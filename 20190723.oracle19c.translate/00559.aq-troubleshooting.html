<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="These topics describe how to troubleshoot Oracle Database Advanced Queuing (AQ).">
      <meta name="description" content="These topics describe how to troubleshoot Oracle Database Advanced Queuing (AQ).">
      <title>Troubleshooting Oracle Database Advanced Queuing</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Advanced Queuing User's Guide ">
      <meta property="og:description" content="These topics describe how to troubleshoot Oracle Database Advanced Queuing (AQ).">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Advanced Queuing User's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="oracle-database-advanced-queuing.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-12T10:53:09-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96511-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="aq-internet-access.html" title="Previous" type="text/html">
      <link rel="next" href="aq-administrative-interface.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="OracleÂ® Database Advanced Queuing">
    <meta name="dcterms.isVersionOf" content="ADQUE">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="aq-internet-access.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="aq-administrative-interface.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Advanced Queuing User's Guide </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Troubleshooting Oracle Database Advanced Queuing</li>
            </ol>
            <a id="GUID-AB1C926E-1C7C-41A0-A16A-FC5615E81234" name="GUID-AB1C926E-1C7C-41A0-A16A-FC5615E81234"></a><a id="ADQUE0700"></a>
            
            <h2 id="ADQUE-GUID-AB1C926E-1C7C-41A0-A16A-FC5615E81234" class="sect2"><span class="enumeration_chapter">7 </span> Troubleshooting Oracle Database Advanced Queuing
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>These topics describe how to troubleshoot Oracle Database Advanced Queuing (AQ).</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="aq-troubleshooting.html#GUID-473DCAFD-BBF1-47A2-8010-3A70BFE3A4EB" title="These tips should help with debugging propagation problems. This discussion assumes that you have created queue tables and queues in source and target databases and defined a database link for the destination database.">Debugging Oracle Database Advanced Queuing Propagation Problems</a></p>
                  </li>
                  <li>
                     <p><a href="aq-troubleshooting.html#GUID-17EE50B4-17C7-4246-8CC8-EA486B831FCA" title="The Oracle Database Advanced Queuing Error Messages are listed here.">Oracle Database Advanced Queuing Error Messages</a></p>
                  </li>
               </ul>
            </div><a id="ADQUE2650"></a><div class="props_rev_3"><a id="GUID-473DCAFD-BBF1-47A2-8010-3A70BFE3A4EB" name="GUID-473DCAFD-BBF1-47A2-8010-3A70BFE3A4EB"></a><h3 id="ADQUE-GUID-473DCAFD-BBF1-47A2-8010-3A70BFE3A4EB" class="sect3"><span class="enumeration_section">7.1 </span>Debugging Oracle Database Advanced Queuing Propagation Problems
               </h3>
               <div>
                  <p>These tips should help with debugging propagation problems. This discussion assumes that you have created queue tables and queues in source and target databases and defined a database link for the destination database.</p>
                  <div class="section">
                     <p>The notation assumes that you supply the actual name of the entity (without the brackets). </p>
                     <div class="infoboxnotealso" id="GUID-473DCAFD-BBF1-47A2-8010-3A70BFE3A4EB__GUID-224A031B-9647-48AD-BDF0-DB0F37B9466A">
                        <p class="notep1">See Also:</p>
                        <p><span class="q">"<a href="managing-aq.html#GUID-D1888DEE-D758-411C-8AFF-EBEF6B704482" title="AQ propagation jobs are run by the Oracle Scheduler. Propagation may be scheduled in these ways.">Optimizing Propagation</a>"</span></p>
                     </div>
                     <p>To begin debugging, do the following:</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>Check that the propagation schedule has been created and that a job queue process has been assigned. </span><div>
                           <p>Look for the entry in the <code class="codeph">DBA_QUEUE_SCHEDULES</code> view and make sure that the status of the schedule is enabled. <code class="codeph">SCHEDULE_DISABLED</code> must be set to '<code class="codeph">N</code>'. Check that it has a nonzero entry for <code class="codeph">JOBNO</code> in table <code class="codeph">AQ$_SCHEDULES</code>, and that there is an entry in table <code class="codeph">JOB$</code> with that <code class="codeph">JOBNO</code>. 
                           </p>
                           <p>To check if propagation is occurring, monitor the <code class="codeph">DBA_QUEUE_SCHEDULES</code> view for the number of messages propagated (<code class="codeph">TOTAL_NUMBER</code>). 
                           </p>
                           <p>If propagation is not occurring, check the view for any errors. Also check the <code class="codeph">NEXT_RUN_DATE</code> and <code class="codeph">NEXT_RUN_TIME</code> in <code class="codeph">DBA_QUEUE_SCHEDULES</code> to see if propagation is scheduled for a later time, perhaps due to errors or the way it is set up.
                           </p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>Check if the database link to the destination database has been set up properly. Make sure that the queue owner can use the database link. You can do this with:</span><div><pre class="oac_no_warn" dir="ltr">select count(*) from <span class="italic">table_name</span>@d<span class="italic">blink_name</span>;
</pre></div>
                     </li>
                     <li class="stepexpand"><span>Make sure that at least two job queue processes are running. </span></li>
                     <li class="stepexpand"><span>Check for messages in the source <a href="glossary.html#GUID-583DEF67-C9BC-4B83-B8DC-2375A5BE08BB"><span class="xrefglossterm">queue</span></a> with:</span><div><pre class="oac_no_warn" dir="ltr">select count (*) from AQ$&lt;source_queue_table&gt; 
  where q_name = 'source_queue_name';
</pre></div>
                     </li>
                     <li class="stepexpand"><span>Check for messages in the destination queue with:</span><div><pre class="oac_no_warn" dir="ltr">select count (*) from AQ$&lt;destination_queue_table&gt; 
  where q_name = 'destination_queue_name';
</pre></div>
                     </li>
                     <li class="stepexpand"><span>Check to see who is using job queue processes.</span><div>
                           <p>Check which jobs are being run by querying <code class="codeph">dba_jobs_running</code>. It is possible that other jobs are starving the propagation jobs. 
                           </p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>Check to see that the queue table <code class="codeph">sys.aq$_prop_table_</code><span class="italic"><code class="codeph">instno</code></span> exists in <code class="codeph">DBA_QUEUE_TABLES</code>. The queue <code class="codeph">sys.aq$_prop_notify_queue_</code><span class="italic"><code class="codeph">instno</code></span> must also exist in <code class="codeph">DBA_QUEUES</code> and must be enabled for enqueue and dequeue. </span><div>
                           <p>In case of Oracle Real Application Clusters (Oracle RAC), this queue table and queue pair must exist for each Oracle RAC node in the system. They are used for communication between job queue processes and are automatically created.</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>Check that the <a href="glossary.html#GUID-B9071BDE-395F-4686-B2D2-A1B83F986BCC"><span class="xrefglossterm">consumer</span></a> attempting to <a href="glossary.html#GUID-BC8D60E8-953A-4C6C-8163-F7AE187B768B"><span class="xrefglossterm">dequeue</span></a> a <a href="glossary.html#GUID-2028AECF-DB3E-40E2-99B6-A35674C08038"><span class="xrefglossterm">message</span></a> from the destination queue is a recipient of the propagated messages. </span><div>
                           <p>For 8.1-style queues, you can do the following:</p><pre class="oac_no_warn" dir="ltr">select consumer_name, deq_txn_id, deq_time, deq_user_id, 
  propagated_msgid from aq$&lt;destination_queue_table&gt; 
  where queue = '<span class="italic">queue_name</span>';
</pre><p>For 8.0-style queues, you can obtain the same information from the history column of the <a href="glossary.html#GUID-45894F1F-4871-4A00-9171-2743821BAD3A"><span class="xrefglossterm">queue table</span></a>: 
                           </p><pre class="oac_no_warn" dir="ltr">select h.consumer, h.transaction_id, h.deq_time, h.deq_user,
  h.propagated_msgid from aq$&lt;destination_queue_table&gt; t, table(t.history) h 
  where t.q_name = 'queue_name'; 
</pre><div class="infoboxnote" id="GUID-473DCAFD-BBF1-47A2-8010-3A70BFE3A4EB__GUID-EED73681-8A0E-4EB8-920F-27330B9AAE33">
                              <p class="notep1">Note:</p>
                              <p>Queues created in a queue table with <code class="codeph">compatible</code> set to <code class="codeph">8.0</code> (referrred to in this guide as 8.0-style queues) are deprecated in Oracle Database Advanced Queuing 10<span class="italic">g</span> Release 2 (10.2). Oracle recommends that any new queues you create be 8.1-style or newer and that you migrate existing 8.0-style queues at your earliest convenience.
                              </p>
                           </div>
                        </div>
                     </li>
                     <li class="stepexpand"><span>Turn on <a href="glossary.html#GUID-DE5B852F-823C-4DC8-B6BB-4825D688A00A"><span class="xrefglossterm">propagation</span></a> tracing at the highest level using event 24040, level 10.</span><div>
                           <p>Debugging information is logged to job queue trace files as propagation takes place. You can check the trace file for errors and for statements indicating that messages have been sent.</p>
                        </div>
                     </li>
                  </ol>
               </div>
            </div><a id="ADQUE2652"></a><a id="ADQUE2653"></a><a id="ADQUE2654"></a><a id="ADQUE2655"></a><a id="ADQUE2651"></a><div class="props_rev_3"><a id="GUID-17EE50B4-17C7-4246-8CC8-EA486B831FCA" name="GUID-17EE50B4-17C7-4246-8CC8-EA486B831FCA"></a><h3 id="ADQUE-GUID-17EE50B4-17C7-4246-8CC8-EA486B831FCA" class="sect3"><span class="enumeration_section">7.2 </span>Oracle Database Advanced Queuing Error Messages
               </h3>
               <div>
                  <p>The Oracle Database Advanced Queuing Error Messages are listed here.</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-17EE50B4-17C7-4246-8CC8-EA486B831FCA__GUID-B3B680E6-4EB6-4691-A285-F20CF808DAE6">ORA-1555</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>You might get this error when using the <code class="codeph">NEXT_MESSAGE</code> navigation option for dequeue. <code class="codeph">NEXT_MESSAGE</code> uses the snapshot created during the first dequeue call. After that, undo information may not be retained.
                     </p>
                     <p>The workaround is to use the <code class="codeph">FIRST_MESSAGE</code> option to dequeue the message. This reexecutes the cursor and gets a new snapshot. <code class="codeph">FIRST_MESSAGE</code> does not perform as well as <code class="codeph">NEXT_MESSAGE</code>, so Oracle recommends that you dequeue messages in batches: <code class="codeph">FIRST_MESSAGE</code> for one, <code class="codeph">NEXT_MESSAGE</code> for the next 1000 messages, then <code class="codeph">FIRST_MESSAGE</code> again, and so on.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-17EE50B4-17C7-4246-8CC8-EA486B831FCA__GUID-79F34093-53BB-4F1B-B129-0B8AB86EC202">ORA-24033</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>This error is raised if a message is enqueued to a multiconsumer queue with no recipient and the queue has no subscribers (or rule-based subscribers that match this message). This is a warning that the message will be discarded because there are no recipients or subscribers to whom it can be delivered.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-17EE50B4-17C7-4246-8CC8-EA486B831FCA__GUID-907F751F-0997-468D-9BCE-3E303435A7CF">ORA-25237</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>When using the Oracle Database Advanced Queuing navigation option, you must reset the dequeue position by using the <code class="codeph">FIRST_MESSAGE</code> option if you want to continue dequeuing between services (such as <code class="codeph">xa_start</code> and <code class="codeph">xa_end</code> boundaries). This is because XA cancels the cursor fetch state after an <code class="codeph">xa_end</code>. If you do not reset, then you get an error message stating that the navigation is used out of sequence.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-17EE50B4-17C7-4246-8CC8-EA486B831FCA__GUID-086D52CF-CFB8-4FED-9CF4-42588BA9E660">ORA-25307</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>Flow control has been enabled for the message sender. This means that the fastest subscriber of the sender's message is not able to keep pace with the rate at which messages are enqueued. The buffered messaging application must handle this error and attempt again to enqueue messages after waiting for some time.</p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>