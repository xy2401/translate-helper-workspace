<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>透明应用程序故障转移</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="JDBC Developer&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="JDBC Developer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="jdbc-developers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-02-13T13:20:37-08:00"></meta>
      <meta name="dcterms.title" content="JDBC Developer&#39;s Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="1999, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96471-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="JDBC-support-Oracle-FAN.html" title="Previous" type="text/html"></link>
      <link rel="next" href="single-client-access-name.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="JJDBC"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="JDBC-support-Oracle-FAN.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="single-client-access-name.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">JDBC开发人员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="high-availablility.html" property="item" typeof="WebPage"><span property="name">高可用性</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">透明应用程序故障转移</li>
            </ol>
            <a id="GUID-95B3215D-A988-4619-94BD-0C6F56B8F43C" name="GUID-95B3215D-A988-4619-94BD-0C6F56B8F43C"></a>
            
            <h2 id="JJDBC-GUID-95B3215D-A988-4619-94BD-0C6F56B8F43C" class="sect2"><span class="enumeration_chapter">31</span>透明应用程序故障转移</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章包含以下部分：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="transparent-application-failover.html#GUID-CE4DC31A-56F6-45B3-B4AE-1DAC8414138B">透明应用程序故障转移概述</a></p>
                  </li>
                  <li>
                     <p><a href="transparent-application-failover.html#GUID-2FE6BED0-3879-47AF-9381-E13E3C45B155">故障转移类型事件</a></p>
                  </li>
                  <li>
                     <p><a href="transparent-application-failover.html#GUID-2B28C498-F588-45B9-B1A0-8F396FF6D756">TAF回调</a></p>
                  </li>
                  <li>
                     <p><a href="transparent-application-failover.html#GUID-E3BA2E54-B332-46AB-BEB9-175B789F3FFC">Java TAF回调接口</a></p>
                  </li>
                  <li>
                     <p><a href="transparent-application-failover.html#GUID-0C2A0B68-6391-4CDD-A5D0-3A7B72966E79">TAF与快速连接故障转移的比较</a></p>
                  </li>
               </ul>
            </div><a id="JJDBC28836"></a><div class="props_rev_3"><a id="GUID-CE4DC31A-56F6-45B3-B4AE-1DAC8414138B" name="GUID-CE4DC31A-56F6-45B3-B4AE-1DAC8414138B"></a><h3 id="JJDBC-GUID-CE4DC31A-56F6-45B3-B4AE-1DAC8414138B" class="sect3"><span class="enumeration_section">31.1</span>透明应用程序故障转移概述</h3>
               <div>
                  <p><a id="d79516e56" class="indexterm-anchor"></a>透明应用程序故障转移<a id="d79516e59" class="indexterm-anchor"></a> TAF）是Java数据库连接（JDBC）Oracle调用接口（OCI）驱动程序的一项功能。如果建立连接的数据库实例失败，它使应用程序能够自动重新连接到数据库。在这种情况下，活动事务回滚。
                  </p>
                  <p>当建立连接的实例失败或关闭时，客户端上的连接变得陈旧，并且会向尝试使用它的调用者抛出异常。TAF使应用程序能够透明地重新连接到预配置的辅助实例，从而创建新连接，但与在第一个原始实例上建立的连接相同。也就是说，连接属性与早期连接的属性相同。无论连接如何丢失，都是如此。</p>
                  <div class="infoboxnote" id="GUID-CE4DC31A-56F6-45B3-B4AE-1DAC8414138B__GUID-3DDE1848-D67F-4792-9D08-1BD830B74D8B">
                     <p class="notep1">注意：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>TAF始终处于活动状态，无需进行设置。</p>
                        </li>
                        <li>
                           <p>LOB和XML类型不支持TAF。</p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="JJDBC28837"></a><div class="props_rev_3"><a id="GUID-2FE6BED0-3879-47AF-9381-E13E3C45B155" name="GUID-2FE6BED0-3879-47AF-9381-E13E3C45B155"></a><h3 id="JJDBC-GUID-2FE6BED0-3879-47AF-9381-E13E3C45B155" class="sect3"><span class="enumeration_section">31.2</span>故障转移类型事件</h3>
               <div>
                  <div class="section">
                     <p>以下是<code class="codeph">OracleOCIFailover</code>接口中可能的故障转移事件：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">FO_SESSION</code></p>
                           <p>相当于<code class="codeph">tnsnames.ora</code>文件<code class="codeph">CONNECT_DATA</code>标志中的<code class="codeph">FAILOVER_MODE=SESSION</code> 。这意味着只有用户会话在服务器端再次进行身份验证，而OCI应用程序中的打开游标需要重新处理。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">FO_SELECT</code></p>
                           <p>相当于<code class="codeph">tnsnames.ora</code>文件中的<code class="codeph">FAILOVER_MODE=SELECT</code> <code class="codeph">CONNECT_DATA</code>标志。这意味着不仅在服务器端重新验证用户会话，而且OCI中的打开游标可以继续获取。这意味着客户端逻辑维护每个打开游标的获取状态。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">FO_NONE</code></p>
                           <p>相当于<code class="codeph">tnsnames.ora</code>文件<code class="codeph">CONNECT_DATA</code>标志中的<code class="codeph">FAILOVER_MODE=NONE</code> 。这是默认设置，不使用故障转移功能。这也可以明确指定，以防止发生故障转移。此外， <code class="codeph">FO_TYPE_UNKNOWN</code>表示从OCI驱动程序返回了错误的故障转移类型。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">FO_BEGIN</code></p>
                           <p>表示故障转移已检测到连接丢失且故障转移正在启动。</p>
                        </li>
                        <li>
                           <p><code class="codeph">FO_END</code></p>
                           <p>表示成功完成故障转移。</p>
                        </li>
                        <li>
                           <p><code class="codeph">FO_ABORT</code></p>
                           <p>表示故障转移不成功，并且没有重试选项。</p>
                        </li>
                        <li>
                           <p><code class="codeph">FO_REAUTH</code></p>
                           <p>表示已重新验证用户句柄。</p>
                        </li>
                        <li>
                           <p><code class="codeph">FO_ERROR</code></p>
                           <p>表示故障转移暂时不成功，但它使应用程序有机会处理错误并重试故障转移。错误处理的常用方法是发出<code class="codeph">sleep</code>方法并通过返回值<code class="codeph">FO_RETRY</code>重试。</p>
                        </li>
                        <li>
                           <p><code class="codeph">FO_RETRY</code></p>
                           <p>表示应用程序应重试故障转移。</p>
                        </li>
                        <li>
                           <p><code class="codeph">FO_EVENT_UNKNOWN</code></p>
                           <p>表示错误的故障转移事件。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28838"></a><div class="props_rev_3"><a id="GUID-2B28C498-F588-45B9-B1A0-8F396FF6D756" name="GUID-2B28C498-F588-45B9-B1A0-8F396FF6D756"></a><h3 id="JJDBC-GUID-2B28C498-F588-45B9-B1A0-8F396FF6D756" class="sect3"><span class="enumeration_section">31.3</span> TAF回调</h3>
               <div>
                  <div class="section">
                     <p>TAF回调用于一个数据库连接失败的情况，并故障转移到另一个数据库连接。TAF回调是在故障转移时注册的回调。在故障转移期间调用回调以向JDBC应用程序通知生成的事件。该应用程序还具有一些故障转移控制权。</p>
                     <div class="infoboxnote" id="GUID-2B28C498-F588-45B9-B1A0-8F396FF6D756__GUID-DB9F898C-0942-4D32-A65F-C76E7A62F99D">
                        <p class="notep1">注意：</p>
                        <p>回调设置是可选的。</p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28840"></a><a id="JJDBC28841"></a><a id="JJDBC28839"></a><div class="props_rev_3"><a id="GUID-E3BA2E54-B332-46AB-BEB9-175B789F3FFC" name="GUID-E3BA2E54-B332-46AB-BEB9-175B789F3FFC"></a><h3 id="JJDBC-GUID-E3BA2E54-B332-46AB-BEB9-175B789F3FFC" class="sect3"><span class="enumeration_section">31.4</span> Java TAF回调接口</h3>
               <div>
                  <div class="section">
                     <p><code class="codeph">OracleOCIFailover</code>接口包含<code class="codeph">callbackFn</code>方法，支持以下类型和事件：</p><pre class="oac_no_warn" dir="ltr">public interface OracleOCIFailover {//可能的故障转移类型public static final int FO_SESSION = 1; public static final int FO_SELECT = 2; public static final int FO_NONE = 3; public static final int; //使用callback注册的可能的故障转移事件public static final int FO_BEGIN = 1; public static final int FO_END = 2; public static final int FO_ABORT = 3; public static final int FO_REAUTH = 4; public static final int FO_ERROR = 5; public static final int FO_RETRY = 6; public static final int FO_EVENT_UNKNOWN = 7; public int callbackFn（Connection conn，Object ctxt，//用户想要保存int类型的东西，//可能的故障转移类型int事件之一）; //可能的故障转移事件之一</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-E3BA2E54-B332-46AB-BEB9-175B789F3FFC__GUID-AC90627B-2F92-483D-BACE-13F715C9F02E">处理FO_ERROR事件</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>如果在故障转移到新连接时发生错误，JDBC应用程序可以重试故障转移。通常，应用程序会休眠一段时间，然后通过让回调返回<code class="codeph">FO_RETRY</code> ，无限期地或在有限的时间内重试。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-E3BA2E54-B332-46AB-BEB9-175B789F3FFC__GUID-314F0FA3-FDF3-40BE-86D9-0EAF0B58BE76">处理FO_ABORT事件</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>如果<code class="codeph">FO_ERROR</code>事件传递给它，则注册的回调应该返回<code class="codeph">FO_ABORT</code>事件。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28835"></a><div class="props_rev_3"><a id="GUID-0C2A0B68-6391-4CDD-A5D0-3A7B72966E79" name="GUID-0C2A0B68-6391-4CDD-A5D0-3A7B72966E79"></a><h3 id="JJDBC-GUID-0C2A0B68-6391-4CDD-A5D0-3A7B72966E79" class="sect3"><span class="enumeration_section">31.5</span> TAF和快速连接故障转移的比较</h3>
               <div>
                  <div class="section">
                     <p>透明应用程序故障转移（TAF）与快速连接故障转移的区别在于以下方面：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>应用程序级连接重试</p>
                           <p>TAF仅支持在OCI / Net层进行连接重试。快速连接故障转移支持应用程序级连接重试。这使应用程序可以控制响应连接故障转移。应用程序可以选择是重试连接还是重新抛出异常。</p>
                        </li>
                        <li>
                           <p>与通用连接池集成</p>
                           <p>TAF在每个连接的基础上在网络级别工作，这意味着无法通知连接缓存失败。快速连接故障转移与通用连接池完美集成，使连接缓存管理器能够管理缓存以实现高可用性。例如，失败的连接在缓存中自动失效。</p>
                        </li>
                        <li>
                           <p>基于事件</p>
                           <p>快速连接故障转移基于Oracle RAC事件机制。这意味着快速连接故障转移非常有效，可以快速检测活动和非活动连接的故障。</p>
                        </li>
                        <li>
                           <p>负载平衡支持</p>
                           <p>快速连接故障转移支持跨活动Oracle RAC实例的连接的<code class="codeph">UP</code>事件负载平衡和运行时工作请求分发。
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-0C2A0B68-6391-4CDD-A5D0-3A7B72966E79__GUID-E205D954-856A-45B7-8A47-7C4FBB394456">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../jjucp/fast-connection-failover.html#JJUCP08100" target="_blank"><span class="italic">JDBC开发人员指南的Oracle通用连接池</span></a></p>
                     </div>
                     <div class="infoboxnote" id="GUID-0C2A0B68-6391-4CDD-A5D0-3A7B72966E79__GUID-169A8EF1-0EED-461C-A777-042F4B092428">
                        <p class="notep1">注意：</p>
                        <p>Oracle建议<span class="italic">不要</span>在同一应用程序中使用TAF和快速连接故障转移。
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>