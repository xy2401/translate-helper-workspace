<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="You can configure a PDB snapshot carousel for a specified PDB, create snapshots manually or automatically, and set the maximum number of snapshots."></meta>
      <meta name="description" content="You can configure a PDB snapshot carousel for a specified PDB, create snapshots manually or automatically, and set the maximum number of snapshots."></meta>
      <title>管理PDB快照轮播</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Administrator’s Guide "></meta>
      <meta property="og:description" content="You can configure a PDB snapshot carousel for a specified PDB, create snapshots manually or automatically, and set the maximum number of snapshots."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Administrator’s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="multitenant-administrators-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-03-20T09:59:22-07:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2017, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96136-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="administering-pdbs-with-sql-plus.html" title="Previous" type="text/html"></link>
      <link rel="next" href="administering-application-containers-with-sql-plus.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Multitenant Administrator&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="MULTI"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="administering-pdbs-with-sql-plus.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="administering-application-containers-with-sql-plus.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">管理员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="managing-a-multitenant-environment.html" property="item" typeof="WebPage"><span property="name">管理多租户环境</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">管理PDB快照轮播</li>
            </ol>
            <a id="GUID-FF6DF540-0C22-451C-80B3-1ACA8C8CB7D2" name="GUID-FF6DF540-0C22-451C-80B3-1ACA8C8CB7D2"></a>
            
            <h2 id="MULTI-GUID-FF6DF540-0C22-451C-80B3-1ACA8C8CB7D2" class="sect2"><span class="enumeration_chapter">16</span>管理<span>PDB快照轮播</span></h2>
         </header>
         <div class="ind">
            <div>
               <p>您可以为指定的PDB配置<span>PDB快照轮播</span> ，手动或自动创建快照，以及设置最大快照数。
               </p>
               <p>本节包含以下主题：</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-72CA6DD5-4DE5-4375-BEA6-A01E5E31A01B">关于PDB Snapshot Carousel</a><br><span>PDB快照轮播是PDB快照库。</span>  
                  </li>
                  <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-B6A785B6-42F2-4027-9DA5-6FA1164CCC5C">设置PDB快照轮播中的最大快照数</a><br>您可以为PDB设置最大PDB快照数。</li>
                  <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5">配置自动PDB快照</a><br>在创建或更改PDB时，使用<code class="codeph">SNAPSHOT MODE EVERY</code>子句为自动快照配置PDB。</li>
                  <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-FBF77C07-9B40-4BF3-8C7D-61C8F11E2B14">手动创建PDB快照</a><br>要手动创建PDB快照，请在<code class="codeph">ALTER PLUGGABLE DATABASE</code>或<code class="codeph">CREATE PLUGGABLE DATABASE</code>指定<code class="codeph">SNAPSHOT <span class="codeinlineitalic">snapshot_name</span></code>子句。</li>
                  <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-9E7D3176-9504-429D-895F-A3D60028FE5A">删除PDB快照</a><br>您可以通过使用<code class="codeph">DROP SNAPSHOT</code>子句运行<code class="codeph">ALTER PLUGGABLE DATABASE</code>语句来删除PDB快照。
                  </li>
                  <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-87CB7869-5A15-456F-90B8-361A0D06D8AF">查看PDB快照的元数据</a><br>数据字典视图<code class="codeph">DBA_PDB_SNAPSHOTS</code>和<code class="codeph">DBA_PDB_SNAPSHOTFILE</code>显示PDB快照的元数据。
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="managing-a-multitenant-environment.html#GUID-93F1E584-D309-4301-82E0-AD0E60D4977C" title="您可以使用SQL * Plus或企业管理器云控制（云控制）管理多租户环境。">管理多租户环境</a></p>
                  </div>
               </div>
            </div>
            
            <div class="sect2"><a id="GUID-72CA6DD5-4DE5-4375-BEA6-A01E5E31A01B" name="GUID-72CA6DD5-4DE5-4375-BEA6-A01E5E31A01B"></a><h3 id="MULTI-GUID-72CA6DD5-4DE5-4375-BEA6-A01E5E31A01B" class="sect3"><span class="enumeration_section">16.1</span>关于<span>PDB Snapshot Carousel</span></h3>
               <div>
                  <p><span>PDB快照轮播是PDB快照库。</span>  
                  </p>
                  <p><span><span id="GUID-72CA6DD5-4DE5-4375-BEA6-A01E5E31A01B__d5e1624"><strong class="term">PDB快照</strong>是<strong class="term">PDB</strong>的时间点副本。</span>您可以使用<code class="codeph">CREATE PLUGGABLE DATABASE</code> （或<code class="codeph">ALTER PLUGGABLE DATABASE</code> ）的<code class="codeph">SNAPSHOT</code>子句手动创建快照，也可以使用<code class="codeph">EVERY <span class="codeinlineitalic">interval</span></code>子句自动创建快照。</span></p>
                  <p>从<span>Oracle Database 19c开始</span> ，您可以在读/写模式下创建源PDB的快照。PDB快照的内容取决于创建快照时<code class="codeph">CLONEDB</code>初始化参数的设置。当<code class="codeph">CLONEDB</code>为<code class="codeph">TRUE</code> ，快照是PDB数据文件的稀疏副本。当<code class="codeph">CLONEDB</code>为<code class="codeph">FALSE</code> ，快照是PDB文件的完整副本。
                  </p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-87183462-C87C-432C-BE7E-282B1F1202F4">PDB快照轮播的目的</a><br><span>PDB快照轮播</span>是维护最近PDB副本库以进行时间点恢复和克隆的有用方法。
                     </li>
                     <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-F2FC2FCB-2DA2-43B5-B98D-8902BC8D66A6">PDB快照轮播的工作原理</a><br>特定PDB的轮播是该PDB的循环副本库。</li>
                     <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF">PDB快照轮播的用户界面</a><br><code class="codeph">SNAPSHOT MODE</code>子句控制快照的创建，并确定创建是手动，自动还是禁用。
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-72CA6DD5-4DE5-4375-BEA6-A01E5E31A01B__GUID-2B838C1E-DA59-4675-96E2-789D15689B03">
                     <p class="notep1">也可以看看：</p>
                     <p><span><a href="../dblic/Licensing-Information.html#DBLIC-GUID-0F9EB85D-4610-4EDF-89C2-4916A0E7AC87" target="_blank"><span><cite>“Oracle数据库许可信息用户手册”</cite></span></a> ，了解不同版本和服务支持哪些功能的详细信息</span></p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="administering-pdb-snapshots.html#GUID-FF6DF540-0C22-451C-80B3-1ACA8C8CB7D2" title="您可以为指定的PDB配置PDB快照轮播，手动或自动创建快照，以及设置最大快照数。">管理PDB快照轮播</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-87183462-C87C-432C-BE7E-282B1F1202F4" name="GUID-87183462-C87C-432C-BE7E-282B1F1202F4"></a><h4 id="MULTI-GUID-87183462-C87C-432C-BE7E-282B1F1202F4" class="sect4"><span class="enumeration_section">16.1.1</span> <span>PDB快照轮播的</span>目的</h4>
                  <div>
                     <p><span>PDB快照轮播</span>是维护最近PDB副本库以进行时间点恢复和克隆的有用方法。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-87183462-C87C-432C-BE7E-282B1F1202F4__GUID-F75B3C72-B251-470D-8417-97D0AD782A84">克隆PDB以进行开发和测试</p>
                        <p>在典型的开发用例中，您将克隆生产PDB以进行测试。当CDB处于<code class="codeph">ARCHIVELOG</code>模式和本地撤消模式时，源生产PDB可以在读/写模式下打开并在操作期间完全起作用。这种技术称为<strong class="term">热克隆</strong> 。在<code class="codeph">ALTER PLUGGABLE DATABASE ...完成时，热克隆与SCN上的源PDB在事务上保持一致<code class="codeph">ALTER PLUGGABLE DATABASE ...OPEN</code>声明。
                        </p>
                        <p>例如，当名为<code class="codeph">pdb1_prod</code>的生产PDB已打开并正在使用时，您将创建名为<code class="codeph">pdb1_test_master</code>的可刷新克隆。然后，您可以配置<code class="codeph">pdb1_test_master</code>以每天创建自动快照。当您需要新的PDB进行测试时，请创建任何PDB快照的完整克隆，然后使用<code class="codeph">CREATE PLUGGABLE DATABASE ...创建稀疏克隆<code class="codeph">CREATE PLUGGABLE DATABASE ...SNAPSHOT COPY</code> 。</p>
                        <p>下图显示了从4月5日拍摄的PDB快照创建克隆<code class="codeph">pdb1_test_full1</code> 。该图显示了从<code class="codeph">pdb1_test_full1</code>创建的三个快照复制PDB。
                        </p>
                        <div class="figure" id="GUID-87183462-C87C-432C-BE7E-282B1F1202F4__GUID-BE4DAD25-D140-43DD-8BE8-E02A30BA6433">
                           <p class="titleinfigure">图16-1可刷新克隆PDB的自动快照</p><img src="img/multi_pb_001a1.png" alt="下面是图16-1的描述" title="下面是图16-1的描述" longdesc="img_text/multi_pb_001a1.html"><br><a href="img_text/multi_pb_001a1.html">“图16-1可刷新克隆PDB的自动快照”的描述</a></div>
                        <!-- class="figure" -->
                        <p>从Oracle Database 19c开始，当<code class="codeph">CLONEDB</code>初始化参数为<code class="codeph">TRUE</code> ，您可以使用<code class="codeph">ALTER PLUGGABLE DATABASE SNAPSHOT</code>创建读/写PDB的稀疏数据库管理快照。只有第一个数据库管理的PDB快照已满。您可以通过执行<code class="codeph">CREATE PLUGGABLE DATABASE ...从快照克隆稀疏PDB <code class="codeph">CREATE PLUGGABLE DATABASE ...USING SNAPSHOT</code> 。与以前的版本不同，克隆PDB不要求源PDB在克隆PDB的生命周期内保持读/仅模式。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-87183462-C87C-432C-BE7E-282B1F1202F4__GUID-C3F9E599-5C78-4B0B-87FA-65E2AE4A654D">使用<span>PDB快照轮播</span>进行时间点恢复</p>
                        <p>典型的策略是每天同时拍摄PDB的快照。另一种策略是在数据加载之前手动获取PDB快照。在任何一种情况下， <span>PDB快照轮播都</span>允许您使用任何可用的PDB快照还原PDB。
                        </p>
                        <p>例如，名为<code class="codeph">pdb1_prod</code>的销售历史PDB每天上午12:01生成自动快照。在4月9日星期一下午的每日数据加载中，您意外加载了错误的数据，从而破坏了PDB。您可以基于星期一4/9快照创建新的生产PDB，删除损坏的PDB，然后重试数据加载。
                        </p>
                        <div class="figure" id="GUID-87183462-C87C-432C-BE7E-282B1F1202F4__GUID-9E3BDF6C-438E-45CF-8036-F809220662CC">
                           <p class="titleinfigure">图16-2使用快照还原生产PDB</p><img src="img/multi_pb_003a.png" alt="下面是图16-2的描述" title="下面是图16-2的描述" longdesc="img_text/multi_pb_003a.html"><br><a href="img_text/multi_pb_003a.html">“图16-2使用快照还原生产PDB”的说明</a></div>
                        <!-- class="figure" -->
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-87183462-C87C-432C-BE7E-282B1F1202F4__GUID-31595C90-5E04-4133-85D4-9078A802CC51">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="cloning-a-pdb.html#GUID-8A6287A1-14E5-4B45-972F-FC2FB3CDCF8B" title="克隆意味着从源PDB或非CDB创建新的PDB。">关于克隆PDB或非CDB</a> ”</span></p>
                           </li>
                           <li>
                              <p>用于<code class="codeph">CREATE PLUGGABLE DATABASE</code>语法和语义的<a href="../sqlrf/CREATE-PLUGGABLE-DATABASE.html#SQLRF-GUID-F2DBA8DD-EEA8-4BB7-A07F-78DC04DB1FFC" target="_blank"><span><cite>Oracle数据库SQL语言参考</cite></span></a></p>
                           </li>
                           <li>
                              <p><span><a href="../dblic/Licensing-Information.html#DBLIC-GUID-0F9EB85D-4610-4EDF-89C2-4916A0E7AC87" target="_blank"><span><cite>“Oracle数据库许可信息用户手册”</cite></span></a> ，了解不同版本和服务支持哪些功能的详细信息</span></p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="administering-pdb-snapshots.html#GUID-72CA6DD5-4DE5-4375-BEA6-A01E5E31A01B" title="PDB快照轮播是PDB快照库。">关于PDB Snapshot Carousel</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-F2FC2FCB-2DA2-43B5-B98D-8902BC8D66A6" name="GUID-F2FC2FCB-2DA2-43B5-B98D-8902BC8D66A6"></a><h4 id="MULTI-GUID-F2FC2FCB-2DA2-43B5-B98D-8902BC8D66A6" class="sect4"><span class="enumeration_section">16.1.2</span> <span>PDB快照轮播的</span>工作<span class="enumeration_section">原理</span></h4>
                  <div>
                     <p>特定PDB的轮播是该PDB的循环副本库。</p>
                     <p>数据库可以根据需要或自动在轮播中创建连续副本。达到快照限制时，数据库将覆盖最旧的快照。</p>
                     <p>本节包括以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-35B03C37-00BA-4945-BF20-9A7C4C541955">PDB快照的内容</a><br>PDB快照的内容取决于<code class="codeph">CLONEDB</code>初始化参数的设置。
                        </li>
                        <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-751B6486-D4C3-4A66-8CAD-7DEF067F34DB">PDB快照轮播的内容</a><br><span>PDB快照轮播</span>是<span>PDB</span>的所有现有快照的集合。</li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="administering-pdb-snapshots.html#GUID-72CA6DD5-4DE5-4375-BEA6-A01E5E31A01B" title="PDB快照轮播是PDB快照库。">关于PDB Snapshot Carousel</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955" name="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955"></a><h5 id="MULTI-GUID-35B03C37-00BA-4945-BF20-9A7C4C541955" class="sect5"><span class="enumeration_section">16.1.2.1</span> PDB快照的内容</h5>
                     <div>
                        <p>PDB快照的内容取决于<code class="codeph">CLONEDB</code>初始化参数的设置。
                        </p>
                        <div class="section">
                           <p class="subhead3" id="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955__GUID-76ECBCA8-BD11-4679-8B16-F7B87C1E65AA">快照名称</p>
                           <p>数据库管理的PDB快照的名称可以是用户指定的，也可以是系统生成的。对于系统生成的快照名称， <code class="codeph">SNAP_</code>前缀为唯一标识符，其中包含快照SCN。例如，以下查询显示了三个具有系统生成的名称的快照以及执行这些名称的SCN：</p><pre class="pre codeblock"><code>SET LINESIZE 200 SET PAGESIZE 50000 COL CON_ID FORMAT 999999 COL CON_NAME FORMAT a15 COL SNAPSHOT_NAME FORMAT a27 SELECT CON_ID，CON_NAME，SNAPSHOT_NAME，SNAPSHOT_SCN FROM DBA_PDB_SNAPSHOTS; CON_ID CON_NAME SNAPSHOT_NAME SNAPSHOT_SCN ------- --------------- ------------------------ --- ------------ 5 HRPDB SNAP_1389467754_993556301 2925293 5 HRPDB SNAP_1389467754_993556306 2925679 5 HRPDB SNAP_1389467754_993556309 2925698</code></pre><div class="infoboxnote" id="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955__GUID-FEE7CE17-B281-4A3F-980C-B0581F730B0C">
                              <p class="notep1">注意：</p>
                              <p id="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955__d5e5244">有关<span id="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955__d5e5246">不同版本和服务支持哪些功能的详细信息，</span>请参阅“ <span id="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955__d5e5246"><a href="../dblic/Licensing-Information.html#DBLIC-GUID-0F9EB85D-4610-4EDF-89C2-4916A0E7AC87" target="_blank"><span><cite>Oracle数据库许可信息用户手册</cite></span></a> ”</span> 。
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955__GUID-4868542E-5F00-4CC5-9E00-6A99B6734F1B">完整和稀疏快照</p>
                           <p><span>使用稀疏性和写时复制等技术，当<code class="codeph">CLONEDB</code>为<code class="codeph">TRUE</code>时创建的快照克隆PDB表现为源PDB的完整数据集副本，而不需要复制所有数据。仅复制数据文件头。如果修改了快照克隆PDB中的数据块，则Oracle数据库会复制受影响的块，从而导致源和克隆PDB的文件头发散。源PDB标头指向原始数据块，而克隆PDB标头指向复制的数据块。</span></p>
                           <p>当<code class="codeph">CLONEDB</code>为<code class="codeph">FALSE</code> ，PDB快照的数据文件驻留在文件系统上的存档文件中。存档的文件扩展名为<code class="codeph">.pdb</code> 。不包含存档的重做日志文件。通常，存档文件存储在与PDB数据文件相同的目录中。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955__GUID-8422A9FC-612D-4599-9CC8-C141227EC4AB">快照目录</p>
                           <p>每个PDB都有自己的快照目录。在此目录中，每个快照都有自己的子目录，该子目录以SCN的名称命名。以下查询显示<code class="codeph">hrpdb</code>的稀疏PDB快照，其DBID为<code class="codeph">1389467754</code> ：</p><pre class="pre codeblock"><code>SET LINESIZE 200 SET PAGESIZE 50000 COL SNAPSHOT_NAME FORMAT a27 COL FULL_SNAPSHOT_PATH FORMAT a65 SELECT SNAPSHOT_NAME，SNAPSHOT_SCN，FULL_SNAPSHOT_PATH来自DBA_PDB_SNAPSHOTS; SNAPSHOT_NAME SNAPSHOT_SCN FULL_SNAPSHOT_PATH --------------------------- ------------ -------- ------------------------------- SNAP_1389467754_993556301 2925293 / d1 / snapshots / pdb_1389467754 / 2925293 / SNAP_1389467754_993556306 2925679 / d1 / snapshots / pdb_1389467754 / 2925679 / SNAP_1389467754_993556309 2925698 / d1 / snapshots / pdb_1389467754 / 2925698 /</code></pre><div class="infoboxnote" id="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955__GUID-3AEADA5B-DD46-4832-998A-6EC50D168D49">
                              <p class="notep1">注意：</p>
                              <p>如果快照已满而不是稀疏，则完整快照路径将指定具有<code class="codeph">.pdb</code>后缀的存档。
                              </p>
                           </div>
                           <p><code class="codeph">/d1/snapshots/pdb_1389467754/2925698/</code>包含以下文件：</p><pre class="pre codeblock"><code>archparlog_1_63_52d1986a_993552590.arc o1_mf_salestbs_g03341t2_.dbf o1_mf_syse_1_g0333vqw_.dbf o1_mf_undo_1_g033gd2j_.dbf o1_mf_sysaux_g0333vqv_.dbf o1_mf_system_g0333vqt_.dbf HRPDB.xml</code></pre><p>该集包括数据文件，归档重做日志文件以及包含有关PDB快照的元数据的XML文件。以下<code class="codeph">du</code>命令显示稀疏的快照数据文件的大小相对于数据文件的大小较小：</p><pre class="pre codeblock"><code>％du -h * dbf 16K o1_mf_salestbs_g03341t2_.dbf 16K o1_mf_sysaux_g0333vqv_.dbf 16K o1_mf_sysext_g0333vqw_.dbf 16K o1_mf_system_g0333vqt_.dbf 16K o1_mf_undo_1_g033gd2j_.dbf</code></pre><p>以下数据字典连接显示快照<code class="codeph">2925698</code>的快照文件名和类型：</p><pre class="pre codeblock"><code>选择f。SNAPSHOT_FILENAME，f。SNAPSHOT_FILETYPE FROM DBA_PDB_SNAPSHOTS s，DBA_PDB_SNAPSHOTFILE f WHERE s。SNAPSHOT_SCN = F。SNAPSHOT_SCN和s。CON_ID = F。CON_ID ORDER BY s。SNAPSHOT_SCN DESC; SNAPSHOT_FILENAME SNAPSHOT ------------------------------------------------ ----------------- -------- /d1/snapshots/pdb_1389467754/2925698/o1_mf_sysaux_g0333vqv_.dbf DATA /d1/snapshots/pdb_1389467754/2925698/o1_mf_system_g0333vqt_.dbf数据/d1/snapshots/pdb_1389467754/2925698/HRPDB.xml XML /d1/snapshots/pdb_1389467754/2925698/o1_mf_sysext_g0333vqw_.dbf DATA /d1/snapshots/pdb_1389467754/2925698/o1_mf_salestbs_g03341t2_.dbf DATA / D1 /快照/ pdb_1389467754 / 2925698 / o1_mf_undo_1_g033gd2j_的.dbf DATA /d1/snapshots/pdb_1389467754/2925698/archparlog_1_63_52d1986a_993552590.arc ARCH /d1/snapshots/pdb_1389467754/2925679/o1_mf_sysext_g0333vqw_.dbf DATA /d1/snapshots/pdb_1389467754/2925679/o1_mf_salestbs_g03341t2_.dbf DATA / D1 /快照/ pdb_1389467754 / 2925679 /o1_mf_undo_1_g033gd2j_.dbf DATA /d1/snapshots/pdb_1389467754/2925679/o1_mf_sysaux_g0333vqv_.dbf DATA /d1/snapshots/pdb_1389467754/2925679/archparlog_1_63_52d1986a_993552590.arc ARCH /d1/snapshots/pdb_1389467754/2925679/HRPDB.xml XML / d1 / snaps白热化/ pdb_1389467754 / 2925679 / o1_mf_system_g0333vqt_.dbf DATA /d1/snapshots/pdb_1389467754/2925293/HRPDB.xml XML /d1/snapshots/pdb_1389467754/2925293/o1_mf_system_g0333vqt_.dbf DATA /d1/snapshots/pdb_1389467754/2925293/o1_mf_sysaux_g0333vqv_.dbf DATA / D1 /快照/ pdb_1389467754 / 2925293 / o1_mf_undo_1_g033gd2j_.dbf DATA /d1/snapshots/pdb_1389467754/2925293/o1_mf_salestbs_g03341t2_.dbf DATA /d1/snapshots/pdb_1389467754/2925293/o1_mf_sysext_g0333vqw_.dbf DATA /d1/snapshots/pdb_1389467754/2925293/archparlog_1_63_52d1986a_993552590.arc拱</code></pre></div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955__GUID-AE32E3F8-128C-44B5-9C7C-A3C7EAECCB81">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="cloning-a-pdb.html#GUID-F26C8A55-2465-475A-905A-83BD2E68AE6E" title="在Oracle Multitenant中，术语快照根据上下文意味着不同的东西。">快照类型</a> ”</span></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="administering-pdb-snapshots.html#GUID-F2FC2FCB-2DA2-43B5-B98D-8902BC8D66A6" title="特定PDB的轮播是该PDB的循环副本库。">PDB快照轮播的工作原理</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-751B6486-D4C3-4A66-8CAD-7DEF067F34DB" name="GUID-751B6486-D4C3-4A66-8CAD-7DEF067F34DB"></a><h5 id="MULTI-GUID-751B6486-D4C3-4A66-8CAD-7DEF067F34DB" class="sect5"><span class="enumeration_section">16.1.2.2</span> <span>PDB快照轮播的内容</span></h5>
                     <div>
                        <p><span>PDB快照轮播</span>是<span>PDB</span>的所有现有快照的集合。</p>
                        <p><code class="codeph">MAX_PDB_SNAPSHOTS</code>属性指定轮播中允许的最大快照数。当前设置在<code class="codeph">CDB_PROPERTIES</code>视图中可见。
                        </p>
                        <p>下图显示了<code class="codeph">cdb1_pdb1</code>的轮播。在此示例中，数据库每天自动获取一个PDB快照，并保持一组8。创建前8个快照后，每个新快照都会替换最旧的快照。例如，星期二4/10快照取代星期一4/2快照;周四的4月3日快照取代了周二的4/3快照;等等。
                        </p>
                        <div class="figure" id="GUID-751B6486-D4C3-4A66-8CAD-7DEF067F34DB__GUID-C10629BB-27E3-4D04-A8B4-8473515CC5C6">
                           <p class="titleinfigure">图16-3 <span>PDB快照轮播</span></p><img src="img/multi_pb_002a.png" alt="下面是图16-3的描述" title="下面是图16-3的描述" longdesc="img_text/multi_pb_002a.html"><br><a href="img_text/multi_pb_002a.html">“图16-3 PDB快照轮播”的说明</a></div>
                        <!-- class="figure" -->
                        <p>启动<span>Oracle Database 19c时</span> ，除第一个之外的轮播中的所有PDB快照都可以是稀疏的，并且源PDB可以保持读/写模式。此功能显着减少了传送带消耗的存储空间。
                        </p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-751B6486-D4C3-4A66-8CAD-7DEF067F34DB__GUID-5ACA1C13-303D-4113-89AF-733AA4CD8930">
                           <p class="notep1">也可以看看：</p>
                           <p><span><a href="../dblic/Licensing-Information.html#DBLIC-GUID-0F9EB85D-4610-4EDF-89C2-4916A0E7AC87" target="_blank"><span><cite>“Oracle数据库许可信息用户手册”</cite></span></a> ，了解不同版本和服务支持哪些功能的详细信息</span></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="administering-pdb-snapshots.html#GUID-F2FC2FCB-2DA2-43B5-B98D-8902BC8D66A6" title="特定PDB的轮播是该PDB的循环副本库。">PDB快照轮播的工作原理</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF" name="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF"></a><h4 id="MULTI-GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF" class="sect4"><span class="enumeration_section">16.1.3</span> <span>PDB快照轮播的</span>用户界面</h4>
                  <div>
                     <p><code class="codeph">SNAPSHOT MODE</code>子句控制快照的创建，并确定创建是手动，自动还是禁用。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF__GUID-68C6A6E5-BF63-478C-9C00-8D2524470DAC">CREATE PLUGGABLE DATABASE语句</p>
                        <p>若要为PDB设置快照模式，请在<code class="codeph">ALTER PLUGGABLE DATABASE</code>或<code class="codeph">CREATE PLUGGABLE DATABASE</code>的<code class="codeph">SNAPSHOT MODE</code>子句中使用以下值之一：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">手册</code></p>
                              <p>此子句是默认设置，可以创建PDB的手动快照。要按需创建快照，请在<code class="codeph">ALTER PLUGGABLE DATABASE</code>或<code class="codeph">CREATE PLUGGABLE DATABASE</code>语句中指定<code class="codeph">SNAPSHOT <span class="codeinlineitalic">snapshot_name</span></code>子句。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">每个<span class="codeinlineitalic">snapshot_interval</span> [MINUTES | HOURS]</code></p>
                              <p>此子句允许在一段时间后自动创建快照。以下限制适用于指定的间隔：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>分钟值必须小于<code class="codeph">3000</code> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p>小时值必须小于<code class="codeph">2000</code> 。
                                    </p>
                                 </li>
                              </ul>
                              <p>数据库为每个自动快照分配系统生成的名称。请注意，指定<code class="codeph">EVERY</code>时，PDB也支持手动快照。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">没有</code></p>
                              <p>此子句禁用PDB的快照创建。</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF__GUID-2FFC8633-8544-4BB0-9755-9BF6E0FDD169">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="cloning-a-pdb.html#GUID-F6F105E1-AB69-4DD0-9A70-51EDD4B2426D" title="PDB快照是PDB的数据库管理的时间点副本。快照克隆PDB是从快照创建的PDB。">关于从PDB快照克隆PDB</a> ”</span></p>
                              </li>
                              <li>
                                 <p><a href="../sqlrf/CREATE-PLUGGABLE-DATABASE.html#SQLRF55694" target="_blank"><span><cite>Oracle数据库SQL语言参考</cite></span></a> ，了解<code class="codeph">SNAPSHOT</code>子句的语法和语义</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF__GUID-8E94B3A9-89D2-4588-935C-4A7D32CA5C24">CLONEDB初始化参数</p>
                        <p>从<span>Oracle Database 19c</span>开始，PDB快照的行为取决于<code class="codeph">CLONEDB</code>初始化参数的设置：</p>
                        <ul id="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF__UL_G4J_VWZ_YFB" style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">CLONEDB = TRUE</code></p>
                              <p>您可以拍摄处于读/写模式或只读模式的PDB的快照。PDB的第一个快照包含原始PDB文件的完整副本，但同一PDB的后续快照包含稀疏文件。</p>
                           </li>
                           <li>
                              <p><code class="codeph">CLONEDB = FALSE</code></p>
                              <p>您只能拍摄只读PDB的快照。每个快照都是源PDB文件的完整副本。在这种情况下，如果基于PDB快照创建克隆PDB，则源PDB必须在克隆PDB的生命周期内保持只读。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF__GUID-49436BE1-1278-4609-9F9F-E1F41F98F546">MAX_PDB_SNAPSHOTS数据库属性</p>
                        <p>要设置PDB的最大快照数，请在<code class="codeph">ALTER PLUGGABLE DATABASE</code>或<code class="codeph">CREATE PLUGGABLE DATABASE</code>指定<code class="codeph">MAX_PDB_SNAPSHOTS</code>属性。属性的默认值为<code class="codeph">8</code> ，这也是最大值。如果已创建允许的最大快照数，则数据库将清除最早的快照。所述<code class="codeph">CDB_PROPERTIES</code>视图显示的设定<code class="codeph">MAX_PDB_SNAPSHOTS</code> 。</p>
                        <div class="infoboxnotealso" id="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF__GUID-C86393BE-C66F-4369-8298-009A3AB3DBD1">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../sqlrf/ALTER-PLUGGABLE-DATABASE.html#SQLRF-GUID-A29491AD-8F0F-4E52-9D94-57FC3FF8FBC7" target="_blank"><span><cite>Oracle数据库SQL语言参考</cite></span></a> ，了解<code class="codeph">ALTER PLUGGABLE DATABASE</code>语句的语法</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF__GUID-AF193A24-4D17-4460-8956-D3FB1F5DA922">快照相关数据字典视图</p>
                        <p>以下数据字典视图提供快照信息：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">DBA_PDB_SNAPSHOTS</code>视图记录有关PDB快照的元数据，包括快照名称，创建SCN，创建时间和文件名。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">DBA_PDB_SNAPSHOTFILE</code>视图列出PDB快照中文件的名称和类型。仅在快照稀疏时才填充此视图。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">DBA_PDBS</code>视图具有<code class="codeph">SNAPSHOT_MODE</code>和<code class="codeph">SNAPSHOT_INTERVAL</code>列。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF__GUID-5E1BCA5F-FE85-4447-BC43-98309C2E4308">
                        <p class="notep1">也可以看看：</p>
                        <p><span><cite>Oracle数据库参考</cite></span> ，了解<a href="../refrn/DBA_PDB_SNAPSHOTS.html#GUID-B1389923-0F82-476F-BBEE-39364F10A988" target="_blank"><code class="codeph">DBA_PDB_SNAPSHOTS</code></a> ， <a href="../refrn/DBA_PDB_SNAPSHOTFILE.html#GUID-990A75BF-090C-4298-AA9A-27F7BF8C35C3" target="_blank"><code class="codeph">DBA_PDB_SNAPSHOTFILE</code></a>和<a href="../refrn/DBA_PDBS.html#GUID-439126EA-A6B6-45B8-AAFA-37EE4356BBEF" target="_blank"><code class="codeph">DBA_PDBS</code></a></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="administering-pdb-snapshots.html#GUID-72CA6DD5-4DE5-4375-BEA6-A01E5E31A01B" title="PDB快照轮播是PDB快照库。">关于PDB Snapshot Carousel</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="sect2"><a id="GUID-B6A785B6-42F2-4027-9DA5-6FA1164CCC5C" name="GUID-B6A785B6-42F2-4027-9DA5-6FA1164CCC5C"></a><h3 id="MULTI-GUID-B6A785B6-42F2-4027-9DA5-6FA1164CCC5C" class="sect3"><span class="enumeration_section">16.2</span>设置<span>PDB快照轮播中</span>的最大快照数</h3>
               <div>
                  <p>您可以为PDB设置最大PDB快照数。</p>
                  <div class="section">
                     <p><code class="codeph">MAX_PDB_SNAPSHOTS</code>数据库属性设置<span>PDB快照轮播中</span>每个PDB的最大快照数。默认最大值为<code class="codeph">8</code> 。您不能将该属性设置为大于<code class="codeph">8</code>的数字。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-B6A785B6-42F2-4027-9DA5-6FA1164CCC5C__GUID-F1ED63D6-900C-45CD-95C4-8EF6FF72DFAE">先决条件</p>
                     <p>PDB必须以读/写模式打开。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-B6A785B6-42F2-4027-9DA5-6FA1164CCC5C__GUID-843BFDED-C629-46ED-BAE2-04C7693E90F8">要为PDB设置最大PDB快照数：</p>
                     <ol>
                        <li>
                           <p>在SQL * Plus中，确保当前容器是要为其设置限制的PDB。</p>
                        </li>
                        <li>
                           <p>（可选）查询<code class="codeph">CDB_PROPERTIES</code>以获取<code class="codeph">SET MAX_PDB_SNAPSHOTS</code>属性的当前设置。
                           </p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">SET MAX_PDB_SNAPSHOTS</code>子句运行<code class="codeph">ALTER PLUGGABLE DATABASE</code>或<code class="codeph">ALTER DATABASE</code>语句。
                           </p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-B6A785B6-42F2-4027-9DA5-6FA1164CCC5C__GUID-509A37D6-9BB3-469B-BB3A-B5D32C8C2AE1">
                     <p class="titleinexample">例16-1设置PDB的最大PDB快照数</p>
                     <p>以下查询显示<code class="codeph">cdb1_pdb1</code>的轮播中的<code class="codeph">cdb1_pdb1</code> （包括示例输出）：</p><pre class="pre codeblock"><code>SET LINESIZE 150 COL CON_ID FORMAT 99999 COL PROPERTY_NAME FORMAT a17 COL PDB_NAME FORMAT a9 COL VALUE FORMAT a3 COL DESCRIPTION FORMAT a43 SELECT r。CON_ID，p。PDB_NAME，PROPERTY_NAME，PROPERTY_VALUE AS值，描述来自CDB_PROPERTIES r，CDB_PDBS p WHERE r。CON_ID = p。CON_ID AND PROPERTY_NAME LIKE'MAX_PDB％'由PROPERTY_NAME订购; CON_ID PDB_NAME PROPERTY_NAME VAL DESCRIPTION ------ --------- ----------------- --- ---------- --------------------------------- 3 CDB1_PDB1 MAX_PDB_SNAPSHOTS 8给定PDB的最大快照数</code></pre><p>以下SQL语句将当前PDB的最大PDB快照数设置为7：</p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE SET MAX_PDB_SNAPSHOTS = 7;</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-B6A785B6-42F2-4027-9DA5-6FA1164CCC5C__GUID-CB8DC44C-F1FD-4463-AF82-D635818D9AAC">
                     <p class="titleinexample">示例16-2删除<span>PDB快照轮播中的</span>所有快照</p>
                     <p>要删除<span>PDB快照轮播</span>中的所有快照，请将<code class="codeph">MAX_PDB_SNAPSHOTS</code>数据库属性设置为<code class="codeph">0</code> （零），如以下语句所示：</p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE SET MAX_PDB_SNAPSHOTS = 0;</code></pre><p>这种技术比执行<code class="codeph">ALTER PLUGGABLE DATABASE ...快<code class="codeph">ALTER PLUGGABLE DATABASE ...DROP SNAPSHOT <span class="codeinlineitalic">snapshot_name</span></code>每一个快照。
                     </p>
                  </div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-B6A785B6-42F2-4027-9DA5-6FA1164CCC5C__GUID-4C70D67B-4ECE-4CD1-91A3-4C84986CC119">
                     <p class="notep1">也可以看看：</p>
                     <p><span class="q">“ <a href="administering-a-cdb-with-sql-plus.html#GUID-D75CAF12-1073-40DB-B096-51B63E4C01E3" title="您可以使用SQL * Plus访问CDB中的根或PDB。">关于CDB中的容器访问</a> ”</span></p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="administering-pdb-snapshots.html#GUID-FF6DF540-0C22-451C-80B3-1ACA8C8CB7D2" title="您可以为指定的PDB配置PDB快照轮播，手动或自动创建快照，以及设置最大快照数。">管理PDB快照轮播</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5" name="GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5"></a><h3 id="MULTI-GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5" class="sect3"><span class="enumeration_section">16.3</span>配置自动PDB快照</h3>
               <div>
                  <p>在创建或更改PDB时，使用<code class="codeph">SNAPSHOT MODE EVERY</code>子句为自动快照配置PDB。</p>
                  <div class="section">默认情况下，PDB配置为手动快照。</div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5__GUID-EE62ACB9-8F13-41B1-BB75-4335F42BE8DC">先决条件</p>
                     <p>请注意<code class="codeph">ALTER PLUGGABLE DATABASE SNAPSHOT</code>语句的以下先决条件：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>CDB必须处于本地撤消模式。</p>
                        </li>
                        <li>
                           <p>管理员必须具有创建PDB和删除PDB的权限。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5__GUID-895929A2-9D3A-4A6E-AB24-6B894FDE5EF2">在更改PDB时配置自动快照：</p>
                     <ol>
                        <li>
                           <p>在SQL * Plus中，以管理员身份登录到要配置其快照模式的PDB。</p>
                        </li>
                        <li>
                           <p>（可选）查询<code class="codeph">DBA_PDBS</code>以确定当前快照模式。
                           </p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">SNAPSHOT MODE EVERY <span class="codeinlineitalic">interval</span></code>子句运行<code class="codeph">ALTER PLUGGABLE DATABASE</code> ，指定<code class="codeph">MINUTES</code>或<code class="codeph">HOURS</code> 。</p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5__TOCONFIGUREAUTOMATICSNAPSHOTSWHENAL-37ABCC8A">在创建PDB时配置自动快照：</p>
                     <ol>
                        <li>
                           <p>在SQL * Plus中，以管理员身份登录CDB根目录或应用程序根目录。</p>
                        </li>
                        <li>
                           <p>（可选）查询<code class="codeph">DBA_PDBS</code>以确定当前快照模式。
                           </p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">SNAPSHOT MODE EVERY <span class="codeinlineitalic">interval</span></code>子句运行<code class="codeph">CREATE PLUGGABLE DATABASE</code> ，指定<code class="codeph">MINUTES</code>或<code class="codeph">HOURS</code> 。</p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5__GUID-C7045DF2-C315-4D15-B0C2-27CCBFB535E0">
                     <p class="titleinexample">示例16-3为现有PDB每天配置自动快照</p>
                     <p>此示例假定您已登录到要更改其快照模式的PDB。查询数据字典以确认PDB当前处于<code class="codeph">MANUAL</code>模式（包括样本输出）：</p><pre class="pre codeblock"><code>SELECT SNAPSHOT_MODE“S_MODE”，SNAPSHOT_INTERVAL / 60“SNAP_INT_HRS”来自DBA_PDBS; S_MODE SNAP_INT_HRS ------ ------------ MANUAL</code></pre><p>将快照模式更改为每24小时：</p><pre class="pre codeblock"><code>更改可插入的数据库快照模式每24小时;</code></pre><p>确认更改为自动模式：</p><pre class="pre codeblock"><code>SELECT SNAPSHOT_MODE“S_MODE”，SNAPSHOT_INTERVAL / 60“SNAP_INT_HRS”来自DBA_PDBS; S_MODE SNAP_INT_HRS ------ ------------ AUTO 24</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5__GUID-B7A04ED2-4C4D-4A1A-AD37-2F50EF7BE27E">
                     <p class="titleinexample">示例16-4创建每两个小时拍摄一次快照的PDB</p>
                     <p>此示例假定您已登录CDB根目录。以下语句从名为<code class="codeph">cdb1_pdb1</code>的现有PDB创建<code class="codeph">cdb1_pdb3</code> ，并将其配置为每2小时自动拍摄一次快照：</p><pre class="pre codeblock"><code>CREATE PLUGGABLE DATABASE cdb1_pdb3 FROM cdb1_pdb1 FILE_NAME_CONVERT =（'cdb1_pdb1'，'cdb1_pdb3'）SNAPSHOT MODE每120分钟;</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5__GUID-31595C90-5E04-4133-85D4-9078A802CC51">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="q">“ <a href="cloning-a-pdb.html#GUID-539A1F68-27B9-4802-95AC-2C721347296C" title="此方案通过执行CREATE PLUGGABLE DATABASE从PDB快照创建新的PDB ...使用快照。">从PDB快照克隆PDB：场景</a> ”</span></p>
                        </li>
                        <li>
                           <p><span class="q">“ <a href="administering-a-cdb-with-sql-plus.html#GUID-1AAB032F-D13A-4E06-A062-59E0487C2FC5" title="您可以通过发出ALTER DATABASE LOCAL UNDO ON语句并重新启动数据库将CDB更改为本地撤消模式。">配置CDB以使用本地撤消模式</a> ”</span></p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="administering-pdb-snapshots.html#GUID-FF6DF540-0C22-451C-80B3-1ACA8C8CB7D2" title="您可以为指定的PDB配置PDB快照轮播，手动或自动创建快照，以及设置最大快照数。">管理PDB快照轮播</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-FBF77C07-9B40-4BF3-8C7D-61C8F11E2B14" name="GUID-FBF77C07-9B40-4BF3-8C7D-61C8F11E2B14"></a><h3 id="MULTI-GUID-FBF77C07-9B40-4BF3-8C7D-61C8F11E2B14" class="sect3"><span class="enumeration_section">16.4</span>手动创建PDB快照</h3>
               <div>
                  <p>要手动创建PDB快照，请在<code class="codeph">ALTER PLUGGABLE DATABASE</code>或<code class="codeph">CREATE PLUGGABLE DATABASE</code>指定<code class="codeph">SNAPSHOT <span class="codeinlineitalic">snapshot_name</span></code>子句。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-FBF77C07-9B40-4BF3-8C7D-61C8F11E2B14__GUID-BBEB4503-6406-433D-A4E1-91846C9C167C">先决条件</p>
                     <p>请注意<code class="codeph">ALTER PLUGGABLE DATABASE SNAPSHOT</code>语句的以下先决条件：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>CDB必须处于本地撤消模式。您可以使用以下查询检查模式，该查询在启用本地撤消时返回<code class="codeph">TRUE</code> ：</p><pre class="pre codeblock"><code>SELECT * FROM DATABASE_PROPERTIES，其中PROPERTY_NAME ='LOCAL_UNDO_ENABLED';</code></pre></li>
                        <li>
                           <p>DBA必须具有创建和删除PDB的权限。</p>
                        </li>
                        <li>
                           <p>如果源PDB处于读/写模式，则必须将<code class="codeph">CLONEDB</code>设置为<code class="codeph">TRUE</code> ，在这种情况下，除第一个快照之外的所有快照都是稀疏的。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-FBF77C07-9B40-4BF3-8C7D-61C8F11E2B14__GUID-8BC45F3E-85D2-4E0E-B46A-DA6049388906">要创建PDB快照：</p>
                     <ol>
                        <li>
                           <p>在SQL * Plus中，以管理员身份登录到要创建其快照的PDB。</p>
                        </li>
                        <li>
                           <p>（可选）查询<code class="codeph">DBA_PDBS.SNAPSHOT_MODE</code>以确认快照模式未设置为<code class="codeph">NONE</code> 。</p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">SNAPSHOT</code>子句运行<code class="codeph">ALTER PLUGGABLE DATABASE</code>语句。
                           </p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-FBF77C07-9B40-4BF3-8C7D-61C8F11E2B14__GUID-509A37D6-9BB3-469B-BB3A-B5D32C8C2AE1">
                     <p class="titleinexample">示例16-5使用用户指定的名称创建PDB快照</p>
                     <p>以下SQL语句创建<code class="codeph">cdb1_pdb1</code>两个PDB快照，一个在星期三数据加载之前，一个在星期三数据加载之后：</p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE SNAPSHOT cdb1_pdb1_b4WLOAD; - 数据加载ALTER PLUGGABLE DATABASE SNAPSHOT cdb1_pdb1_afWLOAD;</code></pre><p>以下<code class="codeph">DBA_PDB_SNAPSHOTS</code>查询显示了名为<code class="codeph">cdb1_pdb1</code>的PDB的两个快照的位置（包括样本输出）：</p><pre class="pre codeblock"><code>SET LINESIZE 150 COL CON_NAME FORMAT a9 COL SNAPSHOT_NAME FORMAT a20 COL SNAP_SCN FORMAT 9999999 COL FULL_SNAPSHOT_PATH FORMAT a45 SELECT CON_ID，CON_NAME，SNAPSHOT_NAME，SNAPSHOT_SCN AS snap_scn，FULL_SNAPSHOT_PATH FROM DBA_PDB_SNAPSHOTS ORDER BY SNAP_SCN; CON_ID CON_NAME SNAPSHOT_NAME SNAP_SCN FULL_SNAPSHOT_PATH ------- --------- -------------------- ---------- ----------------------------------------- 3 CDB1_PDB1 CDB1_PDB1_B4WLOAD 2962078 / d1 / oracle / dbs / snap_3489077498_2962078.pdb 3 CDB1_PDB1 CDB1_PDB1_AFWLOAD 2962938 /d1/oracle/dbs/snap_3489077498_2962938.pdb</code></pre><p>如果未指定PDB快照名称，则数据库将生成唯一名称。请注意，前面示例中的快照路径是<code class="codeph">.pdb</code>存档，这意味着快照是完整的而不是稀疏的。
                     </p>
                  </div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-FBF77C07-9B40-4BF3-8C7D-61C8F11E2B14__GUID-0DE08F77-0073-4F63-84D9-1E3C79AAADBF">
                     <p class="titleinexample">示例16-6使用系统指定的名称创建PDB快照</p>
                     <p>以下SQL语句创建快照，但未指定名称：</p><pre class="pre codeblock"><code>ALTER PLOGGABLE DATABASE SNAPSHOT;</code></pre><p>以下示例查询显示数据库为快照分配了一个名为<code class="codeph">SNAP_</code>的名称：</p><pre class="pre codeblock"><code>SET LINESIZE 150 COL CON_NAME FORMAT a9 COL SNAPSHOT_NAME FORMAT a25 COL SNAP_SCN FORMAT 9999999 COL FULL_SNAPSHOT_PATH FORMAT a45 SELECT CON_ID，CON_NAME，SNAPSHOT_NAME，SNAPSHOT_SCN AS snap_scn，FULL_SNAPSHOT_PATH FROM DBA_PDB_SNAPSHOTS ORDER BY SNAP_SCN; CON_ID CON_NAME SNAPSHOT_NAME SNAP_SCN FULL_SNAPSHOT_PATH ------- --------- ------------------------- ---- ---- ------------------------------------------ 3 CDB1_PDB1 CDB1_PDB1_B4WLOAD 2962078 /d1/oracle/dbs/snap_3489077498_2962078.pdb 3 CDB1_PDB1 CDB1_PDB1_AFWLOAD 2962938 /d1/oracle/dbs/snap_3489077498_2962938.pdb 3 CDB1_PDB1 SNAP_3489077498_960130367 2993525 /d1/oracle/dbs/snap_3489077498_2993525.pdb</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-FBF77C07-9B40-4BF3-8C7D-61C8F11E2B14__GUID-75F8BAB3-9623-4C97-A916-116F9F9F20D7">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="q">“ <a href="administering-a-cdb-with-sql-plus.html#GUID-D75CAF12-1073-40DB-B096-51B63E4C01E3" title="您可以使用SQL * Plus访问CDB中的根或PDB。">关于CDB中的容器访问</a> ”</span></p>
                        </li>
                        <li>
                           <p><span class="q">“ <a href="administering-a-cdb-with-sql-plus.html#GUID-1AAB032F-D13A-4E06-A062-59E0487C2FC5" title="您可以通过发出ALTER DATABASE LOCAL UNDO ON语句并重新启动数据库将CDB更改为本地撤消模式。">配置CDB以使用本地撤消模式</a> ”</span></p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="administering-pdb-snapshots.html#GUID-FF6DF540-0C22-451C-80B3-1ACA8C8CB7D2" title="您可以为指定的PDB配置PDB快照轮播，手动或自动创建快照，以及设置最大快照数。">管理PDB快照轮播</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-9E7D3176-9504-429D-895F-A3D60028FE5A" name="GUID-9E7D3176-9504-429D-895F-A3D60028FE5A"></a><h3 id="MULTI-GUID-9E7D3176-9504-429D-895F-A3D60028FE5A" class="sect3"><span class="enumeration_section">16.5</span>删除PDB快照</h3>
               <div>
                  <p>您可以通过使用<code class="codeph">DROP SNAPSHOT</code>子句运行<code class="codeph">ALTER PLUGGABLE DATABASE</code>语句来删除PDB快照。
                  </p>
                  <div class="section">
                     <p>要基于PDB删除所有PDB快照，请将PDB中的<code class="codeph">MAX_PDB_SNAPSHOTS</code>属性设置为<code class="codeph">0</code> （零）。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-9E7D3176-9504-429D-895F-A3D60028FE5A__GUID-C8D468D5-FC95-44E2-A11D-FD07967AAF50">要删除PDB快照：</p>
                     <ol>
                        <li>
                           <p>在SQL * Plus中，确保当前容器是您从中创建PDB快照的PDB。</p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">DROP SNAPSHOT</code>子句运行<code class="codeph">ALTER PLUGGABLE DATABASE</code>语句。
                           </p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-9E7D3176-9504-429D-895F-A3D60028FE5A__GUID-509A37D6-9BB3-469B-BB3A-B5D32C8C2AE1">
                     <p class="titleinexample">示例16-7删除PDB快照</p>
                     <p>以下SQL语句删除名为<code class="codeph">sales_snap</code>的PDB快照：</p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE DROP SNAPSHOT sales_snap;</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-9E7D3176-9504-429D-895F-A3D60028FE5A__GUID-1A26FD38-5B50-4249-8861-7135E4F1AFA7">
                     <p class="notep1">也可以看看：</p>
                     <p><span class="q">“ <a href="administering-a-cdb-with-sql-plus.html#GUID-D75CAF12-1073-40DB-B096-51B63E4C01E3" title="您可以使用SQL * Plus访问CDB中的根或PDB。">关于CDB中的容器访问</a> ”</span></p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="administering-pdb-snapshots.html#GUID-FF6DF540-0C22-451C-80B3-1ACA8C8CB7D2" title="您可以为指定的PDB配置PDB快照轮播，手动或自动创建快照，以及设置最大快照数。">管理PDB快照轮播</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-87CB7869-5A15-456F-90B8-361A0D06D8AF" name="GUID-87CB7869-5A15-456F-90B8-361A0D06D8AF"></a><h3 id="MULTI-GUID-87CB7869-5A15-456F-90B8-361A0D06D8AF" class="sect3"><span class="enumeration_section">16.6</span>查看PDB快照的元数据</h3>
               <div>
                  <p>数据字典视图<code class="codeph">DBA_PDB_SNAPSHOTS</code>和<code class="codeph">DBA_PDB_SNAPSHOTFILE</code>显示PDB快照的元数据。
                  </p>
                  <div class="section">
                     <p><code class="codeph">DBA_PDB_SNAPSHOTS</code>包含有关快照的常规信息，包括名称，SCN，时间和路径。<code class="codeph">DBA_PDB_SNAPSHOTFILE</code>显示快照中每个文件的路径和文件类型：数据文件，归档重做日志文件和XML文件。
                     </p>
                     <div class="infoboxnote" id="GUID-87CB7869-5A15-456F-90B8-361A0D06D8AF__GUID-62B7B4D9-5B06-419E-B2FD-7A61DFC68F4F">
                        <p class="notep1">注意：</p>
                        <p><code class="codeph">DBA_PDB_SNAPSHOTFILE</code>仅显示稀疏克隆PDB。要创建稀疏克隆，必须将<code class="codeph">CLONEDB</code>初始化参数设置为<code class="codeph">TRUE</code> 。</p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-87CB7869-5A15-456F-90B8-361A0D06D8AF__GUID-FBC91654-7FE7-49E3-8E11-6EFBC62929C5">要查看PDB快照的元数据：</p>
                     <ol>
                        <li>
                           <p>在SQL * Plus中，以管理用户身份登录数据库。</p>
                        </li>
                        <li>
                           <p>查询<code class="codeph">DBA_PDB_SNAPSHOTS</code> 。</p>
                           <p>例如，运行以下查询（包括示例输出）：</p>一世<pre class="pre codeblock"><code>COL SNAPSHOT_NAME格式a30选择SNAPSHOT_NAME，SNAPSHOT_SCN，SNAPSHOT_TIME来自DBA_PDB_SNAPSHOTS; SNAPSHOT_NAME SNAPSHOT_SCN SNAPSHOT_TIME ------------------------------ ------------ ----- -------- HRPDB_SNAP_F 3678939 1536262569 HRPDB_SNAP_S 4954803 986473745</code></pre></li>
                        <li>
                           <p>查询<code class="codeph">DBA_PDB_SNAPSHOTFILE</code> 。</p>
                           <p>例如，运行以下连接查询（包括示例输出）：</p><pre class="pre codeblock"><code>SET LINESIZE 120 COL SNAPSHOT_NAME格式a12 COL SNAPSHOT_FILENAME格式a63选择SNAPSHOT_NAME，SNAPSHOT_FILENAME，SNAPSHOT_FILETYPE，类型为DBA_PDB_SNAPSHOTS，DBA_PDB_SNAPSHOTFILE f WHERE s。SNAPSHOT_SCN = F。SNAPSHOT_SCN; SNAPSHOT_NAM SNAPSHOT_FILENAME TYPE ------------ ----------------------------------- -------------------------- ---- HRPDB_SNAP_S /d1/snapshots/4954803/o1_mf_undo_1_fry1l5bq_.dbf DATA HRPDB_SNAP_S / d1 / snapshots / 4954803 / o1_mf_salestbs_fry19m6h_.dbf DATA HRPDB_SNAP_S /d1/snapshots/4954803/o1_mf_sysext_fry19d1n_.dbf DATA HRPDB_SNAP_S /d1/snapshots/4954803/o1_mf_sysaux_fry19d1m_.dbf DATA HRPDB_SNAP_S /d1/snapshots/4954803/o1_mf_system_fry19d1k_.dbf DATA HRPDB_SNAP_S / D1 /快照/ 4954803 / HRPDB。 xml XML HRPDB_SNAP_S /d1/snapshots/4954803/archparlog_1_274_b87ca51e_985963814.arc ARCH</code></pre></li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-87CB7869-5A15-456F-90B8-361A0D06D8AF__GUID-74C40090-ECE4-4229-90C6-47E8CB29B10D">
                     <p class="titleinexample">示例16-8查询完整PDB快照的元数据</p>
                     <p>以下查询显示了两个PDB快照。快照已满，而不是稀疏，如<code class="codeph">.pdb</code>扩展名所示。
                     </p><pre class="pre codeblock"><code>SET LINESIZE 200 SET PAGESIZE 50000 COL CON_ID FORMAT 999999 COL CON_NAME FORMAT a8 COL SNAPSHOT_NAME FORMAT a25 COL FULL_SNAPSHOT_PATH FORMAT a65 CON_ID CON_NAME SNAPSHOT_NAME SNAPSHOT_SCN FULL_SNAPSHOT_PATH ------- -------- -------- ----------------- ------------ --------------------- ---------- 5 HRPDB SNAP_3286480866_994766895 3160319 /d1/snap_3286480866_3160319.pdb 5 HRPDB SNAP_3286480866_994767095 3165758 /d1/snap_3286480866_3165758.pdb</code></pre><p>以下<code class="codeph">DBA_PDB_SNAPSHOTFILE</code>查询<code class="codeph">DBA_PDB_SNAPSHOTFILE</code>返回任何行，因为仅在PDB快照稀疏时才填充此视图：</p><pre class="pre codeblock"><code>SQL&gt; SELECT COUNT（*）FROM DBA_PDB_SNAPSHOTFILE; COUNT（*）---------- 0</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="administering-pdb-snapshots.html#GUID-FF6DF540-0C22-451C-80B3-1ACA8C8CB7D2" title="您可以为指定的PDB配置PDB快照轮播，手动或自动创建快照，以及设置最大快照数。">管理PDB快照轮播</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>