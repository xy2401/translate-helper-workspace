<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>恢复表和表分区</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96241-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="performing-rman-tspitr.html" title="Previous" type="text/html"></link>
      <link rel="next" href="part-rman-tuning-troubleshooting.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="BRADV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="performing-rman-tspitr.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="part-rman-tuning-troubleshooting.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复用户指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-diagnosing-responding-failures.html" property="item" typeof="WebPage"><span property="name">诊断和应对失败</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">恢复表和表分区</li>
            </ol>
            <a id="GUID-87B7F772-335F-4179-81C9-91678D026D01" name="GUID-87B7F772-335F-4179-81C9-91678D026D01"></a><a id="BRADV686"></a>
            
            <h2 id="BRADV-GUID-87B7F772-335F-4179-81C9-91678D026D01" class="sect2"><span class="enumeration_chapter">22</span>恢复表和表分区</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍如何将表和表分区恢复到指定的时间点。本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="rman-recovering-tables-partitions.html#GUID-FBD1224C-822F-45E7-898D-1DEC3C6FD7A1" title="RMAN RECOVER命令使您可以从RMAN备份恢复表和表分区。">从RMAN备份恢复表和表分区的概述</a></p>
                  </li>
                  <li>
                     <p><a href="rman-recovering-tables-partitions.html#GUID-27F62B73-7341-4939-9677-5F6D614DE55A" title="在准备恢复表或表分区之前，必须执行一些初步任务。">准备恢复表和表分区</a></p>
                  </li>
                  <li>
                     <p><a href="rman-recovering-tables-partitions.html#GUID-04D1B794-25D0-4C1E-9A98-F08AD361B41E" title="使用RESTORE和RECOVER命令恢复表或表分区。">恢复表和表分区</a></p>
                  </li>
                  <li>
                     <p><a href="rman-recovering-tables-partitions.html#GUID-B8245791-9B75-4AE7-ACE9-D9EDBC2DACC0" title="RMAN使您可以使用RECOVER命令将可插拔数据库（PDB）中的一个或多个表或表分区恢复到指定的时间点，而不会影响PDB中的其他对象。">在PDB中恢复表和表分区</a></p>
                  </li>
                  <li>
                     <p><a href="rman-recovering-tables-partitions.html#GUID-DEE9C16C-C30A-46C6-A0CE-2DE060A8EC10" title="本节包含的示例涵盖了恢复表和表分区的多种方案。">示例：从RMAN备份恢复表和表分区</a></p>
                  </li>
               </ul>
            </div><a id="BRADV687"></a><div class="props_rev_3"><a id="GUID-FBD1224C-822F-45E7-898D-1DEC3C6FD7A1" name="GUID-FBD1224C-822F-45E7-898D-1DEC3C6FD7A1"></a><h3 id="BRADV-GUID-FBD1224C-822F-45E7-898D-1DEC3C6FD7A1" class="sect3"><span class="enumeration_section">22.1</span>恢复表和表分区概述</h3>
               <div>
                  <p>RMAN <code class="codeph">RECOVER</code>命令使您可以从RMAN备份恢复表和表分区。
                  </p>
                  <div class="infoboxnote" id="GUID-FBD1224C-822F-45E7-898D-1DEC3C6FD7A1__GUID-62C0D687-8B62-4227-B13C-D7EB544A2E62">
                     <p class="notep1">注意：</p>
                     <p>还有其他方法可以将表恢复到指定的时间点，例如Oracle Flashback和TSPITR。有关这些方法有用的方案以及如何使用这些方法恢复表的更多信息，请参阅：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="rman-performing-flashback-dbpitr.html#GUID-5463669A-DC89-4FF4-ACCE-136A72DF687B" title="此概述描述了Oracle闪回技术和数据库时间点恢复的目的和基本概念。某些情况适合使用时间点恢复或闪回功能，以便在之前的某个时间点将数据库或数据库对象返回到其状态。数据库时间点恢复（DBPITR）和闪回功能使您可以将数据库恢复到先前的某个时间点。DBPITR在物理级别工作，以在过去的目标时间将数据文件返回到其状态。RMAN为一个或多个PDB的时间点恢复提供支持。要恢复PDB，必须以具有SYSDBA或SYSBACKUP权限的用户身份连接到root。恢复后，PDB的旧备份仍然有效，并且可以在发生介质故障时使用。在大多数可用的情况下，Oracle数据库的闪回功能比介质恢复更有效。您可以使用它们来调查数据库的过去状态。Oracle闪回数据库是DBPITR最有效的替代方法。逻辑闪回功能用于将表及其内容恢复到过去的时间。您可以对整个多租户容器数据库（CDB）或特定可插拔数据库（PDB）执行闪回数据库操作。多租户容器数据库（CDB）可以使用共享撤消或本地撤消。RMAN用于执行闪回数据库操作的技术取决于CDB的撤消配置类型.RMAN提供了管理PDB中数据块的重做损坏的方法。闪回表使用撤消表空间中的信息而不是恢复的备份来检索表。发生闪回表操作时，将删除新行并重新插入旧行。在执行表的闪回时，数据库的其余部分仍然可用。要执行闪回表操作，该表必须符合闪回的条件，执行操作的用户必须具有所需的权限。要在一个或多个表上使用闪回表功能，请使用带有目标时间或SCN的FLASHBACK TABLE SQL语句。默认情况下，数据库在执行FLASHBACK TABLE操作之前禁用受影响表上的触发器。在操作之后，数据库将触发器返回到操作之前的状态（启用或禁用）。您可以使用FLASHBACK TABLE从回收站中检索对象...在DROP声明之前。Flashback Drop可以反转DROP TABLE操作的效果。闪回丢弃比在这种情况下可以使用的其他恢复机制（如时间点恢复）更快，并且不会导致停机或丢失最近的事务。在执行闪回删除操作之前，必须满足先决条件。使用FLASHBACK TABLE ...在DROP语句之前要从回收站中恢复对象。您可以指定回收站中表的名称或原始表名。您可以使用相同的原始名称创建，然后删除多个对象。所有丢弃的对象都存储在回收站中。闪回数据库通过将数据库返回到先前某个时间点的状态来反转不需要的更改。闪回数据库通过撤消对运行命令时存在的数据文件的更改来工作。必须满足先决条件才能执行闪回数据库操作。闪回数据库操作使用FLASHBACK DATABASE命令将数据库回滚到过去的某个时间点。您可以使用FLASHBACK DATABASE命令为整个多租户容器数据库（CDB）执行闪回数据库操作。您可以使用FLASHBACK DATABASE命令对多租户容器数据库（CDB）中的单个可插拔数据库（PDB）执行闪回数据库操作。数据字典视图包含用于监视闪回数据库的信息。RMAN DBPITR在目标恢复时间之前从备份还原数据库，然后使用增量备份和重做将数据库前滚到目标时间。您可以恢复到SCN，时间，日志序列号或还原点。Oracle建议您在重要时间创建还原点，以便在必要时使时间点恢复更易于管理。必须满足某些先决条件才能执行数据库时间点恢复（DBPITR）。使用RESTORE和RECOVER命令执行DBPITR。使用RECOVER命令执行容器数据库（CDB）和可插拔数据库（PDB）的时间点恢复（PITR）。PDB的PITR只能使用RMAN执行。使用RESTORE和RECOVER命令为整个CDB执行时间点恢复。当您将一个或多个PDB恢复到指定的时间点时，剩余的PDB将在国家开发银行不受影响，可以开放和运作。使用RESTORE和RECOVER命令执行应用程序PDB的时间点恢复。执行稀疏数据库的时间点恢复类似于执行正常数据库的时间点恢复。本节介绍基本闪回数据库和DBPITR方案的变体。闪回数据库可用于撤消OPEN RESETLOGS操作。跨OPEN RESETLOGS的闪回数据库可用于在Data Guard环境中执行多个功能。您可以使用闪回数据库将数据库回滚到废弃的数据库化身。要将DPITR执行到非当前数据库化身，必须显式执行RESET DATABASE以将数据库重置为目标SCN上当前的化身。您还必须从包含目标SCN的数据库化身中还原控制文件。">执行闪回和数据库时间点恢复</a></p>
                        </li>
                        <li>
                           <p><a href="performing-rman-tspitr.html#GUID-CAACDB53-7C3A-45B4-8249-C5D855D47571" title="要有效地使用RMAN表空间时间点恢复（TSPITR），了解它可以解决的问题类型，组件，RMAN在TSPITR期间所执行的操作以及对何时以及如何进行的各种限制和限制很有帮助。跑。本节介绍运行RMAN的基本概念，准备任务和运行模式TSPITR。恢复管理器（RMAN）TSPITR可以将数据库中的一个或多个表空间快速恢复到较早的时间，而不会影响数据库中的其余表空间和对象。了解RMAN TSPITR的概念，例如使用的术语和模式。本节定义了RMAN TSPITR使用的一些常见实体。有几种运行RMAN TSPITR的模式。各种操作模式之间的差异对应于您的环境中需要多少自动化与自定义。在执行完全自动化的RMAN TSPITR（默认）之前，从恢复集，辅助目标和目标时间中选择表空间。由于某些限制和限制，TSPITR无法解决某些数据库问题。在执行TSPITR时需要考虑一些限制。在TSPITR期间不使用恢复目录时要注意某些预防措施。准备执行TSPITR时必须完成某些步骤。为您选择正确的目标时间或SCN非常重要。 TSPITR。请注意，在TSPITR之后将表空间联机后，您不能在使表空间联机的时间之前使用任何备份。最初，恢复集包括要恢复的表空间的数据文件。但是，如果表空间中的对象需要与其他表空间中的对象建立关系（例如约束），则必须先考虑这些关系才能执行TSPITRRMAN TSPITR要求正在恢复的表空间是自包含的，并且没有SYS拥有的对象驻留在表空间中。在表空间上执行RMAN TSPITR时，在目标恢复时间之后创建的对象将丢失。您可以通过在TSPITR之前使用数据泵导出实用程序导出这些对象并在之后使用数据泵导入重新导入这些对象来保留这些对象。在默认模式下，RMAN在目标数据库上尽可能多地使用TSPITR的配置。您可以自定义RMAN TSPITR的某些方面，同时仍然主要执行完全自动化的RMAN TSPITR的过程。您可能不希望恢复集数据文件在其原始位置恢复和恢复。SET NEWNAME命令可用于指定新目标。为恢复集指定新目标时，RMAN不会删除表空间的原始数据文件。与通常存储在其原始位置的恢复集数据文件不同，辅助集数据文件不得覆盖目标数据库中的相应原始文件。如果未指定与其原始位置不同的辅助集文件位置，则TSPITR将失败。当RMAN尝试覆盖原始数据库中的相应文件并发现正在使用的文件时，会发生故障。辅助集数据文件可以在目标中具有Oracle管理文件（OMF），并且可以使用自动存储管理（ASM）或非ASM存储。当设置了DB_FILE_NAME_CONVERT初始化参数且OMF文件位于ASM或非ASM存储中时，TSPITR以不同方式执行名称转换。您可以使用辅助数据库的DB_FILE_NAME_CONVERT和LOG_FILE_NAME_CONVERT初始化参数来指定磁盘组的转换。RMAN使用该模式转换ASM磁盘组名称，并在转换后的磁盘组中生成有效的OMF文件名。有多种方法可用于重命名辅助数据库的OMF（非ASM）文件名。要为辅助集数据文件指定新名称，可以将RECOVER TABLESPACE包含在RUN命令中，并使用RUN块中的SET NEWNAME命令重命名该文件。如果您不想为所有辅助集数据文件使用辅助目标，但又不想单独命名每个文件，则可以在辅助数据库使用的初始化参数文件中包含DB_FILE_NAME_CONVERT初始化参数。临时文件被视为数据库辅助集的一部分。在实例化辅助数据库时，RMAN将重新创建目标数据库的临时表空间，并使用辅助数据文件名的常规规则生成其名称。通过重定向RMAN以使用恢复集和辅助集数据文件的现有映像副本，可以增强TSPITR性能。在这种情况下，RMAN不需要从备份还原数据文件。使用SET NEWNAME命令可以在使用映像副本执行TSPITR时指定映像副本的位置。CONFIGURE AUXNAME命令为辅助集数据文件映像副本设置持久备用位置，而SET NEWNAME命令为RUN命令的持续时间设置备用位置。使用映像副本执行TSPITR时，此过程使用CONFIGURE AUXNAME。自动辅助数据库使用一组默认初始化参数。如果需要，您可以添加其他参数。如果使用初始化参数文件，则可以使用CONTROL_FILES初始化参数为辅助数据库的控制文件指定自己的位置要在辅助数据库上恢复它们后对辅助和恢复集执行恢复，RMAN可能需要还原存档日志。使用辅助目标时，存档日志将还原到该位置。如果在辅助数据库参数文件中指定LOG_FILE_NAME_CONVERT初始化参数，并且参数成功转换目标的联机重做日志的名称，则此参数将确定联机重做日志位置。虽然Oracle建议您让RMAN管理辅助数据库的所有方面，但有时您可能必须创建和管理自己的辅助数据库。如果选择此模式，则负责设置，启动，停止和清理TSPITR中使用的辅助数据库。创建适合用作辅助数据库的Oracle实例需要执行一组步骤。有多种方法可以为辅助数据库创建密码文件。使用文本编辑器为目标数据库主机上的辅助数据库创建初始化参数文件。辅助数据库必须具有有效的网络服务名称。在继续之前，请使用SQL * Plus确保您可以与辅助数据库建立SYSBACKUP或SYSDBA连接。使用您自己的辅助实例执行TSPITR时，请记住某些准则。可以覆盖使用自己的辅助数据库进行TSPITR时通道的默认行为。您可能希望使用SET NEWNAME命令来引用辅助集文件的现有映像副本以提高TSPITR性能，或者为TSPITR之后的恢复集文件分配新名称。如有必要，请计划这些命令，并将它们添加到为TSPITR运行的命令序列中。完成先决条件，然后按照本节中的步骤使用您自己的辅助数据库执行TSPITR。在开始RMAN TSPITR之前，必须启动辅助数据库。由于辅助数据库还没有控制文件，因此只能以NOMOUNT模式启动实例。启动RMAN并连接到目标数据库和手动创建的辅助数据库。使用RECOVER TABLESPACE命令使用您自己的辅助实例执行TSPITR。此过程使用RECOVER TABLESPACE ...UNTIL命令执行TSPITR。各种问题都可能导致RMAN TSPITR失败。必须确定并修复问题。目标数据库中的文件，SET NEWNAME或CONFIGURE AUXNAME命令分配的文件名以及DB_FILE_NAME_CONVERT参数的效果生成的文件名之间可能会发生名称冲突。在TSPITR期间，RMAN需要有关哪些表空间在TSPITR目标时间具有还原段的信息。如果使用此信息，通常可在恢复目录中使用此信息。如果您正在管理自己的辅助数据库并且TSPITR失败，请不要尝试在不解决错误的情况下重新运行TSPITR。">执行RMAN表空间时间点恢复（TSPITR）</a></p>
                        </li>
                     </ul>
                  </div>
                  <div class="infoboxnotealso" id="GUID-FBD1224C-822F-45E7-898D-1DEC3C6FD7A1__GUID-61ED9564-575B-4A20-A5F2-E0C079B04E07">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="rman-recovering-tables-partitions.html#GUID-F9ECE704-0A06-4582-B6AF-6C05C0EFA8ED" title="RMAN使您可以将一个或多个表或表分区恢复到指定的时间点，而不会影响其余的数据库对象。您可以使用以前创建的RMAN备份将表和表分区恢复到指定的时间点。">从RMAN备份恢复表和表分区的目的</a></p>
                        </li>
                        <li>
                           <p><a href="rman-recovering-tables-partitions.html#GUID-EEB32689-9ACE-40C6-9874-5FB484C4126D" title="要恢复表或表分区，需要完全备份undo，SYSTEM，SYSAUX以及包含表或表分区的表空间。">恢复表和表分区所需的RMAN备份</a></p>
                        </li>
                        <li>
                           <p><a href="rman-recovering-tables-partitions.html#GUID-2102898D-E461-4161-8DBC-EE4B37213B60" title="RMAN使用RECOVER命令将表或表分区恢复到指定的时间点。">从RMAN备份恢复表和表分区的基本概念</a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="BRADV688"></a><div class="props_rev_3"><a id="GUID-F9ECE704-0A06-4582-B6AF-6C05C0EFA8ED" name="GUID-F9ECE704-0A06-4582-B6AF-6C05C0EFA8ED"></a><h4 id="BRADV-GUID-F9ECE704-0A06-4582-B6AF-6C05C0EFA8ED" class="sect4"><span class="enumeration_section">22.1.1</span>从RMAN备份中恢复表和表分区的目的</h4>
                  <div>
                     <p>RMAN使您可以将一个或多个表或表分区恢复到指定的时间点，而不会影响其余的数据库对象。您可以使用以前创建的RMAN备份将表和表分区恢复到指定的时间点。</p>
                     <p>从RMAN备份恢复表和表分区在以下方案中很有用：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您需要在特定时间点恢复极少数的表。在这种情况下，TSPITR不是最有效的解决方案，因为它将表空间中的所有对象移动到指定的时间点。</p>
                        </li>
                        <li>
                           <p>您需要恢复已被逻辑损坏或已被删除和清除的表。</p>
                        </li>
                        <li>
                           <p>闪回表是不可能的，因为所需的时间点早于可用的撤销时间。</p>
                        </li>
                        <li>
                           <p>您希望恢复在DDL操作修改表结构后丢失的数据。使用闪回表是不可能的，因为在期望的时间点和当前时间之间的表上运行了DDL。闪回表不能通过结构更改（例如截断表操作）来回滚表。</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="BRADV808"></a><div class="props_rev_3"><a id="GUID-EEB32689-9ACE-40C6-9874-5FB484C4126D" name="GUID-EEB32689-9ACE-40C6-9874-5FB484C4126D"></a><h4 id="BRADV-GUID-EEB32689-9ACE-40C6-9874-5FB484C4126D" class="sect4"><span class="enumeration_section">22.1.2</span>恢复表和表分区所需的RMAN备份</h4>
                  <div>
                     <p>要恢复表或表分区，需要完全备份undo， <code class="codeph">SYSTEM</code> ， <code class="codeph">SYSAUX</code>以及包含表或表分区的表空间。
                     </p>
                     <p>要恢复表，包含表的从属对象的所有分区都必须包含在恢复集中。如果表空间<code class="codeph">tbs2</code>中包含表空间<code class="codeph">tbs1</code>中的表的索引或分区，则仅当tablepsace <code class="codeph">tbs2</code>也包含在恢复集中时，才能恢复该表。
                     </p>
                     <p></p>
                     <p>要恢复PDB中的表，您需要备份以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>根，CDB种子和包含表的PDB的<code class="codeph">SYSTEM</code> ， <code class="codeph">SYSAUX</code>和undo表空间</p>
                        </li>
                        <li>
                           <p>包含表或分区的表空间</p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-EEB32689-9ACE-40C6-9874-5FB484C4126D__GUID-6CC906A5-4FE6-4D5A-B62F-19CBAD3C117A">
                        <p class="notep1">也可以看看：</p><a href="rman-recovering-tables-partitions.html#GUID-5C32C06D-84AC-44D4-AAA2-54886EA30EF0" title="从RMAN备份恢复表或表分区之前，必须满足某些先决条件。">从RMAN备份恢复表和表分区的先决条件</a></div>
                  </div>
               </div><a id="BRADV689"></a><div class="props_rev_3"><a id="GUID-2102898D-E461-4161-8DBC-EE4B37213B60" name="GUID-2102898D-E461-4161-8DBC-EE4B37213B60"></a><h4 id="BRADV-GUID-2102898D-E461-4161-8DBC-EE4B37213B60" class="sect4"><span class="enumeration_section">22.1.3</span>从RMAN备份中恢复表和表分区的基本概念</h4>
                  <div>
                     <p>RMAN使用<code class="codeph">RECOVER</code>命令将表或表分区恢复到指定的时间点。
                     </p>
                     <p>要从RMAN备份恢复表和表分区，您需要提供以下信息：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>必须恢复的表或表分区的名称</p>
                        </li>
                        <li>
                           <p>必须恢复表或表分区的时间点</p>
                        </li>
                        <li>
                           <p>是否必须将恢复的表或表分区导入目标数据库</p>
                        </li>
                     </ul>
                     <p>RMAN使用此信息自动执行恢复指定表或表分区的过程。作为恢复过程的一部分，RMAN会创建一个辅助数据库，用于将表或表分区恢复到指定的时间点。</p>
                     <p>如果需要重命名已恢复的表或表分区，映射到新的表空间或映射到新的模式，则必须为表，表空间或模式指定新名称。</p>
                     <div class="infoboxnotealso" id="GUID-2102898D-E461-4161-8DBC-EE4B37213B60__GUID-570759F6-1F36-4BDD-8320-939EBBCC3080">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="rman-recovering-tables-partitions.html#GUID-433301FC-51C6-4A59-9FBC-B43C6A74198F" title="RMAN执行一系列步骤，同时自动执行从RMAN备份恢复表或表分区的过程。">RMAN执行以恢复表和表分区的步骤</a></p>
                           </li>
                           <li>
                              <p><a href="rman-recovering-tables-partitions.html#GUID-E0AECEFE-D384-4EEE-94AA-CB8F847B1621" title="RMAN创建一个辅助数据库，它在恢复指定的表或表分区的过程中使用它。有多种技术可用于指定辅助数据库文件的位置。">关于RMAN表恢复期间辅助数据库文件的位置</a></p>
                           </li>
                           <li>
                              <p><a href="rman-recovering-tables-partitions.html#GUID-B80DD4C3-BF33-46C4-BFA5-614A2523877B" title="在将表或表分区恢复到辅助数据库上的指定时间点之后，RMAN会创建一个包含已恢复对象的数据泵导出转储文件。您可以指定此转储文件的名称和位置，也可以允许RMAN使用默认名称和位置。">关于RMAN表恢复期间使用的数据泵导出转储文件</a></p>
                           </li>
                           <li>
                              <p><a href="rman-recovering-tables-partitions.html#GUID-F22330E3-071D-40C5-ACC2-A984E6A3EBD8" title="使用REMAP TABLE子句重命名目标数据库中已恢复的表或表分区。">关于在RMAN恢复期间重命名恢复的表和表分区</a></p>
                           </li>
                           <li>
                              <p><a href="rman-recovering-tables-partitions.html#GUID-907031B5-B355-43D8-8E2B-A0A6F2283BD7" title="将表或表分区恢复到不同的模式使您可以避免可能由源模式中已存在的约束，索引或触发器名称引起的名称冲突。">关于将表和分区恢复到新架构</a></p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="BRADV690"></a><div class="props_rev_3"><a id="GUID-433301FC-51C6-4A59-9FBC-B43C6A74198F" name="GUID-433301FC-51C6-4A59-9FBC-B43C6A74198F"></a><h5 id="BRADV-GUID-433301FC-51C6-4A59-9FBC-B43C6A74198F" class="sect5"><span class="enumeration_section">22.1.3.1</span> RMAN执行的恢复表和表分区的步骤</h5>
                     <div>
                        <p>RMAN执行一系列步骤，同时自动执行从RMAN备份恢复表或表分区的过程。</p>
                        <div class="section">
                           <p>步骤包括以下内容：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>根据为恢复指定的时间点确定哪个备份包含需要恢复的表或表分区。</span><div></div>
                           </li>
                           <li class="stepexpand"><span>确定目标主机上是否有足够的空间来创建将在表或分区恢复过程中使用的辅助实例。</span><div>如果所需空间不可用，则RMAN将显示错误并退出恢复操作。</div>
                           </li>
                           <li class="stepexpand"><span>在目标主机上创建辅助数据库，并将指定的表或表分区恢复到此辅助数据库，直到指定的时间点。</span><div>
                                 <p>您可以在辅助数据库中指定恢复数据文件存储到的目标主机上的位置。</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>创建包含已恢复的表或表分区的数据泵<a href="glossary.html#GUID-5C2A79F3-E089-41DC-B3F5-879FB6125CE5"><span class="xrefglossterm">导出转储文件</span></a> 。</span><div>
                                 <p>您可以指定用于存储已恢复表或表分区的元数据的数据泵导出转储文件的名称和位置。</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>（可选）将Data Pump导出转储文件导入目标实例。</span><div>
                                 <p>您可以选择不将包含已恢复表或表分区的导出转储文件导入目标数据库。如果在恢复过程中未导入导出转储文件，则必须稍后使用“数据泵导入”实用程序手动导入该文件。</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>（可选）重命名目标数据库中已恢复的表或表分区。</span><div>
                                 <p>您还可以将恢复的对象导入到与它们最初存在的表空间或模式不同的表空间或模式中。</p>
                              </div>
                           </li>
                        </ol>
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-433301FC-51C6-4A59-9FBC-B43C6A74198F__GUID-0233E38B-4281-48D9-87FA-95FC87D30747">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="rman-recovering-tables-partitions.html#GUID-E0AECEFE-D384-4EEE-94AA-CB8F847B1621" title="RMAN创建一个辅助数据库，它在恢复指定的表或表分区的过程中使用它。有多种技术可用于指定辅助数据库文件的位置。">关于RMAN表恢复期间辅助数据库文件的位置</a></p>
                                 </li>
                                 <li>
                                    <p><a href="rman-recovering-tables-partitions.html#GUID-B80DD4C3-BF33-46C4-BFA5-614A2523877B" title="在将表或表分区恢复到辅助数据库上的指定时间点之后，RMAN会创建一个包含已恢复对象的数据泵导出转储文件。您可以指定此转储文件的名称和位置，也可以允许RMAN使用默认名称和位置。">关于RMAN表恢复期间使用的数据泵导出转储文件</a></p>
                                 </li>
                                 <li>
                                    <p><a href="rman-recovering-tables-partitions.html#GUID-87627528-1EC7-42D3-ADB1-232A6C134A2B" title="默认情况下，RMAN将存储在导出转储文件中的已恢复表或表分区导入目标数据库。但是，您可以使用RESTORE命令的NOTABLEIMPORT子句选择不导入已恢复的表或表分区。">关于将恢复的表和表分区导入目标数据库</a></p>
                                 </li>
                                 <li>
                                    <p><a href="rman-recovering-tables-partitions.html#GUID-F22330E3-071D-40C5-ACC2-A984E6A3EBD8" title="使用REMAP TABLE子句重命名目标数据库中已恢复的表或表分区。">关于在RMAN恢复期间重命名恢复的表和表分区</a></p>
                                 </li>
                                 <li>
                                    <p><a href="rman-recovering-tables-partitions.html#GUID-907031B5-B355-43D8-8E2B-A0A6F2283BD7" title="将表或表分区恢复到不同的模式使您可以避免可能由源模式中已存在的约束，索引或触发器名称引起的名称冲突。">关于将表和分区恢复到新架构</a></p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV693"></a><div class="props_rev_3"><a id="GUID-E0AECEFE-D384-4EEE-94AA-CB8F847B1621" name="GUID-E0AECEFE-D384-4EEE-94AA-CB8F847B1621"></a><h5 id="BRADV-GUID-E0AECEFE-D384-4EEE-94AA-CB8F847B1621" class="sect5"><span class="enumeration_section">22.1.3.2</span>关于RMAN表恢复期间辅助数据库文件的位置</h5>
                     <div>
                        <p>RMAN创建一个辅助数据库，它在恢复指定的表或表分区的过程中使用它。有多种技术可用于指定辅助数据库文件的位置。</p>
                        <p>在用于存储辅助数据库的数据文件的目标主机上，使用以下技术之一：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">RECOVER</code>命令中的<code class="codeph">AUXILIARY DESTINATION</code>子句</p>
                           </li>
                           <li>
                              <p><code class="codeph">SET NEWNAME</code>命令</p>
                              <p>使用包含<code class="codeph">RECOVER</code>命令的<code class="codeph">RUN</code>块和重命名数据文件所需的<code class="codeph">SET NEWNAME</code>命令。
                              </p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-E0AECEFE-D384-4EEE-94AA-CB8F847B1621__GUID-250C0E4F-CCCC-4828-BB6D-91FECE55E677">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../rcmrf/RECOVER.html#RCMRF140" target="_blank"><span><cite>Oracle数据库备份和恢复参考中的</cite></span></a> <code class="codeph">RECOVER</code>命令语法</p>
                              </li>
                              <li>
                                 <p><a href="../rcmrf/SET.html#RCMRF153" target="_blank"><span><cite>Oracle数据库备份和恢复参考中的</cite></span></a> <code class="codeph">SET</code>命令语法</p>
                              </li>
                           </ul>
                        </div>
                        <p>建议您使用<code class="codeph">AUXILIARY DESTINATION</code>子句为辅助数据库中的数据文件提供位置。使用<code class="codeph">SET NEWNAME</code>命令时，如果省略恢复过程所需的一个数据文件的名称，则无法恢复表或表分区。
                        </p>
                     </div>
                  </div><a id="BRADV691"></a><div class="props_rev_3"><a id="GUID-B80DD4C3-BF33-46C4-BFA5-614A2523877B" name="GUID-B80DD4C3-BF33-46C4-BFA5-614A2523877B"></a><h5 id="BRADV-GUID-B80DD4C3-BF33-46C4-BFA5-614A2523877B" class="sect5"><span class="enumeration_section">22.1.3.3</span>关于在RMAN表恢复期间使用的数据泵导出转储文件</h5>
                     <div>
                        <p>在将表或表分区恢复到辅助数据库上的指定时间点之后，RMAN会创建一个包含已恢复对象的数据泵导出转储文件。您可以指定此转储文件的名称和位置，也可以允许RMAN使用默认名称和位置。</p>
                        <p>使用<code class="codeph">RECOVER</code>命令的<code class="codeph">DATAPUMP DESTINATION</code>子句指定创建数据泵<a href="glossary.html#GUID-5C2A79F3-E089-41DC-B3F5-879FB6125CE5"><span class="xrefglossterm">导出转储文件的</span></a>位置。该位置通常是存储转储文件的操作系统目录的路径。如果省略此子句，则转储文件将存储在<code class="codeph">AUXILIARY DESTINATION</code>参数指定的位置。如果未指定辅助目标，则转储文件将存储在特定于操作系统的默认位置。在Linux上，此默认位置为<code class="codeph">$ORACLE_HOME/dbs</code> 。在Windows上，默认位置为<code class="codeph">%ORACLE_HOME\database</code> 。
                        </p>
                        <p>使用<code class="codeph">RECOVER</code>命令的<code class="codeph">DUMP FILE</code>子句指定数据泵导出转储文件的名称。如果省略此子句，RMAN将使用特定于操作系统的默认名称作为转储文件。在Linux和Windows上，默认转储文件名是<code class="codeph">tspitr_</code> <span class="italic"><code class="codeph">SID-of-clone_n</code></span> <code class="codeph">.dmp</code> ，其中<span class="italic"><code class="codeph">SID-of-clone</code></span>是由RMAN创建以执行恢复的辅助数据库的Oracle SID， <span class="italic"><code class="codeph">n</code></span>是任意随机生成的数字。如果必须在必须创建转储文件的位置存在具有<code class="codeph">DUMP FILE</code>指定名称的文件，则恢复操作将失败。
                        </p>
                     </div>
                  </div><a id="BRADV694"></a><div class="props_rev_3"><a id="GUID-87627528-1EC7-42D3-ADB1-232A6C134A2B" name="GUID-87627528-1EC7-42D3-ADB1-232A6C134A2B"></a><h5 id="BRADV-GUID-87627528-1EC7-42D3-ADB1-232A6C134A2B" class="sect5"><span class="enumeration_section">22.1.3.4</span>关于将恢复的表和表分区导入目标数据库</h5>
                     <div>
                        <p>默认情况下，RMAN将存储在导出转储文件中的已恢复表或表分区导入目标数据库。但是，您可以使用<code class="codeph">RESTORE</code>命令的<code class="codeph">NOTABLEIMPORT</code>子句选择不导入已恢复的表或表分区。
                        </p>
                        <p>使用<code class="codeph">NOTABLEIMPORT</code> ，RMAN将它们恢复到指定的点，然后创建<a href="glossary.html#GUID-5C2A79F3-E089-41DC-B3F5-879FB6125CE5"><span class="xrefglossterm">导出转储文件</span></a> 。但是，此转储文件不会导入目标数据库。必要时，必须使用“数据泵导入”实用程序将此转储文件手动导入目标数据库。
                        </p>
                        <p>如果在导入操作期间发生错误，RMAN不会在表恢复结束时删除导出转储文件。这使您可以手动导入转储文件。</p>
                     </div>
                  </div><a id="BRADV692"></a><div class="props_rev_3"><a id="GUID-F22330E3-071D-40C5-ACC2-A984E6A3EBD8" name="GUID-F22330E3-071D-40C5-ACC2-A984E6A3EBD8"></a><h5 id="BRADV-GUID-F22330E3-071D-40C5-ACC2-A984E6A3EBD8" class="sect5"><span class="enumeration_section">22.1.3.5</span>关于在RMAN恢复期间重命名恢复的表和表分区</h5>
                     <div>
                        <p>使用<code class="codeph">REMAP TABLE</code>子句重命名目标数据库中已恢复的表或表分区。
                        </p>
                        <p>如果目标数据库中存在与您恢复的表同名的表，RMAN将显示一条错误消息，指示必须使用<code class="codeph">REMAP TABLE</code>子句重命名已恢复的表。
                        </p>
                        <p>恢复表分区时，每个表分区都将恢复到单独的表中。使用<code class="codeph">REMAP TABLE</code>子句指定必须将每个已恢复的分区导入的表名。如果未明确指定表名，则RMAN通过连接已恢复的表名和分区名来生成表名。生成的名称格式为<span class="italic"><code class="codeph">tablename_partitionname</code></span> 。如果目标数据库中存在具有此名称的表，则RMAN会将_1附加到名称。如果此名称也存在，则RMAN会将_2附加到名称，依此类推。
                        </p>
                        <p>要将恢复的表或表分区导入到与这些对象最初存在的表空间不同的表空间中，请使用<code class="codeph">RECOVER</code>命令的<code class="codeph">REMAP TABLESPACE</code>子句。仅重新映射正在恢复的表或表分区，不更改现有对象。
                        </p>
                        <div class="infoboxnote" id="GUID-F22330E3-071D-40C5-ACC2-A984E6A3EBD8__GUID-26E28F0C-84FD-4222-8823-187EE66157F5">
                           <p class="notep1">注意：</p>
                           <p>使用<code class="codeph">REMAP</code>选项时，不会导入任何命名的约束和索引。这是为了避免与现有表的名称冲突。
                           </p>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-907031B5-B355-43D8-8E2B-A0A6F2283BD7" name="GUID-907031B5-B355-43D8-8E2B-A0A6F2283BD7"></a><h5 id="BRADV-GUID-907031B5-B355-43D8-8E2B-A0A6F2283BD7" class="sect5"><span class="enumeration_section">22.1.3.6</span>关于将表和分区恢复到新架构中</h5>
                     <div>
                        <p>将表或表分区恢复到不同的模式使您可以避免可能由源模式中已存在的约束，索引或触发器名称引起的名称冲突。</p>
                        <p></p>
                        <p>从Oracle Database 12 <span class="italic">c</span>第2版（12.2）开始，您可以将表或表分区恢复为与源模式（它们最初存在的模式）不同的模式。将对象恢复到不同的模式时，您可以保留其原始名称或重命名它们。您可以在单个恢复操作中重命名表并重新映射架构。例如，您可以将<code class="codeph">HR.EMPLOYEES</code>表恢复到<code class="codeph">NEW_HR.EMPLOYEES</code>表， <code class="codeph">HR.NEW_EMPLOYEES</code>表或<code class="codeph">NEW_HR.NEW_EMPLOYEES</code>表中。<code class="codeph">REMAP TABLE</code>子句使您可以重命名对象并将它们恢复到不同的模式中。
                        </p>
                        <p>在表恢复期间，使用<code class="codeph">RECOVER TABLE</code>命令的<code class="codeph">REMAP TABLE</code>子句将源模式映射到新模式。在执行恢复之前，新模式必须存在于目标数据库中。
                        </p>
                        <div class="infoboxnote" id="GUID-907031B5-B355-43D8-8E2B-A0A6F2283BD7__GUID-4593CBEB-E063-4CB8-94FD-F9B8E0929442">
                           <p class="notep1">注意：</p>
                           <p>物理备用数据库不支持表恢复。对于逻辑备用数据库，在主数据库上恢复的对象将传播到逻辑备用数据库。</p>
                        </div>
                        <div class="infoboxnote" id="GUID-907031B5-B355-43D8-8E2B-A0A6F2283BD7__GUID-316A58CF-E60E-4B50-94F3-6619CA707E38">
                           <p class="notep1">注意：</p>
                           <p><a href="rman-recovering-tables-partitions.html#GUID-98525DD5-E08F-46F0-A9D8-A7EC3EB54457" title="此示例将多个表恢复为与源架构不同的新架构。">示例：将表恢复为新架构</a></p>
                        </div>
                     </div>
                  </div>
               </div><a id="BRADV695"></a><div class="props_rev_3"><a id="GUID-526969ED-37C3-44C6-B205-AF1621008DCE" name="GUID-526969ED-37C3-44C6-B205-AF1621008DCE"></a><h4 id="BRADV-GUID-526969ED-37C3-44C6-B205-AF1621008DCE" class="sect4"><span class="enumeration_section">22.1.4</span>从RMAN备份恢复表和表分区的限制</h4>
                  <div>
                     <p>使用<code class="codeph">RECOVER</code>命令从RMAN备份恢复表和表分区受到某些限制。
                     </p>
                     <p>限制包括以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>无法恢复属于<code class="codeph">SYS</code>模式的表和表分区。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">SYSTEM</code>和<code class="codeph">SYSAUX</code>表空间中的表和表分区无法恢复。
                           </p>
                        </li>
                        <li>
                           <p>无法恢复备用数据库上的表和表分区。</p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">REMAP</code>选项无法恢复具有命名<code class="codeph">NOT NULL</code>约束的表。
                           </p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="BRADV696"></a><div class="props_rev_3"><a id="GUID-27F62B73-7341-4939-9677-5F6D614DE55A" name="GUID-27F62B73-7341-4939-9677-5F6D614DE55A"></a><h3 id="BRADV-GUID-27F62B73-7341-4939-9677-5F6D614DE55A" class="sect3"><span class="enumeration_section">22.2</span>准备恢复表和表分区</h3>
               <div>
                  <p>在准备恢复表或表分区之前，必须执行一些初步任务。</p>
                  <div class="p">查看<span class="q">“ <a href="rman-recovering-tables-partitions.html#GUID-526969ED-37C3-44C6-B205-AF1621008DCE" title="Recovering tables and table partitions from RMAN backups by using the RECOVER command is subject to certain limitations.">从RMAN备份中恢复表和表分区</a></span>的限制”中描述的<span class="q"><a href="rman-recovering-tables-partitions.html#GUID-526969ED-37C3-44C6-B205-AF1621008DCE" title="使用RECOVER命令从RMAN备份恢复表和表分区受到某些限制。">限制</a></span> 。
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>从RMAN备份恢复表或表分区的准备工作包括以下步骤：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>验证是否满足恢复表或表分区所需的先决条件</p>
                        </li>
                        <li>
                           <p>确定必须恢复表或表分区的时间点</p>
                        </li>
                        <li>
                           <p>确定是否必须将恢复的表或表分区导入目标数据库</p>
                           <p>默认情况下，RMAN将恢复的表或表分区导入目标数据库。但是，您可以指定RMAN不得导入已恢复的对象。</p>
                        </li>
                        <li>
                           <p>确定是否必须重命名已恢复的表或表分区，映射到新的表空间，还是映射到新的模式。</p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-27F62B73-7341-4939-9677-5F6D614DE55A__GUID-1422396D-3A48-46BD-959F-A131EC6ACA58">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li><span class="q">“ <a href="rman-recovering-tables-partitions.html#GUID-5C32C06D-84AC-44D4-AAA2-54886EA30EF0" title="从RMAN备份恢复表或表分区之前，必须满足某些先决条件。">从RMAN备份恢复表和表分区的先决条件</a> ”</span></li>
                           <li>
                              <p><span class="q">“ <a href="rman-recovering-tables-partitions.html#GUID-87627528-1EC7-42D3-ADB1-232A6C134A2B" title="默认情况下，RMAN将存储在导出转储文件中的已恢复表或表分区导入目标数据库。但是，您可以使用RESTORE命令的NOTABLEIMPORT子句选择不导入已恢复的表或表分区。">关于将恢复的表和表分区导入目标数据库</a> ”</span></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="rman-recovering-tables-partitions.html#GUID-688A090A-B24F-4C9C-800B-99483F3514C5" title="确定要恢复表或表分区的确切时间点非常重要。有多种方法可以指定必须恢复对象的时间点。">确定必须恢复表和表分区的时间点</a> ”</span></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="rman-recovering-tables-partitions.html#GUID-F22330E3-071D-40C5-ACC2-A984E6A3EBD8" title="使用REMAP TABLE子句重命名目标数据库中已恢复的表或表分区。">关于在RMAN恢复期间重命名恢复的表和表分区</a> ”</span></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="rman-recovering-tables-partitions.html#GUID-907031B5-B355-43D8-8E2B-A0A6F2283BD7" title="将表或表分区恢复到不同的模式使您可以避免可能由源模式中已存在的约束，索引或触发器名称引起的名称冲突。">关于将表和分区恢复到新架构</a> ”</span></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="BRADV698"></a><div class="props_rev_3"><a id="GUID-5C32C06D-84AC-44D4-AAA2-54886EA30EF0" name="GUID-5C32C06D-84AC-44D4-AAA2-54886EA30EF0"></a><h4 id="BRADV-GUID-5C32C06D-84AC-44D4-AAA2-54886EA30EF0" class="sect4"><span class="enumeration_section">22.2.1</span>从RMAN备份恢复表和表分区的先决条件</h4>
                  <div>
                     <p>从RMAN备份恢复表或表分区之前，必须满足某些先决条件。</p>
                     <p>它们包括以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>目标数据库必须处于读写模式。</p>
                        </li>
                        <li>
                           <p>目标数据库必须处于<code class="codeph">ARCHIVELOG</code>模式。
                           </p>
                        </li>
                        <li>
                           <p>您必须具有表或分区的RMAN备份，因为它们存在于您希望恢复这些对象的时间点。</p>
                        </li>
                        <li>
                           <p>要恢复单个表分区，目标数据库的<code class="codeph">COMPATIBLE</code>初始化参数必须设置为11.1.0或更高版本。
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-5C32C06D-84AC-44D4-AAA2-54886EA30EF0__GUID-C8B7A056-FE4D-4C11-9775-B2F13A50E4C6">
                        <p class="notep1">也可以看看：</p><a href="rman-recovering-tables-partitions.html#GUID-EEB32689-9ACE-40C6-9874-5FB484C4126D" title="要恢复表或表分区，需要完全备份undo，SYSTEM，SYSAUX以及包含表或表分区的表空间。">恢复表和表分区所需的RMAN备份</a></div>
                  </div>
               </div><a id="BRADV697"></a><div class="props_rev_3"><a id="GUID-688A090A-B24F-4C9C-800B-99483F3514C5" name="GUID-688A090A-B24F-4C9C-800B-99483F3514C5"></a><h4 id="BRADV-GUID-688A090A-B24F-4C9C-800B-99483F3514C5" class="sect4"><span class="enumeration_section">22.2.2</span>确定必须恢复表和表分区的时间点</h4>
                  <div>
                     <p>确定要恢复表或表分区的确切时间点非常重要。有多种方法可以指定必须恢复对象的时间点。</p>
                     <p>使用以下方法之一：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>SCN</p>
                           <p>将表或表分区恢复到SCN指定时的状态。</p>
                        </li>
                        <li>
                           <p>时间</p>
                           <p>将表或表分区恢复到指定时间所处的状态。使用<code class="codeph">NLS_LANG</code>和<code class="codeph">NLS_DATE_FORMAT</code>环境变量中指定的日期格式。您还可以使用<code class="codeph">SYSDATE</code>等数据常量来指定时间，例如<code class="codeph">SYSDATE-30</code> 。
                           </p>
                        </li>
                        <li>
                           <p>序列号</p>
                           <p>将表或表分区恢复到日志序列号和线程号指定的时间状态。</p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="BRADV809"></a><a id="BRADV699"></a><div class="props_rev_3"><a id="GUID-04D1B794-25D0-4C1E-9A98-F08AD361B41E" name="GUID-04D1B794-25D0-4C1E-9A98-F08AD361B41E"></a><h3 id="BRADV-GUID-04D1B794-25D0-4C1E-9A98-F08AD361B41E" class="sect3"><span class="enumeration_section">22.3</span>恢复表和表分区</h3>
               <div>
                  <p>使用<code class="codeph">RESTORE</code>和<code class="codeph">RECOVER</code>命令恢复表或表分区。
                  </p>
                  <div class="section">
                     <p><span class="bold">要将非CDB中的表或表分区恢复到指定的时间点：</span></p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>执行<span class="q">“ <a href="rman-recovering-tables-partitions.html#GUID-27F62B73-7341-4939-9677-5F6D614DE55A" title="在准备恢复表或表分区之前，必须执行一些初步任务。">准备恢复表和表分区</a> ”中</span>描述的规划任务。</span></li>
                     <li class="stepexpand"><span>启动RMAN并以<code class="codeph">TARGET</code>身份连接到目标数据库。必须以具有<code class="codeph">SYSBACKUP</code>或<code class="codeph">SYSDBA</code>权限的用户身份进行连接，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”中所述</span> 。</span></li>
                     <li class="stepexpand"><span>使用<code class="codeph">RECOVER TABLE</code>命令将选定的表或表分区恢复到指定的时间点。必须使用<code class="codeph">AUXILIARY DESTINATION</code>子句和以下子句之一指定恢复的时间点： <code class="codeph">UNTIL TIME</code> ， <code class="codeph">UNTIL SCN</code>或<code class="codeph">UNTIL SEQUENCE</code> 。</span><div>
                           <p>您可以在<code class="codeph">RECOVER</code>命令中使用以下附加子句：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">DUMP FILE</code>和<code class="codeph">DATAPUMP DESTINATION</code></p>
                                 <p>指定包含已恢复表或表分区的<a href="glossary.html#GUID-5C2A79F3-E089-41DC-B3F5-879FB6125CE5"><span class="xrefglossterm">导出转储文件</span></a>的名称以及必须存储它的位置。
                                 </p>
                                 <p>有关信息，请参阅<span class="q">“ <a href="rman-recovering-tables-partitions.html#GUID-B80DD4C3-BF33-46C4-BFA5-614A2523877B" title="在将表或表分区恢复到辅助数据库上的指定时间点之后，RMAN会创建一个包含已恢复对象的数据泵导出转储文件。您可以指定此转储文件的名称和位置，也可以允许RMAN使用默认名称和位置。">关于在RMAN表恢复期间使用的数据泵导出转储文件</a> ”</span> 。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">NOTABLEIMPORT</code></p>
                                 <p>表示不能将恢复的表或表分区导入目标数据库。</p>
                                 <p>请参见<span class="q">“ <a href="rman-recovering-tables-partitions.html#GUID-87627528-1EC7-42D3-ADB1-232A6C134A2B" title="默认情况下，RMAN将存储在导出转储文件中的已恢复表或表分区导入目标数据库。但是，您可以使用RESTORE命令的NOTABLEIMPORT子句选择不导入已恢复的表或表分区。">关于将恢复的表和表分区导入目标数据库</a> ”</span></p>
                              </li>
                              <li>
                                 <p><code class="codeph">REMAP TABLE</code></p>
                                 <p>重命名目标数据库中已恢复的表或表分区。此子句还用于将表或表分区恢复为与源模式不同的模式。</p>
                                 <p>请参见<span class="q">“ <a href="rman-recovering-tables-partitions.html#GUID-F22330E3-071D-40C5-ACC2-A984E6A3EBD8" title="使用REMAP TABLE子句重命名目标数据库中已恢复的表或表分区。">关于在RMAN恢复期间重命名恢复的表和表分区</a>以及<a href="rman-recovering-tables-partitions.html#GUID-907031B5-B355-43D8-8E2B-A0A6F2283BD7" title="将表或表分区恢复到不同的模式使您可以避免可能由源模式中已存在的约束，索引或触发器名称引起的名称冲突。">关于将表和分区恢复到新架构</a> ”</span></p>
                              </li>
                              <li>
                                 <p><code class="codeph">REMAP TABLESPACE</code></p>
                                 <p>将表或表分区恢复到与最初存在这些对象的表空间不同的表空间。</p>
                                 <p>请参见<span class="q">“ <a href="rman-recovering-tables-partitions.html#GUID-F22330E3-071D-40C5-ACC2-A984E6A3EBD8" title="使用REMAP TABLE子句重命名目标数据库中已恢复的表或表分区。">关于在RMAN恢复期间重命名恢复的表和表分区</a> ”</span></p>
                              </li>
                           </ul>
                        </div>
                     </li>
                  </ol>
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-04D1B794-25D0-4C1E-9A98-F08AD361B41E__GUID-96C46C2E-791B-44FE-8377-B06F470C754D">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="rman-recovering-tables-partitions.html#GUID-DEE9C16C-C30A-46C6-A0CE-2DE060A8EC10" title="本节包含的示例涵盖了恢复表和表分区的多种方案。">示例：从RMAN备份恢复表和表分区</a></p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="BRADV860"></a><a id="BRADV859"></a><div class="props_rev_3"><a id="GUID-B8245791-9B75-4AE7-ACE9-D9EDBC2DACC0" name="GUID-B8245791-9B75-4AE7-ACE9-D9EDBC2DACC0"></a><h3 id="BRADV-GUID-B8245791-9B75-4AE7-ACE9-D9EDBC2DACC0" class="sect3"><span class="enumeration_section">22.4</span>在PDB中恢复表和表分区</h3>
               <div>
                  <p>RMAN使您可以使用<code class="codeph">RECOVER</code>命令将可插拔数据库（PDB）中的一个或多个表或表分区恢复到指定的时间点，而不会影响PDB中的其他对象。</p>
                  <div class="section">
                     <p>用于恢复PDB中的表或表分区的步骤与用于非CDB的步骤类似，但本节中描述的不同之处。</p>
                     <p><span class="bold">要恢复PDB中的表或表分区：</span></p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>执行<span class="q">“ <a href="rman-recovering-tables-partitions.html#GUID-27F62B73-7341-4939-9677-5F6D614DE55A" title="在准备恢复表或表分区之前，必须执行一些初步任务。">准备恢复表和表分区</a> ”中</span>描述的规划任务。</span></li>
                     <li class="stepexpand"><span>启动RMAN并以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的用户身份连接到root，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="您可以将RMAN客户端连接到多租户容器数据库（CDB）和可插拔数据库（PDB）。">使RMAN连接到CDB</a> ”中所述</span> 。</span></li>
                     <li class="stepexpand"><span>使用<code class="codeph">RECOVER TABLE ...将表或表分区恢复到指定的时间点<code class="codeph">RECOVER TABLE ...OF PLUGGABLE DATABASE</code>命令。</span><div>
                           <p>您必须使用<code class="codeph">AUXILIARY DESTINATION</code>子句和以下子句之一： <code class="codeph">UNITL TIME</code> ， <code class="codeph">UNTIL SCN</code>或<code class="codeph">UNTIL SEQUENCE</code> 。</p>
                           <p>根据您的要求，您可能还需要使用以下一个或多个子句： <code class="codeph">DUMP FILE</code> ， <code class="codeph">DATAPUMP DESTINATION</code> ， <code class="codeph">NOTABLEIMPORT</code> ， <code class="codeph">REMAP TABLE</code>或<code class="codeph">REMAP TABLESPACE</code> 。</p>
                           <div class="infoboxnotealso" id="GUID-B8245791-9B75-4AE7-ACE9-D9EDBC2DACC0__GUID-3E56DF68-F9C0-49E5-9063-6B74D7C210C2">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="rman-recovering-tables-partitions.html#GUID-2102898D-E461-4161-8DBC-EE4B37213B60" title="RMAN使用RECOVER命令将表或表分区恢复到指定的时间点。">从RMAN备份恢复表和表分区的基本概念</a></p>
                                 </li>
                                 <li>
                                    <p>有关<code class="codeph">RECOVER</code>命令的信息<a href="../rcmrf/RECOVER.html#RCMRF140" target="_blank"><span><cite>，请参见Oracle数据库备份和恢复参考</cite></span></a></p>
                                 </li>
                              </ul>
                           </div>
                           <p>以下命令将PDB <code class="codeph">HR_PDB</code>的表<code class="codeph">PDB_EMP</code>恢复到当前日期之前4天的状态。<code class="codeph">HR</code>是包含表的模式的名称。恢复的表重命名为<code class="codeph">EMP_RECVR</code> 。</p><pre class="oac_no_warn" dir="ltr">恢复表HR.PDB_EMP可插拔数据库HR_PDB直到'SYSDATE-4'辅助目的地'/ tmp / backups'REMAP TABLE'HR'。'PDB_EMP'： 'EMP_RECVR';</pre></div>
                     </li>
                  </ol>
               </div>
            </div><a id="BRADV700"></a><div class="props_rev_3"><a id="GUID-DEE9C16C-C30A-46C6-A0CE-2DE060A8EC10" name="GUID-DEE9C16C-C30A-46C6-A0CE-2DE060A8EC10"></a><h3 id="BRADV-GUID-DEE9C16C-C30A-46C6-A0CE-2DE060A8EC10" class="sect3"><span class="enumeration_section">22.5</span>示例：从RMAN备份恢复表和表分区</h3>
               <div>
                  <p>本节包含的示例涵盖了恢复表和表分区的多种方案。</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="rman-recovering-tables-partitions.html#GUID-D1C6E45D-44CC-4B07-9C89-E82CD6C0E6A8" title="此示例将多个表恢复到使用SYSDATE表示的指定时间点。">示例：将表恢复到指定的时间点</a></p>
                     </li>
                     <li>
                        <p><a href="rman-recovering-tables-partitions.html#GUID-FB30D350-DFF9-4F92-8132-5C824B2A9E68" title="此示例使用RMAN备份来恢复多个表分区。">示例：将表分区恢复为指定的日志序列号</a></p>
                     </li>
                     <li>
                        <p><a href="rman-recovering-tables-partitions.html#GUID-98525DD5-E08F-46F0-A9D8-A7EC3EB54457" title="此示例将多个表恢复为与源架构不同的新架构。">示例：将表恢复为新架构</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV702"></a><div class="props_rev_3"><a id="GUID-D1C6E45D-44CC-4B07-9C89-E82CD6C0E6A8" name="GUID-D1C6E45D-44CC-4B07-9C89-E82CD6C0E6A8"></a><h4 id="BRADV-GUID-D1C6E45D-44CC-4B07-9C89-E82CD6C0E6A8" class="sect4"><span class="enumeration_section">22.5.1</span>示例：将表恢复到指定的时间点</h4>
                  <div>
                     <p>此示例将多个表恢复到使用<code class="codeph">SYSDATE</code>表示的指定时间点。</p>
                     <div class="section">
                        <p>假设您希望将两个表<code class="codeph">EMP</code>和<code class="codeph">DEPT</code>恢复到两天前的状态，然后才会发生某些逻辑损坏。但是，您不希望RMAN将这些表导入目标数据库。RMAN只能在位置<code class="codeph">/tmp/recover/dumpfiles</code>创建名为<code class="codeph">emp_dept_exp_dump.dat</code>的<a href="glossary.html#GUID-5C2A79F3-E089-41DC-B3F5-879FB6125CE5"><span class="xrefglossterm">导出转储文件</span></a> 。使用<code class="codeph">NOTABLEIMPORT</code>表示不得将这些表导入目标数据库。您可以在需要时使用Data Pump导入实用程序导入这些表。恢复过程中使用的辅助目标是<code class="codeph">/tmp/oracle/recover</code> 。
                        </p>
                        <p>要恢复表<code class="codeph">EMP</code>和<code class="codeph">DEPT</code>而不将它们导入目标数据库：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>执行<span class="q">“ <a href="rman-recovering-tables-partitions.html#GUID-27F62B73-7341-4939-9677-5F6D614DE55A" title="在准备恢复表或表分区之前，必须执行一些初步任务。">准备恢复表和表分区</a> ”中</span>描述的规划任务。</span><div>
                              <p>在此示例中，您需要将表恢复到由使用<code class="codeph">SYSDATE</code>的表达式指定的时间点。但是，不能将恢复的表导入目标数据库。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>启动RMAN会话并按照<code class="codeph">TARGET</code>连接到目标数据库，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”中所述</span> 。</span></li>
                        <li class="stepexpand"><span>使用<code class="codeph">RECOVER</code>命令中的以下子句恢复表<code class="codeph">EMP</code>和<code class="codeph">DEPT</code> ： <code class="codeph">DATAPUMP DESTINATION</code> ， <code class="codeph">DUMP FILE</code> ， <code class="codeph">REMAP TABLE</code>和<code class="codeph">NOTABLEIMPORT</code> 。</span><div>
                              <p>以下<code class="codeph">RECOVER</code>命令可恢复<code class="codeph">EMP</code>和<code class="codeph">DEPT</code>表。
                              </p><pre class="oac_no_warn" dir="ltr">RECOVER TABLE SCOTT.EMP，SCOTT.DEPT UNTIL TIME'SYSDATE-1'AUXILIARY DESTINATION'/ tmp / oracle / recover'DATAPUMP DESTINATION'/ tmp / recover / dumpfiles'DUMP FILE'emp_dept_exp_dump.dat'NOTABLEIMPORT;</pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-D1C6E45D-44CC-4B07-9C89-E82CD6C0E6A8__GUID-5CF428FC-2B4C-48BD-AAF7-8D00BCA78562">
                           <p class="notep1">也可以看看：</p>
                           <p>有关将表恢复到指定时间点的其他示例<a href="../rcmrf/RECOVER.html#RCMRF140" target="_blank"><span><cite>，请参见Oracle数据库备份和恢复参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV703"></a><div class="props_rev_3"><a id="GUID-FB30D350-DFF9-4F92-8132-5C824B2A9E68" name="GUID-FB30D350-DFF9-4F92-8132-5C824B2A9E68"></a><h4 id="BRADV-GUID-FB30D350-DFF9-4F92-8132-5C824B2A9E68" class="sect4"><span class="enumeration_section">22.5.2</span>示例：将表分区恢复为指定的日志序列号</h4>
                  <div>
                     <p>此示例使用RMAN备份来恢复多个表分区。</p>
                     <div class="section">
                        <p>在此示例中，模式<code class="codeph">sh</code>的表<code class="codeph">sales</code>包含以下分区： <code class="codeph">sales_1998</code> ， <code class="codeph">sales_1999</code> ， <code class="codeph">sales_2000</code>和<code class="codeph">sales_2001</code> 。该表存储在<code class="codeph">sales_ts</code>表空间中。您需要将两个分区<code class="codeph">sales_1998</code>和<code class="codeph">sales_1999</code>恢复到由重做日志序列号指定的时间点。必须将恢复的表自动导入目标数据库并映射到表空间<code class="codeph">SALES_PRE_2000_TS</code> 。</p>
                        <p>要将分区<code class="codeph">sales_1998</code>和<code class="codeph">sales_1999</code>恢复为指定的日志序列号：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>执行<span class="q">“ <a href="rman-recovering-tables-partitions.html#GUID-27F62B73-7341-4939-9677-5F6D614DE55A" title="在准备恢复表或表分区之前，必须执行一些初步任务。">准备恢复表和表分区</a> ”中</span>描述的规划任务。</span><div>
                              <p>在此示例中，您需要将两个表分区恢复为指定的日志序列号，然后将这些分区导入目标数据库。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>启动RMAN会话并按照<code class="codeph">TARGET</code>连接到目标数据库，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”中所述</span> 。</span></li>
                        <li class="stepexpand"><span>使用以下<code class="codeph">RECOVER</code>命令和<code class="codeph">REMAP TABLE</code>和<code class="codeph">REMAP TABLESPACE</code>子句恢复分区。</span><div><pre class="oac_no_warn" dir="ltr">RECOVER TABLE SH.SALES：SALES_1998，SH.SALES：SALES_1999 UNTIL SEQUENCE 354辅助目的地'/ tmp / oracle / recover'REMAP TABLE'SH'。'SALES'：'SALES_1998'：'HISTORIC_SALES_1998'，'SH'。'SALES'：'SALES_1999'：'HISTORIC_SALES_1999'REMAP TABLESPACE'SALES_TS'：'SALES_PRE_2000_TS';</pre><p>在这种情况下，指定的表分区将作为单独的表（称为<code class="codeph">historic_sales_1998</code>和<code class="codeph">historic_sales_1999</code> ）导入到目标数据库的<code class="codeph">sales_pre_2000_ts</code>表空间中。<code class="codeph">REMAP TABLE</code>子句指定用于导入表的名称。恢复过程中使用的辅助目标是<code class="codeph">/tmp/oracle/recover</code> 。
                              </p>
                              <p>如果省略<code class="codeph">REMAP TABLE</code>子句，RMAN将使用导入表的默认名称。名称是原始表名和分区名的组合。
                              </p>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-98525DD5-E08F-46F0-A9D8-A7EC3EB54457" name="GUID-98525DD5-E08F-46F0-A9D8-A7EC3EB54457"></a><h4 id="BRADV-GUID-98525DD5-E08F-46F0-A9D8-A7EC3EB54457" class="sect4"><span class="enumeration_section">22.5.3</span>示例：将表恢复为新架构</h4>
                  <div>
                     <p>此示例将多个表恢复为与源架构不同的新架构。</p>
                     <div class="section">
                        <p>在此示例中， <code class="codeph">HR.DEPARTMENTS</code>和<code class="codeph">SH.CHANNELS</code>表需要恢复到它们在一天前发生逻辑损坏之前的状态。必须将恢复的表重命名为<code class="codeph">NEW_DEPARTMENTS</code>和<code class="codeph">NEW_CHANNELS</code>并导入到<code class="codeph">EXAMPLE</code>模式中。架构<code class="codeph">EXAMPLE</code>在运行此示例时存在。
                        </p>
                        <p><code class="codeph">REMAP TABLE</code>子句用于指示源架构如何映射到新的目标架构。恢复过程中使用的辅助目标是<code class="codeph">/tmp/auxdest</code> 。</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>执行从RMAN备份恢复表所需的计划任务。在此示例中，您需要将表恢复到由使用<code class="codeph">SYSDATE</code>的表达式指定的时间点。</span><div>请参阅<a href="rman-recovering-tables-partitions.html#GUID-27F62B73-7341-4939-9677-5F6D614DE55A" title="在准备恢复表或表分区之前，必须执行一些初步任务。">准备恢复表和表分区</a> 。
                           </div>
                        </li>
                        <li class="stepexpand"><span>启动RMAN会话并连接到目标数据库，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”中所述</span> 。</span></li>
                        <li class="stepexpand"><span>恢复<code class="codeph">HR.DEPARTMENTS</code>和<code class="codeph">SH.CHANNELS</code>表，分别将它们重命名为<code class="codeph">NEW_DEPARTMENTS</code>和<code class="codeph">NEW_CHANNELS</code> ，然后将它们导入<code class="codeph">EXAMPLE</code>模式。</span><div>
                              <p>以下<code class="codeph">RECOVER</code>命令执行所需的表恢复：</p><pre class="pre codeblock"><code>恢复表HR.DEPARTMENTS，SH.CHANNELS直到'SYDATE  -  1'辅助目的地'/ tmp / auxdest'REMAP TABLE hr.departments：example.new_departments，sh.channels：example.new_channels;</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>