<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>使用连续查询通知（CQN）</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Database Development Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Database Development Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-development-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-31T23:23:15-08:00"></meta>
      <meta name="dcterms.title" content="Database Development Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96334-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="web-applications.html" title="Previous" type="text/html"></link>
      <link rel="next" href="advanced-part.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="ADFNS"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="web-applications.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="advanced-part.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据库开发指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="plsql-for-application-developers.html" property="item" typeof="WebPage"><span property="name">应用程序开发人员的PL / SQL</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用连续查询通知（CQN）</li>
            </ol>
            <a id="GUID-373BAF72-3E63-42FE-8BEA-8A2AEFBF1C35" name="GUID-373BAF72-3E63-42FE-8BEA-8A2AEFBF1C35"></a><a id="ADFNS1060"></a><a id="ADFNS018"></a>
            
            <h2 id="ADFNS-GUID-373BAF72-3E63-42FE-8BEA-8A2AEFBF1C35" class="sect2"><span class="enumeration_chapter">18</span>使用连续查询通知（CQN）</h2>
         </header>
         <div class="ind"><script type="text/javascript">window.name='cqn'</script><script type="text/javascript">
    function footdisplay(footnum,footnote) {
    var msg = window.open('about:blank', 'NewWindow' + footnum,
        'directories=no,height=100,location=no,menubar=no,resizable=yes,' +
        'scrollbars=yes,status=no,toolbar=no,width=598');
    msg.document.open('text/html');
    msg.document.write('<!DOCTYPE html ');
    msg.document.write('PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" ');
    msg.document.write('"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">'); 
    msg.document.write('<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us" dir="ltr"><head><title>');
   
    msg.document.write('Footnote&nbsp; ' + footnum);
    msg.document.write('<\/title><meta http-equiv="Content-Type" ');
    msg.document.write('content="text/html; charset=utf-8" />');
    msg.document.write('<meta http-equiv="Content-Script-Type" ');
    msg.document.write('content="text/javascript" />');
    msg.document.write('<style type="text/css"> <![CDATA[ ');
    msg.document.write('h1 {text-align: center; font-size: 14pt;}');
    msg.document.write('fieldset {border: none;}');
    msg.document.write('form {text-align: center;}');
    msg.document.write(' ]]u003e </style>');
    msg.document.write('<\/head><body><div id="footnote"><h1>Footnote&nbsp; ' + footnum + '<\/h1><p>');
    msg.document.write(footnote);
    msg.document.write('<\/p><form action="" method="post"><fieldset>');
    msg.document.write('<input type="button" value="OK" ');
    msg.document.write('onclick="window.close();" />');
    msg.document.write('<\/fieldset><\/form><\/div><\/body><\/html>');
    msg.document.close();
    setTimeout(function() {
        var height = msg.document.getElementById('footnote').offsetHeight;
        msg.resizeTo(598, height + 100);
    }
    , 100);
    msg.focus();
}
            </script><noscript>
               <p>此页面上的脚本内容仅用于导航目的，不会以任何方式更改内容。</p>
            </noscript>
            <div>
               <p><span class="bold">连续查询通知（CQN）</span>允许应用程序向数据库注册查询对象更改通知（默认）或查询结果更改通知。已注册查询引用的对象是已<span class="bold">注册的对象</span> 。
               </p>
               <p>如果为<span class="bold">对象更改通知（OCN）</span>注册了查询，则只要事务更改了查询引用和提交的对象，数据库就会通知应用程序，无论查询结果是否更改。
               </p>
               <p>如果为<span class="bold">查询结果更改通知（QRCN）</span>注册了<span class="bold">查询</span> ，则只要事务更改了查询结果并提交，数据库就会通知应用程序。
               </p>
               <p><span class="bold">CQN注册</span>将一个或多个查询的列表与通知类型（OCN或QRCN）和通知处理程序相关联。要创建CQN注册，您可以使用PL / SQL接口或Oracle调用接口（OCI）。如果使用PL / SQL接口，则通知处理程序是服务器端PL / SQL存储过程;如果您使用OCI，则通知处理程序是客户端C回调过程。
               </p>
               <p>本章介绍了CQN的一般概念，并解释了如何使用PL / SQL CQN接口。</p>
               <div class="section">
                  <p class="subhead1" id="GUID-373BAF72-3E63-42FE-8BEA-8A2AEFBF1C35__GUID-FC277921-3E22-475F-BBE5-6E214591E263">话题：</p>
               </div>
               <!-- class="section" -->
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="cqn.html#GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4">关于对象更改通知（OCN）</a></p>
                  </li>
                  <li>
                     <p><a href="cqn.html#GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9" title="某些类型的查询如此简化，以至于在对象级别生成失效;也就是说，只要这些查询中引用的任何对象发生更改。此类查询的示例是使用不受支持的列类型或包含子查询的查询。此问题的解决方案是重写原始查询。">关于查询结果更改通知（QRCN）</a></p>
                  </li>
                  <li>
                     <p><a href="cqn.html#GUID-C678472B-392F-4ABD-A811-259DC2BC3271">生成通知的事件</a></p>
                  </li>
                  <li>
                     <p><a href="cqn.html#GUID-B65C2FEA-1A2C-4C47-9E93-4697442F4529">通知内容</a></p>
                  </li>
                  <li>
                     <p><a href="cqn.html#GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778">CQN的优秀候选人</a></p>
                  </li>
                  <li>
                     <p><a href="cqn.html#GUID-9F2A38D3-1E9B-484C-8793-6D6CA554044A">创建CQN注册</a></p>
                  </li>
                  <li>
                     <p><a href="cqn.html#GUID-01E3E0A3-81AB-4EEE-8E26-4F3F2FE1D60E">使用PL / SQL创建CQN注册</a></p>
                  </li>
                  <li>
                     <p><a href="cqn.html#GUID-0D38B15C-F5CD-44C9-B073-39DA78350D28">使用OCI创建CQN注册</a></p>
                  </li>
                  <li>
                     <p><a href="cqn.html#GUID-A74B4631-B908-45C3-801E-B6986603918F">查询CQN注册</a></p>
                  </li>
                  <li>
                     <p><a href="cqn.html#GUID-2A42CDAB-DBB9-4785-B67B-2E0803F1EAB2">解释通知</a></p>
                  </li>
               </ul>
               <div class="infoboxnote" id="GUID-373BAF72-3E63-42FE-8BEA-8A2AEFBF1C35__GUID-8B2789CF-574F-4947-80A6-29229CEC5711">
                  <p class="notep1">注意：</p>
                  <p>术语<span class="bold">OCN</span>和<span class="bold">QRCN</span>既指通知类型又指通知本身：应用程序<span class="italic">为OCN</span>注册查询，数据库向应用程序<span class="italic">发送OCN</span> ;应用程序<span class="italic">为QRCN</span>注册查询，数据库向应用程序发送<span class="italic">QRCN</span> 。</p>
               </div>
               <div class="infoboxnotealso" id="GUID-373BAF72-3E63-42FE-8BEA-8A2AEFBF1C35__NOTE-139-CAD2C2E5">
                  <p class="notep1">也可以看看：</p>
                  <p>有关使用OCI进行CQN的信息，请参阅<a href="../lnoci/index.html" target="_blank"><span class="italic">Oracle调用接口程序员指南</span></a></p>
               </div>
            </div><a id="ADFNS545"></a><a id="ADFNS544"></a><div class="props_rev_3"><a id="GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4" name="GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4"></a><h3 id="ADFNS-GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4" class="sect3">关于对象更改通知（OCN）</h3>
               <div>
                  <p>如果应用程序注册了对象更改通知（OCN）的查询，则只要事务更改与查询关联的对象并提交，数据库就会向应用程序发送OCN，无论查询结果是否发生更改。</p>
                  <p>例如，如果应用程序在<a href="cqn.html#GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4__CHDIDFIB">示例18-1中</a>为OCN注册查询，并且用户提交更改<code class="codeph">EMPLOYEES</code>表的事务，则数据库会向应用程序发送OCN，即使更改的行不满足查询谓词也是如此（例如，如果<code class="codeph">DEPARTMENT_ID</code> = 5）。
                  </p>
                  <div class="example" id="GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4__CHDIDFIB">
                     <p class="titleinexample">示例18-1要为变更通知注册的查询</p><pre class="oac_no_warn" dir="ltr">从员工中选择EMPLOYEE_ID，SALARY DEPARTMENT_ID = 10;</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="ADFNS1061"></a><a id="ADFNS546"></a><div class="props_rev_3"><a id="GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9" name="GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9"></a><h3 id="ADFNS-GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9" class="sect3">关于查询结果更改通知（QRCN）</h3>
               <div>
                  <div class="infoboxnote" id="GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9__GUID-8AF747A3-D94C-4D8D-9B32-FF71659BD48E">
                     <p class="notep1">注意：</p>
                     <p>对于QRCN支持，数据库的<code class="codeph">COMPATIBLE</code>初始化参数必须至少为11.0.0，并且必须启用自动撤消管理（AUM）（默认情况下）。
                     </p>
                  </div>
                  <p>如果应用程序为查询结果更改通知（QRCN）注册查询，则只要事务更改查询结果并提交，数据库就会向应用程序发送QRCN。</p>
                  <p>例如，如果应用程序在<a href="cqn.html#GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4__CHDIDFIB">例18-1中</a>为QRCN注册查询，则只有在查询结果集发生变化时，数据库才会向应用程序发送QRCN;也就是说，如果这些数据操作语言（DML）语句之一提交：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>满足查询谓词（ <code class="codeph">DEPARTMENT_ID</code> = 10）的行的<code class="codeph">INSERT</code>或<code class="codeph">DELETE</code> 。
                        </p>
                     </li>
                     <li>
                        <p>对满足查询谓词（ <code class="codeph">DEPARTMENT_ID</code> = 10）的行的<code class="codeph">EMPLOYEE_ID</code>或<code class="codeph">SALARY</code>列的<code class="codeph">UPDATE</code> 。
                        </p>
                     </li>
                     <li>
                        <p>对行的<code class="codeph">DEPARTMENT_ID</code>列的<code class="codeph">UPDATE</code> ，将其值从10更改为10以外的值，从而导致从结果集中删除该行。
                        </p>
                     </li>
                     <li>
                        <p>对行的<code class="codeph">DEPARTMENT_ID</code>列的<code class="codeph">UPDATE</code> ，将其值从10以外的值更改为10，从而将该行添加到结果集中。
                        </p>
                     </li>
                  </ul>
                  <p>默认通知类型是OCN。对于QRCN， <code class="codeph">QOS_QUERY</code>在<code class="codeph">CQ_NOTIFICATION$_REG_INFO</code>对象的<code class="codeph">QOSFLAGS</code>属性中指定<code class="codeph">QOS_QUERY</code> 。
                  </p>
                  <p>使用QRCN，您可以选择保证模式（默认）或尽力而为模式。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9__GUID-6B473A84-1FBE-44B9-B75A-E4E4C0337BEA">话题：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="cqn.html#GUID-4A320315-AF7F-4D60-BB63-AD9731D3640D">保证模式</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-0766B418-4023-4BB7-8887-25AE98CBD351" title="某些类型的查询如此简化，以至于在对象级别生成失效;也就是说，只要这些查询中引用的任何对象发生更改。此类查询的示例是使用不受支持的列类型或包含子查询的查询。此问题的解决方案是重写原始查询。">尽力而为模式</a></p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9__NOTE-1382-CAD3DEE1">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关<code class="codeph">COMPATIBLE</code>初始化参数的信息，请<code class="codeph">COMPATIBLE</code> <a href="../admin/creating-and-configuring-an-oracle-database.html#ADMIN11112" target="_blank"><span class="italic">“Oracle数据库管理员指南”</span></a></p>
                           </li>
                           <li>
                              <p>有关AUM的信息，请参见<a href="../admin/managing-undo.html#ADMIN013" target="_blank"><span class="italic">“Oracle数据库管理员指南”</span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS547"></a><div class="props_rev_3"><a id="GUID-4A320315-AF7F-4D60-BB63-AD9731D3640D" name="GUID-4A320315-AF7F-4D60-BB63-AD9731D3640D"></a><h4 id="ADFNS-GUID-4A320315-AF7F-4D60-BB63-AD9731D3640D" class="sect4">保证模式</h4>
                  <div>
                     <p>在保证模式下，没有误报：只有在保证查询结果集发生变化时，数据库才会向应用程序发送QRCN。</p>
                     <p>例如，假设某个应用程序在<a href="cqn.html#GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4__CHDIDFIB">例18-1中</a>为QRCN注册了该查询，该员工201在部门10中，并且这些语句被执行：</p><pre class="oac_no_warn" dir="ltr">更新员工设定SALARY = SALARY + 10 EMPLOYEE_ID = 201;更新员工设定SALARY = SALARY  -  10 EMPLOYEE_ID = 201;承诺;</pre><p>上一个事务中的每个<code class="codeph">UPDATE</code>语句都会更改查询结果集，但它们一起对查询结果集没有影响;因此，数据库不会向应用程序发送QRCN以进行交易。
                     </p>
                     <p>为了保证模式，指定<code class="codeph">QOS_QUERY</code> ，但不<code class="codeph">QOS_BEST_EFFORT</code> ，在<code class="codeph">QOSFLAGS</code>的属性<code class="codeph">CQ_NOTIFICATION$_REG_INFO</code>对象。
                     </p>
                     <p>在保证模式下，某些查询对于QRCN来说过于复杂。</p>
                     <div class="infoboxnotealso" id="GUID-4A320315-AF7F-4D60-BB63-AD9731D3640D__NOTE-127-CAD40C0F">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="cqn.html#GUID-15F66C86-D79B-408F-977C-9BB614C3D91E">可以在保证模式下为QRCN注册</a>的查询，以查找可以在保证模式下注册的查询的特征</p>
                     </div>
                  </div>
               </div><a id="ADFNS549"></a><a id="ADFNS550"></a><a id="ADFNS548"></a><div class="props_rev_3"><a id="GUID-0766B418-4023-4BB7-8887-25AE98CBD351" name="GUID-0766B418-4023-4BB7-8887-25AE98CBD351"></a><h4 id="ADFNS-GUID-0766B418-4023-4BB7-8887-25AE98CBD351" class="sect4">尽力而为模式</h4>
                  <div>
                     <p>对于保证模式而言过于复杂的一些查询可以在尽力而为模式下注册到QRCN，其中CQN创建并注册它们的更简单版本。</p>
                     <p>以下两个示例演示了它的工作原理：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="cqn.html#GUID-A6690455-55C2-4493-8BB2-7F11E1D580D8">示例：在保证模式下查询QRCN过于复杂</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-37F7D32F-20F7-4876-A401-A9A9ED1622EE" title="某些类型的查询如此简化，以至于在对象级别生成失效;也就是说，只要这些查询中引用的任何对象发生更改。此类查询的示例是使用不受支持的列类型或包含子查询的查询。此问题的解决方案是重写原始查询。">示例：查询谁的简化版本使对象无效</a></p>
                        </li>
                     </ul>
                  </div>
                  <div class="sect4"><a id="GUID-A6690455-55C2-4493-8BB2-7F11E1D580D8" name="GUID-A6690455-55C2-4493-8BB2-7F11E1D580D8"></a><h5 id="ADFNS-GUID-A6690455-55C2-4493-8BB2-7F11E1D580D8" class="sect5">示例：在保证模式下查询QRCN过于复杂</h5>
                     <div>
                        <p><a href="cqn.html#GUID-A6690455-55C2-4493-8BB2-7F11E1D580D8__CHDEFDDD">例18-2中</a>的查询对于保证模式下的QRCN而言过于复杂，因为它包含聚合函数<code class="codeph">SUM</code> 。</p>
                        <div class="example" id="GUID-A6690455-55C2-4493-8BB2-7F11E1D580D8__CHDEFDDD">
                           <p class="titleinexample">例18-2保证模式下QRCN的查询过于复杂</p><pre class="oac_no_warn" dir="ltr">SELECT <span class="bold">AND（SALARY）</span> FROM EMPLOYEES WHERE DEPARTMENT_ID = 20;</pre><p>在尽力而为模式下，CQN在此示例中注册了这个更简单的查询版本：</p><pre class="oac_no_warn" dir="ltr">从员工中选择<span class="bold">SALAR</span> DEPETMENT_ID = 20;</pre><p>每当原始查询的结果发生变化时，其更简单版本的结果也会发生变化;因此，简化中不会丢失任何通知。但是，简化可能会导致误报，因为较简单版本的结果可能会在原始查询的结果不变时更改。</p>
                           <p>在尽力而为模式下，数据库：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>最小化来自与通知相关的处理的OLTP响应开销，如下所示：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>对于单表查询，数据库确定查询结果是否已更改哪些列已更改，哪些谓词更改的行满足。</p>
                                    </li>
                                    <li>
                                       <p>对于多表查询（连接），数据库使用表之间的主键/外键约束关系来确定查询结果是否已更改。</p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>每当DML语句更改查询结果集时，即使后续DML语句使第一个DML语句所做的更改无效，也会将应用程序发送到QRCN。</p>
                              </li>
                           </ul>
                           <p>即使对于CQN不简化的查询，尽力而为模式的开销最小化也不经常导致误报。例如，请考虑此示例中的查询和<a href="cqn.html#GUID-4A320315-AF7F-4D60-BB63-AD9731D3640D">保证模式下</a>的事务。在尽力而为模式中，CQN不会简化查询，但事务会产生误报。
                           </p>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-37F7D32F-20F7-4876-A401-A9A9ED1622EE" name="GUID-37F7D32F-20F7-4876-A401-A9A9ED1622EE"></a><h5 id="ADFNS-GUID-37F7D32F-20F7-4876-A401-A9A9ED1622EE" class="sect5">示例：查询谁的简化版本使对象无效</h5>
                     <div>
                        <p>某些类型的查询如此简化，以至于在对象级别生成失效;也就是说，只要这些查询中引用的任何对象发生更改。此类查询的示例是使用不受支持的列类型或包含子查询的查询。此问题的解决方案是重写原始查询。</p>
                        <p>例如， <a href="cqn.html#GUID-37F7D32F-20F7-4876-A401-A9A9ED1622EE__CHDJBIFC">示例18-3中</a>的查询对于保证模式下的QRCN而言过于复杂，因为它包含子查询。
                        </p>
                        <div class="example" id="GUID-37F7D32F-20F7-4876-A401-A9A9ED1622EE__CHDJBIFC">
                           <p class="titleinexample">示例18-3简化版本的查询使对象无效</p><pre class="oac_no_warn" dir="ltr">从DEPARTMENT_ID处的员工中选择SALARY <span class="bold">（</span> <span class="bold">从</span> <span class="bold">LOCATION_ID = 1700的</span> <span class="bold">DEPARTMENTS中</span> <span class="bold">选择DEPARTMENT_ID</span> <span class="bold">）</span> ;</pre><p>在尽力而为模式下，CQN将此示例中的查询简化为：</p><pre class="oac_no_warn" dir="ltr">选择*来自员工，部门;</pre><p>简化的查询可能导致对象失效。但是，如果您按如下方式重写原始查询，则可以在保证模式或尽力模式下注册它：</p><pre class="oac_no_warn" dir="ltr">从员工，部门员工中选择员工.DEPARTMENT_ID = DEPARTMENTS.DEPARTMENT_ID和DEPARTMENTS.LOCATION_ID = 1700;</pre><p>只能在尽力而为模式下注册的查询在最佳工作模式下仅<a href="cqn.html#GUID-12872C24-0535-4EA9-B9DF-E2FE9FEC8908">可以为QRCN注册的查询</a>中描述。
                           </p>
                           <p>QRCN模式的默认值是保证模式。对于尽力而为模式， <code class="codeph">QOS_BEST_EFFORT</code>在<code class="codeph">CQ_NOTIFICATION$_REG_INFO</code>对象的<code class="codeph">QOSFLAGS</code>属性中指定<code class="codeph">QOS_BEST_EFFORT</code> 。
                           </p>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div>
            </div><a id="ADFNS551"></a><div class="props_rev_3"><a id="GUID-C678472B-392F-4ABD-A811-259DC2BC3271" name="GUID-C678472B-392F-4ABD-A811-259DC2BC3271"></a><h3 id="ADFNS-GUID-C678472B-392F-4ABD-A811-259DC2BC3271" class="sect3">生成通知的事件</h3>
               <div>
                  <p>这些事件会生成通知：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="cqn.html#GUID-2232C97C-60E4-4383-AE74-C6EF89983740">承诺的DML事务</a></p>
                     </li>
                     <li>
                        <p><a href="cqn.html#GUID-8B0C2F8C-FD79-4AC9-A1E4-8BCA8035FCA8">承诺的DDL声明</a></p>
                     </li>
                     <li>
                        <p><a href="cqn.html#GUID-E18D6FE8-1389-4774-AC98-175BE374CC5F">注销</a></p>
                     </li>
                     <li>
                        <p><a href="cqn.html#GUID-15D6BF5D-28B9-4E14-AF6B-A5311B8F034D">全球活动</a></p>
                     </li>
                  </ul>
               </div><a id="ADFNS552"></a><div class="props_rev_3"><a id="GUID-2232C97C-60E4-4383-AE74-C6EF89983740" name="GUID-2232C97C-60E4-4383-AE74-C6EF89983740"></a><h4 id="ADFNS-GUID-2232C97C-60E4-4383-AE74-C6EF89983740" class="sect4">承诺的DML事务</h4>
                  <div>
                     <p>当通知类型为OCN时，任何更改一个或多个已注册对象的DML事务在提交时为每个对象生成一个通知。</p>
                     <p>当通知类型是QRCN时，任何更改一个或多个已注册查询的结果的DML事务在提交时都会生成通知。通知包括结果已更改的查询的查询ID。</p>
                     <p>对于任一通知类型，通知包括：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>每个更改的表的名称</p>
                        </li>
                        <li>
                           <p>操作类型（ <code class="codeph">INSERT</code> ， <code class="codeph">UPDATE</code>或<code class="codeph">DELETE</code> ）</p>
                        </li>
                        <li>
                           <p><code class="codeph">ROWID</code>每个更改的行，如果登记与所创建的<code class="codeph">ROWID</code>选项和修改的行数不会太大。
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-2232C97C-60E4-4383-AE74-C6EF89983740__NOTE-125-CAD47A2E">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="cqn.html#GUID-52166555-C4AB-46F0-ABB6-6AD64093E19F">ROWID选项</a></p>
                     </div>
                  </div>
               </div><a id="ADFNS553"></a><div class="props_rev_3"><a id="GUID-8B0C2F8C-FD79-4AC9-A1E4-8BCA8035FCA8" name="GUID-8B0C2F8C-FD79-4AC9-A1E4-8BCA8035FCA8"></a><h4 id="ADFNS-GUID-8B0C2F8C-FD79-4AC9-A1E4-8BCA8035FCA8" class="sect4">承诺的DDL声明</h4>
                  <div>
                     <p>对于OCN和QRCN，这些数据定义语言（DDL）语句在提交时会生成通知：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">ALTER</code> <code class="codeph">TABLE</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">TRUNCATE</code> <code class="codeph">TABLE</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">FLASHBACK</code> <code class="codeph">TABLE</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">DROP</code> <code class="codeph">TABLE</code></p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-8B0C2F8C-FD79-4AC9-A1E4-8BCA8035FCA8__GUID-BD9595AB-2F8D-465F-9EA6-982B3A0A1745">
                        <p class="notep1">注意：</p>
                        <p>当通知类型为OCN时，已提交的<code class="codeph">DROP</code> <code class="codeph">TABLE</code>语句将生成<code class="codeph">DROP</code> <code class="codeph">NOTIFICATION</code> 。</p>
                        <p>对已删除表的任何OCN注册都将与该表（不再存在）取消关联，但注册本身仍然存在。如果这些注册中的任何一个与删除表以外的对象相关联，则对这些其他对象的已提交更改将继续生成通知。仅与已删除表关联的注册也将继续存在，并且其创建者可以向其添加查询（及其引用的对象）。</p>
                        <p>OCN注册基于查询注册时对象的版本和定义。如果删除了某个对象，则该对象上的注册将永远与其取消关联。如果创建的对象具有相同的名称，并且在与删除的对象相同的模式中，则创建的对象不会与与删除的对象关联的OCN注册关联。</p>
                     </div>
                     <p>当通知类型为QRCN时：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>通知包括：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>查询结果已更改的查询的ID</p>
                              </li>
                              <li>
                                 <p>修改表的名称</p>
                              </li>
                              <li>
                                 <p>DDL操作的类型</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>某些使注册查询无效的DDL操作可能会导致这些查询被取消注册。</p>
                           <p>例如，假设此查询是为QRCN注册的：</p><pre class="oac_no_warn" dir="ltr">SELECT COL1 FROM TEST_TABLE WHERE COL2 = 1;</pre><p>假设<code class="codeph">TEST_TABLE</code>具有此架构：</p><pre class="oac_no_warn" dir="ltr">（COL1 NUMBER，COL2 NUMBER，COL3 NUMBER）</pre><p>提交时，此DDL语句使查询无效并使其从注册中删除：</p><pre class="oac_no_warn" dir="ltr">ALTER TABLE DROP COLUMN COL2;</pre></li>
                     </ul>
                  </div>
               </div><a id="ADFNS554"></a><div class="props_rev_3"><a id="GUID-E18D6FE8-1389-4774-AC98-175BE374CC5F" name="GUID-E18D6FE8-1389-4774-AC98-175BE374CC5F"></a><h4 id="ADFNS-GUID-E18D6FE8-1389-4774-AC98-175BE374CC5F" class="sect4">注销</h4>
                  <div>
                     <p>对于OCN和QRCN，注销 - 从数据库中删除注册 - 生成通知。数据库删除注册的原因是：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>超时</p>
                           <p>如果在注册查询时使用非零值指定<code class="codeph">TIMEOUT</code> ，则数据库会在指定的时间间隔后清除注册。
                           </p>
                           <p>如果在注册查询时指定了<code class="codeph">QOS_DEREG_NFY</code> ，则数据库会在生成第一个通知后清除注册。
                           </p>
                        </li>
                        <li>
                           <p>失去特权</p>
                           <p>如果与已注册查询关联的对象上的权限丢失，并且通知类型为OCN，则数据库将清除注册。（当通知类型为QRCN时，数据库会从注册中删除该查询，但不会清除注册。）</p>
                        </li>
                     </ul>
                     <p>客户端应用程序执行显式注销时不会生成通知。</p>
                     <div class="infoboxnotealso" id="GUID-E18D6FE8-1389-4774-AC98-175BE374CC5F__NOTE-124-CAD4A718">
                        <p class="notep1">也可以看看：</p><a href="cqn.html#GUID-63C99D7D-0C28-4925-8F5C-93D0202DB3F1">创建CQN注册的先决条件，</a>以获取注册查询所需的权限</div>
                  </div>
               </div><a id="ADFNS555"></a><div class="props_rev_3"><a id="GUID-15D6BF5D-28B9-4E14-AF6B-A5311B8F034D" name="GUID-15D6BF5D-28B9-4E14-AF6B-A5311B8F034D"></a><h4 id="ADFNS-GUID-15D6BF5D-28B9-4E14-AF6B-A5311B8F034D" class="sect4">全球活动</h4>
                  <div>
                     <p>全局事件<code class="codeph">EVENT_STARTUP</code>和<code class="codeph">EVENT_SHUTDOWN</code>生成通知。
                     </p>
                     <p>在Oracle RAC环境中，这些事件会生成通知：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>第一个数据库实例启动时的<code class="codeph">EVENT_STARTUP</code></p>
                        </li>
                        <li>
                           <p>当数据库的最后一个实例关闭时<code class="codeph">EVENT_SHUTDOWN</code></p>
                        </li>
                        <li>
                           <p>当数据库的任何实例关闭时， <code class="codeph">EVENT_SHUTDOWN_ANY</code></p>
                        </li>
                     </ul>
                     <p>前面的全局事件是<code class="codeph">DBMS_CQ_NOTIFICATION</code>包中定义的<code class="codeph">DBMS_CQ_NOTIFICATION</code> 。
                     </p>
                     <div class="infoboxnotealso" id="GUID-15D6BF5D-28B9-4E14-AF6B-A5311B8F034D__GUID-85F2A03D-EB01-4CED-805E-4514B35E8584">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<code class="codeph">DBMS_CQ_NOTIFICATION</code>包的更多信息，请<code class="codeph">DBMS_CQ_NOTIFICATION</code> <a href="../arpls/DBMS_CQ_NOTIFICATION.html#ARPLS201" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a></p>
                     </div>
                  </div>
               </div>
            </div><a id="ADFNS556"></a><div class="props_rev_3"><a id="GUID-B65C2FEA-1A2C-4C47-9E93-4697442F4529" name="GUID-B65C2FEA-1A2C-4C47-9E93-4697442F4529"></a><h3 id="ADFNS-GUID-B65C2FEA-1A2C-4C47-9E93-4697442F4529" class="sect3">通知内容</h3>
               <div>
                  <p>通知包含部分或全部此信息：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>事件类型，它是以下之一：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>启动</p>
                           </li>
                           <li>
                              <p>对象更改</p>
                           </li>
                           <li>
                              <p>查询结果更改</p>
                           </li>
                           <li>
                              <p>注销</p>
                           </li>
                           <li>
                              <p>关掉</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>受影响注册的注册ID</p>
                     </li>
                     <li>
                        <p>已更改对象的名称</p>
                     </li>
                     <li>
                        <p>如果指定了<code class="codeph">ROWID</code>选项， <code class="codeph">ROWID</code>改行的<code class="codeph">ROWID</code></p>
                     </li>
                     <li>
                        <p>如果通知类型是QRCN：查询结果已更改的查询的ID</p>
                     </li>
                     <li>
                        <p>如果通知是由DML或DDL声明引起的：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>修改表的名称数组</p>
                           </li>
                           <li>
                              <p>操作类型（例如， <code class="codeph">INSERT</code>或<code class="codeph">UPDATE</code> ）</p>
                           </li>
                        </ul>
                     </li>
                  </ul>
                  <p>通知不包含已更改的数据本身。例如，通知并未说明月薪从5000增加到6000。要获取更改的对象或行或查询结果的更新值，应用程序必须查询数据库。</p>
               </div>
            </div><a id="ADFNS557"></a><a id="ADFNS558"></a><a id="ADFNS1015"></a><div class="props_rev_3"><a id="GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778" name="GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778"></a><h3 id="ADFNS-GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778" class="sect3">CQN的优秀候选人</h3>
               <div>
                  <p>CQN的良好候选者是将查询结果集缓存在中间层中不频繁更改的对象上的应用程序，以避免网络往返数据库。这些应用程序可以使用CQN来注册要缓存的查询。当这样的应用程序收到通知时，它可以通过重新运行已注册的查询来刷新其缓存。</p>
                  <p>这种应用程序的一个例子是网络论坛。由于其用户无需在插入数据库后立即查看内容，因此该应用程序可以在中间层缓存信息，并让CQN在何时刷新缓存时告诉它。</p>
                  <p><a href="cqn.html#GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778__BGBIFFAE">图18-1</a>说明了典型情况，其中数据库提供在中间层缓存然后通过Internet访问的数据。
                  </p>
                  <div class="figure" id="GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778__BGBIFFAE">
                     <p class="titleinfigure">图18-1中间层缓存</p><img width="401" src="img/adfns022.gif" alt="下面是图18-1的描述" title="下面是图18-1的描述" longdesc="img_text/adfns022.html"><br><a href="img_text/adfns022.html">“图18-1中间层缓存”的说明</a></div>
                  <!-- class="figure" -->
                  <p>中间层中的应用程序需要快速访问数据库对象的缓存副本，同时使缓存尽可能与数据库相关联。当事务修改数据并提交时，缓存的数据就会过时，从而使应用程序面临访问错误结果的风险。如果应用程序使用CQN，则数据库可以在已注册对象发生更改时发布通知，并提供有关更改内容的详细信息。响应该通知，应用程序可以通过从后端数据库中获取缓存数据来刷新缓存数据。</p>
                  <p><a href="cqn.html#GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778__CHECFHCH">图18-2</a>说明了中间层Web客户端接收和处理通知的过程。
                  </p>
                  <div class="figure" id="GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778__CHECFHCH">
                     <p class="titleinfigure">图18-2连续查询通知（CQN）的基本流程</p><img width="401" src="img/adfns104.gif" alt="下面是图18-2的描述" title="下面是图18-2的描述" longdesc="img_text/adfns104.html"><br><a href="img_text/adfns104.html">“图18-2连续查询通知（CQN）的基本过程”的描述</a></div>
                  <!-- class="figure" -->
                  <p><a href="cqn.html#GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778__CHECFHCH">图18-2中</a>的步骤说明（如果使用PL / SQL创建注册，并且应用程序已在<code class="codeph">HR</code>上缓存了查询的结果集<code class="codeph">EMPLOYEES</code> ）：</p>
                  <ol>
                     <li>
                        <p>开发人员使用PL / SQL为查询创建CQN注册，其中包括创建存储的PL / SQL过程以处理通知，然后使用PL / SQL CQN接口为查询创建注册，指定PL / SQL过程作为通知处理程序。</p>
                     </li>
                     <li>
                        <p>数据库填充数据字典中的注册信息。</p>
                     </li>
                     <li>
                        <p>用户更新<code class="codeph">HR</code>的行。后端数据库中的<code class="codeph">EMPLOYEES</code>表并提交更新，从而导致查询结果发生更改。<code class="codeph">HR</code>的数据。缓存在中间层的<code class="codeph">EMPLOYEES</code>现在已经过时了。
                        </p>
                     </li>
                     <li>
                        <p>数据库添加一条消息，描述对内部队列的更改。</p>
                     </li>
                     <li>
                        <p>数据库通知<code class="codeph">JOBQ</code>后台进程通知消息。
                        </p>
                     </li>
                     <li id="GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778__CHDCABFC">
                        <p><code class="codeph">JOBQ</code>进程运行客户端应用程序指定的存储过程。在此示例中， <code class="codeph">JOBQ</code>将数据传递到服务器端PL / SQL过程。PL / SQL通知处理程序的实现确定如何处理通知。
                        </p>
                     </li>
                     <li>
                        <p>在服务器端PL / SQL过程中，开发人员可以实现逻辑以通知中间层客户端应用程序对已注册对象的更改。例如，它通知应用程序<code class="codeph">HR</code>中已更改行的<code class="codeph">ROWID</code> 。 <code class="codeph">EMPLOYEES</code> 。</p>
                     </li>
                     <li>
                        <p>中间层中的客户端应用程序查询后端数据库以检索已更改行中的数据。</p>
                     </li>
                     <li>
                        <p>客户端应用程序使用数据更新缓存。</p>
                     </li>
                  </ol>
               </div>
            </div><a id="ADFNS1016"></a><div class="props_rev_3"><a id="GUID-9F2A38D3-1E9B-484C-8793-6D6CA554044A" name="GUID-9F2A38D3-1E9B-484C-8793-6D6CA554044A"></a><h3 id="ADFNS-GUID-9F2A38D3-1E9B-484C-8793-6D6CA554044A" class="sect3">创建CQN注册</h3>
               <div>
                  <div class="section">
                     <p><span class="bold">CQN注册</span>将一个或多个查询的列表与通知类型和通知处理程序相关联。
                     </p>
                     <p>通知类型是OCN或QRCN。</p>
                     <p>要创建CQN注册，您可以使用以下两个接口之一：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>PL / SQL接口</p>
                           <p>如果使用PL / SQL接口，则通知处理程序是服务器端PL / SQL存储过程。</p>
                        </li>
                        <li>
                           <p>Oracle调用接口（OCI）</p>
                           <p>如果使用OCI，则通知处理程序是客户端C回调过程。</p>
                        </li>
                     </ul>
                     <p>创建后，注册将存储在数据库中。在Oracle RAC环境中，所有数据库实例都可以看到它。更改查询的事务会导致任何数据库实例生成通知。</p>
                     <p>默认情况下，注册会一直存在，直到创建它的应用程序显式取消注册它，或者直到数据库隐式清除它（例如，丢失权限）。</p>
                     <div class="infoboxnotealso" id="GUID-9F2A38D3-1E9B-484C-8793-6D6CA554044A__NOTE-1325-CAD4E28C">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="cqn.html#GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4">关于对象更改通知（OCN）</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9" title="某些类型的查询如此简化，以至于在对象级别生成失效;也就是说，只要这些查询中引用的任何对象发生更改。此类查询的示例是使用不受支持的列类型或包含子查询的查询。此问题的解决方案是重写原始查询。">关于查询结果更改通知（QRCN）</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-01E3E0A3-81AB-4EEE-8E26-4F3F2FE1D60E">使用PL / SQL创建CQN注册</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-0D38B15C-F5CD-44C9-B073-39DA78350D28">使用OCI创建CQN注册</a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="ADFNS543"></a><a id="ADFNS542"></a><div class="props_rev_3"><a id="GUID-01E3E0A3-81AB-4EEE-8E26-4F3F2FE1D60E" name="GUID-01E3E0A3-81AB-4EEE-8E26-4F3F2FE1D60E"></a><h3 id="ADFNS-GUID-01E3E0A3-81AB-4EEE-8E26-4F3F2FE1D60E" class="sect3">使用PL / SQL创建CQN注册</h3>
               <div>
                  <div class="section">
                     <p>本节介绍如何使用PL / SQL创建CQN注册。使用PL / SQL接口时，通知处理程序是服务器端PL / SQL存储过程。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-01E3E0A3-81AB-4EEE-8E26-4F3F2FE1D60E__GUID-B4B2E2DB-FB5E-4C43-A602-6075495C126C">话题：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="cqn.html#GUID-2F2BA54E-5EA9-41C3-BA67-87D709BE6343">PL / SQL CQN注册接口</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE">CQN注册选项</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-63C99D7D-0C28-4925-8F5C-93D0202DB3F1">创建CQN注册的先决条件</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-2D04655A-3C16-4878-9F07-26311FD3149D">可以为对象更改通知（OCN）注册的查询</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-B96D4FE6-465D-4400-89B1-7E8DBCD5829C">可以为查询结果更改通知（QRCN）注册的查询</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-52D0C42D-EA7E-4282-A14B-BA42E11D9A6D">使用PL / SQL为CQN注册查询</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-069991BE-E98B-4733-BEB7-D4AE96D0DB87">CQN注册的最佳实践</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-FC45C32A-D57E-4925-A88B-97FAE4AD528D">CQN注册故障排除</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-ABAB71A2-F950-4F0A-B413-FD2D67F335DF">删除注册</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-2D194274-3C78-42F3-959C-10B9F30B2F07">配置CQN：场景</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS559"></a><div class="props_rev_3"><a id="GUID-2F2BA54E-5EA9-41C3-BA67-87D709BE6343" name="GUID-2F2BA54E-5EA9-41C3-BA67-87D709BE6343"></a><h4 id="ADFNS-GUID-2F2BA54E-5EA9-41C3-BA67-87D709BE6343" class="sect4">PL / SQL CQN注册接口</h4>
                  <div>
                     <p>PL / SQL CQN注册接口使用<code class="codeph">DBMS_CQ_NOTIFICATION</code>包实现。您使用<code class="codeph">DBMS_CQ_NOTIFICATION</code> 。 <code class="codeph">NEW_REG_START</code>函数用于打开注册块。您可以将注册详细信息（包括通知类型和通知处理程序）指定为<code class="codeph">CQ_NOTIFICATION$_REG_INFO</code>对象的一部分，该对象作为参数传递给<code class="codeph">NEW_REG_START</code>过程。注册块打开时运行的每个查询都在CQN中注册。如果您指定了通知类型QRCN，则数据库会为每个查询分配查询ID。您可以使用<code class="codeph">DBMS_CQ_NOTIFICATION</code>检索这些查询ID。 <code class="codeph">CQ_NOTIFICATION_QUERYID</code>函数。要关闭注册块，请使用<code class="codeph">DBMS_CQ_NOTIFICATION</code> 。 <code class="codeph">REG_END</code>功能。
                     </p>
                     <div class="infoboxnotealso" id="GUID-2F2BA54E-5EA9-41C3-BA67-87D709BE6343__GUID-423A67C4-798D-45FE-99D6-3DC7EC42DD7F">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关<code class="codeph">DBMS_CQ_NOTIFICATION</code>包的更多信息，请<code class="codeph">DBMS_CQ_NOTIFICATION</code> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ARPLS201" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-52D0C42D-EA7E-4282-A14B-BA42E11D9A6D">使用PL / SQL为CQN注册查询</a> 
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="ADFNS561"></a><a id="ADFNS1063"></a><a id="ADFNS560"></a><div class="props_rev_3"><a id="GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE" name="GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE"></a><h4 id="ADFNS-GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE" class="sect4">CQN注册选项</h4>
                  <div>
                     <p>您可以使用<a href="cqn.html#GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE__g1826201" title="此表汇总了数据库更改通知注册选项。">表18-1中</a>汇总的选项更改CQN注册默认值。
                     </p>
                     <div class="tblformal" id="GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE__g1826201">
                        <p class="titleintable">表18-1连续查询通知注册选项</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="连续查询通知注册选项" width="100%" border="1" summary="This table summarizes the Database Change Notification registration options." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="28%" id="d102353e2667">选项</th>
                                 <th align="left" valign="bottom" width="72%" id="d102353e2670">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d102353e2675" headers="d102353e2667 ">
                                    <p>通知类型</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d102353e2675 d102353e2670 ">
                                    <p>指定QRCN（默认为OCN）。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d102353e2682" headers="d102353e2667 ">
                                    <p>QRCN模式<a id="fn_1" name="fn_1" href="#fn_1" type="" applies="" only="" when="" notification="" is="" qrcn=")" ="" onclick="footdisplay(1, "><sup>脚1</sup></a></p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d102353e2682 d102353e2670 ">
                                    <p>指定尽力模式（默认为保证模式）。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d102353e2692" headers="d102353e2667 ">
                                    <p><code class="codeph">ROWID</code></p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d102353e2692 d102353e2670 ">
                                    <p>包含通知中每个已更改行的<code class="codeph">ROWID</code>伪列的值。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d102353e2703" headers="d102353e2667 ">
                                    <p>操作过滤器<a id="GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE__CHDGJDDD" name="GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE__CHDGJDDD" href="#GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE__CHDGJDDD" type="" applies="" only="" when="" notification="" is="" ocn=")" ="" onclick="footdisplay(2, "><sup>脚2</sup></a></p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d102353e2703 d102353e2670 ">
                                    <p>仅在操作类型与指定的过滤条件匹配时才发布通知。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d102353e2713" headers="d102353e2667 ">
                                    <p>交易延迟<a id="fnsrc_d102353e2716" name="fnsrc_d102353e2716" href="#fnsrc_d102353e2716" type="" applies="" only="" when="" notification="" is="" ocn=")" ="" onclick="footdisplay(2, "><sup>Footref 2</sup></a></p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d102353e2713 d102353e2670 ">
                                    <p>已过时。请改用通知分组。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d102353e2722" headers="d102353e2667 ">
                                    <p>通知分组</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d102353e2722 d102353e2670 ">
                                    <p>指定通知的分组方式。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d102353e2729" headers="d102353e2667 ">
                                    <p>可靠</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d102353e2729 d102353e2670 ">
                                    <p>在持久数据库队列中存储通知（而不是在共享内存中，默认值）。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d102353e2736" headers="d102353e2667 ">
                                    <p>清除通知</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d102353e2736 d102353e2670 ">
                                    <p>在第一次通知后清除注册。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d102353e2743" headers="d102353e2667 ">
                                    <p>超时</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d102353e2743 d102353e2670 ">
                                    <p>在指定的时间间隔后清除注册。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p class="tablefootnote"><sup class="tablefootnote">脚注1</sup></p><p>仅在通知类型为QRCN时适用。</p>
                     <p></p>
                     <p class="tablefootnote"><sup class="tablefootnote">脚注2</sup></p><p>仅在通知类型为OCN时适用。</p>
                     <p></p>
                     <div class="section">
                        <p class="subhead3" id="GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE__GUID-746DB27B-7B07-4DB5-A593-3A37EA2A7DD1">话题：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="cqn.html#GUID-CAEE5FDA-BE64-4449-9DAE-97AB89DE45E7">通知类型选项</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-2CF1B8D6-75CE-4510-8B7A-4BFA43476B37">QRCN模式（仅限QRCN通知类型）</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-52166555-C4AB-46F0-ABB6-6AD64093E19F">ROWID选项</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-8349364C-1340-4B13-B8BB-F23FC1152DED">操作筛选选项（仅限OCN通知类型）</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-1B25459B-ED98-44B0-8F73-872E1CB84641">交易滞后期权（仅限OCN通知类型）</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-6E9DCC6A-BFD7-40D6-B5C0-8BF9311259E8">通知分组选项</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-B920D116-298A-4024-84DC-B6B594E7F371">可靠的选择</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-52255F89-1799-48DA-881B-C7797BA548BF">清除通知和超时选项</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS562"></a><div class="props_rev_3"><a id="GUID-CAEE5FDA-BE64-4449-9DAE-97AB89DE45E7" name="GUID-CAEE5FDA-BE64-4449-9DAE-97AB89DE45E7"></a><h5 id="ADFNS-GUID-CAEE5FDA-BE64-4449-9DAE-97AB89DE45E7" class="sect5">通知类型选项</h5>
                     <div>
                        <p>通知类型是OCN和QRCN。</p>
                        <div class="infoboxnotealso" id="GUID-CAEE5FDA-BE64-4449-9DAE-97AB89DE45E7__GUID-46C323C4-90AB-4604-86C3-39CD633895DE">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="cqn.html#GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4">关于对象更改通知（OCN）</a></p>
                              </li>
                              <li>
                                 <p><a href="cqn.html#GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9" title="某些类型的查询如此简化，以至于在对象级别生成失效;也就是说，只要这些查询中引用的任何对象发生更改。此类查询的示例是使用不受支持的列类型或包含子查询的查询。此问题的解决方案是重写原始查询。">关于查询结果更改通知（QRCN）</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="ADFNS563"></a><div class="props_rev_3"><a id="GUID-2CF1B8D6-75CE-4510-8B7A-4BFA43476B37" name="GUID-2CF1B8D6-75CE-4510-8B7A-4BFA43476B37"></a><h5 id="ADFNS-GUID-2CF1B8D6-75CE-4510-8B7A-4BFA43476B37" class="sect5">QRCN模式（仅限QRCN通知类型）</h5>
                     <div>
                        <p>仅当通知类型为QRCN时，QRCN模式选项才适用。将通知类型设置为QRCN的说明在<a href="cqn.html#GUID-CAEE5FDA-BE64-4449-9DAE-97AB89DE45E7">通知类型选项中</a> 。
                        </p>
                        <div class="p">QRCN模式是：<ul style="list-style-type:disc">
                              <li>
                                 <p>保证</p>
                              </li>
                              <li>
                                 <p>最大的努力</p>
                              </li>
                           </ul> 
                        </div>
                        <p>默认为保证模式。对于尽力而为模式， <code class="codeph">QOS_BEST_EFFORT</code>在<code class="codeph">CQ_NOTIFICATION$_REG_INFO</code>对象的<code class="codeph">QOSFLAGS</code>属性中指定<code class="codeph">QOS_BEST_EFFORT</code> 。
                        </p>
                        <div class="infoboxnotealso" id="GUID-2CF1B8D6-75CE-4510-8B7A-4BFA43476B37__NOTE-124-CAD5B93A">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="cqn.html#GUID-4A320315-AF7F-4D60-BB63-AD9731D3640D">保证模式</a></p>
                              </li>
                              <li>
                                 <p><a href="cqn.html#GUID-0766B418-4023-4BB7-8887-25AE98CBD351" title="某些类型的查询如此简化，以至于在对象级别生成失效;也就是说，只要这些查询中引用的任何对象发生更改。此类查询的示例是使用不受支持的列类型或包含子查询的查询。此问题的解决方案是重写原始查询。">尽力而为模式</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="ADFNS564"></a><div class="props_rev_3"><a id="GUID-52166555-C4AB-46F0-ABB6-6AD64093E19F" name="GUID-52166555-C4AB-46F0-ABB6-6AD64093E19F"></a><h5 id="ADFNS-GUID-52166555-C4AB-46F0-ABB6-6AD64093E19F" class="sect5">ROWID选项</h5>
                     <div>
                        <p><code class="codeph">ROWID</code>选项包括通知中每个已更改行的<code class="codeph">ROWID</code>伪列（行的rowid）的值。要在通知中包含每个已更改行的<code class="codeph">ROWID</code>选项，请在<code class="codeph">CQ_NOTIFICATION$_REG_INFO</code>对象的<code class="codeph">QOSFLAGS</code>属性中指定<code class="codeph">QOS_ROWIDS</code> 。
                        </p>
                        <div class="infoboxnote" id="GUID-52166555-C4AB-46F0-ABB6-6AD64093E19F__GUID-B54ACFC2-BCBD-4980-B1B3-8C4D59E70F1F">
                           <p class="notep1">注意：</p>
                           <p>更新使用混合列压缩（HCC）压缩的表中的行时，行的<code class="codeph">ROWID</code>会更改。<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=CNCPT89198" target="_blank"><span class="italic">Oracle数据库概念中</span></a>描述了HCC，某些Oracle存储系统的一个特性。
                           </p>
                        </div>
                        <p>从通知中的<code class="codeph">ROWID</code>信息，应用程序可以通过执行以下表单的查询来检索已更改行的内容：</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM <span class="italic">table_name_from_notification</span> WHERE ROWID = <span class="italic">rowid_from_notification</span> ;</pre><p><code class="codeph">ROWID</code>以外部字符串格式发布。对于常规堆表， <code class="codeph">ROWID</code>的长度为18个字符字节。对于索引组织表（IOT）， <code class="codeph">ROWID</code>的长度取决于主键的大小，并且可能超过18个字节。
                        </p>
                        <p>如果服务器没有足够的内存用于<code class="codeph">ROWID</code> ，则通知可能会“卷起”为<code class="codeph">FULL-TABLE-NOTIFICATION</code> ，由通知描述符中的特殊标志指示。<code class="codeph">FULL-TABLE-NOTIFICATION</code>可能原因是：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">ROWID</code>的总共享内存消耗超过动态共享池大小的1％。
                              </p>
                           </li>
                           <li>
                              <p>在事务中的单个注册对象中更改了太多行（上限大约为80）。</p>
                           </li>
                           <li>
                              <p>IOT的修改行的逻辑<code class="codeph">ROWID</code>的总长度太大（上限大约为1800字节）。
                              </p>
                           </li>
                           <li>
                              <p>您指定的通知分组选项<code class="codeph">NTFN_GROUPING_TYPE</code>与价值<code class="codeph">DBMS_CQ_NOTIFICATION</code> 。 <code class="codeph">NTFN_GROUPING_TYPE_SUMMARY</code> ，在<a href="cqn.html#GUID-6E9DCC6A-BFD7-40D6-B5C0-8BF9311259E8">通知分组选项中</a>描述。
                              </p>
                           </li>
                        </ul>
                        <p>由于<code class="codeph">FULL-TABLE-NOTIFICATION</code>不包含<code class="codeph">ROWID</code> ，因此接收它的应用程序必须假定整个表（即所有行）可能已更改。
                        </p>
                     </div>
                  </div><a id="ADFNS565"></a><div class="props_rev_3"><a id="GUID-8349364C-1340-4B13-B8BB-F23FC1152DED" name="GUID-8349364C-1340-4B13-B8BB-F23FC1152DED"></a><h5 id="ADFNS-GUID-8349364C-1340-4B13-B8BB-F23FC1152DED" class="sect5">操作筛选选项（仅限OCN通知类型）</h5>
                     <div>
                        <p>仅当通知类型为OCN时，“操作筛选器”选项才适用。</p>
                        <p>“操作筛选器”选项使您可以指定生成通知的操作类型。</p>
                        <p>默认为所有操作。要指定仅某些操作生成通知，请使用<code class="codeph">CQ_NOTIFICATION$_REG_INFO</code>对象的<code class="codeph">OPERATIONS_FILTER</code>属性。使用<code class="codeph">OPERATIONS_FILTER</code>属性，使用表示它的常量指定<code class="codeph">OPERATIONS_FILTER</code>类型，该常量在<code class="codeph">DBMS_CQ_NOTIFICATION</code>包中定义，如下所示：</p>
                        <div class="tblformal" id="GUID-8349364C-1340-4B13-B8BB-F23FC1152DED__GUID-66600CE8-AEF6-409D-BBBA-4FD9EE029A1A">
                           <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="This table summarizes the operations that can generate change notifications and the constants that represent them in the DBMS_CQ_NOTIFICATIONS package." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="18%" id="d102353e3372">手术</th>
                                    <th align="left" valign="bottom" width="82%" id="d102353e3375">不变</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="18%" id="d102353e3380" headers="d102353e3372 ">
                                       <p><code class="codeph">插入</code></p>
                                    </td>
                                    <td align="left" valign="top" width="82%" headers="d102353e3380 d102353e3375 ">
                                       <p><code class="codeph">DBMS_CQ_NOTIFICATION.INSERTOP</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="18%" id="d102353e3389" headers="d102353e3372 ">
                                       <p><code class="codeph">UPDATE</code></p>
                                    </td>
                                    <td align="left" valign="top" width="82%" headers="d102353e3389 d102353e3375 ">
                                       <p><code class="codeph">DBMS_CQ_NOTIFICATION.UPDATEOP</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="18%" id="d102353e3398" headers="d102353e3372 ">
                                       <p><code class="codeph">删除</code></p>
                                    </td>
                                    <td align="left" valign="top" width="82%" headers="d102353e3398 d102353e3375 ">
                                       <p><code class="codeph">DBMS_CQ_NOTIFICATION.DELETEOP</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="18%" id="d102353e3407" headers="d102353e3372 ">
                                       <p><code class="codeph">ALTEROP</code></p>
                                    </td>
                                    <td align="left" valign="top" width="82%" headers="d102353e3407 d102353e3375 ">
                                       <p><code class="codeph">DBMS_CQ_NOTIFICATION.ALTEROP</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="18%" id="d102353e3416" headers="d102353e3372 ">
                                       <p><code class="codeph">DROPOP</code></p>
                                    </td>
                                    <td align="left" valign="top" width="82%" headers="d102353e3416 d102353e3375 ">
                                       <p><code class="codeph">DBMS_CQ_NOTIFICATION.DROPOP</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="18%" id="d102353e3425" headers="d102353e3372 ">
                                       <p><code class="codeph">UNKNOWNOP</code></p>
                                    </td>
                                    <td align="left" valign="top" width="82%" headers="d102353e3425 d102353e3375 ">
                                       <p><code class="codeph">DBMS_CQ_NOTIFICATION.UNKNOWNOP</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="18%" id="d102353e3434" headers="d102353e3372 ">
                                       <p>全部（默认）</p>
                                    </td>
                                    <td align="left" valign="top" width="82%" headers="d102353e3434 d102353e3375 ">
                                       <p><code class="codeph">DBMS_CQ_NOTIFICATION.ALL_OPERATIONS</code></p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>要指定多个操作，请使用按位<code class="codeph">OR</code> 。例如：</p><pre class="oac_no_warn" dir="ltr">DBMS_CQ_NOTIFICATION.INSERTOP + DBMS_CQ_NOTIFICATION.DELETEOP</pre><p><code class="codeph">OPERATIONS_FILTER</code>有如果还指定了没有效果<code class="codeph">QOS_QUERY</code>在<code class="codeph">QOSFLAGS</code>属性，因为<code class="codeph">QOS_QUERY</code>指定通知类型QRCN。</p>
                        <div class="infoboxnotealso" id="GUID-8349364C-1340-4B13-B8BB-F23FC1152DED__GUID-A5ACC36D-49B4-40BF-81C4-7CFFE4C6E720">
                           <p class="notep1">也可以看看：</p>
                           <p>有关<code class="codeph">DBMS_CQ_NOTIFICATION</code>包的更多信息，请<code class="codeph">DBMS_CQ_NOTIFICATION</code> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ARPLS201" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a></p>
                        </div>
                     </div>
                  </div><a id="ADFNS566"></a><div class="props_rev_3"><a id="GUID-1B25459B-ED98-44B0-8F73-872E1CB84641" name="GUID-1B25459B-ED98-44B0-8F73-872E1CB84641"></a><h5 id="ADFNS-GUID-1B25459B-ED98-44B0-8F73-872E1CB84641" class="sect5">交易滞后期权（仅限OCN通知类型）</h5>
                     <div>
                        <p>“交易延迟”选项仅在通知类型为OCN时适用。</p>
                        <div class="infoboxnote" id="GUID-1B25459B-ED98-44B0-8F73-872E1CB84641__GUID-D2BF19B0-F72E-4A93-A40F-0781C79E6A8E">
                           <p class="notep1">注意：</p>
                           <p>不推荐使用此选项。要实施控制流通知，请使用<a href="cqn.html#GUID-6E9DCC6A-BFD7-40D6-B5C0-8BF9311259E8">通知分组选项</a> 。
                           </p>
                        </div>
                        <p>“事务延迟”选项指定客户端应用程序可以滞后于数据库的事务数。如果该数字为0，则更改已注册对象的每个事务都会生成通知。如果该数字为5，则更改已注册对象的每五个事务都会生成一个通知。数据库跟踪对象粒度的干预变化，并将它们包含在通知中，以便客户端不会丢失它们。</p>
                        <p>仅当应用程序实现控制流通知时，事务滞后大于0才有用。确保应用程序频繁生成通知以满足滞后，以便它们不会无限期延迟。</p>
                        <p>如果指定<code class="codeph">TRANSACTION_LAG</code> ，则即使您还指定了<code class="codeph">QOS_ROWIDS</code> ，通知也不包括<code class="codeph">ROWID</code> 。</p>
                     </div>
                  </div><a id="ADFNS567"></a><div class="props_rev_3"><a id="GUID-6E9DCC6A-BFD7-40D6-B5C0-8BF9311259E8" name="GUID-6E9DCC6A-BFD7-40D6-B5C0-8BF9311259E8"></a><h5 id="ADFNS-GUID-6E9DCC6A-BFD7-40D6-B5C0-8BF9311259E8" class="sect5">通知分组选项</h5>
                     <div>
                        <p>默认情况下，会在导致通知的事件之后立即生成通知。</p>
                        <p>通知分组选项是<code class="codeph">CQ_NOTIFICATION$_REG_INFO</code>对象的属性，它们是：</p>
                        <div class="tblformal" id="GUID-6E9DCC6A-BFD7-40D6-B5C0-8BF9311259E8__GUID-C99F62EC-AB2B-46F6-A356-EB9B933B6F4A">
                           <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="This table summarizes the notification grouping options." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="40%" id="d102353e3701">属性</th>
                                    <th align="left" valign="bottom" width="60%" id="d102353e3704">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="40%" id="d102353e3709" headers="d102353e3701 ">
                                       <p><code class="codeph">NTFN_GROUPING_CLASS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d102353e3709 d102353e3704 ">
                                       <p>指定用于对通知进行分组的类。唯一允许的值是<code class="codeph">DBMS_CQ_NOTIFICATION</code> 。 <code class="codeph">NTFN_GROUPING_CLASS_TIME</code> ，按时间对通知进行分组，为零，这是默认值（通知在导致它们的事件之后立即生成）。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="40%" id="d102353e3723" headers="d102353e3701 ">
                                       <p><code class="codeph">NTFN_GROUPING_VALUE</code></p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d102353e3723 d102353e3704 ">
                                       <p>指定定义组的时间间隔（以秒为单位）。例如，如果此值为900，则会在相同的15分钟间隔中生成的通知进行分组。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="40%" id="d102353e3731" headers="d102353e3701 ">
                                       <p><code class="codeph">NTFN_GROUPING_TYPE</code></p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d102353e3731 d102353e3704 ">
                                       <p>指定分组的类型，其中包括：</p>
                                       <ul style="list-style-type:disc">
                                          <li>
                                             <p><code class="codeph">DBMS_CQ_NOTIFICATION</code> 。 <code class="codeph">NTFN_GROUPING_TYPE_SUMMARY</code> ：组中的所有通知都汇总到一个通知中。
                                             </p>
                                             <p><span class="bold">注意：</span>即使您指定了<code class="codeph">ROWID</code>选项，单个通知也不包括<code class="codeph">ROWID</code> 。
                                             </p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">DBMS_CQ_NOTIFICATION</code> 。 <code class="codeph">NTFN_GROUPING_TYPE_LAST</code> ：仅发布组中的最后一个通知，并丢弃先前的通知。
                                             </p>
                                          </li>
                                       </ul>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="40%" id="d102353e3766" headers="d102353e3701 ">
                                       <p><code class="codeph">NTFN_GROUPING_START_TIME</code></p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d102353e3766 d102353e3704 ">
                                       <p>指定何时开始生成通知。如果指定为<code class="codeph">NULL</code> ，则默认为当前系统生成的时间。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="40%" id="d102353e3777" headers="d102353e3701 ">
                                       <p><code class="codeph">NTFN_GROUPING_REPEAT_COUNT</code></p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d102353e3777 d102353e3704 ">
                                       <p>指定重复通知的次数。设置为<code class="codeph">DBMS_CQ_NOTIFICATION</code> 。 <code class="codeph">NTFN_GROUPING_FOREVER</code>接收注册生命周期的通知。要在注册期限内最多收到<span class="italic">n个</span>通知，请设置为<span class="italic">n</span> 。
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <div class="infoboxnote" id="GUID-6E9DCC6A-BFD7-40D6-B5C0-8BF9311259E8__GUID-FBC1F868-C660-4916-B436-16126CBD1EFA">
                           <p class="notep1">注意：</p>
                           <p>超时，权限丢失和全局事件生成的通知可能会在指定的分组间隔到期之前发布。如果是，则任何待处理的分组通知也会在间隔到期之前发布。</p>
                        </div>
                     </div>
                  </div><a id="ADFNS568"></a><div class="props_rev_3"><a id="GUID-B920D116-298A-4024-84DC-B6B594E7F371" name="GUID-B920D116-298A-4024-84DC-B6B594E7F371"></a><h5 id="ADFNS-GUID-B920D116-298A-4024-84DC-B6B594E7F371" class="sect5">可靠的选择</h5>
                     <div>
                        <p>默认情况下，CQN注册存储在共享内存中。将其存储在一个持久数据库队列代替，也就是说，生成<span class="bold">可靠的通知</span> -指定<code class="codeph">QOS_RELIABLE</code>在<code class="codeph">QOSFLAGS</code>的属性<code class="codeph">CQ_NOTIFICATION$_REG_INFO</code>对象。
                        </p>
                        <p>可靠通知的优点是，如果数据库在生成后失败，它仍然可以在重新启动后提供它们。在Oracle RAC环境中，幸存的数据库实例可以提供它们。</p>
                        <p>可靠通知的缺点是它们比默认通知具有更高的CPU和I / O成本。</p>
                     </div>
                  </div><a id="ADFNS569"></a><div class="props_rev_3"><a id="GUID-52255F89-1799-48DA-881B-C7797BA548BF" name="GUID-52255F89-1799-48DA-881B-C7797BA548BF"></a><h5 id="ADFNS-GUID-52255F89-1799-48DA-881B-C7797BA548BF" class="sect5">清除通知和超时选项</h5>
                     <div>
                        <p>默认情况下，CQN注册会一直存在，直到创建它的应用程序显式取消注册它，或者直到数据库隐式清除它（例如，丢失权限）。</p>
                        <p>要在生成第一个通知后清除注册，请在<code class="codeph">CQ_NOTIFICATION$_REG_INFO</code>对象的<code class="codeph">QOSFLAGS</code>属性中指定<code class="codeph">QOS_DEREG_NFY</code> 。
                        </p>
                        <p>要在<span class="italic">n</span>秒后清除注册，请在<code class="codeph">CQ_NOTIFICATION$_REG_INFO</code>对象的<code class="codeph">TIMEOUT</code>属性中指定<span class="italic">n</span> 。
                        </p>
                        <p>您可以一起使用Purge-on-Notify和Timeout选项。</p>
                     </div>
                  </div>
               </div><a id="ADFNS570"></a><div class="props_rev_3"><a id="GUID-63C99D7D-0C28-4925-8F5C-93D0202DB3F1" name="GUID-63C99D7D-0C28-4925-8F5C-93D0202DB3F1"></a><h4 id="ADFNS-GUID-63C99D7D-0C28-4925-8F5C-93D0202DB3F1" class="sect4">创建CQN注册的先决条件</h4>
                  <div>
                     <p>这些是创建CQN注册的先决条件：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您必须拥有以下权限：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">DBMS_CQ_NOTIFICATION</code>包的<code class="codeph">EXECUTE</code>特权，其子程序用于创建注册</p>
                              </li>
                              <li>
                                 <p><code class="codeph">CHANGE</code> <code class="codeph">NOTIFICATION</code>系统特权</p>
                              </li>
                              <li>
                                 <p>对要注册的每个对象具有<code class="codeph">READ</code>或<code class="codeph">SELECT</code>权限</p>
                              </li>
                           </ul>
                           <p>与已注册查询关联的对象上的权限丢失会生成通知。</p>
                        </li>
                        <li>
                           <p>您必须以非SYS用户身份进行连接。</p>
                        </li>
                        <li>
                           <p>您不得处于未提交的事务中。</p>
                        </li>
                        <li>
                           <p><code class="codeph">dml_locks</code> <code class="codeph">init</code> 。 <code class="codeph">ora</code>参数必须具有非零值（如其默认值所示）。
                           </p>
                           <p>（这也是接收通知的先决条件。）</p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-63C99D7D-0C28-4925-8F5C-93D0202DB3F1__GUID-B0DCEDF2-1AF4-457E-9A71-43129539BD15">
                        <p class="notep1">注意：</p>
                        <p>对于QRCN支持，数据库的<code class="codeph">COMPATIBLE</code>设置必须至少为11.0.0。
                        </p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-63C99D7D-0C28-4925-8F5C-93D0202DB3F1__NOTE-125-CAD62611">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="cqn.html#GUID-E18D6FE8-1389-4774-AC98-175BE374CC5F">注销</a></p>
                     </div>
                  </div>
               </div><a id="ADFNS571"></a><div class="props_rev_3"><a id="GUID-2D04655A-3C16-4878-9F07-26311FD3149D" name="GUID-2D04655A-3C16-4878-9F07-26311FD3149D"></a><h4 id="ADFNS-GUID-2D04655A-3C16-4878-9F07-26311FD3149D" class="sect4">可以为对象更改通知（OCN）注册的查询</h4>
                  <div>
                     <p>大多数查询都可以注册OCN，包括作为存储过程和<code class="codeph">REF</code>游标的一部分执行的查询。
                     </p>
                     <p>无法为OCN注册的查询是：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>查询固定表或固定视图</p>
                        </li>
                        <li>
                           <p>查询用户视图</p>
                        </li>
                        <li>
                           <p>包含数据库链接的查询（dblinks）</p>
                        </li>
                        <li>
                           <p>查询物化视图</p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-2D04655A-3C16-4878-9F07-26311FD3149D__GUID-1D64D0C9-66B8-4FDB-A79E-E2A9234AB1BD">
                        <p class="notep1">注意：</p>
                        <p>您可以在OCN注册中使用同义词，但不能在QRCN注册中使用。</p>
                     </div>
                  </div>
               </div><a id="ADFNS1064"></a><a id="ADFNS572"></a><div class="props_rev_3"><a id="GUID-B96D4FE6-465D-4400-89B1-7E8DBCD5829C" name="GUID-B96D4FE6-465D-4400-89B1-7E8DBCD5829C"></a><h4 id="ADFNS-GUID-B96D4FE6-465D-4400-89B1-7E8DBCD5829C" class="sect4">可以为查询结果更改通知（QRCN）注册的查询</h4>
                  <div>
                     <p>有些查询可以在保证模式下注册到QRCN，有些可以仅在尽力模式下注册到QRCN，有些查询无法在任何模式下注册到QRCN。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-B96D4FE6-465D-4400-89B1-7E8DBCD5829C__GUID-26BA7F9D-13EE-43C4-B0F3-9FB731E1512C">话题：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="cqn.html#GUID-15F66C86-D79B-408F-977C-9BB614C3D91E">可以在保证模式下为QRCN注册的查询</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-12872C24-0535-4EA9-B9DF-E2FE9FEC8908">仅在Best-Effort模式下可以为QRCN注册的查询</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-77B34385-509E-434C-9E78-C793A22AD0A8">在任一模式下无法为QRCN注册的查询</a></p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-B96D4FE6-465D-4400-89B1-7E8DBCD5829C__NOTE-1232-CAD658CF">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="cqn.html#GUID-4A320315-AF7F-4D60-BB63-AD9731D3640D">保证模式</a>和</p>
                              </li>
                              <li>
                                 <p><a href="cqn.html#GUID-0766B418-4023-4BB7-8887-25AE98CBD351" title="某些类型的查询如此简化，以至于在对象级别生成失效;也就是说，只要这些查询中引用的任何对象发生更改。此类查询的示例是使用不受支持的列类型或包含子查询的查询。此问题的解决方案是重写原始查询。">尽力而为模式</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS573"></a><div class="props_rev_3"><a id="GUID-15F66C86-D79B-408F-977C-9BB614C3D91E" name="GUID-15F66C86-D79B-408F-977C-9BB614C3D91E"></a><h5 id="ADFNS-GUID-15F66C86-D79B-408F-977C-9BB614C3D91E" class="sect5">可以在保证模式下为QRCN注册的查询</h5>
                     <div>
                        <p>要在保证模式下注册QRCN，查询必须符合以下规则：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>它引用的每个列都是<code class="codeph">NUMBER</code>数据类型或<code class="codeph">VARCHAR2</code>数据类型。
                              </p>
                           </li>
                           <li>
                              <p>列表达式中的算术运算符仅限于这些二元运算符，它们的操作数是具有数字数据类型的列：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">+</code> （另外）</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">-</code> （减法，不是一元减去）</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">*</code> （乘法）</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">/</code> （分裂）</p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>谓词中的比较运算符仅限于：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">&lt;</code> （小于）</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">&lt;=</code> （小于或等于）</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">=</code> （等于）</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">&gt;=</code> （大于或等于）</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">&gt;</code> （大于）</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">&lt;&gt;</code>或<code class="codeph">!=</code> （不等于）</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">IS</code> <code class="codeph">NULL</code></p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">IS</code> <code class="codeph">NOT</code> <code class="codeph">NULL</code></p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>谓词中的布尔运算符仅限于<code class="codeph">AND</code> ， <code class="codeph">OR</code>和<code class="codeph">NOT</code> 。</p>
                           </li>
                           <li>
                              <p>该查询不包含聚合函数（例如<code class="codeph">SUM</code> ， <code class="codeph">COUNT</code> ， <code class="codeph">AVERAGE</code> ， <code class="codeph">MIN</code>和<code class="codeph">MAX</code> ）。
                              </p>
                           </li>
                        </ul>
                        <p>保证模式支持单个表和一些内部等值连接上的大多数查询，例如：</p><pre class="oac_no_warn" dir="ltr">从员工，部门员工中选择员工.DEPARTMENT_ID = DEPARTMENTS.DEPARTMENT_ID和DEPARTMENTS.LOCATION_ID = 1700;</pre><div class="infoboxnote" id="GUID-15F66C86-D79B-408F-977C-9BB614C3D91E__GUID-A6E98C15-EECD-4F88-8A0C-98F76092DE07">
                           <p class="notep1">注意：</p>
                           <p></p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有时，查询优化器使用执行计划，使查询与保证模式不兼容（例如， <code class="codeph">OR</code> -expansion）。
                                 </p>
                              </li>
                              <li>
                                 <p>可以在保证模式下注册的查询也可以在尽力模式下注册，但结果可能不同，因为即使对于CQN不简化的查询，尽力而为模式也可能导致误报。</p>
                              </li>
                           </ul>
                        </div>
                        <div class="infoboxnotealso" id="GUID-15F66C86-D79B-408F-977C-9BB614C3D91E__NOTE-126-CAD69DC6">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=SQLRF20035" target="_blank"><span class="italic">Oracle数据库SQL语言参考</span></a> ，以获取SQL聚合函数的列表</p>
                              </li>
                              <li>
                                 <p>有关查询优化器的信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=TGSQL193" target="_blank"><span class="italic">参见“Oracle数据库SQL调优指南”</span></a></p>
                              </li>
                              <li>
                                 <p><a href="cqn.html#GUID-0766B418-4023-4BB7-8887-25AE98CBD351" title="某些类型的查询如此简化，以至于在对象级别生成失效;也就是说，只要这些查询中引用的任何对象发生更改。此类查询的示例是使用不受支持的列类型或包含子查询的查询。此问题的解决方案是重写原始查询。">尽力而为模式</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="ADFNS574"></a><div class="props_rev_3"><a id="GUID-12872C24-0535-4EA9-B9DF-E2FE9FEC8908" name="GUID-12872C24-0535-4EA9-B9DF-E2FE9FEC8908"></a><h5 id="ADFNS-GUID-12872C24-0535-4EA9-B9DF-E2FE9FEC8908" class="sect5">仅在Best-Effort模式下可以为QRCN注册的查询</h5>
                     <div>
                        <p>只能在尽力而为模式下为QRCN注册执行以下任何操作的查询，其简化版本以对象粒度生成通知：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>指已启用加密的列</p>
                           </li>
                           <li>
                              <p><code class="codeph">SELECT</code>列表中有10个以上相同类型的项目</p>
                           </li>
                           <li>
                              <p>表达式包括以下任何一个：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>字符串函数（例如<code class="codeph">SUBSTR</code> ， <code class="codeph">LTRIM</code>和<code class="codeph">RTRIM</code> ）</p>
                                 </li>
                                 <li>
                                    <p>算术函数（如<code class="codeph">TRUNC</code> ， <code class="codeph">ABS</code>和<code class="codeph">SQRT</code> ）</p>
                                 </li>
                                 <li>
                                    <p>模式匹配条件<code class="codeph">LIKE</code>和<code class="codeph">REGEXP_LIKE</code></p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">EXISTS</code>或<code class="codeph">NOT</code> <code class="codeph">EXISTS</code>条件</p>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>具有涉及在不同表的列上定义的谓词的析取。例如：</p><pre class="oac_no_warn" dir="ltr">选择EMPLOYEE_ID，DEPARTMENT_ID来自员工，部门员工EMPLOYEES.EMPLOYEE_ID = 10或DEPARTMENTS.DEPARTMENT_ID ='IT';</pre></li>
                           <li>
                              <p>有用户rowid访问权限。例如：</p><pre class="oac_no_warn" dir="ltr">从DEPARTMENTS中选择DEPARTMENT_ID，其中ROWID ='AAANkdAABAAALinAAF';</pre></li>
                           <li>
                              <p>除了内部联接之外是否有任何联接</p>
                           </li>
                           <li>
                              <p>有一个涉及以下任何一个的执行计划：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>位图连接，域或基于函数的索引</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">UNION</code> <code class="codeph">ALL</code>或<code class="codeph">CONCATENATION</code></p>
                                    <p>（在查询本身中，或者作为查询优化器选择的<code class="codeph">OR</code>扩展执行计划的结果。）
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">ORDER</code> <code class="codeph">BY</code>或<code class="codeph">GROUP</code> <code class="codeph">BY</code></p>
                                    <p>（在查询本身中，或者作为在查询优化器选择的执行计划中使用<code class="codeph">ORDER</code> <code class="codeph">BY</code>选项的<code class="codeph">SORT</code>操作的结果。）
                                    </p>
                                 </li>
                                 <li>
                                    <p>具有溢出段的分区索引组织表（IOT）</p>
                                 </li>
                                 <li>
                                    <p>集群对象</p>
                                 </li>
                                 <li>
                                    <p>并行执行</p>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-12872C24-0535-4EA9-B9DF-E2FE9FEC8908__NOTE-124-CAD6FA93">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=SQLRF006" target="_blank"><span class="italic">Oracle数据库SQL语言参考，</span></a>用于SQL函数列表</p>
                        </div><pre class="pre codeblock"><code></code></pre></div>
                  </div><a id="ADFNS575"></a><div class="props_rev_3"><a id="GUID-77B34385-509E-434C-9E78-C793A22AD0A8" name="GUID-77B34385-509E-434C-9E78-C793A22AD0A8"></a><h5 id="ADFNS-GUID-77B34385-509E-434C-9E78-C793A22AD0A8" class="sect5">在任一模式下无法为QRCN注册的查询</h5>
                     <div>
                        <p>在保证或尽力而为模式下，无法为QRCN注册引用以下任何内容的查询：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>查看</p>
                           </li>
                           <li>
                              <p>已启用固定，远程或启用虚拟专用数据库（VPD）策略的表</p>
                           </li>
                           <li>
                              <p><code class="codeph">DUAL</code> （在<code class="codeph">SELECT</code>列表中）</p>
                           </li>
                           <li>
                              <p>同义词</p>
                           </li>
                           <li>
                              <p>调用用户定义的PL / SQL子程序</p>
                           </li>
                           <li>
                              <p>未在<a href="cqn.html#GUID-15F66C86-D79B-408F-977C-9BB614C3D91E">可以在保证模式下为QRCN注册的查询中</a>列出的运算符</p>
                           </li>
                           <li>
                              <p>聚合函数<code class="codeph">COUNT</code></p>
                              <p>（在尽力模式下允许使用其他聚合函数，但在保证模式下不允许。）</p>
                           </li>
                           <li>
                              <p>应用环境;例如：</p><pre class="oac_no_warn" dir="ltr">从员工中选择SALARY USER = SYS_CONTEXT（'USERENV'，'SESSION_USER'）;</pre></li>
                           <li>
                              <p><code class="codeph">SYSDATE</code> ， <code class="codeph">SYSTIMESTAMP</code>或<code class="codeph">CURRENT</code> <code class="codeph">TIMESTAMP</code></p>
                           </li>
                        </ul>
                        <p>此外，无法为QRCN注册查询优化器使用实体化视图重写的查询。</p>
                        <div class="infoboxnotealso" id="GUID-77B34385-509E-434C-9E78-C793A22AD0A8__NOTE-124-CAD8825C">
                           <p class="notep1">也可以看看：</p>
                           <p>有关查询优化器的信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=TGSQL193" target="_blank"><span class="italic">参见“Oracle数据库SQL调优指南”</span></a></p>
                        </div>
                     </div>
                  </div>
               </div><a id="ADFNS1065"></a><a id="ADFNS576"></a><div class="props_rev_3"><a id="GUID-52D0C42D-EA7E-4282-A14B-BA42E11D9A6D" name="GUID-52D0C42D-EA7E-4282-A14B-BA42E11D9A6D"></a><h4 id="ADFNS-GUID-52D0C42D-EA7E-4282-A14B-BA42E11D9A6D" class="sect4">使用PL / SQL为CQN注册查询</h4>
                  <div>
                     <div class="section">
                        <p>要使用PL / SQL创建CQN注册，请按照下列步骤操作：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>创建存储的PL / SQL过程以用作通知处理程序。</span><div>请参阅<a href="cqn.html#GUID-FB04F169-2CC0-4059-9B47-1D852C131A05">创建PL / SQL通知处理程序</a> 。
                           </div>
                        </li>
                        <li class="stepexpand"><span>创建<code class="codeph">CQ_NOTIFICATION$_REG_INFO</code>对象，该对象指定通知处理程序的名称，通知类型和注册的其他属性。</span><div>请参阅<a href="cqn.html#GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B">创建CQ_NOTIFICATION $ _REG_INFO对象</a> 。
                           </div>
                        </li>
                        <li class="stepexpand"><span>在客户端应用程序中，使用<code class="codeph">DBMS_CQ_NOTIFICATION</code> 。 <code class="codeph">NEW_REG_START</code>函数用于打开注册块。</span><div>
                              <p>有关<code class="codeph">CQ_NOTIFICATION$_REG_INFO</code>对象以及函数<code class="codeph">NEW_REG_START</code>和<code class="codeph">REG_END</code>详细信息，请参阅<span class="italic">Oracle数据库PL / SQL包和类型参考</span> ，所有这些都在<code class="codeph">DBMS_CQ_NOTIFICATION</code>包中定义。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>运行查询以进行注册。（不要运行DML或DDL操作。）</span><div>有关更多信息，请参阅以下主题：<ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="cqn.html#GUID-55D2DA06-65E0-4FB7-A765-477688840831">识别通知中的单个查询</a></p>
                                 </li>
                                 <li>
                                    <p><a href="cqn.html#GUID-7CBB4F5D-30F5-406C-8D5E-1E030B72E718">将查询添加到现有注册</a></p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>使用<code class="codeph">DBMS_CQ_NOTIFICATION</code>关闭注册块。 <code class="codeph">REG_END</code>功能。</span></li>
                     </ol>
                  </div><a id="ADFNS577"></a><div class="props_rev_3"><a id="GUID-FB04F169-2CC0-4059-9B47-1D852C131A05" name="GUID-FB04F169-2CC0-4059-9B47-1D852C131A05"></a><h5 id="ADFNS-GUID-FB04F169-2CC0-4059-9B47-1D852C131A05" class="sect5">创建PL / SQL通知处理程序</h5>
                     <div>
                        <div class="section">
                           <p>您创建用作通知处理程序的PL / SQL存储过程必须具有以下签名：</p><pre class="oac_no_warn" dir="ltr">PROCEDURE <span class="italic">schema_name.proc_name</span> （ <span class="italic">ntfnds</span> IN CQ_NOTIFICATION $ _DESCRIPTOR）</pre><p>在前面的签名中， <span class="italic"><code class="codeph">schema_name</code></span>是数据库模式的名称， <span class="italic"><code class="codeph">proc_name</code></span>是存储过程的名称， <span class="italic"><code class="codeph">ntfnds</code></span>是通知描述符。
                           </p>
                           <p>通知描述符是<code class="codeph">CQ_NOTIFICATION$_DESCRIPTOR</code>对象，其属性描述更改的详细信息（事务ID，更改类型，受影响的查询，已修改的表等）。
                           </p>
                           <p>所述<code class="codeph">JOBQ</code>过程转到通知描述符， <span class="italic"><code class="codeph">ntfnds</code></span> ，所述通知处理程序， <span class="italic"><code class="codeph">proc_name</code></span> ，根据它的应用要求其处理该通知。（这是<a href="cqn.html#GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778__CHECFHCH">图18-2中的</a>第<a href="cqn.html#GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778__CHDCABFC">6</a>步。）
                           </p>
                           <div class="infoboxnote" id="GUID-FB04F169-2CC0-4059-9B47-1D852C131A05__GUID-5CABB28C-D0F6-4D29-B781-662FE2948D24">
                              <p class="notep1">注意：</p>
                              <p>通知处理程序在作业队列进程内运行。<code class="codeph">JOB_QUEUE_PROCESSES</code>初始化参数指定可以为执行作业创建的最大进程数。必须将<code class="codeph">JOB_QUEUE_PROCESSES</code>设置为非零值才能接收PL / SQL通知。
                              </p>
                           </div>
                           <div class="infoboxnotealso" id="GUID-FB04F169-2CC0-4059-9B47-1D852C131A05__NOTE-1217-CAD95645">
                              <p class="notep1">也可以看看：</p>
                              <p><code class="codeph"><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=REFRN10077" target="_blank">JOB_QUEUE_PROCESSES</a></code></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="ADFNS579"></a><a id="ADFNS580"></a><a id="ADFNS581"></a><a id="ADFNS578"></a><div class="props_rev_3"><a id="GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B" name="GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B"></a><h5 id="ADFNS-GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B" class="sect5">创建CQ_NOTIFICATION $ _REG_INFO对象</h5>
                     <div>
                        <div class="section">
                           <p><code class="codeph">CQ_NOTIFICATION$_REG_INFO</code>类型的对象指定在注册的对象更改时数据库运行的通知处理程序。在SQL * Plus中，您可以通过运行以下语句来查看其类型属性：</p><pre class="oac_no_warn" dir="ltr">DESC CQ_NOTIFICATION $ _REG_INFO</pre><p><a href="cqn.html#GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B__CHEEDHCG" title="此表汇总了SYS.CHNF $ _REG_INFO_OC4J数据类型的属性。">表18-2</a>描述了<code class="codeph">SYS</code>的属性。 <code class="codeph">CQ_NOTIFICATION$_REG_INFO</code> 。</p>
                           <div class="tblformal" id="GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B__CHEEDHCG">
                              <p class="titleintable">表18-2 CQ_NOTIFICATION $ _REG_INFO的属性</p>
                              <table cellpadding="4" cellspacing="0" class="Formal" title="CQ_NOTIFICATION $ _REG_INFO的属性" width="100%" border="1" summary="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="38%" id="d102353e5559">属性</th>
                                       <th align="left" valign="bottom" width="62%" id="d102353e5562">描述</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5567" headers="d102353e5559 ">
                                          <p><code class="codeph">打回来</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5567 d102353e5562 ">
                                          <p>指定生成通知时要执行的PL / SQL过程的名称（通知处理程序）。您必须在表单<span class="italic"><code class="codeph">schema_name</code></span>指定名称。 <span class="italic"><code class="codeph">procedure_name</code></span> ，例如<code class="codeph">hr</code> 。 <code class="codeph">dcn_callback</code> 。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5589" headers="d102353e5559 ">
                                          <p><code class="codeph">QOSFLAGS</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5589 d102353e5562 ">
                                          <p>指定一个或多个服务质量标志，这些标志是<code class="codeph">DBMS_CQ_NOTIFICATION</code>包中的<code class="codeph">DBMS_CQ_NOTIFICATION</code> 。有关其名称和说明，请<a href="cqn.html#GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B__g4923183" title="此表总结了服务质量标志。">参见表18-3</a> 。
                                          </p>
                                          <p>要指定多个服务质量标志，请使用按位<code class="codeph">OR</code> 。例如： <code class="codeph">DBMS_CQ_NOTIFICATION.QOS_RELIABLE + DBMS_CQ_NOTIFICATION.QOS_ROWIDS</code></p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5612" headers="d102353e5559 ">
                                          <p><code class="codeph">超时</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5612 d102353e5562 ">
                                          <p>指定注册的超时时间。如果设置为非零值，则指定数据库清除注册的时间（以秒为单位）。如果为<code class="codeph">0</code>或<code class="codeph">NULL</code> ，则注册将持续存在，直到客户端明确注销它为止。
                                          </p>
                                          <p>可以与<code class="codeph">QOSFLAGS</code>属性及其<code class="codeph">QOS_DEREG_NFY</code>标志结合使用。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5634" headers="d102353e5559 ">
                                          <p><code class="codeph">OPERATIONS_FILTER</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5634 d102353e5562 ">
                                          <p>仅适用于OCN（在<a href="cqn.html#GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4">关于对象更改通知（OCN）中描述</a> ）。如果使用<code class="codeph">QOS_QUERY</code>标志指定<code class="codeph">QOS_FLAGS</code>属性，则<code class="codeph">QOS_QUERY</code> 。
                                          </p>
                                          <p>根据SQL语句的类型过滤消息。您可以在<code class="codeph">DBMS_CQ_NOTIFICATION</code>包中指定这些常量：</p>
                                          <ul style="list-style-type:disc">
                                             <li>
                                                <p><code class="codeph">ALL_OPERATIONS</code>会通知所有更改</p>
                                             </li>
                                             <li>
                                                <p><code class="codeph">INSERTOP</code>通知插入</p>
                                             </li>
                                             <li>
                                                <p><code class="codeph">UPDATEOP</code>通知更新</p>
                                             </li>
                                             <li>
                                                <p><code class="codeph">DELETEOP</code>通知删除</p>
                                             </li>
                                             <li>
                                                <p><code class="codeph">ALTEROP</code>通知<code class="codeph">ALTER</code> <code class="codeph">TABLE</code>操作</p>
                                             </li>
                                             <li>
                                                <p><code class="codeph">DROPOP</code>在<code class="codeph">DROP</code> <code class="codeph">TABLE</code>操作上通知</p>
                                             </li>
                                             <li>
                                                <p><code class="codeph">UNKNOWNOP</code>通知未知的操作</p>
                                             </li>
                                          </ul>
                                          <p>您可以使用按位<code class="codeph">OR</code>指定操作组合。例如： <code class="codeph">DBMS_CQ_NOTIFICATION.INSERTOP</code> + <code class="codeph">DBMS_CQ_NOTIFICATION.DELETEOP</code> 。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5716" headers="d102353e5559 ">
                                          <p><code class="codeph">TRANSACTION_LAG</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5716 d102353e5562 ">
                                          <p><span class="bold">不推荐</span> 。要实现控制流通知，请使用<code class="codeph">NTFN_GROUPING_*</code>属性。
                                          </p>
                                          <p>仅适用于OCN（在<a href="cqn.html#GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4">关于对象更改通知（OCN）中描述</a> ）。如果使用<code class="codeph">QOS_QUERY</code>标志指定<code class="codeph">QOS_FLAGS</code>属性，则<code class="codeph">QOS_QUERY</code> 。
                                          </p>
                                          <p>指定客户端可以滞后于数据库的事务或数据库更改的数量。如果为0，则客户端一生成就会收到失效消息。如果为5，则更改已注册对象的每五个事务将生成一个通知。数据库以对象粒度跟踪干预变更，并将更改与通知捆绑在一起。因此，客户不会失去干预性的变化。</p>
                                          <p>大多数应用程序必须在没有进一步延迟的情况下通知事务提交中对象的更改，预计会选择0事务延迟。仅当应用程序对通知实施流控制时，非零事务延迟才有用。使用非零事务延迟时，Oracle建议应用程序工作负载具有以合理频率生成通知的属性。否则，通知可能会无限期延迟，直到满足滞后为止。</p>
                                          <p>如果指定<code class="codeph">TRANSACTION_LAG</code> ，则即使在注册期间指定了<code class="codeph">QOS_ROWIDS</code> ，通知消息中的<code class="codeph">ROWID</code>级别粒度也不可用。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5756" headers="d102353e5559 ">
                                          <p><code class="codeph">NTFN_GROUPING_CLASS</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5756 d102353e5562 ">
                                          <p>指定用于对通知进行分组的类。唯一允许的值是<code class="codeph">DBMS_CQ_NOTIFICATION</code> 。 <code class="codeph">NTFN_GROUPING_CLASS_TIME</code> ，按时间对通知进行分组。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5770" headers="d102353e5559 ">
                                          <p><code class="codeph">NTFN_GROUPING_VALUE</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5770 d102353e5562 ">
                                          <p>指定定义组的时间间隔（以秒为单位）。例如，如果此值为900，则会在相同的15分钟间隔中生成的通知进行分组。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5778" headers="d102353e5559 ">
                                          <p><code class="codeph">NTFN_GROUPING_TYPE</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5778 d102353e5562 ">
                                          <p>指定以下任一类型的分组：</p>
                                          <ul style="list-style-type:disc">
                                             <li>
                                                <p><code class="codeph">DBMS_CQ_NOTIFICATION</code> 。 <code class="codeph">NTFN_GROUPING_TYPE_SUMMARY</code> ：组中的所有通知都汇总到一个通知中。
                                                </p>
                                             </li>
                                             <li>
                                                <p><code class="codeph">DBMS_CQ_NOTIFICATION</code> 。 <code class="codeph">NTFN_GROUPING_TYPE_LAST</code> ：仅发布组中的最后一个通知，并丢弃先前的通知。
                                                </p>
                                             </li>
                                          </ul>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5803" headers="d102353e5559 ">
                                          <p><code class="codeph">NTFN_GROUPING_START_TIME</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5803 d102353e5562 ">
                                          <p>指定何时开始生成通知。如果指定为<code class="codeph">NULL</code> ，则默认为当前系统生成的时间。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5814" headers="d102353e5559 ">
                                          <p><code class="codeph">NTFN_GROUPING_REPEAT_COUNT</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5814 d102353e5562 ">
                                          <p>指定重复通知的次数。设置为<code class="codeph">DBMS_CQ_NOTIFICATION</code> 。 <code class="codeph">NTFN_GROUPING_FOREVER</code>接收注册生命周期的通知。要在注册期限内最多收到<span class="italic">n个</span>通知，请设置为<span class="italic">n</span> 。
                                          </p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p><a href="cqn.html#GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B__g4923183" title="此表总结了服务质量标志。">表18-3</a>中的服务质量标志是<code class="codeph">DBMS_CQ_NOTIFICATION</code>包中的<code class="codeph">DBMS_CQ_NOTIFICATION</code> 。您可以使用<code class="codeph">CQ_NOTIFICATION$_REG_INFO</code>的<code class="codeph">QOS_FLAGS</code>属性指定它们（请参阅<a href="cqn.html#GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B__CHEEDHCG" title="此表汇总了SYS.CHNF $ _REG_INFO_OC4J数据类型的属性。">表18-2</a> ）。
                           </p>
                           <div class="tblformal" id="GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B__g4923183">
                              <p class="titleintable">表18-3服务质量标志</p>
                              <table cellpadding="4" cellspacing="0" class="Formal" title="服务质量标志" width="100%" border="1" summary="This table summarizes the quality-of-service flags." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="23%" id="d102353e5864">旗</th>
                                       <th align="left" valign="bottom" width="77%" id="d102353e5867">描述</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="23%" id="d102353e5872" headers="d102353e5864 ">
                                          <p><code class="codeph">QOS_DEREG_NFY</code></p>
                                       </td>
                                       <td align="left" valign="top" width="77%" headers="d102353e5872 d102353e5867 ">
                                          <p>在第一次通知后清除注册。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="23%" id="d102353e5880" headers="d102353e5864 ">
                                          <p><code class="codeph">QOS_RELIABLE</code></p>
                                       </td>
                                       <td align="left" valign="top" width="77%" headers="d102353e5880 d102353e5867 ">
                                          <p>在持久数据库队列中存储通知。</p>
                                          <p>在Oracle RAC环境中，如果数据库实例失败，幸存的数据库实例可以传递任何排队的通知消息。</p>
                                          <p><span class="bold">默认值：</span>通知存储在共享内存中，可以更有效地执行。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="23%" id="d102353e5894" headers="d102353e5864 ">
                                          <p><code class="codeph">QOS_ROWIDS</code></p>
                                       </td>
                                       <td align="left" valign="top" width="77%" headers="d102353e5894 d102353e5867 ">
                                          <p>包含通知中每个已更改行的<code class="codeph">ROWID</code> 。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="23%" id="d102353e5905" headers="d102353e5864 ">
                                          <p><code class="codeph">QOS_QUERY</code></p>
                                       </td>
                                       <td align="left" valign="top" width="77%" headers="d102353e5905 d102353e5867 ">
                                          <p>注册QRCN的查询，如<a href="cqn.html#GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9" title="某些类型的查询如此简化，以至于在对象级别生成失效;也就是说，只要这些查询中引用的任何对象发生更改。此类查询的示例是使用不受支持的列类型或包含子查询的查询。此问题的解决方案是重写原始查询。">关于查询结果更改通知（QRCN）中所述</a> 。
                                          </p>
                                          <p>如果无法为QRCN注册查询，则在注册时会生成错误，除非您还指定了<code class="codeph">QOS_BEST_EFFORT</code> 。</p>
                                          <p><span class="bold">默认值：</span>为<a href="cqn.html#GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4">关于对象更改通知（OCN）中</a>描述的OCN注册查询</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="23%" id="d102353e5932" headers="d102353e5864 ">
                                          <p><code class="codeph">QOS_BEST_EFFORT</code></p>
                                       </td>
                                       <td align="left" valign="top" width="77%" headers="d102353e5932 d102353e5867 ">
                                          <p>与<code class="codeph">QOS_QUERY</code>一起<code class="codeph">QOS_QUERY</code> 。注册对查询结果更改评估过于复杂的查询的简化版本;换句话说，在<a href="cqn.html#GUID-0766B418-4023-4BB7-8887-25AE98CBD351" title="某些类型的查询如此简化，以至于在对象级别生成失效;也就是说，只要这些查询中引用的任何对象发生更改。此类查询的示例是使用不受支持的列类型或包含子查询的查询。此问题的解决方案是重写原始查询。">Best-Effort模式中</a>描述的以尽力模式注册QRCN。
                                          </p>
                                          <p>要查看哪些查询已简化，请查询静态数据字典视图<code class="codeph">DBA_CQ_NOTIFICATION_QUERIES</code>或<code class="codeph">USER_CQ_NOTIFICATION_QUERIES</code> 。这些视图提供<code class="codeph">QUERYID</code>和每个已注册查询的文本。
                                          </p>
                                          <p><span class="bold">默认值：</span>在保证模式下为QRCN注册查询，如<a href="cqn.html#GUID-4A320315-AF7F-4D60-BB63-AD9731D3640D">保证模式中所述</a></p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p>假设您必须调用<code class="codeph">HR</code>程序。每当注册的对象发生变化时， <code class="codeph">dcn_callback</code> 。在<a href="cqn.html#GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B__BGBFBHFD">例18-4中</a> ，您创建了一个<code class="codeph">CQ_NOTIFICATION$_REG_INFO</code>对象，该对象指定了<code class="codeph">HR</code> 。 <code class="codeph">dcn_callback</code>接收通知。要创建对象，您必须对<code class="codeph">DBMS_CQ_NOTIFICATION</code>包具有<code class="codeph">EXECUTE</code>特权。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B__BGBFBHFD">
                           <p class="titleinexample">示例18-4创建CQ_NOTIFICATION $ _REG_INFO对象</p><pre class="oac_no_warn" dir="ltr">DECLARE v_cn_addr CQ_NOTIFICATION $ _REG_INFO; BEGIN  - 创建对象：v_cn_addr：= CQ_NOTIFICATION $ _REG_INFO（'HR.dcn_callback'， -  PL / SQL通知处理程序DBMS_CQ_NOTIFICATION.QOS_QUERY  - 通知类型QRCN + DBMS_CQ_NOTIFICATION.QOS_ROWIDS， - 包括已更改对象的rowid 0， - 注册一直持续到未注册0， - 通知所有操作0  - 立即通知）; - 注册查询：...结束; /</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="ADFNS582"></a><div class="props_rev_3"><a id="GUID-55D2DA06-65E0-4FB7-A765-477688840831" name="GUID-55D2DA06-65E0-4FB7-A765-477688840831"></a><h5 id="ADFNS-GUID-55D2DA06-65E0-4FB7-A765-477688840831" class="sect5">识别通知中的单个查询</h5>
                     <div>
                        <div class="section">
                           <p>已注册的查询列表中的任何查询都可能导致连续的查询通知。要知道某个查询何时导致通知，请使用<code class="codeph">DBMS_CQ_NOTIFICATION</code> 。该查询的<code class="codeph">SELECT</code>列表中的<code class="codeph">CQ_NOTIFICATION_QUERYID</code>函数。例如：</p><pre class="oac_no_warn" dir="ltr">从员工中选择EMPLOYEE_ID，SALARY， <span class="bold">DBMS_CQ_NOTIFICATION.CQ_NOTIFICATION_QUERYID</span> ， <span class="bold">其中</span> DEPARTMENT_ID = 10;</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">EMPLOYEE_ID SALARY <span class="bold">CQ_NOTIFICATION_QUERYID</span> ----------- ---------- ----------------------- 200 2800 <span class="bold">0</span>选择了1行。
</pre><p>当该查询导致通知时，通知包括查询ID。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="ADFNS584"></a><a id="ADFNS583"></a><div class="props_rev_3"><a id="GUID-7CBB4F5D-30F5-406C-8D5E-1E030B72E718" name="GUID-7CBB4F5D-30F5-406C-8D5E-1E030B72E718"></a><h5 id="ADFNS-GUID-7CBB4F5D-30F5-406C-8D5E-1E030B72E718" class="sect5">将查询添加到现有注册</h5>
                     <div>
                        <div class="section">
                           <p>要向现有注册添加查询，请按照下列步骤操作：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>检索现有注册的注册ID。</span><div>
                                 <p>您可以从保存的输出或<code class="codeph">*_CHANGE_NOTIFICATION_REGS</code>的查询中检索它。</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>通过调用过程<code class="codeph">DBMS_CQ_NOTIFICATION</code>打开现有注册。 <code class="codeph">ENABLE_REG</code> ，注册ID作为参数。</span></li>
                           <li class="stepexpand"><span>运行查询以进行注册。（不要运行DML或DDL操作。）</span></li>
                           <li class="stepexpand"><span>使用<code class="codeph">DBMS_CQ_NOTIFICATION</code>关闭注册。 <code class="codeph">REG_END</code>功能。</span><div>
                                 <p><a href="cqn.html#GUID-7CBB4F5D-30F5-406C-8D5E-1E030B72E718__BGBDIIBJ">例18-5</a>将查询添加到注册ID为21的现有注册。
                                 </p>
                              </div>
                           </li>
                        </ol>
                        <div class="example" id="GUID-7CBB4F5D-30F5-406C-8D5E-1E030B72E718__BGBDIIBJ">
                           <p class="titleinexample">示例18-5向现有注册添加查询</p><pre class="oac_no_warn" dir="ltr">DECLARE v_cursor SYS_REFCURSOR; BEGIN <span class="bold">- 打开现有注册</span> DBMS_CQ_NOTIFICATION.ENABLE_REG（21）; OPEN v_cursor FOR <span class="bold">- 运行要注册的查询</span> SELECT DEPARTMENT_ID FROM HR.DEPARTMENTS; - 注册此查询CLOSE v_cursor; <span class="bold">- 关闭注册</span> DBMS_CQ_NOTIFICATION.REG_END;结束; /</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div><a id="ADFNS1303"></a><div class="props_rev_3"><a id="GUID-069991BE-E98B-4733-BEB7-D4AE96D0DB87" name="GUID-069991BE-E98B-4733-BEB7-D4AE96D0DB87"></a><h4 id="ADFNS-GUID-069991BE-E98B-4733-BEB7-D4AE96D0DB87" class="sect4">CQN注册的最佳实践</h4>
                  <div>
                     <p>要获得最佳CQN性能，请遵循以下注册准则：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>注册几个查询 - 最好是那些引用很少更改的对象。</p>
                           <p>极易变形的注册对象会导致大量通知，其开销会降低OLTP吞吐量。</p>
                        </li>
                        <li>
                           <p>最大限度地减少任何给定对象的重复注册次数，以避免为多个收件人复制通知邮件。</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="ADFNS1020"></a><div class="props_rev_3"><a id="GUID-FC45C32A-D57E-4925-A88B-97FAE4AD528D" name="GUID-FC45C32A-D57E-4925-A88B-97FAE4AD528D"></a><h4 id="ADFNS-GUID-FC45C32A-D57E-4925-A88B-97FAE4AD528D" class="sect4">CQN注册故障排除</h4>
                  <div>
                     <div class="section">
                        <p>如果您无法创建注册，或者您已创建注册但未收到预期的通知，则问题可能是以下问题之一：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">JOB_QUEUE_PROCESSES</code>参数未设置为非零值。
                              </p>
                              <p>这可以防止您通过通知处理程序接收PL / SQL通知。</p>
                           </li>
                           <li>
                              <p>您在创建注册时以SYS用户身份进行连接。</p>
                              <p>您必须以非SYS用户身份进行连接才能创建CQN注册。</p>
                           </li>
                           <li>
                              <p>您更改了已注册的对象，但未提交该事务。</p>
                              <p>仅在事务提交时生成通知。</p>
                           </li>
                           <li>
                              <p>未在数据库中成功创建注册。</p>
                              <p>要检查，请查询静态数据字典视图<code class="codeph">*_CHANGE_NOTIFICATION_REGS</code> 。例如，此语句显示当前用户的所有注册和注册对象：</p><pre class="oac_no_warn" dir="ltr">SELECT REGID，TABLE_NAME来自USER_CHANGE_NOTIFICATION_REGS;</pre></li>
                           <li>
                              <p>执行通知处理程序期间发生运行时错误。</p>
                              <p>如果是这样，它们被记录到试图运行该过程的<code class="codeph">JOBQ</code>进程的跟踪文件中。跟踪文件的名称通常具有以下形式：</p><pre class="oac_no_warn" dir="ltr"><span class="italic">ORACLE_SID</span> _j <span class="italic">number</span> _ <span class="italic">PID</span> .trc</pre><p>例如，如果ORACLE_SID是<code class="codeph">dbs1</code>并且<code class="codeph">JOBQ</code>进程的进程ID（PID）是12483，则跟踪文件的名称通常是<code class="codeph">dbs1_j000_12483</code> 。 <code class="codeph">trc</code> 。
                              </p>
                              <p>假设使用<code class="codeph">'chnf_callback</code> '作为通知处理程序和注册ID 100创建注册。假设数据库中未定义<code class="codeph">'chnf_callback</code> '。然后<code class="codeph">JOBQ</code>跟踪文件可能包含以下形式的消息：</p><pre class="oac_no_warn" dir="ltr">************************************************** **************************在执行reg CHNF <span class="bold">100</span>的PL / SQL cbk <span class="bold">chnf_callback</span>期间出现运行时错误。msgstr的PLSQL通知出错：队列：使用者名称：PLSQL函数： <span class="bold">chnf_callback</span>异常出错，错误消息：ORA-00604：递归SQL级别2发生错误ORA-06550：第1行第7行： <span class="bold">PLS-00201：标识符'CHNF_CALLBACK '必须声明</span> ORA-06550：第1行第7列：PL / SQL：忽略语句****************************** **********************************************</pre><p>如果在执行通知处理程序期间发生运行时错误，请创建一个非常简单的通知处理程序版本，以验证您是否正在接收通知，然后逐步添加应用程序逻辑。</p>
                              <p>一个非常简单的通知处理程序的示例是：</p><pre class="oac_no_warn" dir="ltr">REM在HR模式中创建表以保存收到的通知计数。CREATE TABLE nfcount（cnt NUMBER）; INSERT INTO nfcount（cnt）VALUES（0）;承诺;创建或替换过程chnf_callback（ntfnds IN CQ_NOTIFICATION $ _DESCRIPTOR）是BEGIN UPDATE nfcount SET cnt = cnt + 1;承诺;结束; /</pre></li>
                           <li>
                              <p>提交事务和最终用户收到的通知之间存在时间差。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS593"></a><div class="props_rev_3"><a id="GUID-ABAB71A2-F950-4F0A-B413-FD2D67F335DF" name="GUID-ABAB71A2-F950-4F0A-B413-FD2D67F335DF"></a><h4 id="ADFNS-GUID-ABAB71A2-F950-4F0A-B413-FD2D67F335DF" class="sect4">删除注册</h4>
                  <div>
                     <div class="section">
                        <p>要删除注册，请调用过程<code class="codeph">DBMS_CQ_NOTIFICATION</code> 。 <code class="codeph">DEREGISTER</code>与所述注册的ID作为参数。例如，此语句取消注册其注册ID为21的注册：</p><pre class="oac_no_warn" dir="ltr">DBMS_CQ_NOTIFICATION.DEREGISTER（21）;</pre><p>只有创建注册的用户或SYS用户才能取消注册。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS1067"></a><a id="ADFNS1302"></a><div class="props_rev_3"><a id="GUID-2D194274-3C78-42F3-959C-10B9F30B2F07" name="GUID-2D194274-3C78-42F3-959C-10B9F30B2F07"></a><h4 id="ADFNS-GUID-2D194274-3C78-42F3-959C-10B9F30B2F07" class="sect4">配置CQN：场景</h4>
                  <div>
                     <div class="section">
                        <p>在此方案中，您是管理提供员工数据的Web应用程序的开发人员：名称，位置，电话号码等。在Oracle Application Server上运行的应用程序被大量使用并处理<code class="codeph">HR</code>频繁查询。 <code class="codeph">EMPLOYEES</code>和<code class="codeph">HR</code> 。后端数据库中的<code class="codeph">DEPARTMENTS</code>表。由于这些表相对不经常更改，因此应用程序可以通过缓存查询结果来提高性能。缓存避免了往返后端数据库和服务器端执行延迟的往返。
                        </p>
                        <p>您可以使用<code class="codeph">DBMS_CQ_NOTIFICATION</code>包根据<code class="codeph">HR</code>注册查询。 <code class="codeph">EMPLOYEES</code>和<code class="codeph">HR</code> 。 <code class="codeph">DEPARTMENTS</code>表。要配置CQN，请按照下列步骤操作：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li id="GUID-2D194274-3C78-42F3-959C-10B9F30B2F07__CHDIDAHJ"><span>按照<a href="cqn.html#GUID-8B697AA3-7A7D-49E6-B5D3-127F3F9FB89C">创建PL / SQL通知处理</a>程序中的说明， <a href="cqn.html#GUID-8B697AA3-7A7D-49E6-B5D3-127F3F9FB89C">创建</a>服务器端PL / SQL存储过程以处理通知。</span></li>
                        <li id="GUID-2D194274-3C78-42F3-959C-10B9F30B2F07__CHDCGHHG"><span>在<code class="codeph">HR</code>上注册查询。 <code class="codeph">EMPLOYEES</code>和<code class="codeph">HR</code> 。按照<a href="cqn.html#GUID-E1B5BA1A-AE5D-4F04-9627-190586835A9D">注册查询中的</a>说明，QRCN的<code class="codeph">DEPARTMENTS</code>表。</span></li>
                     </ol>
                     <div class="section">
                        <p>完成这些步骤后，对步骤<a href="cqn.html#GUID-2D194274-3C78-42F3-959C-10B9F30B2F07__CHDCGHHG">2中</a>注册的查询结果的任何已提交更改将导致在步骤<a href="cqn.html#GUID-2D194274-3C78-42F3-959C-10B9F30B2F07__CHDIDAHJ">1中</a>创建的通知处理程序通知Web应用程序更改，然后Web应用程序通过查询后端数据库刷新缓存。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS595"></a><a id="ADFNS594"></a><div class="props_rev_3"><a id="GUID-8B697AA3-7A7D-49E6-B5D3-127F3F9FB89C" name="GUID-8B697AA3-7A7D-49E6-B5D3-127F3F9FB89C"></a><h5 id="ADFNS-GUID-8B697AA3-7A7D-49E6-B5D3-127F3F9FB89C" class="sect5">创建PL / SQL通知处理程序</h5>
                     <div>
                        <div class="section">
                           <p>创建服务器端存储的PL / SQL过程以处理通知，如下所示：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>连接到数据库<code class="codeph">AS</code> <code class="codeph">SYSDBA</code> 。</span></li>
                           <li class="stepexpand"><span>为<code class="codeph">HR</code>授予所需的权限：</span><div><pre class="oac_no_warn" dir="ltr">授予DBMS_CQ_NOTIFICATION到HR的授权;人力资源变更通知;</pre></div>
                           </li>
                           <li class="stepexpand"><span>启用<code class="codeph">JOB_QUEUE_PROCESSES</code>参数以接收通知：</span><div><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SET“JOB_QUEUE_PROCESSES”= 4;</pre></div>
                           </li>
                           <li class="stepexpand"><span>以非SYS用户（例如<code class="codeph">HR</code> ）连接到数据库。</span></li>
                           <li class="stepexpand"><span>创建数据库表以保存收到的通知事件的记录：</span><div><pre class="oac_no_warn" dir="ltr">- 创建表以记录通知事件。DROP TABLE nfevents; CREATE TABLE nfevents（regid NUMBER，event_type NUMBER）; - 创建表以记录通知查询：DROP TABLE nfqueries; CREATE TABLE nfqueries（qid NUMBER，qop NUMBER）; - 创建表以记录对已注册表的更改：DROP TABLE nftablechanges; CREATE TABLE nftablechanges（qid NUMBER，table_name VARCHAR2（100），table_operation NUMBER）; - 创建表以记录已更改行的ROWID：DROP TABLE nfrowchanges; CREATE TABLE nfrowchanges（qid NUMBER，table_name VARCHAR2（100），row_id VARCHAR2（2000））;</pre></div>
                           </li>
                           <li class="stepexpand"><span>创建<code class="codeph">HR</code>程序。 <code class="codeph">chnf_callback</code> ，如<a href="cqn.html#GUID-8B697AA3-7A7D-49E6-B5D3-127F3F9FB89C__CHEJCBFE">例18-6</a>所示。</span></li>
                        </ol>
                        <div class="example" id="GUID-8B697AA3-7A7D-49E6-B5D3-127F3F9FB89C__CHEJCBFE">
                           <p class="titleinexample">示例18-6创建服务器端PL / SQL通知处理程序</p><pre class="oac_no_warn" dir="ltr">创建或替换程序chnf_callback（ntfnds IN CQ_NOTIFICATION $ _DESCRIPTOR）是注册号码; tbname VARCHAR2（60）; event_type NUMBER; numtables NUMBER; operation_type NUMBER; numrows NUMBER; row_id VARCHAR2（2000）; numqueries NUMBER; qid NUMBER; qop NUMBER; BEGIN regid：= ntfnds.registration_id; event_type：= ntfnds.event_type; INSERT INTO nfevents（regid，event_type）VALUES（chnf_callback.regid，chnf_callback.event_type）; numqueries：= 0; IF（event_type = DBMS_CQ_NOTIFICATION.EVENT_QUERYCHANGE）那么numqueries：= ntfnds.query_desc_array.count; FOR i IN 1..numqueries LOOP  - 循环查询qid：= ntfnds.query_desc_array（i）.queryid; qop：= ntfnds.query_desc_array（i）.queryop; INSERT INTO nfqueries（qid，qop）VALUES（chnf_callback.qid，chnf_callback.qop）; numtables：= 0; numtables：= ntfnds.query_desc_array（i）.table_desc_array.count; FOR j IN 1..numtables LOOP  - 循环表tbname：= ntfnds.query_desc_array（i）.table_desc_array（j）.table_name; operation_type：= ntfnds.query_desc_array（i）.table_desc_array（j）。Opflags; INSERT INTO nftablechanges（qid，table_name，table_operation）VALUES（chnf_callback.qid，tbname，operation_type）; IF（bitand（operation_type，DBMS_CQ_NOTIFICATION.ALL_ROWS）= 0）THEN numrows：= ntfnds.query_desc_array（i）.table_desc_array（j）.numrows; ELSE numrows：= 0; -  ROWID信息不可用END IF; - 当numrows为零时，循环体不会运行。FOR k IN 1..numrows LOOP  - 遍历行Row_id：= ntfnds.query_desc_array（i）.table_desc_array（j）.row_desc_array（k）.row_id; INSERT INTO nfrowchanges（qid，table_name，row_id）VALUES（chnf_callback.qid，tbname，chnf_callback。ROW_ID）;结束循环; - 循环行END LOOP; - 循环表END LOOP; - 循环查询END IF;承诺;结束; /</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="ADFNS597"></a><a id="ADFNS596"></a><div class="props_rev_3"><a id="GUID-E1B5BA1A-AE5D-4F04-9627-190586835A9D" name="GUID-E1B5BA1A-AE5D-4F04-9627-190586835A9D"></a><h5 id="ADFNS-GUID-E1B5BA1A-AE5D-4F04-9627-190586835A9D" class="sect5">注册查询</h5>
                     <div>
                        <div class="section">
                           <p>创建通知处理程序后，您可以注册要为其接收通知的查询，并指定<code class="codeph">HR</code> 。 <code class="codeph">chnf_callback</code>作为通知处理程序，如<a href="cqn.html#GUID-E1B5BA1A-AE5D-4F04-9627-190586835A9D__CHEHHFFF">例18-7所示</a> 。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-E1B5BA1A-AE5D-4F04-9627-190586835A9D__CHEHHFFF">
                           <p class="titleinexample">示例18-7注册查询</p><pre class="oac_no_warn" dir="ltr">DECLARE reginfo CQ_NOTIFICATION $ _REG_INFO; mgr_id NUMBER; dept_id NUMBER; v_cursor SYS_REFCURSOR;注册号码; BEGIN / *为QRNC注册两个查询：* / / * 1。构建注册信息。chnf_callback是通知处理程序的名称。QOS_QUERY指定结果集更改通知。* / reginfo：= cq_notification $ _reg_info（'chnf_callback'，DBMS_CQ_NOTIFICATION.QOS_QUERY，0,0,0）; / * 2。创建注册。* / regid：= DBMS_CQ_NOTIFICATION.new_reg_start（reginfo）; OPEN v_cursor FOR SELECT dbms_cq_notification。CQ_NOTIFICATION_QUERYID，manager_id FROM HR.EMPLOYEES WHERE employee_id = 7902;关闭v_cursor; OPEN v_cursor FOR SELECT dbms_cq_notification。CQ_NOTIFICATION_QUERYID，department_id来自HR.departments WHERE department_name ='IT';关闭v_cursor; DBMS_CQ_NOTIFICATION.reg_end;结束; /</pre><p>查看新创建的注册：</p><pre class="oac_no_warn" dir="ltr">SELECT queryid，regid，TO_CHAR（querytext）FROM user_cq_notification_queries;</pre><p>结果类似于：</p><pre class="oac_no_warn" dir="ltr">QUERYID REGID TO_CHAR（QUERYTEXT）------- ----- -------------------------------- ---------------- 22 41从HR.DEPARTMENTS中选择HR.DEPARTMENTS.DEPARTMENT_ID HR.DEPARTMENTS.DEPARTMENT_NAME ='IT'21 41从HR.EMPLOYEES中选择HR.EMPLOYEES.MANAGER_ID HR.EMPLOYEES.EMPLOYEE_ID = 7902</pre><p>运行此事务，该事务使用<code class="codeph">QUERYID</code> 22更改查询结果：</p><pre class="oac_no_warn" dir="ltr">UPDATE DEPARTMENTS SET DEPARTMENT_NAME ='FINANCE'WHERE department_name ='IT';</pre><p>通知过程<code class="codeph">chnf_callback</code> （您在<a href="cqn.html#GUID-8B697AA3-7A7D-49E6-B5D3-127F3F9FB89C__CHEJCBFE">示例18-6中</a>创建）运行。
                           </p>
                           <p>查询记录通知事件的表：</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM nfevents;</pre><p>结果类似于：</p><pre class="oac_no_warn" dir="ltr">REGID EVENT_TYPE ----- ---------- 61 7</pre><p><code class="codeph">EVENT_TYPE</code> 7对应于<code class="codeph">EVENT_QUERYCHANGE</code> （查询结果更改）。
                           </p>
                           <p>查询记录了已注册表的更改的表：</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM nftablechanges;</pre><p>结果类似于：</p><pre class="oac_no_warn" dir="ltr">REGID TABLE_NAME TABLE_OPERATION ----- -------------- --------------- 42 HR.DEPARTMENTS 4</pre><p><code class="codeph">TABLE_OPERATION</code> 4对应于<code class="codeph">UPDATEOP</code> （更新操作）。
                           </p>
                           <p>查询记录了更改行的<code class="codeph">ROWID</code>的表：</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM nfrowchanges;</pre><p>结果类似于：</p><pre class="oac_no_warn" dir="ltr">REGID TABLE_NAME ROWID ----- -------------- ------------------ 61 HR.DEPARTMENTS AAANkdAABAAALinAAF</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div>
            </div><a id="ADFNS681"></a><a id="ADFNS680"></a><div class="props_rev_3"><a id="GUID-0D38B15C-F5CD-44C9-B073-39DA78350D28" name="GUID-0D38B15C-F5CD-44C9-B073-39DA78350D28"></a><h3 id="ADFNS-GUID-0D38B15C-F5CD-44C9-B073-39DA78350D28" class="sect3">使用OCI创建CQN注册</h3>
               <div>
                  <div class="section">
                     <p>本节介绍如何使用OCI创建CQN注册。使用OCI时，通知处理程序是客户端C回调过程。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-0D38B15C-F5CD-44C9-B073-39DA78350D28__GUID-8E0BBA51-78DE-44D4-8810-423BC3943F2A">话题</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="cqn.html#GUID-78180E2A-7011-4F32-B1C1-81923C918647">使用OCI进行查询结果集通知</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-497F4BB3-33B1-4231-B664-F7BFD76F2AD0">使用OCI注册连续查询通知</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-B6BE0F08-AFB7-4D6C-B5EB-8F85C43F1CD1">使用OCI订阅句柄属性进行连续查询通知</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-96222028-5814-44E9-A37E-89D8EE897280">OCI_ATTR_CQ_QUERYID属性</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-D2A55BA3-C631-43B2-811F-DAEA7C5104FC">使用OCI连续查询通知描述符</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-8CB2CED7-C1AC-4CD7-ADC2-240D2C5B9E22">在OCI示例程序中演示连续查询通知</a></p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-0D38B15C-F5CD-44C9-B073-39DA78350D28__GUID-C03C68D8-5049-4B64-847A-287F0E9454C3">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI16713" target="_blank">OCI中发布 - 订阅通知的</a>更多信息，请参阅<span class="italic">Oracle调用接口程序员指南</span> 
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS682"></a><div class="props_rev_3"><a id="GUID-78180E2A-7011-4F32-B1C1-81923C918647" name="GUID-78180E2A-7011-4F32-B1C1-81923C918647"></a><h4 id="ADFNS-GUID-78180E2A-7011-4F32-B1C1-81923C918647" class="sect4">使用OCI进行查询结果集通知</h4>
                  <div>
                     <div class="section">
                        <p>要记录特定于连续查询（CQ）通知的QOS（服务质量标志）， <code class="codeph">OCI_ATTR_SUBSCR_CQ_QOSFLAGS</code>在订阅句柄<code class="codeph">OCI_HTYPE_SUBSCR</code>上设置属性<code class="codeph">OCI_ATTR_SUBSCR_CQ_QOSFLAGS</code> 。要请求注册的查询粒度与对象粒度相反，请在属性<code class="codeph">OCI_ATTR_SUBSCR_CQ_QOSFLAGS</code>上设置<code class="codeph">OCI_SUBSCR_CQ_QOS_QUERY</code>标志位。</p>
                        <p>可以可选地指定伪列<code class="codeph">CQ_NOTIFICATION_QUERY_ID</code>以检索已注册查询的查询ID。这不会自动将粒度转换为查询级别。返回时伪列的值设置为分配给查询的唯一查询ID。对于基于OCI的注册，可以省略查询ID伪列，在这种情况下，查询ID作为语句句柄的<code class="codeph">READ</code>属性返回。（此属性称为<code class="codeph">OCI_ATTR_CQ_QUERYID</code> ）。
                        </p>
                        <p>在通知期间，将调用客户端指定的回调，并将顶级通知描述符作为参数传递。</p>
                        <p>有关已更改查询的查询ID的信息通过名为<code class="codeph">OCI_DTYPE_CQDES</code>的特殊描述符类型传达。查询描述符的集合（ <code class="codeph">OCIColl</code> ）嵌入在顶级通知描述符中。每个描述符的类型为<code class="codeph">OCI_DTYPE_CQDES</code> 。查询描述符具有以下属性：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">OCI_ATTR_CQDES_OPERATION</code> - 可以是<code class="codeph">OCI_EVENT_QUERYCHANGE</code>或<code class="codeph">OCI_EVENT_DEREG</code> 。</p>
                           </li>
                           <li>
                              <p><code class="codeph">OCI_ATTR_CQDES_QUERYID</code> - 已更改查询的查询ID。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">OCI_ATTR_CQDES_TABLE_CHANGES</code> - 描述导致查询结果集更改的表上的DML操作的表描述符数组。每个表描述符的类型为<code class="codeph">OCI_DTYPE_TABLE_CHDES</code> 。</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-78180E2A-7011-4F32-B1C1-81923C918647__GUID-10E4CEB2-652A-4DC0-8150-C928FE77CAF2">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="cqn.html#GUID-635139E3-40F9-49E2-8C3C-605771FB07D6">OCI_DTYPE_CHDES</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS683"></a><div class="props_rev_3"><a id="GUID-497F4BB3-33B1-4231-B664-F7BFD76F2AD0" name="GUID-497F4BB3-33B1-4231-B664-F7BFD76F2AD0"></a><h4 id="ADFNS-GUID-497F4BB3-33B1-4231-B664-F7BFD76F2AD0" class="sect4">使用OCI注册连续查询通知</h4>
                  <div>
                     <div class="section">
                        <p>调用会话必须具有<code class="codeph">CHANGE</code> <code class="codeph">NOTIFICATION</code>系统特权以及它尝试注册的所有对象的<code class="codeph">SELECT</code>特权。注册是记录在数据库中的持久实体，对所有Oracle RAC实例都是可见的。如果注册是查询粒度，则导致查询结果集更改并在任何Oracle RAC实例中提交的事务都会生成通知。如果注册是对象粒度，则在任何Oracle RAC实例中修改已注册对象的事务都会生成通知。
                        </p>
                        <p><span class="italic">不</span>支持涉及物化视图或非物化视图的查询。
                        </p>
                        <p>注册接口使用回调来响应查询的基础对象的更改，并使用命名空间扩展（ <code class="codeph">DBCHANGE</code> ）到AQ。</p>
                        <p>编写注册的步骤如下：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>在<code class="codeph">OCI_EVENTS</code>和<code class="codeph">OCI_OBJECT</code>模式下创建环境。</span></li>
                        <li class="stepexpand"><span>将订阅句柄属性<code class="codeph">OCI_ATTR_SUBSCR_NAMESPACE</code>为名称空间<code class="codeph">OCI_SUBSCR_NAMESPACE_DBCHANGE</code> 。</span></li>
                        <li class="stepexpand"><span>设置订阅句柄属性<code class="codeph">OCI_ATTR_SUBSCR_CALLBACK</code>以存储与查询句柄关联的OCI回调。回调有以下原型：</span><div><pre class="oac_no_warn" dir="ltr">void notification_callback（void * ctx，OCISubscription * subscrhp，void * payload，ub4 paylen，void * desc，ub4 mode）;</pre><p>这些参数在<span class="italic">Oracle Call Interface Programmer's Guide的</span> “ <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI16723" target="_blank">OCI</a>中的<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI16723" target="_blank">通知回调</a> ”中描述。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>（可选）使用<code class="codeph">OCI_ATTR_SUBSCR_CTX</code>属性关联客户端特定的上下文。</span></li>
                        <li class="stepexpand"><span>设置<code class="codeph">OCI_ATTR_SUBSCR_TIMEOUT</code>属性以指定<code class="codeph">ub4</code>超时间隔（以秒为单位）。如果未设置，则不会超时。</span></li>
                        <li class="stepexpand"><span>使用以下值设置<code class="codeph">OCI_ATTR_SUBSCR_QOSFLAGS</code>属性（QOS（服务质量）级别）：</span><div>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">OCI_SUBSCR_QOS_PURGE_ON_NTFN</code>标志允许在第一个通知上清除注册。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">OCI_SUBSCR_QOS_RELIABLE</code>标志允许通知持久。即使在节点发生故障之后，您也可以使用幸存的Oracle RAC实例来发送和检索连续查询通知消息，因为与此注册相关联的失效会持久排队到数据库中。如果为<code class="codeph">FALSE</code> ，则将失效排入快速内存中队列。此选项描述通知的持久性，而不是注册的持久性。默认情况下，注册会自动保留。
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>调用<code class="codeph">OCISubscriptionRegister()</code>以在<code class="codeph">DBCHANGE</code>命名空间中创建新注册。</span></li>
                        <li class="stepexpand"><span>通过设置语句句柄<code class="codeph">OCI_HTYPE_STMT</code>的属性<code class="codeph">OCI_ATTR_CHNF_REGHANDLE</code> ，将多个查询语句与订阅句柄相关<code class="codeph">OCI_ATTR_CHNF_REGHANDLE</code> 。执行查询时完成注册。</span><div>
                              <div class="infoboxnotealso" id="GUID-497F4BB3-33B1-4231-B664-F7BFD76F2AD0__GUID-681C929F-35B1-4A20-96B1-9E3020C8B9A8">
                                 <p class="notep1">也可以看看：</p>
                                 <p>有关<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI17861" target="_blank"><code class="codeph">OCI_ATTR_CHNF_REGHANDLE</code></a>详细信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI17861" target="_blank"><code class="codeph">OCI_ATTR_CHNF_REGHANDLE</code></a> <span class="italic">Oracle调用接口程序员指南</span></p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>（可选）取消注册订阅。客户端可以使用订阅句柄作为参数调用OCISubscriptionRegister（）函数。</span></li>
                     </ol>
                     <div class="section">
                        <p>语句句柄与预订句柄的绑定仅对第一次执行查询有效。如果应用程序必须使用相同的<span>OCI语句</span>句柄进行后续执行，则必须重新填充语句句柄的注册句柄属性。仅当语句是查询（在执行时确定）时，才允许将订阅句柄绑定到语句句柄。如果DML语句作为执行的一部分执行，则发出异常。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS685"></a><a id="ADFNS686"></a><a id="ADFNS684"></a><div class="props_rev_3"><a id="GUID-B6BE0F08-AFB7-4D6C-B5EB-8F85C43F1CD1" name="GUID-B6BE0F08-AFB7-4D6C-B5EB-8F85C43F1CD1"></a><h4 id="ADFNS-GUID-B6BE0F08-AFB7-4D6C-B5EB-8F85C43F1CD1" class="sect4">使用OCI订阅句柄属性进行连续查询通知</h4>
                  <div>
                     <div class="section">
                        <p>连续查询通知的订阅句柄属性可以分为通用属性（所有订阅共用）和命名空间特定属性（特别是连续查询通知）。</p>
                        <p>只有在创建注册之前，才能修改语句句柄上的<code class="codeph">WRITE</code>属性。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-B6BE0F08-AFB7-4D6C-B5EB-8F85C43F1CD1__GUID-BB5EB6C4-02C8-49BA-89D9-01D0CDE84B38">通用属性 - 所有订阅的共同属性</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><code class="codeph">OCI_ATTR_SUBSCR_NAMESPACE</code> （ <code class="codeph">WRITE</code> ） - 为订阅句柄设置此属性为<code class="codeph">OCI_SUBSCR_NAMESPACE_DBCHANGE</code> 。
                        </p>
                        <p><code class="codeph">OCI_ATTR_SUBSCR_CALLBACK</code> （ <code class="codeph">WRITE</code> ） - 使用此属性存储与订阅句柄关联的回调。收到通知时执行回调。
                        </p>
                        <p>当新的连续查询通知消息可用时，将在侦听器线程中调用回调，其中<code class="codeph">desc</code>指向包含有关失效的详细信息的<code class="codeph">OCI_DTYPE_CHDES</code>类型的描述符。
                        </p>
                        <p><code class="codeph">OCI_ATTR_SUBSCR_QOSFLAGS</code> - 此属性是具有以下值的通用标志：</p><pre class="oac_no_warn" dir="ltr">#define OCI_SUBSCR_QOS_RELIABLE 0x01 / *可靠* / #define OCI_SUBSCR_QOS_PURGE_ON_NTFN 0x10 / *清除第一个ntfn * /</pre><ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">OCI_SUBSCR_QOS_RELIABLE</code> - 设置此位以允许通知持久。因此，即使在节点发生故障之后，您也可以使用Oracle RAC集群的幸存实例来发送和检索失效消息，因为与此注册ID关联的失效会持久排队到数据库中。如果此位为<code class="codeph">FALSE</code> ，则将失效排入快速内存中队列。此选项描述通知的持久性，而不是注册的持久性。默认情况下，注册会自动保留。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">OCI_SUBSCR_QOS_PURGE_ON_NTFN</code> - 设置此位以允许在第一个通知上清除注册。
                              </p>
                           </li>
                        </ul>
                        <p><span class="italic">Oracle调用接口程序员指南</span> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI16715" target="_blank">中的OCI</a>中的<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI16715" target="_blank">发布 - 订阅注册功能中</a>提供了一个并行示例。</p>
                        <p><code class="codeph">OCI_ATTR_SUBSCR_CQ_QOSFLAGS</code> - 该属性描述了连续查询通知特定的QOS标志（模式为<code class="codeph">WRITE</code> ，数据类型为<code class="codeph">ub4</code> ），它们是：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">0x1 OCI_SUBSCR_CQ_QOS_QUERY</code> - 设置此标志以指示需要查询级粒度。仅在查询结果集更改时生成通知。默认情况下，此级别的QOS没有误报。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">0x2 OCI_SUBSCR_CQ_QOS_BEST_EFFORT</code> - 设置此标志以指示尽力过滤是可接受的。它可以由缓存应用程序使用。数据库可以使用基于评估成本的启发式方法，并在某些情况下避免完全修剪。
                              </p>
                           </li>
                        </ul>
                        <p><code class="codeph">OCI_ATTR_SUBSCR_TIMEOUT</code> - 使用此属性指定以秒为单位定义的<code class="codeph">ub4</code>超时值。如果超时值为0或未指定，则注册处于活动状态，直到显式取消注册。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-B6BE0F08-AFB7-4D6C-B5EB-8F85C43F1CD1__GUID-1EDD50D8-7B16-4A67-960F-11C4737FDAFC">命名空间特定或特定于功能的属性</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>以下属性是特定于命名空间或特定于连续查询通知功能的特征。</p>
                        <p><code class="codeph">OCI_ATTR_CHNF_TABLENAMES</code> （数据类型为<code class="codeph">(OCIColl *)</code> ） - 提供这些属性以检索已注册的表名列表。执行查询后，可以从订阅句柄获取这些属性。
                        </p>
                        <p><code class="codeph">OCI_ATTR_CHNF_ROWIDS</code> - 布尔属性（默认为<code class="codeph">FALSE</code> ）。如果为<code class="codeph">TRUE</code> ，则连续查询通知消息包括行级详细信息，例如操作类型和<code class="codeph">ROWID</code> 。</p>
                        <p><code class="codeph">OCI_ATTR_CHNF_OPERATIONS</code> - 使用此<code class="codeph">ub4</code>标志可根据操作类型有选择地过滤通知。如果注册具有查询级粒度，则忽略此选项。存储的标志是：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">OCI_OPCODE_ALL</code> - 所有操作</p>
                           </li>
                           <li>
                              <p><code class="codeph">OCI_OPCODE_INSERT</code> - 在表上插入操作</p>
                           </li>
                           <li>
                              <p><code class="codeph">OCI_OPCODE_UPDATE</code> - 更新表上的操作</p>
                           </li>
                           <li>
                              <p><code class="codeph">OCI_OPCODE_DELETE</code> - 删除表上的操作</p>
                           </li>
                        </ul>
                        <p><code class="codeph">OCI_ATTR_CHNF_CHANGELAG</code> - 客户端可以使用此<code class="codeph">ub4</code>值来指定客户端愿意滞后的事务数。客户端还可以将此选项用作连续查询通知消息的限制机制。选择此选项时，即使<code class="codeph">OCI_ATTR_CHNF_ROWIDS</code>为<code class="codeph">TRUE</code> ，通知中的<code class="codeph">ROWID</code>级别信息也不可用。如果注册具有查询级粒度，则忽略此选项。
                        </p>
                        <p>调用OCISubscriptionRegister（）调用后，无法在已创建的注册上修改上述属性（通用，特定于名称或特定于功能）。任何修改这些属性的尝试都不会反映在已创建的注册上，但它会对使用相同注册句柄的新创建的注册生效。</p>
                        <div class="infoboxnotealso" id="GUID-B6BE0F08-AFB7-4D6C-B5EB-8F85C43F1CD1__GUID-922A5AB5-75DF-49FA-9B57-823603C7CEE2">
                           <p class="notep1">也可以看看：</p>
                           <p>有关<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI17976" target="_blank">连续查询通知描述符属性的</a>更多信息，请参阅<span class="italic">“Oracle调用接口程序员指南”</span> 
                           </p>
                        </div>
                        <p>通过使用分组NTFN选项可以间隔通知。相关的通用通知属性是：</p><pre class="oac_no_warn" dir="ltr">OCI_ATTR_SUBSCR_NTFN_GROUPING_VALUE OCI_ATTR_SUBSCR_NTFN_GROUPING_TYPE OCI_ATTR_SUBSCR_NTFN_GROUPING_START_TIME OCI_ATTR_SUBSCR_NTFN_GROUPING_REPEAT_COUNT</pre><div class="infoboxnotealso" id="GUID-B6BE0F08-AFB7-4D6C-B5EB-8F85C43F1CD1__GUID-F78C54FB-1BA6-43F1-8B07-94CDFEBFD250">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="italic">Oracle调用接口程序员指南</span> ，了解有关<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI16716" target="_blank">发布 - 订阅中</a>这些属性的更多详细信息， <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI16716" target="_blank">直接注册到数据库</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS687"></a><div class="props_rev_3"><a id="GUID-96222028-5814-44E9-A37E-89D8EE897280" name="GUID-96222028-5814-44E9-A37E-89D8EE897280"></a><h4 id="ADFNS-GUID-96222028-5814-44E9-A37E-89D8EE897280" class="sect4">OCI_ATTR_CQ_QUERYID属性</h4>
                  <div>
                     <p>语句句柄上的属性<code class="codeph">OCI_ATTR_CQ_QUERYID</code> <code class="codeph">OCI_HTYPE_STMT</code>在通过调用<code class="codeph">OCIStmtExecute()</code>进行注册后获得已注册查询的查询ID。
                     </p>
                     <div class="infoboxnotealso" id="GUID-96222028-5814-44E9-A37E-89D8EE897280__GUID-FAF76643-8202-405E-B63F-CD9400A33FB9">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI17862" target="_blank"><code class="codeph">OCI_ATTR_CQ_QUERYID</code></a>详细信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI17862" target="_blank"><code class="codeph">OCI_ATTR_CQ_QUERYID</code></a> <span class="italic">Oracle Call Interface Programmer's Guide</span> 
                        </p>
                     </div>
                  </div>
               </div><a id="ADFNS688"></a><div class="props_rev_3"><a id="GUID-D2A55BA3-C631-43B2-811F-DAEA7C5104FC" name="GUID-D2A55BA3-C631-43B2-811F-DAEA7C5104FC"></a><h4 id="ADFNS-GUID-D2A55BA3-C631-43B2-811F-DAEA7C5104FC" class="sect4">使用OCI连续查询通知描述符</h4>
                  <div>
                     <div class="section">
                        <p>连续查询通知描述符被传递到应用程序指定的通知回调的<code class="codeph">desc</code>参数。以下属性特定于连续查询通知。连续查询通知描述符的OCI类型常量是<code class="codeph">OCI_DTYPE_CHDES</code> 。</p>
                        <p>通知回调接收顶级通知描述符<code class="codeph">OCI_DTYPE_CHDES</code>作为参数。这个描述符依次包括无论是收集<code class="codeph">OCI_DTYPE_CQDES</code>或<code class="codeph">OCI_DTYPE_TABLE_CHDES</code>根据事件类型是否是描述符<code class="codeph">OCI_EVENT_QUERYCHANGE</code>或<code class="codeph">OCI_EVENT_OBJCHANGE</code> 。表连续查询描述符数组嵌入在连续查询描述符内，用于<code class="codeph">OCI_EVENT_QUERYCHANGE</code>类型的通知。如果请求了<code class="codeph">ROWID</code>级别的信息粒度，则每个<code class="codeph">OCI_DTYPE_TABLE_CHDES</code>包含与每个修改的<code class="codeph">ROWID</code>相对应的行级连续查询描述符（ <code class="codeph">OCI_DTYPE_ROW_CHDES</code> ）的数组。</p>
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS689"></a><div class="props_rev_3"><a id="GUID-635139E3-40F9-49E2-8C3C-605771FB07D6" name="GUID-635139E3-40F9-49E2-8C3C-605771FB07D6"></a><h5 id="ADFNS-GUID-635139E3-40F9-49E2-8C3C-605771FB07D6" class="sect5">OCI_DTYPE_CHDES</h5>
                     <div>
                        <div class="section">
                           <p>这是顶级连续查询通知描述符类型。</p>
                           <p><code class="codeph">OCI_ATTR_CHDES_DBNAME</code> （ <code class="codeph">oratext *</code> ） - 数据库的名称（连续查询通知的来源）</p>
                           <p><code class="codeph">OCI_ATTR_CHDES_XID</code> （ <code class="codeph">RAW(8)</code> ） - 消息的消息ID</p>
                           <p><code class="codeph">OCI_ATTR_CHDES_NFYTYPE</code> - 描述通知类型的标志：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">0x0 OCI_EVENT_NONE</code> - 没有关于连续查询通知的进一步信息</p>
                              </li>
                              <li>
                                 <p><code class="codeph">0x1 OCI_EVENT_STARTUP</code> - 实例启动</p>
                              </li>
                              <li>
                                 <p><code class="codeph">0x2 OCI_EVENT_SHUTDOWN</code> - 实例关闭</p>
                              </li>
                              <li>
                                 <p><code class="codeph">0x3 OCI_EVENT_SHUTDOWN_ANY</code> - 任何实例关闭 -  Oracle Real Application Clusters（Oracle RAC）</p>
                              </li>
                              <li>
                                 <p><code class="codeph">0x5 OCI_EVENT_DEREG</code> - 未注册或超时</p>
                              </li>
                              <li>
                                 <p><code class="codeph">0x6 OCI_EVENT_OBJCHANGE</code> - 对象更改通知</p>
                              </li>
                              <li>
                                 <p><code class="codeph">0x7 OCI_EVENT_QUERYCHANGE</code> - 查询更改通知</p>
                              </li>
                           </ul>
                           <p><code class="codeph">OCI_ATTR_CHDES_TABLE_CHANGES</code> - 描述对数据类型表<code class="codeph">(OCIColl *)</code>操作的集合类型。仅当<code class="codeph">OCI_ATTR_CHDES_NFTYPE</code>属性的类型为<code class="codeph">OCI_EVENT_OBJCHANGE</code> ，才会显示此属性。否则，它是<code class="codeph">NULL</code> 。集合的每个元素都是一个<code class="codeph">OCI_DTYPE_TABLE_CHDES</code>类型的连续查询描述符表。</p>
                           <p><code class="codeph">OCI_ATTR_CHDES_QUERIES</code> - 描述失效查询的集合类型。集合的每个成员都是<code class="codeph">OCI_DTYPE_CQDES</code>类型。仅当属性<code class="codeph">OCI_ATTR_CHDES_NFTYPE</code>属于<code class="codeph">OCI_ATTR_CHDES_NFTYPE</code>类型时， <code class="codeph">OCI_EVENT_QUERYCHANGE</code>出现此属性。否则，它是<code class="codeph">NULL</code> 。</p>
                        </div>
                        <!-- class="section" -->
                     </div><a id="ADFNS690"></a><div class="props_rev_3"><a id="GUID-7C68A757-480C-44CB-9B57-A28363517F58" name="GUID-7C68A757-480C-44CB-9B57-A28363517F58"></a><h6 id="ADFNS-GUID-7C68A757-480C-44CB-9B57-A28363517F58" class="sect6">OCI_DTYPE_CQDES</h6>
                        <div>
                           <div class="section">
                              <p>此通知描述符描述了一个无效的查询，通常是为了响应DML或DDL事务的提交。它具有以下属性：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">OCI_ATTR_CQDES_OPERATION</code> （ <code class="codeph">ub4</code> ， <code class="codeph">READ</code> ） - 查询中发生的操作。它可以是以下值之一：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><code class="codeph">OCI_EVENT_QUERYCHANGE</code> - 查询结果集更改</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">OCI_EVENT_DEREG</code> - 查询未注册</p>
                                       </li>
                                    </ul>
                                 </li>
                                 <li>
                                    <p><code class="codeph">OCI_ATTR_CQDES_TABLE_CHANGES</code> （ <code class="codeph">OCIColl *</code> ， <code class="codeph">READ</code> ） - 表连续查询描述符的集合，描述导致查询结果集更改的表上的DML或DDL操作。集合的每个元素都是<code class="codeph">OCI_DTYPE_TABLE_CHDES</code>类型。</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">OCI_ATTR_CQDES_QUERYID</code> （ <code class="codeph">ub8</code> ， <code class="codeph">READ</code> ） - 查询失效的查询ID。
                                    </p>
                                 </li>
                              </ul>
                           </div>
                           <!-- class="section" -->
                        </div>
                     </div><a id="ADFNS691"></a><div class="props_rev_3"><a id="GUID-8F812E36-BF73-43F3-A8F6-DF7FBCD0CCF2" name="GUID-8F812E36-BF73-43F3-A8F6-DF7FBCD0CCF2"></a><h6 id="ADFNS-GUID-8F812E36-BF73-43F3-A8F6-DF7FBCD0CCF2" class="sect6">OCI_DTYPE_TABLE_CHDES</h6>
                        <div>
                           <div class="section">
                              <p>该通知描述符传达有关已注册查询中涉及的表的更改的信息。它具有以下属性：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">OCI_ATTR_CHDES_TABLE_NAME</code> <code class="codeph">(oratext *)</code> - 架构注释表名。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">OCI_ATTR_CHDES_TABLE_OPFLAGS</code> （ <code class="codeph">ub4</code> ） - 描述表上操作的标志字段。以下每个标志字段都位于属性中的单独位位置：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><code class="codeph">0x1 OCI_OPCODE_ALLROWS</code> - 表完全失效。
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">0x2 OCI_OPCODE_INSERT</code> - 在表上插入操作。
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">0x4 OCI_OPCODE_UPDATE</code> - 更新表上的操作。
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">0x8 OCI_OPCODE_DELETE</code> - 删除表上的操作。
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">0x10 OCI_OPCODE_ALTER</code> - 表已更改（架构更改）。这包括导致行迁移的DDL语句和内部操作。
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">0x20 OCI_OPCODE_DROP</code> - 表已删除。
                                          </p>
                                       </li>
                                    </ul>
                                 </li>
                                 <li>
                                    <p><code class="codeph">OCI_ATTR_CHDES_TABLE_ROW_CHANGES</code> - 这是一个嵌入式集合，用于描述表中行的更改。集合的每个元素都是<code class="codeph">OCI_DTYPE_ROW_CHDES</code>类型的行连续查询描述符，它具有以下属性：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><code class="codeph">OCI_ATTR_CHDES_ROW_ROWID</code> （ <code class="codeph">OraText *</code> ） - <code class="codeph">ROWID</code>字符串表示形式。</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">OCI_ATTR_CHDES_ROW_OPFLAGS</code> - 反映操作类型： <code class="codeph">INSERT</code> ， <code class="codeph">UPDATE</code> ， <code class="codeph">DELETE</code>或<code class="codeph">OTHER</code> 。</p>
                                       </li>
                                    </ul>
                                 </li>
                              </ul>
                              <div class="infoboxnotealso" id="GUID-8F812E36-BF73-43F3-A8F6-DF7FBCD0CCF2__GUID-000DA2C4-C34B-4AC2-9143-3DDE7E788331">
                                 <p class="notep1">也可以看看：</p>
                                 <p>有关<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI17976" target="_blank">连续查询通知描述符属性的</a>更多信息，请参阅<span class="italic">“Oracle调用接口程序员指南”</span> 
                                 </p>
                              </div>
                           </div>
                           <!-- class="section" -->
                        </div>
                     </div>
                  </div>
               </div><a id="ADFNS693"></a><a id="ADFNS692"></a><div class="props_rev_3"><a id="GUID-8CB2CED7-C1AC-4CD7-ADC2-240D2C5B9E22" name="GUID-8CB2CED7-C1AC-4CD7-ADC2-240D2C5B9E22"></a><h4 id="ADFNS-GUID-8CB2CED7-C1AC-4CD7-ADC2-240D2C5B9E22" class="sect4">在OCI示例程序中演示连续查询通知</h4>
                  <div>
                     <div class="section">
                        <p><a href="cqn.html#GUID-8CB2CED7-C1AC-4CD7-ADC2-240D2C5B9E22__BAJHEGDB">例18-8</a>是一个简单的OCI程序<code class="codeph">demoquery.c</code> 。请参阅清单中的评论。调用会话必须具有<code class="codeph">CHANGE</code> <code class="codeph">NOTIFICATION</code>系统特权以及它尝试注册的所有对象的<code class="codeph">SELECT</code>特权。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-8CB2CED7-C1AC-4CD7-ADC2-240D2C5B9E22__BAJHEGDB">
                        <p class="titleinexample">示例18-8演示连续查询通知的程序清单</p><pre class="oac_no_warn" dir="ltr">/ *版权所有（c）2010，Oracle。版权所有。* / #ifndef S_ORACLE #include &lt;oratypes.h&gt; #endif / *********************************** *************************************** *这是一个DEMO计划。要测试，请编译该文件以生成可执行文件* demoquery。然后可以从命令提示符调用demoquery。*它将具有以下输出：初始化OCI流程注册查询：从员工中选择last_name，employees.department_id，department_name，employee_id = 200的employees和employees.department_id = departments.department_id查询ID 23等待通知*然后从另一个会话，以HR / <span class="italic">&lt;密码&gt;登录</span>并执行以下* DML事务。它将导致生成两个通知。更新部门设置department_name ='全局管理员'，其中department_id = 10;承诺;更新部门设置department_name ='管理'，其中department_id = 10;承诺; * demoquery程序现在将显示以下与收到的通知相对应的输出*。查询23被更改表更改为HR.DEPARTMENTS table_op 4行更改为AAAMBoAABAAAKX2AAA row_op 4查询23已更改表已更改为HR.DEPARTMENTS table_op 4行已更改为AAAMBoAABAAAKX2AAA row_op 4 *演示程序等待正好接收10个通知*注销和取消注册订阅。************************************************** ************************* / / * ---------------------- -------------------------------------------------- ---私人类型和常态------------------------------------------- -------------------------------- * / / * -------------- -------------------------------------------------- -----------静态功能声明------------------------------------ --------------------------------------- * / #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;string.h&gt; #include &lt;oci.h&gt; #define MAXSTRLENGTH 1024 #define bit（a，b）（（a）＆（b））static int notifications_processed = 0; static OCISubscription * subhandle1 =（OCISubscription *）0; static OCISubscription * subhandle2 =（OCISubscription *）0; static void checker（/ * _ OCIError * errhp，sword status _ * /）; static void registerQuery（/ * _ OCISvcCtx * svchp，OCIError * errhp，OCIStmt * stmthp，OCIEnv * envhp _ * /）; static void myCallback（/ * _ dvoid * ctx，OCISubscription * subscrhp，dvoid * payload，ub4 * payl，dvoid * descriptor，ub4 mode _ * /）; static int NotificationDriver（/ * _ int argc，char * argv [] _ * /）;静态剑状态; static boolean logged_on = FALSE; static void processRowChanges（OCIEnv * envhp，OCIError * errhp，OCIStmt * stmthp，OCIColl * row_changes）; static void processTableChanges（OCIEnv * envhp，OCIError * errhp，OCIStmt * stmthp，OCIColl * table_changes）; static void processQueryChanges（OCIEnv * envhp，OCIError * errhp，OCIStmt * stmthp，OCIColl * query_changes）; static int nonractests2（/ * _ int argc，char * argv [] _ * /）; int main（int argc，char ** argv）{NotificationDriver（argc，argv）;返回0; } int NotificationDriver（argc，argv）int argc; char * argv []; {OCIEnv * envhp; OCISvcCtx * svchp，* svchp2; OCIError * errhp，* errhp2; OCISession * authp，* authp2; OCIStmt * stmthp，* stmthp2; OCIDuration dur，dur2; int i; dvoid * tmp; OCISession * usrhp; OCIServer * srvhp; printf（“初始化OCI过程\ n”）; / *初始化环境。必须使用OCI_EVENTS和OCI_OBJECT初始化环境，以创建连续查询通知注册并接收通知。* / OCIEnvCreate（（OCIEnv **）＆envhp，OCI_EVENTS | OCI_OBJECT，（dvoid *）0，（dvoid *（*）（dvoid *，size_t））0，（dvoid *（*）（dvoid *，dvoid *，size_t ））0，（void（*）（dvoid *，dvoid *））0，（size_t）0，（dvoid **）0）; OCIHandleAlloc（（dvoid *）envhp，（dvoid **）＆errhp，OCI_HTYPE_ERROR，（size_t）0，（dvoid **）0）; / *服务器上下文* / OCIHandleAlloc（（dvoid *）envhp，（dvoid **）＆srvhp，OCI_HTYPE_SERVER，（size_t）0，（dvoid **）0）; OCIHandleAlloc（（dvoid *）envhp，（dvoid **）＆svchp，OCI_HTYPE_SVCCTX，（size_t）0，（dvoid **）0）; checker（errhp，OCIServerAttach（srvhp，errhp，（text *）0，（sb4）0，（ub4）OCI_DEFAULT））; / *在服务上下文中设置属性服务器上下文* / OCIAttrSet（（dvoid *）svchp，（ub4）OCI_HTYPE_SVCCTX，（dvoid *）srvhp，（ub4）0，（ub4）OCI_ATTR_SERVER，（OCIError *）errhp）; / *分配用户上下文句柄* / OCIHandleAlloc（（dvoid *）envhp，（dvoid **）＆usrhp，（ub4）OCI_HTYPE_SESSION，（size_t）0，（dvoid **）0）; OCIAttrSet（（dvoid *）usrhp，（ub4）OCI_HTYPE_SESSION，（dvoid *）（（text *）“HR”），（ub4）strlen（（char *）“HR”），OCI_ATTR_USERNAME，errhp）; OCIAttrSet（（dvoid *）usrhp，（ub4）OCI_HTYPE_SESSION，（dvoid *）（（text *）“HR”），（ub4）strlen（（char *）“HR”），OCI_ATTR_PASSWORD，errhp）; checker（errhp，OCISessionBegin（svchp，errhp，usrhp，OCI_CRED_RDBMS，OCI_DEFAULT））; / *分配语句句柄* / OCIHandleAlloc（（dvoid *）envhp，（dvoid **）＆stmthp，（ub4）OCI_HTYPE_STMT，52，（dvoid **）＆tmp）; OCIAttrSet（（dvoid *）svchp，（ub4）OCI_HTYPE_SVCCTX，（dvoid *）usrhp，（ub4）0，OCI_ATTR_SESSION，errhp）; registerQuery（svchp，errhp，stmthp，envhp）; printf（“等待通知\ n”）; while（notifications_processed！= 10）{sleep（1）; } printf（“去取消注册HR \ n”）; fflush（stdout中）; / *取消注册HR * / checker（errhp，OCISubscriptionUnRegister（svchp，subhandle1，errhp，OCI_DEFAULT））; checker（errhp，OCISessionEnd（svchp，errhp，usrhp，（ub4）0））; printf（“HR Logged off。\ n”）; if（subhandle1）OCIHandleFree（（dvoid *）subhandle1，OCI_HTYPE_SUBSCRIPTION）; if（stmthp）OCIHandleFree（（dvoid *）stmthp，OCI_HTYPE_STMT）; if（srvhp）OCIHandleFree（（dvoid *）srvhp，（ub4）OCI_HTYPE_SERVER）; if（svchp）OCIHandleFree（（dvoid *）svchp，（ub4）OCI_HTYPE_SVCCTX）; if（authp）OCIHandleFree（（dvoid *）usrhp，（ub4）OCI_HTYPE_SESSION）; if（errhp）OCIHandleFree（（dvoid *）errhp，（ub4）OCI_HTYPE_ERROR）; if（envhp）OCIHandleFree（（dvoid *）envhp，（ub4）OCI_HTYPE_ENV）;返回0; } void checker（errhp，status）OCIError * errhp;剑的地位; {text errbuf [512]; sb4 errcode = 0; int retval = 1; switch（status）{case OCI_SUCCESS：retval = 0;打破; case OCI_SUCCESS_WITH_INFO：（void）printf（“Error  -  OCI_SUCCESS_WITH_INFO \ n”）;打破; case OCI_NEED_DATA：（void）printf（“Error  -  OCI_NEED_DATA \ n”）;打破; case OCI_NO_DATA：（void）printf（“Error  -  OCI_NODATA \ n”）;打破; case OCI_ERROR：（void）OCIErrorGet（（dvoid *）errhp，（ub4）1，（text *）NULL，＆errcode，errbuf，（ub4）sizeof（errbuf），OCI_HTYPE_ERROR）; （void）printf（“Error  - ％。* s \ n”，512，errbuf）;打破; case OCI_INVALID_HANDLE：（void）printf（“Error  -  OCI_INVALID_HANDLE \ n”）;打破; case OCI_STILL_EXECUTING：（void）printf（“Error  -  OCI_STILL_EXECUTE \ n”）;打破; case OCI_CONTINUE：（void）printf（“Error  -  OCI_CONTINUE \ n”）;打破;默认值：break; } if（retval）{exit（1）; void processRowChanges（OCIEnv * envhp，OCIError * errhp，OCIStmt * stmthp，OCIColl * row_changes）{dvoid ** row_descp; dvoid * row_desc;布尔存在; ub2 i，j; dvoid * elemind =（dvoid *）0; oratext * row_id; ub4 row_op; sb4 num_rows;如果（！row_changes）返回; checker（errhp，OCICollSize（envhp，errhp，（CONST OCIColl *）row_changes，＆num_rows））; for（i = 0; i &lt;num_rows; i ++）{checker（errhp，OCICollGetElem（envhp，errhp，（OCIColl *）row_changes，i，＆exist，＆row_descp，＆elemind））; row_desc = * row_descp; checker（errhp，OCIAttrGet（row_desc，OCI_DTYPE_ROW_CHDES，（dvoid *）＆row_id，NULL，OCI_ATTR_CHDES_ROW_ROWID，errhp））; checker（errhp，OCIAttrGet（row_desc，OCI_DTYPE_ROW_CHDES，（dvoid *）＆row_op，NULL，OCI_ATTR_CHDES_ROW_OPFLAGS，errhp））; printf（“行更改为％s row_op％d \ n”，row_id，row_op）; fflush（stdout中）; void processTableChanges（OCIEnv * envhp，OCIError * errhp，OCIStmt * stmthp，OCIColl * table_changes）{dvoid ** table_descp; dvoid * table_desc; dvoid ** row_descp; dvoid * row_desc; OCIColl * row_changes =（OCIColl *）0;布尔存在; ub2 i，j; dvoid * elemind =（dvoid *）0; oratext * table_name; ub4 table_op; sb4 num_tables;如果（！table_changes）返回; checker（errhp，OCICollSize（envhp，errhp，（CONST OCIColl *）table_changes，＆num_tables））; for（i = 0; i &lt;num_tables; i ++）{checker（errhp，OCICollGetElem（envhp，errhp，（OCIColl *）table_changes，i，＆exist，＆table_descp，＆elemind））; table_desc = * table_descp; checker（errhp，OCIAttrGet（table_desc，OCI_DTYPE_TABLE_CHDES，（dvoid *）＆table_name，NULL，OCI_ATTR_CHDES_TABLE_NAME，errhp））; checker（errhp，OCIAttrGet（table_desc，OCI_DTYPE_TABLE_CHDES，（dvoid *）＆table_op，NULL，OCI_ATTR_CHDES_TABLE_OPFLAGS，errhp））; checker（errhp，OCIAttrGet（table_desc，OCI_DTYPE_TABLE_CHDES，（dvoid *）＆row_changes，NULL，OCI_ATTR_CHDES_TABLE_ROW_CHANGES，errhp））; printf（“表更改为％s table_op％d \ n”，table_name，table_op）; fflush（stdout中）;如果（！bit（table_op，OCI_OPCODE_ALLROWS））processRowChanges（envhp，errhp，stmthp，row_changes）; void processQueryChanges（OCIEnv * envhp，OCIError * errhp，OCIStmt * stmthp，OCIColl * query_changes）{sb4 num_queries; ub8 queryid; OCINumber qidnum; ub4 queryop; dvoid * elemind =（dvoid *）0; dvoid * query_desc; dvoid ** query_descp; ub2 i;布尔存在; OCIColl * table_changes =（OCIColl *）0;如果（！query_changes）return; checker（errhp，OCICollSize（envhp，errhp，（CONST OCIColl *）query_changes，＆num_queries））; for（i = 0; i &lt;num_queries; i ++）{checker（errhp，OCICollGetElem（envhp，errhp，（OCIColl *）query_changes，i，＆exist，＆query_descp，＆elemind））; query_desc = * query_descp; checker（errhp，OCIAttrGet（query_desc，OCI_DTYPE_CQDES，（dvoid *）＆queryid，NULL，OCI_ATTR_CQDES_QUERYID，errhp））; checker（errhp，OCIAttrGet（query_desc，OCI_DTYPE_CQDES，（dvoid *）＆queryop，NULL，OCI_ATTR_CQDES_OPERATION，errhp））; printf（“查询％d被更改\ n”，queryid）; if（queryop == OCI_EVENT_DEREG）printf（“Query Deregistered \ n”）; checker（errhp，OCIAttrGet（query_desc，OCI_DTYPE_CQDES，（dvoid *）＆table_changes，NULL，OCI_ATTR_CQDES_TABLE_CHANGES，errhp））; processTableChanges（envhp，errhp，stmthp，table_changes）; void myCallback（ctx，subscrhp，payload，payl，descriptor，mode）dvoid * ctx; OCISubscription * subscrhp; dvoid *有效载荷; ub4 * payl; dvoid *描述符; ub4模式; {OCIColl * table_changes =（OCIColl *）0; OCIColl * row_changes =（OCIColl *）0; dvoid * change_descriptor = descriptor; ub4 notify_type; ub2 i，j; OCIEnv * envhp; OCIError * errhp; OCIColl * query_changes =（OCIColl *）0; OCIServer * srvhp; OCISvcCtx * svchp; OCISession * usrhp; dvoid * tmp; OCIStmt * stmthp; （void）OCIEnvInit（（OCIEnv **）＆envhp，OCI_DEFAULT，（size_t）0，（dvoid **）0）; （void）OCIHandleAlloc（（dvoid *）envhp，（dvoid **）＆errhp，OCI_HTYPE_ERROR，（size_t）0，（dvoid **）0）; / * server contexts * /（void）OCIHandleAlloc（（dvoid *）envhp，（dvoid **）＆srvhp，OCI_HTYPE_SERVER，（size_t）0，（dvoid **）0）; （void）OCIHandleAlloc（（dvoid *）envhp，（dvoid **）＆svchp，OCI_HTYPE_SVCCTX，（size_t）0，（dvoid **）0）; OCIAttrGet（change_descriptor，OCI_DTYPE_CHDES，（dvoid *）＆notify_type，NULL，OCI_ATTR_CHDES_NFYTYPE，errhp）; fflush（stdout中）; if（notify_type == OCI_EVENT_SHUTDOWN || notify_type == OCI_EVENT_SHUTDOWN_ANY）{printf（“SHUTDOWN NOTIFICATION RECEIVED \ n”）; fflush（stdout中）; notifications_processed ++;返回; } if（notify_type == OCI_EVENT_STARTUP）{printf（“STARTUP NOTIFICATION RECEIVED \ n”）; fflush（stdout中）; notifications_processed ++;返回; } notifications_processed ++; checker（errhp，OCIServerAttach（srvhp，errhp，（text *）0，（sb4）0，（ub4）OCI_DEFAULT））; OCIHandleAlloc（（dvoid *）envhp，（dvoid **）＆svchp，（ub4）OCI_HTYPE_SVCCTX，52，（dvoid **）＆tmp）; / *在服务上下文中设置属性服务器上下文* / OCIAttrSet（（dvoid *）svchp，（ub4）OCI_HTYPE_SVCCTX，（dvoid *）srvhp，（ub4）0，（ub4）OCI_ATTR_SERVER，（OCIError *）errhp）; / *分配用户上下文句柄* / OCIHandleAlloc（（dvoid *）envhp，（dvoid **）＆usrhp，（ub4）OCI_HTYPE_SESSION，（size_t）0，（dvoid **）0）; OCIAttrSet（（dvoid *）usrhp，（ub4）OCI_HTYPE_SESSION，（dvoid *）“HR”，（ub4）strlen（“HR”），OCI_ATTR_USERNAME，errhp）; OCIAttrSet（（dvoid *）usrhp，（ub4）OCI_HTYPE_SESSION，（dvoid *）“HR”，（ub4）strlen（“HR”），OCI_ATTR_PASSWORD，errhp）; checker（errhp，OCISessionBegin（svchp，errhp，usrhp，OCI_CRED_RDBMS，OCI_DEFAULT））; OCIAttrSet（（dvoid *）svchp，（ub4）OCI_HTYPE_SVCCTX，（dvoid *）usrhp，（ub4）0，OCI_ATTR_SESSION，errhp）; / *分配语句句柄* / OCIHandleAlloc（（dvoid *）envhp，（dvoid **）＆stmthp，（ub4）OCI_HTYPE_STMT，52，（dvoid **）＆tmp）; if（notify_type == OCI_EVENT_OBJCHANGE）{checker（errhp，OCIAttrGet（change_descriptor，OCI_DTYPE_CHDES，＆table_changes，NULL，OCI_ATTR_CHDES_TABLE_CHANGES，errhp））; processTableChanges（envhp，errhp，stmthp，table_changes）; } else if（notify_type == OCI_EVENT_QUERYCHANGE）{checker（errhp，OCIAttrGet（change_descriptor，OCI_DTYPE_CHDES，＆query_changes，NULL，OCI_ATTR_CHDES_QUERIES，errhp））; processQueryChanges（envhp，errhp，stmthp，query_changes）; } checker（errhp，OCISessionEnd（svchp，errhp，usrhp，OCI_DEFAULT））; checker（errhp，OCIServerDetach（srvhp，errhp，OCI_DEFAULT））; if（stmthp）OCIHandleFree（（dvoid *）stmthp，OCI_HTYPE_STMT）; if（errhp）OCIHandleFree（（dvoid *）errhp，OCI_HTYPE_ERROR）; if（srvhp）OCIHandleFree（（dvoid *）srvhp，OCI_HTYPE_SERVER）; if（svchp）OCIHandleFree（（dvoid *）svchp，OCI_HTYPE_SVCCTX）; if（usrhp）OCIHandleFree（（dvoid *）usrhp，OCI_HTYPE_SESSION）; if（envhp）OCIHandleFree（（dvoid *）envhp，OCI_HTYPE_ENV）; } void registerQuery（svchp，errhp，stmthp，envhp）OCISvcCtx * svchp; OCIError * errhp; OCIStmt * stmthp; OCIEnv * envhp; {OCISubscription * subscrhp; ub4 namespace = OCI_SUBSCR_NAMESPACE_DBCHANGE; ub4 timeout = 60; OCIDefine * defnp1 =（OCIDefine *）0; OCIDefine * defnp2 =（OCIDefine *）0; OCIDefine * defnp3 =（OCIDefine *）0; OCIDefine * defnp4 =（OCIDefine *）0; OCIDefine * defnp5 =（OCIDefine *）0; int mgr_id = 0; text query_text1 [] =“选择last_name，employees.department_id，department_name \，来自员工，部门，其中employee_id = 200，employees.department_id = \ departments.department_id”; ub4 num_prefetch_rows = 0; ub4 num_reg_tables; OCIColl * table_names; ub2 i; boolean rowids = TRUE; ub4 qosflags = OCI_SUBSCR_CQ_QOS_QUERY; int empno = 0; OCINumber qidnum; ub8 qid; char outstr [MAXSTRLENGTH]，dname [MAXSTRLENGTH]; int q3out; fflush（stdout中）; / *分配订阅句柄* / OCIHandleAlloc（（dvoid *）envhp，（dvoid **）＆subscrhp，OCI_HTYPE_SUBSCRIPTION，（size_t）0，（dvoid **）0）; / *将命名空间设置为DBCHANGE * / checker（errhp，OCIAttrSet（subscrhp，OCI_HTYPE_SUBSCRIPTION，（dvoid *）＆namespace，sizeof（ub4），OCI_ATTR_SUBSCR_NAMESPACE，errhp））; / *将通知回调与订阅* /检查器关联（errhp，OCIAttrSet（subscrhp，OCI_HTYPE_SUBSCRIPTION，（void *）myCallback，0，OCI_ATTR_SUBSCR_CALLBACK，errhp））; / *允许提取rowid信息* / checker（errhp，OCIAttrSet（subscrhp，OCI_HTYPE_SUBSCRIPTION，（dvoid *）＆rowids，sizeof（ub4），OCI_ATTR_CHNF_ROWIDS，errhp））; checker（errhp，OCIAttrSet（subscrhp，OCI_HTYPE_SUBSCRIPTION，（dvoid *）＆qosflags，sizeof（ub4），OCI_ATTR_SUBSCR_CQ_QOSFLAGS，errhp））; / *在DBCHANGE命名空间* / checker中创建一个新注册（errhp，OCISubscriptionRegister（svchp，＆subscrhp，1，errhp，OCI_DEFAULT））; / *现在可以将多个查询与订阅相关联* / subhandle1 = subscrhp; printf（“注册查询：％s \ n”，（const signed char *）query_text1）; / *准备语句* / checker（errhp，OCIStmtPrepare（stmthp，errhp，query_text1，（ub4）strlen（（const signed char *）query_text1），OCI_V7_SYNTAX，OCI_DEFAULT））; checker（errhp，OCIDefineByPos（stmthp，＆defnp1，errhp，1，（dvoid *）outstr，MAXSTRLENGTH * sizeof（char），SQLT_STR，（dvoid *）0，（ub2 *）0，（ub2 *）0，OCI_DEFAULT）） ; checker（errhp，OCIDefineByPos（stmthp，＆defnp2，errhp，2，（dvoid *）＆empno，sizeof（empno），SQLT_INT，（dvoid *）0，（ub2 *）0，（ub2 *）0，OCI_DEFAULT））; checker（errhp，OCIDefineByPos（stmthp，＆defnp3，errhp，3，（dvoid *）＆dname，sizeof（dname），SQLT_STR，（dvoid *）0，（ub2 *）0，（ub2 *）0，OCI_DEFAULT））; / *将语句与订阅句柄* / OCIAttrSet（stmthp，OCI_HTYPE_STMT，subscrhp，0，OCI_ATTR_CHNF_REGHANDLE，errhp）相关联; / *执行语句，执行执行对象注册* / checker（errhp，OCIStmtExecute（svchp，stmthp，errhp，（ub4）1，（ub4）0，（CONST OCISnapshot *）NULL，（OCISnapshot *）NULL，OCI_DEFAULT） ）; fflush（stdout中）; OCIAttrGet（stmthp，OCI_HTYPE_STMT，＆qid，（ub4 *）0，OCI_ATTR_CQ_QUERYID，errhp）; printf（“查询ID％d \ n”，qid）; / * commit * / checker（errhp，OCITransCommit（svchp，errhp，（ub4）0））; } static void cleanup（envhp，svchp，srvhp，errhp，usrhp）OCIEnv * envhp; OCISvcCtx * svchp; OCIServer * srvhp; OCIError * errhp; OCISession * usrhp; {/ *从服务器* / checker分离（errhp，OCISessionEnd（svchp，errhp，usrhp，OCI_DEFAULT））; checker（errhp，OCIServerDetach（srvhp，errhp，（ub4）OCI_DEFAULT））; if（usrhp）（void）OCIHandleFree（（dvoid *）usrhp，（ub4）OCI_HTYPE_SESSION）; if（svchp）（void）OCIHandleFree（（dvoid *）svchp，（ub4）OCI_HTYPE_SVCCTX）; if（srvhp）（void）OCIHandleFree（（dvoid *）srvhp，（ub4）OCI_HTYPE_SERVER）; if（errhp）（void）OCIHandleFree（（dvoid *）errhp，（ub4）OCI_HTYPE_ERROR）; if（envhp）（void）OCIHandleFree（（dvoid *）envhp，（ub4）OCI_HTYPE_ENV）; }</pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div><a id="ADFNS1301"></a><div class="props_rev_3"><a id="GUID-A74B4631-B908-45C3-801E-B6986603918F" name="GUID-A74B4631-B908-45C3-801E-B6986603918F"></a><h3 id="ADFNS-GUID-A74B4631-B908-45C3-801E-B6986603918F" class="sect3">查询CQN注册</h3>
               <div>
                  <div class="section">
                     <p>要查看有关所有注册的顶级信息（包括其QOS选项），请查询静态数据字典视图<code class="codeph">*_CHANGE_NOTIFICATION_REGS</code> 。</p>
                     <p>例如，您可以获取客户端的注册ID以及接收通知的对象列表。要查看<code class="codeph">HR</code>注册ID和表名，请使用以下查询：</p><pre class="oac_no_warn" dir="ltr">SELECT <span class="italic">regid</span> ， <span class="italic">table_name</span> FROM USER_CHANGE_NOTIFICATION_REGS;</pre><p>要查看为QRCN注册了哪些查询，请查询静态数据字典视图<code class="codeph">USER_CQ_NOTIFICATION_QUERIES</code>或<code class="codeph">DBA_CQ_NOTIFICATION_QUERIES</code> 。这些视图包含有关查询使用的任何绑定值的信息。在这些视图中，原始查询中的绑定值作为常量包含在查询文本中。查询文本与已注册的原始查询等效，但可能不完全相同。
                     </p>
                     <div class="infoboxnotealso" id="GUID-A74B4631-B908-45C3-801E-B6986603918F__GUID-8C05CB2A-C573-4340-AB18-083CE6429127">
                        <p class="notep1">也可以看看：</p>
                        <p>有关静态数据字典视图的更多信息，请参阅<span class="italic">Oracle数据库参考</span> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=REFRN23537" target="_blank"><code class="codeph">USER_CHANGE_NOTIFICATION_REGS</code></a>和<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=REFRN23626" target="_blank"><code class="codeph">DBA_CQ_NOTIFICATION_QUERIES</code></a></p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="ADFNS1066"></a><a id="ADFNS1017"></a><div class="props_rev_3"><a id="GUID-2A42CDAB-DBB9-4785-B67B-2E0803F1EAB2" name="GUID-2A42CDAB-DBB9-4785-B67B-2E0803F1EAB2"></a><h3 id="ADFNS-GUID-2A42CDAB-DBB9-4785-B67B-2E0803F1EAB2" class="sect3">解释通知</h3>
               <div>
                  <div class="section">
                     <p>当事务提交时，数据库确定是否在事务中修改了已注册的对象。如果是这样，它将运行注册中指定的通知处理程序。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-2A42CDAB-DBB9-4785-B67B-2E0803F1EAB2__GUID-320C89CF-BDB0-41F3-85EE-00EC2ACB1690">话题：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="cqn.html#GUID-014D005B-34DA-41A9-93A6-AC347C9FAC19">解释CQ_NOTIFICATION $ _DESCRIPTOR对象</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-7C3B9794-BE25-4D88-B4B8-9F5B6A271CC2">解释CQ_NOTIFICATION $ _TABLE对象</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-03A79EF0-253A-4CA0-80F6-593EDC97532B">解释CQ_NOTIFICATION $ _QUERY对象</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-55474F05-0919-4771-964E-97113D66EC4F">解释CQ_NOTIFICATION $ _ROW对象</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS586"></a><a id="ADFNS585"></a><div class="props_rev_3"><a id="GUID-014D005B-34DA-41A9-93A6-AC347C9FAC19" name="GUID-014D005B-34DA-41A9-93A6-AC347C9FAC19"></a><h4 id="ADFNS-GUID-014D005B-34DA-41A9-93A6-AC347C9FAC19" class="sect4">解释CQ_NOTIFICATION $ _DESCRIPTOR对象</h4>
                  <div>
                     <div class="section">
                        <p><a id="d102353e9310" class="indexterm-anchor"></a>当CQN注册生成通知时，数据库将<code class="codeph">CQ_NOTIFICATION$_DESCRIPTOR</code>对象传递给通知处理程序。通知处理程序可以在<code class="codeph">CQ_NOTIFICATION$_DESCRIPTOR</code>对象的属性中查找数据库更改的详细信息。
                        </p>
                        <p>在SQL * Plus中，您可以通过以<code class="codeph">SYS</code>身份连接并运行此语句来列出这些属性：</p><pre class="oac_no_warn" dir="ltr">DESC CQ_NOTIFICATION $ _DESCRIPTOR</pre><p><a href="cqn.html#GUID-014D005B-34DA-41A9-93A6-AC347C9FAC19__CHEDAHIA" title="此表汇总了SYS.CHNF $ _REG_INFO_OC4J数据类型的属性。">表18-4</a>总结了<code class="codeph">CQ_NOTIFICATION$_DESCRIPTOR</code>的属性。</p>
                        <div class="tblformal" id="GUID-014D005B-34DA-41A9-93A6-AC347C9FAC19__CHEDAHIA">
                           <p class="titleintable">表18-4 CQ_NOTIFICATION $ _DESCRIPTOR的属性</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="CQ_NOTIFICATION $ _DESCRIPTOR的属性" width="100%" border="1" summary="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="24%" id="d102353e9345">属性</th>
                                    <th align="left" valign="bottom" width="76%" id="d102353e9348">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d102353e9353" headers="d102353e9345 ">
                                       <p><code class="codeph">REGISTRATION_ID</code></p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d102353e9353 d102353e9348 ">
                                       <p>注册期间返回的注册ID。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d102353e9361" headers="d102353e9345 ">
                                       <p><code class="codeph">TRANSACTION_ID</code></p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d102353e9361 d102353e9348 ">
                                       <p>进行更改的事务的ID。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d102353e9369" headers="d102353e9345 ">
                                       <p><code class="codeph">DBNAME</code></p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d102353e9369 d102353e9348 ">
                                       <p>生成通知的数据库的名称。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d102353e9377" headers="d102353e9345 ">
                                       <p><code class="codeph">事件类型</code></p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d102353e9377 d102353e9348 ">
                                       <p>触发通知的数据库事件。例如，属性可以包含这些常量，这些常量对应于不同的数据库事件：</p>
                                       <ul style="list-style-type:disc">
                                          <li>
                                             <p><code class="codeph">EVENT_NONE</code></p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EVENT_STARTUP</code> （实例启动）</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EVENT_SHUTDOWN</code> （实例关闭 -  Oracle RAC的最后一次实例关闭）</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EVENT_SHUTDOWN_ANY</code> （Oracle RAC的任何实例关闭）</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EVENT_DEREG</code> （已注册已删除）</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EVENT_OBJCHANGE</code> （更改为已注册的表）</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EVENT_QUERYCHANGE</code> （更改为注册结果集）</p>
                                          </li>
                                       </ul>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d102353e9420" headers="d102353e9345 ">
                                       <p><code class="codeph">NUMTABLES</code></p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d102353e9420 d102353e9348 ">
                                       <p>已修改的表的数量。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d102353e9428" headers="d102353e9345 ">
                                       <p><code class="codeph">TABLE_DESC_ARRAY</code></p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d102353e9428 d102353e9348 ">
                                       <p>该字段仅适用于OCN注册。对于QRCN注册，它为<code class="codeph">NULL</code> 。</p>
                                       <p>如果<code class="codeph">EVENT_TYPE</code>是<code class="codeph">EVENT_OBJCHANGE</code> ]： <code class="codeph">CQ_NOTIFICATION$_TABLE</code>类型的表更改描述符的<code class="codeph">VARRAY</code> ，每个表更改描述符对应于更改的表。有关<code class="codeph">CQ_NOTIFICATION$_TABLE</code>属性，请<a href="cqn.html#GUID-7C3B9794-BE25-4D88-B4B8-9F5B6A271CC2__CHEGCHEE" title="此表汇总了SYS.CHNF $ _REG_INFO_OC4J数据类型的属性。">参见表18-5</a> 。
                                       </p>
                                       <p>否则： <code class="codeph">NULL</code> 。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d102353e9467" headers="d102353e9345 ">
                                       <p><code class="codeph">QUERY_DESC_ARRAY</code></p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d102353e9467 d102353e9348 ">
                                       <p>此字段仅适用于QRCN注册。对于OCN注册，它为<code class="codeph">NULL</code> 。</p>
                                       <p>如果<code class="codeph">EVENT_TYPE</code>是<code class="codeph">EVENT_QUERYCHANGE</code> ]：类型为<code class="codeph">CQ_NOTIFICATION$_QUERY</code>的结果集更改描述符的<code class="codeph">VARRAY</code> ，其中每个描述符对应于更改的结果集。有关<code class="codeph">CQ_NOTIFICATION$_QUERY</code>属性，请<a href="cqn.html#GUID-03A79EF0-253A-4CA0-80F6-593EDC97532B__CHDGBGHJ" title="此表汇总了SYS.CHNF $ _REG_INFO_OC4J数据类型的属性。">参见表18-6</a> 。
                                       </p>
                                       <p>否则： <code class="codeph">NULL</code> 。</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS588"></a><a id="ADFNS587"></a><div class="props_rev_3"><a id="GUID-7C3B9794-BE25-4D88-B4B8-9F5B6A271CC2" name="GUID-7C3B9794-BE25-4D88-B4B8-9F5B6A271CC2"></a><h4 id="ADFNS-GUID-7C3B9794-BE25-4D88-B4B8-9F5B6A271CC2" class="sect4">解释CQ_NOTIFICATION $ _TABLE对象</h4>
                  <div>
                     <div class="section">
                        <p>该<a id="d102353e9604" class="indexterm-anchor"></a> <code class="codeph">CQ_NOTIFICATION$_DESCRIPTOR</code>类型包含称为属性<code class="codeph">TABLE_DESC_ARRAY</code> ，其持有<code class="codeph">VARRAY</code>类型的表描述的<code class="codeph">CQ_NOTIFICATION$_TABLE</code> 。</p>
                        <p>在SQL * Plus中，您可以通过以<code class="codeph">SYS</code>身份连接并运行此语句来列出这些属性：</p><pre class="oac_no_warn" dir="ltr">DESC CQ_NOTIFICATION $ _TABLE</pre><p><a href="cqn.html#GUID-7C3B9794-BE25-4D88-B4B8-9F5B6A271CC2__CHEGCHEE" title="此表汇总了SYS.CHNF $ _REG_INFO_OC4J数据类型的属性。">表18-5</a>总结了<code class="codeph">CQ_NOTIFICATION$_TABLE</code>的属性。</p>
                        <div class="tblformal" id="GUID-7C3B9794-BE25-4D88-B4B8-9F5B6A271CC2__CHEGCHEE">
                           <p class="titleintable">表18-5 CQ_NOTIFICATION $ _TABLE的属性</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="CQ_NOTIFICATION $ _TABLE的属性" width="100%" border="1" summary="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="21%" id="d102353e9644">属性</th>
                                    <th align="left" valign="bottom" width="79%" id="d102353e9647">指定。 。 。</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d102353e9652" headers="d102353e9644 ">
                                       <p><code class="codeph">OPFLAGS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="79%" headers="d102353e9652 d102353e9647 ">
                                       <p>在修改的表上执行的操作类型。例如，属性可以包含这些常量，这些常量对应于不同的数据库操作：</p>
                                       <ul style="list-style-type:disc">
                                          <li>
                                             <p><code class="codeph">ALL_ROWS</code>表示整个表被修改，如在<code class="codeph">DELETE</code> <code class="codeph">*</code> ，或者通知中未请求或不提供行级粒度的信息，并且收件人必须假定整个表已更改</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">UPDATEOP</code>表示更新</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">DELETEOP</code>表示删除</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">ALTEROP</code>表示<code class="codeph">ALTER</code> <code class="codeph">TABLE</code></p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">DROPOP</code>表示<code class="codeph">DROP</code> <code class="codeph">TABLE</code></p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">UNKNOWNOP</code>表示未知操作</p>
                                          </li>
                                       </ul>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d102353e9707" headers="d102353e9644 ">
                                       <p><code class="codeph">TABLE_NAME</code></p>
                                    </td>
                                    <td align="left" valign="top" width="79%" headers="d102353e9707 d102353e9647 ">
                                       <p>修改后的表的名称。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d102353e9715" headers="d102353e9644 ">
                                       <p><code class="codeph">numRows行</code></p>
                                    </td>
                                    <td align="left" valign="top" width="79%" headers="d102353e9715 d102353e9647 ">
                                       <p>修改行的数量。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d102353e9723" headers="d102353e9644 ">
                                       <p><code class="codeph">ROW_DESC_ARRAY</code></p>
                                    </td>
                                    <td align="left" valign="top" width="79%" headers="d102353e9723 d102353e9647 ">
                                       <p><a href="cqn.html#GUID-55474F05-0919-4771-964E-97113D66EC4F__CHEBBJJB" title="此表汇总了SYS.CHNF $ _REG_INFO_OC4J数据类型的属性。">表18-7</a>描述的<code class="codeph">CQ_NOTIFICATION$_ROW</code>类型的行描述符的<code class="codeph">VARRAY</code> 。如果在<code class="codeph">ALL_ROWS</code>中设置了<code class="codeph">opflags</code> ，则<code class="codeph">ROW_DESC_ARRAY</code>成员为<code class="codeph">NULL</code> 。</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS590"></a><a id="ADFNS589"></a><div class="props_rev_3"><a id="GUID-03A79EF0-253A-4CA0-80F6-593EDC97532B" name="GUID-03A79EF0-253A-4CA0-80F6-593EDC97532B"></a><h4 id="ADFNS-GUID-03A79EF0-253A-4CA0-80F6-593EDC97532B" class="sect4">解释CQ_NOTIFICATION $ _QUERY对象</h4>
                  <div>
                     <div class="section">
                        <p>该<a id="d102353e9854" class="indexterm-anchor"></a> <code class="codeph">CQ_NOTIFICATION$_DESCRIPTOR</code>类型包含称为属性<code class="codeph">QUERY_DESC_ARRAY</code> ，其持有<code class="codeph">VARRAY</code>类型的结果集变化的描述符<code class="codeph">CQ_NOTIFICATION$_QUERY</code> 。</p>
                        <p>在SQL * Plus中，您可以通过以<code class="codeph">SYS</code>身份连接并运行此语句来列出这些属性：</p><pre class="oac_no_warn" dir="ltr">DESC CQ_NOTIFICATION $ _QUERY</pre><p><a href="cqn.html#GUID-03A79EF0-253A-4CA0-80F6-593EDC97532B__CHDGBGHJ" title="此表汇总了SYS.CHNF $ _REG_INFO_OC4J数据类型的属性。">表18-6</a>总结了<code class="codeph">CQ_NOTIFICATION$_QUERY</code>的属性。</p>
                        <div class="tblformal" id="GUID-03A79EF0-253A-4CA0-80F6-593EDC97532B__CHDGBGHJ">
                           <p class="titleintable">表18-6 CQ_NOTIFICATION $ _QUERY的属性</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="CQ_NOTIFICATION $ _QUERY的属性" width="100%" border="1" summary="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="27%" id="d102353e9894">属性</th>
                                    <th align="left" valign="bottom" width="73%" id="d102353e9897">指定。 。 。</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="27%" id="d102353e9902" headers="d102353e9894 ">
                                       <p><code class="codeph">QUERYID</code></p>
                                    </td>
                                    <td align="left" valign="top" width="73%" headers="d102353e9902 d102353e9897 ">
                                       <p>已更改查询的查询ID。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="27%" id="d102353e9910" headers="d102353e9894 ">
                                       <p><code class="codeph">QUERYOP</code></p>
                                    </td>
                                    <td align="left" valign="top" width="73%" headers="d102353e9910 d102353e9897 ">
                                       <p>更改查询的操作（ <code class="codeph">EVENT_QUERYCHANGE</code>或<code class="codeph">EVENT_DEREG</code> ）。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="27%" id="d102353e9924" headers="d102353e9894 ">
                                       <p><code class="codeph">TABLE_DESC_ARRAY</code></p>
                                    </td>
                                    <td align="left" valign="top" width="73%" headers="d102353e9924 d102353e9897 ">
                                       <p>一个类型为<code class="codeph">CQ_NOTIFICATION$_TABLE</code>的表更改描述符的<code class="codeph">VARRAY</code> ，每个描述符对应一个导致结果集发生更改的已更改表。有关<code class="codeph">CQ_NOTIFICATION$_TABLE</code>属性，请<a href="cqn.html#GUID-7C3B9794-BE25-4D88-B4B8-9F5B6A271CC2__CHEGCHEE" title="此表汇总了SYS.CHNF $ _REG_INFO_OC4J数据类型的属性。">参见表18-5</a> 。
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS592"></a><a id="ADFNS591"></a><div class="props_rev_3"><a id="GUID-55474F05-0919-4771-964E-97113D66EC4F" name="GUID-55474F05-0919-4771-964E-97113D66EC4F"></a><h4 id="ADFNS-GUID-55474F05-0919-4771-964E-97113D66EC4F" class="sect4">解释CQ_NOTIFICATION $ _ROW对象</h4>
                  <div>
                     <div class="section">
                        <p>如果在注册期间指定了<code class="codeph">ROWID</code>选项，则<code class="codeph">CQ_NOTIFICATION$_TABLE</code>类型具有<code class="codeph">ROW_DESC_ARRAY</code>属性，类型为<code class="codeph">VARRAY</code> <a id="d102353e10056" class="indexterm-anchor"></a> <code class="codeph">CQ_NOTIFICATION$_ROW</code>包含已更改行的<code class="codeph">ROWID</code> 。如果<code class="codeph">ALL_ROWS</code>是在设定<code class="codeph">OPFLAGS</code>基于场<code class="codeph">CQ_NOTIFICATION$_TABLE</code>对象，那么<code class="codeph">ROWID</code>信息不可用。
                        </p>
                        <p><a href="cqn.html#GUID-55474F05-0919-4771-964E-97113D66EC4F__CHEBBJJB" title="此表汇总了SYS.CHNF $ _REG_INFO_OC4J数据类型的属性。">表18-7</a>总结了<code class="codeph">CQ_NOTIFICATION$_ROW</code>的属性。</p>
                        <div class="tblformal" id="GUID-55474F05-0919-4771-964E-97113D66EC4F__CHEBBJJB">
                           <p class="titleintable">表18-7 CQ_NOTIFICATION $ _ROW的属性</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="CQ_NOTIFICATION $ _ROW的属性" width="100%" border="1" summary="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="27%" id="d102353e10096">属性</th>
                                    <th align="left" valign="bottom" width="73%" id="d102353e10099">指定。 。 。</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="27%" id="d102353e10104" headers="d102353e10096 ">
                                       <p><code class="codeph">OPFLAGS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="73%" headers="d102353e10104 d102353e10099 ">
                                       <p>在修改的表上执行的操作类型。请参阅<a href="cqn.html#GUID-7C3B9794-BE25-4D88-B4B8-9F5B6A271CC2__CHEGCHEE" title="此表汇总了SYS.CHNF $ _REG_INFO_OC4J数据类型的属性。">表18-5中</a>的<code class="codeph">OPFLAGS</code>说明。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="27%" id="d102353e10120" headers="d102353e10096 ">
                                       <p><code class="codeph">ROW_ID</code></p>
                                    </td>
                                    <td align="left" valign="top" width="73%" headers="d102353e10120 d102353e10099 ">
                                       <p>已更改行的<code class="codeph">ROWID</code> 。
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>