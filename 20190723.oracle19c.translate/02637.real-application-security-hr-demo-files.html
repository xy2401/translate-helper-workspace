<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>真实应用程序安全HR演示文件</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Real Application Security Administrator&#39;s and Developer&#39;s Guide "></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Real Application Security Administrator&#39;s and Developer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="real-application-security-administrators-and-developers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-11T05:21:48-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2012, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E95725-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="configuring-oci-and-jdbc-applications-for-column-authorization.html" title="Previous" type="text/html"></link>
      <link rel="next" href="troubleshooting_real_application_security.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Real Application Security Administrator&#39;s and Developer&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="DBFSG"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="configuring-oci-and-jdbc-applications-for-column-authorization.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="troubleshooting_real_application_security.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Real Application Security管理员和开发人员指南</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">真实应用程序安全HR演示文件</li>
            </ol>
            <a id="GUID-9289D66D-6426-4CE5-9E5E-941A360B0E9C" name="GUID-9289D66D-6426-4CE5-9E5E-941A360B0E9C"></a><a id="DBFSG819"></a>
            
            <h2 id="DBFSG-GUID-9289D66D-6426-4CE5-9E5E-941A360B0E9C" class="sect2"><span class="enumeration_appendix">C</span> Real Application Security HR演示文件</h2>
         </header>
         <div class="ind">
            <div>
               <p>本附录包含源文件和日志文件。可以在<a href="real-application-security-hr-demo.html#GUID-F38C8CA7-05B0-4939-AF59-741D8EF7FB87" title="介绍如何使用RASADM使用图形用户界面创建Real Application Security数据安全策略。描述如何运行RASADM应用程序。在设计阶段，您可以识别应用程序执行的所有任务，这些任务需要应用程序权限才能控制数据访问。要使用RASADM开发数据安全策略，您必须遵循一些基本步骤。介绍如何使用RASADM创建HR Demo应用程序。描述如何创建应用程序角色，特别是数据库DB_EMP角色。描述如何使用RASADM创建应用程序角色。描述创建应用程序用户并授予他们角色。描述使用RASADM创建应用程序用户。描述用于创建数据安全策略的流程。描述使用RASADM应用程序输入数据安全策略信息。描述创建数据安全策略的列授权部分。描述创建数据安全策略的数据领域授权部分。描述应用数据安全策略。">Real Application Security HR Demo中</a>找到HR演示的详细说明。
               </p>
               <div class="p">本附录描述了以下主题：<ul style="list-style-type:disc">
                     <li>
                        <p><a href="real-application-security-hr-demo-files.html#GUID-8DB26655-69C4-41C0-8C55-66415125BDB0">如何运行安全HR演示</a></p>
                     </li>
                     <li>
                        <p><a href="real-application-security-hr-demo-files.html#GUID-5953585D-D2F7-47E5-B27E-A81DCEC2CA52">安全HR演示的脚本</a></p>
                     </li>
                     <li>
                        <p><a href="real-application-security-hr-demo-files.html#GUID-95FB6E3E-1119-47A6-9E82-C17AC5CC6850">为每个脚本生成日志文件</a></p>
                     </li>
                  </ul>
               </div>
            </div><a id="DBFSG820"></a><div class="props_rev_3"><a id="GUID-8DB26655-69C4-41C0-8C55-66415125BDB0" name="GUID-8DB26655-69C4-41C0-8C55-66415125BDB0"></a><h3 id="DBFSG-GUID-8DB26655-69C4-41C0-8C55-66415125BDB0" class="sect3">如何运行安全HR演示</h3>
               <div>
                  <div class="section">
                     <p>要运行Security HR演示，请按所示顺序运行以下脚本：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li><span>运行安装脚本<code class="codeph">hrdemo_setup.sql</code> ，它将创建日志文件： <code class="codeph">hrdemo_setup.log</code> 。</span></li>
                     <li><span>使用直接登录运行演示脚本<code class="codeph">hrdemo.sql</code> ，这将创建日志文件： <code class="codeph">hrdemo.log</code> 。</span></li>
                     <li><span>运行演示脚本以显式创建并附加到Real Application Security会话<code class="codeph">hrdemo_session.sql</code> ，该会话创建日志文件： <code class="codeph">hrdemo_session.log</code> 。</span></li>
                     <li><span>运行Java demo <code class="codeph">hrdemo.java</code>文件，该文件创建日志文件： <code class="codeph">hrdemo.log</code> 。</span></li>
                     <li><span>运行清理脚本<code class="codeph">hrdemo_clean.sql</code> ，它创建日志文件： <code class="codeph">hrdemo_clean.log</code> 。</span></li>
                  </ol>
               </div>
            </div><a id="DBFSG822"></a><a id="DBFSG821"></a><div class="props_rev_3"><a id="GUID-5953585D-D2F7-47E5-B27E-A81DCEC2CA52" name="GUID-5953585D-D2F7-47E5-B27E-A81DCEC2CA52"></a><h3 id="DBFSG-GUID-5953585D-D2F7-47E5-B27E-A81DCEC2CA52" class="sect3">安全HR演示的脚本</h3>
               <div>
                  <div class="section">
                     <p><a href="real-application-security-hr-demo-files.html#GUID-5953585D-D2F7-47E5-B27E-A81DCEC2CA52__CEGGEEAB" title="此表列出了HR演示脚本的源文件和生成的日志文件。该表有2列。第1列是脚本名称，第2列是运行脚本时生成的日志文件的名称。">表C-1</a>列出了脚本和生成的日志文件，其中包含指向每个文件内容的链接。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="tblformal" id="GUID-5953585D-D2F7-47E5-B27E-A81DCEC2CA52__CEGGEEAB">
                     <p class="titleintable">表C-1 HR演示脚本和日志文件</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="HR演示脚本和日志文件" width="100%" border="1" summary="This table lists the source files and the generated log files for the HR demo scripts. This table has 2 columns. Column 1 is the script name and column 2 is the name of the log file that is generated when the script is run." frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="31%" id="d134082e424">脚本</th>
                              <th align="left" valign="bottom" width="69%" id="d134082e427">日志文件</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="31%" id="d134082e432" headers="d134082e424 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-E7974492-8418-4DAD-8497-530F3A669064">hrdemo_setup.sql</a></p>
                              </td>
                              <td align="left" valign="top" width="69%" headers="d134082e432 d134082e427 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-2EFC5D83-9586-4B06-93B7-190197A8821A">hrdemo_setup.log</a></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="31%" id="d134082e443" headers="d134082e424 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-37A422AF-7AAB-4CC0-9E49-0D4BD2ED5F0F">hrdemo.sql</a></p>
                              </td>
                              <td align="left" valign="top" width="69%" headers="d134082e443 d134082e427 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-65F8FD60-F26D-4E63-97CB-DC310B64C078">hrdemo.log</a></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="31%" id="d134082e454" headers="d134082e424 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-933185DA-9B2F-4530-9B3A-91A034818B0A">hrdemo_session.sql</a></p>
                              </td>
                              <td align="left" valign="top" width="69%" headers="d134082e454 d134082e427 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-9D131D01-1A54-4771-AD08-1FD36415E2AD">hrdemo_session.log</a></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="31%" id="d134082e465" headers="d134082e424 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-C19275DF-6D8C-4D3B-8B8F-A83766CB5F61">hrdemo.java</a></p>
                              </td>
                              <td align="left" valign="top" width="69%" headers="d134082e465 d134082e427 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-E041C7EE-68C9-4495-BC1F-F87A3B567A98">hrdemo.log</a></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="31%" id="d134082e476" headers="d134082e424 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-4BAA592E-CD45-4789-A371-96A3BC3668D0">hrdemo_clean.sql</a></p>
                              </td>
                              <td align="left" valign="top" width="69%" headers="d134082e476 d134082e427 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-027FBD01-2EFE-47C8-A84F-5E52B5469382">hrdemo_clean.log</a></p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <div class="section">
                     <p>本节包括以下脚本文件：</p>
                  </div>
                  <!-- class="section" -->
               </div><a id="DBFSG823"></a><div class="props_rev_3"><a id="GUID-E7974492-8418-4DAD-8497-530F3A669064" name="GUID-E7974492-8418-4DAD-8497-530F3A669064"></a><h4 id="DBFSG-GUID-E7974492-8418-4DAD-8497-530F3A669064" class="sect4">hrdemo_setup.sql</h4>
                  <div>
                     <div class="section">
                        <p>设置脚本<code class="codeph">hrdemo_setup.sql</code>的源文件。
                        </p><pre class="oac_no_warn" dir="ltr">SET ECHO OFF SET FEEDBACK 1 SET NUMWIDTH 10 SET LINESIZE 80 SET TRIMSPOOL ON SET TAB OFF SET PAGESIZE 100 SET ECHO ON定义passwd =＆1 ---------------------- ------------------------------------------------  - 介绍  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  - - ---------------------  -  HR演示展示了如何使用基本的Real Application Security功能。- 该演示通过创建数据安全性来保护HR.EMPLOYEES表 - 该策略授予表访问权限： - 数据安全策略 -   - （1）员工可以查看他/她自己的记录，包括SALARY列。- （2）IT工程师可以查看IT部门的所有员工记录，但无法查看员工的工资。- （3）人力资源代表可以查看和更新所有员工记录。-   - 示例用户及其角色授予： -  1）DAUSTIN，IT部门的应用程序用户。他有角色员工 - 和it_engineer。他可以在IT部门查看员工记录，但他 - 除了他自己的工作列之外无法查看工资列。-  2）SMAVRIS，人力资源部门的应用程序用户。她有角色员工 - 和hr_representative。她可以查看和更新所有员工记录。-------------------------------------------------- --------------------  -  1。设置 - 用户和角色--------------------------------------------- -------------------------将sys /＆passwd连接为sysdba  - 为普通员工创建应用程序角色员工。exec sys.xs_principal.create_role（name =&gt;'employee'，enabled =&gt; true）; - 为IT部门创建应用程序角色it_engineer。exec sys.xs_principal.create_role（name =&gt;'it_engineer'，enabled =&gt; true）; - 为HR部门创建应用程序角色hr_representative。exec sys.xs_principal.create_role（name =&gt;'hr_representative'，enabled =&gt; true）; - 为对象权限授予创建数据库角色创建角色db_emp; - 将DB_EMP授予三个应用程序角色，因此它们具有访问该表所需的对象权限。将db_emp授予员工;将db_emp授予it_engineer;将db_emp授予hr_representative; - 创建两个应用程序用户： -  DAUSTIN（在IT部门），授予员工和it_engineer。exec sys.xs_principal.create_user（name =&gt;'daustin'，schema =&gt;'hr'）; exec sys.xs_principal.set_password（'daustin'，'welcome1'）; exec sys.xs_principal.grant_roles（'daustin'，'XSCONNECT'）; exec sys.xs_principal.grant_roles（'daustin'，'employee'）; exec sys.xs_principal.grant_roles（'daustin'，'it_engineer'）; -  SMAVRIS（人力资源部门），授予员工和hr_representative。exec sys.xs_principal.create_user（name =&gt;'smavris'，schema =&gt;'hr'）; exec sys.xs_principal.set_password（'smavris'，'welcome1'）; exec sys.xs_principal.grant_roles（'daustin'，'XSCONNECT'）; exec sys.xs_principal.grant_roles（'smavris'，'employee'）; exec sys.xs_principal.grant_roles（'smavris'，'hr_representative'）; - 授予HR用户策略管理权限exec sys.xs_admin_util.grant_system_privilege（'ADMIN_ANY_SEC_POLICY'，'HR'）; -------------------------------------------------- --------------------  -  2。SETUP  - 安全类和ACL -------------------------------------------- --------------------------  - 连接为HR连接hr / hr; - 为db_emp角色授予必要的对象权限 - 此角色将用于向应用程序用户授予所需的对象权限。将hr.employees上的select，insert，update，delete授予db_emp; - 创建安全类hr_privileges并包含预定义DML安全性类的权限。-  hr_privileges有一个新的权限VIEW_SALARY，用于控制对SALARY列的访问。declare begin sys.xs_security_class.create_security_class（name =&gt;'hr_privileges'，parent_list =&gt; xs $ name_list（'sys.dml'），priv_list =&gt; xs $ privilege_list（xs $ privilege（'view_salary'）））;结束; /  - 创建三个ACL以授予稍后定义的策略的权限。声明aces xs $ ace_list：= xs $ ace_list（）;开始aces.extend（1）; -  EMP_ACL：此ACL授予员工查看员工自己的记录（包括SALARY列）的权限。aces（1）：= xs $ ace_type（privilege_list =&gt; xs $ name_list（'select'，'view_salary'），principal_name =&gt;'employee'）; sys.xs_acl.create_acl（name =&gt;'emp_acl'，ace_list =&gt; aces，sec_class =&gt;'hr_privileges'）; -  IT_ACL：此ACL授予it_engineer查看员工的权限 -  IT部门中的记录，但不授予访问SALARY列所需的VIEW_SALARY特权。aces（1）：= xs $ ace_type（privilege_list =&gt; xs $ name_list（'select'），principal_name =&gt;'it_engineer'）; sys.xs_acl.create_acl（name =&gt;'it_acl'，ace_list =&gt; aces，sec_class =&gt;'hr_privileges'）; -  HR_ACL：此ACL授予hr_representative查看和更新所有员工记录（包括SALARY列）的权限。aces（1）：= xs $ ace_type（privilege_list =&gt; xs $ name_list（'select'，'insert'，'update'，'delete'，'view_salary'），principal_name =&gt;'hr_representative'）; sys.xs_acl.create_acl（name =&gt;'hr_acl'，ace_list =&gt; aces，sec_class =&gt;'hr_privileges'）;结束; / ------------------------------------------------- ---------------------  -  3。SETUP  - 数据安全策略--------------------------------------------- -------------------------  - 为EMPLOYEE表创建数据安全策略。该策略定义了三个领域约束和一个保护SALARY列的列约束。声明领域xs $ realm_constraint_list：= xs $ realm_constraint_list（）; cols xs $ column_constraint_list：= xs $ column_constraint_list（）; begin realms.extend（3）; - 领域＃1：只有员工自己的记录。- 员工可以查看包括SALARY列的领域。realms（1）：= xs $ realm_constraint_type（realm =&gt;'email = xs_sys_context（''xs $ session''，''username''）'，acl_list =&gt; xs $ name_list（'emp_acl'））; - 领域＃2：IT部门的记录。-  it_engineer可以查看除SALARY列之外的域。realms（2）：= xs $ realm_constraint_type（realm =&gt;'department_id = 60'，acl_list =&gt; xs $ name_list（'it_acl'））; - 境界＃3：所有记录。-  hr_representative可以查看和更新包括SALARY列的领域。realms（3）：= xs $ realm_constraint_type（realm =&gt;'1 = 1'，acl_list =&gt; xs $ name_list（'hr_acl'））; - 列约束通过要求VIEW_SALARY  - 特权来保护SALARY列。cols.extend（1）; cols（1）：= xs $ column_constraint_type（column_list =&gt; xs $ list（'salary'），privilege =&gt;'view_salary'）; sys.xs_data_security.create_policy（name =&gt;'employees_ds'，realm_constraint_list =&gt; realms，column_constraint_list =&gt; cols）;结束; /  - 将数据安全策略应用于表。begin sys.xs_data_security.apply_object_policy（policy =&gt;'employees_ds'，schema =&gt;'hr'，object =&gt;'employees'）;结束; / ------------------------------------------------- ---------------------  -  4。SETUP  - 验证我们设置的对象。-------------------------------------------------- --------------------设置serveroutput on; start if（sys.xs_diag.validate_workspace（））然后dbms_output.put_line（'所有配置都正确。“）; else dbms_output.put_line（'某些配置不正确。“）;万一;结束; /  -  XS $ VALIDATION_TABLE包含验证错误（如果有）。- 期望不选择任何行。从xs $ validation_table顺序中选择* 1,2,3,4; -------------------------------------------------- --------------------  -  5。设置 - 中间层相关配置。-------------------------------------------------- --------------------将sys /＆passwd连接为sysdba  - 创建一个只具有 -  RAS会话管理权限（无数据权限）的会话管理员， - 和负责管理每个应用程序用户的RAS会话。授予xs_session_admin，创建hr_session标识的hr_session会话;将创建会话授予hr_common标识的hr_common; - 为java演示提供调度程序用户，为应用程序用户exec sys.xs_principal.create_user设置会话（name =&gt;'dispatcher'，schema =&gt;'HR'）; exec sys.xs_principal.set_password（'dispatcher'，'welcome1'）; exec sys.xs_principal.grant_roles（'dispatcher'，'XSCONNECT'）; exec sys.xs_principal.grant_roles（'dispatcher'，'xsdispatcher'）;出口</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DBFSG824"></a><div class="props_rev_3"><a id="GUID-37A422AF-7AAB-4CC0-9E49-0D4BD2ED5F0F" name="GUID-37A422AF-7AAB-4CC0-9E49-0D4BD2ED5F0F"></a><h4 id="DBFSG-GUID-37A422AF-7AAB-4CC0-9E49-0D4BD2ED5F0F" class="sect4">hrdemo.sql</h4>
                  <div>
                     <div class="section">
                        <p><code class="codeph">hrdemo.sql</code>脚本的源文件。此脚本通过直接登录运行演示。
                        </p><pre class="oac_no_warn" dir="ltr">SET ECHO OFF设置反馈1设置数量10设置LINESIZE 80设置TRIMSPOOL设置TAB OFF设置PAGESIZE 100列电子邮件格式A10列FIRST_NAME格式A15列LAST_NAME格式A15列DEPARTMENT_ID格式9999 COLUMN MANAGER_ID格式9999字符串SALARY格式999999 SET ECHO ON  - -------------------------------------------------- ------------------  -  HR演示 - 带RAS直接登录用户的PL / SQL ------------------- -------------------------------------------------- -   - 此演示使用RAS直接登录用户显示RAS运行时。- 每个用户直接连接到数据库并访问员工表。- 自动执行RAS策略。-------------------------------------------------- -------------------  - 以DAUSTIN身份连接，他只有员工和it_engineer角色conn daustin / welcome1;在UNAUTH上设置SECUREDCOL *******  -  DAUSTIN可以查看IT部门的记录，但只能查看自己的 -  SALARY列。通过电子邮件选择电子邮件，first_name，last_name，department_id，manager_id，员工薪水; SET SECUREDCOL OFF  -  DAUSTIN无法更新记录。更新员工设置manager_id = 102 where email ='DAUSTIN'; - 记录未更改。选择email，first_name，last_name，department_id，manager_id，员工的工资，其中email ='DAUSTIN'; - 以SMAVRIS身份连接，该员工兼有员工和hr_representative角色。conn smavris / welcome1; -  SMAVRIS可以查看包括SALARY列在内的所有记录。选择电子邮件，first_name，last_name，department_id，manager_id，来自员工的工资，其中department_id = 60或department_id = 40 order by department_id，email; -  EMPLOYEES表有107行，我们希望看到所有这些行。从员工中选择计数（*）; -  SMAVRIS可以更新记录。更新员工设置manager_id = 102 where email ='DAUSTIN'; - 记录已更改。选择email，first_name，last_name，department_id，manager_id，员工的工资，其中email ='DAUSTIN'; - 将记录更改回原始记录。更新员工设置manager_id = 103 where email ='DAUSTIN';出口</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DBFSG825"></a><div class="props_rev_3"><a id="GUID-933185DA-9B2F-4530-9B3A-91A034818B0A" name="GUID-933185DA-9B2F-4530-9B3A-91A034818B0A"></a><h4 id="DBFSG-GUID-933185DA-9B2F-4530-9B3A-91A034818B0A" class="sect4">hrdemo_session.sql</h4>
                  <div>
                     <div class="section">
                        <p><code class="codeph">hrdemo_session.sql</code>脚本的源文件。此脚本显式创建并附加Real Application Security会话。
                        </p><pre class="oac_no_warn" dir="ltr">SET ECHO OFF设置反馈1设置数量10设置LINESIZE 80设置TRIMSPOOL设置TAB OFF设置PAGESIZE 100列电子邮件格式A10列FIRST_NAME格式A15列LAST_NAME格式A15列DEPARTMENT_ID格式9999 COLUMN MANAGER_ID格式9999字符串SALARY格式999999 SET ECHO ON  - -------------------------------------------------- ------------------  -  HR演示 - 带会话API的PL / SQL --------------------- -------------------------------------------------  -  - 此演示使用RAS用户作为应用程序用户显示RAS运行时。- 用户未登录到数据库，但会创建RAS会话 - 并在访问employee表之前为每个用户附加。-------------------------------------------------- -------------------  - 以RAS会话管理员身份连接。connect hr_session / hr_session; - 用于记住会话ID的变量。 var gsessionid varchar2（32）; - 为SMARVIS创建应用程序会话并附加到该应用程序会话。声明sessionid raw（16）; begin sys.dbms_xs_sessions.create_session（'SMAVRIS'，sessionid）; ：gsessionid：= rawtohex（sessionid）; sys.dbms_xs_sessions.attach_session（sessionid，null）;结束 ; /  - 显示当前用户，现在应该是SMAVRIS。从双重选择xs_sys_context（'xs $ session'，'username'）; - 显示已启用的应用程序角色和数据库角色。从v $ xs_session_roles中选择role_name从session_roles中选择union的角色顺序为1; -  SMAVRIS可以查看包括SALARY列在内的所有记录。选择电子邮件，first_name，last_name，department_id，manager_id，来自员工的工资，其中department_id = 60或department_id = 40 order by department_id，email; -  EMPLOYEES表有107行，我们希望看到所有这些行。从员工中选择计数（*）; - 禁用hr_representative角色。exec dbms_xs_sessions.disable_role（'hr_representative'）; -  SMAVRIS应该只能看到自己的记录。选择电子邮件，first_name，last_name，department_id，manager_id，来自员工的工资，其中department_id = 60或department_id = 40 order by department_id，email; - 启用hr_representative角色。exec sys.dbms_xs_sessions.enable_role（'hr_representative'）; -  SMAVRIS可以再次查看所有记录。选择电子邮件，first_name，last_name，department_id，manager_id，来自员工的工资，其中department_id = 60或department_id = 40 order by department_id，email; -  EMPLOYEES表有107行，我们希望看到所有这些行。从员工中选择计数（*）; - 分离并销毁应用程序会话。声明sessionid raw（16）; begin sessionid：= hextoraw（：gsessionid）; sys.dbms_xs_sessions.detach_session; sys.dbms_xs_sessions.destroy_session（的sessionid）;结束; / 出口</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DBFSG826"></a><div class="props_rev_3"><a id="GUID-C19275DF-6D8C-4D3B-8B8F-A83766CB5F61" name="GUID-C19275DF-6D8C-4D3B-8B8F-A83766CB5F61"></a><h4 id="DBFSG-GUID-C19275DF-6D8C-4D3B-8B8F-A83766CB5F61" class="sect4">hrdemo.java</h4>
                  <div>
                     <div class="section">
                        <p>Java演示的源文件是<code class="codeph">hrdemo.java</code> 。
                        </p><pre class="oac_no_warn" dir="ltr">import java.security。GeneralSecurityException; import java.security。InvalidAlgorithmParameterException异常; import java.security。InvalidKeyException异常; import java.security。抛出：NoSuchAlgorithmException; import java.security.spec。InvalidKeySpecException; import java.sql。连接; import java.sql。DriverManager的; import java.sql。ResultSet的; import java.sql。的SQLException; import java.sql。声明; import java.util。数组列表; import java.util。清单; import oracle.jdbc。一个OracleDriver; import oracle.jdbc。OracleResultSet; import oracle.jdbc。OracleResultSet。AuthorizationIndicator; import oracle.security.xs。AccessDeniedException异常; import oracle.security.xs。InvalidXSNamespaceException; import oracle.security.xs。InvalidXSUserException; import oracle.security.xs。角色; import oracle.security.xs。会议; import oracle.security.xs。XSAccessController; import oracle.security.xs。XSException; import oracle.security.xs。XSSessionManager; / ** *使用RAS实现的简单Java应用程序。 *它显示：*  - 如何设置RAS会话管理器*  - 如何管理RAS会话*  - 如何使用列授权指示器*  - 如何使用“checkAcl”函数检查权限* / public class hrdemo {//应用程序连接，应该使用非特权用户创建//在RAS情况下，用户只需要DB连接权限私有连接appConnection = null; // RAS调度程序的连接，应该使用RAS调度程序用户私有连接创建mgrConnection = null; // RAS会话管理器，用于管理应用程序用户的会话//必须使用disptcher的连接私有化XSSessionManager manager = null; public static void main（String [] args）{try {DriverManager.registerDriver（new OracleDriver（））; if（args.length！= 1）{System.out.println（“用法hrdemo dbURL”）; System.exit（1）; } hrdemo demo = new hrdemo（）; demo.setupConnection（参数[0]）; demo.queryAsUser（ “DAUSTIN”）; demo.queryAsUser（ “SMAVRIS”）; demo.cleanupConnection（）; } catch（异常e）{//我们现在不处理异常e.printStackTrace（）; private void queryAsUser（String user）抛出SQLException，XSException {System.out.println（“\ nQuery HR.EMPLOYEES table as user”“+ user +”\“”）; Session lws = manager.createSession（appConnection，user，null，null）; manager.attachSession（appConnection，lws，null，null，null，null，null）; queryEmployees（LWS）; manager.detachSession（LWS）; manager.destroySession（appConnection，lws）; public void setupConnection（String url）抛出SQLException，XSException，GeneralSecurityException {//调度程序的连接mgrConnection = DriverManager.getConnection（url，“dispatcher”，“welcome1”）; // RAS会话管理器管理器= XSSessionManager.getSessionManager（mgrConnection，30,2048000）; //用于应用程序查询的连接appConnection = DriverManager.getConnection（url，“hr_common”，“hr_common”）; public void cleanupConnection（）抛出SQLException {mgrConnection.close（）; appConnection.close（）; public void queryEmployees（Session lws）抛出SQLException，XSException {//使用已连接到RAS会话的数据库连接连接conn = lws.getConnection（）;字符串查询=“从hr.employees \ temp中选择email，first_name，last_name，department_id，salary，ora_get_aclids（emp），其中department_id in（40,60,100）通过电子邮件订购”;语句stmt = null; ResultSet rs = null; System.out.printf（“EMAIL | FIRST_NAME | LAST_NAME | DEPT | SALARY | UPDATE | VIEW_SALARY \ n”）; try {stmt = conn.createStatement（）; rs = stmt.executeQuery（query）; while（rs.next（））{String email = rs.getString（“EMAIL”）; String first_name = rs.getString（“FIRST_NAME”）; String last_name = rs.getString（“LAST_NAME”）; String department_id = rs.getString（“DEPARTMENT_ID”）;字符串工资; if（（（OracleResultSet）rs）。getAuthorizationIndicator（“SALARY”）== AuthorizationIndicator。NONE）{salary = rs.getString（“SALARY”）; } else {salary =“*****”; } byte [] aclRaw = rs.getBytes（6）;字符串更新，viewSalary; //调用checkAcl来确定是否可以更新数据库记录if（XSAccessController.checkAcl（lws，aclRaw，“UPDATE”））{update =“true”; } else {update =“false”; if（XSAccessController.checkAcl（lws，aclRaw，“VIEW_SALARY”））{viewSalary =“true”; } else {viewSalary =“false”; System.out.printf（“％9s |％12s |％12s |％6s |％8s |％8s |％8s \ n”，email，first_name，last_name，department_id，salary，update，viewSalary）;终于{try {if（rs！）= null）rs.close（）; } catch（例外e）{};试试{if（stmt！= null）stmt.close（）; } catch（例外e）{}; }}}</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DBFSG827"></a><div class="props_rev_3"><a id="GUID-4BAA592E-CD45-4789-A371-96A3BC3668D0" name="GUID-4BAA592E-CD45-4789-A371-96A3BC3668D0"></a><h4 id="DBFSG-GUID-4BAA592E-CD45-4789-A371-96A3BC3668D0" class="sect4">hrdemo_clean.sql</h4>
                  <div>
                     <div class="section">
                        <p>清理脚本的源文件是<code class="codeph">hrdemo_clean.sql</code> 。
                        </p><pre class="oac_no_warn" dir="ltr">SET ECHO OFF SET FEEDBACK 1 SET NUMWIDTH 10 SET LINESIZE 80 SET TRIMSPOOL ON SET TAB OFF SET PAGESIZE 100 SET ECHO ON定义passwd =＆1 connect hr / hr; - 从表中删除策略。begin sys.xs_data_security.remove_object_policy（policy =&gt;'employees_ds'，schema =&gt;'hr'，object =&gt;'employees'）;结束; /  - 删除安全性类和ACL exec sys.xs_security_class.delete_security_class（'hr_privileges'，xs_admin_util.cascade_option）; exec sys.xs_acl.delete_acl（'emp_acl'，xs_admin_util.cascade_option）; exec sys.xs_acl.delete_acl（'it_acl'，xs_admin_util.cascade_option）; exec sys.xs_acl.delete_acl（'hr_acl'，xs_admin_util.cascade_option）; - 删除数据安全策略exec sys.xs_data_security.delete_policy（'employees_ds'，xs_admin_util.cascade_option）; connect sys /＆passwd as sysdba  - 删除应用程序用户和角色exec sys.xs_principal.delete_principal（'employee'，xs_admin_util.cascade_option）; exec sys.xs_principal.delete_principal（'hr_representative'，xs_admin_util.cascade_option）; exec sys.xs_principal.delete_principal（'it_engineer'，xs_admin_util.cascade_option）; exec sys.xs_principal.delete_principal（'smavris'，xs_admin_util.cascade_option）; exec sys.xs_principal.delete_principal（'daustin'，xs_admin_util.cascade_option）; - 删除数据库角色删除角色db_emp; - 删除会话管理员删除用户hr_session; - 删除用于连接数据删除用户hr_common的普通用户; - 删除中间层exec sys.xs_principal.delete_principal（'dispatcher'，xs_admin_util.cascade_option）使用的调度程序用户;出口</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="DBFSG828"></a><div class="props_rev_3"><a id="GUID-95FB6E3E-1119-47A6-9E82-C17AC5CC6850" name="GUID-95FB6E3E-1119-47A6-9E82-C17AC5CC6850"></a><h3 id="DBFSG-GUID-95FB6E3E-1119-47A6-9E82-C17AC5CC6850" class="sect3">为每个脚本生成日志文件</h3>
               <div>
                  <div class="section">
                     <div class="p">本节包括从运行<a href="real-application-security-hr-demo-files.html#GUID-5953585D-D2F7-47E5-B27E-A81DCEC2CA52__CEGGEEAB" title="此表列出了HR演示脚本的源文件和生成的日志文件。该表有2列。第1列是脚本名称，第2列是运行脚本时生成的日志文件的名称。">表C-1中</a>列出的脚本生成的以下日志文件：<ul style="list-style-type:disc">
                           <li>
                              <p><a href="real-application-security-hr-demo-files.html#GUID-2EFC5D83-9586-4B06-93B7-190197A8821A">hrdemo_setup.log</a></p>
                           </li>
                           <li>
                              <p><a href="real-application-security-hr-demo-files.html#GUID-65F8FD60-F26D-4E63-97CB-DC310B64C078">hrdemo.log</a></p>
                           </li>
                           <li>
                              <p><a href="real-application-security-hr-demo-files.html#GUID-9D131D01-1A54-4771-AD08-1FD36415E2AD">hrdemo_run_sess.log</a></p>
                           </li>
                           <li>
                              <p><a href="real-application-security-hr-demo-files.html#GUID-E041C7EE-68C9-4495-BC1F-F87A3B567A98">hrdemo.log</a></p>
                           </li>
                           <li>
                              <p><a href="real-application-security-hr-demo-files.html#GUID-027FBD01-2EFE-47C8-A84F-5E52B5469382">hrdemo_clean.log</a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="DBFSG829"></a><div class="props_rev_3"><a id="GUID-2EFC5D83-9586-4B06-93B7-190197A8821A" name="GUID-2EFC5D83-9586-4B06-93B7-190197A8821A"></a><h4 id="DBFSG-GUID-2EFC5D83-9586-4B06-93B7-190197A8821A" class="sect4">hrdemo_setup.log</h4>
                  <div>
                     <div class="section">
                        <p><code class="codeph">hrdemo_setup.log</code>文件。
                        </p><pre class="pre codeblock"><code>SQL&gt; @hrdemo_setup SQL&gt; SQL&gt; define passwd =＆1输入1的值：示例SQL&gt; SQL&gt; ---------------------------- ------------------------------------------ SQL&gt;  - 简介SQL&gt;  - -------------------------------------------------- ------------------- SQL&gt;  -  HR演示展示了如何使用基本的Real Application Security功能。SQL&gt;  - 该演示通过创建数据安全性SQL&gt;  - 授予表访问权限的策略来保护HR.EMPLOYEE表。SQL&gt;  - 数据安全策略SQL&gt;  -  SQL&gt;  - （1）员工可以查看他/她自己的记录，包括SALARY列。SQL&gt;  - （2）IT工程师可以查看IT部门中的所有员工记录，SQL&gt;  - 但无法查看员工的工资。SQL&gt;  - （3）HR代表可以查看和更新所有员工记录。SQL&gt;  -  SQL&gt;  -  SQL&gt;  - 示例用户及其角色授予：SQL&gt;  -  1）DAUSTIN，IT部门的应用程序用户。他有角色员工SQL&gt;  - 和it_engineer。他可以在IT部门查看员工记录，但他&gt; SQL  - 除了他自己的以外，无法查看薪水栏。SQL&gt;  -  2）SMAVRIS，HR部门的应用程序用户。她有角色员工SQL&gt;  - 和hr_representative。她可以查看和更新所有员工记录SQL&gt;  -  SQL&gt; ----------------------------------- ----------------------------------- SQL&gt;  -  1。设置 - 用户和角色SQL&gt; ------------------------------------------- --------------------------- SQL&gt; SQL&gt; connect sys /＆passwd as sysdba已连接。SQL&gt;  - 为普通员工创建应用程序角色员工。SQL&gt; exec xs_principal.create_role（name =&gt;'employee'，enabled =&gt; true）; PL / SQL过程成功完成。SQL&gt; SQL&gt;  - 为IT部门创建应用程序角色it_engineer。SQL&gt; exec xs_principal.create_role（name =&gt;'it_engineer'，enabled =&gt; true）; PL / SQL过程成功完成。SQL&gt; SQL&gt;  - 为HR部门创建应用程序角色hr_representative。SQL&gt; exec xs_principal.create_role（name =&gt;'hr_representative'，enabled =&gt; true）; PL / SQL过程成功完成。SQL&gt; SQL&gt;  - 为对象权限授予创建数据库角色SQL&gt; create role db_emp;角色创建。SQL&gt; SQL&gt;  - 将DB_EMP授予三个应用程序角色，因此它们具有访问表所需的SQL&gt;  - 对象权限。SQL&gt;向员工授予db_emp;格兰特成功了。SQL&gt;将db_emp授予it_engineer;格兰特成功了。SQL&gt;将db_emp授予hr_representative;格兰特成功了。SQL&gt; SQL&gt;  - 创建两个应用程序用户：SQL&gt;  -  DAUSTIN（在IT部门），授予employee和it_engineer。SQL&gt; exec xs_principal.create_user（name =&gt;'daustin'，schema =&gt;'hr'）; PL / SQL过程成功完成。SQL&gt; exec xs_principal.set_password（'daustin'，'welcome1'）; PL / SQL过程成功完成。SQL&gt; exec xs_principal.grant_roles（'daustin'，'XSCONNECT'）; PL / SQL过程成功完成。SQL&gt; exec xs_principal.grant_roles（'daustin'，'employee'）; PL / SQL过程成功完成。SQL&gt; exec xs_principal.grant_roles（'daustin'，'it_engineer'）; PL / SQL过程成功完成。SQL&gt; SQL&gt;  -  SMAVRIS（在HR部门），授予员工和hr_representative。SQL&gt; exec xs_principal.create_user（name =&gt;'smavris'，schema =&gt;'hr'）; PL / SQL过程成功完成。SQL&gt; exec xs_principal.set_password（'smavris'，'welcome1'）; PL / SQL过程成功完成。SQL&gt; exec xs_principal.grant_roles（'smavris'，'XSCONNECT'）; PL / SQL过程成功完成。SQL&gt; exec xs_principal.grant_roles（'smavris'，'employee'）; PL / SQL过程成功完成。SQL&gt; exec xs_principal.grant_roles（'smavris'，'hr_representative'）; PL / SQL过程成功完成。SQL&gt; SQL&gt;  - 授予HR用户策略管理权限SQL&gt; exec xs_admin_util.grant_system_privilege（'ADMIN_ANY_SEC_POLICY'，'HR'）; PL / SQL过程成功完成。SQL&gt; SQL&gt; ---------------------------------------------- ------------------------ SQL&gt;  -  2。SETUP  - 安全类和ACL SQL&gt; ------------------------------------------ ---------------------------- SQL&gt; SQL&gt; SQL&gt;  - 连接为HR SQL&gt; connect hr / hr;连接的。SQL&gt; SQL&gt;  - 为db_emp角色提供必要的对象权限SQL&gt;  - 此角色将用于向SQL&gt;  - 应用程序用户授予所需的对象权限。SQL&gt; SQL&gt;将hr.employees上的select，insert，update，delete授予db_emp;格兰特成功了。SQL&gt; SQL&gt; SQL&gt;  - 创建安全类hr_privileges并包含预定义DML安全性类的权限。SQL&gt;  -  hr_privileges有一个新的权限VIEW_SALARY，用于控制SQL&gt;  - 访问SALARY列。SQL&gt; declare 2 begin 3 xs_security_class.create_security_class（4 name =&gt;'hr_privileges'，5 parent_list =&gt; xs $ name_list（'sys.dml'），6 priv_list =&gt; xs $ privilege_list（xs $ privilege（'view_salary'）） ）; 7结束; 8 / PL / SQL过程成功完成。SQL&gt; SQL&gt; SQL&gt; SQL&gt;  - 创建三个ACL以授予稍后定义的策略的权限。SQL&gt;声明2个aces xs $ ace_list：= xs $ ace_list（）; 3开始4 aces.extend（1）; 5 6  -  EMP_ACL：此ACL授予员工查看员工7自己记录（包括SALARY列）的权限。8 aces（1）：= xs $ ace_type（privilege_list =&gt; xs $ name_list（'select'，'view_salary'），9 principal_name =&gt;'employee'）; 10 11 xs_acl.create_acl（name =&gt;'emp_acl'，12 ace_list =&gt; aces，13 sec_class =&gt;'hr_privileges'）; 14 15  -  IT_ACL：此ACL授予it_engineer查看员工16的权限 -  IT部门中的记录，但不授予访问SALARY列所需的VIEW_SALARY 17权限。18 aces（1）：= xs $ ace_type（privilege_list =&gt; xs $ name_list（'select'），19 principal_name =&gt;'it_engineer'）; 20 21 xs_acl.create_acl（name =&gt;'it_acl'，22 ace_list =&gt; aces，23 sec_class =&gt;'hr_privileges'）; 24 25  -  HR_ACL：此ACL授予hr_representative查看和更新所有26个员工记录（包括SALARY列）的权限。27 aces（1）：= xs $ ace_type（privilege_list =&gt; xs $ name_list（'select'，'insert'，28'update'，'delete'，'view_salary'），29 principal_name =&gt;'hr_representative'）; 30 31 xs_acl.create_acl（name =&gt;'hr_acl'，32 ace_list =&gt; aces，33 sec_class =&gt;'hr_privileges'）; 34结束; 35 / PL / SQL过程成功完成。SQL&gt; SQL&gt; SQL&gt; SQL&gt; ------------------------------------------ ---------------------------- SQL&gt;  -  3。SETUP  - 数据安全策略SQL&gt; ------------------------------------------- --------------------------- SQL&gt;  - 为EMPLOYEE表创建数据安全策略。该策略定义了三个SQL&gt;  - 领域约束和一个保护SALARY列的列约束。SQL&gt;声明2个域xs $ realm_constraint_list：= xs $ realm_constraint_list（）; 3 cols xs $ column_constraint_list：= xs $ column_constraint_list（）; 4开始5 realms.extend（3）; 6 7  - 领域＃1：只有员工自己的记录。8  - 员工可以查看包括SALARY列的领域。9个领域（1）：= xs $ realm_constraint_type（10 realm =&gt;'email = xs_sys_context（''xs $ session''，''username''）'，11 acl_list =&gt; xs $ name_list（'emp_acl'））; 12 13  - 领域＃2：IT部门的记录。14  -  it_engineer可以查看除SALARY列之外的域。15个领域（2）：= xs $ realm_constraint_type（16 realm =&gt;'department_id = 60'，17 acl_list =&gt; xs $ name_list（'it_acl'））; 18 19  - 境界＃3：所有记录。20-hr_representative可以查看和更新包括SALARY列的领域。21 realms（3）：= xs $ realm_constraint_type（22 realm =&gt;'1 = 1'，23 acl_list =&gt; xs $ name_list（'hr_acl'））; 24 25  - 列约束通过要求VIEW_SALARY 26  - 特权来保护SALARY列。27 cols.extend（1）; 28 cols（1）：= xs $ column_constraint_type（29 column_list =&gt; xs $ list（'salary'），30 privilege =&gt;'view_salary'）; 31 32 xs_data_security.create_policy（33 name =&gt;'employees_ds'，34 realm_constraint_list =&gt; realms，35 column_constraint_list =&gt; cols）; 36结束; 37 / PL / SQL过程成功完成。SQL&gt; SQL&gt; SQL&gt; SQL&gt;  - 将数据安全策略应用于表。SQL&gt; begin 2 xs_data_security.apply_object_policy（3 policy =&gt;'employees_ds'，4 schema =&gt;'hr'，5 object =&gt;'employees'）; 6结束; 7 / PL / SQL过程成功完成。SQL&gt; SQL&gt; SQL&gt; SQL&gt; ------------------------------------------ ---------------------------- SQL&gt;  -  4。SETUP  - 验证我们设置的对象。SQL&gt; ------------------------------------------------ ---------------------- SQL&gt; set serveroutput on; SQL&gt; begin 2 if（xs_diag.validate_workspace（））然后3 dbms_output.put_line（'所有配置都正确。“）; 4 else 5 dbms_output.put_line（'某些配置不正确。“）; 6结束如果; 7结束; 8 /某些配置不正确。PL / SQL过程成功完成。SQL&gt;  -  XS $ VALIDATION_TABLE包含验证错误（如果有）。SQL&gt;  - 期望不选择任何行。SQL&gt; select * from xs $ validation_table order by 1,2,3,4;代码---------- DESCRIPTION -------------------------------------- ------------------------------------------ OBJECT ------- -------------------------------------------------- -  -  -  -  -  -  -  -  -  -  - - 注意  -  -  -  -  -  -  -  -  -  -  -  -  - -------------------------------------------------- ---- -1020 ACL中没有ACE [ACL“SYS”。“NETWORK_ACL_30D45882EF095A86E053B0AAE80AF5F8”]选择了1行。SQL&gt; SQL&gt; SQL&gt; -------------------------------------------- -------------------------- SQL&gt;  -  5。SETUP  -  Java演示的附加配置。SQL&gt; ------------------------------------------------ ---------------------- SQL&gt; SQL&gt; connect sys /＆passwd as sysdba已连接。SQL&gt; SQL&gt;  - 创建只具有SQL&gt;  -  RAS会话管理权限（无数据权限），SQL&gt;的会话管理员 - 并负责管理每个应用程序用户的RAS会话。SQL&gt; grant xs_session_admin，创建hr_session标识的hr_session会话;格兰特成功了。SQL&gt;将创建会话授予hr_common标识的hr_common;格兰特成功了。SQL&gt; SQL&gt;  - 为java演示提供调度程序用户，为应用程序用户设置会话SQL&gt; exec xs_principal.create_user（name =&gt;'dispatcher'，schema =&gt;'HR'）; PL / SQL过程成功完成。SQL&gt; exec xs_principal.set_password（'dispatcher'，'welcome1'）; PL / SQL过程成功完成。SQL&gt; exec xs_principal.grant_roles（'dispatcher'，'XSCONNECT'）; PL / SQL过程成功完成。SQL&gt; exec xs_principal.grant_roles（'dispatcher'，'xsdispatcher'）; PL / SQL过程成功完成。SQL&gt; SQL&gt;退出</code></pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DBFSG830"></a><div class="props_rev_3"><a id="GUID-65F8FD60-F26D-4E63-97CB-DC310B64C078" name="GUID-65F8FD60-F26D-4E63-97CB-DC310B64C078"></a><h4 id="DBFSG-GUID-65F8FD60-F26D-4E63-97CB-DC310B64C078" class="sect4">hrdemo.log</h4>
                  <div>
                     <div class="section">
                        <p><code class="codeph">hrdemo.log</code>文件。
                        </p><pre class="pre codeblock"><code>SQL&gt; @hrdemo SQL&gt; SQL&gt; SQL&gt; ---------------------------------------- ------------------------------ SQL&gt;  -  HR演示 - 带RAS的PL / SQL直接登录用户SQL&gt; --- -------------------------------------------------- ----------------- SQL&gt;  - 此演示使用RAS直接登录用户显示RAS运行时。SQL&gt;  - 每个用户直接连接到数据库并访问employee表。SQL&gt;  - 自动强制执行RAS策略。SQL&gt; ------------------------------------------------ --------------------- SQL&gt; SQL&gt;  - 以DAUSTIN身份连接，她只有employee和it_engineer角色SQL&gt; conn daustin / welcome1;连接的。SQL&gt; SQL&gt; SET SECUREDCOL ON UNAUTH ******* SQL&gt; SQL&gt;  -  DAUSTIN可以查看IT部门中的记录，但只能查看自己的SQL&gt;  -  SALARY列。SQL&gt;通过电子邮件从员工订单中选择email，first_name，last_name，department_id，manager_id，salary 2; EMAIL FIRST_NAME LAST_NAME DEPARTMENT_ID MANAGER_ID SALARY ---------- --------------- --------------- ---- --------- ---------- ------- AHUNOLD Alexander Hunold 60 102 ******* BERNST Bruce Ernst 60 103 ******* DAUSTIN David Austin 60 103 4800 DLORENTZ Diana Lorentz 60 103 ******* VPATABAL Valli Pataballa 60 103 *******选择了5行。SQL&gt; SQL&gt; SQL&gt; SET SECUREDCOL OFF SQL&gt; SQL&gt; SQL&gt;  -  DAUSTIN无法更新记录。SQL&gt; update employees set manager_id = 102 where email ='DAUSTIN'; 0行已更新。SQL&gt; SQL&gt;  - 记录不会更改。SQL&gt;从email ='DAUSTIN'的员工中选择email，first_name，last_name，department_id，manager_id，salary 2; EMAIL FIRST_NAME LAST_NAME DEPARTMENT_ID MANAGER_ID SALARY ---------- --------------- --------------- ---- --------- ---------- ------- DAUSTIN David Austin 60 103 4800 1排选中。SQL&gt; SQL&gt; SQL&gt; SQL&gt;  - 连接为SMAVRIS，具有employee和hr_representative角色。SQL&gt; conn smavris / welcome1;连接的。SQL&gt; SQL&gt;  -  SMAVRIS可以查看包括SALARY列在内的所有记录。SQL&gt;选择电子邮件，first_name，last_name，department_id，manager_id，来自员工的工资2，其中department_id = 60或department_id = 40 3按department_id，电子邮件订购; EMAIL FIRST_NAME LAST_NAME DEPARTMENT_ID MANAGER_ID SALARY ---------- --------------- --------------- ---- --------- ---------- ------- SMAVRIS Susan Mavris 40 101 6500 AHUNOLD Alexander Hunold 60 102 9000 BERNST Bruce Ernst 60 103 6000 DAUSTIN David Austin 60 103 4800 DLORENTZ Diana Lorentz 60 103 4200 VPATABAL Valli Pataballa 60 103 4800 6行选择。SQL&gt; SQL&gt;  -  EMPLOYEES表有107行，我们希望看到所有这些行。SQL&gt;从员工中选择count（*）; COUNT（*）---------- 107选择1行。SQL&gt; SQL&gt; SQL&gt; SQL&gt;  -  SMAVRIS可以更新记录。SQL&gt; update employees set manager_id = 102 where email ='DAUSTIN'; 1行更新。SQL&gt; SQL&gt;  - 记录已更改。SQL&gt;从email ='DAUSTIN'的员工中选择email，first_name，last_name，department_id，manager_id，salary 2; EMAIL FIRST_NAME LAST_NAME DEPARTMENT_ID MANAGER_ID SALARY ---------- --------------- --------------- ---- ---------- ---------- ------- DAUSTIN David Austin 60 102 4800 1行选中。SQL&gt; SQL&gt;  - 将记录更改回原始记录。SQL&gt; update employees set manager_id = 103 where email ='DAUSTIN'; 1行更新。SQL&gt; SQL&gt;退出</code></pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DBFSG831"></a><div class="props_rev_3"><a id="GUID-9D131D01-1A54-4771-AD08-1FD36415E2AD" name="GUID-9D131D01-1A54-4771-AD08-1FD36415E2AD"></a><h4 id="DBFSG-GUID-9D131D01-1A54-4771-AD08-1FD36415E2AD" class="sect4">hrdemo_run_sess.log</h4>
                  <div>
                     <div class="section">
                        <p><code class="codeph">hrdemo_run_sess.log</code>文件。
                        </p><pre class="pre codeblock"><code>SQL&gt; @hrdemo_session SQL&gt; SQL&gt; SQL&gt; ---------------------------------------- ------------------------------ SQL&gt;  -  HR演示 - 带有会话API SQL的PL / SQL&gt; ----- -------------------------------------------------- --------------- SQL&gt;  - 此演示使用RAS用户作为应用程序用户显示RAS运行时。SQL&gt;  - 用户不登录到数据库，但是创建了一个RAS会话SQL&gt;  - 并在访问employee表之前为每个用户附加了。SQL&gt; ------------------------------------------------ --------------------- SQL&gt; SQL&gt;  - 作为RAS会话管理员连接SQL&gt; connect hr_session / hr_session;连接的。SQL&gt; SQL&gt;  - 用于记住会话ID的变量; SQL&gt; var gsessionid varchar2（32）; SQL&gt; SQL&gt;  - 为SMARVIS创建应用程序会话并附加到它。SQL&gt;声明2 sessionid raw（16）; 3开始4 dbms_xs_sessions.create_session（'SMAVRIS'，sessionid）; 5：gsessionid：= rawtohex（sessionid）; 6 dbms_xs_sessions.attach_session（sessionid，null）; 7结束; 8 / PL / SQL过程成功完成。SQL&gt; SQL&gt;  - 显示当前用户，现在应该是SMAVRIS。SQL&gt;从双重选择xs_sys_context（'xs $ session'，'username'）; XS_SYS_CONTEXT（'XS $ SESSION'，'USERNAME'）-------------------------------------- ------------------------------------------选择SMAVRIS 1行。SQL&gt; SQL&gt;  - 显示已启用的应用程序角色和数据库角色。从v $ xs_session_roles union 2中选择SQL&gt; select role_name从session_roles中选择角色顺序为1; ROLE_NAME ------------------------------------------------- ------------------------------- DB_EMP EMPLOYEE HR_REPRESENTATIVE XSCONNECT XSPUBLIC XS_CONNECT选择了6行。SQL&gt; SQL&gt;  -  SMAVRIS可以查看包括SALARY列在内的所有记录。SQL&gt;选择电子邮件，first_name，last_name，department_id，manager_id，来自员工的工资2，其中department_id = 60或department_id = 40 3按department_id，电子邮件订购; EMAIL FIRST_NAME LAST_NAME DEPARTMENT_ID MANAGER_ID SALARY ---------- --------------- --------------- ---- --------- ---------- ------- SMAVRIS Susan Mavris 40 101 6500 AHUNOLD Alexander Hunold 60 102 9000 BERNST Bruce Ernst 60 103 6000 DAUSTIN David Austin 60 103 4800 DLORENTZ Diana Lorentz 60 103 4200 VPATABAL Valli Pataballa 60 103 4800 6行选择。SQL&gt; SQL&gt;  -  EMPLOYEES表有107行，我们希望看到所有这些行。SQL&gt;从员工中选择count（*）; COUNT（*）---------- 107选择1行。SQL&gt; SQL&gt;  - 禁用hr_representative角色SQL&gt; exec dbms_xs_sessions.disable_role（'hr_representative'）; PL / SQL过程成功完成。SQL&gt; SQL&gt;  -  SMAVRIS应该只能看到自己的记录。SQL&gt;选择电子邮件，first_name，last_name，department_id，manager_id，来自员工的工资2，其中department_id = 60或department_id = 40 3按department_id，电子邮件订购; EMAIL FIRST_NAME LAST_NAME DEPARTMENT_ID MANAGER_ID SALARY ---------- --------------- --------------- ---- --------- ---------- ------- SMAVRIS苏珊马维里斯40 101 6500 1排选中。SQL&gt; SQL&gt; SQL&gt;  - 启用HR_ROLE SQL&gt; exec dbms_xs_sessions.enable_role（'hr_representative'）; PL / SQL过程成功完成。SQL&gt; SQL&gt;  -  SMAVRIS可以再次查看所有记录。SQL&gt;选择电子邮件，first_name，last_name，department_id，manager_id，来自员工的工资2，其中department_id = 60或department_id = 40 3按department_id，电子邮件订购; EMAIL FIRST_NAME LAST_NAME DEPARTMENT_ID MANAGER_ID SALARY ---------- --------------- --------------- ---- --------- ---------- ------- SMAVRIS Susan Mavris 40 101 6500 AHUNOLD Alexander Hunold 60 102 9000 BERNST Bruce Ernst 60 103 6000 DAUSTIN David Austin 60 103 4800 DLORENTZ Diana Lorentz 60 103 4200 VPATABAL Valli Pataballa 60 103 4800 6行选择。SQL&gt; SQL&gt;  -  EMPLOYEES表有107行，我们希望看到所有这些行。SQL&gt;从员工中选择count（*）; COUNT（*）---------- 107选择1行。SQL&gt; SQL&gt;  - 分离并销毁应用程序会话。SQL&gt;声明2 sessionid raw（16）; 3开始4 sessionid：= hextoraw（：gsessionid）; 5 dbms_xs_sessions.detach_session; 6 dbms_xs_sessions.destroy_session（sessionid）; 7结束; 8 / PL / SQL过程成功完成。SQL&gt; SQL&gt;退出</code></pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DBFSG832"></a><div class="props_rev_3"><a id="GUID-E041C7EE-68C9-4495-BC1F-F87A3B567A98" name="GUID-E041C7EE-68C9-4495-BC1F-F87A3B567A98"></a><h4 id="DBFSG-GUID-E041C7EE-68C9-4495-BC1F-F87A3B567A98" class="sect4">hrdemo.log</h4>
                  <div>
                     <div class="section">
                        <p>Java <code class="codeph">hrdemo.log</code>文件。
                        </p><pre class="oac_no_warn" dir="ltr">将HR.EMPLOYEES表作为用户“DAUSTIN”EMAIL |进行查询FIRST_NAME | LAST_NAME | DEPT | SALARY |更新| VIEW_SALARY AHUNOLD |亚历山大|胡诺尔德| 60 | ***** |假|假BERNST |布鲁斯|恩斯特| 60 | ***** |假|假DAUSTIN |大卫|奥斯汀| 60 | 4800 |假|真正的DLORENTZ |戴安娜|洛伦兹| 60 | ***** |假|假VPATABAL |瓦利| Pataballa | 60 | ***** |假| false将HR.EMPLOYEES表作为用户“SMAVRIS”EMAIL |查询FIRST_NAME | LAST_NAME | DEPT | SALARY |更新| VIEW_SALARY AHUNOLD |亚历山大|胡诺尔德| 60 | 9000 |真|真的BERNST |布鲁斯|恩斯特| 60 | 6000 |真|真的DAUSTIN |大卫|奥斯汀| 60 | 4800 |真|真DFAVIET |丹尼尔| Faviet | 100 | 9000 |真|真正的DLORENTZ |戴安娜|洛伦兹| 60 | 4200 |真|真正的ISCIARRA |伊斯梅尔| Sciarra | 100 | 7700 |真|真的JCHEN |约翰|陈| 100 | 8200 |真|真JMURMAN |何塞曼努埃尔| Urman | 100 | 7800 |真|真正的LPOPP |路易斯|波普| 100 | 6900 |真|真正的NGREENBE |南希|格林伯格| 100 | 12008 |真|真正的SMAVRIS |苏珊| Mavris | 40 | 6500 |真|真正的VPATABAL |瓦利| Pataballa | 60 | 4800 |真|真正</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DBFSG833"></a><div class="props_rev_3"><a id="GUID-027FBD01-2EFE-47C8-A84F-5E52B5469382" name="GUID-027FBD01-2EFE-47C8-A84F-5E52B5469382"></a><h4 id="DBFSG-GUID-027FBD01-2EFE-47C8-A84F-5E52B5469382" class="sect4">hrdemo_clean.log</h4>
                  <div>
                     <div class="section">
                        <p><code class="codeph">hrdemo_clean.log</code>文件。
                        </p><pre class="pre codeblock"><code>SQL&gt; @hrdemo_clean SQL&gt; SQL&gt; define passwd =＆1输入1的值：test SQL&gt; SQL&gt; connect hr / hr;连接的。SQL&gt; SQL&gt;  - 从表中删除策略。SQL&gt; begin 2 xs_data_security.remove_object_policy（policy =&gt;'employees_ds'，3 schema =&gt;'hr'，object =&gt;'employees'）; 4结束; 5 / PL / SQL过程成功完成。SQL&gt; SQL&gt;  - 删除安全性类和ACL SQL&gt; exec xs_security_class.delete_security_class（'hr_privileges'，xs_admin_util.cascade_option）; PL / SQL过程成功完成。SQL&gt; exec xs_acl.delete_acl（'emp_acl'，xs_admin_util.cascade_option）; PL / SQL过程成功完成。SQL&gt; exec xs_acl.delete_acl（'it_acl'，xs_admin_util.cascade_option）; PL / SQL过程成功完成。SQL&gt; exec xs_acl.delete_acl（'hr_acl'，xs_admin_util.cascade_option）; PL / SQL过程成功完成。SQL&gt; SQL&gt;  - 删除数据安全策略SQL&gt; exec xs_data_security.delete_policy（'employees_ds'，xs_admin_util.cascade_option）; PL / SQL过程成功完成。SQL&gt; SQL&gt; connect sys /＆passwd as sysdba已连接。SQL&gt;  - 删除应用程序用户和角色SQL&gt; exec xs_principal.delete_principal（'employee'，xs_admin_util.cascade_option）; PL / SQL过程成功完成。SQL&gt; exec xs_principal.delete_principal（'hr_representative'，xs_admin_util.cascade_option）; PL / SQL过程成功完成。SQL&gt; exec xs_principal.delete_principal（'it_engineer'，xs_admin_util.cascade_option）; PL / SQL过程成功完成。SQL&gt; exec xs_principal.delete_principal（'smavris'，xs_admin_util.cascade_option）; PL / SQL过程成功完成。SQL&gt; exec xs_principal.delete_principal（'daustin'，xs_admin_util.cascade_option）; PL / SQL过程成功完成。SQL&gt; SQL&gt;  - 删除数据库角色SQL&gt; drop role db_emp;角色掉线了。SQL&gt; SQL&gt;  - 删除会话管理员SQL&gt;删除用户hr_session;用户掉线了SQL&gt;  - 删除用于连接到DB SQL的公共用户&gt; drop user hr_common;用户掉线了SQL&gt; SQL&gt;  - 删除调度程序SQL&gt; exec xs_principal.delete_principal（'dispatcher'，xs_admin_util.cascade_option）; PL / SQL过程成功完成。SQL&gt; SQL&gt;退出</code></pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>