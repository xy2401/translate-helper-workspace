<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="This chapter explains what end-to-end application tracing is, and how to generate and read trace files."></meta>
      <meta name="description" content="This chapter explains what end-to-end application tracing is, and how to generate and read trace files."></meta>
      <title>执行应用程序跟踪</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="SQL Tuning Guide"></meta>
      <meta property="og:description" content="This chapter explains what end-to-end application tracing is, and how to generate and read trace files."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="SQL Tuning Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="sql-tuning-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-31T14:57:08-08:00"></meta>
      <meta name="dcterms.title" content="SQL Tuning Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="2013, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96095-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="monitoring-database-operations.html" title="Previous" type="text/html"></link>
      <link rel="next" href="automatic-sql-tuning.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGSQL"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="monitoring-database-operations.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="automatic-sql-tuning.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL调优指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="monitoring-and-tracing-sql.html" property="item" typeof="WebPage"><span property="name">监视和跟踪SQL</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">执行应用程序跟踪</li>
            </ol>
            <a id="GUID-440D3AD4-B302-408E-8627-FE8032DD09F9" name="GUID-440D3AD4-B302-408E-8627-FE8032DD09F9"></a><a id="TGSQL791"></a>
            
            <h2 id="TGSQL-GUID-440D3AD4-B302-408E-8627-FE8032DD09F9" class="sect2"><span class="enumeration_chapter">22</span>执行应用程序跟踪</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍了端到端应用程序跟踪的内容，以及如何生成和读取跟踪文件。</p>
               <p>本章包含以下主题：</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-246A5A52-E666-4DBC-BDF6-98B83260A7AD">端到端应用程序跟踪概述</a><br>端到端应用程序跟踪可以通过客户端标识符，服务，模块，操作，会话，实例或整个数据库来识别过多数据库工作负载的来源，例如高负载SQL语句。
                  </li>
                  <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-33FA4E54-C759-480B-A075-CF75E6D85CAD">为端到端跟踪启用统计信息收集</a><br>要使用PL / SQL收集适当的统计信息，必须使用<code class="codeph">DBMS_MONITOR</code>过程为客户端标识符，服务，模块或操作启用统计信息收集。</li>
                  <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-C490364E-6DF4-4A1C-B8B4-A59451686BC0">启用端到端应用程序跟踪</a><br>要为客户端标识符，服务，模块，操作，会话，实例或数据库启用跟踪，请在<code class="codeph">DBMS_MONITOR</code>包中执行相应的过程。
                  </li>
                  <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-045E1093-E389-4F2A-94CB-820AF356C564">使用SQL跟踪和TKPROF生成输出文件</a><br>本节介绍使用SQL Trace和TKPROF的基本过程。</li>
                  <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-A92E180C-8F2C-4864-ABFC-8439CEFFE368">解释TKPROF输出的准则</a><br>虽然<code class="codeph">TKPROF</code>提供了有用的分析，但最准确的效率衡量标准是应用程序的性能。在<code class="codeph">TKPROF</code>输出的末尾是该过程在跟踪运行期间执行的工作的摘要。
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-440D3AD4-B302-408E-8627-FE8032DD09F9__GUID-1522EF5F-2A61-41BE-A38E-258535495C27">
                  <p class="notep1">也可以看看：</p>
                  <p><a href="../sqpug/tuning-SQL-Plus.html#SQPUG534" target="_blank"><span><cite>SQL * Plus用户指南和参考</cite></span></a> ，了解使用Autotrace跟踪和调优SQL * Plus语句</p>
               </div>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="monitoring-and-tracing-sql.html#GUID-CA494EFF-53D7-4345-9576-8FED65F35AAE" title="使用DBMS_MONITOR跟踪数据库操作，使用SQL Test Case Builder打包与性能问题相关的信息，使用SQL Trace生成问题SQL语句的诊断数据。">监视和跟踪SQL</a></p>
                  </div>
               </div>
            </div>
            <a id="TGSQL792"></a><div class="props_rev_3"><a id="GUID-246A5A52-E666-4DBC-BDF6-98B83260A7AD" name="GUID-246A5A52-E666-4DBC-BDF6-98B83260A7AD"></a><h3 id="TGSQL-GUID-246A5A52-E666-4DBC-BDF6-98B83260A7AD" class="sect3"><span class="enumeration_section">22.1</span>端到端应用程序跟踪概述</h3>
               <div>
                  <p>端到端应用程序跟踪可以通过客户端标识符，服务，模块，操作，会话，实例或整个数据库来识别过多数据库工作负载的来源，例如高负载SQL语句。</p>
                  <p>在多层环境中，中间层将请求从最终客户端路由到不同的数据库会话，从而难以跨数据库会话跟踪客户端。端到端应用程序跟踪是一种基础结构，它使用客户端ID通过数据库的所有层唯一地跟踪特定的最终客户端，并提供有关最终客户端在数据库中执行的操作的信息。</p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-E9F88E73-FB9A-40CF-B133-B5BF30F2BC56">端到端应用程序跟踪的目的</a><br>端到端应用程序跟踪简化了多层环境中诊断性能问题的过程。
                     </li>
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-5A0DF363-2BF3-4AD7-A4BC-9CBF45855DE7">多租户环境中的端到端应用程序跟踪</a><br>从<span>Oracle Database 12c</span>第2版（12.2）开始，当您连接到CDB中的容器时，新的<code class="codeph">V$</code>视图将启用对特定于容器的跟踪文件的读访问权。
                     </li>
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-31EF2BD5-28DB-488F-A855-8DA324F6970B">用于端到端应用程序跟踪的工具</a><br>SQL Trace工具和TKPROF是两种基本的性能诊断工具，可以帮助您准确评估应用程序运行的SQL语句的效率。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-440D3AD4-B302-408E-8627-FE8032DD09F9" title="本章介绍了端到端应用程序跟踪的内容，以及如何生成和读取跟踪文件。">执行应用程序跟踪</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL94999"></a><div class="props_rev_3"><a id="GUID-E9F88E73-FB9A-40CF-B133-B5BF30F2BC56" name="GUID-E9F88E73-FB9A-40CF-B133-B5BF30F2BC56"></a><h4 id="TGSQL-GUID-E9F88E73-FB9A-40CF-B133-B5BF30F2BC56" class="sect4"><span class="enumeration_section">22.1.1</span>端到端应用程序跟踪的目的</h4>
                  <div>
                     <p>端到端应用程序跟踪简化了多层环境中诊断性能问题的过程。</p>
                     <p>例如，您可以识别过多数据库工作负载的来源，例如高负载SQL语句，并与负责用户联系。此外，有问题的用户可以与您联系。然后，您可以确定此用户会话在非CDB或PDB级别执行的操作</p>
                     <p>端到端应用程序跟踪还通过跟踪服务中的特定模块和操作来简化应用程序工作负载的管理。模块和操作名称由应用程序开发人员设置。例如，您将使用<code class="codeph">DBMS_APPLICATION_INFO</code>包中的<code class="codeph">SET_MODULE</code>和<code class="codeph">SET_ACTION</code>过程在PL / SQL程序中设置这些值。
                     </p>
                     <p>端到端应用程序跟踪可以识别数据库中的工作负载问题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>客户标识符</p>
                           <p>根据登录ID指定最终用户，例如<code class="codeph">HR.HR</code></p>
                        </li>
                        <li>
                           <p>服务</p>
                           <p>指定一组具有公共属性，服务级别阈值和优先级的应用程序;或单一申请，例如会计申请的<code class="codeph">ACCTG</code></p>
                        </li>
                        <li>
                           <p>模</p>
                           <p>指定应用程序的功能块，例如“应收帐款”或“总帐”</p>
                        </li>
                        <li>
                           <p>行动</p>
                           <p>指定模块中的操作，例如<code class="codeph">INSERT</code>或<code class="codeph">UPDATE</code>操作</p>
                        </li>
                        <li>
                           <p>会议</p>
                           <p>指定基于本地实例上的给定数据库会话标识符（SID）的会话</p>
                        </li>
                        <li>
                           <p>例</p>
                           <p>根据实例名称指定给定的数据库实例</p>
                        </li>
                        <li>
                           <p>容器</p>
                           <p>指定CDB中的容器</p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-246A5A52-E666-4DBC-BDF6-98B83260A7AD" title="端到端应用程序跟踪可以通过客户端标识符，服务，模块，操作，会话，实例或整个数据库来识别过多数据库工作负载的来源，例如高负载SQL语句。">端到端应用程序跟踪概述</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-5A0DF363-2BF3-4AD7-A4BC-9CBF45855DE7" name="GUID-5A0DF363-2BF3-4AD7-A4BC-9CBF45855DE7"></a><h4 id="TGSQL-GUID-5A0DF363-2BF3-4AD7-A4BC-9CBF45855DE7" class="sect4"><span class="enumeration_section">22.1.2</span>多租户环境中的端到端应用程序跟踪</h4>
                  <div>
                     <p>从<span>Oracle Database 12c</span>第2版（12.2）开始，当您连接到CDB中的容器时，新的<code class="codeph">V$</code>视图将启用对特定于容器的跟踪文件的读访问权。
                     </p>
                     <p>主要用例如下：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>CDB管理员必须查看特定PDB的跟踪。</p>
                           <p><code class="codeph">V$DIAG_TRACE_FILE</code>视图列出ADR跟踪目录中包含来自特定PDB的跟踪数据的所有跟踪文件。 <code class="codeph">V$DIAG_TRACE_FILE_CONTENTS</code>显示跟踪文件的内容。
                           </p>
                        </li>
                        <li>
                           <p>PDB管理员必须查看特定PDB的跟踪。</p>
                           <p>您可以使用SQL Trace收集PDB应用程序中执行的SQL语句的诊断数据。跟踪数据包括SQL跟踪（事件10046）和优化程序跟踪（事件10053）。使用<code class="codeph">V$</code>视图，开发人员只能访问SQL或优化程序跟踪记录，而无需访问整个跟踪文件。
                           </p>
                        </li>
                     </ul>
                     <p>要使用户和工具能够确定哪个PDB与文件或文件的一部分相关联，PDB注释存在于跟踪文件，事件转储和日志文件中。PDB信息是存储在每个跟踪文件的<code class="codeph">.trm</code>文件中的结构化元数据的一部分。每条记录都会捕获以下属性：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">CON_ID</code> ，它是与数据关联的容器的ID</p>
                        </li>
                        <li>
                           <p><code class="codeph">CON_UID</code> ，它是容器的唯一ID</p>
                        </li>
                        <li>
                           <p><code class="codeph">NAME</code> ，即容器的名称</p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-5A0DF363-2BF3-4AD7-A4BC-9CBF45855DE7__GUID-CE633469-668E-4109-86D6-2B27FDD48393">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="performing-application-tracing.html#GUID-DED467E4-4890-47B7-84DB-FAB180E9E780" title="您可以使用数据字典和V $视图来监视跟踪。">应用程序跟踪视图</a> ”</span></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-246A5A52-E666-4DBC-BDF6-98B83260A7AD" title="端到端应用程序跟踪可以通过客户端标识符，服务，模块，操作，会话，实例或整个数据库来识别过多数据库工作负载的来源，例如高负载SQL语句。">端到端应用程序跟踪概述</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL95001"></a><div class="props_rev_3"><a id="GUID-31EF2BD5-28DB-488F-A855-8DA324F6970B" name="GUID-31EF2BD5-28DB-488F-A855-8DA324F6970B"></a><h4 id="TGSQL-GUID-31EF2BD5-28DB-488F-A855-8DA324F6970B" class="sect4"><span class="enumeration_section">22.1.3</span>端到端应用程序跟踪工具</h4>
                  <div>
                     <p>SQL Trace工具和TKPROF是两种基本的性能诊断工具，可以帮助您准确评估应用程序运行的SQL语句的效率。</p>
                     <p>为获得最佳效果， <code class="codeph">EXPLAIN PLAN</code>这些工具与<code class="codeph">EXPLAIN PLAN</code>使用，而不是单独使用<code class="codeph">EXPLAIN PLAN</code> 。在将跟踪信息写入文件后，您可以将此数据与TRCSESS实用程序合并，然后使用TKPROF或SQL Trace对其进行诊断。
                     </p>
                     <p>端到端应用程序跟踪的推荐接口是Oracle企业管理器云控制（云控制）。使用Cloud Control，您可以查看每种使用者类型的最高使用者，并为特定使用者启用或禁用统计信息收集和SQL跟踪。如果Cloud Control不可用，则可以使用<code class="codeph">DBMS_MONITOR</code> API管理此功能。</p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-374ABE48-C63F-4A7B-B80E-906A51F9246C">SQL跟踪工具概述</a><br>SQL Trace工具提供有关各个SQL语句的性能信息。
                        </li>
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-A1F41137-03E2-43AD-98E4-AD49760C4C35">TKPROF概述</a><br>要格式化跟踪文件的内容并将输出放入可读输出文件，请运行TKPROF程序。
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-31EF2BD5-28DB-488F-A855-8DA324F6970B__GUID-43AB6FE3-7020-4671-894D-BB80E869BC62">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<code class="codeph">DBMS_MONITOR</code> ， <code class="codeph">DBMS_SESSION</code> ， <code class="codeph">DBMS_SERVICE</code>和<code class="codeph">DBMS_APPLICATION_INFO</code>程序包的信息，请<code class="codeph">DBMS_SESSION</code> <a href="../arpls/DBMS_MONITOR.html#ARPLS-GUID-951568BF-D798-4456-8478-15FEEBA0C78E" target="_blank"><span><cite>Oracle Database PL / SQL程序包和类型参考</cite></span></a></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-246A5A52-E666-4DBC-BDF6-98B83260A7AD" title="端到端应用程序跟踪可以通过客户端标识符，服务，模块，操作，会话，实例或整个数据库来识别过多数据库工作负载的来源，例如高负载SQL语句。">端到端应用程序跟踪概述</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL807"></a><div class="props_rev_3"><a id="GUID-374ABE48-C63F-4A7B-B80E-906A51F9246C" name="GUID-374ABE48-C63F-4A7B-B80E-906A51F9246C"></a><h5 id="TGSQL-GUID-374ABE48-C63F-4A7B-B80E-906A51F9246C" class="sect5"><span class="enumeration_section">22.1.3.1</span> SQL跟踪工具概述</h5>
                     <div>
                        <p>SQL Trace工具提供有关各个SQL语句的性能信息。</p>
                        <p>SQL Trace为每个语句生成以下统计信息：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>解析，执行和获取计数</p>
                           </li>
                           <li>
                              <p>CPU和经过的时间</p>
                           </li>
                           <li>
                              <p>物理读取和逻辑读取</p>
                           </li>
                           <li>
                              <p>处理的行数</p>
                           </li>
                           <li>
                              <p>错过了库缓存</p>
                           </li>
                           <li>
                              <p>每个解析发生的用户名</p>
                           </li>
                           <li>
                              <p>每次提交和回滚</p>
                           </li>
                           <li>
                              <p>等待每个SQL语句的事件数据，以及每个跟踪文件的摘要</p>
                           </li>
                        </ul>
                        <p>如果关闭SQL语句的游标，则SQL Trace还提供包含以下内容的行源信息：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>行操作显示每个SQL语句的实际执行计划</p>
                           </li>
                           <li>
                              <p>一行中的行数，一致读取数，物理读取数，物理写入次数和每次操作所用的时间</p>
                           </li>
                        </ul>
                        <p>虽然您可以为会话或实例启用SQL跟踪工具，但Oracle建议您改为使用<code class="codeph">DBMS_SESSION</code>或<code class="codeph">DBMS_MONITOR</code>软件包。为会话或实例启用SQL跟踪工具时，将在用户会话或实例中执行的所有SQL语句的性能统计信息放入跟踪文件中。使用SQL跟踪工具可能会影响性能，并可能导致系统开销增加，CPU使用率过高以及磁盘空间不足。
                        </p>
                        <p>TRCSESS命令行实用程序根据特定条件（例如会话或客户端ID）合并来自多个跟踪文件的跟踪信息。</p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-374ABE48-C63F-4A7B-B80E-906A51F9246C__GUID-EAF6702E-8B42-4626-A7D6-CCAF15AC181D">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="performing-application-tracing.html#GUID-9E4264C7-76AF-451B-99ED-83FB1AAAE3E5" title="TRCSESS实用程序根据用户指定的条件合并所选跟踪文件的跟踪输出。">TRCSESS</a> ”</span></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="performing-application-tracing.html#GUID-C490364E-6DF4-4A1C-B8B4-A59451686BC0" title="要为客户端标识符，服务，模块，操作，会话，实例或数据库启用跟踪，请在DBMS_MONITOR包中执行相应的过程。">启用端到端应用程序跟踪</a> ”</span>以了解如何使用<code class="codeph">DBMS_SESSION</code>或<code class="codeph">DBMS_MONITOR</code>程序包为会话或实例启用SQL跟踪</p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-31EF2BD5-28DB-488F-A855-8DA324F6970B" title="SQL Trace工具和TKPROF是两种基本的性能诊断工具，可以帮助您准确评估应用程序运行的SQL语句的效率。">用于端到端应用程序跟踪的工具</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL808"></a><div class="props_rev_3"><a id="GUID-A1F41137-03E2-43AD-98E4-AD49760C4C35" name="GUID-A1F41137-03E2-43AD-98E4-AD49760C4C35"></a><h5 id="TGSQL-GUID-A1F41137-03E2-43AD-98E4-AD49760C4C35" class="sect5"><span class="enumeration_section">22.1.3.2</span> TKPROF概述</h5>
                     <div>
                        <p>要格式化跟踪文件的内容并将输出放入可读输出文件，请运行TKPROF程序。</p>
                        <p>TKPROF还可以执行以下操作：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>创建一个将统计信息存储在数据库中的SQL脚本</p>
                           </li>
                           <li>
                              <p>确定SQL语句的执行计划</p>
                           </li>
                        </ul>
                        <p>TKPROF报告使用其消耗的资源执行的每个语句，调用它的次数以及它处理的行数。此信息使您可以找到使用最大资源的语句。有了基线，您可以评估所使用的资源是否合理。</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-31EF2BD5-28DB-488F-A855-8DA324F6970B" title="SQL Trace工具和TKPROF是两种基本的性能诊断工具，可以帮助您准确评估应用程序运行的SQL语句的效率。">用于端到端应用程序跟踪的工具</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div><a id="TGSQL793"></a><div class="props_rev_3"><a id="GUID-33FA4E54-C759-480B-A075-CF75E6D85CAD" name="GUID-33FA4E54-C759-480B-A075-CF75E6D85CAD"></a><h3 id="TGSQL-GUID-33FA4E54-C759-480B-A075-CF75E6D85CAD" class="sect3"><span class="enumeration_section">22.2</span>为端到端跟踪启用统计信息收集</h3>
               <div>
                  <p>要使用PL / SQL收集适当的统计信息，必须使用<code class="codeph">DBMS_MONITOR</code>过程为客户端标识符，服务，模块或操作启用统计信息收集。</p>
                  <p>默认级别是会话级统计信息收集。统计信息收集对于数据库是全局的，并在重新启动数据库实例后继续。</p>
                  <p>您可以按以下标准收集统计信息：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-EE7E5FD9-36AD-4E35-951E-6F9B345217DC">启用客户端ID的统计信息收集</a><br><code class="codeph">CLIENT_ID_STAT_ENABLE</code>过程为给定的客户端ID启用统计信息收集，而<code class="codeph">CLIENT_ID_STAT_DISABLE</code>过程禁用它。
                     </li>
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-EC773447-7BA3-4D03-9593-3AF7FDA118EC">为服务，模块和操作启用统计信息收集</a><br>过程<code class="codeph">SERV_MOD_ACT_STAT_ENABLE</code>启用服务，模块和操作组合的统计信息收集，而过程<code class="codeph">SERV_MOD_ACT_STAT_DISABLE</code>禁用服务，模块和操作组合的统计信息收集。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-440D3AD4-B302-408E-8627-FE8032DD09F9" title="本章介绍了端到端应用程序跟踪的内容，以及如何生成和读取跟踪文件。">执行应用程序跟踪</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL94955"></a><a id="TGSQL794"></a><div class="props_rev_3"><a id="GUID-EE7E5FD9-36AD-4E35-951E-6F9B345217DC" name="GUID-EE7E5FD9-36AD-4E35-951E-6F9B345217DC"></a><h4 id="TGSQL-GUID-EE7E5FD9-36AD-4E35-951E-6F9B345217DC" class="sect4"><span class="enumeration_section">22.2.1</span>启用客户端ID的统计信息收集</h4>
                  <div>
                     <p><code class="codeph">CLIENT_ID_STAT_ENABLE</code>过程为给定的客户端ID启用统计信息收集，而<code class="codeph">CLIENT_ID_STAT_DISABLE</code>过程禁用它。
                     </p>
                     <div class="section">
                        <p>您可以在<code class="codeph">V$SESSION</code>的<code class="codeph">CLIENT_IDENTIFIER</code>列中查看客户端标识符。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-EE7E5FD9-36AD-4E35-951E-6F9B345217DC__GUID-15601E6F-BEA8-4E64-8FE0-F127D815E110">假设</p>
                        <p>本教程假定您要为ID为<code class="codeph">oe.oe</code>的客户端启用然后禁用统计信息收集。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-EE7E5FD9-36AD-4E35-951E-6F9B345217DC__GUID-849F3A6C-271F-4F01-A671-9FD4D55930EE">要为客户端标识符启用和禁用统计信息收集：</p>
                        <ol>
                           <li>
                              <p>启动SQL * Plus，然后使用适当的权限连接到数据库。</p>
                           </li>
                           <li>
                              <p>为<code class="codeph">oe.oe</code>启用统计信息收集。
                              </p>
                              <p>例如，运行以下命令：</p><pre class="pre codeblock"><code>EXECUTE DBMS_MONITOR.CLIENT_ID_STAT_ENABLE（client_id =&gt;'OE.OE'）;</code></pre></li>
                           <li>
                              <p>禁用<code class="codeph">oe.oe</code>统计信息收集。
                              </p>
                              <p>例如，运行以下命令：</p><pre class="pre codeblock"><code>EXECUTE DBMS_MONITOR.CLIENT_ID_STAT_DISABLE（client_id =&gt;'OE.OE'）;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-33FA4E54-C759-480B-A075-CF75E6D85CAD" title="要使用PL / SQL收集适当的统计信息，必须使用DBMS_MONITOR中的过程为客户端标识符，服务，模块或操作启用统计信息收集。">为端到端跟踪启用统计信息收集</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94956"></a><a id="TGSQL795"></a><div class="props_rev_3"><a id="GUID-EC773447-7BA3-4D03-9593-3AF7FDA118EC" name="GUID-EC773447-7BA3-4D03-9593-3AF7FDA118EC"></a><h4 id="TGSQL-GUID-EC773447-7BA3-4D03-9593-3AF7FDA118EC" class="sect4"><span class="enumeration_section">22.2.2</span>启用服务，模块和操作的统计信息收集</h4>
                  <div>
                     <p>过程<code class="codeph">SERV_MOD_ACT_STAT_ENABLE</code>启用服务，模块和操作组合的统计信息收集，而过程<code class="codeph">SERV_MOD_ACT_STAT_DISABLE</code>禁用服务，模块和操作组合的统计信息收集。
                     </p>
                     <div class="section">
                        <p>使用前面的<code class="codeph">DBMS_MONITOR</code>过程更改模块或操作时，更改将在会话中执行下一个用户调用时生效。例如，如果在会话中将模块设置为<code class="codeph">module1</code> ，并且如果在会话中的用户调用中将模块重置为<code class="codeph">module2</code> ，则在此用户调用期间模块仍为<code class="codeph">module1</code> 。在会话的下一个用户调用中，模块将更改为<code class="codeph">module2</code> 。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-EC773447-7BA3-4D03-9593-3AF7FDA118EC__GUID-8BD9AEF2-9028-4E3C-B199-961C69498F66">假设</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>本教程假定您要收集统计信息，如下所示：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>对于<code class="codeph">ACCTG</code>服务</p>
                           </li>
                           <li>
                              <p>对于<code class="codeph">PAYROLL</code>模块中的所有操作</p>
                           </li>
                           <li>
                              <p>对于<code class="codeph">GLEDGER</code>模块中的<code class="codeph">INSERT ITEM</code>操作</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-EC773447-7BA3-4D03-9593-3AF7FDA118EC__GUID-1D7DFFDB-7921-4C91-8095-AB3CEC818BE0">要为服务，模块和操作启用和禁用统计信息收集，请执行以下操作：</p>
                        <ol>
                           <li>
                              <p>启动SQL * Plus，然后使用适当的权限连接到数据库。</p>
                           </li>
                           <li>
                              <p>为所需的服务，模块和操作启用统计信息收集。</p>
                              <p>例如，运行以下命令：</p><pre class="pre codeblock"><code>BEGIN DBMS_MONITOR.SERV_MOD_ACT_STAT_ENABLE（service_name =&gt;'ACCTG'，module_name =&gt;'PAYROLL'）;结束; BEGIN DBMS_MONITOR.SERV_MOD_ACT_STAT_ENABLE（service_name =&gt;'ACCTG'，module_name =&gt;'GLEDGER'，action_name =&gt;'INSERT ITEM'）;结束;</code></pre></li>
                           <li>
                              <p>禁用先前指定的服务，模块和操作组合的统计信息收集。</p>
                              <p>例如，运行以下命令：</p><pre class="pre codeblock"><code>BEGIN DBMS_MONITOR.SERV_MOD_ACT_STAT_DISABLE（service_name =&gt;'ACCTG'，module_name =&gt;'GLEDGER'，action_name =&gt;'INSERT ITEM'）;结束;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-33FA4E54-C759-480B-A075-CF75E6D85CAD" title="要使用PL / SQL收集适当的统计信息，必须使用DBMS_MONITOR中的过程为客户端标识符，服务，模块或操作启用统计信息收集。">为端到端跟踪启用统计信息收集</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL797"></a><div class="props_rev_3"><a id="GUID-C490364E-6DF4-4A1C-B8B4-A59451686BC0" name="GUID-C490364E-6DF4-4A1C-B8B4-A59451686BC0"></a><h3 id="TGSQL-GUID-C490364E-6DF4-4A1C-B8B4-A59451686BC0" class="sect3"><span class="enumeration_section">22.3</span>启用端到端应用程序跟踪</h3>
               <div>
                  <p>要为客户端标识符，服务，模块，操作，会话，实例或数据库启用跟踪，请在<code class="codeph">DBMS_MONITOR</code>包中执行相应的过程。
                  </p>
                  <p>根据您提供的条件，特定跟踪信息将捕获在一组跟踪文件中，并合并为单个输出跟踪文件。您可以通过以下标准为特定诊断和工作负载管理启用跟踪：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-BBC8ECB8-8EB6-4815-9C38-E9631DEE3C04">启用客户端标识符的跟踪</a><br>要为数据库全局跟踪指定的客户端标识符，请使用<code class="codeph">DBMS_MONITOR.CLIENT_ID_TRACE_ENABLE</code>过程。
                     </li>
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-37DD6B78-6A99-4D6B-83A8-D96587A4EFD4">启用对服务，模块和操作的跟踪</a><br>除非过程指定数据库实例名称，否则<code class="codeph">DBMS_MONITOR.SERV_MOD_ACT_TRACE_ENABLE</code>过程将为数据库全局启用对服务名称，模块和操作的指定组合的SQL跟踪。
                     </li>
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-F872D6F9-E015-481F-80F6-8A7036A6AD29">启用会话跟踪</a><br><code class="codeph">SESSION_TRACE_ENABLE</code>过程为本地实例上的给定数据库会话标识符（SID）启用跟踪。
                     </li>
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-C8E6C609-C849-4C74-9F69-2F41FA1A2ABA">启用实例或数据库的跟踪</a><br><code class="codeph">DBMS_MONITOR.DATABASE_TRACE_ENABLE</code>过程会覆盖所有其他会话级跟踪，但是与客户端标识符，服务，模块和操作跟踪互补。所有当前和未来会话都启用了跟踪。
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-C490364E-6DF4-4A1C-B8B4-A59451686BC0__FINDINGTRACEFILESINORACLEDATABASEAD-A653A227">
                     <p class="notep1">也可以看看：</p>
                     <p>有关如何查找跟踪文件的信息，请参见<a href="../admin/diagnosing-and-resolving-problems.html#ADMIN-GUID-34137402-19A6-4134-93AE-D6DD02242F61" target="_blank"><span><cite>“Oracle数据库管理员指南”</cite></span></a></p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-440D3AD4-B302-408E-8627-FE8032DD09F9" title="本章介绍了端到端应用程序跟踪的内容，以及如何生成和读取跟踪文件。">执行应用程序跟踪</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL94957"></a><a id="TGSQL798"></a><div class="props_rev_3"><a id="GUID-BBC8ECB8-8EB6-4815-9C38-E9631DEE3C04" name="GUID-BBC8ECB8-8EB6-4815-9C38-E9631DEE3C04"></a><h4 id="TGSQL-GUID-BBC8ECB8-8EB6-4815-9C38-E9631DEE3C04" class="sect4"><span class="enumeration_section">22.3.1</span>启用客户端标识符的跟踪</h4>
                  <div>
                     <p>要为数据库全局跟踪指定的客户端标识符，请使用<code class="codeph">DBMS_MONITOR.CLIENT_ID_TRACE_ENABLE</code>过程。
                     </p>
                     <div class="section">
                        <p><code class="codeph">CLIENT_ID_TRACE_DISABLE</code>过程禁用数据库的全局跟踪，以获取给定的客户端标识符。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BBC8ECB8-8EB6-4815-9C38-E9631DEE3C04__GUID-20C74CFA-3E25-4905-8393-6DB415046F94">假设</p>
                        <p>本教程假设以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">OE.OE</code>是要为其启用SQL跟踪的客户端标识符。
                              </p>
                           </li>
                           <li>
                              <p>您希望在跟踪中包含等待信息。</p>
                           </li>
                           <li>
                              <p>您希望从跟踪中排除绑定信息。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BBC8ECB8-8EB6-4815-9C38-E9631DEE3C04__GUID-A4A6EBE3-E78C-47FF-8DAB-F792F91E764E">要启用和禁用客户端标识符的跟踪：</p>
                        <ol>
                           <li>
                              <p>启动SQL * Plus，然后使用适当的权限连接到数据库。</p>
                           </li>
                           <li>
                              <p>为客户端启用跟踪。</p>
                              <p>例如，执行以下程序：</p><pre class="pre codeblock"><code>BEGIN DBMS_MONITOR.CLIENT_ID_TRACE_ENABLE（client_id =&gt;'OE.OE'，等待=&gt;真，绑定=&gt;假）;结束;</code></pre></li>
                           <li>
                              <p>禁用客户端的跟踪。</p>
                              <p>例如，执行以下命令：</p><pre class="pre codeblock"><code>EXECUTE DBMS_MONITOR.CLIENT_ID_TRACE_DISABLE（client_id =&gt;'OE.OE'）;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-C490364E-6DF4-4A1C-B8B4-A59451686BC0" title="要为客户端标识符，服务，模块，操作，会话，实例或数据库启用跟踪，请在DBMS_MONITOR包中执行相应的过程。">启用端到端应用程序跟踪</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94958"></a><a id="TGSQL799"></a><div class="props_rev_3"><a id="GUID-37DD6B78-6A99-4D6B-83A8-D96587A4EFD4" name="GUID-37DD6B78-6A99-4D6B-83A8-D96587A4EFD4"></a><h4 id="TGSQL-GUID-37DD6B78-6A99-4D6B-83A8-D96587A4EFD4" class="sect4"><span class="enumeration_section">22.3.2</span>启用对服务，模块和操作的跟踪</h4>
                  <div>
                     <p>除非过程指定数据库实例名称，否则<code class="codeph">DBMS_MONITOR.SERV_MOD_ACT_TRACE_ENABLE</code>过程将为数据库全局启用对服务名称，模块和操作的指定组合的SQL跟踪。
                     </p>
                     <div class="section">
                        <p>对于给定的服务名称，模块和操作名称组合， <code class="codeph">SERV_MOD_ACT_TRACE_DISABLE</code>过程会在所有已启用的实例上<code class="codeph">SERV_MOD_ACT_TRACE_DISABLE</code>禁用跟踪。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-37DD6B78-6A99-4D6B-83A8-D96587A4EFD4__GUID-AEB64E7C-3706-46BD-93E4-DECABFB93D8C">假设</p>
                        <p>本教程假设以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您想要为服务<code class="codeph">ACCTG</code>启用跟踪。</p>
                           </li>
                           <li>
                              <p>您希望为<code class="codeph">ACCTG</code>服务和<code class="codeph">PAYROLL</code>模块的组合启用所有操作的跟踪。
                              </p>
                           </li>
                           <li>
                              <p>您希望在跟踪中包含等待信息。</p>
                           </li>
                           <li>
                              <p>您希望从跟踪中排除绑定信息。</p>
                           </li>
                           <li>
                              <p>您只想为<code class="codeph">inst1</code>实例启用跟踪。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-37DD6B78-6A99-4D6B-83A8-D96587A4EFD4__GUID-D3BDEAD2-C6CA-45BF-B2A9-62B36E21190E">要启用和禁用服务，模块和操作的跟踪，请执行以下操作：</p>
                        <ol>
                           <li>
                              <p>启动SQL * Plus，然后使用适当的权限连接到数据库。</p>
                           </li>
                           <li>
                              <p>启用对服务，模块和操作的跟踪。</p>
                              <p>例如，执行以下命令：</p><pre class="pre codeblock"><code>BEGIN DBMS_MONITOR.SERV_MOD_ACT_TRACE_ENABLE（service_name =&gt;'ACCTG'，module_name =&gt;'PAYROLL'，waits =&gt; true，binds =&gt; false，instance_name =&gt;'inst1'）;结束;</code></pre></li>
                           <li>
                              <p>禁用对服务，模块和操作的跟踪。</p>
                              <p>例如，执行以下命令：</p><pre class="pre codeblock"><code>BEGIN DBMS_MONITOR.SERV_MOD_ACT_TRACE_DISABLE（service_name =&gt;'ACCTG'，module_name =&gt;'PAYROLL'，instance_name =&gt;'inst1'）;结束;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-C490364E-6DF4-4A1C-B8B4-A59451686BC0" title="要为客户端标识符，服务，模块，操作，会话，实例或数据库启用跟踪，请在DBMS_MONITOR包中执行相应的过程。">启用端到端应用程序跟踪</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL95363"></a><a id="TGSQL800"></a><div class="props_rev_3"><a id="GUID-F872D6F9-E015-481F-80F6-8A7036A6AD29" name="GUID-F872D6F9-E015-481F-80F6-8A7036A6AD29"></a><h4 id="TGSQL-GUID-F872D6F9-E015-481F-80F6-8A7036A6AD29" class="sect4"><span class="enumeration_section">22.3.3</span>启用会话跟踪</h4>
                  <div>
                     <p><code class="codeph">SESSION_TRACE_ENABLE</code>过程为本地实例上的给定数据库会话标识符（SID）启用跟踪。
                     </p>
                     <div class="section">
                        <p><code class="codeph">DBMS_MONITOR</code>包只能由具有DBA角色的用户调用，而用户还可以通过调用<code class="codeph">DBMS_SESSION.SESSION_TRACE_ENABLE</code>过程为自己的会话启用SQL跟踪，如以下示例所示：</p><pre class="pre codeblock"><code>BEGIN DBMS_SESSION.SESSION_TRACE_ENABLE（等待=&gt;真，绑定=&gt;假）;结束;</code></pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-F872D6F9-E015-481F-80F6-8A7036A6AD29__GUID-C6D865FF-3AD6-452B-A846-1EB77476F1BA">假设</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>本教程假设以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您希望以管理员权限登录数据库。</p>
                           </li>
                           <li>
                              <p>用户<code class="codeph">OE</code>有一个活动会话。
                              </p>
                           </li>
                           <li>
                              <p>您想暂时启用<code class="codeph">OE</code>会话的跟踪。
                              </p>
                           </li>
                           <li>
                              <p>您希望在跟踪中包含等待信息。</p>
                           </li>
                           <li>
                              <p>您希望从跟踪中排除绑定信息。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-F872D6F9-E015-481F-80F6-8A7036A6AD29__GUID-7C7CFCB6-6DBF-42A8-936F-2F361780902C">要启用和禁用会话跟踪，请执行以下操作：</p>
                        <ol>
                           <li>
                              <p>启动SQL * Plus，然后使用管理员权限登录数据库。</p>
                           </li>
                           <li>
                              <p>确定要跟踪的会话的会话ID和序列号值。</p>
                              <p>例如，查询<code class="codeph">V$SESSION</code>如下：</p><pre class="pre codeblock"><code>SELECT SID，SERIAL＃，USERNAME FROM V $ SESSION WHERE USERNAME ='OE'; SID SERIAL＃USERNAME ---------- ---------- -------------------------- ---- 27 60 OE</code></pre></li>
                           <li>
                              <p>使用上一步中的值启用特定会话的跟踪。</p>
                              <p>例如，执行以下程序以启用<code class="codeph">OE</code>会话的跟踪，其中<code class="codeph">true</code>参数包括跟踪中的等待信息， <code class="codeph">false</code>参数从跟踪中排除绑定信息：</p><pre class="pre codeblock"><code>BEGIN DBMS_MONITOR.SESSION_TRACE_ENABLE（session_id =&gt; 27，serial_num =&gt; 60，waits =&gt; true，binds =&gt; false）;结束;</code></pre></li>
                           <li>
                              <p>禁用会话跟踪。</p>
                              <p><code class="codeph">SESSION_TRACE_DISABLE</code>过程禁用给定数据库会话标识符（SID）和序列号的跟踪。例如：</p><pre class="pre codeblock"><code>BEGIN DBMS_MONITOR.SESSION_TRACE_DISABLE（session_id =&gt; 27，serial_num =&gt; 60）;结束;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-C490364E-6DF4-4A1C-B8B4-A59451686BC0" title="要为客户端标识符，服务，模块，操作，会话，实例或数据库启用跟踪，请在DBMS_MONITOR包中执行相应的过程。">启用端到端应用程序跟踪</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL95364"></a><a id="TGSQL95365"></a><a id="TGSQL801"></a><div class="props_rev_3"><a id="GUID-C8E6C609-C849-4C74-9F69-2F41FA1A2ABA" name="GUID-C8E6C609-C849-4C74-9F69-2F41FA1A2ABA"></a><h4 id="TGSQL-GUID-C8E6C609-C849-4C74-9F69-2F41FA1A2ABA" class="sect4"><span class="enumeration_section">22.3.4</span>启用实例或数据库的跟踪</h4>
                  <div>
                     <p><code class="codeph">DBMS_MONITOR.DATABASE_TRACE_ENABLE</code>过程会覆盖所有其他会话级跟踪，但是与客户端标识符，服务，模块和操作跟踪互补。所有当前和未来会话都启用了跟踪。
                     </p>
                     <div class="section">
                        <p>所有新会话都会继承此过程指定的等待和绑定信息，直到您调用<code class="codeph">DATABASE_TRACE_DISABLE</code>过程。使用<code class="codeph">instance_name</code>参数调用此过程时，该过程将重置命名实例的会话级SQL跟踪。如果在没有<code class="codeph">instance_name</code>参数的<code class="codeph">instance_name</code>调用此过程，则该过程将重置整个数据库的会话级SQL跟踪。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C8E6C609-C849-4C74-9F69-2F41FA1A2ABA__GUID-666995B3-5DCF-4711-9996-38616B1ECDA8">先决条件</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>您必须具有管理权限才能执行<code class="codeph">DATABASE_TRACE_ENABLE</code>过程。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C8E6C609-C849-4C74-9F69-2F41FA1A2ABA__GUID-0DE54101-F7E2-4DAD-A3CE-F6AD2176D384">假设</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>本教程假设以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您希望为<code class="codeph">inst1</code>实例启用所有SQL的跟踪。
                              </p>
                           </li>
                           <li>
                              <p>您希望等待信息在跟踪中。</p>
                           </li>
                           <li>
                              <p>您不希望跟踪中的绑定信息。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C8E6C609-C849-4C74-9F69-2F41FA1A2ABA__GUID-435AE75D-59A4-4D34-9CC3-227C697C5747">要启用和禁用会话跟踪，请执行以下操作：</p>
                        <ol>
                           <li>
                              <p>启动SQL * Plus，然后使用必要的权限登录数据库。</p>
                           </li>
                           <li>
                              <p>调用<code class="codeph">DATABASE_TRACE_ENABLE</code>过程以对给定实例或整个数据库启用SQL跟踪。
                              </p>
                              <p>例如，执行以下程序，其中<code class="codeph">true</code>参数指定等待信息在跟踪中，而<code class="codeph">false</code>参数指定跟踪中没有绑定信息：</p><pre class="pre codeblock"><code>BEGIN DBMS_MONITOR.DATABASE_TRACE_ENABLE（等待=&gt; true，binds =&gt; false，instance_name =&gt;'inst1'）;结束;</code></pre></li>
                           <li>
                              <p>禁用会话跟踪。</p>
                              <p><code class="codeph">SESSION_TRACE_DISABLE</code>过程禁用跟踪。例如，以下程序禁用<code class="codeph">inst1</code>跟踪：</p><pre class="pre codeblock"><code>EXECUTE DBMS_MONITOR.DATABASE_TRACE_DISABLE（instance_name =&gt;'inst1'）;</code></pre><p>要禁用整个数据库的会话级SQL跟踪，请在不指定<code class="codeph">instance_name</code>参数的<code class="codeph">instance_name</code>调用<code class="codeph">DATABASE_TRACE_DISABLE</code>过程：</p><pre class="pre codeblock"><code>EXECUTE DBMS_MONITOR.DATABASE_TRACE_DISABLE（）;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-C490364E-6DF4-4A1C-B8B4-A59451686BC0" title="要为客户端标识符，服务，模块，操作，会话，实例或数据库启用跟踪，请在DBMS_MONITOR包中执行相应的过程。">启用端到端应用程序跟踪</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL809"></a><div class="props_rev_3"><a id="GUID-045E1093-E389-4F2A-94CB-820AF356C564" name="GUID-045E1093-E389-4F2A-94CB-820AF356C564"></a><h3 id="TGSQL-GUID-045E1093-E389-4F2A-94CB-820AF356C564" class="sect3"><span class="enumeration_section">22.4</span>使用SQL跟踪和TKPROF生成输出文件</h3>
               <div>
                  <p>本节介绍使用SQL Trace和TKPROF的基本过程。</p>
                  <p>生成输出文件的过程如下：</p>
                  <ol>
                     <li>
                        <p>设置跟踪文件管理的初始化参数。</p>
                        <p>请参阅<span class="q">“ <a href="performing-application-tracing.html#GUID-A4FD1913-D35A-4EE6-9CE8-361718433E91" title="要启用跟踪文件，必须确保设置了特定的初始化参数。">步骤1：设置跟踪文件管理的初始化参数</a> ”</span> 。
                        </p>
                     </li>
                     <li>
                        <p>为所需会话启用SQL跟踪工具，然后运行该应用程序。此步骤生成一个跟踪文件，其中包含应用程序发出的SQL语句的统计信息。</p>
                        <p>请参阅<span class="q">“ <a href="performing-application-tracing.html#GUID-A465F2E0-F841-4E2A-B54D-7C062C869E48" title="您可以在实例或会话级别启用SQL跟踪工具。">步骤2：启用SQL跟踪工具</a> ”</span> 。
                        </p>
                     </li>
                     <li>
                        <p>运行TKPROF将步骤2中创建的跟踪文件转换为可读输出文件。此步骤可以选择创建一个SQL脚本，您可以使用该脚本将统计信息存储在数据库中。</p>
                        <p>请参阅<span class="q">“ <a href="performing-application-tracing.html#GUID-83A1CF94-F9AC-4631-80EA-EB0B1A339C0E" title="TKPROF接受由SQL Trace工具生成的跟踪文件作为输入，并生成格式化的输出文件。TKPROF还可以生成执行计划。">步骤3：使用TKPROF生成输出文件</a> ”</span> 。
                        </p>
                     </li>
                     <li>
                        <p>（可选）运行步骤3中生成的SQL脚本，将统计信息存储在数据库中。</p>
                        <p>请参阅<span class="q">“ <a href="performing-application-tracing.html#GUID-BDB972EC-AFBC-433C-AAB9-F50F453474F4" title="您可能希望保留应用程序的SQL跟踪工具生成的统计信息的历史记录，并随时间进行比较。">步骤4：存储SQL跟踪设施统计信息</a> ”</span> 。
                        </p>
                     </li>
                  </ol>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-A4FD1913-D35A-4EE6-9CE8-361718433E91">步骤1：设置跟踪文件管理的初始化参数</a><br>要启用跟踪文件，必须确保设置了特定的初始化参数。
                     </li>
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-A465F2E0-F841-4E2A-B54D-7C062C869E48">第2步：启用SQL跟踪工具</a><br>您可以在实例或会话级别启用SQL跟踪工具。
                     </li>
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-83A1CF94-F9AC-4631-80EA-EB0B1A339C0E">第3步：使用TKPROF生成输出文件</a><br>TKPROF接受由SQL Trace工具生成的跟踪文件作为输入，并生成格式化的输出文件。TKPROF还可以生成执行计划。
                     </li>
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-BDB972EC-AFBC-433C-AAB9-F50F453474F4">第4步：存储SQL跟踪工具统计信息</a><br>您可能希望保留应用程序的SQL跟踪工具生成的统计信息的历史记录，并随时间进行比较。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-440D3AD4-B302-408E-8627-FE8032DD09F9" title="本章介绍了端到端应用程序跟踪的内容，以及如何生成和读取跟踪文件。">执行应用程序跟踪</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL811"></a><a id="TGSQL810"></a><div class="props_rev_3"><a id="GUID-A4FD1913-D35A-4EE6-9CE8-361718433E91" name="GUID-A4FD1913-D35A-4EE6-9CE8-361718433E91"></a><h4 id="TGSQL-GUID-A4FD1913-D35A-4EE6-9CE8-361718433E91" class="sect4"><span class="enumeration_section">22.4.1</span>步骤1：设置跟踪文件管理的初始化参数</h4>
                  <div>
                     <p>要启用跟踪文件，必须确保设置了特定的初始化参数。</p>
                     <div class="section">
                        <p>为会话启用SQL跟踪工具后，Oracle数据库会生成一个跟踪文件，其中包含该会话的跟踪SQL语句的统计信息。为实例启用SQL跟踪工具后，Oracle数据库会为每个进程创建单独的跟踪文件。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-A4FD1913-D35A-4EE6-9CE8-361718433E91__GUID-DC2BDA4F-2A72-4E44-A161-30879BFBF5F1">要为跟踪文件管理设置初始化参数：</p>
                        <ol>
                           <li>
                              <p>检查<code class="codeph">TIMED_STATISTICS</code> ， <code class="codeph">MAX_DUMP_FILE_SIZE</code>和<code class="codeph">DIAGNOSTIC_DEST</code>初始化参数的设置，如<span class="q">“ <a href="performing-application-tracing.html#GUID-A4FD1913-D35A-4EE6-9CE8-361718433E91__CHDCDGFH" title="此表描述了在启用SQL跟踪之前应检查的初始化参数。">表22-1</a> ”中所示</span> 。
                              </p>
                              <div class="tblformal" id="GUID-A4FD1913-D35A-4EE6-9CE8-361718433E91__CHDCDGFH">
                                 <p class="titleintable">表22-1启用SQL跟踪前要检查的初始化参数</p>
                                 <table cellpadding="4" cellspacing="0" class="Formal" title="启用SQL跟踪之前要检查的初始化参数" width="90%" border="1" summary="This table describes the initialization parameters that you should check before enabling SQL Trace." frame="hsides" rules="rows">
                                    <thead>
                                       <tr align="left" valign="top">
                                          <th align="left" valign="bottom" width="34%" id="d109757e2997">参数</th>
                                          <th align="left" valign="bottom" width="66%" id="d109757e3000">描述</th>
                                       </tr>
                                    </thead>
                                    <tbody>
                                       <tr align="left" valign="top">
                                          <td align="left" valign="top" width="34%" id="d109757e3005" headers="d109757e2997 ">
                                             <p><code class="codeph">DIAGNOSTIC_DEST</code></p>
                                          </td>
                                          <td align="left" valign="top" width="66%" headers="d109757e3005 d109757e3000 ">
                                             <p>指定自动诊断信息库（ADR）主页的位置。每个数据库实例的诊断文件都位于此专用目录中。</p>
                                          </td>
                                       </tr>
                                       <tr align="left" valign="top">
                                          <td align="left" valign="top" width="34%" id="d109757e3013" headers="d109757e2997 ">
                                             <p><code class="codeph">MAX_DUMP_FILE_SIZE</code> 
                                             </p>
                                          </td>
                                          <td align="left" valign="top" width="66%" headers="d109757e3013 d109757e3000 ">
                                             <p>在数据库实例级别启用SQL跟踪工具时，对数据库的每次调用都会以操作系统的文件格式在文件中写入文本行。操作系统块中这些文件的最大大小受此初始化参数的限制。默认值为<code class="codeph">UNLIMITED</code> 。</p>
                                          </td>
                                       </tr>
                                       <tr align="left" valign="top">
                                          <td align="left" valign="top" width="34%" id="d109757e3025" headers="d109757e2997 ">
                                             <p><code class="codeph">TIMED_STATISTICS</code> 
                                             </p>
                                          </td>
                                          <td align="left" valign="top" width="66%" headers="d109757e3025 d109757e3000 ">
                                             <p>通过SQL跟踪工具启用和禁用定时统计信息（如CPU和已用时间）的集合，以及<code class="codeph">V$</code>视图中各种统计信息的集合。
                                             </p>
                                             <p>如果<code class="codeph">STATISTICS_LEVEL</code>设置为<code class="codeph">TYPICAL</code>或<code class="codeph">ALL</code> ，则<code class="codeph">TIMED_STATISTICS</code>的默认值为<code class="codeph">true</code> 。如果<code class="codeph">STATISTICS_LEVEL</code>设置为<code class="codeph">BASIC</code> ，则<code class="codeph">TIMED_STATISTICS</code>的默认值为<code class="codeph">false</code> 。
                                             </p>
                                             <p>启用时序会导致额外的时序调用以进行低级操作。这是一个动态参数。它也是一个会话参数。</p>
                                          </td>
                                       </tr>
                                    </tbody>
                                 </table>
                              </div>
                              <!-- class="inftblhruleinformal" -->
                           </li>
                           <li>
                              <p>设计一种识别结果跟踪文件的方法。</p>
                              <p>确保您知道如何按名称区分跟踪文件。您可以通过在程序中包含<code class="codeph">SELECT <span class="codeinlineitalic"><code class="codeph">program_name</code></span> ' FROM DUAL</code>等语句来标记跟踪文件。然后，您可以将每个文件追溯到创建它的进程。
                              </p>
                              <p>您还可以设置<code class="codeph">TRACEFILE_IDENTIFIER</code>初始化参数以指定成为跟踪文件名的一部分的自定义标识符。例如，您可以将<span class="italic"><code class="codeph">my_trace_id</code></span>添加到后续跟踪文件名中，以便于使用以下内容进行识别：</p><pre class="pre codeblock"><code>ALTER SESSION SET TRACEFILE_IDENTIFIER =' <span class="italic">my_trace_id</span> ';</code></pre><p></p>
                           </li>
                           <li>
                              <p>如果操作系统保留多个版本的文件，请确保版本限制足够高，以容纳您希望SQL跟踪工具生成的跟踪文件数。</p>
                           </li>
                           <li>
                              <p>如果生成的跟踪文件可以由您自己以外的操作系统用户拥有，那么请确保您具有使用TKPROF格式化它们的必要权限。</p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-A4FD1913-D35A-4EE6-9CE8-361718433E91__GUID-2BB629C9-A913-45F1-A2A4-8A4B5A55F041">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span><cite>Oracle数据库参考</cite></span> ，了解<a href="../refrn/DIAGNOSTIC_DEST.html#REFRN10280" target="_blank"><code class="codeph">DIAGNOSTIC_DEST</code></a> ， <a href="../refrn/STATISTICS_LEVEL.html#REFRN10214" target="_blank"><code class="codeph">STATISTICS_LEVEL</code></a> ， <a href="../refrn/TIMED_STATISTICS.html#REFRN10218" target="_blank"><code class="codeph">TIMED_STATISTICS</code></a>和<a href="../refrn/TRACEFILE_IDENTIFIER.html#REFRN10220" target="_blank"><code class="codeph">TRACEFILE_IDENTIFIER</code></a>初始化参数</p>
                           </li>
                           <li>
                              <p><a href="../admin/monitoring-the-database.html#ADMIN11244" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a> ，了解如何控制跟踪文件大小</p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-045E1093-E389-4F2A-94CB-820AF356C564" title="本节介绍使用SQL Trace和TKPROF的基本过程。">使用SQL跟踪和TKPROF生成输出文件</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL812"></a><div class="props_rev_3"><a id="GUID-A465F2E0-F841-4E2A-B54D-7C062C869E48" name="GUID-A465F2E0-F841-4E2A-B54D-7C062C869E48"></a><h4 id="TGSQL-GUID-A465F2E0-F841-4E2A-B54D-7C062C869E48" class="sect4"><span class="enumeration_section">22.4.2</span>第2步：启用SQL跟踪工具</h4>
                  <div>
                     <p>您可以在实例或会话级别启用SQL跟踪工具。</p>
                     <div class="section">
                        <p>要使用的包取决于级别：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>数据库实例</p>
                              <p>使用<code class="codeph">DBMS_MONITOR.DATABASE_TRACE_ENABLE</code>程序启用跟踪，并<code class="codeph">DBMS_MONITOR.DATABASE_TRACE_DISABLE</code>程序禁用跟踪。
                              </p>
                           </li>
                           <li>
                              <p>数据库会话</p>
                              <p>使用<code class="codeph">DBMS_SESSION.SET_SQL_TRACE</code>过程启用跟踪（ <code class="codeph">true</code> ）或禁用跟踪（ <code class="codeph">false</code> ）。
                              </p>
                              <div class="infoboxnote" id="GUID-A465F2E0-F841-4E2A-B54D-7C062C869E48__GUID-14B6D693-5567-498F-834F-84177B1F2CFC">
                                 <p class="notep1">注意：</p>
                                 <p>因为运行SQL跟踪工具会增加系统开销，所以只在调优SQL语句时启用它，并在完成后禁用它。</p>
                              </div>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-A465F2E0-F841-4E2A-B54D-7C062C869E48__GUID-4938DCB2-98F4-4666-84FE-EFC32D457668">要在数据库实例级别启用和禁用跟踪：</p>
                        <ol>
                           <li>
                              <p>启动SQL * Plus，并使用管理员权限连接到数据库。</p>
                           </li>
                           <li>
                              <p>在数据库实例级别启用跟踪。</p>
                              <p>以下示例启用了对<code class="codeph">orcl</code>实例的跟踪：</p><pre class="pre codeblock"><code>EXEC DBMS_MONITOR.DATABASE_TRACE_ENABLE（INSTANCE_NAME =&gt;'orcl'）;</code></pre></li>
                           <li>
                              <p>执行要跟踪的语句。</p>
                           </li>
                           <li>
                              <p>禁用数据库实例的跟踪。</p>
                              <p>以下示例禁用<code class="codeph">orcl</code>实例的跟踪：</p><pre class="pre codeblock"><code>EXEC DBMS_MONITOR.DATABASE_TRACE_DISABLE（INSTANCE_NAME =&gt;'orcl'）;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-A465F2E0-F841-4E2A-B54D-7C062C869E48__GUID-9DCBA121-F332-4A95-B7AA-97F32A594CAB">要在会话级别启用和禁用跟踪：</p>
                        <ol>
                           <li>
                              <p>启动SQL * Plus，并使用所需的凭据连接到数据库。</p>
                           </li>
                           <li>
                              <p>启用当前会话的跟踪。</p>
                              <p>以下示例启用当前会话的跟踪：</p><pre class="pre codeblock"><code>EXEC DBMS_SESSION.SET_SQL_TRACE（sql_trace =&gt; true）;</code></pre></li>
                           <li>
                              <p>执行要跟踪的语句。</p>
                           </li>
                           <li>
                              <p>禁用当前会话的跟踪。</p>
                              <p>以下示例禁用当前会话的跟踪：</p><pre class="pre codeblock"><code>EXEC DBMS_SESSION.SET_SQL_TRACE（sql_trace =&gt; false）;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-A465F2E0-F841-4E2A-B54D-7C062C869E48__GUID-98D32ECA-274E-4453-A4DD-75360A2850E3">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../arpls/DBMS_MONITOR.html#ARPLS67166" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_MONITOR.DATABASE_TRACE_ENABLE</code></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-045E1093-E389-4F2A-94CB-820AF356C564" title="本节介绍使用SQL Trace和TKPROF的基本过程。">使用SQL跟踪和TKPROF生成输出文件</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL95366"></a><a id="TGSQL813"></a><div class="props_rev_3"><a id="GUID-83A1CF94-F9AC-4631-80EA-EB0B1A339C0E" name="GUID-83A1CF94-F9AC-4631-80EA-EB0B1A339C0E"></a><h4 id="TGSQL-GUID-83A1CF94-F9AC-4631-80EA-EB0B1A339C0E" class="sect4"><span class="enumeration_section">22.4.3</span>第3步：使用TKPROF生成输出文件</h4>
                  <div>
                     <p>TKPROF接受由SQL Trace工具生成的跟踪文件作为输入，并生成格式化的输出文件。TKPROF还可以生成执行计划。</p>
                     <div class="section">
                        <p>在SQL跟踪工具生成跟踪文件后，您可以：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>在每个单独的跟踪文件上运行TKPROF，生成多个格式化的输出文件，每个会话一个。</p>
                           </li>
                           <li>
                              <p>连接跟踪文件，然后在结果上运行TKPROF以生成整个实例的格式化输出文件。</p>
                           </li>
                           <li>
                              <p>运行TRCSESS命令行实用程序以合并来自多个跟踪文件的跟踪信息，然后对结果运行TKPROF。</p>
                           </li>
                        </ul>
                        <p>TKPROF不报告跟踪文件中记录的<code class="codeph">COMMIT</code>和<code class="codeph">ROLLBACK</code>语句。
                        </p>
                        <div class="infoboxnote" id="GUID-83A1CF94-F9AC-4631-80EA-EB0B1A339C0E__GUID-DBBB7FAD-F8F6-4FDE-AD02-9F579F433ADB">
                           <p class="notep1">注意：</p>
                           <p>SQL跟踪文件中的以下SQL语句被截断为25个字符：</p><pre class="pre codeblock"><code>SET ROLE GRANT ALTER USER ALTER ROLE创建用户创建角色</code></pre></div>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-83A1CF94-F9AC-4631-80EA-EB0B1A339C0E__GUID-4F6E3AFC-A4F2-46BD-A75D-D89E12BDD7BE">
                        <p class="titleinexample">例22-1 TKPROF输出</p><pre class="pre codeblock"><code>SELECT * FROM emp，dept WHERE emp.deptno = dept.deptno; call count cpu elapsed disk query current rows ---- ------- ------- --------- -------- ------- -  ------- ------ Parse 1 0.16 0.29 3 13 0 0执行1 0.00 0.00 0 0 0 0 Fetch 1 0.03 0.26 2 2 4 14解析期间库缓存未命中：1解析用户ID： （8）SCOTT行执行计划------- ------------------------------------ --------------- 14 MERGE JOIN 4 SORT JOIN 4表格访问（全部）'DEPT'14 SORT JOIN 14表格访问（全部）'EMP'</code></pre><p>对于此声明，TKPROF输出包括以下信息：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>SQL语句的文本</p>
                           </li>
                           <li>
                              <p>表格形式的SQL跟踪统计信息</p>
                           </li>
                           <li>
                              <p>解析和执行语句时库缓存未命中的数量。</p>
                           </li>
                           <li>
                              <p>用户最初解析该语句。</p>
                           </li>
                           <li>
                              <p><code class="codeph">EXPLAIN PLAN</code>生成的执行计划。</p>
                           </li>
                        </ul>
                        <p>TKPROF还提供了跟踪文件的用户级语句和递归SQL调用的摘要。</p>
                     </div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-045E1093-E389-4F2A-94CB-820AF356C564" title="本节介绍使用SQL Trace和TKPROF的基本过程。">使用SQL跟踪和TKPROF生成输出文件</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL834"></a><div class="props_rev_3"><a id="GUID-BDB972EC-AFBC-433C-AAB9-F50F453474F4" name="GUID-BDB972EC-AFBC-433C-AAB9-F50F453474F4"></a><h4 id="TGSQL-GUID-BDB972EC-AFBC-433C-AAB9-F50F453474F4" class="sect4"><span class="enumeration_section">22.4.4</span>第4步：存储SQL跟踪工具统计信息</h4>
                  <div>
                     <p>您可能希望保留应用程序的SQL跟踪工具生成的统计信息的历史记录，并随时间进行比较。</p>
                     <p><code class="codeph">TKPROF</code>可以生成一个SQL脚本，用于创建表并将统计信息行插入其中。该脚本包含以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">CREATE TABLE</code>语句，用于创建名为<code class="codeph">TKPROF_TABLE</code>的输出表。</p>
                        </li>
                        <li>
                           <p><code class="codeph">INSERT</code>语句，为每个跟踪的SQL语句添加一行统计信息到<code class="codeph">TKPROF_TABLE</code> 。</p>
                        </li>
                     </ul>
                     <p>运行<code class="codeph">TKPROF</code> ，运行此脚本以将统计信息存储在数据库中。
                     </p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-FEE8BC1B-4036-43F2-9FAB-4C8CFA17BE45">生成TKPROF输出SQL脚本</a><br>运行<code class="codeph">TKPROF</code> ，使用<code class="codeph">INSERT</code>参数指定生成的SQL脚本的名称。
                        </li>
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-EE4D0B73-12A6-40FA-A40E-DC312C746DD4">编辑TKPROF输出SQL脚本</a><br><code class="codeph">TKPROF</code>创建SQL脚本后，您可能希望在运行脚本之前编辑脚本。
                        </li>
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-FA5C99BF-A42B-4BB0-A963-E175E0CF4A69">查询输出表</a><br>创建输出表后，使用<code class="codeph">SELECT</code>语句进行查询。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-045E1093-E389-4F2A-94CB-820AF356C564" title="本节介绍使用SQL Trace和TKPROF的基本过程。">使用SQL跟踪和TKPROF生成输出文件</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL835"></a><div class="props_rev_3"><a id="GUID-FEE8BC1B-4036-43F2-9FAB-4C8CFA17BE45" name="GUID-FEE8BC1B-4036-43F2-9FAB-4C8CFA17BE45"></a><h5 id="TGSQL-GUID-FEE8BC1B-4036-43F2-9FAB-4C8CFA17BE45" class="sect5"><span class="enumeration_section">22.4.4.1</span>生成TKPROF输出SQL脚本</h5>
                     <div>
                        <p>运行<code class="codeph">TKPROF</code> ，使用<code class="codeph">INSERT</code>参数指定生成的SQL脚本的名称。
                        </p>
                        <div class="section">
                           <p>如果省略<code class="codeph">INSERT</code>参数，则<code class="codeph">TKPROF</code>不会生成脚本。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-BDB972EC-AFBC-433C-AAB9-F50F453474F4" title="您可能希望保留应用程序的SQL跟踪工具生成的统计信息的历史记录，并随时间进行比较。">步骤4：存储SQL跟踪工具统计信息</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL836"></a><div class="props_rev_3"><a id="GUID-EE4D0B73-12A6-40FA-A40E-DC312C746DD4" name="GUID-EE4D0B73-12A6-40FA-A40E-DC312C746DD4"></a><h5 id="TGSQL-GUID-EE4D0B73-12A6-40FA-A40E-DC312C746DD4" class="sect5"><span class="enumeration_section">22.4.4.2</span>编辑TKPROF输出SQL脚本</h5>
                     <div>
                        <p><code class="codeph">TKPROF</code>创建SQL脚本后，您可能希望在运行脚本之前编辑脚本。
                        </p>
                        <div class="section">
                           <p>如果已为先前收集的统计信息创建了输出表，并且要向此表添加新统计信息，则从脚本中删除<code class="codeph">CREATE TABLE</code>语句。然后，该脚本将新行插入现有表中。如果已创建多个输出表，可能要存储来自不同表中不同数据库的统计信息，请编辑<code class="codeph">CREATE TABLE</code>和<code class="codeph">INSERT</code>语句以更改输出表的名称。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-BDB972EC-AFBC-433C-AAB9-F50F453474F4" title="您可能希望保留应用程序的SQL跟踪工具生成的统计信息的历史记录，并随时间进行比较。">步骤4：存储SQL跟踪工具统计信息</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL838"></a><a id="TGSQL837"></a><div class="props_rev_3"><a id="GUID-FA5C99BF-A42B-4BB0-A963-E175E0CF4A69" name="GUID-FA5C99BF-A42B-4BB0-A963-E175E0CF4A69"></a><h5 id="TGSQL-GUID-FA5C99BF-A42B-4BB0-A963-E175E0CF4A69" class="sect5"><span class="enumeration_section">22.4.4.3</span>查询输出表</h5>
                     <div>
                        <p>创建输出表后，使用<code class="codeph">SELECT</code>语句进行查询。
                        </p>
                        <div class="section">
                           <p>以下<code class="codeph">CREATE TABLE</code>语句创建<code class="codeph">TKPROF_TABLE</code> ：</p><pre class="pre codeblock"><code>CREATE TABLE TKPROF_TABLE（DATE_OF_INSERT DATE，CURSOR_NUM NUMBER，DEPTH NUMBER，USER_ID NUMBER，PARSE_CNT NUMBER，PARSE_CPU NUMBER，PARSE_ELAP NUMBER，PARSE_DISK NUMBER，PARSE_QUERY NUMBER，PARSE_CURRENT NUMBER，PARSE_MISS NUMBER，EXE_COUNT NUMBER，EXE_CPU NUMBER，EXE_ELAP NUMBER，EXE_DISK NUMBER，EXE_QUERY NUMBER，EXE_CURRENT NUMBER，EXE_MISS NUMBER，EXE_ROWS NUMBER，FETCH_COUNT NUMBER，FETCH_CPU NUMBER，FETCH_ELAP NUMBER，FETCH_DISK NUMBER，FETCH_QUERY NUMBER，FETCH_CURRENT NUMBER，FETCH_ROWS NUMBER，CLOCK_TICKS NUMBER，SQL_STATEMENT LONG）;</code></pre><p>大多数输出表列直接对应于格式化输出文件中显示的统计信息。例如， <code class="codeph">PARSE_CNT</code>列值对应于输出文件中的解析步骤的计数统计。
                           </p>
                           <p>下表中的列可帮助您标识一行统计信息。</p>
                           <div class="tblformal" id="GUID-FA5C99BF-A42B-4BB0-A963-E175E0CF4A69__CHDFEIAB">
                              <p class="titleintable">表22-2用于标识统计行的TKPROF_TABLE列</p>
                              <table cellpadding="4" cellspacing="0" class="Formal" title="用于标识统计行的TKPROF_TABLE列" width="100%" border="1" summary="This table describes the TKPROF_TABLE columns." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="26%" id="d109757e4142">柱</th>
                                       <th align="left" valign="bottom" width="74%" id="d109757e4145">描述</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="26%" id="d109757e4150" headers="d109757e4142 ">
                                          <p><code class="codeph">SQL_STATEMENT</code></p>
                                       </td>
                                       <td align="left" valign="top" width="74%" headers="d109757e4150 d109757e4145 ">
                                          <p>这是SQL跟踪工具收集统计信息行的SQL语句。由于此列的数据类型为<code class="codeph">LONG</code> ，因此无法在表达式或<code class="codeph">WHERE</code>子句条件中使用它。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="26%" id="d109757e4164" headers="d109757e4142 ">
                                          <p><code class="codeph">DATE_OF_INSERT</code></p>
                                       </td>
                                       <td align="left" valign="top" width="74%" headers="d109757e4164 d109757e4145 ">
                                          <p>这是将行插入表中的日期和时间。此值与SQL跟踪工具收集统计信息的时间不同。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="26%" id="d109757e4172" headers="d109757e4142 ">
                                          <p><code class="codeph">深度</code></p>
                                       </td>
                                       <td align="left" valign="top" width="74%" headers="d109757e4172 d109757e4145 ">
                                          <p>这表示发出SQL语句的递归级别。例如，值为0表示用户发出了该语句。值为1表示Oracle数据库生成语句为递归调用，以处理值为0的语句（用户发出的语句）。值<span class="italic">n</span>表示Oracle数据库生成该语句作为递归调用以处理值为<span class="italic">n</span> -1的语句。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="26%" id="d109757e4186" headers="d109757e4142 ">
                                          <p><code class="codeph">用户身份</code></p>
                                       </td>
                                       <td align="left" valign="top" width="74%" headers="d109757e4186 d109757e4145 ">
                                          <p>这标识发出语句的用户。该值也出现在格式化的输出文件中。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="26%" id="d109757e4194" headers="d109757e4142 ">
                                          <p><code class="codeph">CURSOR_NUM</code></p>
                                       </td>
                                       <td align="left" valign="top" width="74%" headers="d109757e4194 d109757e4145 ">
                                          <p>Oracle数据库使用此列值来跟踪每个SQL语句所分配的游标。</p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p>输出表不存储语句的执行计划。以下查询返回输出表中的统计信息。这些统计信息对应于<span class="q">“ <a href="performing-application-tracing.html#GUID-71A1BF7C-8353-4B8B-94E6-FB7A62C121B6__CHDDBHAD">示例22-7</a> ”中</span>显示的格式化输出。
                           </p><pre class="pre codeblock"><code>SELECT * FROM TKPROF_TABLE;</code></pre><p>示例输出显示如下：</p><pre class="pre codeblock"><code>DATE_OF_INSERT CURSOR_NUM DEPTH USER_ID PARSE_CNT PARSE_CPU PARSE_ELAP -------------- ---------- ----- ------- ------- -  --------- ---------- 21-DEC-2017 1 0 8 1 16 22 PARSE_DISK PARSE_QUERY PARSE_CURRENT PARSE_MISS EXE_COUNT EXE_CPU ----------- --------- ------------- ---------- --------- ------- 3 11 0 1 1 0 EXE_ELAP EXE_DISK EXE_QUERY EXE_CURRENT EXE_MISS EXE_ROWS FETCH_COUNT -------- -------- --------- ----------- --- ----- -------- ----------- 0 0 0 0 0 0 1 FETCH_CPU FETCH_ELAP FETCH_DISK FETCH_QUERY FETCH_CURRENT FETCH_ROWS --------- ---- ------ ---------- ----------- ------------- ---------- 2 20 2 2 4 10 SQL_STATEMENT ------------------------------------------- -------------------------- SELECT * FROM EMP，DEPT WHERE EMP.DEPTNO = DEPT.DEPTNO</code></pre></div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-BDB972EC-AFBC-433C-AAB9-F50F453474F4" title="您可能希望保留应用程序的SQL跟踪工具生成的统计信息的历史记录，并随时间进行比较。">步骤4：存储SQL跟踪工具统计信息</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div><a id="TGSQL820"></a><div class="props_rev_3"><a id="GUID-A92E180C-8F2C-4864-ABFC-8439CEFFE368" name="GUID-A92E180C-8F2C-4864-ABFC-8439CEFFE368"></a><h3 id="TGSQL-GUID-A92E180C-8F2C-4864-ABFC-8439CEFFE368" class="sect3"><span class="enumeration_section">22.5</span>解释TKPROF输出的指南</h3>
               <div>
                  <p>虽然<code class="codeph">TKPROF</code>提供了有用的分析，但最准确的效率衡量标准是应用程序的性能。在<code class="codeph">TKPROF</code>输出的末尾是该过程在跟踪运行期间执行的工作的摘要。
                  </p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-A853A5BC-B2BB-4071-AF28-550D4E2C5848">解释统计数据的指南</a><br>时序统计的分辨率为百分之一秒。因此，对光标的任何操作需要百分之一秒或更短的时间可能无法准确计时。
                     </li>
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-681AB1DC-082B-460C-8656-DC3286627D0C">递归SQL语句的准则</a><br>递归SQL是Oracle数据库必须发出的用于执行用户发出的SQL语句的附加SQL。
                     </li>
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-16256746-D82C-46DF-8EE0-B4230C22C723">决定调整哪些陈述的指南</a><br>您必须确定哪些SQL语句使用最多的CPU或磁盘资源。
                     </li>
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-EBA1A650-19A7-4C79-B602-166442887595">在TKPROF解释中避免陷阱的指南</a><br>在解释<code class="codeph">TKPROF</code>输出时，有助于了解常见的陷阱。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-440D3AD4-B302-408E-8627-FE8032DD09F9" title="本章介绍了端到端应用程序跟踪的内容，以及如何生成和读取跟踪文件。">执行应用程序跟踪</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL827"></a><div class="props_rev_3"><a id="GUID-A853A5BC-B2BB-4071-AF28-550D4E2C5848" name="GUID-A853A5BC-B2BB-4071-AF28-550D4E2C5848"></a><h4 id="TGSQL-GUID-A853A5BC-B2BB-4071-AF28-550D4E2C5848" class="sect4"><span class="enumeration_section">22.5.1</span>解释统计数据的解释指南</h4>
                  <div>
                     <p>时序统计的分辨率为百分之一秒。因此，对光标的任何操作需要百分之一秒或更短的时间可能无法准确计时。</p>
                     <div class="section">
                        <p>在解释统计数据时请记住时间限制。特别是，在解释执行速度非常快的简单查询的结果时要小心。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-A92E180C-8F2C-4864-ABFC-8439CEFFE368" title="虽然TKPROF提供了有用的分析，但最准确的效率衡量标准是应用程序的性能。在TKPROF输出的末尾是该过程在跟踪运行期间执行的工作的摘要。">解释TKPROF输出的准则</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL828"></a><div class="props_rev_3"><a id="GUID-681AB1DC-082B-460C-8656-DC3286627D0C" name="GUID-681AB1DC-082B-460C-8656-DC3286627D0C"></a><h4 id="TGSQL-GUID-681AB1DC-082B-460C-8656-DC3286627D0C" class="sect4"><span class="enumeration_section">22.5.2</span>递归SQL语句指南</h4>
                  <div>
                     <p>递归SQL是Oracle数据库必须发出的用于执行用户发出的SQL语句的附加SQL。</p>
                     <div class="section">
                        <p>从概念上讲，递归SQL是“副作用SQL”。例如，如果会话将一行插入到没有足够空间容纳该行的表中，则数据库会进行递归SQL调用以动态分配空间。当数据字典信息在内存中不可用时，数据库也会生成递归调用，因此必须从磁盘检索。</p>
                        <p>如果在启用SQL跟踪工具时发生递归调用，则<code class="codeph">TKPROF</code>会为递归SQL语句生成统计信息，并将它们清楚地标记为输出文件中的递归SQL语句。您可以通过将<code class="codeph">SYS</code>命令行参数设置为<code class="codeph">NO</code>来禁止在输出文件中列出Oracle数据库内部递归调用（例如，空间管理）。递归SQL语句的统计信息包含在该语句的列表中，而不是在导致递归调用的SQL语句的列表中。因此，在计算处理SQL语句所需的总资源时，请考虑该语句的统计信息以及该语句导致的递归调用的统计信息。
                        </p>
                        <div class="infoboxnote" id="GUID-681AB1DC-082B-460C-8656-DC3286627D0C__GUID-524CB3AD-4964-489A-8FCA-C657343460B8">
                           <p class="notep1">注意：</p>
                           <p>SQL级别的操作不包括递归SQL统计信息。</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-A92E180C-8F2C-4864-ABFC-8439CEFFE368" title="虽然TKPROF提供了有用的分析，但最准确的效率衡量标准是应用程序的性能。在TKPROF输出的末尾是该过程在跟踪运行期间执行的工作的摘要。">解释TKPROF输出的准则</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL833"></a><div class="props_rev_3"><a id="GUID-16256746-D82C-46DF-8EE0-B4230C22C723" name="GUID-16256746-D82C-46DF-8EE0-B4230C22C723"></a><h4 id="TGSQL-GUID-16256746-D82C-46DF-8EE0-B4230C22C723" class="sect4"><span class="enumeration_section">22.5.3</span>确定调整哪些陈述的指南</h4>
                  <div>
                     <p>您必须确定哪些SQL语句使用最多的CPU或磁盘资源。</p>
                     <div class="section">
                        <p>如果启用了<code class="codeph">TIMED_STATISTICS</code>参数，则可以在<code class="codeph">CPU</code>列中找到高CPU活动。如果未启用<code class="codeph">TIMED_STATISTICS</code> ，请检查<code class="codeph">QUERY</code>和<code class="codeph">CURRENT</code>列。
                        </p>
                        <p>除了锁定问题和低效的PL / SQL循环之外，查找问题语句既不需要CPU时间也不需要经过的时间。关键是块访问次数，包括查询（即，受读取一致性）和当前（即，不受读取一致性）。将在当前模式下获取将要更新的段头和块，但所有查询和子查询处理都以查询模式请求数据。这些与实例统计数据<code class="codeph">CONSISTENT GETS</code>和<code class="codeph">DB BLOCK GETS</code>完全相同。您可以在<code class="codeph">disk</code>列中找到高磁盘活动。
                        </p>
                        <p>以下列表显示了输出文件中出现的一个SQL语句的<code class="codeph">TKPROF</code>输出：</p><pre class="pre codeblock"><code>SELECT * FROM emp，dept WHERE emp.deptno = dept.deptno; call count cpu elapsed disk query current rows ---- ------- ------- --------- -------- ------- -  ------- ------ Parse 11 0.08 0.18 0 0 0 0执行11 0.23 0.66 0 3 6 0 Fetch 35 6.70 6.83 100 12326 2 824 ------------ -------------------------------------------------- ----总计57 7.01 7.67 100 12329 8 826解析期间库缓存中未命中：0</code></pre><p>如果可以接受7.01 CPU秒并检索824行，那么您无需再查看此跟踪输出。实际上， <code class="codeph">TKPROF</code>报告在调整练习中的主要用途是从详细的调整阶段中消除过程。
                        </p>
                        <p>输出表明进行了10次不必要的解析调用（因为此单个语句存在11次解析调用）并且执行了数组获取操作。获取的行数多于获取的行数。<code class="codeph">CPU</code>和<code class="codeph">elapsed</code>时间之间的较大间隙表示物理I / O.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-16256746-D82C-46DF-8EE0-B4230C22C723__GUID-39EB01AA-B54D-4A3B-9813-242117A976EB">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="performing-application-tracing.html#GUID-71A1BF7C-8353-4B8B-94E6-FB7A62C121B6__CHDEICAF">例22-4</a> ”</span></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-A92E180C-8F2C-4864-ABFC-8439CEFFE368" title="虽然TKPROF提供了有用的分析，但最准确的效率衡量标准是应用程序的性能。在TKPROF输出的末尾是该过程在跟踪运行期间执行的工作的摘要。">解释TKPROF输出的准则</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL839"></a><div class="props_rev_3"><a id="GUID-EBA1A650-19A7-4C79-B602-166442887595" name="GUID-EBA1A650-19A7-4C79-B602-166442887595"></a><h4 id="TGSQL-GUID-EBA1A650-19A7-4C79-B602-166442887595" class="sect4"><span class="enumeration_section">22.5.4</span>在TKPROF解释中避免陷阱的指南</h4>
                  <div>
                     <p>在解释<code class="codeph">TKPROF</code>输出时，有助于了解常见的陷阱。
                     </p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-2D5E244C-1852-40F0-B222-3DBA59380A56">避免争论陷阱的指南</a><br>如果您不知道在运行时绑定的值，则可能会陷入参数陷阱。
                        </li>
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-1308081A-42E3-4B9B-8838-67AFB6DA4AF2">避免读一致性陷阱的指南</a><br>在不知道未提交的事务已对列进行一系列更新的情况下，很难理解为什么会发生如此多的块访问。
                        </li>
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-207AB87B-22D5-40EA-A796-AE6CA631E3D7">避免模式陷阱的指南</a><br>在某些情况下，一个明显简单的索引查询会查看许多数据库块并以当前模式访问它们。
                        </li>
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-7A286CCD-6889-43C2-B72E-A4BB93E88E1A">避免时间陷阱的指南</a><br>在某些情况下，查询需要花费不可思议的长时间。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-A92E180C-8F2C-4864-ABFC-8439CEFFE368" title="虽然TKPROF提供了有用的分析，但最准确的效率衡量标准是应用程序的性能。在TKPROF输出的末尾是该过程在跟踪运行期间执行的工作的摘要。">解释TKPROF输出的准则</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL840"></a><div class="props_rev_3"><a id="GUID-2D5E244C-1852-40F0-B222-3DBA59380A56" name="GUID-2D5E244C-1852-40F0-B222-3DBA59380A56"></a><h5 id="TGSQL-GUID-2D5E244C-1852-40F0-B222-3DBA59380A56" class="sect5"><span class="enumeration_section">22.5.4.1</span>避免论证陷阱的指导原则</h5>
                     <div>
                        <p>如果您不知道在运行时绑定的值，则可能会陷入参数陷阱。</p>
                        <div class="section">
                           <p><code class="codeph">EXPLAIN PLAN</code>无法从SQL语句的文本中确定绑定变量的类型，并且始终假定类型为<code class="codeph">VARCHAR</code> 。如果绑定变量实际上是数字或日期，那么<code class="codeph">TKPROF</code>可能导致隐式数据转换，这可能导致执行效率低下的计划。要避免这种情况，请在查询中尝试不同的数据类型，并自行执行转换。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-EBA1A650-19A7-4C79-B602-166442887595" title="在解释TKPROF输出时，有助于了解常见的陷阱。">TKPROF解释中避免陷阱的指南</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL841"></a><div class="props_rev_3"><a id="GUID-1308081A-42E3-4B9B-8838-67AFB6DA4AF2" name="GUID-1308081A-42E3-4B9B-8838-67AFB6DA4AF2"></a><h5 id="TGSQL-GUID-1308081A-42E3-4B9B-8838-67AFB6DA4AF2" class="sect5"><span class="enumeration_section">22.5.4.2</span>避免读一致性陷阱的指南</h5>
                     <div>
                        <p>在不知道未提交的事务已对列进行一系列更新的情况下，很难理解为什么会发生如此多的块访问。</p>
                        <div class="section">
                           <p>这种情况通常不可重复。如果再次运行该进程，则另一个事务不太可能以相同的方式与其进行交互。</p><pre class="pre codeblock"><code>SELECT name_id FROM cq_names WHERE name ='FLOOR';调用cpu经过磁盘查询当前行---- ----- --- ------- ---- ----- ------- ---- Parse 1 0.10 0.18 0 0 0 0执行1 0.00 0.00 0 0 0 0获取1 0.11 0.21 2 101 0 1解析期间库缓存未命中：1解析用户ID：01（USER1）行执行计划e ------ ---- ---- 0 SELECT STATEMENT 1'CQ_NAMES'的表访问（BY ROWID）'CQ_NAMES_NAME'的索引（RANGE SCAN）（NON_UNIQUE）</code></pre></div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-EBA1A650-19A7-4C79-B602-166442887595" title="在解释TKPROF输出时，有助于了解常见的陷阱。">TKPROF解释中避免陷阱的指南</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL842"></a><div class="props_rev_3"><a id="GUID-207AB87B-22D5-40EA-A796-AE6CA631E3D7" name="GUID-207AB87B-22D5-40EA-A796-AE6CA631E3D7"></a><h5 id="TGSQL-GUID-207AB87B-22D5-40EA-A796-AE6CA631E3D7" class="sect5"><span class="enumeration_section">22.5.4.3</span>避免模式陷阱的指南</h5>
                     <div>
                        <p>在某些情况下，一个明显简单的索引查询会查看许多数据库块并以当前模式访问它们。</p>
                        <div class="section">
                           <p>以下示例显示了模式陷阱的极端（因此很容易检测到）示例：</p><pre class="pre codeblock"><code>SELECT name_id FROM cq_names WHERE name ='FLOOR'; call count cpu elapsed disk query current rows -------- ------- -------- --------- ------- --- --- ------- ---- Parse 1 0.06 0.10 0 0 0 0执行1 0.02 0.02 0 0 0 0获取1 0.23 0.30 31 31 3 1解析期间库缓存中未命中：0解析用户ID： 02（USER2）行执行计划------- ------------------------------------ --------------- 0 SELECT STATEMENT 2340'CQ_NAMES'的表访问（BY ROWID）'CQ_NAMES_NAME'的索引（范围扫描）（NON-UNIQUE）</code></pre><p>两个统计信息表明查询可能已使用全表扫描执行：当前模式块访问，以及源自计划中的表访问行源的行数。解释是所需的索引是在生成跟踪文件之后但在<code class="codeph">TKPROF</code>运行之前构建的。生成新的跟踪文件会提供以下数据：</p><pre class="pre codeblock"><code>SELECT name_id FROM cq_names WHERE name ='FLOOR'; call count cpu elapsed disk query current rows ----- ------ ------ -------- ----- ------ ------ -  ----- Parse 1 0.01 0.02 0 0 0 0执行1 0.00 0.00 0 0 0 0 Fetch 1 0.00 0.00 0 2 0 1解析期间库缓存未命中：0解析用户ID：02（USER2）行执行计划 - ------ -------------------------------------------- ------- 0 SELECT STATEMENT 1'CQ_NAMES'的表访问（BY ROWID）'CQ_NAMES_NAME'的索引（范围扫描）（NON-UNIQUE）</code></pre><p>在正确的版本中，解析调用占用10毫秒的CPU时间和20毫秒的经过时间，但查询显然没有时间执行并执行提取。出现这些异常是因为相对于执行和获取数据所花费的时间，10毫秒的时钟周期太长。在这种情况下，重要的是要对语句进行多次执行，以便您具有统计上有效的数字。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-EBA1A650-19A7-4C79-B602-166442887595" title="在解释TKPROF输出时，有助于了解常见的陷阱。">TKPROF解释中避免陷阱的指南</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL843"></a><div class="props_rev_3"><a id="GUID-7A286CCD-6889-43C2-B72E-A4BB93E88E1A" name="GUID-7A286CCD-6889-43C2-B72E-A4BB93E88E1A"></a><h5 id="TGSQL-GUID-7A286CCD-6889-43C2-B72E-A4BB93E88E1A" class="sect5"><span class="enumeration_section">22.5.4.4</span>避免时间陷阱的指南</h5>
                     <div>
                        <p>在某些情况下，查询需要花费不可思议的长时间。</p>
                        <div class="section">
                           <p>例如，以下7行更新在19秒内执行：</p><pre class="pre codeblock"><code>UPDATE cq_names SET ATTRIBUTES = lower（ATTRIBUTES）WHERE ATTRIBUTES =：att call count cpu elapsed disk query current rows -------- ------- -------- ----- ---- -------- -------- ------- ---------- Parse 1 0.06 0.24 0 0 0 0执行1 0.62 19.62 22 526 12 7 Fetch 0 0.00 0.00 0 0 0 0解析期间库缓存未命中：1解析用户ID：02（USER2）行执行计划------- ------------- -------------------------------------- 0更新声明2519'CQ_NAMES的表访问（全部） “</code></pre><p>解释是来自另一个交易的干扰。在这种情况下，另一个事务在发布更新之前和之后的几秒钟内对表<code class="codeph">cq_names</code>保持共享锁。诊断干扰效应正在发生需要经验。一方面，当干扰仅造成短暂的延迟（或前一个例子中的块访问量略有增加）时，比较数据是必不可少的。但是，如果干扰仅产生适度的开销，并且如果该语句基本上是有效的，则其统计信息可能不需要分析。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-EBA1A650-19A7-4C79-B602-166442887595" title="在解释TKPROF输出时，有助于了解常见的陷阱。">TKPROF解释中避免陷阱的指南</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div><a id="TGSQL95367"></a><div class="sect2"><a id="GUID-66C145A4-A8C9-4688-A00C-22B71C19DFF6" name="GUID-66C145A4-A8C9-4688-A00C-22B71C19DFF6"></a><h3 id="TGSQL-GUID-66C145A4-A8C9-4688-A00C-22B71C19DFF6" class="sect3"><span class="enumeration_section">22.6</span>应用程序跟踪实用程序</h3>
               <div>
                  <p>Oracle跟踪实用程序是TKPROF和TRCSESS。</p>
                  <p>本节介绍以下实用程序的语法和语义：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-9E4264C7-76AF-451B-99ED-83FB1AAAE3E5">TRCSESS</a><br>TRCSESS实用程序根据用户指定的条件合并所选跟踪文件的跟踪输出。
                     </li>
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-9C03013B-6587-4475-8888-16E84DAD5806">TKPROF</a><br>TKPROF程序格式化跟踪文件的内容并将输出放入可读的输出文件中。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-440D3AD4-B302-408E-8627-FE8032DD09F9" title="本章介绍了端到端应用程序跟踪的内容，以及如何生成和读取跟踪文件。">执行应用程序跟踪</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL95368"></a><div class="sect3"><a id="GUID-9E4264C7-76AF-451B-99ED-83FB1AAAE3E5" name="GUID-9E4264C7-76AF-451B-99ED-83FB1AAAE3E5"></a><h4 id="TGSQL-GUID-9E4264C7-76AF-451B-99ED-83FB1AAAE3E5" class="sect4"><span class="enumeration_section">22.6.1</span> TRCSESS</h4>
                  <div>
                     <p>TRCSESS实用程序根据用户指定的条件合并所选跟踪文件的跟踪输出。</p>
                     <p>在TRCSESS将跟踪信息合并到单个输出文件中之后，TKPROF可以处理输出文件。本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-D4D248DF-8269-49B0-B719-EF41F85D4E34">目的</a><br>TRCSESS对于整合特定会话的跟踪以用于性能或调试目的非常有用。
                        </li>
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-6D9676AF-F14B-4576-9FBF-25F87D39082D">方针</a><br>您必须指定<code class="codeph">session</code> ， <code class="codeph">clientid</code> ， <code class="codeph">service</code> ， <code class="codeph">action</code>或<code class="codeph">module</code>选项之一。
                        </li>
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-2A3B090A-BF15-4676-93D5-21F7B9D890DA">句法</a><br></li>
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-906FA3FD-257A-4EE4-8A36-5733098565FB">选项</a><br>TRCSESS支持许多命令行选项。
                        </li>
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-42AAC7B3-6FD1-4125-AFEC-12F79E31F757">例子</a><br>本节演示常见的TRCSESS用例。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-66C145A4-A8C9-4688-A00C-22B71C19DFF6" title="Oracle跟踪实用程序是TKPROF和TRCSESS。">应用程序跟踪实用程序</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL95369"></a><div class="sect4"><a id="GUID-D4D248DF-8269-49B0-B719-EF41F85D4E34" name="GUID-D4D248DF-8269-49B0-B719-EF41F85D4E34"></a><h5 id="TGSQL-GUID-D4D248DF-8269-49B0-B719-EF41F85D4E34" class="sect5"><span class="enumeration_section">22.6.1.1</span>目的</h5>
                     <div>
                        <p>TRCSESS对于整合特定会话的跟踪以用于性能或调试目的非常有用。</p>
                        <p>在专用服务器模型中跟踪特定会话通常不是问题，因为一个进程在其生命周期内为会话提供服务。您可以从属于服务器进程的跟踪文件中查看会话的跟踪信息。但是，在共享服务器配置中，用户会话由不同进程随时间服务。用户会话的跟踪分散在属于不同进程的不同跟踪文件中，这使得很难全面了解会话的生命周期。</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-9E4264C7-76AF-451B-99ED-83FB1AAAE3E5" title="TRCSESS实用程序根据用户指定的条件合并所选跟踪文件的跟踪输出。">TRCSESS</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95370"></a><div class="sect4"><a id="GUID-6D9676AF-F14B-4576-9FBF-25F87D39082D" name="GUID-6D9676AF-F14B-4576-9FBF-25F87D39082D"></a><h5 id="TGSQL-GUID-6D9676AF-F14B-4576-9FBF-25F87D39082D" class="sect5"><span class="enumeration_section">22.6.1.2</span>指南</h5>
                     <div>
                        <p>您必须指定<code class="codeph">session</code> ， <code class="codeph">clientid</code> ， <code class="codeph">service</code> ， <code class="codeph">action</code>或<code class="codeph">module</code>选项之一。
                        </p>
                        <p>如果指定多个选项，则TRCSESS会将满足指定条件的所有跟踪文件合并到输出文件中。</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-9E4264C7-76AF-451B-99ED-83FB1AAAE3E5" title="TRCSESS实用程序根据用户指定的条件合并所选跟踪文件的跟踪输出。">TRCSESS</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95371"></a><div class="sect4"><a id="GUID-2A3B090A-BF15-4676-93D5-21F7B9D890DA" name="GUID-2A3B090A-BF15-4676-93D5-21F7B9D890DA"></a><h5 id="TGSQL-GUID-2A3B090A-BF15-4676-93D5-21F7B9D890DA" class="sect5"><span class="enumeration_section">22.6.1.3</span>语法</h5>
                     <div><pre class="pre codeblock"><code>trcsess [output = <span class="italic">output_file_name</span> ] [session = <span class="italic">session_id</span> ] [clientid = <span class="italic">client_id</span> ] [service = <span class="italic">service_name</span> ] [action = <span class="italic">action_name</span> ] [module = <span class="italic">module_name</span> ] [ <span class="italic">trace_files</span> ]</code></pre></div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-9E4264C7-76AF-451B-99ED-83FB1AAAE3E5" title="TRCSESS实用程序根据用户指定的条件合并所选跟踪文件的跟踪输出。">TRCSESS</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95372"></a><div class="sect4"><a id="GUID-906FA3FD-257A-4EE4-8A36-5733098565FB" name="GUID-906FA3FD-257A-4EE4-8A36-5733098565FB"></a><h5 id="TGSQL-GUID-906FA3FD-257A-4EE4-8A36-5733098565FB" class="sect5"><span class="enumeration_section">22.6.1.4</span>选项</h5>
                     <div>
                        <p>TRCSESS支持许多命令行选项。</p>
                        <div class="tblformal" id="GUID-906FA3FD-257A-4EE4-8A36-5733098565FB__GUID-5261394C-CED4-4FA8-A15A-F68DC457DC6A">
                           <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="TRSESS options" frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" id="d109757e6271">争论</th>
                                    <th align="left" valign="bottom" id="d109757e6274">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d109757e6279" headers="d109757e6271 ">
                                       <p><code class="codeph">产量</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d109757e6279 d109757e6274 ">
                                       <p>指定生成输出的文件。如果未指定此选项，则实用程序将写入标准输出。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d109757e6287" headers="d109757e6271 ">
                                       <p><code class="codeph">会议</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d109757e6287 d109757e6274 ">
                                       <p>合并指定会话的跟踪信息。会话标识符是会话索引和会话序列号的组合，例如<code class="codeph">21.2371</code> 。您可以在<code class="codeph">V$SESSION</code>视图中找到这些值。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d109757e6301" headers="d109757e6271 ">
                                       <p><code class="codeph">客户端ID</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d109757e6301 d109757e6274 ">
                                       <p>合并指定客户端ID的跟踪信息。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d109757e6309" headers="d109757e6271 ">
                                       <p><code class="codeph">服务</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d109757e6309 d109757e6274 ">
                                       <p>合并指定服务名称的跟踪信息。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d109757e6317" headers="d109757e6271 ">
                                       <p><code class="codeph">行动</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d109757e6317 d109757e6274 ">
                                       <p>合并指定操作名称的跟踪信息。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d109757e6325" headers="d109757e6271 ">
                                       <p><code class="codeph">模</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d109757e6325 d109757e6274 ">
                                       <p>合并指定模块名称的跟踪信息。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d109757e6333" headers="d109757e6271 ">
                                       <p><span class="italic"><code class="codeph">trace_files</code></span></p>
                                    </td>
                                    <td align="left" valign="top" headers="d109757e6333 d109757e6274 ">
                                       <p>列出由空格分隔的跟踪文件名，TRCSESS应在其中查找跟踪信息。您可以使用通配符（ <code class="codeph">*</code> ）指定跟踪文件名。如果未指定跟踪文件，则TRCSESS将使用当前目录中的所有文件作为输入。
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-9E4264C7-76AF-451B-99ED-83FB1AAAE3E5" title="TRCSESS实用程序根据用户指定的条件合并所选跟踪文件的跟踪输出。">TRCSESS</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95374"></a><a id="TGSQL95375"></a><a id="TGSQL95373"></a><div class="sect4"><a id="GUID-42AAC7B3-6FD1-4125-AFEC-12F79E31F757" name="GUID-42AAC7B3-6FD1-4125-AFEC-12F79E31F757"></a><h5 id="TGSQL-GUID-42AAC7B3-6FD1-4125-AFEC-12F79E31F757" class="sect5"><span class="enumeration_section">22.6.1.5</span>例子</h5>
                     <div>
                        <p>本节演示常见的TRCSESS用例。</p>
                        <div class="example" id="GUID-42AAC7B3-6FD1-4125-AFEC-12F79E31F757__GUID-1307EAF0-EBDB-4DFA-B32E-9DD944B5E070">
                           <p class="titleinexample">示例22-2跟踪单个会话</p>
                           <p>TRCSESS的此示例输出显示特定会话的跟踪容器。在此示例中，会话索引和序列号等于<code class="codeph">21.2371</code> 。当前目录中的所有文件都被视为输入。
                           </p><pre class="pre codeblock"><code>trcsess session = 21.2371</code></pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-42AAC7B3-6FD1-4125-AFEC-12F79E31F757__GUID-72FAAF97-8DD4-4903-BFD3-A7E9C6408B9A">
                           <p class="titleinexample">示例22-3指定多个跟踪文件</p>
                           <p>以下示例指定了两个跟踪文件：</p><pre class="pre codeblock"><code>trcsess session = 21.2371 main_12359.trc main_12995.trc</code></pre><p>示例输出类似于以下内容：</p><pre class="pre codeblock"><code>[PROCESS ID = 12359] *** 2014-04-02 09：48：28.376 PARSING IN CURSOR＃1 len = 17 dep = 0 uid = 27 oct = 3 lid = 27 tim = 868373970961 hv = 887450622 ad ='22683fb4' select * from cat END OF STMT PARSE＃1：c = 0，e = 339，p = 0，cr = 0，cu = 0，mis = 0，r = 0，dep = 0，og = 4，tim = 868373970944执行＃1：c = 0，e = 221，p = 0，cr = 0，cu = 0，mis = 0，r = 0，dep = 0，og = 4，tim = 868373971411 FETCH＃1：c = 0 ，e = 791，p = 0，cr = 7，cu = 0，mis = 0，r = 1，dep = 0，og = 4，tim = 868373972435 FETCH＃1：c = 0，e = 1486，p = 0，cr = 20，cu = 0，mis = 0，r = 6，dep = 0，og = 4，tim = 868373986238 *** 2014-04-02 10：03：58.058 XCTEND rlbk = 0，rd_only = 1 STAT＃1 id = 1 cnt = 7 pid = 0 pos = 1 obj = 0 op ='FILTER'STAT＃1 id = 2 cnt = 7 pid = 1 pos = 1 obj = 18 op ='表访问索引ROWID OBJ $'STAT＃1 id = 3 cnt = 7 pid = 2 pos = 1 obj = 37 op ='INDEX RANGE SCAN I_OBJ2'STAT＃1 id = 4 cnt = 0 pid = 1 pos = 2 obj = 4 op ='TABLE访问集群标签$ J2'STAT＃1 id = 5 cnt = 6 pid = 4 pos = 1 obj = 3 op ='INDEX UNIQUE SCAN I_OBJ＃'[PROCESS ID = 12995] *** 2014-04-02 10:04 ：32.738存档已禁用</code></pre></div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-9E4264C7-76AF-451B-99ED-83FB1AAAE3E5" title="TRCSESS实用程序根据用户指定的条件合并所选跟踪文件的跟踪输出。">TRCSESS</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL95376"></a><div class="sect3"><a id="GUID-9C03013B-6587-4475-8888-16E84DAD5806" name="GUID-9C03013B-6587-4475-8888-16E84DAD5806"></a><h4 id="TGSQL-GUID-9C03013B-6587-4475-8888-16E84DAD5806" class="sect4"><span class="enumeration_section">22.6.2</span> TKPROF</h4>
                  <div>
                     <p>TKPROF程序格式化跟踪文件的内容并将输出放入可读的输出文件中。</p>
                     <p>TKPROF还可以执行以下操作：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>创建一个将统计信息存储在数据库中的SQL脚本</p>
                        </li>
                        <li>
                           <p>确定SQL语句的执行计划</p>
                           <div class="infoboxnote" id="GUID-9C03013B-6587-4475-8888-16E84DAD5806__GUID-E20C3C5C-055C-4DA0-9EC9-9AE087914876">
                              <p class="notep1">注意：</p>
                              <p>如果未关闭SQL语句的游标，则TKPROF输出不会自动包含SQL语句的实际执行计划。在这种情况下，使用<code class="codeph">EXPLAIN</code>选项和TKPROF生成执行计划。
                              </p>
                           </div>
                        </li>
                     </ul>
                     <p>TKPROF报告使用其消耗的资源执行的每个语句，调用它的次数以及它处理的行数。</p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-E494C346-8892-4713-B1A1-8CBFF3E734B1">目的</a><br>TKPROF可以找到消耗最多资源的语句。
                        </li>
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-5049625B-72C1-435F-A6F7-6B19A78E878E">方针</a><br>输入和输出文件是唯一必需的参数。
                        </li>
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-32F3AB58-B20C-4363-A47E-F1EF909D02FF">句法</a><br></li>
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-024D1DE6-6405-4F3D-B403-40DE010F2252">选项</a><br>TKPROF支持许多命令行选项。
                        </li>
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-2ACECBE8-C812-432C-AFC4-0FD0E04490CE">产量</a><br>本节介绍TKPROF输出。
                        </li>
                        <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-71A1BF7C-8353-4B8B-94E6-FB7A62C121B6">例子</a><br>本节演示常见的TKPROF用例。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-66C145A4-A8C9-4688-A00C-22B71C19DFF6" title="Oracle跟踪实用程序是TKPROF和TRCSESS。">应用程序跟踪实用程序</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL95377"></a><div class="sect4"><a id="GUID-E494C346-8892-4713-B1A1-8CBFF3E734B1" name="GUID-E494C346-8892-4713-B1A1-8CBFF3E734B1"></a><h5 id="TGSQL-GUID-E494C346-8892-4713-B1A1-8CBFF3E734B1" class="sect5"><span class="enumeration_section">22.6.2.1</span>目的</h5>
                     <div>
                        <p>TKPROF可以找到消耗最多资源的语句。</p>
                        <p>在可用基线的情况下，您可以根据所执行的工作评估所使用的资源是否合理。</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-9C03013B-6587-4475-8888-16E84DAD5806" title="TKPROF程序格式化跟踪文件的内容并将输出放入可读的输出文件中。">TKPROF</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95378"></a><div class="sect4"><a id="GUID-5049625B-72C1-435F-A6F7-6B19A78E878E" name="GUID-5049625B-72C1-435F-A6F7-6B19A78E878E"></a><h5 id="TGSQL-GUID-5049625B-72C1-435F-A6F7-6B19A78E878E" class="sect5"><span class="enumeration_section">22.6.2.2</span>指南</h5>
                     <div>
                        <p>输入和输出文件是唯一必需的参数。</p>
                        <p>如果您在没有参数的情况下调用TKPROF，则该工具会显示在线帮助。</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-9C03013B-6587-4475-8888-16E84DAD5806" title="TKPROF程序格式化跟踪文件的内容并将输出放入可读的输出文件中。">TKPROF</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95379"></a><div class="sect4"><a id="GUID-32F3AB58-B20C-4363-A47E-F1EF909D02FF" name="GUID-32F3AB58-B20C-4363-A47E-F1EF909D02FF"></a><h5 id="TGSQL-GUID-32F3AB58-B20C-4363-A47E-F1EF909D02FF" class="sect5"><span class="enumeration_section">22.6.2.3</span>语法</h5>
                     <div>
                        <p></p><pre class="pre codeblock"><code>tkprof <span class="italic">input_file</span> <span class="italic">output_file</span> [waits = yes | no] [sort = <span class="italic">option</span> ] [print = <span class="italic">n</span> ] [aggregate = yes | no] [insert = <span class="italic">filename3</span> ] [sys = yes | no] [table = <span class="italic">schema.table</span> ] [explain = <span class="italic">user / password</span> ] [record = <span class="italic">filename4</span> ] [width = <span class="italic">n</span> ]</code></pre></div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-9C03013B-6587-4475-8888-16E84DAD5806" title="TKPROF程序格式化跟踪文件的内容并将输出放入可读的输出文件中。">TKPROF</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95381"></a><a id="TGSQL95380"></a><div class="sect4"><a id="GUID-024D1DE6-6405-4F3D-B403-40DE010F2252" name="GUID-024D1DE6-6405-4F3D-B403-40DE010F2252"></a><h5 id="TGSQL-GUID-024D1DE6-6405-4F3D-B403-40DE010F2252" class="sect5"><span class="enumeration_section">22.6.2.4</span>选项</h5>
                     <div>
                        <p>TKPROF支持许多命令行选项。</p>
                        <div class="tblformal" id="GUID-024D1DE6-6405-4F3D-B403-40DE010F2252__GUID-4E02AD6F-679E-41BD-B6BF-69A707F5B5FF">
                           <p class="titleintable">表22-3 TKPROF参数</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="TKPROF论据" width="100%" border="1" summary="This table describes the arguments that are used with TKPROF." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" id="d109757e7165">争论</th>
                                    <th align="left" valign="bottom" id="d109757e7168">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d109757e7173" headers="d109757e7165 ">
                                       <p><span class="italic"><code class="codeph">输入文件</code></span></p>
                                    </td>
                                    <td align="left" valign="top" headers="d109757e7173 d109757e7168 ">
                                       <p>指定输入文件，该跟踪文件包含SQL跟踪工具生成的统计信息。此文件可以是为单个会话生成的跟踪文件，也可以是通过连接来自多个会话的各个跟踪文件生成的文件。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d109757e7182" headers="d109757e7165 ">
                                       <p><span class="italic"><code class="codeph">输出文件</code></span></p>
                                    </td>
                                    <td align="left" valign="top" headers="d109757e7182 d109757e7168 ">
                                       <p>指定<code class="codeph">TKPROF</code>将其格式化输出写入的文件。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d109757e7194" headers="d109757e7165 ">
                                       <p><code class="codeph">WAITS</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d109757e7194 d109757e7168 ">
                                       <p>指定是否记录跟踪文件中找到的任何等待事件的摘要。有效值为<code class="codeph">YES</code> （默认值）和<code class="codeph">NO</code> 。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d109757e7208" headers="d109757e7165 ">
                                       <p><code class="codeph">分类</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d109757e7208 d109757e7168 ">
                                       <p>在将它们列在输出文件中之前，按照指定排序选项的降序对SQL语句进行排序跟踪。如果指定了多个选项，则输出将按降序选项中指定的值之和的降序排序。如果省略此参数，则<code class="codeph">TKPROF</code>按首次使用的顺序将语句列入输出文件。排序选项如下所示：</p>
                                       <ul style="list-style-type:disc">
                                          <li>
                                             <p><code class="codeph">PRSCNT</code> - 解析的次数</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">PRSCPU</code> - 解析所花费的CPU时间</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">PRSELA</code> - 解析所花费的时间</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">PRSDSK</code> - 解析期间从磁盘读取的物理数</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">PRSQRY</code> - 解析期间一致模式块读取的数量</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">PRSCU</code> - 解析期间当前模式块读取的数量</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">PRSMIS</code> - 解析期间库缓存未命中的数量</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EXECNT</code> - 执行次数</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EXECPU</code> - 执行的CPU时间</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EXEELA</code> - 执行所花费的时间</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EXEDSK</code> - 执行期间从磁盘读取的物理数</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EXEQRY</code> - 执行期间一致模式块读取的数量</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EXECU</code> - 执行期间当前模式块读取的数量</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EXEROW</code> - 执行期间处理的行数</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EXEMIS</code> - 执行期间库缓存未命中的数量</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">FCHCNT</code> - 提取次数</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">FCHCPU</code> - 获取的CPU时间</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">FCHELA</code> - 花费的时间</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">FCHDSK</code> - 获取期间从磁盘读取的物理数</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">FCHQRY</code> - 获取期间一致模式块读取的数量</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">FCHCU</code> - 获取期间当前模式块读取的数量</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">FCHROW</code> - 获取的行数</p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">USERID</code> - 解析光标的用户的ID</p>
                                          </li>
                                       </ul>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d109757e7337" headers="d109757e7165 ">
                                       <p><code class="codeph">打印</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d109757e7337 d109757e7168 ">
                                       <p>仅列出输出文件中第一个整数排序的SQL语句。如果省略此参数，则<code class="codeph">TKPROF</code>列出所有跟踪的SQL语句。此参数不影响可选的SQL脚本。SQL脚本始终为所有跟踪的SQL语句生成插入数据。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d109757e7348" headers="d109757e7165 ">
                                       <p><code class="codeph">骨料</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d109757e7348 d109757e7168 ">
                                       <p>如果指定<code class="codeph">AGGREGATE</code> = <code class="codeph">NO</code> ，则<code class="codeph">TKPROF</code>不会聚合同一SQL文本的多个用户。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d109757e7365" headers="d109757e7165 ">
                                       <p><code class="codeph">插入</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d109757e7365 d109757e7168 ">
                                       <p>创建一个SQL脚本，用于在数据库中存储跟踪文件统计信息。<code class="codeph">TKPROF</code>使用名称<span class="italic"><code class="codeph">filename3</code></span>创建此脚本。此脚本创建一个表，并将每个跟踪的SQL语句的一行统计信息插入到表中。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d109757e7380" headers="d109757e7165 ">
                                       <p><code class="codeph">SYS</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d109757e7380 d109757e7168 ">
                                       <p>启用和禁用用户<code class="codeph">SYS</code>或递归SQL语句发出的SQL语句列表到输出文件中。默认值<code class="codeph">YES</code>会导致<code class="codeph">TKPROF</code>列出这些语句。<code class="codeph">NO</code>的值导致<code class="codeph">TKPROF</code>省略它们。此参数不影响可选的SQL脚本。SQL脚本始终为所有跟踪的SQL语句插入统计信息，包括递归SQL语句。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d109757e7403" headers="d109757e7165 ">
                                       <p><code class="codeph">表</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d109757e7403 d109757e7168 ">
                                       <p>指定<code class="codeph">TKPROF</code>将执行计划写入输出文件之前临时放置的表的模式和名称。如果指定的表存在，则<code class="codeph">TKPROF</code>删除表中的所有行，将其用于<code class="codeph">EXPLAIN PLAN</code>语句（将更多行写入表中），然后删除这些行。如果此表不存在，则<code class="codeph">TKPROF</code>创建它，使用它，然后删除它。
                                       </p>
                                       <p>指定的用户必须能够对表发出<code class="codeph">INSERT</code> ， <code class="codeph">SELECT</code>和<code class="codeph">DELETE</code>语句。如果表不存在，那么用户还必须能够发出<code class="codeph">CREATE TABLE</code>和<code class="codeph">DROP TABLE</code>语句。
                                       </p>
                                       <p>此选项允许多个用户与<code class="codeph">EXPLAIN</code>值中的同一数据库用户帐户同时运行<code class="codeph">TKPROF</code> 。这些用户可以指定不同的<code class="codeph">TABLE</code>值，并在处理临时计划表时避免破坏性地相互干扰。
                                       </p>
                                       <p><code class="codeph">TKPROF</code>支持以下组合：</p>
                                       <ul style="list-style-type:disc">
                                          <li>
                                             <p>没有<code class="codeph">TABLE</code>参数的<code class="codeph">EXPLAIN</code>参数</p>
                                             <p><code class="codeph">TKPROF</code>在<code class="codeph">EXPLAIN</code>参数指定的用户的模式中使用表<code class="codeph">PROF$PLAN_TABLE</code></p>
                                          </li>
                                          <li>
                                             <p>没有<code class="codeph">EXPLAIN</code>参数的<code class="codeph">TABLE</code>参数</p>
                                             <p><code class="codeph">TKPROF</code>忽略<code class="codeph">TABLE</code>参数。
                                             </p>
                                          </li>
                                       </ul>
                                       <p>如果不存在计划表，则<code class="codeph">TKPROF</code>创建表<code class="codeph">PROF$PLAN_TABLE</code> ，然后在最后将其删除。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d109757e7499" headers="d109757e7165 ">
                                       <p><code class="codeph">说明</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d109757e7499 d109757e7168 ">
                                       <p>确定跟踪文件中每个SQL语句的执行计划，并将这些执行计划写入输出文件。<code class="codeph">TKPROF</code>还显示执行计划的每个步骤处理的行数。
                                       </p>
                                       <p><code class="codeph">TKPROF</code>通过使用此参数中指定的用户和密码连接到Oracle数据库后发出<code class="codeph">EXPLAIN</code> <code class="codeph">PLAN</code>语句来确定执行计划。指定的用户必须具有<code class="codeph">CREATE SESSION</code>系统特权。如果使用<code class="codeph">EXPLAIN</code>选项， <code class="codeph">TKPROF</code>需要更长的时间来处理大型跟踪文件。
                                       </p>
                                       <p><span class="bold">注意：</span>实例启动后立即生成的跟踪文件包含反映启动过程活动的数据。特别是，当系统全局区域（SGA）中的高速缓存被填充时，它们反映了不成比例的I / O活动量。出于调优的目的，请忽略此类跟踪文件。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d109757e7533" headers="d109757e7165 ">
                                       <p><code class="codeph">记录</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d109757e7533 d109757e7168 ">
                                       <p>使用指定的<span class="italic"><code class="codeph">filename</code></span>创建一个SQL脚本，其中包含跟踪文件中的所有非递归SQL。您可以使用此脚本从跟踪文件重播用户事件。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d109757e7546" headers="d109757e7165 ">
                                       <p><code class="codeph">宽度</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d109757e7546 d109757e7168 ">
                                       <p>一个整数，用于控制某些<code class="codeph">TKPROF</code>输出的输出线宽，例如解释计划。此参数对<code class="codeph">TKPROF</code>输出的后处理很有用。
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-9C03013B-6587-4475-8888-16E84DAD5806" title="TKPROF程序格式化跟踪文件的内容并将输出放入可读的输出文件中。">TKPROF</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95382"></a><div class="sect4"><a id="GUID-2ACECBE8-C812-432C-AFC4-0FD0E04490CE" name="GUID-2ACECBE8-C812-432C-AFC4-0FD0E04490CE"></a><h5 id="TGSQL-GUID-2ACECBE8-C812-432C-AFC4-0FD0E04490CE" class="sect5"><span class="enumeration_section">22.6.2.5</span>输出</h5>
                     <div>
                        <p>本节介绍TKPROF输出。</p>
                        <p>本节包含以下主题：</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-F7AF11DB-252F-47EB-88C2-E660E8EB8E40">用户在TKPROF中发布SQL语句的标识</a><br><code class="codeph">TKPROF</code>列出发出每个SQL语句的用户的用户标识。
                           </li>
                           <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-B6EE4109-5946-415D-9B75-EC1B73D16B87">TKPROF的表格统计</a><br>TKPROF列出了SQL跟踪工具在行和列中返回的SQL语句的统计信息。
                           </li>
                           <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-CB9869D2-B175-47A9-AC01-FA18FA780120">TKPROF中的库缓存未命中</a><br>TKPROF还列出了每个SQL语句的解析和执行步骤导致的库高速缓存未命中数。
                           </li>
                           <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-77906451-193D-4D73-BA49-95A64445C673">TKPROF中的行源操作</a><br>在TKPROF输出中，行源操作显示为在行上执行的每个操作处理的行数，以及其他行源信息，例如物理读取和写入。
                           </li>
                           <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-D6CF31D4-33A6-4F85-A79E-3CE3B5779682">等待TKPROF中的事件信息</a><br>如果存在等待事件信息，则<code class="codeph">TKPROF</code>输出包括关于等待事件的部分。
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-9C03013B-6587-4475-8888-16E84DAD5806" title="TKPROF程序格式化跟踪文件的内容并将输出放入可读的输出文件中。">TKPROF</a></p>
                           </div>
                        </div>
                     </div>
                     <a id="TGSQL831"></a><div class="sect5"><a id="GUID-F7AF11DB-252F-47EB-88C2-E660E8EB8E40" name="GUID-F7AF11DB-252F-47EB-88C2-E660E8EB8E40"></a><h6 id="TGSQL-GUID-F7AF11DB-252F-47EB-88C2-E660E8EB8E40" class="sect6"><span class="enumeration_section">22.6.2.5.1</span>用户在TKPROF中发布SQL语句的标识</h6>
                        <div>
                           <p><code class="codeph">TKPROF</code>列出发出每个SQL语句的用户的用户标识。
                           </p>
                           <p>如果SQL Trace输入文件包含来自多个用户的统计信息，并且该语句是由多个用户发出的，则<code class="codeph">TKPROF</code>列出要解析该语句的最后一个用户的ID。所有数据库用户的用户标识都显示在<code class="codeph">ALL_USERS</code>列的数据字典中。 <code class="codeph">USER_ID</code> 。</p>
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-2ACECBE8-C812-432C-AFC4-0FD0E04490CE" title="本节介绍TKPROF输出。">输出</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL822"></a><a id="TGSQL823"></a><a id="TGSQL821"></a><div class="sect5"><a id="GUID-B6EE4109-5946-415D-9B75-EC1B73D16B87" name="GUID-B6EE4109-5946-415D-9B75-EC1B73D16B87"></a><h6 id="TGSQL-GUID-B6EE4109-5946-415D-9B75-EC1B73D16B87" class="sect6"><span class="enumeration_section">22.6.2.5.2</span> TKPROF中的表格统计</h6>
                        <div>
                           <p>TKPROF列出了SQL跟踪工具在行和列中返回的SQL语句的统计信息。</p>
                           <p>每行对应于SQL语句处理的三个步骤之一。统计信息由<code class="codeph">CALL</code>列的值标识。<a href="performing-application-tracing.html#GUID-B6EE4109-5946-415D-9B75-EC1B73D16B87__CHDHIIHC" title="此表说明了CALL列值的含义。">见表22-4</a> 。
                           </p>
                           <div class="tblformal" id="GUID-B6EE4109-5946-415D-9B75-EC1B73D16B87__CHDHIIHC">
                              <p class="titleintable">表22-4 CALL列值</p>
                              <table cellpadding="4" cellspacing="0" class="Formal" title="CALL列值" width="100%" border="1" summary="This table explains the meaning of the CALL column values." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="25%" id="d109757e7994">CALL价值</th>
                                       <th align="left" valign="bottom" width="75%" id="d109757e7997">含义</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d109757e8002" headers="d109757e7994 ">
                                          <p><code class="codeph">PARSE</code> 
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="75%" headers="d109757e8002 d109757e7997 ">
                                          <p>将SQL语句转换为执行计划，包括检查适当的安全授权并检查表，列和其他引用对象是否存在。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d109757e8011" headers="d109757e7994 ">
                                          <p><code class="codeph">执行</code> 
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="75%" headers="d109757e8011 d109757e7997 ">
                                          <p>Oracle数据库实际执行语句。对于<code class="codeph">INSERT</code> ， <code class="codeph">UPDATE</code> ， <code class="codeph">DELETE</code>和<code class="codeph">MERGE</code>语句，这会修改数据。对于<code class="codeph">SELECT</code>语句，它标识所选行。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d109757e8035" headers="d109757e7994 ">
                                          <p><code class="codeph">取</code> 
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="75%" headers="d109757e8035 d109757e7997 ">
                                          <p>检索查询返回的行。仅对<code class="codeph">SELECT</code>语句执行提取。
                                          </p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p>SQL跟踪工具输出的其他列是语句的所有分析，执行和提取的组合统计信息。<code class="codeph">query</code>和<code class="codeph">current</code>的总和是访问的缓冲区总数，也称为逻辑I / O（LIO）。<a href="performing-application-tracing.html#GUID-B6EE4109-5946-415D-9B75-EC1B73D16B87__CHDDADGG" title="此表说明了分析，执行和提取的跟踪统计信息的含义。">见表22-5</a> 。
                           </p>
                           <div class="tblformal" id="GUID-B6EE4109-5946-415D-9B75-EC1B73D16B87__CHDDADGG">
                              <p class="titleintable">表22-5 Parses，Executes和Fetches的SQL跟踪统计信息。</p>
                              <table cellpadding="4" cellspacing="0" class="Formal" title="Parses，Executes和Fetches的SQL跟踪统计信息。" width="100%" border="1" summary="This table explains the meaning of the trace statistics for parses, executes, and fetches." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="25%" id="d109757e8069">SQL跟踪统计信息</th>
                                       <th align="left" valign="bottom" width="75%" id="d109757e8072">含义</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d109757e8077" headers="d109757e8069 ">
                                          <p><code class="codeph">计数</code></p>
                                       </td>
                                       <td align="left" valign="top" width="75%" headers="d109757e8077 d109757e8072 ">
                                          <p>解析，执行或提取语句的次数。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d109757e8085" headers="d109757e8069 ">
                                          <p><code class="codeph">中央处理器</code></p>
                                       </td>
                                       <td align="left" valign="top" width="75%" headers="d109757e8085 d109757e8072 ">
                                          <p>语句的所有分析，执行或提取调用的总CPU时间（以秒为单位）。如果未启用<code class="codeph">TIMED_STATISTICS</code>则此值为零（0）。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d109757e8096" headers="d109757e8069 ">
                                          <p><code class="codeph">过去</code></p>
                                       </td>
                                       <td align="left" valign="top" width="75%" headers="d109757e8096 d109757e8072 ">
                                          <p>语句的所有分析，执行或提取调用的总耗用时间（以秒为单位）。如果未启用<code class="codeph">TIMED_STATISTICS</code>则此值为零（0）。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d109757e8107" headers="d109757e8069 ">
                                          <p><code class="codeph">DISK</code></p>
                                       </td>
                                       <td align="left" valign="top" width="75%" headers="d109757e8107 d109757e8072 ">
                                          <p>对于所有解析，执行或提取调用，从磁盘上的数据文件中物理读取的数据块总数。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d109757e8115" headers="d109757e8069 ">
                                          <p><code class="codeph">QUERY</code></p>
                                       </td>
                                       <td align="left" valign="top" width="75%" headers="d109757e8115 d109757e8072 ">
                                          <p>对于所有解析，执行或提取调用，以一致模式检索的缓冲区总数。通常，以一致模式检索缓冲区以进行查询。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d109757e8123" headers="d109757e8069 ">
                                          <p><code class="codeph">当前</code></p>
                                       </td>
                                       <td align="left" valign="top" width="75%" headers="d109757e8123 d109757e8072 ">
                                          <p>在当前模式下检索的缓冲区总数。在当前模式下检索缓冲区，例如<code class="codeph">INSERT</code> ， <code class="codeph">UPDATE</code>和<code class="codeph">DELETE</code> 。</p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p>有关已处理行的统计信息显示在<code class="codeph">ROWS</code>列中。该列显示SQL语句处理的行数。此总计不包括由SQL语句的子查询处理的行。对于<code class="codeph">SELECT</code>语句，将为fetch步骤显示返回的行数。对于<code class="codeph">UPDATE</code> ， <code class="codeph">DELETE</code>和<code class="codeph">INSERT</code>语句，将为执行步骤显示已处理的行数。
                           </p>
                           <div class="infoboxnote" id="GUID-B6EE4109-5946-415D-9B75-EC1B73D16B87__GUID-1E1D26C6-AD3E-429A-B5CB-BA610A1AEC7B">
                              <p class="notep1">注意：</p>
                              <p>关闭光标时显示行源计数。在SQL * Plus中，只有一个用户游标，因此每个执行的语句都会导致前一个游标被关闭;因此，显示行源计数。PL / SQL有自己的游标处理，并且在父游标关闭时不关闭子游标。退出或重新连接会导致显示计数。</p>
                           </div>
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-2ACECBE8-C812-432C-AFC4-0FD0E04490CE" title="本节介绍TKPROF输出。">输出</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL829"></a><div class="sect5"><a id="GUID-CB9869D2-B175-47A9-AC01-FA18FA780120" name="GUID-CB9869D2-B175-47A9-AC01-FA18FA780120"></a><h6 id="TGSQL-GUID-CB9869D2-B175-47A9-AC01-FA18FA780120" class="sect6"><span class="enumeration_section">22.6.2.5.3</span> TKPROF中的库缓存未命中</h6>
                        <div>
                           <p>TKPROF还列出了每个SQL语句的解析和执行步骤导致的库高速缓存未命中数。</p>
                           <p>这些统计信息显示在表格统计信息后面的单独行中。如果该语句导致没有库缓存未命中，则<code class="codeph">TKPROF</code>不会列出统计信息。在<span class="q">“ <a href="performing-application-tracing.html#GUID-71A1BF7C-8353-4B8B-94E6-FB7A62C121B6" title="本节演示常见的TKPROF用例。">示例</a> ”中</span> ，该语句导致解析步骤中的一个库高速缓存未命中，并且执行步骤没有未命中。
                           </p>
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-2ACECBE8-C812-432C-AFC4-0FD0E04490CE" title="本节介绍TKPROF输出。">输出</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL95383"></a><a id="TGSQL825"></a><div class="sect5"><a id="GUID-77906451-193D-4D73-BA49-95A64445C673" name="GUID-77906451-193D-4D73-BA49-95A64445C673"></a><h6 id="TGSQL-GUID-77906451-193D-4D73-BA49-95A64445C673" class="sect6"><span class="enumeration_section">22.6.2.5.4</span> TKPROF中的行源操作</h6>
                        <div>
                           <p>在TKPROF输出中，行源操作显示为在行上执行的每个操作处理的行数，以及其他行源信息，例如物理读取和写入。</p>
                           <div class="tblformal" id="GUID-77906451-193D-4D73-BA49-95A64445C673__GUID-2A98F5F3-C9AB-4FA8-8F53-1E3DC5551F99">
                              <p class="titleintable">表22-6行源操作</p>
                              <table cellpadding="4" cellspacing="0" class="Formal" title="行源操作" width="100%" border="1" summary="This table explains the meaning of the CALL column values." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="25%" id="d109757e8410">行源操作</th>
                                       <th align="left" valign="bottom" width="75%" id="d109757e8413">含义</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d109757e8418" headers="d109757e8410 ">
                                          <p><code class="codeph">CR</code> 
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="75%" headers="d109757e8418 d109757e8413 ">
                                          <p>行源执行的一致读取。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d109757e8427" headers="d109757e8410 ">
                                          <p><code class="codeph">[R</code> 
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="75%" headers="d109757e8427 d109757e8413 ">
                                          <p>由行源执行的物理读取</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d109757e8436" headers="d109757e8410 ">
                                          <p><code class="codeph">w ^</code> 
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="75%" headers="d109757e8436 d109757e8413 ">
                                          <p>由行源执行的物理写入</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d109757e8445" headers="d109757e8410 ">
                                          <p><code class="codeph">时间</code> 
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="75%" headers="d109757e8445 d109757e8413 ">
                                          <p>时间以微秒为单位</p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p>在以下示例<code class="codeph">TKPROF</code>输出中，请注意“行源操作”列下的<code class="codeph">cr</code> ， <code class="codeph">r</code> ， <code class="codeph">w</code>和<code class="codeph">time</code>值：</p><pre class="pre codeblock"><code>行行源操作------- --------------------------------------- ------------ 0 DELETE（cr = 43141 r = 266947 w = 25854 time = 60235565 us）28144 HASH JOIN ANTI（cr = 43057 r = 262332 w = 25854 time = 48830056 us）51427表访问完整的状态$ SQLTEXT（cr = 3465 r = 3463 w = 0 time = 865083 us）647529 INDEX FAST FULL SCAN STATS $ SQL_SUMMARY_PK（cr = 39592 r = 39325 w = 0 time = 10522877 us）（object id 7409）</code></pre></div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-2ACECBE8-C812-432C-AFC4-0FD0E04490CE" title="本节介绍TKPROF输出。">输出</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL95384"></a><div class="sect5"><a id="GUID-D6CF31D4-33A6-4F85-A79E-3CE3B5779682" name="GUID-D6CF31D4-33A6-4F85-A79E-3CE3B5779682"></a><h6 id="TGSQL-GUID-D6CF31D4-33A6-4F85-A79E-3CE3B5779682" class="sect6"><span class="enumeration_section">22.6.2.5.5</span> TKPROF中的等待事件信息</h6>
                        <div>
                           <p>如果存在等待事件信息，则<code class="codeph">TKPROF</code>输出包括关于等待事件的部分。
                           </p>
                           <p>输出类似于以下内容：</p><pre class="pre codeblock"><code>经过的时间包括等待以下事件：事件在Times Max上等待。等待总等待----------------------------------------等待------ ---- ------------ db file sequential read 8084 0.12 5.34 direct path write 834 0.00 0.00 direct path write temp 834 0.00 0.05 db file parallel read 8 1.53 5.51 db file scattered 4180 0.07 1.45直接路径读取7082 0.00 0.05直接路径读取温度7082 0.00 0.44 rdbms ipc reply 20 0.00 0.01 SQL *到客户端1的网络消息0.00 0.00 SQL *来自客户端1的净消息0.00 0.00</code></pre><p>此外，等待事件将在文件末尾对整个跟踪文件求和。</p>
                           <p>要确保将等待事件信息写入会话的跟踪文件，请运行以下SQL语句：</p><pre class="pre codeblock"><code>ALTER SESSION SET EVENTS'10046追踪名称背景永远，等级8';</code></pre></div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-2ACECBE8-C812-432C-AFC4-0FD0E04490CE" title="本节介绍TKPROF输出。">输出</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div><a id="TGSQL95385"></a><a id="TGSQL95386"></a><a id="TGSQL95387"></a><a id="TGSQL95388"></a><a id="TGSQL95389"></a><a id="TGSQL844"></a><div class="sect4"><a id="GUID-71A1BF7C-8353-4B8B-94E6-FB7A62C121B6" name="GUID-71A1BF7C-8353-4B8B-94E6-FB7A62C121B6"></a><h5 id="TGSQL-GUID-71A1BF7C-8353-4B8B-94E6-FB7A62C121B6" class="sect5"><span class="enumeration_section">22.6.2.6</span>例子</h5>
                     <div>
                        <p>本节演示常见的TKPROF用例。</p>
                        <div class="example" id="GUID-71A1BF7C-8353-4B8B-94E6-FB7A62C121B6__CHDEICAF">
                           <p class="titleinexample">例22-4打印资源最密集的语句</p>
                           <p>如果使用<code class="codeph">SORT</code>参数和<code class="codeph">PRINT</code>参数的组合处理大型跟踪文件，则可以生成仅包含最高资源密集型语句的<code class="codeph">TKPROF</code>输出文件。以下语句打印跟踪文件中生成最多物理I / O的10个语句：</p><pre class="pre codeblock"><code>TKPROF ora53269.trc ora53269.prf SORT =（PRSDSK，EXEDSK，FCHDSK）PRINT = 10</code></pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-71A1BF7C-8353-4B8B-94E6-FB7A62C121B6__GUID-35208F0A-B7D9-43BC-B219-FE5C36B65D61">
                           <p class="titleinexample">示例22-5生成SQL脚本</p>
                           <p>本示例运行<code class="codeph">TKPROF</code> ，接受一个名为跟踪文件<code class="codeph">examp12_jane_fg_sqlplus_007.trc</code> ，并写入名为格式化输出文件<code class="codeph">outputa.prf</code> ：</p><pre class="pre codeblock"><code>TKPROF examp12_jane_fg_sqlplus_007.trc OUTPUTA.PRF EXPLAIN = hr TABLE = hr.temp_plan_table_a INSERT = STOREA.SQL SYS = NO SORT =（EXECPU，FCHCPU）</code></pre><p>此示例可能比屏幕上的单行长，并且您可能需要使用延续字符，具体取决于操作系统。</p>
                           <p>请注意此示例中的其他参数：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">EXPLAIN</code>值使<code class="codeph">TKPROF</code>以用户<code class="codeph">hr</code>身份连接，并使用<code class="codeph">EXPLAIN PLAN</code>语句为每个跟踪的SQL语句生成执行计划。您可以使用它来获取访问路径和行源计数。
                                 </p>
                                 <div class="infoboxnote" id="GUID-71A1BF7C-8353-4B8B-94E6-FB7A62C121B6__GUID-1D68DF65-AD1D-4678-9ED6-0D4D33677A3B">
                                    <p class="notep1">注意：</p>
                                    <p>如果未关闭SQL语句的游标，则<code class="codeph">TKPROF</code>输出不会自动包含SQL语句的实际执行计划。在这种情况下，您可以使用<code class="codeph">EXPLAIN</code>选项和<code class="codeph">TKPROF</code>生成执行计划。
                                    </p>
                                 </div>
                              </li>
                              <li>
                                 <p><code class="codeph">TABLE</code>值使<code class="codeph">TKPROF</code>使用模式<code class="codeph">scott</code>的表<code class="codeph">temp_plan_table_a</code>作为临时计划表。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">INSERT</code>值使<code class="codeph">TKPROF</code>生成名为<code class="codeph">STOREA</code>的SQL脚本。 <code class="codeph">SQL</code> ，用于存储数据库中所有跟踪的SQL语句的统计信息。
                                 </p>
                              </li>
                              <li>
                                 <p>值为<code class="codeph">NO</code>的<code class="codeph">SYS</code>参数会导致<code class="codeph">TKPROF</code>从输出文件中省略递归SQL语句。通过这种方式，您可以忽略内部Oracle数据库语句，例如临时表操作。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">SORT</code>值使<code class="codeph">TKPROF</code>按照执行所花费的CPU时间和在将行写入输出文件之前获取行所花费的CPU时间之和的顺序对SQL语句进行排序。为获得最高效率，请始终使用<code class="codeph">SORT</code>参数。
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-71A1BF7C-8353-4B8B-94E6-FB7A62C121B6__GUID-DCE10479-EF11-4B22-B787-7CF0BDFA598B">
                           <p class="titleinexample">例22-6 TKPROF标题</p>
                           <p>此示例显示TKPROF报告的示例标头。</p><pre class="pre codeblock"><code>TKPROF：版本12.1.0.0.2版权所有（c）1982,2012，Oracle和/或其附属公司。版权所有。跟踪文件：/disk1/oracle/log/diag/rdbms/orcla/orcla/trace/orcla_ora_917.trc排序选项：默认*********************** ************************************************** ******* count =执行OCI过程的次数cpu =执行过去的cpu时间（以秒为单位）=执行磁盘的经过时间（以秒为单位）=磁盘查询中缓冲区的物理读取次数=获得一致读取电流的缓冲区数=当前模式下获得的缓冲区数（通常用于更新）rows =获取或执行调用处理的行数************************* ************************************************** *****</code></pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-71A1BF7C-8353-4B8B-94E6-FB7A62C121B6__CHDDBHAD">
                           <p class="titleinexample">例22-7 TKPROF体</p>
                           <p>此示例显示TKPROF报告的样本正文。</p><pre class="pre codeblock"><code>call count cpu elapsed disk query current rows ------- ------ -------- ---------- ----------- ---------- ---------- ---------- Parse 1 0.01 0.00 0 0 0 0执行1 0.00 0.00 0 0 0 0取0 0.00 0.00 0 0 0 0 ------- ------ -------- ---------- ---------- ------ ---- ---------- ---------- total 2 0.01 0.00 0 0 0 0解析期间库缓存未命中：1优化器模式：FIRST_ROWS解析用户ID：44 Elapsed时间包括等待以下事件：事件在Times Max上等待。等待总等待----------------------------------------等待------ ---- ------------ SQL * Net message to client 1 0.00 0.00 SQL *来自客户端1的网络消息28.59 28.59 **************** ************************************************** **************从cdef $中选择条件where rowid =：1 call count cpu elapsed disk query current rows ------- ------ ----- --- ---------- ---------- ---------- ---------- ------- --- Parse 1 0.00 0.00 0 0 0 0执行1 0.00 0.00 0 0 0 0 Fetch 1 0.00 0.00 0 2 0 1 ------- ------ --------  - -------- ---------- ---------- ---------- ----------总计3 0.00 0.00 0 2 0 1解析期间库高速缓存中未命中：1优化器模式：CHOOSE解析用户ID：SYS（递归深度：1）行行源操作------- ---------- ----------------------------------------- 1 USER ROWID OBJ的表访问＃（ 31）（cr = 1 r = 0 w = 0时间= 151 us）********************************* *********************************************** SELECT last_name， job_id，薪水来自员工WHERE sala ry =（SELECT max（salary）FROM employees）调用count cpu经过磁盘查询当前行------- ------ -------- ---------- ---------- ---------- ---------- ---------- Parse 1 0.02 0.01 0 0 0 0执行1 0.00 0.00 0 0 0 0 Fetch 2 0.00 0.00 0 15 0 1 ------- ------ -------- ---------- ----- ----- ---------- ---------- ---------- total 4 0.02 0.01 0 15 0 1解析期间库缓存中未命中： 1优化器模式：FIRST_ROWS解析用户ID：44行行源操作------- ----------------------------- ---------------------- 1表访问全员工（cr = 15 r = 0 w = 0 time = 1743 us）1 SORT AGGREGATE（cr = 7 r = 0 w = 0时间= 777 us）107表访问全员工（cr = 7 r = 0 w = 0时间= 655 us）经过的时间包括等待以下事件：事件在Times Max上等待。等待总等待----------------------------------------等待------ ---- ------------ SQL * Net message to client 2 0.00 0.00 SQL *来自客户端2的网络消息9.62 9.62 **************** ************************************************** ************** ************************************ ********************************************从stats $ sqltext st删除where（hash_value，text_subset）不在（select  -  + hash_aj hash_value，text_subset from stats $ sql_summary ss where（（snap_id &lt;：lo_snap或snap_id&gt;：hi_snap）和dbid =：dbid和instance_number =：inst_num）或（dbid！=：dbid或instance_number！=：inst_num））调用count cpu经过磁盘查询当前行------- ------ -------- ---------- ------ ---- ---------- ---------- ---------- Parse 1 0.00 0.00 0 0 0 0执行1 29.60 60.68 266984 43776 131172 28144取0 0.00 0.00 0 0 0 0 ------- ------ -------- ---------- ----------  - ---------- ---------- ---------- total 2 29.60 60.68 266984 43776 131172 28144解析期间库缓存中未命中：1期间库缓存未命中执行：1优化器模式：CHOOSE解析用户ID：22行行源操作------- --------------------------- ------------------------ 0 DELETE（cr = 43141 r = 266947 w = 25854 time = 60235565 us）28144 HASH JOIN ANTI（cr = 43057 r = 262332 w = 25854 time = 48830056 us）51427表访问完整状态$ SQLTEXT（cr = 3465 r = 3463 w = 0 time = 865083 us）647529 INDEX FAST FULL SCAN STATS $ SQL_SUMMARY_PK（cr = 39592 r = 39325 w = 0 time = 10522877 us）（对象ID 7409）经过的时间包括等待以下事件：事件在Times Max上等待。等待总等待----------------------------------------等待------ ---- ------------ db file sequential read 8084 0.12 5.34 direct path write 834 0.00 0.00 direct path write temp 834 0.00 0.05 db file parallel read 8 1.53 5.51 db file scattered 4180 0.07 1.45直接路径读取7082 0.00 0.05直接路径读取温度7082 0.00 0.44 rdbms ipc reply 20 0.00 0.01 SQL *到客户端1的网络消息0.00 0.00 SQL *来自客户端1的净消息0.00 0.00 ************* ************************************************** *****************</code></pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-71A1BF7C-8353-4B8B-94E6-FB7A62C121B6__GUID-CEEF6684-8C1E-4B2B-B224-6B623029666E">
                           <p class="titleinexample">例22-8 TKPROF摘要</p>
                           <p>此示例显示TKPROF报告的摘要。</p><pre class="pre codeblock"><code>所有非递归语句的总计调用计数cpu经过磁盘查询当前行------- ------ -------- ---------- --- ------- ---------- ---------- ---------- Parse 4 0.04 0.01 0 0 0 0执行5 0.00 0.04 0 0 0 0 Fetch 2 0.00 0.00 0 15 0 1 ------- ------ -------- ---------- -------- -  ---------- ---------- ---------- total 11 0.04 0.06 0 15 0 1解析期间库缓存中未命中：4未命中执行期间的库缓存：1经过的时间包括等待以下事件：事件在Times Max上等待。等待总等待----------------------------------------等待------ ---- ------------ SQL *向客户端发送的消息6 0.00 0.00 SQL *来自客户端5的网络消息77.77 128.88所有递送报告的总计呼叫计数cpu经过磁盘查询当前行 - ----- ------ -------- ---------- ---------- ----------  - --------- ---------- Parse 1 0.00 0.00 0 0 0 0执行1 0.00 0.00 0 0 0 0取1 0.00 0.00 0 2 0 1 ------- ------ -------- ---------- ---------- ---------- ------ ---- ---------- total 3 0.00 0.00 0 2 0 1解析期间库缓存中未命中：1 5个会话中的用户SQL语句。会话中的1个内部SQL语句。6个会话中的SQL语句。************************************************** ******************************跟踪文件：main_ora_27621.trc跟踪文件兼容性：9.00.01排序选项：默认1个会话跟踪文件。跟踪文件中的5个用户SQL语句。跟踪文件中的1个内部SQL语句。6跟踪文件中的SQL语句。跟踪文件中有6个唯一的SQL语句。跟踪文件中有76行。跟踪文件中经过128秒。</code></pre></div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-9C03013B-6587-4475-8888-16E84DAD5806" title="TKPROF程序格式化跟踪文件的内容并将输出放入可读的输出文件中。">TKPROF</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div><a id="TGSQL95390"></a><div class="sect2"><a id="GUID-DED467E4-4890-47B7-84DB-FAB180E9E780" name="GUID-DED467E4-4890-47B7-84DB-FAB180E9E780"></a><h3 id="TGSQL-GUID-DED467E4-4890-47B7-84DB-FAB180E9E780" class="sect3"><span class="enumeration_section">22.7</span>应用程序跟踪视图</h3>
               <div>
                  <p>您可以使用数据字典和<code class="codeph">V$</code>视图来监视跟踪。
                  </p>
                  <p>本节包括以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-93ACB9CC-9937-479E-8995-FEABD854C900">与跟踪统计相关的视图</a><br>您可以显示使用以下<code class="codeph">V$</code>和<code class="codeph">DBA</code>视图收集的统计信息。
                     </li>
                     <li class="ulchildlink"><a href="performing-application-tracing.html#GUID-59FA7520-BAAA-478C-925D-DD43A527CF01">与启用跟踪相关的视图</a><br>Cloud Control报告或<code class="codeph">DBA_ENABLED_TRACES</code>视图可以显示出色的跟踪。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-440D3AD4-B302-408E-8627-FE8032DD09F9" title="本章介绍了端到端应用程序跟踪的内容，以及如何生成和读取跟踪文件。">执行应用程序跟踪</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL796"></a><div class="sect3"><a id="GUID-93ACB9CC-9937-479E-8995-FEABD854C900" name="GUID-93ACB9CC-9937-479E-8995-FEABD854C900"></a><h4 id="TGSQL-GUID-93ACB9CC-9937-479E-8995-FEABD854C900" class="sect4"><span class="enumeration_section">22.7.1</span>与跟踪统计相关的视图</h4>
                  <div>
                     <p>您可以显示使用以下<code class="codeph">V$</code>和<code class="codeph">DBA</code>视图收集的统计信息。
                     </p>
                     <div class="tblformalwide" id="GUID-93ACB9CC-9937-479E-8995-FEABD854C900__GUID-E40C57F1-4D54-4A7B-98A5-7C428B9EF4CD">
                        <p class="titleintable">表22-7诊断视图</p>
                        <table cellpadding="4" cellspacing="0" class="FormalWide" title="诊断视图" width="100%" border="1" summary="This 2 column table shows views that provide trace-related information. Column 1 is the view name. Column 2 describes what the view displays. " frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="20%" id="d109757e9131">视图</th>
                                 <th align="left" valign="bottom" width="20%" id="d109757e9133">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d109757e9137" headers="d109757e9131 "><code class="codeph">DBA_ENABLED_AGGREGATIONS</code></td>
                                 <td align="left" valign="top" width="20%" headers="d109757e9137 d109757e9133 ">已启用统计信息的累计全局统计信息</td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d109757e9143" headers="d109757e9131 "><code class="codeph">V $ CLIENT_STATS</code></td>
                                 <td align="left" valign="top" width="20%" headers="d109757e9143 d109757e9133 ">已累计的指定客户端标识符的统计信息</td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d109757e9149" headers="d109757e9131 "><code class="codeph">V $ SERVICE_STATS</code></td>
                                 <td align="left" valign="top" width="20%" headers="d109757e9149 d109757e9133 ">已累计的指定服务的统计信息</td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d109757e9155" headers="d109757e9131 "><code class="codeph">V $ SERV_MOD_ACT_STATS</code></td>
                                 <td align="left" valign="top" width="20%" headers="d109757e9155 d109757e9133 ">已指定服务，模块和操作组合的累计统计信息</td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d109757e9161" headers="d109757e9131 "><code class="codeph">V $ SERVICEMETRIC</code></td>
                                 <td align="left" valign="top" width="20%" headers="d109757e9161 d109757e9133 ">累计数据库调用和CPU使用时间的统计信息</td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d109757e9167" headers="d109757e9131 "><code class="codeph">V $ DIAG_TRACE_FILE</code></td>
                                 <td align="left" valign="top" width="20%" headers="d109757e9167 d109757e9133 ">有关当前容器的ADR中所有跟踪文件的信息</td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d109757e9173" headers="d109757e9131 "><code class="codeph">V $ DIAG_APP_TRACE_FILE</code></td>
                                 <td align="left" valign="top" width="20%" headers="d109757e9173 d109757e9133 ">有关当前容器的ADR中包含应用程序跟踪数据（ <code class="codeph">SQL_TRACE</code>或<code class="codeph">OPTIMIZER_TRACE</code>事件数据）的所有跟踪文件的信息</td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d109757e9185" headers="d109757e9131 "><code class="codeph">V $ DIAG_TRACE_FILE_CONTENTS</code></td>
                                 <td align="left" valign="top" width="20%" headers="d109757e9185 d109757e9133 ">跟踪ADR中跟踪文件中的数据</td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d109757e9191" headers="d109757e9131 "><code class="codeph">V $ DIAG_SQL_TRACE_RECORDS</code></td>
                                 <td align="left" valign="top" width="20%" headers="d109757e9191 d109757e9133 ">ADR中跟踪文件中的<code class="codeph">SQL_TRACE</code>数据</td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d109757e9199" headers="d109757e9131 "><code class="codeph">V $ DIAG_OPT_TRACE_RECORDS</code></td>
                                 <td align="left" valign="top" width="20%" headers="d109757e9199 d109757e9133 ">ADR中跟踪文件中的优化程序跟踪事件数据</td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d109757e9205" headers="d109757e9131 "><code class="codeph">V $ DIAG_SESS_SQL_TRACE_RECORDS</code></td>
                                 <td align="left" valign="top" width="20%" headers="d109757e9205 d109757e9133 ">ADR中跟踪文件中的<code class="codeph">SQL_TRACE</code>数据，用于当前用户会话</td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d109757e9214" headers="d109757e9131 "><code class="codeph">V $ DIAG_SESS_OPT_TRACE_RECORDS</code></td>
                                 <td align="left" valign="top" width="20%" headers="d109757e9214 d109757e9133 ">ADR中的跟踪文件中的优化程序跟踪事件数据，用于当前用户会话</td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d109757e9220" headers="d109757e9131 "><code class="codeph">V $ DIAG_ALERT_EXT</code></td>
                                 <td align="left" valign="top" width="20%" headers="d109757e9220 d109757e9133 ">ADR中当前容器的基于XML的警报日志的内容</td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-93ACB9CC-9937-479E-8995-FEABD854C900__GUID-54A5A277-409D-49B0-8591-95E2B744DAA4">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<code class="codeph">V$</code>和数据字典视图的信息，请参阅<a href="../refrn/dynamic-performance-v-views-2.html#GUID-B200B2D6-08D4-49B0-9FD9-8AF6AED37202" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-DED467E4-4890-47B7-84DB-FAB180E9E780" title="您可以使用数据字典和V $视图来监视跟踪。">应用程序跟踪的视图</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL802"></a><div class="sect3"><a id="GUID-59FA7520-BAAA-478C-925D-DD43A527CF01" name="GUID-59FA7520-BAAA-478C-925D-DD43A527CF01"></a><h4 id="TGSQL-GUID-59FA7520-BAAA-478C-925D-DD43A527CF01" class="sect4"><span class="enumeration_section">22.7.2</span>与启用跟踪相关的视图</h4>
                  <div>
                     <p>Cloud Control报告或<code class="codeph">DBA_ENABLED_TRACES</code>视图可以显示出色的跟踪。
                     </p>
                     <p>在<code class="codeph">DBA_ENABLED_TRACES</code>视图中，您可以确定有关如何启用跟踪的详细信息，包括跟踪类型。跟踪类型指定是否为客户端标识符，会话，服务，数据库或服务，模块和操作的组合启用跟踪。
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="performing-application-tracing.html#GUID-DED467E4-4890-47B7-84DB-FAB180E9E780" title="您可以使用数据字典和V $视图来监视跟踪。">应用程序跟踪的视图</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>