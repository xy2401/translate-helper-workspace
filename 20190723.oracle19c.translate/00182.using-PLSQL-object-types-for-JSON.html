<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="Some examples of using PL/SQL object types for JSON are presented."></meta>
      <meta name="description" content="Some examples of using PL/SQL object types for JSON are presented."></meta>
      <title>为PLSON使用PL / SQL对象类型</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="JSON Developer&#39;s Guide"></meta>
      <meta property="og:description" content="Some examples of using PL/SQL object types for JSON are presented."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="JSON Developer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="json-developers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-02-22T10:58:31-08:00"></meta>
      <meta name="dcterms.title" content="JSON Developer&#39;s Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="2015, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96227-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="overview-of-pl-sql-object-types-for-json.html" title="Previous" type="text/html"></link>
      <link rel="next" href="GeoJSON-geographic-data.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="ADJSN"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="overview-of-pl-sql-object-types-for-json.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="GeoJSON-geographic-data.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">JSON开发人员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="pl-sql-object-types-for-json.html" property="item" typeof="WebPage"><span property="name">JSON的PL / SQL对象类型</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">为PLSON使用PL / SQL对象类型</li>
            </ol>
            <a id="GUID-F0561593-D0B9-44EA-9C8C-ACB6AA9474EE" name="GUID-F0561593-D0B9-44EA-9C8C-ACB6AA9474EE"></a>
            
            <h2 id="ADJSN-GUID-F0561593-D0B9-44EA-9C8C-ACB6AA9474EE" class="sect2"><span class="enumeration_chapter">23</span>为JSON使用PL / SQL对象类型</h2>
         </header>
         <div class="ind">
            <div>
               <p>给出了使用JSON的PL / SQL对象类型的一些示例。</p>
               <div class="section">
                  <div class="infoboxnotealso" id="GUID-F0561593-D0B9-44EA-9C8C-ACB6AA9474EE__GUID-F0DA707B-45F7-4C56-B959-6C225346547D">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>有关<code class="codeph">JSON_ARRAY_T</code>信息，请<code class="codeph">JSON_ARRAY_T</code> <a href="../arpls/json-types.html#ARPLS-GUID-69E61601-5533-418B-8C03-E591B4F7FE36" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a></p>
                        </li>
                        <li>
                           <p>有关<code class="codeph">JSON_ELEMENT_T</code>信息，请<code class="codeph">JSON_ELEMENT_T</code> <a href="../arpls/json-types.html#ARPLS-GUID-639D871E-D116-4793-888E-F7948E48F4DE" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a></p>
                        </li>
                        <li>
                           <p>有关<code class="codeph">JSON_OBJECT_T</code>信息，请<code class="codeph">JSON_OBJECT_T</code> <a href="../arpls/json-types.html#ARPLS-GUID-10062646-E36F-48B1-9F24-751B613DFB5A" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a></p>
                        </li>
                        <li>
                           <p>有关<code class="codeph">JSON_KEY_LIST</code>信息，请<code class="codeph">JSON_KEY_LIST</code> <a href="../arpls/json-types.html#ARPLS-GUID-50692D34-FEAF-471E-BA22-17530E31D95D" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a></p>
                        </li>
                     </ul>
                  </div>
               </div>
               <!-- class="section" -->
               <div class="example" id="GUID-F0561593-D0B9-44EA-9C8C-ACB6AA9474EE__GUID-4A962DA4-F04D-4698-8C54-BA983A0CEA6D">
                  <p class="titleinexample">示例23-1构造和序列化内存中的JSON对象</p>
                  <p>此示例使用函数<code class="codeph">parse</code>来解析表示具有一个字段<code class="codeph">name</code>的JSON对象的JSON数据字符串，从而创建对象类型为<code class="codeph">JSON_ELEMENT_T</code>的实例<code class="codeph">je</code> 。使用内省方法（谓词） <code class="codeph">is_object()</code>测试此实例以查看它是否表示对象。
                  </p>
                  <p>如果它表示一个对象（谓词为<code class="codeph">je</code>返回<code class="codeph">TRUE</code> ），则将其<code class="codeph">JSON_OBJECT_T</code>为<code class="codeph">JSON_OBJECT_T</code>的实例并分配给变量<code class="codeph">jo</code> 。然后使用对象类型<code class="codeph">JSON_OBJECT_T</code>方法<code class="codeph">put()</code>来添加值为<code class="codeph">149.99</code>对象字段<code class="codeph">price</code> 。
                  </p>
                  <p>最后，使用方法<code class="codeph">to_string()</code> <code class="codeph">JSON_ELEMENT_T</code>实例<code class="codeph">je</code> （与<code class="codeph">JSON_OBJECT_T</code>实例<code class="codeph">jo</code>中的内存中的数据相同）序列化为字符串，并使用过程<code class="codeph">DBMS_OUTPUT.put_line</code>打印出该字符串。打印出的结果显示更新的对象为<code class="codeph">{"name":"Radio-controlled plane","price":149.99}</code> 。
                  </p>
                  <p>更新的瞬态对象<code class="codeph">je</code>在此处被序列化以仅打印出来;生成的文本不存储在数据库中。在执行示例代码之后的某个时间，为垃圾收集器回收为对象类型实例<code class="codeph">je</code>和<code class="codeph">jo</code>分配的内存。
                  </p><pre class="pre codeblock"><code>DECLARE <span class="bold">je</span> JSON_ELEMENT_T; <span class="bold">jo</span> JSON_OBJECT_T; BEGIN je：= JSON_ELEMENT_T。 <span class="bold">解析</span> （'{“name”：“无线电控制的飞机”}'）; IF（ <span class="bold">je.is_Object</span> ）那么jo：= <span class="bold">treat</span> （je AS JSON_OBJECT_T）;乔。 <span class="bold">put</span> （'price'，149.99）;万一; DBMS_OUTPUT.put_line（ <span class="bold">je.to_string</span> ）;结束; /</code></pre></div>
               <!-- class="example" -->
               <div class="example" id="GUID-F0561593-D0B9-44EA-9C8C-ACB6AA9474EE__USINGMETHODGET_KEYSTOOBTAINALISTOFO-13B0AA0A">
                  <p class="titleinexample">示例23-2使用方法GET_KEYS（）获取对象字段列表</p>
                  <p>PL / SQL方法<code class="codeph">get_keys()</code>是为PL / SQL对象类型<code class="codeph">JSON_OBJECT_T</code> 。它返回PL / SQL对象类型<code class="codeph">JSON_KEY_LIST</code>的实例，它是<code class="codeph">VARCHAR2(4000)</code>的varray。varray包含给定<code class="codeph">JSON_OBJECT_T</code>实例的所有字段名称。
                  </p>
                  <p>此示例遍历<code class="codeph">get_keys()</code>返回的字段，将它们添加到PL / SQL对象类型<code class="codeph">JSON_ARRAY_T</code>的实例中。然后使用方法<code class="codeph">to_string()</code>来序列化该JSON数组，然后打印生成的字符串。
                  </p><pre class="pre codeblock"><code>DECLARE jo JSON_OBJECT_T; ja JSON_ARRAY_T;键JSON_KEY_LIST; keys_string VARCHAR2（100）; BEGIN ja：= new JSON_ARRAY_T; jo：= JSON_OBJECT_T.parse（'{“ <span class="bold">name</span> ”：“Beda”，“ <span class="bold">jobTitle</span> ”：“codmonki”，“ <span class="bold">projects</span> ”：[“json”，“xml”]}'）;键：= jo。 <span class="bold">get_keys</span> ; FOR I IN 1..keys。COUNT LOOP ja。 <span class="bold">追加</span> （键（i））;结束循环; keys_string：= ja。 <span class="bold">to_string</span> ; DBMS_OUTPUT.PUT_LINE（keys_string）;结束; /</code></pre><p>打印输出是<code class="codeph">["name","jobTitle","projects"]</code> 。
                  </p>
               </div>
               <!-- class="example" -->
               <div class="example" id="GUID-F0561593-D0B9-44EA-9C8C-ACB6AA9474EE__GUID-1025CB40-0022-4EA9-B197-C2E3D2BF8B58">
                  <p class="titleinexample">示例23-3使用方法PUT（）更新JSON文档的各个部分</p>
                  <p>此示例更新表<code class="codeph">j_purchaseorder</code> JSON列<code class="codeph">po_document</code>的每个采购订单文档。它迭代每个文档中的JSON数组<code class="codeph">LineItems</code> （变量<code class="codeph">li_arr</code> ），计算每个行项目对象（变量<code class="codeph">li_obj</code> ）的总价格和数量，并使用方法<code class="codeph">put()</code>将这些总计添加到<code class="codeph">li_obj</code>作为新值字段<code class="codeph">totalQuantity</code>和<code class="codeph">totalPrice</code> 。这是由用户定义的函数<code class="codeph">add_totals</code> 。
                  </p>
                  <p>此处的<code class="codeph">SELECT</code>语句选择已更新的文档之一。
                  </p><pre class="pre codeblock"><code>创建或替换函数<span class="bold">add_totals</span> （purchaseOrder IN VARCHAR2）RETURN VARCHAR2是po_obj JSON_OBJECT_T; li_arr JSON_ARRAY_T; li_item JSON_ELEMENT_T; li_obj JSON_OBJECT_T; unitPrice NUMBER;数量NUMBER; totalPrice NUMBER：= 0; totalQuantity NUMBER：= 0; BEGIN po_obj：= JSON_OBJECT_T。 <span class="bold">解析</span> （purchaseOrder）; li_arr：= po_obj。 <span class="bold">get_Array</span> （'LineItems'）; FOR i IN 0 .. li_arr。 <span class="bold">get_size</span> - 1个LOOP li_obj：= JSON_OBJECT_T（li_arr <span class="bold">得到</span> （I））;数量：= li_obj。 <span class="bold">get_Number</span> （'Quantity'）; unitPrice：= li_obj。 <span class="bold">get_Object</span> （'Part'）。 <span class="bold">get_Number</span> （'UnitPrice'）; totalPrice：= totalPrice +（quantity * unitPrice）; totalQuantity：= totalQuantity + quantity;结束循环; po_obj。 <span class="bold">put</span> （'totalQuantity'，totalQuantity）; po_obj。 <span class="bold">put</span> （'totalPrice'，totalPrice）;返回po_obj。 <span class="bold">to_string</span> ;结束; / <span class="bold">UPDATE</span> j_purchaseorder <span class="bold">SET</span> （po_document）= <span class="bold">add_totals</span> （po_document）; SELECT po_document FROM j_purchaseorder po WHERE po.po_document。PONumber = 1600;</code></pre><p>选择此更新文档：</p><pre class="pre codeblock"><code>{“PONumber”：1600，“参考”：“ABULL-20140421”，“请求者”：“Alexis Bull”，“用户”：“ABULL”，“CostCenter”：“A50”，“ShippingInstructions”：{“name” ：“Alexis Bull”，“Address”：{“street”：“200 Sporting Green”，“city”：“South San Francisco”，“state”：“CA”，“zipCode”：99236，“country”：“美利坚合众国“}，”电话“：[{”type“：”Office“，”number“：”909-555-7307“}，{”type“：”Mobile“，”number“：”415- 555-1234“}]}，”特殊指令“：null，”AllowPartialShipment“：true，”LineItems“：[{”ItemNumber“：1，”Part“：{”Description“：”One Magic Christmas“，”UnitPrice “：19.95，”UPCCode“：13131092899}，”数量“：9.0}，{”ItemNumber“：2，”Part“：{”Description“：”致命武器“，”UnitPrice“：19.95，”UPCCode“：85391628927 }，“数量”：5.0}]， <span class="bold">“totalQuantity”：14，</span> <span class="bold">“totalPrice”：279.3</span> }</code></pre></div>
               <!-- class="example" -->
            </div>
            <div>
               <div class="relinfo">
                  <p><strong>相关话题</strong></p>
                  <ul>
                     <li><a href="overview-of-pl-sql-object-types-for-json.html#GUID-A22995AD-A144-4A5C-AB80-A17225A56E41" title="PL / SQL对象类型允许细粒度编程构造和内存中JSON数据的操作。您可以对其进行内省，修改并将其序列化为文本JSON数据。">JSON的PL / SQL对象类型概述</a></li>
                     <li><a href="updating-json-document-json-merge-patch.html#GUID-31F88F28-3D92-489B-9CCD-BD1931B91F1F" title="您可以使用Oracle SQL函数json_mergepatch更新JSON文档的特定部分。您传递一个JSON Merge Patch文档，该文档指定对指定的JSON文档所做的更改。JSON Merge Patch是IETF标准。">使用JSON Merge修补程序更新JSON文档</a></li>
                  </ul>
               </div>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="pl-sql-object-types-for-json.html#GUID-C0C2A8C0-99BD-4770-9EA2-B7D53804FC18" title="您可以使用JSON的PL / SQL对象类型来读取和写入JSON文档的多个字段。这可以提高性能，特别是通过避免多次解析和数据序列化。">JSON的PL / SQL对象类型</a></p>
                  </div>
               </div>
            </div>
            
         </div>
      </article>
   </body>
</html>