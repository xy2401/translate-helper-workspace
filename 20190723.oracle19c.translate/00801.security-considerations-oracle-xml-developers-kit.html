<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="The security measures to be taken when using software programs that are built using XDK are explained in this chapter."></meta>
      <meta name="description" content="The security measures to be taken when using software programs that are built using XDK are explained in this chapter."></meta>
      <title>Oracle XML Developer's Kit的安全注意事项</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Programmer&#39;s Guide"></meta>
      <meta property="og:description" content="The security measures to be taken when using software programs that are built using XDK are explained in this chapter."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Programmer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="xml-developers-kit-programmers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-11T05:58:48-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2001, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96292-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="introduction-to-XDK.html" title="Previous" type="text/html"></link>
      <link rel="next" href="XDK-for-C.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="XML Developers Kit Programmers Guide"></meta>
    <meta name="dcterms.isVersionOf" content="ADXDK"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="introduction-to-XDK.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="XDK-for-C.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">程序员指南</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Oracle XML Developer's Kit的安全注意事项</li>
            </ol>
            <a id="GUID-5BA0F90B-4B43-49E3-B7F0-700A7755689B" name="GUID-5BA0F90B-4B43-49E3-B7F0-700A7755689B"></a>
            
            <h2 id="ADXDK-GUID-5BA0F90B-4B43-49E3-B7F0-700A7755689B" class="sect2"><span class="enumeration_chapter">2</span> Oracle XML Developer's Kit的安全注意事项</h2>
         </header>
         <div class="ind">
            <div>
               <p>使用XDK构建的软件程序时要采取的安全措施将在本章中介绍。</p>
            </div>
            <div class="sect2"><a id="GUID-8AEC58C0-3E65-417E-AB46-EA5E505F86FC" name="GUID-8AEC58C0-3E65-417E-AB46-EA5E505F86FC"></a><h3 id="ADXDK-GUID-8AEC58C0-3E65-417E-AB46-EA5E505F86FC" class="sect3">实现Java的安全性</h3>
               <div>
                  <p>实现Java程序安全性的过程。</p>
               </div>
               <div class="sect3"><a id="GUID-A1547226-6486-4F0D-AE23-E21B4510D61A" name="GUID-A1547226-6486-4F0D-AE23-E21B4510D61A"></a><h4 id="ADXDK-GUID-A1547226-6486-4F0D-AE23-E21B4510D61A" class="sect4">使用Oracle XML Developer's Kit保护XSLT处理</h4>
                  <div>
                     <p>在使用Oracle XML Developer's Kit进行XSLT处理之前，您需要通过设置一些配置选项来保护它。</p>
                     <div class="section">
                        <p>您必须为<code class="codeph">XSLProcessor</code> API和JAXP转换器API启用安全处理，如下所示。
                        </p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>使用此Java代码为<code class="codeph">XSLProcessor</code>启用安全处理模式：</p><pre class="pre codeblock"><code>processor.setAttribute（XMLConstants。FEATURE_SECURE_PROCESSING，布尔值。真正）;</code></pre></li>
                           <li>
                              <p>使用此Java代码为JAXP转换器API的<code class="codeph">SAXTransformerFactory</code>启用安全处理模式：</p><pre class="pre codeblock"><code>factory.setFeature（XMLConstants。FEATURE_SECURE_PROCESSING，true）;</code></pre></li>
                        </ul>
                        <p>这些设置一起通过以下方式提高了XML解析的安全性：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>默认情况下，设置会阻止对外部资源的访问。</p>
                              <p>然后开发人员可以使用<code class="codeph">org.xml.sax.EntityResolver</code>或<code class="codeph">javax.xml.transform.URIResolver</code>解决XSL样式表中的<code class="codeph">include</code>和<code class="codeph">import</code>元素。他们可以使用Java接口<code class="codeph">URIResolver</code>提供对受信任外部资源的XPath或XSLT功能访问。
                              </p>
                           </li>
                           <li>
                              <p>这些设置会阻止使用Java反射来执行Java代码。</p>
                              <p>开发人员可以将受信任的Java类转换为接口<code class="codeph">javax.xml.xpath.XPathFunction</code>并使用接口<code class="codeph">javax.xml.xpath.XPathFunctionResolver</code>来解决它们。
                              </p>
                           </li>
                           <li>
                              <p>设置限制递归实体扩展。</p>
                              <p>这有助于避免因过多的资源消耗而导致的常见拒绝服务攻击。</p>
                              <div class="infoboxnote" id="GUID-A1547226-6486-4F0D-AE23-E21B4510D61A__GUID-1E8F8EC7-D599-4A68-A3F3-C3AC36CD4D77">
                                 <p class="notep1">注意：</p>
                                 <p>虽然这可以限制递归实体<span class="italic">扩展</span> ，但XDK不能限制XML转换期间的资源消耗。XSL样式表可以包含无限循环或以其他方式消耗资源。因此，不得从不受信任的来源或外部实体接受XSL样式表。<span class="italic">测试所有使用的样式表</span> ，以确保它们不会消耗过多的资源。
                                 </p>
                              </div>
                           </li>
                        </ul>
                        <p>此外，Oracle建议对从用户或外部不可信实体获取的数据或文件执行XSLT处理的所有代码检查是否为XSLProcessor API和JAXP转换器API启用了安全处理。不这样做会打开一个安全漏洞。在XSL处理器受到保护之后，不允许访问外部资源和运行Java扩展功能。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-A1547226-6486-4F0D-AE23-E21B4510D61A__GUID-7F1DC426-BBF6-4DEA-8873-10E4EB4BCCD6">任意安全豁免</p>
                        <p>如果要任意覆盖安全限制，可以使用以下选项：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>执行以下任何修改以允许访问某些外部源：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>使用<code class="codeph">setURIResolver()</code>方法将<code class="codeph">URIResolver</code>设置为<code class="codeph">SAXTransformerFactory</code>或<code class="codeph">XSLProcessor</code> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p>使用<code class="codeph">setEntityResolver()</code>方法将<code class="codeph">EntityResolver</code>设置为<code class="codeph">XSLProcessor</code> 。
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>使用Java接口<code class="codeph">oracle.xml.xslt.XSLSecurityManager</code>用于注册Java类和方法的白名单，您可以使用它们使用Java反射扩展函数。
                              </p>
                           </li>
                           <li>
                              <p>使用<code class="codeph">XSLProcessor</code>方法<code class="codeph">setAttribute()</code>注册<code class="codeph">XSLSecurityManager</code>以运行您知道安全的扩展函数：</p><pre class="pre codeblock"><code>processor.setAttribute（XSLProcessor。SECURITY_MANAGER，securityManager）;</code></pre></li>
                           <li>
                              <p>在<code class="codeph">XSLSecurityManager</code>上使用简单的API来实现Java类和方法的白名单：</p><pre class="pre codeblock"><code>boolean checkExtensionFunction（String className，String fnName）;</code></pre></li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-45303542-41DE-4455-93B3-854A826EF8BB" name="GUID-45303542-41DE-4455-93B3-854A826EF8BB"></a><h4 id="ADXDK-GUID-45303542-41DE-4455-93B3-854A826EF8BB" class="sect4">安全地使用Oracle XML Parser</h4>
                  <div>
                     <p>与许多XML解析器一样，默认情况下，XDK解析器会尝试解析外部引用。攻击者可以利用此行为来执行XML外部实体（XXE）和XML实体扩展（XEE）攻击。要避免此漏洞，请禁用对外部资源的任意引用，并禁用不受约束的实体扩展。</p>
                     <div class="section">
                        <p>要实现全局安全设置（阻止在系统中创建的所有解析器使用外部实体），请将Java系统属性<code class="codeph">oracle.xdkjava.security.resolveEntityDefault</code>为<code class="codeph">false</code> 。
                        </p>
                        <p>要阻止特定解析器的实体扩展，或限制实体扩展的级别数，请设置属性<code class="codeph">XMLParser.RESOLVE_ENTITY_DEFAULT</code>或<code class="codeph">XMLParser.ENTITY_EXPANSION_DEPTH</code>到解析器。
                        </p>
                        <p>例如：</p><pre class="pre codeblock"><code>DOMParser domParser = new DOMParser（）; //扩展oracle.xml.parser.v2。XMLParser domParser.setAttribute（DOMParser。EXPAND_ENTITYREF，false）; //不要扩展实体引用domParser.setAttribute（DOMParser。DTD_OBJECT，dtdObj）; // dtdObj是oracle.xml.parser.v2的一个实例。DTD domParser.setAttribute（DOMParser。ENTITY_EXPANSION_DEPTH，12）; //不允许超过11个级别的实体扩展</code></pre><p>如果使用JAXP启用XML解析，则将<code class="codeph">DocumentBuilderFactory</code>或<code class="codeph">SAXParserFactor</code> <code class="codeph">FEATURE_SECURE_PROCESSING</code>设置为<code class="codeph">true</code> 。这会阻止外部实体的扩展，将实体扩展限制为深度11，并将实体扩展计数限制为64000。
                        </p><pre class="pre codeblock"><code>my_factory.setFeature（XMLConstants。FEATURE_SECURE_PROCESSING，true）;</code></pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-45303542-41DE-4455-93B3-854A826EF8BB__GUID-67C20A07-6A63-48D3-B2E2-0F48C20C6CBD">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Prevention_Cheat_Sheet" target="_blank">XML外部实体（XXE）预防备忘单</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-45303542-41DE-4455-93B3-854A826EF8BB__GUID-9F24FC66-9FC4-40A1-9C17-AFAC4366E99B">
                        <p class="titleinexample">示例2-1提高使用XML解析器的Java代码的安全性</p>
                        <p>此Java代码段阻止外部实体的解析，限制实体扩展级别的数量，并限制实体扩展的数量。</p><pre class="pre codeblock"><code>尝试{DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance（）; dbf.setNamespaceAware（真）; dbf.setXIncludeAware（假）; DBF。 <span class="bold">setExpandEntityReferences</span> （ <span class="bold">false</span> ）; //禁用实体扩展尝试{dbf.setFeature（XMLConstants。<span class="bold">FEATURE_SECURE_PROCESSING</span> ， <span class="bold">true</span> ）; } catch（Throwable e）{//处理旧的解析器版本......} DocumentBuilder dp = dbf.newDocumentBuilder（）; //使resolveEntity抛出异常。//（如果你真的需要支持外部引用//那么只针对可信值解析publicId。）DP。 <span class="bold">setEntityResolver</span> （new EntityResolver（）{public InputSource resolveEntity（String publicId，String systemId）抛出DOMException，IOException { <span class="bold">throw</span> new <span class="bold">DOMException</span> （（short）0，“Security Violation”）;}}）; ...</code></pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-050DF080-439E-4515-9DFE-1D3D9D4571BD" name="GUID-050DF080-439E-4515-9DFE-1D3D9D4571BD"></a><h3 id="ADXDK-GUID-050DF080-439E-4515-9DFE-1D3D9D4571BD" class="sect3">实施C的安全性</h3>
               <div>
                  <p>实现C程序安全性的过程。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-050DF080-439E-4515-9DFE-1D3D9D4571BD__GUID-FC66519C-624B-49C2-BA4B-79D200DCD665">阻止不安全的访问</p>
                     <p>通常，有两组XDK C API可以承担XXE攻击的风险：一组使用函数<code class="codeph">LpxInitEncoded()</code> ，另一组使用函数<code class="codeph">XmlCreate()</code>或<code class="codeph">XmlCreateNew()</code></p>
                     <p>对于<code class="codeph">LpxInitEncoded()</code> ，将标志<code class="codeph">LPX_FLAG_URL_DONT_OPEN</code>和<code class="codeph">LPX_FLAG_FILE_DONT_OPEN</code>给解析器API以阻止外部资源访问。
                     </p>
                     <p>例如：</p><pre class="pre codeblock"><code>LpxBufferParse（ctx，（oratext *）buf，（size_t）lstlen（buf），（oratext *）“UTF-8”，（lx_langid）0，（lxglo *）0，LPX_FLAG_URL_DONT_OPEN | LPX_FLAG_FILE_DONT_OPEN）;</code></pre><p>对于<code class="codeph">XmlCreate()</code>或<code class="codeph">XmlCreateNew()</code> ，在创建上下文<code class="codeph">xctx</code>时将参数<code class="codeph">no_ri_open</code>设置为<code class="codeph">TRUE</code> 。此设置将阻止使用<code class="codeph">xctx</code>解析器API的不安全访问。
                     </p>
                     <p>例如：</p><pre class="pre codeblock"><code>xctx = XmlCreateNew（＆xerr，（oratext *）“test”，（oratext **）NULL，0，（oratext *）NULL，“data_encoding”，“AL32UTF8”，“input_encoding”，“AL32UTF8”，“no_ri_open”，“ TRUE“，/ *禁止URI解析* /”error_handler“，test_errmsg，NULL）;</code></pre><p>在DOM API中也可以将参数<code class="codeph">no_ri_open</code>设置为<code class="codeph">TRUE</code>以阻止不安全的访问。在DOM API中设置此标志可确保即使在<code class="codeph">XmlCreate()</code>未设置此标志也会强制执行安全性。
                     </p>
                     <p>例如：</p><pre class="pre codeblock"><code>doc = XmlLoadDom（xctx，＆xerr，“file”，filename，“discard_whitespace”，TRUE，“validate”，TRUE，“no_ri_open”，TRUE，/ *禁止URI解析* / NULL）;</code></pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-050DF080-439E-4515-9DFE-1D3D9D4571BD__GUID-A993E34C-CCF1-472D-A228-6162A0E4E83C">允许任意访问</p>
                     <p>当用户希望允许对外部资源的任意引用或在他们自己的控制下进行访问时，他们可以实现以下步骤：</p>
                     <ol>
                        <li>
                           <p>在前面示例中显示的位置将<code class="codeph">no_ri_open</code>设置为<code class="codeph">FALSE</code> 。
                           </p>
                        </li>
                        <li>
                           <p>开发定制的打开，读取和关闭回调函数，并使用这些函数初始化<code class="codeph">OraSteam</code> 。
                           </p>
                        </li>
                        <li>
                           <p>覆盖访问<code class="codeph">xctx</code>与<code class="codeph">OraSteam</code></p>
                        </li>
                     </ol>
                     <p>例如：</p><pre class="pre codeblock"><code>ostream = OraStreamInit（actx，（oratext *）“test”，＆oerr，“open”，http_open，“read”，http_read，“close”，http_close，NULL）; xerr = XmlAccess（xctx，XML_ACCESS_HTTP，ostream）;</code></pre><p>该代码通过提供三个回调来创建<code class="codeph">ostream</code>的实例。创建的流将使用<code class="codeph">XmlAccess</code>覆盖<code class="codeph">xctx</code>内的访问。 <code class="codeph">xctx</code>调用API，例如当使用<code class="codeph">XmlLoadDom</code> 。因此，用户可以选择创建可以访问外部资源的规则。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-4FB6E252-2EC9-4D53-9282-4FC41C282161" name="GUID-4FB6E252-2EC9-4D53-9282-4FC41C282161"></a><h3 id="ADXDK-GUID-4FB6E252-2EC9-4D53-9282-4FC41C282161" class="sect3">C ++的安全性</h3>
               <div>
                  <p>默认情况下，C ++ API会阻止对外部资源的访问 - 从而确保安全性。但是，用户可以覆盖此安全限制，并允许根据其自行决定任意引用外部资源。</p>
                  <p><code class="codeph">xmlctx.hpp</code>头文件使用<code class="codeph">CXmlCtx(bool no_ri_open)</code> API初始化<code class="codeph">xctx</code>上下文并设置参数<code class="codeph">no_ri_open</code> 。当<code class="codeph">no_ri_open</code>参数设置为<code class="codeph">true</code> ，使用<code class="codeph">xctx</code>解析器API将无法访问外部资源。当<code class="codeph">no_ri_open</code>参数设置为<code class="codeph">false</code> ，使用<code class="codeph">xctx</code>解析器API将能够访问外部资源。
                  </p>
                  <p>默认情况下，使用<code class="codeph">xctx</code>解析器API无法访问外部资源。要允许访问，请将<code class="codeph">no_ri_open</code>参数设置为<code class="codeph">false</code> ，如下所示：</p><pre class="pre codeblock"><code>xctx = CXmlCtx（FALSE）; / *允许URI解析* /</code></pre><div class="infoboxnote" id="GUID-4FB6E252-2EC9-4D53-9282-4FC41C282161__GUID-ADF68510-3FA6-4CEF-9ACE-C6E3DDD2E47E">
                     <p class="notep1">警告：</p>
                     <p>允许访问外部资源可能导致XML外部实体（XXE）和XML实体扩展（XEE）攻击。在覆盖安全限制并允许访问外部资源时，用户应该小心。</p>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>