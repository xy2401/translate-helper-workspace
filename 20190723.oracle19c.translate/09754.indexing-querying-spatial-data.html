<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="After you have loaded spatial data , you should create a spatial index on it to enable efficient query performance using the data.">
      <meta name="description" content="After you have loaded spatial data , you should create a spatial index on it to enable efficient query performance using the data.">
      <title>Indexing and Querying Spatial Data</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Developer's Guide ">
      <meta property="og:description" content="After you have loaded spatial data , you should create a spatial index on it to enable efficient query performance using the data.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="spatial-and-graph-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-10T14:11:51-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="1999, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E94799-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="loading-spatial-data.html" title="Previous" type="text/html">
      <link rel="next" href="coordinate-systems-concepts.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Spatial and Graph Developer's Guide">
    <meta name="dcterms.isVersionOf" content="SPATL">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="loading-spatial-data.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="coordinate-systems-concepts.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Developer's Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="spatial-concepts-usage.html" property="item" typeof="WebPage"><span property="name">  Conceptual and Usage Information </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Indexing and Querying Spatial Data</li>
            </ol>
            <a id="GUID-07129836-0DAE-4BCC-B290-942C456AE2EA" name="GUID-07129836-0DAE-4BCC-B290-942C456AE2EA"></a><a id="SPATL040"></a>
            
            <h2 id="SPATL-GUID-07129836-0DAE-4BCC-B290-942C456AE2EA" class="sect2"><span class="enumeration_chapter">5 </span> Indexing and Querying Spatial Data
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>After you have loaded spatial data , you should create a spatial index on it to enable efficient query performance using the data.</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-18BB2973-096E-4239-9A01-0C95E9AFEFA1">Creating a Spatial Index</a><br>Once data has been loaded into the spatial tables through either bulk or transactional loading, a spatial index (that is, a spatial R-tree index) must be created on each geometry column in the tables for efficient access to the data.
                  </li>
                  <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-34D74D79-6B6A-4827-B418-A05D3F41103D">Querying Spatial Data</a><br>The structures of a spatial layer are used to resolve spatial queries and spatial joins.
                  </li>
               </ul>
               <div class="relinfo">
                  <p><strong>Related Topics</strong></p>
                  <ul>
                     <li><a href="loading-spatial-data.html#GUID-69233A26-EE80-4AFC-82EF-803124DA7F97" title="Describes how to load spatial data into a database, including storing the data in a table with a column of type SDO_GEOMETRY.">Loading Spatial Data</a></li>
                  </ul>
               </div>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="spatial-concepts-usage.html#GUID-EEEED709-34A1-46EA-9AF3-869FD06E3076">Conceptual and Usage Information</a></p>
                  </div>
               </div>
            </div><a id="SPATL583"></a><div class="props_rev_3"><a id="GUID-18BB2973-096E-4239-9A01-0C95E9AFEFA1" name="GUID-18BB2973-096E-4239-9A01-0C95E9AFEFA1"></a><h3 id="SPATL-GUID-18BB2973-096E-4239-9A01-0C95E9AFEFA1" class="sect3"><span class="enumeration_section">5.1 </span>Creating a Spatial Index
               </h3>
               <div>
                  <p>Once data has been loaded into the spatial tables through either bulk or transactional loading, a spatial index (that is, a spatial R-tree index) must be created on each geometry column in the tables for efficient access to the data.</p>
                  <p><a id="d34665e133" class="indexterm-anchor"></a>For example, the following statement creates a spatial index named <code class="codeph">territory_idx</code> using default values for all parameters:
                  </p><pre class="oac_no_warn" dir="ltr">CREATE INDEX territory_idx ON territories (territory_geom)
   INDEXTYPE IS MDSYS.SPATIAL_INDEX_V2;
</pre><div class="infoboxnote" id="GUID-18BB2973-096E-4239-9A01-0C95E9AFEFA1__GUID-4C9EBA15-6FBD-4668-8CE2-45D282A9EBC8">
                     <p class="notep1">Note:</p>
                     <p>For an explanation of the “_V2” in INDEXTYPE IS MDSYS.SPATIAL_INDEX_V2, see <a href="indexing-querying-spatial-data.html#GUID-6BBF58C4-10D0-4993-8DF2-60C3157412D7">Using System-Managed Spatial Indexes</a></p>
                  </div>
                  <p>For detailed information about options for creating a spatial index, see the documentation for the <a href="sql-indexing-spatial-data.html#GUID-BB6D7C9E-277B-4F49-BDD4-539CFE88D12C">CREATE INDEX</a> statement.
                  </p>
                  <p>If the index creation does not complete for any reason, the index is invalid and must be deleted with the <a href="sql-indexing-spatial-data.html#GUID-A661EFD5-59E6-4084-A511-B5141F9205A7">DROP INDEX</a> &lt;index_name&gt; [FORCE] statement.
                  </p>
                  <p>Within each geometry column to be indexed, all the geometries must have the same SDO_SRID value.</p>
                  <p>Spatial indexes can be built on two, three, or four dimensions of data. The default number of dimensions is two, but if the data has more than two dimensions, you can use the <code class="codeph">sdo_indx_dims</code> parameter keyword to specify the number of dimensions on which to build the index. (For information about support for three-dimensional geometries, see <a href="spatial-concepts.html#GUID-6F3A9C6E-3617-47D9-AE61-CF9F1770555A" title="Oracle Spatial and Graph supports the storage and retrieval of three-dimensional spatial data, which can include points, point clouds (collections of points), lines, polygons, surfaces, and solids.">Three-Dimensional Spatial Objects</a>. For an explanation of support for various combinations of dimensionality in query elements, see <a href="indexing-querying-spatial-data.html#GUID-DDD42A40-3EF8-473D-8D07-52A934A72D0C">Data and Index Dimensionality, and Spatial Queries</a>.)
                  </p>
                  <p>If you are <span class="italic">not</span> using the automatic undo management feature or the PGA memory management feature, or both, of Oracle Database, see <a href="indexing-querying-spatial-data.html#GUID-41454B7A-666C-48BA-A44C-5E946943BC1A">Rollback Segments and Sort Area Size</a> for information about initialization parameter values that you may need to set. Both automatic undo management and PGA memory management are enabled by default, and their use is highly recommended.
                  </p>
                  <p>The tablespace specified with the <code class="codeph">tablespace</code> keyword in the <a href="sql-indexing-spatial-data.html#GUID-BB6D7C9E-277B-4F49-BDD4-539CFE88D12C">CREATE INDEX</a> statement (or the default tablespace if the <code class="codeph">tablespace</code> keyword is not specified) is used to hold both the index data table and some transient tables that are created for internal computations. If you specify WORK_TABLESPACE as the tablespace, the transient tables are stored in the work tablespace.
                  </p>
                  <p>For large tables (over 1 million rows), a temporary tablespace may be needed to perform internal sorting operations. The recommended size for this temporary tablespace is 100*<span class="italic">n</span> bytes, where <span class="italic">n</span> is the number of rows in the table, up to a maximum requirement of 1 gigabyte of temporary tablespace.
                  </p>
                  <p>To estimate the space that will be needed to create a spatial index, use the <a href="SDO_TUNE-reference.html#GUID-BE58E3F8-63C2-4E81-A2B8-F17CDD381F1F">SDO_TUNE.ESTIMATE_RTREE_INDEX_SIZE</a> function.
                  </p>
                  <p><a id="d34665e214" class="indexterm-anchor"></a>Spatial indexes are not supported on nested tables.
                  </p>
                  <p>This section also contains the following topics.</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-6BBF58C4-10D0-4993-8DF2-60C3157412D7">Using System-Managed Spatial Indexes</a><br></li>
                     <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-0A054242-4FCC-4DBB-97FC-E375DE9773EE">Constraining Data to a Geometry Type</a><br></li>
                     <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-14E71BA4-7802-4AA2-A727-22B029906F50">Creating a Composite B-tree Spatial Index on Points</a><br></li>
                     <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-8E6AE949-758B-4A5E-9453-CC3D00647497">Creating a Cross-Schema Index</a><br></li>
                     <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-DB52CEB5-4A4D-44E5-B6F6-F80E00A39E61">Using Partitioned Spatial Indexes</a><br></li>
                     <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-54F618C8-EAAE-41F4-8C35-19373FF39F85">Exchanging Partitions Including Indexes</a><br></li>
                     <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-4206F617-284B-46CE-9327-7EEDA3B47044">Export and Import Considerations with Spatial Indexes and Data</a><br></li>
                     <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-AA03F9FB-7A46-4AF8-96CF-EC61270186F8">Distributed and Oracle XA Transactions Supported with R-Tree Spatial Indexes</a><br></li>
                     <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-F18EDF46-B0E2-437D-AB05-74941EC3608C">Enabling Access to Spatial Index Statistics</a><br></li>
                     <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-41454B7A-666C-48BA-A44C-5E946943BC1A">Rollback Segments and Sort Area Size</a><br></li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-07129836-0DAE-4BCC-B290-942C456AE2EA" title="After you have loaded spatial data , you should create a spatial index on it to enable efficient query performance using the data.">Indexing and Querying Spatial Data</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="props_rev_3"><a id="GUID-6BBF58C4-10D0-4993-8DF2-60C3157412D7" name="GUID-6BBF58C4-10D0-4993-8DF2-60C3157412D7"></a><h4 id="SPATL-GUID-6BBF58C4-10D0-4993-8DF2-60C3157412D7" class="sect4"><span class="enumeration_section">5.1.1 </span>Using System-Managed Spatial Indexes
                  </h4>
                  <div>
                     <p>Effective with Release 12.2, spatial indexes can be system-managed by specifying INDEXTYPE=MDSYS.SPATIAL_INDEX<span class="bold">_V2</span> at index creation. You are strongly encouraged to use this index type for all new spatial indexes you create, regardless of whether the spatial table or the spatial index is partitioned, and you may also want to use it if you decide to re-create legacy spatial indexes.
                     </p>
                     <p>The main benefit is simplified spatial index management. This is most beneficial in cases of partitioning, because this new index type eliminates the need for most, if not all, index partitioning management operations. Full support is provided for almost all Oracle Database base table partitioning models, including:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Single-level partitioning: range, hash, list </p>
                        </li>
                        <li>
                           <p>Composite partitioning: range-range, range-hash, range-list, list-range, list-hash, list-list, hash-hash, hash-list, hash-range</p>
                        </li>
                        <li>
                           <p>Partitioning extensions: interval (but not interval-based composite partitions), reference, virtual column-based partitioning</p>
                        </li>
                     </ul>
                     <p> The old INDEXTYPE=MDSYS.SPATIAL_INDEX (without the “_V2”) is still available for use, It may provide slightly better index creation performance, especially with small data sets and no partitioning involved. You might also want to use the old type if you need to drop a legacy spatial index and then want to re-create it in exactly the same form as it was before. However, in all or almost all cases you will want to specify INDEXTYPE=MDSYS.SPATIAL_INDEX_V2 when creating any spatial index.</p>
                     <p>The following topics provide examples of using INDEXTYPE=MDSYS.SPATIAL_INDEX_V2.</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-CF86A02C-67EB-4D67-A1BD-AA4A2F8BAE18">Spatial Indexing Example: Interval Partitioning</a><br></li>
                        <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-D0EC4A9D-AD99-4AFD-ACB7-681950C51E15">Spatial Indexing Example: Virtual Column Partitioning</a><br></li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-18BB2973-096E-4239-9A01-0C95E9AFEFA1" title="Once data has been loaded into the spatial tables through either bulk or transactional loading, a spatial index (that is, a spatial R-tree index) must be created on each geometry column in the tables for efficient access to the data.">Creating a Spatial Index</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="props_rev_3"><a id="GUID-CF86A02C-67EB-4D67-A1BD-AA4A2F8BAE18" name="GUID-CF86A02C-67EB-4D67-A1BD-AA4A2F8BAE18"></a><h5 id="SPATL-GUID-CF86A02C-67EB-4D67-A1BD-AA4A2F8BAE18" class="sect5"><span class="enumeration_section">5.1.1.1 </span>Spatial Indexing Example: Interval Partitioning
                     </h5>
                     <div>
                        <p>Interval partitioning is a partitioning method where Oracle Database automatically creates base table partitions when the inserted value does not match any existing partition ranges.</p>
                        <p>The following restrictions apply: </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>You can only specify one base table partitioning key column, and it must be of type NUMBER or DATE. </p>
                           </li>
                           <li>
                              <p>Interval partitioning is not supported for index-organized tables.</p>
                           </li>
                        </ul>
                        <p>Consider the following example of a base table named DEST_TABLE, partitioned based on the month of the “currently last seen” column:</p><pre class="pre codeblock"><code>CREATE TABLE dest_table
PARTITION BY RANGE ("CURR_LAST_SEEN_AT")
INTERVAL(NUMTOYMINTERVAL(1, 'MONTH'))
  (PARTITION "YEAR_1999"
     VALUES LESS THAN (TIMESTAMP' 2000-01-01 00:00:00'),
   PARTITION "YEAR_2000"
     VALUES LESS THAN (TIMESTAMP' 2001-01-01 00:00:00'))
PARALLEL 
AS SELECT imo_num,
          last_seen_at           curr_last_seen_at,
          a.geometry.sdo_point.x curr_longitude,
          a.geometry.sdo_point.y curr_latitude,
LAG(last_seen_at) 
  OVER (partition by imo_num ORDER BY last_seen_at) prev_last_seen_at,
LEAD(last_seen_at) 
  OVER (partition by imo_num ORDER BY last_seen_at) next_last_seen_at,
LAG(a.geometry.sdo_point.x) 
  OVER (partition by imo_num ORDER BY last_seen_at) prev_longitude,
LAG(a.geometry.sdo_point.y) 
  OVER (partition by imo_num ORDER BY last_seen_at) prev_latitude,
LEAD(a.geometry.sdo_point.x) 
  OVER (partition by imo_num ORDER BY last_seen_at) next_longitude,
LEAD(a.geometry.sdo_point.y) 
  OVER (partition by imo_num ORDER BY last_seen_at) next_latitude
FROM source_table a;
</code></pre><p>As data is selected from the source table (source_table) into this DEST_TABLE table, Oracle Database automatically partitions the data by the month of the CURR_LAST_SEEN_AT column. If the corresponding partition does not exist, Oracle Database will automatically create a new partition without any action required on your part.</p>
                        <p>The preceding example created two explicit partitions. To see what our actual data looks like, use a query such as for following to the database dictionary to see what partitions were created:</p><pre class="pre codeblock"><code>SQL&gt; select partition_name, high_value
  2  from user_tab_partitions
  3  where table_name = 'DEST_TABLE'
  4  order by partition_name;

PARTITION_NAME
--------------------------------------------------------------------------------
HIGH_VALUE
--------------------------------------------------------------------------------
SYS_P2881
TIMESTAMP' 2014-08-01 00:00:00'

SYS_P2882
TIMESTAMP' 2014-09-01 00:00:00'

SYS_P2883
TIMESTAMP' 2014-10-01 00:00:00'

SYS_P2884
TIMESTAMP' 2014-11-01 00:00:00'

YEAR_1999
TIMESTAMP' 2000-01-01 00:00:00'

YEAR_2000
TIMESTAMP' 2001-01-01 00:00:00'

6 rows selected.
</code></pre><p>Now create the spatial index. The following example uses function-based index; the function will convert the base table scalar longitude and latitude columns into a virtual spatial geometry, which will be the index “key value”:</p><pre class="pre codeblock"><code>CREATE OR REPLACE FUNCTION get_geometry(in_longitude NUMBER,
                                        in_latitude  NUMBER)
  return SDO_GEOMETRY DETERMINISTIC PARALLEL_ENABLE IS
BEGIN
  RETURN sdo_geometry(2001,
                      4326,
                      sdo_point_type(in_longitude, in_latitude, NULL),
                      NULL,
                      NULL);
END;
/

INSERT INTO user_sdo_geom_metadata VALUES (
  'DEST_TABLE','SCOTT.GET_GEOMETRY(CURR_LONGITUDE,CURR_LATITUDE)',
   SDO_DIM_ARRAY(SDO_DIM_ELEMENT('Longitude', '-180', '180', '.05'),
                 SDO_DIM_ELEMENT('Latitude',   '-90',  '90', '.05')),
   4326);
COMMIT;

CREATE INDEX geom_idx1
ON dest_table(GET_GEOMETRY(CURR_LONGITUDE, CURR_LATITUDE))
INDEXTYPE IS MDSYS.SPATIAL_INDEX_V2 LOCAL PARALLEL;
</code></pre><p>Notice that no partitioning information was specified for the spatial index.  To see the partitions that were automatically created, use a query such as for following:</p><pre class="pre codeblock"><code>SQL&gt; select partition_name, high_value
  2  from user_ind_partitions
  3  where index_name = 'PRECOMPUTE_GEOM_IDX1'
  4  order by partition_name;

PARTITION_NAME
--------------------------------------------------------------------------------
HIGH_VALUE
--------------------------------------------------------------------------------
SYS_P2921
TIMESTAMP' 2014-08-01 00:00:00'
SYS_P2922
TIMESTAMP' 2014-09-01 00:00:00'
SYS_P2923
TIMESTAMP' 2014-10-01 00:00:00'
SYS_P2924
TIMESTAMP' 2014-11-01 00:00:00'
YEAR_1999
TIMESTAMP' 2000-01-01 00:00:00'
YEAR_2000
TIMESTAMP' 2001-01-01 00:00:00'
6 rows selected.
</code></pre><p>Notice that the number of index partitions is the same as were created for the base table, including two partitions with the same name as those explicitly specified in the CREATE TABLE statement. However, the system-generated index partition names are different from the base table name.</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-6BBF58C4-10D0-4993-8DF2-60C3157412D7">Using System-Managed Spatial Indexes</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="props_rev_3"><a id="GUID-D0EC4A9D-AD99-4AFD-ACB7-681950C51E15" name="GUID-D0EC4A9D-AD99-4AFD-ACB7-681950C51E15"></a><h5 id="SPATL-GUID-D0EC4A9D-AD99-4AFD-ACB7-681950C51E15" class="sect5"><span class="enumeration_section">5.1.1.2 </span>Spatial Indexing Example: Virtual Column Partitioning
                     </h5>
                     <div>
                        <p>A virtual column is an expression based on one or more existing columns in the base table. While a virtual column is only stored as metadata and does not consume physical space, it can be indexed and also contain optimizer statistics and histograms. Partitioning is supported for a table using a partitioning key on a virtual column</p>
                        <p>If system-managed spatial indexing is not used, then to partition a table by using a derived value, a DBA must create and populate an additional physical column in order to achieve the same result. The derived value then must be populated by the application or by a trigger that evaluates the expression before insertion.  In either case, achieving this goal without system-managed indexing requires additional overhead and increased disk space for the physical column.</p>
                        <p>If system-managed indexing is used, the ability to use an expression as a partitioning key provides a more efficient way to meet comprehensive business requirements without incurring unnecessary overhead. This can be very useful when a table cannot be partitioned by the existing data columns.</p>
                        <p>Consider the following example of a base table named ACCOUNTS that contains a virtual column named REGION:</p><pre class="pre codeblock"><code>create table accounts_v
( account_number varchar2(30),
  account_name varchar2(30),
  contact_person varchar2(30),
  region AS (case
             when substr(account_name,1,1) = 'N' then 'NORTH'
             when substr(account_name,1,1) = 'E' then 'EAST'
             when substr(account_name,1,1) = 'S' then 'SOUTH'
             when substr(account_name,1,1) = 'W' then 'WEST'
             end),
  shape mdsys.sdo_geometry
)
partition by list (region)
( partition pN values ('NORTH'),
  partition pE values ('EAST'),
  partition pS values ('SOUTH'),
  partition pW values ('WEST')
);
</code></pre><p>Now create a system-managed local domain spatial index on the SHAPE column:</p><pre class="pre codeblock"><code>insert into user_sdo_geom_metadata
values('ACCOUNTS_V',
       'SHAPE',
       mdsys.sdo_dim_array(
         mdsys.sdo_dim_element('Longitude', -180, 180, 0.05),
         mdsys.sdo_dim_element('Latitude',   -90,  90, 0.05)),
       NULL);
commit;
create index shape_v_idx on accounts_v(shape)
indextype is mdsys.spatial_index_v2 LOCAL;
</code></pre><p>Notice that no spatial index partition information was specified. However, a full set of spatial index partitions was created automatically and without user intervention.</p>
                        <p>To verify the placement of records in the appropriate partitions, query a specific partition. The following query is for the accounts in the East region (:</p><pre class="pre codeblock"><code>SQL&gt; select * from accounts_v partition(PE)
  2  order by account_number;

ACCOUNT_NUMBER                 ACCOUNT_NAME
------------------------------ ------------------------------
CONTACT_PERSON                 REGIO
------------------------------ -----
SHAPE(SDO_GTYPE, SDO_SRID, SDO_POINT(X, Y, Z), SDO_ELEM_INFO, SDO_ORDINATES)
--------------------------------------------------------------------------------
8778-5435-5345-5223            E-HORIZON-AUTOMOTIVE
RICK                           EAST
SDO_GEOMETRY(2001, NULL, SDO_POINT_TYPE(2, 2, NULL), NULL, NULL)

1 row selected.
</code></pre></div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-6BBF58C4-10D0-4993-8DF2-60C3157412D7">Using System-Managed Spatial Indexes</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="SPATL584"></a><div class="props_rev_3"><a id="GUID-0A054242-4FCC-4DBB-97FC-E375DE9773EE" name="GUID-0A054242-4FCC-4DBB-97FC-E375DE9773EE"></a><h4 id="SPATL-GUID-0A054242-4FCC-4DBB-97FC-E375DE9773EE" class="sect4"><span class="enumeration_section">5.1.2 </span>Constraining Data to a Geometry Type
                  </h4>
                  <div>
                     <p>When you create or rebuild a spatial index, you can ensure that all geometries that are in the table or that are inserted later are of a specified geometry type. To constrain the data to a geometry type in this way, use the <code class="codeph">layer_gtype</code> keyword in the PARAMETERS clause of the <a href="sql-indexing-spatial-data.html#GUID-BB6D7C9E-277B-4F49-BDD4-539CFE88D12C">CREATE INDEX</a> or <a href="sql-indexing-spatial-data.html#GUID-9DBFA670-1F9D-49CB-8D68-66F1C31C1677">ALTER INDEX REBUILD</a> statement, and specify a value from the Geometry Type column of the Valid SDO_GTYPE Values table described in <a href="spatial-datatypes-metadata.html#GUID-4D84CE67-67E4-4A84-8255-C586E765A94B">SDO_GTYPE</a>. For example, to constrain spatial data in a layer to polygons:
                     </p><pre class="oac_no_warn" dir="ltr">CREATE INDEX cola_spatial_idx
ON cola_markets(shape)
INDEXTYPE IS MDSYS.SPATIAL_INDEX_V2
PARAMETERS ('layer_gtype=POLYGON');
</pre><p>The geometry types in <a href="spatial-datatypes-metadata.html#GUID-4D84CE67-67E4-4A84-8255-C586E765A94B">SDO_GTYPE</a> are considered as a hierarchy when data is checked:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The <span class="italic">MULTI</span> forms include the regular form also. For example, specifying <code class="codeph">'layer_gtype=</code><code class="codeph">MULTIPOINT'</code> allows the layer to include both POINT and MULTIPOINT geometries.
                           </p>
                        </li>
                        <li>
                           <p> COLLECTION allows the layer to include all types of geometries.</p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-18BB2973-096E-4239-9A01-0C95E9AFEFA1" title="Once data has been loaded into the spatial tables through either bulk or transactional loading, a spatial index (that is, a spatial R-tree index) must be created on each geometry column in the tables for efficient access to the data.">Creating a Spatial Index</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="props_rev_3"><a id="GUID-14E71BA4-7802-4AA2-A727-22B029906F50" name="GUID-14E71BA4-7802-4AA2-A727-22B029906F50"></a><h4 id="SPATL-GUID-14E71BA4-7802-4AA2-A727-22B029906F50" class="sect4"><span class="enumeration_section">5.1.3 </span>Creating a Composite B-tree Spatial Index on Points
                  </h4>
                  <div>
                     <p>Effective with Release 12.2, you can create a composite B-tree index on point data by specifying the <code class="codeph">cbtree_index=true</code> and <code class="codeph">layer_gtype=POINT</code> keywords in the PARAMETERS clause of the <a href="sql-indexing-spatial-data.html#GUID-BB6D7C9E-277B-4F49-BDD4-539CFE88D12C">CREATE INDEX</a> statement. For example:
                     </p><pre class="oac_no_warn" dir="ltr">CREATE INDEX pt_idx on PT_CB(c2) indextype is mdsys.spatial_index_v2 
  PAREMETERS ('layer_gtype=POINT <span class="bold">cbtree_index=true</span>');</pre><p>The preceding example creates a composite B-tree spatial index, not an R-tree spatial index. Using a composite B-tree spatial index for point data can:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Improve the performance of spatial index creation.</p>
                        </li>
                        <li>
                           <p>Improve DML performance when performing concurrent DML from many Oracle sessions.</p>
                        </li>
                     </ul>
                     <p>However, while composite B-tree spatial query performance is very fast, optimal spatial query performance may be obtained by using an R-tree spatial index on that data (especially with SPATIAL_VECTOR_ACCELERATION set to the recommended value of <code class="codeph">TRUE</code>).
                     </p>
                     <p>The <code class="codeph">cbtree_index=true</code> keyword can used only for spatial index creation (CREATE INDEX statement). It cannot be used with ALTER INDEX or ALTER INDEX REBUILD.
                     </p>
                     <p>The <a href="spatial-operators-reference.html#GUID-4D9DD9EF-DD9C-4198-A416-37B900B4E32F">SDO_JOIN</a> operator is not supported when a composite B-tree spatial index is used
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-18BB2973-096E-4239-9A01-0C95E9AFEFA1" title="Once data has been loaded into the spatial tables through either bulk or transactional loading, a spatial index (that is, a spatial R-tree index) must be created on each geometry column in the tables for efficient access to the data.">Creating a Spatial Index</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="SPATL585"></a><div class="props_rev_3"><a id="GUID-8E6AE949-758B-4A5E-9453-CC3D00647497" name="GUID-8E6AE949-758B-4A5E-9453-CC3D00647497"></a><h4 id="SPATL-GUID-8E6AE949-758B-4A5E-9453-CC3D00647497" class="sect4"><span class="enumeration_section">5.1.4 </span>Creating a Cross-Schema Index
                  </h4>
                  <div>
                     <div class="section">
                        <p>You can create a spatial index on a table that is not in your schema. Assume that user B wants to create a spatial index on column GEOMETRY in table T1 under user A's schema. Follow these steps:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Connect to the database as a privileged user (for example, as SYSTEM), and execute the following statements:</span><div><pre class="oac_no_warn" dir="ltr">GRANT create table, create sequence to A;
GRANT create table, create sequence to B;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Connect as a privileged user or as user A (or have user A connect), and execute the following statement:</span><div><pre class="oac_no_warn" dir="ltr">GRANT select, index on A.T1 to B;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Connect as user B and execute a statement such as the following:</span><div><pre class="oac_no_warn" dir="ltr">CREATE INDEX t1_spatial_idx on A.T1(geometry)
  INDEXTYPE IS mdsys.spatial_index_v2;</pre></div>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-18BB2973-096E-4239-9A01-0C95E9AFEFA1" title="Once data has been loaded into the spatial tables through either bulk or transactional loading, a spatial index (that is, a spatial R-tree index) must be created on each geometry column in the tables for efficient access to the data.">Creating a Spatial Index</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="SPATL1453"></a><a id="SPATL586"></a><div class="props_rev_3"><a id="GUID-DB52CEB5-4A4D-44E5-B6F6-F80E00A39E61" name="GUID-DB52CEB5-4A4D-44E5-B6F6-F80E00A39E61"></a><h4 id="SPATL-GUID-DB52CEB5-4A4D-44E5-B6F6-F80E00A39E61" class="sect4"><span class="enumeration_section">5.1.5 </span>Using Partitioned Spatial Indexes
                  </h4>
                  <div>
                     <p>You can create a partitioned spatial index on a partitioned table. This section describes usage considerations specific to Oracle Spatial and Graph. For a detailed explanation of partitioned tables and partitioned indexes, see <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/spatl&amp;id=VLDBG002" target="_blank"><span class="italic">Oracle Database VLDB and Partitioning Guide</span></a>.
                     </p>
                     <p>A partitioned spatial index can provide the following benefits:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Reduced response times for long-running queries, because partitioning reduces disk I/O operations</p>
                        </li>
                        <li>
                           <p>Reduced response times for concurrent queries, because I/O operations run concurrently on each partition</p>
                        </li>
                        <li>
                           <p>Easier index maintenance, because of partition-level create and rebuild operations</p>
                           <p>Indexes on partitions can be rebuilt without affecting the queries on other partitions, and storage parameters for each local index can be changed independent of other partitions.</p>
                        </li>
                        <li>
                           <p>Parallel query on multiple partition searching</p>
                           <p>The degree of parallelism is the value from the DEGREE column in the row for the index in the USER_INDEXES view (that is, the value specified or defaulted for the PARALLEL keyword with the <a href="sql-indexing-spatial-data.html#GUID-BB6D7C9E-277B-4F49-BDD4-539CFE88D12C">CREATE INDEX</a>, <a href="sql-indexing-spatial-data.html#GUID-D1F318B7-F224-4576-A59C-F42E14427B99">ALTER INDEX</a>, or <a href="sql-indexing-spatial-data.html#GUID-9DBFA670-1F9D-49CB-8D68-66F1C31C1677">ALTER INDEX REBUILD</a> statement).
                           </p>
                        </li>
                        <li>
                           <p>Improved query processing in multiprocessor system environments</p>
                           <p>In a multiprocessor system environment, if a spatial operator is invoked on a table with partitioned spatial index and if multiple partitions are involved in the query, multiple processors can be used to evaluate the query. The number of processors used is determined by the degree of parallelism and the number of partitions used in evaluating the query. </p>
                        </li>
                     </ul>
                     <p>The following restrictions apply to spatial index partitioning:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The partition key for spatial tables must be a scalar value, and must not be a spatial column.</p>
                        </li>
                        <li>
                           <p>Only range partitioning is supported on the underlying table. All other kinds of partitioning are not currently supported for partitioned spatial indexes.</p>
                        </li>
                     </ul>
                     <p>To create a partitioned spatial index, you must specify the LOCAL keyword. (If you do not specify the LOCAL keyword, a nonpartitioned spatial index is created on the data in all table partitions.) The following example creates a partitioned spatial index:</p><pre class="oac_no_warn" dir="ltr">CREATE INDEX counties_idx ON counties(geometry)
   INDEXTYPE IS MDSYS.SPATIAL_INDEX_V2 LOCAL;
</pre><p>In this example, the default values are used for the number and placement of index partitions, namely:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Index partitioning is based on the underlying table partitioning. For each table partition, a corresponding index partition is created.</p>
                        </li>
                        <li>
                           <p>Each index partition is placed in the default tablespace.</p>
                        </li>
                     </ul>
                     <p>If you do specify parameters for individual partitions, the following considerations apply:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The storage characteristics for each partition can be the same or different for each partition. If they are different, it may enable parallel I/O (if the tablespaces are on different disks) and may improve performance.</p>
                        </li>
                        <li>
                           <p>The <code class="codeph">sdo_indx_dims</code> value must be the same for all partitions.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">layer_gtype</code> parameter value (see <a href="indexing-querying-spatial-data.html#GUID-0A054242-4FCC-4DBB-97FC-E375DE9773EE">Constraining Data to a Geometry Type</a>) used for each partition may be different.
                           </p>
                        </li>
                     </ul>
                     <p>To override the default partitioning values, use a CREATE INDEX statement with the following general format:</p><pre class="oac_no_warn" dir="ltr">CREATE INDEX &lt;indexname&gt; ON &lt;table&gt;(&lt;column&gt;) 
  INDEXTYPE IS MDSYS.SPATIAL_INDEX_V2 
     [PARAMETERS ('&lt;spatial-params&gt;, &lt;storage-params&gt;')] LOCAL 
     [( PARTITION &lt;index_partition&gt; 
        PARAMETERS ('&lt;spatial-params&gt;, &lt;storage-params&gt;') 
     [, PARTITION &lt;index_partition&gt; 
        PARAMETERS ('&lt;spatial-params&gt;, &lt;storage-params&gt;')] 
     )] 
</pre><p>Queries can operate on partitioned tables to perform the query on only one partition. For example:</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM counties PARTITION(p1)
    WHERE ...&lt;some-spatial-predicate&gt;;
</pre><p>Querying on a selected partition may speed up the query and also improve overall throughput when multiple queries operate on different partitions concurrently. </p>
                     <p>When queries use a partitioned spatial index, the semantics (meaning or behavior) of spatial operators and functions is the same with partitioned and nonpartitioned indexes, except in the case of <a href="spatial-operators-reference.html#GUID-41E6B1FA-1A03-480B-996F-830E8566661D">SDO_NN</a> (nearest neighbor). With <a href="spatial-operators-reference.html#GUID-41E6B1FA-1A03-480B-996F-830E8566661D">SDO_NN</a>, the requested number of geometries is returned for each partition that is affected by the query. (See the description of the <a href="spatial-operators-reference.html#GUID-41E6B1FA-1A03-480B-996F-830E8566661D">SDO_NN</a> operator in <a href="spatial-operators-reference.html#GUID-85422854-5133-4F1D-BF0E-228CA6EDAF87" title="This chapter describes the operators that you can use when working with the spatial object data type."> Spatial Operators </a> for more information.)
                     </p>
                     <p>For example, if you request the 5 closest restaurants to a point and the spatial index has 4 partitions, <a href="spatial-operators-reference.html#GUID-41E6B1FA-1A03-480B-996F-830E8566661D">SDO_NN</a> returns up to 20 (5*4) geometries. In this case, you must use the ROWNUM pseudocolumn (here, <code class="codeph">WHERE ROWNUM &lt;=5</code>) to return the 5 closest restaurants, and the ORDER BY clause to sort the results by distance in miles. <a href="indexing-querying-spatial-data.html#GUID-DB52CEB5-4A4D-44E5-B6F6-F80E00A39E61__BABEBDJH">Example 5-1</a> returns the 5 nearest restaurants from a partitioned spatial index.
                     </p>
                     <div class="infoboxnotealso" id="GUID-DB52CEB5-4A4D-44E5-B6F6-F80E00A39E61__GUID-E3894790-548F-4FAF-A864-2C3F46CC64E7">
                        <p class="notep1">See Also:</p>
                        <p><a href="complex-spatial-queries.html#GUID-C4BE15BF-04AC-41EC-BEE1-F6DDA2A29E79">SDO_NN Examples</a> for more examples of using the <a href="spatial-operators-reference.html#GUID-41E6B1FA-1A03-480B-996F-830E8566661D">SDO_NN</a> operator. 
                        </p>
                     </div>
                     <p>For a cross-schema query when a table has a partitioned spatial index, the user must be granted SELECT or READ privilege on both the spatial table and the index table (MDRT_<span class="italic">xxx</span>) for the spatial index that was created on the spatial table. For more information and an example, see <span class="q">"<a href="spatial-operators-reference.html#GUID-4D9DD9EF-DD9C-4198-A416-37B900B4E32F__BABBFGFE">Cross-Schema Invocation of SDO_JOIN</a>"</span> in the Usage Notes for the <a href="spatial-operators-reference.html#GUID-4D9DD9EF-DD9C-4198-A416-37B900B4E32F">SDO_JOIN</a> operator.
                     </p>
                     <div class="example" id="GUID-DB52CEB5-4A4D-44E5-B6F6-F80E00A39E61__BABEBDJH">
                        <p class="titleinexample">Example 5-1 SDO_NN Query with Partitioned Spatial Index</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM
(
SELECT r.name, r.location, SDO_NN_DISTANCE(1) distance_in_miles
FROM restaurants_part_table r
WHERE SDO_NN(r.location,
      MDSYS.SDO_GEOMETRY(2001,8307,MDSYS.SDO_POINT_TYPE(-110,35,Null),Null,Null),
     'SDO_NUM_RES=5 distance=2  unit=MILE', 1) = 'TRUE'
<span class="bold">ORDER BY distance_in_miles</span>
)
<span class="bold">WHERE ROWNUM&lt;=5</span>;</pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-3009AE2A-2BB3-48D7-94D2-57D11BDE7496">Creating a Local Partitioned Spatial Index</a><br></li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-18BB2973-096E-4239-9A01-0C95E9AFEFA1" title="Once data has been loaded into the spatial tables through either bulk or transactional loading, a spatial index (that is, a spatial R-tree index) must be created on each geometry column in the tables for efficient access to the data.">Creating a Spatial Index</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="SPATL587"></a><div class="props_rev_3"><a id="GUID-3009AE2A-2BB3-48D7-94D2-57D11BDE7496" name="GUID-3009AE2A-2BB3-48D7-94D2-57D11BDE7496"></a><h5 id="SPATL-GUID-3009AE2A-2BB3-48D7-94D2-57D11BDE7496" class="sect5"><span class="enumeration_section">5.1.5.1 </span>Creating a Local Partitioned Spatial Index
                     </h5>
                     <div>
                        <div class="section">
                           <p>If you want to create a local partitioned spatial index, Oracle recommends that you use the procedure in this section instead of using the PARALLEL keyword, to avoid having to start over if the creation of any partition's index fails for any reason (for example, because the tablespace is full). Follow these steps:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Create a local spatial index and specify the UNUSABLE keyword. For example:</span><div><pre class="oac_no_warn" dir="ltr">CREATE INDEX sp_idx ON my_table (location) 
  INDEXTYPE IS mdsys.spatial_index_v2 
  PARAMETERS ('tablespace=tb_name work_tablespace=work_tb_name') 
  <span class="bold">LOCAL UNUSABLE</span>;
</pre><p>This statement executes quickly and creates metadata associated with the index.</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Create scripts with ALTER INDEX REBUILD statements, but without the PARALLEL keyword. For example, if you have 100 partitions and 10 processors, create 10 scripts with 10 ALTER INDEX statements such as the following:</span><div><pre class="oac_no_warn" dir="ltr">ALTER INDEX sp_idx REBUILD PARTITION ip1;
ALTER INDEX sp_idx REBUILD PARTITION ip2;
. . .
ALTER INDEX sp_idx REBUILD PARTITION ip10;
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Run all the scripts at the same time, so that each processor works on the index for a single partition, but all the processors are busy working on their own set of ALTER INDEX statements.</span></li>
                        </ol>
                        <div class="section">
                           <p>If any of the ALTER INDEX statements fails, you do not need to rebuild any partitions for which the operation has successfully completed.</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-DB52CEB5-4A4D-44E5-B6F6-F80E00A39E61">Using Partitioned Spatial Indexes</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="SPATL588"></a><div class="props_rev_3"><a id="GUID-54F618C8-EAAE-41F4-8C35-19373FF39F85" name="GUID-54F618C8-EAAE-41F4-8C35-19373FF39F85"></a><h4 id="SPATL-GUID-54F618C8-EAAE-41F4-8C35-19373FF39F85" class="sect4"><span class="enumeration_section">5.1.6 </span>Exchanging Partitions Including Indexes
                  </h4>
                  <div>
                     <p>You can use the ALTER TABLE statement with the EXCHANGE PARTITION ... INCLUDING INDEXES clause to exchange a spatial table partition and its index partition with a corresponding table and its index. For information about exchanging partitions, see the description of the ALTER TABLE statement in <a href="../sqlrf/ALTER-TABLE.html#SQLRF01001" target="_blank"><span class="italic">Oracle Database SQL Language Reference</span></a>.
                     </p>
                     <p>This feature can help you to operate more efficiently in a number of situations, such as:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Bringing data into a partitioned table and avoiding the cost of index re-creation.</p>
                        </li>
                        <li>
                           <p>Managing and creating partitioned indexes. For example, the data could be divided into multiple tables. The index for each table could be built one after the other to minimize the memory and tablespace resources needed during index creation. Alternately, the indexes could be created in parallel in multiple sessions. The tables (along with the indexes) could then be exchanged with the partitions of the original data table.</p>
                        </li>
                        <li>
                           <p>Managing offline insert operations. New data can be stored in a temporary table and periodically exchanged with a new partition (for example, in a database with historical data).</p>
                        </li>
                     </ul>
                     <p>To exchange partitions including indexes with spatial data and indexes, the two spatial indexes (one on the partition, the other on the table) must have the same dimensionality (<code class="codeph">sdo_indx_dims</code> value). If the indexes do not have the same dimensionality, an error is raised. The table data is exchanged, but the indexes are not exchanged and the indexes are marked as failed. To use the indexes, you must rebuild them
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-18BB2973-096E-4239-9A01-0C95E9AFEFA1" title="Once data has been loaded into the spatial tables through either bulk or transactional loading, a spatial index (that is, a spatial R-tree index) must be created on each geometry column in the tables for efficient access to the data.">Creating a Spatial Index</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="SPATL589"></a><div class="props_rev_3"><a id="GUID-4206F617-284B-46CE-9327-7EEDA3B47044" name="GUID-4206F617-284B-46CE-9327-7EEDA3B47044"></a><h4 id="SPATL-GUID-4206F617-284B-46CE-9327-7EEDA3B47044" class="sect4"><span class="enumeration_section">5.1.7 </span>Export and Import Considerations with Spatial Indexes and Data
                  </h4>
                  <div>
                     <p>If you use the Export utility to export tables with spatial data, the behavior of the operation depends on whether or not the spatial data has been spatially indexed:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>If the spatial data has not been spatially indexed, the table data is exported. However, you must update the USER_SDO_GEOM_METADATA view with the appropriate information on the target system.</p>
                        </li>
                        <li>
                           <p>If the spatial data has been spatially indexed, the table data is exported, the appropriate information is inserted into the USER_SDO_GEOM_METADATA view on the target system, and the spatial index is built on the target system. However, if the insertion into the USER_SDO_GEOM_METADATA view fails (for example, if there is already a USER_SDO_GEOM_METADATA entry for the spatial layer), the spatial index is not built.</p>
                        </li>
                     </ul>
                     <p>If you use the Import utility to import data that has been spatially indexed, the following considerations apply:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>If the index on the exported data was created with a <code class="codeph">TABLESPACE</code> clause and if the specified tablespace does not exist in the database at import time, the index is not built. (This is different from the behavior with other Oracle indexes, where the index is created in the user's default tablespace if the tablespace specified for the original index does not exist at import time.)
                           </p>
                        </li>
                        <li>
                           <p>If the import operation must be done by a privileged database user, and if the <code class="codeph">FROMUSER</code> and <code class="codeph">TOUSER</code> format is used, the <code class="codeph">TOUSER</code> user must be granted the CREATE TABLE and CREATE SEQUENCE privileges before the import operation, as shown in the following example (and enter the password for the SYSTEM account when prompted):
                           </p><pre class="oac_no_warn" dir="ltr">sqlplus system
SQL&gt; grant CREATE TABLE, CREATE SEQUENCE to CHRIS;
SQL&gt; exit;
imp system file=spatl_data.dmp fromuser=SCOTT touser=CHRIS
</pre></li>
                     </ul>
                     <p>For information about using the Export and Import utilities, see <a href="../sutil/oracle-data-pump-overview.html#SUTIL100" target="_blank"><span class="italic">Oracle Database Utilities</span></a>.
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-18BB2973-096E-4239-9A01-0C95E9AFEFA1" title="Once data has been loaded into the spatial tables through either bulk or transactional loading, a spatial index (that is, a spatial R-tree index) must be created on each geometry column in the tables for efficient access to the data.">Creating a Spatial Index</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="SPATL590"></a><div class="props_rev_3"><a id="GUID-AA03F9FB-7A46-4AF8-96CF-EC61270186F8" name="GUID-AA03F9FB-7A46-4AF8-96CF-EC61270186F8"></a><h4 id="SPATL-GUID-AA03F9FB-7A46-4AF8-96CF-EC61270186F8" class="sect4"><span class="enumeration_section">5.1.8 </span>Distributed and Oracle XA Transactions Supported with R-Tree Spatial Indexes
                  </h4>
                  <div>
                     <p>The use of R-tree spatial indexes is supported in distributed and Oracle XA transactions.</p>
                     <p>However, spatial DML operations are not allowed in a serializable distributed  transaction.</p>
                     <p>For more information about distributed transactions, see <a href="../admin/distributed-transactions-concepts.html#ADMIN031" target="_blank"><span class="italic">Oracle Database Administrator's Guide</span></a>.
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-18BB2973-096E-4239-9A01-0C95E9AFEFA1" title="Once data has been loaded into the spatial tables through either bulk or transactional loading, a spatial index (that is, a spatial R-tree index) must be created on each geometry column in the tables for efficient access to the data.">Creating a Spatial Index</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="SPATL1520"></a><div class="props_rev_3"><a id="GUID-F18EDF46-B0E2-437D-AB05-74941EC3608C" name="GUID-F18EDF46-B0E2-437D-AB05-74941EC3608C"></a><h4 id="SPATL-GUID-F18EDF46-B0E2-437D-AB05-74941EC3608C" class="sect4"><span class="enumeration_section">5.1.9 </span>Enabling Access to Spatial Index Statistics
                  </h4>
                  <div>
                     <p>The Oracle Database optimizer collects statistics that describe details about the database and its objects. Statistics are critical to the optimizer's ability to pick the best execution plan for a SQL statement. For more information about optimizer statistics, see <a href="../tgsql/optimizer-statistics.html#TGSQL335" target="_blank"><span class="italic">Oracle Database SQL Tuning Guide</span></a>.
                     </p>
                     <p>To be able to use procedures such as <a href="../arpls/index.html" target="_blank"><code class="codeph">DBMS_STATS.GATHER_INDEX_STATS</code></a> and <a href="../arpls/index.html" target="_blank"><code class="codeph">DBMS_STATS.GATHER_SCHEMA_STATS</code></a> to gather index statistics related to spatial indexes, the CREATE TABLE privilege must be granted to all database users that will perform the statistics collection.
                     </p>
                     <p>When you run ANALYZE INDEX on a spatial domain index for a different schema (user), the user performing the ANALYZE operation needs the following privileges:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>CREATE ANY TABLE to create missing temporary tables</p>
                        </li>
                        <li>
                           <p>DROP ANY TABLE to truncate or remove existing temporary tables</p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-18BB2973-096E-4239-9A01-0C95E9AFEFA1" title="Once data has been loaded into the spatial tables through either bulk or transactional loading, a spatial index (that is, a spatial R-tree index) must be created on each geometry column in the tables for efficient access to the data.">Creating a Spatial Index</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="SPATL591"></a><div class="props_rev_3"><a id="GUID-41454B7A-666C-48BA-A44C-5E946943BC1A" name="GUID-41454B7A-666C-48BA-A44C-5E946943BC1A"></a><h4 id="SPATL-GUID-41454B7A-666C-48BA-A44C-5E946943BC1A" class="sect4"><span class="enumeration_section">5.1.10 </span>Rollback Segments and Sort Area Size
                  </h4>
                  <div>
                     <p>This section applies <span class="italic">only</span> if you (or the database administrator) are not using the automatic undo management feature or the PGA memory management feature, or both, of Oracle Database. Automatic memory management and PGA memory management are enabled by default, and their use is highly recommended. For explanations of these features, see:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The section about automatic undo management and undo segments in <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/spatl&amp;id=CNCPT305" target="_blank"><span class="italic">Oracle Database Concepts</span></a></p>
                        </li>
                        <li>
                           <p>The section about PGA memory management in <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/spatl&amp;id=CNCPT803" target="_blank"><span class="italic">Oracle Database Concepts</span></a></p>
                        </li>
                     </ul>
                     <p><a id="d34665e1693" class="indexterm-anchor"></a><a id="d34665e1697" class="indexterm-anchor"></a><a id="d34665e1703" class="indexterm-anchor"></a>If you are not using automatic undo management and if the rollback segment is not large enough, an attempt to create a spatial index will fail. The rollback segment should be 100*<span class="italic">n </span>bytes, where <span class="italic">n</span> is the number of rows of data to be indexed. For example, if the table contains 1 million (1,000,000) rows, the rollback segment size should be 100,000,000 (100 million) bytes.
                     </p>
                     <p>To ensure an adequate rollback segment, or if you have tried to create a spatial index and received an error that a rollback segment cannot be extended, review (or have a DBA review) the size and structure of the rollback segments. Create a public rollback segment of the appropriate size, and place that rollback segment online. In addition, ensure that any small inappropriate rollback segments are placed offline during large spatial index operations.</p>
                     <p><a id="d34665e1717" class="indexterm-anchor"></a>If you are not using the PGA memory management feature, the database parameter SORT_AREA_SIZE affects the amount of time required to create the index. The SORT_AREA_SIZE value is the maximum amount, in bytes, of memory to use for a sort operation. The optimal value depends on the database size, but a good guideline is to make it at least 1 million bytes when you create a spatial index. To change the SORT_AREA_SIZE value, use the ALTER SESSION statement. For example, to change the value to 20 million bytes:
                     </p><pre class="oac_no_warn" dir="ltr">ALTER SESSION SET SORT_AREA_SIZE = 20000000;</pre></div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-18BB2973-096E-4239-9A01-0C95E9AFEFA1" title="Once data has been loaded into the spatial tables through either bulk or transactional loading, a spatial index (that is, a spatial R-tree index) must be created on each geometry column in the tables for efficient access to the data.">Creating a Spatial Index</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="SPATL592"></a><div class="props_rev_3"><a id="GUID-34D74D79-6B6A-4827-B418-A05D3F41103D" name="GUID-34D74D79-6B6A-4827-B418-A05D3F41103D"></a><h3 id="SPATL-GUID-34D74D79-6B6A-4827-B418-A05D3F41103D" class="sect3"><span class="enumeration_section">5.2 </span>Querying Spatial Data
               </h3>
               <div>
                  <p>The structures of a spatial layer are used to resolve spatial queries and spatial joins.</p>
                  <p>Spatial and Graph uses a two-tier query model with primary and secondary filter operations to resolve spatial queries and spatial joins, as explained in <a href="spatial-concepts.html#GUID-79F09397-E9DA-4E91-B154-9ECB327A5809" title="Spatial and Graph uses a two-tier query model to resolve spatial queries and spatial joins.">Query Model</a>. The term <span class="italic">two-tier</span> indicates that two distinct operations are performed to resolve queries. If both operations are performed, the exact result set is returned.
                  </p>
                  <p><a id="d34665e1803" class="indexterm-anchor"></a><a id="d34665e1807" class="indexterm-anchor"></a>You cannot append a database link (dblink) name to the name of a spatial table in a query if a spatial index is defined on that table.
                  </p>
                  <p>This section also contains the following topics.</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-FE2E8337-8A4E-4508-8D8D-F206ACB898E5">Spatial Query</a><br></li>
                     <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-C4C35CB5-0138-487B-9C50-B4BF1BDAFE08">Spatial Join</a><br></li>
                     <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-DDD42A40-3EF8-473D-8D07-52A934A72D0C">Data and Index Dimensionality, and Spatial Queries</a><br></li>
                     <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-D5FC46C1-6A9F-40C5-90A9-449DD93EAF0A">Using Event 54700 to Require a Spatial Index for Spatial Queries</a><br></li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-07129836-0DAE-4BCC-B290-942C456AE2EA" title="After you have loaded spatial data , you should create a spatial index on it to enable efficient query performance using the data.">Indexing and Querying Spatial Data</a></p>
                     </div>
                  </div>
               </div>
               <a id="SPATL594"></a><a id="SPATL595"></a><a id="SPATL593"></a><div class="props_rev_3"><a id="GUID-FE2E8337-8A4E-4508-8D8D-F206ACB898E5" name="GUID-FE2E8337-8A4E-4508-8D8D-F206ACB898E5"></a><h4 id="SPATL-GUID-FE2E8337-8A4E-4508-8D8D-F206ACB898E5" class="sect4"><span class="enumeration_section">5.2.1 </span>Spatial Query
                  </h4>
                  <div>
                     <p>In a spatial R-tree index, each geometry is represented by its minimum bounding rectangle (MBR), as explained in <a href="spatial-concepts.html#GUID-69A50E50-F713-4E3D-9182-AF3797250B97">R-Tree Indexing</a>. Consider the following layer containing several objects in <a href="indexing-querying-spatial-data.html#GUID-FE2E8337-8A4E-4508-8D8D-F206ACB898E5__BGBHEJGE">Figure 5-1</a>. Each object is labeled with its geometry name (geom_1 for the line string, geom_2 for the four-sided polygon, geom_3 for the triangular polygon, and geom_4 for the ellipse), and the MBR around each object is represented by a dashed line. 
                     </p>
                     <div class="figure" id="GUID-FE2E8337-8A4E-4508-8D8D-F206ACB898E5__BGBHEJGE">
                        <p class="titleinfigure">Figure 5-1 Geometries with MBRs</p><img src="img/query_mbrs.gif" alt="Description of Figure 5-1 follows" title="Description of Figure 5-1 follows" longdesc="img_text/query_mbrs.html"><br><a href="img_text/query_mbrs.html">Description of "Figure 5-1 Geometries with MBRs"</a></div>
                     <!-- class="figure" -->
                     <p>A typical spatial query is to request all objects that lie within a <a id="d34665e1922" class="indexterm-anchor"></a><span class="bold">query window</span>, that is, a defined fence or window. A <a id="d34665e1927" class="indexterm-anchor"></a>dynamic query window refers to a rectangular area that is not defined in the database, but that must be defined before it is used. <a href="indexing-querying-spatial-data.html#GUID-FE2E8337-8A4E-4508-8D8D-F206ACB898E5__BGBHIEJD">Figure 5-2</a> shows the same geometries as in <a href="indexing-querying-spatial-data.html#GUID-FE2E8337-8A4E-4508-8D8D-F206ACB898E5__BGBHEJGE">Figure 5-1</a>, but adds a query window represented by the heavy dotted-line box.
                     </p>
                     <div class="figure" id="GUID-FE2E8337-8A4E-4508-8D8D-F206ACB898E5__BGBHIEJD">
                        <p class="titleinfigure">Figure 5-2 Layer with a Query Window</p><img src="img/query_window.gif" alt="Description of Figure 5-2 follows" title="Description of Figure 5-2 follows" longdesc="img_text/query_window.html"><br><a href="img_text/query_window.html">Description of "Figure 5-2 Layer with a Query Window"</a></div>
                     <!-- class="figure" -->
                     <p>In <a href="indexing-querying-spatial-data.html#GUID-FE2E8337-8A4E-4508-8D8D-F206ACB898E5__BGBHIEJD">Figure 5-2</a>, the query window covers parts of geometries geom_1 and geom_2, as well as part of the MBR for geom_3 but none of the actual geom_3 geometry. The query window does not cover any part of the geom_4 geometry or its MBR.
                     </p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-E5954C4A-C8FF-4264-A583-5178A42B3F07">Primary Filter Operator</a><br></li>
                        <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-00000B2F-E63F-44DE-B969-BD5E6F8F5A5B">Primary and Secondary Filter Operator</a><br></li>
                        <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-3839BEE8-7743-46F4-B573-667ADC7FEB3E">Within-Distance Operator</a><br></li>
                        <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-850B0CE8-ED06-4B81-A3CE-39CE63DAFF25">Nearest Neighbor Operator</a><br></li>
                        <li class="ulchildlink"><a href="indexing-querying-spatial-data.html#GUID-76F77285-DC7D-496C-8352-1A25202D47A7">Spatial Functions</a><br></li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-34D74D79-6B6A-4827-B418-A05D3F41103D" title="The structures of a spatial layer are used to resolve spatial queries and spatial joins.">Querying Spatial Data</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="SPATL597"></a><a id="SPATL598"></a><a id="SPATL599"></a><a id="SPATL596"></a><div class="props_rev_3"><a id="GUID-E5954C4A-C8FF-4264-A583-5178A42B3F07" name="GUID-E5954C4A-C8FF-4264-A583-5178A42B3F07"></a><h5 id="SPATL-GUID-E5954C4A-C8FF-4264-A583-5178A42B3F07" class="sect5"><span class="enumeration_section">5.2.1.1 </span>Primary Filter Operator
                     </h5>
                     <div>
                        <p>The <a href="spatial-operators-reference.html#GUID-9AB42477-D0C0-4A87-826F-1BDDF1CA1FE5">SDO_FILTER</a> operator, described in <a href="spatial-operators-reference.html#GUID-85422854-5133-4F1D-BF0E-228CA6EDAF87" title="This chapter describes the operators that you can use when working with the spatial object data type."> Spatial Operators </a>, implements the primary filter portion of the two-step process involved in the Oracle Spatial and Graph query processing model. The primary filter uses the index data to determine only if a set of candidate object pairs may interact. Specifically, the primary filter checks to see if the MBRs of the candidate objects interact, not whether the objects themselves interact. The <a href="spatial-operators-reference.html#GUID-9AB42477-D0C0-4A87-826F-1BDDF1CA1FE5">SDO_FILTER</a> operator syntax is as follows:
                        </p><pre class="oac_no_warn" dir="ltr">SDO_FILTER(geometry1 SDO_GEOMETRY, geometry2 SDO_GEOMETRY, param VARCHAR2)
</pre><p>In the preceding syntax:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">geometry1</code> is a column of type SDO_GEOMETRY in a table. This column must be spatially indexed.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">geometry2</code> is an object of type SDO_GEOMETRY. This object may or may not come from a table. If it comes from a table, it may or may not be spatially indexed.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">param</code> is an optional string of type VARCHAR2. It can specify either or both of the <code class="codeph">min_resolution</code> and <code class="codeph">max_resolution</code> keywords.
                              </p>
                           </li>
                        </ul>
                        <p>The following examples perform a primary filter operation only (with no secondary filter operation). They will return all the geometries shown in <a href="indexing-querying-spatial-data.html#GUID-FE2E8337-8A4E-4508-8D8D-F206ACB898E5__BGBHIEJD">Figure 5-2</a> that have an MBR that interacts with the query window. The result of the following examples are geometries geom_1, geom_2, and geom_3.
                        </p>
                        <p><a href="indexing-querying-spatial-data.html#GUID-E5954C4A-C8FF-4264-A583-5178A42B3F07__i1005295">Example 5-2</a> performs a primary filter operation without inserting the query window into a table. The window will be indexed in memory and performance will be very good. 
                        </p>
                        <div class="example" id="GUID-E5954C4A-C8FF-4264-A583-5178A42B3F07__i1005295">
                           <p class="titleinexample">Example 5-2 Primary Filter with a Temporary Query Window</p><pre class="oac_no_warn" dir="ltr">SELECT A.Feature_ID FROM TARGET A
 WHERE sdo_filter(A.shape, SDO_geometry(2003,NULL,NULL,
                                       SDO_elem_info_array(1,1003,3),
                                       SDO_ordinate_array(x1,y1, x2,y2))
                           ) = 'TRUE';	
</pre><p>In <a href="indexing-querying-spatial-data.html#GUID-E5954C4A-C8FF-4264-A583-5178A42B3F07__i1005295">Example 5-2</a>, <code class="codeph">(x1,y1)</code> and <code class="codeph">(x2,y2)</code> are the lower-left and upper-right corners of the query window.
                           </p>
                           <p>In <a href="indexing-querying-spatial-data.html#GUID-E5954C4A-C8FF-4264-A583-5178A42B3F07__i1005306">Example 5-3</a>, a transient instance of type SDO_GEOMETRY was constructed for the query window instead of specifying the window parameters in the query itself.
                           </p>
                        </div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-E5954C4A-C8FF-4264-A583-5178A42B3F07__i1005306">
                           <p class="titleinexample">Example 5-3 Primary Filter with a Transient Instance of the Query Window</p><pre class="oac_no_warn" dir="ltr">SELECT A.Feature_ID FROM TARGET A
 WHERE sdo_filter(A.shape, :theWindow) = 'TRUE';	
</pre><p><a href="indexing-querying-spatial-data.html#GUID-E5954C4A-C8FF-4264-A583-5178A42B3F07__i1005314">Example 5-4</a> assumes the query window was inserted into a table called WINDOWS, with an ID of WINS_1.
                           </p>
                        </div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-E5954C4A-C8FF-4264-A583-5178A42B3F07__i1005314">
                           <p class="titleinexample">Example 5-4 Primary Filter with a Stored Query Window</p><pre class="oac_no_warn" dir="ltr">SELECT A.Feature_ID FROM TARGET A, WINDOWS B
 WHERE B.ID = 'WINS_1' AND 
  sdo_filter(A.shape, B.shape) = 'TRUE';	
</pre><p>If the B.SHAPE column is not spatially indexed, the <a href="spatial-operators-reference.html#GUID-9AB42477-D0C0-4A87-826F-1BDDF1CA1FE5">SDO_FILTER</a> operator indexes the query window in memory and performance is very good.
                           </p>
                        </div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-FE2E8337-8A4E-4508-8D8D-F206ACB898E5">Spatial Query</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="SPATL601"></a><a id="SPATL602"></a><a id="SPATL600"></a><div class="props_rev_3"><a id="GUID-00000B2F-E63F-44DE-B969-BD5E6F8F5A5B" name="GUID-00000B2F-E63F-44DE-B969-BD5E6F8F5A5B"></a><h5 id="SPATL-GUID-00000B2F-E63F-44DE-B969-BD5E6F8F5A5B" class="sect5"><span class="enumeration_section">5.2.1.2 </span>Primary and Secondary Filter Operator
                     </h5>
                     <div>
                        <p>The <a href="spatial-operators-reference.html#GUID-97C17C18-F05E-49B4-BE11-E89B972E2A02">SDO_RELATE</a> operator, described in <a href="spatial-operators-reference.html#GUID-85422854-5133-4F1D-BF0E-228CA6EDAF87" title="This chapter describes the operators that you can use when working with the spatial object data type."> Spatial Operators </a>, performs both the primary and secondary filter stages when processing a query. The secondary filter ensures that only candidate objects that actually interact are selected. This operator can be used only if a spatial index has been created on two dimensions of data. The syntax of the <a href="spatial-operators-reference.html#GUID-97C17C18-F05E-49B4-BE11-E89B972E2A02">SDO_RELATE</a> operator is as follows:
                        </p><pre class="oac_no_warn" dir="ltr">SDO_RELATE(geometry1  SDO_GEOMETRY,
           geometry2  SDO_GEOMETRY,
           param      VARCHAR2)
</pre><p>In the preceding syntax:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">geometry1</code> is a column of type SDO_GEOMETRY in a table. This column must be spatially indexed.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">geometry2</code> is an object of type SDO_GEOMETRY. This object may or may not come from a table. If it comes from a table, it may or may not be spatially indexed.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">param</code> is a quoted string with the <code class="codeph">mask</code> keyword and a valid mask value, and optionally either or both of the <code class="codeph">min_resolution</code> and <code class="codeph">max_resolution</code> keywords, as explained in the documentation for the <a href="spatial-operators-reference.html#GUID-97C17C18-F05E-49B4-BE11-E89B972E2A02">SDO_RELATE</a> operator in <a href="spatial-operators-reference.html#GUID-85422854-5133-4F1D-BF0E-228CA6EDAF87" title="This chapter describes the operators that you can use when working with the spatial object data type."> Spatial Operators </a>.
                              </p>
                           </li>
                        </ul>
                        <p>The following examples perform both primary and secondary filter operations. They return all the geometries in <a href="indexing-querying-spatial-data.html#GUID-FE2E8337-8A4E-4508-8D8D-F206ACB898E5__BGBHIEJD">Figure 5-2</a> that lie within or overlap the query window. The result of these examples is objects geom_1 and geom_2.
                        </p>
                        <p><a href="indexing-querying-spatial-data.html#GUID-00000B2F-E63F-44DE-B969-BD5E6F8F5A5B__i1005358">Example 5-5</a> performs both primary and secondary filter operations without inserting the query window into a table. The window will be indexed in memory and performance will be very good.
                        </p>
                        <div class="example" id="GUID-00000B2F-E63F-44DE-B969-BD5E6F8F5A5B__i1005358">
                           <p class="titleinexample">Example 5-5 Secondary Filter Using a Temporary Query Window</p><pre class="oac_no_warn" dir="ltr">SELECT A.Feature_ID FROM TARGET A
   WHERE sdo_relate(A.shape, SDO_geometry(2003,NULL,NULL,
                                       SDO_elem_info_array(1,1003,3),
                                      SDO_ordinate_array(x1,y1, x2,y2)),
                        'mask=anyinteract') = 'TRUE';
</pre><p>In <a href="indexing-querying-spatial-data.html#GUID-00000B2F-E63F-44DE-B969-BD5E6F8F5A5B__i1005358">Example 5-5</a>, <code class="codeph">(x1,y1)</code> and <code class="codeph">(x2,y2)</code> are the lower-left and upper-right corners of the query window.
                           </p>
                           <p><a href="indexing-querying-spatial-data.html#GUID-00000B2F-E63F-44DE-B969-BD5E6F8F5A5B__i1005370">Example 5-6</a> assumes the query window was inserted into a table called WINDOWS, with an ID value of WINS_1.
                           </p>
                        </div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-00000B2F-E63F-44DE-B969-BD5E6F8F5A5B__i1005370">
                           <p class="titleinexample">Example 5-6 Secondary Filter Using a Stored Query Window</p><pre class="oac_no_warn" dir="ltr">SELECT A.Feature_ID FROM TARGET A, WINDOWS B
 WHERE B.ID = 'WINS_1' AND 
        sdo_relate(A.shape, B.shape,
          'mask=anyinteract') = 'TRUE';	
</pre><p>If the B.SHAPE column is not spatially indexed, the <a href="spatial-operators-reference.html#GUID-97C17C18-F05E-49B4-BE11-E89B972E2A02">SDO_RELATE</a> operator indexes the query window in memory and performance is very good.
                           </p>
                        </div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-FE2E8337-8A4E-4508-8D8D-F206ACB898E5">Spatial Query</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="SPATL603"></a><div class="props_rev_3"><a id="GUID-3839BEE8-7743-46F4-B573-667ADC7FEB3E" name="GUID-3839BEE8-7743-46F4-B573-667ADC7FEB3E"></a><h5 id="SPATL-GUID-3839BEE8-7743-46F4-B573-667ADC7FEB3E" class="sect5"><span class="enumeration_section">5.2.1.3 </span>Within-Distance Operator
                     </h5>
                     <div>
                        <p>The <a href="spatial-operators-reference.html#GUID-682B258F-1604-4BE8-824D-F6E05376E7EC">SDO_WITHIN_DISTANCE</a> operator, described in <a href="spatial-operators-reference.html#GUID-85422854-5133-4F1D-BF0E-228CA6EDAF87" title="This chapter describes the operators that you can use when working with the spatial object data type."> Spatial Operators </a>, is used to determine the set of objects in a table that are within <span class="italic">n</span> distance units from a reference object. This operator can be used only if a spatial index has been created on two dimensions of data. The reference object may be a transient or persistent instance of SDO_GEOMETRY, such as a temporary query window or a permanent geometry stored in the database. The syntax of the operator is as follows:
                        </p><pre class="oac_no_warn" dir="ltr">SDO_WITHIN_DISTANCE(geometry1  SDO_GEOMETRY, 
                    aGeom      SDO_GEOMETRY,
                    params     VARCHAR2);
</pre><p>In the preceding syntax:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">geometry1</code> is a column of type SDO_GEOMETRY in a table. This column must be spatially indexed.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">aGeom</code> is an instance of type SDO_GEOMETRY.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">params</code> is a quoted string of keyword value pairs that determines the behavior of the operator. See the <a href="spatial-operators-reference.html#GUID-682B258F-1604-4BE8-824D-F6E05376E7EC">SDO_WITHIN_DISTANCE</a> operator in <a href="spatial-operators-reference.html#GUID-85422854-5133-4F1D-BF0E-228CA6EDAF87" title="This chapter describes the operators that you can use when working with the spatial object data type."> Spatial Operators </a> for a list of parameters.
                              </p>
                           </li>
                        </ul>
                        <p>The following example selects any objects within 1.35 distance units from the query window: </p><pre class="oac_no_warn" dir="ltr">SELECT A.Feature_ID
  FROM TARGET A
  WHERE SDO_WITHIN_DISTANCE( A.shape, :theWindow, 'distance=1.35') = 'TRUE';
</pre><p>The distance units are based on the geometry coordinate system in use. If you are using a geodetic coordinate system, the units are meters. If no coordinate system is used, the units are the same as for the stored data.</p>
                        <p>The <a href="spatial-operators-reference.html#GUID-682B258F-1604-4BE8-824D-F6E05376E7EC">SDO_WITHIN_DISTANCE</a> operator is not suitable for performing spatial joins. That is, a query such as <span class="italic">Find all parks that are within 10 distance units from coastlines</span> will not be processed as an index-based spatial join of the COASTLINES and PARKS tables. Instead, it will be processed as a nested loop query in which each COASTLINES instance is in turn a reference object that is buffered, indexed, and evaluated against the PARKS table. Thus, the <a href="spatial-operators-reference.html#GUID-682B258F-1604-4BE8-824D-F6E05376E7EC">SDO_WITHIN_DISTANCE</a> operation is performed <span class="italic">n</span> times if there are <span class="italic">n</span> rows in the COASTLINES table. 
                        </p>
                        <p>For non-geodetic data, there is an efficient way to accomplish a spatial join that involves buffering all geometries of a layer. This method does not use the <a href="spatial-operators-reference.html#GUID-682B258F-1604-4BE8-824D-F6E05376E7EC">SDO_WITHIN_DISTANCE</a> operator. First, create a new table COSINE_BUFS as follows:
                        </p><pre class="oac_no_warn" dir="ltr">CREATE TABLE cosine_bufs UNRECOVERABLE AS
   SELECT SDO_BUFFER (A.SHAPE, B.DIMINFO, 1.35)
     FROM COSINE A, USER_SDO_GEOM_METADATA B
     WHERE TABLE_NAME='COSINES' AND COLUMN_NAME='SHAPE';
</pre><p>Next, create a spatial index on the SHAPE column of COSINE_BUFS. Then you can perform the following query:</p><pre class="oac_no_warn" dir="ltr">SELECT /*+ ordered */ a.gid, b.gid 
  FROM TABLE(SDO_JOIN('PARKS', 'SHAPE', 
                      'COSINE_BUFS', 'SHAPE',
                      'mask=ANYINTERACT')) c,
       parks a, 
       cosine_bufs b
  WHERE c.rowid1 = a.rowid AND c.rowid2 = b.rowid;</pre></div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-FE2E8337-8A4E-4508-8D8D-F206ACB898E5">Spatial Query</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="SPATL604"></a><div class="props_rev_3"><a id="GUID-850B0CE8-ED06-4B81-A3CE-39CE63DAFF25" name="GUID-850B0CE8-ED06-4B81-A3CE-39CE63DAFF25"></a><h5 id="SPATL-GUID-850B0CE8-ED06-4B81-A3CE-39CE63DAFF25" class="sect5"><span class="enumeration_section">5.2.1.4 </span>Nearest Neighbor Operator
                     </h5>
                     <div>
                        <p>The <a href="spatial-operators-reference.html#GUID-41E6B1FA-1A03-480B-996F-830E8566661D">SDO_NN</a> operator, described in <a href="spatial-operators-reference.html#GUID-85422854-5133-4F1D-BF0E-228CA6EDAF87" title="This chapter describes the operators that you can use when working with the spatial object data type."> Spatial Operators </a>, is used to identify the nearest neighbors for a geometry. This operator can be used only if a spatial index has been created on two dimensions of data. The syntax of the operator is as follows:
                        </p><pre class="oac_no_warn" dir="ltr">SDO_NN(geometry1  SDO_GEOMETRY, 
       geometry2  SDO_GEOMETRY,
       param      VARCHAR2
       [, number  NUMBER]);
</pre><p>In the preceding syntax:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">geometry1</code> is a column of type SDO_GEOMETRY in a table. This column must be spatially indexed.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">geometry2</code> is an instance of type SDO_GEOMETRY.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">param</code> is a quoted string of keyword-value pairs that can determine the behavior of the operator, such as how many nearest neighbor geometries are returned. See the <a href="spatial-operators-reference.html#GUID-41E6B1FA-1A03-480B-996F-830E8566661D">SDO_NN</a> operator in <a href="spatial-operators-reference.html#GUID-85422854-5133-4F1D-BF0E-228CA6EDAF87" title="This chapter describes the operators that you can use when working with the spatial object data type."> Spatial Operators </a> for information about this parameter.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">number</code> is the same number used in the call to <a href="spatial-operators-reference.html#GUID-4CD900B5-E2FB-4802-B843-E66D5D86BE64">SDO_NN_DISTANCE</a>. Use this only if the <a href="spatial-operators-reference.html#GUID-4CD900B5-E2FB-4802-B843-E66D5D86BE64">SDO_NN_DISTANCE</a> ancillary operator is included in the call to <a href="spatial-operators-reference.html#GUID-41E6B1FA-1A03-480B-996F-830E8566661D">SDO_NN</a>. See the <a href="spatial-operators-reference.html#GUID-41E6B1FA-1A03-480B-996F-830E8566661D">SDO_NN</a> operator in <a href="spatial-operators-reference.html#GUID-85422854-5133-4F1D-BF0E-228CA6EDAF87" title="This chapter describes the operators that you can use when working with the spatial object data type."> Spatial Operators </a> for information about this parameter.
                              </p>
                           </li>
                        </ul>
                        <p>The following example finds the two objects from the SHAPE column in the COLA_MARKETS table that are closest to a specified point (10,7). (Note the use of the optimizer hint in the SELECT statement, as explained in the Usage Notes for the <a href="spatial-operators-reference.html#GUID-41E6B1FA-1A03-480B-996F-830E8566661D">SDO_NN</a> operator in <a href="spatial-operators-reference.html#GUID-85422854-5133-4F1D-BF0E-228CA6EDAF87" title="This chapter describes the operators that you can use when working with the spatial object data type."> Spatial Operators </a>.)
                        </p><pre class="oac_no_warn" dir="ltr">SELECT /*+ INDEX(cola_markets cola_spatial_idx) */
 c.mkt_id, c.name  FROM cola_markets c  WHERE SDO_NN(c.shape,
   SDO_geometry(2001, NULL, SDO_point_type(10,7,NULL), NULL,
   NULL),  'sdo_num_res=2') = 'TRUE'; </pre></div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-FE2E8337-8A4E-4508-8D8D-F206ACB898E5">Spatial Query</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="SPATL605"></a><div class="props_rev_3"><a id="GUID-76F77285-DC7D-496C-8352-1A25202D47A7" name="GUID-76F77285-DC7D-496C-8352-1A25202D47A7"></a><h5 id="SPATL-GUID-76F77285-DC7D-496C-8352-1A25202D47A7" class="sect5"><span class="enumeration_section">5.2.1.5 </span>Spatial Functions
                     </h5>
                     <div>
                        <p>Spatial and Graph also supplies functions for determining relationships between geometries, finding information about single geometries, changing geometries, and combining geometries. These functions all take into account two dimensions of source data. If the output value of these functions is a geometry, the resulting geometry will have the same dimensionality as the input geometry, but only the first two dimensions will accurately reflect the result of the operation.</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-FE2E8337-8A4E-4508-8D8D-F206ACB898E5">Spatial Query</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="SPATL606"></a><div class="props_rev_3"><a id="GUID-C4C35CB5-0138-487B-9C50-B4BF1BDAFE08" name="GUID-C4C35CB5-0138-487B-9C50-B4BF1BDAFE08"></a><h4 id="SPATL-GUID-C4C35CB5-0138-487B-9C50-B4BF1BDAFE08" class="sect4"><span class="enumeration_section">5.2.2 </span>Spatial Join
                  </h4>
                  <div>
                     <p>A <a id="d34665e2721" class="indexterm-anchor"></a><span class="bold">spatial join</span> is the same as a regular join except that the predicate involves a spatial operator. In Spatial and Graph, a spatial join takes place when you compare all geometries of one layer to all geometries of another layer. This is unlike a query window, which compares a single geometry to all geometries of a layer.
                     </p>
                     <p>Spatial joins can be used to answer questions such as <span class="italic">Which highways cross national parks?</span></p>
                     <p>The following table structures illustrate how the join would be accomplished for this example: </p><pre class="oac_no_warn" dir="ltr">PARKS(    GID VARCHAR2(32), SHAPE SDO_GEOMETRY)
HIGHWAYS( GID VARCHAR2(32), SHAPE SDO_GEOMETRY) 
</pre><p>To perform a spatial join, use the <a href="spatial-operators-reference.html#GUID-4D9DD9EF-DD9C-4198-A416-37B900B4E32F">SDO_JOIN</a> operator, which is described in <a href="spatial-operators-reference.html#GUID-85422854-5133-4F1D-BF0E-228CA6EDAF87" title="This chapter describes the operators that you can use when working with the spatial object data type."> Spatial Operators </a>. The following spatial join query, to list the GID column values of highways and parks where a highway interacts with a park, performs a primary filter operation only (<code class="codeph">'mask=FILTER'</code>), and thus it returns only approximate results:
                     </p><pre class="oac_no_warn" dir="ltr">SELECT /*+ ordered */ a.gid, b.gid 
  FROM TABLE(SDO_JOIN('PARKS', 'SHAPE', 
                      'HIGHWAYS', 'SHAPE',
                      'mask=FILTER')) c,
       parks a, 
       highways b
  WHERE c.rowid1 = a.rowid AND c.rowid2 = b.rowid;
</pre><div class="infoboxnote" id="GUID-C4C35CB5-0138-487B-9C50-B4BF1BDAFE08__GUID-BE1280DD-EED8-439E-8319-C6305DF0CFB4">
                        <p class="notep1">Note:</p>
                        <p>The <a href="spatial-operators-reference.html#GUID-4D9DD9EF-DD9C-4198-A416-37B900B4E32F">SDO_JOIN</a> operator is not supported when a composite B-tree spatial index is used.
                        </p>
                     </div>
                     <p>The following spatial join query requests the same information as in the preceding example, but it performs both primary and secondary filter operations (<code class="codeph">'mask=ANYINTERACT'</code>), and thus it returns exact results:
                     </p><pre class="oac_no_warn" dir="ltr">SELECT /*+ ordered */ a.gid, b.gid 
  FROM TABLE(SDO_JOIN('PARKS', 'SHAPE', 
                      'HIGHWAYS', 'SHAPE',
                      'mask=ANYINTERACT')) c,
       parks a, 
       highways b
  WHERE c.rowid1 = a.rowid AND c.rowid2 = b.rowid;</pre></div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-34D74D79-6B6A-4827-B418-A05D3F41103D" title="The structures of a spatial layer are used to resolve spatial queries and spatial joins.">Querying Spatial Data</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="SPATL1412"></a><a id="SPATL1411"></a><div class="props_rev_3"><a id="GUID-DDD42A40-3EF8-473D-8D07-52A934A72D0C" name="GUID-DDD42A40-3EF8-473D-8D07-52A934A72D0C"></a><h4 id="SPATL-GUID-DDD42A40-3EF8-473D-8D07-52A934A72D0C" class="sect4"><span class="enumeration_section">5.2.3 </span>Data and Index Dimensionality, and Spatial Queries
                  </h4>
                  <div>
                     <p>The elements of a spatial query can, in theory, have the following dimensionality:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The base table geometries (or <code class="codeph">geometry1</code> in spatial operator formats) can have two, three, or more dimensions.
                           </p>
                        </li>
                        <li>
                           <p>The spatial index created on the base table (or <code class="codeph">geometry1</code>) can be two-dimensional or three-dimensional.
                           </p>
                        </li>
                        <li>
                           <p>The query window (or <code class="codeph">geometry2</code> in spatial operator formats) can have two, three, or more dimensions.
                           </p>
                        </li>
                     </ul>
                     <p>Some combinations of dimensionality among the three elements are supported and some are not. <a href="indexing-querying-spatial-data.html#GUID-DDD42A40-3EF8-473D-8D07-52A934A72D0C__BGBCEEFJ" title="Data and Index Dimensionality, and Query Support. Column 1 is Base Table (geometry1) Dimensionality, column 2 is Spatial Index Dimensionality, column 3 is Query Window (geometry2) Dimensionality, and column 4 is Query Result.">Table 5-1</a> explains what happens with the possible combinations involving two and three dimensions.
                     </p>
                     <div class="tblformal" id="GUID-DDD42A40-3EF8-473D-8D07-52A934A72D0C__BGBCEEFJ">
                        <p class="titleintable">Table 5-1 Data and Index Dimensionality, and Query Support</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="Data and Index Dimensionality, and Query Support" summary="Data and Index Dimensionality, and Query Support. Column 1 is Base Table (geometry1) Dimensionality, column 2 is Spatial Index Dimensionality, column 3 is Query Window (geometry2) Dimensionality, and column 4 is Query Result." width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="16%" id="d34665e2867">Base Table (geometry1) Dimensionality</th>
                                 <th align="left" valign="bottom" width="16%" id="d34665e2870">Spatial Index Dimensionality</th>
                                 <th align="left" valign="bottom" width="15%" id="d34665e2873">Query Window (geometry2) Dimensionality</th>
                                 <th align="left" valign="bottom" width="53%" id="d34665e2876">Query Result</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="16%" id="d34665e2881" headers="d34665e2867 ">
                                    <p>2-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="16%" headers="d34665e2881 d34665e2870 ">
                                    <p>2-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="15%" headers="d34665e2881 d34665e2873 ">
                                    <p>2-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="53%" headers="d34665e2881 d34665e2876 ">
                                    <p>Performs a two-dimensional query.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="16%" id="d34665e2894" headers="d34665e2867 ">
                                    <p>2-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="16%" headers="d34665e2894 d34665e2870 ">
                                    <p>2-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="15%" headers="d34665e2894 d34665e2873 ">
                                    <p>3-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="53%" headers="d34665e2894 d34665e2876 ">
                                    <p>Supported if the query window has an appropriate SDO_GTYPE value less than 3008.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="16%" id="d34665e2907" headers="d34665e2867 ">
                                    <p>2-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="16%" headers="d34665e2907 d34665e2870 ">
                                    <p>3-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="15%" headers="d34665e2907 d34665e2873 ">
                                    <p>2-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="53%" headers="d34665e2907 d34665e2876 ">
                                    <p>Not supported: 3D index not permitted on 2D data.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="16%" id="d34665e2920" headers="d34665e2867 ">
                                    <p>2-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="16%" headers="d34665e2920 d34665e2870 ">
                                    <p>3-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="15%" headers="d34665e2920 d34665e2873 ">
                                    <p>3-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="53%" headers="d34665e2920 d34665e2876 ">
                                    <p>Not supported: 3D index not permitted on 2D data.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="16%" id="d34665e2933" headers="d34665e2867 ">
                                    <p>3-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="16%" headers="d34665e2933 d34665e2870 ">
                                    <p>2-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="15%" headers="d34665e2933 d34665e2873 ">
                                    <p>2-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="53%" headers="d34665e2933 d34665e2876 ">
                                    <p>Ignores the third (Z) dimension in each base geometry and performs a two-dimensional query.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="16%" id="d34665e2946" headers="d34665e2867 ">
                                    <p>3-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="16%" headers="d34665e2946 d34665e2870 ">
                                    <p>2-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="15%" headers="d34665e2946 d34665e2873 ">
                                    <p>3-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="53%" headers="d34665e2946 d34665e2876 ">
                                    <p>Supported if the query window has an appropriate SDO_GTYPE value less than 3008.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="16%" id="d34665e2959" headers="d34665e2867 ">
                                    <p>3-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="16%" headers="d34665e2959 d34665e2870 ">
                                    <p>3-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="15%" headers="d34665e2959 d34665e2873 ">
                                    <p>2-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="53%" headers="d34665e2959 d34665e2876 ">
                                    <p>Converts the 2D query window to a 3D window with zero Z values and performs a three-dimensional query.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="16%" id="d34665e2972" headers="d34665e2867 ">
                                    <p>3-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="16%" headers="d34665e2972 d34665e2870 ">
                                    <p>3-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="15%" headers="d34665e2972 d34665e2873 ">
                                    <p>3-dimensional</p>
                                 </td>
                                 <td align="left" valign="top" width="53%" headers="d34665e2972 d34665e2876 ">
                                    <p>Performs a three-dimensional query.</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-34D74D79-6B6A-4827-B418-A05D3F41103D" title="The structures of a spatial layer are used to resolve spatial queries and spatial joins.">Querying Spatial Data</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="props_rev_3"><a id="GUID-D5FC46C1-6A9F-40C5-90A9-449DD93EAF0A" name="GUID-D5FC46C1-6A9F-40C5-90A9-449DD93EAF0A"></a><h4 id="SPATL-GUID-D5FC46C1-6A9F-40C5-90A9-449DD93EAF0A" class="sect4"><span class="enumeration_section">5.2.4 </span>Using Event 54700 to Require a Spatial Index for Spatial Queries
                  </h4>
                  <div>
                     <p><a id="d34665e3044" class="indexterm-anchor"></a>Although a spatial index is recommended for spatial queries, by default is it not required. However, you can require that a spatial index be defined and used for spatial queries by setting event 54700 to the <code class="codeph">level</code> value <code class="codeph">1</code>. You can reset the behavior to the default by setting event 54700 to the <code class="codeph">level</code> value <code class="codeph">0</code> (zero).
                     </p>
                     <p>You can apply the event for the session or system by using the ALTER SESSION or ALTER SYSTEM statement, respectively. For example:</p><pre class="pre codeblock"><code>ALTER SESSION set events '54700 trace name context forever, level 1';</code></pre><p>The possible <code class="codeph">level</code> values are:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>0 (default): Indicates that spatial queries can be performed even when a spatial index is not present on the query candidate geometry column.</p>
                        </li>
                        <li>
                           <p>1: Indicates indicates that spatial queries <span class="bold">must</span> have a spatial index present on the query candidate geometry column.
                           </p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="indexing-querying-spatial-data.html#GUID-34D74D79-6B6A-4827-B418-A05D3F41103D" title="The structures of a spatial layer are used to resolve spatial queries and spatial joins.">Querying Spatial Data</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>