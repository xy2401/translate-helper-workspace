<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="The DBMS_DG package allows applications to notify the primary database or the fast-start failover target database in an Oracle Data Guard broker environment to initiate a fast-start failover when the application encounters a condition that warrants a failover."></meta>
      <meta name="description" content="The DBMS_DG package allows applications to notify the primary database or the fast-start failover target database in an Oracle Data Guard broker environment to initiate a fast-start failover when the application encounters a condition that warrants a failover."></meta>
      <title>DBMS_DG</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="PL/SQL Packages and Types Reference"></meta>
      <meta property="og:description" content="The DBMS_DG package allows applications to notify the primary database or the fast-start failover target database in an Oracle Data Guard broker environment to initiate a fast-start failover when the application encounters a condition that warrants a failover."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="PL/SQL Packages and Types Reference"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-pl-sql-packages-and-types-reference.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-03-25T11:24:34-07:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96430-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="DBMS_DESCRIBE.html" title="Previous" type="text/html"></link>
      <link rel="next" href="DBMS_DIMENSION.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database PL/SQL Packages and Types Reference"></meta>
    <meta name="dcterms.isVersionOf" content="ARPLS"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="DBMS_DESCRIBE.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="DBMS_DIMENSION.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">PL / SQL包和类型参考</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">DBMS_DG</li>
            </ol>
            <a id="GUID-B9D52B3F-F2AD-4800-9D07-7B969B86442A" name="GUID-B9D52B3F-F2AD-4800-9D07-7B969B86442A"></a><a id="ARPLS920"></a><a id="ARPLS920"></a>
            
            <h2 id="ARPLS-GUID-B9D52B3F-F2AD-4800-9D07-7B969B86442A" class="sect2"><span class="enumeration_chapter">58</span> DBMS_DG</h2>
         </header>
         <div class="ind">
            <div>
               <p><code class="codeph">DBMS_DG</code>程序包允许应用程序在Oracle Data Guard代理环境中通知主数据库或快速启动故障转移目标数据库，以在应用程序遇到保证故障转移的条件时启动快速启动故障转移。
               </p>
               <p>本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="DBMS_DG.html#GUID-C786B2E4-6F04-48CD-9E07-C7863182C835" title="Oracle数据库外部运行的应用程序可检测到某些条件，这些条件可能会保证Oracle Data Guard代理执行快速启动故障转移。由于可能的条件范围几乎是无限的，因此应由程序决定哪些条件需要快速启动故障转移。">使用DBMS_DG</a></p>
                  </li>
                  <li>
                     <p><a href="DBMS_DG.html#GUID-CBA5D4CB-7D33-44E8-B86D-59C7B6967564" title="DBMS_DG包以调用者的权限运行，并需要SYSDBA权限。">安全模型</a></p>
                  </li>
                  <li>
                     <p><a href="DBMS_DG.html#GUID-0DEA3CDF-F93F-4F70-9D05-20CA954E7605" title="DBMS_DG包中包含一个子程序INITIATE_FS_FAILOVER过程。">DBMS_DG子程序摘要</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-B9D52B3F-F2AD-4800-9D07-7B969B86442A__GUID-D25A469E-BA01-4503-9028-366FE5E0AFDD">
                  <p class="notep1">也可以看看：</p>
                  <p><a href="../dgbkr/using-data-guard-broker-to-manage-switchovers-failovers.html#DGBKR-GUID-995CED84-BEA1-4675-9C68-B37CB996924F" target="_blank"><span><cite>Oracle Data Guard Broker</cite></span></a></p>
               </div>
            </div><a id="ARPLS66222"></a><a id="ARPLS66222"></a><div class="props_rev_3"><a id="GUID-C786B2E4-6F04-48CD-9E07-C7863182C835" name="GUID-C786B2E4-6F04-48CD-9E07-C7863182C835"></a><h3 id="ARPLS-GUID-C786B2E4-6F04-48CD-9E07-C7863182C835" class="sect3"><span class="enumeration_section">58.1</span>使用DBMS_DG</h3>
               <div>
                  <p>Oracle数据库外部运行的应用程序可检测到某些条件，这些条件可能会保证Oracle Data Guard代理执行快速启动故障转移。由于可能的条件范围几乎是无限的，因此应由程序决定哪些条件需要快速启动故障转移。</p>
                  <div class="section">
                     <p>发生此类情况时，应用程序将调用<code class="codeph">DBMS_DG</code> 。 <code class="codeph">INITIATE_FS_FAILOVER</code>过程，用于警告主<code class="codeph">INITIATE_FS_FAILOVER</code>程序或快速启动故障转移目标备用数据库，应用程序希望立即进行快速启动故障转移。调用该过程的数据库然后通知观察者，只要备用数据库处于有效的快速启动故障转移状态（“观察”并且“同步”或“滞后”，立即启动快速启动故障转移） ）接受故障转移。如果配置未处于有效的快速启动故障转移状态，则<code class="codeph">INITIATE_FS_FAILOVER</code>子程序将返回ORA错误消息（它不会发出异常信号），以通知调用应用程序无法执行快速启动故障转移。
                     </p>
                     <div class="infoboxnote" id="GUID-C786B2E4-6F04-48CD-9E07-C7863182C835__GUID-427B4823-5C34-4E04-B415-C01FFDFD4AAE">
                        <p class="notep1">注意：</p>
                        <p>如果您在多租户容器数据库（CDB）中工作，则<code class="codeph">DBMS_DG</code>中的函数仅在根级别执行。确保您在根级别连接，而不是在单个可插拔数据库（PDB）级别连接。
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="ARPLS73145"></a><a id="ARPLS73145"></a><div class="props_rev_3"><a id="GUID-CBA5D4CB-7D33-44E8-B86D-59C7B6967564" name="GUID-CBA5D4CB-7D33-44E8-B86D-59C7B6967564"></a><h3 id="ARPLS-GUID-CBA5D4CB-7D33-44E8-B86D-59C7B6967564" class="sect3"><span class="enumeration_section">58.2</span> DBMS_DG安全模型</h3>
               <div>
                  <p><code class="codeph">DBMS_DG</code>包以调用者的权限运行，并需要<code class="codeph">SYSDBA</code>权限。
                  </p>
               </div>
            </div><a id="ARPLS66223"></a><a id="ARPLS66224"></a><a id="ARPLS66224"></a><a id="ARPLS66223"></a><div class="props_rev_3"><a id="GUID-0DEA3CDF-F93F-4F70-9D05-20CA954E7605" name="GUID-0DEA3CDF-F93F-4F70-9D05-20CA954E7605"></a><h3 id="ARPLS-GUID-0DEA3CDF-F93F-4F70-9D05-20CA954E7605" class="sect3"><span class="enumeration_section">58.3</span> DBMS_DG子程序摘要</h3>
               <div>
                  <p><code class="codeph">DBMS_DG</code>包中包含一个子程序<code class="codeph">INITIATE_FS_FAILOVER</code>过程。
                  </p>
                  <div class="tblformal" id="GUID-0DEA3CDF-F93F-4F70-9D05-20CA954E7605__GUID-ADD07D8B-B42D-47AE-9A22-33ECB6B6C185">
                     <p class="titleintable">表58-1 DBMS_DG包子程序</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_DG包子程序" width="100%" border="1" summary="Summary of the procedures in the DBMS_DG Subprogram." frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="31%" id="d407971e444">子程序</th>
                              <th align="left" valign="bottom" width="69%" id="d407971e447">描述</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="31%" id="d407971e452" headers="d407971e444 ">
                                 <p><a href="DBMS_DG.html#GUID-7E393767-6595-43EB-9FEE-B138B2DEA8ED" title="使用此过程指定条件字符串，当应用程序遇到该条件字符串时，允许应用程序请求调用快速启动故障转移。">INITIATE_FS_FAILOVER过程</a></p>
                              </td>
                              <td align="left" valign="top" width="69%" headers="d407971e452 d407971e447 ">
                                 <p>允许应用程序通知主要或快速启动故障转移目标备用数据库，当应用程序遇到保证故障转移的条件时，需要快速启动故障转移。只有在连接到主数据库或快速启动故障转移备用数据库时才能调用此过程。</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
               </div><a id="ARPLS66225"></a><a id="ARPLS66226"></a><a id="ARPLS66227"></a><a id="ARPLS66226"></a><a id="ARPLS66227"></a><a id="ARPLS66225"></a><div class="props_rev_3"><a id="GUID-7E393767-6595-43EB-9FEE-B138B2DEA8ED" name="GUID-7E393767-6595-43EB-9FEE-B138B2DEA8ED"></a><h4 id="ARPLS-GUID-7E393767-6595-43EB-9FEE-B138B2DEA8ED" class="sect4"><span class="enumeration_section">58.3.1</span> INITIATE_FS_FAILOVER过程</h4>
                  <div>
                     <p>使用此过程指定条件字符串，当应用程序遇到该条件字符串时，允许应用程序请求调用快速启动故障转移。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-7E393767-6595-43EB-9FEE-B138B2DEA8ED__GUID-615D81CF-B62A-474E-9905-5EC2D0844ED9">句法</p><pre class="oac_no_warn" dir="ltr">DBMS_DG.INITIATE_FS_FAILOVER（condstr IN VARCHAR2）RETURN BINARY_INTEGER;</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-7E393767-6595-43EB-9FEE-B138B2DEA8ED__GUID-068A887F-D523-493C-AB43-7B82F048A6C7">参数</p>
                        <div class="tblformal" id="GUID-7E393767-6595-43EB-9FEE-B138B2DEA8ED__GUID-FDF74A29-7A04-4033-A520-94FBBD345CA8">
                           <p class="titleintable">表58-2 INITIATE_FS_FAILOVER过程参数</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="INITIATE_FS_FAILOVER过程参数" width="100%" border="1" summary="Parameters for the DBMS_DG.INITIATE_FS_FAILOVER procedure" frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="31%" id="d407971e577">参数</th>
                                    <th align="left" valign="bottom" width="69%" id="d407971e580">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d407971e585" headers="d407971e577 ">
                                       <p>condstr</p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d407971e585 d407971e580 ">
                                       <p>指定应为其请求快速启动故障转移的条件字符串。如果未提供条件字符串参数，则将在代理日志文件中以及调用该过程的数据库的数据库警报日志中记录默认字符串“Application Failover Requested”。</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-7E393767-6595-43EB-9FEE-B138B2DEA8ED__GUID-22742070-222F-41E2-AA53-9A463352D76F">使用说明</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>此过程返回二进制整数。</p>
                           </li>
                           <li>
                              <p>查询<code class="codeph">V$FS_FAILOVER_STATS</code>视图以查看上次快速启动故障转移的时间及其执行的原因。
                              </p>
                           </li>
                           <li>
                              <p>只有在连接到主数据库或快速启动故障转移备用数据库时才能调用此过程。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-7E393767-6595-43EB-9FEE-B138B2DEA8ED__GUID-C158EE8A-C7F6-4A5C-AE59-451E56171B57">错误</p>
                        <div class="tblformal" id="GUID-7E393767-6595-43EB-9FEE-B138B2DEA8ED__GUID-D32B1CD7-259E-4BF6-BB14-364A822CC9B6">
                           <p class="titleintable">表58-3 INITIATE_FS_FAILOVER过程错误</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="INITIATE_FS_FAILOVER过程错误" width="100%" border="1" summary="Errors returned by the DBMS_DG.INITIATE_FS_FAILOVER procedure." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="41%" id="d407971e620">错误</th>
                                    <th align="left" valign="bottom" width="59%" id="d407971e623">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="41%" id="d407971e628" headers="d407971e620 ">
                                       <p><code class="codeph">ORA-00000：正常，成功完成</code></p>
                                    </td>
                                    <td align="left" valign="top" width="59%" headers="d407971e628 d407971e623 ">
                                       <p>启动快速启动故障转移的请求已发布给观察者。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="41%" id="d407971e636" headers="d407971e620 ">
                                       <p><code class="codeph">ORA-16646：禁用快速启动故障转移</code></p>
                                    </td>
                                    <td align="left" valign="top" width="59%" headers="d407971e636 d407971e623 ">
                                       <p>代理配置不存在或尚未启用快速启动故障转移。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="41%" id="d407971e644" headers="d407971e620 ">
                                       <p><code class="codeph">ORA-16666：无法在旁观者备用数据库上启动快速启动故障转移</code></p>
                                    </td>
                                    <td align="left" valign="top" width="59%" headers="d407971e644 d407971e623 ">
                                       <p>在旁观者备用数据库上调用了<code class="codeph">DBMS_DG.INITIATE_FS_FAILOVER</code> 。也就是说，它未在主要或快速启动故障转移目标备用数据库上调用。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="41%" id="d407971e654" headers="d407971e620 ">
                                       <p><code class="codeph">ORA-16817：不同步的快速启动故障转移配置</code></p>
                                    </td>
                                    <td align="left" valign="top" width="59%" headers="d407971e654 d407971e623 ">
                                       <p>当配置未同步时，在最大可用快速启动故障转移配置中调用<code class="codeph">DBMS_DG.INITIATE_FS_FAILOVER</code> 。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="41%" id="d407971e664" headers="d407971e620 ">
                                       <p><code class="codeph">ORA-16819：快速启动故障转移观察器未启动</code></p>
                                    </td>
                                    <td align="left" valign="top" width="59%" headers="d407971e664 d407971e623 ">
                                       <p>调用了<code class="codeph">DBMS_DG.INITIATE_FS_FAILOVER</code> ，但尚未启动观察者。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="41%" id="d407971e674" headers="d407971e620 ">
                                       <p><code class="codeph">ORA-16820：快速启动故障转移观察器不再观察此数据库</code></p>
                                    </td>
                                    <td align="left" valign="top" width="59%" headers="d407971e674 d407971e623 ">
                                       <p>调用了<code class="codeph">DBMS_DG.INITIATE_FS_FAILOVER</code> ，但配置检测到观察者可能没有运行。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="41%" id="d407971e684" headers="d407971e620 ">
                                       <p><code class="codeph">ORA-16829：滞后快速启动故障转移配置</code></p>
                                    </td>
                                    <td align="left" valign="top" width="59%" headers="d407971e684 d407971e623 ">
                                       <p>当配置不在用户指定的重做延迟限制内时，在最高性能快速启动故障转移配置中调用<code class="codeph">DBMS_DG.INITIATE_FS_FAILOVER</code> 。
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-7E393767-6595-43EB-9FEE-B138B2DEA8ED__GUID-06328762-9F0E-4AA1-9C7F-80BEBA66FB31">例</p>
                        <p>在此示例中，程序尝试在禁用快速启动故障转移时启动快速启动故障转移。要使用此示例，请以<code class="codeph">SYS</code>用户<code class="codeph">SYDDBA</code>连接<code class="codeph">SYDDBA</code>权限。
                        </p><pre class="oac_no_warn" dir="ltr">在serverre status整数上设置serveroutput;开始状态：= dbms_dg.initiate_fs_failover（''Failover Requested''）; dbms_output.put_line（''禁用快速启动故障转移：预期状态= ORA-16646''）; dbms_output.put_line（''实际状态= ORA-''||状态）;结束; / 出口;</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>