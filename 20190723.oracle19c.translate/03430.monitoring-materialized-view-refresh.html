<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="This chapter describes how to use refresh statistics to monitor the performance of materialized view refresh operations."></meta>
      <meta name="description" content="This chapter describes how to use refresh statistics to monitor the performance of materialized view refresh operations."></meta>
      <title>监视物化视图刷新操作</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Data Warehousing Guide"></meta>
      <meta property="og:description" content="This chapter describes how to use refresh statistics to monitor the performance of materialized view refresh operations."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Data Warehousing Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-data-warehousing-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T00:20:13-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2001, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96243-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="synchronous-refresh.html" title="Previous" type="text/html"></link>
      <link rel="next" href="dimensions.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Data Warehousing Guide"></meta>
    <meta name="dcterms.isVersionOf" content="DWHSG"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="synchronous-refresh.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="dimensions.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据仓库指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-optimizing-dw.html" property="item" typeof="WebPage"><span property="name">优化数据仓库</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">监视物化视图刷新操作</li>
            </ol>
            <a id="GUID-6AD8879A-0BE5-466E-8D19-1D076C5DDFFB" name="GUID-6AD8879A-0BE5-466E-8D19-1D076C5DDFFB"></a>
            
            <h2 id="DWHSG-GUID-6AD8879A-0BE5-466E-8D19-1D076C5DDFFB" class="sect2"><span class="enumeration_chapter">9</span>监控物化视图刷新操作</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍如何使用刷新统计信息来监视实例化视图刷新操作的性能。</p>
               <p></p>
               <p>本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="monitoring-materialized-view-refresh.html#GUID-F6DBC9A1-7C48-4653-9B52-27C0CCC2D2EA" title="Oracle数据库收集并存储有关物化视图刷新操作的统计信息。可以使用数据字典视图访问这些统计信息">关于物化视图刷新统计信息</a></p>
                  </li>
                  <li>
                     <p><a href="monitoring-materialized-view-refresh.html#GUID-D5FD6B4A-D211-4EB6-890A-6BC5FCC2C73E" title="Oracle数据库根据定义的数据库设置管理物化视图刷新统计信息的收集和保留。默认情况下，数据库收集并存储有关整个数据库的物化视图刷新操作的基本统计信息。">管理物化视图刷新统计信息概述</a></p>
                  </li>
                  <li>
                     <p><a href="monitoring-materialized-view-refresh.html#GUID-AA9F1365-AC7D-4A35-B6B9-95036DDF6597" title="Oracle数据库将物化视图刷新统计信息存储在数据字典中。设置实例化视图刷新的集合级别可控制收集的刷新统计信息的详细级别。">关于存储物化视图刷新统计信息的数据字典视图</a></p>
                  </li>
                  <li>
                     <p><a href="monitoring-materialized-view-refresh.html#GUID-F06DFCF7-BC77-4A63-9A27-410F36D9152D" title="Oracle数据库收集有关物化视图刷新操作的基本统计信息。这些统计信息存储在数据字典中，可用于分析物化视图刷新操作的性能。">收集物化视图刷新统计信息</a></p>
                  </li>
                  <li>
                     <p><a href="monitoring-materialized-view-refresh.html#GUID-2504FDE4-EE8E-492A-ADA5-15162A909AD9" title="Oracle数据库将收集的物化视图刷新统计信息存储在保留期指定的时间段内。">保留物化视图刷新统计信息</a></p>
                  </li>
                  <li>
                     <p><a href="monitoring-materialized-view-refresh.html#GUID-D4D01309-4ACA-426B-8F33-75E9FB8DF838" title="数据字典视图存储管理物化视图刷新统计信息的默认设置和物化视图特定设置。">查看物化视图刷新统计信息设置</a></p>
                  </li>
                  <li>
                     <p><a href="monitoring-materialized-view-refresh.html#GUID-B4215657-7526-4C64-AB27-B906EBA28A00" title="DBMS_MVIEW_STATS.PURGE_REFRESH_STATS过程使您可以从数据字典中显式清除早于指定时间段的实例化视图刷新统计信息。">清除物化视图刷新统计信息</a></p>
                  </li>
                  <li>
                     <p><a href="monitoring-materialized-view-refresh.html#GUID-8F9CC2EC-9CFC-4F56-97D5-5EB099BD852A" title="您可以通过查询存储刷新统计信息的数据字典视图来查看物化视图刷新操作的当前和历史统计信息。">查看物化视图刷新统计信息</a></p>
                  </li>
                  <li>
                     <p><a href="monitoring-materialized-view-refresh.html#GUID-D87F8F81-8B93-4D7E-87F5-3BFEAA2A7C06" title="存储在数据字典视图中的物化视图刷新统计信息可用于分析物化视图的刷新性能。">使用刷新统计信息分析物化视图刷新性能</a></p>
                  </li>
               </ul>
            </div>
            <div class="sect2"><a id="GUID-F6DBC9A1-7C48-4653-9B52-27C0CCC2D2EA" name="GUID-F6DBC9A1-7C48-4653-9B52-27C0CCC2D2EA"></a><h3 id="DWHSG-GUID-F6DBC9A1-7C48-4653-9B52-27C0CCC2D2EA" class="sect3"><span class="enumeration_section">9.1</span>关于物化视图刷新统计信息</h3>
               <div>
                  <p>Oracle数据库收集并存储有关物化视图刷新操作的统计信息。可以使用数据字典视图访问这些统计信息</p>
                  <p>当前和历史物化视图刷新操作的统计信息存储在数据库中。通过历史物化视图刷新统计信息，您可以了解和分析数据库中物化视图刷新性能。可以以不同的粒度级别收集刷新统计信息。</p>
                  <p>维护物化视图刷新统计信息提供以下内容：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>物化视图刷新操作的报告功能</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>显示物化视图刷新操作的当前和历史统计信息</p>
                           </li>
                           <li>
                              <p>显示实际刷新执行时间的统计信息</p>
                           </li>
                           <li>
                              <p>使用实际刷新执行时间的统计信息跟踪物化视图刷新的性能</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>物化视图刷新性能的诊断功能</p>
                        <p>详细的当前和历史统计信息可用于快速分析物化视图刷新操作的性能。例如，如果物化视图需要很长时间才能刷新，则可以使用刷新统计信息来确定减速是由于系统负载增加还是变化数据变化很大。</p>
                     </li>
                  </ul>
               </div>
            </div>
            <div class="sect2"><a id="GUID-D5FD6B4A-D211-4EB6-890A-6BC5FCC2C73E" name="GUID-D5FD6B4A-D211-4EB6-890A-6BC5FCC2C73E"></a><h3 id="DWHSG-GUID-D5FD6B4A-D211-4EB6-890A-6BC5FCC2C73E" class="sect3"><span class="enumeration_section">9.2</span>管理物化视图刷新统计信息概述</h3>
               <div>
                  <p>Oracle数据库根据定义的数据库设置管理物化视图刷新统计信息的收集和保留。默认情况下，数据库收集并存储有关整个数据库的物化视图刷新操作的基本统计信息。</p>
                  <p>管理物化视图刷新统计信息包含控制以下内容的定义策略：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>物化视图刷新统计信息的详细程度</p>
                     </li>
                     <li>
                        <p>物化视图刷新统计信息的保留期</p>
                     </li>
                  </ul>
                  <p>使用以下技术定义管理物化视图刷新统计信息的策略：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>定义适用于整个数据库的默认设置</p>
                        <p><code class="codeph">DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT</code>过程定义了管理整个数据库的物化视图刷新统计信息的收集和保留的默认设置。
                        </p>
                     </li>
                     <li>
                        <p>为各个物化视图定义收集和保留策略</p>
                        <p><code class="codeph">DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS</code>过程通过管理各个物化视图中级别的统计信息的收集和保留，对物化视图刷新统计信息提供更细粒度的控制。在物化视图级别进行的设置会覆盖数据库级别的设置。
                        </p>
                     </li>
                  </ul>
                  <div class="infoboxnote" id="GUID-D5FD6B4A-D211-4EB6-890A-6BC5FCC2C73E__GUID-D980E6E9-9014-47BC-9C79-B4DAE1FDD5BD">
                     <p class="notep1">注意：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-F06DFCF7-BC77-4A63-9A27-410F36D9152D" title="Oracle数据库收集有关物化视图刷新操作的基本统计信息。这些统计信息存储在数据字典中，可用于分析物化视图刷新操作的性能。">收集物化视图刷新统计信息</a></p>
                        </li>
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-2504FDE4-EE8E-492A-ADA5-15162A909AD9" title="Oracle数据库将收集的物化视图刷新统计信息存储在保留期指定的时间段内。">保留物化视图刷新统计信息</a></p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-AA9F1365-AC7D-4A35-B6B9-95036DDF6597" name="GUID-AA9F1365-AC7D-4A35-B6B9-95036DDF6597"></a><h3 id="DWHSG-GUID-AA9F1365-AC7D-4A35-B6B9-95036DDF6597" class="sect3"><span class="enumeration_section">9.3</span>关于存储物化视图刷新统计信息的数据字典视图</h3>
               <div>
                  <p>Oracle数据库将物化视图刷新统计信息存储在数据字典中。设置实例化视图刷新的集合级别可控制收集的刷新统计信息的详细级别。</p>
                  <p>使用唯一的刷新ID标识每个物化视图刷新操作。单个刷新操作可以刷新多个物化视图。例如，当使用<code class="codeph">REFRESH_DEPENDENT</code>过程刷新单个实例化视图时，所有依赖于指定实例化视图的实例化视图也将作为相同刷新操作的一部分进行刷新。因此，作为此操作的一部分刷新的所有物化视图将具有相同的刷新ID。</p>
                  <div class="tblformal" id="GUID-AA9F1365-AC7D-4A35-B6B9-95036DDF6597__GUID-D09AE281-E251-46B9-9D9A-7C544D6FDB8D">
                     <p class="titleintable">表9-1存储物化视图刷新统计信息的数据字典视图</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="存储物化视图刷新统计信息的数据字典视图" width="100%" border="1" summary="This table describes the data dictionary views that store statistics on materialized view refresh operations" frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="20%" id="d39969e261">查看名称</th>
                              <th align="left" valign="bottom" width="20%" id="d39969e263">描述</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d39969e267" headers="d39969e261 "><code class="codeph">DBA_MVREF_STATS</code></td>
                              <td align="left" valign="top" width="20%" headers="d39969e267 d39969e263 ">
                                 <p>存储物化视图刷新的基本统计信息，例如刷新操作的刷新ID和基本时序统计信息。</p>
                                 <p>此视图包含有关为其收集刷新统计信息的每个物化视图的以下信息：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>物化视图的名称</p>
                                    </li>
                                    <li>
                                       <p>使用刷新方法</p>
                                    </li>
                                    <li>
                                       <p>刷新操作开始和结束时物化视图中的行数</p>
                                    </li>
                                    <li>
                                       <p>用于刷新实例化视图的步骤数</p>
                                    </li>
                                 </ul>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d39969e289" headers="d39969e261 "><code class="codeph">DBA_MVREF_RUN_STATS</code></td>
                              <td align="left" valign="top" width="20%" headers="d39969e289 d39969e263 ">
                                 <p>存储有关每个物化视图刷新操作的详细信息，包括以下内容：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>运行刷新操作时指定的参数，例如物化视图列表，刷新方法，清除选项等。</p>
                                    </li>
                                    <li>
                                       <p>刷新操作中刷新的实例化视图数。</p>
                                    </li>
                                    <li>
                                       <p>刷新操作的详细时序统计，包括开始时间，结束时间和经过时间。</p>
                                    </li>
                                 </ul>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d39969e306" headers="d39969e261 "><code class="codeph">DBA_MVREF_CHANGE_STATS</code></td>
                              <td align="left" valign="top" width="20%" headers="d39969e306 d39969e263 ">
                                 <p>包含与实例化视图刷新操作关联的基表的更改数据装入信息。</p>
                                 <p>详细信息包括基表名称，物化视图名称，插入的行数，更新的行数，删除的行数，直接装载插入的数量，PMOP详细信息以及刷新操作开始时的行数。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d39969e315" headers="d39969e261 "><code class="codeph">DBA_MVREF_STMT_STATS</code></td>
                              <td align="left" valign="top" width="20%" headers="d39969e315 d39969e263 ">
                                 <p>包含与每个刷新语句相关的信息，该刷新语句是单个物化视图刷新操作的一部分。</p>
                                 <p>这包括物化视图名称，刷新ID，刷新语句，刷新语句的SQLID以及语句的执行计划等信息。</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <div class="infoboxnotealso" id="GUID-AA9F1365-AC7D-4A35-B6B9-95036DDF6597__GUID-4F2CA3CF-2C7E-4138-BF5B-89B6F6AD45B1">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="../refrn/index.html" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-F06DFCF7-BC77-4A63-9A27-410F36D9152D" name="GUID-F06DFCF7-BC77-4A63-9A27-410F36D9152D"></a><h3 id="DWHSG-GUID-F06DFCF7-BC77-4A63-9A27-410F36D9152D" class="sect3"><span class="enumeration_section">9.4</span>收集物化视图刷新统计信息</h3>
               <div>
                  <p>Oracle数据库收集有关物化视图刷新操作的基本统计信息。这些统计信息存储在数据字典中，可用于分析物化视图刷新操作的性能。</p>
                  <div class="infoboxnotealso" id="GUID-F06DFCF7-BC77-4A63-9A27-410F36D9152D__GUID-904D4E07-36F0-440C-98DD-2331BF920BB6">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-EBEAEDE0-6DE1-477C-B140-7C6F7F594271" title="默认情况下，Oracle数据库会收集所有物化视图刷新操作的基本刷新统计信息。">关于收集物化视图刷新统计信息</a></p>
                        </li>
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-D758F3E6-EA01-4F01-BAD9-1D5A0AFD7CB2" title="DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT过程使您可以设置用于管理数据库级别的物化视图刷新统计信息收集的默认值。">指定收集物化视图刷新统计信息的默认设置</a></p>
                        </li>
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-2EF89116-0920-4F5A-8E4B-14C0F7D8B2FD" title="您可以使用DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS过程修改管理物化视图刷新统计信息收集的设置。">修改物化视图刷新统计信息的收集级别</a></p>
                        </li>
                     </ul>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-EBEAEDE0-6DE1-477C-B140-7C6F7F594271" name="GUID-EBEAEDE0-6DE1-477C-B140-7C6F7F594271"></a><h4 id="DWHSG-GUID-EBEAEDE0-6DE1-477C-B140-7C6F7F594271" class="sect4"><span class="enumeration_section">9.4.1</span>关于收集物化视图刷新统计信息</h4>
                  <div>
                     <p>默认情况下，Oracle数据库会收集所有物化视图刷新操作的基本刷新统计信息。</p>
                     <p>通过Oracle数据库，您可以控制收集物化视图刷新统计信息的粒度和级别。可以为数据库中的所有物化视图或特定的物化视图集收集统计信息。如果您只想监视数据库中的某些物化视图，则可以在物化视图级别收集统计信息。收集一组选定的物化视图的刷新统计信息非常有用，因为物化视图的刷新模式可能差异很大。</p>
                     <p>集合级别定义数据库为实例化视图刷新操作收集的统计信息量。您可以收集基本统计信息或更详细的信息，例如使用的参数和在物化视图刷新操作期间运行的SQL语句。</p>
                     <p>使用<code class="codeph">DBMS_MVIEW_STATS</code>包中的过程设置<code class="codeph">COLLECTION_LEVEL</code>参数，该参数指定<code class="codeph">DBMS_MVIEW_STATS</code>化视图刷新统计信息的集合级别。可以为<code class="codeph">COLLECTION_LEVEL</code>参数设置的值为：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>没有</p>
                           <p>没有为物化视图刷新操作收集统计信息。</p>
                        </li>
                        <li>
                           <p>典型</p>
                           <p>仅为物化视图刷新操作收集基本刷新统计信息。这是默认设置。</p>
                        </li>
                        <li>
                           <p>高级</p>
                           <p>将收集详细统计信息，包括刷新操作中使用的参数和运行的SQL语句，以进行物化视图刷新操作。</p>
                        </li>
                     </ul>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-D758F3E6-EA01-4F01-BAD9-1D5A0AFD7CB2" name="GUID-D758F3E6-EA01-4F01-BAD9-1D5A0AFD7CB2"></a><h4 id="DWHSG-GUID-D758F3E6-EA01-4F01-BAD9-1D5A0AFD7CB2" class="sect4"><span class="enumeration_section">9.4.2</span>指定收集物化视图刷新统计信息的默认设置</h4>
                  <div>
                     <p><code class="codeph">DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT</code>过程使您可以设置用于管理数据库级别的物化视图刷新统计信息收集的默认值。
                     </p>
                     <div class="section">
                        <p>您可以通过在单个物化视图级别指定不同的设置来覆盖系统默认值。未覆盖默认设置的物化视图将使用系统默认设置。</p>
                        <p>默认情况下，Oracle数据库收集并存储有关整个数据库的物化视图刷新操作的基本统计信息。您可以通过修改统计信息收集级别来禁用统计信息收集或更改默认设置。</p>
                        <p>要在数据库级别设置实例化视图刷新统计信息的默认收集级别：</p>
                     </div>
                     <!-- class="section" -->
                     <ul>
                        <li><span>运行<code class="codeph">DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT</code>过程并设置<code class="codeph">COLLECTION_LEVEL</code>参数。</span></li>
                     </ul>
                     <div class="example" id="GUID-D758F3E6-EA01-4F01-BAD9-1D5A0AFD7CB2__GUID-7158C175-C0E3-47BA-B7F3-B6F57DD5196B">
                        <p class="titleinexample">示例9-1设置数据库的物化视图刷新统计信息收集级别</p>
                        <p>此示例将物化视图刷新统计信息的默认集合级别设置为ADVANCED，表示将收集和存储有关物化视图刷新操作的详细统计信息。</p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT（'COLLECTION_LEVEL'，'ADVANCED'）;</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-D758F3E6-EA01-4F01-BAD9-1D5A0AFD7CB2__GUID-78AE67B3-91C9-4231-9180-D6803E79A656">
                        <p class="titleinexample">示例9-2禁用物化视图刷新的统计信息收集</p>
                        <p>此示例将物化视图刷新统计信息的默认集合级别设置为NONE，从而禁用统计信息收集。</p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT（'COLLECTION_LEVEL'，'NONE'）;</code></pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-D758F3E6-EA01-4F01-BAD9-1D5A0AFD7CB2__GUID-5C35513D-94A0-4A24-9493-E593A541108C">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../arpls/DBMS_MVIEW_STATS.html#ARPLS-GUID-D52E7FAD-D01A-478F-9861-2C9CDBCB60FF" target="_blank"><span><cite>Oracle数据库PL / SQL包和类型参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-2EF89116-0920-4F5A-8E4B-14C0F7D8B2FD" name="GUID-2EF89116-0920-4F5A-8E4B-14C0F7D8B2FD"></a><h4 id="DWHSG-GUID-2EF89116-0920-4F5A-8E4B-14C0F7D8B2FD" class="sect4"><span class="enumeration_section">9.4.3</span>修改物化视图刷新统计信息的收集级别</h4>
                  <div>
                     <p>您可以使用<code class="codeph">DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS</code>过程修改管理物化视图刷新统计信息收集的设置。
                     </p>
                     <div class="section">
                        <p>您可以修改整个数据库或一个或多个物化视图的统计信息收集行为。新的集合设置将覆盖在数据库级别进行的默认设置或为指定的物化视图进行的先前设置。例如， <code class="codeph">COLLECTION_LEVEL</code>的系统默认设置为数据库的TYPICAL。然后，使用<code class="codeph">DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS</code>过程将物化视图<code class="codeph">MV1</code>和<code class="codeph">MV2</code>的集合级别修改为ADVANCED。数据库中剩余的物化视图将继续使用TYPICAL集合级别。
                        </p>
                        <p>要在数据库级别或物化视图级别修改实例化视图刷新统计信息的集合级别，请执行以下操作：</p>
                     </div>
                     <!-- class="section" -->
                     <ul>
                        <li><span>运行<code class="codeph">DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS</code>过程并将<code class="codeph">COLLECTION_LEVEL</code>参数设置为所需的值</span></li>
                     </ul>
                     <div class="example" id="GUID-2EF89116-0920-4F5A-8E4B-14C0F7D8B2FD__GUID-8F78DA4C-B47F-48FA-B30D-4A659C5D7325">
                        <p class="titleinexample">示例9-3设置整个数据库的物化视图统计信息收集级别</p>
                        <p>以下示例将数据库级别的物化视图刷新统计信息的集合级别修改为TYPICAL。指定<code class="codeph">NULL</code>而不是一个或多个物化视图名称表示此设置适用于整个数据库。
                        </p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS（NULL，'TYPICAL'）;</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-2EF89116-0920-4F5A-8E4B-14C0F7D8B2FD__GUID-D7539A66-65BD-4580-842D-57F0C077C113">
                        <p class="titleinexample">示例9-4为多个物化视图设置物化视图统计信息收集级别</p>
                        <p>此示例将<code class="codeph">SH</code>模式中的物化视图<code class="codeph">SALES_2013_MV</code>和<code class="codeph">SALES_2014_MV</code>的集合级别设置为ADVANCED。保留期设置为60天。此设置将覆盖可能已在数据库级别指定的任何默认设置。
                        </p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS（'SH.SALES_2013_MV，SH.SALES_2014_MV'，'ADVANCED'，60）;</code></pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-2EF89116-0920-4F5A-8E4B-14C0F7D8B2FD__GUID-78A9708F-8401-4818-B08D-72BE55B870BA">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../arpls/DBMS_MVIEW_STATS.html#ARPLS-GUID-5935488C-CB7F-4C92-A50F-949461F0281D" target="_blank"><span><cite>Oracle数据库PL / SQL包和类型参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-2504FDE4-EE8E-492A-ADA5-15162A909AD9" name="GUID-2504FDE4-EE8E-492A-ADA5-15162A909AD9"></a><h3 id="DWHSG-GUID-2504FDE4-EE8E-492A-ADA5-15162A909AD9" class="sect3"><span class="enumeration_section">9.5</span>保留物化视图刷新统计信息</h3>
               <div>
                  <p>Oracle数据库将收集的物化视图刷新统计信息存储在保留期指定的时间段内。</p>
                  <div class="infoboxnotealso" id="GUID-2504FDE4-EE8E-492A-ADA5-15162A909AD9__GUID-CC503E0F-E4B9-4825-9E48-9081865255A3">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-AF606D42-C6DC-4806-8DF3-C8ED3CF3AE04" title="保留期定义物化视图刷新统计信息存储在数据字典中的持续时间（以天为单位）。达到保留期后，将自动清除收集的统计信息。">关于保留物化视图刷新统计信息</a></p>
                        </li>
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-BB9A5914-BEAD-439A-8E53-A8D3F6CC80F9" title="DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT过程设置用于管理数据库级别的实例化视图刷新统计信息保留的缺省值。">指定物化视图刷新统计信息的默认保留期</a></p>
                        </li>
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-90DC0F87-E772-42E8-9EAB-028B862A4022" title="DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS过程使您可以修改为物化视图刷新统计信息设置的保留期。">修改物化视图刷新统计信息的保留期</a></p>
                        </li>
                     </ul>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-AF606D42-C6DC-4806-8DF3-C8ED3CF3AE04" name="GUID-AF606D42-C6DC-4806-8DF3-C8ED3CF3AE04"></a><h4 id="DWHSG-GUID-AF606D42-C6DC-4806-8DF3-C8ED3CF3AE04" class="sect4"><span class="enumeration_section">9.5.1</span>关于保留物化视图刷新统计信息</h4>
                  <div>
                     <p>保留期定义物化视图刷新统计信息存储在数据字典中的持续时间（以天为单位）。达到保留期后，将自动清除收集的统计信息。</p>
                     <p>物化视图刷新统计信息的保留期可以在数据库级别或物化视图级别设置。<code class="codeph">DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT</code>或<code class="codeph">DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS</code>的<code class="codeph">RETENTION_PERIOD</code>参数使您可以指定必须在数据字典中保留<code class="codeph">DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS</code>化视图刷新统计信息的持续时间。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-BB9A5914-BEAD-439A-8E53-A8D3F6CC80F9" name="GUID-BB9A5914-BEAD-439A-8E53-A8D3F6CC80F9"></a><h4 id="DWHSG-GUID-BB9A5914-BEAD-439A-8E53-A8D3F6CC80F9" class="sect4"><span class="enumeration_section">9.5.2</span>指定物化视图刷新统计信息的默认保留期限</h4>
                  <div>
                     <p><code class="codeph">DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT</code>过程设置用于管理数据库级别的<code class="codeph">DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT</code>化视图刷新统计信息保留的缺省值。
                     </p>
                     <div class="section">
                        <p>默认情况下，Oracle数据库会在收集日期后的365天内保留物化视图刷新统计信息。达到保留期后，将从数据字典中清除统计信息。您可以通过在单个物化视图级别指定不同的设置来覆盖系统默认设置。未覆盖默认设置的物化视图将继续使用系统默认设置。</p>
                        <p>您可以通过将保留期设置为-1来指定永远不能从数据库中清除刷新统计信息。</p>
                        <p>要为整个数据库指定新的默认保留期：</p>
                     </div>
                     <!-- class="section" -->
                     <ul>
                        <li><span>将<code class="codeph">DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT</code>过程的<code class="codeph">RETENTION_PERIOD</code>参数设置为所需的天数</span></li>
                     </ul>
                     <div class="example" id="GUID-BB9A5914-BEAD-439A-8E53-A8D3F6CC80F9__GUID-FE17E445-2519-4725-9370-7302CD275888">
                        <p class="titleinexample">示例9-5设置物化视图刷新统计信息的保留期限</p>
                        <p>此示例将整个数据库的物化视图刷新统计信息的默认保留期设置为60天。</p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT（'RETENTION_PERIOD'，60）;</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-BB9A5914-BEAD-439A-8E53-A8D3F6CC80F9__GUID-AE6BFFBF-146B-4161-97C1-A237B9A93C08">
                        <p class="titleinexample">示例9-6防止清除物化视图刷新统计信息</p>
                        <p>此示例将实例化视图刷新统计信息的保留期设置为-1，从而确保在达到默认保留期时不会自动清除刷新统计信息。使用此设置时，需要使用<code class="codeph">DBMS_MVIEW_STATS.PURGE_REFRESH_STATS</code>过程从数据字典中显式清除刷新统计信息。
                        </p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT（'RETENTION_PERIOD'， -  1）;</code></pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-BB9A5914-BEAD-439A-8E53-A8D3F6CC80F9__GUID-C1610700-3801-4B82-B776-588AAE24033C">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../arpls/DBMS_MVIEW_STATS.html#ARPLS-GUID-D52E7FAD-D01A-478F-9861-2C9CDBCB60FF" target="_blank"><span><cite>Oracle数据库PL / SQL包和类型参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-90DC0F87-E772-42E8-9EAB-028B862A4022" name="GUID-90DC0F87-E772-42E8-9EAB-028B862A4022"></a><h4 id="DWHSG-GUID-90DC0F87-E772-42E8-9EAB-028B862A4022" class="sect4"><span class="enumeration_section">9.5.3</span>修改物化视图刷新统计信息的保留期限</h4>
                  <div>
                     <p><code class="codeph">DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS</code>过程使您可以修改为物化视图刷新统计信息设置的保留期。
                     </p>
                     <div class="section">
                        <p>您可以修改整个数据库或一个或多个物化视图的保留期。仅为特定实例化视图修改保留期时，数据库中的其余实例化视图将继续使用其现有保留期。</p>
                        <p>假设您的系统默认设置是收集基本的物化视图刷新统计信息并将其保留60天。但是，对于一组特定的物化视图，您希望收集详细的统计信息并保留这些统计信息45天。在这种情况下，对于特定的物化视图集，可以将<code class="codeph">COLLECTION_LEVEL</code>设置为ADVANCED，将<code class="codeph">RETENTION_PERIOD</code>为45。
                        </p>
                        <p>要在物理化视图级别修改物化视图刷新统计信息的保留期，请执行以下操作：</p>
                     </div>
                     <!-- class="section" -->
                     <ul>
                        <li><span>运行<code class="codeph">DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS</code>过程并将<code class="codeph">RETENTION_PERIOD</code>参数设置为所需的值</span></li>
                     </ul>
                     <div class="example" id="GUID-90DC0F87-E772-42E8-9EAB-028B862A4022__GUID-A3231911-A53A-4D26-8D3D-8686E27B23BD">
                        <p class="titleinexample">示例9-7使用保留期的默认物化视图刷新统计信息设置</p>
                        <p>此示例将<code class="codeph">SH</code>模式中的物化视图<code class="codeph">SALES_MV</code>的集合级别设置为TYPICAL。由于NULL用于保留期，因此保留期的系统范围默认设置用于此物化视图。
                        </p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS（'SH.SALES_MV'，'TYPICAL'，NULL）;</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-90DC0F87-E772-42E8-9EAB-028B862A4022__GUID-B8DD3B77-C0BF-4E6D-8B37-54CE21079544">
                        <p class="titleinexample">示例9-8设置实体化视图的保留期</p>
                        <p>此示例将<code class="codeph">SH.SALES_MV</code>的集合级别设置为ADVANCED，将保留期限设置为45天。这将覆盖为此物化视图设置的现有保留期。
                        </p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS（'SH.SALES_MV'，'ADVANCED'，45）;</code></pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-90DC0F87-E772-42E8-9EAB-028B862A4022__GUID-AA77B255-ABE8-4E8D-A17A-30E3A4976EAD">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../arpls/DBMS_MVIEW_STATS.html#ARPLS-GUID-5935488C-CB7F-4C92-A50F-949461F0281D" target="_blank"><span><cite>Oracle数据库PL / SQL包和类型参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-D4D01309-4ACA-426B-8F33-75E9FB8DF838" name="GUID-D4D01309-4ACA-426B-8F33-75E9FB8DF838"></a><h3 id="DWHSG-GUID-D4D01309-4ACA-426B-8F33-75E9FB8DF838" class="sect3"><span class="enumeration_section">9.6</span>查看物化视图刷新统计设置</h3>
               <div>
                  <p>数据字典视图存储管理物化视图刷新统计信息的默认设置和物化视图特定设置。</p>
                  <div class="section">
                     <p>要查看用于收集和保留实例化视图刷新统计信息的数据库级默认设置：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>查询<code class="codeph">DBA_MVREF_STATS_SYS_DEFAULTS</code>视图中的<code class="codeph">parameter_name</code>和<code class="codeph">value</code>列</p>
                        </li>
                     </ul>
                     <p>要查看一个或多个物化视图的刷新统计信息的集合和保留设置，请执行以下操作：</p>
                  </div>
                  <!-- class="section" -->
                  <ul>
                     <li><span>查询<code class="codeph">parameter_name</code>和<code class="codeph">value</code>中的列<code class="codeph">DBA_MVREF_STATS_PARAMS</code>使用通过滤波数据视图<code class="codeph">mv_owner</code>和<code class="codeph">mv_name</code>列</span></li>
                  </ul>
                  <div class="example" id="GUID-D4D01309-4ACA-426B-8F33-75E9FB8DF838__GUID-EC5AF9DE-24FF-45BC-804B-27F6431783BB">
                     <p class="titleinexample">示例9-9显示用于管理物化视图刷新统计信息的数据库级缺省设置</p>
                     <p>以下查询显示用于管理物化视图刷新统计信息的数据库级别默认设置：</p><pre class="pre codeblock"><code>SELECT parameter_name，来自DBA_MVREF_STATS_SYS_DEFAULTS的值; PARAMETER_NAME VALUE --------------- -------- COLLECTION_LEVEL TYPICAL RETENTION_PERIOD 45</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-D4D01309-4ACA-426B-8F33-75E9FB8DF838__GUID-B0C54C69-CA6A-465D-A66E-152013CC832A">
                     <p class="titleinexample">示例9-10显示一组物化视图的刷新统计信息设置</p>
                     <p>以下查询显示<code class="codeph">SH</code>架构拥有的所有物化视图的刷新统计信息设置：</p><pre class="pre codeblock"><code>SELECT mv_name，collection_level，retention_period FROM DBA_MVREF_STATS_PARAMS WHERE mv_owner ='SH'; MV_NAME COLLECTION_LEVEL RETENTION_PERIOD -------- ---------------- ----------------- MY_RTMV ADVANCED 60 NEW_SALES_RTMV ADVANCED 45 MY_SUM_SALES_RTMV典型31 SALES_RTMV典型-1 CAL_MONTH_SALES_MV典型45选择5行。
</code></pre></div>
                  <!-- class="example" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-B4215657-7526-4C64-AB27-B906EBA28A00" name="GUID-B4215657-7526-4C64-AB27-B906EBA28A00"></a><h3 id="DWHSG-GUID-B4215657-7526-4C64-AB27-B906EBA28A00" class="sect3"><span class="enumeration_section">9.7</span>清除物化视图刷新统计信息</h3>
               <div>
                  <p><code class="codeph">DBMS_MVIEW_STATS.PURGE_REFRESH_STATS</code>过程使您可以从数据字典中显式清除早于指定时间段的实例化视图刷新统计信息。
                  </p>
                  <div class="section">
                     <p>默认情况下，在指定的保留期后，将从数据字典中删除实例化视图刷新统计信息。根据您的设置，可以对整个数据库或一组指定的物化视图执行清除。您可以使用<code class="codeph">DBMS_MVIEW_STATS.PURGE_REFRESH_STATS</code>过程显式清除早于指定时间的刷新统计信息，而不更改设置的保留期。显式清除刷新统计信息会覆盖保留期的当前设置，但不会更改设置。
                     </p>
                     <p>要清除存储在数据库中的物化视图刷新统计信息：</p>
                  </div>
                  <!-- class="section" -->
                  <ul>
                     <li class="stepexpand"><span>运行<code class="codeph">DBMS_MVIEW_STATS.PURGE_REFRESH_STATS</code>过程。</span><div>
                           <p>指定必须清除统计信息的物化视图以及必须清除统计信息的持续时间。</p>
                        </div>
                     </li>
                  </ul>
                  <div class="example" id="GUID-B4215657-7526-4C64-AB27-B906EBA28A00__GUID-AD82C52D-3A2B-4941-ACF6-7E7CF216B0FE">
                     <p class="titleinexample">示例9-11清除物化视图的刷新统计信息</p>
                     <p>假设物化视图<code class="codeph">SALES_MV</code>刷新统计信息的保留期为60天。在任何给定时间，都可以获得前60天的刷新统计信息。但是，由于空间限制，您希望清除过去30天的统计信息。使用<code class="codeph">DBMS_MVIEW_STATS.PURGE_REFRESH_STATS</code>过程执行此操作。
                     </p>
                     <p>请注意，为<code class="codeph">SALES_MV</code>设置的保留期保持不变。清洗是一次性操作。
                     </p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.PURGE_REFRESH_STATS（'SH.SALES_MV'，30）;</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-B4215657-7526-4C64-AB27-B906EBA28A00__GUID-2238A186-E776-4CF3-977E-CF35DAF60A0C">
                     <p class="titleinexample">示例9-12清除所有物化视图的刷新统计信息</p>
                     <p>此示例清除数据库中所有实例化视图的超过20天的物化视图刷新统计信息。指定<code class="codeph">NULL</code>而不是一个或多个物化视图表示此设置适用于整个数据库。
                     </p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.PURGE_REFRESH_STATS（NULL，20）;</code></pre></div>
                  <!-- class="example" -->
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-B4215657-7526-4C64-AB27-B906EBA28A00__GUID-2CB525B3-B7CA-47F8-935B-B045401B23DD">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../arpls/DBMS_MVIEW_STATS.html#ARPLS-GUID-3BA6F833-24CA-432D-8B62-56A020606676" target="_blank"><span><cite>Oracle数据库PL / SQL包和类型参考</cite></span></a></p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-8F9CC2EC-9CFC-4F56-97D5-5EB099BD852A" name="GUID-8F9CC2EC-9CFC-4F56-97D5-5EB099BD852A"></a><h3 id="DWHSG-GUID-8F9CC2EC-9CFC-4F56-97D5-5EB099BD852A" class="sect3"><span class="enumeration_section">9.8</span>查看物化视图刷新统计信息</h3>
               <div>
                  <p>您可以通过查询存储刷新统计信息的数据字典视图来查看物化视图刷新操作的当前和历史统计信息。</p>
                  <p>根据集合级别设置，物化视图刷新统计信息存储在以下一个或多个视图中： <code class="codeph">DBA_MVREFS_STATS</code> ， <code class="codeph">DBA_MVREF_RUN_STATS</code> ， <code class="codeph">DBA_MVREF_CHANGE_STATS</code>和<code class="codeph">DBA_MVREF_STMT_STATS</code> 。所有这些视图都有相应的<code class="codeph">USER_</code>版本。视图包含<code class="codeph">REFRESH_ID</code>列，可在需要时用于连接一个或多个视图。
                  </p>
                  <div class="infoboxnotealso" id="GUID-8F9CC2EC-9CFC-4F56-97D5-5EB099BD852A__GUID-76D259BF-9B81-4A13-96C6-79623F32C2AC">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-681103A3-996F-4862-A9D3-2EA8D0269BA4" title="使用DBA_MVREF_STATS视图显示有关实例化视图刷新操作的基本统计信息。">查看物化视图的基本刷新统计信息</a></p>
                        </li>
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-7F2FF444-7FFD-4F2A-8D04-CBE7CD2EB04E" title="DBA_MVREF_RUN_STATS视图存储有关物化视图刷新操作的详细统计信息。当刷新操作影响多个物化视图时，所有受影响的物化视图都可以使用详细的统计信息。">查看每个物化视图刷新操作的详细统计信息</a></p>
                        </li>
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-D3C9BA73-E6DE-4135-AAE9-414103D4C715" title="DBA_MVREF_CHANGE_STATS视图存储物化视图刷新操作的详细更改数据统计信息。这包括刷新的基表，插入的行数，更新的行数，删除的行数以及分区维护操作（PMOP）详细信息。">在物化视图刷新操作期间查看更改数据统计信息</a></p>
                        </li>
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-BD3E19B7-0F73-466D-87A7-7D477D55DBBA" title="查询DBA_MVREF_STMT_STATS视图以显示有关实例化视图刷新操作中使用的所有SQL语句的信息。">查看与物化视图刷新操作关联的SQL语句</a></p>
                        </li>
                     </ul>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-681103A3-996F-4862-A9D3-2EA8D0269BA4" name="GUID-681103A3-996F-4862-A9D3-2EA8D0269BA4"></a><h4 id="DWHSG-GUID-681103A3-996F-4862-A9D3-2EA8D0269BA4" class="sect4"><span class="enumeration_section">9.8.1</span>查看物化视图的基本刷新统计信息</h4>
                  <div>
                     <p>使用<code class="codeph">DBA_MVREF_STATS</code>视图显示有关<code class="codeph">DBA_MVREF_STATS</code>化视图刷新操作的基本统计信息。
                     </p>
                     <div class="section">
                        <p>使用唯一的刷新ID标识每个物化视图刷新操作。 <code class="codeph">DBA_MVREF_STATS</code>视图存储刷新ID，刷新方法，刷新的<code class="codeph">DBA_MVREF_STATS</code>视图的名称，基本执行时间以及刷新操作中的步骤数。
                        </p>
                        <p>要查看实例化视图刷新操作的基本刷新统计信息：</p>
                     </div>
                     <!-- class="section" -->
                     <ul>
                        <li><span>使用所需列的列表查询<code class="codeph">DBA_MVREF_STATS</code>视图，并使用条件过滤所需的数据</span></li>
                     </ul>
                     <div class="example" id="GUID-681103A3-996F-4862-A9D3-2EA8D0269BA4__GUID-12BCEE5D-106E-44C7-921D-F872D0E99B37">
                        <p class="titleinexample">示例9-13显示物化视图刷新操作的基本统计信息</p>
                        <p>以下查询显示<code class="codeph">SH.NEW_SALES_RTMV</code>化视图上的刷新操作的一些刷新统计信息。信息包括刷新方法，刷新时间，刷新操作开始时物化视图中的行数以及刷新操作结束时的行数。
                        </p><pre class="pre codeblock"><code>SELECT refresh_id，refresh_method，elapsed_time，initial_num_rows，final_num_rows FROM dba_mvref_stats WHERE mv_name ='NEW_SALES_RTMV'和mv_owner ='SH'; REFRESH_ID REFRESH_METHOD ELAPSED_TIME INITIAL_NUM_ROWS FINAL_NUM_ROWS ---------- -------------- ------------- -------- -------- ---------------- 49 FAST 0 766 788 61 FAST 1 788 788 81 FAST 1 788 798 3行选择。
</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-681103A3-996F-4862-A9D3-2EA8D0269BA4__GUID-42C5604F-91CE-48C4-A7E1-5F823855A2E3">
                        <p class="titleinexample">示例9-14根据刷新时间显示实体化视图</p>
                        <p>以下示例显示刷新操作耗时超过10分钟的实例化视图的名称。由于<code class="codeph">elapsed_time</code>以秒为单位指定，因此我们在查询中使用600。
                        </p><pre class="pre codeblock"><code>SELECT mv_owner，mv_name，refresh_method FROM dba_mvref_stats WHERE elapsed_time&gt; 600;</code></pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-7F2FF444-7FFD-4F2A-8D04-CBE7CD2EB04E" name="GUID-7F2FF444-7FFD-4F2A-8D04-CBE7CD2EB04E"></a><h4 id="DWHSG-GUID-7F2FF444-7FFD-4F2A-8D04-CBE7CD2EB04E" class="sect4"><span class="enumeration_section">9.8.2</span>查看每个物化视图刷新操作的详细统计信息</h4>
                  <div>
                     <p><code class="codeph">DBA_MVREF_RUN_STATS</code>视图存储有关物化视图刷新操作的详细统计信息。当刷新操作影响多个物化视图时，所有受影响的物化视图都可以使用详细的统计信息。
                     </p>
                     <div class="section">
                        <p>可以使用<code class="codeph">DBMS_MVIEW</code>包中的以下过程之一<code class="codeph">REFRESH</code> <code class="codeph">DBMS_MVIEW</code> ： <code class="codeph">REFRESH</code> ， <code class="codeph">REFRESH_DEPENDENT</code>或<code class="codeph">REFRESH_ALL</code> 。每个过程包含指定必须如何执行刷新的不同参数。<code class="codeph">DBA_MVREF_RUN_STATS</code>视图包含有关为刷新操作指定的参数，刷新的<code class="codeph">DBA_MVREF_RUN_STATS</code>视图数，执行时间和日志清除时间的信息。
                        </p>
                        <p>要查看物化视图刷新操作的详细刷新统计信息：</p>
                     </div>
                     <!-- class="section" -->
                     <ul>
                        <li><span>使用所需列的列表查询<code class="codeph">DBA_MVREF_RUN_STATS</code>视图并使用条件过滤所需的数据</span></li>
                     </ul>
                     <div class="example" id="GUID-7F2FF444-7FFD-4F2A-8D04-CBE7CD2EB04E__GUID-F1CDF6BC-4553-4F9F-87B2-1DBCFF191951">
                        <p class="titleinexample">示例9-15列出在单个刷新操作中刷新的所有实例化视图</p>
                        <p>以下示例显示已作为指定刷新ID的一部分刷新的实例化视图的实例化视图和刷新时间。</p><pre class="pre codeblock"><code>SELECT mviews，elapsed_time，complete_stats_available FROM dba_mvref_run_stats WHERE refresh_id = 100; MVIEWS ELAPSED_TIME COMPLETE_STATS_AVAIALBE -------- ------------ -------------------------“SH “。”SALES_RTMV“1 Y.</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-7F2FF444-7FFD-4F2A-8D04-CBE7CD2EB04E__GUID-374ADC11-8CB0-403E-87CD-19B155BDFF9A">
                        <p class="titleinexample">示例9-16查看实体化视图刷新操作期间指定的参数</p>
                        <p>以下示例显示刷新的实例化视图列表以及刷新ID 81的刷新操作期间指定的一些参数。</p><pre class="pre codeblock"><code>SELECT mviews，refresh_after_errors，purge_option，parallelism，嵌套FROM dba_mvref_run_stats WHERE run_owner ='SH'和refresh_id = 81; MVIEWS R PURGE_OPTION PARALLELISM NESTED ------  -  ------------ ------------ -------“SH”。“SALES_RTMV” N 1 0 N.</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-7F2FF444-7FFD-4F2A-8D04-CBE7CD2EB04E__GUID-35F5556C-A8B3-4171-8ECF-D1C854770F67">
                        <p class="titleinexample">示例9-17显示物化视图刷新操作的详细统计信息</p>
                        <p>以下示例显示刷新ID为156的刷新操作的详细统计信息。详细信息包括刷新的实例化视图的数量，实体化视图的所有者和名称以及刷新所用的时间。</p><pre class="pre codeblock"><code>SELECT num_mvs，mv_owner，mv_name，r.elapsed_time FROM dba_mvref_stats s，dba_mvref_run_stats r WHERE s.refresh_id = r.refresh_id和refresh_id = 156; NUM_MVS MV_OWNER MV_NAME ELAPSED_TIME -------- -------- -------- ----------- 1 SH SALES_RTMV 5</code></pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-7F2FF444-7FFD-4F2A-8D04-CBE7CD2EB04E__GUID-A813D2DA-DDEF-4229-87DB-E13B759ECECB">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../refrn/DBA_MVREF_RUN_STATS.html#REFRN-GUID-A078FAB9-BE12-42BF-811C-D6E2EEF5A952" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-D3C9BA73-E6DE-4135-AAE9-414103D4C715" name="GUID-D3C9BA73-E6DE-4135-AAE9-414103D4C715"></a><h4 id="DWHSG-GUID-D3C9BA73-E6DE-4135-AAE9-414103D4C715" class="sect4"><span class="enumeration_section">9.8.3</span>在物化视图刷新操作期间查看更改数据统计信息</h4>
                  <div>
                     <p><code class="codeph">DBA_MVREF_CHANGE_STATS</code>视图存储物化视图刷新操作的详细更改数据统计信息。这包括刷新的基表，插入的行数，更新的行数，删除的行数以及分区维护操作（PMOP）详细信息。
                     </p>
                     <div class="section">
                        <p>您可以将<code class="codeph">DBA_MVREF_CHANGE_STATS</code>视图与包含物化视图刷新统计信息的其他视图一起加入，以提供更完整的统计信息。
                        </p>
                        <p>要查看物化视图刷新操作的详细更改数据统计信息：</p>
                     </div>
                     <!-- class="section" -->
                     <ul>
                        <li><span>使用所需列的列表查询<code class="codeph">DBA_MVREF_CHANGE_STATS</code>视图并使用条件过滤所需数据</span></li>
                     </ul>
                     <div class="example" id="GUID-D3C9BA73-E6DE-4135-AAE9-414103D4C715__GUID-160B85F7-321E-4B01-960F-ABD6BCD970D5">
                        <p class="titleinexample">例9-18确定PMOP中是否有刷新操作</p>
                        <p>以下示例显示刷新操作的基表名称和PMOP详细信息，其中刷新ID为1876。查询输出包含物化视图的每个基表的一条记录。</p><pre class="pre codeblock"><code>SELECT tbl_name，mv_name，pmops_occurred，pmop_details FROM dba_mvref_change_stats WHERE refresh_id = 1876; TBL_NAME MV_NAME PMOPS_OCCURRED PMOP_DETAILS --------- -------- -------------- ------------ MY_SALES SALES_RTMV N</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-D3C9BA73-E6DE-4135-AAE9-414103D4C715__GUID-9C6F5423-42D1-4813-8817-35BE1F5D31A7">
                        <p class="titleinexample">例9-19显示刷新操作期间修改的行数</p>
                        <p>此示例在<code class="codeph">SH.MY_SALES</code>物化视图的刷新操作中显示有关每个基表的以下详细信息：表中的行数，插入的行数，更新的行数，删除的行数，直接装载插入的数量，和PMOP操作的细节。
                        </p><pre class="pre codeblock"><code>SELECT tbl_name，num_rows，num_rows_ins，num_rows_upd，num_rows_del，num_rows_dl_ins，pmops_occurred，pmop_details FROM dba_mvref_change_stats WHERE mv_name ='MY_SALES'和mv_owner ='SH';</code></pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-D3C9BA73-E6DE-4135-AAE9-414103D4C715__GUID-2A186927-B7AB-47C8-9F3C-747D008B0531">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../refrn/DBA_MVREF_CHANGE_STATS.html#REFRN-GUID-1343FE59-366F-4F2D-A539-51BEE0D8B204" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-BD3E19B7-0F73-466D-87A7-7D477D55DBBA" name="GUID-BD3E19B7-0F73-466D-87A7-7D477D55DBBA"></a><h4 id="DWHSG-GUID-BD3E19B7-0F73-466D-87A7-7D477D55DBBA" class="sect4"><span class="enumeration_section">9.8.4</span>查看与物化视图刷新操作关联的SQL语句</h4>
                  <div>
                     <p>查询<code class="codeph">DBA_MVREF_STMT_STATS</code>视图以显示有关<code class="codeph">DBA_MVREF_STMT_STATS</code>化视图刷新操作中使用的所有SQL语句的信息。
                     </p>
                     <div class="section">
                        <p>每个刷新操作可以包含多个步骤，每个步骤都使用SQL语句执行。对于刷新操作中的每个步骤，您可以查看步骤编号和SQL语句。</p>
                        <p>要查看与实例化视图刷新操作关联的SQL语句：</p>
                     </div>
                     <!-- class="section" -->
                     <ul>
                        <li><span>使用所需列的列表查询<code class="codeph">DBA_MVREF_STMT_STATS</code>视图并使用条件过滤所需数据</span></li>
                     </ul>
                     <div class="example" id="GUID-BD3E19B7-0F73-466D-87A7-7D477D55DBBA__GUID-8377ED79-FFA2-4A6B-BF0C-A5E5321B359B">
                        <p class="titleinexample">示例9-20在刷新操作中显示每个步骤的SQL语句</p>
                        <p>以下示例显示实例化视图名称，用于刷新实例化视图的SQL语句以及具有刷新ID的实例化视图刷新操作的执行时间为1278。</p><pre class="pre codeblock"><code>SELECT mv_name，step，stmt，execution_time FROM dba_mvref_stmt_stats WHERE refresh_id = 1278;</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-BD3E19B7-0F73-466D-87A7-7D477D55DBBA__GUID-1A22FAFB-7B46-42E1-9EFC-7E426E5F568F">
                        <p class="titleinexample">示例9-21显示在物化视图的当前刷新中使用的刷新语句</p>
                        <p>此示例显示用于刷新<code class="codeph">MY_SALES</code>化视图的各个SQL语句。单个刷新操作可以包含多个步骤，每个步骤都执行一个SQL语句。此示例中显示的详细信息包括步骤编号，SQL语句的SQL ID，执行的SQL语句以及SQL语句的执行时间。
                        </p><pre class="pre codeblock"><code>SELECT步骤，sqlid，stmt，execution_time FROM DBA_MVREF_STATS M，DBA_MVREF_STMT_STATS S WHERE M.refresh_id = S.refresh_id和M.mv_name ='MY_SALES'ORDER BY步骤;</code></pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-BD3E19B7-0F73-466D-87A7-7D477D55DBBA__GUID-36B5AE3F-9662-436C-9ED1-996E5F2114D7">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../refrn/DBA_MVREF_STMT_STATS.html#REFRN-GUID-A1C15C62-A01B-4727-B3BF-9D73568EE552" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-D87F8F81-8B93-4D7E-87F5-3BFEAA2A7C06" name="GUID-D87F8F81-8B93-4D7E-87F5-3BFEAA2A7C06"></a><h3 id="DWHSG-GUID-D87F8F81-8B93-4D7E-87F5-3BFEAA2A7C06" class="sect3"><span class="enumeration_section">9.9</span>使用刷新统计信息分析物化视图刷新性能</h3>
               <div>
                  <p>存储在数据字典视图中的物化视图刷新统计信息可用于分析物化视图的刷新性能。</p>
                  <div class="section">
                     <p>刷新统计信息提供详细信息，使您能够了解和分析物化视图刷新操作及其性能。通常，您可以分析关键或长时间运行的物化视图刷新操作的刷新统计信息。如果物化视图的刷新时间比正常情况要长，那么您可以分析其过去的刷新时间并更改数据以识别可能导致增加时间的任何差异（例如，此次需要刷新的数据量增加5倍） ）。</p>
                     <p><span class="bold">要分析物化视图刷新性能：</span></p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>设置实例化视图的集合级别和保留期限，以收集一段时间内的刷新统计信息。</span><div>您可以在数据库级别或物化视图级别设置它们。</div>
                     </li>
                     <li class="stepexpand"><span>确定需要分析其刷新性能的物化视图。</span><div>通常，您会对分析数据库中特定物化视图集的刷新性能感兴趣。在这种情况下，您可以根据需要修改这些实例化视图的刷新统计信息设置。</div>
                     </li>
                     <li class="stepexpand"><span>如果在一段时间内发生多次刷新操作（对于要分析的物化视图），Oracle数据库会收集所需的刷新统计信息。</span></li>
                     <li class="stepexpand"><span>查询存储刷新统计信息的数据字典视图，并分析一段时间内感兴趣的物化视图的刷新行为，以了解刷新行为。</span><div>数据库存储历史和当前统计信息，可以对其进行分析以了解刷新行为。</div>
                     </li>
                  </ol>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>