<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>Oracle调用接口（OCI）</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Object-Relational Developer&#39;s Guide "></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Object-Relational Developer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="object-relational-developers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-11T02:05:10-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96436-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="plsql.html" title="Previous" type="text/html"></link>
      <link rel="next" href="pro-c-cpp.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Object-Relational Developer&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="ADOBJ"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="plsql.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="pro-c-cpp.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">对象关系开发人员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="object-support-in-oracle-programming-environments.html" property="item" typeof="WebPage"><span property="name">Oracle编程环境中的对象支持</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Oracle调用接口（OCI）</li>
            </ol>
            <a id="GUID-D3515120-813C-480B-93BC-6C9027FE14E1" name="GUID-D3515120-813C-480B-93BC-6C9027FE14E1"></a>
            
            <h2 id="ADOBJ-GUID-D3515120-813C-480B-93BC-6C9027FE14E1" class="sect2"><span class="enumeration_section">4.4</span> Oracle调用接口（OCI）</h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d15326e6" class="indexterm-anchor"></a> OCI是一组C库函数，应用程序可以使用它们来操作Oracle数据库中的数据和模式。
               </p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="oracle-call-interface-oci.html#GUID-B274BB40-BAC1-4D9B-BEE8-0B1BD223640C">关于Oracle Call Interface（OCI）</a></p>
                  </li>
                  <li>
                     <p><a href="oracle-call-interface-oci.html#GUID-30CAFE06-6176-498D-AFF7-6B5D98A97EBC">OCI计划中的关联访问</a></p>
                  </li>
                  <li>
                     <p><a href="oracle-call-interface-oci.html#GUID-5D5499A5-D30A-45BA-B9B8-88F14FFADA6B">OCI计划中的导航访问</a></p>
                  </li>
               </ul>
            </div><a id="ADOBJ7194"></a><div class="props_rev_3"><a id="GUID-B274BB40-BAC1-4D9B-BEE8-0B1BD223640C" name="GUID-B274BB40-BAC1-4D9B-BEE8-0B1BD223640C"></a><h3 id="ADOBJ-GUID-B274BB40-BAC1-4D9B-BEE8-0B1BD223640C" class="sect3"><span class="enumeration_section">4.4.1</span>关于Oracle调用接口（OCI）</h3>
               <div>
                  <p>OCI支持传统的3GL和面向对象的数据库访问技术，如以下部分所述。</p>
                  <p>OCI的一个重要组件是一组管理称为对象缓存的工作空间的调用。该<a id="d15326e111" class="indexterm-anchor"></a><a id="d15326e115" class="indexterm-anchor"></a>对象缓存是客户端上的一个内存块，它允许程序存储整个对象并在它们之间导航，而无需额外的往返服务器。
                  </p>
                  <p>对象缓存完全受使用它的应用程序的控制和管理。Oracle服务器无法访问它。使用它的应用程序必须保持与服务器的数据一致性，并保护工作空间免受同时冲突的访问。</p>
                  <p>OCI提供功能</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>使用访问服务器上的对象<a id="d15326e128" class="indexterm-anchor"></a> SQL。</p>
                     </li>
                     <li>
                        <p>通过遍历指针或<code class="codeph">REF</code>访问，操作和管理对象缓存中的对象。
                        </p>
                     </li>
                     <li>
                        <p>将Oracle日期，字符串和数字转换为C数据类型。</p>
                     </li>
                     <li>
                        <p>管理对象缓存内存的大小。</p>
                     </li>
                  </ul>
                  <p>OCI提高了并发性<a id="d15326e149" class="indexterm-anchor"></a><a id="d15326e153" class="indexterm-anchor"></a>允许锁定单个对象。它通过支持复杂的对象检索来提高性能。
                  </p>
                  <p>OCI开发人员可以使用对象类型转换器生成与Oracle对象类型对应的C数据类型。</p>
                  <div class="infoboxnotealso" id="GUID-B274BB40-BAC1-4D9B-BEE8-0B1BD223640C__GUID-29986D8F-9D3A-4FF1-A4C3-62AFC869F55B">
                     <p class="notep1">也可以看看：</p>
                     <p>有关使用OCI对象的更多信息，请参阅<a href="../lnoci/oci-object-relational-programming.html#LNOCI100" target="_blank"><span><cite>“Oracle调用接口程序员指南”</cite></span></a></p>
                  </div>
               </div>
            </div><a id="ADOBJ7195"></a><div class="props_rev_3"><a id="GUID-30CAFE06-6176-498D-AFF7-6B5D98A97EBC" name="GUID-30CAFE06-6176-498D-AFF7-6B5D98A97EBC"></a><h3 id="ADOBJ-GUID-30CAFE06-6176-498D-AFF7-6B5D98A97EBC" class="sect3"><span class="enumeration_section">4.4.2</span> OCI程序中的关联访问</h3>
               <div>
                  <p>OCI程序支持使用可以操作对象数据的API对对象的关联访问。</p>
                  <p><a id="d15326e220" class="indexterm-anchor"></a>传统上，3GL程序通过执行SQL语句和PL / SQL过程来操纵存储在关系数据库中的数据。通常在服务器上操纵数据而不会产生将数据传输到客户端的成本。OCI通过提供用于执行操作对象数据的SQL语句的API来支持对对象的关联访问。具体而言，OCI使您能够：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>执行操作对象数据和对象类型架构信息的SQL语句</p>
                     </li>
                     <li>
                        <p>将对象实例，对象引用（ <code class="codeph">REF</code> ）和集合作为输入变量传递给SQL语句</p>
                     </li>
                     <li>
                        <p>返回对象实例， <code class="codeph">REF</code>和集合作为SQL语句提取的输出</p>
                     </li>
                     <li>
                        <p>描述返回对象实例， <code class="codeph">REF</code>和集合的SQL语句的属性</p>
                     </li>
                     <li>
                        <p>使用对象参数或结果描述和执行PL / SQL过程或函数</p>
                     </li>
                     <li>
                        <p>通过增强的提交和回滚功能同步对象和关系功能</p>
                     </li>
                  </ul>
                  <p>请参阅<span class="q">“ <a href="pro-c-cpp.html#GUID-563052BA-73D1-40BA-8351-705AA29A98BB">Pro * C / C ++中的关联访问</a> ”</span> 。
                  </p>
               </div>
            </div><a id="ADOBJ7196"></a><div class="props_rev_3"><a id="GUID-5D5499A5-D30A-45BA-B9B8-88F14FFADA6B" name="GUID-5D5499A5-D30A-45BA-B9B8-88F14FFADA6B"></a><h3 id="ADOBJ-GUID-5D5499A5-D30A-45BA-B9B8-88F14FFADA6B" class="sect3"><span class="enumeration_section">4.4.3</span> OCI程序中的导航访问</h3>
               <div>
                  <p>OCI程序通过API提供导航访问。</p>
                  <p><a id="d15326e313" class="indexterm-anchor"></a>在面向对象的编程范例中，应用程序将它们的真实世界实体建模为一组形成对象图的相互关联的对象。对象之间的关系实现为引用。应用程序通过从一些初始对象集开始处理对象，使用这些初始对象中的引用遍历其余对象，并对每个对象执行计算。OCI为这种对象访问提供了一种API，称为导航访问。具体而言，OCI使您能够：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>缓存客户端计算机内存中的对象</p>
                     </li>
                     <li>
                        <p>取消引用对象引用并固定对象缓存中的相应对象。固定对象透明地映射到宿主语言表示中。</p>
                     </li>
                     <li>
                        <p>当不再需要固定对象时通知缓存</p>
                     </li>
                     <li>
                        <p>在一次调用中从数据库中获取相关对象的图形到客户端缓存中</p>
                     </li>
                     <li>
                        <p>锁定对象</p>
                     </li>
                     <li>
                        <p>在缓存中创建，更新和删除对象</p>
                     </li>
                     <li>
                        <p>将对客户端缓存中的对象所做的更改刷新到数据库</p>
                     </li>
                  </ul>
                  <p>请参阅<span class="q">“ <a href="pro-c-cpp.html#GUID-7162D120-3CDB-4549-85C4-283E4F0E5DFA">Pro * C / C ++中的导航访问</a> ”</span> 。
                  </p>
               </div>
            </div><a id="ADOBJ7197"></a><div class="props_rev_3"><a id="GUID-EDDCDEB1-988B-47C0-9C2B-80821CEC6D2E" name="GUID-EDDCDEB1-988B-47C0-9C2B-80821CEC6D2E"></a><h3 id="ADOBJ-GUID-EDDCDEB1-988B-47C0-9C2B-80821CEC6D2E" class="sect3"><span class="enumeration_section">4.4.4</span>对象缓存</h3>
               <div>
                  <p><a id="d15326e397" class="indexterm-anchor"></a>为了支持对象的高性能导航访问，OCI运行时提供了一个对象缓存，用于缓存内存中的对象。
                  </p>
                  <p>对象缓存支持对对象缓存中的数据库对象的引用（ <code class="codeph">REF</code> ），数据库对象可以通过它们的引用来标识（即固定）。当数据库对象加载到缓存中时，应用程序不需要分配或释放内存，因为对象缓存为数据库对象提供透明和有效的内存管理。
                  </p>
                  <p>此外，当数据库对象加载到缓存中时，它们会透明地映射到宿主语言表示中。例如，在C编程语言中，数据库对象被映射到其对应的C结构。对象缓存维护缓存中的对象副本与相应的数据库对象之间的关联。在事务提交时，对缓存中的对象副本所做的更改会自动传播到数据库。</p>
                  <p>对象缓存维护一个快速查找表，用于将<code class="codeph">REF</code>映射到对象。当应用程序取消引用<code class="codeph">REF</code>并且相应的对象尚未缓存在对象缓存中时，对象缓存会自动向服务器发送请求以从数据库中获取对象并将其加载到对象缓存中。相同<code class="codeph">REF</code>后续解引用速度更快，因为它们成为本地缓存访问并且不会导致网络往返。
                  </p>
                  <p>要通知对象缓存应用程序正在访问缓存中的对象，应用程序将对象固定;当它完成对象时，它会取消它。对象缓存维护缓存中每个对象的引脚数。计数在引脚调用时递增，在取消固定调用时递减。当引脚数变为零时，表示应用程序不再需要该对象。</p>
                  <p>对象缓存使用最近最少使用（LRU）算法来管理缓存的大小。当高速缓存达到最大大小时，LRU算法释放引脚数为零的候选对象。</p>
               </div>
            </div><a id="ADOBJ7198"></a><div class="props_rev_3"><a id="GUID-99AA9F59-9347-45FF-A569-70E218A30F89" name="GUID-99AA9F59-9347-45FF-A569-70E218A30F89"></a><h3 id="ADOBJ-GUID-99AA9F59-9347-45FF-A569-70E218A30F89" class="sect3"><span class="enumeration_section">4.4.5</span>构建操纵对象的OCI程序</h3>
               <div>
                  <div class="section">
                     <p><a id="d15326e475" class="indexterm-anchor"></a>您可以通过以C主机语言格式表示类型来构建OCI程序来操作对象。
                     </p>
                     <p>构建操作对象的OCI程序时，必须完成以下常规步骤</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>定义与应用程序对象对应的对象类型。</span></li>
                     <li class="stepexpand"><span>执行SQL DDL语句以使用必要的对象类型填充数据库。</span></li>
                     <li class="stepexpand"><span>以宿主语言格式表示对象类型。</span><div>
                           <p>例如，要在C程序中操作对象类型的实例，必须以C主机语言格式表示这些类型。您可以通过将对象类型表示为C结构来完成此操作。您可以使用Oracle提供的称为对象类型转换器（OTT）的工具来生成对象类型的C映射。OTT将等效的C结构放在头（* .h）文件中。您将这些* .h文件包含在包含实现该应用程序的C函数的* .c文件中。</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>通过编译和链接应用程序的* .c文件与OCI库来构造应用程序可执行文件。</span><div>
                           <div class="infoboxnotealso" id="GUID-99AA9F59-9347-45FF-A569-70E218A30F89__GUID-5EA111EF-4B40-4243-8760-1A5CAEFF9192">
                              <p class="notep1">也可以看看：</p>
                              <p> <a href="../lnoci/oci-object-relational-programming.html#LNOCI100" target="_blank"><span><cite>Oracle调用接口程序员指南</cite></span></a> ，了解有效使用OCI程序和对象的技巧和技巧</p>
                           </div>
                        </div>
                     </li>
                  </ol>
               </div>
            </div><a id="ADOBJ7200"></a><a id="ADOBJ7199"></a><div class="props_rev_3"><a id="GUID-A03F7475-9470-4D25-9060-E5E055347D4A" name="GUID-A03F7475-9470-4D25-9060-E5E055347D4A"></a><h3 id="ADOBJ-GUID-A03F7475-9470-4D25-9060-E5E055347D4A" class="sect3"><span class="enumeration_section">4.4.6</span>在C中定义用户定义的构造函数</h3>
               <div>
                  <div class="section">
                     <p>在C中定义用户定义的构造函数时，必须在<code class="codeph">PARAMETERS</code>子句中指定<code class="codeph">SELF</code> （并且可以选择指定<code class="codeph">SELF</code> <code class="codeph">TDO</code> ）。
                     </p>
                     <p>在进入C函数时，对象映射到的C结构的属性都被初始化为<code class="codeph">NULL</code> 。函数返回的值将映射到用户定义类型的实例。
                     </p>
                     <p> <a href="oracle-call-interface-oci.html#GUID-A03F7475-9470-4D25-9060-E5E055347D4A__CCHDJCAC">示例4-1</a>显示了如何在C中定义用户定义的构造函数。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-A03F7475-9470-4D25-9060-E5E055347D4A__CCHDJCAC">
                     <p class="titleinexample">示例4-1在C中定义用户定义的构造函数</p><pre class="oac_no_warn" dir="ltr">CREATE LIBRARY person_lib TRUSTED AS STATIC / CREATE TYPE person AS OBJECT（名称VARCHAR2（30），CONSTRUCTOR FUNCTION person（SELF IN OUT NOCOPY person，name VARCHAR2）RETURN SELF AS RESULT）; / CREATE TYPE BODY person是CONSTRUCTOR FUNCTION person（SELF IN OUT NOCOPY person，name VARCHAR2）RETURN SELF AS RESULT是EXTERNAL NAME“cons_person_typ”LIBRARY person_lib WITH CONTEXT PARAMETERS（context，SELF，name OCIString，name INDICATOR sb4）;结束;/</pre><p><code class="codeph">SELF</code>参数映射为<code class="codeph">IN</code>参数，因此在<code class="codeph">NOT</code> <code class="codeph">FINAL</code>类型的情况下，它映射到<code class="codeph">(dvoid *)</code> ，而不是<code class="codeph">(dvoid **)</code> 。返回值的<code class="codeph">TDO</code>必须在比赛<code class="codeph">TDO</code>的<code class="codeph">SELF</code> ，因此是隐含的。返回值永远不能为null，因此返回指示符也是隐式的。
                     </p>
                  </div>
                  <!-- class="example" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>