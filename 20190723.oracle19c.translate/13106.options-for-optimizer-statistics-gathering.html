<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="This chapter explains what optimizer statistics collection is and how to set statistics preferences."></meta>
      <meta name="description" content="This chapter explains what optimizer statistics collection is and how to set statistics preferences."></meta>
      <title>配置优化程序统计信息收集选项</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="SQL Tuning Guide"></meta>
      <meta property="og:description" content="This chapter explains what optimizer statistics collection is and how to set statistics preferences."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="SQL Tuning Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="sql-tuning-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-31T14:57:08-08:00"></meta>
      <meta name="dcterms.title" content="SQL Tuning Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="2013, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96095-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="histograms.html" title="Previous" type="text/html"></link>
      <link rel="next" href="gathering-optimizer-statistics.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGSQL"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="histograms.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="gathering-optimizer-statistics.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL调优指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="optimizer-statistics.html" property="item" typeof="WebPage"><span property="name">优化器统计</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">配置优化程序统计信息收集选项</li>
            </ol>
            <a id="GUID-2044960C-025B-44FC-9522-63F426C74386" name="GUID-2044960C-025B-44FC-9522-63F426C74386"></a>
            
            <h2 id="TGSQL-GUID-2044960C-025B-44FC-9522-63F426C74386" class="sect2"><span class="enumeration_chapter">12</span>配置优化程序统计信息收集选项</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍优化程序统计信息收集的内容以及如何设置统计信息首选项。</p>
               <p>本章包含以下主题：</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-3B795407-2E23-4612-B243-52701799F0B0">关于优化器统计信息收集</a><br>在Oracle数据库中， <strong class="term">优化程序统计信息收集</strong>是数据库对象（包括固定对象）的优化程序统计信息的收集。
                  </li>
                  <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-4FDDBCB2-1DA1-4697-9F07-5AB7DE01D682">设置Optimizer Statistics首选项</a><br>本主题说明如何使用<code class="codeph">DBMS_STATS.SET_*_PREFS</code>过程设置优化程序统计信息缺省值。
                  </li>
                  <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-F1C666DC-5450-4F92-83AA-607327DB5FD8">配置动态统计信息的选项</a><br><strong class="term">动态统计</strong>是一种优化技术，其中数据库使用递归SQL扫描表中块的小随机样本。
                  </li>
                  <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-67E635AA-F168-47D7-9DC9-CE8803464B6E">管理SQL计划指令</a><br><span class="bold">SQL计划指令</span>是优化程序可用于生成更优计划的附加信息和指令。
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="optimizer-statistics.html#GUID-0A2F3D52-A135-43E1-9CAB-55BFE068A297" title="执行计划的准确性取决于优化程序统计信息的质量。">优化程序统计信息</a></p>
                  </div>
               </div>
            </div>
            <a id="TGSQL390"></a><div class="props_rev_3"><a id="GUID-3B795407-2E23-4612-B243-52701799F0B0" name="GUID-3B795407-2E23-4612-B243-52701799F0B0"></a><h3 id="TGSQL-GUID-3B795407-2E23-4612-B243-52701799F0B0" class="sect3"><span class="enumeration_section">12.1</span>关于优化器统计信息收集</h3>
               <div>
                  <p>在Oracle数据库中， <strong class="term">优化程序统计信息收集</strong>是数据库对象（包括固定对象）的优化程序统计信息的收集。
                  </p>
                  <p>数据库可以自动收集优化程序统计信息。您也可以使用<code class="codeph">DBMS_STATS</code>包手动收集它们。
                  </p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-212B6999-D190-4B00-BE30-D7830B3D8499">优化器统计信息收集的目的</a><br>表和关联索引的内容经常更改，这可能导致优化器为查询选择次优的执行计划。为避免潜在的性能问题，必须保持最新的统计数据。
                     </li>
                     <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-F3E7DF77-30DF-4639-98A3-788ACF3032F7">优化器统计管理的用户界面</a><br>您可以通过Oracle Enterprise Manager云控制（云控制）或在命令行上使用PL / SQL来管理优化程序统计信息。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-2044960C-025B-44FC-9522-63F426C74386" title="本章介绍优化程序统计信息收集的内容以及如何设置统计信息首选项。">配置优化程序统计信息收集的选项</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL94582"></a><div class="props_rev_3"><a id="GUID-212B6999-D190-4B00-BE30-D7830B3D8499" name="GUID-212B6999-D190-4B00-BE30-D7830B3D8499"></a><h4 id="TGSQL-GUID-212B6999-D190-4B00-BE30-D7830B3D8499" class="sect4"><span class="enumeration_section">12.1.1</span>优化器统计信息收集的目的</h4>
                  <div>
                     <p>表和关联索引的内容经常更改，这可能导致优化器为查询选择次优的执行计划。为避免潜在的性能问题，必须保持最新的统计数据。</p>
                     <p>为了最大限度地减少DBA的使用，Oracle数据库会在不同时间自动收集优化程序统计信息。一些自动选项是可配置的，例如使AutoTask能够运行<code class="codeph">DBMS_STATS</code> 。</p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-3B795407-2E23-4612-B243-52701799F0B0" title="在Oracle数据库中，优化程序统计信息收集是数据库对象（包括固定对象）的优化程序统计信息的收集。">关于优化程序统计信息收集</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL391"></a><div class="props_rev_3"><a id="GUID-F3E7DF77-30DF-4639-98A3-788ACF3032F7" name="GUID-F3E7DF77-30DF-4639-98A3-788ACF3032F7"></a><h4 id="TGSQL-GUID-F3E7DF77-30DF-4639-98A3-788ACF3032F7" class="sect4"><span class="enumeration_section">12.1.2</span>优化器统计管理的用户界面</h4>
                  <div>
                     <p>您可以通过Oracle Enterprise Manager云控制（云控制）或在命令行上使用PL / SQL来管理优化程序统计信息。</p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-7D050AB3-B3E6-4318-B9AC-B0D751131CD3">优化器统计管理的图形界面</a><br>Cloud Control中的Manage Optimizer Statistics页面是一个GUI，可用于管理优化程序统计信息。
                        </li>
                        <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-476BA982-0543-4B4D-84C7-8123D6174E1F">优化器统计信息管理的命令行界面</a><br><code class="codeph">DBMS_STATS</code>包执行大多数优化程序统计任务。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-3B795407-2E23-4612-B243-52701799F0B0" title="在Oracle数据库中，优化程序统计信息收集是数据库对象（包括固定对象）的优化程序统计信息的收集。">关于优化程序统计信息收集</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL392"></a><div class="props_rev_3"><a id="GUID-7D050AB3-B3E6-4318-B9AC-B0D751131CD3" name="GUID-7D050AB3-B3E6-4318-B9AC-B0D751131CD3"></a><h5 id="TGSQL-GUID-7D050AB3-B3E6-4318-B9AC-B0D751131CD3" class="sect5"><span class="enumeration_section">12.1.2.1</span>优化器统计管理的图形界面</h5>
                     <div>
                        <p>Cloud Control中的Manage Optimizer Statistics页面是一个GUI，可用于管理优化程序统计信息。</p>
                        <p>本节包含以下主题：</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-15511441-3164-4233-A0F8-54A8DF44AC6D">访问Cloud Control中的数据库主页</a><br>Oracle Enterprise Manager Cloud Control使您可以在单个基于GUI的框架内管理多个数据库。
                           </li>
                           <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-360B47CD-4CE0-4336-8637-FD90A16F2830">访问优化程序统计控制台</a><br>您可以通过Optimizer Statistics控制台页面链接的页面执行与优化程序统计信息相关的大多数必要任务。
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-F3E7DF77-30DF-4639-98A3-788ACF3032F7" title="您可以通过Oracle Enterprise Manager云控制（云控制）或在命令行上使用PL / SQL来管理优化程序统计信息。">优化程序统计信息管理的用户界面</a></p>
                           </div>
                        </div>
                     </div>
                     <a id="TGSQL94917"></a><div class="props_rev_3"><a id="GUID-15511441-3164-4233-A0F8-54A8DF44AC6D" name="GUID-15511441-3164-4233-A0F8-54A8DF44AC6D"></a><h6 id="TGSQL-GUID-15511441-3164-4233-A0F8-54A8DF44AC6D" class="sect6"><span class="enumeration_section">12.1.2.1.1</span>在Cloud Control中访问数据库主页</h6>
                        <div>
                           <p>Oracle Enterprise Manager Cloud Control使您可以在单个基于GUI的框架内管理多个数据库。</p>
                           <div class="section">
                              <p class="subhead3" id="GUID-15511441-3164-4233-A0F8-54A8DF44AC6D__GUID-8CABBC92-0224-4D55-9803-A6AE521AFC7D">要使用Cloud Control访问数据库主页：</p>
                              <ol>
                                 <li>
                                    <p>使用适当的凭据登录Cloud Control。</p>
                                 </li>
                                 <li>
                                    <p>在“ <span class="bold">目标”</span>菜单下，选择“ <span class="bold">数据库”</span> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p>在数据库目标列表中，选择要管理的Oracle数据库实例的目标。</p>
                                 </li>
                                 <li>
                                    <p>如果系统提示您输入数据库凭据，请输入您要执行的任务所需的最低凭据。</p>
                                 </li>
                              </ol>
                           </div>
                           <!-- class="section" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-15511441-3164-4233-A0F8-54A8DF44AC6D__GUID-2A854074-E945-4F93-8CE8-069D7B990D92">
                              <p class="notep1">也可以看看：</p>
                              <p>Cloud Control在线帮助</p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-7D050AB3-B3E6-4318-B9AC-B0D751131CD3" title="Cloud Control中的Manage Optimizer Statistics页面是一个GUI，可用于管理优化程序统计信息。">优化程序统计信息管理的图形界面</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL393"></a><div class="props_rev_3"><a id="GUID-360B47CD-4CE0-4336-8637-FD90A16F2830" name="GUID-360B47CD-4CE0-4336-8637-FD90A16F2830"></a><h6 id="TGSQL-GUID-360B47CD-4CE0-4336-8637-FD90A16F2830" class="sect6"><span class="enumeration_section">12.1.2.1.2</span>访问优化程序统计控制台</h6>
                        <div>
                           <p>您可以通过Optimizer Statistics控制台页面链接的页面执行与优化程序统计信息相关的大多数必要任务。</p>
                           <div class="section">
                              <p class="subhead3" id="GUID-360B47CD-4CE0-4336-8637-FD90A16F2830__GUID-E7F664E9-767A-4B71-8A5C-A845B1EDD1D5">要使用Cloud Control管理优化程序统计信息：</p>
                              <ol>
                                 <li id="GUID-360B47CD-4CE0-4336-8637-FD90A16F2830__d5e1470">
                                    <p>在Cloud Control中，访问“ <span>数据库主页</span> ”。
                                    </p>
                                 </li>
                                 <li id="GUID-360B47CD-4CE0-4336-8637-FD90A16F2830__d5e1476">
                                    <p>从<span class="bold">Performance</span>菜单中，选择<span class="bold">SQL</span> ，然后选择<span class="bold">Optimizer Statistics</span> 。
                                    </p>
                                    <p>出现Optimizer Statistics控制台。</p>
                                 </li>
                              </ol>
                           </div>
                           <!-- class="section" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-360B47CD-4CE0-4336-8637-FD90A16F2830__GUID-7422A963-293D-431A-9B81-735C0F0630F7">
                              <p class="notep1">也可以看看：</p>
                              <p>Oracle企业管理器云控制的在线帮助</p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-7D050AB3-B3E6-4318-B9AC-B0D751131CD3" title="Cloud Control中的Manage Optimizer Statistics页面是一个GUI，可用于管理优化程序统计信息。">优化程序统计信息管理的图形界面</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div><a id="TGSQL394"></a><div class="props_rev_3"><a id="GUID-476BA982-0543-4B4D-84C7-8123D6174E1F" name="GUID-476BA982-0543-4B4D-84C7-8123D6174E1F"></a><h5 id="TGSQL-GUID-476BA982-0543-4B4D-84C7-8123D6174E1F" class="sect5"><span class="enumeration_section">12.1.2.2</span>优化器统计管理的命令行界面</h5>
                     <div>
                        <p><code class="codeph">DBMS_STATS</code>包执行大多数优化程序统计任务。
                        </p>
                        <p>要启用和禁用自动统计信息收集，请使用<code class="codeph">DBMS_AUTO_TASK_ADMIN</code> PL / SQL程序包。
                        </p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-476BA982-0543-4B4D-84C7-8123D6174E1F__GUID-DF378729-C6B6-4695-AD36-A4BB99DD530E">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../arpls/DBMS_AUTO_TASK_ADMIN.html#ARPLS-GUID-8CD58D39-436B-4642-BAEB-00C651DE8A8F" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a> ，了解如何使用<code class="codeph">DBMS_STATS</code>和<code class="codeph">DBMS_AUTO_TASK_ADMIN</code></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-F3E7DF77-30DF-4639-98A3-788ACF3032F7" title="您可以通过Oracle Enterprise Manager云控制（云控制）或在命令行上使用PL / SQL来管理优化程序统计信息。">优化程序统计信息管理的用户界面</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div><a id="TGSQL398"></a><div class="props_rev_3"><a id="GUID-4FDDBCB2-1DA1-4697-9F07-5AB7DE01D682" name="GUID-4FDDBCB2-1DA1-4697-9F07-5AB7DE01D682"></a><h3 id="TGSQL-GUID-4FDDBCB2-1DA1-4697-9F07-5AB7DE01D682" class="sect3"><span class="enumeration_section">12.2</span>设置优化器统计信息首选项</h3>
               <div>
                  <p>本主题说明如何使用<code class="codeph">DBMS_STATS.SET_*_PREFS</code>过程设置优化程序统计信息缺省值。
                  </p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-E798E1F6-FC85-456E-8F38-99534BE74492">关于Optimizer Statistics首选项</a><br><strong class="term">优化程序统计信息首选项</strong>设置自动统计信息收集和<code class="codeph">DBMS_STATS</code>统计信息收集过程使用的参数的默认值。
                     </li>
                     <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-777704A7-3751-4720-957E-6C916FD36917">使用云控制设置全局优化器统计信息首选项</a><br>全局优先适用于任何对象中<span class="italic">不</span>具有现有的表偏好的数据库。您可以使用Cloud Control在全局级别设置优化程序统计信息首选项。
                     </li>
                     <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-99A31FC1-56F1-4F30-8D0E-156602D4983C">使用Cloud Control设置对象级优化器统计信息首选项</a><br>您可以使用Cloud Control在数据库，架构和表级别设置优化程序统计信息首选项。
                     </li>
                     <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-C644102E-0E5B-4CC8-96B6-F3F34200BE34">从命令行设置优化程序统计信息首选项</a><br>如果不使用Cloud Control设置优化程序统计信息首选项，则可以从命令行调用<code class="codeph">DBMS_STATS</code>过程。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-2044960C-025B-44FC-9522-63F426C74386" title="本章介绍优化程序统计信息收集的内容以及如何设置统计信息首选项。">配置优化程序统计信息收集的选项</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL399"></a><div class="props_rev_3"><a id="GUID-E798E1F6-FC85-456E-8F38-99534BE74492" name="GUID-E798E1F6-FC85-456E-8F38-99534BE74492"></a><h4 id="TGSQL-GUID-E798E1F6-FC85-456E-8F38-99534BE74492" class="sect4"><span class="enumeration_section">12.2.1</span>关于优化程序统计信息首选项</h4>
                  <div>
                     <p><strong class="term">优化程序统计信息首选项</strong>设置自动统计信息收集和<code class="codeph">DBMS_STATS</code>统计信息收集过程使用的参数的默认值。
                     </p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-7E1B6E90-9DB7-4BA2-97E7-D074733392DC">优化器统计信息首选项的用途</a><br>首选项使您可以在某些对象需要的设置与默认设置不同时自动维护优化程序统计信息。
                        </li>
                        <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-7C1411BC-EEFF-4585-9289-EA6B442CFD1E">统计首选项的示例</a><br>使用<code class="codeph">SET_ <span class="codeinlineitalic">*</span> _PREFS</code>过程的<code class="codeph">pname</code>参数设置首选项。
                        </li>
                        <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-61F0ECF1-8B91-4509-B0D9-82879DB6F545">DBMS_STATS设置统计信息首选项的过程</a><br><code class="codeph">DBMS_STATS.SET_*_PREFS</code>过程更改<code class="codeph">DBMS_STATS.GATHER_*_STATS</code>过程使用的参数的缺省值。要查询当前首选项，请使用<code class="codeph">DBMS_STATS.GET_PREFS</code>函数。
                        </li>
                        <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-E616363F-0A7B-4D4D-9384-63934DB69F7D">统计首选项覆盖</a><br><code class="codeph">preference_overrides_parameter</code>统计信息首选项确定在收集优化程序统计信息时是否使用统计信息首选项覆盖参数的输入值。通过这种方式，您可以控制数据库何时遵循传递给统计信息收集过程的参数值。
                        </li>
                        <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-FEE5B9A2-413E-42E8-86BF-0C12B818A95C">设置统计首选项：示例</a><br>此示例说明了<code class="codeph">SET_TABLE_PREFS</code> ， <code class="codeph">SET_SCHEMA_STATS</code>和<code class="codeph">SET_DATABASE_PREFS</code>之间的关系。</li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-4FDDBCB2-1DA1-4697-9F07-5AB7DE01D682" title="本主题说明如何使用DBMS_STATS.SET _ * _ PREFS过程设置优化程序统计信息缺省值。">设置优化程序统计信息首选项</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-7E1B6E90-9DB7-4BA2-97E7-D074733392DC" name="GUID-7E1B6E90-9DB7-4BA2-97E7-D074733392DC"></a><h5 id="TGSQL-GUID-7E1B6E90-9DB7-4BA2-97E7-D074733392DC" class="sect5"><span class="enumeration_section">12.2.1.1</span>优化器统计信息首选项的用途</h5>
                     <div>
                        <p>首选项使您可以在某些对象需要的设置与默认设置不同时自动维护优化程序统计信息。</p>
                        <p>首选项使您可以更精细地控制Oracle数据库收集统计信息的方式。您可以在以下级别设置优化程序统计信息首选项：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>表</p>
                           </li>
                           <li>
                              <p>架构</p>
                           </li>
                           <li>
                              <p>数据库（所有表格）</p>
                           </li>
                           <li>
                              <p>全局（没有首选项的表和将来创建的任何表）</p>
                           </li>
                        </ul>
                        <p>用于设置首选项的<code class="codeph">DBMS_STATS</code>过程具有<code class="codeph">SET_*_PREFS</code>形式的名称。</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-E798E1F6-FC85-456E-8F38-99534BE74492" title="优化程序统计信息首选项设置自动统计信息收集和DBMS_STATS统计信息收集过程使用的参数的默认值。">关于优化程序统计信息首选项</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-7C1411BC-EEFF-4585-9289-EA6B442CFD1E" name="GUID-7C1411BC-EEFF-4585-9289-EA6B442CFD1E"></a><h5 id="TGSQL-GUID-7C1411BC-EEFF-4585-9289-EA6B442CFD1E" class="sect5"><span class="enumeration_section">12.2.1.2</span>统计首选项示例</h5>
                     <div>
                        <p>使用<code class="codeph">SET_ <span class="codeinlineitalic">*</span> _PREFS</code>过程的<code class="codeph">pname</code>参数设置首选项。
                        </p>
                        <p>您可以设置的首选项包括但不限于以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">ESTIMATE_PERCENT</code> 
                              </p>
                              <p>此首选项确定要估计的行的百分比。</p>
                           </li>
                           <li>
                              <p><code class="codeph">同时</code></p>
                              <p>此首选项确定数据库是否在多个对象上同时收集统计信息，或者一次收集一个对象。</p>
                           </li>
                           <li>
                              <p><code class="codeph">STALE_PERCENT</code></p>
                              <p>此首选项确定表中的行百分比，在数据库认为统计信息过时且需要重新收集之前必须更改这些行。</p>
                           </li>
                           <li>
                              <p><code class="codeph">AUTO_STAT_EXTENSIONS</code></p>
                              <p>当设置为非默认值<code class="codeph">ON</code> ，此首选项使SQL计划指令能够根据工作负载中谓词中列的使用情况触发列组统计信息的创建。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">增加的</code></p>
                              <p>此首选项确定数据库是否维护分区表的全局统计信息，而不执行全表扫描。可能的值为<code class="codeph">TRUE</code>和<code class="codeph">FALSE</code> 。</p>
                              <p>例如， <code class="codeph">INCREMENTAL</code>的默认设置为<code class="codeph">FALSE</code> 。在更新最后几个分区时，可以为范围分区表将<code class="codeph">INCREMENTAL</code>设置为<code class="codeph">TRUE</code> 。此外，在非分区表上执行分区交换操作时，Oracle建议您将<code class="codeph">INCREMENTAL</code>设置为<code class="codeph">TRUE</code> ，将<code class="codeph">INCREMENTAL_LEVEL</code>为<code class="codeph">TABLE</code> 。通过这些设置， <code class="codeph">DBMS_STATS</code>在此表上收集表级别概要。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">INCREMENTAL_LEVEL</code></p>
                              <p>当<code class="codeph">INCREMENTAL</code>首选项设置为<code class="codeph">TRUE</code>时，此首选项控制要收集的概要。它需要两个值： <code class="codeph">TABLE</code>或<code class="codeph">PARTITION</code> 。</p>
                           </li>
                           <li>
                              <p><code class="codeph">APPROXIMATE_NDV_ALGORITHM</code></p>
                              <p>此首选项控制在使用增量统计信息计算分区表的不同值的数量时使用的算法。</p>
                           </li>
                           <li>
                              <p><code class="codeph">ROOT_TRIGGER_PDB</code></p>
                              <p>此首选项控制是接受还是拒绝从CDB中的应用程序根触发的统计信息收集。</p>
                              <p>默认情况下，聚集在应用程序根目录元数据联表统计信息时，如果统计应用PDB是陈旧的，数据库<span class="italic">不会</span>触发统计数据收集应用PDB。设置为<code class="codeph">TRUE</code> ， <code class="codeph">ROOT_TRIGGER_PDB</code>将触发应用程序PDB上的统计信息收集，然后在应用程序根目录中派生全局统计信息。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-7C1411BC-EEFF-4585-9289-EA6B442CFD1E__GUID-CD82DA7C-AD35-4AC0-9E34-06CA27E9AAD4">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../arpls/DBMS_STATS.html#ARPLS68491" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a> ，了解用于设置优化程序统计信息首选项的<code class="codeph">DBMS_STATS</code>过程</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-E798E1F6-FC85-456E-8F38-99534BE74492" title="优化程序统计信息首选项设置自动统计信息收集和DBMS_STATS统计信息收集过程使用的参数的默认值。">关于优化程序统计信息首选项</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL401"></a><a id="TGSQL95042"></a><div class="props_rev_3"><a id="GUID-61F0ECF1-8B91-4509-B0D9-82879DB6F545" name="GUID-61F0ECF1-8B91-4509-B0D9-82879DB6F545"></a><h5 id="TGSQL-GUID-61F0ECF1-8B91-4509-B0D9-82879DB6F545" class="sect5"><span class="enumeration_section">12.2.1.3</span> DBMS_STATS设置统计首选项的过程</h5>
                     <div>
                        <p><code class="codeph">DBMS_STATS.SET_*_PREFS</code>过程更改<code class="codeph">DBMS_STATS.GATHER_*_STATS</code>过程使用的参数的缺省值。要查询当前首选项，请使用<code class="codeph">DBMS_STATS.GET_PREFS</code>函数。
                        </p>
                        <div class="section">
                           <p>设置统计信息首选项时，优先顺序为：</p>
                           <ol>
                              <li>
                                 <p>表首选项（为特定表设置，模式中的所有表或数据库中的所有表）</p>
                              </li>
                              <li>
                                 <p>全球偏好</p>
                              </li>
                              <li>
                                 <p>默认偏好</p>
                              </li>
                           </ol>
                           <p>下表总结了相关的<code class="codeph">DBMS_STATS</code>过程。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="tblformal" id="GUID-61F0ECF1-8B91-4509-B0D9-82879DB6F545__CHDDJJJI">
                           <p class="titleintable">表12-1设置优化程序统计信息首选项的DBMS_STATS过程</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_STATS设置优化程序统计信息首选项的过程" width="100%" border="1" summary="This 2 column table shows DBMS_STATS Procedures for Setting Optimizer Statistics Preferences. Column 1 is the procedure. Column 2 is the scope. " frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="32%" id="d70063e2042">程序</th>
                                    <th align="left" valign="bottom" width="68%" id="d70063e2045">范围</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="32%" id="d70063e2050" headers="d70063e2042 ">
                                       <p><code class="codeph">SET_TABLE_PREFS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="68%" headers="d70063e2050 d70063e2045 ">
                                       <p>仅限指定表。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="32%" id="d70063e2058" headers="d70063e2042 ">
                                       <p><code class="codeph">SET_SCHEMA_PREFS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="68%" headers="d70063e2058 d70063e2045 ">
                                       <p>指定架构中的所有现有表。</p>
                                       <p>此过程为指定模式中的每个表调用<code class="codeph">SET_TABLE_PREFS</code> 。调用<code class="codeph">SET_SCHEMA_PREFS</code>不会影响运行后创建的任何新表。新表对所有参数使用<code class="codeph">GLOBAL_PREF</code>值。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="32%" id="d70063e2077" headers="d70063e2042 ">
                                       <p><code class="codeph">SET_DATABASE_PREFS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="68%" headers="d70063e2077 d70063e2045 ">
                                       <p>数据库中的所有用户定义的模式。通过将<code class="codeph">ADD_SYS</code>参数设置为<code class="codeph">true</code>可以包括系统拥有的模式，例如<code class="codeph">SYS</code>和<code class="codeph">SYSTEM</code> 。
                                       </p>
                                       <p>此过程为指定模式中的每个表调用<code class="codeph">SET_TABLE_PREFS</code> 。调用<code class="codeph">SET_DATABASE_PREFS</code>不会影响运行后创建的任何新对象。新对象对所有参数使用<code class="codeph">GLOBAL_PREF</code>值。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="32%" id="d70063e2108" headers="d70063e2042 ">
                                       <p><code class="codeph">SET_GLOBAL_PREFS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="68%" headers="d70063e2108 d70063e2045 ">
                                       <p>任何没有现有表首选项的表。</p>
                                       <p>除非设置了表首选项或在<code class="codeph">DBMS_STATS.GATHER_*_STATS</code>语句中显式设置了参数，否则所有参数都默认为全局设置。<code class="codeph">SET_GLOBAL_PREFS</code>所做的<code class="codeph">SET_GLOBAL_PREFS</code>会影响运行后创建的任何新对象。新对象对所有参数使用<code class="codeph">SET_GLOBAL_PREFS</code>值。
                                       </p>
                                       <p>随着<code class="codeph">SET_GLOBAL_PREFS</code> ，你可以设置参数的默认值<code class="codeph">AUTOSTATS_TARGET</code> 。此附加参数控制在夜间维护窗口中运行的自动统计信息收集作业对哪些对象产生影响。可能值<code class="codeph">AUTOSTATS_TARGET</code>是<code class="codeph">ALL</code> ， <code class="codeph">ORACLE</code> ，和<code class="codeph">AUTO</code> （默认值）。
                                       </p>
                                       <p>您只能在全局级别设置<code class="codeph">CONCURRENT</code>首选项。您无法使用<code class="codeph">SET_GLOBAL_PREFS</code>设置首选项<code class="codeph">INCREMENTAL_LEVEL</code> 。</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <div class="section"></div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-61F0ECF1-8B91-4509-B0D9-82879DB6F545__GUID-648043E0-995E-45B8-A969-819467836F11">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9" title="默认情况下，按顺序收集分区表的每个分区。">关于并发统计收集</a> ”</span></p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_STATS.html#ARPLS68491" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a> ，了解用于设置优化程序统计信息首选项的<code class="codeph">DBMS_STATS</code>过程</p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-E798E1F6-FC85-456E-8F38-99534BE74492" title="优化程序统计信息首选项设置自动统计信息收集和DBMS_STATS统计信息收集过程使用的参数的默认值。">关于优化程序统计信息首选项</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="props_rev_3"><a id="GUID-E616363F-0A7B-4D4D-9384-63934DB69F7D" name="GUID-E616363F-0A7B-4D4D-9384-63934DB69F7D"></a><h5 id="TGSQL-GUID-E616363F-0A7B-4D4D-9384-63934DB69F7D" class="sect5"><span class="enumeration_section">12.2.1.4</span>统计首选项覆盖</h5>
                     <div>
                        <p><code class="codeph">preference_overrides_parameter</code>统计信息首选项确定在收集优化程序统计信息时是否使用统计信息首选项覆盖参数的输入值。通过这种方式，您可以控制数据库何时遵循传递给统计信息收集过程的参数值。
                        </p>
                        <div class="section">
                           <p>当<code class="codeph">preference_overrides_parameter</code>设置为<code class="codeph">FALSE</code> （默认值）时，将遵循统计信息收集过程的输入值。设置为<code class="codeph">TRUE</code> ，将忽略输入值。
                           </p>
                           <p>使用<code class="codeph">DBMS_STATS</code>的<code class="codeph">SET_TABLE_PREFS</code> ， <code class="codeph">SET_SCHEMA_PREFS</code>或<code class="codeph">SET_GLOBAL_PREFS</code>过程设置<code class="codeph">preference_overrides_parameter</code>选项。无论是否设置了<code class="codeph">preference_overrides_parameter</code> ，数据库都使用相同的优先顺序来设置统计信息：</p>
                           <ol>
                              <li>
                                 <p>表首选项（为特定表设置，模式中的所有表或数据库中的所有表）</p>
                              </li>
                              <li>
                                 <p>全球偏好</p>
                              </li>
                              <li>
                                 <p>默认偏好</p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-E616363F-0A7B-4D4D-9384-63934DB69F7D__GUID-5F64B53B-9688-4B3B-9634-B80CA0DFC591">
                           <p class="titleinexample">示例12-1在表级别覆盖统计信息首选项</p>
                           <p>在此示例中，遗留脚本显式设置<code class="codeph">estimate_percent</code>而不是使用推荐的<code class="codeph">AUTO_SAMPLE_SIZE</code> 。您的目标是阻止用户使用这些脚本在<code class="codeph">sh.costs</code>表上设置首选项。
                           </p>
                           <div class="tblformalwide" id="GUID-E616363F-0A7B-4D4D-9384-63934DB69F7D__CHDFCJBE">
                              <p class="titleintable">表12-2在表级别覆盖统计信息首选项</p>
                              <table cellpadding="4" cellspacing="0" class="FormalWide" title="覆盖表级别的统计信息首选项" width="100%" border="1" summary="This 2 column table lists preference overrides for statistic at the table level. Column 1 is the action. Column 2 describes that action." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="51%" id="d70063e2373">行动</th>
                                       <th align="left" valign="bottom" width="49%" id="d70063e2376">描述</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="51%" id="d70063e2381" headers="d70063e2373 "><pre class="pre codeblock"><code>SQL&gt; SELECT DBMS_STATS.GET_PREFS（'estimate_percent'，'sh'，'costs'）AS“STAT_PREFS”FROM DUAL; STAT_PREFS ---------- DBMS_STATS.AUTO_SAMPLE_SIZE</code></pre></td>
                                       <td align="left" valign="top" width="49%" headers="d70063e2381 d70063e2376 ">
                                          <p>对于无要求<code class="codeph">estimate_percent</code>设置为<code class="codeph">sh.costs</code>或在全球范围内，所以优先默认为<code class="codeph">AUTO_SAMPLE_SIZE</code> 。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="51%" id="d70063e2397" headers="d70063e2373 "><pre class="pre codeblock"><code>SQL&gt; EXEC DBMS_STATS.SET_TABLE_PREFS（'sh'，'cost'，'preference_overrides_parameter'，'true'）; PL / SQL过程成功完成。</code></pre></td>
                                       <td align="left" valign="top" width="49%" headers="d70063e2397 d70063e2376 ">
                                          <p>默认情况下，Oracle数据库接受传递给<code class="codeph">GATHER_*_STATS</code>过程的首选项。要覆盖这些参数，可以使用<code class="codeph">SET_TABLE_PREFS</code>仅为<code class="codeph">costs</code>表将<code class="codeph">preference_overrides_parameter</code>首选项设置为<code class="codeph">true</code> 。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="51%" id="d70063e2419" headers="d70063e2373 "><pre class="pre codeblock"><code>SQL&gt; EXEC DBMS_STATS.GATHER_TABLE_STATS（'sh'，'cost'，estimate_percent =&gt; 100）; PL / SQL过程成功完成。</code></pre></td>
                                       <td align="left" valign="top" width="49%" headers="d70063e2419 d70063e2376 ">
                                          <p>在收集<code class="codeph">sh.costs</code>统计信息时，您尝试将<code class="codeph">estimate_percent</code>设置为<code class="codeph">100</code> 。但是，由于此表的<code class="codeph">preference_overrides_parameter</code>为<code class="codeph">true</code> ，因此Oracle数据库不支持<code class="codeph">estimate_percent=&gt;100</code>设置。相反，数据库使用<code class="codeph">AUTO_SAMPLE_SIZE</code>收集统计信息，这是默认值。
                                          </p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                        </div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-E616363F-0A7B-4D4D-9384-63934DB69F7D__GUID-0DBBA55B-55ED-46A3-9E9B-278DB5309B60">
                           <p class="titleinexample">示例12-2覆盖全局级别的统计信息首选项</p>
                           <p>在这个例子中，您将<code class="codeph">estimate_percent</code>至<code class="codeph">5</code>在全球范围内，这意味着这种偏好适用于所有的表中<span class="italic">没有</span>一个表的首选项集数据库。然后，在<code class="codeph">sh.sales</code>表上设置覆盖，该表没有表级首选项集，以防止用户覆盖其脚本中的全局设置。
                           </p>
                           <div class="tblformalwide" id="GUID-E616363F-0A7B-4D4D-9384-63934DB69F7D__OVERRIDINGSTATISTICSPREFERENCES-A50F5ED1">
                              <p class="titleintable">表12-3覆盖全局级别的统计信息首选项</p>
                              <table cellpadding="4" cellspacing="0" class="FormalWide" title="覆盖全球级别的统计信息首选项" width="100%" border="1" summary="This 2 column table lists preference overrides for statistic at the global level. Column 1 is the action. Column 2 describes that action." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="51%" id="d70063e2474">行动</th>
                                       <th align="left" valign="bottom" width="49%" id="d70063e2477">描述</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="51%" id="d70063e2482" headers="d70063e2474 "><pre class="pre codeblock"><code>SQL&gt; SELECT DBMS_STATS.GET_PREFS（'estimate_percent'，'sh'，'sales'）AS“STAT_PREFS”FROM DUAL; STAT_PREFS ---------- DBMS_STATS.AUTO_SAMPLE_SIZE</code></pre></td>
                                       <td align="left" valign="top" width="49%" headers="d70063e2482 d70063e2477 ">
                                          <p>对于无要求<code class="codeph">estimate_percent</code>设置为<code class="codeph">sh.sales</code>或在全球范围内，所以优先默认为<code class="codeph">AUTO_SAMPLE_SIZE</code> 。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="51%" id="d70063e2498" headers="d70063e2474 "><pre class="pre codeblock"><code>SQL&gt; EXEC DBMS_STATS.SET_GLOBAL_PREFS（'estimate_percent'，'5'）; PL / SQL过程成功完成。</code></pre></td>
                                       <td align="left" valign="top" width="49%" headers="d70063e2498 d70063e2477 ">
                                          <p>对于没有设置表首选项的数据库中的每个表，使用<code class="codeph">SET_GLOBAL_PREFS</code>过程将<code class="codeph">estimate_percent</code>首选项设置为<code class="codeph">5</code> 。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="51%" id="d70063e2514" headers="d70063e2474 "><pre class="pre codeblock"><code>SQL&gt; SELECT DBMS_STATS.GET_PREFS（'estimate_percent'，'sh'，'sales'）AS“STAT_PREFS”FROM DUAL; STAT_PREFS ---------- 5</code></pre></td>
                                       <td align="left" valign="top" width="49%" headers="d70063e2514 d70063e2477 ">
                                          <p>由于<code class="codeph">sh.sales</code>没有首选项集，因此全局设置适用于此表。现在，对<code class="codeph">sh.sales</code>首选项的查询显示<code class="codeph">estimate_percent</code>设置为<code class="codeph">5</code> ，这是全局设置。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="51%" id="d70063e2533" headers="d70063e2474 "><pre class="pre codeblock"><code>SQL&gt; EXEC DBMS_STATS.SET_TABLE_PREFS（'sh'，'sales'，'preference_overrides_parameter'，'true'）; PL / SQL过程成功完成。</code></pre></td>
                                       <td align="left" valign="top" width="49%" headers="d70063e2533 d70063e2477 ">
                                          <p>您可以使用<code class="codeph">SET_TABLE_PREFS</code>仅为<code class="codeph">sh.sales</code>表将<code class="codeph">preference_overrides_parameter</code>选项设置为<code class="codeph">true</code> 。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="51%" id="d70063e2552" headers="d70063e2474 "><pre class="pre codeblock"><code>SQL&gt; EXEC DBMS_STATS.GATHER_TABLE_STATS（'sh'，'sales'，estimate_percent =&gt; 10）; PL / SQL过程成功完成。</code></pre></td>
                                       <td align="left" valign="top" width="49%" headers="d70063e2552 d70063e2477 ">
                                          <p>在收集<code class="codeph">sh.sales</code>统计信息时，您尝试将<code class="codeph">estimate_percent</code>设置为<code class="codeph">10</code> 。但是，由于<code class="codeph">preference_overrides_parameter</code>对于<code class="codeph">sales</code>表为<code class="codeph">true</code> ，并且由于定义了全局首选项，因此Oracle Database实际上使用全局设置<code class="codeph">5</code>收集统计信息。
                                          </p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                        </div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-E616363F-0A7B-4D4D-9384-63934DB69F7D__GUID-648043E0-995E-45B8-A969-819467836F11">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../arpls/DBMS_STATS.html#ARPLS68491" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a> ，了解用于设置优化程序统计信息的<code class="codeph">DBMS_STATS</code>过程</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-E798E1F6-FC85-456E-8F38-99534BE74492" title="优化程序统计信息首选项设置自动统计信息收集和DBMS_STATS统计信息收集过程使用的参数的默认值。">关于优化程序统计信息首选项</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95044"></a><a id="TGSQL95043"></a><div class="props_rev_3"><a id="GUID-FEE5B9A2-413E-42E8-86BF-0C12B818A95C" name="GUID-FEE5B9A2-413E-42E8-86BF-0C12B818A95C"></a><h5 id="TGSQL-GUID-FEE5B9A2-413E-42E8-86BF-0C12B818A95C" class="sect5"><span class="enumeration_section">12.2.1.5</span>设置统计首选项：示例</h5>
                     <div>
                        <p>此示例说明了<code class="codeph">SET_TABLE_PREFS</code> ， <code class="codeph">SET_SCHEMA_STATS</code>和<code class="codeph">SET_DATABASE_PREFS</code>之间的关系。</p>
                        <div class="section">
                           <p></p>
                           <div class="tblformalwide" id="GUID-FEE5B9A2-413E-42E8-86BF-0C12B818A95C__CHDFCJBE">
                              <p class="titleintable">表12-4更改统计信息收集过程的首选项</p>
                              <table cellpadding="4" cellspacing="0" class="FormalWide" title="更改统计信息收集程序的首选项" width="100%" border="1" summary="Changing preferences for statistics" frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="50%" id="d70063e2730">行动</th>
                                       <th align="left" valign="bottom" width="50%" id="d70063e2733">描述</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="50%" id="d70063e2738" headers="d70063e2730 "><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT DBMS_STATS.GET_PREFS（'incremental'，'sh'，'costs'）AS“STAT_PREFS”FROM DUAL; STAT_PREFS ---------- TRUE</pre></td>
                                       <td align="left" valign="top" width="50%" headers="d70063e2738 d70063e2733 ">
                                          <p>您查询<code class="codeph">INCREMENTAL</code>首选项的<code class="codeph">costs</code>并确定它已设置为<code class="codeph">true</code> 。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="50%" id="d70063e2754" headers="d70063e2730 "><pre class="oac_no_warn" dir="ltr">SQL&gt; EXEC DBMS_STATS.SET_TABLE_PREFS（'sh'，'cost'，'incremental'，'false'）; PL / SQL过程成功完成。</pre></td>
                                       <td align="left" valign="top" width="50%" headers="d70063e2754 d70063e2733 ">
                                          <p>使用<code class="codeph">SET_TABLE_PREFS</code>仅为<code class="codeph">costs</code>表将<code class="codeph">INCREMENTAL</code>首选项设置为<code class="codeph">false</code> 。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="50%" id="d70063e2773" headers="d70063e2730 "><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT DBMS_STATS.GET_PREFS（'incremental'，'sh'，'costs'）AS“STAT_PREFS”FROM DUAL; STAT_PREFS ---------- FALSE</pre></td>
                                       <td align="left" valign="top" width="50%" headers="d70063e2773 d70063e2733 ">
                                          <p>您查询<code class="codeph">INCREMENTAL</code>首选项的<code class="codeph">costs</code>并确认它已设置为<code class="codeph">false</code> 。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="50%" id="d70063e2789" headers="d70063e2730 "><pre class="oac_no_warn" dir="ltr">SQL&gt; EXEC DBMS_STATS.SET_SCHEMA_PREFS（'sh'，'incremental'，'true'）; PL / SQL过程成功完成。</pre></td>
                                       <td align="left" valign="top" width="50%" headers="d70063e2789 d70063e2733 ">
                                          <p>对于<code class="codeph">sh</code>模式中的每个表，使用<code class="codeph">SET_SCHEMA_PREFS</code>将<code class="codeph">INCREMENTAL</code>首选项设置为<code class="codeph">true</code> ，包括<code class="codeph">costs</code> 。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="50%" id="d70063e2811" headers="d70063e2730 "><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT DBMS_STATS.GET_PREFS（'incremental'，'sh'，'costs'）AS“STAT_PREFS”FROM DUAL; STAT_PREFS ---------- TRUE</pre></td>
                                       <td align="left" valign="top" width="50%" headers="d70063e2811 d70063e2733 ">
                                          <p>您查询<code class="codeph">INCREMENTAL</code>首选项的<code class="codeph">costs</code>并确认它已设置为<code class="codeph">true</code> 。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="50%" id="d70063e2827" headers="d70063e2730 "><pre class="oac_no_warn" dir="ltr">SQL&gt; EXEC DBMS_STATS.SET_DATABASE_PREFS（'incremental'，'false'）; PL / SQL过程成功完成。</pre></td>
                                       <td align="left" valign="top" width="50%" headers="d70063e2827 d70063e2733 ">
                                          <p>使用<code class="codeph">SET_DATABASE_PREFS</code>将所有用户定义的模式中的所有表的<code class="codeph">INCREMENTAL</code>首选项设置为<code class="codeph">false</code> 。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="50%" id="d70063e2843" headers="d70063e2730 "><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT DBMS_STATS.GET_PREFS（'incremental'，'sh'，'costs'）AS“STAT_PREFS”FROM DUAL; STAT_PREFS ---------- FALSE</pre></td>
                                       <td align="left" valign="top" width="50%" headers="d70063e2843 d70063e2733 ">
                                          <p>您查询<code class="codeph">INCREMENTAL</code>首选项的<code class="codeph">costs</code>并确认它已设置为<code class="codeph">false</code> 。
                                          </p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-E798E1F6-FC85-456E-8F38-99534BE74492" title="优化程序统计信息首选项设置自动统计信息收集和DBMS_STATS统计信息收集过程使用的参数的默认值。">关于优化程序统计信息首选项</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL402"></a><div class="props_rev_3"><a id="GUID-777704A7-3751-4720-957E-6C916FD36917" name="GUID-777704A7-3751-4720-957E-6C916FD36917"></a><h4 id="TGSQL-GUID-777704A7-3751-4720-957E-6C916FD36917" class="sect4"><span class="enumeration_section">12.2.2</span>使用云控制设置全局优化器统计信息首选项</h4>
                  <div>
                     <p>全局优先适用于任何对象中<span class="italic">不</span>具有现有的表偏好的数据库。您可以使用Cloud Control在全局级别设置优化程序统计信息首选项。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-777704A7-3751-4720-957E-6C916FD36917__GUID-5E5A083B-2156-4CCA-89FD-FF0315A8E4D7">要使用Cloud Control设置全局优化程序统计信息首选项：</p>
                        <ol>
                           <li>
                              <p>在Cloud Control中，访问“ <span>数据库主页</span> ”。
                              </p>
                           </li>
                           <li>
                              <p>从<span class="bold">Performance</span>菜单中，选择<span class="bold">SQL</span> ，然后选择<span class="bold">Optimizer Statistics</span> 。
                              </p>
                              <p>出现Optimizer Statistics控制台。</p>
                           </li>
                           <li>
                              <p>单击“ <span class="bold">全局统计信息收集选项”</span> 。
                              </p>
                              <p>将显示“全局统计信息收集选项”页面。</p>
                           </li>
                           <li>
                              <p>进行所需的更改，然后单击“ <span class="bold">应用”</span> 。
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section"></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-777704A7-3751-4720-957E-6C916FD36917__GUID-D68AC8C4-FE4D-4616-B4AE-E040037F76BC">
                        <p class="notep1">也可以看看：</p>
                        <p>Oracle企业管理器云控制的在线帮助</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-4FDDBCB2-1DA1-4697-9F07-5AB7DE01D682" title="本主题说明如何使用DBMS_STATS.SET _ * _ PREFS过程设置优化程序统计信息缺省值。">设置优化程序统计信息首选项</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL403"></a><div class="props_rev_3"><a id="GUID-99A31FC1-56F1-4F30-8D0E-156602D4983C" name="GUID-99A31FC1-56F1-4F30-8D0E-156602D4983C"></a><h4 id="TGSQL-GUID-99A31FC1-56F1-4F30-8D0E-156602D4983C" class="sect4"><span class="enumeration_section">12.2.3</span>使用云控制设置对象级优化器统计信息首选项</h4>
                  <div>
                     <p>您可以使用Cloud Control在数据库，架构和表级别设置优化程序统计信息首选项。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-99A31FC1-56F1-4F30-8D0E-156602D4983C__GUID-283B40D6-A3F3-4AB1-97A4-74221984F6A8">要使用Cloud Control设置对象级优化程序统计信息首选项：</p>
                        <ol>
                           <li>
                              <p>在Cloud Control中，访问“ <span>数据库主页</span> ”。
                              </p>
                           </li>
                           <li>
                              <p>从<span class="bold">Performance</span>菜单中，选择<span class="bold">SQL</span> ，然后选择<span class="bold">Optimizer Statistics</span> 。
                              </p>
                              <p>出现Optimizer Statistics控制台。</p>
                           </li>
                           <li>
                              <p>单击<span class="bold">对象级统计信息收集首选项</span> 。
                              </p>
                              <p>将出现“对象级统计信息收集首选项”页面。</p>
                           </li>
                           <li>
                              <p>要修改在表级别设置了首选项的表的表首选项，请执行以下操作（否则，请跳至下一步）：</p>
                              <ol type="a">
                                 <li>
                                    <p>在<span class="bold">Schema</span>和<span class="bold">Table Name中</span>输入值。将<span class="bold">表名</span>保留为空以查看架构中的所有表。
                                    </p>
                                    <p>页面刷新表名。</p>
                                 </li>
                                 <li>
                                    <p>选择所需的表，然后单击<span class="bold">编辑首选项</span> 。
                                    </p>
                                    <p>将出现“编辑首选项”页面的“常规”子页面。</p>
                                 </li>
                                 <li>
                                    <p>根据需要更改首选项，然后单击<span class="bold">Apply</span> 。
                                    </p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>要为<span class="italic">没有</span>在表级别设置首选项的表设置首选项，请执行以下操作（否则，请跳至下一步）：</p>
                              <ol type="a">
                                 <li>
                                    <p>单击<span class="bold">添加表首选项</span> 。
                                    </p>
                                    <p>将出现“添加表首选项”页面的“常规”子页面。</p>
                                 </li>
                                 <li>
                                    <p>在<span class="bold">表名称中</span> ，输入架构和表名称。
                                    </p>
                                 </li>
                                 <li>
                                    <p>根据需要更改首选项，然后单击<span class="bold">确定</span></p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>要设置架构的首选项，请执行以下操作：</p>
                              <ol type="a">
                                 <li>
                                    <p>单击“ <span class="bold">设置架构表首选项”</span> 。
                                    </p>
                                    <p>将出现“编辑架构首选项”页面的“常规”子页面。</p>
                                 </li>
                                 <li>
                                    <p>在<span class="bold">Schema中</span> ，输入模式名称。
                                    </p>
                                 </li>
                                 <li>
                                    <p>根据需要更改首选项，然后单击<span class="bold">确定</span></p>
                                 </li>
                              </ol>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section"></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-99A31FC1-56F1-4F30-8D0E-156602D4983C__GUID-958A1E85-1B05-4B32-BCEC-C39ABE33884A">
                        <p class="notep1">也可以看看：</p>
                        <p>Oracle企业管理器云控制的在线帮助</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-4FDDBCB2-1DA1-4697-9F07-5AB7DE01D682" title="本主题说明如何使用DBMS_STATS.SET _ * _ PREFS过程设置优化程序统计信息缺省值。">设置优化程序统计信息首选项</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL405"></a><a id="TGSQL404"></a><div class="props_rev_3"><a id="GUID-C644102E-0E5B-4CC8-96B6-F3F34200BE34" name="GUID-C644102E-0E5B-4CC8-96B6-F3F34200BE34"></a><h4 id="TGSQL-GUID-C644102E-0E5B-4CC8-96B6-F3F34200BE34" class="sect4"><span class="enumeration_section">12.2.4</span>从命令行设置优化程序统计信息首选项</h4>
                  <div>
                     <p>如果不使用Cloud Control设置优化程序统计信息首选项，则可以从命令行调用<code class="codeph">DBMS_STATS</code>过程。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-C644102E-0E5B-4CC8-96B6-F3F34200BE34__GUID-25E7B66E-7E21-48E8-BEC9-FAAF05011D4D">先决条件</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>此任务具有以下先决条件：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>要设置全局或数据库首选项，您必须具有<code class="codeph">SYSDBA</code>权限，或同时具有<code class="codeph">ANALYZE ANY DICTIONARY</code>和<code class="codeph">ANALYZE ANY</code>系统权限。
                              </p>
                           </li>
                           <li>
                              <p>要设置架构首选项，您必须以所有者身份连接，或具有<code class="codeph">SYSDBA</code>权限，或具有<code class="codeph">ANALYZE ANY</code>系统权限。
                              </p>
                           </li>
                           <li>
                              <p>要设置表首选项，您必须以表的所有者身份连接或具有<code class="codeph">ANALYZE ANY</code>系统特权。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C644102E-0E5B-4CC8-96B6-F3F34200BE34__GUID-83ED884D-F953-44C5-8460-4F851C742401">要从命令行设置优化程序统计信息首选项：</p>
                        <ol>
                           <li>
                              <p id="GUID-C644102E-0E5B-4CC8-96B6-F3F34200BE34__d5e29">在SQL * Plus或SQL Developer中，以具有必要权限的用户身份登录数据库。</p>
                           </li>
                           <li>
                              <p>（可选）调用<code class="codeph">DBMS_STATS.GET_PREFS</code>过程以查看在对象级别设置的首选项，如果未设置特定表，则调用全局级别。
                              </p>
                              <p>例如，获取<code class="codeph">sh.sales</code>表的<code class="codeph">STALE_PERCENT</code>参数设置，如下所示：</p><pre class="pre codeblock"><code>从DUAL中选择DBMS_STATS.GET_PREFS（'STALE_PERCENT'，'SH'，'SALES'）;</code></pre></li>
                           <li>
                              <p>执行<a href="options-for-optimizer-statistics-gathering.html#GUID-61F0ECF1-8B91-4509-B0D9-82879DB6F545__CHDDJJJI" title="此2列表显示了用于设置优化程序统计信息首选项的DBMS_STATS过程。第1列是程序。第2列是范围。">表12-1中</a>的相应过程，指定以下参数：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">ownname</code> - 设置模式名称（ <code class="codeph">SET_TAB_PREFS</code>和<code class="codeph">SET_SCHEMA_PREFS</code> ）</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">tabname</code> - 设置表名（ <code class="codeph">SET_TAB_PREFS</code> ）</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">pname</code> - 设置参数名称</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">pvalue</code> - 设置参数值</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">add_sys</code> - 包含系统表（可选， <code class="codeph">SET_DATABASE_PREFS</code> ）</p>
                                 </li>
                              </ul>
                              <p>以下示例指定在将该表上的统计信息视为过时之前， <code class="codeph">sh.sales</code>中13％的行必须更改：</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.SET_TABLE_PREFS（'SH'，'SALES'，'STALE_PERCENT'，'13'）;</code></pre></li>
                           <li>
                              <p>（可选）查询<code class="codeph">*_TAB_STAT_PREFS</code>视图以确认更改。
                              </p>
                              <p>例如，查询<code class="codeph">DBA_TAB_STAT_PREFS</code>如下：</p><pre class="pre codeblock"><code>COL OWNER FORMAT a5 COL TABLE_NAME FORMAT a15 COL PREFERENCE_NAME格式a20 COL PREFERENCE_VALUE FORMAT a30 SELECT * FROM DBA_TAB_STAT_PREFS;</code></pre><p>示例输出显示如下：</p><pre class="pre codeblock"><code>OWNER TABLE_NAME PREFERENCE_NAME PREFERENCE_VALUE ----- --------------- -------------------- ------ ------------------------ OE CUSTOMERS NO_INVALIDATE DBMS_STATS.AUTO_INVALIDATE SH SALES STALE_PERCENT 13</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-C644102E-0E5B-4CC8-96B6-F3F34200BE34__GUID-B3EB8E62-89A5-4CB7-AC14-DF0BAA1EC25F">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-CDAA4742-5398-4A64-B871-E39F38D0021F" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>用于描述程序单元的参数名称和值</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-4FDDBCB2-1DA1-4697-9F07-5AB7DE01D682" title="本主题说明如何使用DBMS_STATS.SET _ * _ PREFS过程设置优化程序统计信息缺省值。">设置优化程序统计信息首选项</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL450"></a><div class="props_rev_3"><a id="GUID-F1C666DC-5450-4F92-83AA-607327DB5FD8" name="GUID-F1C666DC-5450-4F92-83AA-607327DB5FD8"></a><h3 id="TGSQL-GUID-F1C666DC-5450-4F92-83AA-607327DB5FD8" class="sect3"><span class="enumeration_section">12.3</span>配置动态统计选项</h3>
               <div>
                  <p><strong class="term">动态统计</strong>是一种优化技术，其中数据库使用递归SQL扫描表中块的小随机样本。
                  </p>
                  <p>样本扫描估计谓词选择性。使用这些估算值，数据库可确定未分析段的更好的默认统计信息，并验证其估算值。默认情况下，当优化程序统计信息丢失，过时或不足时， <a href="glossary.html#GUID-453737A7-931A-49D1-AA5C-AFB14D9837FB"><span class="xrefglossterm">动态统计信息会</span></a>在<a href="glossary.html#GUID-6E4480E1-4274-499C-B582-2A089D2914DC"><span class="xrefglossterm">解析</span></a>期间自动运行<a href="glossary.html#GUID-4BBB2EED-7E8C-4BAF-A3B3-B1CEF98342AC"><span class="xrefglossterm">递归SQL</span></a> ，以扫描表块的一小部分随机样本。
                  </p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-DEE2AF8B-5F4B-4FE7-9F0E-7D188921EBCC">关于动态统计级别</a><br><strong class="term">动态统计级别</strong>控制数据库何时收集动态统计信息以及优化程序用于收集统计信息的样本大小。
                     </li>
                     <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-B92327C9-9B33-4E9C-8813-7E7BC86202C3">手动设置动态统计级别</a><br>确定对所有SQL语句有益的数据库级设置可能很困难。
                     </li>
                     <li class="ulchildlink"><a href="options-for-optimizer-statistics-gathering.html#GUID-0D188B48-179D-4496-AEB8-C46016D5D0B2">禁用动态统计信息</a><br>通常，最佳做法是不要为编译时间必须尽可能快的查询（例如，未重复的OLTP查询）产生动态统计信息的成本。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-2044960C-025B-44FC-9522-63F426C74386" title="本章介绍优化程序统计信息收集的内容以及如何设置统计信息首选项。">配置优化程序统计信息收集的选项</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL452"></a><a id="TGSQL451"></a><div class="props_rev_3"><a id="GUID-DEE2AF8B-5F4B-4FE7-9F0E-7D188921EBCC" name="GUID-DEE2AF8B-5F4B-4FE7-9F0E-7D188921EBCC"></a><h4 id="TGSQL-GUID-DEE2AF8B-5F4B-4FE7-9F0E-7D188921EBCC" class="sect4"><span class="enumeration_section">12.3.1</span>关于动态统计级别</h4>
                  <div>
                     <p><strong class="term">动态统计级别</strong>控制数据库何时收集动态统计信息以及优化程序用于收集统计信息的样本大小。
                     </p>
                     <p>使用<code class="codeph">OPTIMIZER_DYNAMIC_SAMPLING</code>初始化参数或语句提示设置动态统计级别。
                     </p>
                     <div class="infoboxnote" id="GUID-DEE2AF8B-5F4B-4FE7-9F0E-7D188921EBCC__GUID-0FBEED2B-6D7C-45B8-A3EE-4401CF75FFE3">
                        <p class="notep1">注意：</p>
                        <p>动态统计在早于<span>Oracle Database 12c</span>第1版（12.1）的版本中称为<span class="italic">动态采样</span> 。
                        </p>
                     </div>
                     <p>下表介绍了动态统计信息的级别。请注意以下事项：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>如果<code class="codeph">OPTIMIZER_DYNAMIC_STATISTICS</code>为<code class="codeph">TRUE</code> ，并且未禁用动态统计信息，则当SQL语句使用并行执行时，数据库可以选择使用动态统计信息。
                           </p>
                        </li>
                        <li>
                           <p>如果<code class="codeph">OPTIMIZER_ADAPTIVE_STATISTICS</code>为<code class="codeph">TRUE</code> ，则优化程序在存在相关SQL计划指令时使用动态统计信息。数据库在SQL计划指令存储中维护生成的统计信息，使其可用于其他查询。
                           </p>
                        </li>
                     </ul>
                     <div class="tblformalwide" id="GUID-DEE2AF8B-5F4B-4FE7-9F0E-7D188921EBCC__CHDFEHGA">
                        <p class="titleintable">表12-5动态统计级别</p>
                        <table cellpadding="4" cellspacing="0" class="FormalWide" title="动态统计级别" width="100%" border="1" summary="Dynamic sampling levels" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="9%" id="d70063e3848">水平</th>
                                 <th align="left" valign="bottom" width="60%" id="d70063e3851">优化程序使用动态统计信息时</th>
                                 <th align="left" valign="bottom" width="32%" id="d70063e3854">样本大小（块）</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="9%" id="d70063e3859" headers="d70063e3848 ">
                                    <p>0</p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d70063e3859 d70063e3851 ">
                                    <p>不要使用动态统计信息。</p>
                                 </td>
                                 <td align="left" valign="top" width="32%" headers="d70063e3859 d70063e3854 ">
                                    <p>N / A</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="9%" id="d70063e3869" headers="d70063e3848 ">
                                    <p>1</p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d70063e3869 d70063e3851 ">
                                    <p>对所有没有统计信息的表使用动态统计信息，但仅在满足以下条件时使用：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p>查询中至少有一个非分区表没有统计信息。</p>
                                       </li>
                                       <li>
                                          <p>该表没有索引。</p>
                                       </li>
                                       <li>
                                          <p>此表的块数多于用于此表的动态统计信息的块数。</p>
                                       </li>
                                    </ul>
                                 </td>
                                 <td align="left" valign="top" width="32%" headers="d70063e3869 d70063e3854 ">
                                    <p>32</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="9%" id="d70063e3889" headers="d70063e3848 ">
                                    <p>2</p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d70063e3889 d70063e3851 ">
                                    <p>如果语句中至少有一个表没有统计信息，请使用动态统计信息。这是默认值。</p>
                                 </td>
                                 <td align="left" valign="top" width="32%" headers="d70063e3889 d70063e3854 ">
                                    <p>64</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="9%" id="d70063e3899" headers="d70063e3848 ">
                                    <p>3</p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d70063e3899 d70063e3851 ">
                                    <p>如果满足以下任一条件，请使用动态统计信息：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p>语句中至少有一个表没有统计信息。</p>
                                       </li>
                                       <li>
                                          <p>该语句在<code class="codeph">WHERE</code>子句谓词中使用了一个或多个表达式，例如<code class="codeph">WHERE SUBSTR(CUSTLASTNAME,1,3)</code> 。
                                          </p>
                                       </li>
                                    </ul>
                                 </td>
                                 <td align="left" valign="top" width="32%" headers="d70063e3899 d70063e3854 ">
                                    <p>64</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="9%" id="d70063e3922" headers="d70063e3848 ">
                                    <p>4</p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d70063e3922 d70063e3851 ">
                                    <p>如果满足以下任一条件，请使用动态统计信息：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p>语句中至少有一个表没有统计信息。</p>
                                       </li>
                                       <li>
                                          <p>该语句在<code class="codeph">WHERE</code>子句谓词中使用了一个或多个表达式，例如<code class="codeph">WHERE SUBSTR(CUSTLASTNAME,1,3)</code> 。
                                          </p>
                                       </li>
                                       <li>
                                          <p>该语句使用复杂谓词（同一个表上多个谓词之间的<code class="codeph">OR</code>或<code class="codeph">AND</code>运算符）。
                                          </p>
                                       </li>
                                    </ul>
                                 </td>
                                 <td align="left" valign="top" width="32%" headers="d70063e3922 d70063e3854 ">
                                    <p>64</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="9%" id="d70063e3954" headers="d70063e3848 ">
                                    <p>五</p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d70063e3954 d70063e3851 ">
                                    <p>标准与级别4相同，但数据库使用不同的样本大小。</p>
                                 </td>
                                 <td align="left" valign="top" width="32%" headers="d70063e3954 d70063e3854 ">
                                    <p>128</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="9%" id="d70063e3964" headers="d70063e3848 ">
                                    <p>6</p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d70063e3964 d70063e3851 ">
                                    <p>标准与级别4相同，但数据库使用不同的样本大小。</p>
                                 </td>
                                 <td align="left" valign="top" width="32%" headers="d70063e3964 d70063e3854 ">
                                    <p>256</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="9%" id="d70063e3974" headers="d70063e3848 ">
                                    <p>7</p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d70063e3974 d70063e3851 ">
                                    <p>标准与级别4相同，但数据库使用不同的样本大小。</p>
                                 </td>
                                 <td align="left" valign="top" width="32%" headers="d70063e3974 d70063e3854 ">
                                    <p>512</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="9%" id="d70063e3984" headers="d70063e3848 ">
                                    <p>8</p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d70063e3984 d70063e3851 ">
                                    <p>标准与级别4相同，但数据库使用不同的样本大小。</p>
                                 </td>
                                 <td align="left" valign="top" width="32%" headers="d70063e3984 d70063e3854 ">
                                    <p>1024</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="9%" id="d70063e3994" headers="d70063e3848 ">
                                    <p>9</p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d70063e3994 d70063e3851 ">
                                    <p>标准与级别4相同，但数据库使用不同的样本大小。</p>
                                 </td>
                                 <td align="left" valign="top" width="32%" headers="d70063e3994 d70063e3854 ">
                                    <p>4086</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="9%" id="d70063e4004" headers="d70063e3848 ">
                                    <p>10</p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d70063e4004 d70063e3851 ">
                                    <p>标准与级别4相同，但数据库使用不同的样本大小。</p>
                                 </td>
                                 <td align="left" valign="top" width="32%" headers="d70063e4004 d70063e3854 ">
                                    <p>所有街区</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="9%" id="d70063e4015" headers="d70063e3848 ">
                                    <p>11</p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d70063e4015 d70063e3851 ">
                                    <p>当优化器认为有必要时，数据库会自动使用自适应动态采样。</p>
                                 </td>
                                 <td align="left" valign="top" width="32%" headers="d70063e4015 d70063e3854 ">
                                    <p>自动确定</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-DEE2AF8B-5F4B-4FE7-9F0E-7D188921EBCC__GUID-A8492C7F-8BAE-4F0A-9D14-CCC88449572A">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="optimizer-statistics-concepts.html#GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9" title="从Oracle Database 12c开始，优化程序会自动确定动态统计信息是否有用以及用于所有SQL语句的样本大小。">当数据库样本数据时</a> ”</span></p>
                           </li>
                           <li>
                              <p><a href="../refrn/OPTIMIZER_DYNAMIC_SAMPLING.html#REFRN10140" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">OPTIMIZER_DYNAMIC_SAMPLING</code>初始化参数</p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-F1C666DC-5450-4F92-83AA-607327DB5FD8" title="动态统计是一种优化技术，其中数据库使用递归SQL扫描表中块的小随机样本。">配置动态统计信息的选项</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL454"></a><a id="TGSQL453"></a><div class="props_rev_3"><a id="GUID-B92327C9-9B33-4E9C-8813-7E7BC86202C3" name="GUID-B92327C9-9B33-4E9C-8813-7E7BC86202C3"></a><h4 id="TGSQL-GUID-B92327C9-9B33-4E9C-8813-7E7BC86202C3" class="sect4"><span class="enumeration_section">12.3.2</span>手动设置动态统计级别</h4>
                  <div>
                     <p>确定对所有SQL语句有益的数据库级设置可能很困难。</p>
                     <div class="section">设置动态统计信息的级别时，Oracle建议在会话级别设置<code class="codeph">OPTIMIZER_DYNAMIC_SAMPLING</code>初始化参数。
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-B92327C9-9B33-4E9C-8813-7E7BC86202C3__GUID-C8D20E3D-053A-46BA-A2C7-D6D9B97C348B">假设</p>
                        <p>本教程假设以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您希望对以下查询进行正确的选择性估计，该查询在两个相关列上具有<code class="codeph">WHERE</code>子句谓词：</p><pre class="pre codeblock"><code>SELECT * FROM sh.customers WHERE cust_city ='洛杉矶'和cust_state_province ='CA';</code></pre></li>
                           <li>
                              <p>前面的查询使用串行处理。</p>
                           </li>
                           <li>
                              <p><code class="codeph">sh.customers</code>表包含符合查询条件的932行。
                              </p>
                           </li>
                           <li>
                              <p>您已经收集了<code class="codeph">sh.customers</code>表的统计信息。
                              </p>
                           </li>
                           <li>
                              <p>您在<code class="codeph">cust_city</code>和<code class="codeph">cust_state_province</code>列上创建了一个索引。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">OPTIMIZER_DYNAMIC_SAMPLING</code>初始化参数设置为默认级别<code class="codeph">2</code> 。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-B92327C9-9B33-4E9C-8813-7E7BC86202C3__GUID-CDB3694B-3469-4E13-9E80-6FA3DE1B6E56">要手动设置动态统计级别：</p>
                        <ol>
                           <li>
                              <p id="GUID-B92327C9-9B33-4E9C-8813-7E7BC86202C3__d5e29">在SQL * Plus或SQL Developer中，以具有必要权限的用户身份登录数据库。</p>
                           </li>
                           <li>
                              <p>解释执行计划如下：</p><pre class="pre codeblock"><code>来自sh.customers的解析计划WHERE cust_city ='洛杉矶'和cust_state_province ='CA';</code></pre></li>
                           <li>
                              <p>查询计划如下：</p><pre class="pre codeblock"><code>SET LINESIZE 130 SET PAGESIZE 0 SELECT * FROM TABLE（DBMS_XPLAN.DISPLAY）;</code></pre><p>输出显示在下面（示例已重新格式化以适合页面）：</p><pre class="pre codeblock"><code>-------------------------------------------------- ----------------------------- | Id |操作|名称|行|字节|成本|时间| -------------------------------------------------- ----------------------------- | 0 |选择声明| | <span class="bold">53</span> | 9593 | 53（0）| 00：00：01 | | 1 |通过INDEX ROWID表示访问权限|客户| <span class="bold">53</span> | 9593 | 53（0）| 00：00：01 | | * 2 | INDEX RANGE SCAN | CUST_CITY_STATE_IND | <span class="bold">53</span> | 9593 | 3（0）| 00：00：01 | -------------------------------------------------- -----------------------------谓词信息（由操作ID标识）：------------ --------------------------------------- 2  -  access（“CUST_CITY”='洛杉矶'AND“CUST_STATE_PROVINCE”='CA'）</code></pre><p><code class="codeph">WHERE</code>子句中的列具有实际关联，但优化器不知道洛杉矶位于加利福尼亚，并假设两个谓词都减少了返回的行数。因此，该表包含符合条件的932行，但优化程序估计53，如粗体所示。
                              </p>
                              <p>如果数据库已使用此计划的动态统计信息，则计划输出的“ <code class="codeph">Note</code>部分将指示此事实。优化程序未使用动态统计信息，因为语句是串行执行的，存在标准统计信息，参数<code class="codeph">OPTIMIZER_DYNAMIC_SAMPLING</code>设置为默认值<code class="codeph">2</code> 。
                              </p>
                           </li>
                           <li>
                              <p>使用以下语句将会话中的动态统计级别设置为<code class="codeph">4</code> ：</p><pre class="pre codeblock"><code>ALTER SESSION SET OPTIMIZER_DYNAMIC_SAMPLING = 4;</code></pre></li>
                           <li>
                              <p>再次解释计划：</p><pre class="pre codeblock"><code>来自sh.customers的解析计划WHERE cust_city ='洛杉矶'和cust_state_province ='CA';</code></pre><p>新计划显示了更准确的行数估计值，如粗体值932所示：</p><pre class="pre codeblock"><code>PLAN_TABLE_OUTPUT ------------------------------------------------- --------------------------计划哈希值：2008213504 ------------------- -------------------------------------------------- ------ | Id |操作|名称|行|字节|成本（％CPU）|时间| -------------------------------------------------- ------------------------- | 0 |选择声明| | <span class="bold">932</span> | 271K | 406（1）| 00:00:05 | | * 1 |表访问完全|客户| <span class="bold">932</span> | 271K | 406（1）| 00:00:05 | -------------------------------------------------- -------------------------谓词信息（由操作ID标识）：---------------- ----------------------------------- 1  -  filter（“CUST_CITY”='洛杉矶'和'CUST_STATE_PROVINCE “='CA'）注意-----  - <span class="bold">用于此语句的动态统计信息（级别= 4）</span>
</code></pre><p>计划底部的注释表明抽样水平为<code class="codeph">4</code> 。额外的动态统计信息使优化器了解<code class="codeph">cust_city</code>和<code class="codeph">cust_state_province</code>列之间的真实世界关系，从而使其能够更准确地估计行数：932而不是53。
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-B92327C9-9B33-4E9C-8813-7E7BC86202C3__GUID-7BB2F27F-3AE9-469F-9C9B-3CB2D803B4D4">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="../sqlrf/Comments.html#SQLRF50913" target="_blank"><span><cite>Oracle Database SQL语言参考</cite></span></a> ，了解如何使用<code class="codeph">DYNAMIC_SAMPLING</code>提示设置采样级别</p>
                           </li>
                           <li>
                              <p><a href="../refrn/OPTIMIZER_DYNAMIC_SAMPLING.html#REFRN10140" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">OPTIMIZER_DYNAMIC_SAMPLING</code>初始化参数</p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-F1C666DC-5450-4F92-83AA-607327DB5FD8" title="动态统计是一种优化技术，其中数据库使用递归SQL扫描表中块的小随机样本。">配置动态统计信息的选项</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL455"></a><div class="props_rev_3"><a id="GUID-0D188B48-179D-4496-AEB8-C46016D5D0B2" name="GUID-0D188B48-179D-4496-AEB8-C46016D5D0B2"></a><h4 id="TGSQL-GUID-0D188B48-179D-4496-AEB8-C46016D5D0B2" class="sect4"><span class="enumeration_section">12.3.3</span>禁用动态统计</h4>
                  <div>
                     <p>通常，最佳做法是不要为编译时间必须尽可能快的查询（例如，未重复的OLTP查询）产生动态统计信息的成本。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-0D188B48-179D-4496-AEB8-C46016D5D0B2__GUID-1CC6CFA2-49F5-46E1-9143-B16528309A57">要在会话级别禁用动态统计信息：</p>
                        <ol>
                           <li>
                              <p>使用适当的权限将SQL * Plus连接到数据库。</p>
                           </li>
                           <li>
                              <p>将动态统计级别设置为<code class="codeph">0</code> 。
                              </p>
                              <p>例如，运行以下语句：</p><pre class="pre codeblock"><code>ALTER SESSION SET OPTIMIZER_DYNAMIC_SAMPLING = 0;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section"></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-0D188B48-179D-4496-AEB8-C46016D5D0B2__GUID-A077E070-1D89-485F-9365-BF9B8DA33F15">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../refrn/OPTIMIZER_DYNAMIC_SAMPLING.html#REFRN10140" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">OPTIMIZER_DYNAMIC_SAMPLING</code>初始化参数</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-F1C666DC-5450-4F92-83AA-607327DB5FD8" title="动态统计是一种优化技术，其中数据库使用递归SQL扫描表中块的小随机样本。">配置动态统计信息的选项</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL95103"></a><a id="TGSQL95104"></a><a id="TGSQL95105"></a><a id="TGSQL95106"></a><a id="TGSQL95102"></a><div class="props_rev_3"><a id="GUID-67E635AA-F168-47D7-9DC9-CE8803464B6E" name="GUID-67E635AA-F168-47D7-9DC9-CE8803464B6E"></a><h3 id="TGSQL-GUID-67E635AA-F168-47D7-9DC9-CE8803464B6E" class="sect3"><span class="enumeration_section">12.4</span>管理SQL计划指令</h3>
               <div>
                  <p><span class="bold">SQL计划指令</span>是优化程序可用于生成更优计划的附加信息和指令。
                  </p>
                  <div class="section">
                     <p>指令通知数据库优化器是某些类型谓词的基本基数，并警告<code class="codeph">DBMS_STATS</code>以便将来收集其他统计信息。因此，指令对统计数据收集有影响。
                     </p>
                     <p>数据库自动在SGA中创建和管理SQL计划指令，然后定期将它们写入数据字典。如果指令在53周内未使用，则数据库会自动清除它们。</p>
                     <p>您可以使用<code class="codeph">DBMS_SPD</code>过程和函数手动更改，保存，删除和传输指令。下表列出了一些更常用的过程和函数。
                     </p>
                     <div class="tblformal" id="GUID-67E635AA-F168-47D7-9DC9-CE8803464B6E__CHDEEGEG">
                        <p class="titleintable">表12-6 DBMS_SPD过程</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_SPD程序" width="100%" border="1" summary="This 2 column table lists DBMS_SPD restore procedures. Column 1 is the procedure. Column 2 describes that procedure. " frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="40%" id="d70063e4627">程序</th>
                                 <th align="left" valign="bottom" width="60%" id="d70063e4630">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="40%" id="d70063e4635" headers="d70063e4627 ">
                                    <p><code class="codeph">FLUSH_SQL_PLAN_DIRECTIVE</code></p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d70063e4635 d70063e4630 ">
                                    <p>强制数据库将指令从内存写入<code class="codeph">SYSAUX</code>表空间中的持久存储。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="40%" id="d70063e4646" headers="d70063e4627 ">
                                    <p><code class="codeph">DROP_SQL_PLAN_DIRECTIVE</code></p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d70063e4646 d70063e4630 ">
                                    <p>删除SQL计划指令。如果触发动态采样的指令正在创建不可接受的性能开销，那么您可能希望手动删除它。</p>
                                    <p>如果手动或自动删除SQL计划指令，则数据库可以重新创建它。要防止重新创建，可以使用<code class="codeph">DBMS_SPM.ALTER_SQL_PLAN_DIRECTIVE</code>执行以下操作：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p>通过将<code class="codeph">ENABLED</code>设置为<code class="codeph">NO</code>来禁用该指令</p>
                                       </li>
                                       <li>
                                          <p>通过将<code class="codeph">AUTO_DROP</code>设置为<code class="codeph">NO</code>来防止删除指令</p>
                                       </li>
                                    </ul>
                                    <p>要禁用SQL计划指令，请将<code class="codeph">OPTIMIZER_ADAPTIVE_STATISTICS</code>设置为<code class="codeph">FALSE</code> 。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-67E635AA-F168-47D7-9DC9-CE8803464B6E__GUID-80CFA0F0-1875-42BC-8469-6535CB8F1F43">先决条件</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>您必须具有“管理SQL管理对象”权限才能执行<code class="codeph">DBMS_SPD</code> API。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-67E635AA-F168-47D7-9DC9-CE8803464B6E__GUID-2E937CC1-1A15-4373-A6EA-69BF4BAE276A">假设</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>本教程假定您要执行以下操作：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>将<code class="codeph">sh</code>模式的所有指令写入持久存储。
                           </p>
                        </li>
                        <li>
                           <p>删除<code class="codeph">sh</code>模式的所有指令。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-67E635AA-F168-47D7-9DC9-CE8803464B6E__GUID-1338E18C-CA4B-4DC7-8D30-26AEDCDD56BB">要编写然后删除所有sh schema计划指令：</p>
                     <ol>
                        <li>
                           <p id="GUID-67E635AA-F168-47D7-9DC9-CE8803464B6E__d5e29">在SQL * Plus或SQL Developer中，以具有必要权限的用户身份登录数据库。</p>
                        </li>
                        <li>
                           <p>强制数据库将SQL计划指令写入磁盘。</p>
                           <p>例如，执行以下<code class="codeph">DBMS_SPD</code>程序：</p><pre class="pre codeblock"><code>BEGIN DBMS_SPD.FLUSH_SQL_PLAN_DIRECTIVE;结束; /</code></pre></li>
                        <li>
                           <p>查询数据字典以获取有关<code class="codeph">sh</code>模式中现有指令的信息。
                           </p>
                           <p><a href="options-for-optimizer-statistics-gathering.html#GUID-67E635AA-F168-47D7-9DC9-CE8803464B6E__CHDGCEBH">例12-3</a>查询数据字典以获取有关该指令的信息。
                           </p>
                        </li>
                        <li>
                           <p>删除<code class="codeph">sh</code>模式的现有SQL计划指令。
                           </p>
                           <p>以下PL / SQL程序单元删除ID为<code class="codeph">1484026771529551585</code>的SQL计划指令：</p><pre class="pre codeblock"><code>BEGIN DBMS_SPD.DROP_SQL_PLAN_DIRECTIVE（directive_id =&gt; 1484026771529551585）;结束; /</code></pre></li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-67E635AA-F168-47D7-9DC9-CE8803464B6E__CHDGCEBH">
                     <p class="titleinexample">例12-3显示sh Schema的指令</p>
                     <p>此示例显示SQL计划指令以及SQL计划指令动态采样查询的结果。</p><pre class="pre codeblock"><code>SELECT TO_CHAR（d。DIRECTIVE_ID）dir_id，o。所有者，o。OBJECT_NAME，o。SUBOBJECT_NAME col_name，o。OBJECT_TYPE对象，d。TYPE，d。国家，d。来自DBA_SQL_PLAN_DIRECTIVES的原因d，DBA_SQL_PLAN_DIR_OBJECTS o d。DIRECTIVE_ID = O。DIRECTIVE_ID和o。所有者（'SH'）订购1,2,3,4,5; DIR_ID自己OBJECT_NA COL_NAME对象类型状态原因------------------- --- --------- ----------  - ------ -------- ---------- ------------ 1484026771529551585 SH CUSTOMERS COUNTRY_ID COLUMN DYNAMIC_ SUPERSEDED SINGLE TABLE SAMPLING CARDINALITY MISESTIMATE 1484026771529551585 SH客户CUST_STATE_ COLUMN DYNAMIC_取代单一的表省抽样CARDINALITY MISESTIMATE 1484026771529551585 SH Customers表DYNAMIC_取代单一的表抽样CARDINALITY MISESTIMATE 9781501826140511330 SH dyg4msnst5 SQL STA DYNAMIC_保质校验TEMENT抽样CARDINALITY _RESULT估计9872337207064898539 SH时间表DYNAMIC_保质校验抽样CARDINALITY _RESULT估计9781501826140511330 SH 2nk1v0fdx0 SQL STA DYNAMIC_可用的验证时间采样卡丁度_结果估计</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-67E635AA-F168-47D7-9DC9-CE8803464B6E__GUID-2C96D047-F9C3-4F24-8E71-C4FCEB01B494">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="q">“ <a href="optimizer-statistics-concepts.html#GUID-F8F25E31-7113-4B91-BD81-BE6082983192" title="SQL计划指令是优化程序可用于生成更优计划的附加信息和指令。">SQL计划指令</a> ”</span></p>
                        </li>
                        <li>
                           <p><a href="../arpls/DBMS_SPD.html#ARPLS73856" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a> ，了解<code class="codeph">DBMS_SPD</code>包的完整语法和语义。
                           </p>
                        </li>
                        <li>
                           <p><a href="../refrn/DBA_SQL_PLAN_DIRECTIVES.html#REFRN23823" target="_blank"><span class="italic">Oracle Database Reference</span></a>了解<code class="codeph">DBA_SQL_PLAN_DIRECTIVES</code></p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="options-for-optimizer-statistics-gathering.html#GUID-2044960C-025B-44FC-9522-63F426C74386" title="本章介绍优化程序统计信息收集的内容以及如何设置统计信息首选项。">配置优化程序统计信息收集的选项</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>