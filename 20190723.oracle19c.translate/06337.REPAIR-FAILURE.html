<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>修复失败</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery Reference"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery Reference"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-reference.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T19:31:58-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96242-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="RELEASE-CHANNEL.html" title="Previous" type="text/html"></link>
      <link rel="next" href="REPLACE-SCRIPT.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery Reference"></meta>
    <meta name="dcterms.isVersionOf" content="RCMRF"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="RELEASE-CHANNEL.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="REPLACE-SCRIPT.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复参考</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="rman-commands-recover-to-validate.html" property="item" typeof="WebPage"><span property="name">RMAN命令：RECOVER to VALIDATE</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">修复失败</li>
            </ol>
            <a id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98" name="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98"></a><a id="RCMRF90266"></a><a id="RCMRF90267"></a><a id="RCMRF90268"></a><a id="RCMRF90269"></a><a id="RCMRF90270"></a><a id="RCMRF199"></a>
            
            <h2 id="RCMRF-GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98" class="sect2"><span class="enumeration_section">3.4</span>维修失败</h2>
         </header>
         <div class="ind">
            <div>
               <div class="section">
                  <p class="subhead1" id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__GUID-36C1F100-A514-41E1-AA1A-29F792156B99">目的</p>
                  <p><a id="d76438e98" class="indexterm-anchor"></a><a id="d76438e100" class="indexterm-anchor"></a><a id="d76438e102" class="indexterm-anchor"></a>使用<code class="codeph">REPAIR FAILURE</code>命令修复Data Recovery Advisor标识的数据库故障。
                  </p>
                  <p>建议的工作流程是运行<code class="codeph"><a href="LIST.html#GUID-2BAB704C-A3C9-4F76-8D96-4BD961FBEF2E">LIST</a></code> <code class="codeph">FAILURE</code>以显示故障， <code class="codeph"><a href="ADVISE-FAILURE.html#GUID-40985161-61A8-4C0A-9BEF-1DEECBCDF49C">ADVISE FAILURE</a></code>显示修复选项，以及<code class="codeph">REPAIR FAILURE</code>以修复故障。
                  </p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__GUID-CAD2503B-016D-4032-BE19-020E7554F296">先决条件</p>
                  <p>必须启动目标数据库实例。数据库必须是单实例数据库，并且不能是物理备用数据库。</p>
                  <p>确保只有一个RMAN会话正在运行<code class="codeph">REPAIR FAILURE</code>命令。唯一的例外是<code class="codeph">REPAIR FAILURE ...PREVIEW</code> ，在并发RMAN会话中允许。
                  </p>
                  <p>执行<a id="d76438e141" class="indexterm-anchor"></a>自动修复，Data Recovery Advisor可能需要特定备份和归档重做日志文件。如果恢复所需的文件不可用，则无法进行恢复。
                  </p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__GUID-062803C6-3A0D-4A2F-8509-924CC2118972">使用说明</p>
                  <p>尽可能整合维修，以便一次维修可以修复多个故障。请注意， <code class="codeph">REPAIR FAILURE</code>要求您在当前会话中明确运行<code class="codeph">ADVISE FAILURE</code>以成功修复每个已识别的故障。您通常使用以下命令迭代<code class="codeph">REPAIR</code>会话：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><code class="codeph">维修失败;</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">列表失败;</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">建议失败;</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">维修失败;</code></p>
                     </li>
                  </ul>
                  <p>RMAN始终验证故障是否仍然相关并自动关闭固定故障。RMAN不会尝试修复已修复的故障，也不会修复由于在<code class="codeph">ADVISE FAILURE</code>运行后引入新故障而导致的<code class="codeph">ADVISE FAILURE</code> 。
                  </p>
                  <p>默认情况下， <code class="codeph">REPAIR FAILURE</code>在开始执行之前会提示确认。执行修复后，RMAN会重新评估所有现有故障，因为它们可能也已修复。
                  </p>
                  <div class="infoboxnotealso" id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__GUID-DE438092-3E7E-4A8D-9FB1-FB44CDEFC5F2">
                     <p class="notep1">也可以看看：</p>
                     <p>有关使用Data Recovery Advisor诊断和修复故障的完整示例，请<a href="REPAIR-FAILURE.html#GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__BGBBBCGC">参见示例3-17</a></p>
                  </div>
                  <p><span class="bold">Oracle RAC和Data Recovery Advisor</span></p>
                  <p>如果数据故障导致所有实例失效<a id="d76438e194" class="indexterm-anchor"></a>在Oracle RAC数据库中，您可以在单实例模式下装入数据库，并使用Data Recovery Advisor检测和修复控制文件， <code class="codeph">SYSTEM</code>数据文件和字典故障。您还可以启动运行状况检查以测试其他数据库组件的数据故障。此方法不会检测其他群集实例本地的数据故障，例如，无法访问的数据文件。
                  </p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__GUID-87187ABF-A3B4-4B60-B24B-92D1744D913A">句法</p>
                  <p><a id="d76438e206" class="indexterm-anchor"></a><a id="d76438e210" class="indexterm-anchor"></a> <span class="bold"><span class="italic">修理</span> :: =</span></p>
                  <div class="figure" id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__GUID-B01277FA-B1E2-49C0-9118-A680A3B6E261"><img src="img/repair.gif" alt="repair.eps的描述如下" title="repair.eps的描述如下" longdesc="img_text/repair.html"><br><a href="img_text/repair.html">说明repair.eps的说明</a></div>
                  <!-- class="figure" -->
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__GUID-9BCED9BA-8C5E-4D72-A831-0E18659C4992">语义</p>
                  <p id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__CHDCBEBJ"><span class="bold"><span class="italic">修理</span></span></p>
                  <div class="tblformalwide" id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__GUID-8E4F5A18-5861-42DA-BEBA-342E9D09CB4D">
                     <table cellpadding="4" cellspacing="0" class="FormalWide" title="" width="100%" border="1" summary="Describes REPAIR FAILURE command parameters" frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="29%" id="d76438e236">语法元素</th>
                              <th align="left" valign="bottom" width="71%" id="d76438e239">描述</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d76438e244" headers="d76438e236 ">
                                 <p><code class="codeph">修复失败</code></p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d76438e244 d76438e239 ">
                                 <p>修复自动诊断信息库中记录的故障。</p>
                                 <p>如果在没有其他命令选项的情况下执行<code class="codeph">REPAIR FAILURE</code> ，则RMAN将使用当前会话中最新<code class="codeph"><a href="ADVISE-FAILURE.html#GUID-40985161-61A8-4C0A-9BEF-1DEECBCDF49C">ADVISE FAILURE</a></code>命令的第一个修复选项。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d76438e262" headers="d76438e236 "><code class="codeph">USING ADVISE OPTION</code> <span class="italic"><code class="codeph">integer</code></span></td>
                              <td align="left" valign="top" width="71%" headers="d76438e262 d76438e239 ">
                                 <p>按选项编号（ <span class="italic">不是</span>其故障编号）指定修复选项。您可以从<code class="codeph"><a href="ADVISE-FAILURE.html#GUID-40985161-61A8-4C0A-9BEF-1DEECBCDF49C">ADVISE FAILURE</a></code>命令获取修理选项编号。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d76438e281" headers="d76438e236 ">
                                 <p><code class="codeph">NOPROMPT</code></p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d76438e281 d76438e239 ">
                                 <p>禁止确认提示。</p>
                                 <p>如果在命令文件中运行<code class="codeph">REPAIR FAILURE</code> ，则这是默认选项。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d76438e294" headers="d76438e236 ">
                                 <p><code class="codeph">预习</code></p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d76438e294 d76438e239 ">
                                 <p>不进行任何修复并生成包含所有修复操作和注释的脚本。默认情况下，脚本显示为标准输出。您可以使用<code class="codeph"><a href="SPOOL.html#GUID-5B739051-429E-4C72-B96F-4A7E5A7C2A49">SPOOL</a></code>命令将脚本写入可编辑文件（请参见<a href="REPAIR-FAILURE.html#GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__CHDJJCJC">示例3-18</a> ）。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d76438e309" headers="d76438e236 ">
                                 <p><code class="codeph">数据库</code></p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d76438e309 d76438e239 ">修复所选数据库的所有数据文件。要修复CDB的所有数据文件，请在连接到root时运行<code class="codeph">REPAIR DATABASE</code>命令。
                                 <p>在可能的情况下， <code class="codeph">REPAIR</code>还会自动使文件脱机，恢复并恢复它，然后再将其重新联机。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d76438e324" headers="d76438e236 "><code class="codeph">PLUGGABLE DATABASE <span class="codeinlineitalic">pdb_name</span></code></td>
                              <td align="left" valign="top" width="71%" headers="d76438e324 d76438e239 ">
                                 <p>修复以逗号分隔的列表中指定的一个或多个PDB中的所有数据文件。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d76438e333" headers="d76438e236 ">
                                 <p><code class="codeph">数据库根</code></p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d76438e333 d76438e239 ">
                                 <p></p>
                                 <p>在CDB中，修复根目录中的数据文件。使用<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限以普通用户身份连接到root用户。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d76438e348" headers="d76438e236 ">
                                 <p><code class="codeph">DATAFILE <span class="codeinlineitalic">datafileSpec</span></code></p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d76438e348 d76438e239 ">
                                 <p></p>
                                 <p>指定要修复的一个或多个数据文件的列表。有关如何列出数据文件的更多信息，请参阅<a href="datafileSpec.html#GUID-A0A69931-D404-4D89-8F95-3AB898B6A220">datafileSpec</a> 。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d76438e363" headers="d76438e236 ">
                                 <p><code class="codeph">TABLESPACE <span class="codeinlineitalic">tablespace_name</span></code></p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d76438e363 d76438e239 ">
                                 <p></p>
                                 <p>指定要修复的一个或多个表空间的名称。RMAN在修复表空间时将表空间名称内部转换为数据文件列表。</p>
                                 <p>在CDB中，它修复根中的表空间。在PDB中，它修复所选PDB中的表空间。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d76438e376" headers="d76438e236 ">
                                 <p><code class="codeph">TO RESTORE POINT</code> <code class="codeph"><span class="codeinlineitalic">restore_point_name</span></code></p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d76438e376 d76438e239 ">
                                 <p></p>
                                 <p>将还原点指定为要修复的数据文件的上限（包含）限制。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d76438e389" headers="d76438e236 ">
                                 <p><code class="codeph"><span class="codeinlineitalic">untilClause</span></code></p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d76438e389 d76438e239 ">
                                 <p></p>
                                 <p>设置修复的结束时间，SCN或日志序列号。有关如何使用此子句的更多信息，请参见<a href="untilClause.html#GUID-6A6C502A-6E21-4673-9FC9-C075D1E2F97A">untilClause</a> 。
                                 </p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__GUID-B7EDA78F-766B-49F0-B678-08427E8184EF">例子</p>
               </div>
               <!-- class="section" -->
               <div class="example" id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__BGBBBCGC">
                  <p class="titleinexample">例3-17修复故障</p>
                  <p>此示例修复Data Recovery Advisor已知的所有故障。该示例修复了两个故障：丢失数据文件和具有损坏块的数据文件。恢复后，RMAN询问是否应该打开数据库（用户输入的文本以粗体显示）。</p><pre class="oac_no_warn" dir="ltr">RMAN&gt; <span class="bold">LIST FAILURE;</span>数据库故障列表=========================故障ID优先级状态检测时间摘要---------- ---- ---- --------- ------------- ------- 142 HIGH OPEN 23-APR-13缺少一个或多个非系统数据文件101 HIGH OPEN 23-APR-13数据文件1：'/ disk1 / oddata / prod / system01.dbf'包含一个或多个损坏的块RMAN&gt; <span class="bold">ADVISE FAILURE;</span>数据库故障列表=========================故障ID优先级状态检测时间摘要---------- ---- ---- --------- ------------- ------- 142 HIGH OPEN 23-APR-13缺少一个或多个非系统数据文件101 HIGH OPEN 23-APR-13数据文件1：'/ disk1 / oddata / prod / system01.dbf'包含一个或多个分析自动修复选项的损坏块;这可能需要一些时间使用通道ORA_DISK_1分析自动修复选项完成强制手动操作========================没有可用的手动操作可选手动操作=== ==================== 1。如果无意中重命名或移动了文件/disk1/oradata/prod/users01.dbf，请将其恢复为自动修复选项========================选项修复说明------ ------------------ 1恢复和恢复数据文件28;在文件1中执行块56416的块介质恢复策略：修复包括完整的介质恢复，没有数据丢失修复脚本：/disk1/oracle/log/diag/rdbms/prod/prod/hm/reco_660500184.hm RMAN&gt; <span class="bold">REPAIR FAILURE;</span>策略：修复包括完整的介质恢复，无数据丢失修复脚本：/disk1/oracle/log/diag/rdbms/prod/prod/hm/reco_475549922.hm修复脚本的内容：#recovery and recover datafile alter database datafile 28 offline ;恢复数据文件28;恢复数据文件28; alter database datafile 28 online; #block media recovery recover datafile 1 block 56416;你真的想要执行上面的修复（输入是或否）？<span class="bold">是</span>执行修复脚本sql语句：alter database datafile 28 offline使用通道ORA_DISK_1通道在23-APR-13开始恢复ORA_DISK_1：启动数据文件备份集恢复通道ORA_DISK_1：指定要从备份集通道恢复的数据文件ORA_DISK_1：恢复数据文件00028到/disk1/oradata/prod/users01.dbf频道ORA_DISK_1：从备份片段读取/disk2/PROD/backupset/2013_04_18/o1_mf_nnndf_TAG20130418T182042_32fjzd3z_.bkp频道ORA_DISK_1：piece handle = / disk2 / PROD / backupset / 2013_04_18 / o1_mf_nnndf_TAG20130418T182042_32fjzd3z_.bkp tag = TAG20130418T182042频道ORA_DISK_1：恢复备份1频道ORA_DISK_1：恢复完成，已用时间：00：00：03 23-APR-13完成恢复使用频道ORA_DISK_1开始恢复23-APR-13开始媒体恢复媒体恢复完成，已用时间：00：00：01在23-APR-13 sql语句完成恢复：alter database datafile 28 online使用通道ORA_DISK_1搜索在23-APR-13开始恢复阻止图像的闪回日志，直到SCN 429690完成闪回日志搜索，恢复1个块，开始介质恢复介质恢复完成，已用时间：00：00：03完成恢复，23-APR-13修复失败完成</pre></div>
               <!-- class="example" -->
               <div class="example" id="GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98__CHDJJCJC">
                  <p class="titleinexample">示例3-18预览修复</p>
                  <p>以下示例预览了当前会话中最新<code class="codeph"><a href="ADVISE-FAILURE.html#GUID-40985161-61A8-4C0A-9BEF-1DEECBCDF49C">ADVISE FAILURE</a></code>命令的第一个修复选项的修复。<code class="codeph">LIST FAILURE</code>和<code class="codeph">ADVISE FAILURE</code>命令的示例输出未在示例中显示。
                  </p><pre class="oac_no_warn" dir="ltr">RMAN&gt; LIST FAILURE; 。。。RMAN&gt;建议失败; 。。。RMAN&gt;维修失败预览;策略：修复包括完整的介质恢复，无数据丢失修复脚本：/disk1/oracle/log/diag/rdbms/prod/prod/hm/reco_3200987003.hm修复脚本的内容：#block media recovery recovery datafile 1 block 56416;</pre><p>你可以使用<code class="codeph"><a href="SPOOL.html#GUID-5B739051-429E-4C72-B96F-4A7E5A7C2A49">SPOOL</a></code>和<code class="codeph">REPAIR FAILURE ...PREVIEW</code>将修复脚本写入文件。然后，您可以编辑此脚本并手动执行。以下示例将修复预览的日志<code class="codeph">/tmp/repaircmd.dat</code>到<code class="codeph">/tmp/repaircmd.dat</code> 。
                  </p><pre class="oac_no_warn" dir="ltr">RMAN&gt; SPOOL LOG TO'/tmp/repaircmd.dat'; RMAN&gt;维修失败预览; RMAN&gt; SPOOL LOG OFF;</pre></div>
               <!-- class="example" -->
            </div>
         </div>
      </article>
   </body>
</html>