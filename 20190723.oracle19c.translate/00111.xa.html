<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>使用Oracle XA开发应用程序</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Database Development Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Database Development Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-development-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-31T23:23:15-08:00"></meta>
      <meta name="dcterms.title" content="Database Development Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96334-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="external-procedures.html" title="Previous" type="text/html"></link>
      <link rel="next" href="publish-subscribe-model.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="ADFNS"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="external-procedures.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="publish-subscribe-model.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据库开发指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="advanced-part.html" property="item" typeof="WebPage"><span property="name">应用程序开发人员的高级主题</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用Oracle XA开发应用程序</li>
            </ol>
            <a id="GUID-1DAB062F-F796-4424-9FFD-9756688AC5B7" name="GUID-1DAB062F-F796-4424-9FFD-9756688AC5B7"></a><a id="ADFNS1097"></a><a id="ADFNS017"></a>
            
            <h2 id="ADFNS-GUID-1DAB062F-F796-4424-9FFD-9756688AC5B7" class="sect2"><span class="enumeration_chapter">22</span>使用Oracle XA开发应用程序</h2>
         </header>
         <div class="ind">
            <div>
               <div class="infoboxnote" id="GUID-1DAB062F-F796-4424-9FFD-9756688AC5B7__GUID-87C74900-502C-40FF-9457-99D2AC698B40">
                  <p class="notep1">注意：</p>
                  <p>如果可能，请避免使用XA，原因如下：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>XA会降低性能。</p>
                     </li>
                     <li>
                        <p>XA可能会导致不确定的交易。</p>
                     </li>
                     <li>
                        <p>XA可能无法利用Oracle Database 12 <span class="italic">c</span>第1版（12.1.0.1）功能，这些功能可增强应用程序在可恢复中断后继续运行的能力。
                        </p>
                     </li>
                  </ul>
                  <p>即使可以避免使用XA，也可以避免使用XA（例如，如果必须在同一事务中使用Oracle和非Oracle资源）。</p>
               </div>
               <p>本章介绍如何使用Oracle XA库。通常，您在使用事务监视器的应用程序中使用此库。XA功能在事务与多个数据库交互的应用程序中最有用。</p>
               <div class="section">
                  <p class="subhead1" id="GUID-1DAB062F-F796-4424-9FFD-9756688AC5B7__GUID-055B150E-7A14-4327-9D3D-2A72B6DE9C17">话题：</p>
               </div>
               <!-- class="section" -->
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="xa.html#GUID-19B8285C-F8CA-4857-89E3-477C6BD1483C">X / Open分布式事务处理（DTP）</a></p>
                  </li>
                  <li>
                     <p><a href="xa.html#GUID-9A7404AC-CE6F-4F41-B8C6-CA2936A78609">Oracle XA库子程序</a></p>
                  </li>
                  <li>
                     <p><a href="xa.html#GUID-22284B0A-C63F-471A-96ED-AEA195068944">开发和安装XA应用程序</a></p>
                  </li>
                  <li>
                     <p><a href="xa.html#GUID-194B0A1B-1A10-47B5-B898-5CDECD7FFA9B">XA应用程序疑难解答</a></p>
                  </li>
                  <li>
                     <p><a href="xa.html#GUID-D1F82CDD-DDDA-4895-B18B-C9F7D44AAEBB">Oracle XA问题和限制</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-1DAB062F-F796-4424-9FFD-9756688AC5B7__GUID-4BF8CF25-B27D-4EAD-8C8E-D09C4CAC0A78">
                  <p class="notep1">也可以看看：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><span class="italic">分布式TP：XA规范</span> ，概述了XA，包括基本架构<span class="italic">。</span> 访问<a href="https://www2.opengroup.org/ogsys/jsp/publications/PublicationDetails.jsp?publicationid=11144" target="_blank"><code class="codeph">https://www2.opengroup.org/ogsys/jsp/publications/PublicationDetails.jsp?publicationid=11144</code></a> 。</p>
                     </li>
                     <li>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI350" target="_blank"><span class="italic">Oracle Call Interface Programmer's Guide</span></a> ，了解有关Oracle XA库的背景和参考信息</p>
                     </li>
                     <li>
                        <p>有关库链接文件名的信息，请参阅Oracle数据库平台特定文档</p>
                     </li>
                     <li>
                        <p>有关适用于您的平台的Oracle XA库中的更改，错误和限制的自述文件</p>
                     </li>
                  </ul>
               </div>
            </div><a id="ADFNS760"></a><a id="ADFNS1098"></a><a id="ADFNS1501"></a><div class="props_rev_3"><a id="GUID-19B8285C-F8CA-4857-89E3-477C6BD1483C" name="GUID-19B8285C-F8CA-4857-89E3-477C6BD1483C"></a><h3 id="ADFNS-GUID-19B8285C-F8CA-4857-89E3-477C6BD1483C" class="sect3">X / Open分布式事务处理（DTP）</h3>
               <div>
                  <p>X / Open分布式事务处理（DTP）体系结构定义了一种标准体系结构或接口，使多个应用程序（AP）能够共享由多个（可能是不同的）资源管理器（RM）提供的资源。它协调AP和RM之间的工作进入全局事务。</p>
                  <p>Oracle XA库符合X / Open软件架构的XA接口规范。Oracle XA库是一个外部接口，它使不是Oracle客户端TM的客户端事务管理器（TM）能够协调全局事务，从而允许在分布式事务中包含非Oracle数据库RM的数据库RM。例如，客户端应用程序可以将NTFS文件系统中的Oracle数据库事务和事务作为单个全局事务进行管理。</p>
                  <p><a href="xa.html#GUID-19B8285C-F8CA-4857-89E3-477C6BD1483C__BGBJEHGJ">图22-1</a>说明了可能的X / Open DTP模型。
                  </p>
                  <div class="figure" id="GUID-19B8285C-F8CA-4857-89E3-477C6BD1483C__BGBJEHGJ">
                     <p class="titleinfigure">图22-1可能的DTP模型</p><img src="img/adfns079.gif" width="400" alt="下面是图22-1的描述" title="下面是图22-1的描述" longdesc="img_text/adfns079.html"><br><a href="img_text/adfns079.html">“图22-1可能的DTP模型”的描述</a></div>
                  <!-- class="figure" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-19B8285C-F8CA-4857-89E3-477C6BD1483C__GUID-7C56C978-7923-4A1E-9FCB-1692AA110A2C">话题：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="xa.html#GUID-CA0BA438-300D-4978-AE75-52D293D3552E">DTP术语</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-2CF88A6E-A75B-4CE0-891D-0E6AE7D31FA1">所需的公共信息</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS762"></a><a id="ADFNS763"></a><a id="ADFNS764"></a><a id="ADFNS765"></a><a id="ADFNS766"></a><a id="ADFNS767"></a><a id="ADFNS768"></a><a id="ADFNS769"></a><a id="ADFNS770"></a><a id="ADFNS771"></a><a id="ADFNS761"></a><div class="props_rev_3"><a id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E" name="GUID-CA0BA438-300D-4978-AE75-52D293D3552E"></a><h4 id="ADFNS-GUID-CA0BA438-300D-4978-AE75-52D293D3552E" class="sect4">DTP术语</h4>
                  <div>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="xa.html#GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABDCAIG">资源经理（RM）</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABFFCHB">分布式事务</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABHEGBF">科</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABIACJA">交易经理（TM）</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABDBFFB">事务处理监视器（TPM）</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABBBCHD">两阶段提交协议</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABCBIAH">应用程序（AP）</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABFDADA">TX接口</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABBDDFC">紧凑和松散的耦合</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABGHHEG">动态和静态注册</a></p>
                        </li>
                     </ul>
                     <div class="section" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABDCAIG">
                        <p class="subhead3" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__GUID-F0D59031-48A6-4599-99C3-3B800502573C">资源经理（RM）</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>资源管理器控制共享的可恢复资源，该资源可在失败后返回到一致状态。示例是关系数据库，事务性队列和事务性文件系统。Oracle数据库是RM，使用其联机重做日志和还原段在失败后返回到一致状态。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABFFCHB">
                        <p class="subhead3" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__GUID-0CA959CF-5C8A-44B0-BDA6-AC1D8FDB3AF6">分布式事务</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>分布式事务（也称为<strong class="term">全局事务</strong> ）是一种客户端事务，它涉及对多个分布式资源的更新，并且需要跨分布式RM的“全有或全无”语义。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABHEGBF">
                        <p class="subhead3" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__GUID-808BE7EC-91B6-4C9E-8F60-4636A309C62F">科</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>分支是一个RM中包含的工作单元。多个分支包括全局事务。对于Oracle数据库，每个分支映射到数据库服务器内的本地事务。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABIACJA">
                        <p class="subhead3" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__GUID-7137E6FF-E308-497A-9251-0DA1D3E9C2C8">交易经理（TM）</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>事务管理器提供用于指定事务边界的API，并管理提交和恢复。TM实现了两阶段提交引擎，以跨分布式RM提供“全有或全无”语义。</p>
                        <p><strong class="term">外部TM</strong>是位于Oracle数据库之外的中间层组件。通常，数据库是它自己的内部TM。使用基于标准的TM使Oracle数据库能够在单个事务中与其他异构RM协作。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABDBFFB">
                        <p class="subhead3" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__GUID-12171B7B-DDF7-4002-9F42-C0A6A65FC4F2">事务处理监视器（TPM）</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>TM通常由事务处理监视器（TPM）提供，例如：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>Oracle Tuxedo</p>
                           </li>
                           <li>
                              <p>IBM Transarc Encina</p>
                           </li>
                           <li>
                              <p>IBM CICS</p>
                           </li>
                        </ul>
                        <p>TPM协调发出请求的客户端进程与处理它们的后端服务器之间的事务请求流。基本上，TPM协调需要几种不同类型的后端进程的服务的事务，例如通过网络分发的应用程序服务器和RM。</p>
                        <p>TPM同步完成分布式事务所需的任何提交或回滚。TPM的TM部分负责控制何时进行分布式提交和回滚。因此，如果分布式应用程序利用TPM，则TPM的TM部分负责控制两阶段提交协议。RM使TM能够执行此任务。</p>
                        <p>由于TM控制分布式提交或回滚，因此它必须通过XA接口直接与Oracle数据库（或任何其他RM）通信。它使用Oracle XA库子程序（在<span class="q">“ <a href="xa.html#GUID-9C1460F8-43B4-470B-A624-07889E522340">Oracle XA库子程序</a> ”</span>中描述），根据其对事务中所有RM的了解，告知Oracle数据库如何处理事务。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABBBCHD">
                        <p class="subhead3" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__GUID-11969F91-28A8-4D39-BC05-60DB34C658E0">两阶段提交协议</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Oracle XA库接口遵循两阶段提交协议。事件顺序如下：</p>
                        <ol>
                           <li>
                              <p>在准备阶段，TM要求每个RM保证它可以提交交易的任何部分。如果可能，则RM记录其准备好的状态并肯定地回复TM。如果不可能，那么RM可能会回滚任何工作，对TM做出否定回复，并忘记交易。该协议允许应用程序或任何RM单方面回滚事务，直到准备阶段完成。</p>
                           </li>
                           <li>
                              <p>在第二阶段，TM记录提交决策并向参与事务的所有RM发出提交或回滚。只有当所有客户经理肯定地回复第一阶段时，TM才能为RM发出提交。</p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABCBIAH">
                        <p class="subhead3" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__GUID-2D142483-7C2F-459D-AA08-245875528D82">应用程序（AP）</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>应用程序定义事务边界并指定构成事务的操作。例如，AP可以是预编译器或Oracle调用接口（OCI）程序。AP通过其本机接口（例如，SQL）在RM资源上运行。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABFDADA">
                        <p class="subhead3" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__GUID-1D409ADA-6013-4F0F-A191-A474890F92C8">TX接口</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>应用程序通过名为<strong class="term">TX</strong>的接口通过TM启动并完成所有事务控制操作。 AP不直接使用XA接口。AP不知道在中间层中分支的分支：应用程序线程没有明确地加入，离开，暂停和恢复分支工作，而是事务处理监视器的TM部分管理AP的全局事务的分支。最终，AP呼叫TM提交全有或全无。
                        </p>
                        <div class="infoboxnote" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__GUID-293402A0-94B2-4B5C-804F-5460BFA68609">
                           <p class="notep1">注意：</p>
                           <p>TX接口和相关子程序的命名约定是特定于供应商的。例如， <code class="codeph">tx_open</code>调用可能在您的系统上称为<code class="codeph">tp_open</code> 。在某些情况下，调用可能是隐式的，例如，在事务RPC的入口处。有关详细信息，请参阅事务处理监视器随附的文档。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABBDDFC">
                        <p class="subhead3" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__GUID-74CB271D-C466-4928-9137-4C94D60A9823">紧凑和松散的耦合</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>如果RM将它们视为用于所有隔离语义目的的单个实体，则应用程序线程<span class="bold">紧密耦合</span> 。紧密耦合的分支必须看到彼此的变化。此外，外部客户端必须要么看到紧耦合集的所有更改，要么看不到任何更改。如果应用程序线程没有紧密耦合，那么它们是<span class="bold">松散耦合的</span> 。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__BABGHHEG">
                        <p class="subhead3" id="GUID-CA0BA438-300D-4978-AE75-52D293D3552E__GUID-E572F404-6B66-4496-B3B9-77EC82AF2C1E">动态和静态注册</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Oracle数据库支持动态和静态注册。在<span class="bold">动态注册中</span> ，RM在开始任何工作之前运行应用程序回调。在<span class="bold">静态注册中</span> ，您必须在开始任何工作之前为每个RM调用<code class="codeph">xa_start</code> ，即使不涉及某些RM。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS773"></a><a id="ADFNS772"></a><div class="props_rev_3"><a id="GUID-2CF88A6E-A75B-4CE0-891D-0E6AE7D31FA1" name="GUID-2CF88A6E-A75B-4CE0-891D-0E6AE7D31FA1"></a><h4 id="ADFNS-GUID-2CF88A6E-A75B-4CE0-891D-0E6AE7D31FA1" class="sect4">所需的公共信息</h4>
                  <div>
                     <p>作为资源管理器，Oracle数据库必须发布<a href="xa.html#GUID-2CF88A6E-A75B-4CE0-891D-0E6AE7D31FA1__BGBFABGJ" title="此表汇总了Oracle数据库发布的所需XA功能。">表22-1中</a>描述的信息。
                     </p>
                     <div class="tblformal" id="GUID-2CF88A6E-A75B-4CE0-891D-0E6AE7D31FA1__BGBFABGJ">
                        <p class="titleintable">表22-1 Oracle数据库发布的必需XA功能</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="Oracle数据库发布的必需XA功能" width="100%" border="1" summary="This table summarizes the required XA features published by Oracle Database." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="28%" id="d132228e765">XA功能</th>
                                 <th align="left" valign="bottom" width="72%" id="d132228e768">Oracle Database详细信息</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d132228e773" headers="d132228e765 ">
                                    <p><code class="codeph">xa_switch_t</code>结构</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d132228e773 d132228e768 ">
                                    <p>Oracle数据库<code class="codeph">xa_switch_t</code>结构名称是<code class="codeph">xaosw</code>静态登记和<code class="codeph">xaoswd</code>动态注册。这些结构包含资源管理器的入口点和其他信息。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d132228e791" headers="d132228e765 ">
                                    <p><code class="codeph">xa_switch_t</code>资源管理器</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d132228e791 d132228e768 ">
                                    <p><code class="codeph">xa_switch_t</code>结构中的Oracle数据库资源管理器名称是<code class="codeph">Oracle_XA</code> 。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d132228e806" headers="d132228e765 ">
                                    <p>关闭字符串</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d132228e806 d132228e768 ">
                                    <p><code class="codeph">xa_close</code>使用的关闭字符串将被忽略，并且可以为null。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d132228e816" headers="d132228e765 ">
                                    <p>打开字符串</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d132228e816 d132228e768 ">
                                    <p>有关<code class="codeph">xa_open</code>使用的打开字符串格式的说明，请参阅<a href="xa.html#GUID-33E70E78-7ACD-4B6F-84C2-AC567C6EDE96">定义xa_open字符串</a> 。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d132228e830" headers="d132228e765 ">
                                    <p>图书馆</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d132228e830 d132228e768 ">
                                    <p>使用Oracle XA链接应用程序所需的库具有特定于平台的名称。该过程类似于链接普通预编译器或OCI程序，但您可能必须链接任何特定于TPM的库。</p>
                                    <p>如果您不使用预编译器（例如Pro * C / C ++，Pro * COBOL等），则链接到<code class="codeph">$ORACLE_HOME/rdbms/lib/xaonsl.o</code>或<code class="codeph">$ORACLE_HOME/rdbms/lib32/xaonsl.o</code> （对于32 64位平台上的位应用程序）。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d132228e845" headers="d132228e765 ">
                                    <p>要求</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d132228e845 d132228e768 ">
                                    <p>没有。支持XA的功能是标准版和企业版的一部分。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
               </div>
            </div><a id="ADFNS1099"></a><a id="ADFNS1502"></a><div class="props_rev_3"><a id="GUID-9A7404AC-CE6F-4F41-B8C6-CA2936A78609" name="GUID-9A7404AC-CE6F-4F41-B8C6-CA2936A78609"></a><h3 id="ADFNS-GUID-9A7404AC-CE6F-4F41-B8C6-CA2936A78609" class="sect3">Oracle XA库子程序</h3>
               <div>
                  <p>Oracle XA库子程序使TM能够告诉Oracle数据库如何处理事务。通常，TM必须使用<code class="codeph">xa_open</code>打开资源。通常，资源的打开是由AP调用<code class="codeph">tx_open</code> 。当应用程序开始时，某些TM可能会隐式调用<code class="codeph">xa_open</code> 。
                  </p>
                  <p>类似地，当应用程序完成资源时，会发生关闭（使用<code class="codeph">xa_close</code> ）。当AP调用<code class="codeph">tx_close</code>或应用程序终止时，可能会发生关闭。
                  </p>
                  <p>TM指示RM执行其他几项任务，包括：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>启动事务并将其与ID关联</p>
                     </li>
                     <li>
                        <p>回滚交易</p>
                     </li>
                     <li>
                        <p>准备和提交交易</p>
                     </li>
                  </ul>
                  <div class="section">
                     <p class="subhead2" id="GUID-9A7404AC-CE6F-4F41-B8C6-CA2936A78609__GUID-7C1AF3C7-1DD7-4F98-A4EB-49A2BF1F290B">话题：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="xa.html#GUID-9C1460F8-43B4-470B-A624-07889E522340">Oracle XA库子程序</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-00C2A1DD-B351-4377-A13B-0E67D0E21B51">Oracle XA接口扩展</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS775"></a><a id="ADFNS774"></a><div class="props_rev_3"><a id="GUID-9C1460F8-43B4-470B-A624-07889E522340" name="GUID-9C1460F8-43B4-470B-A624-07889E522340"></a><h4 id="ADFNS-GUID-9C1460F8-43B4-470B-A624-07889E522340" class="sect4">Oracle XA库子程序</h4>
                  <div>
                     <p>XA库子程序如<a href="xa.html#GUID-9C1460F8-43B4-470B-A624-07889E522340__g1017655" title="此表总结了XA库子例程。">表22-2所示</a> 。
                     </p>
                     <div class="tblformal" id="GUID-9C1460F8-43B4-470B-A624-07889E522340__g1017655">
                        <p class="titleintable">表22-2 XA库子程序</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="XA库子程序" width="100%" border="1" summary="This table summarizes the XA library subroutines." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="20%" id="d132228e1116">XA子程序</th>
                                 <th align="left" valign="bottom" width="80%" id="d132228e1119">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d132228e1124" headers="d132228e1116 ">
                                    <p><code class="codeph">xa_open</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d132228e1124 d132228e1119 ">
                                    <p>连接到RM。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d132228e1132" headers="d132228e1116 ">
                                    <p><code class="codeph">xa_close</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d132228e1132 d132228e1119 ">
                                    <p>与RM断开连接。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d132228e1140" headers="d132228e1116 ">
                                    <p><code class="codeph">xa_start</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d132228e1140 d132228e1119 ">
                                    <p>启动事务并将其与给定的事务ID（XID）相关联，或将该流程与现有事务相关联。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d132228e1148" headers="d132228e1116 ">
                                    <p><code class="codeph">XA_END</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d132228e1148 d132228e1119 ">
                                    <p>将进程与给定的XID解除关联。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d132228e1156" headers="d132228e1116 ">
                                    <p><code class="codeph">XA_ROLLBACK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d132228e1156 d132228e1119 ">
                                    <p>回滚与给定XID关联的事务。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d132228e1164" headers="d132228e1116 ">
                                    <p><code class="codeph">xa_prepare</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d132228e1164 d132228e1119 ">
                                    <p>准备与给定XID关联的事务。这是两阶段提交协议的第一阶段。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d132228e1172" headers="d132228e1116 ">
                                    <p><code class="codeph">xa_commit</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d132228e1172 d132228e1119 ">
                                    <p>提交与给定XID关联的事务。这是两阶段提交协议的第二阶段。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d132228e1180" headers="d132228e1116 ">
                                    <p><code class="codeph">xa_recover</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d132228e1180 d132228e1119 ">
                                    <p>检索已准备好，启发式提交或启发式回滚事务的列表。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d132228e1188" headers="d132228e1116 ">
                                    <p><code class="codeph">xa_forget</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d132228e1188 d132228e1119 ">
                                    <p>忘记与给定XID相关联的启发式完成的事务。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>通常，除了理解<code class="codeph">xa_open</code>字符串所起的作用外，AP不必担心<a href="xa.html#GUID-9C1460F8-43B4-470B-A624-07889E522340__g1017655" title="此表总结了XA库子例程。">表22-2中</a>的子程序。
                     </p>
                  </div>
               </div><a id="ADFNS777"></a><a id="ADFNS776"></a><div class="props_rev_3"><a id="GUID-00C2A1DD-B351-4377-A13B-0E67D0E21B51" name="GUID-00C2A1DD-B351-4377-A13B-0E67D0E21B51"></a><h4 id="ADFNS-GUID-00C2A1DD-B351-4377-A13B-0E67D0E21B51" class="sect4">Oracle XA接口扩展</h4>
                  <div>
                     <p>Oracle数据库的XA接口包括一些附加功能，如<a href="xa.html#GUID-00C2A1DD-B351-4377-A13B-0E67D0E21B51__BGBEDJAG" title="此表汇总了Oracle数据库XA界面中的其他功能。">表22-3所示</a> 。
                     </p>
                     <div class="tblformalwide" id="GUID-00C2A1DD-B351-4377-A13B-0E67D0E21B51__BGBEDJAG">
                        <p class="titleintable">表22-3 Oracle XA接口扩展</p>
                        <table cellpadding="4" cellspacing="0" class="FormalWide" title="Oracle XA接口扩展" width="100%" border="1" summary="This table summarizes additional functions in the XA interface for Oracle Database." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="49%" id="d132228e1318">功能</th>
                                 <th align="left" valign="bottom" width="51%" id="d132228e1321">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="49%" id="d132228e1326" headers="d132228e1318 ">
                                    <p><code class="codeph">OCISvcCtx * xaoSvcCtx（text * dbname）</code></p>
                                 </td>
                                 <td align="left" valign="top" width="51%" headers="d132228e1326 d132228e1321 ">
                                    <p>返回给定XA连接的OCI服务句柄。<code class="codeph">dbname</code>参数必须与<code class="codeph">xa_open</code>字符串中传递的<code class="codeph">DB</code>参数相同。OCI应用程序可以使用此路由而不是<code class="codeph">sqlld2</code>调用来获取连接句柄。因此，OCI应用程序不需要与<code class="codeph">sqllib</code>库链接。可以使用<code class="codeph">OCISvcCtxToLda</code> [Version 8 OCI]将服务句柄转换为V7 OCI登录数据区（LDA）。客户端应用程序必须记住在完成OCI调用后使用<code class="codeph">OCILdaToSvcCtx</code>将V7 LDA转换为服务句柄。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="49%" id="d132228e1356" headers="d132228e1318 ">
                                    <p><code class="codeph">OCIEnv * xaoEnv（text * dbname）</code></p>
                                 </td>
                                 <td align="left" valign="top" width="51%" headers="d132228e1356 d132228e1321 ">
                                    <p>返回给定XA连接的OCI环境句柄。<code class="codeph">dbname</code>参数必须与<code class="codeph">xa_open</code>字符串中传递的<code class="codeph">DB</code>参数相同。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="49%" id="d132228e1373" headers="d132228e1318 ">
                                    <p><code class="codeph">int xaosterr（OCISvcCtx * SvcCtx，sb4错误）</code></p>
                                 </td>
                                 <td align="left" valign="top" width="51%" headers="d132228e1373 d132228e1321 ">
                                    <p>将Oracle数据库错误代码转换为XA错误代码（仅适用于动态注册）。第一个参数是用于在数据库中运行工作的服务句柄。第二个参数是从Oracle数据库返回的错误代码。使用此函数可确定是否因为<code class="codeph">xa_start</code>失败而导致从OCI语句返回的错误。如果XA模块未生成错误，则函数返回XA_OK;如果XA模块生成错误，则函数返回有效的XA错误。
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
               </div>
            </div><a id="ADFNS1503"></a><div class="props_rev_3"><a id="GUID-22284B0A-C63F-471A-96ED-AEA195068944" name="GUID-22284B0A-C63F-471A-96ED-AEA195068944"></a><h3 id="ADFNS-GUID-22284B0A-C63F-471A-96ED-AEA195068944" class="sect3">开发和安装XA应用程序</h3>
               <div>
                  <div class="section">
                     <p>本节介绍如何开发和安装Oracle XA应用程序：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="xa.html#GUID-91007BAE-9DD3-4993-8220-C3EC8391376B">DBA或系统管理员职责</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-FE99AEDA-C4B1-40F9-A3BB-4484F9532753">应用程序开发人员职责</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-33E70E78-7ACD-4B6F-84C2-AC567C6EDE96">定义xa_open字符串</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-22284B0A-C63F-471A-96ED-AEA195068944">开发和安装XA应用程序</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-731EEEF6-C3CB-460C-85DE-25F5EF88FD2C">使用Oracle XA管理事务控制</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-97D86BEB-B303-4CCE-9D7A-D65BB79F43DE">将预编译器或OCI应用程序迁移到TPM应用程序</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-1769DFE4-A670-471F-81D2-514398386A41">管理Oracle XA Library线程安全</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-27CD17CC-91C7-4C4D-B341-132AB8E167A6">使用DBMS_XA包</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS778"></a><div class="props_rev_3"><a id="GUID-91007BAE-9DD3-4993-8220-C3EC8391376B" name="GUID-91007BAE-9DD3-4993-8220-C3EC8391376B"></a><h4 id="ADFNS-GUID-91007BAE-9DD3-4993-8220-C3EC8391376B" class="sect4">DBA或系统管理员职责</h4>
                  <div>
                     <div class="section">
                        <p>DBA或系统管理员的职责是：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>在应用程序开发人员的帮助下定义打开的字符串。</span></li>
                        <li class="stepexpand"><span>确保存在静态数据字典视图<code class="codeph">DBA_PENDING_TRANSACTIONS</code> ，并为<code class="codeph">xa_open</code>字符串中指定的所有Oracle用户授予对视图的<code class="codeph">READ</code>或<code class="codeph">SELECT</code>权限。</span><div>
                              <p>使用命令<code class="codeph">COMMIT</code> <code class="codeph">FORCE</code> <span class="italic"><code class="codeph">local_tran_id</code></span>或<code class="codeph">ROLLBACK</code> <code class="codeph">FORCE</code> <span class="italic"><code class="codeph">local_tran_id</code></span>向Oracle用户授予<code class="codeph">FORCE</code> <code class="codeph">TRANSACTION</code>权限，该用户可能提交或回滚他或她创建的待处理（不确定）事务。
                              </p>
                              <p>向可能提交或回滚其他用户创建的XA事务的Oracle用户授予<code class="codeph">FORCE</code> <code class="codeph">ANY</code> <code class="codeph">TRANSACTION</code>权限。例如，如果用户A可能提交或回滚用户B创建的事务，则用户A必须具有<code class="codeph">FORCE</code> <code class="codeph">ANY</code> <code class="codeph">TRANSACTION</code>权限。
                              </p>
                              <p>在Oracle Database <code class="codeph">V$XATRANS$</code>客户端应用程序中，Oracle XA库使用的所有Oracle数据库帐户必须具有动态性能视图<code class="codeph">V$XATRANS$</code>的<code class="codeph">SELECT</code>权限。必须在XA库安装期间创建此视图。如有必要，可以通过运行SQL脚本<code class="codeph">xaview</code>手动创建视图。 <code class="codeph">sql</code>作为Oracle数据库用户<code class="codeph">SYS</code> 。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>使用打开的字符串信息，将RM安装到TPM配置中。按照TPM供应商的说明进行操作</span><div>
                              <p>DBA或系统管理员必须知道TPM系统启动连接到Oracle数据库的进程。请参阅TPM文档以确定流程存在的环境以及必须具有的用户ID。确保在此环境中为<code class="codeph">$ORACLE_HOME</code>和<code class="codeph">$ORACLE_SID</code>设置了正确的值。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>将用户标识写入权限授予系统要在其中写入XA跟踪文件的目录。</span><div></div>
                        </li>
                        <li class="stepexpand"><span>启动相关数据库实例以使Oracle XA应用程序联机。在启动任何TPM服务器之前执行此任务。</span></li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-91007BAE-9DD3-4993-8220-C3EC8391376B__NOTE-1231-CB04EA89">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="xa.html#GUID-33E70E78-7ACD-4B6F-84C2-AC567C6EDE96">定义xa_open String</a>以获取有关如何定义开放字符串的信息，并指定Oracle系统标识符（SID）或与默认值不同的跟踪目录</p>
                              </li>
                              <li>
                                 <p>有关<code class="codeph">catxpend</code>位置的Oracle数据库平台特定文档。 <code class="codeph">sql</code>脚本</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS779"></a><div class="props_rev_3"><a id="GUID-FE99AEDA-C4B1-40F9-A3BB-4484F9532753" name="GUID-FE99AEDA-C4B1-40F9-A3BB-4484F9532753"></a><h4 id="ADFNS-GUID-FE99AEDA-C4B1-40F9-A3BB-4484F9532753" class="sect4">应用程序开发人员职责</h4>
                  <div>
                     <div class="section">
                        <p>应用程序开发人员的职责是：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>在DBA或系统管理员的帮助下定义打开的字符串，如<a href="xa.html#GUID-33E70E78-7ACD-4B6F-84C2-AC567C6EDE96">定义xa_open字符串中所述</a> 。</span></li>
                        <li class="stepexpand"><span>开发应用程序。</span><div>
                              <p>对预编译器的事务导向SQL语句遵守特殊限制。</p>
                              <div class="infoboxnotealso" id="GUID-FE99AEDA-C4B1-40F9-A3BB-4484F9532753__GUID-AB0A5F35-9E3B-4959-990B-959E0C3B13FE">
                                 <p class="notep1">也可以看看：</p>
                                 <p><a href="xa.html#GUID-22284B0A-C63F-471A-96ED-AEA195068944">开发和安装XA应用程序</a></p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>根据TPM供应商说明链接应用程序。</span></li>
                     </ol>
                  </div>
               </div><a id="ADFNS1100"></a><a id="ADFNS780"></a><div class="props_rev_3"><a id="GUID-33E70E78-7ACD-4B6F-84C2-AC567C6EDE96" name="GUID-33E70E78-7ACD-4B6F-84C2-AC567C6EDE96"></a><h4 id="ADFNS-GUID-33E70E78-7ACD-4B6F-84C2-AC567C6EDE96" class="sect4">定义xa_open字符串</h4>
                  <div>
                     <div class="section">
                        <p>事务监视器使用打开的字符串来打开数据库。打开字符串中的最大字符数为256。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-33E70E78-7ACD-4B6F-84C2-AC567C6EDE96__GUID-C967996D-E739-49A0-A6B6-FBEC760D51B8">话题：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="xa.html#GUID-A4EF3AB0-8800-45B8-9A71-07986BE3697B">xa_open字符串的语法</a></p>
                           </li>
                           <li>
                              <p><a href="xa.html#GUID-C6CEF296-5873-4F8B-80AE-F647B9367054">xa_open字符串的必填字段</a></p>
                           </li>
                           <li>
                              <p><a href="xa.html#GUID-F2867F04-EE6C-4AB7-83FE-7E77F6EFACD2">xa_open字符串的可选字段</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS782"></a><a id="ADFNS781"></a><div class="props_rev_3"><a id="GUID-A4EF3AB0-8800-45B8-9A71-07986BE3697B" name="GUID-A4EF3AB0-8800-45B8-9A71-07986BE3697B"></a><h5 id="ADFNS-GUID-A4EF3AB0-8800-45B8-9A71-07986BE3697B" class="sect5">xa_open字符串的语法</h5>
                     <div>
                        <div class="section">
                           <p>您可以使用<a href="xa.html#GUID-A4EF3AB0-8800-45B8-9A71-07986BE3697B__BGBJCIHB">示例22-1中</a>显示的语法定义一个打开的字符串。
                           </p>
                           <p>这些字符串显示示例参数设置：</p><pre class="oac_no_warn" dir="ltr">ORACLE_XA + DB = MANAGERS + SqlNet = SID1 + ACC = P / <span class="italic">用户名</span> / <span class="italic">密码</span> + SesTM = 10 + LogDir = / usr / local / xalog ORACLE_XA + DB = PAYROLL + SqlNet = SID2 + ACC = P / <span class="italic">用户名</span> / <span class="italic">密码</span> + SesTM = 10 + LogDir = / usr / local / xalog ORACLE_XA + SqlNet = SID3 + ACC = P / <span class="italic">用户名</span> / <span class="italic">密码</span> + SesTM = 10 + LogDir = / usr / local / xalog</pre><p>这些主题描述了<span class="italic"><code class="codeph">required_fields</code></span>有效参数<span class="italic"> </span>和<span class="italic"><code class="codeph">optional_fields</code></span>占位符：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="xa.html#GUID-C6CEF296-5873-4F8B-80AE-F647B9367054">xa_open字符串的必填字段</a></p>
                              </li>
                              <li>
                                 <p><a href="xa.html#GUID-F2867F04-EE6C-4AB7-83FE-7E77F6EFACD2">xa_open字符串的可选字段</a></p>
                              </li>
                           </ul>
                           <div class="infoboxnote" id="GUID-A4EF3AB0-8800-45B8-9A71-07986BE3697B__GUID-482A066D-E03F-4A9C-BCD4-0F8F59C18348">
                              <p class="notep1">注意：</p>
                              <p></p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>在构造打开的字符串时，您可以按任何顺序输入必填字段和可选字段。</p>
                                 </li>
                                 <li>
                                    <p>所有字段名称都不区分大小写。它们的值是否区分大小写取决于平台。</p>
                                 </li>
                                 <li>
                                    <p>无法使用加号（ <code class="codeph">+</code> ）作为实际信息字符串的一部分。
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-A4EF3AB0-8800-45B8-9A71-07986BE3697B__BGBJCIHB">
                           <p class="titleinexample">例22-1 xa_open字符串</p><pre class="oac_no_warn" dir="ltr">ORACLE_XA {+ <span class="italic"><code class="codeph">required_fields</code></span> ...} [+ <span class="italic"><code class="codeph">optional_fields</code></span> <span class="italic">..</span> ]
</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="ADFNS784"></a><a id="ADFNS783"></a><div class="props_rev_3"><a id="GUID-C6CEF296-5873-4F8B-80AE-F647B9367054" name="GUID-C6CEF296-5873-4F8B-80AE-F647B9367054"></a><h5 id="ADFNS-GUID-C6CEF296-5873-4F8B-80AE-F647B9367054" class="sect5">xa_open字符串的必填字段</h5>
                     <div>
                        <p><a href="xa.html#GUID-A4EF3AB0-8800-45B8-9A71-07986BE3697B__BGBJCIHB">例22-1中</a>的<span class="italic"><code class="codeph">required_fields</code></span>占位符引用<a href="xa.html#GUID-C6CEF296-5873-4F8B-80AE-F647B9367054__BGBDIACH" title="此表汇总了xa_open字符串的必填字段。">表22-4中</a>描述的任何名称 - 值对。
                        </p>
                        <div class="tblformal" id="GUID-C6CEF296-5873-4F8B-80AE-F647B9367054__BGBDIACH">
                           <p class="titleintable">表22-4 xa_open字符串的必填字段</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="xa_open字符串的必填字段" width="100%" border="1" summary="This table summarizes the required fields of the xa_open string." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="36%" id="d132228e2287">语法元素</th>
                                    <th align="left" valign="bottom" width="64%" id="d132228e2290">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="36%" id="d132228e2295" headers="d132228e2287 ">
                                       <p><code class="codeph">度Acc = P //</code></p>
                                    </td>
                                    <td align="left" valign="top" width="64%" headers="d132228e2295 d132228e2290 ">
                                       <p>指定不提供显式用户或密码信息，并且使用操作系统身份验证表单。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="36%" id="d132228e2303" headers="d132228e2287 ">
                                       <p><code class="codeph">Acc=P/</code> <span class="italic"><code class="codeph">user</code></span> <code class="codeph">/</code> <span class="italic"><code class="codeph">password</code></span> 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="64%" headers="d132228e2303 d132228e2290 ">
                                       <p>指定有效Oracle数据库帐户的用户名和密码。如<a href="xa.html#GUID-91007BAE-9DD3-4993-8220-C3EC8391376B">DBA或系统管理员职责中所述</a> ，确保HR对<code class="codeph">DBA_PENDING_TRANSACTIONS</code>表具有<code class="codeph">READ</code>或<code class="codeph">SELECT</code>权限。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="36%" id="d132228e2333" headers="d132228e2287 ">
                                       <p><code class="codeph">SesTm=</code> <span class="italic"><code class="codeph">session_time_limit</code></span></p>
                                    </td>
                                    <td align="left" valign="top" width="64%" headers="d132228e2333 d132228e2290 ">
                                       <p>指定在系统终止事务之前，一个服务与下一个服务之间或服务与事务的提交或回滚之间的事务中允许的最大秒数。例如， <code class="codeph">SesTM=15</code>表示会话空闲时间限制为15秒。
                                       </p>
                                       <p>例如，如果TPM使用客户端和服务器之间的远程子程序调用，则<code class="codeph">SesTM</code>适用于完成一个RPC和启动下一个RPC，或<code class="codeph">tx_commit</code>或<code class="codeph">tx_rollback</code> 。
                                       </p>
                                       <p>值<code class="codeph">0</code>表示没有限制。强烈建议不要输入值<code class="codeph">0</code> 。如果出现问题，它可能会长时间占用资源。此外，如果子进程的<code class="codeph">SesTM=0</code> ，则父进程终止后， <code class="codeph">SesTM</code>设置无效。
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <div class="infoboxnotealso" id="GUID-C6CEF296-5873-4F8B-80AE-F647B9367054__NOTE-123-CB061EE4">
                           <p class="notep1">也可以看看：</p>
                           <p>有关管理员身份验证的详细信息，请参见<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ADMIN11046" target="_blank"><span class="italic">“Oracle数据库管</span></a></p>
                        </div>
                     </div>
                  </div><a id="ADFNS786"></a><a id="ADFNS785"></a><div class="props_rev_3"><a id="GUID-F2867F04-EE6C-4AB7-83FE-7E77F6EFACD2" name="GUID-F2867F04-EE6C-4AB7-83FE-7E77F6EFACD2"></a><h5 id="ADFNS-GUID-F2867F04-EE6C-4AB7-83FE-7E77F6EFACD2" class="sect5">xa_open字符串的可选字段</h5>
                     <div>
                        <p><a href="xa.html#GUID-A4EF3AB0-8800-45B8-9A71-07986BE3697B__BGBJCIHB">例22-1中</a>的<span class="italic"><code class="codeph">optional_fields</code></span>占位符引用<a href="xa.html#GUID-F2867F04-EE6C-4AB7-83FE-7E77F6EFACD2__BGBFICJB" title="此表汇总了xa_open字符串的可选字段。">表22-5中</a>描述的任何名称 - 值对。
                        </p>
                        <div class="tblformal" id="GUID-F2867F04-EE6C-4AB7-83FE-7E77F6EFACD2__BGBFICJB">
                           <p class="titleintable">表22-5 xa_open字符串中的可选字段</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="xa_open字符串中的可选字段" width="100%" border="1" summary="This table summarizes the optional fields of the xa_open string." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="31%" id="d132228e2498">语法元素</th>
                                    <th align="left" valign="bottom" width="69%" id="d132228e2501">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d132228e2506" headers="d132228e2498 ">
                                       <p><code class="codeph">NoLocal = true |假</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d132228e2506 d132228e2501 ">
                                       <p>指定是否允许本地事务。默认值为<code class="codeph">false</code> 。如果应用程序必须禁止本地事务，则将值设置为<code class="codeph">true</code> 。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d132228e2520" headers="d132228e2498 ">
                                       <p><code class="codeph">DB=</code> <span class="italic"><code class="codeph">db_name</code></span></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d132228e2520 d132228e2501 ">
                                       <p>指定Oracle数据库预编译器用于标识数据库的名称。例如， <code class="codeph">DB=payroll</code>指定数据库名称是<code class="codeph">payroll</code> ，并且应用程序服务器程序在<code class="codeph">AT</code>子句中使用该名称。
                                       </p>
                                       <p>仅使用Oracle数据库预编译器的默认数据库的应用程序（即，它们的SQL语句中不使用<code class="codeph">AT</code>子句）必须省略打开字符串中的<code class="codeph">DB=</code> <span class="italic"><code class="codeph">db_name</code></span>子句。使用显式命名数据库的应用程序必须在其<code class="codeph">DB=</code> <span class="italic"><code class="codeph">db_name</code></span>字段中指明该数据库名称。Oracle数据库版本7 OCI程序必须调用<code class="codeph">sqlld2</code>函数以获取登录数据区域（ <code class="codeph">Lda_Def</code> ）的正确上下文，该区域等同于OCI服务上下文。版本8及更高版本的OCI程序必须调用<code class="codeph">xaoSvcCtx</code>函数来获取<code class="codeph">OCISvcCtx</code>服务上下文。
                                       </p>
                                       <p><span class="italic"><code class="codeph">db_name</code></span>不是SID，不用于查找要打开的数据库。相反，它将此打开字符串打开的数据库与应用程序中用于运行SQL语句的名称相关联。SID是从TPM应用程序服务器的环境变量<code class="codeph">ORACLE_SID</code>或打开字符串中的Oracle Net子句中给出的SID设置的。Oracle Net子句将在本节后面介绍。某些TPM供应商提供了一种命名一组使用相同开放字符串的服务器的方法。您可能会发现为此目的和db_name选择相同的名称很方便。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d132228e2579" headers="d132228e2498 ">
                                       <p><code class="codeph">LogDir=</code> <span class="italic"><code class="codeph">log_dir</code></span></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d132228e2579 d132228e2501 ">
                                       <p>指定要记录Oracle XA库错误和跟踪信息的本地系统上的路径名。默认值是<code class="codeph">$ORACLE_HOME/rdbms/log</code> ，如果<code class="codeph">ORACLE_HOME</code>设置;否则，它指定当前目录。例如， <code class="codeph">LogDir=/xa_trace</code>表示日志记录信息位于<code class="codeph">/xa_trace</code>目录下。确保该目录存在且应用程序服务器可以写入该目录。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d132228e2602" headers="d132228e2498 ">
                                       <p><code class="codeph">Objects= true</code> | <code class="codeph">false</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d132228e2602 d132228e2501 ">
                                       <p>指定是否在对象模式下初始化应用程序。默认值为false。如果应用程序必须使用某些需要对象模式的API调用，例如<code class="codeph">OCIRawAssignBytes</code> ，则将该值设置为<code class="codeph">true</code> 。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d132228e2619" headers="d132228e2498 ">
                                       <p><code class="codeph">MaxCur=</code> <span class="italic"><code class="codeph">maximum_#_of_open_cursors</code></span></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d132228e2619 d132228e2501 ">
                                       <p>指定打开数据库时要分配的游标数。它与预编译器选项<code class="codeph">maxopencursors</code>用途相同。例如， <code class="codeph">MaxCur=5</code>表示预编译器尝试保持缓存五个打开的游标。此参数将覆盖您可能在源代码中或在编译时指定的预编译器选项<code class="codeph">maxopencursors</code> 。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d132228e2639" headers="d132228e2498 ">
                                       <p><code class="codeph">SqlNet=</code> <span class="italic"><code class="codeph">db_link</code></span></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d132228e2639 d132228e2501 ">
                                       <p>指定用于登录系统的Oracle Net数据库链接。该字符串必须是<code class="codeph">tnsnames.ora</code>的条目。例如，如果在<code class="codeph">tnsnames.ora</code>定义，则字符串<code class="codeph">SqlNet=inst1_disp</code>可能会连接到实例1上的共享服务器。
                                       </p>
                                       <p>在无法控制服务器环境变量的情况下，可以使用<code class="codeph">SqlNet</code>参数指定<code class="codeph">ORACLE_SID</code> 。当服务器必须访问多个Oracle数据库实例时，您还必须使用它。要在不实际访问远程数据库的情况下使用Oracle Net字符串，请使用管道驱动程序。例如，指定<code class="codeph">SqlNet=localsid1</code> ，其中<code class="codeph">localsid1</code>是<code class="codeph">tnsnames.ora</code>文件中定义的别名。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d132228e2676" headers="d132228e2498 ">
                                       <p><code class="codeph">Loose_Coupling = true |假</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d132228e2676 d132228e2501 ">
                                       <p>指定是否共享锁。同一个全局事务中的Oracle数据库事务分支可以紧密耦合或松散耦合。如果分支松散耦合，则它们不共享锁。对于松散耦合的分支，将值设置为<code class="codeph">true</code> 。如果分支紧密耦合，则它们共享锁。对于紧耦合分支，将值设置为<code class="codeph">false</code> 。默认值为<code class="codeph">false</code> 。
                                       </p>
                                       <p><span class="bold">注意：</span>运行Oracle RAC时，如果事务分支<code class="codeph">Loose_Coupling=false</code>在不同的Oracle RAC实例上，则即使<code class="codeph">Loose_Coupling=false</code> ，它们也会松散耦合。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d132228e2700" headers="d132228e2498 ">
                                       <p><code class="codeph">SesWt=</code> <span class="italic"><code class="codeph">session_wait_limit</code></span></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d132228e2700 d132228e2501 ">
                                       <p>指定Oracle数据库在返回<code class="codeph">XA_RETRY</code>之前<code class="codeph">XA_RETRY</code>另一个会话正在使用的事务分支的<code class="codeph">XA_RETRY</code> 。默认值为60秒。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d132228e2714" headers="d132228e2498 ">
                                       <p><code class="codeph">Threads=true</code> | <code class="codeph">false</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d132228e2714 d132228e2501 ">
                                       <p>指定应用程序是否为多线程。默认值为<code class="codeph">false</code> 。如果应用程序是多线程的，则设置为<code class="codeph">true</code> 。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d132228e2731" headers="d132228e2498 ">
                                       <p><code class="codeph">FAN=true</code> | <code class="codeph">false</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d132228e2731 d132228e2501 ">
                                       <p>指定应用程序是否将使用快速应用程序通知（FAN）。默认值为<code class="codeph">false</code> 。如果应用程序将使用FAN，则设置为<code class="codeph">true</code> 。
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <div class="infoboxnotealso" id="GUID-F2867F04-EE6C-4AB7-83FE-7E77F6EFACD2__NOTE-123-CB056A25">
                           <p class="notep1">也可以看看：</p>
                           <p>有关FAN的信息，请参见<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ADMIN13178" target="_blank"><span class="italic">“Oracle数据库管理员指南”</span></a></p>
                        </div>
                     </div>
                  </div>
               </div><a id="ADFNS787"></a><div class="props_rev_3"><a id="GUID-F59B1580-2DAF-44DA-9B19-F4AA10DF9937" name="GUID-F59B1580-2DAF-44DA-9B19-F4AA10DF9937"></a><h4 id="ADFNS-GUID-F59B1580-2DAF-44DA-9B19-F4AA10DF9937" class="sect4">将Oracle XA与预编译器一起使用</h4>
                  <div>
                     <div class="section">
                        <p>在Oracle XA应用程序中使用时，游标仅在事务持续时间内有效。必须在事务开始后打开显式游标，并在提交或回滚之前关闭。</p>
                        <p>在与预编译器连接时，您有以下选项：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="xa.html#GUID-EEFA138F-9B25-4085-B141-FF5E959A2B87">将预编译器与默认数据库一起使用</a></p>
                           </li>
                           <li>
                              <p><a href="xa.html#GUID-FB945892-26E9-4AF4-B0DB-7ED5A66CAAFB">将预编译器与命名数据库一起使用</a></p>
                           </li>
                        </ul>
                        <p>本主题中的示例使用预编译器Pro * C / C ++。</p>
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS788"></a><div class="props_rev_3"><a id="GUID-EEFA138F-9B25-4085-B141-FF5E959A2B87" name="GUID-EEFA138F-9B25-4085-B141-FF5E959A2B87"></a><h5 id="ADFNS-GUID-EEFA138F-9B25-4085-B141-FF5E959A2B87" class="sect5">将预编译器与默认数据库一起使用</h5>
                     <div>
                        <div class="section">
                           <p>要使用缺省数据库连接预编译器，请确保不存在打开字符串中使用的<code class="codeph">DB</code> = <span class="italic"><code class="codeph">db_name</code></span>字段。缺少此字段表示默认连接。每个进程只允许一个默认连接。
                           </p>
                           <p>这是一个标识默认Pro * C / C ++连接的开放字符串示例：</p><pre class="oac_no_warn" dir="ltr">ORACLE_XA + SqlNet = maildb + ACC = P / <span class="italic">用户名</span> / <span class="italic">密码</span> + SesTM = 10 + LogDir = / usr / local / logs</pre><p><code class="codeph">DB</code> = <span class="italic"><code class="codeph">db_name</code></span>不存在，表示空数据库ID字符串。
                           </p>
                           <p>SQL语句的语法是：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL UPDATE Emp_tab SET Sal = Sal * 1.5;</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="ADFNS790"></a><a id="ADFNS789"></a><div class="props_rev_3"><a id="GUID-FB945892-26E9-4AF4-B0DB-7ED5A66CAAFB" name="GUID-FB945892-26E9-4AF4-B0DB-7ED5A66CAAFB"></a><h5 id="ADFNS-GUID-FB945892-26E9-4AF4-B0DB-7ED5A66CAAFB" class="sect5">将预编译器与命名数据库一起使用</h5>
                     <div>
                        <div class="section">
                           <p>要与具有指定数据库的预编译器连接，请在打开的字符串中包含<code class="codeph">DB</code> = <span class="italic"><code class="codeph">db_name</code></span>字段。您引用的任何数据库都必须引用您在相应的打开字符串中指定的相同<span class="italic"><code class="codeph">db_name</code></span> 。
                           </p>
                           <p>应用程序可能包括默认数据库和一个或多个命名数据库。例如，假设您要在一个数据库中更新员工的薪水，在另一个数据库中更新他的部门编号（ <code class="codeph">DEPTNO</code> ），在第三个数据库中更新他的经理。在事务管理器中配置打开的字符串，如<a href="xa.html#GUID-FB945892-26E9-4AF4-B0DB-7ED5A66CAAFB__BGBIEBII">例22-2</a>所示。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-FB945892-26E9-4AF4-B0DB-7ED5A66CAAFB__BGBIEBII">
                           <p class="titleinexample">示例22-2示例打开字符串配置</p><pre class="oac_no_warn" dir="ltr">ORACLE_XA + DB = MANAGERS + SqlNet = SID1 + ACC = P / <span class="italic">用户名</span> / <span class="italic">密码</span> + SesTM = 10 + LogDir = / usr / local / xalog ORACLE_XA + DB = PAYROLL + SqlNet = SID2 + ACC = P / <span class="italic">用户名</span> / <span class="italic">密码</span> + SesTM = 10 + LogDir = / usr / local / xalog ORACLE_XA + SqlNet = SID3 + ACC = P / <span class="italic">用户名</span> / <span class="italic">密码</span> + SesTM = 10 + LogDir = / usr / local / xalog</pre><p><a href="xa.html#GUID-FB945892-26E9-4AF4-B0DB-7ED5A66CAAFB__BGBIEBII">例22-2中</a>最后一个打开的字符串中没有<code class="codeph">DB</code> = <span class="italic"><code class="codeph">db_name</code></span>字段。
                           </p>
                           <p>在应用程序服务器程序中，输入声明，例如：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL DECLARE PAYROLL DATABASE; EXEC SQL DECLARE MANAGERS DATABASE;</pre><p>同样，默认连接（对应于不包含<code class="codeph">DB</code>字段的第三个打开的字符串）不需要声明。
                           </p>
                           <p>进行更新时，输入与以下类似的语句：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL AT PAYROLL UPDATE Emp_Tab SET Sal = 4500 WHERE Empno = 7788; EXEC SQL AT MANAGERS UPDATE Emp_Tab SET Mgr = 7566 WHERE Empno = 7788; EXEC SQL UPDATE Emp_Tab SET Deptno = 30 WHERE Empno = 7788;</pre><p>最后一个语句中没有<code class="codeph">AT</code>子句，因为它指的是默认数据库。
                           </p>
                           <p>在Oracle数据库预编译器1.5.3或更高版本中，您可以在<code class="codeph">AT</code>子句中使用字符主机变量，如下例所示：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL BEGIN DECLARE SECTION; DB_NAME1 CHARACTER（10）; DB_NAME2 CHARACTER（10）; EXEC SQL END DECLARE SECTION; ...SET DB_NAME1 ='PAYROLL'SET DB_NAME2 ='MANAGERS'...EXEC SQL AT：DB_NAME1更新...EXEC SQL AT：DB_NAME2更新...</pre><div class="infoboxnote" id="GUID-FB945892-26E9-4AF4-B0DB-7ED5A66CAAFB__GUID-7765C40A-DEF7-4957-A632-10F9CE39F8BB">
                              <p class="notep1">警告：</p>
                              <p>没有XA应用程序创建除通过<code class="codeph">xa_open</code>创建的连接之外的连接。在非XA连接上执行的工作在全局事务之外，必须单独提交。
                              </p>
                           </div>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div><a id="ADFNS791"></a><div class="props_rev_3"><a id="GUID-085722D0-7EFA-40D8-88F0-9C06D19A26CB" name="GUID-085722D0-7EFA-40D8-88F0-9C06D19A26CB"></a><h4 id="ADFNS-GUID-085722D0-7EFA-40D8-88F0-9C06D19A26CB" class="sect4">将Oracle XA与OCI结合使用</h4>
                  <div>
                     <div class="section">
                        <p>使用Oracle XA库的Oracle Call Interface应用程序不得调用<code class="codeph">OCISessionBegin</code>登录资源管理器。相反，登录必须通过TPM完成。当应用程序必须访问资源管理器时，应用程序可以运行<code class="codeph">xaoSvcCtx</code>函数以获取服务上下文结构。
                        </p>
                        <p>在必须将环境句柄传递给OCI函数的应用程序中，您还可以调用<code class="codeph">xaoEnv</code>来查找该句柄。
                        </p>
                        <p>由于应用程序服务器可以具有多个并发的Oracle数据库资源管理器，因此必须使用正确的参数调用函数<code class="codeph">xaoSvcCtx</code>以获取正确的服务上下文。
                        </p>
                        <div class="infoboxnotealso" id="GUID-085722D0-7EFA-40D8-88F0-9C06D19A26CB__GUID-B04D1CD9-1351-4C0A-A385-2543C4D7F7A5">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI-GUID-27645179-6957-4004-8BB8-38775266B038" target="_blank"><span><cite>Oracle调用接口程序员指南</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS793"></a><a id="ADFNS792"></a><div class="props_rev_3"><a id="GUID-731EEEF6-C3CB-460C-85DE-25F5EF88FD2C" name="GUID-731EEEF6-C3CB-460C-85DE-25F5EF88FD2C"></a><h4 id="ADFNS-GUID-731EEEF6-C3CB-460C-85DE-25F5EF88FD2C" class="sect4">使用Oracle XA管理事务控制</h4>
                  <div>
                     <div class="section">
                        <p>使用XA库时，事务不受提交或回滚事务的SQL语句控制。相反，它们由TM接受的API控制，该API启动和停止事务。您调用事务管理器提供的API，包括<a href="xa.html#GUID-731EEEF6-C3CB-460C-85DE-25F5EF88FD2C__g1017842" title="该表总结了TX接口功能。">表22-6中</a>列出的TX接口，但不调用<a href="xa.html#GUID-9C1460F8-43B4-470B-A624-07889E522340__g1017655" title="此表总结了XA库子例程。">表22-2中</a>列出的XA库子程序。
                        </p>
                        <p>TM通常通过XA接口控制事务。该接口包括<a href="xa.html#GUID-9C1460F8-43B4-470B-A624-07889E522340__g1017655" title="此表总结了XA库子例程。">表22-2中</a>描述的功能。
                        </p>
                        <div class="tblformal" id="GUID-731EEEF6-C3CB-460C-85DE-25F5EF88FD2C__g1017842">
                           <p class="titleintable">表22-6 TX接口功能</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="TX接口功能" width="100%" border="1" summary="This table summarizes the TX interface functions." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="31%" id="d132228e3444">TX功能</th>
                                    <th align="left" valign="bottom" width="69%" id="d132228e3447">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d132228e3452" headers="d132228e3444 ">
                                       <p><code class="codeph">tx_open</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d132228e3452 d132228e3447 ">
                                       <p>登录资源管理器</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d132228e3460" headers="d132228e3444 ">
                                       <p><code class="codeph">tx_close</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d132228e3460 d132228e3447 ">
                                       <p>退出资源管理器</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d132228e3468" headers="d132228e3444 ">
                                       <p><code class="codeph">tx_begin</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d132228e3468 d132228e3447 ">
                                       <p>开始交易</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d132228e3476" headers="d132228e3444 ">
                                       <p><code class="codeph">tx_commit</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d132228e3476 d132228e3447 ">
                                       <p>提交交易</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d132228e3484" headers="d132228e3444 ">
                                       <p><code class="codeph">tx_rollback</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d132228e3484 d132228e3447 ">
                                       <p>回滚交易</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>大多数TPM应用程序使用客户端/服务器架构，其中应用程序客户端请求服务，应用程序服务器提供服务。<span class="q">“ <a href="xa.html#GUID-629D4D9D-1B0D-4582-9FC7-9AE011CDA07A">预编译器应用程序</a></span>示例”中显示的<span class="q"><a href="xa.html#GUID-629D4D9D-1B0D-4582-9FC7-9AE011CDA07A">示例</a></span>使用这样的客户端/服务器模型。服务是一个逻辑工作单元，对于作为资源管理器的Oracle数据库，它包含一组执行相关工作单元的SQL语句。
                        </p>
                        <p>例如，当名为“credit”的服务收到帐号和要记入的金额时，它会运行SQL语句来更新数据库中某些表中的信息。此外，服务可能会请求其他服务。例如，“转账”服务可能会从“信用”和“借记”服务请求服务。</p>
                        <p>通常，应用程序客户端从应用程序服务器请求服务以在事务中执行任务。但是，对于某些TPM系统，应用程序客户端本身可以提供自己的本地服务。如<span class="q">“ <a href="xa.html#GUID-629D4D9D-1B0D-4582-9FC7-9AE011CDA07A">预编译器应用程序示例</a> ”中所示</span> ，您可以在客户端或服务器中编码事务控制语句。
                        </p>
                        <p>为了让多个进程参与同一事务，TPM提供了一个通信API，使事务信息能够在参与的进程之间流动。通信API的示例包括RPC，伪RPC函数和发送/接收函数。</p>
                        <p>由于领先的供应商支持不同的通信功能，因此这些示例使用通信伪功能<code class="codeph">tpm_service</code>来概括通信API。</p>
                        <p>X / Open包括几种在其初步规范中提供通信功能的替代方法。每个领先的TPM供应商都支持这些替代方案中的至少一个。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS795"></a><a id="ADFNS796"></a><a id="ADFNS794"></a><div class="props_rev_3"><a id="GUID-629D4D9D-1B0D-4582-9FC7-9AE011CDA07A" name="GUID-629D4D9D-1B0D-4582-9FC7-9AE011CDA07A"></a><h4 id="ADFNS-GUID-629D4D9D-1B0D-4582-9FC7-9AE011CDA07A" class="sect4">预编译器应用程序的示例</h4>
                  <div>
                     <p>这些示例说明了预编译器应用程序。假设应用程序服务器已以TPM特定方式登录到RM系统。<a href="xa.html#GUID-629D4D9D-1B0D-4582-9FC7-9AE011CDA07A__BGBDDBJJ">例22-3</a>显示了由应用程序服务器启动的事务。
                     </p>
                     <div class="example" id="GUID-629D4D9D-1B0D-4582-9FC7-9AE011CDA07A__BGBDDBJJ">
                        <p class="titleinexample">示例22-3应用程序服务器启动的事务</p><pre class="oac_no_warn" dir="ltr">/ *****客户端：***** / tpm_service（“ServiceName”）; <span class="italic">/ * Request Service * /</span> / ***** Server：***** / ServiceName（）{&lt;get service specific data&gt; tx_begin（）; <span class="italic">/ *开始事务边界* /</span> EXEC SQL UPDATE ...; / *此应用程序服务器暂时变为* / / *客户端并请求其他服务。* / tpm_service（“AnotherService”）; tx_commit（）; <span class="italic">/ *提交事务* /</span> &lt;将服务状态返回给客户端&gt;}</pre><p><a href="xa.html#GUID-629D4D9D-1B0D-4582-9FC7-9AE011CDA07A__BGBGFADB">例22-4</a>显示了由应用程序客户端启动的事务。
                        </p>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-629D4D9D-1B0D-4582-9FC7-9AE011CDA07A__BGBGFADB">
                        <p class="titleinexample">示例22-4应用程序客户端启动的事务</p><pre class="oac_no_warn" dir="ltr">/ *****客户端：***** / tx_begin（）; <span class="italic">/ *开始事务边界* /</span> tpm_service（“Service1”）; tpm_service（ “服务2”）; tx_commit（）; / *提交事务* / / *****服务器：***** / Service1（）{&lt;获取服务特定数据&gt; EXEC SQL UPDATE ...; &lt;将服务状态返回给客户端&gt;} Service2（）{&lt;获取服务特定数据&gt; EXEC SQL UPDATE ...; ...&lt;将服务状态返回客户端&gt;}</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="ADFNS798"></a><a id="ADFNS797"></a><div class="props_rev_3"><a id="GUID-97D86BEB-B303-4CCE-9D7A-D65BB79F43DE" name="GUID-97D86BEB-B303-4CCE-9D7A-D65BB79F43DE"></a><h4 id="ADFNS-GUID-97D86BEB-B303-4CCE-9D7A-D65BB79F43DE" class="sect4">将预编译器或OCI应用程序迁移到TPM应用程序</h4>
                  <div>
                     <div class="section">
                        <p>要将现有预编译器或OCI应用程序迁移到使用Oracle XA库的TPM应用程序，您必须：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>将应用程序重新组织到“服务”框架中，以便应用程序客户端从应用程序服务器请求服务。某些TPM要求应用程序使用<code class="codeph">tx_open</code>和<code class="codeph">tx_close</code>函数，而其他TPM则隐式执行登录和注销。</span><div>
                              <p>如果未在打开的字符串中指定<code class="codeph">SqlNet</code>参数，则应用程序将使用默认的Oracle Net驱动程序。因此，请确保使用正确定义的<code class="codeph">ORACLE_HOME</code>和<code class="codeph">ORACLE_SID</code>环境变量启动应用程序服务器。这是以TPM特定的方式完成的。有关如何完成此操作的说明，请参阅TPM供应商文档。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>确保应用程序替换常规的connect和disconnect语句。例如，替换连接语句<code class="codeph">EXEC</code> <code class="codeph">SQL</code> <code class="codeph">CONNECT</code> （对于预编译器）或<code class="codeph">OCISessionBegin</code> ， <code class="codeph">OCIServerAttach</code> ，和<code class="codeph">OCIEnvCreate</code>用（对于OCI） <code class="codeph">tx_open</code> 。更换断开语句<code class="codeph">EXEC</code> <code class="codeph">SQL</code> <code class="codeph">COMMIT</code> / <code class="codeph">ROLLBACK</code> <code class="codeph">WORK RELEASE</code> （对于预编译器）或<code class="codeph">OCISessionEnd</code> / <code class="codeph">OCIServerDetach</code> （用于OCI）与<code class="codeph">tx_close</code> 。</span></li>
                        <li class="stepexpand"><span>确保应用程序替换任何全局事务的常规提交或回滚语句，并显式启动事务。</span><div>
                              <p>例如，更换<code class="codeph">COMMIT</code> / <code class="codeph">ROLLBACK</code>语句<code class="codeph">EXEC</code> <code class="codeph">SQL</code> <code class="codeph">COMMIT</code> / <code class="codeph">ROLLBACK</code> <code class="codeph">WORK</code> （用于预编译器），或者<code class="codeph">OCITransCommit</code> <code class="codeph">/</code> <code class="codeph">OCITransRollback</code>用（用于OCI） <code class="codeph">tx_commit/tx_rollback</code> ，并通过调用启动事务<code class="codeph">tx_begin</code> 。
                              </p>
                              <div class="infoboxnote" id="GUID-97D86BEB-B303-4CCE-9D7A-D65BB79F43DE__GUID-8097AC93-3568-406D-8070-F25AF61F8EC9">
                                 <p class="notep1">注意：</p>
                                 <p>以上内容仅适用于全局事务而非本地事务。使用Oracle API提交或回滚本地事务。</p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>确保应用程序在结束事务之前重置获取状态。通常，使用<code class="codeph">release_cursor=no</code> 。仅当您确定语句只运行一次时才使用<code class="codeph">release_cursor=yes</code> 。</span></li>
                     </ol>
                     <div class="section">
                        <p><a href="xa.html#GUID-97D86BEB-B303-4CCE-9D7A-D65BB79F43DE__g1017864" title="此表汇总了TPM替换命令。">表22-7</a>列出了在将预编译器或OCI应用程序迁移到TPM应用程序时替换常规Oracle Database语句的TPM函数。
                        </p>
                        <div class="tblformal" id="GUID-97D86BEB-B303-4CCE-9D7A-D65BB79F43DE__g1017864">
                           <p class="titleintable">表22-7 TPM替换声明</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="TPM替换声明" width="100%" border="1" summary="This table summarizes the TPM replacement commands." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="44%" id="d132228e3883">常规Oracle数据库语句</th>
                                    <th align="left" valign="bottom" width="56%" id="d132228e3886">TPM功能</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="44%" id="d132228e3891" headers="d132228e3883 ">
                                       <p><code class="codeph">CONNECT</code> <span class="italic"><code class="codeph">user</code></span> / <span class="italic"><code class="codeph">password</code></span></p>
                                    </td>
                                    <td align="left" valign="top" width="56%" headers="d132228e3891 d132228e3886 ">
                                       <p><code class="codeph">tx_open</code> （可能隐含）</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="44%" id="d132228e3908" headers="d132228e3883 ">
                                       <p>隐含的交易开始</p>
                                    </td>
                                    <td align="left" valign="top" width="56%" headers="d132228e3908 d132228e3886 ">
                                       <p><code class="codeph">tx_begin</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="44%" id="d132228e3916" headers="d132228e3883 ">
                                       <p><code class="codeph">SQL</code></p>
                                    </td>
                                    <td align="left" valign="top" width="56%" headers="d132228e3916 d132228e3886 ">
                                       <p>运行SQL的服务</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="44%" id="d132228e3924" headers="d132228e3883 ">
                                       <p><code class="codeph">承诺</code></p>
                                    </td>
                                    <td align="left" valign="top" width="56%" headers="d132228e3924 d132228e3886 ">
                                       <p><code class="codeph">tx_commit</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="44%" id="d132228e3933" headers="d132228e3883 ">
                                       <p><code class="codeph">ROLLBACK</code></p>
                                    </td>
                                    <td align="left" valign="top" width="56%" headers="d132228e3933 d132228e3886 ">
                                       <p><code class="codeph">tx_rollback</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="44%" id="d132228e3942" headers="d132228e3883 ">
                                       <p>断开</p>
                                    </td>
                                    <td align="left" valign="top" width="56%" headers="d132228e3942 d132228e3886 ">
                                       <p><code class="codeph">tx_close</code> （可能隐含）</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS1106"></a><a id="ADFNS799"></a><div class="props_rev_3"><a id="GUID-1769DFE4-A670-471F-81D2-514398386A41" name="GUID-1769DFE4-A670-471F-81D2-514398386A41"></a><h4 id="ADFNS-GUID-1769DFE4-A670-471F-81D2-514398386A41" class="sect4">管理Oracle XA Library线程安全</h4>
                  <div>
                     <div class="section">
                        <p>如果使用支持线程的事务监视器，则Oracle XA库使您可以编写线程安全的应用程序。不过，请记住某些问题。</p>
                        <p><strong class="term">控制线程</strong> （或线程）是指与资源管理器的连接集。在非线程系统中，每个进程都被视为一个控制线程，因为每个进程都有自己的一组与RM的连接，并维护自己独立的资源管理器表。在线程系统中，每个线程都有一组与RM的自主连接，每个线程都维护一个<span class="italic">私有</span> RM表。必须为每个线程分配此专用表，并在线程终止时解除分配，即使终止异常。
                        </p>
                        <div class="infoboxnote" id="GUID-1769DFE4-A670-471F-81D2-514398386A41__GUID-7D61DDF5-5E58-49C7-90BD-9C5432AD2D99">
                           <p class="notep1">注意：</p>
                           <p>在Oracle数据库中，访问数据库的每个线程都必须具有自己的连接。</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-1769DFE4-A670-471F-81D2-514398386A41__GUID-773EFAC2-B84F-447B-8514-ACBD22B95747">话题：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="xa.html#GUID-45CBD96F-DE5E-4A2C-AEC4-5E1AA6E33D0A">在Open String中指定线程</a></p>
                           </li>
                           <li>
                              <p><a href="xa.html#GUID-50E69541-0FA8-44F4-A8AB-2EE199533003">Oracle XA中的线程限制</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS800"></a><div class="props_rev_3"><a id="GUID-45CBD96F-DE5E-4A2C-AEC4-5E1AA6E33D0A" name="GUID-45CBD96F-DE5E-4A2C-AEC4-5E1AA6E33D0A"></a><h5 id="ADFNS-GUID-45CBD96F-DE5E-4A2C-AEC4-5E1AA6E33D0A" class="sect5">在Open String中指定线程</h5>
                     <div>
                        <div class="section">
                           <p><code class="codeph">xa_open</code>字符串提供了<code class="codeph">Threads=</code>子句。必须将此子句指定为<code class="codeph">true</code>才能启用TM的线程使用。默认值为<code class="codeph">false</code> 。在大多数情况下，TM会创建线程;应用程序不知道何时创建线程。因此，建议在为TM应用程序编写的每个服务中为堆栈分配服务上下文。在对该服务执行任何与Oracle数据库相关的调用之前，必须调用<code class="codeph">xaoSvcCtx</code>函数来检索已初始化的OCI服务上下文。然后，您可以将此上下文用于服务中的OCI调用。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="ADFNS801"></a><div class="props_rev_3"><a id="GUID-50E69541-0FA8-44F4-A8AB-2EE199533003" name="GUID-50E69541-0FA8-44F4-A8AB-2EE199533003"></a><h5 id="ADFNS-GUID-50E69541-0FA8-44F4-A8AB-2EE199533003" class="sect5">Oracle XA中的线程限制</h5>
                     <div>
                        <p>使用线程时适用这些限制：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>除非在每个应用程序线程启动时明确告知事务监视器，否则不能对作为事务监视器上的应用程序服务器进程的一部分运行的任何Pro *或OCI代码进行线程化。这通常通过使用TM供应商提供的特殊C编译器来完成。</p>
                           </li>
                           <li>
                              <p>不支持Pro *语句<code class="codeph">EXEC</code> <code class="codeph">SQL</code> <code class="codeph">ALLOCATE</code>和<code class="codeph">EXEC</code> <code class="codeph">SQL</code> <code class="codeph">USE</code> 。因此，启用线程时，不能跨非XA连接使用嵌入式SQL语句。
                              </p>
                           </li>
                           <li>
                              <p>如果进程中的一个线程通过XA连接到Oracle数据库，则进程中连接到Oracle数据库的所有其他线程也必须通过XA连接。您无法通过一个线程中的<code class="codeph">EXEC</code> <code class="codeph">SQL</code> <code class="codeph">CONNECT</code>和另一个线程中的<code class="codeph">xa_open</code>进行<code class="codeph">CONNECT</code> 。
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="ADFNS802"></a><a id="ADFNS0171"></a><div class="props_rev_3"><a id="GUID-27CD17CC-91C7-4C4D-B341-132AB8E167A6" name="GUID-27CD17CC-91C7-4C4D-B341-132AB8E167A6"></a><h4 id="ADFNS-GUID-27CD17CC-91C7-4C4D-B341-132AB8E167A6" class="sect4">使用DBMS_XA包</h4>
                  <div>
                     <div class="section">
                        <p>PL / SQL应用程序可以将Oracle XA库与<code class="codeph">DBMS_XA</code>包一起使用。
                        </p>
                        <p>在<a href="xa.html#GUID-27CD17CC-91C7-4C4D-B341-132AB8E167A6__BABJDBFH">例22-5中</a> ，一个PL / SQL会话启动一个事务但不提交它，第二个会话恢复事务，第三个会话提交事务。所有三个会话都连接到<code class="codeph">HR</code>模式。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-27CD17CC-91C7-4C4D-B341-132AB8E167A6__BABJDBFH">
                        <p class="titleinexample">示例22-5使用DBMS_XA包</p><pre class="oac_no_warn" dir="ltr"><span class="bold">REM Session 1启动一个事务并完成一些工作。</span>DECLARE rc PLS_INTEGER;是PLS_INTEGER; xae EXCEPTION; BEGIN rc：= <span class="bold">DBMS_XA.XA_START（DBMS_XA_XID（123），DBMS_XA.TMNOFLAGS</span> ）;如果rc！= <span class="bold">DBMS_XA.XA_OK</span>那么：= <span class="bold">DBMS_XA.XA_GETLASTOER（）</span> ; DBMS_OUTPUT.PUT_LINE（'ORA-'|| oer ||'发生，XA_START失败'）;升起xae; ELSE DBMS_OUTPUT.PUT_LINE（'XA_START（new xid = 123）OK'）;万一; UPDATE员工SET薪水=薪水* 1.1 WHERE employee_id = 100; rc：= <span class="bold">DBMS_XA.XA_END（DBMS_XA_XID（123），DBMS_XA.TMSUSPEND）</span> ;如果rc！= <span class="bold">DBMS_XA.XA_OK</span>那么：= <span class="bold">DBMS_XA.XA_GETLASTOER（）</span> ; DBMS_OUTPUT.PUT_LINE（'ORA-'|| oer ||'发生，XA_END失败'）;升起xae; ELSE DBMS_OUTPUT.PUT_LINE（'XA_END（suspend xid = 123）OK'）;万一;除了DBMS_OUTPUT.PUT_LINE（'XA错误（'|| rc ||'）之外发生的异常，回滚事务......“）; rc：= <span class="bold">DBMS_XA.XA_END（DBMS_XA_XID（123），DBMS_XA.TMSUCCESS）</span> ; rc：= <span class="bold">DBMS_XA.XA_ROLLBACK（DBMS_XA_XID（123））</span> ;如果rc！= <span class="bold">DBMS_XA.XA_OK</span>那么：= <span class="bold">DBMS_XA.XA_GETLASTOER（）</span> ; DBMS_OUTPUT.PUT_LINE（'XA-'|| rc ||'，ORA-'|| oer ||'XA_ROLLBACK不返回XA_OK'）; raise_application_error（-20001，'ORA-'|| oer ||'在回滚失败的事务时出错'）;万一; raise_application_error（-20002，事务处理中的'ORA-'|| oer ||'错误，事务回滚'）;结束; /显示ERRORS <span class="bold">DISCONNECT</span> <span class="bold">REM会话2恢复交易并完成一些工作。</span>DECLARE rc PLS_INTEGER;是PLS_INTEGER;的数字; xae EXCEPTION; BEGIN rc：= <span class="bold">DBMS_XA.XA_START（DBMS_XA_XID（123），DBMS_XA.TMRESUME）</span> ;如果rc！= <span class="bold">DBMS_XA.XA_OK</span>那么：= <span class="bold">DBMS_XA.XA_GETLASTOER（）</span> ; DBMS_OUTPUT.PUT_LINE（'ORA-'|| oer ||'发生，xa_start失败'）;升起xae; ELSE DBMS_OUTPUT.PUT_LINE（'XA_START（resume xid = 123）OK'）;万一; SELECT salary INTO s FROM employees WHERE employee_id = 100; DBMS_OUTPUT.PUT_LINE（'employee_id = 100，salary ='|| s）; rc：= <span class="bold">DBMS_XA.XA_END（DBMS_XA_XID（123），DBMS_XA.TMSUCCESS）</span> ;如果rc！= <span class="bold">DBMS_XA.XA_OK</span>那么：= <span class="bold">DBMS_XA.XA_GETLASTOER（）</span> ; DBMS_OUTPUT.PUT_LINE（'ORA-'|| oer ||'发生，XA_END失败'）;升起xae; ELSE DBMS_OUTPUT.PUT_LINE（'XA_END（detach xid = 123）OK'）;万一;除了DBMS_OUTPUT.PUT_LINE（'XA错误（'|| rc ||'）之外发生的异常，回滚事务......“）; rc：= <span class="bold">DBMS_XA.XA_END（DBMS_XA_XID（123），DBMS_XA.TMSUCCESS）</span> ; rc：= <span class="bold">DBMS_XA.XA_ROLLBACK（DBMS_XA_XID（123））</span> ;如果rc！= <span class="bold">DBMS_XA.XA_OK</span>那么：= <span class="bold">DBMS_XA.XA_GETLASTOER（）</span> ; DBMS_OUTPUT.PUT_LINE（'XA-'|| rc ||'，ORA-'|| oer ||'XA_ROLLBACK不返回XA_OK'）; raise_application_error（-20001，'ORA-'|| oer ||'在回滚失败的事务时出错'）;万一; raise_application_error（-20002，事务处理中的'ORA-'|| oer ||'错误，事务回滚'）;结束; /显示ERRORS <span class="bold">DISCONNECT</span> <span class="bold">REM会话3提交事务。</span>DECLARE rc PLS_INTEGER;是PLS_INTEGER; xae EXCEPTION; BEGIN rc：= <span class="bold">DBMS_XA.XA_COMMIT（DBMS_XA_XID（123），TRUE）</span> ;如果rc！= <span class="bold">DBMS_XA.XA_OK</span>那么：= <span class="bold">DBMS_XA.XA_GETLASTOER（）</span> ; DBMS_OUTPUT.PUT_LINE（'ORA-'|| oer ||'发生，XA_COMMIT失败'）;升起xae; ELSE DBMS_OUTPUT.PUT_LINE（'XA_COMMIT（commit xid = 123）OK'）;万一;当xae那时出现DBMS_OUTPUT.PUT_LINE（'XA错误（'|| rc ||'），回滚事务......“）; rc：= <span class="bold">DBMS_XA.XA_ROLLBACK（DBMS_XA_XID（123））</span> ;如果rc！= <span class="bold">DBMS_XA.XA_OK</span>那么：= <span class="bold">DBMS_XA.XA_GETLASTOER（）</span> ; DBMS_OUTPUT.PUT_LINE（'XA-'|| rc ||'，ORA-'|| oer ||'XA_ROLLBACK不返回XA_OK'）; raise_application_error（-20001，'ORA-'|| oer ||'在回滚失败的事务时出错'）;万一; raise_application_error（-20002，事务处理中的'ORA-'|| oer ||'错误，事务回滚'）;结束; /显示错误<span class="bold">断开</span> <span class="bold">退出</span></pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-27CD17CC-91C7-4C4D-B341-132AB8E167A6__NOTE-1331-CB06F080">
                           <p class="notep1">也可以看看：</p>
                           <p>有关<code class="codeph">DBMS_XA</code>包的更多信息，请<code class="codeph">DBMS_XA</code> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ARPLS209" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="ADFNS1107"></a><a id="ADFNS1504"></a><div class="props_rev_3"><a id="GUID-194B0A1B-1A10-47B5-B898-5CDECD7FFA9B" name="GUID-194B0A1B-1A10-47B5-B898-5CDECD7FFA9B"></a><h3 id="ADFNS-GUID-194B0A1B-1A10-47B5-B898-5CDECD7FFA9B" class="sect3">XA应用程序疑难解答</h3>
               <div>
                  <div class="section">
                     <p class="subhead2" id="GUID-194B0A1B-1A10-47B5-B898-5CDECD7FFA9B__GUID-D4113682-7688-43B8-8F8F-B1576E5FDA06">话题：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="xa.html#GUID-02FDAD5D-7C03-430A-93F1-5C0B93194F65">访问Oracle XA跟踪文件</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-06BB7A40-971F-43A5-AF4F-581A6A1F95F9">管理疑似或待定Oracle XA事务</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-8EFEBEF3-5827-4EF9-AFEA-355BB3994DDA">使用SYS帐户表监视Oracle XA事务</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS804"></a><a id="ADFNS1108"></a><a id="ADFNS803"></a><div class="props_rev_3"><a id="GUID-02FDAD5D-7C03-430A-93F1-5C0B93194F65" name="GUID-02FDAD5D-7C03-430A-93F1-5C0B93194F65"></a><h4 id="ADFNS-GUID-02FDAD5D-7C03-430A-93F1-5C0B93194F65" class="sect4">访问Oracle XA跟踪文件</h4>
                  <div>
                     <div class="section">
                        <p>Oracle XA库将任何错误和跟踪信息记录到其跟踪文件中。此信息可用于补充XA错误代码。例如，它可以指示<code class="codeph">xa_open</code>失败是由错误的打开字符串，无法找到Oracle数据库实例还是登录授权失败引起的。
                        </p>
                        <p>跟踪文件的名称是<code class="codeph">xa_</code> <span class="italic"><code class="codeph">db_namedate</code></span> 。 <code class="codeph">trc</code> ，其中<span class="italic"><code class="codeph">db_name</code></span>是在打开的字符串字段<code class="codeph">DB</code> = <span class="italic"><code class="codeph">db_name</code></span>指定的数据库名称，而<span class="italic"><code class="codeph">date</code></span>是将信息记录到跟踪文件的日期。如果未在打开的字符串中指定<code class="codeph">DB</code> = <span class="italic"><code class="codeph">db_name</code></span> ，则它会自动默认为<code class="codeph">NULL</code> 。</p>
                        <p>例如， <code class="codeph">xa_NULL06022005</code> 。 <code class="codeph">trc</code>表示2005年6月2日创建的跟踪文件。打开资源管理器时，未在打开的字符串中指定其<code class="codeph">DB</code>字段。文件名<code class="codeph">xa_Finance12152004</code> 。 <code class="codeph">trc</code>表示在2004年12月15日创建了跟踪文件。打开资源管理器时，其<code class="codeph">DB</code>字段在打开的字符串中指定为“Finance”。
                        </p>
                        <div class="infoboxnote" id="GUID-02FDAD5D-7C03-430A-93F1-5C0B93194F65__GUID-1605428A-F122-46BA-BE72-7D9706A92CFA">
                           <p class="notep1">注意：</p>
                           <p>多个Oracle XA库资源管理器在其打开的字符串中具有相同的<code class="codeph">DB</code>字段和<code class="codeph">LogDir</code>字段，将同一天发生的所有跟踪信息记录到同一个跟踪文件中。
                           </p>
                        </div>
                        <p>假设跟踪文件包含以下内容：</p><pre class="oac_no_warn" dir="ltr">1032.12345.2：ORA-01017：用户名/密码无效;登录被拒绝1032.12345.2：xaolgn：XAER_INVAL;登录被拒绝</pre><p><a href="xa.html#GUID-02FDAD5D-7C03-430A-93F1-5C0B93194F65__BGBHBCIJ" title="此表描述了示例跟踪文件内容。">表22-8</a>说明了每个元素的含义。
                        </p>
                        <div class="tblformal" id="GUID-02FDAD5D-7C03-430A-93F1-5C0B93194F65__BGBHBCIJ">
                           <p class="titleintable">表22-8跟踪文件内容示例</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="示例跟踪文件内容" width="100%" border="1" summary="This table describes sample trace file contents." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="24%" id="d132228e4868">串</th>
                                    <th align="left" valign="bottom" width="76%" id="d132228e4871">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d132228e4876" headers="d132228e4868 ">
                                       <p><code class="codeph">1032</code></p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d132228e4876 d132228e4871 ">
                                       <p>记录信息的时间。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d132228e4884" headers="d132228e4868 ">
                                       <p><code class="codeph">12345</code></p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d132228e4884 d132228e4871 ">
                                       <p>进程ID（PID）。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d132228e4892" headers="d132228e4868 ">
                                       <p><code class="codeph">2</code></p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d132228e4892 d132228e4871 ">
                                       <p>资源经理ID</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d132228e4900" headers="d132228e4868 ">
                                       <p><code class="codeph">xaolgn</code></p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d132228e4900 d132228e4871 ">
                                       <p>模块名称</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d132228e4908" headers="d132228e4868 ">
                                       <p><code class="codeph">XAER_INVAL</code></p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d132228e4908 d132228e4871 ">
                                       <p>按照XA标准中的指定返回错误</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d132228e4916" headers="d132228e4868 ">
                                       <p>ORA-01017</p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d132228e4916 d132228e4871 ">
                                       <p>返回的Oracle数据库信息</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-02FDAD5D-7C03-430A-93F1-5C0B93194F65__GUID-0830BF45-8EB7-4609-BEB3-906491602BFE">话题：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="xa.html#GUID-1C816BFB-9B5D-490A-BD40-8560E4743847">xa_open String DbgFl</a></p>
                           </li>
                           <li>
                              <p><a href="xa.html#GUID-8271A46E-A8F5-4E73-A2DF-DB7DA03315B6">跟踪文件位置</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS805"></a><div class="props_rev_3"><a id="GUID-1C816BFB-9B5D-490A-BD40-8560E4743847" name="GUID-1C816BFB-9B5D-490A-BD40-8560E4743847"></a><h5 id="ADFNS-GUID-1C816BFB-9B5D-490A-BD40-8560E4743847" class="sect5">xa_open String DbgFl</h5>
                     <div>
                        <p>通常，只有在检测到错误时才会打开XA跟踪文件。<code class="codeph">xa_open</code>字符串<code class="codeph">DbgFl</code>提供跟踪工具来记录有关XA库的其他详细信息。默认情况下，其值为零。您可以将其设置为这些值的任意组合：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">0x1</code> ，使您可以跟踪XA界面中每个子程序的进入和退出。此值可用于准确查看TP Monitor正在调用哪些XA调用以及它正在生成哪个事务标识符。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">0x2</code> ，使您可以跟踪其他非公共XA库程序的入口和出口。这通常仅对Oracle数据库开发人员有用。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">0x4</code> ，它使您能够跟踪XA库所做的各种其他“有趣”调用，例如对OCI的特定调用。这通常仅对Oracle数据库开发人员有用。
                              </p>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-1C816BFB-9B5D-490A-BD40-8560E4743847__GUID-8A242A59-58B2-46A2-8711-8CF340A272DF">
                           <p class="notep1">注意：</p>
                           <p>标志是<code class="codeph">ub4</code>独立位，因此要从两个或多个标志获取打印输出，必须设置标志的组合值。
                           </p>
                        </div>
                     </div>
                  </div><a id="ADFNS806"></a><div class="props_rev_3"><a id="GUID-8271A46E-A8F5-4E73-A2DF-DB7DA03315B6" name="GUID-8271A46E-A8F5-4E73-A2DF-DB7DA03315B6"></a><h5 id="ADFNS-GUID-8271A46E-A8F5-4E73-A2DF-DB7DA03315B6" class="sect5">跟踪文件位置</h5>
                     <div>
                        <div class="section">
                           <p>XA应用程序根据此算法确定跟踪文件的位置：</p>
                           <ol>
                              <li>
                                 <p>在打开的字符串中指定的<code class="codeph">LogDir</code>目录。
                                 </p>
                              </li>
                              <li>
                                 <p>如果未在打开的字符串中指定<code class="codeph">LogDir</code> ，则Oracle XA应用程序会尝试在此目录中创建跟踪文件（如果可以访问Oracle主目录）：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>Windows上的<code class="codeph">%ORACLE_HOME%\rdbms\trace</code></p>
                                    </li>
                                    <li>
                                       <p>Linux和UNIX上的<code class="codeph">$ORACLE_HOME/rdbms/log</code></p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>如果Oracle XA应用程序无法确定Oracle主目录所在的位置，则应用程序会在当前工作目录中创建跟踪文件。</p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="ADFNS807"></a><div class="props_rev_3"><a id="GUID-06BB7A40-971F-43A5-AF4F-581A6A1F95F9" name="GUID-06BB7A40-971F-43A5-AF4F-581A6A1F95F9"></a><h4 id="ADFNS-GUID-06BB7A40-971F-43A5-AF4F-581A6A1F95F9" class="sect4">管理疑似或待定Oracle XA事务</h4>
                  <div>
                     <div class="section">
                        <p>不确定或待处理事务是已准备但未提交到数据库的事务。通常，TPM系统提供的TM可以解决无意或未决事务的任何故障和恢复。如果出现以下情况，DBA可能必须覆盖不确定的事务：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>它锁定其他事务所需的数据。</p>
                           </li>
                           <li>
                              <p>它没有在合理的时间内解决。</p>
                           </li>
                        </ul>
                        <p>有关在这种情况下覆盖不确定事务以及如何决定是否提交或回滚不确定事务的更多信息，请参阅TPM文档。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS808"></a><div class="props_rev_3"><a id="GUID-8EFEBEF3-5827-4EF9-AFEA-355BB3994DDA" name="GUID-8EFEBEF3-5827-4EF9-AFEA-355BB3994DDA"></a><h4 id="ADFNS-GUID-8EFEBEF3-5827-4EF9-AFEA-355BB3994DDA" class="sect4">使用SYS帐户表监视Oracle XA事务</h4>
                  <div>
                     <div class="section">
                        <p>Oracle Database <code class="codeph">SYS</code>帐户下的这些视图包含由常规Oracle数据库应用程序和Oracle XA应用程序生成的事务：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">DBA_PENDING_TRANSACTIONS</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">V $ GLOBAL_TRANSACTION</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">DBA_2PC_PENDING</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">DBA_2PC_NEIGHBORS</code></p>
                           </li>
                        </ul>
                        <p>对于Oracle XA应用程序生成的事务，此列信息特别适用于<code class="codeph">DBA_2PC_NEIGHBORS</code>表：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">DBID</code>列始终为<code class="codeph">xa_orcl</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">DBUSER_OWNER</code>列始终为<span class="italic"><code class="codeph">db_name</code></span> <code class="codeph">xa</code> 。 <code class="codeph">oracle</code> 。 <code class="codeph">com</code></p>
                           </li>
                        </ul>
                        <p>请记住， <span class="italic">db_name</span>始终在打开的字符串中指定为<code class="codeph">DB</code> = <span class="italic"><code class="codeph">db_name</code></span> 。如果未在打开的字符串中指定此字段，则此列的值为<code class="codeph">NULLxa</code> 。 <code class="codeph">oracle</code> 。 <code class="codeph">com</code>用于Oracle XA应用程序生成的事务。
                        </p>
                        <p>例如，此SQL语句提供有关Oracle XA应用程序生成的不确定事务的更多信息：</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM DBA_2PC_PENDING p，DBA_2PC_NEIGHBORS n WHERE p。LOCAL_TRAN_ID = n。LOCAL_TRAN_ID和n。DBID ='xa_orcl';</pre><p>或者，如果您知道事务处理监视器使用的格式<code class="codeph">ID</code> ，则可以使用<code class="codeph">DBA_PENDING_TRANSACTIONS</code>或<code class="codeph">V$GLOBAL_TRANSACTION</code> 。 <code class="codeph">DBA_PENDING_TRANSACTIONS</code>提供准备好的事务列表，而<code class="codeph">V$GLOBAL_TRANSACTION</code>提供所有活动全局事务的列表。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="ADFNS1109"></a><a id="ADFNS1505"></a><div class="props_rev_3"><a id="GUID-D1F82CDD-DDDA-4895-B18B-C9F7D44AAEBB" name="GUID-D1F82CDD-DDDA-4895-B18B-C9F7D44AAEBB"></a><h3 id="ADFNS-GUID-D1F82CDD-DDDA-4895-B18B-C9F7D44AAEBB" class="sect3">Oracle XA问题和限制</h3>
               <div>
                  <div class="section">
                     <p class="subhead2" id="GUID-D1F82CDD-DDDA-4895-B18B-C9F7D44AAEBB__GUID-D4EBF802-279C-4F90-A475-AFEFF73346DE">话题：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="xa.html#GUID-C4F27C42-C388-4604-8986-7917930F7EF8">在Oracle XA应用程序中使用数据库链接</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-66124F06-FC05-4513-A76A-F00D725440E4">管理Oracle XA应用程序中的事务分支</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-086B00D2-116E-4862-B8D0-AADF90CC9E8F">将Oracle XA与Oracle Real Application Clusters一起使用（Oracle RAC）</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-F6CB7EA2-BC01-47D6-BCF6-BD3D329B42EA">基于SQL的Oracle XA限制</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-6166F2B9-4ADA-417E-A8B2-6FF22C3D72E8">其他限制</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS809"></a><div class="props_rev_3"><a id="GUID-C4F27C42-C388-4604-8986-7917930F7EF8" name="GUID-C4F27C42-C388-4604-8986-7917930F7EF8"></a><h4 id="ADFNS-GUID-C4F27C42-C388-4604-8986-7917930F7EF8" class="sect4">在Oracle XA应用程序中使用数据库链接</h4>
                  <div>
                     <div class="section">
                        <p>Oracle XA应用程序可以通过具有以下限制的数据库链接访问其他Oracle数据库实例：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>他们必须使用共享服务器配置。</p>
                              <p>事务处理监视器（TPM）使用共享服务器打开与Oracle数据库A的连接。然后，调度程序而不是专用服务器进程打开数据库链接所需的操作系统网络连接。这允许不同的服务或线程对事务进行操作。</p>
                              <p>如果不满足此限制，则在XA事务中使用数据库链接时，它会在专用服务器进程与其他Oracle数据库B之间创建操作系统网络连接。因为此网络连接无法从一个专用服务器进程移动到另外，您无法从数据库A的此专用服务器进程分离。然后，当您通过数据库链接访问数据库B时，会收到ORA-24777错误。</p>
                           </li>
                           <li>
                              <p>正在访问的另一个数据库必须是另一个Oracle数据库。</p>
                           </li>
                        </ul>
                        <p>如果满足这些限制，Oracle数据库允许此类链接并将事务协议（准备，回滚和提交）传播到其他Oracle数据库实例。</p>
                        <p>如果无法使用共享服务器配置，则使用<code class="codeph">EXEC</code> <code class="codeph">SQL</code> <code class="codeph">AT</code>语法通过Pro * C / C ++应用程序访问远程数据库。
                        </p>
                        <p><code class="codeph">init.ora</code>参数<code class="codeph">OPEN_LINKS_PER_INSTANCE</code>指定可以迁移的打开的数据库链接连接数。XA事务使用这些<code class="codeph">dblink</code>连接，以便在提交事务后缓存连接。如果创建连接的用户也创建了事务，则另一个事务可以使用数据库链接连接。此参数与<code class="codeph">init</code>不同。 <code class="codeph">ora</code>参数<code class="codeph">OPEN_LINKS</code> ，指定一个会话中远程数据库的最大并发打开连接数（包括数据库链接）。<code class="codeph">OPEN_LINKS</code>参数不适用于XA应用程序。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS811"></a><a id="ADFNS810"></a><div class="props_rev_3"><a id="GUID-66124F06-FC05-4513-A76A-F00D725440E4" name="GUID-66124F06-FC05-4513-A76A-F00D725440E4"></a><h4 id="ADFNS-GUID-66124F06-FC05-4513-A76A-F00D725440E4" class="sect4">管理Oracle XA应用程序中的事务分支</h4>
                  <div>
                     <div class="section">
                        <p>同一个全局事务中的Oracle数据库事务分支可以紧密耦合或松散耦合。如果事务分支<strong class="term">紧密耦合</strong> ，则它们共享锁。因此，一个事务分支中的预<code class="codeph">COMMIT</code>更新在属于同一全局事务的其他分支中可见。在松散耦合的事务分支中，分支不共享锁，也不会在其他分支中看到更新。
                        </p>
                        <p>在紧密耦合的分支中，Oracle数据库在运行任何语句之前获取DX锁。因为系统在运行语句之前没有获得锁，所以松散耦合的事务分支会导致更大的并发性。缺点是所有事务分支都必须经历两个提交阶段，即系统不能使用XA单阶段优化。</p>
                        <p><a href="xa.html#GUID-66124F06-FC05-4513-A76A-F00D725440E4__g1017904" title="此表比较紧密和松散耦合的事务分支。">表22-9</a>总结了紧耦合分支和松散耦合分支之间的权衡。
                        </p>
                        <div class="tblformal" id="GUID-66124F06-FC05-4513-A76A-F00D725440E4__g1017904">
                           <p class="titleintable">表22-9紧密且松散耦合的交易分支</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="紧密且松散耦合的交易分支" width="100%" border="1" summary="This table compares tightly and loosely coupled transaction branches." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="22%" id="d132228e5886">属性</th>
                                    <th align="left" valign="bottom" width="39%" id="d132228e5889">紧密耦合的分支</th>
                                    <th align="left" valign="bottom" width="39%" id="d132228e5892">松散耦合的分支</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="22%" id="d132228e5897" headers="d132228e5886 ">
                                       <p>两阶段提交</p>
                                    </td>
                                    <td align="left" valign="top" width="39%" headers="d132228e5897 d132228e5889 ">
                                       <p>只读优化</p>
                                       <p>[为所有分支做准备，为最后一个分支做准备]</p>
                                    </td>
                                    <td align="left" valign="top" width="39%" headers="d132228e5897 d132228e5892 ">
                                       <p>两个阶段</p>
                                       <p>[准备并承诺所有分支机构]</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="22%" id="d132228e5911" headers="d132228e5886 ">
                                       <p>序列化</p>
                                    </td>
                                    <td align="left" valign="top" width="39%" headers="d132228e5911 d132228e5889 ">
                                       <p>数据库通话</p>
                                    </td>
                                    <td align="left" valign="top" width="39%" headers="d132228e5911 d132228e5892 ">
                                       <p>没有</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS1110"></a><a id="ADFNS812"></a><div class="props_rev_3"><a id="GUID-086B00D2-116E-4862-B8D0-AADF90CC9E8F" name="GUID-086B00D2-116E-4862-B8D0-AADF90CC9E8F"></a><h4 id="ADFNS-GUID-086B00D2-116E-4862-B8D0-AADF90CC9E8F" class="sect4">将Oracle XA与Oracle Real Application Clusters一起使用（Oracle RAC）</h4>
                  <div>
                     <div class="section">
                        <p>从Oracle Database <span class="italic">11g</span>第1版（11.1）开始，XA事务可以跨越Oracle RAC实例，允许任何使用XA的应用程序充分利用Oracle RAC环境，从而增强应用程序的可用性和可伸缩性。
                        </p>
                        <div class="infoboxnote" id="GUID-086B00D2-116E-4862-B8D0-AADF90CC9E8F__GUID-CD6B383F-D744-4058-A821-24E3E5D2090C">
                           <p class="notep1">注意：</p>
                           <p>不支持外部过程标注与分布式事务相结合。</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-086B00D2-116E-4862-B8D0-AADF90CC9E8F__GUID-CD272BCA-7B39-4529-A67B-4D70B26C13AE">话题：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="xa.html#GUID-B0A727E2-06BC-44E2-8359-EF1EFE060082">GLOBAL_TXN_PROCESSES初始化参数</a></p>
                           </li>
                           <li>
                              <p><a href="xa.html#GUID-E8D197D4-E2CE-43C7-AF61-047EABB71F96">管理Oracle RAC上的事务分支</a></p>
                           </li>
                           <li>
                              <p><a href="xa.html#GUID-5D7075DF-3857-49DA-BE4A-835AEA2DE3BE">使用DTP服务管理Oracle RAC中的实例恢复（10.2）</a></p>
                           </li>
                           <li>
                              <p><a href="xa.html#GUID-AFE8748A-61A2-44FB-8C8D-2A2EEAE91EA0">Oracle RAC中XID的全局唯一性</a></p>
                           </li>
                           <li>
                              <p><a href="xa.html#GUID-1A97ED73-4C0E-42D2-AF06-8BB2CAF05977">紧凑和松散的耦合</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS813"></a><div class="props_rev_3"><a id="GUID-B0A727E2-06BC-44E2-8359-EF1EFE060082" name="GUID-B0A727E2-06BC-44E2-8359-EF1EFE060082"></a><h5 id="ADFNS-GUID-B0A727E2-06BC-44E2-8359-EF1EFE060082" class="sect5">GLOBAL_TXN_PROCESSES初始化参数</h5>
                     <div>
                        <p>初始化参数<code class="codeph">GLOBAL_TXN_PROCESSES</code>指定每个Oracle RAC实例的初始GTX <span class="italic">n</span>后台进程数。其默认值为1。
                        </p>
                        <p>如果分布式事务可能跨越多个Oracle RAC实例，请将此参数保留为群集范围的默认值。这允许跨这些Oracle RAC实例执行的工作单元共享资源并充当单个事务（即，工作单元紧密耦合）。它还允许将2PC请求发送到群集中的任何节点。</p>
                        <div class="infoboxnotealso" id="GUID-B0A727E2-06BC-44E2-8359-EF1EFE060082__GUID-89EEECAB-AF94-46DA-96AA-67A358E6BAE7">
                           <p class="notep1">也可以看看：</p>
                           <p>有关<code class="codeph">GLOBAL_TXN_PROCESSES</code>更多信息，请<code class="codeph">GLOBAL_TXN_PROCESSES</code> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=REFRN10291" target="_blank"><span class="italic">Oracle数据库参考</span></a></p>
                        </div>
                     </div>
                  </div><a id="ADFNS815"></a><a id="ADFNS816"></a><a id="ADFNS814"></a><div class="props_rev_3"><a id="GUID-E8D197D4-E2CE-43C7-AF61-047EABB71F96" name="GUID-E8D197D4-E2CE-43C7-AF61-047EABB71F96"></a><h5 id="ADFNS-GUID-E8D197D4-E2CE-43C7-AF61-047EABB71F96" class="sect5">管理Oracle RAC上的事务分支</h5>
                     <div>
                        <div class="section">
                           <div class="infoboxnote" id="GUID-E8D197D4-E2CE-43C7-AF61-047EABB71F96__GUID-8559641B-484C-4D9A-B66E-29604A8BE7B1">
                              <p class="notep1">注意：</p>
                              <p>如果满足以下任一条件，则本主题适用：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>初始化参数<code class="codeph">GLOBAL_TXN_PROCESSES</code>在每个Oracle RAC实例的初始化文件中都不是其默认值。
                                    </p>
                                 </li>
                                 <li>
                                    <p>Oracle XA应用程序恢复或加入以前分离的事务分支。</p>
                                 </li>
                              </ul>
                           </div>
                           <p>Oracle数据库允许不同的实例在Oracle RAC中的不同事务分支上运行。例如，节点1可以在分支A上运行，而节点2在分支B上运行。在Oracle Database <span class="italic">11g</span>第1版（11.1）之前，如果事务分支在不同的实例上，那么它们是松散耦合的并且不共享锁。在这种情况下，Oracle数据库将不同应用程序线程中的不同工作单元视为不共享资源的单独实体。
                           </p>
                           <p>另一种情况是多个实例在单个事务分支上运行。例如，假设单个事务落在节点1和节点2上，如下所示：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-E8D197D4-E2CE-43C7-AF61-047EABB71F96__GUID-3F97576D-7DEA-49E2-B342-E43EE1920D04">节点1</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ol>
                              <li>
                                 <p><code class="codeph">xa_start</code></p>
                              </li>
                              <li>
                                 <p>SQL操作</p>
                              </li>
                              <li>
                                 <p><code class="codeph">xa_end</code> （SUSPEND）</p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-E8D197D4-E2CE-43C7-AF61-047EABB71F96__GUID-BC744918-1A0D-41FC-B30A-BA673CFDFB5D">节点2</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ol>
                              <li>
                                 <p><code class="codeph">xa_start</code> （ <code class="codeph">xa_start</code> ）</p>
                              </li>
                              <li>
                                 <p><code class="codeph">xa_prepare</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">xa_commit</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">XA_END</code></p>
                              </li>
                           </ol>
                           <p>在前面的序列中，Oracle数据库返回错误，因为节点2不能恢复物理上位于不同节点（节点1）上的分支。</p>
                           <p>在Oracle Database <span class="italic">11g</span>第1版（11.1）之前，在Oracle RAC中实现紧耦合的方法是使用<strong class="term">分布式事务处理（DTP）服务</strong> ，即基数（一）确保所有紧密耦合的分支到达的服务。同一实例 - 无论是否启用了负载均衡。中间层组件通过在任何时间点映射到单个Oracle RAC实例的公共逻辑数据库服务名称来解决Oracle数据库问题。数据库服务的中间名称解析程序隐藏了数据库实例的物理特征。DTP服务使紧密耦合的全局事务的所有参与者能够在一个实例上创建分支。
                           </p>
                           <p>从Oracle Database <span class="italic">11g</span>第1版（11.1）开始，不再需要DTP服务来支持紧密耦合分支的XA事务。默认情况下，位于不同Oracle RAC实例上的紧密耦合分支保持紧密耦合;也就是说，它们跨Oracle RAC实例共享锁和资源。
                           </p>
                           <p>例如，当您使用DTP服务时，这一系列操作发生在同一个实例上：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li><span><code class="codeph">xa_start</code></span></li>
                           <li><span>SQL操作</span></li>
                           <li><span><code class="codeph">xa_end</code> （SUSPEND）</span></li>
                           <li><span><code class="codeph">xa_start</code> （ <code class="codeph">xa_start</code> ）</span></li>
                           <li><span>SQL操作</span></li>
                           <li><span><code class="codeph">xa_prepare</code></span></li>
                           <li><span><code class="codeph">xa_commit</code>或<code class="codeph">xa_rollback</code></span></li>
                        </ol>
                        <div class="section">
                           <p>此外，如果每个分支都使用相同的DTP服务对Oracle RM进行寻址，则多个紧密耦合的分支将落在同一实例上。</p>
                           <p>要利用群集中的所有实例，请创建多个DTP服务，每个承载分布式事务的节点上都有一个或多个DTP服务。全局分布式事务的所有分支都存在于同一实例上。因此，您可以利用Oracle RAC集群的所有实例和节点来平衡许多分布式XA事务的负载，从而最大化应用程序吞吐量。</p>
                           <div class="infoboxnotealso" id="GUID-E8D197D4-E2CE-43C7-AF61-047EABB71F96__GUID-0FF94259-A3D9-459E-90D1-FFE7E92EB3BB">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=RACAD967" target="_blank"><span class="italic">“Oracle Real Application Clusters管理和部署指南”</span></a> ，了解如何在Real Application Clusters配置中管理分布式事务</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="ADFNS817"></a><div class="props_rev_3"><a id="GUID-5D7075DF-3857-49DA-BE4A-835AEA2DE3BE" name="GUID-5D7075DF-3857-49DA-BE4A-835AEA2DE3BE"></a><h5 id="ADFNS-GUID-5D7075DF-3857-49DA-BE4A-835AEA2DE3BE" class="sect5">使用DTP服务管理Oracle RAC中的实例恢复（10.2）</h5>
                     <div>
                        <div class="section">
                           <p>在Oracle Database <span class="italic">10g</span>第2版（10.2）之前，TM负责检测Oracle RAC中的故障并触发故障转移和故障恢复。为确保有关<code class="codeph">DBA_2PC_PENDING</code>事务的信息传播到<code class="codeph">DBA_2PC_PENDING</code> ，TM必须在解决<code class="codeph">xa_recover</code>之前调用<code class="codeph">xa_recover</code> 。如果实例失败，则XA客户端库无法故障转移到另一个实例，直到它运行<code class="codeph">SYS.DBMS_XA.DIST_TXN_SYNC</code>过程以确保已恢复失败实例的还原段。从Oracle数据库<span class="italic">10g</span>第2版（10.2）开始，如果TM有足够的有关<code class="codeph">xa_recover</code>事务的信息，则不需要调用<code class="codeph">xa_recover</code> 。
                           </p>
                           <div class="infoboxnote" id="GUID-5D7075DF-3857-49DA-BE4A-835AEA2DE3BE__GUID-C9C6B44C-38B6-49D2-BC2F-70D2F7C590E4">
                              <p class="notep1">注意：</p>
                              <p>从Oracle Database <span class="italic">9g</span>第2版（9.2）开始， <code class="codeph">xa_recover</code>需要等待在远程站点上完成分布式数据操作语言（DML）语句。
                              </p>
                           </div>
                           <p>在Oracle RAC中使用DTP服务具有以下优点：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>自动化实例故障检测。</p>
                              </li>
                              <li>
                                 <p>自动执行实例故障转移和故障回复。当实例失败时，此实例上托管的DTP服务将故障转移到另一个实例。故障转移强制客户端重新连接;尽管如此，服务的逻辑名称保持不变。故障转移是自动的，不需要管理员干预。管理员可以通过服务重定位语句引发故障回复，但所有与故障回复相关的恢复都会在数据库服务器中自动处理。</p>
                              </li>
                              <li>
                                 <p>使Oracle数据库而不是客户端能够驱动实例恢复。数据库不需要中间层TM参与来确定由其他实例准备的事务的状态。</p>
                              </li>
                           </ul>
                           <div class="infoboxnotealso" id="GUID-5D7075DF-3857-49DA-BE4A-835AEA2DE3BE__GUID-4290CF4E-FE6B-4E9F-B116-D104C6D2901C">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=RACAD063" target="_blank"><span class="italic">“Oracle Real Application Clusters管理和部署指南”</span></a> ，了解如何管理实例恢复</p>
                                 </li>
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=RACAD7147" target="_blank"><span class="italic">“Oracle Real Application Clusters管理和部署指南”，</span></a>以获取有关Oracle RAC中的服务和分布式事务处理的信息</p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="ADFNS818"></a><div class="props_rev_3"><a id="GUID-AFE8748A-61A2-44FB-8C8D-2A2EEAE91EA0" name="GUID-AFE8748A-61A2-44FB-8C8D-2A2EEAE91EA0"></a><h5 id="ADFNS-GUID-AFE8748A-61A2-44FB-8C8D-2A2EEAE91EA0" class="sect5">Oracle RAC中XID的全局唯一性</h5>
                     <div>
                        <p>在Oracle Database <span class="italic">11g</span>第1版（11.1）之前，Oracle RAC数据库无法确定给定的XID是否对整个群集中的XA事务是唯一的。
                        </p>
                        <p>例如，假设存在XID <code class="codeph">Fmt(</code> <span class="italic"><code class="codeph">x</code></span> <code class="codeph">)</code> 。<code class="codeph">Tx(1)</code> 。Oracle RAC实例1上的<code class="codeph">Br(1)</code>和另一个XID <code class="codeph">Fmt(</code> <span class="italic"><code class="codeph">x</code></span> <code class="codeph">)</code> 。<code class="codeph">Tx(1)</code> 。Oracle RAC实例2上的<code class="codeph">Br(1)</code> 。其中每个都可以启动分支并运行SQL，即使XID在Oracle RAC实例中不是唯一的。
                        </p>
                        <p>从Oracle Database <span class="italic">11g</span>第1版（11.1）开始，Oracle RAC数据库检测跨Oracle RAC实例的重复XID，并防止启动具有重复XID的分支。
                        </p>
                        <div class="infoboxnotealso" id="GUID-AFE8748A-61A2-44FB-8C8D-2A2EEAE91EA0__GUID-3C896BA5-FD5D-44AD-9447-1CFBA51FEB39">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=RACAD7147" target="_blank"><span class="italic">“Oracle Real Application Clusters管理和部署指南”，</span></a>以获取有关Oracle RAC中的服务和分布式事务处理的信息</p>
                        </div>
                     </div>
                  </div><a id="ADFNS819"></a><div class="props_rev_3"><a id="GUID-1A97ED73-4C0E-42D2-AF06-8BB2CAF05977" name="GUID-1A97ED73-4C0E-42D2-AF06-8BB2CAF05977"></a><h5 id="ADFNS-GUID-1A97ED73-4C0E-42D2-AF06-8BB2CAF05977" class="sect5">紧凑和松散的耦合</h5>
                     <div>
                        <p>同一全局事务中的Oracle数据库事务分支可以紧密耦合或松散耦合。通常，耦合类型由<code class="codeph">xa_open</code>字符串的<code class="codeph">Loose_Coupling</code>字段的值确定（ <a href="xa.html#GUID-F2867F04-EE6C-4AB7-83FE-7E77F6EFACD2__BGBFICJB" title="此表汇总了xa_open字符串的可选字段。">参见表22-5</a> ）。但是，如果事务分支在运行Oracle RAC时落在不同的Oracle RAC实例上，即使<code class="codeph">Loose_Coupling=false</code> ，它们也会松散耦合。
                        </p>
                        <div class="infoboxnotealso" id="GUID-1A97ED73-4C0E-42D2-AF06-8BB2CAF05977__GUID-E558C90A-0D15-409B-B102-F2B5C6227DB6">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=RACAD7147" target="_blank"><span class="italic">“Oracle Real Application Clusters管理和部署指南”，</span></a>以获取有关Oracle RAC中的服务和分布式事务处理的信息</p>
                              </li>
                              <li>
                                 <p><a href="xa.html#GUID-66124F06-FC05-4513-A76A-F00D725440E4">管理Oracle XA应用程序中的事务分支</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div><a id="ADFNS820"></a><div class="props_rev_3"><a id="GUID-F6CB7EA2-BC01-47D6-BCF6-BD3D329B42EA" name="GUID-F6CB7EA2-BC01-47D6-BCF6-BD3D329B42EA"></a><h4 id="ADFNS-GUID-F6CB7EA2-BC01-47D6-BCF6-BD3D329B42EA" class="sect4">基于SQL的Oracle XA限制</h4>
                  <div>
                     <p>本节介绍有关这些SQL操作的限制：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="xa.html#GUID-73F77CBF-D4AA-4E05-9493-4A07FB774751">回滚和提交</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-C83AE4C3-0FD5-49FC-B3F5-AC0F5BAD6463">DDL声明</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-5E6A9F11-244B-4A26-8781-0C654AC9E448">会话状态</a></p>
                        </li>
                        <li>
                           <p><a href="xa.html#GUID-407EDF18-A106-4E62-B795-2C5A8552C824">EXEC SQL</a></p>
                        </li>
                     </ul>
                  </div><a id="ADFNS821"></a><div class="props_rev_3"><a id="GUID-73F77CBF-D4AA-4E05-9493-4A07FB774751" name="GUID-73F77CBF-D4AA-4E05-9493-4A07FB774751"></a><h5 id="ADFNS-GUID-73F77CBF-D4AA-4E05-9493-4A07FB774751" class="sect5">回滚和提交</h5>
                     <div>
                        <p>由于事务管理器负责协调和监视全局事务的进度，因此应用程序不得包含任何独立回滚或提交全局事务的Oracle Database特定语句。但是，您可以在本地事务中使用回滚和提交。</p>
                        <p>当您处于全局事务中时，不要将<code class="codeph">EXEC</code> <code class="codeph">SQL</code> <code class="codeph">ROLLBACK</code> <code class="codeph">WORK</code>用于预编译器应用程序。同样，OCI应用程序不得运行<code class="codeph">OCITransRollback</code>或版本7等效的<code class="codeph">orol</code> 。您可以通过调用<code class="codeph">tx_rollback</code>来回滚全局事务。
                        </p>
                        <p>同样，预编译器应用程序在全局事务中不得具有<code class="codeph">EXEC</code> <code class="codeph">SQL</code> <code class="codeph">COMMIT</code> <code class="codeph">WORK</code>语句。OCI应用程序不得运行<code class="codeph">OCITransCommit</code>或版本7等效的<code class="codeph">ocom</code> 。例如，使用<code class="codeph">tx_commit</code>或<code class="codeph">tx_rollback</code>结束全局事务。
                        </p>
                     </div>
                  </div><a id="ADFNS822"></a><div class="props_rev_3"><a id="GUID-C83AE4C3-0FD5-49FC-B3F5-AC0F5BAD6463" name="GUID-C83AE4C3-0FD5-49FC-B3F5-AC0F5BAD6463"></a><h5 id="ADFNS-GUID-C83AE4C3-0FD5-49FC-B3F5-AC0F5BAD6463" class="sect5">DDL声明</h5>
                     <div>
                        <p>由于数据定义语言（DDL）语句（如<code class="codeph">CREATE</code> <code class="codeph">TABLE</code> ）意味着隐式提交，因此Oracle XA应用程序无法运行任何DDL语句。
                        </p>
                     </div>
                  </div><a id="ADFNS823"></a><div class="props_rev_3"><a id="GUID-5E6A9F11-244B-4A26-8781-0C654AC9E448" name="GUID-5E6A9F11-244B-4A26-8781-0C654AC9E448"></a><h5 id="ADFNS-GUID-5E6A9F11-244B-4A26-8781-0C654AC9E448" class="sect5">会话状态</h5>
                     <div>
                        <p>Oracle数据库不保证会话状态在TPM服务之间有效。例如，如果TPM服务更新会话变量（例如全局包变量），则作为同一全局事务的一部分运行的另一个TPM服务可能看不到更改。仅在TPM服务中使用保存点。应用程序不得引用在另一个TPM服务中创建的保存点。同样，应用程序不得尝试从另一个TPM服务中执行的游标中获取。</p>
                     </div>
                  </div><a id="ADFNS824"></a><div class="props_rev_3"><a id="GUID-407EDF18-A106-4E62-B795-2C5A8552C824" name="GUID-407EDF18-A106-4E62-B795-2C5A8552C824"></a><h5 id="ADFNS-GUID-407EDF18-A106-4E62-B795-2C5A8552C824" class="sect5">EXEC SQL</h5>
                     <div>
                        <p>不要使用<code class="codeph">EXEC</code> <code class="codeph">SQL</code>语句进行连接或断开连接。也就是说，不要使用<code class="codeph">EXEC</code> <code class="codeph">SQL</code> <code class="codeph">CONNECT</code> ， <code class="codeph">EXEC</code> <code class="codeph">SQL</code> <code class="codeph">COMMIT</code> <code class="codeph">WORK</code> <code class="codeph">RELEASE</code>或<code class="codeph">EXEC</code> <code class="codeph">SQL</code> <code class="codeph">ROLLBACK</code> <code class="codeph">WORK</code> <code class="codeph">RELEASE</code> 。</p>
                     </div>
                  </div>
               </div><a id="ADFNS825"></a><div class="props_rev_3"><a id="GUID-6166F2B9-4ADA-417E-A8B2-6FF22C3D72E8" name="GUID-6166F2B9-4ADA-417E-A8B2-6FF22C3D72E8"></a><h4 id="ADFNS-GUID-6166F2B9-4ADA-417E-A8B2-6FF22C3D72E8" class="sect4">其他限制</h4>
                  <div>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您不能在同一会话中同时使用Oracle XA和网关。</p>
                        </li>
                        <li>
                           <p>Oracle数据库不支持关联迁移（事务管理器可以恢复另一个分支中的挂起分支关联的方法）。</p>
                        </li>
                        <li>
                           <p>不支持可选的XA功能异步XA调用。</p>
                        </li>
                        <li>
                           <p>将<code class="codeph">TRANSACTIONS</code>初始化参数设置为预期的并发全局事务数。初始化参数<code class="codeph">OPEN_LINKS_PER_INSTANCE</code>指定可以迁移的打开的数据库链接连接数。XA事务使用这些数据库链接连接，以便在提交事务后缓存连接。
                           </p>
                           <div class="infoboxnotealso" id="GUID-6166F2B9-4ADA-417E-A8B2-6FF22C3D72E8__GUID-7A537654-45E3-40A0-9389-29ABDE8E182A">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="xa.html#GUID-C4F27C42-C388-4604-8986-7917930F7EF8">在Oracle XA应用程序中使用数据库链接</a></p>
                           </div>
                        </li>
                        <li>
                           <p>每个线程的最大<code class="codeph">xa_open</code>调用数为32。
                           </p>
                        </li>
                        <li>
                           <p>在构建基于TP-monitor的XA应用程序时，请确保TP-monitors库（定义符号<code class="codeph">ax_reg</code>和<code class="codeph">ax_unreg</code> ）放置在Oracle Database的客户端共享库之前的链接行中。如果您的平台不支持共享库，或者链接器对链接行中的库排序不敏感，请使用Oracle数据库的非共享客户端库。这些链接限制仅在使用XA的动态注册（Oracle XA交换机<code class="codeph">xaoswd</code> ）时适用。
                           </p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>