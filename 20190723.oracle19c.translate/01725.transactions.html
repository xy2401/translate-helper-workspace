<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="This chapter defines a transaction and describes how the database processes transactions."></meta>
      <meta name="description" content="This chapter defines a transaction and describes how the database processes transactions."></meta>
      <title>交易</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Database Concepts"></meta>
      <meta property="og:description" content="This chapter defines a transaction and describes how the database processes transactions."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Database Concepts"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-concepts.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T07:47:16-08:00"></meta>
      <meta name="dcterms.title" content="Database Concepts"></meta>
      <meta name="dcterms.dateCopyrighted" content="1993, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96138-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="data-concurrency-and-consistency.html" title="Previous" type="text/html"></link>
      <link rel="next" href="oracle-database-storage-structures.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="CNCPT"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="data-concurrency-and-consistency.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="oracle-database-storage-structures.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据库概念</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="oracle-transaction-management.html" property="item" typeof="WebPage"><span property="name">Oracle事务管理</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">交易</li>
            </ol>
            <a id="GUID-B97790CB-DF82-442D-B9D5-50CCE6BF9FBD" name="GUID-B97790CB-DF82-442D-B9D5-50CCE6BF9FBD"></a>
            
            <h2 id="CNCPT-GUID-B97790CB-DF82-442D-B9D5-50CCE6BF9FBD" class="sect2"><span class="enumeration_chapter">10</span>笔交易</h2>
         </header>
         <div class="ind"><script type="text/javascript">window.name='transactions'</script><script type="text/javascript">
    function footdisplay(footnum,footnote) {
    var msg = window.open('about:blank', 'NewWindow' + footnum,
        'directories=no,height=100,location=no,menubar=no,resizable=yes,' +
        'scrollbars=yes,status=no,toolbar=no,width=598');
    msg.document.open('text/html');
    msg.document.write('<!DOCTYPE html ');
    msg.document.write('PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" ');
    msg.document.write('"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">'); 
    msg.document.write('<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us" dir="ltr"><head><title>');
   
    msg.document.write('Footnote&nbsp; ' + footnum);
    msg.document.write('<\/title><meta http-equiv="Content-Type" ');
    msg.document.write('content="text/html; charset=utf-8" />');
    msg.document.write('<meta http-equiv="Content-Script-Type" ');
    msg.document.write('content="text/javascript" />');
    msg.document.write('<style type="text/css"> <![CDATA[ ');
    msg.document.write('h1 {text-align: center; font-size: 14pt;}');
    msg.document.write('fieldset {border: none;}');
    msg.document.write('form {text-align: center;}');
    msg.document.write(' ]]u003e </style>');
    msg.document.write('<\/head><body><div id="footnote"><h1>Footnote&nbsp; ' + footnum + '<\/h1><p>');
    msg.document.write(footnote);
    msg.document.write('<\/p><form action="" method="post"><fieldset>');
    msg.document.write('<input type="button" value="OK" ');
    msg.document.write('onclick="window.close();" />');
    msg.document.write('<\/fieldset><\/form><\/div><\/body><\/html>');
    msg.document.close();
    setTimeout(function() {
        var height = msg.document.getElementById('footnote').offsetHeight;
        msg.resizeTo(598, height + 100);
    }
    , 100);
    msg.focus();
}
            </script><noscript>
               <p>此页面上的脚本内容仅用于导航目的，不会以任何方式更改内容。</p>
            </noscript>
            <div>
               <p>本章定义了一个事务，并描述了数据库如何处理事务。</p>
               <p>本章包含以下部分：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="transactions.html#GUID-31319EA7-994C-4D25-8814-0214ABD3CBDA" title="事务是包含一个或多个SQL语句的逻辑原子工作单元。">交易简介</a></p>
                  </li>
                  <li>
                     <p><a href="transactions.html#GUID-5BB15405-8A03-47DE-8A20-63E1B83E1361" title="事务控制是对DML语句所做的更改以及将DML语句分组到事务中的管理。">交易控制概述</a></p>
                  </li>
                  <li>
                     <p><a href="transactions.html#GUID-47BCD081-8FFF-4D13-A0B1-F531521BC6C3" title="Transaction Guard是一种API，应用程序可以使用它来提供事务幂等性，这是数据库保留保证提交结果的能力，该结果指示事务是否已提交和完成。Oracle数据库为JDBC瘦，OCI，OCCI和ODP.Net提供API。">交易保护概述</a></p>
                  </li>
                  <li>
                     <p><a href="transactions.html#GUID-0B463F72-73C9-4EB6-B98D-5EC828CDB1E7" title="应用程序连续性尝试通过在计划外和计划中断后重放未完成的应用程序请求来屏蔽应用程序中断。在此上下文中，请求是应用程序的工作单元。">应用程序连续性概述</a></p>
                  </li>
                  <li>
                     <p><a href="transactions.html#GUID-C0C61571-5175-400D-AEFC-FDBFE4F87188" title="自治事务是可以从另一个事务调用的独立事务，该事务是主事务。您可以挂起调用事务，执行SQL操作并在自治事务中提交或撤消它们，然后恢复调用事务。">自治交易概述</a></p>
                  </li>
                  <li>
                     <p><a href="transactions.html#GUID-47231512-4A3E-4E59-86BD-332E1FB88A88" title="分布式事务是包含一个或多个语句的事务，这些语句使用称为数据库链接的模式对象更新分布式数据库的两个或更多不同节点上的数据。">分布式事务概述</a></p>
                  </li>
               </ul>
            </div><a id="CNCPT117"></a><div class="props_rev_3"><a id="GUID-31319EA7-994C-4D25-8814-0214ABD3CBDA" name="GUID-31319EA7-994C-4D25-8814-0214ABD3CBDA"></a><h3 id="CNCPT-GUID-31319EA7-994C-4D25-8814-0214ABD3CBDA" class="sect3">交易简介</h3>
               <div>
                  <p><span class="bold">事务</span>是包含一个或多个SQL语句的逻辑原子工作单元。
                  </p>
                  <p>事务将SQL语句分组，以便它们全部提交，这意味着它们应用于数据库，或全部回滚，这意味着它们从数据库中撤消。Oracle数据库为每个事务分配一个称为<a href="glossary.html#GUID-71C31D71-F2E8-4FB9-9010-062C1C407CEF"><span class="xrefglossterm">事务ID</span></a>的唯一标识符。</p>
                  <p>所有Oracle事务都遵循数据库事务的基本属性，称为<a href="glossary.html#GUID-2684886B-AB0E-4F65-9B24-688511AED791"><span class="xrefglossterm">ACID属性</span></a> 。ACID是以下内容的首字母缩写：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>原子性</p>
                        <p>执行事务的所有任务或不执行任何任务。没有部分交易。例如，如果事务开始更新100行，但系统在20次更新后失败，则数据库将更改回滚到这20行。</p>
                     </li>
                     <li>
                        <p>一致性</p>
                        <p>事务将数据库从一个一致状态转换为另一个一致状态。例如，在借记储蓄账户并贷记支票账户的银行交易中，故障不得导致数据库仅贷记一个账户，这将导致数据不一致。</p>
                     </li>
                     <li>
                        <p>隔离</p>
                        <p>在提交事务之前，事务的影响对其他事务是不可见的。例如，更新<code class="codeph">hr.employees</code>表的一个用户看不到另一个用户同时进行的对<code class="codeph">employees</code>的未提交更改。因此，对于用户来说，似乎事务是串行执行的。
                        </p>
                     </li>
                     <li>
                        <p>耐久力</p>
                        <p>已提交事务所做的更改是永久性的。事务完成后，数据库通过其恢复机制确保不会丢失事务中的更改。</p>
                     </li>
                  </ul>
                  <p>事务的使用是数据库管理系统与文件系统不同的最重要方式之一。</p>
               </div><a id="CNCPT88951"></a><a id="CNCPT037"></a><div class="props_rev_3"><a id="GUID-A049FE81-8B67-4386-B599-9CDD7E6B6C59" name="GUID-A049FE81-8B67-4386-B599-9CDD7E6B6C59"></a><h4 id="CNCPT-GUID-A049FE81-8B67-4386-B599-9CDD7E6B6C59" class="sect4">样本交易：账户借记和贷记</h4>
                  <div>
                     <p>为了说明交易的概念，请考虑银行数据库。</p>
                     <p>当客户将资金从储蓄账户转移到支票账户时，交易必须包含三个单独的操作：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>减少储蓄账户</p>
                        </li>
                        <li>
                           <p>增加支票帐户</p>
                        </li>
                        <li>
                           <p>在交易日志中记录交易</p>
                        </li>
                     </ul>
                     <p>Oracle数据库必须允许两种情况。如果所有三个SQL语句都以适当的平衡维护帐户，则可以将事务的效果应用于数据库。但是，如果资金不足，帐号无效或硬件故障等问题导致事务中的一个或两个语句无法完成，则数据库必须回滚整个事务，以便所有帐户的余额都正确。</p>
                     <p>下图说明了银行交易。第一份声明从储蓄账户3209中减去500美元。第二个声明为支票账户3208增加了500美元。第三个语句将传输记录插入日志表。最终语句提交事务。</p>
                     <div class="figure" id="GUID-A049FE81-8B67-4386-B599-9CDD7E6B6C59__I974">
                        <p class="titleinfigure">图10-1银行交易</p><img src="img/cncpt025.gif" alt="下面是图10-1的描述" title="下面是图10-1的描述" longdesc="img_text/cncpt025.html"><br><a href="img_text/cncpt025.html">“图10-1银行交易”的说明</a></div>
                     <!-- class="figure" -->
                  </div>
               </div><a id="CNCPT038"></a><div class="props_rev_3"><a id="GUID-7690181F-8293-47B9-ADC1-905BD9C3AF57" name="GUID-7690181F-8293-47B9-ADC1-905BD9C3AF57"></a><h4 id="CNCPT-GUID-7690181F-8293-47B9-ADC1-905BD9C3AF57" class="sect4">交易结构</h4>
                  <div>
                     <p>数据库事务由一个或多个语句组成。</p>
                     <p>具体而言，交易包括以下之一：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>一个或多个数据操作语言（DML）语句，它们共同构成对数据库的原子更改</p>
                        </li>
                        <li>
                           <p>一种数据定义语言（DDL）语句</p>
                        </li>
                     </ul>
                     <p>交易有开始和结束。</p>
                     <div class="infoboxnotealso" id="GUID-7690181F-8293-47B9-ADC1-905BD9C3AF57__GUID-FA8AAADC-7384-4FF1-9D20-FDD1F0662E7E">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="sql.html#GUID-662EE4B0-7D5E-43F5-806D-A2AE404D77BF" title="对Oracle数据库中的信息执行的所有操作都使用SQL语句运行。SQL语句是由标识符，参数，变量，名称，数据类型和SQL保留字组成的计算机程序或指令。">SQL语句概述</a> ”</span></p>
                           </li>
                           <li>
                              <p><a href="../sqlrf/Types-of-SQL-Statements.html#SQLRF-GUID-E1749EF5-2264-44DF-99EF-AEBEB943BED6" target="_blank"><span><cite>Oracle数据库SQL语言参考，</cite></span></a>用于SQL语句类型的帐户</p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="CNCPT88952"></a><div class="props_rev_3"><a id="GUID-E3FB3DC3-3317-4589-BADD-D89A3547F87D" name="GUID-E3FB3DC3-3317-4589-BADD-D89A3547F87D"></a><h5 id="CNCPT-GUID-E3FB3DC3-3317-4589-BADD-D89A3547F87D" class="sect5">交易开始</h5>
                     <div>
                        <p>事务在遇到第一个可执行SQL语句时开始。</p>
                        <p><a href="glossary.html#GUID-2F2F02A4-2405-4A0A-ABAF-91DB48DD4B82"><span class="xrefglossterm">可执行SQL语句</span></a>是一种SQL语句，它生成对<a href="glossary.html#GUID-CFB1A30E-76B6-44EA-839E-9E63C8DA31AC"><span class="xrefglossterm">数据库实例的</span></a>调用，包括DML和DDL语句以及<code class="codeph">SET TRANSACTION</code>语句。
                        </p>
                        <p>事务开始时，Oracle数据库会将事务分配给可用的<a href="glossary.html#GUID-297B963A-989C-4720-B061-A2352FF72892"><span class="xrefglossterm">撤消数据</span></a>段，以记录新事务的撤消条目。在分配撤消段和<a href="glossary.html#GUID-BFF71130-2760-4C64-8829-7772C803FBE7"><span class="xrefglossterm">事务表</span></a>槽之前，不会分配事务ID，这在第一个DML语句期间发生。事务ID对于事务是唯一的，表示还原段号，插槽和序列号。
                        </p>
                        <p>以下示例执行<code class="codeph">UPDATE</code>语句以开始事务，并查询<code class="codeph">V$TRANSACTION</code>以获取有关<code class="codeph">V$TRANSACTION</code>的详细信息：</p><pre class="pre codeblock"><code>SQL&gt; UPDATE hr.employees SET salary = salary; 107行更新。SQL&gt; SELECT XID AS“txn id”，XIDUSN AS“undo seg”，XIDSLOT AS“slot”，2 XIDSQN AS“seq”，STATUS AS“txn status”3 FROM V $ TRANSACTION; txn id undo seg slot seq txn status ---------------- ---------- ---------- ------ ---- ---------------- 0600060037000000 6 6 55 ACTIVE</code></pre><div class="infoboxnotealso" id="GUID-E3FB3DC3-3317-4589-BADD-D89A3547F87D__GUID-A3625BA5-F209-4844-88DE-84C49CDBCFCF">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="logical-storage-structures.html#GUID-6E206D3A-E0E7-4B23-9C41-516FB35BC3FE" title="Oracle数据库维护事务操作的记录，统称为撤消数据。">撤消细分</a> ”</span></p>
                        </div>
                     </div>
                  </div><a id="CNCPT88953"></a><div class="props_rev_3"><a id="GUID-510DF997-BA9C-4431-95EF-A0622881EC9C" name="GUID-510DF997-BA9C-4431-95EF-A0622881EC9C"></a><h5 id="CNCPT-GUID-510DF997-BA9C-4431-95EF-A0622881EC9C" class="sect5">交易结束</h5>
                     <div>
                        <p>交易可以在不同情况下结束。</p>
                        <p>发生以下任何操作时，事务结束：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>用户发出<span class="italic">不</span>带<code class="codeph">SAVEPOINT</code>子句的<code class="codeph">COMMIT</code>或<code class="codeph">ROLLBACK</code>语句。
                              </p>
                              <p>在<a href="glossary.html#GUID-0680EB2C-ADF4-431A-A259-FB2227E5AA93"><span class="xrefglossterm">提交中</span></a> ，用户明确或隐式地请求将事务中的更改设为永久更改。只有在事务提交后，事务所做的更改才是永久性的，并且对其他用户可见。
                              </p>
                           </li>
                           <li>
                              <p>用户运行DDL命令，例如<code class="codeph">CREATE</code> ， <code class="codeph">DROP</code> ， <code class="codeph">RENAME</code>或<code class="codeph">ALTER</code> 。</p>
                              <p>数据库在每个DDL语句之前和之后发出隐式<code class="codeph">COMMIT</code>语句。如果当前事务包含DML语句，则Oracle数据库首先提交事务，然后运行并将DDL语句作为新的单语句事务提交。
                              </p>
                           </li>
                           <li>
                              <p>用户通常从大多数Oracle数据库实用程序和工具退出，导致当前事务被隐式提交。用户断开连接时的提交行为取决于应用程序并且是可配置的。</p>
                              <div class="infoboxnote" id="GUID-510DF997-BA9C-4431-95EF-A0622881EC9C__GUID-FE2BC2EA-ECED-4B0E-BAD7-B60F09830E6B">
                                 <p class="notep1">注意：</p>
                                 <p>应用程序应始终在程序终止之前显式提交或撤消事务。</p>
                              </div>
                           </li>
                           <li>
                              <p>客户端进程异常终止，导致使用存储在事务表和还原段中的元数据隐式回滚事务。</p>
                           </li>
                        </ul>
                        <p>一个事务结束后，下一个可执行SQL语句会自动启动以下事务。以下示例执行<code class="codeph">UPDATE</code>以启动事务，使用<code class="codeph">ROLLBACK</code>语句结束事务，然后执行<code class="codeph">UPDATE</code>以启动新事务（请注意事务ID不同）：</p><pre class="pre codeblock"><code>SQL&gt; UPDATE hr.employees SET salary = salary; 107行更新。SQL&gt; SELECT XID，STATUS FROM V $ TRANSACTION; XID STATUS ---------------- ---------------- 0800090033000000 ACTIVE SQL&gt; ROLLBACK;回滚完成。SQL&gt; SELECT XID FROM V $ TRANSACTION;没有选择行SQL&gt; UPDATE hr.employees SET last_name = last_name; 107行更新。SQL&gt; SELECT XID，STATUS FROM V $ TRANSACTION; XID STATUS ---------------- ---------------- 0900050033000000 ACTIVE</code></pre><div class="infoboxnotealso" id="GUID-510DF997-BA9C-4431-95EF-A0622881EC9C__GUID-53EDFBB7-6436-4DB3-9CA6-617DFB9BA4F3">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="transactions.html#GUID-A049FE81-8B67-4386-B599-9CDD7E6B6C59" title="为了说明交易的概念，请考虑银行数据库。">示例交易：帐户借方和贷方</a> ”，</span>用于以提交结束的交易示例。
                                 </p>
                              </li>
                              <li>
                                 <p><a href="../sqlrf/COMMIT.html#SQLRF01110" target="_blank"><span><cite>Oracle数据库SQL语言参考</cite></span></a> ，了解<code class="codeph">COMMIT</code></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div><a id="CNCPT1115"></a><div class="props_rev_3"><a id="GUID-5A632477-AC9E-4BC7-BB06-26B64837BF90" name="GUID-5A632477-AC9E-4BC7-BB06-26B64837BF90"></a><h4 id="CNCPT-GUID-5A632477-AC9E-4BC7-BB06-26B64837BF90" class="sect4">声明级原子性</h4>
                  <div>
                     <p>Oracle数据库支持<strong class="term">语句级原子性</strong> ，这意味着SQL语句是一个原子工作单元，并且完全成功或完全失败。
                     </p>
                     <p>成功的声明与已提交的事务不同。如果数据库在没有错误的情况下解析并运行它作为原子单元，则单个SQL语句将成功执行，就像在多行更新中更改所有行一样。</p>
                     <p>如果SQL语句在执行期间导致错误，则它不成功，因此将回滚该语句的所有效果。此操作是<a href="glossary.html#GUID-187EACC0-1FDD-498A-BEAD-892AC03B50D0"><span class="xrefglossterm">语句级回滚</span></a> 。此操作具有以下特征：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>不成功的SQL语句只会导致它本身会执行的工作丢失。</p>
                           <p>不成功的声明不会导致在当前事务中丢失之前的任何工作。例如，如果<span class="q">“ <a href="transactions.html#GUID-A049FE81-8B67-4386-B599-9CDD7E6B6C59" title="为了说明交易的概念，请考虑银行数据库。">Sample Transaction：Account Debit and Credit</a> ”</span>中的第二个<code class="codeph">UPDATE</code>语句的执行导致错误并被回滚，则第一个<code class="codeph">UPDATE</code>语句执行的工作不会回滚。第一个<code class="codeph">UPDATE</code>语句可以由用户显式提交或回滚。
                           </p>
                        </li>
                        <li>
                           <p>回滚的效果就好像语句从未运行过一样。</p>
                           <p>原子语句的任何副作用（例如，在执行语句时调用的触发器）都被视为原子语句的一部分。作为原子语句的一部分生成的所有工作都成功或者没有成功。</p>
                        </li>
                     </ul>
                     <p>导致语句级回滚的错误示例是尝试插入重复的<a href="glossary.html#GUID-8640EFA5-276C-4812-A078-1F21F55F4200"><span class="xrefglossterm">主键</span></a> 。<a href="glossary.html#GUID-E33D1853-7F99-4FDD-9CC7-D6308E943D61"><span class="xrefglossterm">死锁中</span></a>涉及的单个SQL语句（即对相同数据的竞争）也可能导致语句级回滚。但是，在SQL语句解析期间发现的错误（例如语法错误）尚未运行，因此不会导致语句级回滚。
                     </p>
                     <div class="infoboxnotealso" id="GUID-5A632477-AC9E-4BC7-BB06-26B64837BF90__GUID-601E894B-FB32-4487-8EAF-8D2714D16083">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="sql.html#GUID-B3F2B5B8-B679-4A7C-B1E8-286F36319FCB" title="SQL处理的第一个阶段是SQL解析。此阶段涉及将SQL语句的各个部分分离为可由其他例程处理的数据结构。">SQL解析</a> ”</span></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="data-concurrency-and-consistency.html#GUID-C1971E9B-849A-4634-9575-4F8FAD697750" title="死锁是指两个或更多用户正在等待彼此锁定的数据的情况。死锁会阻止某些事务继续工作。">锁和死锁</a> ”</span></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="server-side-programming.html#GUID-40297ADF-0968-42F8-B8B9-84AD6ADCBE63" title="数据库触发器是一个编译的存储程序单元，用PL / SQL或Java编写，Oracle数据库调用（" fire=")=" ="">触发器概述</a> ”</span></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="CNCPT039"></a><div class="props_rev_3"><a id="GUID-A2615547-94D2-4346-B156-64C534C5E9E4" name="GUID-A2615547-94D2-4346-B156-64C534C5E9E4"></a><h4 id="CNCPT-GUID-A2615547-94D2-4346-B156-64C534C5E9E4" class="sect4">系统变更编号（SCN）</h4>
                  <div>
                     <p><strong class="term">系统更改编号（SCN）</strong>是Oracle数据库使用的逻辑内部时间戳。
                     </p>
                     <p>SCN对数据库中发生的事件进行排序，这是满足事务的ACID属性所必需的。Oracle数据库使用SCN标记SCN，在此之前已知所有更改都在磁盘上，以便恢复避免应用不必要的重做。数据库还使用SCN标记一组数据不存在重做的点，以便可以停止恢复。</p>
                     <p>SCN以单调递增的顺序发生。Oracle数据库可以像时钟一样使用SCN，因为观察到的SCN表示逻辑时间点，重复观察返回相等或更大的值。如果一个事件的SCN低于另一个事件，则它在数据库中的较早时间发生。多个事件可能共享相同的SCN，这意味着它们在数据库中同时发生。</p>
                     <p>每笔交易都有一个SCN。例如，如果事务更新了一行，则数据库会记录发生此更新的SCN。此事务中的其他修改具有相同的SCN。当事务提交时，数据库会记录此提交的SCN。</p>
                     <p>Oracle数据库在<a href="glossary.html#GUID-78C0E867-233A-4857-B9FE-A3852A9B7BDF"><span class="xrefglossterm">系统全局区域（SGA）中</span></a>增加SCN。当事务修改数据时，数据库会将新SCN写入分配给事务的撤消数据段。然后，日志写入器进程立即将事务的提交记录写入<a href="glossary.html#GUID-2A8BC112-AB70-4B06-9F85-FE975861CEE0"><span class="xrefglossterm">联机重做日志</span></a> 。提交记录具有事务的唯一SCN。Oracle数据库还将SCN用作其<a href="glossary.html#GUID-FFDBC27D-CE99-49C7-8BB9-C8C2D8D52801"><span class="xrefglossterm">实例恢复</span></a>和<a href="glossary.html#GUID-938A3E7D-CC65-496C-9DB3-3CFC45AFA8DD"><span class="xrefglossterm">介质恢复</span></a>机制的一部分。
                     </p>
                     <div class="infoboxnotealso" id="GUID-A2615547-94D2-4346-B156-64C534C5E9E4__GUID-F2FF6329-8DAD-4392-845D-8A832BFD50E8">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="oracle-database-instance.html#GUID-728C6BE1-5687-4DC5-B570-D2042C88F935" title="实例恢复是将联机重做日志中的记录应用于数据文件以重建最近检查点之后所做更改的过程。">实例恢复概述</a> ”</span></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="concepts-for-database-administrators.html#GUID-DCE361D9-B486-43B4-B4FD-5722A93203F0" title="备份和恢复是保护数据库免受介质故障或用户错误导致的数据丢失所涉及的一组概念，过程和策略。通常，备份和恢复策略的目的是保护数据库免受数据丢失和重建丢失的数据。">备份和恢复</a> ”</span></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div><a id="CNCPT88954"></a><a id="CNCPT1118"></a><div class="props_rev_3"><a id="GUID-5BB15405-8A03-47DE-8A20-63E1B83E1361" name="GUID-5BB15405-8A03-47DE-8A20-63E1B83E1361"></a><h3 id="CNCPT-GUID-5BB15405-8A03-47DE-8A20-63E1B83E1361" class="sect3">交易控制概述</h3>
               <div>
                  <p><span class="bold">事务控制</span>是对DML语句所做的更改以及将DML语句分组到事务中的管理。
                  </p>
                  <p>通常，应用程序设计人员关心事务控制，以便以逻辑单元完成工作，并保持数据的一致性。</p>
                  <p>事务控制涉及使用以下语句，如<span class="q">“ <a href="sql.html#GUID-73F24816-881A-4849-B8A7-EA9B446A24A7" title="事务控制语句管理DML语句所做的更改，并将DML语句分组到事务中。">事务控制语句</a> ”中所述</span> ：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><code class="codeph">COMMIT</code>语句结束当前事务，并使事务中执行的所有更改成为永久更改。<code class="codeph">COMMIT</code>还会擦除事务中的所有保存点并释放事务锁。
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">ROLLBACK</code>语句反转当前事务中完成的工作;它导致自上次<code class="codeph">COMMIT</code>或<code class="codeph">ROLLBACK</code>被丢弃以来的所有数据更改。<code class="codeph">ROLLBACK TO SAVEPOINT</code>语句撤消自上一个保存点以来的更改，但不会结束整个事务。
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">SAVEPOINT</code>语句标识事务中您可以稍后回滚的点。
                        </p>
                     </li>
                  </ul>
                  <p><a href="transactions.html#GUID-5BB15405-8A03-47DE-8A20-63E1B83E1361__CHDCIJGA" title="此表显示了一个会话，说明了事务控制的基本概念。">表10-1中</a>的会话说明了事务控制的基本概念。
                  </p>
                  <div class="tblformalwide" id="GUID-5BB15405-8A03-47DE-8A20-63E1B83E1361__CHDCIJGA">
                     <p class="titleintable">表10-1交易控制</p>
                     <table cellpadding="4" cellspacing="0" class="FormalWide" title="交易控制" width="100%" border="1" summary="This table shows a session that illustrates the basic concepts of transaction control. " frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="5%" id="d53698e2712">Ť</th>
                              <th align="left" valign="bottom" width="45%" id="d53698e2715">会议</th>
                              <th align="left" valign="bottom" width="50%" id="d53698e2718">说明</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="5%" id="d53698e2723" headers="d53698e2712 ">
                                 <p>T0</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d53698e2723 d53698e2715 "><pre class="pre codeblock"><code>承诺;</code></pre></td>
                              <td align="left" valign="top" width="50%" headers="d53698e2723 d53698e2718 ">
                                 <p>此语句结束会话中的任何现有事务。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="5%" id="d53698e2733" headers="d53698e2712 ">
                                 <p>T1</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d53698e2733 d53698e2715 "><pre class="pre codeblock"><code>SET TRANSACTION NAME'sal_update';</code></pre></td>
                              <td align="left" valign="top" width="50%" headers="d53698e2733 d53698e2718 ">
                                 <p>此语句开始一个事务并将其命名为<code class="codeph">sal_update</code> 。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="5%" id="d53698e2746" headers="d53698e2712 ">
                                 <p>T2</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d53698e2746 d53698e2715 "><pre class="pre codeblock"><code>UPDATE员工SET薪水= 7000 WHERE last_name ='Banda';</code></pre></td>
                              <td align="left" valign="top" width="50%" headers="d53698e2746 d53698e2718 ">
                                 <p>此声明将Banda的工资更新为7000。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="5%" id="d53698e2756" headers="d53698e2712 ">
                                 <p>T3</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d53698e2756 d53698e2715 "><pre class="pre codeblock"><code>SAVEPOINT after_banda_sal;</code></pre></td>
                              <td align="left" valign="top" width="50%" headers="d53698e2756 d53698e2718 ">
                                 <p>此语句创建一个名为<code class="codeph">after_banda_sal</code>的保存点，使此事务中的更改可以回滚到此时。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="5%" id="d53698e2769" headers="d53698e2712 ">
                                 <p>T4</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d53698e2769 d53698e2715 "><pre class="pre codeblock"><code>UPDATE员工SET薪水= 12000 WHERE last_name ='Greene';</code></pre></td>
                              <td align="left" valign="top" width="50%" headers="d53698e2769 d53698e2718 ">
                                 <p>此声明将Greene的薪水更新为12000。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="5%" id="d53698e2779" headers="d53698e2712 ">
                                 <p>T5</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d53698e2779 d53698e2715 "><pre class="pre codeblock"><code>SAVEPOINT after_greene_sal;</code></pre></td>
                              <td align="left" valign="top" width="50%" headers="d53698e2779 d53698e2718 ">
                                 <p>此语句创建一个名为<code class="codeph">after_greene_sal</code>的保存点，使此事务中的更改可以回滚到此时。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="5%" id="d53698e2792" headers="d53698e2712 ">
                                 <p>T6</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d53698e2792 d53698e2715 "><pre class="pre codeblock"><code>ROLLBACK TO SAVEPOINT after_banda_sal;</code></pre></td>
                              <td align="left" valign="top" width="50%" headers="d53698e2792 d53698e2718 ">
                                 <p>此语句将事务回滚到t3，在t4撤消对Greene工资的更新。<code class="codeph">sal_update</code>事务<span class="italic">尚未</span>结束。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="5%" id="d53698e2808" headers="d53698e2712 ">
                                 <p>T7</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d53698e2808 d53698e2715 "><pre class="pre codeblock"><code>UPDATE员工SET薪水= 11000 WHERE last_name ='Greene';</code></pre></td>
                              <td align="left" valign="top" width="50%" headers="d53698e2808 d53698e2718 ">
                                 <p>此语句将事务<code class="codeph">sal_update</code> Greene的工资更新为11000。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="5%" id="d53698e2821" headers="d53698e2712 ">
                                 <p>T8</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d53698e2821 d53698e2715 "><pre class="pre codeblock"><code>ROLLBACK;</code></pre></td>
                              <td align="left" valign="top" width="50%" headers="d53698e2821 d53698e2718 ">
                                 <p>此语句回滚事务<code class="codeph">sal_update</code>所有更改，结束事务。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="5%" id="d53698e2834" headers="d53698e2712 ">
                                 <p>T9</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d53698e2834 d53698e2715 "><pre class="pre codeblock"><code>SET TRANSACTION NAME'sal_update2';</code></pre></td>
                              <td align="left" valign="top" width="50%" headers="d53698e2834 d53698e2718 ">
                                 <p>此语句在会话中开始一个新事务，并将其命名为<code class="codeph">sal_update2</code> 。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="5%" id="d53698e2847" headers="d53698e2712 ">
                                 <p>T10</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d53698e2847 d53698e2715 "><pre class="pre codeblock"><code>UPDATE员工SET薪水= 7050 WHERE last_name ='Banda';</code></pre></td>
                              <td align="left" valign="top" width="50%" headers="d53698e2847 d53698e2718 ">
                                 <p>此声明将Banda的工资更新为7050。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="5%" id="d53698e2858" headers="d53698e2712 ">
                                 <p>T11</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d53698e2858 d53698e2715 "><pre class="pre codeblock"><code>UPDATE员工SET薪水= 10950 WHERE last_name ='Greene';</code></pre></td>
                              <td align="left" valign="top" width="50%" headers="d53698e2858 d53698e2718 ">
                                 <p>此声明将Greene的薪水更新为10950。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="5%" id="d53698e2868" headers="d53698e2712 ">
                                 <p>T12</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d53698e2868 d53698e2715 "><pre class="pre codeblock"><code>承诺;</code></pre></td>
                              <td align="left" valign="top" width="50%" headers="d53698e2868 d53698e2718 ">
                                 <p>此语句提交事务<code class="codeph">sal_update2</code>所做的所有更改，从而结束事务。提交保证更改保存在联机重做日志文件中。
                                 </p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <div class="infoboxnotealso" id="GUID-5BB15405-8A03-47DE-8A20-63E1B83E1361__GUID-047002A0-E2E5-44C1-8C97-7CCC9D5EBED0">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="../sqlrf/Types-of-SQL-Statements.html#SQLRF30043" target="_blank"><span><cite>Oracle数据库SQL语言参考</cite></span></a> ，了解事务控制语句</p>
                  </div>
               </div><a id="CNCPT1122"></a><div class="props_rev_3"><a id="GUID-0B3F11E3-5C3E-4BB4-9E13-E1EC07D3FD2B" name="GUID-0B3F11E3-5C3E-4BB4-9E13-E1EC07D3FD2B"></a><h4 id="CNCPT-GUID-0B3F11E3-5C3E-4BB4-9E13-E1EC07D3FD2B" class="sect4">交易名称</h4>
                  <div>
                     <p>事务名称是可选的，用户指定的标记，用于提醒事务正在执行的工作。您使用<code class="codeph">SET TRANSACTION</code>命名<code class="codeph">SET TRANSACTION</code> <code class="codeph">...</code> <code class="codeph">NAME</code>语句，如果使用，必须是事务的第一个语句。
                     </p>
                     <p>在<a href="transactions.html#GUID-5BB15405-8A03-47DE-8A20-63E1B83E1361__CHDCIJGA" title="此表显示了一个会话，说明了事务控制的基本概念。">表10-1中</a> ，第一个事务名为<code class="codeph">sal_update</code> ，第二个事务名为<code class="codeph">sal_update2</code> 。
                     </p>
                     <p>交易名称具有以下优点：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>监视长时间运行的事务并解决不确定的分布式事务更容易。</p>
                        </li>
                        <li>
                           <p>您可以在应用程序中查看事务名称以及事务ID。例如，数据库管理员可以在监视系统活动时查看Oracle Enterprise Manager（企业管理器）中的事务名称。</p>
                        </li>
                        <li>
                           <p>数据库将事务名称写入事务审计重做记录，因此您可以使用LogMiner在重做日志中搜索特定事务。</p>
                        </li>
                        <li>
                           <p>您可以使用事务名称在数据字典视图中查找特定事务，例如<code class="codeph">V$TRANSACTION</code> 。</p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-0B3F11E3-5C3E-4BB4-9E13-E1EC07D3FD2B__GUID-C5CD08B4-812B-40B4-89BB-25DFF035C285">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="concepts-for-database-administrators.html#GUID-BE08A8FA-501A-418E-AD32-3E42AE762026" title="Oracle Enterprise Manager（企业管理器）是一个基于Web的系统管理工具，可以管理Oracle数据库，Exadata数据库计算机，融合中间件，Oracle应用程序，服务器，存储以及非Oracle硬件和软件。">Oracle企业管理器</a> ”</span></p>
                           </li>
                           <li>
                              <p><a href="../refrn/V-TRANSACTION.html#REFRN30291" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">V$TRANSACTION</code></p>
                           </li>
                           <li>
                              <p><a href="../sqlrf/SET-TRANSACTION.html#SQLRF01705" target="_blank"><span><cite>Oracle Database SQL语言参考</cite></span></a> ，了解<code class="codeph">SET TRANSACTION</code></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="CNCPT88955"></a><div class="props_rev_3"><a id="GUID-E34DAE8D-6632-4B41-948C-13AD8312410D" name="GUID-E34DAE8D-6632-4B41-948C-13AD8312410D"></a><h4 id="CNCPT-GUID-E34DAE8D-6632-4B41-948C-13AD8312410D" class="sect4">活跃交易</h4>
                  <div>
                     <p><strong class="term">活动事务</strong>是已启动但尚未提交或回滚的<strong class="term">事务</strong> 。
                     </p>
                     <p>在<a href="transactions.html#GUID-5BB15405-8A03-47DE-8A20-63E1B83E1361__CHDCIJGA" title="此表显示了一个会话，说明了事务控制的基本概念。">表10-1中</a> ，修改<code class="codeph">sal_update</code>事务中数据的第一个语句是对Banda工资的更新。从成功执行此更新直到<code class="codeph">ROLLBACK</code>语句结束事务， <code class="codeph">sal_update</code>事务处于活动状态。
                     </p>
                     <p>在事务提交或回滚之前，事务所做的数据更改是临时的。在事务结束之前，数据的状态如下表所示。</p>
                     <div class="tblformal" id="GUID-E34DAE8D-6632-4B41-948C-13AD8312410D__GUID-113A87B4-B7A1-4AED-B896-3304A37CD29F">
                        <p class="titleintable">表10-2交易结束前的数据状态</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="交易结束前的数据状态" border="1" summary="This table describes the state of the data before a transaction ends" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" id="d53698e3553">州</th>
                                 <th align="left" valign="bottom" id="d53698e3555">描述</th>
                                 <th align="left" valign="bottom" id="d53698e3557">了解更多</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d53698e3561" headers="d53698e3553 ">
                                    <p>Oracle数据库已在SGA中生成撤消信息。</p>
                                 </td>
                                 <td align="left" valign="top" headers="d53698e3561 d53698e3555 ">
                                    <p>撤消数据包含由事务的SQL语句更改的旧数据值。</p>
                                 </td>
                                 <td align="left" valign="top" headers="d53698e3561 d53698e3557 ">
                                    <p><span class="q">“ <a href="data-concurrency-and-consistency.html#GUID-432C4EDC-F7F2-467C-B85F-4E82D3D58A2F" title="数据库为每个查询提供一致的结果集，保证数据的一致性，用户无需采取任何操作。">在Read Committed Isolation Level中读取一致性</a> ”</span></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d53698e3576" headers="d53698e3553 ">
                                    <p>Oracle数据库已在SGA的联机重做日志缓冲区中生成重做。</p>
                                 </td>
                                 <td align="left" valign="top" headers="d53698e3576 d53698e3555 ">
                                    <p>重做日志记录包含对数据块的更改以及对撤消块的更改。</p>
                                 </td>
                                 <td align="left" valign="top" headers="d53698e3576 d53698e3557 ">
                                    <p><span class="q">“ <a href="memory-architecture.html#GUID-C2AD1BF6-A5AE-42E9-9677-0AA08126864B" title="重做日志缓冲区是SGA中的循环缓冲区，用于存储描述对数据库所做更改的重做条目。">重做日志缓冲区</a> ”</span></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d53698e3594" headers="d53698e3553 ">
                                    <p>已对SGA的数据库缓冲区进行了更改。</p>
                                 </td>
                                 <td align="left" valign="top" headers="d53698e3594 d53698e3555 ">
                                    <p>存储在SGA的数据库缓冲区中的已提交事务的数据更改不一定由<a href="glossary.html#GUID-C27AAA54-E60B-49BC-AB04-7B3848EBAFD6"><span class="xrefglossterm">数据库写入程序（DBW）</span></a>立即写入数据文件。磁盘写入可以在提交之前或之后发生。
                                    </p>
                                 </td>
                                 <td align="left" valign="top" headers="d53698e3594 d53698e3557 ">
                                    <p><span class="q">“ <a href="memory-architecture.html#GUID-4FF66585-E469-4631-9225-29D75594CD14" title="数据库缓冲区高速缓存（也称为缓冲区高速缓存）是存储从数据文件读取的数据块副本的存储区。">数据库缓冲区缓存</a> ”</span></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d53698e3618" headers="d53698e3553 ">
                                    <p>受数据更改影响的行将被锁定。</p>
                                 </td>
                                 <td align="left" valign="top" headers="d53698e3618 d53698e3555 ">
                                    <p>其他用户无法更改受影响的行中的数据，也无法查看未提交的更改。</p>
                                 </td>
                                 <td align="left" valign="top" headers="d53698e3618 d53698e3557 ">
                                    <p><span class="q">“ <a href="data-concurrency-and-consistency.html#GUID-1D60EFCC-03F4-4A04-B099-1B4DE5D02C47" title="数据库维护几种不同类型的锁，具体取决于获取锁的操作。">锁定行为摘要</a> ”</span></p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
               </div><a id="CNCPT1121"></a><div class="props_rev_3"><a id="GUID-55081904-2D79-430B-9E37-D4127F0BBF7D" name="GUID-55081904-2D79-430B-9E37-D4127F0BBF7D"></a><h4 id="CNCPT-GUID-55081904-2D79-430B-9E37-D4127F0BBF7D" class="sect4">保存点</h4>
                  <div>
                     <p><span class="bold">保存点</span>是事务上下文中用户声明的中间标记。
                     </p>
                     <p>在内部，保存点标记解析为SCN。保存点将长事务划分为较小的部分。</p>
                     <p>如果在长事务中使用保存点，则稍后可以选择在事务中当前点之前但在事务中声明的保存点之后回滚执行的工作。因此，如果出错，则无需重新提交每个语句。<a href="transactions.html#GUID-5BB15405-8A03-47DE-8A20-63E1B83E1361__CHDCIJGA" title="此表显示了一个会话，说明了事务控制的基本概念。">表10-1</a>创建了保存点<code class="codeph">after_banda_sal</code>以便可以将对Greene薪水的更新回滚到此保存点。
                     </p>
                  </div><a id="CNCPT88956"></a><div class="props_rev_3"><a id="GUID-D0B75614-4720-4586-9ABF-99E894FA68BD" name="GUID-D0B75614-4720-4586-9ABF-99E894FA68BD"></a><h5 id="CNCPT-GUID-D0B75614-4720-4586-9ABF-99E894FA68BD" class="sect5">回滚到Savepoint</h5>
                     <div>
                        <p>在未提交的事务中回滚到保存点意味着撤消在指定的保存点之后所做的任何更改，但这并不意味着回滚事务本身。</p>
                        <p>当事务回滚到保存点时，如<a href="transactions.html#GUID-5BB15405-8A03-47DE-8A20-63E1B83E1361__CHDCIJGA" title="此表显示了一个会话，说明了事务控制的基本概念。">表10-1中</a>运行<code class="codeph">ROLLBACK TO SAVEPOINT after_banda_sal</code> ，会发生以下情况：</p>
                        <ol>
                           <li>
                              <p>Oracle数据库仅回滚在保存点之后运行的语句。</p>
                              <p>在<a href="transactions.html#GUID-5BB15405-8A03-47DE-8A20-63E1B83E1361__CHDCIJGA" title="此表显示了一个会话，说明了事务控制的基本概念。">表10-1中</a> ， <code class="codeph">ROLLBACK TO SAVEPOINT</code>导致Greene的<code class="codeph">UPDATE</code>被回滚，而不是Banda的<code class="codeph">UPDATE</code> 。
                              </p>
                           </li>
                           <li>
                              <p>Oracle数据库保留<code class="codeph">ROLLBACK TO SAVEPOINT</code>语句中指定的保存点，但所有后续保存点都将丢失。
                              </p>
                              <p>在<a href="transactions.html#GUID-5BB15405-8A03-47DE-8A20-63E1B83E1361__CHDCIJGA" title="此表显示了一个会话，说明了事务控制的基本概念。">表10-1中</a> ， <code class="codeph">ROLLBACK TO SAVEPOINT</code>导致<code class="codeph">after_greene_sal</code>保存点丢失。
                              </p>
                           </li>
                           <li>
                              <p>Oracle数据库释放在指定保存点之后获取的所有表锁和行锁，但保留在保存点之前获取的所有数据锁。</p>
                           </li>
                        </ol>
                        <p>交易仍然有效，可以继续。</p>
                        <div class="infoboxnotealso" id="GUID-D0B75614-4720-4586-9ABF-99E894FA68BD__GUID-9F3FEA8F-4C01-43B4-BE0C-5B854CBFDA13">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../sqlrf/ROLLBACK.html#SQLRF01610" target="_blank"><span><cite>Oracle Database SQL语言参考</cite></span></a> ，了解<code class="codeph">ROLLBACK</code>和<code class="codeph">SAVEPOINT</code>语句</p>
                              </li>
                              <li>
                                 <p><a href="../lnpls/static-sql.html#LNPLS00608" target="_blank"><span><cite>Oracle Database PL / SQL语言参考</cite></span></a> ，了解事务处理和控制</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="CNCPT88958"></a><a id="CNCPT88957"></a><div class="props_rev_3"><a id="GUID-07517D95-D5F9-4851-B737-B076336CED13" name="GUID-07517D95-D5F9-4851-B737-B076336CED13"></a><h5 id="CNCPT-GUID-07517D95-D5F9-4851-B737-B076336CED13" class="sect5">排队交易</h5>
                     <div>
                        <p>根据方案，在回滚到保存点后，仍可能阻止等待先前锁定的资源的事务。</p>
                        <p>当事务被另一个事务阻塞时，它会在阻塞事务本身上排队，因此整个阻塞事务必须提交或回滚以阻止事务继续。</p>
                        <p>在下表所示的方案中，会话1回滚到在执行DML语句之前创建的保存点。但是，会话2仍然被阻止，因为它正在等待会话1事务完成。</p>
                        <div class="tblformalwide" id="GUID-07517D95-D5F9-4851-B737-B076336CED13__CHDGIIFB">
                           <p class="titleintable">表10-3回滚到保存点示例</p>
                           <table cellpadding="4" cellspacing="0" class="FormalWide" title="回滚到Savepoint示例" width="100%" border="1" summary="This table shows an extended example showing a rollback to savepoint." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="5%" id="d53698e4573">Ť</th>
                                    <th align="left" valign="bottom" width="24%" id="d53698e4576">第1节</th>
                                    <th align="left" valign="bottom" width="24%" id="d53698e4579">第二节</th>
                                    <th align="left" valign="bottom" width="24%" id="d53698e4582">第3节</th>
                                    <th align="left" valign="bottom" width="22%" id="d53698e4585">说明</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="5%" id="d53698e4590" headers="d53698e4573 ">
                                       <p>T0</p>
                                    </td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4590 d53698e4576 "><pre class="oac_no_warn" dir="ltr">UPDATE员工SET薪水= 7000 WHERE last_name ='Banda';</pre></td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4590 d53698e4579 "> </td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4590 d53698e4582 "> </td>
                                    <td align="left" valign="top" width="22%" headers="d53698e4590 d53698e4585 ">
                                       <p>会话1开始交易。会话在<code class="codeph">Banda</code>行（TX）上放置一个独占锁，并在表上放置一个子外置表锁（SX）。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="5%" id="d53698e4605" headers="d53698e4573 ">
                                       <p>T1</p>
                                    </td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4605 d53698e4576 "><pre class="oac_no_warn" dir="ltr">SAVEPOINT after_banda_sal;</pre></td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4605 d53698e4579 "> </td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4605 d53698e4582 "> </td>
                                    <td align="left" valign="top" width="22%" headers="d53698e4605 d53698e4585 ">
                                       <p>会话1创建名为<code class="codeph">after_banda_sal</code>的保存点。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="5%" id="d53698e4620" headers="d53698e4573 ">
                                       <p>T2</p>
                                    </td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4620 d53698e4576 "><pre class="oac_no_warn" dir="ltr">UPDATE员工SET薪水= 12000 WHERE last_name ='Greene';</pre></td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4620 d53698e4579 "> </td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4620 d53698e4582 "> </td>
                                    <td align="left" valign="top" width="22%" headers="d53698e4620 d53698e4585 ">
                                       <p>会话1锁定<code class="codeph">Greene</code>行。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="5%" id="d53698e4635" headers="d53698e4573 ">
                                       <p>T3</p>
                                    </td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4635 d53698e4576 "> </td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4635 d53698e4579 "><pre class="oac_no_warn" dir="ltr">UPDATE员工SET薪水= 14000 WHERE last_name ='Greene';</pre></td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4635 d53698e4582 "> </td>
                                    <td align="left" valign="top" width="22%" headers="d53698e4635 d53698e4585 ">
                                       <p>会话2尝试更新<code class="codeph">Greene</code>行，但无法获取锁定，因为会话1在此行上有锁定。第2节没有开始交易。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="5%" id="d53698e4650" headers="d53698e4573 ">
                                       <p>T4</p>
                                    </td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4650 d53698e4576 "><pre class="oac_no_warn" dir="ltr">ROLLBACK TO SAVEPOINT after_banda_sal;</pre></td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4650 d53698e4579 "> </td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4650 d53698e4582 "> </td>
                                    <td align="left" valign="top" width="22%" headers="d53698e4650 d53698e4585 ">
                                       <p>会话1个回滚更新到工资<code class="codeph">Greene</code> ，释放用于行锁定<code class="codeph">Greene</code> 。在t0获取的表锁未释放。
                                       </p>
                                       <p>此时，会话2 <span class="italic">仍然</span>被会话1阻止，因为会话2在会话1 <span class="italic">事务</span>上排队，该<span class="italic">事务</span>尚未完成。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="5%" id="d53698e4676" headers="d53698e4573 ">
                                       <p>T5</p>
                                    </td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4676 d53698e4576 "> </td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4676 d53698e4579 "> </td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4676 d53698e4582 "><pre class="oac_no_warn" dir="ltr">UPDATE员工SET薪水= 11000 WHERE last_name ='Greene';</pre></td>
                                    <td align="left" valign="top" width="22%" headers="d53698e4676 d53698e4585 ">
                                       <p><code class="codeph">Greene</code>行目前已解锁，因此会话3获取了对<code class="codeph">Greene</code>行更新的锁定。此语句在会话3中开始事务。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="5%" id="d53698e4694" headers="d53698e4573 ">
                                       <p>T6</p>
                                    </td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4694 d53698e4576 "><pre class="oac_no_warn" dir="ltr">承诺;</pre></td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4694 d53698e4579 "> </td>
                                    <td align="left" valign="top" width="24%" headers="d53698e4694 d53698e4582 "> </td>
                                    <td align="left" valign="top" width="22%" headers="d53698e4694 d53698e4585 ">
                                       <p>第1节提交，结束其交易。第2节现已加入，以更新第3节交易背后的<code class="codeph">Greene</code>行。
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <div class="infoboxnotealso" id="GUID-07517D95-D5F9-4851-B737-B076336CED13__GUID-4082A562-5884-4A65-BDD6-49719B340308">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="data-concurrency-and-consistency.html#GUID-DB33AD91-8A4E-44CE-A6B2-654909143E5F" title="当某些事件发生时，Oracle数据库会自动释放锁，以便事务不再需要该资源。">锁定持续时间</a> ”</span>以了解有关Oracle数据库何时发布锁定的更多信息</p>
                        </div>
                     </div>
                  </div>
               </div><a id="CNCPT1120"></a><div class="props_rev_3"><a id="GUID-C289D507-93F1-412E-8AAC-C9B758212CEC" name="GUID-C289D507-93F1-412E-8AAC-C9B758212CEC"></a><h4 id="CNCPT-GUID-C289D507-93F1-412E-8AAC-C9B758212CEC" class="sect4">回滚交易</h4>
                  <div>
                     <p>回滚未提交的事务将撤消对事务中SQL语句执行的数据的任何更改。</p>
                     <p>回滚事务后，事务中完成的工作的效果不再存在。在回滚整个事务而不引用任何保存点时，Oracle数据库执行以下操作：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>通过使用相应的撤消段撤消事务中所有SQL语句所做的所有更改</p>
                           <p>每个活动事务的事务表条目包含指向事务的所有撤消数据（与应用程序的相反顺序）的指针。数据库从撤消段读取数据，反转操作，然后将撤消条目标记为已应用。因此，如果事务插入一行，则回滚将删除它。如果事务更新了一行，则回滚会反转更新。如果事务删除了一行，则回滚会重新插入它。在<a href="transactions.html#GUID-5BB15405-8A03-47DE-8A20-63E1B83E1361__CHDCIJGA" title="此表显示了一个会话，说明了事务控制的基本概念。">表10-1中</a> ， <code class="codeph">ROLLBACK</code>反转了Greene和Banda工资的更新。
                           </p>
                        </li>
                        <li>
                           <p>释放事务持有的所有数据锁</p>
                        </li>
                        <li>
                           <p>擦除事务中的所有保存点</p>
                           <p>在<a href="transactions.html#GUID-5BB15405-8A03-47DE-8A20-63E1B83E1361__CHDCIJGA" title="此表显示了一个会话，说明了事务控制的基本概念。">表10-1中</a> ， <code class="codeph">ROLLBACK</code>删除保存点<code class="codeph">after_banda_sal</code> 。<code class="codeph">ROLLBACK TO SAVEPOINT</code>语句删除了<code class="codeph">after_greene_sal</code>保存点。
                           </p>
                        </li>
                        <li>
                           <p>结束交易</p>
                           <p>在<a href="transactions.html#GUID-5BB15405-8A03-47DE-8A20-63E1B83E1361__CHDCIJGA" title="此表显示了一个会话，说明了事务控制的基本概念。">表10-1中</a> ， <code class="codeph">ROLLBACK</code>使数据库处于与执行初始<code class="codeph">COMMIT</code>之后相同的状态。
                           </p>
                        </li>
                     </ul>
                     <p>回滚的持续时间是修改数据量的函数。</p>
                     <div class="infoboxnotealso" id="GUID-C289D507-93F1-412E-8AAC-C9B758212CEC__GUID-62DA8A3D-986C-4F05-BBDF-72E42830532E">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="logical-storage-structures.html#GUID-6E206D3A-E0E7-4B23-9C41-516FB35BC3FE" title="Oracle数据库维护事务操作的记录，统称为撤消数据。">撤消细分</a> ”</span></p>
                           </li>
                           <li>
                              <p><a href="../sqlrf/ROLLBACK.html#GUID-94551F0C-A47F-43DE-BC68-9B1C1ED38C93" target="_blank"><span><cite>Oracle Database SQL语言参考</cite></span></a> ，了解<code class="codeph">ROLLBACK</code>命令</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="CNCPT1119"></a><div class="props_rev_3"><a id="GUID-C3FE1082-94AA-4BE8-98F2-480205D99DCA" name="GUID-C3FE1082-94AA-4BE8-98F2-480205D99DCA"></a><h4 id="CNCPT-GUID-C3FE1082-94AA-4BE8-98F2-480205D99DCA" class="sect4">交易提交</h4>
                  <div>
                     <p>提交结束当前事务，并在事务中执行永久性所有更改。</p>
                     <p>在<a href="transactions.html#GUID-5BB15405-8A03-47DE-8A20-63E1B83E1361__CHDCIJGA" title="此表显示了一个会话，说明了事务控制的基本概念。">表10-1中</a> ，第二个事务以<code class="codeph">sal_update2</code>开头，以显式<code class="codeph">COMMIT</code>语句结束。现在，两个<code class="codeph">UPDATE</code>语句产生的更改是永久性的。
                     </p>
                     <p>事务提交时，会发生以下操作：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>数据库为<code class="codeph">COMMIT</code>生成SCN。</p>
                           <p>事务已提交的关联<a href="glossary.html#GUID-78A7FBF2-2EB5-4BD6-AECC-D61A5AEF1158"><span class="xrefglossterm">撤消表空间</span></a>的内部事务表记录。事务的相应唯一SCN被分配并记录在事务表中。
                           </p>
                        </li>
                        <li>
                           <p><a href="glossary.html#GUID-E96BC851-0B78-4250-8EAB-26EBDF4FE5A6"><span class="xrefglossterm">日志写入器进程（LGWR）</span></a>进程将重做日志缓冲区中的剩余重做日志条目写入联机重做日志，并将事务SCN写入联机重做日志。<span class="italic">此原子事件构成事务的提交。</span></p>
                        </li>
                        <li>
                           <p>Oracle数据库发布了行和表上的锁。</p>
                           <p>排队等待未提交事务持有的锁的用户可以继续他们的工作。</p>
                        </li>
                        <li>
                           <p>Oracle数据库删除保存点。</p>
                           <p>在<a href="transactions.html#GUID-5BB15405-8A03-47DE-8A20-63E1B83E1361__CHDCIJGA" title="此表显示了一个会话，说明了事务控制的基本概念。">表10-1中</a> ， <code class="codeph">sal_update</code>事务中不存在保存点，因此没有擦除保存点。
                           </p>
                        </li>
                        <li>
                           <p>Oracle数据库执行<a href="glossary.html#GUID-5E20E19B-FC72-40E3-A129-306B52DC9607"><span class="xrefglossterm">提交清除</span></a> 。
                           </p>
                           <p>如果包含来自已提交事务的数据的已修改块仍在SGA中，并且如果没有其他会话正在修改它们，则数据库将从块中删除与锁相关的事务信息（ITL条目）。</p>
                           <p>理想情况下， <code class="codeph">COMMIT</code>清除块，以便后续的<code class="codeph">SELECT</code>不必执行此任务。如果特定行没有ITL条目，则不会锁定它。如果特定行存在ITL条目，则它可能已锁定，因此会话必须检查还原段标头以确定此感兴趣的事务是否已提交。如果感兴趣的事务已提交，则会话清除该块，生成重做。但是，如果<code class="codeph">COMMIT</code>先前清理了ITL，则不需要检查和清除。
                           </p>
                           <div class="infoboxnote" id="GUID-C3FE1082-94AA-4BE8-98F2-480205D99DCA__GUID-26D30903-DFCE-48DD-BA67-9895B3BFB233">
                              <p class="notep1">注意：</p>
                              <p>由于块清除会生成重做，因此查询可能会生成重做，从而导致在下一个<a href="glossary.html#GUID-95DBDA37-4C57-444F-B660-D52B4A99D919"><span class="xrefglossterm">检查点</span></a>期间写入块。
                              </p>
                           </div>
                        </li>
                        <li>
                           <p>Oracle数据库标记事务已完成。</p>
                        </li>
                     </ul>
                     <p>提交事务后，用户可以查看更改。</p>
                     <p>通常，无论事务大小如何，提交都是快速操作。提交的速度不会随着事务中修改的数据大小而增加。提交的最长部分是LGWR执行的物理磁盘I / O.但是，LGWR花费的时间减少了，因为它已经在后台逐步写入重做日志缓冲区的内容。</p>
                     <p>默认行为是LGWR同步将重做写入联机重做日志，并且在将提交返回给用户之前，事务等待缓冲的重做在磁盘上。但是，对于较低的事务提交延迟，应用程序开发人员可以指定重做异步写入，以便事务不需要等待重做在磁盘上并且可以立即从<code class="codeph">COMMIT</code>调用返回。
                     </p>
                     <div class="infoboxnotealso" id="GUID-C3FE1082-94AA-4BE8-98F2-480205D99DCA__GUID-5FA0B3EF-8402-42EF-9FDB-676602149DDF">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“可<a href="data-concurrency-and-consistency.html#GUID-8DA9A191-4CA3-4B1A-995F-4B17471C2738" title="在可序列化隔离级别中，事务只能看到在事务而非查询开始时提交的更改以及事务本身所做的更改。">序列化隔离级别</a> ”</span></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="data-concurrency-and-consistency.html#GUID-AD960556-7F7B-4242-8B91-6DA22AABA27D" title="通常，多用户数据库使用某种形式的数据锁定来解决与数据并发性，一致性和完整性相关的问题。">锁定机制</a> ”</span></p>
                           </li>
                           <li>
                              <p>有关LGWR的更多信息，请参阅<span class="q">“ <a href="process-architecture.html#GUID-D8AE1B78-69D5-4F0F-8BE3-C91AA2514F2D" title="后台进程是多进程Oracle数据库使用的其他进程。后台进程执行操作数据库所需的维护任务，并最大限度地提高多个用户的性能。">后台进程概述</a> ”</span></p>
                           </li>
                           <li>
                              <p>有关异步提交的更多信息，请<a href="../lnpls/static-sql.html#LNPLS592" target="_blank"><span><cite>参见Oracle Database PL / SQL包和类型参考</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div><a id="CNCPT89217"></a><div class="props_rev_3"><a id="GUID-47BCD081-8FFF-4D13-A0B1-F531521BC6C3" name="GUID-47BCD081-8FFF-4D13-A0B1-F531521BC6C3"></a><h3 id="CNCPT-GUID-47BCD081-8FFF-4D13-A0B1-F531521BC6C3" class="sect3">交易保护概述</h3>
               <div>
                  <p><strong class="term">Transaction Guard</strong>是一种API，应用程序可以使用它来提供<strong class="term">事务幂等性</strong> ，这是数据库保留保证提交结果的能力，该结果指示事务是否已提交和完成。Oracle数据库为JDBC瘦，OCI，OCCI和ODP.Net提供API。</p>
                  <p><a href="glossary.html#GUID-2F7DE61F-BD7C-4A89-91E6-CE0D193E8294"><span class="xrefglossterm">可恢复的错误</span></a>是由外部系统故障引起的，与正在执行的应用程序会话逻辑无关。在前台进程，网络，节点，存储和数据库的计划内和计划外中断之后发生可恢复的错误。如果中断中断了客户端应用程序与数据库之间的连接，则应用程序会收到断开连接错误消息。连接中断时运行的事务称为正在进行的<a href="glossary.html#GUID-4A49C543-CD3B-4F01-BF01-21F15CEABEE1"><span class="xrefglossterm">事务</span></a> 。
                  </p>
                  <p>要决定是重新提交事务还是将结果（已提交或未提交）返回给客户端，应用程序必须确定正在进行的事务的结果。在<span>Oracle Database 12c</span>之前，返回到客户端的提交消息不是持久的。检查事务并不能保证它在检查后不会提交，允许重复事务和其他形式的逻辑损坏。例如，用户可能在网上购买图书时刷新网络浏览器，并为同一本书收取两次费用。
                  </p>
                  <div class="infoboxnotealso" id="GUID-47BCD081-8FFF-4D13-A0B1-F531521BC6C3__GUID-43A398FD-1438-4ADC-90BF-9293420ADFFC">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="q">“ <a href="transactions.html#GUID-31319EA7-994C-4D25-8814-0214ABD3CBDA" title="事务是包含一个或多个SQL语句的逻辑原子工作单元。">交易简介</a> ”</span></p>
                        </li>
                        <li>
                           <p><a href="../adfns/transaction-guard.html#ADFNS1062" target="_blank"><span><cite>Oracle数据库开发指南</cite></span></a> ，了解Transaction Guard</p>
                        </li>
                        <li>
                           <p><a href="../racad/ensuring-application-continuity.html#RACAD8423" target="_blank"><span><cite>“Oracle Real Application Clusters管理和部署指南”</cite></span></a> ，了解如何为Transaction Guard配置服务</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="CNCPT89319"></a><div class="props_rev_3"><a id="GUID-DDABC6A2-4CFC-4934-8294-BC44772BC5BC" name="GUID-DDABC6A2-4CFC-4934-8294-BC44772BC5BC"></a><h4 id="CNCPT-GUID-DDABC6A2-4CFC-4934-8294-BC44772BC5BC" class="sect4">交易卫士的好处</h4>
                  <div>
                     <p>从<span>Oracle Database 12c开始</span> ，Transaction Guard为应用程序提供了一个工具，用于确定可恢复中断后的正在进行的事务的状态。
                     </p>
                     <p>使用Transaction Guard，应用程序可以确保事务执行不超过一次。例如，如果在线书店应用程序确定先前提交的提交失败，则应用程序可以安全地重新提交。</p>
                     <p>Transaction Guard为最多一次执行提供了一个工具，以避免应用程序执行重复提交。Transaction Guard为每笔交易提供已知结果。</p>
                     <p>Transaction Guard是Oracle数据库的核心功能。应用程序连续性在屏蔽最终用户的中断时使用Transaction Guard。如果没有Transaction Guard，应用程序在发生错误后重试可能会导致重复的事务被提交。</p>
                     <div class="infoboxnotealso" id="GUID-DDABC6A2-4CFC-4934-8294-BC44772BC5BC__GUID-38F71CC2-49CD-4EF0-B459-2755C76B2724">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="transactions.html#GUID-0B463F72-73C9-4EB6-B98D-5EC828CDB1E7" title="应用程序连续性尝试通过在计划外和计划中断后重放未完成的应用程序请求来屏蔽应用程序中断。在此上下文中，请求是应用程序的工作单元。">应用程序连续性概述</a> ”</span>了解Application Continuity，它与Transaction Guard配合使用，帮助开发人员实现高应用程序可用性</p>
                           </li>
                           <li>
                              <p><a href="../adfns/high-availability.html#ADFNS924" target="_blank"><span><cite>Oracle数据库开发指南</cite></span></a> ，了解Transaction Guard，包括支持和包含的事务的类型</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="CNCPT89320"></a><div class="props_rev_3"><a id="GUID-BB758CA1-B046-463E-969F-69C3E87E5DAF" name="GUID-BB758CA1-B046-463E-969F-69C3E87E5DAF"></a><h4 id="CNCPT-GUID-BB758CA1-B046-463E-969F-69C3E87E5DAF" class="sect4">交易卫士如何运作</h4>
                  <div>
                     <p>本节介绍了丢失提交消息的问题以及Transaction Guard如何使用逻辑事务ID来解决问题。</p>
                  </div><a id="CNCPT89219"></a><a id="CNCPT89218"></a><div class="props_rev_3"><a id="GUID-E567DC50-32EC-440E-9352-18E8AD79340B" name="GUID-E567DC50-32EC-440E-9352-18E8AD79340B"></a><h5 id="CNCPT-GUID-E567DC50-32EC-440E-9352-18E8AD79340B" class="sect5">丢失提交消息</h5>
                     <div>
                        <p>在设计幂等性时，开发人员必须在提交commit语句后解决通信失败的问题。提交消息不会在数据库中保留，因此在发生故障后无法检索。</p>
                        <p>下图是客户端应用程序与数据库之间交互的高级表示。</p>
                        <div class="figure" id="GUID-E567DC50-32EC-440E-9352-18E8AD79340B__CIHEHJGB">
                           <p class="titleinfigure">图10-2丢失提交消息</p><img src="img/cncpt356.png" alt="下面是图10-2的描述" title="下面是图10-2的描述" longdesc="img_text/cncpt356.html"><br><a href="img_text/cncpt356.html">“图10-2丢失提交消息”的描述</a></div>
                        <!-- class="figure" -->
                        <p>在标准提交案例中，数据库提交事务并将成功消息返回给客户端。在<a href="transactions.html#GUID-E567DC50-32EC-440E-9352-18E8AD79340B__CIHEHJGB">图10-2中</a> ，客户端提交commit语句并收到一条消息，指出通信失败。出于多种原因可能会发生此类故障，包括数据库实例故障或网络中断。在这种情况下，客户端不知道事务的状态。
                        </p>
                        <p>通信失败后，数据库可能仍在运行提交，并且不知道客户端已断开连接。检查事务状态并不能保证在检查后不会提交活动事务。如果客户端由于此过时信息而重新发送提交，则数据库可能会重复该事务，从而导致逻辑损坏。</p>
                     </div>
                  </div><a id="CNCPT89220"></a><div class="props_rev_3"><a id="GUID-10F207C2-C59A-4707-A9A0-BDA3B19DE8D3" name="GUID-10F207C2-C59A-4707-A9A0-BDA3B19DE8D3"></a><h5 id="CNCPT-GUID-10F207C2-C59A-4707-A9A0-BDA3B19DE8D3" class="sect5">逻辑交易ID</h5>
                     <div>
                        <p>Oracle数据库通过使用称为<span class="bold">逻辑事务ID</span>的全局唯一标识符来解决通信故障。</p>
                        <p>此ID包含会话首次连接时分配的逻辑会话号，以及每次会话提交或回滚时更新的运行提交号。<a id="fn_1" name="fn_1" href="#fn_1" for="" oracle="" real="" application="" clusters="" (oracle="" rac),="" the="" logical="" transaction="" includes="" database="" instance="" number="" as="" a="" prefix=")" ="" onclick="footdisplay(1, "><sup>Foot 1</sup></a>从应用程序的角度来看，逻辑事务ID唯一地标识在失败的会话上提交的最后一个数据库事务。
                        </p>
                        <p>对于来自其中提交一个或多个事务的客户端的每次往返，数据库存储逻辑事务ID。对于每次提交数据的往返，此ID可以为应用程序和数据库之间的交互提供事务幂等性。</p>
                        <p>最多一次的协议允许数据库执行以下操作，从而允许访问提交结果：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>保持同意重试的保留期的逻辑事务ID</p>
                           </li>
                           <li>
                              <p>在提交时保留逻辑事务ID</p>
                           </li>
                        </ul>
                        <p>在事务正在运行时，数据库和客户端都保存逻辑事务ID。在从连接池借用时，以及在执行一个或多个提交操作的客户端驱动程序的每次往返时，数据库为客户端提供身份验证时的逻辑事务ID。</p>
                        <p>在应用程序可以确定可恢复错误之后的最后一个事务的结果之前，应用程序使用Java，OCI，OCCI或ODP.Net API获取在客户端保存的逻辑事务ID。然后，应用程序使用逻辑事务ID调用PL / SQL过程<code class="codeph">DBMS_APP_CONT.GET_LTXID_OUTCOME</code> ，以确定上次提交的结果：已提交（ <code class="codeph">true</code>或<code class="codeph">false</code> ）和用户调用已完成（ <code class="codeph">true</code>或<code class="codeph">false</code> ）。
                        </p>
                        <p>使用Transaction Guard时，应用程序可以在错误可恢复且会话中的最后一个事务未提交时重放事务。当最后一个事务已提交且用户调用已完成时，应用程序可以继续。应用程序可以使用Transaction Guard将已知结果返回给客户端，以便客户端可以决定下一步要采取的操作。</p>
                        <div class="infoboxnotealso" id="GUID-10F207C2-C59A-4707-A9A0-BDA3B19DE8D3__GUID-6116E843-6CE2-47FA-B081-0B0C4CCC5707">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../adfns/transaction-guard.html#ADFNS324" target="_blank"><span><cite>Oracle数据库开发指南</cite></span></a> ，了解逻辑事务ID</p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_APP_CONT.html#ARPLS73456" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解有关<code class="codeph">DBMS_APP_CONT.GET_LTXID_OUTCOME</code>过程的更多信息</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div><a id="CNCPT89221"></a><a id="CNCPT89321"></a><div class="props_rev_3"><a id="GUID-6AEE7250-D39B-4DB7-BF71-E2C1841BF598" name="GUID-6AEE7250-D39B-4DB7-BF71-E2C1841BF598"></a><h4 id="CNCPT-GUID-6AEE7250-D39B-4DB7-BF71-E2C1841BF598" class="sect4">交易警卫：示例</h4>
                  <div>
                     <p>在这种情况下，由于可恢复的错误，提交消息将丢失。</p>
                     <p>Transaction Guard使用逻辑事务ID来保留<code class="codeph">COMMIT</code>语句的结果，确保事务已知结果。
                     </p>
                     <div class="figure" id="GUID-6AEE7250-D39B-4DB7-BF71-E2C1841BF598__CIHGGHBA">
                        <p class="titleinfigure">图10-3检查逻辑事务状态</p><img src="img/cncpt365.png" alt="下面是图10-3的描述" title="下面是图10-3的描述" longdesc="img_text/cncpt365.html"><br><a href="img_text/cncpt365.html">“图10-3逻辑事务状态检查”的说明</a></div>
                     <!-- class="figure" -->
                     <p>在<a href="transactions.html#GUID-6AEE7250-D39B-4DB7-BF71-E2C1841BF598__CIHGGHBA">图10-3中</a> ，数据库通知应用程序提交的事务以及最后一次用户调用是否已完成。然后，应用程序可以将结果返回给最终用户。可能性是：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>如果提交的事务和用户调用已完成，则应用程序可以将结果返回给最终用户并继续。</p>
                        </li>
                        <li>
                           <p>如果事务已提交但用户调用未完成，则应用程序可以将结果返回给最终用户并发出警告。示例包括丢失的绑定或丢失的行数。某些应用程序依赖于额外信息，而其他应用程序则不依赖。</p>
                        </li>
                        <li>
                           <p>如果未提交用户调用，则应用程序可以将此信息返回给最终用户，或安全地重新提交。该协议是有保证的。当提交状态返回false时，将阻止上次提交提交。</p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-6AEE7250-D39B-4DB7-BF71-E2C1841BF598__GUID-C73C378A-C218-4717-9792-9EC257CE4A23">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../adfns/transaction-guard.html#ADFNS8000" target="_blank"><span><cite>Oracle数据库开发指南</cite></span></a> ，了解如何使用Transaction Guard</p>
                     </div>
                  </div>
               </div>
            </div><a id="CNCPT89322"></a><div class="props_rev_3"><a id="GUID-0B463F72-73C9-4EB6-B98D-5EC828CDB1E7" name="GUID-0B463F72-73C9-4EB6-B98D-5EC828CDB1E7"></a><h3 id="CNCPT-GUID-0B463F72-73C9-4EB6-B98D-5EC828CDB1E7" class="sect3">应用程序连续性概述</h3>
               <div>
                  <p><span class="bold">应用程序连续性</span>尝试通过在计划外和计划中断后重放未完成的应用程序请求来屏蔽应用程序中断。在此上下文中，请求是应用程序的工作单元。
                  </p>
                  <p>通常，请求对应于单个数据库连接上的单个Web请求的DML语句和其他数据库调用。通常，请求由在连接池中签出和签入数据库连接之间的调用划分。</p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="transactions.html#GUID-0B2F6AD0-92ED-431D-BEB6-10DFC3715FCC" title="开发人员面临的一个基本问题是如何屏蔽最终用户丢失的数据库会话。">应用程序连续性的好处</a></p>
                     </li>
                     <li>
                        <p><a href="transactions.html#GUID-2E973242-2B39-42FC-AA16-CD97B460B6D2" title="Application Continuity的关键组件是运行时，重新连接和重放。">应用程序连续性体系结构</a></p>
                     </li>
                  </ul>
               </div><a id="CNCPT89323"></a><div class="props_rev_3"><a id="GUID-0B2F6AD0-92ED-431D-BEB6-10DFC3715FCC" name="GUID-0B2F6AD0-92ED-431D-BEB6-10DFC3715FCC"></a><h4 id="CNCPT-GUID-0B2F6AD0-92ED-431D-BEB6-10DFC3715FCC" class="sect4">应用程序连续性的好处</h4>
                  <div>
                     <p>开发人员面临的一个基本问题是如何屏蔽最终用户丢失的数据库会话。</p>
                     <p>应用程序连续性尝试通过在任何组件中断数据库和客户端之间的对话时还原数据库会话来解决丢失的会话问题。还原的数据库会话包括所有状态，游标，变量以及存在时的最新事务。</p>
                  </div>
                  <div class="props_rev_3"><a id="GUID-C9064A61-CB65-463B-89D6-66AB18F55845" name="GUID-C9064A61-CB65-463B-89D6-66AB18F55845"></a><h5 id="CNCPT-GUID-C9064A61-CB65-463B-89D6-66AB18F55845" class="sect5">应用程序连续性的用例</h5>
                     <div>
                        <p>在典型的情况下，客户端已向数据库提交了请求，该请求已建立了事务和非事务状态。</p>
                        <p>客户端的状态保持最新状态，可能包括输入的数据，返回的数据以及缓存的数据和变量。但是，应用程序需要在其中运行的数据库会话状态将丢失。</p>
                        <p>如果客户端请求已启动一个或多个事务，则应用程序将面临以下可能性：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>如果提交<span class="italic">已经</span>发出，然后提交返回的消息给客户端不耐用。客户端不知道请求是否已提交，以及处于非事务处理状态的位置。
                              </p>
                           </li>
                           <li>
                              <p>如果提交<span class="italic">尚未</span>颁发，或者如果它发出，但没有执行，然后在飞行事务回滚，必须按正确的状态使用会话重新提交。
                              </p>
                           </li>
                        </ul>
                        <p>如果重播成功，则不会中断计划内和计划外中断的数据库用户服务。如果数据库检测到应用程序看到并可能对其执行操作的数据发生更改，则拒绝重放。当超出允许开始重播的时间，应用程序使用受限制的调用，或者应用程序已使用<code class="codeph">disableReplay</code>方法显式禁用重播时，不会尝试重播。
                        </p>
                        <div class="infoboxnotealso" id="GUID-C9064A61-CB65-463B-89D6-66AB18F55845__GUID-33A601A4-B4A2-4AA6-98D3-761603DB514E">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../racad/ensuring-application-continuity.html#GUID-70D9CDC4-0C86-432B-A04E-1618AF5C35A4" target="_blank"><span><cite>“Oracle Real Application Clusters管理和部署指南”，</cite></span></a>以了解有关Application Continuity如何适用于数据库会话的更多信息</p>
                        </div>
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-9D9947D6-99E9-4862-84A4-1D8676695BC6" name="GUID-9D9947D6-99E9-4862-84A4-1D8676695BC6"></a><h5 id="CNCPT-GUID-9D9947D6-99E9-4862-84A4-1D8676695BC6" class="sect5">计划维护的应用程序连续性</h5>
                     <div>
                        <p>针对计划中断的应用程序连续性使应用程序能够继续对可以可靠地耗尽或迁移的数据库会话进行操作。</p>
                        <p>预定维护不需要中断应用程序工作。应用程序连续性提供了从当前位置流向当前不受维护影响的新位置的有效工作时间。在排放间隔结束时，会话可以保留在计划维护的数据库实例上。应用程序连续性可以将这些会话故障转移到正常运行的站点，而不是强制断开这些会话，并重新提交任何正在进行的事务。</p>
                        <p>启用应用程序连续性后，数据库可以执行以下操作：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>在维护期间报告传入或现有工作没有错误</p>
                           </li>
                           <li>
                              <p>将活动数据库会话重定向到其他功能服务</p>
                           </li>
                           <li>
                              <p>在维护期间和之后根据需要重新平衡数据库会话</p>
                           </li>
                        </ul>
                        <p>使用SRVCTL实用程序，全局数据服务控制实用程序（GDSCTL）和Oracle Data Guard Broker的<code class="codeph">drain_timeout</code>和<code class="codeph">stop_option</code>服务属性控制计划维护期间的排放行为。<code class="codeph">DBMS_SERVICE</code>包提供底层基础结构。
                        </p>
                        <div class="infoboxnotealso" id="GUID-9D9947D6-99E9-4862-84A4-1D8676695BC6__GUID-33A601A4-B4A2-4AA6-98D3-761603DB514E">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../racad/ensuring-application-continuity.html#GUID-BD699AEB-9F85-42A8-8687-5A979918938D" target="_blank"><span><cite>“Oracle Real Application Clusters管理和部署指南”</cite></span></a>了解更多应用程序连续性</p>
                              </li>
                              <li>
                                 <p><a href="../arpls/index.html" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以了解有关<code class="codeph">DBMS_SERVICE</code>更多信息</p>
                              </li>
                              <li>
                                 <p>用于SRVCTL命令参考的<a href="../racad/server-control-utility-reference.html#RACAD-GUID-C2D37BAB-DA98-49B4-A777-F2B3AA8D2E7A" target="_blank"><span><cite>Oracle Real Application Clusters管理和部署指南</cite></span></a></p>
                              </li>
                              <li>
                                 <p>用于GDSCTL命令参考的<a href="../gsmug/global-data-services-config.html#GSMUG-GUID-77AC1ABB-9401-4ECB-B31D-60C46D405595" target="_blank"><span><cite>Oracle数据库全局数据服务概念和管理指南</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div><a id="CNCPT89325"></a><a id="CNCPT89324"></a><div class="props_rev_3"><a id="GUID-2E973242-2B39-42FC-AA16-CD97B460B6D2" name="GUID-2E973242-2B39-42FC-AA16-CD97B460B6D2"></a><h4 id="CNCPT-GUID-2E973242-2B39-42FC-AA16-CD97B460B6D2" class="sect4">应用程序连续性体系结构</h4>
                  <div>
                     <p>Application Continuity的关键组件是运行时，重新连接和重放。</p>
                     <p>阶段如下：</p>
                     <ol>
                        <li>
                           <p>正常运行时</p>
                           <p>在此阶段，Application Continuity执行以下任务：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>标识数据库请求</p>
                              </li>
                              <li>
                                 <p>确定本地和数据库调用是否可重放</p>
                              </li>
                              <li>
                                 <p>构建代理对象以在必要时启用重播并管理队列</p>
                              </li>
                              <li>
                                 <p>保持原始调用和这些调用的验证，直到数据库请求或重放结束被禁用</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>重新连接</p>
                           <p>此阶段由可恢复的错误触发。应用程序连续性执行以下任务：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>确保为数据库请求启用重播</p>
                              </li>
                              <li>
                                 <p>管理超时</p>
                              </li>
                              <li>
                                 <p>获得与数据库的新连接，然后验证这是否是有效的数据库目标</p>
                              </li>
                              <li>
                                 <p>使用Transaction Guard确定最后一个事务是否成功提交（未重新提交已提交的事务）</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>重播</p>
                           <p>应用程序连续性执行以下任务：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>重播队列中保存的呼叫</p>
                              </li>
                              <li>
                                 <p>如果在重放期间出现用户可见的结果更改，则禁用重播</p>
                              </li>
                              <li>
                                 <p>不允许提交，但允许最后一次调用（遇到错误）提交</p>
                              </li>
                           </ul>
                        </li>
                     </ol>
                     <p>成功重播后，请求将从故障点继续。</p>
                     <div class="infoboxnotealso" id="GUID-2E973242-2B39-42FC-AA16-CD97B460B6D2__GUID-FEF124B5-3D23-4397-B025-393E3F4127A5">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="transactions.html#GUID-47BCD081-8FFF-4D13-A0B1-F531521BC6C3" title="Transaction Guard是一种API，应用程序可以使用它来提供事务幂等性，这是数据库保留保证提交结果的能力，该结果指示事务是否已提交和完成。Oracle数据库为JDBC瘦，OCI，OCCI和ODP.Net提供API。">交易警卫概述</a> ”</span></p>
                           </li>
                           <li>
                              <p><a href="../racad/ensuring-application-continuity.html#GUID-91427DA2-2C5F-46E9-93D4-B5FF6427A69B" target="_blank"><span><cite>“Oracle Real Application Clusters管理和部署指南”</cite></span></a>以了解有关应用程序连续性的更多信息</p>
                           </li>
                           <li>
                              <p><a href="../jjdbc/application-continuity.html#JJDBC29059" target="_blank"><span class="italic">Oracle数据库JDBC开发人员指南</span></a>和<a href="../jajdb/index.html" target="_blank"><span class="italic">Oracle数据库JDBC Java API参考，</span></a>以了解有关JDBC和应用程序连续性的更多信息</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div><a id="CNCPT88959"></a><a id="CNCPT417"></a><div class="props_rev_3"><a id="GUID-C0C61571-5175-400D-AEFC-FDBFE4F87188" name="GUID-C0C61571-5175-400D-AEFC-FDBFE4F87188"></a><h3 id="CNCPT-GUID-C0C61571-5175-400D-AEFC-FDBFE4F87188" class="sect3">自治交易概述</h3>
               <div>
                  <p><span class="bold">自治事务</span>是可以从另一个事务调用的独立事务，该事务是主事务。您可以挂起调用事务，执行SQL操作并在自治事务中提交或撤消它们，然后恢复调用事务。
                  </p>
                  <p>无论调用事务是提交还是回滚，自治事务对于必须独立执行的操作都很有用。例如，在股票购买交易中，无论整体股票购买是否通过，您都希望提交客户数据。此外，即使整个事务回滚，您也希望将错误消息记录到调试表中。</p>
                  <p>自治交易具有以下特征：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>自治事务不会看到主事务所做的未提交的更改，也不会与主事务共享锁或资源。</p>
                     </li>
                     <li>
                        <p>在提交自治事务时，自治事务中的更改对其他事务是可见的。因此，用户可以访问更新的信息而无需等待主事务提交。</p>
                     </li>
                     <li>
                        <p>自治事务可以启动其他自治事务。除资源限制外，没有限制可以调用多少级别的自治事务。</p>
                     </li>
                  </ul>
                  <p>在PL / SQL中，自治事务在<span class="italic">自治范围内</span>执行，该<span class="italic">范围</span>是用编译指示<code class="codeph">AUTONOMOUS_TRANSACTION</code>标记的例程。在此上下文中，例程包括顶级匿名PL / SQL块和PL / SQL子程序和触发器。<a href="glossary.html#GUID-0ED5CC20-407D-42A1-AF92-8816691861DE"><span class="xrefglossterm">pragma</span></a>是一个指令，指示编译器执行编译选项。编译指示<code class="codeph">AUTONOMOUS_TRANSACTION</code>指示数据库该程序在执行时将作为独立于其父事务的新自治事务执行。
                  </p>
                  <p>下图显示了控制如何从主例程（MT）流向自治例程再返回。主程序是<code class="codeph">proc1</code> ，自治程序是<code class="codeph">proc2</code> 。在控制返回主例程之前，自治例程可以提交多个事务（AT1和AT2）。
                  </p>
                  <div class="figure" id="GUID-C0C61571-5175-400D-AEFC-FDBFE4F87188__CHDDGDCJ">
                     <p class="titleinfigure">图10-4事务控制流程</p><img src="img/cncpt288.gif" alt="下面是图10-4的描述" title="下面是图10-4的描述" longdesc="img_text/cncpt288.html"><br><a href="img_text/cncpt288.html">“图10-4交易控制流程”的描述</a></div>
                  <!-- class="figure" -->
                  <p>当您输入自治例程的可执行部分时，主例程将暂停。退出自治例程时，主例程将恢复。</p>
                  <p>在<a href="transactions.html#GUID-C0C61571-5175-400D-AEFC-FDBFE4F87188__CHDDGDCJ">图10-4中</a> ， <code class="codeph">proc1</code>内部的<code class="codeph">COMMIT</code>不仅使其永久工作，而且在其会话中执行任何未完成的工作。但是， <code class="codeph">proc2</code>的<code class="codeph">COMMIT</code>仅使<code class="codeph">proc2</code>事务中执行的工作成为永久性。因此，事务AT1和AT2中的<code class="codeph">COMMIT</code>语句对MT事务没有影响。
                  </p>
                  <div class="infoboxnotealso" id="GUID-C0C61571-5175-400D-AEFC-FDBFE4F87188__GUID-63C487E4-2F98-469C-AB0F-032499AB7EC3">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="../adfns/sql-processing-for-application-developers.html#ADFNS00205" target="_blank"><span><cite>Oracle数据库开发指南</cite></span></a>和<a href="../lnpls/static-sql.html#LNPLS00609" target="_blank"><span><cite>Oracle数据库PL / SQL语言参考</cite></span></a> ，了解如何使用自治事务</p>
                  </div>
               </div>
            </div><a id="CNCPT1125"></a><div class="props_rev_3"><a id="GUID-47231512-4A3E-4E59-86BD-332E1FB88A88" name="GUID-47231512-4A3E-4E59-86BD-332E1FB88A88"></a><h3 id="CNCPT-GUID-47231512-4A3E-4E59-86BD-332E1FB88A88" class="sect3">分布式事务概述</h3>
               <div>
                  <p><strong class="term">分布式事务</strong>是包含一个或多个语句的事务，这些语句使用称为数据库链接的模式对象更新分布式数据库的两个或更多不同节点上的数据。
                  </p>
                  <p><a href="glossary.html#GUID-DB7296DF-74E0-45E1-9BC2-5052DD543214"><span class="xrefglossterm">分布式数据库</span></a>是分布式系统中的一组数据库，可以将应用程序显示为单个数据源。<a href="glossary.html#GUID-1C8C6E07-BE1F-4BC9-93C3-CF6D1D15DC42"><span class="xrefglossterm">数据库链接</span></a>描述了一个数据库实例如何登录到另一个数据库实例。
                  </p>
                  <p>与本地数据库上的事务不同，分布式事务会更改多个数据库上的数据。因此，分布式事务处理更复杂，因为数据库必须协调作为原子单元提交或回滚事务中的更改。整个事务必须提交或回滚。即使发生网络或系统故障，Oracle数据库也必须协调网络上的事务控制并保持数据一致性。</p>
                  <div class="infoboxnotealso" id="GUID-47231512-4A3E-4E59-86BD-332E1FB88A88__GUID-150122D2-6DFE-469A-88F4-FEAC2131BC02">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="../admin/distributed-transactions-concepts.html#ADMIN031" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a> ，了解如何管理分布式事务</p>
                  </div>
               </div><a id="CNCPT041"></a><div class="props_rev_3"><a id="GUID-0F0E4F21-1522-449C-9532-DD26AB9EECA1" name="GUID-0F0E4F21-1522-449C-9532-DD26AB9EECA1"></a><h4 id="CNCPT-GUID-0F0E4F21-1522-449C-9532-DD26AB9EECA1" class="sect4">两阶段提交</h4>
                  <div>
                     <p><strong class="term">两阶段提交机制</strong>保证参与分布式事务的<span class="italic">所有</span>数据库都提交或全部撤消事务中的语句。该机制还保护由完整性约束，远程过程调用和触发器执行的隐式DML。
                     </p>
                     <p>在多个数据库之间的两阶段提交中，一个数据库协调分布式事务。发起节点称为<span class="italic">全局协调器</span> 。协调员询问其他数据库是否准备提交。如果任何数据库以no响应，则回滚整个事务。如果所有数据库都投赞成票，则协调器广播消息以使每个数据库上的提交永久化。
                     </p>
                     <p>两阶段提交机制对发布分布式事务的用户是透明的。实际上，用户甚至不需要知道事务是分布式的。表示事务结束的<code class="codeph">COMMIT</code>语句会自动触发两阶段提交机制。在数据库应用程序的主体内包含分布式事务不需要编码或复杂语句语法。
                     </p>
                     <div class="infoboxnotealso" id="GUID-0F0E4F21-1522-449C-9532-DD26AB9EECA1__GUID-10839962-C13A-48BA-88DC-484BCE26E684">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="../admin/distributed-transactions-concepts.html#ADMIN12222" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a> ，了解两阶段提交机制</p>
                           </li>
                           <li>
                              <p><a href="../sqlrf/COMMIT.html#GUID-6CD5C9A7-54B9-4FA2-BA3C-D6B4492B9EE2" target="_blank"><span><cite>Oracle数据库SQL语言参考</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="CNCPT042"></a><div class="props_rev_3"><a id="GUID-20FEB719-8BB3-49C3-834E-E0FF156BB681" name="GUID-20FEB719-8BB3-49C3-834E-E0FF156BB681"></a><h4 id="CNCPT-GUID-20FEB719-8BB3-49C3-834E-E0FF156BB681" class="sect4">怀疑交易</h4>
                  <div>
                     <p>当两阶段提交被任何类型的系统或网络故障中断时，会发生<span class="bold">不确定的分布式事务</span> 。
                     </p>
                     <p>例如，两个数据库向协调数据库报告它们准备提交，但协调数据库实例在收到消息后立即失败。准备提交的两个数据库现在在等待结果通知时被挂起。</p>
                     <p>恢复器（ <code class="codeph">RECO</code> ）后台进程自动解决<code class="codeph">RECO</code>分布式事务的结果。修复故障并重新建立通信后，每个本地Oracle数据库的<code class="codeph">RECO</code>进程会自动在所有相关节点上一致地提交或回滚任何不确定的分布式事务。
                     </p>
                     <p>如果发生长期故障，Oracle数据库使每个本地管理员都可以手动提交或撤消因故障而存在疑问的任何分布式事务。此选项使本地数据库管理员可以释放由于长期故障而无限期保留的任何锁定资源。</p>
                     <p>如果必须将数据库恢复到过去的时间，则数据库恢复工具使其他站点的数据库管理员能够将其数据库返回到较早的时间点。此操作可确保全局数据库保持一致。</p>
                     <div class="infoboxnotealso" id="GUID-20FEB719-8BB3-49C3-834E-E0FF156BB681__GUID-8AD9A053-0233-458E-B9DD-5DA4F472EA20">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="process-architecture.html#GUID-9FF900D1-7DB8-4D41-8D34-8E99AF650CEC" title="在分布式数据库中，恢复程序进程（RECO）自动解决分布式事务中的故障。">Recoverer Process（RECO）</a> ”</span></p>
                           </li>
                           <li>
                              <p><a href="../admin/managing-distributed-transactions.html#ADMIN12252" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a> ，了解如何管理不确定的事务</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div>
            <hr><br><p style="text-decoration:underline">脚注图例</p>脚注1：<p>对于Oracle Real Application Clusters（Oracle RAC），逻辑事务ID包括数据库实例编号作为前缀。</p><br></div>
      </article>
   </body>
</html>