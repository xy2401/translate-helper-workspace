<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="This chapter explains how to use the DBMS_STATS.GATHER_*_STATS program units."></meta>
      <meta name="description" content="This chapter explains how to use the DBMS_STATS.GATHER_*_STATS program units."></meta>
      <title>收集优化程序统计信息</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="SQL Tuning Guide"></meta>
      <meta property="og:description" content="This chapter explains how to use the DBMS_STATS.GATHER_*_STATS program units."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="SQL Tuning Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="sql-tuning-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-31T14:57:08-08:00"></meta>
      <meta name="dcterms.title" content="SQL Tuning Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="2013, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96095-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="options-for-optimizer-statistics-gathering.html" title="Previous" type="text/html"></link>
      <link rel="next" href="managing-extended-statistics.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGSQL"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="options-for-optimizer-statistics-gathering.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="managing-extended-statistics.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL调优指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="optimizer-statistics.html" property="item" typeof="WebPage"><span property="name">优化器统计</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">收集优化程序统计信息</li>
            </ol>
            <a id="GUID-245F23B2-24AF-44D8-9F12-99FD1215E878" name="GUID-245F23B2-24AF-44D8-9F12-99FD1215E878"></a><a id="TGSQL389"></a>
            
            <h2 id="TGSQL-GUID-245F23B2-24AF-44D8-9F12-99FD1215E878" class="sect2"><span class="enumeration_chapter">13</span>收集优化程序统计信息</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍如何使用<code class="codeph">DBMS_STATS.GATHER_*_STATS</code>程序单元。
               </p>
               <p>本章包含以下主题：</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-F007E78A-9967-4921-8046-D8F59A9272B4">配置自动优化器统计信息收集</a><br>Oracle数据库可以自动收集优化器统计信息。
                  </li>
                  <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-374ACB86-2512-4658-9170-8505B3EACF7D">配置高频自动优化器统计信息收集</a><br>此轻量级任务补充了标准自动统计信息收集。
                  </li>
                  <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B">手动收集优化程序统计信息</a><br>作为自动统计信息收集的替代或补充，您可以使用<code class="codeph">DBMS_STATS</code>包手动收集优化程序统计信息。
                  </li>
                  <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31">手动收集系统统计信息</a><br>系统统计信息描述优化程序的硬件特征，例如I / O和CPU性能和利用率。
                  </li>
                  <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-4274A976-0185-4113-844F-1F818CD916CA">在报告模式下运行统计信息收集功能</a><br>您可以在报告模式下运行<code class="codeph">DBMS_STATS</code>统计信息收集过程。
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-245F23B2-24AF-44D8-9F12-99FD1215E878__GUID-665B8F0B-5D1A-43E1-ABA3-725E02DF4C33">
                  <p class="notep1">也可以看看：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><span class="q">“ <a href="optimizer-statistics-concepts.html#GUID-C0E74ACE-2706-48A1-97A2-33F52207166A" title="Oracle数据库优化器统计信息描述有关数据库及其对象的详细信息。">优化器统计概念</a> ”</span></p>
                     </li>
                     <li>
                        <p><span class="q">“ <a href="query-optimizer-concepts.html#GUID-06129ACE-36B2-4534-AE68-EDFCAEBB3B5D" title="本章描述了与查询优化器相关的最重要的概念，包括其主要组件。">查询优化器概念</a> ”</span></p>
                     </li>
                     <li>
                        <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-CA6A56B9-0540-45E9-B1D7-D78769B7714C" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_STATS.GATHER_TABLE_STATS</code></p>
                     </li>
                  </ul>
               </div>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="optimizer-statistics.html#GUID-0A2F3D52-A135-43E1-9CAB-55BFE068A297" title="执行计划的准确性取决于优化程序统计信息的质量。">优化程序统计信息</a></p>
                  </div>
               </div>
            </div>
            <a id="TGSQL395"></a><div class="props_rev_3"><a id="GUID-F007E78A-9967-4921-8046-D8F59A9272B4" name="GUID-F007E78A-9967-4921-8046-D8F59A9272B4"></a><h3 id="TGSQL-GUID-F007E78A-9967-4921-8046-D8F59A9272B4" class="sect3"><span class="enumeration_section">13.1</span>配置自动优化器统计信息收集</h3>
               <div>
                  <p>Oracle数据库可以自动收集优化器统计信息。</p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C">关于自动优化器统计信息收集</a><br>自动维护任务基础结构（称为AutoTask）计划在Oracle Scheduler窗口中自动运行的任务，称为维护窗口。
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-3D546E00-5DC0-4350-80F8-68205008FCEA">使用Cloud Control配置自动优化器统计信息收集</a><br>您可以使用Cloud Control启用和禁用所有自动维护任务，包括自动优化程序统计信息收集。
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C">从命令行配置自动优化器统计信息收集</a><br>如果不使用Cloud Control配置自动优化程序统计信息收集，则必须使用命令行。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-245F23B2-24AF-44D8-9F12-99FD1215E878" title="本章介绍如何使用DBMS_STATS.GATHER _ * _ STATS程序单元。">收集优化程序统计信息</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="props_rev_3"><a id="GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C" name="GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C"></a><h4 id="TGSQL-GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C" class="sect4"><span class="enumeration_section">13.1.1</span>关于自动优化器统计信息收集</h4>
                  <div>
                     <p>自动维护任务基础结构（称为AutoTask）计划在Oracle Scheduler窗口中自动运行的任务，称为维护窗口。</p>
                     <p>默认情况下，为一周中的每一天安排一个窗口。自动优化器统计信息收集作为AutoTask的一部分运行。默认情况下，集合在所有预定义的维护窗口中运行。</p>
                     <div class="infoboxnote" id="GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C__GUID-ACEA21D5-E9D3-4BA2-870D-BE3300013F53">
                        <p class="notep1">注意：</p>
                        <p>使用带可插拔数据库的自动优化程序统计信息收集时，数据可见性和权限要求可能不同。</p>
                     </div>
                     <p>要收集优化程序统计信息，数据库将调用一个内部过程，该过程的操作类似于<code class="codeph">GATHER_DATABASE_STATS</code>过程和<code class="codeph">GATHER AUTO</code>选项。自动统计信息收集符合数据库中设置的所有首选项。
                     </p>
                     <p>手动和自动收集之间的主要区别在于后者优先考虑需要统计的数据库对象。在维护窗口关闭之前，自动收集会评估所有对象并确定没有统计信息或非常旧统计信息的对象的优先级。</p>
                     <div class="infoboxnote" id="GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C__GUID-784706EE-7783-448A-B3A6-35D59EF97D6D">
                        <p class="notep1">注意：</p>
                        <p>手动收集统计信息时，可以使用<code class="codeph">DBMS_AUTO_TASK_IMMEDIATE</code>包重现自动收集的对象优先级。此程序包运行在自动夜间统计信息收集作业期间执行的相同统计信息收集作业。
                        </p>
                     </div>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C__GUID-5CA45A75-AEBE-4FF1-AA09-D16AD61938F1">
                        <p class="notep1">也可以看看：</p>
                        <p> <a href="../multi/administering-a-cdb-with-sql-plus.html#ADMIN13885" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a> ，其中总结了可管理性功能在容器数据库（CDB）中的工作方式</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="Oracle数据库可以自动收集优化器统计信息。">配置自动优化器统计信息收集</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL396"></a><div class="props_rev_3"><a id="GUID-3D546E00-5DC0-4350-80F8-68205008FCEA" name="GUID-3D546E00-5DC0-4350-80F8-68205008FCEA"></a><h4 id="TGSQL-GUID-3D546E00-5DC0-4350-80F8-68205008FCEA" class="sect4"><span class="enumeration_section">13.1.2</span>使用云控制配置自动优化器统计信息收集</h4>
                  <div>
                     <p>您可以使用Cloud Control启用和禁用所有自动维护任务，包括自动优化程序统计信息收集。</p>
                     <div class="section">
                        <p>默认窗口时序适用于大多数情况。但是，您可能会执行窗口期间发生的批量加载等操作。在这种情况下，为了避免因自动统计信息收集同时发生的操作而导致的潜在冲突，Oracle建议您相应地更改窗口。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-3D546E00-5DC0-4350-80F8-68205008FCEA__GUID-ADC48AC9-AF98-4398-A835-46AC86666207">先决条件</p>
                        <p>访问数据库主页，如<span class="q">“ <a href="options-for-optimizer-statistics-gathering.html#GUID-15511441-3164-4233-A0F8-54A8DF44AC6D" title="Oracle Enterprise Manager Cloud Control enables you to manage multiple databases within a single GUI-based framework.">在Cloud Control中访问数据库主页</a> ”中<a href="options-for-optimizer-statistics-gathering.html#GUID-15511441-3164-4233-A0F8-54A8DF44AC6D" title="Oracle Enterprise Manager Cloud Control使您可以在单个基于GUI的框架内管理多个数据库。">所述</a> 。</span></p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-3D546E00-5DC0-4350-80F8-68205008FCEA__GUID-2153DDB6-A13B-4993-B24D-DC474C2D18F6">要使用Cloud Control控制自动优化程序统计信息收集：</p>
                        <ol>
                           <li>
                              <p>从<span class="bold">Administration</span>菜单中，选择<span class="bold">Oracle Scheduler</span> ，然后选择<span class="bold">Automated Maintenance Tasks</span> 。
                              </p>
                              <p>将显示“自动维护任务”页面。</p>
                              <p>此页面显示预定义的任务。要检索有关每个任务的信息，请单击该任务的相应链接。</p>
                           </li>
                           <li>
                              <p>单击<span class="bold">配置</span> 。
                              </p>
                              <p>将显示“自动维护任务配置”页面。</p>
                              <p>默认情况下，自动优化程序统计信息收集在<code class="codeph">MAINTENANCE_WINDOW_GROUP</code>中的所有预定义维护窗口中执行。</p>
                           </li>
                           <li>
                              <p>执行以下步骤：</p>
                              <ol type="a">
                                 <li>
                                    <p>在“优化程序统计信息收集”的“任务设置”部分中，选择“已<span class="bold">启用”</span>或“ <span class="bold">已禁用”</span>以启用或禁用自动化任务。
                                    </p>
                                    <div class="infoboxnote" id="GUID-3D546E00-5DC0-4350-80F8-68205008FCEA__GUID-18208DB9-4038-49A9-BB1D-72CD2F1559F6">
                                       <p class="notep1">注意：</p>
                                       <p>Oracle强烈建议您不要禁用自动统计信息收集，因为优化程序为字典和用户对象的查询生成最佳计划至关重要。如果禁用自动收集，请确保您具有针对字典和用户架构的良好手动统计信息收集策略。</p>
                                    </div>
                                 </li>
                                 <li>
                                    <p>要禁用一周中特定日期的统计信息收集，请选中窗口名称旁边的相应框。</p>
                                 </li>
                                 <li>
                                    <p>要更改窗口组的特征，请单击“ <span class="bold">编辑窗口组”</span> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p>若要更改窗口的时间，请单击窗口的名称（例如， <span class="bold">MONDAY_WINDOW</span> ），然后在“计划”部分中单击“ <span class="bold">编辑”</span> 。
                                    </p>
                                    <p>将出现“编辑窗口”页面。</p>
                                    <div class="figure" id="GUID-3D546E00-5DC0-4350-80F8-68205008FCEA__GUID-8AE3F5E7-6AE1-433A-A1AA-48DE99791589"><img src="img/edit_window.jpg" alt="edit_window.jpg的描述如下" title="edit_window.jpg的描述如下" longdesc="img_text/edit_window.html"><br><a href="img_text/edit_window.html">插图描述edit_window.jpg</a></div>
                                    <!-- class="figure" -->
                                    <p>在此页面中，您可以更改窗口执行的持续时间和开始时间等参数。</p>
                                 </li>
                                 <li>
                                    <p>单击“ <span class="bold">应用”</span>
                                    </p>
                                 </li>
                              </ol>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section"></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-3D546E00-5DC0-4350-80F8-68205008FCEA__GUID-B6D8768F-CE59-4BD3-A5C9-7E1DA6D70FDC">
                        <p class="notep1">也可以看看：</p>
                        <p>Oracle企业管理器云控制的在线帮助</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="Oracle数据库可以自动收集优化器统计信息。">配置自动优化器统计信息收集</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL397"></a><div class="props_rev_3"><a id="GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C" name="GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C"></a><h4 id="TGSQL-GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C" class="sect4"><span class="enumeration_section">13.1.3</span>从命令行配置自动优化器统计信息收集</h4>
                  <div>
                     <p>如果不使用Cloud Control配置自动优化程序统计信息收集，则必须使用命令行。</p>
                     <div class="section">
                        <p>您有以下选择：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>在<code class="codeph">DBMS_AUTO_TASK_ADMIN</code> PL / SQL包中运行<code class="codeph">ENABLE</code>或<code class="codeph">DISABLE</code>过程。
                              </p>
                              <p>该软件包是推荐的命令行技术。对于<code class="codeph">ENABLE</code>和<code class="codeph">DISABLE</code>过程，您可以使用<code class="codeph">window_name</code>参数指定特定的维护窗口。
                              </p>
                           </li>
                           <li>
                              <p>将<code class="codeph">STATISTICS_LEVEL</code>初始化级别设置为<code class="codeph">BASIC</code>以禁用<span class="italic">所有</span>建议和统计信息的收集，包括Automatic SQL Tuning Advisor。
                              </p>
                              <div class="infoboxnote" id="GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C__GUID-65EEDF7F-64AC-4C22-9AD7-D4E61E8A5A68">
                                 <p class="notep1">注意：</p>
                                 <p>由于禁用了监视和许多自动功能，Oracle强烈建议您不要将<code class="codeph">STATISTICS_LEVEL</code>设置为<code class="codeph">BASIC</code> 。</p>
                              </div>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C__GUID-42BB12D2-F9A6-4B42-9D5C-AC4F2EF23BD6">要使用DBMS_AUTO_TASK_ADMIN控制自动统计信息收集：</p>
                        <ol>
                           <li>
                              <p id="GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C__d5e32">在SQL * Plus或SQL Developer中，以具有管理权限的用户身份登录数据库。</p>
                           </li>
                           <li>
                              <p>执行以下操作之一：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>要启用自动化任务，请执行以下PL / SQL块：</p><pre class="pre codeblock"><code>BEGIN DBMS_AUTO_TASK_ADMIN.ENABLE（client_name =&gt;'auto optimizer stats collection'，operation =&gt; NULL，window_name =&gt; NULL）;结束; /</code></pre></li>
                                 <li>
                                    <p>要禁用自动化任务，请执行以下PL / SQL块：</p><pre class="pre codeblock"><code>BEGIN DBMS_AUTO_TASK_ADMIN.DISABLE（client_name =&gt;'auto optimizer stats collection'，operation =&gt; NULL，window_name =&gt; NULL）;结束; /</code></pre></li>
                              </ul>
                           </li>
                           <li>
                              <p>查询数据字典以确认更改。</p>
                              <p>例如，查询<code class="codeph">DBA_AUTOTASK_CLIENT</code>如下：</p><pre class="pre codeblock"><code>COL CLIENT_NAME FORMAT a31 SELECT CLIENT_NAME，STATUS FROM DBA_AUTOTASK_CLIENT WHERE CLIENT_NAME ='auto optimizer stats collection';</code></pre><p>示例输出显示如下：</p><pre class="pre codeblock"><code>CLIENT_NAME STATUS ------------------------------- -------- auto optimizer stats collection ENABLED</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C__GUID-81EB6620-BBE6-40B9-B060-896FDF5CCD86">要更改自动统计信息收集的窗口属性：</p>
                        <ol>
                           <li>
                              <p>使用管理员权限将SQL * Plus连接到数据库。</p>
                           </li>
                           <li>
                              <p>根据需要更改维护窗口的属性。</p>
                              <p>例如，要更改星期一维护窗口以使其从早上5点开始，请执行以下PL / SQL程序：</p><pre class="pre codeblock"><code>BEGIN DBMS_SCHEDULER.SET_ATTRIBUTE（'MONDAY_WINDOW'，'repeat_interval'，'freq = daily; byday = MON; byhour = 05; byminute = 0; bysecond = 0'）;结束; /</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C__GUID-E9901D00-61F9-4F20-B7B2-55E0F6063E76">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="../arpls/DBMS_AUTO_TASK_ADMIN.html#ARPLS-GUID-8CD58D39-436B-4642-BAEB-00C651DE8A8F" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_AUTO_TASK_ADMIN</code>包</p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN-GUID-16B23F95-8644-407A-A6C8-E85CADFA61FF" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">STATISTICS_LEVEL</code>初始化参数</p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="Oracle数据库可以自动收集优化器统计信息。">配置自动优化器统计信息收集</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="sect2"><a id="GUID-374ACB86-2512-4658-9170-8505B3EACF7D" name="GUID-374ACB86-2512-4658-9170-8505B3EACF7D"></a><h3 id="TGSQL-GUID-374ACB86-2512-4658-9170-8505B3EACF7D" class="sect3"><span class="enumeration_section">13.2</span>配置<span>高频自动优化器统计信息收集</span></h3>
               <div>
                  <p>此轻量级任务补充了标准自动统计信息收集。</p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-02415AC0-CA76-42F3-A10D-5B431215DD61">关于高频自动优化器统计信息收集</a><br>您可以更频繁地配置自动统计信息收集。
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-401A1202-B7DB-45EA-8278-E1481ED7642F">设置高频自动优化器统计信息收集的首选项</a><br>要启用和禁用该任务，请使用<code class="codeph">DBMS_STATS.SET_GLOBAL_PREFS</code> 。</li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-933EC241-11D2-47B0-B7E1-E68CDC9E9277">高频自动优化器统计收集：示例</a><br>在此示例中，您启用了运行DML语句，然后启用高频统计信息收集作业。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-245F23B2-24AF-44D8-9F12-99FD1215E878" title="本章介绍如何使用DBMS_STATS.GATHER _ * _ STATS程序单元。">收集优化程序统计信息</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-02415AC0-CA76-42F3-A10D-5B431215DD61" name="GUID-02415AC0-CA76-42F3-A10D-5B431215DD61"></a><h4 id="TGSQL-GUID-02415AC0-CA76-42F3-A10D-5B431215DD61" class="sect4"><span class="enumeration_section">13.2.1</span>关于<span>高频自动优化器统计信息收集</span></h4>
                  <div>
                     <p>您可以更频繁地配置自动统计信息收集。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-02415AC0-CA76-42F3-A10D-5B431215DD61__GUID-86AA1214-845B-4FFC-8445-BBED68B2F244"><span>高频自动优化统计收集的目的</span></p>
                        <p>AutoTask计划任务在维护窗口中自动运行。默认情况下，为一周中的每一天安排一个窗口。自动优化程序统计信息收集（ <code class="codeph">DBMS_STATS</code> ）在所有预定义的维护窗口中运行。
                        </p>
                        <p>统计信息可能在两个连续的统计信息收集任务之间失效如果数据经常更改，过时的统计信息可能会导致性能问题。例如，经纪公司可能在交易时间内收到大量数据，导致优化器对在此期间执行的查询使用陈旧统计数据。</p>
                        <p><span>高频自动优化器统计信息收集</span>补充了标准统计信息收集工作。默认情况下，集合每15分钟发生一次，这意味着统计信息的时间较短。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-02415AC0-CA76-42F3-A10D-5B431215DD61__GUID-63441E4F-0749-4E9B-96ED-9FC2779818B6"><span>高频自动优化器统计信息收集的</span>工作原理</p>
                        <p>要启用和禁用高频任务，设置执行间隔并设置最长运行时间，请使用<code class="codeph">DBMS_STATS.SET_GLOBAL_PREFS</code>过程。高频任务是“轻量级”，只收集过时的统计数据。它不执行诸如清除不存在的对象的统计信息或调用Optimizer Statistics Advisor之类的操作。标准自动化作业执行这些附加任务。
                        </p>
                        <p>在维护窗口中运行的自动统计信息收集作业不受高频作业的影响。维护窗口期间不会启动高频任务，因此一次只能运行一个统计任务。您可以通过查询<code class="codeph">DBA_AUTO_STAT_EXECUTIONS</code>来监视任务。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-374ACB86-2512-4658-9170-8505B3EACF7D" title="此轻量级任务补充了标准自动统计信息收集。">配置高频自动优化器统计信息收集</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-401A1202-B7DB-45EA-8278-E1481ED7642F" name="GUID-401A1202-B7DB-45EA-8278-E1481ED7642F"></a><h4 id="TGSQL-GUID-401A1202-B7DB-45EA-8278-E1481ED7642F" class="sect4"><span class="enumeration_section">13.2.2</span>设置<span>高频自动优化器统计信息收集的</span>首选项</h4>
                  <div>
                     <p>要启用和禁用该任务，请使用<code class="codeph">DBMS_STATS.SET_GLOBAL_PREFS</code> 。</p>
                     <div class="section">
                        <p>您可以使用<code class="codeph">DBMS_STATS.SET_GLOBAL_PREFS</code>将首选项设置为以下任何值：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">AUTO_TASK_STATUS</code></p>
                              <p>启用或禁用<span>高频自动优化程序统计信息收集</span> 。价值观是：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">ON</code> - 启用<span>高频自动优化器统计信息收集</span> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">OFF</code> - 禁用<span>高频自动优化器统计信息收集</span> 。这是默认值。
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p><code class="codeph">AUTO_TASK_MAX_RUN_TIME</code></p>
                              <p>配置执行<span>高频自动优化器统计信息收集</span>的最长运行时间（以秒为单位）。最大值为<code class="codeph">3600</code> （等于1小时），这是默认值。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">AUTO_TASK_INTERVAL</code></p>
                              <p>指定执行<span>高频自动优化程序统计信息收集</span>之间的间隔（秒）。最小值为<code class="codeph">60</code> 。默认值为<code class="codeph">900</code> （等于15分钟）。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="p">要配置高频任务，您必须具有管理员权限。</div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-401A1202-B7DB-45EA-8278-E1481ED7642F__GUID-072A9C06-A264-4171-901C-C709B7090A00">配置高频任务：</p>
                        <ol>
                           <li>
                              <p>以具有管理员权限的用户身份登录数据库。</p>
                           </li>
                           <li>
                              <p>要启用高频任务，请将<code class="codeph">AUTO_TASK_STATUS</code>首选项设置为<code class="codeph">ON</code> 。</p>
                              <p>以下示例启用自动任务：</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.SET_GLOBAL_PREFS（'AUTO_TASK_STATUS'，'ON'）;</code></pre></li>
                           <li>
                              <p>要设置最长运行时间，请将<code class="codeph">AUTO_TASK_MAX_RUN_TIME</code>首选项设置为所需的秒数。
                              </p>
                              <p>以下示例将最长运行时间设置为10分钟：</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.SET_GLOBAL_PREFS（'AUTO_TASK_MAX_RUN_TIME'，'600'）;</code></pre></li>
                           <li>
                              <p>要设置频率，请将<code class="codeph">AUTO_TASK_INTERVAL</code>首选项设置为所需的秒数。
                              </p>
                              <p>以下示例将频率设置为8分钟：</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.SET_GLOBAL_PREFS（'AUTO_TASK_INTERVAL'，'240'）;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-374ACB86-2512-4658-9170-8505B3EACF7D" title="此轻量级任务补充了标准自动统计信息收集。">配置高频自动优化器统计信息收集</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-933EC241-11D2-47B0-B7E1-E68CDC9E9277" name="GUID-933EC241-11D2-47B0-B7E1-E68CDC9E9277"></a><h4 id="TGSQL-GUID-933EC241-11D2-47B0-B7E1-E68CDC9E9277" class="sect4"><span class="enumeration_section">13.2.3</span> <span>高频自动优化器统计收集</span> ：示例</h4>
                  <div>
                     <p>在此示例中，您启用了运行DML语句，然后启用高频统计信息收集作业。</p>
                     <div class="section">
                        <p>此示例假定以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您以管理员身份登录数据库。</p>
                           </li>
                           <li>
                              <p><code class="codeph">sh</code>模式的统计数据很新鲜。
                              </p>
                           </li>
                           <li>
                              <p><span>高频自动优化器统计收集</span></p>未启用。
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-933EC241-11D2-47B0-B7E1-E68CDC9E9277__GUID-C45CFDE1-F4A8-41DC-88C2-14F4D5DE7307">
                        <ol>
                           <li>
                              <p>查询数据字典以获取<code class="codeph">sales</code>和<code class="codeph">customers</code>表的统计信息（包括样本输出）：</p><pre class="pre codeblock"><code>SET LINESIZE 170 SET PAGESIZE 5000 COL TABLE_NAME FORMAT a20 COL PARTITION_NAME FORMAT a20 COL NUM_ROWS FORMAT 9999999 COL STALE_STATS FORMAT a3 SELECT TABLE_NAME，PARTITION_NAME，NUM_ROWS，STALE_STATS FROM DBA_TAB_STATISTICS OWNER ='SH'和TABLE_NAME IN（'CUSTOMERS'，'SALES'） ORDER BY TABLE_NAME，PARTITION_NAME; TABLE_NAME PARTITION_NAME NUM_ROWS STA -------------------- -------------------- ------ -  ---客户55500没有销售SALES_1995 0没有销售SALES_1996 0没有销售SALES_H1_1997 0没有销售SALES_H1_1997 0没有销售SALES_Q1_1998 43687没有销售SALES_Q1_1999 64186没有销售SALES_Q1_2000 62197没有销售SALES_Q1_2001 60608没有销售SALES_Q1_2002 0没有销售SALES_Q1_2003 0没有销售SALES_Q2_1998 35758 NO SALES SALES_Q2_1999 54233 NO SALES SALES_Q2_2000 55515 NO SALES SALES_Q2_2001 63292个NO SALES SALES_Q2_2002 0 NO SALES SALES_Q2_2003 0 NO SALES SALES_Q3_1998 50515 NO SALES SALES_Q3_1999 67138 NO SALES SALES_Q3_2000 58950 NO SALES SALES_Q3_2001 65769 NO SALES SALES_Q3_2002 0 NO SALES SALES_Q3_2003 0 NO SALES SALES_Q4_1998 48874 NO SALES SALES_Q4_1999 62388无销售SALES_Q4_2000 55984无销售SALES_Q4_2001 69749无销售SALES_Q4_2002 0无销售SALES_Q4_2003 0无销售918843无</code></pre><p>前面的输出显示没有任何统计信息是陈旧的。</p>
                           </li>
                           <li>
                              <p>在<code class="codeph">sales</code>和<code class="codeph">customers</code>上执行DML：</p><pre class="pre codeblock"><code>- 在销售中插入918K行INSERT INTO sh.sales SELECT * FROM sh.sales; - 更新大约15％的销售行UPDATE sh.sales SET amount_sold = amount_sold + 1 WHERE amount_sold&gt; 100; - 向客户插入1行INSERT INTO sh.customers（cust_id，cust_first_name，cust_last_name，cust_gender，cust_year_of_birth，cust_main_phone_number，cust_street_address，cust_postal_code，cust_city_id，cust_city，cust_state_province_id，cust_state_province，country_id，cust_total，cust_total_id）VALUES（188710，'Jenny' ，'史密斯'，'F'，'1966'，'555-111-2222'，'400 oracle parkway'，'94065'，51402，'Redwood Shores'，52564，'CA'，52790，'客户总数' ，'52772'）;承诺;</code></pre><p><code class="codeph">sales</code>行总数增加了100％，但仅向<code class="codeph">customers</code>添加了一行。
                              </p>
                           </li>
                           <li>
                              <p>将优化程序统计信息保存到磁盘：</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.FLUSH_DATABASE_MONITORING_INFO;</code></pre></li>
                           <li>
                              <p>再次查询表统计信息（包括示例输出）：</p><pre class="pre codeblock"><code>SELECT TABLE_NAME，PARTITION_NAME，NUM_ROWS，STALE_STATS来自DBA_TAB_STATISTICS，其中OWNER ='SH'和TABLE_NAME IN（'CUSTOMERS'，'SALES'）ORDER BY TABLE_NAME，PARTITION_NAME; TABLE_NAME PARTITION_NAME NUM_ROWS STA -------------------- -------------------- ------ -  ---客户55500 <span class="bold">没有</span>销售SALES_1995 0没有销售SALES_1996 0没有销售SALES_H1_1997 0没有销售SALES_H1_1997 0没有销售SALES_Q1_1998 43687是销售SALES_Q1_1999 64186是销售SALES_Q1_2000 62197是销售SALES_Q1_2001 60608是销售SALES_Q1_2002 0没有销售SALES_Q1_2003 0没有销售SALES_Q2_1998 35758 YES SALES SALES_Q2_1999 54233 YES SALES SALES_Q2_2000 55515 YES SALES SALES_Q2_2001 63292 YES SALES SALES_Q2_2002 0 NO SALES SALES_Q2_2003 0 NO SALES SALES_Q3_1998 50515 YES SALES SALES_Q3_1999 67138 YES SALES SALES_Q3_2000 58950 YES SALES SALES_Q3_2001 65769 YES SALES SALES_Q3_2002 0 NO SALES SALES_Q3_2003 0 NO SALES SALES_Q4_1998 48874 YES SALES SALES_Q4_1999 62388是销售SALES_Q4_2000 55984是销售SALES_Q4_2001 69749是销售SALES_Q4_2002 0否销售SALES_Q4_2003 0否销售1837686销售918843 <span class="bold">是</span> 31行选择。
</code></pre><p>前面的输出显示统计信息对于<code class="codeph">customers</code>并不陈旧，但对于<code class="codeph">sales</code>是陈旧的。
                              </p>
                           </li>
                           <li>
                              <p>配置<span>高频自动优化器统计信息收集</span> ：</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.SET_GLOBAL_PREFS（'AUTO_TASK_STATUS'，'ON'）; EXEC DBMS_STATS.SET_GLOBAL_PREFS（'AUTO_TASK_MAX_RUN_TIME'，'180'）; EXEC DBMS_STATS.SET_GLOBAL_PREFS（'AUTO_TASK_INTERVAL'，'240'）;</code></pre><p>前面的PL / SQL程序支持高频采集，将最大运行时间设置为3分钟，并将任务执行间隔设置为4分钟。</p>
                           </li>
                           <li>
                              <p>等待几分钟，然后查询数据字典：</p><pre class="pre codeblock"><code>COL OPID FORMAT 9999 COL状态格式a11 COL ORIGIN格式a20 COL已完成格式99999 COL FAILED FORMAT 99999 COL TIMEOUT FORMAT 99999 COL INPROG FORMAT 99999 SELECT OPID，ORIGIN，STATUS，TO_CHAR（START_TIME，'DD / MM HH24：MI：SS'） AS BEGIN_TIME，TO_CHAR（END_TIME，'DD / MM HH24：MI：SS'）AS END_TIME，COMPLETED，FAILED，TIMED_OUT作为超时，IN_PROGRESS作为来自DBA_AUTO_STAT_EXECUTION的订单按OPID排序;</code></pre><p>输出显示高频作业执行两次，标准自动统计信息收集作业执行一次：</p><pre class="pre codeblock"><code>OPID ORIGIN STATUS BEGIN_TIME END_TIME完成失败的超时输入----- -------------------- ----------- ----- --------- -------------- --------- ------ ------- ----- -  790 HIGH_FREQ_AUTO_TASK COMPLETED 03/10 14:54:02 03/10 14:54:35 338 3 0 0 793 HIGH_FREQ_AUTO_TASK COMPLETED 03/10 14:58:11 03/10 14:58:45 193 3 0 0 794 AUTO_TASK已完成03/10 15:00:02 03/10 15:00:20 52 3 0 0</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-374ACB86-2512-4658-9170-8505B3EACF7D" title="此轻量级任务补充了标准自动统计信息收集。">配置高频自动优化器统计信息收集</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL406"></a><div class="props_rev_3"><a id="GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" name="GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B"></a><h3 id="TGSQL-GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" class="sect3"><span class="enumeration_section">13.3</span>手动收集优化器统计信息</h3>
               <div>
                  <p>作为自动统计信息收集的替代或补充，您可以使用<code class="codeph">DBMS_STATS</code>包手动收集优化程序统计信息。
                  </p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001">关于使用DBMS_STATS进行手动统计信息收集</a><br>使用<code class="codeph">DBMS_STATS</code>包来操作优化程序统计信息。您可以在不同的粒度级别收集对象和列的统计信息：对象，架构和数据库。您还可以收集物理系统的统计信息。
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-A3E66485-F827-494E-99D7-6E4558E9CC21">手动收集优化程序统计信息的指南</a><br>在大多数情况下，自动统计信息收集足以用于以中等速度修改的数据库对象。
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-33C8239F-53A9-4FCB-969B-4772041317AA">确定优化程序统计信息何时失效</a><br>表上的陈旧统计数据不能准确反映其数据。为了帮助您确定数据库对象何时需要新的统计信息，数据库提供了一个表监视工具。
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D">收集架构和表统计信息</a><br>使用<code class="codeph">GATHER_TABLE_STATS</code>收集表统计信息，使用<code class="codeph">GATHER_SCHEMA_STATS</code>收集模式中所有对象的统计信息。
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212">收集固定对象的统计信息</a><br>固定对象是动态性能表及其索引。这些对象记录当前数据库活动。
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5">使用动态统计信息收集易失性表的统计信息</a><br>易失性表的统计信息（在白天显着修改的表）很快就会过时。例如，可以删除或截断表，然后重建。
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-3D36585C-5850-402E-9DB5-2EE9AAAD8C36">同时收集优化程序统计信息</a><br>Oracle数据库可以同时收集多个表或分区的统计信息。
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-63E195EB-10F4-428B-9912-3E98C2A957BF">收集分区对象的增量统计信息</a><br>增量统计信息仅扫描已更改的分区。通过从分区级统计信息中获取全局统计信息来收集大分区表的统计信息时， <strong class="term">增量统计信息维护</strong>可提高性能。
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B__GUID-FAAC7E0D-F492-4210-8041-A1BE10562508">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="Oracle数据库可以自动收集优化器统计信息。">配置自动优化程序统计信息收集</a> ”</span></p>
                        </li>
                        <li>
                           <p><a href="../arpls/DBMS_STATS.html#ARPLS059" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_STATS</code>包</p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-245F23B2-24AF-44D8-9F12-99FD1215E878" title="本章介绍如何使用DBMS_STATS.GATHER _ * _ STATS程序单元。">收集优化程序统计信息</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL94918"></a><a id="TGSQL407"></a><div class="props_rev_3"><a id="GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001" name="GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001"></a><h4 id="TGSQL-GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001" class="sect4"><span class="enumeration_section">13.3.1</span>关于使用DBMS_STATS进行手动统计信息收集</h4>
                  <div>
                     <p>使用<code class="codeph">DBMS_STATS</code>包来操作优化程序统计信息。您可以在不同的粒度级别收集对象和列的统计信息：对象，架构和数据库。您还可以收集物理系统的统计信息。
                     </p>
                     <p>下表总结了用于收集优化程序统计信息的<code class="codeph">DBMS_STATS</code>过程。此程序包不会收集表群集的统计信息。但是，您可以收集<a href="glossary.html#GUID-631F5681-B73D-4551-A4B2-C69282695030"><span class="xrefglossterm">表群集中</span></a>各个表的统计信息。
                     </p>
                     <div class="tblformal" id="GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001__CHDCEEJH">
                        <p class="titleintable">表13-1收集优化程序统计信息的DBMS_STATS过程</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_STATS收集优化程序统计信息的过程" width="100%" border="1" summary="This 2 column table lists the DBMS_STATS Procedures for Setting Preferences. Column 1 is the procedure. Column 2 is the purpose of the procedure. " frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="40%" id="d74756e2055">程序</th>
                                 <th align="left" valign="bottom" width="60%" id="d74756e2058">目的</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="40%" id="d74756e2063" headers="d74756e2055 ">
                                    <p><code class="codeph">GATHER_INDEX_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d74756e2063 d74756e2058 ">
                                    <p>收集索引统计信息</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="40%" id="d74756e2071" headers="d74756e2055 ">
                                    <p><code class="codeph">GATHER_TABLE_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d74756e2071 d74756e2058 ">
                                    <p>收集表，列和索引统计信息</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="40%" id="d74756e2079" headers="d74756e2055 ">
                                    <p><code class="codeph">GATHER_SCHEMA_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d74756e2079 d74756e2058 ">
                                    <p>收集模式中所有对象的统计信息</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="40%" id="d74756e2087" headers="d74756e2055 ">
                                    <p><code class="codeph">GATHER_DICTIONARY_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d74756e2087 d74756e2058 ">
                                    <p>收集所有系统模式的统计信息，包括<code class="codeph">SYS</code>和<code class="codeph">SYSTEM</code> ，以及其他可选模式，如<code class="codeph">CTXSYS</code>和<code class="codeph">DRSYS</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="40%" id="d74756e2106" headers="d74756e2055 ">
                                    <p><code class="codeph">GATHER_DATABASE_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d74756e2106 d74756e2058 ">
                                    <p>收集数据库中所有对象的统计信息</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>当<code class="codeph">OPTIONS</code>参数设置为<code class="codeph">GATHER STALE</code>或<code class="codeph">GATHER AUTO</code> ， <code class="codeph">GATHER_SCHEMA_STATS</code>和<code class="codeph">GATHER_DATABASE_STATS</code>过程将收集任何具有陈旧统计信息的表和任何缺少统计信息的表的统计信息。如果受监视的表的修改次数超过10％，则数据库会将这些统计信息视为过时并再次收集它们。
                     </p>
                     <div class="infoboxnote" id="GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001__GUID-8CFAD02D-3599-4CF2-9AB9-774F5CAAA3AC">
                        <p class="notep1">注意：</p>
                        <p>如<span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="Oracle数据库可以自动收集优化器统计信息。">配置自动优化程序统计信息收集</a> ”中所述</span> ，您可以配置夜间作业以自动收集统计信息。
                        </p>
                     </div>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001__GUID-BF19598F-E808-42C1-9C94-CEF1508BE5D2">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" title="系统统计信息描述优化程序的硬件特征，例如I / O和CPU性能和利用率。">手动收集系统统计信息</a> ”</span></p>
                           </li>
                           <li>
                              <p><a href="../arpls/DBMS_STATS.html#ARPLS059" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解有关<code class="codeph">DBMS_STATS</code>包的更多信息</p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" title="作为自动统计信息收集的替代或补充，您可以使用DBMS_STATS包手动收集优化程序统计信息。">手动收集优化程序统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL415"></a><div class="props_rev_3"><a id="GUID-A3E66485-F827-494E-99D7-6E4558E9CC21" name="GUID-A3E66485-F827-494E-99D7-6E4558E9CC21"></a><h4 id="TGSQL-GUID-A3E66485-F827-494E-99D7-6E4558E9CC21" class="sect4"><span class="enumeration_section">13.3.2</span>手动收集优化器统计信息的指导原则</h4>
                  <div>
                     <p>在大多数情况下，自动统计信息收集足以用于以中等速度修改的数据库对象。</p>
                     <p>自动收集有时可能不充分或不可用，如下表所示。</p>
                     <div class="tblformal" id="GUID-A3E66485-F827-494E-99D7-6E4558E9CC21__GUID-0433AA43-E757-4E66-A4CE-F3BF12A907AE">
                        <p class="titleintable">表13-2手动收集统计信息的原因</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="手动收集统计数据的原因" border="1" summary="This table describes situations in which you may need to gather statistics manually." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" id="d74756e2297">问题</th>
                                 <th align="left" valign="bottom" id="d74756e2299">了解更多</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d74756e2303" headers="d74756e2297 ">您执行某些类型的<a href="glossary.html#GUID-FC504237-77A1-49E6-8BA2-4475A1C76553"><span class="xrefglossterm">批量加载</span></a> ，并且不能等待维护窗口收集统计信息，因为必须立即执行查询。
                                 </td>
                                 <td align="left" valign="top" headers="d74756e2303 d74756e2299 "><span class="q">“ <a href="optimizer-statistics-concepts.html#GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B" title="在以下类型的批量加载期间，数据库可以自动收集表和索引统计信息：INSERT INTO ...SELECT使用直接路径插入，以及CREATE TABLE AS SELECT。">在线统计数据收集散装货物</a> ”</span></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d74756e2322" headers="d74756e2297 ">在非代表性工作负载期间，自动统计信息收集会收集固定表的统计信息。</td>
                                 <td align="left" valign="top" headers="d74756e2322 d74756e2299 "><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212" title="固定对象是动态性能表及其索引。这些对象记录当前数据库活动。">收集固定对象的统计信息</a> ”</span></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d74756e2332" headers="d74756e2297 ">自动统计信息收集不收集系统统计信息。</td>
                                 <td align="left" valign="top" headers="d74756e2332 d74756e2299 "><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" title="系统统计信息描述优化程序的硬件特征，例如I / O和CPU性能和利用率。">手动收集系统统计信息</a> ”</span></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d74756e2342" headers="d74756e2297 ">正在删除或截断易失性表，然后在白天重建。</td>
                                 <td align="left" valign="top" headers="d74756e2342 d74756e2299 "><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5" title="易失性表的统计信息（在白天显着修改的表）很快就会过时。例如，可以删除或截断表，然后重建。">使用动态统计信息收集易失性表的统计信息</a> ”</span></td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>本节提供了您可以选择手动统计收集的典型情况的指南：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-88E321BF-445E-40BD-83A2-9EA107689B2F">设定样本量的指南</a><br>在优化器统计的上下文中， <span class="bold">抽样</span>是从表行的随机子集中收集统计信息。通过使数据库能够避免全表扫描和整个表的排序，抽样可以最大限度地减少收集统计信息所需的资源。
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-61D61DDE-C597-4B86-98B4-A0A9CB176F33">并行统计数据收集指南</a><br>默认情况下，数据库使用在表或索引级别指定的并行度来收集统计信息。
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-5EB2976E-26EF-47A7-8568-7695CA853079">分区对象的指南</a><br>对于分区表和索引， <code class="codeph">DBMS_STATS</code>可以为每个分区收集单独的统计信息，并为整个表或索引收集全局统计信息。
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-6236E795-8A03-444B-92EA-52CD76EA332E">经常更改对象的指南</a><br>经常修改表时，经常收集统计信息以使它们不会过时，但不会经常收集开销会降低性能。
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-47136764-F468-43ED-9FF7-053C90D338B8">外部表格指南</a><br>由于数据库不允许对外部表进行数据操作，因此数据库永远不会将外部表的统计信息标记为过时。如果外部表需要新的统计信息，例如，因为基础数据文件发生更改，则重新收集统计信息。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" title="作为自动统计信息收集的替代或补充，您可以使用DBMS_STATS包手动收集优化程序统计信息。">手动收集优化程序统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL409"></a><div class="props_rev_3"><a id="GUID-88E321BF-445E-40BD-83A2-9EA107689B2F" name="GUID-88E321BF-445E-40BD-83A2-9EA107689B2F"></a><h5 id="TGSQL-GUID-88E321BF-445E-40BD-83A2-9EA107689B2F" class="sect5"><span class="enumeration_section">13.3.2.1</span>设定样本<span class="enumeration_section">量的</span>指南</h5>
                     <div>
                        <p>在优化器统计的上下文中， <span class="bold">抽样</span>是从表行的随机子集中收集统计信息。通过使数据库能够避免全表扫描和整个表的排序，抽样可以最大限度地减少收集统计信息所需的资源。
                        </p>
                        <div class="section">
                           <p>数据库在处理表中的所有行（100％样本）时收集最准确的统计信息。但是，较大的样本量会增加统计信息收集操作的时间。挑战在于确定在合理时间内提供准确统计数据的样本量。</p>
                           <p>当用户指定参数<code class="codeph">ESTIMATE_PERCENT</code> ， <code class="codeph">DBMS_STATS</code>使用抽样，该参数控制要采样的表中行的百分比。为了在实现必要的统计准确性的同时最大限度地提高性能，Oracle建议<code class="codeph">ESTIMATE_PERCENT</code>参数使用默认设置<code class="codeph">DBMS_STATS.AUTO_SAMPLE_SIZE</code> 。在这种情况下，Oracle数据库会自动选择样本大小。此设置允许使用以下内容：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>基于散列的算法，比采样快得多</p>
                                 <p>该算法读取所有行并生成几乎与100％样本的统计数据一样准确的统计数据。使用此技术计算的统计数据是确定性的。</p>
                              </li>
                              <li>
                                 <p>增量统计</p>
                              </li>
                              <li>
                                 <p>并发统计数据</p>
                              </li>
                              <li>
                                 <p>新的直方图类型</p>
                              </li>
                           </ul>
                           <p><code class="codeph">DBA_TABLES.SAMPLE_SIZE</code>列指示用于收集统计信息的实际样本大小。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-88E321BF-445E-40BD-83A2-9EA107689B2F__GUID-79811D0D-EF05-4A33-8E04-582862DA0389">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="histograms.html#GUID-59C57EDF-E763-436A-9CB2-B59A536A10F7" title="混合直方图结合了基于高度的直方图和频率直方图的特征。这个" best="" of="" both="" world="=" ="">混合直方图</a> ”</span></p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-7BA4CA2E-013E-403B-9AB7-7AB62FE61FEE" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解有关<code class="codeph">DBMS_STATS.AUTO_SAMPLE_SIZE</code>更多信息</p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-A3E66485-F827-494E-99D7-6E4558E9CC21" title="在大多数情况下，自动统计信息收集足以用于以中等速度修改的数据库对象。">手动收集优化程序统计信息的准则</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL410"></a><div class="props_rev_3"><a id="GUID-61D61DDE-C597-4B86-98B4-A0A9CB176F33" name="GUID-61D61DDE-C597-4B86-98B4-A0A9CB176F33"></a><h5 id="TGSQL-GUID-61D61DDE-C597-4B86-98B4-A0A9CB176F33" class="sect5"><span class="enumeration_section">13.3.2.2</span>并行统计数据收集指南</h5>
                     <div>
                        <p>默认情况下，数据库使用在表或索引级别指定的并行度来收集统计信息。</p>
                        <div class="section">
                           <p>您可以使用<code class="codeph">DBMS_STATS</code>收集过程的<code class="codeph">degree</code>参数覆盖此设置。Oracle建议将<code class="codeph">degree</code>设置为<code class="codeph">DBMS_STATS.AUTO_DEGREE</code> 。此设置使数据库能够根据对象大小和与并行性相关的初始化参数的设置选择适当的并行度。
                           </p>
                           <p>数据库可以串行或并行收集大多数统计信息。但是，数据库不会并行收集某些索引统计信息，包括集群索引，域索引和位图连接索引。收集并行统计信息时，数据库可以使用抽样。</p>
                           <div class="infoboxnote" id="GUID-61D61DDE-C597-4B86-98B4-A0A9CB176F33__GUID-C21C5D1A-536B-4B0C-9F6B-53B2979F42F3">
                              <p class="notep1">注意：</p>
                              <p>不要将收集统计信息与同时收集统计信息并行混淆。</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-61D61DDE-C597-4B86-98B4-A0A9CB176F33__GUID-047F2C24-BC75-4E08-BDFD-25DE76C3211E">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9" title="默认情况下，按顺序收集分区表的每个分区。">关于并发统计收集</a> ”</span></p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-7BA4CA2E-013E-403B-9AB7-7AB62FE61FEE" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解有关<code class="codeph">DBMS_STATS.AUTO_DEGREE</code>更多信息</p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-A3E66485-F827-494E-99D7-6E4558E9CC21" title="在大多数情况下，自动统计信息收集足以用于以中等速度修改的数据库对象。">手动收集优化程序统计信息的准则</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL411"></a><div class="props_rev_3"><a id="GUID-5EB2976E-26EF-47A7-8568-7695CA853079" name="GUID-5EB2976E-26EF-47A7-8568-7695CA853079"></a><h5 id="TGSQL-GUID-5EB2976E-26EF-47A7-8568-7695CA853079" class="sect5"><span class="enumeration_section">13.3.2.3</span>分区对象的指南</h5>
                     <div>
                        <p>对于分区表和索引， <code class="codeph">DBMS_STATS</code>可以为每个分区收集单独的统计信息，并为整个表或索引收集全局统计信息。
                        </p>
                        <div class="section">
                           <p>同样，对于复合分区， <code class="codeph">DBMS_STATS</code>可以为子分区，分区以及整个表或索引收集单独的统计信息。
                           </p>
                           <p>要确定要收集的分区统计信息的类型，请指定<code class="codeph">DBMS_STATS</code>过程的<code class="codeph">granularity</code>参数。Oracle建议将<code class="codeph">granularity</code>设置为默认值<code class="codeph">AUTO</code>以收集子分区，分区或全局统计信息，具体取决于分区类型。<code class="codeph">ALL</code>设置收集所有类型的统计信息。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-5EB2976E-26EF-47A7-8568-7695CA853079__GUID-91B43C9E-43CD-4FBB-BF5D-0EDEA7C86C89">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-63E195EB-10F4-428B-9912-3E98C2A957BF" title="增量统计信息仅扫描已更改的分区。通过从分区级统计信息中获取全局统计信息来收集大分区表的统计信息时，增量统计信息维护可提高性能。">收集分区对象的增量统计信息</a> ”</span></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-A3E66485-F827-494E-99D7-6E4558E9CC21" title="在大多数情况下，自动统计信息收集足以用于以中等速度修改的数据库对象。">手动收集优化程序统计信息的准则</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL416"></a><div class="props_rev_3"><a id="GUID-6236E795-8A03-444B-92EA-52CD76EA332E" name="GUID-6236E795-8A03-444B-92EA-52CD76EA332E"></a><h5 id="TGSQL-GUID-6236E795-8A03-444B-92EA-52CD76EA332E" class="sect5"><span class="enumeration_section">13.3.2.4</span>频繁更改对象的指南</h5>
                     <div>
                        <p>经常修改表时，经常收集统计信息以使它们不会过时，但不会经常收集开销会降低性能。</p>
                        <div class="section">
                           <p>您可能只需要每周或每月收集新的统计信息。最佳做法是使用脚本或作业计划程序定期运行<code class="codeph">DBMS_STATS.GATHER_SCHEMA_STATS</code>和<code class="codeph">DBMS_STATS.GATHER_DATABASE_STATS</code>过程。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-A3E66485-F827-494E-99D7-6E4558E9CC21" title="在大多数情况下，自动统计信息收集足以用于以中等速度修改的数据库对象。">手动收集优化程序统计信息的准则</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95045"></a><div class="props_rev_3"><a id="GUID-47136764-F468-43ED-9FF7-053C90D338B8" name="GUID-47136764-F468-43ED-9FF7-053C90D338B8"></a><h5 id="TGSQL-GUID-47136764-F468-43ED-9FF7-053C90D338B8" class="sect5"><span class="enumeration_section">13.3.2.5</span>外部表格指南</h5>
                     <div>
                        <p>由于数据库不允许对外部表进行数据操作，因此数据库永远不会将外部表的统计信息标记为过时。如果外部表需要新的统计信息，例如，因为基础数据文件发生更改，则重新收集统计信息。</p>
                        <div class="section">
                           <p>对于外部表，请使用与内部表相同的<code class="codeph">DBMS_STATS</code>过程。请注意， <code class="codeph">DBMS_STATS.SET_TABLE_STATS</code>和<code class="codeph">DBMS_STATS.GET_TABLE_STATS</code>的<code class="codeph">scanrate</code>参数指定Oracle数据库扫描表中数据的速率（以MB / s为单位），并且仅与外部表相关。<code class="codeph">SCAN_RATE</code>列显示在<code class="codeph">DBA_TAB_STATISTICS</code>和<code class="codeph">DBA_TAB_PENDING_STATS</code>数据字典视图中。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-47136764-F468-43ED-9FF7-053C90D338B8__GUID-63FA5FB5-B7CA-42F1-AC89-AE0757F648CC">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="controlling-the-use-of-optimizer-statistics.html#GUID-87A26DD9-E2C1-41E3-9EF0-D141F44F0968" title="要为优化程序提供用户创建的统计信息以进行测试，可以使用DBMS_STATS.SET _ * _ STATS过程。这些过程为优化程序提供指定统计信息的人工值。">为测试创建人工优化器统计</a> ”</span></p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-17645D4E-279E-4C6F-9FF5-6AC909EDBCD3" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">SET_TABLE_STATS</code>和<code class="codeph">GET_TABLE_STATS</code></p>
                              </li>
                              <li>
                                 <p><a href="../refrn/DBA_TAB_STATISTICS.html#REFRN-GUID-03D846F8-5906-42FE-983B-E3434F5545A7" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">DBA_TAB_STATISTICS</code>视图</p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-A3E66485-F827-494E-99D7-6E4558E9CC21" title="在大多数情况下，自动统计信息收集足以用于以中等速度修改的数据库对象。">手动收集优化程序统计信息的准则</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL425"></a><a id="TGSQL424"></a><div class="props_rev_3"><a id="GUID-33C8239F-53A9-4FCB-969B-4772041317AA" name="GUID-33C8239F-53A9-4FCB-969B-4772041317AA"></a><h4 id="TGSQL-GUID-33C8239F-53A9-4FCB-969B-4772041317AA" class="sect4"><span class="enumeration_section">13.3.3</span>确定优化程序统计信息何时失效</h4>
                  <div>
                     <p>表上的陈旧统计数据不能准确反映其数据。为了帮助您确定数据库对象何时需要新的统计信息，数据库提供了一个表监视工具。</p>
                     <div class="section">
                        <p>监视跟踪表上的大致DML操作数以及自最近的统计信息收集以来是否已截断表。要检查统计信息是否过时，请在<code class="codeph">DBA_TAB_STATISTICS</code>和<code class="codeph">DBA_IND_STATISTICS</code>查询<code class="codeph">STALE_STATS</code>列。此列基于<code class="codeph">DBA_TAB_MODIFICATIONS</code>视图中的数据和<code class="codeph">DBMS_STATS</code>的<code class="codeph">STALE_PERCENT</code>首选项。</p>
                        <div class="infoboxnote" id="GUID-33C8239F-53A9-4FCB-969B-4772041317AA__GUID-FC6DC537-219E-4222-B131-C3F8D6ED414A">
                           <p class="notep1">注意：</p>
                           <p>从<span>Oracle Database 12c</span>第2版（12.2）开始，您不再需要使用<code class="codeph">DBMS_STATS.FLUSH_DATABASE_MONITORING_INFO</code>来确保视图元数据是最新的。<code class="codeph">DBA_TAB_STATISTICS</code> ， <code class="codeph">DBA_IND_STATISTICS</code>和<code class="codeph">DBA_TAB_MODIFICATIONS</code>视图中显示的统计信息是从磁盘和内存中获取的。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><code class="codeph">STALE_STATS</code>列具有以下可能值：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">是</code></p>
                              <p>统计数据陈旧。</p>
                           </li>
                           <li>
                              <p><code class="codeph">没有</code></p>
                              <p>统计数据并非陈旧。</p>
                           </li>
                           <li>
                              <p>空值</p>
                              <p>不收集统计数据。</p>
                           </li>
                        </ul>
                        <p>使用<code class="codeph">GATHER AUTO</code>选项执行<code class="codeph">GATHER_SCHEMA_STATS</code>或<code class="codeph">GATHER_DATABASE_STATS</code>仅收集没有统计信息或过时统计信息的对象的统计信息。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-33C8239F-53A9-4FCB-969B-4772041317AA__GUID-C82CCC7E-7AC7-48E2-87EC-2696C9BC690A">要确定陈旧的统计数据：</p>
                        <ol>
                           <li>
                              <p>启动SQL * Plus，然后以具有必要权限的用户身份登录数据库。</p>
                           </li>
                           <li>
                              <p>查询数据字典以了解陈旧统计信息。</p>
                              <p>以下示例查询<code class="codeph">sh.sales</code>表的陈旧统计信息（包括部分输出）：</p><pre class="pre codeblock"><code>COL PARTITION_NAME FORMAT a15 SELECT PARTITION_NAME，STALE_STATS FROM DBA_TAB_STATISTICS TABLE_NAME ='SALES'和OWNER ='SH'ORDER BY PARTITION_NAME; PARTITION_NAME STA --------------- --- SALES_1995 NO SALES_1996 NO SALES_H1_1997 NO SALES_H2_1997 NO SALES_Q1_1998 NO SALES_Q1_1999 NO。。。</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section"></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-33C8239F-53A9-4FCB-969B-4772041317AA__GUID-53B21D5F-CA63-49DB-AE6C-DEFA96EA1CCC">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../refrn/DBA_TAB_MODIFICATIONS.html#REFRN23280" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">DBA_TAB_MODIFICATIONS</code>视图</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" title="作为自动统计信息收集的替代或补充，您可以使用DBMS_STATS包手动收集优化程序统计信息。">手动收集优化程序统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL427"></a><a id="TGSQL426"></a><div class="props_rev_3"><a id="GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D" name="GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D"></a><h4 id="TGSQL-GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D" class="sect4"><span class="enumeration_section">13.3.4</span>收集模式和表统计信息</h4>
                  <div>
                     <p>使用<code class="codeph">GATHER_TABLE_STATS</code>收集表统计信息，使用<code class="codeph">GATHER_SCHEMA_STATS</code>收集模式中所有对象的统计信息。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D__GUID-94399AF6-9D26-4F92-8B88-FF14809495BD">使用DBMS_STATS收集模式统计信息：</p>
                        <ol>
                           <li>
                              <p>启动SQL * Plus，并使用您要运行的过程的相应权限连接到数据库。</p>
                           </li>
                           <li>
                              <p>运行<code class="codeph">GATHER_TABLE_STATS</code>或<code class="codeph">GATHER_SCHEMA_STATS</code>过程，指定所需的参数。
                              </p>
                              <p>典型参数包括：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>所有者 - <code class="codeph">ownname</code></p>
                                 </li>
                                 <li>
                                    <p>对象名称 - <code class="codeph">tabname</code> ， <code class="codeph">indname</code> ， <code class="codeph">partname</code></p>
                                 </li>
                                 <li>
                                    <p>并行<code class="codeph">degree</code> - <code class="codeph">degree</code></p>
                                 </li>
                              </ul>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D__GUID-725BD3D5-B0FC-4258-8EC5-8C2299538142">
                        <p class="titleinexample">例13-1收集表的统计信息</p>
                        <p>此示例使用<code class="codeph">DBMS_STATS</code>包来收集<code class="codeph">sh.customers</code>表的统计信息，并行设置为<code class="codeph">2</code> 。
                        </p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.GATHER_TABLE_STATS（ownname =&gt;'sh'，tabname =&gt;'customers'，degree =&gt; 2）;结束; /</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D__GUID-A41357C0-966D-4D13-8F41-1874DB543A74">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-CA6A56B9-0540-45E9-B1D7-D78769B7714C" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">GATHER_TABLE_STATS</code>过程</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" title="作为自动统计信息收集的替代或补充，您可以使用DBMS_STATS包手动收集优化程序统计信息。">手动收集优化程序统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL95111"></a><a id="TGSQL95112"></a><a id="TGSQL95110"></a><div class="props_rev_3"><a id="GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212" name="GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212"></a><h4 id="TGSQL-GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212" class="sect4"><span class="enumeration_section">13.3.5</span>收集固定对象的统计信息</h4>
                  <div>
                     <p>固定对象是动态性能表及其索引。这些对象记录当前数据库活动。</p>
                     <div class="section">
                        <p>与其他数据库表不同，当缺少优化程序统计信息时，数据库不会自动使用动态统计信息来引用<code class="codeph">X$</code>表的SQL语句。相反，优化程序使用预定义的默认值。这些默认值可能不具有代表性，可能导致次优的执行计划。因此，保持固定对象统计数据最新是很重要的。
                        </p>
                        <p>如果以前没有收集过，Oracle数据库会自动收集固定对象统计信息作为自动统计信息收集的一部分。您还可以通过调用<code class="codeph">DBMS_STATS.GATHER_FIXED_OBJECTS_STATS</code>手动收集有关固定对象的统计信息。 Oracle建议您在数据库具有代表性活动时收集统计信息。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212__GUID-6CEE1F7E-F67D-43DD-BDE7-EB12EC0853A9">先决条件</p>
                        <p>您必须具有<code class="codeph">SYSDBA</code>或<code class="codeph">ANALYZE ANY DICTIONARY</code>系统特权才能执行此过程。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212__GUID-783092EC-4FA2-4596-AC7E-BEBD2A9A034D">使用GATHER_FIXED_OBJECTS_STATS收集模式统计信息：</p>
                        <ol>
                           <li>
                              <p id="GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212__d5e29">在SQL * Plus或SQL Developer中，以具有必要权限的用户身份登录数据库。</p>
                           </li>
                           <li>
                              <p>运行<code class="codeph">DBMS_STATS.GATHER_FIXED_OBJECTS_STATS</code>过程，指定所需的参数。
                              </p>
                              <p>典型参数包括：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>表标识符，描述保存当前统计信息的位置 - <code class="codeph">stattab</code></p>
                                 </li>
                                 <li>
                                    <p>在<code class="codeph">stattab</code> （可选）中与这些统计信息关联的标识符 - <code class="codeph">statid</code></p>
                                 </li>
                                 <li>
                                    <p>包含<code class="codeph">stattab</code>模式（如果与当前模式不同） - <code class="codeph">statown</code></p>
                                 </li>
                              </ul>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212__GUID-7ACCF448-2110-41EB-8CA6-C274DE61F8BB">
                        <p class="titleinexample">例13-2收集表的统计信息</p>
                        <p>此示例使用<code class="codeph">DBMS_STATS</code>包来收集固定对象统计信息。
                        </p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.GATHER_FIXED_OBJECTS_STATS;结束; /</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212__GUID-A5A0DC01-E906-4D5C-B87B-95E99AB607E3">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="Oracle数据库可以自动收集优化器统计信息。">配置自动优化程序统计信息收集</a> ”</span></p>
                           </li>
                           <li>
                              <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-CA6A56B9-0540-45E9-B1D7-D78769B7714C" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">GATHER_TABLE_STATS</code>过程</p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" title="作为自动统计信息收集的替代或补充，您可以使用DBMS_STATS包手动收集优化程序统计信息。">手动收集优化程序统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94628"></a><a id="TGSQL420"></a><div class="props_rev_3"><a id="GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5" name="GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5"></a><h4 id="TGSQL-GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5" class="sect4"><span class="enumeration_section">13.3.6</span>使用动态统计信息收集易失性表的统计信息</h4>
                  <div>
                     <p>易失性表的统计信息（在白天显着修改的表）很快就会过时。例如，可以删除或截断表，然后重建。</p>
                     <div class="section">
                        <p>将volatile对象的统计信息设置为null时，Oracle Database会使用动态统计信息在优化期间动态收集必要的统计信息。<code class="codeph">OPTIMIZER_DYNAMIC_SAMPLING</code>初始化参数控制此功能。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5__GUID-65EA8679-2ED4-4281-B3B3-EBDD6A4D783E">假设</p>
                        <p>本教程假设以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">oe.orders</code>表非常不稳定。
                              </p>
                           </li>
                           <li>
                              <p>您希望删除然后锁定<code class="codeph">orders</code>表上的统计信息，以防止数据库收集表上的统计信息。通过这种方式，数据库可以动态收集必要的统计信息作为查询优化的一部分。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">oe</code>用户具有查询<code class="codeph">DBMS_XPLAN.DISPLAY_CURSOR</code>所需的权限。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5__GUID-99575B18-40F1-4C2A-B26F-98E21F65333F">要删除和锁定优化程序统计信息：</p>
                        <ol>
                           <li>
                              <p>以<code class="codeph">oe</code>用户身份连接到数据库，然后删除<code class="codeph">oe</code>表的统计信息。
                              </p>
                              <p>例如，执行以下过程：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.DELETE_TABLE_STATS（'OE'，'ORDERS'）;结束; /</code></pre></li>
                           <li>
                              <p>锁定<code class="codeph">oe</code>表的统计信息。
                              </p>
                              <p>例如，执行以下过程：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.LOCK_TABLE_STATS（'OE'，'ORDERS'）;结束; /</code></pre></li>
                           <li>
                              <p>您查询<code class="codeph">orders</code>表。
                              </p>
                              <p>例如，使用以下语句：</p><pre class="pre codeblock"><code>SELECT COUNT（order_id）FROM orders;</code></pre></li>
                           <li>
                              <p>您在游标中查询计划。</p>
                              <p>您运行以下命令（包括部分输出）：</p><pre class="pre codeblock"><code>SET LINESIZE 150 SET PAGESIZE 0 SELECT * FROM TABLE（DBMS_XPLAN.DISPLAY_CURSOR）; SQL_ID aut9632fr3358，子编号0 ------------------------------------- SELECT COUNT（order_id）FROM orders计划哈希值：425895392 --------------------------------------------- ------------------------ | Id |操作|名称|行|成本（％CPU）|时间| -------------------------------------------------- ------------------- | 0 |选择声明| | | 2（100）| | | 1 | SORT AGGREGATE | | 1 | | | | 2 |表访问完全|订单| 105 | 2（0）| 00:00:01 | -------------------------------------------------- -------------------注意-----  - <span class="bold">用于此语句的动态统计信息（级别= 2）</span>
</code></pre><p>前面的执行计划中的注释显示数据库使用<code class="codeph">SELECT</code>语句的动态统计信息。
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5__GUID-84C8B4AA-A164-4C8C-87B4-904B358ABF92">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="options-for-optimizer-statistics-gathering.html#GUID-F1C666DC-5450-4F92-83AA-607327DB5FD8" title="动态统计是一种优化技术，其中数据库使用递归SQL扫描表中块的小随机样本。">配置动态统计选项</a> ”</span></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="controlling-the-use-of-optimizer-statistics.html#GUID-1147FF89-68F0-4B0F-831A-A7E5D151D02F" title="您可以锁定统计信息以防止更改。">锁定和解锁优化程序统计信息</a> ”</span>以了解如何收集代表性统计信息然后锁定它们，这是防止易失性表的统计信息过时的替代技术</p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" title="作为自动统计信息收集的替代或补充，您可以使用DBMS_STATS包手动收集优化程序统计信息。">手动收集优化程序统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL428"></a><div class="props_rev_3"><a id="GUID-3D36585C-5850-402E-9DB5-2EE9AAAD8C36" name="GUID-3D36585C-5850-402E-9DB5-2EE9AAAD8C36"></a><h4 id="TGSQL-GUID-3D36585C-5850-402E-9DB5-2EE9AAAD8C36" class="sect4"><span class="enumeration_section">13.3.7</span>同时收集优化器统计信息</h4>
                  <div>
                     <p>Oracle数据库可以同时收集多个表或分区的统计信息。</p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9">关于并发统计收集</a><br>默认情况下，按顺序收集分区表的每个分区。
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11">启用并发统计信息收集</a><br>要启用并发统计信息收集，请使用<code class="codeph">DBMS_STATS.SET_GLOBAL_PREFS</code>过程来设置<code class="codeph">CONCURRENT</code>首选项。
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451">监控统计数据收集操作</a><br>您可以使用数据字典视图监视统计信息收集作业。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" title="作为自动统计信息收集的替代或补充，您可以使用DBMS_STATS包手动收集优化程序统计信息。">手动收集优化程序统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL429"></a><div class="props_rev_3"><a id="GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9" name="GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9"></a><h5 id="TGSQL-GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9" class="sect5"><span class="enumeration_section">13.3.7.1</span>关于并发统计信息收集</h5>
                     <div>
                        <p>默认情况下，按顺序收集分区表的每个分区。</p>
                        <p>启用<strong class="term">并发统计信息收集模式后</strong> ，数据库可以同时收集模式中的多个表或表中的多个分区或子分区的优化程序统计信息。并发可以通过使数据库完全使用多个处理器来减少收集统计信息所需的总时间。
                        </p>
                        <div class="infoboxnote" id="GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9__GUID-2CA8B54B-33EC-448D-BEB2-9DAA6D7FFAAF">
                           <p class="notep1">注意：</p>
                           <p>并发统计信息收集模式不依赖于并行查询处理，但可以使用它。</p>
                        </div>
                        <p>本节包含以下主题：</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-859939B3-CCA8-4C20-8985-27FB8E9DCB95">DBMS_STATS如何同时收集统计信息</a><br>Oracle数据库使用多种工具和技术来同时创建和管理多个统计信息收集作业。
                           </li>
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-A07045A4-2A62-4233-AF00-BD98641EB224">并发统计收集与资源管理</a><br><code class="codeph">DBMS_STATS</code>程序包不会显式管理作为用户启动的统计信息收集调用的一部分的并发统计信息收集作业使用的资源。
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-3D36585C-5850-402E-9DB5-2EE9AAAD8C36" title="Oracle数据库可以同时收集多个表或分区的统计信息。">同时收集优化程序统计信息</a></p>
                           </div>
                        </div>
                     </div>
                     <a id="TGSQL94629"></a><div class="props_rev_3"><a id="GUID-859939B3-CCA8-4C20-8985-27FB8E9DCB95" name="GUID-859939B3-CCA8-4C20-8985-27FB8E9DCB95"></a><h6 id="TGSQL-GUID-859939B3-CCA8-4C20-8985-27FB8E9DCB95" class="sect6"><span class="enumeration_section">13.3.7.1.1</span> DBMS_STATS如何同时收集统计信息</h6>
                        <div>
                           <p>Oracle数据库使用多种工具和技术来同时创建和管理多个统计信息收集作业。</p>
                           <p>数据库使用以下内容：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>Oracle Scheduler</p>
                              </li>
                              <li>
                                 <p>Oracle数据库高级队列（AQ）</p>
                              </li>
                              <li>
                                 <p>Oracle数据库资源管理器（资源管理器）</p>
                              </li>
                           </ul>
                           <p>通过使用<code class="codeph">DBMS_STATS.SET_GLOBAL_PREF</code>设置<code class="codeph">CONCURRENT</code>首选项来启用并发统计信息收集。</p>
                           <p>数据库运行尽可能多的并发作业。Job Scheduler决定要同时执行多少个作业以及要排队多少个作业。当运行的作业完成时，调度程序会出列并运行更多作业，直到数据库收集了有关所有表，分区和子分区的统计信息。最大作业数受<code class="codeph">JOB_QUEUE_PROCESSES</code>初始化参数和可用系统资源的限制。
                           </p>
                           <p>在大多数情况下， <code class="codeph">DBMS_STATS</code>过程为每个表分区或子分区创建单独的作业。但是，如果分区或子分区为空或非常小，则数据库可以自动将具有其他小对象的对象批处理为单个作业，以减少作业维护的开销。
                           </p>
                           <p>下图说明了在不同级别创建作业，其中表3是分区表，其他表是未分区的。作业3充当表3的协调员作业，并为该表中的每个分区创建作业，并为表3的全局统计创建单独的作业。此示例假定已禁用增量统计信息收集;如果启用，则数据库在分区作业完成后从分区级统计信息中派生全局统计信息。</p>
                           <div class="figure" id="GUID-859939B3-CCA8-4C20-8985-27FB8E9DCB95__GUID-C4206148-0B55-4801-84F7-8B47C6D102E9">
                              <p class="titleinfigure">图13-1并发统计信息收集作业</p><img src="img/tgsql_vm_036.png" alt="下面是图13-1的描述" title="下面是图13-1的描述" longdesc="img_text/tgsql_vm_036.html"><br><a href="img_text/tgsql_vm_036.html">“图13-1并发统计信息收集作业”的说明</a></div>
                           <!-- class="figure" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-859939B3-CCA8-4C20-8985-27FB8E9DCB95__GUID-C4B4C6DC-E76A-48D3-8CD3-BB8B9DECBB38">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11" title="要启用并发统计信息收集，请使用DBMS_STATS.SET_GLOBAL_PREFS过程来设置CONCURRENT首选项。">启用并发统计信息收集</a> ”</span></p>
                                 </li>
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS059" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_STATS</code>包</p>
                                 </li>
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN10077" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">JOB_QUEUE_PROCESSES</code>初始化参数</p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9" title="默认情况下，按顺序收集分区表的每个分区。">关于并发统计信息收集</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL94630"></a><div class="props_rev_3"><a id="GUID-A07045A4-2A62-4233-AF00-BD98641EB224" name="GUID-A07045A4-2A62-4233-AF00-BD98641EB224"></a><h6 id="TGSQL-GUID-A07045A4-2A62-4233-AF00-BD98641EB224" class="sect6"><span class="enumeration_section">13.3.7.1.2</span>并发统计信息收集和资源管理</h6>
                        <div>
                           <p><code class="codeph">DBMS_STATS</code>程序包不会显式管理作为用户启动的统计信息收集调用的一部分的并发统计信息收集作业使用的资源。
                           </p>
                           <p>因此，数据库可以在并发统计信息收集期间完全使用系统资源。要解决此问题，请使用资源管理器限制并发统计信息收集作业使用的资源。必须启用资源管理器才能同时收集统计信息。</p>
                           <p>系统提供的使用者组<code class="codeph">ORA$AUTOTASK</code>注册所有统计信息收集作业。您可以为<code class="codeph">ORA$AUTOTASK</code>创建具有适当资源分配的资源计划，以防止并发统计信息收集消耗所有可用资源。如果您缺少自己的资源计划，并且选择不创建资源计划，请考虑使用系统提供的<code class="codeph">DEFAULT_PLAN</code>激活资源管理器。</p>
                           <div class="infoboxnote" id="GUID-A07045A4-2A62-4233-AF00-BD98641EB224__GUID-E32B7ED8-AE1F-4C73-934C-EC7BF92A53E4">
                              <p class="notep1">注意：</p>
                              <p><code class="codeph">ORA$AUTOTASK</code>使用者组与维护期间自动运行的维护任务共享。因此，当为自动统计信息收集激活并发时，数据库会自动管理资源，而无需额外的步骤。
                              </p>
                           </div>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-A07045A4-2A62-4233-AF00-BD98641EB224__GUID-695BA61B-EEA0-4079-AF51-57CB3585A815">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ADMIN11841" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a> ，了解资源管理器</p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9" title="默认情况下，按顺序收集分区表的每个分区。">关于并发统计信息收集</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div><a id="TGSQL431"></a><a id="TGSQL94632"></a><a id="TGSQL430"></a><div class="props_rev_3"><a id="GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11" name="GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11"></a><h5 id="TGSQL-GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11" class="sect5"><span class="enumeration_section">13.3.7.2</span>启用并发统计信息收集</h5>
                     <div>
                        <p>要启用并发统计信息收集，请使用<code class="codeph">DBMS_STATS.SET_GLOBAL_PREFS</code>过程来设置<code class="codeph">CONCURRENT</code>首选项。
                        </p>
                        <div class="section">
                           <p>可能的值如下：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">手册</code></p>
                                 <p>仅为手动统计信息收集启用并发。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">自动</code></p>
                                 <p>仅为自动统计信息收集启用并发。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">所有</code></p>
                                 <p>为手动和自动统计信息收集启用了并发。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">关闭</code></p>
                                 <p>手动和自动统计信息收集都禁用并发。这是默认值。</p>
                              </li>
                           </ul>
                           <p>本节中的本教程介绍了如何启用并发统计信息收集。</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11__GUID-F8316888-F567-4A76-B673-7FC2845BA570">先决条件</p>
                           <p>本教程具有以下先决条件：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>除了收集统计信息的标准权限外，您还必须具有以下权限：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><code class="codeph">创造工作</code></p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">管理计划员</code></p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">管理任何队列</code></p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p><code class="codeph">SYSAUX</code>表空间必须处于联机状态，因为调度程序在此表空间中存储其内部表和视图。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">JOB_QUEUE_PROCESSES</code>初始化参数必须至少设置为<code class="codeph">4</code> 。
                                 </p>
                              </li>
                              <li>
                                 <p>必须启用资源管理器。</p>
                                 <p>默认情况下，资源管理器已禁用。如果您没有资源计划，请考虑使用系统提供的<code class="codeph">DEFAULT_PLAN</code>启用资源管理器。</p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11__GUID-7B94D593-B0E8-4F0D-8DBF-8AA4518C4C85">假设</p>
                           <p>本教程假定您要执行以下操作：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>启用并发统计信息收集</p>
                              </li>
                              <li>
                                 <p>收集<code class="codeph">sh</code>架构的统计信息</p>
                              </li>
                              <li>
                                 <p>监控<code class="codeph">sh</code>统计数据的收集</p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11__GUID-4F36DFA7-CEEF-4DBB-8384-E974589E71FF">要启用并发统计信息收集：</p>
                           <ol>
                              <li>
                                 <p>使用适当的权限将SQL * Plus连接到数据库，然后启用资源管理器。</p>
                                 <p>以下示例使用资源管理器的默认计划：</p><pre class="pre codeblock"><code>ALTER SYSTEM SET RESOURCE_MANAGER_PLAN ='DEFAULT_PLAN';</code></pre></li>
                              <li>
                                 <p>将<code class="codeph">JOB_QUEUE_PROCESSES</code>初始化参数设置为CPU内核数量的至少两倍。
                                 </p>
                                 <p>在Oracle Real Application Clusters中， <code class="codeph">JOB_QUEUE_PROCESSES</code>设置适用于每个节点。
                                 </p>
                                 <p>假设系统有4个CPU核心。以下示例将参数设置为<code class="codeph">8</code> （核心数的两倍）：</p><pre class="pre codeblock"><code>ALTER SYSTEM SET JOB_QUEUE_PROCESSES = 8;</code></pre></li>
                              <li>
                                 <p>确认参数更改生效。</p>
                                 <p>例如，在SQL * Plus中输入以下命令（包括示例输出）：</p><pre class="pre codeblock"><code>显示参数过程; NAME TYPE VALUE -------------------------------- ----------- ---- -  _high_priority_processes字符串VKTM aq_tm_processes整数1 db_writer_processes整数1 gcs_server_processes整数0 global_txn_processes整数1 job_queue_processes整数8 log_archive_max_processes整数4进程整数100</code></pre></li>
                              <li>
                                 <p>启用并发统计。</p>
                                 <p>例如，执行以下PL / SQL匿名块：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.SET_GLOBAL_PREFS（'CONCURRENT'，'ALL'）;结束; /</code></pre></li>
                              <li>
                                 <p>确认已启用统计信息。</p>
                                 <p>例如，执行以下查询（包括示例输出）：</p><pre class="pre codeblock"><code>从DUAL中选择DBMS_STATS.GET_PREFS（'CONCURRENT'）; DBMS_STATS.GET_PREFS（'CONCURRENT'）---------------------------------- ALL</code></pre></li>
                              <li>
                                 <p>收集<code class="codeph">SH</code>模式的统计信息。
                                 </p>
                                 <p>例如，执行以下过程：</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.GATHER_SCHEMA_STATS（'SH'）;</code></pre></li>
                              <li>
                                 <p>在单独的会话中，通过查询<code class="codeph">DBA_OPTSTAT_OPERATION_TASKS</code>来监视作业进度。</p>
                                 <p>例如，执行以下查询（包括示例输出）：</p><pre class="pre codeblock"><code>SET LINESIZE 1000 COLUMN TARGET FORMAT a8 COLUMN TARGET_TYPE FORMAT a25 COLUMN JOB_NAME FORMAT a14 COLUMN START_TIME FORMAT a40 SELECT TARGET，TARGET_TYPE，JOB_NAME，TO_CHAR（START_TIME，'dd-mon-yyyy hh24：mi：ss'）FROM DBA_OPTSTAT_OPERATION_TASKS WHERE STATUS ='IN PROGRESS'和OPID =（从DBA_OPTSTAT_OPERATIONS中选择MAX（ID），其中OPERATION ='gather_schema_stats'）; TARGET TARGET_TYPE JOB_NAME TO_CHAR（START_TIME，'--------- ------------------------- -------- ------ -------------------- SH.SALES TABLE（仅限全球统计）ST $ T292_1_B29 30-nov-2012 14:22:47 SH。销售表（COORDINATOR JOB）ST $ SD290_1_B10 30-nov-2012 14:22:08</code></pre></li>
                              <li>
                                 <p>在原始会话中，禁用并发统计信息收集。</p>
                                 <p>例如，执行以下查询：</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.SET_GLOBAL_PREFS（'CONCURRENT'，'OFF'）;</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                        <div class="section"></div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11__GUID-9AFAD145-71AE-4CD8-92EF-3E6D16EF83FB">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451" title="您可以使用数据字典视图监视统计信息收集作业。">监控统计数据收集操作</a> ”</span></p>
                              </li>
                              <li>
                                 <p> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ADMIN11890" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a></p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-A17C466D-1DC0-422E-9E63-063CBAFFBC13" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a> ，了解如何使用<code class="codeph">DBMS_STATS.SET_GLOBAL_PREFS</code>过程</p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-3D36585C-5850-402E-9DB5-2EE9AAAD8C36" title="Oracle数据库可以同时收集多个表或分区的统计信息。">同时收集优化程序统计信息</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL433"></a><div class="props_rev_3"><a id="GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451" name="GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451"></a><h5 id="TGSQL-GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451" class="sect5"><span class="enumeration_section">13.3.7.3</span>监控统计信息收集操作</h5>
                     <div>
                        <p>您可以使用数据字典视图监视统计信息收集作业。</p>
                        <div class="section">
                           <p>以下观点是相关的：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../refrn/DBA_OPTSTAT_OPERATION_TASKS.html#REFRN23868" target="_blank"><code class="codeph">DBA_OPTSTAT_OPERATION_TASKS</code></a></p>
                                 <p>此视图包含作为统计信息收集操作的一部分执行或当前正在执行的任务的历史记录（记录在<code class="codeph">DBA_OPTSTAT_OPERATIONS</code> ）。每个任务表示要在相应的父操作中处理的目标对象。
                                 </p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN23463" target="_blank"><code class="codeph">DBA_OPTSTAT_OPERATIONS</code></a></p>
                                 <p>此视图包含使用<code class="codeph">DBMS_STATS</code>包在表，模式和数据库级别执行或当前正在执行的统计信息操作的历史记录。
                                 </p>
                              </li>
                           </ul>
                           <p>上述视图中的<code class="codeph">TARGET</code>列以下列形式显示该统计信息收集作业的目标对象：</p><pre class="pre codeblock"><code>一世</code></pre><p>收集作业名称的所有统计信息都以字符串<code class="codeph">ST$</code>开头。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451__GUID-77440505-DBBE-4CB5-8869-48CD9065CA2F">要显示当前运行的统计信息任务和作业：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>要列出从所有用户会话收集当前正在运行的任务的统计信息，请使用以下SQL语句（包括示例输出）：</p><pre class="pre codeblock"><code>SELECT OPID，TARGET，JOB_NAME，（SYSTIMESTAMP  -  START_TIME）AS elapsed_time FROM DBA_OPTSTAT_OPERATION_TASKS WHERE STATUS ='IN PROGRESS'; OPID TARGET JOB_NAME ELAPSED_TIME ---- ------------------------- ------------- ---- ---------------------- 981 SH.SALES.SALES_Q4_1998 ST $ T82_1_B29 +000000000 00：00：00.596321 981 SH.SALES ST $ SD80_1_B10 +000000000 00:00 ：27.972033</code></pre></li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451__GUID-A4683D06-FFAE-42EF-8ED6-1FC336897E1C">要显示已完成的统计任务和作业：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>要仅列出特定操作中已完成的任务和作业，请首先根据统计信息收集操作名称，目标和开始时间从<code class="codeph">DBA_OPTSTAT_OPERATIONS</code>视图中识别操作ID。确定操作ID后，可以查询<code class="codeph">DBA_OPTSTAT_OPERATION_TASKS</code>视图以查找该操作中的相应任务</p>
                                 <p>例如，要列出ID为981的操作，请在SQL * Plus中使用以下命令（包括示例输出）：</p><pre class="pre codeblock"><code>VARIABLE id NUMBER EXEC：id：= 981 SELECT TARGET，JOB_NAME，（END_TIME  -  START_TIME）AS ELAPSED_TIME FROM DBA_OPTSTAT_OPERATION_TASKS WHERE STATUS &lt;&gt;'IN PROGRESS'且OPID =：id; TARGET JOB_NAME ELAPSED_TIME ------------------------- ------------- --------- ----------------- SH.SALES_TRANSACTIONS_EXT +000000000 00：00：45.479233 SH.CAL_MONTH_SALES_MV ST $ SD88_1_B10 +000000000 00：00：45.382764 SH.CHANNELS ST $ SD88_1_B10 +000000000 00： 00：45.307397</code></pre></li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451__GUID-62624B18-45D2-4751-B306-C51A3F64B2EC">要显示已失败的统计信息收集任务和作业：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>使用以下SQL语句（包括部分示例输出）：</p><pre class="pre codeblock"><code>SET LONG 10000 SELECT TARGET，JOB_NAME，（END_TIME  -  START_TIME）AS ELAPSED_TIME，注释来自DBA_OPTSTAT_OPERATION_TASKS，其中STATUS ='FAILED'; TARGET JOB_NAME ELAPSED_TIME NOTES ------------------ -------- -------------------- ------ ---------------------- SYS.OPATCH_XML_INV +000000007 02：36：31.130314 &lt;错误&gt; ORA-20011：近似NDV失败：ORA -29913：错误。。。
</code></pre></li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451__GUID-4032F5C7-07F1-4ABF-BCF4-185BDBDD9E8E">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN23348" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">DBA_SCHEDULER_JOBS</code>视图</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-3D36585C-5850-402E-9DB5-2EE9AAAD8C36" title="Oracle数据库可以同时收集多个表或分区的统计信息。">同时收集优化程序统计信息</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL413"></a><div class="props_rev_3"><a id="GUID-63E195EB-10F4-428B-9912-3E98C2A957BF" name="GUID-63E195EB-10F4-428B-9912-3E98C2A957BF"></a><h4 id="TGSQL-GUID-63E195EB-10F4-428B-9912-3E98C2A957BF" class="sect4"><span class="enumeration_section">13.3.8</span>收集分区对象的增量统计信息</h4>
                  <div>
                     <p>增量统计信息仅扫描已更改的分区。通过从分区级统计信息中获取全局统计信息来收集大分区表的统计信息时， <strong class="term">增量统计信息维护</strong>可提高性能。
                     </p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-7BECE839-ACC5-4768-8BE6-A16AAD14A9ED">增量统计的目的</a><br>在典型情况下，应用程序将数据加载到范围分区表的新分区中。当应用程序添加新分区和加载数据时，数据库必须收集有关新分区的统计信息并使全局统计信息保持最新。
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47">DBMS_STATS如何为分区表导出全局统计信息</a><br>启用增量统计信息维护时， <code class="codeph">DBMS_STATS</code>收集统计信息并为更改的分区创建概要。数据库还自动将分区级概要合并到全局概要中，并从分区级统计信息和全局概要中派生全局统计信息。
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-766CCB67-3CE7-47D5-83A8-BADFA08DBB60">收集分区表的统计信息：基本步骤</a><br>本节介绍如何收集分区表的优化程序统计信息。
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-4A96081D-97DF-4C26-91E7-C25D18160FA1">维护分区维护操作的增量统计信息</a><br><strong class="term">分区维护操作</strong>是与分区相关的操作，例如添加，交换，合并或拆分表分区。
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-84FA133B-1F62-48FA-ACD2-203C1BFF4FF5">维护具有过时或锁定分区统计信息的表的增量统计信息</a><br>从<span>Oracle Database 12c开始</span> ，增量统计信息可以自动计算分区表的全局统计信息，即使分区或子分区统计信息已过时且已锁定。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" title="作为自动统计信息收集的替代或补充，您可以使用DBMS_STATS包手动收集优化程序统计信息。">手动收集优化程序统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL95046"></a><div class="props_rev_3"><a id="GUID-7BECE839-ACC5-4768-8BE6-A16AAD14A9ED" name="GUID-7BECE839-ACC5-4768-8BE6-A16AAD14A9ED"></a><h5 id="TGSQL-GUID-7BECE839-ACC5-4768-8BE6-A16AAD14A9ED" class="sect5"><span class="enumeration_section">13.3.8.1</span>增量统计的目的</h5>
                     <div>
                        <p>在典型情况下，应用程序将数据加载到范围分区表的新分区中。当应用程序添加新分区和加载数据时，数据库必须收集有关新分区的统计信息并使全局统计信息保持最新。</p>
                        <p>通常，数据仓库应用程序访问大型分区表。这些表通常在日期列上进行分区，只有最近的分区会经常发生DML更改。如果没有增量统计信息，统计信息收集通常使用两遍方法：</p>
                        <ol>
                           <li>
                              <p>数据库扫描表以收集全局统计信息。</p>
                              <p>用于全局统计信息收集的表的完整扫描可能非常昂贵，具体取决于表的大小。当表添加分区时， <code class="codeph">GATHER_TABLE_STATS</code>的执行时间越长，因为全局统计信息需要全表扫描。即使只有一小部分分区发生更改，数据库也必须执行整个表的扫描。
                              </p>
                           </li>
                           <li>
                              <p>数据库扫描已更改的分区以收集其分区级统计信息。</p>
                           </li>
                        </ol>
                        <p>增量维护为数据仓库应用程序提供了巨大的性能优势，原因如下：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>数据库必须仅扫描一次表以收集分区统计信息，并通过聚合分区级统计信息来派生全局统计信息。因此，数据库避免了不使用增量统计信息时所需的<span class="italic">两次</span>完整扫描：一次扫描用于分区级统计信息，一次扫描用于全局级统计信息。
                              </p>
                           </li>
                           <li>
                              <p>在后续的统计信息收集中，数据库只需扫描过时的分区并更新其统计信息（包括概要）。数据库可以从新分区统计信息中获取全局统计信息，从而节省全表扫描。</p>
                           </li>
                        </ul>
                        <p>使用增量统计信息时，数据库仍必须收集有关将更改全局或表级统计信息的任何分区的统计信息。增量统计维护产生与从头开始收集表统计信息相同的统计信息，但性能更好。</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-63E195EB-10F4-428B-9912-3E98C2A957BF" title="增量统计信息仅扫描已更改的分区。通过从分区级统计信息中获取全局统计信息来收集大分区表的统计信息时，增量统计信息维护可提高性能。">收集分区对象的增量统计信息</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95048"></a><a id="TGSQL95047"></a><div class="props_rev_3"><a id="GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47" name="GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47"></a><h5 id="TGSQL-GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47" class="sect5"><span class="enumeration_section">13.3.8.2</span> DBMS_STATS如何为分区表<span class="enumeration_section">导出</span>全局统计信息</h5>
                     <div>
                        <p>启用增量统计信息维护时， <code class="codeph">DBMS_STATS</code>收集统计信息并为更改的分区创建概要。数据库还自动将分区级概要合并到全局概要中，并从分区级统计信息和全局概要中派生全局统计信息。
                        </p>
                        <p>通过从分区级统计信息中获取某些全局统计信息，数据库在计算全局统计信息时避免了全表扫描。例如，全局级别的行数是分区行数的总和。甚至全局直方图也可以从分区直方图中导出。</p>
                        <p>但是，数据库无法从分区级统计信息（包括列的<a href="glossary.html#GUID-34DC46FD-32CE-4242-8ED9-945AE7A9F922"><span class="xrefglossterm">NDV）</span></a>派生<span class="italic">所有</span>统计信息。以下示例显示表中两个分区的NDV：</p>
                        <div class="tblformal" id="GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47__GUID-4DADA3A8-7FC7-4346-A485-EB92D03F5271">
                           <p class="titleintable">表13-3两个分区的NDV</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="两个分区的NDV" width="100%" border="1" summary="This 3 column table provides a DV example. Column 1 is the object. Column 2 lists the column values. Column 3 is the NDV. " frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="20%" id="d74756e5741">宾语</th>
                                    <th align="left" valign="bottom" width="20%" id="d74756e5743">列值</th>
                                    <th align="left" valign="bottom" width="20%" id="d74756e5745">NDV</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e5749" headers="d74756e5741 ">分区1</td>
                                    <td align="left" valign="top" width="20%" headers="d74756e5749 d74756e5743 ">1,3,3,4,5</td>
                                    <td align="left" valign="top" width="20%" headers="d74756e5749 d74756e5745 ">4</td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e5756" headers="d74756e5741 ">分区2</td>
                                    <td align="left" valign="top" width="20%" headers="d74756e5756 d74756e5743 ">2,3,4,5,6</td>
                                    <td align="left" valign="top" width="20%" headers="d74756e5756 d74756e5745 ">五</td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>通过添加各个分区的NDV来计算表中的NDV会产生9的NDV，这是不正确的。因此，需要更精确的技术：概要。</p>
                        <p>本节包含以下主题：</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-F2454C04-A250-444E-AB7B-0B9ED6F2E2B2">分区级别概要</a><br><span class="bold">概要</span>是一种特殊类型的统计信息，用于跟踪分区中每列的不同值（NDV）的数量。您可以将概要视为内部管理结构，对不同的值进行采样。
                           </li>
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-EA02EA33-9E0E-4E32-8C74-5943908D0537">NDV算法：自适应采样和HyperLogLog</a><br>从<span>Oracle Database 12c</span> Release 2（12.2）开始，HyperLogLog算法可以提高NDV（不同值的数量）计算性能，还可以减少概要所需的存储空间。
                           </li>
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-D134B7F3-0EC2-4A03-8998-0286B9FF7A29">使用概要汇总全球统计数据：示例</a><br>在此示例中，数据库收集<code class="codeph">sales</code>表的初始六个分区的统计信息，然后为每个分区（ <code class="codeph">S1</code> ， <code class="codeph">S2</code>等）创建概要。数据库通过聚合分区级统计信息和概要来创建全局统计信息。
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-63E195EB-10F4-428B-9912-3E98C2A957BF" title="增量统计信息仅扫描已更改的分区。通过从分区级统计信息中获取全局统计信息来收集大分区表的统计信息时，增量统计信息维护可提高性能。">收集分区对象的增量统计信息</a></p>
                           </div>
                        </div>
                     </div>
                     
                     <div class="sect5"><a id="GUID-F2454C04-A250-444E-AB7B-0B9ED6F2E2B2" name="GUID-F2454C04-A250-444E-AB7B-0B9ED6F2E2B2"></a><h6 id="TGSQL-GUID-F2454C04-A250-444E-AB7B-0B9ED6F2E2B2" class="sect6"><span class="enumeration_section">13.3.8.2.1</span>分区级别概要</h6>
                        <div>
                           <p><span class="bold">概要</span>是一种特殊类型的统计信息，用于跟踪分区中每列的不同值（NDV）的数量。您可以将概要视为内部管理结构，对不同的值进行采样。
                           </p>
                           <p>通过合并分区级别概要，数据库可以准确地为每列导出全局级NDV。在<a href="gathering-optimizer-statistics.html#GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47__GUID-4DADA3A8-7FC7-4346-A485-EB92D03F5271" title="这3列表提供了DV示例。第1列是对象。第2列列出了列值。第3列是NDV。">表13-3</a>所示的示例中，数据库可以使用概要来计算列的NDV为6。
                           </p>
                           <p>每个分区都以增量模式维护一个概要。将新分区添加到表时，您只需收集新分区的统计信息。数据库通过将新分区概要与现有分区的概要聚合来自动更新全局统计信息。随后的统计信息收集操作比不使用概要时更快。</p>
                           <p>数据库在<code class="codeph">SYSAUX</code>表空间中存储数据字典表<code class="codeph">WRI$_OPTSTAT_SYNOPSIS_HEAD$</code>和<code class="codeph">WRI$_OPTSTAT_SYNOPSIS$</code>中的<code class="codeph">WRI$_OPTSTAT_SYNOPSIS$</code> 。<code class="codeph">DBA_PART_COL_STATISTICS</code>字典视图包含分区中列统计信息的信息。如果<code class="codeph">NOTES</code>列包含关键字<code class="codeph">INCREMENTAL</code> ，则此列具有概要。
                           </p>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-F2454C04-A250-444E-AB7B-0B9ED6F2E2B2__GUID-C7BF3FA1-20D3-4EB0-AD35-44CCEF22FAA3">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-151E541C-C4D8-4F61-BD49-248E82D252BE" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解有关<code class="codeph">DBA_PART_COL_STATISTICS</code>更多信息</p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47" title="启用增量统计信息维护时，DBMS_STATS仅收集统计信息并为更改的分区创建概要。数据库还自动将分区级概要合并到全局概要中，并从分区级统计信息和全局概要中派生全局统计信息。">DBMS_STATS如何为分区表导出全局统计信息</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-EA02EA33-9E0E-4E32-8C74-5943908D0537" name="GUID-EA02EA33-9E0E-4E32-8C74-5943908D0537"></a><h6 id="TGSQL-GUID-EA02EA33-9E0E-4E32-8C74-5943908D0537" class="sect6"><span class="enumeration_section">13.3.8.2.2</span> NDV算法：自适应采样和HyperLogLog</h6>
                        <div>
                           <p>从<span>Oracle Database 12c</span> Release 2（12.2）开始，HyperLogLog算法可以提高NDV（不同值的数量）计算性能，还可以减少概要所需的存储空间。
                           </p>
                           <p>用于计算NDV的传统算法使用<strong class="term">自适应采样</strong> 。概要是不同值的样本。在计算NDV时，数据库最初将每个不同的值存储在哈希表中。每个不同的值占用一个不同的散列桶，因此具有5000个不同值的列具有5000个散列桶。然后，数据库将散列桶的数量减半，然后继续将结果减半，直到剩余少量桶。该算法是“自适应的”，因为采样率基于散列表分割的数量而改变。
                           </p>
                           <p>要计算列的NDV，数据库使用以下公式，其中<span class="italic">B</span>是执行所有拆分后剩余的散列桶数， <span class="italic">S</span>是拆分数：</p><pre class="pre codeblock"><code>NDV = B * 2 ^ S.</code></pre><p>自适应采样产生准确的NDV统计数据，但具有以下结果：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>概要占用大量磁盘空间，尤其是当表有许多列和分区，并且每列中的NDV很高时。</p>
                                 <p>例如，一个60列的表可能有300,000个分区，平均每列NDV为5,000。在此示例中，每个分区都有300,000个条目（60 x 5000）。总的来说，概要表有900亿个条目（300,000平方），占用至少720 GB的存储空间。</p>
                              </li>
                              <li>
                                 <p>批量处理概要可能会对性能产生负面影响。</p>
                                 <p>在数据库重新分配过时分区的统计信息之前，它必须删除关联的概要。批量删除可能会很慢，因为它会生成大量的撤消和重做数据。</p>
                              </li>
                           </ul>
                           <p>与动态采样相比，HyperLogLog算法使用随机化技术。虽然算法很复杂，但基本的见解是在随机值流中， <span class="italic">n个</span>不同的值平均间隔1 / <span class="italic">n</span> 。因此，如果您知道流中的最小值，则可以粗略估计不同值的数量。例如，如果值的范围从0到1，并且如果观察到的最小值是.2，那么数字将平均均匀间隔.2，因此NDV估计值为5。
                           </p>
                           <p>HyperLogLog算法扩展并校正原始估计。数据库将散列函数应用于每个列值，从而生成一组与列相同基数的散列值。对于基础估计，NDV等于2 <sup>n</sup> ，其中<span class="italic">n</span>是在散列值的二进制表示中观察到的最大尾随零数。数据库通过使用部分输出将值拆分为不同的散列桶来优化其NDV估计。
                           </p>
                           <p>HyperLogLog算法优于自适应采样的优点是：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>新算法的准确性与原算法类似。</p>
                              </li>
                              <li>
                                 <p>所需的内存<span class="italic">显着</span>降低，这通常会导致概要大小的大幅减少。
                                 </p>
                                 <p>当存在许多分区时，概要会变大，并且它们具有许多具有高NDV的列。使用HyperLogLog算法的概要更紧凑。创建和删除概要会影响批处理运行时间。管理分区的任何操作过程都会缩短运行时间。</p>
                              </li>
                           </ul>
                           <p><code class="codeph">DBMS_STATS</code>首选项<code class="codeph">APPROXIMATE_NDV_ALGORITHM</code>确定数据库用于NDV计算的算法。
                           </p>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-EA02EA33-9E0E-4E32-8C74-5943908D0537__GUID-7B79EEA5-D76A-4D82-A896-316F78E188F2">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-2C00FE80-1553-404C-85B6-220895561FE8" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">APPROXIMATE_NDV_ALGORITHM</code>首选项</p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47" title="启用增量统计信息维护时，DBMS_STATS仅收集统计信息并为更改的分区创建概要。数据库还自动将分区级概要合并到全局概要中，并从分区级统计信息和全局概要中派生全局统计信息。">DBMS_STATS如何为分区表导出全局统计信息</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-D134B7F3-0EC2-4A03-8998-0286B9FF7A29" name="GUID-D134B7F3-0EC2-4A03-8998-0286B9FF7A29"></a><h6 id="TGSQL-GUID-D134B7F3-0EC2-4A03-8998-0286B9FF7A29" class="sect6"><span class="enumeration_section">13.3.8.2.3</span>使用概要汇总全局统计：示例</h6>
                        <div>
                           <p>在此示例中，数据库收集<code class="codeph">sales</code>表的初始六个分区的统计信息，然后为每个分区（ <code class="codeph">S1</code> ， <code class="codeph">S2</code>等）创建概要。数据库通过聚合分区级统计信息和概要来创建全局统计信息。
                           </p>
                           <div class="figure" id="GUID-D134B7F3-0EC2-4A03-8998-0286B9FF7A29__GUID-A6A99CAC-C075-4CE9-B313-0D0B701FB31E">
                              <p class="titleinfigure">图13-2聚合统计信息</p><img src="img/tgsql_vm_074.png" alt="下面是图13-2的描述" title="下面是图13-2的描述" longdesc="img_text/tgsql_vm_074.html"><br><a href="img_text/tgsql_vm_074.html">“图13-2聚合统计”的描述</a></div>
                           <!-- class="figure" -->
                           <p>下图显示了一个新分区，其中包含5月24日的数据，并添加到<code class="codeph">sales</code>表中。数据库收集新添加的分区的统计信息，检索其他分区的概要，然后聚合概要以创建全局统计信息。
                           </p>
                           <div class="figure" id="GUID-D134B7F3-0EC2-4A03-8998-0286B9FF7A29__GUID-56238B04-687D-4951-AD6D-6BE9E3C93E7B">
                              <p class="titleinfigure">图13-3添加分区后聚合统计信息</p><img src="img/tgsql_vm_075.png" alt="下面是图13-3的描述" title="下面是图13-3的描述" longdesc="img_text/tgsql_vm_075.html"><br><a href="img_text/tgsql_vm_075.html">“图13-3添加分区后聚合统计信息”的说明</a></div>
                           <!-- class="figure" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47" title="启用增量统计信息维护时，DBMS_STATS仅收集统计信息并为更改的分区创建概要。数据库还自动将分区级概要合并到全局概要中，并从分区级统计信息和全局概要中派生全局统计信息。">DBMS_STATS如何为分区表导出全局统计信息</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-766CCB67-3CE7-47D5-83A8-BADFA08DBB60" name="GUID-766CCB67-3CE7-47D5-83A8-BADFA08DBB60"></a><h5 id="TGSQL-GUID-766CCB67-3CE7-47D5-83A8-BADFA08DBB60" class="sect5"><span class="enumeration_section">13.3.8.3</span>收集分区表的统计信息：基本步骤</h5>
                     <div>
                        <p>本节介绍如何收集分区表的优化程序统计信息。</p>
                        <p>本节包含以下主题：</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-C4BFFEEB-28D2-420C-A864-305C4334183B">增量统计维护的注意事项</a><br>启用增量统计维护会产生一些后果。
                           </li>
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-75AD8460-A5F6-43B1-ADE0-4AD77AF72274">使用SET_TABLE_PREFS启用增量统计</a><br>要为分区表启用增量统计信息维护，请使用<code class="codeph">DBMS_STATS.SET_TABLE_PREFS</code>将<code class="codeph">INCREMENTAL</code>值设置为<code class="codeph">true</code> 。当<code class="codeph">INCREMENTAL</code>设置为<code class="codeph">false</code> （默认值）时，数据库使用全表扫描来维护全局统计信息。
                           </li>
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-813375EE-1F69-4083-A4CF-C52CBD6F9D4C">关于APPROXIMATE_NDV_ALGORITHM设置</a><br><code class="codeph">DBMS_STATS.APPROXIMATE_NDV_ALGORITHM</code>首选项指定概要生成算法，HyperLogLog或自适应采样。<code class="codeph">INCREMENTAL_STALENESS</code>首选项控制数据库何时重新格式化使用自适应采样格式的概要。
                           </li>
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-61C14F44-2893-44B4-8300-E5A6C262DE58">配置概要生成：示例</a><br>这些示例显示了将概要切换到新的HyperLogLog格式的不同方法，包括保守和积极的方法。
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-63E195EB-10F4-428B-9912-3E98C2A957BF" title="增量统计信息仅扫描已更改的分区。通过从分区级统计信息中获取全局统计信息来收集大分区表的统计信息时，增量统计信息维护可提高性能。">收集分区对象的增量统计信息</a></p>
                           </div>
                        </div>
                     </div>
                     <a id="TGSQL95049"></a><div class="props_rev_3"><a id="GUID-C4BFFEEB-28D2-420C-A864-305C4334183B" name="GUID-C4BFFEEB-28D2-420C-A864-305C4334183B"></a><h6 id="TGSQL-GUID-C4BFFEEB-28D2-420C-A864-305C4334183B" class="sect6"><span class="enumeration_section">13.3.8.3.1</span>增量统计维护的注意事项</h6>
                        <div>
                           <p>启用增量统计维护会产生一些后果。</p>
                           <p>具体请注意以下事项：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>如果表使用复合分区，则数据库仅收集已修改子分区的统计信息。对于未修改的子分区，数据库不会在子分区级别收集统计信息。通过这种方式，数据库通过跳过未修改的分区来减少工作量。</p>
                              </li>
                              <li>
                                 <p>如果表使用增量统计信息，并且此表具有本地分区索引，则数据库将收集全局级别的索引统计信息以及已修改（未修改）的索引分区。数据库不会从分区级索引统计信息生成全局索引统计信息。相反，数据库通过执行完整索引扫描来收集全局索引统计信息。</p>
                              </li>
                              <li>
                                 <p><a href="glossary.html#GUID-9BAA7917-D479-4DCF-85B2-5B4BE0F891EE"><span class="xrefglossterm">混合分区表</span></a>包含内部和外部分区。仅对于内部分区，DDL更改将调用各个分区和表本身的增量统计信息维护。例如，如果<code class="codeph">june18</code>是内部分区，那么<code class="codeph">ALTER TABLE ...MODIFY PARTITION jun18 ...</code>在统计数据收集期间触发增量统计维护;但是，如果<code class="codeph">june18</code>是外部分区，则不会进行增量维护。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">SYSAUX</code>表空间占用额外空间来维护分区表的全局统计信息。
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-C4BFFEEB-28D2-420C-A864-305C4334183B__GUID-A03902F0-BB84-4990-8955-FCDA34986679">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-09CFA3CD-66B7-4CDF-A086-6958D113BDD1" target="_blank"><span><cite>Oracle Database VLDB和分区指南</cite></span></a> ，了解如何创建混合分区表</p>
                                 </li>
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-01FAB8ED-E4A3-4C3E-8FE2-88717DCDDA06" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以了解有关<code class="codeph">DBMS_STATS</code>更多信息</p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-766CCB67-3CE7-47D5-83A8-BADFA08DBB60" title="本节介绍如何收集分区表的优化程序统计信息。">收集分区表的统计信息：基本步骤</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-75AD8460-A5F6-43B1-ADE0-4AD77AF72274" name="GUID-75AD8460-A5F6-43B1-ADE0-4AD77AF72274"></a><h6 id="TGSQL-GUID-75AD8460-A5F6-43B1-ADE0-4AD77AF72274" class="sect6"><span class="enumeration_section">13.3.8.3.2</span>使用SET_TABLE_PREFS启用增量统计</h6>
                        <div>
                           <p>要为分区表启用增量统计信息维护，请使用<code class="codeph">DBMS_STATS.SET_TABLE_PREFS</code>将<code class="codeph">INCREMENTAL</code>值设置为<code class="codeph">true</code> 。当<code class="codeph">INCREMENTAL</code>设置为<code class="codeph">false</code> （默认值）时，数据库使用全表扫描来维护全局统计信息。
                           </p>
                           <div class="p">要使数据库通过<span class="italic">仅</span>扫描已更改的分区来逐步更新全局统计信息，必须满足以下条件：<ul style="list-style-type:disc">
                                 <li>
                                    <p>分区表的<code class="codeph">PUBLISH</code>值为<code class="codeph">true</code> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p>分区表的<code class="codeph">INCREMENTAL</code>值为<code class="codeph">true</code> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p>收集过程中的统计数据必须指定<code class="codeph">AUTO_SAMPLE_SIZE</code>为<code class="codeph">ESTIMATE_PERCENT</code>和<code class="codeph">AUTO</code>的<code class="codeph">GRANULARITY</code> 。</p>
                                 </li>
                              </ul>
                           </div>
                           <!-- class="section" -->
                           <div class="example" id="GUID-75AD8460-A5F6-43B1-ADE0-4AD77AF72274__GUID-0360CF84-1EBC-4060-8E18-D8D5663E85F5">
                              <p class="titleinexample">示例13-3启用增量统计信息</p>
                              <p>假设分区表<code class="codeph">sh.sales</code>的<code class="codeph">PUBLISH</code>值为<code class="codeph">true</code> 。以下程序为此表启用增量统计信息：</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.SET_TABLE_PREFS（'sh'，'sales'，'INCREMENTAL'，'TRUE'）;</code></pre></div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-766CCB67-3CE7-47D5-83A8-BADFA08DBB60" title="本节介绍如何收集分区表的优化程序统计信息。">收集分区表的统计信息：基本步骤</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-813375EE-1F69-4083-A4CF-C52CBD6F9D4C" name="GUID-813375EE-1F69-4083-A4CF-C52CBD6F9D4C"></a><h6 id="TGSQL-GUID-813375EE-1F69-4083-A4CF-C52CBD6F9D4C" class="sect6"><span class="enumeration_section">13.3.8.3.3</span>关于APPROXIMATE_NDV_ALGORITHM设置</h6>
                        <div>
                           <p><code class="codeph">DBMS_STATS.APPROXIMATE_NDV_ALGORITHM</code>首选项指定概要生成算法，HyperLogLog或自适应采样。<code class="codeph">INCREMENTAL_STALENESS</code>首选项控制数据库何时重新格式化使用自适应采样格式的概要。
                           </p>
                           <div class="section"><code class="codeph">APPROXIMATE_NDV_ALGORITHM</code>首选项具有以下可能值：<ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">重复或HYPERLOGLOG</code></p>
                                    <p>这是默认值。如果在表上启用了<code class="codeph">INCREMENTAL</code> ，则数据库将保留使用自适应采样算法的任何现有概要的格式。但是，数据库会以HyperLogLog格式创建任何新的概要。当现有性能可接受时，此方法很有吸引力，并且您不希望产生重新格式化旧内容的性能成本。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">自适应采样</code></p>
                                    <p>数据库对所有概要使用自适应采样算法。这是最保守的选择。</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">HYPERLOGLOG</code></p>
                                    <p>数据库使用HyperLogLog算法来处理所有新的和过时的概要。</p>
                                 </li>
                              </ul>
                              <p><code class="codeph">INCREMENTAL_STALENESS</code>首选项控制何时将概要视为过时。当<code class="codeph">APPROXIMATE_NDV_ALGORITHM</code>首选项设置为<code class="codeph">HYPERLOGLOG</code> ，则应用以下<code class="codeph">INCREMENTAL_STALENESS</code>设置：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">ALLOW_MIXED_FORMAT</code></p>
                                    <p>这是默认值。如果指定此值，如果满足以下条件，则数据库<span class="italic">不</span>考虑现有的自适应采样梗概为失效：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p>概要很新鲜。</p>
                                       </li>
                                       <li>
                                          <p>您手动收集统计信息。</p>
                                       </li>
                                    </ul>
                                    <p>因此，传统和HyperLogLog格式的概要可以共存。但是，随着时间的推移，自动统计信息收集作业将重新统计使用旧格式的概要，并将其替换为HyperLogLog格式的概要。这样，自动统计收集作业逐渐逐步淘汰旧格式。手动统计信息收集作业不会重新格式化使用自适应采样格式的概要。</p>
                                 </li>
                                 <li>
                                    <p>空值</p>
                                    <p>具有遗留格式的概要的任何分区都被认为是陈旧的，这会<span class="italic">立即</span>触发数据库重新收集过时概要的统计信息。优点是性能成本只出现一次。缺点是重新收集大型表的所有统计信息可能会占用大量资源。
                                    </p>
                                 </li>
                              </ul>
                           </div>
                           <!-- class="section" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-766CCB67-3CE7-47D5-83A8-BADFA08DBB60" title="本节介绍如何收集分区表的优化程序统计信息。">收集分区表的统计信息：基本步骤</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-61C14F44-2893-44B4-8300-E5A6C262DE58" name="GUID-61C14F44-2893-44B4-8300-E5A6C262DE58"></a><h6 id="TGSQL-GUID-61C14F44-2893-44B4-8300-E5A6C262DE58" class="sect6"><span class="enumeration_section">13.3.8.3.4</span>配置概要生成：示例</h6>
                        <div>
                           <p>这些示例显示了将概要切换到新的HyperLogLog格式的不同方法，包括保守和积极的方法。</p>
                           <div class="example" id="GUID-61C14F44-2893-44B4-8300-E5A6C262DE58__GUID-D70A1148-229D-4E40-ADF3-C9FB8D5C3053">
                              <p class="titleinexample">例13-4采取保守的方法重新格式化概要</p>
                              <p>在此示例中，您允许混合格式的概要与<code class="codeph">sh.sales</code>表共存。混合格式产生的准确度较低。不过，你<span class="italic">不需要</span> regather为表的所有分区的统计信息。
                              </p>
                              <p>要确保所有新的和过时的概要都使用HyperLogLog算法，请将<code class="codeph">APPROXIMATE_NDV_ALGORITHM</code>首选项设置为<code class="codeph">HYPERLOGLOG</code> 。要确保自动统计信息收集作业逐步重新格式化过时的概要，请将<code class="codeph">INCREMENTAL_STALENESS</code>首选项设置为<code class="codeph">ALLOW_MIXED_FORMAT</code> 。</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.SET_TABLE_PREFS（ownname =&gt;'sh'，tabname =&gt;'sales'，pname =&gt;'approximate_ndv_algorithm'，pvalue =&gt;'hyperloglog'）; DBMS_STATS.SET_TABLE_PREFS（ownname =&gt;'sh'，tabname =&gt;'sales'，pname =&gt;'incremental_staleness'，pvalue =&gt;'allow_mixed_format'）;结束;</code></pre></div>
                           <!-- class="example" -->
                           <div class="example" id="GUID-61C14F44-2893-44B4-8300-E5A6C262DE58__TAKINGANAGGRESSIVEAPPROACHTOREFORMA-012B5571">
                              <p class="titleinexample">例13-5采取积极的方法重新格式化概要</p>
                              <p>在此示例中，强制所有概要对<code class="codeph">sh.sales</code>表使用HyperLogLog算法。在这种情况下，数据库必须重新收集表的所有分区的统计信息。
                              </p>
                              <p>要确保所有新的和过时的概要都使用HyperLogLog算法，请将<code class="codeph">APPROXIMATE_NDV_ALGORITHM</code>首选项设置为<code class="codeph">HYPERLOGLOG</code> 。要强制数据库立即重新收集表中所有分区的统计信息并以新格式存储它们，请将<code class="codeph">INCREMENTAL_STALENESS</code>首选项设置为null。
                              </p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.SET_TABLE_PREFS（ownname =&gt;'sh'，tabname =&gt;'sales'，pname =&gt;'approximate_ndv_algorithm'，pvalue =&gt;'hyperloglog'）; DBMS_STATS.SET_TABLE_PREFS（ownname =&gt;'sh'，tabname =&gt;'sales'，pname =&gt;'incremental_staleness'，pvalue =&gt;'null'）;结束;</code></pre></div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-766CCB67-3CE7-47D5-83A8-BADFA08DBB60" title="本节介绍如何收集分区表的优化程序统计信息。">收集分区表的统计信息：基本步骤</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div><a id="TGSQL94920"></a><a id="TGSQL94860"></a><div class="props_rev_3"><a id="GUID-4A96081D-97DF-4C26-91E7-C25D18160FA1" name="GUID-4A96081D-97DF-4C26-91E7-C25D18160FA1"></a><h5 id="TGSQL-GUID-4A96081D-97DF-4C26-91E7-C25D18160FA1" class="sect5"><span class="enumeration_section">13.3.8.4</span>维护分区维护操作的增量统计信息</h5>
                     <div>
                        <p><strong class="term">分区维护操作</strong>是与分区相关的操作，例如添加，交换，合并或拆分表分区。
                        </p>
                        <div class="section">
                           <p>Oracle数据库为增量统计信息维护提供以下支持：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>如果分区维护操作触发统计信息收集，则数据库可以重用先前已使用旧段删除的概要。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">DBMS_STATS</code>可以在非分区表上创建概要。概要使数据库能够将增量统计信息作为分区交换操作的一部分进行维护，而无需在交换后显式收集分区的统计信息。
                                 </p>
                              </li>
                           </ul>
                           <p>当<code class="codeph">DBMS_STATS</code>首选项<code class="codeph">INCREMENTAL</code>在表上设置为<code class="codeph">true</code>时， <code class="codeph">INCREMENTAL_LEVEL</code>首选项控制收集哪些摘要以及何时收集。此首选项采用以下值：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">表</code></p>
                                 <p><code class="codeph">DBMS_STATS</code>在此表上收集表级别概要。您只能在表级别将<code class="codeph">INCREMENTAL_LEVEL</code>设置为<code class="codeph">TABLE</code> ，而不是在架构，数据库或全局级别。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">PARTITION</code> （默认）</p>
                                 <p><code class="codeph">DBMS_STATS</code>仅在分区表的分区级别收集概要。
                                 </p>
                              </li>
                           </ul>
                           <p>当执行分区交换，要有提要之后被交换分区的交换，设置<code class="codeph">INCREMENTAL</code> ，以<code class="codeph">true</code>和<code class="codeph">INCREMENTAL_LEVEL</code>以<code class="codeph">TABLE</code>对表进行分区进行交换。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-4A96081D-97DF-4C26-91E7-C25D18160FA1__GUID-30D53601-0CFE-4FEF-A5F8-D41AA20B328F">假设</p>
                           <p>本教程假设以下内容：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>您想在<code class="codeph">sales</code>表中加载空分区<code class="codeph">p_sales_01_2010</code> 。
                                 </p>
                              </li>
                              <li>
                                 <p>您创建一个临时表<code class="codeph">t_sales_01_2010</code> ，然后填充该表。
                                 </p>
                              </li>
                              <li>
                                 <p>您希望数据库在分区交换操作中维护增量统计信息，而不必在交换后显式收集分区的统计信息。</p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-4A96081D-97DF-4C26-91E7-C25D18160FA1__GUID-AC04DA87-C0D0-435F-B171-B4FC399C9CE7">要在分区交换操作中维护增量统计信息：</p>
                           <ol>
                              <li>
                                 <p>为登台表<code class="codeph">t_sales_01_2010</code>设置增量统计信息首选项。
                                 </p>
                                 <p>例如，运行以下语句：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.SET_TABLE_PREFS（ownname =&gt;'sh'，tabname =&gt;'t_sales_01_2010'，pname =&gt;'INCREMENTAL'，pvalue =&gt;'true'）; DBMS_STATS.SET_TABLE_PREFS（ownname =&gt;'sh'，tabname =&gt;'t_sales_01_2010'，pname =&gt;'INCREMENTAL_LEVEL'，pvalue =&gt;'table'）;结束;</code></pre></li>
                              <li>
                                 <p>收集登台表<code class="codeph">t_sales_01_2010</code>统计信息。
                                 </p>
                                 <p>例如，运行以下PL / SQL代码：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.GATHER_TABLE_STATS（ownname =&gt;'SH'，tabname =&gt;'T_SALES_01_2010'）;结束; /</code></pre><p><code class="codeph">DBMS_STATS</code>在<code class="codeph">t_sales_01_2010</code>上收集表级别概要。
                                 </p>
                              </li>
                              <li>
                                 <p>确保<code class="codeph">sh.sales</code>表上的<code class="codeph">INCREMENTAL</code>首选项为<code class="codeph">true</code> 。
                                 </p>
                                 <p>例如，运行以下PL / SQL代码：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.SET_TABLE_PREFS（ownname =&gt;'sh'，tabname =&gt;'sales'，pname =&gt;'INCREMENTAL'，pvalue =&gt;'true'）;结束; /</code></pre></li>
                              <li>
                                 <p>如果在<code class="codeph">INCREMENTAL</code>设置为<code class="codeph">true</code>之前从未收集有关<code class="codeph">sh.sales</code>统计信息，则收集要交换的分区的统计信息。
                                 </p>
                                 <p>例如，运行以下PL / SQL代码：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.GATHER_TABLE_STATS（ownname =&gt;'sh'，tabname =&gt;'sales'，pname =&gt;'p_sales_01_2010'，pvalue =&gt; granularity =&gt;'partition'）;结束; /</code></pre></li>
                              <li>
                                 <p>执行分区交换。</p>
                                 <p>例如，使用以下SQL语句：</p><pre class="pre codeblock"><code>ALTER TABLE sales EXCHANGE PARTITION p_sales_01_2010 WITH TABLE t_sales_01_2010;</code></pre><p>在交换之后，分区表具有分区<code class="codeph">p_sales_01_2010</code>统计信息和概要。
                                 </p>
                                 <p>在<span>Oracle Database 12c</span>之前的版本中，前面的语句将<code class="codeph">p_sales_01_2010</code>的段数据和统计信息与<code class="codeph">t_sales_01_2010</code> 。数据库没有维护非分区表的概要，例如<code class="codeph">t_sales_01_2010</code> 。要收集分区表的全局统计信息，需要重新扫描<code class="codeph">p_sales_01_2010</code>分区以获取其概要。
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-4A96081D-97DF-4C26-91E7-C25D18160FA1__GUID-7C45B371-5427-4ABA-8F1D-D9ECE840EFC2">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-CDAA4742-5398-4A64-B871-E39F38D0021F" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解有关<code class="codeph">DBMS_STATS.SET_TABLE_PREFS</code>更多信息</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-63E195EB-10F4-428B-9912-3E98C2A957BF" title="增量统计信息仅扫描已更改的分区。通过从分区级统计信息中获取全局统计信息来收集大分区表的统计信息时，增量统计信息维护可提高性能。">收集分区对象的增量统计信息</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL94921"></a><a id="TGSQL94863"></a><div class="props_rev_3"><a id="GUID-84FA133B-1F62-48FA-ACD2-203C1BFF4FF5" name="GUID-84FA133B-1F62-48FA-ACD2-203C1BFF4FF5"></a><h5 id="TGSQL-GUID-84FA133B-1F62-48FA-ACD2-203C1BFF4FF5" class="sect5"><span class="enumeration_section">13.3.8.5</span>维护具有过时或锁定分区统计信息的表的增量统计信息</h5>
                     <div>
                        <p>从<span>Oracle Database 12c开始</span> ，增量统计信息可以自动计算分区表的全局统计信息，即使分区或子分区统计信息已过时且已锁定。
                        </p>
                        <div class="section">
                           <p>在<span>Oracle Database 12c</span>之前的版本中启用增量统计信息时，如果分区上发生任何DML，则优化程序会将此分区的统计信息视为过时。因此， <code class="codeph">DBMS_STATS</code>必须再次收集统计信息以准确汇总全局统计信息。此外，如果DML发生在其统计信息被锁定的分区上，则<code class="codeph">DBMS_STATS</code>无法重新收集分区上的统计信息，因此全表扫描是收集全局统计信息的唯一方法。重新收集统计信息会产生性能开销。
                           </p>
                           <p>在<span>Oracle Database 12c中</span> ，统计信息首选项<code class="codeph">INCREMENTAL_STALENESS</code>控制数据库如何确定分区或子分区上的统计信息是否过时。此首选项采用以下值：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">USE_STALE_PERCENT</code></p>
                                 <p>如果DML更改小于为表指定的<code class="codeph">STALE_PERCENT</code>首选项，则分区或子分区不会被视为过时。<code class="codeph">STALE_PERCENT</code>的默认值为<code class="codeph">10</code> ，这意味着如果DML导致超过10％的行更改，则该表被视为过时。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">USE_LOCKED_STATS</code></p>
                                 <p>无论DML更改如何，锁定的分区或子分区统计信息都不会被视为过时。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">NULL</code> （默认）</p>
                                 <p>如果分区或子分区有任何DML更改，则该分区或子分区被视为过时。此行为与<span>Oracle Database 11g</span>行为相同。使用默认值时，以增量模式收集的统计信息将保证与在非增量模式下收集的统计信息相同。使用非默认值时，以增量模式收集的统计信息可能不如在非增量模式下收集的统计信息准确。
                                 </p>
                              </li>
                           </ul>
                           <p>您可以一起指定<code class="codeph">USE_STALE_PERCENT</code>和<code class="codeph">USE_LOCKED_STATS</code> 。例如，您可以编写以下匿名块：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.SET_TABLE_PREFS（ownname =&gt; null，table_name =&gt;'t'，pname =&gt;'incremental_staleness'，pvalue =&gt;'use_stale_percent，use_locked_stats'）;结束;</code></pre></div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-84FA133B-1F62-48FA-ACD2-203C1BFF4FF5__GUID-02FEC71F-B906-4468-803D-E06A24CB6090">假设</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>本教程假设以下内容：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>分区表的<code class="codeph">STALE_PERCENT</code>设置为<code class="codeph">10</code> 。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">INCREMENTAL</code>值设置为<code class="codeph">true</code> 。
                                 </p>
                              </li>
                              <li>
                                 <p>该表之前已在<code class="codeph">INCREMENTAL</code>模式中收集了统计信息。
                                 </p>
                              </li>
                              <li>
                                 <p>您希望了解统计信息收集的更改方式，具体取决于<code class="codeph">INCREMENTAL_STALENESS</code>的设置，统计信息是否已锁定以及DML更改的百分比。
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-84FA133B-1F62-48FA-ACD2-203C1BFF4FF5__GUID-ACB47378-90CD-470B-9C70-00C6809AE893">要测试具有过时或锁定分区统计信息的表：</p>
                           <ol>
                              <li>
                                 <p>将<code class="codeph">INCREMENTAL_STALENESS</code>设置为<code class="codeph">NULL</code> 。</p>
                                 <p>之后，由于DML活动，一个分区中5％的行发生了变化。</p>
                              </li>
                              <li>
                                 <p>使用<code class="codeph">DBMS_STATS</code>收集表的统计信息。
                                 </p>
                                 <p><code class="codeph">DBMS_STATS</code>分配具有5％DML活动的分区的统计信息，并逐步维护全局统计信息。
                                 </p>
                              </li>
                              <li>
                                 <p>将<code class="codeph">INCREMENTAL_STALENESS</code>设置为<code class="codeph">USE_STALE_PERCENT</code> 。</p>
                                 <p>之后，由于DML活动，一个分区中5％的行发生了变化。</p>
                              </li>
                              <li>
                                 <p>使用<code class="codeph">DBMS_STATS</code>收集表的统计信息。
                                 </p>
                                 <p> <code class="codeph">DBMS_STATS</code> <span class="italic">不</span> regather对于有DML活动（因为变化是在10％的陈旧程度阈值）的分区统计，并逐步维护全局统计信息。
                                 </p>
                              </li>
                              <li>
                                 <p>锁定分区统计信息。</p>
                                 <p>之后，由于DML活动，一个分区中20％的行发生了变化。</p>
                              </li>
                              <li>
                                 <p>使用<code class="codeph">DBMS_STATS</code>收集表的统计信息。
                                 </p>
                                 <p><code class="codeph">DBMS_STATS</code>因为统计被锁定<span class="italic">不</span> regather的分区统计信息。数据库使用全表扫描收集全局统计信息。
                                 </p>
                                 <p>之后，由于DML活动，一个分区中5％的行发生了变化。</p>
                              </li>
                              <li>
                                 <p>使用<code class="codeph">DBMS_STATS</code>收集表的统计信息。
                                 </p>
                                 <p>收集此表的统计信息时， <code class="codeph">DBMS_STATS</code>不会重新收集分区的统计信息，因为它们不会被视为过时。数据库使用此分区的现有统计信息以增量方式维护全局统计信息。
                                 </p>
                              </li>
                              <li>
                                 <p>将<code class="codeph">INCREMENTAL_STALENESS</code>设置为<code class="codeph">USE_LOCKED_STATS</code>和<code class="codeph">USE_STALE_PERCENT</code> 。</p>
                                 <p>之后，由于DML活动，一个分区中20％的行发生了变化。</p>
                              </li>
                              <li>
                                 <p>使用<code class="codeph">DBMS_STATS</code>收集表的统计信息。
                                 </p>
                                 <p>由于设置了<code class="codeph">USE_LOCKED_STATS</code> ， <code class="codeph">DBMS_STATS</code>忽略了统计信息过时并使用锁定统计信息的事实。数据库使用此分区的现有统计信息以增量方式维护全局统计信息。
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-84FA133B-1F62-48FA-ACD2-203C1BFF4FF5__GUID-017C8070-4B8D-4790-9CDA-FAC24E409940">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-CDAA4742-5398-4A64-B871-E39F38D0021F" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解有关<code class="codeph">DBMS_STATS.SET_TABLE_PREFS</code>更多信息</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-63E195EB-10F4-428B-9912-3E98C2A957BF" title="增量统计信息仅扫描已更改的分区。通过从分区级统计信息中获取全局统计信息来收集大分区表的统计信息时，增量统计信息维护可提高性能。">收集分区对象的增量统计信息</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div><a id="TGSQL434"></a><div class="props_rev_3"><a id="GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" name="GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31"></a><h3 id="TGSQL-GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" class="sect3"><span class="enumeration_section">13.4</span>手动收集系统统计信息</h3>
               <div>
                  <p>系统统计信息描述优化程序的硬件特征，例如I / O和CPU性能和利用率。</p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-69E0AEFD-5C03-4EB6-B3CC-CD07153759E6">关于系统统计</a><br>系统统计信息衡量CPU和存储的性能，以便优化器在评估计划时可以使用这些输入。
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-BABC67C0-F851-4849-906E-E2588CFD7F2B">收集系统统计指南</a><br>除非有充分的理由手动收集，否则Oracle建议使用系统统计信息的默认值。
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-E5731E8E-3382-4E6A-9986-2508721631E3">使用DBMS_STATS收集系统统计信息</a><br>要手动收集系统统计信息，请使用<code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code>过程。
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-C4F0B12B-2C9E-4050-B647-F7DC451D7878">删除系统统计信息</a><br><code class="codeph">DBMS_STATS.DELETE_SYSTEM_STATS</code>过程删除系统统计信息。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-245F23B2-24AF-44D8-9F12-99FD1215E878" title="本章介绍如何使用DBMS_STATS.GATHER _ * _ STATS程序单元。">收集优化程序统计信息</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-69E0AEFD-5C03-4EB6-B3CC-CD07153759E6" name="GUID-69E0AEFD-5C03-4EB6-B3CC-CD07153759E6"></a><h4 id="TGSQL-GUID-69E0AEFD-5C03-4EB6-B3CC-CD07153759E6" class="sect4"><span class="enumeration_section">13.4.1</span>关于系统统计信息</h4>
                  <div>
                     <p>系统统计信息衡量CPU和存储的性能，以便优化器在评估计划时可以使用这些输入。</p>
                     <p>执行查询时，它会占用CPU。在许多情况下，查询也会占用存储子系统资源。典型查询中的每个计划可能会占用不同比例的CPU和I / O.使用<a href="glossary.html#GUID-7FCF0F80-65B5-4F76-A521-91ABD109DA17"><span class="xrefglossterm">成本</span></a>度量标准，优化程序会选择其估计最快执行的计划。如果优化器知道CPU和存储的速度，那么它可以对每个替代计划的成本做出更精细的判断。
                     </p>
                     <p>下图显示了具有三个可能计划的查询。每个计划使用不同数量的CPU和I / O.为了这个例子，优化器已经为Plan 1分配了最低的成本。</p>
                     <div class="figure" id="GUID-69E0AEFD-5C03-4EB6-B3CC-CD07153759E6__GUID-06A60BA0-9CC5-4748-8D81-323C232D1CCC"><img src="img/mm-3242_tgsql_pb_001b.png" alt="下面是mm-3242_tgsql_pb_001b.eps的说明" title="下面是mm-3242_tgsql_pb_001b.eps的说明" longdesc="img_text/mm-3242_tgsql_pb_001b.html"><br><a href="img_text/mm-3242_tgsql_pb_001b.html">插图说明mm-3242_tgsql_pb_001b.eps</a></div>
                     <!-- class="figure" -->
                     <p>数据库在第一次启动时自动收集称为noworkload统计信息的基本系统统计信息。通常，只有在升级硬件配置的某些方面时，这些特性才会发生变化。</p>
                     <p>下图显示添加高性能存储后的同一数据库。通过收集系统统计信息，优化程序可以将存储性能考虑在内。在此示例中，高性能存储显着降低了计划2和计划3的相对成本。计划1仅显示边际改进，因为它使用较少的I / O.现在已将计划3分配为最低成本。</p>
                     <div class="figure" id="GUID-69E0AEFD-5C03-4EB6-B3CC-CD07153759E6__GUID-16307460-B1B9-43D9-8C03-4D482775D117"><img src="img/mm-3242_tgsql_pb_002b.png" alt="下面是mm-3242_tgsql_pb_002b.eps的说明" title="下面是mm-3242_tgsql_pb_002b.eps的说明" longdesc="img_text/mm-3242_tgsql_pb_002b.html"><br><a href="img_text/mm-3242_tgsql_pb_002b.html">插图说明mm-3242_tgsql_pb_002b.eps</a></div>
                     <!-- class="figure" -->
                     <p>在具有快速I / O基础结构的系统上，系统统计信息会增加查询通过索引访问方法选择表扫描的概率。</p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" title="系统统计信息描述优化程序的硬件特征，例如I / O和CPU性能和利用率。">手动收集系统统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL436"></a><div class="props_rev_3"><a id="GUID-BABC67C0-F851-4849-906E-E2588CFD7F2B" name="GUID-BABC67C0-F851-4849-906E-E2588CFD7F2B"></a><h4 id="TGSQL-GUID-BABC67C0-F851-4849-906E-E2588CFD7F2B" class="sect4"><span class="enumeration_section">13.4.2</span>收集系统统计指南</h4>
                  <div>
                     <p>除非有充分的理由手动收集，否则Oracle建议使用系统统计信息的默认值。</p>
                     <div class="section">
                        <p>系统统计信息对性能很重要，因为它们会影响数据库中执行的<span class="italic">每个</span> SQL语句。更改系统统计信息可能会以意外或不需要的方式更改SQL执行计划。因此，Oracle建议在更改系统统计信息之前仔细考虑这些选项。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BABC67C0-F851-4849-906E-E2588CFD7F2B__GUID-E6162C47-EC8F-4C5A-A6DF-C146E76884EC">何时考虑手动收集系统统计信息</p>
                        <p>如果您使用的是Oracle Exadata，并且数据库正在运行纯数据仓库负载，那么使用<code class="codeph">EXADATA</code>选项收集系统统计信息可以在某些情况下帮助提高性能，因为表扫描更受青睐。但是，即使在Exadata上，默认设置也适用于大多数工作负载。
                        </p>
                        <p>如果您未使用Oracle Exadata，并且选择手动收集系统统计信息，则Oracle建议执行以下操作：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>在环境中发生物理更改时收集系统统计信息，例如，服务器获得更快的CPU，更多内存或不同的磁盘存储。Oracle建议您在存储上创建未被任何其他表空间使用的新表空间后收集noworkload统计信息。</p>
                           </li>
                           <li>
                              <p>在系统具有最常见的工作负载时捕获统计信息。收集工作负载统计信息不会产生额外的开销。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BABC67C0-F851-4849-906E-E2588CFD7F2B__GUID-8A588E7D-9018-42F8-B976-22FE2984A869">何时考虑使用默认统计信息</p>
                        <p>在大多数情况下，Oracle建议使用系统统计信息的默认值。要将系统统计信息重置为其默认值，请执行<code class="codeph">DBMS_STATS.DELETE_SYSTEM_STATS</code> ，然后关闭并重新打开数据库。为确保使用适当的默认值，还建议在新创建的数据库上执行此步骤。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" title="系统统计信息描述优化程序的硬件特征，例如I / O和CPU性能和利用率。">手动收集系统统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-E5731E8E-3382-4E6A-9986-2508721631E3" name="GUID-E5731E8E-3382-4E6A-9986-2508721631E3"></a><h4 id="TGSQL-GUID-E5731E8E-3382-4E6A-9986-2508721631E3" class="sect4"><span class="enumeration_section">13.4.3</span>使用DBMS_STATS收集系统统计信息</h4>
                  <div>
                     <p>要手动收集系统统计信息，请使用<code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code>过程。
                     </p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23">关于GATHER_SYSTEM_STATS程序</a><br><code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code>过程分析指定时间段内的活动（ <strong class="term">工作负载统计信息</strong> ）或模拟工作负载（ <strong class="term">noworkload统计信息</strong> ）。
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-46A36510-4BAF-43B8-8C65-B1B2D6B17916">收集工作量统计信息</a><br>Oracle建议您在数据库具有最典型的工作负载时使用<code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code>来捕获统计信息。
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-4E99C958-71B0-4DC4-BF2A-33244BEFE46D">收集Noworkload统计信息</a><br>Noworkload统计信息捕获I / O系统的特征。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" title="系统统计信息描述优化程序的硬件特征，例如I / O和CPU性能和利用率。">手动收集系统统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL435"></a><a id="TGSQL94865"></a><div class="props_rev_3"><a id="GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23" name="GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23"></a><h5 id="TGSQL-GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23" class="sect5"><span class="enumeration_section">13.4.3.1</span>关于GATHER_SYSTEM_STATS过程</h5>
                     <div>
                        <p><code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code>过程分析指定时间段内的活动（ <strong class="term">工作负载统计信息</strong> ）或模拟工作负载（ <strong class="term">noworkload统计信息</strong> ）。
                        </p>
                        <p><code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code>的输入参数是：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">NOWORKLOAD</code></p>
                              <p>优化程序仅根据系统特征收集统计信息，而不考虑工作负载。</p>
                           </li>
                           <li>
                              <p><code class="codeph">间隔</code></p>
                              <p>在指定的分钟数过后，优化程序将在数据字典或替代表（由<code class="codeph">stattab</code>指定）中更新系统统计信息。统计信息基于指定时间间隔内的系统活动。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">START</code>和<code class="codeph">STOP</code></p>
                              <p><code class="codeph">START</code>启动收集统计信息。<code class="codeph">STOP</code>计算经过时间段（自<code class="codeph">START</code> ）的统计信息，并刷新数据字典或替代表（由<code class="codeph">stattab</code>指定）。优化器忽略<code class="codeph">INTERVAL</code> 。</p>
                           </li>
                           <li>
                              <p><code class="codeph">EXADATA</code></p>
                              <p>系统统计信息考虑使用Exadata提供的独特功能，例如大I / O大小和高I / O吞吐量。优化器设置多块读取计数和I / O吞吐量统计信息以及CPU速度。</p>
                           </li>
                        </ul>
                        <p>下表列出了<code class="codeph">DBMS_STATS</code>收集的优化程序系统统计信息以及用于收集或手动设置特定系统统计信息的选项。
                        </p>
                        <div class="tblformalwide" id="GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23__CHDJHGGG">
                           <p class="titleintable">表13-4 DBMS_STATS包中的优化器系统统计信息</p>
                           <table cellpadding="4" cellspacing="0" class="FormalWide" title="DBMS_STATS包中的优化器系统统计信息" width="100%" border="1" summary="This table describes the optimizer system statistics gathered by the DBMS_STATS package and explains when and how the statistics can be gathered." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="20%" id="d74756e8683">参数名称</th>
                                    <th align="left" valign="bottom" width="20%" id="d74756e8686">描述</th>
                                    <th align="left" valign="bottom" width="20%" id="d74756e8689">初始化</th>
                                    <th align="left" valign="bottom" width="20%" id="d74756e8692">收集或设置统计信息的选项</th>
                                    <th align="left" valign="bottom" width="20%" id="d74756e8695">单元</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e8700" headers="d74756e8683 ">
                                       <p><code class="codeph">cpuspeedNW</code></p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8700 d74756e8686 ">
                                       <p>表示noworkload CPU速度。CPU速度是每秒的平均CPU周期数。</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8700 d74756e8689 ">
                                       <p>在系统启动时</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8700 d74756e8692 ">
                                       <p>设置<code class="codeph">gathering_mode</code> = <code class="codeph">NOWORKLOAD</code>或手动设置统计信息。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8700 d74756e8695 ">
                                       <p>百万/秒</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e8723" headers="d74756e8683 ">
                                       <p><code class="codeph">IOSEEKTIM</code></p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8723 d74756e8686 ">
                                       <p>表示定位磁头以读取数据所需的时间。I / O寻道时间等于寻道时间+延迟时间+操作系统开销时间。</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8723 d74756e8689 ">
                                       <p>在系统启动时</p>
                                       <p>10（默认）</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8723 d74756e8692 ">
                                       <p>设置<code class="codeph">gathering_mode</code> = <code class="codeph">NOWORKLOAD</code>或手动设置统计信息。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8723 d74756e8695 ">
                                       <p>女士</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e8748" headers="d74756e8683 ">
                                       <p><code class="codeph">IOTFRSPEED</code></p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8748 d74756e8686 ">
                                       <p>表示Oracle数据库可以在单个读取请求中读取数据的速率。</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8748 d74756e8689 ">
                                       <p>在系统启动时</p>
                                       <p>4096（默认）</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8748 d74756e8692 ">
                                       <p>设置<code class="codeph">gathering_mode</code> = <code class="codeph">NOWORKLOAD</code>或手动设置统计信息。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8748 d74756e8695 ">
                                       <p>字节/ MS</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e8773" headers="d74756e8683 ">
                                       <p><code class="codeph">CPUSPEED</code></p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8773 d74756e8686 ">
                                       <p>表示工作负载CPU速度。CPU速度是每秒的平均CPU周期数。</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8773 d74756e8689 ">
                                       <p>没有</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8773 d74756e8692 ">
                                       <p>设置<code class="codeph">gathering_mode</code> = <code class="codeph">NOWORKLOAD</code> ， <code class="codeph">INTERVAL</code>或<code class="codeph">START|STOP</code> ，或手动设置统计信息。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8773 d74756e8695 ">
                                       <p>百万/秒</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e8802" headers="d74756e8683 ">
                                       <p><code class="codeph">maxthr</code></p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8802 d74756e8686 ">
                                       <p>最大I / O吞吐量是I / O子系统可以提供的最大吞吐量。</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8802 d74756e8689 ">
                                       <p>没有</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8802 d74756e8692 ">
                                       <p>设置<code class="codeph">gathering_mode</code> = <code class="codeph">NOWORKLOAD</code> ， <code class="codeph">INTERVAL</code>或<code class="codeph">START|STOP</code> ，或手动设置统计信息。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8802 d74756e8695 ">
                                       <p>字节/秒</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e8831" headers="d74756e8683 ">
                                       <p><code class="codeph">slavethr</code></p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8831 d74756e8686 ">
                                       <p>从属I / O吞吐量是平均并行执行服务器I / O吞吐量。</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8831 d74756e8689 ">
                                       <p>没有</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8831 d74756e8692 ">
                                       <p>设置<code class="codeph">gathering_mode</code> = <code class="codeph">INTERVAL</code>或<code class="codeph">START|STOP</code> ，或手动设置统计信息。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8831 d74756e8695 ">
                                       <p>字节/秒</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e8857" headers="d74756e8683 ">
                                       <p><code class="codeph">sreadtim</code></p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8857 d74756e8686 ">
                                       <p>单块读取时间是随机读取单个块的平均时间。</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8857 d74756e8689 ">
                                       <p>没有</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8857 d74756e8692 ">
                                       <p>设置<code class="codeph">gathering_mode</code> = <code class="codeph">INTERVAL</code>或<code class="codeph">START|STOP</code> ，或手动设置统计信息。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8857 d74756e8695 ">
                                       <p>女士</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e8883" headers="d74756e8683 ">
                                       <p><code class="codeph">mreadtim</code></p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8883 d74756e8686 ">
                                       <p>多块读取是顺序读取多块的平均时间。</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8883 d74756e8689 ">
                                       <p>没有</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8883 d74756e8692 ">
                                       <p>设置<code class="codeph">gathering_mode</code> = <code class="codeph">INTERVAL</code>或<code class="codeph">START|STOP</code> ，或手动设置统计信息。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8883 d74756e8695 ">
                                       <p>女士</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e8909" headers="d74756e8683 ">
                                       <p><code class="codeph">MBRC</code></p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8909 d74756e8686 ">
                                       <p>多块计数是顺序的平均多块读取计数。</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8909 d74756e8689 ">
                                       <p>没有</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8909 d74756e8692 ">
                                       <p>设置<code class="codeph">gathering_mode</code> = <code class="codeph">INTERVAL</code>或<code class="codeph">START|STOP</code> ，或手动设置统计信息。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8909 d74756e8695 ">
                                       <p>块</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23__GUID-C33BC8C2-333A-4EF9-AB7E-E27AE65270F0">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS059" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>有关<code class="codeph">DBMS_STATS</code>包中用于收集和删除系统统计信息的过程的详细信息</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-E5731E8E-3382-4E6A-9986-2508721631E3" title="要手动收集系统统计信息，请使用DBMS_STATS.GATHER_SYSTEM_STATS过程。">使用DBMS_STATS收集系统统计信息</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL437"></a><div class="props_rev_3"><a id="GUID-46A36510-4BAF-43B8-8C65-B1B2D6B17916" name="GUID-46A36510-4BAF-43B8-8C65-B1B2D6B17916"></a><h5 id="TGSQL-GUID-46A36510-4BAF-43B8-8C65-B1B2D6B17916" class="sect5"><span class="enumeration_section">13.4.3.2</span>收集工作量统计信息</h5>
                     <div>
                        <p>Oracle建议您在数据库具有最典型的工作负载时使用<code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code>来捕获统计信息。
                        </p>
                        <p>例如，数据库应用程序可以在白天处理OLTP事务并在晚上生成OLAP报告。</p>
                        <p>本节包含以下主题：</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-FB1B9F70-C417-4CC5-8F46-1ECDE2326D66">关于工作量统计</a><br>工作负载统计信息分析指定时间段内的活动。
                           </li>
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-90149651-4244-483C-93AF-D73387B0AF6F">启动和停止系统统计信息收集</a><br>本教程介绍如何使用<code class="codeph">GATHER_SYSTEM_STATS</code>的<code class="codeph">START</code>和<code class="codeph">STOP</code>参数设置工作负载间隔。</li>
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-3E84E773-1D87-46E8-8592-3B5E3CAC2712">在指定的时间间隔内收集系统统计信息</a><br>本教程介绍如何使用<code class="codeph">GATHER_SYSTEM_STATS</code>的<code class="codeph">INTERVAL</code>参数设置工作负载间隔。</li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-E5731E8E-3382-4E6A-9986-2508721631E3" title="要手动收集系统统计信息，请使用DBMS_STATS.GATHER_SYSTEM_STATS过程。">使用DBMS_STATS收集系统统计信息</a></p>
                           </div>
                        </div>
                     </div>
                     <a id="TGSQL439"></a><a id="TGSQL438"></a><div class="props_rev_3"><a id="GUID-FB1B9F70-C417-4CC5-8F46-1ECDE2326D66" name="GUID-FB1B9F70-C417-4CC5-8F46-1ECDE2326D66"></a><h6 id="TGSQL-GUID-FB1B9F70-C417-4CC5-8F46-1ECDE2326D66" class="sect6"><span class="enumeration_section">13.4.3.2.1</span>关于工作负载统计信息</h6>
                        <div>
                           <p>工作负载统计信息分析指定时间段内的活动。</p>
                           <p>工作负载统计信息包括<a href="gathering-optimizer-statistics.html#GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23__CHDJHGGG" title="此表描述了DBMS_STATS包收集的优化程序系统统计信息，并说明了何时以及如何收集统计信息。">表13-4中</a>列出的以下统计信息：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>单块（ <code class="codeph">sreadtim</code> ）和多块（ <code class="codeph">mreadtim</code> ）读取时间</p>
                              </li>
                              <li>
                                 <p>多块计数（ <code class="codeph">mbrc</code> ）</p>
                              </li>
                              <li>
                                 <p>CPU速度（ <code class="codeph">cpuspeed</code> ）</p>
                              </li>
                              <li>
                                 <p>最大系统吞吐量（ <code class="codeph">maxthr</code> ）</p>
                              </li>
                              <li>
                                 <p>平均并行执行吞吐量（ <code class="codeph">slavethr</code> ）</p>
                              </li>
                           </ul>
                           <p>数据库通过比较从工作负载的开始到结束的两个时间点之间的物理顺序和随机读取的数量来计算<code class="codeph">sreadtim</code> ， <code class="codeph">mreadtim</code>和<code class="codeph">mbrc</code> 。数据库通过缓冲区缓存完成同步读取请求时更改的计数器实现这些值。
                           </p>
                           <p>由于计数器位于缓冲区高速缓存中，因此它们不仅包括I / O延迟，还包括与锁存器争用和任务切换相关的等待。因此，工作负载统计信息取决于工作负载窗口期间的系如果系统受I / O限制（锁存器争用和I / O吞吐量），则在数据库使用统计信息后，统计信息将促进较少的I / O密集型计划。</p>
                           <p><a href="gathering-optimizer-statistics.html#GUID-FB1B9F70-C417-4CC5-8F46-1ECDE2326D66__CHDIGAIC">如图13-4</a>所示，如果收集工作负载统计信息，则优化程序将使用为工作负载统计信息收集的<code class="codeph">mbrc</code>值来估计全表扫描的成本。
                           </p>
                           <div class="figure" id="GUID-FB1B9F70-C417-4CC5-8F46-1ECDE2326D66__CHDIGAIC">
                              <p class="titleinfigure">图13-4工作负载统计计数器</p><img src="img/tgsql_vm_019.png" alt="下面是图13-4的描述" title="下面是图13-4的描述" longdesc="img_text/tgsql_vm_019.html"><br><a href="img_text/tgsql_vm_019.html">“图13-4工作负载统计计数器”的说明</a></div>
                           <!-- class="figure" -->
                           <p>收集工作负载统计信息时，如果在串行工作负载期间没有发生表扫描，则数据库可能无法收集<code class="codeph">mbrc</code>和<code class="codeph">mreadtim</code>值，这是OLTP系统的典型情况。但是，DSS系统上经常会发生全表扫描。这些扫描可以并行运行并绕过缓冲区缓存。在这种情况下，数据库仍然收集<code class="codeph">sreadtim</code>因为索引查找使用缓冲区缓存。
                           </p>
                           <p>如果数据库无法收集或验证收集的<code class="codeph">mbrc</code>或<code class="codeph">mreadtim</code>值，但已收集了<code class="codeph">sreadtim</code>和<code class="codeph">cpuspeed</code> ，则数据库仅使用<code class="codeph">sreadtim</code>和<code class="codeph">cpuspeed</code>进行成本核算。在这种情况下，优化程序使用初始化参数<code class="codeph">DB_FILE_MULTIBLOCK_READ_COUNT</code>的值来进行全表扫描。但是，如果<code class="codeph">DB_FILE_MULTIBLOCK_READ_COUNT</code>为<code class="codeph">0</code>或未设置，则优化程序使用值<code class="codeph">8</code>来计算成本。
                           </p>
                           <p>使用<code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code>过程收集工作负载统计信息。<code class="codeph">GATHER_SYSTEM_STATS</code>过程使用经过时间段的统计信息刷新数据字典或临时表。要设置集合的持续时间，请使用以下任一技术：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>指定<code class="codeph">START</code>工作负载窗口的开头，然后在工作负载窗口结束时<code class="codeph">STOP</code> 。
                                 </p>
                              </li>
                              <li>
                                 <p>指定<code class="codeph">INTERVAL</code>和统计信息收集自动停止前的分钟数。如果需要，您可以使用<code class="codeph">GATHER_SYSTEM_STATS (gathering_mode=&gt;'STOP')</code>结束早于计划的收集。
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-FB1B9F70-C417-4CC5-8F46-1ECDE2326D66__GUID-8115234C-4B34-45E8-8B30-90013DB63CE1">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN10037" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">DB_FILE_MULTIBLOCK_READ_COUNT</code>初始化参数</p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-46A36510-4BAF-43B8-8C65-B1B2D6B17916" title="Oracle建议您在数据库具有最典型的工作负载时使用DBMS_STATS.GATHER_SYSTEM_STATS来捕获统计信息。">收集工作负载统计信息</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL441"></a><a id="TGSQL440"></a><div class="props_rev_3"><a id="GUID-90149651-4244-483C-93AF-D73387B0AF6F" name="GUID-90149651-4244-483C-93AF-D73387B0AF6F"></a><h6 id="TGSQL-GUID-90149651-4244-483C-93AF-D73387B0AF6F" class="sect6"><span class="enumeration_section">13.4.3.2.2</span>启动和停止系统统计信息收集</h6>
                        <div>
                           <p>本教程介绍如何使用<code class="codeph">GATHER_SYSTEM_STATS</code>的<code class="codeph">START</code>和<code class="codeph">STOP</code>参数设置工作负载间隔。</p>
                           <div class="section">
                              <p class="subhead3" id="GUID-90149651-4244-483C-93AF-D73387B0AF6F__GUID-EFEE738F-F380-415E-848A-3FDDD7F4807B">假设</p>
                              <p>本教程假设以下内容：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>上午10点到11点之间的小时代表了每日工作量。</p>
                                 </li>
                                 <li>
                                    <p>您打算直接在数据字典中收集系统统计信息。</p>
                                 </li>
                              </ul>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3" id="GUID-90149651-4244-483C-93AF-D73387B0AF6F__GUID-A784195D-CBF6-4547-ACF8-D78ABF27D431">要使用START和STOP收集工作负载统计信息：</p>
                              <ol>
                                 <li>
                                    <p>启动SQL * Plus并使用管理员权限连接到数据库。</p>
                                 </li>
                                 <li>
                                    <p>开始统计收集。</p>
                                    <p>例如，在上午10点，执行以下过程以开始收集：</p><pre class="pre codeblock"><code>EXECUTE DBMS_STATS.GATHER_SYSTEM_STATS（gathering_mode =&gt;'START'）;</code></pre></li>
                                 <li>
                                    <p>生成工作负载。</p>
                                 </li>
                                 <li>
                                    <p>结束统计数据收集</p>
                                    <p>例如，在上午11点，执行以下过程以结束集合：</p><pre class="pre codeblock"><code>EXECUTE DBMS_STATS.GATHER_SYSTEM_STATS（gathering_mode =&gt;'STOP'）;</code></pre><p>优化器现在可以使用工作负载统计信息来生成在正常日常工作负载期间有效的执行计划。</p>
                                 </li>
                                 <li>
                                    <p>（可选）查询系统统计信息。</p>
                                    <p>例如，运行以下查询：</p><pre class="pre codeblock"><code>COL PNAME FORMAT a15 SELECT PNAME，PVAL1 FROM SYS.AUX_STATS $ WHERE SNAME ='SYSSTATS_MAIN';</code></pre></li>
                              </ol>
                           </div>
                           <!-- class="section" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-90149651-4244-483C-93AF-D73387B0AF6F__GUID-46EBADD8-AABF-4511-BAD0-1699E46D1DD7">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-257CDCB8-3595-464B-8337-43EF23A6068D" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code>过程</p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-46A36510-4BAF-43B8-8C65-B1B2D6B17916" title="Oracle建议您在数据库具有最典型的工作负载时使用DBMS_STATS.GATHER_SYSTEM_STATS来捕获统计信息。">收集工作负载统计信息</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL94867"></a><a id="TGSQL94866"></a><div class="props_rev_3"><a id="GUID-3E84E773-1D87-46E8-8592-3B5E3CAC2712" name="GUID-3E84E773-1D87-46E8-8592-3B5E3CAC2712"></a><h6 id="TGSQL-GUID-3E84E773-1D87-46E8-8592-3B5E3CAC2712" class="sect6"><span class="enumeration_section">13.4.3.2.3</span>在指定的时间间隔内收集系统统计信息</h6>
                        <div>
                           <p>本教程介绍如何使用<code class="codeph">GATHER_SYSTEM_STATS</code>的<code class="codeph">INTERVAL</code>参数设置工作负载间隔。</p>
                           <div class="section">
                              <p class="subhead3" id="GUID-3E84E773-1D87-46E8-8592-3B5E3CAC2712__GUID-AE5F421C-B1A3-475B-ABCA-0297FEF3B98A">假设</p>
                              <p>本教程假设以下内容：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>数据库应用程序在白天处理OLTP事务并在晚上运行OLAP报告。要收集有代表性的统计数据，您可以在白天收集它们两个小时，然后在晚上收集两个小时。</p>
                                 </li>
                                 <li>
                                    <p>您希望将统计信息存储在名为<code class="codeph">workload_stats</code>的表中。
                                    </p>
                                 </li>
                                 <li>
                                    <p>您打算在收集的统计信息之间切换。</p>
                                 </li>
                              </ul>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3" id="GUID-3E84E773-1D87-46E8-8592-3B5E3CAC2712__GUID-37226DAE-DB70-45B8-82F0-97EB62DA7B41">使用INTERVAL收集工作负载统计信息：</p>
                              <ol>
                                 <li>
                                    <p>启动SQL * Plus并以管理员<code class="codeph">dba1</code>身份连接到生产数据库。
                                    </p>
                                 </li>
                                 <li>
                                    <p>创建一个表来保存生产统计信息。</p>
                                    <p>例如，执行以下PL / SQL程序以创建用户统计信息表<code class="codeph">workload_stats</code> ：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.CREATE_STAT_TABLE（ownname =&gt;'dba1'，stattab =&gt;'workload_stats'）;结束; /</code></pre></li>
                                 <li>
                                    <p>确保<code class="codeph">JOB_QUEUE_PROCESSES</code>不为<code class="codeph">0</code>以便运行<code class="codeph">DBMS_JOB</code>作业和Oracle Scheduler作业。
                                    </p><pre class="pre codeblock"><code>ALTER SYSTEM SET JOB_QUEUE_PROCESSES = 1;</code></pre></li>
                                 <li>
                                    <p>在白天收集统计数据。</p>
                                    <p>例如，使用以下程序收集两小时的统计信息：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.GATHER_SYSTEM_STATS（interval =&gt; 120，stattab =&gt;'workload_stats'，statid =&gt;'OLTP'）;结束; /</code></pre></li>
                                 <li>
                                    <p>在晚上收集统计数据。</p>
                                    <p>例如，使用以下程序收集两小时的统计信息：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.GATHER_SYSTEM_STATS（interval =&gt; 120，stattab =&gt;'workload_stats'，statid =&gt;'OLAP'）;结束; /</code></pre></li>
                                 <li>
                                    <p>在白天或晚上，将适当的统计信息导入数据字典。</p>
                                    <p>例如，在白天，您可以使用以下程序将登台表中的OLTP统计信息导入到字典中：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.IMPORT_SYSTEM_STATS（stattab =&gt;'workload_stats'，statid =&gt;'OLTP'）;结束; /</code></pre><p>例如，在夜间，您可以使用以下程序将登台表中的OLAP统计信息导入到字典中：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.IMPORT_SYSTEM_STATS（stattab =&gt;'workload_stats'，statid =&gt;'OLAP'）;结束; /</code></pre></li>
                              </ol>
                           </div>
                           <!-- class="section" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-3E84E773-1D87-46E8-8592-3B5E3CAC2712__GUID-35BA840C-6FAD-49CA-9F50-DC3C42B7CA6F">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-257CDCB8-3595-464B-8337-43EF23A6068D" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code>过程</p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-46A36510-4BAF-43B8-8C65-B1B2D6B17916" title="Oracle建议您在数据库具有最典型的工作负载时使用DBMS_STATS.GATHER_SYSTEM_STATS来捕获统计信息。">收集工作负载统计信息</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div><a id="TGSQL94923"></a><a id="TGSQL443"></a><div class="props_rev_3"><a id="GUID-4E99C958-71B0-4DC4-BF2A-33244BEFE46D" name="GUID-4E99C958-71B0-4DC4-BF2A-33244BEFE46D"></a><h5 id="TGSQL-GUID-4E99C958-71B0-4DC4-BF2A-33244BEFE46D" class="sect5"><span class="enumeration_section">13.4.3.3</span>收集Noworkload统计信息</h5>
                     <div>
                        <p>Noworkload统计信息捕获I / O系统的特征。</p>
                        <div class="section">
                           <p>默认情况下，Oracle数据库使用noworkload统计信息和CPU成本模型。noworkload统计信息的值在第一次启动时初始化为默认值。您还可以使用<code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code>过程手动收集noworkload统计信息。
                           </p>
                           <p>Noworkload统计信息包括<a href="gathering-optimizer-statistics.html#GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23__CHDJHGGG" title="此表描述了DBMS_STATS包收集的优化程序系统统计信息，并说明了何时以及如何收集统计信息。">表13-4中</a>列出的以下系统统计信息：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>I / O传输速度（ <code class="codeph">iotfrspeed</code> ）</p>
                              </li>
                              <li>
                                 <p>I / O寻求时间（ <code class="codeph">ioseektim</code> ）</p>
                              </li>
                              <li>
                                 <p>CPU速度（ <code class="codeph">cpuspeednw</code> ）</p>
                              </li>
                           </ul>
                           <p>工作负载统计信息和noworkload统计信息之间的主要区别在于收集方法。Noworkload统计信息通过对所有数据文件提交随机读取来收集数据，而工作负载统计信息使用在数据库活动发生时更新的计数器如果您收集工作负载统计信息，那么Oracle数据库将使用它们而不是noworkload统计信息。</p>
                           <p>要收集noworkload统计信息，请运行没有参数的<code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code>或将收集模式设置为<code class="codeph">noworkload</code> 。在noworkload统计信息的收集过程中，I / O系统会产生开销。收集过程可能需要几秒钟到几分钟，具体取决于I / O性能和数据库大小。
                           </p>
                           <p>收集noworkload统计信息时，数据库会分析信息并验证其一致性。在某些情况下，noworkload统计信息的值可能会保留其默认值。您可以再次收集统计信息，也可以使用<code class="codeph">SET_SYSTEM_STATS</code>手动将值设置为I / O系统规范。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-4E99C958-71B0-4DC4-BF2A-33244BEFE46D__GUID-9160BA12-8F08-46C4-A316-63F11A3CDDFD">假设</p>
                           <p>本教程假定您要手动收集noworkload统计信息。</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-4E99C958-71B0-4DC4-BF2A-33244BEFE46D__GUID-24477134-3227-46B8-82EA-E7D987CA3716">要手动收集noworkload统计信息：</p>
                           <ol>
                              <li>
                                 <p>启动SQL * Plus并使用管理员权限连接到数据库。</p>
                              </li>
                              <li>
                                 <p>收集noworkload统计信息。</p>
                                 <p>例如，运行以下语句：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.GATHER_SYSTEM_STATS（gathering_mode =&gt;'NOWORKLOAD'）;结束;</code></pre></li>
                              <li>
                                 <p>（可选）查询系统统计信息。</p>
                                 <p>例如，运行以下查询：</p><pre class="pre codeblock"><code>COL PNAME FORMAT a15 SELECT PNAME，PVAL1 FROM SYS.AUX_STATS $ WHERE SNAME ='SYSSTATS_MAIN';</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-4E99C958-71B0-4DC4-BF2A-33244BEFE46D__GUID-1C7D5E35-0067-4EB7-ABE0-7FCD67393FC4">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-257CDCB8-3595-464B-8337-43EF23A6068D" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code>过程</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-E5731E8E-3382-4E6A-9986-2508721631E3" title="要手动收集系统统计信息，请使用DBMS_STATS.GATHER_SYSTEM_STATS过程。">使用DBMS_STATS收集系统统计信息</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL448"></a><a id="TGSQL447"></a><div class="props_rev_3"><a id="GUID-C4F0B12B-2C9E-4050-B647-F7DC451D7878" name="GUID-C4F0B12B-2C9E-4050-B647-F7DC451D7878"></a><h4 id="TGSQL-GUID-C4F0B12B-2C9E-4050-B647-F7DC451D7878" class="sect4"><span class="enumeration_section">13.4.4</span>删除系统统计信息</h4>
                  <div>
                     <p><code class="codeph">DBMS_STATS.DELETE_SYSTEM_STATS</code>过程删除系统统计信息。
                     </p>
                     <div class="section">
                        <p>此过程删除使用<code class="codeph">INTERVAL</code>或<code class="codeph">START</code>和<code class="codeph">STOP</code>选项收集的工作负载统计信息，然后将默认值重置为noworkload统计信息。但是，如果<code class="codeph">stattab</code>参数指定用于存储统计信息的表，则子程序将从统计信息表中删除具有关联<code class="codeph">statid</code>所有系统统计信息。
                        </p>
                        <p>如果是新创建的数据库，则Oracle建议删除系统统计信息，关闭数据库，然后重新打开数据库。这一系列步骤可确保数据库为系统统计信息建立适当的默认值。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C4F0B12B-2C9E-4050-B647-F7DC451D7878__GUID-14AC4F61-9092-45C3-B6D1-5BD243F3B13D">假设</p>
                        <p>本教程假设以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您收集了特定密集型工作负载的统计信息，但不再希望优化程序使用这些统计信息。</p>
                           </li>
                           <li>
                              <p>您将工作负载统计信息存储在默认位置，而不是存储在用户指定的表中。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C4F0B12B-2C9E-4050-B647-F7DC451D7878__GUID-BAB40C25-6AA8-47F5-A72D-CEFD38FDC3C7">要删除系统统计信息：</p>
                        <ol>
                           <li>
                              <p>在SQL * Plus中，以具有管理权限的用户身份登录数据库。</p>
                           </li>
                           <li>
                              <p>删除系统统计信息。</p>
                              <p>例如，运行以下语句：</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.DELETE_SYSTEM_STATS;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-C4F0B12B-2C9E-4050-B647-F7DC451D7878__GUID-EF6DCCF2-2D0E-466B-B801-2D684CE8A023">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-69DC84A3-704B-4E48-8C17-7C7E01A368EC" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_STATS.DELETE_SYSTEM_STATS</code>过程</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" title="系统统计信息描述优化程序的硬件特征，例如I / O和CPU性能和利用率。">手动收集系统统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL94639"></a><a id="TGSQL94640"></a><a id="TGSQL94638"></a><div class="props_rev_3"><a id="GUID-4274A976-0185-4113-844F-1F818CD916CA" name="GUID-4274A976-0185-4113-844F-1F818CD916CA"></a><h3 id="TGSQL-GUID-4274A976-0185-4113-844F-1F818CD916CA" class="sect3"><span class="enumeration_section">13.5</span>运行统计信息在报告模式下收集功能</h3>
               <div>
                  <p>您可以在报告模式下运行<code class="codeph">DBMS_STATS</code>统计信息收集过程。
                  </p>
                  <div class="section">
                     <p>使用<code class="codeph">REPORT_*</code>过程时，优化程序实际上不会收集统计信息。相反，如果您要使用指定的统计信息收集功能，则程序包将报告<span class="italic">将</span>要处理的对象。
                     </p>
                     <p>下表列出了<code class="codeph">DBMS_STATS.REPORT_GATHER_*_STATS</code>函数。对于所有函数，输入参数与相应的<code class="codeph">GATHER_*_STATS</code>过程相同，具有以下附加参数： <code class="codeph">detail_level</code>和<code class="codeph">format</code> 。支持的格式是<code class="codeph">XML</code> ， <code class="codeph">HTML</code>和<code class="codeph">TEXT</code> 。</p>
                     <div class="tblformal" id="GUID-4274A976-0185-4113-844F-1F818CD916CA__CHDBEFIB">
                        <p class="titleintable">表13-5 DBMS_STATS报告模式功能</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_STATS报告模式功能" width="100%" border="1" summary="DBMS_STATS restore procedures" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="46%" id="d74756e10353">功能</th>
                                 <th align="left" valign="bottom" width="54%" id="d74756e10356">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="46%" id="d74756e10361" headers="d74756e10353 ">
                                    <p><code class="codeph">REPORT_GATHER_TABLE_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="54%" headers="d74756e10361 d74756e10356 ">
                                    <p>在报告模式下运行<code class="codeph">GATHER_TABLE_STATS</code> 。该过程不收集统计信息，但报告所有受调用<code class="codeph">GATHER_TABLE_STATS</code>影响的对象。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="46%" id="d74756e10375" headers="d74756e10353 ">
                                    <p><code class="codeph">REPORT_GATHER_SCHEMA_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="54%" headers="d74756e10375 d74756e10356 ">
                                    <p>在报告模式下运行<code class="codeph">GATHER_SCHEMA_STATS</code> 。该过程实际上不会收集统计信息，但会通过调用<code class="codeph">GATHER_SCHEMA_STATS</code>来报告所有受影响的对象。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="46%" id="d74756e10389" headers="d74756e10353 ">
                                    <p><code class="codeph">REPORT_GATHER_DICTIONARY_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="54%" headers="d74756e10389 d74756e10356 ">
                                    <p>在报告模式下运行<code class="codeph">GATHER_DICTIONARY_STATS</code> 。该过程实际上不会收集统计信息，但会通过调用<code class="codeph">GATHER_DICTIONARY_STATS</code>来报告所有受影响的<code class="codeph">GATHER_DICTIONARY_STATS</code> 。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="46%" id="d74756e10403" headers="d74756e10353 ">
                                    <p><code class="codeph">REPORT_GATHER_DATABASE_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="54%" headers="d74756e10403 d74756e10356 ">
                                    <p>在报告模式下运行<code class="codeph">GATHER_DATABASE_STATS</code> 。该过程实际上不会收集统计信息，但会通过调用<code class="codeph">GATHER_DATABASE_STATS</code>来报告所有受影响的<code class="codeph">GATHER_DATABASE_STATS</code> 。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="46%" id="d74756e10417" headers="d74756e10353 ">
                                    <p><code class="codeph">REPORT_GATHER_FIXED_OBJ_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="54%" headers="d74756e10417 d74756e10356 ">
                                    <p>在报告模式下运行<code class="codeph">GATHER_FIXED_OBJ_STATS</code> 。该过程实际上不会收集统计信息，但会通过调用<code class="codeph">GATHER_FIXED_OBJ_STATS</code>来报告所有受影响的<code class="codeph">GATHER_FIXED_OBJ_STATS</code> 。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="46%" id="d74756e10431" headers="d74756e10353 ">
                                    <p><code class="codeph">REPORT_GATHER_AUTO_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="54%" headers="d74756e10431 d74756e10356 ">
                                    <p>在报告模式下运行自动统计信息收集作业。该过程实际上不会收集统计信息，但会报告因运行作业而受影响的所有对象。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-4274A976-0185-4113-844F-1F818CD916CA__GUID-B3049A7D-E2C7-436A-BD77-D61E8ED699DE">假设</p>
                     <p>本教程假定您要生成在<code class="codeph">oe</code>架构上运行<code class="codeph">GATHER_SCHEMA_STATS</code>而受影响的对象的HTML报告。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-4274A976-0185-4113-844F-1F818CD916CA__GUID-1A17BB1F-9615-486F-8C93-D2AFB8AF4D25">要报告受运行GATHER_SCHEMA_STATS影响的对象：</p>
                     <ol>
                        <li>
                           <p>启动SQL * Plus并使用管理员权限连接到数据库。</p>
                        </li>
                        <li>
                           <p>运行<code class="codeph">DBMS_STATS.REPORT_GATHER_SCHEMA_STATS</code>函数。
                           </p>
                           <p>例如，在SQL * Plus中运行以下命令：</p><pre class="pre codeblock"><code>SET LINES 200 PAGES 0 SET LONG 100000 COLUMN REPORT FORMAT A200 VARIABLE my_report CLOB; BEGIN：my_report：= DBMS_STATS.REPORT_GATHER_SCHEMA_STATS（ownname =&gt;'OE'，detail_level =&gt;'TYPICAL'，format =&gt;'HTML'）;结束; /</code></pre></li>
                     </ol>
                     <p>下图显示了部分示例报告：</p>
                     <div class="figure" id="GUID-4274A976-0185-4113-844F-1F818CD916CA__GUID-EAC7CF7B-73CF-4924-B9AD-56617D7F599D"><img src="img/report_gs_oe.png" alt="报告的描述如下：report_gs_oe.png" title="报告的描述如下：report_gs_oe.png" longdesc="img_text/report_gs_oe.html"><br><a href="img_text/report_gs_oe.html">报告说明report_gs_oe.png</a></div>
                     <!-- class="figure" -->
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-4274A976-0185-4113-844F-1F818CD916CA__GUID-9F6A0147-E0CC-4175-9BC4-FADCE441481E">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS059" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以了解有关<code class="codeph">DBMS_STATS</code>更多信息 
                     </p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="gathering-optimizer-statistics.html#GUID-245F23B2-24AF-44D8-9F12-99FD1215E878" title="本章介绍如何使用DBMS_STATS.GATHER _ * _ STATS程序单元。">收集优化程序统计信息</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>