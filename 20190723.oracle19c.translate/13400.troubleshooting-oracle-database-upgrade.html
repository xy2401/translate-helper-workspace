<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="Use these troubleshooting tips to address errors or issues that you may encounter while upgrading your database."></meta>
      <meta name="description" content="Use these troubleshooting tips to address errors or issues that you may encounter while upgrading your database."></meta>
      <title>Oracle数据库升级故障排除</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Database Upgrade Guide"></meta>
      <meta property="og:description" content="Use these troubleshooting tips to address errors or issues that you may encounter while upgrading your database."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Database Upgrade Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-upgrade-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-04-25T08:26:31-07:00"></meta>
      <meta name="dcterms.title" content="Database Upgrade Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96252-05"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="transporting-upgrading-database-full-transportable-export-import.html" title="Previous" type="text/html"></link>
      <link rel="next" href="rerunning-upgrades-oracle-database.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="UPGRD"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="transporting-upgrading-database-full-transportable-export-import.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="rerunning-upgrades-oracle-database.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据库升级指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="upgrading-oracle-database.html" property="item" typeof="WebPage"><span property="name">升级Oracle数据库</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Oracle数据库升级故障排除</li>
            </ol>
            <a id="GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" name="GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2"></a><a id="UPGRD12409"></a>
            
            <h2 id="UPGRD-GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" class="sect2">Oracle数据库升级故障排除</h2>
         </header>
         <div class="ind">
            <div>
               <p>使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。</p>
               <p>还要查看相关链接以了解影响此版本的更改（可能与您收到的错误有关），以及在解决错误后如何重新运行升级。</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-21A033B9-5994-4FFC-8D30-D0ABCBB1AC19">关于在升级模式下启动Oracle数据库</a><br>在升级模式下启动Oracle数据库时，只能在固定视图上运行查询。如果您尝试运行其他视图或PL / SQL，则会收到错误。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-6444C924-B085-4941-897D-F8611F9C7625">使用不同的ORACLE_HOME所有者运行DBUA</a><br>如果您的Oracle数据库主目录由不同的操作系统用户帐户拥有，或者遇到<samp class="sysout">upgrade.xml not found</samp>错误，请查看此主题。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-FC90995E-8E54-4E8B-B889-A497866CCA2A">无效的对象警告和DBA注册表错误</a><br>在开始升级之前，Oracle强烈建议您运行preupgrade信息工具（ <code class="codeph">preupgrd.jar</code> ）。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-A6C4B02E-EF6D-449D-82E8-732AF59A7F8B">无效对象和过早使用升级后工具</a><br>在完成升级之前，切勿运行新的Oracle数据库发行版（ <code class="codeph">utlusts.sql</code> ）的升级后状态工具。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-785B0B45-97D9-49FD-8312-2562210D4AF8">解决Oracle数据库升级脚本终止错误</a><br>如果您遇到ORA-00942，ORA-00904或ORA-01722错误，请查看本节。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-AD67C5DA-7481-454D-B259-E362839451AB">升级Oracle数据库时出现资源限制错误的原因</a><br>如果您遇到ORA-01650，ORA-01651，ORA-01652，ORA-01653，ORA-01654，ORA-01655，ORA-0431，ORA-01562，ORA-19815或其他建议资源限制错误的错误，请查看本节。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-5C6DA3B0-396D-4532-A735-9A27C1AF28FE">解决Oracle数据库的SQL * Plus Edition会话启动错误</a><br>使用此部分来理解和解决SP2-1540：“Oracle数据库无法在Edition会话中启动”。</li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-A58002D5-370D-462E-9AA8-7E87142F70B9">错误ORA-00020运行utlrp.sql时超出的最大进程数</a><br>此错误可能表示您的Oracle配置没有足够数量的可用于重新编译的进程。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-30A17B15-665C-4403-A66F-8BC1A0585A15">升级后使用DBMS_DST包修复ORA-01822</a><br>使用此过程<samp class="sysout">可修复</samp>涉及时区文件不匹配的<samp class="sysout">ORA-01822</samp>和<samp class="sysout">ORA-16512</samp>错误。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-C6C97136-C79D-49EB-A1AA-16744FB3DA4B">修复ORA-28365：钱包未打开错误</a><br>如果您使用带有透明数据加密（TDE）的Oracle钱包，并使用数据库升级助手（DBUA）升级数据库，那么您可能会遇到ORA-28365“钱包未打开”错误。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-1F73128E-6DCE-46F8-9587-6E833732607F">解决视图CDB_JAVA_POLICY的问题</a><br>如果视图CDB_JAVA_POLICY变为无效，则使用此过程。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-2FF8F7DD-EF1A-4E2B-8A86-EC427B78EA2C">服务器重新启动后继续升级（ADVM / ACFS驱动程序错误）</a><br>在Windows平台上，如果服务器在升级期间重新启动，则可能会出现与ADVM或ACFS驱动程序相关的错误。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-8AA2F6FB-516F-408C-868C-3979C46A5F7C">组件状态和升级</a><br>组件状态设置受先前安装的组件以及这些组件的升级支持。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-16E662C1-2877-4C97-A9D5-531735FAA2AC">标准版入门数据库和状态选项关闭的组件</a><br>从Oracle Database 18c（18.1）开始，所有<code class="codeph">OPTION OFF</code>组件都升级到新版本，但这些选项被禁用，因为Oracle Database Standard Edition（SE）保持OPTION OFF。</li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-50E0EE5B-9549-4A35-8F27-5134AC42D484">升级后调整Oracle ASM密码文件位置</a><br>在Oracle Grid Infrastructure升级后，您必须为Oracle ASM创建新的密码文件。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-371A976A-C6B5-408A-85C3-13B8D4D80BF0">使用可插拔数据库升级修复“警告XDB现在无效”错误</a><br>如果在升级可插拔数据库（PDB）时遇到“警告：XDB现在无效，发现无效对象”错误，请查看此主题。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-0BBD601F-03AD-495F-BE3B-EBF6F5180A12">修复ORA-27248：sys.dra_reevaluate_open_failures正在运行</a><br>使用此过程可识别阻止升级的<code>DRA_REEVALUATE_OPEN_FAILURES</code>作业。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-82B1B90A-9268-4FCA-91B5-9486A01B0C11">修复ORA-22288：文件或LOB操作FILEOPEN路径中的软链接失败</a><br>当打开BFILES时，符号链接在目录对象路径或文件名中时发生ORA-22288。</li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-39D29002-04E8-4C15-99CB-3BA74DE7C9E3">修复Oracle数据库企业用户安全性，OLS-OID和配置文件错误</a><br>查看以了解<samp class="sysout">ORA-16000：数据库是否为只读访问</samp>错误而<samp class="sysout">打开</samp> 。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-C9EA4C17-E283-4D21-9C9B-0EE97FE2A486">使用utl32k.sql和MAX_STRING_SIZE修复32K迁移错误</a><br>使用此过程修复<samp class="sysout">ORA-01722：无效的数字</samp>升级错误。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-906173BF-B48E-4E2A-86EF-7B174E564AC0">从CRS关闭和Oracle ASM恢复滚动迁移恢复</a><br>所有集群成员节点上的集群就绪服务（CRS）关闭可以使集群处于异构状态。使用此过程可以从该问题中恢复。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-6D5F3EEE-D8CC-45F8-81A7-1C3BC96952FA">数据类型版本控制可能导致跨版本复制（ORA-26656）</a><br>查看受版本控制影响的用户定义的对象类型。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-A6410CD4-4DCE-41D3-BBA1-0CF1CC8204E5">引用的符号计数是未定义的错误libclntsh.so.11.1</a><br>如果您遇到引用<code class="codeph">libclntsh.so.11.1</code>且“引用符号计数未定义”，“无法打开共享对象文件”或类似错误的错误，请查看此主题。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-264F7099-5C9F-42D1-B3D7-D9754CA7F3C2">解决由ISO 8601时间戳引起的时间戳错误</a><br>如果在升级到Oracle Database 12 <span class="italic">c</span> ，18c或更高版本后遇到应用程序的时间戳错误，请查看此主题。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-2F4DAD7F-92E4-415C-A91B-7EE480633E3E">修复仅在Datapatch失败的情况下失败的升级</a><br>如果在升级期间只有datapatch失败，则直接重新运行datapatch。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-C18782A1-4A4F-4C06-B0D6-F58ECE28E13C">错误“时区数据文件不能降级为较低版本”</a><br>如果要升级的数据库中的夏令时版本（DST）版本比要升级的数据库版本中的DST更新，则会遇到禁止升级的时区错误。
                  </li>
                  <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-25BB78B8-B59D-4039-B838-9BCA13A5377C">使用DBUA修复听众完成注册的失败</a><br>在“数据库升级助手进度”步骤中，将出现一个窗口，其中包含以下警告：“无法在目录服务中创建数据库条目。没有配置听众。“</li>
               </ul>
               <div class="relinfo">
                  <p><strong>相关话题</strong></p>
                  <ul>
                     <li><a href="rerunning-upgrades-oracle-database.html#GUID-190D00A4-BE9A-4139-B3FC-A29C2BFBE91B" title="使用这些选项重新运行升级。">重新启动Oracle数据库升级</a></li>
                  </ul>
               </div>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="upgrading-oracle-database.html#GUID-CC88F262-3370-4FFA-8604-EDA9F20F56D9" title="Oracle提供了一套全面的工具，用于以最短的停机时间升级Oracle数据库，以及将应用程序迁移到新版本。">升级Oracle数据库</a></p>
                  </div>
               </div>
            </div><a id="UPGRD52874"></a><div class="props_rev_3"><a id="GUID-21A033B9-5994-4FFC-8D30-D0ABCBB1AC19" name="GUID-21A033B9-5994-4FFC-8D30-D0ABCBB1AC19"></a><h3 id="UPGRD-GUID-21A033B9-5994-4FFC-8D30-D0ABCBB1AC19" class="sect3">关于在升级模式下启动Oracle数据库</h3>
               <div>
                  <p>在升级模式下启动Oracle数据库时，只能在固定视图上运行查询。如果您尝试运行其他视图或PL / SQL，则会收到错误。</p>
                  <p>在升级模式下启动数据库时，只对固定视图的查询执行时没有错误。在您直接运行并行升级实用程序（ <code>catctl.pl</code> ）或使用<code>dbupgrade</code>脚本间接运行此限制之前，此限制适用。在运行升级脚本之前，在任何其他视图上使用PL / SQL，或在任何其他视图上运行查询都会返回错误。如果收到本节中描述的任何错误，则发出<code class="codeph">SHUTDOWN ABORT</code>命令以关闭数据库，然后更正问题。
                  </p>
                  <p>尝试启动新的Oracle数据库发行版时，可能会发生以下错误列表。其中一些错误会写入警报日志，而不会写入您的会话。</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><code class="codeph">ORA-00401：此版本不支持参数兼容的值</code></p>
                        <p><code class="codeph">COMPATIBLE</code>初始化参数设置为小于<code class="codeph">11.2.0</code>的值。
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">ORA-39701：数据库必须为UPGRADE或DOWNGRADE安装EXCLUSIVE</code></p>
                        <p><code class="codeph">CLUSTER_DATABASE</code>初始化参数设置为<code class="codeph">TRUE</code>而不是<code class="codeph">FALSE</code> 。</p>
                     </li>
                     <li>
                        <p><code class="codeph">ORA-39700：必须使用UPGRADE选项打开数据库</code></p>
                        <p><code class="codeph">STARTUP</code>命令是在没有<code class="codeph">UPGRADE</code>关键字的情况下发出的。
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">Ora-00704：引导程序失败</code></p>
                        <p>path变量可以指向早期版本的Oracle主目录。</p>
                     </li>
                     <li>
                        <p><code class="codeph">ORA-00336：日志文件大小xxxx块小于最小8192块</code></p>
                        <p>重做日志文件大小小于4 MB。</p>
                     </li>
                  </ul>
                  <p>如果出现列出不支持的初始化参数的错误，请记下不支持的初始化参数，然后继续升级。下次关闭数据库时删除不支持的初始化参数。</p>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="https://support.oracle.com/rs?type=doc&amp;id=1349722.1" target="_blank">https://support.oracle.com/rs?type=doc&amp;id=1349722.1</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
            </div><a id="UPGRD60135"></a><div class="props_rev_3"><a id="GUID-6444C924-B085-4941-897D-F8611F9C7625" name="GUID-6444C924-B085-4941-897D-F8611F9C7625"></a><h3 id="UPGRD-GUID-6444C924-B085-4941-897D-F8611F9C7625" class="sect3">使用不同的ORACLE_HOME所有者运行DBUA</h3>
               <div>
                  <p>如果您的Oracle数据库主目录由不同的操作系统用户帐户拥有，或者遇到<samp class="sysout">upgrade.xml not found</samp>错误，请查看此主题。
                  </p>
                  <p>DBUA升级默认假设Oracle主与目标（比Oracle数据库<span class="italic">12c的</span>早期版本）在源（新12 <span class="italic">C）Oracle</span>主目录是由同一用户拥有。如果每个Oracle主目录不归同一用户所有，则必须更改为数据库文件权限并将其他参数传递给DBUA。如果不这样做，则在升级期间，DBUA先决条件检查页面会报告<samp class="sysout">找不到upgrade.xml</samp>错误。在更正此错误之前，不允许继续升级。
                  </p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>所有Oracle数据库安装所有者都应将您指定为OINSTALL组（或Oracle Inventory组）的组作为其主要组。确保所有数据库文件（数据文件，重做文件，控制文件，存档日志目标，恢复区域，SPFILE和密码文件）都可由新的12 <span class="italic">c</span>和12 <span class="italic">c之前的</span>二进制所有者读写。如果不是这种情况，请确认每个安装所有者与其主组具有相同的组，并确保OINSTALL组的成员对所有早期版本和稍后版本的Oracle数据库文件和目录具有读/写访问权限。
                        </p>
                     </li>
                     <li>
                        <p>通过指定<code>-logdir</code>命令行选项运行DBUA，并提供新版本和早期版本二进制所有者可以写入的目录。例如： <code class="codeph">/tmp</code> 。DBUA使用您使用<span class="parmname" translate="no">logdir</span>参数指定的目录来存储升级前信息工具的输出，并存储升级期间生成的任何DBUA日志文件。您从早期版本的Oracle数据库实例运行升级前信息工具，作为早期版本的Oracle数据库安装所有者用户帐户。
                        </p>
                        <p>例如：</p><pre class="pre codeblock"><code>dbua -logdir / tmp</code></pre></li>
                  </ul>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-FC90995E-8E54-4E8B-B889-A497866CCA2A" name="GUID-FC90995E-8E54-4E8B-B889-A497866CCA2A"></a><h3 id="UPGRD-GUID-FC90995E-8E54-4E8B-B889-A497866CCA2A" class="sect3">无效的对象警告和DBA注册表错误</h3>
               <div>
                  <p>在开始升级之前，Oracle强烈建议您运行preupgrade信息工具（ <code class="codeph">preupgrd.jar</code> ）。
                  </p>
                  <p>preupgrade信息工具识别无效的SYS和SYSTEM对象，以及其他无效对象。使用<code class="codeph">utlrp.sql</code>重新编译无效对象。如果在升级之前未能执行此操作，则在开始升级之前很难确定系统中的哪些对象无效，以及哪些对象因升级而变为无效。
                  </p>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="using-preupgrade-information-tool-for-oracle-database.html#GUID-C0219AF1-AD43-4097-B358-E53E48958647">使用Oracle数据库的升级前信息工具</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-A6C4B02E-EF6D-449D-82E8-732AF59A7F8B" name="GUID-A6C4B02E-EF6D-449D-82E8-732AF59A7F8B"></a><h3 id="UPGRD-GUID-A6C4B02E-EF6D-449D-82E8-732AF59A7F8B" class="sect3">无效对象和过早使用升级后工具</h3>
               <div>
                  <p>在完成升级之前，切勿运行新的Oracle数据库发行版（ <code class="codeph">utlusts.sql</code> ）的升级后状态工具。
                  </p>
                  <p>Oracle建议您仅在升级过程完成后以及运行<code class="codeph">utlrp.sql</code>后运行postupgrade状态工具。如果在运行<code class="codeph">@utlrp.sql</code>之前运行了升级后状态工具，则工具的输出可能不会显示准确的最终组件状态值。如果在运行<code class="codeph">utlrp.sql</code>之前运行该工具，则组件状态值可能无法正确反映最终状态。运行<code class="codeph">utlrp.sql</code>后，您只能确定最终的组件状态。
                  </p>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="UPGRD52875"></a><div class="props_rev_3"><a id="GUID-785B0B45-97D9-49FD-8312-2562210D4AF8" name="GUID-785B0B45-97D9-49FD-8312-2562210D4AF8"></a><h3 id="UPGRD-GUID-785B0B45-97D9-49FD-8312-2562210D4AF8" class="sect3">解决Oracle数据库升级脚本终止错误</h3>
               <div>
                  <p>如果您遇到ORA-00942，ORA-00904或ORA-01722错误，请查看本节。</p>
                  <p>如果在开始升级之前未运行升级前信息工具，则<code class="codeph">catctl.pl</code>和<code class="codeph">catupgrd.sql</code>脚本将以错误终止，如下所示：</p><pre class="pre codeblock"><code>ORA-00942：表或视图不存在ORA-00904：“TZ_VERSION”：无效标识符ORA-01722：无效的数字</code></pre><p>如果您收到任何这些错误，请完成以下过程：</p>
                  <ol>
                     <li>
                        <p>输入<code>SHUTDOWN ABORT</code>命令，等待命令完成运行。
                        </p>
                     </li>
                     <li>
                        <p>恢复到原始Oracle主目录</p>
                     </li>
                     <li>
                        <p>运行升级前信息工具。</p>
                     </li>
                  </ol>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="using-preupgrade-information-tool-for-oracle-database.html#GUID-C0219AF1-AD43-4097-B358-E53E48958647" title="查看这些主题以了解并使用升级前信息工具（preupgrade.jar）。">Oracle数据库的升级前信息工具</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
            </div><a id="UPGRD12410"></a><div class="props_rev_3"><a id="GUID-AD67C5DA-7481-454D-B259-E362839451AB" name="GUID-AD67C5DA-7481-454D-B259-E362839451AB"></a><h3 id="UPGRD-GUID-AD67C5DA-7481-454D-B259-E362839451AB" class="sect3">升级Oracle数据库时出现资源限制错误的原因</h3>
               <div>
                  <p>如果您遇到ORA-01650，ORA-01651，ORA-01652，ORA-01653，ORA-01654，ORA-01655，ORA-0431，ORA-01562，ORA-19815或其他建议资源限制错误的错误，请查看本节。</p>
                  <p>如果升级期间资源不足，则增加资源分配。增加资源分配后，使用<kbd class="userinput">SHUTDOWN ABORT</kbd>关闭实例，并在重新运行<code>catupgrd.sql</code>脚本之前以<kbd class="userinput">UPGRADE</kbd>模式重新启动实例。
                  </p>
                  <p>新Oracle Database版本通常需要增加的资源如下：</p>
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">SYSTEM</code>和<code class="codeph">SYSAUX</code>表空间</p>
                           <p>如果您的<code class="codeph">SYSTEM</code>表空间大小不足，通常会收到以下错误消息：</p><pre class="oac_no_warn" dir="ltr">ORA-01650：无法在表空间<span class="italic">字符串</span> ORA-01651中按<span class="italic">字符串</span>扩展回滚段<span class="italic">字符串</span> ：无法为表空间<span class="italic">字符串</span> ORA-01652按<span class="italic">字符串</span>扩展保存undo：无法在表空间<span class="italic">字符串</span> ORA-01653中按<span class="italic">字符串</span>扩展临时段：无法扩展表<span class="italic">字符串</span> 。 <span class="italic">串</span>由<span class="italic">字符串</span>表<span class="italic">字符串</span> ORA-01654：无法扩展索引<span class="italic">字符串</span> 。 <span class="italic">串</span>由<span class="italic">字符串</span>表<span class="italic">字符串</span> ORA-01655：无法扩展群集<span class="italic">字符串</span> 。 <span class="italic">字符串</span>由表<span class="italic"><span class="italic">串串</span></span>
</pre><p>要避免这些错误，请为<code class="codeph">SYSTEM</code>和<code class="codeph">SYSAUX</code>表空间设置<code class="codeph">AUTOEXTEND ON MAXSIZE UNLIMITED</code> 。
                           </p>
                        </li>
                        <li>
                           <p>共享内存</p>
                           <p>在某些情况下，您可能需要更大的共享内存池大小。错误消息指示您必须增加哪个共享内存初始化参数，格式如下：</p><pre class="oac_no_warn" dir="ltr">ORA-04031：无法分配共享内存的<span class="italic">字符串</span>字节（“ <span class="variable" translate="no">string</span> ”，“ <span class="variable" translate="no">string</span> ”，“ <span class="variable" translate="no">string</span> ”，“ <span class="variable" translate="no">string</span> ”）</pre><div class="infoboxnotealso" id="GUID-AD67C5DA-7481-454D-B259-E362839451AB__GUID-416288E2-B906-4637-83F9-CD06746DFB5A">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="../admin/managing-memory.html#ADMIN11218" target="_blank"><span class="italic">“Oracle数据库管理员指南”</span></a> ，了解有关使用手动共享内存管理的信息</p>
                           </div>
                        </li>
                        <li>
                           <p>回滚段/撤消表空间</p>
                           <p>如果您使用的是回滚段，则在运行升级脚本时，必须在线有一个大的（100 MB） <code class="codeph">PUBLIC</code>回滚段。较小的公共回滚段应在升级期间脱机。如果回滚段大小不足，则通常会遇到以下错误：</p><pre class="pre codeblock"><code>ORA-01562：未能扩展回滚段号<span class="variable" translate="no">string</span>
</code></pre><p>如果您使用的是撤消表空间，请确保它至少为400 MB。</p>
                        </li>
                        <li>
                           <p>快速恢复区</p>
                           <p>如果您使用快速恢复区并在升级期间填满，则警报日志中会显示以下错误，然后提出从问题中恢复的建议：</p><pre class="pre codeblock"><code>ORA-19815：警告： <span class="italic">字符串</span>字节的db_recovery_file_dest_size使用率为98.99％，并且<span class="variable" translate="no">string</span>剩余字节可用。
</code></pre><pre class="oac_no_warn" dir="ltr"></pre><p>确定问题的根本原因，并采取适当的措施继续升级。为避免升级过程中出现问题，请在开始升级之前增加快速恢复区中的可用空间。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="UPGRD52742"></a><div class="props_rev_3"><a id="GUID-5C6DA3B0-396D-4532-A735-9A27C1AF28FE" name="GUID-5C6DA3B0-396D-4532-A735-9A27C1AF28FE"></a><h3 id="UPGRD-GUID-5C6DA3B0-396D-4532-A735-9A27C1AF28FE" class="sect3">解决Oracle数据库的SQL * Plus Edition会话启动错误</h3>
               <div>
                  <p>使用此部分来理解和解决SP2-1540：“Oracle数据库无法在Edition会话中启动”。</p>
                  <p>如果升级脚本或在SQL * Plus中运行的命令设置了<span class="parmname" translate="no">EDITION</span>参数，则Oracle Database无法在以后正常启动。当您尝试启动数据库时，您收到以下错误：</p><pre class="oac_no_warn" dir="ltr">SP2-1540：“Oracle数据库无法在版本会话中启动”</pre><p>要避免此问题，请在运行<code>catugrd.sql</code>或更改此参数的任何SQL * Plus会话后，退出SQL * Plus会话并在其他会话中重新启动实例。
                  </p>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-A58002D5-370D-462E-9AA8-7E87142F70B9" name="GUID-A58002D5-370D-462E-9AA8-7E87142F70B9"></a><h3 id="UPGRD-GUID-A58002D5-370D-462E-9AA8-7E87142F70B9" class="sect3">错误ORA-00020运行utlrp.sql时超出的最大进程数</h3>
               <div>
                  <p>此错误可能表示您的Oracle配置没有足够数量的可用于重新编译的进程。</p>
                  <p>有关设置<span class="parmname" translate="no">PROCESSES</span>参数的更多详细信息，请参阅Oracle文档。
                  </p>
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-A58002D5-370D-462E-9AA8-7E87142F70B9__GUID-80D2361F-0129-40EA-9D4D-3D8B5602A0DF">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="../refrn/PROCESSES.html#REFRN10175" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="UPGRD52648"></a><div class="props_rev_3"><a id="GUID-30A17B15-665C-4403-A66F-8BC1A0585A15" name="GUID-30A17B15-665C-4403-A66F-8BC1A0585A15"></a><h3 id="UPGRD-GUID-30A17B15-665C-4403-A66F-8BC1A0585A15" class="sect3">升级后使用DBMS_DST包修复ORA-01822</h3>
               <div>
                  <p>使用此过程<samp class="sysout">可修复</samp>涉及时区文件不匹配的<samp class="sysout">ORA-01822</samp>和<samp class="sysout">ORA-16512</samp>错误。
                  </p>
                  <p>升级到Oracle Database 12 <span class="italic">c</span>后运行<code class="codeph">DBMS_DST</code>程序包可能会导致<code class="codeph">ORA-01882: time zone region not found</code>错误。
                  </p>
                  <p>如果时区文件版本设置不正确，则会返回此错误。时区设置不正确会导致多个时区区域的区域ID在数据库中存储不正确。例如：</p><pre class="oac_no_warn" dir="ltr">第1行的错误：@ ORA-01882：未找到时区区域@ ORA-06512：在“SYS.DBMS_DST”，第113行@ ORA-06512：在“SYS.DBMS_DST”，第1101行@ ORA-06512：在行1</pre><p>要解决此问题，请更新时区版本，然后重新运行升级。</p>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-C6C97136-C79D-49EB-A1AA-16744FB3DA4B" name="GUID-C6C97136-C79D-49EB-A1AA-16744FB3DA4B"></a><h3 id="UPGRD-GUID-C6C97136-C79D-49EB-A1AA-16744FB3DA4B" class="sect3">修复ORA-28365：钱包未打开错误</h3>
               <div>
                  <p>如果您使用带有透明数据加密（TDE）的Oracle钱包，并使用数据库升级助手（DBUA）升级数据库，那么您可能会遇到ORA-28365“钱包未打开”错误。</p>
                  <div class="section">要避免此问题，请在升级之前完成以下任务：</div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>以授权用户身份登录。</span></li>
                     <li class="stepexpand"><span>手动将<code class="codeph">sqlnet.ora</code>文件和钱包文件<code class="codeph">ewallet.p12</code>复制到新版本的Oracle主目录。</span></li>
                     <li class="stepexpand"><span>在mount中打开Oracle钱包。</span><div>
                           <p>例如：</p><pre class="pre codeblock"><code>SQL&gt; STARTUP MOUNT; SQL&gt; ALTER SYSTEM SET ENCRYPTION WALLET OPEN</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>像往常一样开始升级。</span></li>
                  </ol>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-1F73128E-6DCE-46F8-9587-6E833732607F" name="GUID-1F73128E-6DCE-46F8-9587-6E833732607F"></a><h3 id="UPGRD-GUID-1F73128E-6DCE-46F8-9587-6E833732607F" class="sect3">解决视图CDB_JAVA_POLICY的问题</h3>
               <div>
                  <p>如果视图CDB_JAVA_POLICY变为无效，则使用此过程。</p>
                  <div class="section">
                     <p>升级到Oracle Database 12 <span class="italic">c第</span> 2版（12.2）及更高版本，或从12.2版或更高版本降级到12.1后，您可能会遇到CDB_JAVA_POLICY视图的问题。CDB_JAVA_POLICY可能会变得无效，或者当您以正常工作方式使用它时可能会遇到错误。如果发生这种情况，请以SYS身份连接，然后运行以下命令。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-1F73128E-6DCE-46F8-9587-6E833732607F__GUID-12E0B7EA-B343-46C7-B0E3-AC45F368A22E">
                     <p>非的CDB：</p><pre class="pre codeblock"><code>alter session set“_ORACLE_SCRIPT”= true; exec CDBView.create_cdbview（false，'SYS'，'dba_java_policy'，'CDB_java_policy'）;在SYS.CDB_java_policy上授予select select_catalog_role /为SYS.CDB_java_policy创建或替换公共同义词CDB_java_policy</code></pre><p>多租户架构系统：</p>
                     <p>运行这些相同的命令，但首先在CDB $ ROOT中运行它们，然后在CDB中的其他容器中运行它们。</p>
                  </div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="UPGRD60105"></a><div class="props_rev_3"><a id="GUID-2FF8F7DD-EF1A-4E2B-8A86-EC427B78EA2C" name="GUID-2FF8F7DD-EF1A-4E2B-8A86-EC427B78EA2C"></a><h3 id="UPGRD-GUID-2FF8F7DD-EF1A-4E2B-8A86-EC427B78EA2C" class="sect3">服务器重新启动后继续升级（ADVM / ACFS驱动程序错误）</h3>
               <div>
                  <p>在Windows平台上，如果服务器在升级期间重新启动，则可能会出现与ADVM或ACFS驱动程序相关的错误。</p>
                  <p>如果服务器在升级过程中重新启动，则您可能会看到以下错误消息之一：</p><pre class="pre codeblock"><code>ACFS-9427：无法卸载ADVM / ACFS驱动程序。建议重启系统</code></pre><pre class="pre codeblock"><code>ACFS-9428无法加载ADVM / ACFS驱动程序。建议重启系统。</code></pre><ul style="list-style-type:disc">
                     <li>
                        <p>原因</p>
                        <p>ADVM和ACFS驱动程序仍在使用中。您必须重新启动系统才能启动新驱动程序。</p>
                     </li>
                     <li>
                        <p>行动</p>
                        <p>完成以下过程中所述的步骤。</p>
                     </li>
                  </ul>
                  <p>对于第一个节点以外的节点（启动升级的节点）：</p>
                  <ol>
                     <li>
                        <p>重新启动发生错误的节点。</p>
                     </li>
                     <li>
                        <p>再次在该节点上运行根脚本。</p>
                     </li>
                  </ol>
                  <p>对于第一个节点（启动升级的节点）：</p>
                  <ol>
                     <li>
                        <p>完成群集中所有其他节点的升级。</p>
                     </li>
                     <li>
                        <p>重启第一个节点。</p>
                     </li>
                     <li>
                        <p>再次在第一个节点上运行根脚本。</p>
                     </li>
                     <li>
                        <p>要完成升级，以root身份登录，并运行该脚本<code class="codeph">configToolAllCommands</code> ，位于路径<span class="italic"><code class="codeph">Grid_home</code></span> <code class="codeph">/cfgtoollogs/configToolAllCommands</code> 。
                        </p>
                     </li>
                  </ol>
                  <div class="section"></div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-2FF8F7DD-EF1A-4E2B-8A86-EC427B78EA2C__GUID-B6FF10E8-EB42-44CB-8F47-5461C1A8914B">
                     <p class="notep1">也可以看看：</p>
                     <p>适用于您的操作系统的<a href="../install-and-upgrade.html" target="_blank"><span class="italic">Oracle Grid Infrastructure安装指南</span></a> ，以获取有关解决群集升级问题的详细信息</p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-8AA2F6FB-516F-408C-868C-3979C46A5F7C" name="GUID-8AA2F6FB-516F-408C-868C-3979C46A5F7C"></a><h3 id="UPGRD-GUID-8AA2F6FB-516F-408C-868C-3979C46A5F7C" class="sect3">组件状态和升级</h3>
               <div>
                  <p>组件状态设置受先前安装的组件以及这些组件的升级支持。</p>
                  <p>话题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-5F3F0B5E-BF6E-488E-8819-850843758675">使用升级后状态工具了解组件状态</a><br>升级后状态工具<code>utlusts.sql</code>在升级完成后报告数据库组件状态。
                     </li>
                     <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-3D897BE9-AF83-4D96-831E-02AA070C7632">组件选项关闭状态和升级</a><br><code class="codeph">OPTION OFF</code>组件的升级状态受组件的目标版本中的支持以及组件必须作为升级的一部分进行升级的影响。
                     </li>
                     <li class="ulchildlink"><a href="troubleshooting-oracle-database-upgrade.html#GUID-5D85ED88-0740-44DE-AA53-318D7240FF0E">升级摘要报告的示例</a><br>升级摘要报告提供有关组件升级状态的信息。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               <a id="UPGRD12411"></a><div class="props_rev_3"><a id="GUID-5F3F0B5E-BF6E-488E-8819-850843758675" name="GUID-5F3F0B5E-BF6E-488E-8819-850843758675"></a><h4 id="UPGRD-GUID-5F3F0B5E-BF6E-488E-8819-850843758675" class="sect4">使用升级后状态工具了解组件状态</h4>
                  <div>
                     <p>升级后状态工具<code>utlusts.sql</code>在升级完成后报告数据库组件状态。
                     </p>
                     <p>您可以运行升级后状态工具<code>utlusts.sql</code>升级之后的任何时间，升级后，或重新编译无效对象用后<code>utlrp.sql</code> 。
                     </p>
                     <p>以下列表简要描述了升级后状态工具报告的状态值：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><samp class="sysout">无效</samp></p>
                           <p>升级完成后，组件的某些对象仍处于无效状态。如果在组件升级的日志文件中未发现任何错误，请运行脚本<code>utlrp.sql</code> 。运行此脚本可能会将无效组件的状态更改为<code class="codeph">VALID</code>而无需重新运行整个升级。运行<code>utlrp.sql</code>后检查<code class="codeph">DBA_REGISTRY</code>视图。
                           </p>
                        </li>
                        <li>
                           <p><samp class="sysout">有效</samp></p>
                           <p>该组件有效且没有错误。</p>
                        </li>
                        <li>
                           <p><samp class="sysout">LOADING</samp></p>
                           <p>组件正在加载</p>
                        </li>
                        <li>
                           <p><samp class="sysout">LOADED</samp></p>
                           <p>该组件已成功完成加载。</p>
                        </li>
                        <li>
                           <p><samp class="sysout">UPGRADING</samp></p>
                           <p>该组件正在升级中。</p>
                        </li>
                        <li>
                           <p><samp class="sysout">特训</samp></p>
                           <p>该组件已完成升级，没有错误。</p>
                        </li>
                        <li>
                           <p><samp class="sysout">降级</samp></p>
                           <p>该组件正在降级。</p>
                        </li>
                        <li>
                           <p><samp class="sysout">降级</samp></p>
                           <p>该组件已完成降级，没有错误。</p>
                        </li>
                        <li>
                           <p><samp class="sysout">拆卸</samp></p>
                           <p>正在删除该组件。</p>
                        </li>
                        <li>
                           <p><samp class="sysout">REMOVED</samp></p>
                           <p>该组件未升级，因为它已从数据库中删除。</p>
                        </li>
                        <li>
                           <p><samp class="sysout">选项关闭</samp></p>
                           <p>未安装组件所需的服务器选项或未与服务器链接。检查<code class="codeph">V$OPTION</code>视图和安装日志。使用所需选项安装组件或重新链接服务器，然后重新运行并行升级实用程序。
                           </p>
                        </li>
                        <li>
                           <p><samp class="sysout">没有脚本</samp></p>
                           <p>$ ORACLE_HOME中找不到组件升级脚本。检查安装日志，安装组件软件，然后重新运行并行升级实用程序。</p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-5F3F0B5E-BF6E-488E-8819-850843758675__GUID-DB88692E-C2CB-4E46-B785-DDB278D7810D">
                        <p class="notep1">注意：</p>
                        <p>您可以运行并行升级工具（ <code>catctl.pl</code>使用命令行脚本<code>dbupgrade</code>在Linux和UNIX和<code>dbupgrade.cmd</code>在Windows上）。
                        </p>
                     </div>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="oracle-database-upgrade-utilities.html#GUID-7935BC31-8818-4757-A6E7-A180C3E95A62">用于升级Oracle数据库的脚本</a></li>
                           <li><a href="improvements-data-dictionary-upgrade-and-upgrade-status-displays.html#GUID-34429081-C0F4-4C8F-AB66-6A0D1A02977A">更改为升级状态设置</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-8AA2F6FB-516F-408C-868C-3979C46A5F7C" title="组件状态设置受先前安装的组件以及这些组件的升级支持。">组件状态和升级</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-3D897BE9-AF83-4D96-831E-02AA070C7632" name="GUID-3D897BE9-AF83-4D96-831E-02AA070C7632"></a><h4 id="UPGRD-GUID-3D897BE9-AF83-4D96-831E-02AA070C7632" class="sect4">组件选项关闭状态和升级</h4>
                  <div>
                     <p><code class="codeph">OPTION OFF</code>组件的升级状态受组件的目标版本中的支持以及组件必须作为升级的一部分进行升级的影响。
                     </p>
                     <p>有三种情况下OPTION OFF组件已升级或未升级。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-3D897BE9-AF83-4D96-831E-02AA070C7632__GUID-3DA67F51-B44D-4B04-B1A7-DECC24886A5D">状态<code class="codeph">OPTION OFF</code>不支持的组件</p>
                        <p>如果数据库中的某个组件处于OPTION OFF状态，并且该组件不再支持数据库升级到目标版本，则不会升级此组件。升级后，其版本和状态保持不变..</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-3D897BE9-AF83-4D96-831E-02AA070C7632__GUID-BE542D84-6530-471F-8C77-A384FAD1A879">状态<code class="codeph">OPTION OFF</code>支持的组件</p>
                        <p>如果数据库中的某个组件处于<code class="codeph">OPTION OFF</code>状态，但该组件支持数据库升级到目标版本，则会升级此组件。升级后，组件的版本与目标发行版本匹配。此组件的状态是<code class="codeph">UPGRADED</code> （成功升级）或<code class="codeph">INVALID</code> （错误）。根据需要重新运行升级，直到所有升级的组件都处于<code class="codeph">UPGRADED</code>状态。然后运行<code class="codeph">utlrp.sql</code> 。如果组件在升级之前处于<code class="codeph">OPTION OFF</code>状态，则在升级之后，其编译和验证成功，其状态将恢复为OPTION OFF。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-3D897BE9-AF83-4D96-831E-02AA070C7632__GUID-E460BB5D-CED6-4EA8-85C7-2C4F7D1CE38E">具有必须升级的必需选项的受支持组件</p>
                        <p>从Oracle Database 18.1开始，必须升级具有所需选项的所有组件。这些组件是：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">RAC</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">SDO</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">APS</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">XOQ</code></p>
                           </li>
                        </ul>
                        <p>必须升级的组件遵循与升级相同的过程，与状态为<code class="codeph">OPTION OFF</code>标准支持组件相同</p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-8AA2F6FB-516F-408C-868C-3979C46A5F7C" title="组件状态设置受先前安装的组件以及这些组件的升级支持。">组件状态和升级</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="props_rev_3"><a id="GUID-5D85ED88-0740-44DE-AA53-318D7240FF0E" name="GUID-5D85ED88-0740-44DE-AA53-318D7240FF0E"></a><h4 id="UPGRD-GUID-5D85ED88-0740-44DE-AA53-318D7240FF0E" class="sect4">升级摘要报告的示例</h4>
                  <div>
                     <p>升级摘要报告提供有关组件升级状态的信息。</p>
                     <p>升级完成后，从Oracle Database 12 <span class="italic">c</span>发行版2开始，升级实用程序脚本（例如，在Oracle Database 19c中， <code class="codeph">utlusts.sql</code> ）使用以下写入顺序写入报告的副本：</p>
                     <ol>
                        <li>
                           <p><code class="codeph">ORACLE_BASE / cfgtoollogs / <span class="variable" translate="no">db_unique_name</span> / upgrade <span class="variable" translate="no">YYMMDDHHMMSC</span> /upg_summary.rpt</code></p>
                        </li>
                        <li>
                           <p><code>$ ORACLE_HOME / RDBMS /日志/ upg_summary.rpt</code></p>
                        </li>
                        <li>
                           <p>Linux和UNIX：</p><pre class="pre codeblock"><code>/tmp/upg_summary.rpt</code></pre><p>视窗：</p><pre class="pre codeblock"><code>\ TEMP \ upg_summary.rpt</code></pre></li>
                     </ol>
                     <p>如果实用程序脚本无法在第一个目录方案下创建报告，则它会尝试写入第二个位置，然后写入第三个位置。如果它无法写入任何这些路径，则它不会编写升级摘要报告。此示例来自Oracle Database 18c。</p>
                     <div class="example" id="GUID-5D85ED88-0740-44DE-AA53-318D7240FF0E__CHDBHFDB">
                        <p class="titleinexample">示例4-39升级后状态工具的升级摘要报告</p><pre class="pre codeblock"><code>Oracle Database Release 18升级后状态工具05-27-2018 23：41：0组件当前完全已用时间名称状态版本HH：MM：SS Oracle Server UPGRADED 18.3.0.0.0 00:18:21 JServer JAVA虚拟机已升级18.3.0.0.0 00:04:31 Oracle XDK UPGRADED 18.3.0.0.0 00:00:51 Oracle数据库Java软件包升级18.3.0.0.0 00:00:22 OLAP分析工作区UPGRADED 18.3.0.0.0 00:00 ：51 Oracle Label Security UPGRADED 18.3.0.0.0 00:00:20 Oracle Database Vault UPGRADED 18.3.0.0.0 00:00:40 Oracle Text UPGRADED 18.3.0.0.0 00:01:37 Oracle Workspace Manager UPGRADED 18.3.0.0 .00 00:01:10 Oracle Real Application Clusters UPGRADED 18.3.0.0.0 00:00:00 Oracle XML Database UPGRADED 18.3.0.0.0 00:02:17 Oracle Multimedia UPGRADED 18.3.0.0.0 00:03:01 Spatial升级18.3.0.0.0 00:06:23 Oracle OLAP API UPGRADED 18.3.0.0.0 00:00:22升级Datapatch 00:00:10最终操作00:00:20升级后00:00:05升级后Datapatch 00 ：00：04总升级时间：00：41：45</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-8AA2F6FB-516F-408C-868C-3979C46A5F7C" title="组件状态设置受先前安装的组件以及这些组件的升级支持。">组件状态和升级</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="props_rev_3"><a id="GUID-16E662C1-2877-4C97-A9D5-531735FAA2AC" name="GUID-16E662C1-2877-4C97-A9D5-531735FAA2AC"></a><h3 id="UPGRD-GUID-16E662C1-2877-4C97-A9D5-531735FAA2AC" class="sect3">标准版入门数据库和状态选项关闭的组件</h3>
               <div>
                  <p>从Oracle Database 18c（18.1）开始，所有<code class="codeph">OPTION OFF</code>组件都升级到新版本，但这些选项被禁用，因为Oracle Database Standard Edition（SE）保持OPTION OFF。</p>
                  <p>升级Oracle数据库标准版（SE）启动器数据库时，启动和升级启动器数据库中未包含的组件。运行<code class="codeph">utlrp.sql</code> ，未在服务器上打开且未包含在SE中的<code class="codeph">OPTION OFF</code>在<code class="codeph">DBA_REGISTRY</code>视图中重置为<code class="codeph">OPTION OFF</code> 。
                  </p>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="UPGRD60136"></a><div class="props_rev_3"><a id="GUID-50E0EE5B-9549-4A35-8F27-5134AC42D484" name="GUID-50E0EE5B-9549-4A35-8F27-5134AC42D484"></a><h3 id="UPGRD-GUID-50E0EE5B-9549-4A35-8F27-5134AC42D484" class="sect3">升级后调整Oracle ASM密码文件位置</h3>
               <div>
                  <p>在Oracle Grid Infrastructure升级后，您必须为Oracle ASM创建新的密码文件。</p>
                  <div class="section">
                     <p>在Grid Infrastructure升级后运行<code class="codeph">srvctl config asm</code>时，Oracle ASM密码文件位置不会显示在命令输出中。密码文件的位置不会自动传递到新的Oracle ASM磁盘组。要使SRVCTL在升级后具有密码文件位置，必须提前磁盘组兼容性设置并在磁盘组中创建PWFILE。然后SRVCTL报告共享PWFILE的配置位置。</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-50E0EE5B-9549-4A35-8F27-5134AC42D484__GUID-3916DB42-FB24-4643-8CE8-D1726A11D7C0">
                     <p class="notep1">也可以看看：</p>
                     <p>有关管理磁盘组中的共享密码文件的信息，请参见<a href="../ostmg/authenticate-access-asm-instance.html#OSTMG95331" target="_blank"><span><cite>“Oracle自动存储管理管理员指南”</cite></span></a></p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-371A976A-C6B5-408A-85C3-13B8D4D80BF0" name="GUID-371A976A-C6B5-408A-85C3-13B8D4D80BF0"></a><h3 id="UPGRD-GUID-371A976A-C6B5-408A-85C3-13B8D4D80BF0" class="sect3">使用可插拔数据库升级修复“警告XDB现在无效”错误</h3>
               <div>
                  <p>如果在升级可插拔数据库（PDB）时遇到“警告：XDB现在无效，发现无效对象”错误，请查看此主题。</p>
                  <div class="section">
                     <p>将Oracle Database 12 <span class="italic">c</span>发行版1（12.1）可插拔数据库（PDB）插入Oracle Database 12 <span class="italic">c</span>发行版2（12.2）或更高版本的多租户容器数据库（CDB）时，可能会遇到XML对象错误。
                     </p>
                     <p>通过在对象关系XML模式中注册系统生成的名称来创建公共对象（ <code class="codeph">dba_objects</code>具有<span class="parmname" translate="no">sharing='METADATA LINK'</span>的对象）。通过使用对象关系存储注册一些ORDSYS模式来创建这些常见类型。
                     </p>
                     <p>这些公共对象的名称是系统生成的，版本12.1中生成的名称可能与版本12.2及更高版本中用于这些对象的名称不同。由于这些可能的名称更改，您可以发现版本12.1对象类型在版本12.2或更高版本的CDB根目录中没有匹配的公共类型。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="p">
                     <p>使用以下过程解决此问题：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>查询目标CDB根目录中的视图<code class="codeph">PDB_PLUG_IN_VIOLATIONS</code>以查看是否存在包含<code class="codeph">'GetTypeDDL'</code>任何操作 </span><div>如果您找到<code class="codeph">'GetTypeDDL'</code>操作，则升级后的PDB会出现常见对象问题。
                        </div>
                     </li>
                     <li class="stepexpand"><span>运行PL / SQL包<code class="codeph">SET SERVEROUTPUT ON</code>和<code class="codeph">exec xdb.目标PDB中的DBMS_XMLSTORAGE_MANAGE.GetTypeDDL</code>生成用户命名的SQL脚本（例如， <code class="codeph">script1.sql</code> ）。</span></li>
                     <li class="stepexpand"><span>运行在步骤2中创建的脚本（例如，源12.1 CDB中的<code class="codeph">script1.sql</code>以获取您遇到错误的每种常见类型的类型创建脚本</span></li>
                     <li class="stepexpand"><span>生成另一个包含这些创建脚本的用户命名的SQL脚本（例如， <code class="codeph">script2.sql</code> ）。</span></li>
                     <li class="stepexpand"><span>运行在目标PDB中在源12.1 CDB上创建的脚本（例如， <code class="codeph">script2.sql</code> ）。</span><div></div>
                     </li>
                  </ol>
                  <div class="section">从版本12.1源CDB类型创建脚本生成的脚本会在目标PDB中生成所有这些对象。在目标PDB中使这些公共对象可用将消除无效的XDB错误。</div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="UPGRD60137"></a><div class="props_rev_3"><a id="GUID-0BBD601F-03AD-495F-BE3B-EBF6F5180A12" name="GUID-0BBD601F-03AD-495F-BE3B-EBF6F5180A12"></a><h3 id="UPGRD-GUID-0BBD601F-03AD-495F-BE3B-EBF6F5180A12" class="sect3">修复ORA-27248：sys.dra_reevaluate_open_failures正在运行</h3>
               <div>
                  <p>使用此过程可识别阻止升级的<code>DRA_REEVALUATE_OPEN_FAILURES</code>作业。
                  </p>
                  <p>在升级期间，如果DBUA因错误<samp class="sysout">ORA-27248而</samp>失败<samp class="sysout">：sys.dra_reevaluate_open_failures正在运行</samp> ，则作业<code class="codeph">DRA_REEVALUATE_OPEN_FAILURES</code>正在运行，这会导致升级失败。在继续升级之前，请确保已停止作业。
                  </p>
                  <p>在作业定义中，如果<code class="codeph">ALLOW_RUNS_IN_RESTRICTED_MODE</code>设置为TRUE，并且允许作业所有者在受限模式下登录，则允许在数据库处于受限模式或升级模式时运行该作业。此参数的默认设置为FALSE。</p>
                  <p>使用以下查询查看任何正在运行的作业的状态：</p><pre class="oac_no_warn" dir="ltr">SQL&gt;从dba_objects中选择OBJECT_NAME，Owner，OBJECT_TYPE whereobject_name，如'％DRA_REEVA％';</pre></div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-82B1B90A-9268-4FCA-91B5-9486A01B0C11" name="GUID-82B1B90A-9268-4FCA-91B5-9486A01B0C11"></a><h3 id="UPGRD-GUID-82B1B90A-9268-4FCA-91B5-9486A01B0C11" class="sect3">修复ORA-22288：文件或LOB操作FILEOPEN路径中的软链接失败</h3>
               <div>
                  <p>当打开BFILES时，符号链接在目录对象路径或文件名中时发生ORA-22288。</p>
                  <div class="section">
                     <p>创建目录对象或BFILE对象时，必须满足以下条件。</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>操作系统文件不能是符号链接或硬链接。</p>
                        </li>
                        <li>
                           <p>Oracle DIRECTORY对象中指定的操作系统目录路径必须是现有的操作系统目录路径。</p>
                        </li>
                        <li>
                           <p>Oracle DIRECTORY对象中指定的操作系统目录路径不应在其组件中包含任何符号链接。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-82B1B90A-9268-4FCA-91B5-9486A01B0C11__GUID-6971E64E-4A72-4AE5-A373-0D64CED71E4B">
                     <p>打开BFILE时，将检查整个目录路径和文件名。如果找到任何符号链接，则会收到以下错误。</p><pre class="pre codeblock"><code>ORA-22288：文件或LOB操作FILEOPEN路径中的软链接失败</code></pre></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p>要解决此错误，请删除符号链接，并遵守创建BFILE的其他要求。</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="../adlob/introduction-to-large-objects.html#ADLOB-GUID-E4FEEE1B-26EB-45E3-931A-54501A900F87" target="_blank"><span><cite>Oracle Database SecureFiles和大对象开发人员指南</cite></span></a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
            </div>
            <div class="props_rev_3"><a id="GUID-39D29002-04E8-4C15-99CB-3BA74DE7C9E3" name="GUID-39D29002-04E8-4C15-99CB-3BA74DE7C9E3"></a><h3 id="UPGRD-GUID-39D29002-04E8-4C15-99CB-3BA74DE7C9E3" class="sect3">修复Oracle数据库企业用户安全性，OLS-OID和配置文件错误</h3>
               <div>
                  <p>查看以了解<samp class="sysout">ORA-16000：数据库是否为只读访问</samp>错误而<samp class="sysout">打开</samp> 。
                  </p>
                  <div class="section">
                     <p>升级使用OLS和备用数据库的数据库后，您可能会看到ORA-16000（数据库打开以进行只读访问）。切换后，使用新主服务器的连接信息更新Provisioning配置文件。如果不更新配置配置文件，则策略将继续传播到新备用数据库（旧主数据库），并且数据库继续因ORA-16000错误而失败。</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-39D29002-04E8-4C15-99CB-3BA74DE7C9E3__GUID-67654FFF-AFE8-47BC-802E-CF240EFF5C93">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="../dbimi/upgrading-from-oracle9i-to-oracle-database-12c-release-12-2.html#DBIMI10245" target="_blank"><span class="italic">“Oracle数据库企业用户安全性管理员指南”</span></a> ，了解将Oracle数据库从10 <span class="italic">g</span> （10.1）及更高版本升级到Oracle Database 12 <span class="italic">c</span>所需的其他步骤</p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="props_rev_3"><a id="GUID-C9EA4C17-E283-4D21-9C9B-0EE97FE2A486" name="GUID-C9EA4C17-E283-4D21-9C9B-0EE97FE2A486"></a><h3 id="UPGRD-GUID-C9EA4C17-E283-4D21-9C9B-0EE97FE2A486" class="sect3">使用utl32k.sql和MAX_STRING_SIZE修复32K迁移错误</h3>
               <div>
                  <p>使用此过程修复<samp class="sysout">ORA-01722：无效的数字</samp>升级错误。
                  </p>
                  <p>如果初始化参数<span class="parmname" translate="no">MAX_STRING_SIZE</span>设置为<code>EXTENDED</code> ，但<code>utl32k.sql</code>脚本执行的32K迁移未完成，则数据库升级失败，并显示以下错误：</p><pre class="oac_no_warn" dir="ltr">SELECT TO_NUMBER（'32K_MIGRATION_NOT_COMPLETED'）*第1行的错误：ORA-01722：无效的数字</pre><p>数据库升级不会自动运行<code>utl32k.sql</code>脚本，也不会执行32K迁移。
                  </p>
                  <p>使用以下手动过程完成升级和32K迁移：</p>
                  <ol>
                     <li>
                        <p>将初始化参数<span class="parmname" translate="no">MAX_STRING_SIZE</span>重置为<span class="parmname" translate="no">STANDARD</span> 。</p>
                     </li>
                     <li>
                        <p>以<code>UPGRADE</code>模式重新启动数据库。
                        </p>
                     </li>
                     <li>
                        <p>使用手动过程重新运行升级。</p>
                     </li>
                     <li>
                        <p>升级数据库后，将初始化参数<span class="parmname" translate="no">MAX_STRING_SIZE</span>设置为<code>EXTENDED</code> 。</p>
                     </li>
                     <li>
                        <p>以<code>UPGRADE</code>模式重新启动数据库。
                        </p>
                     </li>
                     <li>
                        <p>运行SQL脚本<code class="codeph">../rdbms/admin/utl32k.sql</code> 。
                        </p>
                     </li>
                  </ol>
                  <p>运行<code>utl32k.sql</code>脚本后，升级后的数据库将完成32K迁移并支持<span class="parmname" translate="no">EXTENDED</span>参数。
                  </p>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="props_rev_3"><a id="GUID-906173BF-B48E-4E2A-86EF-7B174E564AC0" name="GUID-906173BF-B48E-4E2A-86EF-7B174E564AC0"></a><h3 id="UPGRD-GUID-906173BF-B48E-4E2A-86EF-7B174E564AC0" class="sect3">从CRS关闭和Oracle ASM恢复滚动迁移恢复</h3>
               <div>
                  <p>所有集群成员节点上的集群就绪服务（CRS）关闭可以使集群处于异构状态。使用此过程可以从该问题中恢复。</p>
                  <p>如果CRS在所有节点上关闭，Oracle自动存储管理（Oracle ASM）将失去滚动迁移状态。此CRS关闭可以创建异构状态，因此您无法重新启动所有集群成员节点。您无法在群集中启动不同版本的两个节点。如果尝试启动运行不同版本的Oracle ASM的节点，则运行Oracle ASM节点的其中一组异构节点将失败，从而生成ORA-15153或ORA-15163错误消息。</p>
                  <p>请考虑以下四个节点（node1，node2，node3和node4）的情形，这些节点位于Oracle Database版本11.2.0.2并升级到版本12.1.0.2。</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>Node1和node2升级到12.1.0.2并正在运行。</p>
                     </li>
                     <li>
                        <p>Node3和节点4仍处于11.2.0.2并且正在运行。</p>
                     </li>
                     <li>
                        <p>现在考虑到所有CRS堆栈都已关闭的中断，这使得群集处于异构状态（即，11.2.0.2处的两个节点和12.1.0.2处的两个节点）。</p>
                     </li>
                  </ul>
                  <p>以此方案为例，完成以下过程：</p>
                  <ol>
                     <li>
                        <p>仅重新启动早期版本中的节点。在此方案中，启动版本11.2.0.2（node3或node4或两者）中的节点。</p>
                     </li>
                     <li>
                        <p>在启动任何12.1.0.2节点之前，在node3或node4上的Oracle ASM实例上运行以下SQL命令：</p><pre class="oac_no_warn" dir="ltr"><code class="codeph">更换系统开始将移动转移到'12 .1.0.2'</code></pre></li>
                     <li>
                        <p>从故障点继续记录的升级过程。</p>
                     </li>
                  </ol>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="props_rev_3"><a id="GUID-6D5F3EEE-D8CC-45F8-81A7-1C3BC96952FA" name="GUID-6D5F3EEE-D8CC-45F8-81A7-1C3BC96952FA"></a><h3 id="UPGRD-GUID-6D5F3EEE-D8CC-45F8-81A7-1C3BC96952FA" class="sect3">数据类型版本控制可能导致跨版本复制（ORA-26656）</h3>
               <div>
                  <p>查看受版本控制影响的用户定义的对象类型。</p>
                  <p>版本12.1.0.2引入了可以是Oracle对象类型属性的数据类型的版本控制（参考错误18897657）。由于此功能，版本12.1.0.1和版本12.1.0.2数据库之间的跨版本复制可能会受到影响，从而导致ORA-26656错误。</p>
                  <p>如果任何用户定义的对象类型包含<code class="codeph">DATE</code> ， <code class="codeph">TIMESTAMP</code> ， <code class="codeph">TIMESTAMP WITH TIME ZONE</code> ， <code class="codeph">TIMESTAMP WITH LOCAL TIME ZONE</code> ， <code class="codeph">BINARY_FLOAT</code> ， <code class="codeph">BINARY_DOUBLE</code> ， <code class="codeph">NCHAR</code> ， <code class="codeph">NVARCHAR2</code> ， <code class="codeph">NCLOB</code> ， <code class="codeph">ANYDATA</code>和类似对象的<code class="codeph">ANYDATA</code> ，则必须应用强制修补程序集更新18038108到所有发布12.1.0.1实例。
                  </p>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-A6410CD4-4DCE-41D3-BBA1-0CF1CC8204E5" name="GUID-A6410CD4-4DCE-41D3-BBA1-0CF1CC8204E5"></a><h3 id="UPGRD-GUID-A6410CD4-4DCE-41D3-BBA1-0CF1CC8204E5" class="sect3">引用的符号计数是未定义的错误libclntsh.so.11.1</h3>
               <div>
                  <p>如果您遇到引用<code class="codeph">libclntsh.so.11.1</code>且“引用符号计数未定义”，“无法打开共享对象文件”或类似错误的错误，请查看此主题。
                  </p>
                  <p>在升级到Oracle Database 12 <span class="italic">c</span>或18c期间，链接到<code class="codeph">libclntsh.so.11.1</code>文件的客户端应用程序可能无法在Oracle Solaris，HP-UX Itanium或IBM AIX平台上运行。在那种情况下，您会看到类似于以下内容的错误消息：</p><pre class="pre codeblock"><code>引用的符号计数未定义</code></pre><div class="section">
                     <p class="subhead2" id="GUID-A6410CD4-4DCE-41D3-BBA1-0CF1CC8204E5__GUID-E9D05AEA-BEDF-4BE1-98A7-3735A1DBECDC">解决方法</p>
                     <p>重新链接对新受影响的客户端应用程序<code class="codeph">libclntsh.so.12.2</code> Oracle数据库<span class="italic">12℃，</span>或<code class="codeph">libclntssh.so.18.1</code> Oracle数据库18c的文件。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-264F7099-5C9F-42D1-B3D7-D9754CA7F3C2" name="GUID-264F7099-5C9F-42D1-B3D7-D9754CA7F3C2"></a><h3 id="UPGRD-GUID-264F7099-5C9F-42D1-B3D7-D9754CA7F3C2" class="sect3">解决由ISO 8601时间戳引起的时间戳错误</h3>
               <div>
                  <p>如果在升级到Oracle Database 12 <span class="italic">c</span> ，18c或更高版本后遇到应用程序的时间戳错误，请查看此主题。
                  </p>
                  <p>ISO 8601是由国际标准化组织（ISO）和国际电工委员会（IEC）建立的交换日期和时间相关数据的国际标准。本标准的目的是提供一个表示日期和时间的通用国际标准，以避免使用不同惯例编写数字日期和时间的国家之间使用的数据误解日期和时间。例如：</p><pre class="pre codeblock"><code>2015-09-23T19：25：25.123456 + 00：00</code></pre><p>Oracle建议您使用此标准。</p>
                  <p>默认情况下，初始化参数UNIFORM_LOG_TIMESTAMP_FORMAT设置为TRUE。如果使用ISO 8601标准导致脚本中断，则可以将UNIFORM_LOG_TIMESTAMP_FORMAT设置为FALSE，以使Oracle Database 12.2发行版或更高版本恢复为Oracle Database 12.1中使用的时间戳格式。更改初始化参数后，修复脚本以便它们可以使用ISO 8601时间戳。当脚本可以使用ISO 8601标准时，请将参数更改回默认值TRUE。</p>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-2F4DAD7F-92E4-415C-A91B-7EE480633E3E" name="GUID-2F4DAD7F-92E4-415C-A91B-7EE480633E3E"></a><h3 id="UPGRD-GUID-2F4DAD7F-92E4-415C-A91B-7EE480633E3E" class="sect3">修复仅在Datapatch失败的情况下失败的升级</h3>
               <div>
                  <p>如果在升级期间只有datapatch失败，则直接重新运行datapatch。</p>
                  <div class="section">
                     <p>Datapatch脚本<code class="codeph">datapatch.pl</code>是PERL脚本。在某些修补操作中，由于ORA-20001等错误，最终的升级后修补程序可能无法运行。如果只有Datapatch脚本失败，则无需再次运行升级即可解决此问题。而是直接运行<code class="codeph">datapatch.pl</code> 。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="p">
                     <p>要修复失败的数据片，请以Oracle用户身份登录，然后完成以下过程：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>在升级的Oracle主目录中将目录更改为Opatch。</span><div><pre class="pre codeblock"><code>$ cd $ ORACLE_HOME / OPatch</code></pre></div>
                        <div></div>
                     </li>
                     <li class="stepexpand"><span>运行datapatch命令。</span><div><pre class="pre codeblock"><code>$ ./datapatch -verbose</code></pre></div>
                     </li>
                  </ol>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-C18782A1-4A4F-4C06-B0D6-F58ECE28E13C" name="GUID-C18782A1-4A4F-4C06-B0D6-F58ECE28E13C"></a><h3 id="UPGRD-GUID-C18782A1-4A4F-4C06-B0D6-F58ECE28E13C" class="sect3">错误“时区数据文件不能降级为较低版本”</h3>
               <div>
                  <p>如果要升级的数据库中的夏令时版本（DST）版本比要升级的数据库版本中的DST更新，则会遇到禁止升级的时区错误。</p>
                  <div class="section">
                     <p>场景：您运行数据库升级助手（DBUA）以从早期版本的Oracle数据库升级到更高版本的Oracle数据库，并遇到以下错误：</p><pre class="pre codeblock"><code>严重：由于Oracle数据库升级，时区数据文件可能不会降级为较低版本。</code></pre><p>如果从早期Oracle数据库发行版升级到更高版本的Oracle数据库发行版，则会发生此错误，并且您的早期版本Oracle数据库Oracle主目录具有比新升级Oracle数据库Oracle主目录更新的DST修补程序。在日志文件<code class="codeph">preupgrade.log</code> ，系统会指示您使用旧Oracle主目录中更新的DST修补程序修补新的Oracle数据库Oracle主目录。例如：</p> 
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-C18782A1-4A4F-4C06-B0D6-F58ECE28E13C__GUID-E9528D8A-8220-4878-9001-4BFCF6B5DE38"><pre class="pre codeblock"><code>+使用12.1.0.2.0 $ ORACLE_HOME / oracore / zoneinfo /中的版本29时区数据文件修补新的12.2.0.1.0 $ ORACLE_HOME / oracore / zoneinfo /。数据库使用的时区文件版本比12.2.0.1.0版本附带的版本更新。由于Oracle数据库升级，时区数据文件可能不会降级为较低版本。</code></pre><p>但是，即使您将新的Oracle主服务器修补为与早期版本的Oracle Database Oracle主目录库相同的版本，此错误仍可能存在。</p>
                  </div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-C18782A1-4A4F-4C06-B0D6-F58ECE28E13C__GUID-AC87F00F-3924-42A4-9D57-D05EC1ECD881">
                     <p>解决方法：</p>
                     <p>如果在使用当前时区文件修补新的Oracle主目录后仍然遇到此错误，请使用标志<code class="codeph">-ignorePreReqs true</code>标志运行Oracle数据库升级助手。用tis运行助手</p><pre class="pre codeblock"><code>$ dbua -sid mydb -oracleHome /u02/product/12.2.0/dbhome_1/-ignorePreReqs  -  true</code></pre></div>
                  <!-- class="example" -->
                  <div class="section">
                     <div class="infoboxnote" id="GUID-C18782A1-4A4F-4C06-B0D6-F58ECE28E13C__GUID-7F99134A-6BF0-4782-9562-CF784AC3A072">
                        <p class="notep1">警告：</p>
                        <p>仅使用此解决方法来关闭此特定方案的先决条件检查。忽略报告Oracle主目录之间的时区版本错误的有效失败检查会导致升级失败。</p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-25BB78B8-B59D-4039-B838-9BCA13A5377C" name="GUID-25BB78B8-B59D-4039-B838-9BCA13A5377C"></a><h3 id="UPGRD-GUID-25BB78B8-B59D-4039-B838-9BCA13A5377C" class="sect3">使用DBUA修复听众完成注册的失败</h3>
               <div>
                  <p>在“数据库升级助手进度”步骤中，将出现一个窗口，其中包含以下警告：“无法在目录服务中创建数据库条目。没有配置听众。“</p>
                  <div class="section">
                     <p>在此方案中，您已完成以下步骤：</p>
                     <ol>
                        <li>
                           <p>使用Net Configuration Assistant（NetCA）或Net Manager在早期版本的Oracle主目录中创建了一个侦听器。</p>
                        </li>
                        <li>
                           <p>在新的Oracle主目录中安装了新的Oracle数据库版本，并将其注册到侦听器。</p>
                        </li>
                        <li>
                           <p>您希望将侦听器注册到Oracle Internet Directory（OID），并升级数据库，或者您希望在新的Oracle主目录上的OID上注册侦听器。</p>
                        </li>
                     </ol>
                     <div class="infoboxnote" id="GUID-25BB78B8-B59D-4039-B838-9BCA13A5377C__GUID-1E647DF5-15C0-434B-B0ED-0E053584DC84">
                        <p class="notep1">注意：</p>
                        <p>如果侦听器从服务器上的另一个Oracle主目录运行，或者侦听器从当前的Oracle主目录运行，但它未在<code class="codeph">LISTENER.ORA</code>文件中配置（即，它使用自动生成的默认配置），则DBCA无法找到监听器。
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>在升级过程中，DBUA不再将升级后的数据库直接注册到OID。</p>
                     <p>要解决此问题，请完成以下任务：</p>
                     <ol>
                        <li>
                           <p>从OID取消注册侦听器。</p>
                        </li>
                        <li>
                           <p>执行数据库升级。</p>
                        </li>
                        <li>
                           <p>再次将迁移的侦听器注册到新版Oracle Database Oracle主目录上的OID注册表。</p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2" title="使用这些故障排除提示可以解决升级数据库时可能遇到的错误或问题。">Oracle数据库升级故障排除</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>