<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="You can use SQL tuning sets to group statements and related metadata into a single object, which you can use as input to SQL tuning tools."></meta>
      <meta name="description" content="You can use SQL tuning sets to group statements and related metadata into a single object, which you can use as input to SQL tuning tools."></meta>
      <title>管理SQL调优集</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="SQL Tuning Guide"></meta>
      <meta property="og:description" content="You can use SQL tuning sets to group statements and related metadata into a single object, which you can use as input to SQL tuning tools."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="SQL Tuning Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="sql-tuning-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-31T14:57:08-08:00"></meta>
      <meta name="dcterms.title" content="SQL Tuning Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="2013, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96095-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="automatic-sql-tuning.html" title="Previous" type="text/html"></link>
      <link rel="next" href="sql-tuning-advisor.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGSQL"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="automatic-sql-tuning.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="sql-tuning-advisor.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL调优指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="automatic-sql-tuning.html" property="item" typeof="WebPage"><span property="name">自动SQL调整</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">管理SQL调优集</li>
            </ol>
            <a id="GUID-91D1B886-A6D7-40B8-93D5-112B8C6E6AFE" name="GUID-91D1B886-A6D7-40B8-93D5-112B8C6E6AFE"></a><a id="TGSQL516"></a>
            
            <h2 id="TGSQL-GUID-91D1B886-A6D7-40B8-93D5-112B8C6E6AFE" class="sect2"><span class="enumeration_chapter">23</span>管理SQL调整集</h2>
         </header>
         <div class="ind">
            <div>
               <p>您可以使用SQL调优集将语句和相关元数据分组到单个对象中，您可以将其用作SQL调优工具的输入。</p>
               <p>本章包含以下主题：</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="managing-sql-tuning-sets.html#GUID-DD136837-9921-4C73-ABB8-9F1DC22542C5">关于SQL调整集</a><br><strong class="term">SQL调优集（STS）</strong>是一个数据库对象，可用作调优工具的输入。
                  </li>
                  <li class="ulchildlink"><a href="managing-sql-tuning-sets.html#GUID-5F6C1400-AD6F-4BEB-A0D8-12AADA127ADD">创建SQL调整集</a><br>使用<code class="codeph">DBMS_SQLTUNE</code>或<code class="codeph">DBMS_SQLSET</code>的<code class="codeph">CREATE_SQLSET</code>过程在数据库中创建空STS。
                  </li>
                  <li class="ulchildlink"><a href="managing-sql-tuning-sets.html#GUID-4E5240CD-B021-4728-89A9-95F5B81CBC59">加载SQL调优集</a><br>要使用SQL语句加载STS，请使用<code class="codeph">DBMS_SQLTUNE</code>或<code class="codeph">DBMS_SQLSET</code>包中的<code class="codeph">LOAD_SQLSET</code>过程。
                  </li>
                  <li class="ulchildlink"><a href="managing-sql-tuning-sets.html#GUID-B776D937-29CF-40CA-9D5B-2C427934190E">显示SQL调整集的内容</a><br>要在创建和填充STS后读取STS的内容，请使用<code class="codeph">DBMS_SQLTUNE</code>或<code class="codeph">DBMS_SQLSET</code>的<code class="codeph">SELECT_SQLSET</code>函数，可选择使用过滤条件。
                  </li>
                  <li class="ulchildlink"><a href="managing-sql-tuning-sets.html#GUID-1C2E5289-B579-4AA9-8073-5F77358A8E62">修改SQL调整集</a><br>使用<code class="codeph">DBMS_SQLTUNE</code>或<code class="codeph">DBMS_SQLSET</code>的<code class="codeph">DELETE_SQLSET</code>过程从STS中删除SQL语句。</li>
                  <li class="ulchildlink"><a href="managing-sql-tuning-sets.html#GUID-E6F9F020-6257-4456-A568-8BF4CC1FFF7C">传输SQL调整集</a><br>您可以将STS传输到在Oracle数据库<span class="italic">10g</span>第2版（10.2）或更高版本中创建的任何数据库。使用SQL Performance Analyzer调整测试数据库的回归时，此技术非常有用。
                  </li>
                  <li class="ulchildlink"><a href="managing-sql-tuning-sets.html#GUID-493FA794-EF69-464D-BB6F-C8CF06686023">删除SQL调优集</a><br>要从数据库中删除STS，请使用<code class="codeph">DBMS_SQLTUNE</code>或<code class="codeph">DBMS_SQLSET</code>包中的<code class="codeph">DROP_SQLSET</code>过程。
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="automatic-sql-tuning.html#GUID-538A6E57-527A-46D2-97B8-F2238E0D0838" title="SQL Tuning Advisor和SQL Access Advisor是内置工具，提供SQL调优建议。">自动SQL调整</a></p>
                  </div>
               </div>
            </div>
            <a id="TGSQL517"></a><div class="props_rev_3"><a id="GUID-DD136837-9921-4C73-ABB8-9F1DC22542C5" name="GUID-DD136837-9921-4C73-ABB8-9F1DC22542C5"></a><h3 id="TGSQL-GUID-DD136837-9921-4C73-ABB8-9F1DC22542C5" class="sect3"><span class="enumeration_section">23.1</span>关于SQL调整集</h3>
               <div>
                  <p><strong class="term">SQL调优集（STS）</strong>是一个数据库对象，可用作调优工具的输入。
                  </p>
                  <p>数据库将SQL调优集存储在数据库提供的模式中。STS包括：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>一组SQL语句</p>
                     </li>
                     <li>
                        <p>关联的执行上下文，例如用户架构，应用程序模块名称和操作，绑定值列表以及用于<a href="glossary.html#GUID-F9233BE0-9CB9-4673-A705-174924AE3B18"><span class="xrefglossterm">SQL编译</span></a>游标的环境</p>
                     </li>
                     <li>
                        <p>关联的基本执行统计信息，例如已用时间，CPU时间，缓冲区获取，磁盘读取，已处理的行，游标提取，执行次数，完成执行次数，优化程序成本和命令类型</p>
                     </li>
                     <li>
                        <p>每个SQL语句的关联执行计划和行源统计信息（可选）</p>
                     </li>
                  </ul>
                  <div class="infoboxnote" id="GUID-DD136837-9921-4C73-ABB8-9F1DC22542C5__GUID-A187E5CE-55AC-4159-A5BF-98A40B3092E9">
                     <p class="notep1">注意：</p>
                     <p>将STS与可插拔数据库一起使用时，数据可见性和权限要求可能会有所不同。有关可管理性功能如何在容器数据库（CDB）中工作的表，请参见“ <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ADMIN13885" target="_blank"><span><cite>Oracle数据库管理员指南”</cite></span></a> 。
                     </p>
                  </div>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="managing-sql-tuning-sets.html#GUID-FAFB39D0-13DB-4682-AAEE-6581D71D814C">SQL调优集的目的</a><br>通过STS，您可以在单个数据库对象中对SQL语句和相关元数据进行分组，您可以使用它来满足调整目标。
                     </li>
                     <li class="ulchildlink"><a href="managing-sql-tuning-sets.html#GUID-AB246C71-0701-4FD3-B703-49A1F706B7F3">SQL调优集的概念</a><br>要创建STS，必须从源将SQL语句加载到STS中。
                     </li>
                     <li class="ulchildlink"><a href="managing-sql-tuning-sets.html#GUID-135EE7C5-2768-4BDB-B914-CDD3904AC030">SQL调整集的用户界面</a><br>您可以使用Oracle Enterprise Manager云控制（云控制）或PL / SQL包来管理SQL调优集。Oracle建议使用Cloud Control。
                     </li>
                     <li class="ulchildlink"><a href="managing-sql-tuning-sets.html#GUID-9203BA12-8EDE-4EE5-B4EC-3265824200D7">SQL调优集的基本任务</a><br><code class="codeph">DBMS_SQLTUNE</code>提供了创建，使用和删除SQL调优集所需的过程。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-sql-tuning-sets.html#GUID-91D1B886-A6D7-40B8-93D5-112B8C6E6AFE" title="您可以使用SQL调优集将语句和相关元数据分组到单个对象中，您可以将其用作SQL调优工具的输入。">管理SQL调整集</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL518"></a><div class="props_rev_3"><a id="GUID-FAFB39D0-13DB-4682-AAEE-6581D71D814C" name="GUID-FAFB39D0-13DB-4682-AAEE-6581D71D814C"></a><h4 id="TGSQL-GUID-FAFB39D0-13DB-4682-AAEE-6581D71D814C" class="sect4"><span class="enumeration_section">23.1.1</span> SQL调优集的用途</h4>
                  <div>
                     <p>通过STS，您可以在单个数据库对象中对SQL语句和相关元数据进行分组，您可以使用它来满足调整目标。</p>
                     <p>具体来说，SQL调优集实现了以下目标：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>为性能调优顾问提供输入</p>
                           <p>您可以使用STS作为多个数据库顾问程序的输入，包括SQL Tuning Advisor，SQL Access Advisor和SQL Performance Analyzer。</p>
                        </li>
                        <li>
                           <p>在数据库之间传输SQL</p>
                           <p>您可以将SQL调优集从一个数据库导出到另一个数据库，从而在数据库之间传输SQL工作负载，以进行远程性能诊断和调优。当在生产数据库上发生次优执行SQL语句时，开发人员可能不希望直接在生产数据库上进行调查和调优。DBA可以将有问题的SQL语句传输到测试数据库，开发人员可以在其中安全地分析和调整它们。</p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-sql-tuning-sets.html#GUID-DD136837-9921-4C73-ABB8-9F1DC22542C5" title="SQL调优集（STS）是一个数据库对象，可用作调优工具的输入。">关于SQL调整集</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL520"></a><a id="TGSQL519"></a><div class="props_rev_3"><a id="GUID-AB246C71-0701-4FD3-B703-49A1F706B7F3" name="GUID-AB246C71-0701-4FD3-B703-49A1F706B7F3"></a><h4 id="TGSQL-GUID-AB246C71-0701-4FD3-B703-49A1F706B7F3" class="sect4"><span class="enumeration_section">23.1.2</span> SQL调整集的概念</h4>
                  <div>
                     <p>要创建STS，必须从源将SQL语句加载到STS中。</p>
                     <p><a href="managing-sql-tuning-sets.html#GUID-AB246C71-0701-4FD3-B703-49A1F706B7F3__BEIHEGAG">如图23-1</a>所示，源可以是Automatic Workload Repository（AWR）， <a href="glossary.html#GUID-577D0DD3-FB98-4B1B-BCFB-95313BB35C01"><span class="xrefglossterm">共享SQL区域</span></a> ，用户提供的自定义SQL，跟踪文件或其他STS。</p>
                     <div class="figure" id="GUID-AB246C71-0701-4FD3-B703-49A1F706B7F3__BEIHEGAG">
                        <p class="titleinfigure">图23-1 SQL调整集</p><img src="img/tgsql_vm_065.png" alt="下面是图23-1的描述" title="下面是图23-1的描述" longdesc="img_text/tgsql_vm_065.html"><br><a href="img_text/tgsql_vm_065.html">“图23-1 SQL调整集”的说明</a></div>
                     <!-- class="figure" -->
                     <p>SQL调优集可以执行以下操作：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>使用应用程序模块名称和操作或任何执行统计信息筛选SQL语句</p>
                        </li>
                        <li>
                           <p>根据执行统计信息的任意组合对SQL语句进行排名</p>
                        </li>
                        <li>
                           <p>作为顾问的输入或将其传输到不同的数据库</p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-AB246C71-0701-4FD3-B703-49A1F706B7F3__GUID-B764961A-A69F-4706-ACA9-EAAA4A7F2782">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=TGDBA169" target="_blank"><span><cite>Oracle数据库性能调优指南</cite></span></a> ，了解AWR</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-sql-tuning-sets.html#GUID-DD136837-9921-4C73-ABB8-9F1DC22542C5" title="SQL调优集（STS）是一个数据库对象，可用作调优工具的输入。">关于SQL调整集</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL521"></a><div class="props_rev_3"><a id="GUID-135EE7C5-2768-4BDB-B914-CDD3904AC030" name="GUID-135EE7C5-2768-4BDB-B914-CDD3904AC030"></a><h4 id="TGSQL-GUID-135EE7C5-2768-4BDB-B914-CDD3904AC030" class="sect4"><span class="enumeration_section">23.1.3</span> SQL调整集的用户界面</h4>
                  <div>
                     <p>您可以使用Oracle Enterprise Manager云控制（云控制）或PL / SQL包来管理SQL调优集。Oracle建议使用Cloud Control。</p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="managing-sql-tuning-sets.html#GUID-4336DBFE-6BD2-4F51-A5EB-D3F937431094">访问Cloud Control中的SQL调整集页面</a><br>Cloud Control中的SQL Tuning Sets页面是您可以从中执行与SQL调优集相关的大多数操作的起始页。
                        </li>
                        <li class="ulchildlink"><a href="managing-sql-tuning-sets.html#GUID-236DF69A-6370-4A56-9BF1-384C7CB865B1">SQL调整集的命令行界面</a><br>在命令行上，您可以使用<code class="codeph">DBMS_SQLTUNE</code>或<code class="codeph">DBMS_SQLSET</code>包来管理SQL调优集。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-sql-tuning-sets.html#GUID-DD136837-9921-4C73-ABB8-9F1DC22542C5" title="SQL调优集（STS）是一个数据库对象，可用作调优工具的输入。">关于SQL调整集</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL95141"></a><a id="TGSQL522"></a><div class="props_rev_3"><a id="GUID-4336DBFE-6BD2-4F51-A5EB-D3F937431094" name="GUID-4336DBFE-6BD2-4F51-A5EB-D3F937431094"></a><h5 id="TGSQL-GUID-4336DBFE-6BD2-4F51-A5EB-D3F937431094" class="sect5"><span class="enumeration_section">23.1.3.1</span>访问Cloud Control中的SQL调整集页面</h5>
                     <div>
                        <p>Cloud Control中的SQL Tuning Sets页面是您可以从中执行与SQL调优集相关的大多数操作的起始页。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-4336DBFE-6BD2-4F51-A5EB-D3F937431094__GUID-44325896-8480-4E3C-889C-3129EEABDF1E">要访问SQL Tuning Sets页面：</p>
                           <ol>
                              <li>
                                 <p>使用适当的凭据登录Cloud Control。</p>
                              </li>
                              <li>
                                 <p>在“ <span class="bold">目标”</span>菜单下，选择“ <span class="bold">数据库”</span> 。
                                 </p>
                              </li>
                              <li>
                                 <p>在数据库目标列表中，选择要管理的Oracle数据库实例的目标。</p>
                              </li>
                              <li>
                                 <p>如果系统提示您输入数据库凭据，请输入您要执行的任务所需的最低凭据。</p>
                              </li>
                              <li>
                                 <p>从<span class="bold">Performance</span>菜单中，选择<span class="bold">SQL</span> ，然后选择<span class="bold">SQL Tuning Sets</span> 。
                                 </p>
                                 <p>将出现“SQL Tuning Sets”页面， <a href="managing-sql-tuning-sets.html#GUID-4336DBFE-6BD2-4F51-A5EB-D3F937431094__BEIECCAA">如图23-2</a>所示。
                                 </p>
                                 <div class="figure" id="GUID-4336DBFE-6BD2-4F51-A5EB-D3F937431094__BEIECCAA">
                                    <p class="titleinfigure">图23-2 SQL调整集</p><img src="img/sts_homepage.jpg" alt="下面是图23-2的描述" title="下面是图23-2的描述" longdesc="img_text/sts_homepage.html"><br><a href="img_text/sts_homepage.html">“图23-2 SQL调整集”的说明</a></div>
                                 <!-- class="figure" -->
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                        <div class="section"></div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-4336DBFE-6BD2-4F51-A5EB-D3F937431094__GUID-911AC772-DC4A-4284-9BE8-8EA23C1FECD4">
                           <p class="notep1">也可以看看：</p>
                           <p> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=TDPPT164" target="_blank"><span><cite>Oracle数据库2天+性能调优指南</cite></span></a></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-sql-tuning-sets.html#GUID-135EE7C5-2768-4BDB-B914-CDD3904AC030" title="您可以使用Oracle Enterprise Manager云控制（云控制）或PL / SQL包来管理SQL调优集。Oracle建议使用Cloud Control。">SQL调整集的用户界面</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL523"></a><div class="props_rev_3"><a id="GUID-236DF69A-6370-4A56-9BF1-384C7CB865B1" name="GUID-236DF69A-6370-4A56-9BF1-384C7CB865B1"></a><h5 id="TGSQL-GUID-236DF69A-6370-4A56-9BF1-384C7CB865B1" class="sect5"><span class="enumeration_section">23.1.3.2</span> SQL调整集的命令行界面</h5>
                     <div>
                        <p>在命令行上，您可以使用<code class="codeph">DBMS_SQLTUNE</code>或<code class="codeph">DBMS_SQLSET</code>包来管理SQL调优集。
                        </p>
                        <div class="section">
                           <p>您必须具有<code class="codeph">ADMINISTER SQL TUNING SET</code>系统特权才能管理您拥有的SQL调优集，或具有<code class="codeph">ADMINISTER ANY SQL TUNING SET</code>系统特权来管理任何SQL调优集。
                           </p>
                           <p>用于管理SQL调优集的传统包是<code class="codeph">DBMS_SQLTUNE</code> ，它需要Oracle Tuning Pack。在<span>Oracle数据库18c的</span>开始，您可以执行与相同的任务<code class="codeph">DBMS_SQLSET</code> ， <span class="italic">不需要</span>在Oracle调优包。在大多数情况下， <code class="codeph">DBMS_SQLSET</code>子程序的名称与<code class="codeph">DBMS_SQLTUNE</code>等效子程序的名称相同。下表仅显示名称不同的子程序。
                           </p>
                           <div class="tblformal" id="GUID-236DF69A-6370-4A56-9BF1-384C7CB865B1__GUID-9F19E07F-2DA8-48FE-81D1-DC10CBDA9146">
                              <p class="titleintable">表23-1 SQL调整集子程序的命名差异</p>
                              <table cellpadding="4" cellspacing="0" class="Formal" title="SQL调整集子程序的命名差异" border="1" summary="This table describes SQL tuning set subprograms whose names differ in DBMS_SQLTUNE and DBMS_SQLSET." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="20%" id="d116968e1145">DBMS_SQLTUNE</th>
                                       <th align="left" valign="bottom" width="20%" id="d116968e1147">DBMS_SQLSET</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d116968e1151" headers="d116968e1145 "><code class="codeph">ADD_SQLSET_REFERENCE</code> 
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d116968e1151 d116968e1147 "><code class="codeph">ADD_REFERENCE</code></td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d116968e1159" headers="d116968e1145 "><code class="codeph">CAPTURE_CURSOR_CACHE_SQLSET</code></td>
                                       <td align="left" valign="top" width="20%" headers="d116968e1159 d116968e1147 "><code class="codeph">CAPTURE_CURSOR_CACHE</code></td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d116968e1166" headers="d116968e1145 "><code class="codeph">CREATE_STGTAB_SQLSET</code></td>
                                       <td align="left" valign="top" width="20%" headers="d116968e1166 d116968e1147 "><code class="codeph">CREATE_STGTAB</code></td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d116968e1173" headers="d116968e1145 "><code class="codeph">PACK_STGTAB_SQLSET</code></td>
                                       <td align="left" valign="top" width="20%" headers="d116968e1173 d116968e1147 "><code class="codeph">PACK_STGTAB</code></td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d116968e1180" headers="d116968e1145 "><code class="codeph">REMAP_STGTAB_SQLSET</code></td>
                                       <td align="left" valign="top" width="20%" headers="d116968e1180 d116968e1147 "><code class="codeph">REMAP_STGTAB</code></td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d116968e1187" headers="d116968e1145 "><code class="codeph">REVOVE_SQLSET_REFERENCE</code></td>
                                       <td align="left" valign="top" width="20%" headers="d116968e1187 d116968e1147 "><code class="codeph">REMOVE_REFERENCE</code></td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d116968e1194" headers="d116968e1145 "><code class="codeph">UNPACK_STGTAB_SQLSET</code></td>
                                       <td align="left" valign="top" width="20%" headers="d116968e1194 d116968e1147 "><code class="codeph">UNPACK_STGTAB</code></td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-236DF69A-6370-4A56-9BF1-384C7CB865B1__GUID-FC081A68-1935-4C42-98B5-B405642FA5BE">
                           <p class="notep1">也可以看看：</p>
                           <p><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span>以了解<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS220" target="_blank"><code class="codeph">DBMS_SQLTUNE</code></a>和<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-DFF30D13-6724-46FC-B711-91C0A59EB1E1" target="_blank"><code class="codeph">DBMS_SQLSET</code></a></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-sql-tuning-sets.html#GUID-135EE7C5-2768-4BDB-B914-CDD3904AC030" title="您可以使用Oracle Enterprise Manager云控制（云控制）或PL / SQL包来管理SQL调优集。Oracle建议使用Cloud Control。">SQL调整集的用户界面</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL525"></a><a id="TGSQL524"></a><div class="props_rev_3"><a id="GUID-9203BA12-8EDE-4EE5-B4EC-3265824200D7" name="GUID-9203BA12-8EDE-4EE5-B4EC-3265824200D7"></a><h4 id="TGSQL-GUID-9203BA12-8EDE-4EE5-B4EC-3265824200D7" class="sect4"><span class="enumeration_section">23.1.4</span> SQL调整集的基本任务</h4>
                  <div>
                     <p><code class="codeph">DBMS_SQLTUNE</code>提供了创建，使用和删除SQL调优集所需的过程。
                     </p>
                     <div class="infoboxnote" id="GUID-9203BA12-8EDE-4EE5-B4EC-3265824200D7__GUID-615B4FFA-7D94-4AC4-BCD9-79E948B1FB65">
                        <p class="notep1">注意：</p>
                        <p>或者，您可以在<code class="codeph">DBMS_SQLSET</code>使用相应的子程序。在大多数情况下，子程序具有相同的名称。
                        </p>
                     </div>
                     <p>下图显示了基本工作流程。</p>
                     <div class="figure" id="GUID-9203BA12-8EDE-4EE5-B4EC-3265824200D7__BEIGEHAA">
                        <p class="titleinfigure">图23-3 SQL调优设置API</p><img src="img/tgsql_vm_025.png" alt="下面是图23-3的描述" title="下面是图23-3的描述" longdesc="img_text/tgsql_vm_025.html"><br><a href="img_text/tgsql_vm_025.html">“图23-3 SQL调优集API”的说明</a></div>
                     <!-- class="figure" -->
                     <p>通常，您按以下顺序执行STS操作：</p>
                     <ol>
                        <li>
                           <p>创建一个新的STS。</p>
                           <p><span class="q">“ <a href="managing-sql-tuning-sets.html#GUID-5F6C1400-AD6F-4BEB-A0D8-12AADA127ADD" title="使用DBMS_SQLTUNE或DBMS_SQLSET中的CREATE_SQLSET过程在数据库中创建空STS。">创建SQL调优集</a> ”</span>描述了此任务。
                           </p>
                        </li>
                        <li>
                           <p>使用SQL语句和关联的元数据加载STS。</p>
                           <p><span class="q">“ <a href="managing-sql-tuning-sets.html#GUID-4E5240CD-B021-4728-89A9-95F5B81CBC59" title="要使用SQL语句加载STS，请使用DBMS_SQLTUNE或DBMS_SQLSET包中的LOAD_SQLSET过程。">加载SQL调优集</a> ”</span>描述了此任务。
                           </p>
                        </li>
                        <li>
                           <p>（可选）显示STS的内容。</p>
                           <p><span class="q">“ <a href="managing-sql-tuning-sets.html#GUID-B776D937-29CF-40CA-9D5B-2C427934190E" title="要在创建和填充STS后读取STS的内容，请使用DBMS_SQLTUNE或DBMS_SQLSET的SELECT_SQLSET函数，可选择使用过滤条件。">显示SQL调整集的内容</a> ”</span>描述了此任务。
                           </p>
                        </li>
                        <li>
                           <p>（可选）更新或删除STS的内容。</p>
                           <p><span class="q">“ <a href="managing-sql-tuning-sets.html#GUID-1C2E5289-B579-4AA9-8073-5F77358A8E62" title="使用DBMS_SQLTUNE或DBMS_SQLSET中的DELETE_SQLSET过程从STS中删除SQL语句。">修改SQL调整集</a> ”</span>描述了此任务。
                           </p>
                        </li>
                        <li>
                           <p>使用STS作为输入创建调整任务。</p>
                        </li>
                        <li>
                           <p>（可选）将STS传输到另一个数据库。</p>
                           <p><span class="q">“ <a href="managing-sql-tuning-sets.html#GUID-E6F9F020-6257-4456-A568-8BF4CC1FFF7C" title="您可以将STS传输到在Oracle数据库10g第2版（10.2）或更高版本中创建的任何数据库。使用SQL Performance Analyzer调整测试数据库的回归时，此技术非常有用。">传输SQL调整集</a> ”</span>描述了此任务。
                           </p>
                        </li>
                        <li>
                           <p>完成后丢弃STS。</p>
                           <p><span class="q">“ <a href="managing-sql-tuning-sets.html#GUID-493FA794-EF69-464D-BB6F-C8CF06686023" title="要从数据库中删除STS，请使用DBMS_SQLTUNE或DBMS_SQLSET包中的DROP_SQLSET过程。">删除SQL调优集</a> ”</span>描述了此任务。
                           </p>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-9203BA12-8EDE-4EE5-B4EC-3265824200D7__GUID-DAAB6ED9-004D-4042-A492-3A28F8B83733">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="managing-sql-tuning-sets.html#GUID-236DF69A-6370-4A56-9BF1-384C7CB865B1" title="在命令行上，您可以使用DBMS_SQLTUNE或DBMS_SQLSET包来管理SQL调优集。">SQL调整集的命令行界面</a> ”，</span>用于等效<code class="codeph">DBMS_SQLSET</code>子程序的名称</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-sql-tuning-sets.html#GUID-DD136837-9921-4C73-ABB8-9F1DC22542C5" title="SQL调优集（STS）是一个数据库对象，可用作调优工具的输入。">关于SQL调整集</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL527"></a><a id="TGSQL94880"></a><a id="TGSQL526"></a><div class="props_rev_3"><a id="GUID-5F6C1400-AD6F-4BEB-A0D8-12AADA127ADD" name="GUID-5F6C1400-AD6F-4BEB-A0D8-12AADA127ADD"></a><h3 id="TGSQL-GUID-5F6C1400-AD6F-4BEB-A0D8-12AADA127ADD" class="sect3"><span class="enumeration_section">23.2</span>创建SQL调优集</h3>
               <div>
                  <p>使用<code class="codeph">DBMS_SQLTUNE</code>或<code class="codeph">DBMS_SQLSET</code>的<code class="codeph">CREATE_SQLSET</code>过程在数据库中创建空STS。
                  </p>
                  <div class="section">
                     <p>使用函数而不是过程会导致数据库为STS生成名称。下表描述了一些过程参数。</p>
                     <div class="tblformal" id="GUID-5F6C1400-AD6F-4BEB-A0D8-12AADA127ADD__BEIIHDDJ">
                        <p class="titleintable">表23-2 DBMS_SQLTUNE.CREATE_SQLSET参数</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_SQLTUNE.CREATE_SQLSET参数" width="100%" border="1" summary="This 2 column table lists the parameters for CREATE_SQLSET task. Column 1 is the parameter. Column 2 describes that parameter. " frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="30%" id="d116968e1617">参数</th>
                                 <th align="left" valign="bottom" width="70%" id="d116968e1620">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="30%" id="d116968e1625" headers="d116968e1617 ">
                                    <p><code class="codeph">sqlset_name</code></p>
                                 </td>
                                 <td align="left" valign="top" width="70%" headers="d116968e1625 d116968e1620 ">
                                    <p>STS的名称</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="30%" id="d116968e1633" headers="d116968e1617 ">
                                    <p><code class="codeph">描述</code></p>
                                 </td>
                                 <td align="left" valign="top" width="70%" headers="d116968e1633 d116968e1620 ">
                                    <p>STS的可选描述</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-5F6C1400-AD6F-4BEB-A0D8-12AADA127ADD__GUID-3C0F6202-A260-4682-A51D-394F5519ECA5">假设</p>
                     <p>本教程假定</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您想要创建名为<code class="codeph">SQLT_WKLD_STS</code>的STS。</p>
                        </li>
                        <li>
                           <p>您使用<code class="codeph">DBMS_SQLTUNE</code>而不是<code class="codeph">DBMS_SQLSET</code> 。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-5F6C1400-AD6F-4BEB-A0D8-12AADA127ADD__GUID-08ACD11D-5519-4710-ACE3-14DC9A4D86FC">要创建STS：</p>
                     <ol>
                        <li>
                           <p>在SQL * Plus或SQL Developer中，以具有必要权限的用户身份登录数据库。</p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">DBMS_SQLTUNE.CREATE_SQLSET</code>过程。
                           </p>
                           <p>例如，执行以下PL / SQL程序：</p><pre class="pre codeblock"><code>BEGIN DBMS_SQLTUNE.CREATE_SQLSET（sqlset_name =&gt;'SQLT_WKLD_STS'，description =&gt;'STS用于存储来自私有SQL区域的SQL'）;结束;</code></pre></li>
                        <li>
                           <p>（可选）确认已创建STS。</p>
                           <p>以下示例查询当前用户拥有的所有SQL调优集的状态：</p><pre class="pre codeblock"><code>列名称格式a20列计数格式99999列描述格式a11选择名称，STATEMENT_COUNT为“SQLCNT”，描述来自USER_SQLSET;</code></pre><p>示例输出显示如下：</p><pre class="pre codeblock"><code>名称SQLCNT描述-------------------- ------ ----------- SQLT_WKLD_STS 2 SQL缓存</code></pre></li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-5F6C1400-AD6F-4BEB-A0D8-12AADA127ADD__GUID-BB302B38-8429-4E61-A7D1-986F7F715CC8">
                     <p class="notep1">也可以看看：</p>
                     <p> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS68408" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以获取完整的参考信息</p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-sql-tuning-sets.html#GUID-91D1B886-A6D7-40B8-93D5-112B8C6E6AFE" title="您可以使用SQL调优集将语句和相关元数据分组到单个对象中，您可以将其用作SQL调优工具的输入。">管理SQL调整集</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="TGSQL529"></a><a id="TGSQL94881"></a><a id="TGSQL94882"></a><a id="TGSQL528"></a><div class="props_rev_3"><a id="GUID-4E5240CD-B021-4728-89A9-95F5B81CBC59" name="GUID-4E5240CD-B021-4728-89A9-95F5B81CBC59"></a><h3 id="TGSQL-GUID-4E5240CD-B021-4728-89A9-95F5B81CBC59" class="sect3"><span class="enumeration_section">23.3</span>加载SQL调优集</h3>
               <div>
                  <p>要使用SQL语句加载STS，请使用<code class="codeph">DBMS_SQLTUNE</code>或<code class="codeph">DBMS_SQLSET</code>包中的<code class="codeph">LOAD_SQLSET</code>过程。
                  </p>
                  <div class="section">
                     <p>填充STS的标准源是AWR，另一个STS或共享SQL区域。对于工作负载存储库和SQL调优集，预定义的表函数可以从源中选择列以填充新的STS。</p>
                     <p>下表描述了一些<code class="codeph">DBMS_SQLTUNE.LOAD_SQLSET</code>过程参数。
                     </p>
                     <div class="tblformal" id="GUID-4E5240CD-B021-4728-89A9-95F5B81CBC59__BEICCIII">
                        <p class="titleintable">表23-3 DBMS_SQLTUNE.LOAD_SQLSET参数</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_SQLTUNE.LOAD_SQLSET参数" width="100%" border="1" summary="This table describes the input parameters of the LOAD_SQLSET procedure." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="30%" id="d116968e1841">参数</th>
                                 <th align="left" valign="bottom" width="70%" id="d116968e1844">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="30%" id="d116968e1849" headers="d116968e1841 ">
                                    <p><code class="codeph">populate_cursor</code></p>
                                 </td>
                                 <td align="left" valign="top" width="70%" headers="d116968e1849 d116968e1844 ">
                                    <p>指定从中填充STS的游标引用。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="30%" id="d116968e1857" headers="d116968e1841 ">
                                    <p><code class="codeph">load_option</code></p>
                                 </td>
                                 <td align="left" valign="top" width="70%" headers="d116968e1857 d116968e1844 ">
                                    <p>指定语句如何加载到STS中。可能的值为<code class="codeph">INSERT</code> （默认值）， <code class="codeph">UPDATE</code>和<code class="codeph">MERGE</code> 。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p><code class="codeph">DBMS_SQLTUNE.SELECT_CURSOR_CACHE</code>函数根据指定的过滤器从共享SQL区域收集SQL语句。此函数返回每个数据源中找到的每个SQL ID或<code class="codeph">PLAN_HASH_VALUE</code>对的一个<code class="codeph">SQLSET_ROW</code> 。
                     </p>
                     <p>使用<code class="codeph">DBMS_SQLTUNE.CAPTURE_CURSOR_CACHE_SQLSET</code>函数（或等效的<code class="codeph">DBMS_SQLSET.CAPTURE_CURSOR_CACHE</code> ）在指定的时间间隔内重复轮询共享的SQL区域。此函数比重复调用<code class="codeph">SELECT_CURSOR_CACHE</code>和<code class="codeph">LOAD_SQLSET</code>过程更有效。此功能有效地捕获整个工作负载，而AWR仅捕获高负载SQL语句的工作负载，或<code class="codeph">LOAD_SQLSET</code>过程， <code class="codeph">LOAD_SQLSET</code>访问数据源一次。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-4E5240CD-B021-4728-89A9-95F5B81CBC59__GUID-689D00F6-F258-4786-A1DB-CCB1C12B31A1">先决条件</p>
                     <p>本教程具有以下先决条件：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>提供给<code class="codeph">SELECT_CURSOR_CACHE</code>函数的过滤器将作为当前用户运行的SQL语句的一部分进行评估。因此，它们使用该用户的安全权限执行，并且可以包含用户可以访问的任何构造和子查询，但不能包含。
                           </p>
                        </li>
                        <li>
                           <p>当前用户必须具有共享SQL区域视图的权限。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-4E5240CD-B021-4728-89A9-95F5B81CBC59__GUID-71052334-8D31-456F-B0DC-C912C64F93C3">假设</p>
                     <p>本教程假设以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您希望使用共享SQL区域中的语句加载名为<code class="codeph">SQLT_WKLD_STS</code>的SQL调优集。
                           </p>
                        </li>
                        <li>您希望使用<code class="codeph">DBMS_SQLTUNE</code>而不是<code class="codeph">DBMS_SQLSET</code>来加载STS。</li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-4E5240CD-B021-4728-89A9-95F5B81CBC59__GUID-B9141BC3-7D7E-4A62-A599-BD161BDBE80C">要加载STS：</p>
                     <ol>
                        <li>
                           <p>在SQL * Plus或SQL Developer中，以具有必要权限的用户身份登录数据库。</p>
                        </li>
                        <li>
                           <p>运行<code class="codeph">DBMS_SQLTUNE.LOAD_SQLSET</code>过程。
                           </p>
                           <p>例如，执行以下PL / SQL程序以使用属于<code class="codeph">sh</code>模式的所有游标缓存语句填充SQL调优集：</p><pre class="pre codeblock"><code>DECLARE c_sqlarea_cursor DBMS_SQLTUNE.SQLSET_CURSOR; BEGIN OPEN c_sqlarea_cursor FOR SELECT VALUE（p）FROM TABLE（DBMS_SQLTUNE.SELECT_CURSOR_CACHE（'module =''SQLT_WKLD''and parsing_schema_name =''SH'''））p; - 加载调优集DBMS_SQLTUNE.LOAD_SQLSET（sqlset_name =&gt;'SQLT_WKLD_STS'，populate_cursor =&gt; c_sqlarea_cursor）;结束; /</code></pre></li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-4E5240CD-B021-4728-89A9-95F5B81CBC59__GUID-5321E653-4620-45F3-96E4-24EE8F7FA7B2">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS68430" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以获取完整的参考信息。
                     </p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-sql-tuning-sets.html#GUID-91D1B886-A6D7-40B8-93D5-112B8C6E6AFE" title="您可以使用SQL调优集将语句和相关元数据分组到单个对象中，您可以将其用作SQL调优工具的输入。">管理SQL调整集</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="TGSQL531"></a><a id="TGSQL94883"></a><a id="TGSQL94884"></a><a id="TGSQL530"></a><div class="props_rev_3"><a id="GUID-B776D937-29CF-40CA-9D5B-2C427934190E" name="GUID-B776D937-29CF-40CA-9D5B-2C427934190E"></a><h3 id="TGSQL-GUID-B776D937-29CF-40CA-9D5B-2C427934190E" class="sect3"><span class="enumeration_section">23.4</span>显示SQL调优集的内容</h3>
               <div>
                  <p>要在创建和填充STS后读取STS的内容，请使用<code class="codeph">DBMS_SQLTUNE</code>或<code class="codeph">DBMS_SQLSET</code>的<code class="codeph">SELECT_SQLSET</code>函数，可选择使用过滤条件。
                  </p>
                  <div class="section">
                     <p>使用PL / SQL <a href="glossary.html#GUID-BCAC562D-CB30-4A8E-B9F0-CDF34C39D8B8"><span class="xrefglossterm">流水线表函数</span></a>选择<code class="codeph">SELECT_SQLSET</code>的输出，该<a href="glossary.html#GUID-BCAC562D-CB30-4A8E-B9F0-CDF34C39D8B8"><span class="xrefglossterm">函数</span></a>接受一组行作为输入。您在<code class="codeph">SELECT</code>语句的<code class="codeph">FROM</code>列表中调用表函数作为表运算符的操作数。下表描述了一些<code class="codeph">SELECT_SQLSET</code>函数参数。
                     </p>
                     <div class="tblformal" id="GUID-B776D937-29CF-40CA-9D5B-2C427934190E__BEICJIFI">
                        <p class="titleintable">表23-4 DBMS_SQLTUNE.SELECT_SQLSET参数</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_SQLTUNE.SELECT_SQLSET参数" width="100%" border="1" summary="This table describes input parameters for the DBMS_SQLTUNE.SELECT_SQLSET function." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="25%" id="d116968e2117">参数</th>
                                 <th align="left" valign="bottom" width="75%" id="d116968e2120">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="25%" id="d116968e2125" headers="d116968e2117 ">
                                    <p><code class="codeph">basic_filter</code></p>
                                 </td>
                                 <td align="left" valign="top" width="75%" headers="d116968e2125 d116968e2120 ">
                                    <p>SQL谓词，用于从<code class="codeph">SQLSET_ROW</code>属性上定义的STS中过滤SQL</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="25%" id="d116968e2135" headers="d116968e2117 ">
                                    <p><code class="codeph">object_filter</code></p>
                                 </td>
                                 <td align="left" valign="top" width="75%" headers="d116968e2135 d116968e2120 ">
                                    <p>指定共享SQL区域中所选SQL的对象列表中存在的对象</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>下表描述了<code class="codeph">SQLSET_ROW</code>对象的一些属性。查询<code class="codeph">TABLE(DBMS_SQLTUNE.SELECT_SQLSET())</code>时，这些属性显示为列。
                     </p>
                     <div class="tblformal" id="GUID-B776D937-29CF-40CA-9D5B-2C427934190E__BEIDGICD">
                        <p class="titleintable">表23-5 SQLSET_ROW属性</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="SQLSET_ROW属性" width="100%" border="1" summary="This table describes the attributes of the SQLSET_ROW object." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="25%" id="d116968e2160">参数</th>
                                 <th align="left" valign="bottom" width="75%" id="d116968e2163">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="25%" id="d116968e2168" headers="d116968e2160 ">
                                    <p><code class="codeph">parsing_schema_name</code></p>
                                 </td>
                                 <td align="left" valign="top" width="75%" headers="d116968e2168 d116968e2163 ">
                                    <p>解析SQL的模式</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="25%" id="d116968e2176" headers="d116968e2160 ">
                                    <p><code class="codeph">ELAPSED_TIME</code></p>
                                 </td>
                                 <td align="left" valign="top" width="75%" headers="d116968e2176 d116968e2163 ">
                                    <p>此SQL语句所用总秒数的总和</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="25%" id="d116968e2184" headers="d116968e2160 ">
                                    <p><code class="codeph">BUFFER_GETS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="75%" headers="d116968e2184 d116968e2163 ">
                                    <p>此SQL语句的缓冲区获取总数（数据库访问块的次数）</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-B776D937-29CF-40CA-9D5B-2C427934190E__GUID-ECC73CC1-AC8C-4E86-9200-9E09A1D5909E">假设</p>
                     <p>本教程假设以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您想要显示名为<code class="codeph">SQLT_WKLD_STS</code>的STS的内容。</p>
                        </li>
                        <li>
                           <p>您正在使用<code class="codeph">DBMS_SQLTUNE</code>而不是<code class="codeph">DBMS_SQLSET</code> 。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-B776D937-29CF-40CA-9D5B-2C427934190E__GUID-20199851-3996-472A-83D0-9A5980AA826D">要显示STS的内容：</p>
                     <ol>
                        <li>
                           <p id="GUID-B776D937-29CF-40CA-9D5B-2C427934190E__d5e29">在SQL * Plus或SQL Developer中，以具有必要权限的用户身份登录数据库。</p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">TABLE</code>函数查询STS内容。
                           </p>
                           <p>例如，执行以下查询：</p><pre class="pre codeblock"><code>COLUMN SQL_TEXT FORMAT a30 COLUMN SCH FORMAT a3 COLUMN ELAPSED FORMAT 999999999 SELECT SQL_ID，PARSING_SCHEMA_NAME AS“SCH”，SQL_TEXT，ELAPSED_TIME AS“ELAPSED”，BUFFER_GETS FROM TABLE（DBMS_SQLTUNE.SELECT_SQLSET（'SQLT_WKLD_STS'））;</code></pre><p>示例输出显示如下：</p><pre class="pre codeblock"><code>SQL_ID SCH SQL_TEXT ELAPSED BUFFER_GETS ------------- --- ----------------------------- -  ---------- ----------- 79f8shn041a1f SH select * from sales where quan 8373148 24016 tity_sold &lt;5 union select * f rom sales where quantity_sold&gt; 500 2cqsw036j5u7r SH select promo_name，计数（*）c 3557373 309来自促销p，销售人员来自s.promo_id = p.promo_id和p.promo_category ='internet'group by p.promo_name order b yc desc fudq5z56g642p SH select sum（quantity_sold）from 4787891 12118 sales s，产品p其中sp rod_id = p.prod_id和s.amoun t_sold&gt; 20000和p.prod_name ='亚麻大衬衫'bzmnj0nbvmz8t SH select * from sales where amou 442355 15281 nt_sold = 4</code></pre></li>
                        <li>
                           <p>（可选）根据用户特定条件筛选结果。</p>
                           <p>以下示例显示磁盘读取到缓冲区的语句获得的比率大于或等于50％：</p><pre class="pre codeblock"><code>COLUMN SQL_TEXT FORMAT a30列SCH格式a3列BUF_GETS格式99999999 COLUMN DISK_READS格式99999999 COLUMN％_DISK格式9999.99 SELECT sql_id，parsing_schema_name为“SCH”，sql_text，buffer_gets为“B_GETS”，disk_reads，ROUND（disk_reads / buffer_gets * 100,2） “％_DISK”FROM TABLE（DBMS_SQLTUNE.SELECT_SQLSET（'SQLT_WKLD_STS'，'（disk_reads / buffer_gets）&gt; = 0.50'））;</code></pre><p>示例输出显示如下：</p><pre class="pre codeblock"><code>SQL_ID SCH SQL_TEXT B_GETS DISK_READS％_DISK ------------- --- --------------------------- --- ------ ---------- ------- 79f8shn041a1f SH select * from sales其中quan 24016 17287 71.98 tity_sold &lt;5 union select * f rom sales where quantity_sold&gt; 500 fudq5z56g642p SH选择总和（quantity_sold）从12118 6355 52.44销售s，产品p其中sp rod_id = p.prod_id和s.amoun t_sold&gt; 20000和p.prod_name ='亚麻大衬衫'</code></pre></li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-B776D937-29CF-40CA-9D5B-2C427934190E__GUID-29C0A065-95E6-4023-BF9A-79BA02118887">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS68458" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以获取完整的参考信息</p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-sql-tuning-sets.html#GUID-91D1B886-A6D7-40B8-93D5-112B8C6E6AFE" title="您可以使用SQL调优集将语句和相关元数据分组到单个对象中，您可以将其用作SQL调优工具的输入。">管理SQL调整集</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="TGSQL94885"></a><a id="TGSQL532"></a><div class="props_rev_3"><a id="GUID-1C2E5289-B579-4AA9-8073-5F77358A8E62" name="GUID-1C2E5289-B579-4AA9-8073-5F77358A8E62"></a><h3 id="TGSQL-GUID-1C2E5289-B579-4AA9-8073-5F77358A8E62" class="sect3"><span class="enumeration_section">23.5</span>修改SQL调整集</h3>
               <div>
                  <p>使用<code class="codeph">DBMS_SQLTUNE</code>或<code class="codeph">DBMS_SQLSET</code>的<code class="codeph">DELETE_SQLSET</code>过程从STS中删除SQL语句。</p>
                  <div class="section">
                     <p>您可以使用<code class="codeph">UPDATE_SQLSET</code>过程更新由STS名称和SQL ID标识的现有STS中的SQL语句（例如<code class="codeph">PRIORITY</code>或<code class="codeph">OTHER</code> ）的属性。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-1C2E5289-B579-4AA9-8073-5F77358A8E62__GUID-0806E25E-93CC-41DA-B531-855AAC606903">假设</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>本教程假定您要修改<code class="codeph">SQLT_WKLD_STS</code> ，如下所示：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您希望删除fetch count超过100的所有SQL语句。</p>
                        </li>
                        <li>
                           <p>您希望将ID为<code class="codeph">fudq5z56g642p</code>的SQL语句的优先级更改为<code class="codeph">1</code> 。运行SQL Tuning Advisor时，可以使用优先级作为排名标准。
                           </p>
                        </li>
                        <li>
                           <p>您使用<code class="codeph">DBMS_SQLTUNE</code>而不是<code class="codeph">DBMS_SQLSET</code> 。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-1C2E5289-B579-4AA9-8073-5F77358A8E62__GUID-EC53AE77-5085-4887-B4AA-F11F0D188B25">修改STS的内容：</p>
                     <ol>
                        <li>
                           <p>在SQL * Plus或SQL Developer中，以具有必要权限的用户身份登录数据库。</p>
                        </li>
                        <li>
                           <p>（可选）使用<code class="codeph">TABLE</code>函数查询STS内容。
                           </p>
                           <p>例如，执行以下查询：</p><pre class="pre codeblock"><code>从表中选择SQL_ID，ELAPSED_TIME，FETCHES，EXECUTIONS（DBMS_SQLTUNE.SELECT_SQLSET（'SQLT_WKLD_STS'））;</code></pre><p>示例输出显示如下：</p><pre class="pre codeblock"><code>SQL_ID ELAPSED_TIME FETCHES EXECUTIONS ------------- ------------ ---------- ---------- 2cqsw036j5u7r 3407459 2 1 79f8shn041a1f 9453965 61258 1 bzmnj0nbvmz8t 401869 1 1 fudq5z56g642p 5300264 1 1</code></pre></li>
                        <li>
                           <p>根据用户指定的条件删除SQL语句。</p>
                           <p>使用<code class="codeph">basic_filter</code>谓词从<code class="codeph">SQLSET_ROW</code>属性上定义的STS中过滤SQL。以下示例删除STS中的所有语句，提取计数超过100：</p><pre class="pre codeblock"><code>BEGIN DBMS_SQLTUNE.DELETE_SQLSET（sqlset_name =&gt;'SQLT_WKLD_STS'，basic_filter =&gt;'fetches&gt; 100'）;结束; /</code></pre></li>
                        <li>
                           <p>设置SQL语句的属性值。</p>
                           <p>以下示例将语句<code class="codeph">2cqsw036j5u7r</code>的优先级设置为<code class="codeph">1</code> ：</p><pre class="pre codeblock"><code>BEGIN DBMS_SQLTUNE.UPDATE_SQLSET（sqlset_name =&gt;'SQLT_WKLD_STS'，sql_id =&gt;'2cqsw036j5u7r'，attribute_name =&gt;'PRIORITY'，attribute_value =&gt; 1）;结束; /</code></pre></li>
                        <li>
                           <p>（可选）查询STS以确认已进行了预期的修改。</p>
                           <p>例如，执行以下查询：</p><pre class="pre codeblock"><code>SELECT SQL_ID，ELAPSED_TIME，FETCHES，EXECUTIONS，PRIORITY FROM TABLE（DBMS_SQLTUNE.SELECT_SQLSET（'SQLT_WKLD_STS'））;</code></pre><p>示例输出显示如下：</p><pre class="pre codeblock"><code>SQL_ID ELAPSED_TIME FETCHES EXECUTIONS PRIORITY ------------- ------------ ---------- ---------- ---------- 2cqsw036j5u7r 3407459 2 1 1 bzmnj0nbvmz8t 401869 1 1 fudq5z56g642p 5300264 1 1</code></pre></li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-1C2E5289-B579-4AA9-8073-5F77358A8E62__GUID-4AB4651D-A6FD-44E0-91BD-F5EDCFFFCBC5">
                     <p class="notep1">也可以看看：</p>
                     <p> 有关更多信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS68416" target="_blank"><span><cite>参见Oracle Database PL / SQL包和类型参考</cite></span></a></p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-sql-tuning-sets.html#GUID-91D1B886-A6D7-40B8-93D5-112B8C6E6AFE" title="您可以使用SQL调优集将语句和相关元数据分组到单个对象中，您可以将其用作SQL调优工具的输入。">管理SQL调整集</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="TGSQL533"></a><div class="props_rev_3"><a id="GUID-E6F9F020-6257-4456-A568-8BF4CC1FFF7C" name="GUID-E6F9F020-6257-4456-A568-8BF4CC1FFF7C"></a><h3 id="TGSQL-GUID-E6F9F020-6257-4456-A568-8BF4CC1FFF7C" class="sect3"><span class="enumeration_section">23.6</span>传输SQL调整集</h3>
               <div>
                  <p>您可以将STS传输到在Oracle数据库<span class="italic">10g</span>第2版（10.2）或更高版本中创建的任何数据库。使用SQL Performance Analyzer调整测试数据库的回归时，此技术非常有用。
                  </p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="managing-sql-tuning-sets.html#GUID-35D138E2-1E24-4911-921E-F73C2478EB96">关于传输SQL调整集</a><br>在数据库之间传输SQL调优集意味着将SQL调优集复制到登台表或从登台表复制，然后使用其他工具将登台表移动到目标数据库。最常用的工具是Oracle Data Pump或数据库链接。
                     </li>
                     <li class="ulchildlink"><a href="managing-sql-tuning-sets.html#GUID-CD6EBF22-6A8B-4404-A155-A90FA16754C6">使用DBMS_SQLTUNE传输SQL调整集</a><br>您可以使用<code class="codeph">DBMS_SQLTUNE</code>或<code class="codeph">DBMS_SQLSET</code>包中的三个子程序来传输SQL调优集。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-sql-tuning-sets.html#GUID-91D1B886-A6D7-40B8-93D5-112B8C6E6AFE" title="您可以使用SQL调优集将语句和相关元数据分组到单个对象中，您可以将其用作SQL调优工具的输入。">管理SQL调整集</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL534"></a><div class="props_rev_3"><a id="GUID-35D138E2-1E24-4911-921E-F73C2478EB96" name="GUID-35D138E2-1E24-4911-921E-F73C2478EB96"></a><h4 id="TGSQL-GUID-35D138E2-1E24-4911-921E-F73C2478EB96" class="sect4"><span class="enumeration_section">23.6.1</span>关于传输SQL调整集</h4>
                  <div>
                     <p>在数据库之间传输SQL调优集意味着将SQL调优集复制到登台表或从登台表复制，然后使用其他工具将登台表移动到目标数据库。最常用的工具是Oracle Data Pump或数据库链接。</p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="managing-sql-tuning-sets.html#GUID-6FD06FF4-825A-4A66-A08C-7E4006A7489C">传输SQL调整集的基本步骤</a><br>传输SQL调优集需要导出STS，传输转储文件，然后导入转储文件。
                        </li>
                        <li class="ulchildlink"><a href="managing-sql-tuning-sets.html#GUID-5952CC2C-6D3B-47CE-A5B8-516B20DB3BFA">CON_DBID值不同时传输SQL调整集的基本步骤</a><br>传输STS时，必须在源数据库和目标数据库的<code class="codeph">con_dbid</code>不同时重新映射STS中每个SQL语句的<code class="codeph">con_dbid</code> 。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-sql-tuning-sets.html#GUID-E6F9F020-6257-4456-A568-8BF4CC1FFF7C" title="您可以将STS传输到在Oracle数据库10g第2版（10.2）或更高版本中创建的任何数据库。使用SQL Performance Analyzer调整测试数据库的回归时，此技术非常有用。">传输SQL调整集</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL535"></a><a id="TGSQL95107"></a><div class="props_rev_3"><a id="GUID-6FD06FF4-825A-4A66-A08C-7E4006A7489C" name="GUID-6FD06FF4-825A-4A66-A08C-7E4006A7489C"></a><h5 id="TGSQL-GUID-6FD06FF4-825A-4A66-A08C-7E4006A7489C" class="sect5"><span class="enumeration_section">23.6.1.1</span>传输SQL调整集的基本步骤</h5>
                     <div>
                        <p>传输SQL调优集需要导出STS，传输转储文件，然后导入转储文件。</p>
                        <p>下图显示了使用Oracle Data Pump和<code class="codeph">ftp</code> 。
                        </p>
                        <div class="figure" id="GUID-6FD06FF4-825A-4A66-A08C-7E4006A7489C__BEIHAEEG">
                           <p class="titleinfigure">图23-4传输SQL调整集</p><img src="img/tgsql_vm_049.png" alt="下面是图23-4的描述" title="下面是图23-4的描述" longdesc="img_text/tgsql_vm_049.html"><br><a href="img_text/tgsql_vm_049.html">“图23-4传输SQL调整集”的说明</a></div>
                        <!-- class="figure" -->
                        <p><a href="managing-sql-tuning-sets.html#GUID-6FD06FF4-825A-4A66-A08C-7E4006A7489C__BEIHAEEG">如图23-4</a>所示，步骤如下：</p>
                        <ol>
                           <li>
                              <p>在生产数据库中，使用<code class="codeph">DBMS_SQLTUNE.PACK_STGTAB_SQLSET</code>或<code class="codeph">DBMS_SQLSET.PACK_STGTAB</code>将STS打包到临时表中。</p>
                           </li>
                           <li>
                              <p>使用Oracle Data Pump将STS从登台表导出到<code class="codeph">.dmp</code>文件。
                              </p>
                           </li>
                           <li>
                              <p>使用<code class="codeph">ftp</code>等传输工具将<code class="codeph">.dmp</code>文件从生产主机传输到测试主机。
                              </p>
                           </li>
                           <li>
                              <p>在测试数据库中，使用Oracle Data Pump将STS从<code class="codeph">.dmp</code>文件导入临时表。
                              </p>
                           </li>
                           <li>
                              <p>使用<code class="codeph">DBMS_SQLTUNE.UNPACK_STGTAB_SQLSET</code>或<code class="codeph">DBMS_SQLSET.UNPACK_STGTAB</code>从登台表解压缩STS。</p>
                           </li>
                        </ol>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-sql-tuning-sets.html#GUID-35D138E2-1E24-4911-921E-F73C2478EB96" title="在数据库之间传输SQL调优集意味着将SQL调优集复制到登台表或从登台表复制，然后使用其他工具将登台表移动到目标数据库。最常用的工具是Oracle Data Pump或数据库链接。">关于传输SQL调整集</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95108"></a><div class="props_rev_3"><a id="GUID-5952CC2C-6D3B-47CE-A5B8-516B20DB3BFA" name="GUID-5952CC2C-6D3B-47CE-A5B8-516B20DB3BFA"></a><h5 id="TGSQL-GUID-5952CC2C-6D3B-47CE-A5B8-516B20DB3BFA" class="sect5"><span class="enumeration_section">23.6.1.2</span>当CON_DBID值不同时传输SQL调整集的基本步骤</h5>
                     <div>
                        <p>传输STS时，必须在源数据库和目标数据库的<code class="codeph">con_dbid</code>不同时重新映射STS中每个SQL语句的<code class="codeph">con_dbid</code> 。
                        </p>
                        <p>导致<code class="codeph">con_dbid</code>值不同的情况包括：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>已重新启动其实例的单实例数据库</p>
                           </li>
                           <li>
                              <p>Oracle RAC数据库的不同实例</p>
                           </li>
                           <li>
                              <p>不同的PDB</p>
                           </li>
                           <li>
                              <p>非CDB和CDB</p>
                           </li>
                        </ul>
                        <p>重新映射的基本步骤如下：</p>
                        <ol>
                           <li>
                              <p>使用<code class="codeph">DBMS_SQLTUNE.PACK_STGTAB_SQLSET</code>或<code class="codeph">DBMS_SQLSET.PACK_STGTAB</code>将STS打包到临时表中。</p>
                           </li>
                           <li>
                              <p>使用<code class="codeph">DBMS_SQLTUNE.REMAP_STGTAB_SQLSET</code>或<code class="codeph">DBMS_SQLSET.REMAP_STGTAB</code> <code class="codeph">con_dbid</code>映射登台表中的每个<code class="codeph">con_dbid</code> 。</p>
                           </li>
                           <li>
                              <p>导出STS。</p>
                           </li>
                           <li>
                              <p>在目的地CDB中解压缩STS。</p>
                           </li>
                        </ol>
                        <div class="example" id="GUID-5952CC2C-6D3B-47CE-A5B8-516B20DB3BFA__GUID-F0D849D0-1F44-42C7-A189-CD70BB61D441">
                           <p class="titleinexample">示例23-1将STS从非CDB传输到CDB时重新映射CON_DBID</p>
                           <p>在此示例中，您打算将名为<code class="codeph">STS_for_transport</code>的STS从非CDB传输到CDB。在源非CDB上，您已使用<code class="codeph">DBMS_SQLTUNE.PACK_STGTAB_SQLSET</code>过程将STS打包到源临时表<code class="codeph">src_stg_tbl</code> 。目标CDB的容器ID是<code class="codeph">12345</code> 。
                           </p>
                           <p>在源非CDB中，执行以下命令：</p><pre class="pre codeblock"><code>VARIABLE con_dbid_src NUMBER; EXEC SELECT UNIQUE con_dbid INTO：con_dbid_src FROM src_stg_tbl; BEGIN DBMS_SQLTUNE.REMAP_STGTAB_SQLSET（staging_table_name =&gt;'src_stg_tbl'，staging_schema_owner =&gt;'dba1'，old_sqlset_name =&gt;'STS_for_transport'，old_con_dbid =&gt;：con_dbid_src，new_con_dbid =&gt; 12345）;结束;</code></pre><p>您现在可以导出登台表的内容，然后继续使用正常的传输过程。</p>
                        </div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-5952CC2C-6D3B-47CE-A5B8-516B20DB3BFA__GUID-497250A0-F8BE-4CDC-B4B5-EB89B2215BB7">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS68438" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">REMAP_STGTAB_SQLSET</code></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-sql-tuning-sets.html#GUID-35D138E2-1E24-4911-921E-F73C2478EB96" title="在数据库之间传输SQL调优集意味着将SQL调优集复制到登台表或从登台表复制，然后使用其他工具将登台表移动到目标数据库。最常用的工具是Oracle Data Pump或数据库链接。">关于传输SQL调整集</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL537"></a><a id="TGSQL538"></a><a id="TGSQL536"></a><div class="props_rev_3"><a id="GUID-CD6EBF22-6A8B-4404-A155-A90FA16754C6" name="GUID-CD6EBF22-6A8B-4404-A155-A90FA16754C6"></a><h4 id="TGSQL-GUID-CD6EBF22-6A8B-4404-A155-A90FA16754C6" class="sect4"><span class="enumeration_section">23.6.2</span>使用DBMS_SQLTUNE传输SQL调整集</h4>
                  <div>
                     <p>您可以使用<code class="codeph">DBMS_SQLTUNE</code>或<code class="codeph">DBMS_SQLSET</code>包中的三个子程序来传输SQL调优集。
                     </p>
                     <div class="section">
                        <p>下表描述了与传输SQL调优集相关的过程。</p>
                        <div class="tblformal" id="GUID-CD6EBF22-6A8B-4404-A155-A90FA16754C6__BEIDACDA">
                           <p class="titleintable">表23-6传输SQL调整集的过程</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="传输SQL调整集的过程" width="100%" border="1" summary="This table describes procedures for transporting SQL tuning sets." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="32%" id="d116968e3255">DBMS_SQLTUNE过程</th>
                                    <th align="left" valign="bottom" width="34%" id="d116968e3258">等效的DBMS_SQLSET过程</th>
                                    <th align="left" valign="bottom" width="34%" id="d116968e3261">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="32%" id="d116968e3266" headers="d116968e3255 ">
                                       <p><code class="codeph">CREATE_STGTAB_SQLSET</code></p>
                                    </td>
                                    <td align="left" valign="top" width="34%" headers="d116968e3266 d116968e3258 ">
                                       <p><code class="codeph">CREATE_STGTAB</code></p>
                                    </td>
                                    <td align="left" valign="top" width="34%" headers="d116968e3266 d116968e3261 ">
                                       <p>创建一个临时表来保存导出的SQL调优集</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="32%" id="d116968e3278" headers="d116968e3255 ">
                                       <p><code class="codeph">PACK_STGTAB_SQLSET</code></p>
                                    </td>
                                    <td align="left" valign="top" width="34%" headers="d116968e3278 d116968e3258 ">
                                       <p><code class="codeph">PACK_STGTAB</code></p>
                                    </td>
                                    <td align="left" valign="top" width="34%" headers="d116968e3278 d116968e3261 ">
                                       <p>使用SQL调优集填充临时表</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="32%" id="d116968e3290" headers="d116968e3255 ">
                                       <p><code class="codeph">UNPACK_STGTAB_SQLSET</code></p>
                                    </td>
                                    <td align="left" valign="top" width="34%" headers="d116968e3290 d116968e3258 ">
                                       <p><code class="codeph">UNPACK_STGTAB</code></p>
                                    </td>
                                    <td align="left" valign="top" width="34%" headers="d116968e3290 d116968e3261 ">
                                       <p>将SQL调优集从登台表复制到数据库中</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-CD6EBF22-6A8B-4404-A155-A90FA16754C6__GUID-E3FC2E60-3F24-4DB4-8533-00E14439DB06">假设</p>
                        <p>本教程假设以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>带有回归SQL的STS驻留在当前版本中创建的生产数据库中。</p>
                           </li>
                           <li>
                              <p>您在<span>Oracle Database 11g</span>第2版（11.2）中创建的远程测试数据库上运行SQL Performance Analyzer试用版。
                              </p>
                           </li>
                           <li>
                              <p>您希望将STS从生产数据库复制到测试数据库，并从SQL Performance Analyzer试验中调整回归。</p>
                           </li>
                           <li>
                              <p>您希望使用Oracle Database Pump在数据库主机之间传输SQL调优集。</p>
                           </li>
                           <li>
                              <p>您使用<code class="codeph">DBMS_SQLTUNE</code>而不是<code class="codeph">DBMS_SQLSET</code> 。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-CD6EBF22-6A8B-4404-A155-A90FA16754C6__GUID-AFE7C8FB-2D34-4B42-BB7D-D842BA65DE4C">运输STS：</p>
                        <ol>
                           <li>
                              <p>在SQL * Plus或SQL Developer中，以具有管理权限的用户身份登录数据库。</p>
                           </li>
                           <li>
                              <p>使用<code class="codeph">CREATE_STGTAB_SQLSET</code>过程创建一个临时表来保存导出的SQL调优集。
                              </p>
                              <p>以下示例在<code class="codeph">dba1</code>模式中创建<code class="codeph">my_11g_staging_table</code> ，并将登台表的格式指定为11.2：</p><pre class="pre codeblock"><code>BEGIN DBMS_SQLTUNE.CREATE_STGTAB_SQLSET（table_name =&gt;'my_10g_staging_table'，schema_name =&gt;'dba1'，db_version =&gt; DBMS_SQLTUNE.STS_STGTAB_11_2_VERSION）;结束; /</code></pre></li>
                           <li>
                              <p>使用<code class="codeph">PACK_STGTAB_SQLSET</code>过程使用SQL调优集填充登台表。
                              </p>
                              <p>以下示例使用<code class="codeph">hr</code>拥有的STS <code class="codeph">my_sts</code>填充<code class="codeph">dba1.my_11g_staging_table</code> ：</p><pre class="pre codeblock"><code>BEGIN DBMS_SQLTUNE.PACK_STGTAB_SQLSET（sqlset_name =&gt;'sqlt_wkld_sts'，sqlset_owner =&gt;'sh'，staging_table_name =&gt;'my_11g_staging_table'，staging_schema_owner =&gt;'dba1'，db_version =&gt; DBMS_SQLTUNE.STS_STGTAB_11_2_VERSION）;结束; /</code></pre></li>
                           <li>
                              <p>如有必要，请重新映射STS中语句的容器ID值，如<span class="q">“ <a href="managing-sql-tuning-sets.html#GUID-5952CC2C-6D3B-47CE-A5B8-516B20DB3BFA" title="传输STS时，必须在源数据库和目标数据库的con_dbid不同时重新映射STS中每个SQL语句的con_dbid。">CON_DBID值不同时传输SQL调整集的基本步骤</a> ”中所述</span> 。
                              </p>
                           </li>
                           <li>
                              <p>使用Oracle Data Pump导出登台表的内容。</p>
                              <p>例如，在操作系统提示符下运行<code class="codeph">expdp</code>命令：</p><pre class="pre codeblock"><code>expdp dba1 DIRECTORY = dpump_dir1 DUMPFILE = sts.dmp TABLES = my_11g_staging_table</code></pre></li>
                           <li>
                              <p>将转储文件传输到测试数据库主机。</p>
                           </li>
                           <li>
                              <p>以管理员身份登录测试主机，然后使用Oracle Data Pump导入登台表的内容。</p>
                              <p>例如，在操作系统提示符下运行<code class="codeph">impdp</code>命令：</p><pre class="pre codeblock"><code>impdp dba1 DIRECTORY = dpump_dir1 DUMPFILE = sts.dmp TABLES = my_11g_staging_table</code></pre></li>
                           <li>
                              <p>在测试数据库上，执行<code class="codeph">UNPACK_STGTAB_SQLSET</code>过程以将SQL调优集从登台表复制到数据库中。
                              </p>
                              <p>以下示例显示如何解压缩SQL调优集：</p><pre class="pre codeblock"><code>BEGIN DBMS_SQLTUNE.UNPACK_STGTAB_SQLSET（sqlset_name =&gt;'％'，replace =&gt; true，staging_table_name =&gt;'my_11g_staging_table'）;结束; /</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-CD6EBF22-6A8B-4404-A155-A90FA16754C6__GUID-21EAE563-510A-4CA3-9DC0-BA1BFE4CB085">
                        <p class="notep1">也可以看看：</p>
                        <p> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS68412" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以了解有关<code class="codeph">DBMS_SQLTUNE.UNPACK_STGTAB_SQLSET</code>更多信息</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-sql-tuning-sets.html#GUID-E6F9F020-6257-4456-A568-8BF4CC1FFF7C" title="您可以将STS传输到在Oracle数据库10g第2版（10.2）或更高版本中创建的任何数据库。使用SQL Performance Analyzer调整测试数据库的回归时，此技术非常有用。">传输SQL调整集</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL94886"></a><a id="TGSQL94887"></a><a id="TGSQL539"></a><div class="props_rev_3"><a id="GUID-493FA794-EF69-464D-BB6F-C8CF06686023" name="GUID-493FA794-EF69-464D-BB6F-C8CF06686023"></a><h3 id="TGSQL-GUID-493FA794-EF69-464D-BB6F-C8CF06686023" class="sect3"><span class="enumeration_section">23.7</span>删除SQL调优集</h3>
               <div>
                  <p>要从数据库中删除STS，请使用<code class="codeph">DBMS_SQLTUNE</code>或<code class="codeph">DBMS_SQLSET</code>包中的<code class="codeph">DROP_SQLSET</code>过程。
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-493FA794-EF69-464D-BB6F-C8CF06686023__GUID-B5D705F8-D357-40C0-8674-2AA8CB8CE949">先决条件</p>
                     <p>确保当前没有调整任务正在使用要删除的STS。如果现有调整任务正在使用此STS，则在删除STS之前删除任务。否则，数据库会发出<code class="codeph">ORA-13757</code>错误。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-493FA794-EF69-464D-BB6F-C8CF06686023__GUID-67FEC71A-A25B-469A-A400-624F317A172A">假设</p>
                     <p>本教程假设以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您想要删除名为<code class="codeph">SQLT_WKLD_STS</code>的STS。</p>
                        </li>
                        <li>
                           <p>您使用<code class="codeph">DBMS_SQLTUNE</code>而不是<code class="codeph">DBMS_SQLSET</code> 。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-493FA794-EF69-464D-BB6F-C8CF06686023__GUID-A2DBE305-DDE7-44C3-9F1F-8B0741253FA0">丢弃STS：</p>
                     <ol>
                        <li>
                           <p>在SQL * Plus或SQL Developer中，以具有必要权限的用户身份登录数据库。</p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">DBMS_SQLTUNE.DROP_SQLSET</code>过程。
                           </p>
                           <p>例如，执行以下PL / SQL程序：</p><pre class="pre codeblock"><code>BEGIN DBMS_SQLTUNE.DROP_SQLSET（sqlset_name =&gt;'SQLT_WKLD_STS'）;结束; /</code></pre></li>
                        <li>
                           <p>（可选）确认已删除STS。</p>
                           <p>以下示例计算当前用户拥有的名为<code class="codeph">SQLT_WKLD_STS</code>的SQL调优集的数量（包括示例输出）：</p><pre class="pre codeblock"><code>SELECT COUNT（*）FROM USER_SQLSET WHERE NAME ='SQLT_WKLD_STS'; COUNT（*）---------- 0</code></pre></li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-493FA794-EF69-464D-BB6F-C8CF06686023__GUID-0D2CC086-518D-43DD-AD9F-FC9AB2E7EAF1">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="../arpls/DBMS_SQLTUNE.html#ARPLS68420" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_SQLTUNE</code>的STS过程</p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-sql-tuning-sets.html#GUID-91D1B886-A6D7-40B8-93D5-112B8C6E6AFE" title="您可以使用SQL调优集将语句和相关元数据分组到单个对象中，您可以将其用作SQL调优工具的输入。">管理SQL调整集</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>