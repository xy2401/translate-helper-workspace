<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="Oracle Data Guard lets you set different data protection modes."></meta>
      <meta name="description" content="Oracle Data Guard lets you set different data protection modes."></meta>
      <title>Oracle Data Guard保护模式</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Concepts and Administration "></meta>
      <meta property="og:description" content="Oracle Data Guard lets you set different data protection modes."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Concepts and Administration"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="data-guard-concepts-and-administration.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-02-12T10:50:21-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1999, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96244-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="creating-oracle-data-guard-far-sync-instance.html" title="Previous" type="text/html"></link>
      <link rel="next" href="oracle-data-guard-redo-transport-services.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Data Guard Concepts and Administration"></meta>
    <meta name="dcterms.isVersionOf" content="SBYDB"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="creating-oracle-data-guard-far-sync-instance.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="oracle-data-guard-redo-transport-services.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">概念和管理</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="oracle-data-guard-concepts.html" property="item" typeof="WebPage"><span property="name">概念和管理</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Oracle Data Guard保护模式</li>
            </ol>
            <a id="GUID-16298839-9B8A-4E58-8EC9-27912E57F1CE" name="GUID-16298839-9B8A-4E58-8EC9-27912E57F1CE"></a><a id="SBYDB02000"></a>
            
            <h2 id="SBYDB-GUID-16298839-9B8A-4E58-8EC9-27912E57F1CE" class="sect2"><span class="enumeration_chapter">6</span> Oracle Data Guard保护模式</h2>
         </header>
         <div class="ind">
            <div>
               <p>Oracle Data Guard允许您设置不同的数据保护模式。</p>
               <p>有关这些模式以及如何在主数据库上设置它们的信息，请参阅以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="oracle-data-guard-protection-modes.html#GUID-7EF6EFEE-7E31-4F80-9C97-1B25DAA025F8" title="Oracle Data Guard提供三种保护模式：最大可用性，最高性能和最大保护。">Oracle Data Guard保护模式</a></p>
                  </li>
                  <li>
                     <p><a href="oracle-data-guard-protection-modes.html#GUID-5DB32C5F-3ABF-4AD4-AB41-208F1BF134BB" title="只要配置满足保护模式的要求（包括从最高性能模式到最大可用性模式），就可以在打开的数据库上设置和更改保护模式设置。">设置主数据库的数据保护模式</a></p>
                  </li>
               </ul>
            </div><a id="SBYDB5024"></a><a id="SBYDB5160"></a><a id="SBYDB5025"></a><a id="SBYDB5026"></a><a id="SBYDB4743"></a><div class="props_rev_3"><a id="GUID-7EF6EFEE-7E31-4F80-9C97-1B25DAA025F8" name="GUID-7EF6EFEE-7E31-4F80-9C97-1B25DAA025F8"></a><h3 id="SBYDB-GUID-7EF6EFEE-7E31-4F80-9C97-1B25DAA025F8" class="sect3"><span class="enumeration_section">6.1</span> Oracle Data Guard保护模式</h3>
               <div>
                  <p>Oracle Data Guard提供三种保护模式：最大可用性，最高性能和最大保护。</p>
                  <p>在以下保护模式的描述中，同步备用数据库应该是满足配置的数据保护模式的最低要求且没有重做间隙的数据库。Redo间隙在<a href="oracle-data-guard-redo-transport-services.html#GUID-05CE1D49-3DEE-4AAC-A887-55ED436912AF" title="重做传输中断时会发生重做间隙。">Redo Gap Detection and Resolution中</a>进行了讨论。
                  </p>
                  <div class="section" id="GUID-7EF6EFEE-7E31-4F80-9C97-1B25DAA025F8__BABIEACF">
                     <p class="subhead2" id="GUID-7EF6EFEE-7E31-4F80-9C97-1B25DAA025F8__GUID-7DA1D2E8-3CA8-45A5-AC55-E866B2E2100D">最高可用性</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>此保护模式可提供最高级别的数据保护，而不会影响主数据库的可用性。在正常操作下，事务不会提交，直到恢复这些事务所需的所有重做数据都已写入联机重做日志并且基于用户配置，以下情况之一为真：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>已在备用数据库中收到重做，已启动备用重做日志的I / O，并将确认发送回主数据库</p>
                        </li>
                        <li>
                           <p>redo已被接收并写入待机状态的备用重做日志，并将确认发送回主数据库</p>
                        </li>
                     </ul>
                     <p>如果主服务器没有从至少一个同步备用数据库接收到确认，那么它就像它处于最高性能模式一样运行，以保持主数据库可用性，直到它再次能够将其重做流写入同步备用数据库。</p>
                     <p>如果主数据库发生故障，则此模式可确保在Oracle Data Guard配置中至少有一个同步备用数据库时不会发生数据丢失。有关支持最高可用性和相关权衡所需的重做传输设置的信息，请参阅<span class="q">“ <a href="oracle-data-guard-protection-modes.html#GUID-7EF6EFEE-7E31-4F80-9C97-1B25DAA025F8__BABBFEGF">最高可用性模式下的性能与保护</a> ”</span> 。
                     </p>
                     <p>一旦Oracle Data Guard将重做数据写入备用重做日志文件中的持久存储，主要事务就被视为受保护。完成后，确认将快速返回主数据库，以便它可以继续进行下一个事务。这最大限度地减少了同步传输对主数据库吞吐量和响应时间的影响。要在备用数据库中完全受益于完整的Oracle Data Guard验证，请确保以实时应用模式运行，以便重新更改以尽可能快的速度应用于备用数据库。Oracle Data Guard会发出任何检测到的损坏信号，以便立即采取纠正措施。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-7EF6EFEE-7E31-4F80-9C97-1B25DAA025F8__BABBFEGF">
                     <p class="subhead2" id="GUID-7EF6EFEE-7E31-4F80-9C97-1B25DAA025F8__GUID-38C9145E-E00E-4590-8C29-210F720D9ED9">最高可用性模式下的性能与保护</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>使用最高可用性模式时，了解使用<code class="codeph">LOG_ARCHIVE_DEST_</code> <span class="italic"><code class="codeph">n</code></span>属性<code class="codeph">SYNC</code> / <code class="codeph">AFFIRM</code>与<code class="codeph">SYNC</code> / <code class="codeph">NOAFFIRM</code> （FastSync）的可能结果非常重要。 <a id="d14585e222" class="indexterm-anchor"></a> ）这样您就可以做出最适合您需求的选择。
                     </p>
                     <p>当使用<code class="codeph">SYNC/AFFIRM</code>执行传输时，主服务器执行写操作并等待确认重做已同步传输到物理备用数据库并写入磁盘。<code class="codeph">SYNC/AFFIRM</code>传输提供额外的保护优势，代价是由完成备用重做日志的I / O所需的时间所导致的性能影响。
                     </p>
                     <p>使用<code class="codeph">SYNC/NOAFFIRM</code>执行<code class="codeph">SYNC/NOAFFIRM</code> ，主服务器执行写操作，仅等待确认已在备用数据库上接收到数据， <span class="italic">而不是</span>等待已写入磁盘。<code class="codeph">SYNC/NOAFFIRM</code>传输可以在多个同时发生故障的特殊情况下以潜在的数据丢失风险为代价提供性能优势。
                     </p>
                     <p>考虑到这些定义，假设您在主站点遇到灾难性故障，同时在备用站点断电。数据是否丢失取决于所使用的传输模式。在<code class="codeph">SYNC/AFFIRM</code>的情况下，其中有一个检查以确认数据被写入备用数据库上的磁盘，因此没有数据丢失，因为当系统恢复时，数据将在备用数据库上可用。在<code class="codeph">SYNC/NOAFFIRM</code>的情况下，其中没有检查数据是否已在备用数据库上写入磁盘，可能会有一些数据丢失。
                     </p>
                     <div class="infoboxnotealso" id="GUID-7EF6EFEE-7E31-4F80-9C97-1B25DAA025F8__GUID-DB555252-EC63-494C-BDAE-D86C4843825B">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="LOG_ARCHIVE_DEST_n-parameter-attributes.html#GUID-B04FC22C-F0B0-440F-BAF4-182EE547FCC1" title="这是LOG_ARCHIVE_DEST_n初始化参数的属性列表（其中n是1到31之间的整数）。">LOG_ARCHIVE_DEST_n参数属性</a>有关<code class="codeph">SYNC</code> ， <code class="codeph">AFFIRM</code>和<code class="codeph">NOAFFIRM</code>属性的更多信息</p>
                           </li>
                           <li>
                              <p>有关使用<code class="codeph">FASTSYNC</code>模式在代理配置中传输重做的信息，请参阅<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=DGBKR175" target="_blank"><span class="italic">Oracle Data Guard Broker</span></a> （在最大可用性模式下一起使用<code class="codeph">SYNC</code>和<code class="codeph">NOAFFIRM</code> ）</p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-7EF6EFEE-7E31-4F80-9C97-1B25DAA025F8__GUID-B244C2F8-360D-46E8-ADEF-7B3FEFA693FD">最高性能</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>这种保护<a id="d14585e306" class="indexterm-anchor"></a><a id="d14585e310" class="indexterm-anchor"></a> mode可提供最高级别的数据保护，而不会影响主数据库的性能。这是通过允许事务在这些事务生成的所有重做数据写入在线日志后立即提交来实现的。重做数据也写入一个或多个备用数据库，但这是在事务承诺方面异步完成的，因此主数据库性能不受传输重做数据和从备用数据库接收确认所需的时间的影响。
                     </p>
                     <p>与最大可用性模式相比，此保护模式提供的数据保护略少，对主数据库性能的影响最小。</p>
                     <p>这是默认保护模式。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-7EF6EFEE-7E31-4F80-9C97-1B25DAA025F8__GUID-21CEBAB3-35E0-4FD0-8DFC-E0C4F6D26203">最大保护</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>最大保护与最大可用性类似，但在发生多个故障事件时提供额外级别的数据保护。与最大可用性不同，最大可用性允许主服务器在无法从备用数据库接收确认时继续处理，最大保护会关闭主数据库，而不是允许它继续处理不受保护的事务。</p>
                     <p>由于此数据保护模式优先考虑主数据库可用性的数据保护，因此Oracle建议至少使用两个备用数据库来保护以最大保护模式运行的主数据库，以防止单个数据库故障导致主数据库关闭。</p>
                     <div class="infoboxnote" id="GUID-7EF6EFEE-7E31-4F80-9C97-1B25DAA025F8__GUID-D12AEA3C-220F-44A4-B737-7775E1F7E8CE">
                        <p class="notep1">注意：</p>
                        <p>在将这些事务生成的重做写入至少一个同步备用数据库的备用重做日志之前，Oracle Data Guard不会保护异步提交的事务不会丢失。</p>
                        <p>有关异步提交功能的更多信息，请参阅：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=CNCPT1119" target="_blank"><span class="italic">Oracle数据库概念</span></a></p>
                           </li>
                           <li>
                              <p><a href="../lnpls/static-sql.html#LNPLS006" target="_blank"><span class="italic">Oracle数据库PL / SQL语言参考</span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="SBYDB5465"></a><a id="SBYDB4744"></a><div class="props_rev_3"><a id="GUID-5DB32C5F-3ABF-4AD4-AB41-208F1BF134BB" name="GUID-5DB32C5F-3ABF-4AD4-AB41-208F1BF134BB"></a><h3 id="SBYDB-GUID-5DB32C5F-3ABF-4AD4-AB41-208F1BF134BB" class="sect3"><span class="enumeration_section">6.2</span>设置主数据库的数据保护模式</h3>
               <div>
                  <p>只要配置满足保护模式的要求（包括从最高性能模式到最大可用性模式），就可以在打开的数据库上设置和更改保护模式设置。</p>
                  <div class="section">
                     <p>执行以下步骤以设置主数据库的数据保护模式：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>选择符合可用性，性能和数据保护要求的数据保护模式。有关<a href="oracle-data-guard-protection-modes.html#GUID-7EF6EFEE-7E31-4F80-9C97-1B25DAA025F8" title="Oracle Data Guard provides three protection modes: maximum availability, maximum performance, and maximum protection.">数据保护模式</a>的说明，请参阅<a href="oracle-data-guard-protection-modes.html#GUID-7EF6EFEE-7E31-4F80-9C97-1B25DAA025F8" title="Oracle Data Guard提供三种保护模式：最大可用性，最高性能和最大保护。">Oracle Data Guard</a>保护模式。</span></li>
                     <li class="stepexpand"><span>验证至少一个备用数据库满足所需数据保护模式的重做传输要求。</span><div>
                           <p>对应于至少一个备用数据库的<code class="codeph">LOG_ARCHIVE_DEST_</code> <span class="italic"><code class="codeph">n</code></span>数据库初始化参数必须包含下表中列出的重做传输属性，以获得所需的数据保护模式。
                           </p>
                           <p>备用数据库还必须具有备用重做日志。</p>
                           <div class="tblformal" id="GUID-5DB32C5F-3ABF-4AD4-AB41-208F1BF134BB__GUID-E1E38604-FF2D-45B7-B5DD-34F043E10017">
                              <p class="titleintable">表6-1数据保护模式所需的重做传输属性</p>
                              <table cellpadding="4" cellspacing="0" class="Formal" title="数据保护模式所需的重做传输属性" width="90%" border="1" summary="This 3 column tables lists the required Redo Transport Attributes. Column 1 is maximum availability. Column 2 is maximum performance. Column 1 is maximum protection.  " frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="33%" id="d14585e462">最高可用性</th>
                                       <th align="left" valign="bottom" width="33%" id="d14585e465">最高性能</th>
                                       <th align="left" valign="bottom" width="33%" id="d14585e468">最大保护</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="33%" id="d14585e473" headers="d14585e462 ">
                                          <p><code class="codeph">AFFIRM</code>或<code class="codeph">NOAFFIRM</code></p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d14585e473 d14585e465 ">
                                          <p><code class="codeph">NOAFFIRM</code></p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d14585e473 d14585e468 ">
                                          <p><code class="codeph">确认</code></p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="33%" id="d14585e489" headers="d14585e462 ">
                                          <p><code class="codeph">同步</code></p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d14585e489 d14585e465 ">
                                          <p><code class="codeph">异步</code></p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d14585e489 d14585e468 ">
                                          <p><code class="codeph">同步</code></p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="33%" id="d14585e502" headers="d14585e462 ">
                                          <p><code class="codeph">DB_UNIQUE_NAME</code></p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d14585e502 d14585e465 ">
                                          <p><code class="codeph">DB_UNIQUE_NAME</code></p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d14585e502 d14585e468 ">
                                          <p><code class="codeph">DB_UNIQUE_NAME</code></p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                        </div>
                     </li>
                     <li class="stepexpand"><span>验证是否已将<code class="codeph">DB_UNIQUE_NAME</code>数据库初始化参数设置为主数据库和每个备用数据库上的唯一值。</span></li>
                     <li class="stepexpand"><span>验证是否已在主数据库和每个备用数据库上定义<code class="codeph">LOG_ARCHIVE_CONFIG</code>数据库初始化参数，并且其值包括<code class="codeph">DG_CONFIG</code>列表，该列表包含主数据库和每个备用数据库的<code class="codeph">DB_UNIQUE_NAME</code> 。</span><div>
                           <p>以下示例SQL语句配置<code class="codeph">LOG_ARCHIVE_CONFIG</code>参数：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER SYSTEM SET LOG_ARCHIVE_CONFIG ='DG_CONFIG =（CHICAGO，BOSTON）';</pre></div>
                     </li>
                     <li class="stepexpand"><span>通过在主数据库上执行以下SQL语句来设置数据保护模式：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE  - &gt; SET STANDBY DATABASE最大化{AVAILABILITY |表现|保护};</pre><p>仅当当前数据保护模式为<code class="codeph">MAXIMUM</code> <code class="codeph">AVAILABILITY</code>且且至少有一个同步备用数据库时，才能在打开的数据库上将数据保护模式设置为<code class="codeph">MAXIMUM</code> <code class="codeph">PROTECTION</code> 。
                           </p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>在主数据库上执行以下查询以确认它是在新保护模式下运行：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT PROTECTION_MODE FROM V $ DATABASE;</pre></div>
                     </li>
                  </ol>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>