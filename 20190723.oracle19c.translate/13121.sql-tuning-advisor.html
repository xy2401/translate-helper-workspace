<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="Use SQL Tuning Advisor to obtain recommendations for improving performance of high-load SQL statements, and prevent regressions by only executing optimal plans."></meta>
      <meta name="description" content="Use SQL Tuning Advisor to obtain recommendations for improving performance of high-load SQL statements, and prevent regressions by only executing optimal plans."></meta>
      <title>使用SQL Tuning Advisor分析SQL</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="SQL Tuning Guide"></meta>
      <meta property="og:description" content="Use SQL Tuning Advisor to obtain recommendations for improving performance of high-load SQL statements, and prevent regressions by only executing optimal plans."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="SQL Tuning Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="sql-tuning-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-31T14:57:08-08:00"></meta>
      <meta name="dcterms.title" content="SQL Tuning Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="2013, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96095-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="managing-sql-tuning-sets.html" title="Previous" type="text/html"></link>
      <link rel="next" href="sql-access-advisor.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGSQL"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="managing-sql-tuning-sets.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="sql-access-advisor.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL调优指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="automatic-sql-tuning.html" property="item" typeof="WebPage"><span property="name">自动SQL调整</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用SQL Tuning Advisor分析SQL</li>
            </ol>
            <a id="GUID-8E1A39CB-A491-4254-8B31-9B1DF7B52AA1" name="GUID-8E1A39CB-A491-4254-8B31-9B1DF7B52AA1"></a>
            
            <h2 id="TGSQL-GUID-8E1A39CB-A491-4254-8B31-9B1DF7B52AA1" class="sect2"><span class="enumeration_chapter">24</span>使用SQL Tuning Advisor分析SQL</h2>
         </header>
         <div class="ind">
            <div>
               <p>使用SQL Tuning Advisor获取有关提高高负载SQL语句性能的建议，并通过仅执行最佳计划来防止回归。</p>
               <p>本章包含以下主题：</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-EF47CEF3-E31A-4A2A-8BCE-19DC5F06F458">关于SQL Tuning Advisor</a><br><strong class="term">SQL Tuning Advisor</strong>是Oracle Database Tuning Pack中的SQL诊断软件。
                  </li>
                  <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-87D3AA10-60CE-4F5B-879B-B2E851874B83">管理自动SQL调整任务</a><br>当您的目标是主动识别SQL性能问题时，将SQL Tuning Advisor配置为自动化任务是一个简单的解决方案。该任务处理来自AWR的选定高负载SQL语句，这些语句有资格作为调优候选者。
                  </li>
                  <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-F5494CD1-52BB-478E-BB36-17104B36B0FE">按需运行SQL Tuning Advisor</a><br>您可以按需运行SQL Tuning Advisor。
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="automatic-sql-tuning.html#GUID-538A6E57-527A-46D2-97B8-F2238E0D0838" title="SQL Tuning Advisor和SQL Access Advisor是内置工具，提供SQL调优建议。">自动SQL调整</a></p>
                  </div>
               </div>
            </div>
            <a id="TGSQL541"></a><div class="props_rev_3"><a id="GUID-EF47CEF3-E31A-4A2A-8BCE-19DC5F06F458" name="GUID-EF47CEF3-E31A-4A2A-8BCE-19DC5F06F458"></a><h3 id="TGSQL-GUID-EF47CEF3-E31A-4A2A-8BCE-19DC5F06F458" class="sect3"><span class="enumeration_section">24.1</span>关于SQL Tuning Advisor</h3>
               <div>
                  <p><strong class="term">SQL Tuning Advisor</strong>是Oracle Database Tuning Pack中的SQL诊断软件。
                  </p>
                  <p>您可以将一个或多个SQL语句作为输入提交给顾问，并获得有关如何调整语句的建议或建议，以及基本原理和预期收益。</p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-73AB38C1-A7F6-401E-9010-B4476E173673">SQL Tuning Advisor的用途</a><br>SQL Tuning Advisor是一种用于解决与次优执行SQL语句相关的问题的机制。
                     </li>
                     <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-7FAEE001-6FB3-4FA9-93AC-5598F446A15F">SQL Tuning Advisor体系结构</a><br><strong class="term">自动调整优化器</strong>是SQL Tuning Advisor使用的核心工具。顾问程序可以从多个源接收SQL语句作为输入，使用优化程序分析这些语句，然后提出建议。
                     </li>
                     <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-FBC7E417-3575-46BA-8CE5-2D926158A6A1">SQL Tuning Advisor操作</a><br>您可以自动或按需运行SQL Tuning Advisor。您还可以在本地或远程数据库上运行顾问程序。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-8E1A39CB-A491-4254-8B31-9B1DF7B52AA1" title="使用SQL Tuning Advisor获取有关提高高负载SQL语句性能的建议，并通过仅执行最佳计划来防止回归。">使用SQL Tuning Advisor分析SQL</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL542"></a><div class="props_rev_3"><a id="GUID-73AB38C1-A7F6-401E-9010-B4476E173673" name="GUID-73AB38C1-A7F6-401E-9010-B4476E173673"></a><h4 id="TGSQL-GUID-73AB38C1-A7F6-401E-9010-B4476E173673" class="sect4"><span class="enumeration_section">24.1.1</span> SQL Tuning Advisor的用途</h4>
                  <div>
                     <p>SQL Tuning Advisor是一种用于解决与次优执行SQL语句相关的问题的机制。</p>
                     <p>使用SQL Tuning Advisor获取有关提高高负载SQL语句性能的建议，并通过仅执行最佳计划来防止回归。</p>
                     <p>调整建议包括：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>对象统计的集合</p>
                        </li>
                        <li>
                           <p>创建索引</p>
                        </li>
                        <li>
                           <p>重写SQL语句</p>
                        </li>
                        <li>
                           <p>创建SQL配置文件</p>
                        </li>
                        <li>
                           <p>创建SQL计划基准</p>
                        </li>
                     </ul>
                     <p>SQL Tuning Advisor生成的建议可帮助您实现以下特定目标：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>避免劳动密集型手动调整</p>
                           <p>即使对于专家来说，识别和调整高负载SQL语句也具有挑战性。SQL Tuning Advisor使用优化器为您调优SQL。</p>
                        </li>
                        <li>
                           <p>自动生成建议并实施SQL配置文件</p>
                           <p>您可以将自动SQL调整任务配置为在维护窗口中每晚运行。以这种方式调用时，顾问程序可以生成建议并自动实现SQL配置文件。</p>
                        </li>
                        <li>
                           <p>分析数据库生成的统计信息以实现最佳计划</p>
                           <p>该数据库包含大量有关其自身操作的统计信息。SQL Tuning Advisor可以执行深度挖掘和内部信息分析，以改进执行计划。</p>
                        </li>
                        <li>
                           <p>使开发人员能够在测试系统而不是生产系统上调优SQL</p>
                           <p>当在生产数据库上发生次优执行SQL语句时，开发人员可能不希望直接在生产数据库上进行调查和调优。DBA可以将有问题的SQL语句传输到测试数据库，开发人员可以在其中安全地分析和调整它们。</p>
                        </li>
                     </ul>
                     <p>调整多个语句时，SQL Tuning Advisor无法识别语句之间的相互依赖性。相反，SQL Tuning Advisor提供了一种方便的方法来获取许多语句的调优建议。</p>
                     <div class="infoboxnote" id="GUID-73AB38C1-A7F6-401E-9010-B4476E173673__GUID-71EFC740-5ED1-48C4-A786-76250A658E86">
                        <p class="notep1">注意：</p>
                        <p>将SQL Tuning Advisor与可插拔数据库一起使用时，数据可见性和权限要求可能会有所不同。顾问程序可以调整当前可插拔数据库（PDB）中以及已执行此查询的其他PDB中的查询。通过这种方式，容器数据库（CDB）管理员可以同时在许多PDB中调整相同的查询，而PDB管理员只能调整单个PDB。</p>
                     </div>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-73AB38C1-A7F6-401E-9010-B4476E173673__GUID-2B6E48E4-B023-407B-A06C-3CB2DCA6CC35">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="managing-sql-plan-baselines.html#GUID-7024369A-F98D-48E4-921C-C899485C954F" title="本章介绍使用DBMS_SPM程序包与SQL计划管理相关的概念和任务。">管理SQL计划基准</a> ”</span>以了解SQL计划管理</p>
                           </li>
                           <li>
                              <p><a href="../multi/administering-a-cdb-with-sql-plus.html#ADMIN13885" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a> ，其中总结了可管理性功能在CDB中的工作方式</p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-EF47CEF3-E31A-4A2A-8BCE-19DC5F06F458" title="SQL Tuning Advisor是Oracle Database Tuning Pack中的SQL诊断软件。">关于SQL Tuning Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL544"></a><a id="TGSQL543"></a><div class="props_rev_3"><a id="GUID-7FAEE001-6FB3-4FA9-93AC-5598F446A15F" name="GUID-7FAEE001-6FB3-4FA9-93AC-5598F446A15F"></a><h4 id="TGSQL-GUID-7FAEE001-6FB3-4FA9-93AC-5598F446A15F" class="sect4"><span class="enumeration_section">24.1.2</span> SQL Tuning Advisor体系结构</h4>
                  <div>
                     <p><strong class="term">自动调整优化器</strong>是SQL Tuning Advisor使用的核心工具。顾问程序可以从多个源接收SQL语句作为输入，使用优化程序分析这些语句，然后提出建议。
                     </p>
                     <p>为每个<a href="glossary.html#GUID-AB764C9E-2F03-49A9-BF8B-36A9FBD03BCE"><span class="xrefglossterm">硬解析</span></a>调用自动调整优化器会占用大量时间和资源。调整模式适用于复杂且高负载的SQL语句，这些语句会显着影响数据库性能。
                     </p>
                     <p>SQL调优顾问程序等可管理性顾问使用称为顾问程序框架的通用基础结构。该框架提供了用于存储任务对象的通用模式和接口。顾问程序模式是一组用于存储顾问程序数据的表。SQL Tuning Advisor接收调优输入，然后通过顾问程序框架写入顾问程序模式。SQL Tuning Advisor在生成报告时从顾问程序架构中读取数据。</p>
                     <p>下图显示了SQL Tuning Advisor的基本体系结构。</p>
                     <div class="figure" id="GUID-7FAEE001-6FB3-4FA9-93AC-5598F446A15F__CBBFJHEH">
                        <p class="titleinfigure">图24-1 SQL Tuning Advisor体系结构</p><img src="img/tgsql_vm_050.png" alt="下面是图24-1的描述" title="下面是图24-1的描述" longdesc="img_text/tgsql_vm_050.html"><br><a href="img_text/tgsql_vm_050.html">“图24-1 SQL调优顾问体系结构”的说明</a></div>
                     <!-- class="figure" -->
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-A6419DB4-DBF5-43A3-89DF-F0DE74E58D4C">输入到SQL Tuning Advisor</a><br>SQL Tuning Advisor的输入可以来自多个来源，包括ADDM，AWR，共享SQL区域和SQL调优集。
                        </li>
                        <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-3EDB2F66-5AF9-4A49-9D16-06B9C626D11C">SQL Tuning Advisor的输出</a><br>在分析SQL语句之后，SQL Tuning Advisor会发布建议。
                        </li>
                        <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-26FBDF7C-8A57-4F37-B6FC-5FE7EA65EB5D">自动调整优化器分析</a><br>在调整模式下，优化器有更多时间考虑选项和收集统计信息。例如，Automatic Tuning Optimizer可以使用动态统计信息和部分语句执行。
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-7FAEE001-6FB3-4FA9-93AC-5598F446A15F__GUID-85F171DD-490B-4067-8CEC-08AE6EAC504F">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="sql-processing.html#GUID-8CF633B1-EAC4-47C7-9189-C479ADEF1FFA" title="SQL处理的第一个阶段是解析。">SQL解析</a> ”</span></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-EF47CEF3-E31A-4A2A-8BCE-19DC5F06F458" title="SQL Tuning Advisor是Oracle Database Tuning Pack中的SQL诊断软件。">关于SQL Tuning Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL546"></a><div class="props_rev_3"><a id="GUID-A6419DB4-DBF5-43A3-89DF-F0DE74E58D4C" name="GUID-A6419DB4-DBF5-43A3-89DF-F0DE74E58D4C"></a><h5 id="TGSQL-GUID-A6419DB4-DBF5-43A3-89DF-F0DE74E58D4C" class="sect5"><span class="enumeration_section">24.1.2.1</span> SQL Tuning Advisor的输入</h5>
                     <div>
                        <p>SQL Tuning Advisor的输入可以来自多个来源，包括ADDM，AWR，共享SQL区域和SQL调优集。</p>
                        <p>SQL Tuning Advisor使用其输入源，如下所示：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>自动数据库诊断监视器（ADDM）</p>
                              <p>SQL Tuning Advisor的主要输入源是ADDM（发音为<span class="italic">Adam</span> ）。默认情况下，ADDM每小时主动运行一次。为了识别涉及高负载SQL语句的性能问题，ADDM分析了<a href="glossary.html#GUID-91E88F5F-4220-4B1A-8578-CCFF27FBBCA9"><span class="xrefglossterm">自动工作负载存储库（AWR）</span></a>在过去一小时内收集的关键统计信息。如果标识了高负载SQL语句，则ADDM建议在SQL上运行SQL Tuning Advisor。</p>
                           </li>
                           <li>
                              <p>AWR</p>
                              <p>AWR定期拍摄系统活动的快照，包括按相关统计信息排序的高负载SQL语句，如CPU消耗和等待时间。</p>
                              <p>您可以查看AWR并手动识别高负载SQL语句。您可以在这些语句上运行SQL Tuning Advisor，尽管Oracle数据库会自动执行此工作作为自动SQL调优的一部分。默认情况下，AWR会保留过去八天的数据。您可以使用此技术查找和调整在AWR保留期内运行的任何高负载SQL。</p>
                           </li>
                           <li>
                              <p>共享SQL区域</p>
                              <p>数据库使用共享SQL区域来调整尚未在AWR中捕获的最新SQL语句。共享SQL区域和AWR提供了从AWR保留允许的当前时间识别和调整高负载SQL语句的功能，默认情况下至少为8天。</p>
                           </li>
                           <li>
                              <p>SQL调优集</p>
                              <p><a href="glossary.html#GUID-52FB0AE5-7346-44E5-BE92-3C09385B1DDC"><span class="xrefglossterm">SQL调优集（STS）</span></a>是一个数据库对象，它存储SQL语句及其执行上下文。STS可以包括尚未部署的SQL语句，目的是衡量其个人绩效，或识别性能低于预期的那些。当一组SQL语句用作输入时，数据库必须首先构造并使用STS。</p>
                           </li>
                        </ul>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-A6419DB4-DBF5-43A3-89DF-F0DE74E58D4C__GUID-4FC8865D-9D68-45E6-B971-6E611F0D1E38">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="managing-sql-tuning-sets.html#GUID-DD136837-9921-4C73-ABB8-9F1DC22542C5" title="SQL调优集（STS）是一个数据库对象，可用作调优工具的输入。">关于SQL调优集</a> ”</span></p>
                              </li>
                              <li>
                                 <p><a href="../tgdba/automatic-performance-diagnostics.html#TGDBA026" target="_blank"><span><cite>Oracle数据库性能调优指南</cite></span></a> ，了解ADDM</p>
                              </li>
                              <li>
                                 <p><a href="../tgdba/gathering-database-statistics.html#TGDBA169" target="_blank"><span><cite>Oracle数据库性能调优指南</cite></span></a> ，了解AWR</p>
                              </li>
                              <li>
                                 <p><a href="../cncpt/memory-architecture.html#CNCPT1228" target="_blank"><span><cite>Oracle Database Concepts</cite></span></a>了解共享SQL区域</p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-7FAEE001-6FB3-4FA9-93AC-5598F446A15F" title="自动调整优化器是SQL Tuning Advisor使用的核心工具。顾问程序可以从多个源接收SQL语句作为输入，使用优化程序分析这些语句，然后提出建议。">SQL Tuning Advisor体系结构</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL547"></a><div class="props_rev_3"><a id="GUID-3EDB2F66-5AF9-4A49-9D16-06B9C626D11C" name="GUID-3EDB2F66-5AF9-4A49-9D16-06B9C626D11C"></a><h5 id="TGSQL-GUID-3EDB2F66-5AF9-4A49-9D16-06B9C626D11C" class="sect5"><span class="enumeration_section">24.1.2.2</span> SQL Tuning Advisor的输出</h5>
                     <div>
                        <p>在分析SQL语句之后，SQL Tuning Advisor会发布建议。</p>
                        <p>具体来说，SQL Tuning Advisor会生成以下类型的输出：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>关于优化执行计划的建议</p>
                           </li>
                           <li>
                              <p>建议优化的基本原理</p>
                           </li>
                           <li>
                              <p>估计的性能优势</p>
                           </li>
                           <li>
                              <p>SQL语句实现建议</p>
                           </li>
                        </ul>
                        <p>每项建议显示的福利百分比使用以下公式计算：</p><pre class="pre codeblock"><code>abnf％=（time_old  -  time_new）/（time_old）</code></pre><p>例如，假设在调优之前执行时间是100秒，并且在实施推荐之后，新的执行时间预计为33秒。此绩效改进的收益计算如下：</p><pre class="pre codeblock"><code>67％=（100  -  33）/（100）</code></pre><p>您可以选择是否接受优化SQL语句的建议。根据其配置方式，Automatic SQL Tuning Advisor可以实现SQL配置文件建议，以便在<span class="italic">无需</span>用户干预的<span class="italic">情况下</span>调整语句。当按需调用时，SQL Tuning Advisor可以建议用户实现SQL配置文件，但永远不能自动实现它。
                        </p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-7FAEE001-6FB3-4FA9-93AC-5598F446A15F" title="自动调整优化器是SQL Tuning Advisor使用的核心工具。顾问程序可以从多个源接收SQL语句作为输入，使用优化程序分析这些语句，然后提出建议。">SQL Tuning Advisor体系结构</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL548"></a><div class="props_rev_3"><a id="GUID-26FBDF7C-8A57-4F37-B6FC-5FE7EA65EB5D" name="GUID-26FBDF7C-8A57-4F37-B6FC-5FE7EA65EB5D"></a><h5 id="TGSQL-GUID-26FBDF7C-8A57-4F37-B6FC-5FE7EA65EB5D" class="sect5"><span class="enumeration_section">24.1.2.3</span>自动调整优化器分析</h5>
                     <div>
                        <p>在调整模式下，优化器有更多时间考虑选项和收集统计信息。例如，Automatic Tuning Optimizer可以使用动态统计信息和部分语句执行。</p>
                        <p>下图描绘了自动调整优化器执行的不同类型的分析。</p>
                        <div class="figure" id="GUID-26FBDF7C-8A57-4F37-B6FC-5FE7EA65EB5D__GUID-9EE1283A-354E-4F46-B920-973103AB3D69">
                           <p class="titleinfigure">图24-2自动调整优化器</p><img src="img/tgsql_vm_057.png" alt="下面是图24-2的描述" title="下面是图24-2的描述" longdesc="img_text/tgsql_vm_057.html"><br><a href="img_text/tgsql_vm_057.html">“图24-2自动调整优化器”的说明</a></div>
                        <!-- class="figure" -->
                        <p>本节包含以下主题：</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-CB843CA1-6160-4918-BC71-86E36775EF15">统计分析</a><br>优化器依赖统计信息来生成执行计划。
                           </li>
                           <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-93AEDB23-107C-4357-8D7E-2BDE3D1893DF">SQL分析</a><br><strong class="term">SQL分析</strong>是自动调整优化器对其自身估计的验证。
                           </li>
                           <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-6677340C-7DB3-4F0E-9921-46687E5EDC78">访问路径分析</a><br><span class="bold">访问路径</span>是数据库检索数据的方法。
                           </li>
                           <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-982EB0FC-AADD-4741-B0AA-79005C3AF657">SQL结构分析</a><br>在结构分析期间，自动调整优化器会尝试识别可能导致性能欠佳的语法，语义或设计问题。目标是识别写得不好的SQL语句并建议如何重构它们。
                           </li>
                           <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-2ECAA5D1-A87A-4092-ABF1-575723AC904E">替代计划分析</a><br>在调整SQL语句时，SQL Tuning Advisor会搜索实时和历史性能数据，以获取该语句的<span class="bold">替代执行计划</span> 。
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-26FBDF7C-8A57-4F37-B6FC-5FE7EA65EB5D__GUID-36D4F84E-2FF1-487C-920C-655DB94445A7">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="query-optimizer-concepts.html#GUID-06129ACE-36B2-4534-AE68-EDFCAEBB3B5D" title="本章描述了与查询优化器相关的最重要的概念，包括其主要组件。">查询优化器概念</a> ”</span></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-7FAEE001-6FB3-4FA9-93AC-5598F446A15F" title="自动调整优化器是SQL Tuning Advisor使用的核心工具。顾问程序可以从多个源接收SQL语句作为输入，使用优化程序分析这些语句，然后提出建议。">SQL Tuning Advisor体系结构</a></p>
                           </div>
                        </div>
                     </div>
                     <a id="TGSQL550"></a><a id="TGSQL549"></a><div class="props_rev_3"><a id="GUID-CB843CA1-6160-4918-BC71-86E36775EF15" name="GUID-CB843CA1-6160-4918-BC71-86E36775EF15"></a><h6 id="TGSQL-GUID-CB843CA1-6160-4918-BC71-86E36775EF15" class="sect6"><span class="enumeration_section">24.1.2.3.1</span>统计分析</h6>
                        <div>
                           <p>优化器依赖统计信息来生成执行计划。</p>
                           <p>如果这些统计信息过时或丢失，则优化程序可以生成次优计划。自动调整优化程序会检查缺失或过时的统计信息，并建议在需要时收集新的统计信息。</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>对象统计</p>
                                 <p>优化程序检查查询中引用的每个对象的统计信息。</p>
                              </li>
                              <li>
                                 <p>系统统计</p>
                                 <p>在Oracle数据库云服务器上，智能扫描的成本取决于系统统计信息I / O查找时间，多块读取计数和I / O传输速度。这些系统统计信息的值通常在Oracle数据库云服务器上不同，因此需要进行分析以确定这些系统统计信息是否不是最新的。如果收集这些统计信息可以改进计划，则SQL Tuning Advisor建议接受SQL配置文件。</p>
                              </li>
                           </ul>
                           <p>下图描绘了对象级统计信息的分析。</p>
                           <div class="figure" id="GUID-CB843CA1-6160-4918-BC71-86E36775EF15__CBBEBDHJ">
                              <p class="titleinfigure">图24-3自动调整优化器的统计分析</p><img src="img/tgsql_vm_059.png" alt="下面是图24-3的描述" title="下面是图24-3的描述" longdesc="img_text/tgsql_vm_059.html"><br><a href="img_text/tgsql_vm_059.html">“图24-3自动调整优化器的统计分析”的说明</a></div>
                           <!-- class="figure" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-CB843CA1-6160-4918-BC71-86E36775EF15__GUID-CC8AE60A-FF10-448C-8DB6-0576F83A9FAE">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=DBMSO-GUID-B978FAD1-5E8D-4518-8BAA-2A06DB3F0883" target="_blank"><span id="GUID-CB843CA1-6160-4918-BC71-86E36775EF15__DBMSO"><cite>Oracle数据库云服务器系统概述</cite></span></a></p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-26FBDF7C-8A57-4F37-B6FC-5FE7EA65EB5D" title="在调整模式下，优化器有更多时间考虑选项和收集统计信息。例如，Automatic Tuning Optimizer可以使用动态统计信息和部分语句执行。">自动调整优化程序分析</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL551"></a><div class="props_rev_3"><a id="GUID-93AEDB23-107C-4357-8D7E-2BDE3D1893DF" name="GUID-93AEDB23-107C-4357-8D7E-2BDE3D1893DF"></a><h6 id="TGSQL-GUID-93AEDB23-107C-4357-8D7E-2BDE3D1893DF" class="sect6"><span class="enumeration_section">24.1.2.3.2</span> SQL分析</h6>
                        <div>
                           <p><strong class="term">SQL分析</strong>是自动调整优化器对其自身估计的验证。
                           </p>
                           <p>通过查看执行历史记录和测试SQL，优化器可以确保它具有可用于生成执行计划的最准确信息。SQL分析与生成SQL Tuning Advisor建议和实现这些建议的步骤有关但不同。</p>
                           <p>下图显示了SQL Tuning Advisor推荐SQL配置文件并自动实现它。创建配置文件后，优化器可以在生成执行计划时将其用作附加输入。</p>
                           <div class="figure" id="GUID-93AEDB23-107C-4357-8D7E-2BDE3D1893DF__GUID-9BFFA2AA-0DAA-4815-8149-5D5415956A57">
                              <p class="titleinfigure">图24-4 SQL配置文件</p><img src="img/tgsql_vm_058.png" alt="下面是图24-4的描述" title="下面是图24-4的描述" longdesc="img_text/tgsql_vm_058.html"><br><a href="img_text/tgsql_vm_058.html">“图24-4 SQL配置文件”的说明</a></div>
                           <!-- class="figure" -->
                           <p>本节包含以下主题：</p>
                        </div>
                        <div>
                           <ul class="ullinks">
                              <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-B84B0C81-BE65-41B5-A526-F2305B8EB997">SQL分析如何工作</a><br>数据库可以分析一些DML和DDL语句。
                              </li>
                              <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-A32EACFC-71CD-4476-A7D5-F7CFDF2A842D">SQL配置文件实现</a><br>如果优化程序在统计分析或SQL分析期间生成辅助信息，则优化程序建议实现SQL配置文件。
                              </li>
                           </ul>
                           <div class="infoboxnotealso" id="GUID-93AEDB23-107C-4357-8D7E-2BDE3D1893DF__GUID-22AA1584-9F53-4DB2-B427-3C9D3ADCED95">
                              <p class="notep1">也可以看看：</p>
                              <p><span class="q">“ <a href="managing-sql-profiles.html#GUID-1AC3C45E-331A-4016-8FE8-7FEFFD8D7220" title="SQL配置文件是一个数据库对象，其中包含特定于SQL语句的辅助统计信息。">关于SQL配置文件</a> ”</span></p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-26FBDF7C-8A57-4F37-B6FC-5FE7EA65EB5D" title="在调整模式下，优化器有更多时间考虑选项和收集统计信息。例如，Automatic Tuning Optimizer可以使用动态统计信息和部分语句执行。">自动调整优化程序分析</a></p>
                              </div>
                           </div>
                        </div>
                        <a id="TGSQL552"></a><div class="props_rev_3"><a id="GUID-B84B0C81-BE65-41B5-A526-F2305B8EB997" name="GUID-B84B0C81-BE65-41B5-A526-F2305B8EB997"></a><h6 id="TGSQL-GUID-B84B0C81-BE65-41B5-A526-F2305B8EB997" class="sect6"><span class="enumeration_section">24.1.2.3.2.1</span> SQL分析的工作<span class="enumeration_section">原理</span></h6>
                           <div>
                              <p>数据库可以分析一些DML和DDL语句。</p>
                              <p>具体来说，SQL Tuning Advisor可以分析以下类型的语句：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>DML语句（ <code class="codeph">SELECT</code> ，带有<code class="codeph">SELECT</code>子句的<code class="codeph">INSERT</code> ， <code class="codeph">UPDATE</code> ， <code class="codeph">DELETE</code>以及<code class="codeph">MERGE</code>的更新或插入操作）</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">CREATE TABLE</code>语句（仅使用<code class="codeph">AS SELECT</code>子句）</p>
                                 </li>
                              </ul>
                              <p>执行分析后，SQL Tuning Advisor建议或不建议实现SQL配置文件。</p>
                              <p>下图显示了SQL分析过程。</p>
                              <div class="figure" id="GUID-B84B0C81-BE65-41B5-A526-F2305B8EB997__GUID-088D128E-AF42-4770-A9C8-30EDF9E185AA">
                                 <p class="titleinfigure">图24-5 SQL分析</p><img src="img/tgsql_vm_062.png" alt="下面是图24-5的描述" title="下面是图24-5的描述" longdesc="img_text/tgsql_vm_062.html"><br><a href="img_text/tgsql_vm_062.html">“图24-5 SQL分析”的描述</a></div>
                              <!-- class="figure" -->
                              <p>在SQL分析期间，优化程序会验证语句的成本， <a href="glossary.html#GUID-36E411B8-9558-4655-844A-B2EC45FDDFA7"><span class="xrefglossterm">选择性</span></a>和<a href="glossary.html#GUID-FE541AF8-DCAB-4B00-8015-04BDCB295A85"><span class="xrefglossterm">基数</span></a> 。优化程序使用以下任一方法：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>对数据进行采样并将适当的谓词应用于样本</p>
                                    <p>优化器将新估计与常规估计进行比较，如果差异足够大，则应用校正因子。</p>
                                 </li>
                                 <li>
                                    <p>执行SQL语句的片段</p>
                                    <p>当谓词提供有效的访问路径时，此方法比采样方法更有效。</p>
                                 </li>
                              </ul>
                              <p>优化程序使用过去的语句执行历史记录来确定正确的设置。例如，如果历史记录表明SQL语句通常仅部分执行，则优化程序使用<code class="codeph">FIRST_ROWS</code>而不是<code class="codeph">ALL_ROWS</code>优化。
                              </p>
                           </div>
                           <div>
                              <div class="infoboxnotealso" id="GUID-B84B0C81-BE65-41B5-A526-F2305B8EB997__GUID-F82E1525-DC38-417D-8F00-588CEC171243">
                                 <p class="notep1">也可以看看：</p>
                                 <p><span class="q">“ <a href="influencing-the-optimizer.html#GUID-2D3EEFD3-C4C6-4D2F-B24A-8DC0C1E1CBA1" title="优化器目标是优化器对资源使用的优先级。">选择优化目标</a> ”</span></p>
                              </div>
                              <div class="familylinks">
                                 <div class="parentlink">
                                    <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-93AEDB23-107C-4357-8D7E-2BDE3D1893DF" title="SQL分析是自动调整优化器对其自身估计的验证。">SQL分析</a></p>
                                 </div>
                              </div>
                           </div>
                           
                        </div><a id="TGSQL554"></a><a id="TGSQL553"></a><div class="props_rev_3"><a id="GUID-A32EACFC-71CD-4476-A7D5-F7CFDF2A842D" name="GUID-A32EACFC-71CD-4476-A7D5-F7CFDF2A842D"></a><h6 id="TGSQL-GUID-A32EACFC-71CD-4476-A7D5-F7CFDF2A842D" class="sect6"><span class="enumeration_section">24.1.2.3.2.2</span> SQL配置文件实现</h6>
                           <div>
                              <p>如果优化程序在统计分析或SQL分析期间生成辅助信息，则优化程序建议实现SQL配置文件。</p>
                              <p><a href="sql-tuning-advisor.html#GUID-A32EACFC-71CD-4476-A7D5-F7CFDF2A842D__CBBFBIEC">如图24-6</a>所示，可以使用以下选项：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>当按需运行SQL Tuning Advisor时，用户必须选择是否实现SQL配置文件。</p>
                                 </li>
                                 <li>
                                    <p>当自动SQL调整任务配置为自动实现SQL配置文件时，顾问程序行为取决于<code class="codeph">ACCEPT_SQL_PROFILE</code>调整任务参数的设置：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p>如果设置为<code class="codeph">true</code> ，那么顾问程序会自动实现SQL配置文件。
                                          </p>
                                       </li>
                                       <li>
                                          <p>如果设置为<code class="codeph">false</code> ，则需要用户干预。
                                          </p>
                                       </li>
                                       <li>
                                          <p>如果设置为<code class="codeph">AUTO</code> （默认值），则当至少一个带有SQL配置文件的SQL语句存在时，该设置为<code class="codeph">true</code>如果不满足此条件，则设置为<code class="codeph">false</code> 。
                                          </p>
                                       </li>
                                    </ul>
                                    <div class="infoboxnote" id="GUID-A32EACFC-71CD-4476-A7D5-F7CFDF2A842D__GUID-50132F40-1CEC-488A-908B-4559AF73C9A3">
                                       <p class="notep1">注意：</p>
                                       <p>自动SQL调整任务无法自动创建SQL计划基准或向其添加计划。</p>
                                    </div>
                                 </li>
                              </ul>
                              <div class="figure" id="GUID-A32EACFC-71CD-4476-A7D5-F7CFDF2A842D__CBBFBIEC">
                                 <p class="titleinfigure">图24-6实现SQL配置文件</p><img src="img/tgsql_vm_060.png" alt="下面是图24-6的描述" title="下面是图24-6的描述" longdesc="img_text/tgsql_vm_060.html"><br><a href="img_text/tgsql_vm_060.html">“图24-6实现SQL配置文件”的说明</a></div>
                              <!-- class="figure" -->
                              <p>在自动SQL调整期间或之后的任何时间，您都可以查看报告。此报告详细描述了已分析的SQL语句，生成的建议以及自动实现的任何SQL配置文件。</p>
                           </div>
                           <div>
                              <div class="infoboxnotealso" id="GUID-A32EACFC-71CD-4476-A7D5-F7CFDF2A842D__GUID-A322DA20-8C69-482B-A92A-59851705FD90">
                                 <p class="notep1">也可以看看：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><span class="q">“ <a href="sql-tuning-advisor.html#GUID-8B77491E-9E9A-4E44-9F2A-DFA164C4B074" title="DBMS_AUTO_SQLTUNE包使您可以通过使用SET_AUTO_TUNING_TASK_PARAMETER过程指定任务参数来配置自动SQL调整。">使用命令行配置自动SQL调整任务</a> ”</span></p>
                                    </li>
                                    <li>
                                       <p><span class="q">“ <a href="overview-of-sql-plan-management.html#GUID-3AB2B2F2-A7CD-404C-A36D-8CB5AD5A78B4" title="通常，SQL计划演变是优化程序验证新计划并将其添加到现有SQL计划基准的过程。">计划进化</a> ”</span></p>
                                    </li>
                                    <li>
                                       <p><span class="q">“ <a href="managing-sql-profiles.html#GUID-1AC3C45E-331A-4016-8FE8-7FEFFD8D7220" title="SQL配置文件是一个数据库对象，其中包含特定于SQL语句的辅助统计信息。">关于SQL配置文件</a> ”</span></p>
                                    </li>
                                    <li>
                                       <p><a href="../arpls/DBMS_SQLTUNE.html#ARPLS-GUID-E2292BE7-E680-45A8-BFDD-030C3816A192" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以了解有关<code class="codeph">ACCEPT_SQL_PROFILE</code>更多信息</p>
                                    </li>
                                 </ul>
                              </div>
                              <div class="familylinks">
                                 <div class="parentlink">
                                    <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-93AEDB23-107C-4357-8D7E-2BDE3D1893DF" title="SQL分析是自动调整优化器对其自身估计的验证。">SQL分析</a></p>
                                 </div>
                              </div>
                           </div>
                           
                        </div>
                     </div><a id="TGSQL555"></a><div class="props_rev_3"><a id="GUID-6677340C-7DB3-4F0E-9921-46687E5EDC78" name="GUID-6677340C-7DB3-4F0E-9921-46687E5EDC78"></a><h6 id="TGSQL-GUID-6677340C-7DB3-4F0E-9921-46687E5EDC78" class="sect6"><span class="enumeration_section">24.1.2.3.3</span>访问路径分析</h6>
                        <div>
                           <p><span class="bold">访问路径</span>是数据库检索数据的方法。
                           </p>
                           <p>例如，使用索引的查询和使用全表扫描的查询使用不同的<span>访问路径</span> 。在某些情况下，索引可以通过消除全表扫描来极大地提高SQL语句的性能。下图说明了访问路径分析。
                           </p>
                           <div class="figure" id="GUID-6677340C-7DB3-4F0E-9921-46687E5EDC78__GUID-65AAECD4-F3BB-401F-998D-DBCE71F7FAA4">
                              <p class="titleinfigure">图24-7访问路径分析</p><img src="img/tgsql_vm_063.png" alt="下面是图24-7的描述" title="下面是图24-7的描述" longdesc="img_text/tgsql_vm_063.html"><br><a href="img_text/tgsql_vm_063.html">“图24-7访问路径分析”的描述</a></div>
                           <!-- class="figure" -->
                           <p>自动调整优化器探索新索引是否可以显着提高查询性能并推荐以下任一项：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>创建索引</p>
                                 <p>索引建议特定于SQL Tuning Advisor处理的SQL语句。有时，新索引可以快速解决与单个SQL语句相关的性能问题。</p>
                              </li>
                              <li>
                                 <p>运行SQL Access Advisor</p>
                                 <p>由于自动调整优化器不会分析其索引建议如何影响整个SQL工作负载，因此还建议在SQL语句上运行SQL Access Advisor以及具有代表性的SQL工作负载。SQL Access Advisor在提出建议之前检查在SQL工作负载上创建索引的效果。</p>
                              </li>
                           </ul>
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-26FBDF7C-8A57-4F37-B6FC-5FE7EA65EB5D" title="在调整模式下，优化器有更多时间考虑选项和收集统计信息。例如，Automatic Tuning Optimizer可以使用动态统计信息和部分语句执行。">自动调整优化程序分析</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL557"></a><a id="TGSQL556"></a><div class="props_rev_3"><a id="GUID-982EB0FC-AADD-4741-B0AA-79005C3AF657" name="GUID-982EB0FC-AADD-4741-B0AA-79005C3AF657"></a><h6 id="TGSQL-GUID-982EB0FC-AADD-4741-B0AA-79005C3AF657" class="sect6"><span class="enumeration_section">24.1.2.3.4</span> SQL结构分析</h6>
                        <div>
                           <p>在结构分析期间，自动调整优化器会尝试识别可能导致性能欠佳的语法，语义或设计问题。目标是识别写得不好的SQL语句并建议如何重构它们。</p>
                           <p>下图说明了结构分析。</p>
                           <div class="figure" id="GUID-982EB0FC-AADD-4741-B0AA-79005C3AF657__CBBCFECA">
                              <p class="titleinfigure">图24-8结构分析</p><img src="img/tgsql_vm_061.png" alt="下面是图24-8的描述" title="下面是图24-8的描述" longdesc="img_text/tgsql_vm_061.html"><br><a href="img_text/tgsql_vm_061.html">“图24-8结构分析”的描述</a></div>
                           <!-- class="figure" -->
                           <p>某些语法变体会对性能产生负面影响在结构分析中，自动调优优化器根据一组规则评估语句，识别低效的编码技术，并在可能的情况下推荐替代语句。</p>
                           <p><a href="sql-tuning-advisor.html#GUID-982EB0FC-AADD-4741-B0AA-79005C3AF657__CBBCFECA">如图24-8</a>所示，Automatic Tuning Optimizer可识别以下类别的结构问题：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>SQL构造函数的使用效率低下</p>
                                 <p>执行次优的语句可能使用<code class="codeph">NOT IN</code>而不是<code class="codeph">NOT EXISTS</code> ，或<code class="codeph">UNION</code>而不是<code class="codeph">UNION ALL</code> 。在<code class="codeph">UNION</code>操作，而不是在<code class="codeph">UNION ALL</code>操作，采用了独特的排序，以确保没有重复的行是在结果集中。如果您知道两个查询不返回重复项，则使用<code class="codeph">UNION ALL</code> 。</p>
                              </li>
                              <li>
                                 <p>数据类型不匹配</p>
                                 <p>如果索引列和比较值的数据类型不匹配，则由于隐式数据类型转换，数据库不使用索引。此外，数据库必须花费额外的资源来转换数据类型，并且某些SQL语句可能会失败，因为数据值无法正确转换。常见错误包括包含数字数据但从不用于算术运算的列：电话号码，信用卡号和支票号。为避免基数估计不佳，次优计划和<code class="codeph">ORA-01722</code>错误，开发人员必须确保绑定变量的类型为<code class="codeph">VARCHAR2</code>而不是数字。
                                 </p>
                              </li>
                              <li>
                                 <p>设计错误</p>
                                 <p>设计错误的典型示例是缺少连接条件。如果<span class="italic">n</span>是查询块中的表数，则必须存在<span class="italic">n</span> -1个连接条件才能避免使用笛卡尔积。
                                 </p>
                              </li>
                           </ul>
                           <p>在每种情况下，自动调整优化程序都会提供相关建议来重构语句。建议的替代声明与原始声明类似，但不相同。例如，建议的语句可能使用<code class="codeph">UNION ALL</code>而不是<code class="codeph">UNION</code> 。然后，您可以确定建议是否合理。
                           </p>
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-26FBDF7C-8A57-4F37-B6FC-5FE7EA65EB5D" title="在调整模式下，优化器有更多时间考虑选项和收集统计信息。例如，Automatic Tuning Optimizer可以使用动态统计信息和部分语句执行。">自动调整优化程序分析</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL559"></a><a id="TGSQL560"></a><a id="TGSQL558"></a><div class="props_rev_3"><a id="GUID-2ECAA5D1-A87A-4092-ABF1-575723AC904E" name="GUID-2ECAA5D1-A87A-4092-ABF1-575723AC904E"></a><h6 id="TGSQL-GUID-2ECAA5D1-A87A-4092-ABF1-575723AC904E" class="sect6"><span class="enumeration_section">24.1.2.3.5</span>替代计划分析</h6>
                        <div>
                           <p>在调整SQL语句时，SQL Tuning Advisor会搜索实时和历史性能数据，以获取该语句的<span class="bold">替代执行计划</span> 。
                           </p>
                           <p>如果存在除原始计划之外的计划，则SQL Tuning Advisor将报告备用计划查找。下图显示了SQL Tuning Advisor查找两个备用计划并生成备用计划查找。</p>
                           <div class="figure" id="GUID-2ECAA5D1-A87A-4092-ABF1-575723AC904E__GUID-2D699B7C-1885-43A1-B0EC-1CE795CD674E">
                              <p class="titleinfigure">图24-9替代计划分析</p><img src="img/tgsql_vm_064.png" alt="下面是图24-9的描述" title="下面是图24-9的描述" longdesc="img_text/tgsql_vm_064.html"><br><a href="img_text/tgsql_vm_064.html">“图24-9替代计划分析”的描述</a></div>
                           <!-- class="figure" -->
                           <p>SQL Tuning Advisor验证备用执行计划并记录任何不可重现的计划。找到可重现的替代计划后，您可以创建SQL计划基准，以指示优化程序将来选择这些计划。</p>
                           <div class="example" id="GUID-2ECAA5D1-A87A-4092-ABF1-575723AC904E__CBBDCGDH">
                              <p class="titleinexample">例24-1替代计划查找</p>
                              <p>以下示例显示了<code class="codeph">SELECT</code>语句的替代计划查找：</p><pre class="pre codeblock"><code>2-替代计划查找---------------------------通过搜索系统的实时和历史记录找到了该语句的一些替代执行计划性能数据。下表列出了按平均经过时间排列的这些计划。有关每个计划的详细信息，请参阅“替代计划部分”部分。id计划哈希最后一次看过去的原点备注 -  ---------- -------------------- ------- ----- --------------- ---------------- 1 1378942017 2009-02-05 / 23：12：08 0.000光标缓存原始计划2 2842999589 2009-02-05 CH-23：12：08 0.002 STS信息-----------  - 根据每次执行所用的时间，原始计划似乎具有最佳性能。但是，如果您知道一个备用计划优于原始计划，则可以为其创建SQL计划基准。这将指示Oracle优化器在将来的任何其他选择中选择它。执行dbms_sqltune.create_sql_plan_baseline（task_name =&gt;'TASK_XXXXX'，object_id =&gt; 2，task_owner =&gt;'SYS'，plan_hash =&gt; xxxxxxxx）;</code></pre><p>前面的示例显示SQL Tuning Advisor发现了两个计划，一个在共享SQL区域，另一个在SQL调优集中。共享SQL区域中的计划与原始计划相同。</p>
                              <p>如果原始计划的耗用时间比备用计划差，则SQL Tuning Advisor仅建议备用计划。在这种情况下，SQL Tuning Advisor建议用户在计划上创建具有最佳性能的SQL计划基准。在<a href="sql-tuning-advisor.html#GUID-2ECAA5D1-A87A-4092-ABF1-575723AC904E__CBBDCGDH">示例24-1中</a> ，备用计划的性能与原始计划不同，因此SQL Tuning Advisor不建议使用备用计划。
                              </p>
                           </div>
                           <!-- class="example" -->
                           <div class="example" id="GUID-2ECAA5D1-A87A-4092-ABF1-575723AC904E__CBBBBDEB">
                              <p class="titleinexample">例24-2替代计划部分</p>
                              <p>在此示例中，SQL Tuning Advisor输出的备用计划部分包括原始计划和备用计划，并总结了它们的性能。最重要的统计数据是经过的时间。原始计划使用索引，而替代计划使用全表扫描，将经过时间增加.002秒。</p><pre class="pre codeblock"><code>计划1 ------计划原点：游标缓存计划哈希值：1378942017执行：50经过时间：0.000秒CPU时间：0.000秒缓冲区获取：0磁盘读取：0磁盘写入：0注意：1。显示的统计数据是多次执行的平均值。2。该计划与原计划相符。-------------------------------------------- | Id |操作|名称| -------------------------------------------- | 0 |选择声明| | | 1 | SORT AGGREGATE | | | 2 | MERGE JOIN | | | 3 | INDEX全扫描| TEST1_INDEX | | 4 | SORT JOIN | | | 5 |表访问完全|测试| --------------------------------------------计划2 ---- - 计划原点：STS计划哈希值：2842999589执行：10经过时间：0.002秒CPU时间：0.002秒缓冲区获取：3磁盘读取：0磁盘写入：0注释：1。显示的统计数据是多次执行的平均值。------------------------------------- | Id |操作|名称| ------------------------------------- | 0 |选择声明| | | 1 | SORT AGGREGATE | | | 2 | HASH JOIN | | | 3 |表访问完全|测试| | 4 |表访问完全| TEST1 | -------------------------------------</code></pre><p>无论SQL Tuning Advisor是否推荐使用替代计划，请调用<code class="codeph">DBMS_SQLTUNE.CREATE_SQL_PLAN_BASELINE</code> 。您可以使用此过程在任何现有的可重现计划上创建SQL计划基准。
                              </p>
                           </div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-2ECAA5D1-A87A-4092-ABF1-575723AC904E__GUID-3320AAFD-4616-4E00-B733-6AFEBD9F5703">
                              <p class="notep1">也可以看看：</p>
                              <p><span class="q">“ <a href="overview-of-sql-plan-management.html#GUID-27C85EB8-C4CE-40C5-B99C-F4ADDC09A617" title="SQL配置文件和SQL计划基准都通过确保优化程序仅使用最佳计划来帮助提高SQL语句的性能。">SQL计划基准和SQL配置文件之间的差异</a> ”</span></p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-26FBDF7C-8A57-4F37-B6FC-5FE7EA65EB5D" title="在调整模式下，优化器有更多时间考虑选项和收集统计信息。例如，Automatic Tuning Optimizer可以使用动态统计信息和部分语句执行。">自动调整优化程序分析</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-FBC7E417-3575-46BA-8CE5-2D926158A6A1" name="GUID-FBC7E417-3575-46BA-8CE5-2D926158A6A1"></a><h4 id="TGSQL-GUID-FBC7E417-3575-46BA-8CE5-2D926158A6A1" class="sect4"><span class="enumeration_section">24.1.3</span> SQL Tuning Advisor操作</h4>
                  <div>
                     <p>您可以自动或按需运行SQL Tuning Advisor。您还可以在本地或远程数据库上运行顾问程序。</p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-142BD9EB-36B4-4EA6-A9C1-14B9F7D83573">自动和按需SQL调整</a><br>将SQL Tuning Advisor配置为使用<code class="codeph">DBMS_AUTO_SQLTUNE</code>自动运行，或使用<code class="codeph">DBMS_SQLTUNE</code>按需运行。</li>
                        <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-642877C5-40BE-4736-8302-17F849933038">本地和远程SQL调整</a><br>SQL Tuning Advisor可以分析本地数据库或远程数据库上的工作负载。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-EF47CEF3-E31A-4A2A-8BCE-19DC5F06F458" title="SQL Tuning Advisor是Oracle Database Tuning Pack中的SQL诊断软件。">关于SQL Tuning Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL545"></a><div class="props_rev_3"><a id="GUID-142BD9EB-36B4-4EA6-A9C1-14B9F7D83573" name="GUID-142BD9EB-36B4-4EA6-A9C1-14B9F7D83573"></a><h5 id="TGSQL-GUID-142BD9EB-36B4-4EA6-A9C1-14B9F7D83573" class="sect5"><span class="enumeration_section">24.1.3.1</span>自动和按需SQL调整</h5>
                     <div>
                        <p>将SQL Tuning Advisor配置为使用<code class="codeph">DBMS_AUTO_SQLTUNE</code>自动运行，或使用<code class="codeph">DBMS_SQLTUNE</code>按需运行。</p>
                        <p>调用方法不同如下：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>自动</p>
                              <p>您可以将SQL Tuning Advisor配置为在夜间系统维护窗口中运行。当由<code class="codeph">AUTOTASK</code>运行时，顾问程序称为<a href="glossary.html#GUID-0FCAD63A-F031-4BB5-AC88-0F2E66F34129"><span class="xrefglossterm">自动SQL调优顾问，</span></a>并执行<a href="glossary.html#GUID-54B1FE89-3A61-4BB5-ABD0-2CF78FAB9935"><span class="xrefglossterm">自动SQL调优</span></a> 。
                              </p>
                           </li>
                           <li>
                              <p>一经请求</p>
                              <p>在<a href="glossary.html#GUID-AE3B47BA-428A-435E-8A0C-05E404478475"><span class="xrefglossterm">按需SQL调优中</span></a> ，您可以手动调用SQL Tuning Advisor，以便在发现SQL相关的性能问题<span class="italic">后</span>进行诊断和修复。Oracle企业管理器云控制（云控制）是按需调优SQL的首选界面，但您也可以使用<code class="codeph">DBMS_SQLTUNE</code> PL / SQL包。
                              </p>
                           </li>
                        </ul>
                        <p>SQL Tuning Advisor使用自动调整优化器来执行其分析。此优化是“自动”的，因为优化器分析SQL而不是用户。不要将自动调整优化器与自动SQL调优混淆，本文档中<span class="italic">仅</span>涉及自动SQL调整任务执行的工作。
                        </p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-142BD9EB-36B4-4EA6-A9C1-14B9F7D83573__GUID-6FB5A1F0-5F3B-4B17-8C1D-9253C8E23465">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="sql-tuning-advisor.html#GUID-F5494CD1-52BB-478E-BB36-17104B36B0FE" title="您可以按需运行SQL Tuning Advisor。">按需运行SQL Tuning Advisor</a> ”</span></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="sql-tuning-advisor.html#GUID-87D3AA10-60CE-4F5B-879B-B2E851874B83" title="当您的目标是主动识别SQL性能问题时，将SQL Tuning Advisor配置为自动化任务是一个简单的解决方案。该任务处理来自AWR的选定高负载SQL语句，这些语句有资格作为调优候选者。">管理自动SQL调整任务</a> ”</span></p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_SQLTUNE.html#ARPLS220" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_SQLTUNE</code></p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-FBC7E417-3575-46BA-8CE5-2D926158A6A1" title="您可以自动或按需运行SQL Tuning Advisor。您还可以在本地或远程数据库上运行顾问程序。">SQL Tuning Advisor操作</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-642877C5-40BE-4736-8302-17F849933038" name="GUID-642877C5-40BE-4736-8302-17F849933038"></a><h5 id="TGSQL-GUID-642877C5-40BE-4736-8302-17F849933038" class="sect5"><span class="enumeration_section">24.1.3.2</span>本地和远程SQL调整</h5>
                     <div>
                        <p>SQL Tuning Advisor可以分析本地数据库或远程数据库上的工作负载。</p>
                        <p>在最简单的情况下，SQL Tuning Advisor接受输入，执行并在单个数据库中存储结果。本地模式适用于SQL Tuning Advisor执行的性能开销可接受的数据库。</p>
                        <p>在远程调整中，启动调整任务的数据库与执行调整过程的数据库或存储结果的数据库不同。例如，备用数据库可以有自己的查询工作负载，其中一些可能需要调优。您可以在备用数据库上发出SQL Tuning Advisor语句。备用到主数据库链接使<code class="codeph">DBMS_SQLTUNE</code>能够将数据写入主数据库并从主数据库读取数据。链接是必需的，因为备用数据库是只读的，无法写入SQL调优数据。
                        </p>
                        <p>下图说明了在主数据库上调优备用数据库工作负载的常规设置。此技术需要备用到主数据库链接。</p>
                        <div class="figure" id="GUID-642877C5-40BE-4736-8302-17F849933038__GUID-98F1E303-F0E2-48DE-B94B-BB0BB73364EF">
                           <p class="titleinfigure">图24-10调整主数据库上的备用工作负载</p><img src="img/tgsql_vm_098.png" alt="下面是图24-10的描述" title="下面是图24-10的描述" longdesc="img_text/tgsql_vm_098.html"><br><a href="img_text/tgsql_vm_098.html">“图24-10调整主数据库上的备用工作负载”的说明</a></div>
                        <!-- class="figure" -->
                        <p>要调整主数据库上的备用工作负载，请在<code class="codeph">DBMS_SQLTUNE</code>过程中指定<code class="codeph">database_link_to</code>参数。默认情况下， <code class="codeph">database_link_to</code>参数为null，这意味着调优是本地的。
                        </p>
                        <p><code class="codeph">database_link_to</code>参数必须指定专用数据库链接。此链接必须由<code class="codeph">SYS</code>拥有，并由默认特权用户<code class="codeph">SYS$UMF</code> 。以下示例语句创建名为<code class="codeph">lnk_to_pri</code>的链接：</p><pre class="pre codeblock"><code>创建数据库链接lnk_to_pri通过<span class="italic">密码</span>使用'inst1'连接到SYS $ UMF;</code></pre><p>下表说明了典型的远程调整会话。您在备用数据库上发出所有语句。<code class="codeph">DBMS_SQLTUNE</code>使用数据库链接从主数据库获取数据，并将数据存储在主数据库中。
                        </p>
                        <div class="tblformal" id="GUID-642877C5-40BE-4736-8302-17F849933038__GUID-A9E1A828-EECF-4416-BA05-071281988E1B">
                           <p class="titleintable">表24-1使用到主数据库的数据库链接调整备用数据库工作负载</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="使用到主数据库的数据库链接调整备用数据库工作负载" border="1" summary="This table explains how DBMS_SQLTUNE processes each tuning statement." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="20%" id="d120532e2772">步</th>
                                    <th align="left" valign="bottom" width="20%" id="d120532e2774">在备用数据库上发布的声明</th>
                                    <th align="left" valign="bottom" width="20%" id="d120532e2776">结果</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d120532e2780" headers="d120532e2772 ">1</td>
                                    <td align="left" valign="top" width="20%" headers="d120532e2780 d120532e2774 "><code class="codeph">CREATE_TUNING_TASK</code></td>
                                    <td align="left" valign="top" width="20%" headers="d120532e2780 d120532e2776 "><code class="codeph">DBMS_SQLTUNE</code>使用备用数据库到主数据库链接在主数据库中创建任务数据。
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d120532e2790" headers="d120532e2772 ">2</td>
                                    <td align="left" valign="top" width="20%" headers="d120532e2790 d120532e2774 "><code class="codeph">EXECUTE_TUNING_TASK</code></td>
                                    <td align="left" valign="top" width="20%" headers="d120532e2790 d120532e2776 "><code class="codeph">DBMS_SQLTUNE</code>使用数据库链接读取存储在主数据库中的SQL Tuning Advisor任务数据。调优分析在备用数据库上进行，但<code class="codeph">DBMS_SQLTUNE</code>将结果远程写入主数据库。
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d120532e2803" headers="d120532e2772 ">3</td>
                                    <td align="left" valign="top" width="20%" headers="d120532e2803 d120532e2774 "><code class="codeph">REPORT_TUNING_TASK</code></td>
                                    <td align="left" valign="top" width="20%" headers="d120532e2803 d120532e2776 "><code class="codeph">DBMS_SQLTUNE</code>使用数据库链接从主数据库读取SQL Tuning Advisor报告数据，然后在备用数据库上本地构建报告。
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d120532e2813" headers="d120532e2772 ">4</td>
                                    <td align="left" valign="top" width="20%" headers="d120532e2813 d120532e2774 "><code class="codeph">ACCEPT_SQL_PROFILE</code></td>
                                    <td align="left" valign="top" width="20%" headers="d120532e2813 d120532e2776 "><code class="codeph">DBMS_SQLTUNE</code>使用数据库链接将SQL配置文件数据远程写入主数据库。
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-642877C5-40BE-4736-8302-17F849933038__GUID-A0700EDC-CF6C-46EE-B7E9-F3235057646A">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="sql-tuning-advisor.html#GUID-4CFA6019-BB0D-4CC7-A281-42E13FFABFD9" title="要在创建调整任务后更改调整任务的参数，请执行DBMS_SQLTUNE.SET_TUNING_TASK_PARAMETER函数。">配置SQL调整任务</a> ”</span></p>
                              </li>
                              <li>
                                 <p><a href="../sbydb/managing-oracle-data-guard-physical-standby-databases.html#SBYDB-GUID-07CB190C-C248-4FF5-AB64-EAA9C6D42677" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a> ，了解如何在Data Guard环境中执行远程调整</p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_SQLTUNE.html#GUID-02C23DDE-6304-49E4-9DFC-EA39D44F943C" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解有关<code class="codeph">DBMS_SQLTUNE.CREATE_TUNING_TASK</code>更多信息</p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-FBC7E417-3575-46BA-8CE5-2D926158A6A1" title="您可以自动或按需运行SQL Tuning Advisor。您还可以在本地或远程数据库上运行顾问程序。">SQL Tuning Advisor操作</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div><a id="TGSQL561"></a><div class="props_rev_3"><a id="GUID-87D3AA10-60CE-4F5B-879B-B2E851874B83" name="GUID-87D3AA10-60CE-4F5B-879B-B2E851874B83"></a><h3 id="TGSQL-GUID-87D3AA10-60CE-4F5B-879B-B2E851874B83" class="sect3"><span class="enumeration_section">24.2</span>管理自动SQL调整任务</h3>
               <div>
                  <p>当您的目标是主动识别SQL性能问题时，将SQL Tuning Advisor配置为自动化任务是一个简单的解决方案。该任务处理来自AWR的选定高负载SQL语句，这些语句有资格作为调优候选者。</p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-B383AE33-81F0-4D6A-A48F-A97C06448A2F">关于自动SQL调整任务</a><br>默认情况下，自动SQL调整任务在夜间维护窗口中运行。
                     </li>
                     <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-581888AA-B9EF-4471-ABDF-1FF9C0264412">启用和禁用自动SQL调整任务</a><br>您可以使用Cloud Control（首选）或命令行界面启用或禁用“自动SQL调整”任务。
                     </li>
                     <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-E621B81C-844C-43A1-B81B-75BF0159FBEF">配置自动SQL调整任务</a><br>您可以使用Cloud Control或命令行配置自动SQL调整任务。
                     </li>
                     <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-C8264D23-0A39-4E1F-9603-01137CCB91A8">查看自动SQL调整报告</a><br>在运行自动SQL调整任务期间或之后的任何时间，您都可以查看调整报告。
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-87D3AA10-60CE-4F5B-879B-B2E851874B83__GUID-FAD5E552-7B91-4E77-B42C-E255D1DDA134">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="../admin/managing-automated-database-maintenance-tasks.html#ADMIN12331" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a> ，了解有关自动维护任务的更多信息</p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-8E1A39CB-A491-4254-8B31-9B1DF7B52AA1" title="使用SQL Tuning Advisor获取有关提高高负载SQL语句性能的建议，并通过仅执行最佳计划来防止回归。">使用SQL Tuning Advisor分析SQL</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL562"></a><div class="props_rev_3"><a id="GUID-B383AE33-81F0-4D6A-A48F-A97C06448A2F" name="GUID-B383AE33-81F0-4D6A-A48F-A97C06448A2F"></a><h4 id="TGSQL-GUID-B383AE33-81F0-4D6A-A48F-A97C06448A2F" class="sect4"><span class="enumeration_section">24.2.1</span>关于自动SQL调整任务</h4>
                  <div>
                     <p>默认情况下，自动SQL调整任务在夜间维护窗口中运行。</p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-ECC5B582-2BF1-4CB8-83E9-BAF13213570B">自动SQL调整的目的</a><br>配置自动SQL调优而不是手动调整可降低成本并提高可管理性</li>
                        <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-9A30D6A4-D25D-4260-A74B-B822F7C523B4">自动SQL调整概念</a><br>Oracle Scheduler使用自动维护任务基础结构（称为<span class="italic">AutoTask</span> ）来计划自动运行的任务。
                        </li>
                        <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-44044948-163C-479D-BE9A-A48D28C88651">SQL Tuning Advisor的命令行界面</a><br>在命令行上，您可以使用PL / SQL包来执行SQL调优任务。
                        </li>
                        <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-8FC77F49-A0F0-469E-A37D-71DCAF74E359">自动SQL调整的基本任务</a><br>本节介绍将SQL Tuning Advisor作为自动任务运行的基本任务。
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-B383AE33-81F0-4D6A-A48F-A97C06448A2F__GUID-64FF39E3-064D-4AD2-B7F0-DBCD59FCEDCB">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../multi/administering-a-cdb-with-sql-plus.html#GUID-DF42C0D3-8968-4810-9327-9D176337D356" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a> ，了解多租户环境中的SQL Tuning Advisor</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-87D3AA10-60CE-4F5B-879B-B2E851874B83" title="当您的目标是主动识别SQL性能问题时，将SQL Tuning Advisor配置为自动化任务是一个简单的解决方案。该任务处理来自AWR的选定高负载SQL语句，这些语句有资格作为调优候选者。">管理自动SQL调整任务</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL563"></a><div class="props_rev_3"><a id="GUID-ECC5B582-2BF1-4CB8-83E9-BAF13213570B" name="GUID-ECC5B582-2BF1-4CB8-83E9-BAF13213570B"></a><h5 id="TGSQL-GUID-ECC5B582-2BF1-4CB8-83E9-BAF13213570B" class="sect5"><span class="enumeration_section">24.2.1.1</span>自动SQL调整的目的</h5>
                     <div>
                        <p>配置自动SQL调优而不是手动调整可降低成本并提高可管理性</p>
                        <p>许多DBA没有时间进行SQL调优所需的密集分析。即使他们这样做，SQL调优也涉及几个手动步骤。由于几个不同的SQL语句在任何给定的日期可能都是高负载，因此DBA可能不得不花费相当大的精力来监视和调整它们。 。</p>
                        <p>中自动SQL调整任务<span class="italic">不</span>处理以下类型的SQL语句：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>在一周内不重复的即席SQL语句或SQL语句</p>
                           </li>
                           <li>
                              <p>并行查询</p>
                           </li>
                           <li>
                              <p>在SQL配置文件之后运行时间太长的查询，因此SQL Tuning Advisor测试执行是不切实际的</p>
                           </li>
                           <li>
                              <p>递归SQL</p>
                           </li>
                        </ul>
                        <p>您可以根据需要运行SQL Tuning Advisor来调整前面的SQL语句类型。</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-B383AE33-81F0-4D6A-A48F-A97C06448A2F" title="默认情况下，自动SQL调整任务在夜间维护窗口中运行。">关于自动SQL调整任务</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL564"></a><div class="props_rev_3"><a id="GUID-9A30D6A4-D25D-4260-A74B-B822F7C523B4" name="GUID-9A30D6A4-D25D-4260-A74B-B822F7C523B4"></a><h5 id="TGSQL-GUID-9A30D6A4-D25D-4260-A74B-B822F7C523B4" class="sect5"><span class="enumeration_section">24.2.1.2</span>自动SQL调整概念</h5>
                     <div>
                        <p>Oracle Scheduler使用自动维护任务基础结构（称为<span class="italic">AutoTask</span> ）来计划自动运行的任务。
                        </p>
                        <p>默认情况下，自动SQL调整任务在夜间维护窗口中最多运行一小时。您可以自定义维护窗口的属性，包括开始和结束时间，频率和一周中的几天。</p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-9A30D6A4-D25D-4260-A74B-B822F7C523B4__GUID-AE64CB55-38FE-4E6B-AA21-A1F76E93D610">
                           <p class="notep1">也可以看看：</p>
                           <p></p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../admin/oracle-scheduler-concepts.html#ADMIN033" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a> ，了解Oracle Scheduler</p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_AUTO_TASK_ADMIN.html#ARPLS032" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_AUTO_TASK_ADMIN</code></p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-B383AE33-81F0-4D6A-A48F-A97C06448A2F" title="默认情况下，自动SQL调整任务在夜间维护窗口中运行。">关于自动SQL调整任务</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL566"></a><a id="TGSQL565"></a><div class="props_rev_3"><a id="GUID-44044948-163C-479D-BE9A-A48D28C88651" name="GUID-44044948-163C-479D-BE9A-A48D28C88651"></a><h5 id="TGSQL-GUID-44044948-163C-479D-BE9A-A48D28C88651" class="sect5"><span class="enumeration_section">24.2.1.3</span> SQL Tuning Advisor的命令行界面</h5>
                     <div>
                        <p>在命令行上，您可以使用PL / SQL包来执行SQL调优任务。</p>
                        <div class="section">
                           <p>下表描述了最相关的包。</p>
                           <div class="tblformal" id="GUID-44044948-163C-479D-BE9A-A48D28C88651__CBBHHEAH">
                              <p class="titleintable">表24-2 SQL Tuning Advisor包</p>
                              <table cellpadding="4" cellspacing="0" class="Formal" title="SQL Tuning Advisor包" width="100%" border="1" summary="Tools for performing task" frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="40%" id="d120532e3568">包</th>
                                       <th align="left" valign="bottom" width="60%" id="d120532e3571">描述</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="40%" id="d120532e3576" headers="d120532e3568 ">
                                          <p><code class="codeph">DBMS_AUTO_SQLTUNE</code></p>
                                       </td>
                                       <td align="left" valign="top" width="60%" headers="d120532e3576 d120532e3571 ">
                                          <p>使您能够运行SQL Tuning Advisor，管理SQL配置文件，管理SQL调优集以及执行实时SQL性能监视。要使用此API，您必须具有<code class="codeph">ADVISOR</code>权限。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="40%" id="d120532e3587" headers="d120532e3568 ">
                                          <p><code class="codeph">DBMS_AUTO_TASK_ADMIN</code></p>
                                       </td>
                                       <td align="left" valign="top" width="60%" headers="d120532e3587 d120532e3571 ">
                                          <p>提供<code class="codeph">AUTOTASK</code>的接口。您可以使用此界面启用和禁用“自动SQL调整”任务。
                                          </p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-44044948-163C-479D-BE9A-A48D28C88651__GUID-ECE7DB02-0C9F-4837-8022-F848CD8DD4DD">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../arpls/DBMS_SPM.html#ARPLS150" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考，</span></a>以了解<code class="codeph">DBMS_SQLTUNE</code>和<code class="codeph">DBMS_AUTO_TASK_ADMIN</code></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-B383AE33-81F0-4D6A-A48F-A97C06448A2F" title="默认情况下，自动SQL调整任务在夜间维护窗口中运行。">关于自动SQL调整任务</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL568"></a><a id="TGSQL567"></a><div class="props_rev_3"><a id="GUID-8FC77F49-A0F0-469E-A37D-71DCAF74E359" name="GUID-8FC77F49-A0F0-469E-A37D-71DCAF74E359"></a><h5 id="TGSQL-GUID-8FC77F49-A0F0-469E-A37D-71DCAF74E359" class="sect5"><span class="enumeration_section">24.2.1.4</span>自动SQL调整的基本任务</h5>
                     <div>
                        <p>本节介绍将SQL Tuning Advisor作为自动任务运行的基本任务。</p>
                        <p>下图显示了基本工作流程。</p>
                        <div class="figure" id="GUID-8FC77F49-A0F0-469E-A37D-71DCAF74E359__CBBEBDBC">
                           <p class="titleinfigure">图24-11自动SQL调整API</p><img src="img/tgsql_vm_026.png" alt="下面是图24-11的描述" title="下面是图24-11的描述" longdesc="img_text/tgsql_vm_026.html"><br><a href="img_text/tgsql_vm_026.html">“图24-11自动SQL调优API”的说明</a></div>
                        <!-- class="figure" -->
                        <p><a href="sql-tuning-advisor.html#GUID-35C7B77F-5CB1-45EC-A48D-10C1E47CC7BE__CBBIFFBI">如图24-12</a>所示，基本步骤如下：</p>
                        <ol>
                           <li>
                              <p>启用自动SQL调整任务。</p>
                              <p>请参阅<span class="q">“ <a href="sql-tuning-advisor.html#GUID-581888AA-B9EF-4471-ABDF-1FF9C0264412" title="您可以使用Cloud Control（首选）或命令行界面启用或禁用“自动SQL调整”任务。">启用和禁用自动SQL调整任务</a> ”</span> 。
                              </p>
                           </li>
                           <li>
                              <p>（可选）配置“自动SQL调整”任务。</p>
                              <p>请参阅<span class="q">“ <a href="sql-tuning-advisor.html#GUID-E621B81C-844C-43A1-B81B-75BF0159FBEF" title="您可以使用Cloud Control或命令行配置自动SQL调整任务。">配置自动SQL调整任务</a> ”</span> 。
                              </p>
                           </li>
                           <li>
                              <p>显示自动SQL调整任务的结果。</p>
                              <p>请参阅<span class="q">“ <a href="sql-tuning-advisor.html#GUID-C8264D23-0A39-4E1F-9603-01137CCB91A8" title="在运行自动SQL调整任务期间或之后的任何时间，您都可以查看调整报告。">查看自动SQL调整报告</a> ”</span> 。
                              </p>
                           </li>
                           <li>
                              <p>禁用自动SQL调整任务。</p>
                              <p>请参阅<span class="q">“ <a href="sql-tuning-advisor.html#GUID-581888AA-B9EF-4471-ABDF-1FF9C0264412" title="您可以使用Cloud Control（首选）或命令行界面启用或禁用“自动SQL调整”任务。">启用和禁用自动SQL调整任务</a> ”</span> 。
                              </p>
                           </li>
                        </ol>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-B383AE33-81F0-4D6A-A48F-A97C06448A2F" title="默认情况下，自动SQL调整任务在夜间维护窗口中运行。">关于自动SQL调整任务</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL569"></a><div class="props_rev_3"><a id="GUID-581888AA-B9EF-4471-ABDF-1FF9C0264412" name="GUID-581888AA-B9EF-4471-ABDF-1FF9C0264412"></a><h4 id="TGSQL-GUID-581888AA-B9EF-4471-ABDF-1FF9C0264412" class="sect4"><span class="enumeration_section">24.2.2</span>启用和禁用自动SQL调整任务</h4>
                  <div>
                     <p>您可以使用Cloud Control（首选）或命令行界面启用或禁用“自动SQL调整”任务。</p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-34539175-C00C-46C3-8F68-5A997A4E506C">使用Cloud Control启用和禁用自动SQL调整任务</a><br>您可以使用Cloud Control启用和禁用所有自动维护任务，包括自动SQL调整任务。
                        </li>
                        <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-1980AAEB-E975-46D7-A816-94BB4237E77E">从命令行启用和禁用自动SQL调整任务</a><br>如果不使用Cloud Control启用和禁用“自动SQL调整”任务，则必须使用命令行。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-87D3AA10-60CE-4F5B-879B-B2E851874B83" title="当您的目标是主动识别SQL性能问题时，将SQL Tuning Advisor配置为自动化任务是一个简单的解决方案。该任务处理来自AWR的选定高负载SQL语句，这些语句有资格作为调优候选者。">管理自动SQL调整任务</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL570"></a><div class="props_rev_3"><a id="GUID-34539175-C00C-46C3-8F68-5A997A4E506C" name="GUID-34539175-C00C-46C3-8F68-5A997A4E506C"></a><h5 id="TGSQL-GUID-34539175-C00C-46C3-8F68-5A997A4E506C" class="sect5"><span class="enumeration_section">24.2.2.1</span>使用Cloud Control启用和禁用自动SQL调整任务</h5>
                     <div>
                        <p>您可以使用Cloud Control启用和禁用所有自动维护任务，包括自动SQL调整任务。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-34539175-C00C-46C3-8F68-5A997A4E506C__GUID-FD89B51A-9B1D-472A-8133-B4F9659FD45F">要使用Cloud Control启用或禁用“自动SQL调整”任务，请执行以下操作：</p>
                           <ol>
                              <li>
                                 <p>使用适当的凭据登录Cloud Control。</p>
                              </li>
                              <li>
                                 <p>在“ <span class="bold">目标”</span>菜单下，选择“ <span class="bold">数据库”</span> 。
                                 </p>
                              </li>
                              <li>
                                 <p>在数据库目标列表中，选择要管理的Oracle数据库实例的目标。</p>
                              </li>
                              <li>
                                 <p>如果系统提示您输入数据库凭据，请输入您要执行的任务所需的最低凭据。</p>
                              </li>
                              <li>
                                 <p>从<span class="bold">Administration</span>菜单中，选择<span class="bold">Oracle Scheduler</span> ，然后选择<span class="bold">Automated Maintenance Tasks</span> 。
                                 </p>
                                 <p>将显示“自动维护任务”页面。</p>
                                 <p>此页面显示预定义的任务。您可以通过单击相应的链接来访问每个任务，以获取有关该任务的更多信息。</p>
                              </li>
                              <li>
                                 <p>单击“ <span class="bold">自动SQL调整”</span> 。
                                 </p>
                                 <p>将出现“自动SQL调整结果摘要”页面。</p>
                                 <p>“任务状态”部分显示是启用还是禁用“自动SQL调整任务”。在下图中，任务已禁用：</p>
                                 <div class="figure" id="GUID-34539175-C00C-46C3-8F68-5A997A4E506C__GUID-60AB6FCD-DD7A-40A5-B220-984A52FB2CBB"><img src="img/sta_task_status_disabled.gif" alt="下面是sta_task_status_disabled.gif的描述" title="下面是sta_task_status_disabled.gif的描述" longdesc="img_text/sta_task_status_disabled.html"><br><a href="img_text/sta_task_status_disabled.html">插图描述sta_task_status_disabled.gif</a></div>
                                 <!-- class="figure" -->
                              </li>
                              <li>
                                 <p>在“自动SQL调整”中，单击“ <span class="bold">配置”</span> 。
                                 </p>
                                 <p>将显示“自动维护任务配置”页面。</p>
                                 <div class="figure" id="GUID-34539175-C00C-46C3-8F68-5A997A4E506C__GUID-4C291300-A31D-4325-97CC-DE162013A2EA"><img src="img/sta_maint_task_config.gif" alt="sta_maint_task_config.gif的描述如下" title="sta_maint_task_config.gif的描述如下" longdesc="img_text/sta_maint_task_config.html"><br><a href="img_text/sta_maint_task_config.html">插图描述sta_maint_task_config.gif</a></div>
                                 <!-- class="figure" -->
                                 <p>默认情况下，自动SQL调整在<code class="codeph">MAINTENANCE_WINDOW_GROUP</code>中的所有预定义维护窗口中执行。</p>
                              </li>
                              <li>
                                 <p>执行以下步骤：</p>
                                 <ol type="a">
                                    <li>
                                       <p>在“自动SQL调整的任务设置”中，选择“已<span class="bold">启用”</span>或“ <span class="bold">已禁用”</span>以启用或禁用自动化任务。
                                       </p>
                                    </li>
                                    <li>
                                       <p>要禁用一周中特定日期的自动SQL调整，请选中窗口名称旁边的相应框。</p>
                                    </li>
                                    <li>
                                       <p>要更改窗口的特征，请单击“ <span class="bold">编辑窗口组”</span> 。
                                       </p>
                                    </li>
                                    <li>
                                       <p>单击“ <span class="bold">应用”</span>
                                       </p>
                                    </li>
                                 </ol>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-581888AA-B9EF-4471-ABDF-1FF9C0264412" title="您可以使用Cloud Control（首选）或命令行界面启用或禁用“自动SQL调整”任务。">启用和禁用自动SQL调整任务</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL571"></a><div class="props_rev_3"><a id="GUID-1980AAEB-E975-46D7-A816-94BB4237E77E" name="GUID-1980AAEB-E975-46D7-A816-94BB4237E77E"></a><h5 id="TGSQL-GUID-1980AAEB-E975-46D7-A816-94BB4237E77E" class="sect5"><span class="enumeration_section">24.2.2.2从命令行</span>启用和禁用自动SQL调整任务</h5>
                     <div>
                        <p>如果不使用Cloud Control启用和禁用“自动SQL调整”任务，则必须使用命令行。</p>
                        <div class="section">
                           <p>您有以下选择：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>在<code class="codeph">DBMS_AUTO_TASK_ADMIN</code> PL / SQL包中运行<code class="codeph">ENABLE</code>或<code class="codeph">DISABLE</code>过程。
                                 </p>
                                 <p>该软件包是推荐的命令行技术。对于<code class="codeph">ENABLE</code>和<code class="codeph">DISABLE</code>过程，您可以使用<code class="codeph">window_name</code>参数指定特定的维护窗口。
                                 </p>
                              </li>
                              <li>
                                 <p>将<code class="codeph">STATISTICS_LEVEL</code>初始化参数设置为<code class="codeph">BASIC</code>以禁用<span class="italic">所有</span>建议和统计信息的收集，包括Automatic SQL Tuning Advisor。
                                 </p>
                                 <p>由于禁用了监视和许多自动功能，Oracle强烈建议您不要将<code class="codeph">STATISTICS_LEVEL</code>设置为<code class="codeph">BASIC</code> 。</p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-1980AAEB-E975-46D7-A816-94BB4237E77E__GUID-50A212CC-5D02-4240-85F9-03A620199B6B">使用DBMS_AUTO_TASK_ADMIN启用或禁用自动SQL调整：</p>
                           <ol>
                              <li>
                                 <p>使用管理员权限将SQL * Plus连接到数据库，然后执行以下操作之一：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>要启用自动化任务，请执行以下PL / SQL块：</p><pre class="pre codeblock"><code>BEGIN DBMS_AUTO_TASK_ADMIN.ENABLE（client_name =&gt;'sql tuning advisor'，operation =&gt; NULL，window_name =&gt; NULL）;结束; /</code></pre></li>
                                    <li>
                                       <p>要禁用自动化任务，请执行以下PL / SQL块：</p><pre class="pre codeblock"><code>BEGIN DBMS_AUTO_TASK_ADMIN.DISABLE（client_name =&gt;'sql tuning advisor'，operation =&gt; NULL，window_name =&gt; NULL）;结束; /</code></pre></li>
                                 </ul>
                              </li>
                              <li>
                                 <p>查询数据字典以确认更改。</p>
                                 <p>例如，查询<code class="codeph">DBA_AUTOTASK_CLIENT</code>如下（包括样本输出）：</p><pre class="pre codeblock"><code>COL CLIENT_NAME FORMAT a20 SELECT CLIENT_NAME，STATUS FROM DBA_AUTOTASK_CLIENT WHERE CLIENT_NAME ='sql tuning advisor'; CLIENT_NAME STATUS -------------------- -------- sql tuning advisor ENABLED</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-1980AAEB-E975-46D7-A816-94BB4237E77E__GUID-FE2C5B86-43B7-4247-823F-995EDF0C9D4A">要禁用所有建议和统计信息的收集：</p>
                           <ol>
                              <li>
                                 <p>使用管理员权限将SQL * Plus连接到数据库，然后查询当前的统计级别设置。</p>
                                 <p>以下SQL * Plus命令显示<code class="codeph">STATISTICS_LEVEL</code>设置为<code class="codeph">ALL</code> ：</p><pre class="pre codeblock"><code>sys @ PROD&gt; SHOW PARAMETER statistics_level NAME TYPE VALUE ------------------------------------ ---- ------- ----- statistics_level string ALL</code></pre></li>
                              <li>
                                 <p>将<code class="codeph">STATISTICS_LEVEL</code>设置为<code class="codeph">BASIC</code> ，如下所示：</p><pre class="pre codeblock"><code>sys @ PROD&gt; ALTER SYSTEM SET STATISTICS_LEVEL ='BASIC';系统改变了。</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-1980AAEB-E975-46D7-A816-94BB4237E77E__GUID-37386F75-34EE-4128-B6C7-5741B5973637">
                           <p class="notep1">也可以看看：</p>
                           <p> <a href="../arpls/DBMS_AUTO_TASK_ADMIN.html#ARPLS032" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以获取完整的参考信息</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-581888AA-B9EF-4471-ABDF-1FF9C0264412" title="您可以使用Cloud Control（首选）或命令行界面启用或禁用“自动SQL调整”任务。">启用和禁用自动SQL调整任务</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL572"></a><div class="props_rev_3"><a id="GUID-E621B81C-844C-43A1-B81B-75BF0159FBEF" name="GUID-E621B81C-844C-43A1-B81B-75BF0159FBEF"></a><h4 id="TGSQL-GUID-E621B81C-844C-43A1-B81B-75BF0159FBEF" class="sect4"><span class="enumeration_section">24.2.3</span>配置自动SQL调整任务</h4>
                  <div>
                     <p>您可以使用Cloud Control或命令行配置自动SQL调整任务。</p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-E05C2B66-1F41-4647-B94F-8371E228DA90">使用云控制配置自动SQL调整任务</a><br>您可以使用Cloud Control启用和禁用所有自动维护任务，包括自动SQL调整任务。您必须以<code class="codeph">SYS</code>执行操作或对PL / SQL包<code class="codeph">DBMS_AUTO_SQLTUNE</code>具有<code class="codeph">EXECUTE</code>特权。</li>
                        <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-8B77491E-9E9A-4E44-9F2A-DFA164C4B074">使用命令行配置自动SQL调整任务</a><br><code class="codeph">DBMS_AUTO_SQLTUNE</code>包使您可以通过使用<code class="codeph">SET_AUTO_TUNING_TASK_PARAMETER</code>过程指定任务参数来配置自动SQL调整。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-87D3AA10-60CE-4F5B-879B-B2E851874B83" title="当您的目标是主动识别SQL性能问题时，将SQL Tuning Advisor配置为自动化任务是一个简单的解决方案。该任务处理来自AWR的选定高负载SQL语句，这些语句有资格作为调优候选者。">管理自动SQL调整任务</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL573"></a><div class="props_rev_3"><a id="GUID-E05C2B66-1F41-4647-B94F-8371E228DA90" name="GUID-E05C2B66-1F41-4647-B94F-8371E228DA90"></a><h5 id="TGSQL-GUID-E05C2B66-1F41-4647-B94F-8371E228DA90" class="sect5"><span class="enumeration_section">24.2.3.1</span>使用云控制配置自动SQL调整任务</h5>
                     <div>
                        <p>您可以使用Cloud Control启用和禁用所有自动维护任务，包括自动SQL调整任务。您必须以<code class="codeph">SYS</code>执行操作或对PL / SQL包<code class="codeph">DBMS_AUTO_SQLTUNE</code>具有<code class="codeph">EXECUTE</code>特权。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-E05C2B66-1F41-4647-B94F-8371E228DA90__GUID-7ECDE0A7-777B-4EC1-B750-A3F278A9A98F">使用Cloud Control配置自动SQL调整任务：</p>
                           <ol>
                              <li>
                                 <p>使用适当的凭据登录Cloud Control。</p>
                              </li>
                              <li>
                                 <p>在“ <span class="bold">目标”</span>菜单下，选择“ <span class="bold">数据库”</span> 。
                                 </p>
                              </li>
                              <li>
                                 <p>在数据库目标列表中，选择要管理的Oracle数据库实例的目标。</p>
                              </li>
                              <li>
                                 <p>如果系统提示您输入数据库凭据，请输入您要执行的任务所需的最低凭据。</p>
                              </li>
                              <li>
                                 <p>从“ <span class="bold">管理”</span>菜单中，单击“ <span class="bold">Oracle Scheduler”</span> ，然后单击“ <span class="bold">自动维护任务”</span> 。
                                 </p>
                                 <p>将显示“自动维护任务”页面。</p>
                                 <p>此页面显示预定义的任务。您可以通过单击相应的链接来访问每个任务，以获取有关任务本身的更多信息。</p>
                              </li>
                              <li>
                                 <p>单击“ <span class="bold">自动SQL调整”</span> 。
                                 </p>
                                 <p>将出现“自动SQL调整结果摘要”页面。</p>
                              </li>
                              <li>
                                 <p>在“任务设置”下，单击“自动SQL调整”（ <code class="codeph">SYS_AUTO_SQL_TUNING_TASK</code> ）旁边的“ <span class="bold">配置”</span> 。
                                 </p>
                                 <p>将显示“自动维护任务配置”页面。</p>
                              </li>
                              <li>
                                 <p>在“任务设置”下，单击“自动SQL调整”旁边的“ <span class="bold">配置”</span> 。
                                 </p>
                                 <p>将出现“自动SQL调整设置”页面。</p>
                                 <div class="figure" id="GUID-E05C2B66-1F41-4647-B94F-8371E228DA90__GUID-C4EBCD8A-A15D-42E3-B9D2-C0D0C297EFDA"><img src="img/auto_sql_tuning_settings.gif" alt="auto_sql_tuning_settings.gif的描述如下" title="auto_sql_tuning_settings.gif的描述如下" longdesc="img_text/auto_sql_tuning_settings.html"><br><a href="img_text/auto_sql_tuning_settings.html">auto_sql_tuning_settings.gif插图的描述</a></div>
                                 <!-- class="figure" -->
                              </li>
                              <li>
                                 <p>进行所需的更改并单击“ <span class="bold">应用”</span> 。
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-E621B81C-844C-43A1-B81B-75BF0159FBEF" title="您可以使用Cloud Control或命令行配置自动SQL调整任务。">配置自动SQL调整任务</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL94959"></a><a id="TGSQL94888"></a><a id="TGSQL574"></a><div class="props_rev_3"><a id="GUID-8B77491E-9E9A-4E44-9F2A-DFA164C4B074" name="GUID-8B77491E-9E9A-4E44-9F2A-DFA164C4B074"></a><h5 id="TGSQL-GUID-8B77491E-9E9A-4E44-9F2A-DFA164C4B074" class="sect5"><span class="enumeration_section">24.2.3.2</span>使用命令行配置自动SQL调整任务</h5>
                     <div>
                        <p><code class="codeph">DBMS_AUTO_SQLTUNE</code>包使您可以通过使用<code class="codeph">SET_AUTO_TUNING_TASK_PARAMETER</code>过程指定任务参数来配置自动SQL调整。
                        </p>
                        <div class="section">
                           <p>由于任务由<code class="codeph">SYS</code>拥有，因此只有<code class="codeph">SYS</code>可以设置任务参数。
                           </p>
                           <p><code class="codeph">ACCEPT_SQL_PROFILE</code>调整任务参数指定是自动实现SQL配置文件（ <code class="codeph">true</code> ）还是需要用户干预（ <code class="codeph">false</code> ）。默认值为<code class="codeph">AUTO</code> ，如果至少有一个SQL语句与SQL配置文件一起存在，则表示为<code class="codeph">true</code>如果不满足此条件，则为<code class="codeph">false</code> 。
                           </p>
                           <div class="infoboxnote" id="GUID-8B77491E-9E9A-4E44-9F2A-DFA164C4B074__GUID-516E9278-B64C-4BF2-962D-E30A1D19CCE4">
                              <p class="notep1">注意：</p>
                              <p>启用自动实现时，顾问程序仅实现创建SQL配置文件的建议。不会自动实现诸如创建新索引，收集优化程序统计信息和创建SQL计划基准等建议。</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-8B77491E-9E9A-4E44-9F2A-DFA164C4B074__GUID-51BD787B-F5CD-4A62-8F94-D74DBBE103E3">假设</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>本教程假设以下内容：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>您希望数据库自动实现SQL配置文件，但每次执行不超过50个SQL配置文件，并且数据库上的配置文件总数不超过50个。</p>
                              </li>
                              <li>
                                 <p>您希望任务在每次执行1200秒后超时。</p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-8B77491E-9E9A-4E44-9F2A-DFA164C4B074__GUID-FF781BA0-683A-444E-9CCB-0597A688F3F7">设置自动SQL调整任务参数：</p>
                           <ol>
                              <li>
                                 <p>使用适当的权限将SQL * Plus连接到数据库，然后可选地查询当前任务设置。</p>
                                 <p>例如，使用管理员权限将SQL * Plus连接到数据库并执行以下查询：</p><pre class="pre codeblock"><code>COL PARAMETER_NAME FORMAT a25 COL VALUE FORMAT a10 SELECT PARAMETER_NAME，PARAMETER_VALUE作为“VALUE”来自DBA_ADVISOR_PARAMETERS WHERE（（TASK_NAME ='SYS_AUTO_SQL_TUNING_TASK'）和（（PARAMETER_NAME LIKE'％PROFILE％'）或（PARAMETER_NAME ='LOCAL_TIME_LIMIT'）或（PARAMETER_NAME = 'EXECUTION_DAYS_TO_EXPIRE'）））;</code></pre><p>示例输出显示如下：</p><pre class="pre codeblock"><code>PARAMETER_NAME VALUE ------------------------- ---------- EXECUTION_DAYS_TO_EXPIRE 30 LOCAL_TIME_LIMIT 1000 ACCEPT_SQL_PROFILES FALSE MAX_SQL_PROFILES_PER_EXEC 20 MAX_AUTO_SQL_PROFILES 10000</code></pre></li>
                              <li>
                                 <p>使用以下格式的PL / SQL代码设置参数：</p><pre class="pre codeblock"><code>BEGIN DBMS_SQLTUNE.SET_TUNING_TASK_PARAMETER（task_name =&gt;'SYS_AUTO_SQL_TUNING_TASK'，参数=&gt; <span class="italic">parameter_name</span> ，value =&gt; <span class="italic">value</span> ）;结束; /</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-8B77491E-9E9A-4E44-9F2A-DFA164C4B074__GUID-AEB6182C-2F7C-4060-8D87-6D1082635483">
                           <p class="titleinexample">示例24-3设置SQL调整任务参数</p>
                           <p>以下PL / SQL块将时间限制设置为20分钟，并自动实现SQL配置文件并为这些配置文件设置限制：</p><pre class="pre codeblock"><code>BEGIN DBMS_SQLTUNE.SET_TUNING_TASK_PARAMETER（'SYS_AUTO_SQL_TUNING_TASK'，'LOCAL_TIME_LIMIT'，1200）; DBMS_SQLTUNE.SET_TUNING_TASK_PARAMETER（'SYS_AUTO_SQL_TUNING_TASK'，'ACCEPT_SQL_PROFILES'，'true'）; DBMS_SQLTUNE.SET_TUNING_TASK_PARAMETER（'SYS_AUTO_SQL_TUNING_TASK'，'MAX_SQL_PROFILES_PER_EXEC'，50）; DBMS_SQLTUNE.SET_TUNING_TASK_PARAMETER（'SYS_AUTO_SQL_TUNING_TASK'，'MAX_AUTO_SQL_PROFILES'，10002）;结束; /</code></pre></div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-8B77491E-9E9A-4E44-9F2A-DFA164C4B074__GUID-996928BE-49B9-46C8-8756-F4E44694E648">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../arpls/DBMS_SQLTUNE.html#ARPLS68398" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考，</span></a>以获取<code class="codeph">DBMS_AUTO_SQLTUNE</code>完整参考信息</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-E621B81C-844C-43A1-B81B-75BF0159FBEF" title="您可以使用Cloud Control或命令行配置自动SQL调整任务。">配置自动SQL调整任务</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL575"></a><div class="props_rev_3"><a id="GUID-C8264D23-0A39-4E1F-9603-01137CCB91A8" name="GUID-C8264D23-0A39-4E1F-9603-01137CCB91A8"></a><h4 id="TGSQL-GUID-C8264D23-0A39-4E1F-9603-01137CCB91A8" class="sect4"><span class="enumeration_section">24.2.4</span>查看自动SQL调整报告</h4>
                  <div>
                     <p>在运行自动SQL调整任务期间或之后的任何时间，您都可以查看调整报告。</p>
                     <div class="section">
                        <p>调整报告包含有关自动SQL调整任务的所有执行的信息。根据报告中包含的部分，您可以在以下部分中查看信息：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>一般信息</p>
                              <p>本节包含自动SQL调优任务的高级描述，包括有关为报告提供的输入，在维护期间调整的SQL语句数以及创建的SQL配置文件数的信息。</p>
                           </li>
                           <li>
                              <p>摘要</p>
                              <p>本节列出了在维护窗口期间调整的SQL语句（通过其SQL标识符）以及每个SQL配置文件的估计收益，或者在使用SQL配置文件执行SQL语句的测试执行后的执行统计信息。</p>
                           </li>
                           <li>
                              <p>调整结果</p>
                              <p>本节包含有关SQL Tuning Advisor分析的每个SQL语句的以下信息：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>所有与每个SQL语句相关的发现</p>
                                 </li>
                                 <li>
                                    <p>是否在数据库上实现了配置文件，以及原因</p>
                                 </li>
                                 <li>
                                    <p>是否当前在数据库上启用了SQL配置文件</p>
                                 </li>
                                 <li>
                                    <p>测试SQL配置文件时捕获的详细执行统计信息</p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>解释计划</p>
                              <p>本节显示SQL Tuning Advisor分析的每个SQL语句使用的旧的和新的解释计划。</p>
                           </li>
                           <li>
                              <p>错误</p>
                              <p>本节列出了自动SQL调优任务遇到的所有错误。</p>
                           </li>
                        </ul>
                        <p>本节包含以下主题：</p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-C5A11E6F-9A8E-4061-BFED-39EA51C92AF7">使用命令行查看自动SQL调整报告</a><br>要将SQL调整报告生成为<code class="codeph">CLOB</code> ，请执行<code class="codeph">DBMS_SQLTUNE.REPORT_AUTO_TUNING_TASK</code>函数。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-87D3AA10-60CE-4F5B-879B-B2E851874B83" title="当您的目标是主动识别SQL性能问题时，将SQL Tuning Advisor配置为自动化任务是一个简单的解决方案。该任务处理来自AWR的选定高负载SQL语句，这些语句有资格作为调优候选者。">管理自动SQL调整任务</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL94960"></a><a id="TGSQL576"></a><div class="props_rev_3"><a id="GUID-C5A11E6F-9A8E-4061-BFED-39EA51C92AF7" name="GUID-C5A11E6F-9A8E-4061-BFED-39EA51C92AF7"></a><h5 id="TGSQL-GUID-C5A11E6F-9A8E-4061-BFED-39EA51C92AF7" class="sect5"><span class="enumeration_section">24.2.4.1</span>使用命令行查看自动SQL调整报告</h5>
                     <div>
                        <p>要将SQL调整报告生成为<code class="codeph">CLOB</code> ，请执行<code class="codeph">DBMS_SQLTUNE.REPORT_AUTO_TUNING_TASK</code>函数。
                        </p>
                        <div class="section">
                           <p>您可以将<code class="codeph">CLOB</code>存储在变量中，然后打印变量以查看报告。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-C5A11E6F-9A8E-4061-BFED-39EA51C92AF7__GUID-0B23E420-F27C-47A6-8CA7-0AB49F28C44B">假设</p>
                           <p>本节假定您要显示在最近执行中分析的所有SQL语句，包括未实现的建议。</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-C5A11E6F-9A8E-4061-BFED-39EA51C92AF7__GUID-CFC8EF82-355E-44B0-AF3C-284DC83A7974">要创建和访问Automatic SQL Tuning Advisor报告，请执行以下操作：</p>
                           <ol>
                              <li>
                                 <p>使用管理员权限将SQL * Plus连接到数据库，然后执行<code class="codeph">DBMS_SQLTUNE.REPORT_AUTO_TUNING_TASK</code>函数。
                                 </p>
                                 <p>以下示例生成一个文本报告，以显示在最近执行中分析的所有SQL语句，包括未实现的建议：</p><pre class="pre codeblock"><code>VARIABLE my_rept CLOB; BEGIN：my_rept：= DBMS_SQLTUNE.REPORT_AUTO_TUNING_TASK（begin_exec =&gt; NULL，end_exec =&gt; NULL，type =&gt;'TEXT'，level =&gt;'TYPICAL'，section =&gt;'ALL'，object_id =&gt; NULL，result_limit =&gt; NULL） ;结束; / PRINT：my_rept</code></pre></li>
                              <li>
                                 <p>阅读常规信息部分，了解调优执行的概述。</p>
                                 <p>以下示例显示自动SQL调优任务在7分钟内分析了17个SQL语句：</p><pre class="pre codeblock"><code>MY_REPT ------------------------------------------------- --------------------------一般信息部分--------------------- -------------------------------------------------- ----调整任务名称：SYS_AUTO_SQL_TUNING_TASK调整任务所有者：SYS工作负载类型：自动高负载SQL工作负载执行计数：6当前执行：EXEC_170执行类型：TUNE SQL范围：全面的全局时间限制（秒）：3600 Per-SQL时间限制（秒）：1200完成状态：已完成开始于：04/16/2012 10:00:00已完成时间：04/16/2012 10:07:11候选SQL数量：17累计经过的SQL时间（s ）：8</code></pre></li>
                              <li>
                                 <p>寻找结果和建议。</p>
                                 <p>如果SQL Tuning Advisor提出建议，那么权衡接受它的优缺点。</p>
                                 <p>以下示例显示SQL Tuning Advisor发现了一个可能比现有计划更好的语句计划。顾问建议实现SQL配置文件。</p><pre class="pre codeblock"><code>-------------------------------------------------- -------------------------带有最大（配置文件/索引）好处的查找结果的SQL，对象ID ---------- -------------------------------------------------- --------------- ob ID SQL ID统计资料（利益）指数（利益）重组------ -------------  - -------- ---------------- -------------- ----------- 82 dqjcc345dd4ak 58.03％72 51bbkcd9zwsjw 2 81 03rxjf8gb18jg ------------------------------------------ --------------------------------- DETAILS SECTION --------------- -------------------------------------------------- ----------包含Max（Profile / Index）效益的结果的陈述，对象ID ------------------------- --------------------------------------------------对象ID：82架构名称：DBA1 SQL ID：dqjcc345dd4ak SQL文本：SELECT status FROM dba_autotask_client WHERE client_name =：1 -------------------------- -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  - - 发现部分（1发现）--------------------- -------------------------------------------------- ---- 1- SQL配置文件查找（参见下面的解释计划部分）---------------------------------- ----------------------为此声明找到了一个可能更好的执行计划。由于验证的收益太低，因此未自动创建SQL配置文件。建议（估计收益：58.03％）------------------------------------------ - 考虑接受推荐的SQL配置文件。执行dbms_sqltune.accept_sql_profile（task_name =&gt;'SYS_AUTO_SQL_TUNING_TASK'，object_id =&gt; 82，替换=&gt; TRUE）;验证结果------------------通过执行其计划和原始计划并测量其各自的执行统计信息来测试SQL配置文件。如果另一个计划可以在更短的时间内完成，那么该计划可能只是部分执行。原始计划与SQL配置文件％改进------------- ---------------- ----------完成状态：完成完成经过时间（us）：26963 8829 67.25％CPU时间（us）：27000 9000 66.66％用户I / O时间（us）：25 14 44％缓冲区获取：905 380 58.01％物理读取请求：0 0物理写入请求：0 0物理读取字节数：0 0物理写入字节数：7372 7372 0％已处理的行数：1 1提取：1 1执行次数：1 1注意事项----- 1。首先执行原始计划以加热缓冲区缓存。2。原计划的统计数据在接下来的9次执行中取平均值。3。首先执行SQL配置文件计划以加热缓冲区缓存。4。SQL配置文件计划的统计信息在接下来的9次执行中取平均值。</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-C5A11E6F-9A8E-4061-BFED-39EA51C92AF7__GUID-917D8AE7-A66F-4B02-BFFF-83EA25C9C777">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../arpls/DBMS_AUTO_SQLTUNE.html#ARPLS73163" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以获取完整的参考信息。
                           </p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-C8264D23-0A39-4E1F-9603-01137CCB91A8" title="在运行自动SQL调整任务期间或之后的任何时间，您都可以查看调整报告。">查看自动SQL调整报告</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div><a id="TGSQL577"></a><div class="props_rev_3"><a id="GUID-F5494CD1-52BB-478E-BB36-17104B36B0FE" name="GUID-F5494CD1-52BB-478E-BB36-17104B36B0FE"></a><h3 id="TGSQL-GUID-F5494CD1-52BB-478E-BB36-17104B36B0FE" class="sect3"><span class="enumeration_section">24.3</span>按需运行SQL Tuning Advisor</h3>
               <div>
                  <p>您可以按需运行SQL Tuning Advisor。</p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-85C2BEA4-4483-477F-88CD-ED6962075FAC">关于按需SQL调整</a><br>按需SQL调整定义为SQL Tuning Advisor的任何调用，它不是由自动SQL调整任务产生的。
                     </li>
                     <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-36E17A9F-7912-483D-A10F-7748BBB924E0">创建SQL调整任务</a><br>要创建SQL调优任务，请执行<code class="codeph">DBMS_SQLTUNE.CREATE_TUNING_TASK</code>函数。
                     </li>
                     <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-4CFA6019-BB0D-4CC7-A281-42E13FFABFD9">配置SQL调整任务</a><br>要在创建调整任务后更改调整任务的参数，请执行<code class="codeph">DBMS_SQLTUNE.SET_TUNING_TASK_PARAMETER</code>函数。
                     </li>
                     <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-01A224F2-043E-4E0E-A3A1-5FF21E264C47">执行SQL调整任务</a><br>要执行SQL调整任务，请使用<code class="codeph">DBMS_SQLTUNE.EXECUTE_TUNING_TASK</code>函数。最重要的参数是<code class="codeph">task_name</code> 。
                     </li>
                     <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-893679CA-9998-4A5F-B4E4-C32AB219CD46">监视SQL调整任务</a><br>在Cloud Control中创建SQL调整任务时，不需要单独的监视步骤。Cloud Control会自动显示状态页面。
                     </li>
                     <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-F6C1B6A7-AE67-4FED-B376-F10F02924B0A">显示SQL调整任务的结果</a><br>要报告调优任务的结果，请使用<code class="codeph">DBMS_SQLTUNE.REPORT_TUNING_TASK</code>函数。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-8E1A39CB-A491-4254-8B31-9B1DF7B52AA1" title="使用SQL Tuning Advisor获取有关提高高负载SQL语句性能的建议，并通过仅执行最佳计划来防止回归。">使用SQL Tuning Advisor分析SQL</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL578"></a><div class="props_rev_3"><a id="GUID-85C2BEA4-4483-477F-88CD-ED6962075FAC" name="GUID-85C2BEA4-4483-477F-88CD-ED6962075FAC"></a><h4 id="TGSQL-GUID-85C2BEA4-4483-477F-88CD-ED6962075FAC" class="sect4"><span class="enumeration_section">24.3.1</span>关于按需SQL调整</h4>
                  <div>
                     <p>按需SQL调整定义为SQL Tuning Advisor的任何调用，它不是由自动SQL调整任务产生的。</p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-E4679326-F34B-417E-A95B-2B79425581D8">按需SQL调整的目的</a><br>通常，您可以调用SQL Tuning Advisor以主动运行ADDM，或者在用户抱怨性能欠佳时自动调整SQL语句。
                        </li>
                        <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-AC9AB5F2-9B62-4228-A7F2-11FF1EB75938">用于按需SQL调整的用户界面</a><br>用于手动运行SQL Tuning Advisor的推荐用户界面是Cloud Control。
                        </li>
                        <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-35C7B77F-5CB1-45EC-A48D-10C1E47CC7BE">按需SQL调整中的基本任务</a><br>本节介绍使用<code class="codeph">DBMS_SQLTUNE</code>包运行SQL Tuning Advisor的基本任务。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-F5494CD1-52BB-478E-BB36-17104B36B0FE" title="您可以按需运行SQL Tuning Advisor。">按需运行SQL Tuning Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL579"></a><div class="props_rev_3"><a id="GUID-E4679326-F34B-417E-A95B-2B79425581D8" name="GUID-E4679326-F34B-417E-A95B-2B79425581D8"></a><h5 id="TGSQL-GUID-E4679326-F34B-417E-A95B-2B79425581D8" class="sect5"><span class="enumeration_section">24.3.1.1</span>按需SQL调整的目的</h5>
                     <div>
                        <p>通常，您可以调用SQL Tuning Advisor以主动运行ADDM，或者在用户抱怨性能欠佳时自动调整SQL语句。</p>
                        <p>在主动和被动方案中，运行SQL Tuning Advisor通常是解决意外SQL性能问题的最快方法。</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-85C2BEA4-4483-477F-88CD-ED6962075FAC" title="按需SQL调整定义为SQL Tuning Advisor的任何调用，它不是由自动SQL调整任务产生的。">关于按需SQL调整</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL580"></a><div class="props_rev_3"><a id="GUID-AC9AB5F2-9B62-4228-A7F2-11FF1EB75938" name="GUID-AC9AB5F2-9B62-4228-A7F2-11FF1EB75938"></a><h5 id="TGSQL-GUID-AC9AB5F2-9B62-4228-A7F2-11FF1EB75938" class="sect5"><span class="enumeration_section">24.3.1.2</span>按需SQL调整的用户界面</h5>
                     <div>
                        <p>用于手动运行SQL Tuning Advisor的推荐用户界面是Cloud Control。</p>
                        <p>本节包含以下主题：</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-B7352680-90B8-4DD9-B041-EBADC3CD4926">使用Cloud Control访问SQL Tuning Advisor</a><br>自动数据库诊断监视器（ADDM）自动识别高负载SQL语句。如果ADDM识别出此类语句，则单击“建议详细信息”页面上的<span class="bold">“计划/运行SQL调优顾问</span> ”以运行SQL Tuning Advisor。
                           </li>
                           <li class="ulchildlink"><a href="sql-tuning-advisor.html#GUID-4BB11709-E6D9-496F-AF81-A4E4E2A70E24">按需SQL调整的命令行界面</a><br>如果Cloud Control不可用，则可以使用<code class="codeph">DBMS_SQLTUNE</code>包中的过程运行SQL Tuning Advisor。
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-85C2BEA4-4483-477F-88CD-ED6962075FAC" title="按需SQL调整定义为SQL Tuning Advisor的任何调用，它不是由自动SQL调整任务产生的。">关于按需SQL调整</a></p>
                           </div>
                        </div>
                     </div>
                     <a id="TGSQL581"></a><div class="props_rev_3"><a id="GUID-B7352680-90B8-4DD9-B041-EBADC3CD4926" name="GUID-B7352680-90B8-4DD9-B041-EBADC3CD4926"></a><h6 id="TGSQL-GUID-B7352680-90B8-4DD9-B041-EBADC3CD4926" class="sect6"><span class="enumeration_section">24.3.1.2.1</span>使用Cloud Control访问SQL Tuning Advisor</h6>
                        <div>
                           <p>自动数据库诊断监视器（ADDM）自动识别高负载SQL语句。如果ADDM识别出此类语句，则单击“建议详细信息”页面上的<span class="bold">“计划/运行SQL调优顾问</span> ”以运行SQL Tuning Advisor。
                           </p>
                           <div class="section">
                              <p class="subhead3" id="GUID-B7352680-90B8-4DD9-B041-EBADC3CD4926__GUID-C4010BA3-7C34-46AA-A53C-7E61C1A83FE6">使用SQL Tuning Advisor手动调整SQL语句：</p>
                              <ol>
                                 <li>
                                    <p>使用适当的凭据登录Cloud Control。</p>
                                 </li>
                                 <li>
                                    <p>在“ <span class="bold">目标”</span>菜单下，选择“ <span class="bold">数据库”</span> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p>在数据库目标列表中，选择要管理的Oracle数据库实例的目标。</p>
                                 </li>
                                 <li>
                                    <p>如果系统提示您输入数据库凭据，请输入您要执行的任务所需的最低凭据。</p>
                                 </li>
                                 <li>
                                    <p>从<span class="bold">Performance</span>菜单中，单击<span class="bold">SQL</span> ，然后单击<span class="bold">SQL Tuning Advisor</span> 。
                                    </p>
                                    <p>将出现Schedule SQL Tuning Advisor页面。</p>
                                    <div class="figure" id="GUID-B7352680-90B8-4DD9-B041-EBADC3CD4926__GUID-B404EF74-2F2E-4C60-94AA-225001C4D816"><img src="img/sql_tuning_advisor_empty.gif" alt="下面是sql_tuning_advisor_empty.gif的描述" title="下面是sql_tuning_advisor_empty.gif的描述" longdesc="img_text/sql_tuning_advisor_empty.html"><br><a href="img_text/sql_tuning_advisor_empty.html">插图说明sql_tuning_advisor_empty.gif</a></div>
                                    <!-- class="figure" -->
                                 </li>
                              </ol>
                           </div>
                           <!-- class="section" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-B7352680-90B8-4DD9-B041-EBADC3CD4926__GUID-D287B6CF-3856-4577-832F-0AFED2A5C8D5">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="../tdppt/tuning-sql-statements.html#TDPPT161" target="_blank"><span><cite>Oracle Database 2 Day +性能调优指南</cite></span></a> ，了解如何使用Cloud Control配置和运行SQL Tuning Advisor。
                              </p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-AC9AB5F2-9B62-4228-A7F2-11FF1EB75938" title="用于手动运行SQL Tuning Advisor的推荐用户界面是Cloud Control。">按需SQL调整的用户界面</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL582"></a><div class="props_rev_3"><a id="GUID-4BB11709-E6D9-496F-AF81-A4E4E2A70E24" name="GUID-4BB11709-E6D9-496F-AF81-A4E4E2A70E24"></a><h6 id="TGSQL-GUID-4BB11709-E6D9-496F-AF81-A4E4E2A70E24" class="sect6"><span class="enumeration_section">24.3.1.2.2</span>按需SQL调整的命令行界面</h6>
                        <div>
                           <p>如果Cloud Control不可用，则可以使用<code class="codeph">DBMS_SQLTUNE</code>包中的过程运行SQL Tuning Advisor。
                           </p>
                           <div class="section">
                              <p>要使用API，用户必须具有<code class="codeph">ADVISOR</code>权限。
                              </p>
                           </div>
                           <!-- class="section" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-4BB11709-E6D9-496F-AF81-A4E4E2A70E24__GUID-31C56DD0-1FD4-474E-B96C-01FAEB857691">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="../arpls/DBMS_SQLTUNE.html#ARPLS220" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以获取完整的参考信息</p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-AC9AB5F2-9B62-4228-A7F2-11FF1EB75938" title="用于手动运行SQL Tuning Advisor的推荐用户界面是Cloud Control。">按需SQL调整的用户界面</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div><a id="TGSQL584"></a><a id="TGSQL583"></a><div class="props_rev_3"><a id="GUID-35C7B77F-5CB1-45EC-A48D-10C1E47CC7BE" name="GUID-35C7B77F-5CB1-45EC-A48D-10C1E47CC7BE"></a><h5 id="TGSQL-GUID-35C7B77F-5CB1-45EC-A48D-10C1E47CC7BE" class="sect5"><span class="enumeration_section">24.3.1.3</span>按需SQL调整中的基本任务</h5>
                     <div>
                        <p>本节介绍使用<code class="codeph">DBMS_SQLTUNE</code>包运行SQL Tuning Advisor的基本任务。
                        </p>
                        <p>下图显示了使用PL / SQL API时的基本工作流程。</p>
                        <div class="figure" id="GUID-35C7B77F-5CB1-45EC-A48D-10C1E47CC7BE__CBBIFFBI">
                           <p class="titleinfigure">图24-12 SQL Tuning Advisor API</p><img src="img/tgsql_vm_029.png" alt="下面是图24-12的描述" title="下面是图24-12的描述" longdesc="img_text/tgsql_vm_029.html"><br><a href="img_text/tgsql_vm_029.html">“图24-12 SQL Tuning Advisor API”的说明</a></div>
                        <!-- class="figure" -->
                        <p><a href="sql-tuning-advisor.html#GUID-35C7B77F-5CB1-45EC-A48D-10C1E47CC7BE__CBBIFFBI">如图24-12</a>所示，基本步骤如下：</p>
                        <ol>
                           <li>
                              <p>准备或创建SQL Tuning Advisor的输入。输入可以是：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>单个SQL语句的文本</p>
                                 </li>
                                 <li>
                                    <p>包含一个或多个语句的SQL调优集</p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>创建SQL调优任务。</p>
                              <p>请参阅<span class="q">“ <a href="sql-tuning-advisor.html#GUID-36E17A9F-7912-483D-A10F-7748BBB924E0" title="要创建SQL调优任务，请执行DBMS_SQLTUNE.CREATE_TUNING_TASK函数。">创建SQL调整任务</a> ”</span> 。
                              </p>
                           </li>
                           <li>
                              <p>（可选）配置您创建的SQL调整任务。</p>
                              <p>请参阅<span class="q">“ <a href="sql-tuning-advisor.html#GUID-4CFA6019-BB0D-4CC7-A281-42E13FFABFD9" title="要在创建调整任务后更改调整任务的参数，请执行DBMS_SQLTUNE.SET_TUNING_TASK_PARAMETER函数。">配置SQL调整任务</a> ”</span> 。
                              </p>
                           </li>
                           <li>
                              <p>执行SQL调优任务。</p>
                              <p>请参阅<span class="q">“ <a href="sql-tuning-advisor.html#GUID-01A224F2-043E-4E0E-A3A1-5FF21E264C47" title="要执行SQL调整任务，请使用DBMS_SQLTUNE.EXECUTE_TUNING_TASK函数。最重要的参数是task_name。">执行SQL调整任务</a> ”</span> 。
                              </p>
                           </li>
                           <li>
                              <p>（可选）检查SQL调整任务的状态或进度。</p>
                              <p><span class="q">“ <a href="sql-tuning-advisor.html#GUID-893679CA-9998-4A5F-B4E4-C32AB219CD46" title="在Cloud Control中创建SQL调整任务时，不需要单独的监视步骤。Cloud Control会自动显示状态页面。">监视SQL调优任务</a> ”</span> 。
                              </p>
                           </li>
                           <li>
                              <p>显示SQL调整任务的结果。</p>
                              <p><span class="q">“ <a href="sql-tuning-advisor.html#GUID-F6C1B6A7-AE67-4FED-B376-F10F02924B0A" title="要报告调优任务的结果，请使用DBMS_SQLTUNE.REPORT_TUNING_TASK函数。">显示SQL调整任务的结果</a> ”</span> 。
                              </p>
                           </li>
                           <li>
                              <p>酌情实施建议。</p>
                           </li>
                        </ol>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-35C7B77F-5CB1-45EC-A48D-10C1E47CC7BE__GUID-5620E95C-B8A4-4DC6-99AA-6760112433A1">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../tdppt/tuning-sql-statements.html#TDPPT161" target="_blank"><span><cite>Oracle Database 2 Day +性能调优指南</cite></span></a> ，了解如何使用Cloud Control调整SQL</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-85C2BEA4-4483-477F-88CD-ED6962075FAC" title="按需SQL调整定义为SQL Tuning Advisor的任何调用，它不是由自动SQL调整任务产生的。">关于按需SQL调整</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL94961"></a><a id="TGSQL585"></a><div class="props_rev_3"><a id="GUID-36E17A9F-7912-483D-A10F-7748BBB924E0" name="GUID-36E17A9F-7912-483D-A10F-7748BBB924E0"></a><h4 id="TGSQL-GUID-36E17A9F-7912-483D-A10F-7748BBB924E0" class="sect4"><span class="enumeration_section">24.3.2</span>创建SQL调整任务</h4>
                  <div>
                     <p>要创建SQL调优任务，请执行<code class="codeph">DBMS_SQLTUNE.CREATE_TUNING_TASK</code>函数。
                     </p>
                     <div class="section">
                        <p>您可以从以下任何一项创建调整任务：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>单个SQL语句的文本</p>
                           </li>
                           <li>
                              <p>包含多个语句的SQL调优集</p>
                           </li>
                           <li>
                              <p>SQL标识从共享SQL区域中选择的SQL语句</p>
                           </li>
                           <li>
                              <p>从AWR通过SQL标识符选择的SQL语句</p>
                           </li>
                        </ul>
                        <p><code class="codeph">scope</code>参数是此函数最重要的参数之一。您可以将此参数设置为以下值：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">有限</code></p>
                              <p>SQL Tuning Advisor基于统计检查，访问路径分析和SQL结构分析生成建议。不生成SQL配置文件建议。</p>
                           </li>
                           <li>
                              <p><code class="codeph">全面</code></p>
                              <p>SQL Tuning Advisor执行在有限范围内执行的所有分析以及SQL分析。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-36E17A9F-7912-483D-A10F-7748BBB924E0__GUID-153D69B9-BE11-4BAC-930D-AAA899548A23">假设</p>
                        <p>本教程假设以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您希望以具有<code class="codeph">ADVISOR</code>权限的用户<code class="codeph">hr</code>进行调整。
                              </p>
                           </li>
                           <li>
                              <p>您想调整以下查询：</p><pre class="pre codeblock"><code>SELECT / * + ORDERED * / * FROM employees e，locations l，departments d WHERE e.department_id = d.department_id AND l.location_id = d.location_id AND e.employee_id &lt;：bnd;</code></pre></li>
                           <li>
                              <p>您希望将绑定变量<code class="codeph">100</code>传递给前面的查询。
                              </p>
                           </li>
                           <li>
                              <p>您希望SQL Tuning Advisor执行SQL分析。</p>
                           </li>
                           <li>
                              <p>您希望任务运行时间不超过60秒。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-36E17A9F-7912-483D-A10F-7748BBB924E0__GUID-F5DC1C60-9D83-49EF-ABF8-49AB31B4EA7D">要创建SQL调整任务：</p>
                        <ol>
                           <li>
                              <p>使用适当的权限将SQL * Plus连接到数据库，然后运行<code class="codeph">DBMS_SQLTUNE.CREATE_TUNING_TASK</code>函数。
                              </p>
                              <p>例如，执行以下PL / SQL程序：</p><pre class="pre codeblock"><code>DECLARE my_task_name VARCHAR2（30）; my_sqltext CLOB; BEGIN my_sqltext：='SELECT / * + ORDERED * / *'|| '来自员工e，地点l，部门d'|| 'WHERE e.department_id = d.department_id AND'|| 'l.location_id = d.location_id AND'|| 'e.employee_id &lt;：bnd'; my_task_name：= DBMS_SQLTUNE.CREATE_TUNING_TASK（sql_text =&gt; my_sqltext，bind_list =&gt; sql_binds（anydata。ConvertNumber（100）），user_name =&gt;'HR'，scope =&gt;'COMPREHENSIVE'，time_limit =&gt; 60，task_name =&gt;'STA_SPECIFIC_EMP_TASK'，description =&gt;'调整对指定员工的查询的任务'）;结束; /</code></pre></li>
                           <li>
                              <p>（可选）查询任务的状态。</p>
                              <p>以下示例查询当前用户拥有的所有任务的状态，在此示例中为<code class="codeph">hr</code> ：</p><pre class="pre codeblock"><code>COL TASK_ID FORMAT 999999 COL TASK_NAME FORMAT a25 COL STATUS_MESSAGE FORMAT a33从USER_ADVISOR_LOG中选择TASK_ID，TASK_NAME，STATUS，STATUS_MESSAGE;</code></pre><p>示例输出显示如下：</p><pre class="pre codeblock"><code>TASK_ID TASK_NAME状态STATUS_MESSAGE ------- ------------------------- ----------- --- ----------- 884 STA_SPECIFIC_EMP_TASK INITIAL</code></pre><p>在前面的输出中， <code class="codeph">INITIAL</code>状态表示任务尚未开始执行。
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-36E17A9F-7912-483D-A10F-7748BBB924E0__GUID-C60F3B45-4155-47D9-95A7-BF70E43A82AC">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS68414" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_SQLTUNE.CREATE_TUNING_TASK</code>函数</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-F5494CD1-52BB-478E-BB36-17104B36B0FE" title="您可以按需运行SQL Tuning Advisor。">按需运行SQL Tuning Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94962"></a><a id="TGSQL586"></a><div class="props_rev_3"><a id="GUID-4CFA6019-BB0D-4CC7-A281-42E13FFABFD9" name="GUID-4CFA6019-BB0D-4CC7-A281-42E13FFABFD9"></a><h4 id="TGSQL-GUID-4CFA6019-BB0D-4CC7-A281-42E13FFABFD9" class="sect4"><span class="enumeration_section">24.3.3</span>配置SQL调优任务</h4>
                  <div>
                     <p>要在创建调整任务后更改调整任务的参数，请执行<code class="codeph">DBMS_SQLTUNE.SET_TUNING_TASK_PARAMETER</code>函数。
                     </p>
                     <div class="p">
                        <p>本教程假设以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您希望使用已授予<code class="codeph">ADVISOR</code>权限的用户帐户<code class="codeph">hr</code>进行调整。
                              </p>
                           </li>
                           <li>
                              <p>您想要调整在<span class="q">“ <a href="sql-tuning-advisor.html#GUID-36E17A9F-7912-483D-A10F-7748BBB924E0" title="To create a SQL tuning task execute the DBMS_SQLTUNE.CREATE_TUNING_TASK function.">创建SQL调整任务</a> ”中<a href="sql-tuning-advisor.html#GUID-36E17A9F-7912-483D-A10F-7748BBB924E0" title="要创建SQL调优任务，请执行DBMS_SQLTUNE.CREATE_TUNING_TASK函数。">创建</a></span>的<code class="codeph">STA_SPECIFIC_EMP_TASK</code> 。
                              </p>
                           </li>
                           <li>
                              <p>您希望将SQL调整任务可以运行的最长时间更改为300秒。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-4CFA6019-BB0D-4CC7-A281-42E13FFABFD9__GUID-4E9F3687-2096-463D-91FC-225A7EB7B1EC">要配置SQL调优任务：</p>
                        <ol>
                           <li>
                              <p>使用适当的权限将SQL * Plus连接到数据库，然后运行<code class="codeph">DBMS_SQLTUNE.SET_TUNING_TASK_PARAMETER</code>函数。
                              </p>
                              <p>例如，执行以下PL / SQL程序将调整任务的时间限制更改为300秒：</p><pre class="pre codeblock"><code>BEGIN DBMS_SQLTUNE.SET_TUNING_TASK_PARAMETER（task_name =&gt;'STA_SPECIFIC_EMP_TASK'，参数=&gt;'TIME_LIMIT'，值=&gt; 300）;结束; /</code></pre></li>
                           <li>
                              <p>（可选）验证任务参数是否已更改。</p>
                              <p>以下示例查询任务<code class="codeph">STA_SPECIFIC_EMP_TASK</code>中所有已使用参数的值：</p><pre class="pre codeblock"><code>COL PARAMETER_NAME FORMAT a25 COL VALUE FORMAT a15 SELECT PARAMETER_NAME，PARAMETER_VALUE为“VALUE”来自USER_ADVISOR_PARAMETERS，其中TASK_NAME ='STA_SPECIFIC_EMP_TASK'和PARAMETER_VALUE！='未使用'订阅PARAMETER_NAME;</code></pre><p>示例输出显示如下：</p><pre class="pre codeblock"><code>PARAMETER_NAME VALUE ------------------------- --------------- DAYS_TO_EXPIRE 30 DEFAULT_EXECUTION_TYPE TUNE SQL EXECUTION_DAYS_TO_EXPIRE UNLIMITED CHINESEING信息模式综合SQL_LIMIT -1 SQL_PERCENTAGE 1 TARGET_OBJECTS 1 TEST_EXECUTE AUTO TIME_LIMIT 300</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-4CFA6019-BB0D-4CC7-A281-42E13FFABFD9__GUID-D8499560-B559-4924-B0B7-5C1011BB6453">
                        <p class="titleinexample">示例24-4使用数据库链接调整备用数据库工作负载</p>
                        <p>从<span>Oracle Database 12c</span>第2版（12.2）开始，您可以通过在<code class="codeph">database_link_to</code>参数中指定数据库链接来调整备用数据库工作负载。出于安全原因，Oracle建议使用专用数据库链接。该链接必须由<code class="codeph">SYS</code>拥有，并由特权用户访问。Oracle数据库包括名为<code class="codeph">SYS$UMF</code>的默认特权用户。</p>
                        <p>以下程序在备用数据库上发布，显示了<code class="codeph">table1</code>查询的示例SQL调优会话。<code class="codeph">database_link_to</code>参数指定备用数据库到主数据库链接的名称。
                        </p><pre class="pre codeblock"><code>VARIABLE tname VARCHAR2（30）; VARIABLE查询VARCHAR2（500）; EXEC：tname：='my_task'; EXEC：query：='SELECT / * + FULL（t）* / col1 FROM table1 t WHERE col1 = 9000'; BEGIN：tname：= DBMS_SQLTUNE.CREATE_TUNING_TASK（sql_text =&gt;：query，task_name =&gt;：tname，database_link_to =&gt;'lnk_to_pri'）;结束; / EXEC DBMS_SQLTUNE.EXECUTE_TUNING_TASK（：tname）; SELECT DBMS_SQLTUNE.REPORT_TUNING_TASK（：tname）FROM DUAL; BEGIN DBMS_SQLTUNE.ACCEPT_SQL_PROFILE（task_name =&gt;：tname，name =&gt;'prof'，task_owner =&gt;'SYS'，replace =&gt; TRUE，database_link_to =&gt;'lnk_to_pri'）;结束; /</code></pre><p>请注意，备用数据库不支持<code class="codeph">CREATE_TUNING_TASK</code>的<code class="codeph">bind_list</code>参数。
                        </p>
                     </div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-4CFA6019-BB0D-4CC7-A281-42E13FFABFD9__GUID-A3A54366-B49F-41F8-9FF2-A3048149B8AC">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="sql-tuning-advisor.html#GUID-642877C5-40BE-4736-8302-17F849933038" title="SQL Tuning Advisor可以分析本地数据库或远程数据库上的工作负载。">本地和远程SQL调优</a> ”</span></p>
                           </li>
                           <li>
                              <p><a href="../sbydb/managing-oracle-data-guard-physical-standby-databases.html#SBYDB-GUID-07CB190C-C248-4FF5-AB64-EAA9C6D42677" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a> ，了解如何在Data Guard环境中执行远程调整</p>
                           </li>
                           <li>
                              <p><code class="codeph">DBMS_SQLTUNE.SET_TUNING_TASK_PARAMETER</code>语法和语义的<a href="../arpls/DBMS_SQLTUNE.html#ARPLS68462" target="_blank"><span><cite>Oracle数据库PL / SQL包和类型参考</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-F5494CD1-52BB-478E-BB36-17104B36B0FE" title="您可以按需运行SQL Tuning Advisor。">按需运行SQL Tuning Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94963"></a><a id="TGSQL587"></a><div class="props_rev_3"><a id="GUID-01A224F2-043E-4E0E-A3A1-5FF21E264C47" name="GUID-01A224F2-043E-4E0E-A3A1-5FF21E264C47"></a><h4 id="TGSQL-GUID-01A224F2-043E-4E0E-A3A1-5FF21E264C47" class="sect4"><span class="enumeration_section">24.3.4</span>执行SQL调整任务</h4>
                  <div>
                     <p>要执行SQL调整任务，请使用<code class="codeph">DBMS_SQLTUNE.EXECUTE_TUNING_TASK</code>函数。最重要的参数是<code class="codeph">task_name</code> 。
                     </p>
                     <div class="section">
                        <div class="infoboxnote" id="GUID-01A224F2-043E-4E0E-A3A1-5FF21E264C47__GUID-BD1FF202-4761-426A-B482-4303460CE0CE">
                           <p class="notep1">注意：</p>
                           <p>您还可以使用<code class="codeph">EXECUTE_TUNING_TASK</code> API执行自动调整任务<code class="codeph">SYS_AUTO_SQL_TUNING_TASK</code> 。 SQL Tuning Advisor执行与自动运行时相同的分析和操作。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-01A224F2-043E-4E0E-A3A1-5FF21E264C47__GUID-43867B8F-D92B-46C0-910B-67D2746FE17B">假设</p>
                        <p>本教程假设以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您希望以具有<code class="codeph">ADVISOR</code>权限的用户<code class="codeph">hr</code>进行调整。
                              </p>
                           </li>
                           <li>
                              <p>您想要执行<span class="q">“ <a href="sql-tuning-advisor.html#GUID-36E17A9F-7912-483D-A10F-7748BBB924E0" title="To create a SQL tuning task execute the DBMS_SQLTUNE.CREATE_TUNING_TASK function.">创建SQL调整任务</a> ”中<a href="sql-tuning-advisor.html#GUID-36E17A9F-7912-483D-A10F-7748BBB924E0" title="要创建SQL调优任务，请执行DBMS_SQLTUNE.CREATE_TUNING_TASK函数。">创建</a></span>的<code class="codeph">STA_SPECIFIC_EMP_TASK</code> 。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-01A224F2-043E-4E0E-A3A1-5FF21E264C47__GUID-04C0537E-7738-40EE-942C-1193A888B436">要执行SQL调整任务：</p>
                        <ol>
                           <li>
                              <p>使用适当的权限将SQL * Plus连接到数据库，然后运行<code class="codeph">DBMS_SQLTUNE.EXECUTE_TUNING_TASK</code>函数。
                              </p>
                              <p>例如，执行以下PL / SQL程序：</p><pre class="pre codeblock"><code>BEGIN DBMS_SQLTUNE.EXECUTE_TUNING_TASK（task_name =&gt;'STA_SPECIFIC_EMP_TASK'）;结束; /</code></pre></li>
                           <li>
                              <p>（可选）查询任务的状态。</p>
                              <p>以下示例查询当前用户拥有的所有任务的状态，在此示例中为<code class="codeph">hr</code> ：</p><pre class="pre codeblock"><code>COL TASK_ID FORMAT 999999 COL TASK_NAME FORMAT a25 COL STATUS_MESSAGE FORMAT a33从USER_ADVISOR_LOG中选择TASK_ID，TASK_NAME，STATUS，STATUS_MESSAGE;</code></pre><p>示例输出显示如下：</p><pre class="pre codeblock"><code>TASK_ID TASK_NAME状态STATUS_MESSAGE ------- ------------------------- ----------- --- ----------- 884 STA_SPECIFIC_EMP_TASK已完成</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-01A224F2-043E-4E0E-A3A1-5FF21E264C47__GUID-C07C53B8-DCA4-47EB-A085-9B3FC87AAA10">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<code class="codeph">DBMS_SQLTUNE.EXECUTE_TUNING_TASK</code>函数的完整参考信息，请参阅<a href="../arpls/DBMS_SQLTUNE.html#ARPLS68424" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-F5494CD1-52BB-478E-BB36-17104B36B0FE" title="您可以按需运行SQL Tuning Advisor。">按需运行SQL Tuning Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL589"></a><a id="TGSQL94964"></a><a id="TGSQL588"></a><div class="props_rev_3"><a id="GUID-893679CA-9998-4A5F-B4E4-C32AB219CD46" name="GUID-893679CA-9998-4A5F-B4E4-C32AB219CD46"></a><h4 id="TGSQL-GUID-893679CA-9998-4A5F-B4E4-C32AB219CD46" class="sect4"><span class="enumeration_section">24.3.5</span>监视SQL调整任务</h4>
                  <div>
                     <p>在Cloud Control中创建SQL调整任务时，不需要单独的监视步骤。Cloud Control会自动显示状态页面。</p>
                     <div class="section">
                        <p>如果您不使用Cloud Control，则可以通过查询数据字典和动态性能视图来监视当前正在执行的SQL调优任务。下表描述了相关视图。</p>
                        <div class="tblformal" id="GUID-893679CA-9998-4A5F-B4E4-C32AB219CD46__CBBCIIJD">
                           <p class="titleintable">表24-3 DBMS_SQLTUNE.EXECUTE_TUNING_TASK参数</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_SQLTUNE.EXECUTE_TUNING_TASK参数" width="100%" border="1" summary="initialization parameters for task" frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="40%" id="d120532e7183">视图</th>
                                    <th align="left" valign="bottom" width="60%" id="d120532e7186">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="40%" id="d120532e7191" headers="d120532e7183 ">
                                       <p><code class="codeph">USER_ADVISOR_TASKS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d120532e7191 d120532e7186 ">
                                       <p>显示有关当前用户拥有的任务的信息。视图包含每个任务的一行。每个任务都有一个对所有者唯一的名称。任务名称只是信息性的，并且在任何其他名称空间中不会强制执行任何唯一性。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="40%" id="d120532e7199" headers="d120532e7183 ">
                                       <p><code class="codeph">V $ ADVISOR_PROGRESS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d120532e7199 d120532e7186 ">
                                       <p>显示有关顾问程序执行进度的信息。</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-893679CA-9998-4A5F-B4E4-C32AB219CD46__GUID-4BE75801-70F0-4C04-A46F-AE6AA06B8A9B">假设</p>
                        <p>本教程假设以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您调整为具有<code class="codeph">ADVISOR</code>权限的用户<code class="codeph">hr</code> 。
                              </p>
                           </li>
                           <li>
                              <p>您监视在<span class="q">“ <a href="sql-tuning-advisor.html#GUID-01A224F2-043E-4E0E-A3A1-5FF21E264C47" title="To execute a SQL tuning task, use the DBMS_SQLTUNE.EXECUTE_TUNING_TASK function. The most important parameter is task_name.">执行SQL调整任务</a> ”中<a href="sql-tuning-advisor.html#GUID-01A224F2-043E-4E0E-A3A1-5FF21E264C47" title="要执行SQL调整任务，请使用DBMS_SQLTUNE.EXECUTE_TUNING_TASK函数。最重要的参数是task_name。">执行</a></span>的<code class="codeph">STA_SPECIFIC_EMP_TASK</code> 。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-893679CA-9998-4A5F-B4E4-C32AB219CD46__GUID-D24565FC-1868-434F-8AF4-9EC27F6F01A1">要监视SQL调优任务：</p>
                        <ol>
                           <li>
                              <p>使用适当的权限将SQL * Plus连接到数据库，然后确定任务是在执行还是已完成。</p>
                              <p>例如，查询<code class="codeph">STA_SPECIFIC_EMP_TASK</code>的状态，如下所示：</p><pre class="pre codeblock"><code>从USER_ADVISOR_TASKS中选择状态TASK_NAME ='STA_SPECIFIC_EMP_TASK';</code></pre><p>以下输出显示任务已完成：</p><pre class="pre codeblock"><code>状态-----------执行</code></pre></li>
                           <li>
                              <p>确定执行任务的进度。</p>
                              <p>以下示例使用任务ID <code class="codeph">884</code>查询任务的状态：</p><pre class="pre codeblock"><code>VARIABLE my_tid NUMBER; EXEC：my_tid：= 884 COL ADVISOR_NAME FORMAT a20 COL SOFAR FORMAT 999 COL TOTALWORK FORMAT 999 SELECT TASK_ID，ADVISOR_NAME，SOFAR，TOTALWORK，ROUND（SOFAR / TOTALWORK * 100,2）“％_COMPLETE”来自V $ ADVISOR_PROGRESS，其中TASK_ID =：my_tid ;</code></pre><p>示例输出显示如下：</p><pre class="pre codeblock"><code>TASK_ID ADVISOR_NAME SOFAR TOTALWORK％_COMPLETE ---------- -------------------- ----- --------- ---------- 884 SQL Tuning Advisor 1 2 50</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-893679CA-9998-4A5F-B4E4-C32AB219CD46__GUID-E2F60F0B-27D2-4DF8-B14C-E816761A4A89">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../refrn/V-ADVISOR_PROGRESS.html#REFRN30327" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">V$ADVISOR_PROGRESS</code>视图</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-F5494CD1-52BB-478E-BB36-17104B36B0FE" title="您可以按需运行SQL Tuning Advisor。">按需运行SQL Tuning Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94965"></a><a id="TGSQL590"></a><div class="props_rev_3"><a id="GUID-F6C1B6A7-AE67-4FED-B376-F10F02924B0A" name="GUID-F6C1B6A7-AE67-4FED-B376-F10F02924B0A"></a><h4 id="TGSQL-GUID-F6C1B6A7-AE67-4FED-B376-F10F02924B0A" class="sect4"><span class="enumeration_section">24.3.6</span>显示SQL调整任务的结果</h4>
                  <div>
                     <p>要报告调优任务的结果，请使用<code class="codeph">DBMS_SQLTUNE.REPORT_TUNING_TASK</code>函数。
                     </p>
                     <div class="section">
                        <p>该报告包含SQL Tuning Advisor的所有发现和建议。对于每个提议的建议，报告提供了实现建议所需的SQL语句的基本原理和优点。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-F6C1B6A7-AE67-4FED-B376-F10F02924B0A__GUID-4CD0EBDB-79C4-4580-A9F6-62EAEAD6B661">假设</p>
                        <p>本教程假设以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您希望以具有<code class="codeph">ADVISOR</code>权限的用户<code class="codeph">hr</code>进行调整。
                              </p>
                           </li>
                           <li>
                              <p>您想要访问<span class="q">“ <a href="sql-tuning-advisor.html#GUID-01A224F2-043E-4E0E-A3A1-5FF21E264C47" title="To execute a SQL tuning task, use the DBMS_SQLTUNE.EXECUTE_TUNING_TASK function. The most important parameter is task_name.">执行SQL调整任务</a> ”中<a href="sql-tuning-advisor.html#GUID-01A224F2-043E-4E0E-A3A1-5FF21E264C47" title="要执行SQL调整任务，请使用DBMS_SQLTUNE.EXECUTE_TUNING_TASK函数。最重要的参数是task_name。">执行</a></span>的<code class="codeph">STA_SPECIFIC_EMP_TASK</code>的报告。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-F6C1B6A7-AE67-4FED-B376-F10F02924B0A__GUID-A45B3B85-2980-429F-A149-3A057DEAABE7">要查看SQL调优任务的报告：</p>
                        <ol>
                           <li>
                              <p>使用适当的权限将SQL * Plus连接到数据库，然后运行<code class="codeph">DBMS_SQLTUNE.REPORT_TUNING_TASK</code>函数。
                              </p>
                              <p>例如，您运行以下语句：</p><pre class="pre codeblock"><code>SET LONG 1000 SET LONGCHUNKSIZE 1000 SET LINESIZE 100 SELECT DBMS_SQLTUNE.REPORT_TUNING_TASK（'STA_SPECIFIC_EMP_TASK'）FROM DUAL;</code></pre><p>截断的样本输出如下所示：</p><pre class="pre codeblock"><code>DBMS_SQLTUNE.REPORT_TUNING_TASK（'STA_SPECIFIC_EMP_TASK'）------------------------------------------ ---------------------------------一般信息部分-------------- -------------------------------------------------- -----------调整任务名称：STA_SPECIFIC_EMP_TASK调整任务所有者：HR工作负载类型：单个SQL语句执行计数：11当前执行：EXEC_1057执行类型：TUNE SQL范围：全面的时间限制（秒）：300完成状态：已完成状态开始于：04/22/2012 07:35:49已完成于：2012年4月22日07:35:50 -------------------- -------------------------------------------------- -----模式名称：HR SQL ID：dg7nfaj0bdcvk SQL文本：SELECT / * + ORDERED * / * FROM employees e，locations l，departments d WHERE e.department_id = d.department_id AND l.location_id = d.location_id AND e.employee_id &lt;：bnd绑定变量：1  - （NUMBER）：100 ---------------------------------- -----------------------------------------调查结果（4项调查结果）--- --- -----------------------------------------</code></pre></li>
                           <li>
                              <p>解释结果。</p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-F6C1B6A7-AE67-4FED-B376-F10F02924B0A__GUID-CA4125F3-5C01-4A7D-85FD-1BE457824FA3">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="sql-tuning-advisor.html#GUID-C5A11E6F-9A8E-4061-BFED-39EA51C92AF7" title="要将SQL调整报告生成为CLOB，请执行DBMS_SQLTUNE.REPORT_AUTO_TUNING_TASK函数。">使用命令行查看自动SQL调整报告</a> ”</span></p>
                           </li>
                           <li>
                              <p><a href="../arpls/DBMS_SQLTUNE.html#ARPLS68446" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以获取完整的参考信息</p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-tuning-advisor.html#GUID-F5494CD1-52BB-478E-BB36-17104B36B0FE" title="您可以按需运行SQL Tuning Advisor。">按需运行SQL Tuning Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>