<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>开发客户端应用程序（仅限SNA）</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="User&#39;s Guide "></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-gateway-appc-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-04-16T18:35:49-07:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2002, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="F18239-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="creating-tip-oracle-database-gateway-appc.html" title="Previous" type="text/html"></link>
      <link rel="next" href="implement-appc-commit-confirm-sna-only.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Gateway for APPC User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="APPUG"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="creating-tip-oracle-database-gateway-appc.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="implement-appc-commit-confirm-sna-only.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">用户指导</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">开发客户端应用程序（仅限SNA）</li>
            </ol>
            <a id="GUID-9D1AFA3A-C1DC-4D52-AAAB-41269D6D5788" name="GUID-9D1AFA3A-C1DC-4D52-AAAB-41269D6D5788"></a><a id="APPUG400"></a>
            
            <h2 id="APPUG-GUID-9D1AFA3A-C1DC-4D52-AAAB-41269D6D5788" class="sect2"><span class="enumeration_chapter">4</span>开发客户端应用程序（仅限SNA）</h2>
         </header>
         <div class="ind">
            <div>
               <p>以下部分讨论如何调用TIP并控制远程主机事务。它还为您提供了准备和执行网关事务的步骤。做出以下假设：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p>已经编写了远程主机事务（RHT）</p>
                  </li>
                  <li>
                     <p>已经使用<a href="creating-tip-oracle-database-gateway-appc.html#GUID-78D4439E-7DD6-45DF-842E-35007FCC572B">创建提示中</a>描述的步骤定义了与RHT对应<a href="creating-tip-oracle-database-gateway-appc.html#GUID-78D4439E-7DD6-45DF-842E-35007FCC572B">的提示</a></p>
                     <div class="infoboxnote" id="GUID-9D1AFA3A-C1DC-4D52-AAAB-41269D6D5788__GUID-868E1727-1517-4BC4-865D-38F73C533907">
                        <p class="notep1">注意：</p>
                        <p>如果您的网关使用IMS Connect的TCP / IP支持，请参阅<a href="developing-appc-client-app-tcpip-only.html#GUID-705991C2-2CC2-4FAB-A04C-D63485B571FC">客户端应用程序开发（仅限TCP / IP）</a>以获取有关调用TIP和控制远程主机事务的信息。
                        </p>
                     </div>
                  </li>
               </ul>
               <p>话题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="developing-appc-client-app-sna-only.html#GUID-4AF92748-25E4-4262-88D7-742CE302709D">客户端应用程序概述</a></p>
                  </li>
                  <li>
                     <p><a href="developing-appc-client-app-sna-only.html#GUID-234C85C7-BC32-4B2F-9580-9151360B3DD7">准备客户端应用程序</a></p>
                  </li>
                  <li>
                     <p><a href="developing-appc-client-app-sna-only.html#GUID-BFE11091-D32F-4B66-B48F-5569EB5FAD6E">了解远程主机事务要求</a></p>
                  </li>
                  <li>
                     <p><a href="developing-appc-client-app-sna-only.html#GUID-30316801-BD91-4799-BAB2-B145F27CD624">每个远程主机事务的自定义TIP</a></p>
                  </li>
                  <li>
                     <p><a href="developing-appc-client-app-sna-only.html#GUID-A3323A41-AEDA-48EA-90D2-4C150D708D8E">客户申请要求</a></p>
                  </li>
                  <li>
                     <p><a href="developing-appc-client-app-sna-only.html#GUID-B264D759-308E-46B3-B303-7E651B4AF83C">确保TIP和远程交易程序通信</a></p>
                  </li>
                  <li>
                     <p><a href="developing-appc-client-app-sna-only.html#GUID-1C0A2278-D220-4DDB-888C-F691D057BB78">从客户端应用程序调用TIP</a></p>
                  </li>
                  <li>
                     <p><a href="developing-appc-client-app-sna-only.html#GUID-62418ADB-1A9B-4DCC-A2D5-70940D7ECBFC">交换数据</a></p>
                  </li>
                  <li>
                     <p><a href="developing-appc-client-app-sna-only.html#GUID-19815A38-8520-41D5-9418-2DB46AFDB9AA">执行申请</a></p>
                  </li>
                  <li>
                     <p><a href="developing-appc-client-app-sna-only.html#GUID-E02BE2D4-97BA-407C-B1D6-4503D79561D7">APPC对话共享</a></p>
                  </li>
                  <li>
                     <p><a href="developing-appc-client-app-sna-only.html#GUID-2F5FD89A-06E6-47DF-84CD-525B6515B25F">支持多字节字符集的应用程序开发</a></p>
                  </li>
                  <li>
                     <p><a href="developing-appc-client-app-sna-only.html#GUID-B118F27C-0B26-4429-8B70-3CC5B01C6A93">修改面向终端的事务以使用APPC</a></p>
                  </li>
                  <li>
                     <p><a href="developing-appc-client-app-sna-only.html#GUID-8E530425-F978-4095-8A39-B8FD8BE2A47A">使用TIP所需的权限</a></p>
                  </li>
               </ul>
            </div><a id="APPUG1299"></a><a id="APPUG970"></a><div class="props_rev_3"><a id="GUID-4AF92748-25E4-4262-88D7-742CE302709D" name="GUID-4AF92748-25E4-4262-88D7-742CE302709D"></a><h3 id="APPUG-GUID-4AF92748-25E4-4262-88D7-742CE302709D" class="sect3">客户端应用程序概述</h3>
               <div>
                  <p>程序网关管理实用程序（ <a id="d17239e161" class="indexterm-anchor"></a> PGAU）使用您提供的定义生成完整的TIP。然后，客户端应用程序可以调用TIP来访问远程主机事务。 <a href="pga-utility-oracle-database-gateway-appc.html#GUID-F73E20E7-D94C-468F-BA65-CC34F6373F19"> 程序网关管理实用程序</a> ，详细讨论了PGAU的使用。
                  </p>
                  <p>此概述说明了为调用TIP和控制远程主机事务必须执行的操作。</p>
                  <p>网关从接收PL / SQL调用<a id="d17239e172" class="indexterm-anchor"></a> Oracle数据库并发出APPC调用以与远程事务程序进行通信。以下三个应用程序使这成为可能：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>启用APPC的远程主机事务程序</p>
                     </li>
                     <li>
                        <p>一个<a id="d17239e182" class="indexterm-anchor"></a>事务接口包，或TIP。 TIP是一个P L / SQL包，用于处理客户端和网关之间的通信，并执行COBOL和PL / SQL之间的数据类型转换。</p>
                        <p>PGAU生成了<a id="d17239e192" class="indexterm-anchor"></a><a id="d17239e196" class="indexterm-anchor"></a> TIP规范为您服务。在发货的样本中，PGAU生成的包称为<code class="codeph">pgadb2i.pkb</code> 。生成的TIP包括至少三个映射到远程事务程序的函数调用：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">pgadb2i_init</code>初始化与远程事务程序的对话</p>
                           </li>
                           <li>
                              <p><code class="codeph">pgadb2i_main</code>与远程事务程序交换应用程序数据</p>
                           </li>
                           <li>
                              <p><code class="codeph">pgadb2i_term</code>终止与远程事务程序的对话</p>
                           </li>
                        </ul>
                        <p>如果您正在编写自己的TIP或调试，请参阅<a href="tip-internals-oracle-database-gateway-appc.html#GUID-9F4E3177-13B0-43CE-AD0A-5BCD66B3FD17">Tip Internals</a>以获取有关TIP的更多信息。
                        </p>
                     </li>
                     <li>
                        <p>调用TIP的客户端应用程序。</p>
                        <p>客户端应用程序使用输入和输出参数调用三个TIP函数。在该示例中，客户端应用程序将<code class="codeph">empno</code> ，员工编号传递给远程事务，远程事务发送回<code class="codeph">emprec</code>员工记录。
                        </p>
                     </li>
                  </ul>
                  <p><a href="developing-appc-client-app-sna-only.html#GUID-4AF92748-25E4-4262-88D7-742CE302709D__CHDDBIFA" title="这3列表描述了使用示例CICS-DB2事务演示PL / SQL驱动程序，TIP和网关之间的逻辑流程">表4-1</a>演示了使用示例CICS-DB2事务的PL / SQL驱动程序，TIP和网关之间的逻辑流程。
                  </p>
                  <div class="tblformal" id="GUID-4AF92748-25E4-4262-88D7-742CE302709D__CHDDBIFA">
                     <p class="titleintable">表4-1 CICS-DB2示例的逻辑流程</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="CICS-DB2示例的逻辑流程" width="100%" border="1" summary="This 3 column table describes demonstrates the logic flow between the PL/SQL driver, the TIP, and the gateway using the example CICS-DB2 transaction" frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="24%" id="d17239e252">客户申请</th>
                              <th align="left" valign="bottom" width="30%" id="d17239e255">Oracle提示</th>
                              <th align="left" valign="bottom" width="46%" id="d17239e258">在网关和远程事务（大型机）之间建立的程序</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="24%" id="d17239e263" headers="d17239e252 ">
                                 <p><code class="codeph">调用tip_init</code></p>
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="30%" headers="d17239e263 d17239e255 ">
                                 <p>打电话<code class="codeph">PGAINIT</code></p>
                              </td>
                              <td align="left" valign="top" width="46%" headers="d17239e263 d17239e258 ">
                                 <p>Gateway设置控制块并发出APPC <code class="codeph">ALLOCATE</code> 。大型机程序启动。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="24%" id="d17239e280" headers="d17239e252 ">
                                 <p><code class="codeph">调用tip_main</code></p>
                              </td>
                              <td align="left" valign="top" width="30%" headers="d17239e280 d17239e255 ">
                                 <p>调用<code class="codeph">PGAXFER</code>发送<code class="codeph">empno</code>并接收<code class="codeph">emprec</code></p>
                              </td>
                              <td align="left" valign="top" width="46%" headers="d17239e280 d17239e258 ">
                                 <p>Gateway向大型机发出APPC <code class="codeph">SEND</code> 。主机<code class="codeph">RECEIVE</code>完成。大型机执行应用程序逻辑并将APPC <code class="codeph">SEND</code>回网关。网关 - 发布APPC <code class="codeph">RECEIVE</code> ;收到完成。大型机问题APPC <code class="codeph">TERM</code> 。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="24%" id="d17239e314" headers="d17239e252 ">
                                 <p><code class="codeph">调用tip_term</code></p>
                              </td>
                              <td align="left" valign="top" width="30%" headers="d17239e314 d17239e255 ">
                                 <p>致电<code class="codeph">PGATERM</code></p>
                              </td>
                              <td align="left" valign="top" width="46%" headers="d17239e314 d17239e258 ">
                                 <p>Gateway清理控制块。</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <p>利用网关与远程主机事务交换数据的客户端应用程序为自己执行一些任务，并指示TIP代表它执行其他任务。因此，客户端应用程序设计者必须知道远程事务的行为以及TIP如何促进交换。</p>
                  <p>以下部分概述了远程主机事务行为，客户端应用程序如何控制此行为以及TIP函数调用和数据声明如何支持客户端应用程序控制远程主机事务。这些部分还提供了有关TIP为客户端应用程序执行的操作以及TIP调用如何与远程主机事务交换数据的背景信息。</p>
               </div>
            </div><a id="APPUG971"></a><div class="props_rev_3"><a id="GUID-234C85C7-BC32-4B2F-9580-9151360B3DD7" name="GUID-234C85C7-BC32-4B2F-9580-9151360B3DD7"></a><h3 id="APPUG-GUID-234C85C7-BC32-4B2F-9580-9151360B3DD7" class="sect3">准备客户端应用程序</h3>
               <div>
                  <div class="section">
                     <p>要准备客户端应用程序以执行，您必须了解远程主机事务要求，然后执行以下步骤：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li><span>移动相关<a id="d17239e373" class="indexterm-anchor"></a> COBOL将布局（副本）记录到网关系统以输入到PGAU。</span></li>
                     <li><span>描述远程主机事务数据并调用<a id="d17239e379" class="indexterm-anchor"></a>带有<code class="codeph">DEFINE DATA</code> ， <code class="codeph">DEFINE CALL</code>和<code class="codeph">DEFINE TRANSACTION</code>语句的PG数据字典（PG DD）。</span></li>
                     <li><span>使用<code class="codeph">GENERATE</code>在Oracle数据库中生成TIP。</span></li>
                     <li><span>创建调用TIP公共函数的客户端应用程序。</span></li>
                     <li><span>授予新创建的包的权限。</span></li>
                  </ol>
               </div>
            </div><a id="APPUG972"></a><div class="props_rev_3"><a id="GUID-BFE11091-D32F-4B66-B48F-5569EB5FAD6E" name="GUID-BFE11091-D32F-4B66-B48F-5569EB5FAD6E"></a><h3 id="APPUG-GUID-BFE11091-D32F-4B66-B48F-5569EB5FAD6E" class="sect3">了解远程主机事务要求</h3>
               <div>
                  <p>浏览远程主机事务程序（RTP）以确定：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>各种客户端应用程序对TIP调用所需的PL / SQL参数</p>
                     </li>
                     <li>
                        <p>调用的顺序</p>
                     </li>
                  </ul>
                  <p>确定要调用的远程主机事务程序（RTP）工具以及每次调用时要交换的数据。然后，您将定义以下内容，并将它们存储在PG DD中：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><code class="codeph">定义数据</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">DEFINE CALL</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">定义交易</code></p>
                     </li>
                  </ul>
                  <p>有关具体的定义步骤以及实际创建和生成<a href="creating-tip-oracle-database-gateway-appc.html#GUID-78D4439E-7DD6-45DF-842E-35007FCC572B">TIP</a> ，请参阅<a href="creating-tip-oracle-database-gateway-appc.html#GUID-78D4439E-7DD6-45DF-842E-35007FCC572B">创建</a>提示。</p>
               </div><a id="APPUG973"></a><div class="props_rev_3"><a id="GUID-72D8DB06-5E1C-499E-8C3F-95D5304DB401" name="GUID-72D8DB06-5E1C-499E-8C3F-95D5304DB401"></a><h4 id="APPUG-GUID-72D8DB06-5E1C-499E-8C3F-95D5304DB401" class="sect4">提示内容和目的</h4>
                  <div>
                     <p>PGAU生成的TIP的内容反映了远程主机事务可用的调用和已交换的数据。了解此内容有助于设计和调试调用TIP的客户端应用程序。</p>
                     <p>提示是一个<a id="d17239e522" class="indexterm-anchor"></a> PL / SQL包，并据此有<a id="d17239e527" class="indexterm-anchor"></a><a id="d17239e531" class="indexterm-anchor"></a>两节：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>包规范包含：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>公共函数原型和参数，以及</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>包体包含：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>私有函数和内部控制变量</p>
                              </li>
                              <li>
                                 <p>公共职能</p>
                              </li>
                              <li>
                                 <p>最后一个公共函数后的包初始化。</p>
                              </li>
                           </ul>
                        </li>
                     </ul>
                     <p>TIP的目的是为每个允许的远程事务程序交互提供PL / SQL可调用公共函数。一个<a id="d17239e561" class="indexterm-anchor"></a>远程交易程序交互是通过一个或多个逻辑相关的数据交换组<a id="d17239e566" class="indexterm-anchor"></a><a id="d17239e568" class="indexterm-anchor"></a> <code class="codeph">PGAXFER</code> RPC调用。这在概念上类似于屏幕或菜单交互，其中填充了几个字段，按下了回车键，并且向用户返回了几个字段。进一步进行类比：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>用户可能被比作TIP或客户端应用程序</p>
                        </li>
                        <li>
                           <p>要填写的字段是TIP函数调用的<code class="codeph">IN</code>参数</p>
                        </li>
                        <li>
                           <p>返回的字段是TIP函数调用的<code class="codeph">OUT</code>参数</p>
                        </li>
                        <li>
                           <p>屏幕或菜单是<code class="codeph">IN</code>和<code class="codeph">OUT</code>参数组合在一起的</p>
                        </li>
                        <li>
                           <p>按下的回车键被比作<code class="codeph">PGAXFER</code>远程过程调用（RPC）</p>
                        </li>
                     </ul>
                     <p>构成交易调用的实际参数分组由用户定义。网关对远程事务程序如何对应于TIP函数调用的集合没有限制，每个调用具有许多<code class="codeph">IN</code>和<code class="codeph">OUT</code>参数。
                     </p>
                     <p>PGA用户通常每个远程交易程序有一个TIP。如何对TIP函数调用进行分组以及在每次调用时交换哪些数据参数取决于远程事务程序的大小，复杂性和行为。</p>
                     <p>有关如何操作的讨论，请参阅Oracle的<a href="../lnpls/index.html" target="_blank"><span class="italic">Oracle数据库PL / SQL语言参考</span></a> <a id="d17239e623" class="indexterm-anchor"></a> PL / SQL包工作。以下讨论涵盖了必须在TIP中执行的逻辑。请参阅针对Microsoft Windows的<code class="codeph">%ORACLE_HOME%\dg4appc\demo\CICS</code>目录中提供的示例提示和驱动程序或针对基于UNIX的系统的<code class="codeph">$ORACLE_HOME/dg4appc/demo/CICS</code>目录，位于文件中<a id="d17239e632" class="indexterm-anchor"></a><a id="d17239e634" class="indexterm-anchor"></a> <code class="codeph">pgadb2i.pkh</code> ， <a id="d17239e643" class="indexterm-anchor"></a><a id="d17239e645" class="indexterm-anchor"></a> <code class="codeph">pgadb2i.pkb</code> ，和<a id="d17239e652" class="indexterm-anchor"></a> <code class="codeph">pgadb2id.sql</code> 。
                     </p>
                  </div>
               </div><a id="APPUG974"></a><div class="props_rev_3"><a id="GUID-FD67739C-7249-466A-A492-0E43195A6D3B" name="GUID-FD67739C-7249-466A-A492-0E43195A6D3B"></a><h4 id="APPUG-GUID-FD67739C-7249-466A-A492-0E43195A6D3B" class="sect4">远程主机事务类型</h4>
                  <div>
                     <p>从数据库网关应用程序的角度来看，有三种主要类型的远程主机事务：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>一次性</p>
                        </li>
                        <li>
                           <p>一贯</p>
                        </li>
                        <li>
                           <p>多对话</p>
                        </li>
                     </ul>
                  </div><a id="APPUG975"></a><div class="props_rev_3"><a id="GUID-58F456FB-9B18-4D4A-ABA9-D97863A69B2E" name="GUID-58F456FB-9B18-4D4A-ABA9-D97863A69B2E"></a><h5 id="APPUG-GUID-58F456FB-9B18-4D4A-ABA9-D97863A69B2E" class="sect5">一次性交易</h5>
                     <div>
                        <p><a id="d17239e747" class="indexterm-anchor"></a>接收一个员工编号并返回员工记录的简单远程交易程序可以具有提供一个呼叫的TIP，将员工编号作为<code class="codeph">IN</code>参数传递并将员工记录作为<code class="codeph">OUT</code>参数返回。此和每个提示必须提供另外两个函数调用：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>一个远程事务程序init函数调用</p>
                           </li>
                           <li>
                              <p>远程事务程序终止函数调用</p>
                           </li>
                        </ul>
                        <p>最简单的TIP有三个公共函数，例如<code class="codeph">tip_init</code> ， <code class="codeph">tip_main</code>和<code class="codeph">tip_term</code> 。
                        </p>
                        <p>客户端应用程序连续调用<code class="codeph">tip_init</code> ， <code class="codeph">tip_main</code>和<code class="codeph">tip_term</code> 。远程站点的相应活动是远程事务程序启动，数据交换和远程事务程序结束。
                        </p>
                        <p>远程事务程序甚至可能在从网关接收到终止信号之前自行终止。这个序列很常见，通常由网关逻辑处理。这种远程交易程序被称为一次性。</p>
                     </div>
                  </div><a id="APPUG976"></a><div class="props_rev_3"><a id="GUID-6F97F428-51DD-4A44-A5E3-EFD7A07A1AAD" name="GUID-6F97F428-51DD-4A44-A5E3-EFD7A07A1AAD"></a><h5 id="APPUG-GUID-6F97F428-51DD-4A44-A5E3-EFD7A07A1AAD" class="sect5">持久交易</h5>
                     <div>
                        <p><a id="d17239e826" class="indexterm-anchor"></a>更复杂的远程事务程序有两种行为模式： <code class="codeph">INQUIRY</code>或报告模式，以及<code class="codeph">UPDATE</code>模式。这些模式可以有两个TIP数据传输函数调用：一个用于<code class="codeph">INQUIRY</code> ，另一个用于<code class="codeph">UPDATE</code> 。这样的TIP可能有五个公共职能。例如：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a id="d17239e844" class="indexterm-anchor"></a><code class="codeph">tip_init</code></p>
                              <p>这初始化了与远程事务程序的通信。</p>
                           </li>
                           <li>
                              <p><a id="d17239e856" class="indexterm-anchor"></a><code class="codeph">tip_mode</code></p>
                              <p>这接受模式选择参数并将事务程序置于查询或更新模式。</p>
                           </li>
                           <li>
                              <p><a id="d17239e868" class="indexterm-anchor"></a><code class="codeph">tip_inqr</code> 
                              </p>
                              <p>这将返回给定员工编号的员工记录。</p>
                           </li>
                           <li>
                              <p>Ť <a id="d17239e882" class="indexterm-anchor"></a> <code class="codeph">ip_updt</code></p>
                              <p>这接受给定员工编号的员工记录。</p>
                           </li>
                           <li>
                              <p><a id="d17239e894" class="indexterm-anchor"></a><code class="codeph">tip_term</code></p>
                              <p>这终止了与远程事务程序的通信。</p>
                           </li>
                        </ul>
                        <p>客户端应用程序调用<code class="codeph">tip_init</code>然后<code class="codeph">tip_mode</code>放置在查询模式远程交易程序，然后扫描雇员记录，搜索属性的某些组合（称为客户端应用和最终用户）。然后将查询调用上的某些参数设置为表示更改为更新模式，客户端应用程序调用<code class="codeph">tip_updt</code>以更新某些记录。客户端应用程序最终调用<code class="codeph">tip_term</code>来终止远程事务程序。
                        </p>
                        <p>相应的活动在<a id="d17239e920" class="indexterm-anchor"></a>远程站点是：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>远程交易程序启动</p>
                           </li>
                           <li>
                              <p>模式选择交换</p>
                           </li>
                           <li>
                              <p>循环阅读记录</p>
                           </li>
                           <li>
                              <p>切换到更新模式</p>
                           </li>
                           <li>
                              <p>更新一条记录</p>
                           </li>
                           <li>
                              <p>远程交易程序结束</p>
                           </li>
                        </ul>
                        <p>这样的远程事务程序称为持久性，因为它会进行交互，直到它被发出信号终止。</p>
                        <p>可以编写远程事务程序以允许返回查询模式并无限期地重复整个过程。</p>
                     </div>
                  </div><a id="APPUG977"></a><div class="props_rev_3"><a id="GUID-EB18C5AF-6577-4702-9893-250023FB106B" name="GUID-EB18C5AF-6577-4702-9893-250023FB106B"></a><h5 id="APPUG-GUID-EB18C5AF-6577-4702-9893-250023FB106B" class="sect5">多方会话交易</h5>
                     <div>
                        <p><a id="d17239e988" class="indexterm-anchor"></a>客户端应用程序可能需要从一个交易，获取信息<code class="codeph">tran_A</code> ，随后编写或从另一个查找信息， <code class="codeph">tran_B</code> 。通过正确编写的客户端应用程序以及<code class="codeph">tran_A</code>和<code class="codeph">tran_B</code> TIP，可以实现<code class="codeph">tran_A</code> <code class="codeph">tran_B</code> 。实际上，任何数量的事务可能由单个客户端应用程序同时控制。所有事务都可以是只读的，客户端应用程序从每个事务中检索数据并将其合并到本地Oracle数据库中或在Oracle表单中显示。
                        </p>
                        <p>或者，取决于客户端应用程序提供的输入选择，事务能够以不同模式操作或执行不同服务。例如， <code class="codeph">tran_C</code>一个实例可以执行一个服务，而<code class="codeph">tran_C</code>的第二个实例执行第二个服务。<code class="codeph">tran_C</code>每个实例<code class="codeph">tran_C</code>将与客户端应用程序具有自己唯一的对话，并且每个实例可以具有其自己的行为（一次性或持久性），这取决于正在执行的服务的性质。
                        </p>
                     </div>
                  </div>
               </div>
            </div><a id="APPUG1300"></a><a id="APPUG978"></a><div class="props_rev_3"><a id="GUID-30316801-BD91-4799-BAB2-B145F27CD624" name="GUID-30316801-BD91-4799-BAB2-B145F27CD624"></a><h3 id="APPUG-GUID-30316801-BD91-4799-BAB2-B145F27CD624" class="sect3">每个远程主机事务的自定义TIP</h3>
               <div>
                  <p>每个远程主机系统可能有数百个<a id="d17239e1057" class="indexterm-anchor"></a>用户可能想要调用的远程事务程序（RTP）。每个远程事务程序都不同，传递不同的数据，并执行不同的功能。因此，用户和每个远程事务程序之间的接口必须专门化并根据用户对每个远程事务程序的要求进行定制。事务接口包提供此自定义接口。
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-30316801-BD91-4799-BAB2-B145F27CD624__GUID-BA1A1ECC-D0C8-4B68-9E3D-596D66EC921F">例</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>假设远程站点具有管理员工数据库或其他文件系统中的员工信息的事务程序。远程主机中的远程事务程序名称是员工跟踪的<code class="codeph">EMPT</code> 。<code class="codeph">EMPT</code>提供查询和更新功能，并且需要不同的Oracle用户访问和使用这些<code class="codeph">EMPT</code>设施。
                     </p>
                     <p>某些用户可能仅限于仅查询使用<code class="codeph">EMPT</code> ，而其他用户可能有更新要求。为了支持Oracle用户的客户端应用程序，至少可能存在三种可能的TIP：</p>
                     <ol>
                        <li>
                           <p><code class="codeph">EMP_MGMT</code>提供对<code class="codeph">EMPT</code>远程交易程序的所有设施的访问。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">EMP_UPDT</code>仅访问<code class="codeph">EMPT</code>远程事务程序的更新功能。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">EMP_INQR</code>仅访问<code class="codeph">EMPT</code>远程事务程序的查找功能。
                           </p>
                        </li>
                     </ol>
                     <p>最终用户对这些TIP的访问权限由Oracle权限控制。远程主机可能会对最终用户施加额外的安全性。</p>
                     <p>每个TIP还在其中编码远程交易程序（ <code class="codeph">EMPT</code> ）的名称和足以与<code class="codeph">EMPT</code>建立APPC对话的网络信息。</p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="APPUG1301"></a><a id="APPUG1302"></a><a id="APPUG1303"></a><a id="APPUG979"></a><div class="props_rev_3"><a id="GUID-A3323A41-AEDA-48EA-90D2-4C150D708D8E" name="GUID-A3323A41-AEDA-48EA-90D2-4C150D708D8E"></a><h3 id="APPUG-GUID-A3323A41-AEDA-48EA-90D2-4C150D708D8E" class="sect3">客户申请要求</h3>
               <div>
                  <p>使用TIP，客户端应用程序必须与之对应并控制<a id="d17239e1181" class="indexterm-anchor"></a>远程主机事务。这包括：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>客户应用初始化</p>
                     </li>
                     <li>
                        <p>用户输入和输出</p>
                     </li>
                     <li id="GUID-A3323A41-AEDA-48EA-90D2-4C150D708D8E__I1008983">
                        <p>使用TIP初始化函数进行远程主机事务初始化（使用和不使用覆盖）</p>
                     </li>
                     <li id="GUID-A3323A41-AEDA-48EA-90D2-4C150D708D8E__I1008989">
                        <p>使用TIP用户功能进行远程主机事务控制和数据交换</p>
                     </li>
                     <li id="GUID-A3323A41-AEDA-48EA-90D2-4C150D708D8E__I1008993">
                        <p>使用TIP终止功能终止远程主机事务</p>
                        <p>前三个步骤根据远程主机事务的要求而有所不同。</p>
                     </li>
                     <li>
                        <p>异常处理</p>
                     </li>
                     <li>
                        <p>客户申请终止</p>
                     </li>
                  </ul>
                  <div class="section">
                     <p class="subhead2" id="GUID-A3323A41-AEDA-48EA-90D2-4C150D708D8E__GUID-7AAE85C6-85B8-48CE-96F8-5ABD3024CCFD">一次性远程主机事务客户端应用程序必须：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>声明要交换的RHT / TIP数据类型。<a id="d17239e1218" class="indexterm-anchor"></a>所有客户端应用程序必须使用TIP声明要与RHT交换的变量。<a id="d17239e1225" class="indexterm-anchor"></a>这些变量的PL / SQL数据类型已经在每个RHT对应的TIP中定义，客户端应用程序只需要在其声明中引用TIP数据类型。有关更多信息，另请参阅<span class="q">“ <a href="developing-appc-client-app-sna-only.html#GUID-26AFD2F9-2126-418D-9B71-B01D2A06E7E6">声明TIP变量</a> ”</span> 。有关这些变量的确切用法的更多信息，另请参阅特定TIP / RHT的TIP内容文档文件。
                           </p>
                        </li>
                        <li>
                           <p>使用TIP初始化函数初始化RHT <a id="d17239e1238" class="indexterm-anchor"></a> 。TIP指示网关服务器初始化具有所需RHT的会话，指定默认RHT标识参数（在PG DD中定义RHT时生成，并在生成时在TIP内编码）或覆盖由RHT提供的RHT标识参数。调用TIP初始化函数时的用户或客户端应用程序。有关更多详细信息，请参阅<span class="q">“ <a href="developing-appc-client-app-sna-only.html#GUID-41ABD528-5797-468E-A436-B6B3434ADF34">初始化对话</a> ”</span>和<span class="q">“ <a href="developing-appc-client-app-sna-only.html#GUID-125BF246-33A2-46AF-87E8-7344F3B4F573">覆盖TIP初始化</a> ”</span> 。
                           </p>
                        </li>
                        <li>
                           <p>使用TIP用户功能（一次呼叫）与RHT交换数据。 <a id="d17239e1258" class="indexterm-anchor"></a> 如前所述，一次性远程主机事务仅适用于单个数据交换，并且在完成该交换后，RHT自行终止。因此，客户端应用程序只需要对用户定义的TIP函数执行单个调用即可进行数据交换。
                           </p>
                           <p>请参阅Microsoft Windows上的<code class="codeph">%ORACLE_HOME%\dg4appc\demo\CICS\</code>或基于UNIX的系统上的<code class="codeph">$ORACLE_HOME/dg4appc/demo/CICS/</code>的TIP内容文档文件，了解此调用的确切语法的特定TIP / RHT。
                           </p>
                           <p>在调用TIP函数调用之前，客户端应用程序应将值初始化为<code class="codeph">IN</code>或<code class="codeph">IN OUT</code>参数值。当您声明要交换的RHT / TIP数据类型时，这些变量与上面声明的变量相同。
                           </p>
                           <p>所有TIP函数调用返回<code class="codeph">0</code>返回码值，并且所有返回的用户网关数据值在函数参数中交换。任何异常条件都会根据需要引发，并且可以在异常处理程序中截获。
                           </p>
                           <p>从TIP函数调用返回后，客户端应用程序可以分析并操作<code class="codeph">IN OUT</code>或<code class="codeph">OUT</code>参数值。当您声明要交换的RHT / TIP数据类型时，这些变量与上面声明的变量相同。
                           </p>
                           <p>有关TIP如何转换远程主机数据的各种类型和格式的详细信息，请参阅<a href="data-type-conversion-oracle-database-gateway-appc.html#GUID-FEB0C201-9C07-4932-A328-B048B582B18A">数据类型转换</a> 。
                           </p>
                        </li>
                        <li>
                           <p>使用TIP终止功能终止RHT <a id="d17239e1303" class="indexterm-anchor"></a> 。无论访问的RHT类型如何，都应调用TIP终止函数来清理和终止与RHT的对话。在RHT终止之前，可以从网关服务器终止与一次性RHT的对话。TIP也必须执行清理。清理仅在客户端应用程序的终止请求时执行。
                           </p>
                           <p>客户端应用程序可以请求正常或中止终止。</p>
                           <p>参考<a id="d17239e1314" class="indexterm-anchor"></a><a id="d17239e1316" class="indexterm-anchor"></a> <span class="q">“ <a href="developing-appc-client-app-sna-only.html#GUID-3CDB9504-3937-4909-A6FE-3B63FC25BF75">终止对话</a> ”</span>以获取更多信息。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-A3323A41-AEDA-48EA-90D2-4C150D708D8E__GUID-A1A87711-9449-496D-88E7-B271382F6BBD">持久远程主机事务客户端应用程序必须：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>声明要交换的RHT / TIP数据类型。<a id="d17239e1333" class="indexterm-anchor"></a>所有客户端应用程序必须使用TIP声明要与RHT交换的变量。<a id="d17239e1340" class="indexterm-anchor"></a>已经在与每个RHT对应的TIP中定义了这些变量的PL / SQL数据类型;客户端应用程序只需要在其声明中引用TIP数据类型。有关更多信息，请参阅<span class="q">“ <a href="developing-appc-client-app-sna-only.html#GUID-26AFD2F9-2126-418D-9B71-B01D2A06E7E6">声明TIP变量</a> ”</span> 。有关这些变量的确切用法的更多信息，另请参阅特定TIP / RHT的TIP内容文档文件。
                           </p>
                        </li>
                        <li>
                           <p>使用TIP初始化函数初始化RHT。<a id="d17239e1353" class="indexterm-anchor"></a> TIP指示网关服务器初始化具有所需RHT的会话，指定默认RHT标识参数（在PG DD中定义RHT时生成，并在生成时在TIP内编码）或覆盖由RHT提供的RHT标识参数。调用TIP初始化函数时的用户或客户端应用程序。有关更多详细信息，请参阅<span class="q">“ <a href="developing-appc-client-app-sna-only.html#GUID-41ABD528-5797-468E-A436-B6B3434ADF34">初始化对话</a> ”</span>和<span class="q">“ <a href="developing-appc-client-app-sna-only.html#GUID-125BF246-33A2-46AF-87E8-7344F3B4F573">覆盖TIP初始化</a> ”</span> 。
                           </p>
                        </li>
                        <li>
                           <p>使用TIP用户功能与RHT重复交换数据。 <a id="d17239e1373" class="indexterm-anchor"></a> 提供或要求持续或重复控制序列的远程主机事务应由客户端应用程序控制，其方式与交互用户或其他控制程序操作RHT的方式相同。TIP和网关服务器的代理不会改变RHT行为;相反，它使用TIP中定义的各种函数调用将该行为的控制扩展到客户端应用程序。</p>
                           <p>可以使用一个或多个TIP函数调用来控制持久性RHT。例如，RHT可以设计为循环并返回每个输入的输出，直到会话被明确终止。或者它可以被设计为接受作为输入的操作的计数或列表，并且在多个交换中返回结果，其中TIP功能仅具有<code class="codeph">OUT</code>参数。
                           </p>
                           <p>持久性RHT也可以是交互式的，每个输出由先前的输入选择指定，并且仅在客户端应用程序明确终止对话时结束。</p>
                           <p>TIP函数调用可用于客户端应用程序，其特定语法记录在特定TIP / RHT的TIP内容文档文件中。</p>
                           <p>RHT解释TIP <code class="codeph">IN</code>参数并返回TIP <code class="codeph">OUT</code>参数的方式必须从RHT确定或由RHT程序员解释。TIP提供函数调用和交换的参数数据类型，以便于客户端应用程序控制RHT，并且不对RHT执行的操作序列施加任何限制或先决条件。TIP为客户端应用程序提供RHT定义为在PG DD中接受的调用和数据参数。</p>
                        </li>
                        <li>
                           <p>使用TIP终止功能终止RHT <a id="d17239e1400" class="indexterm-anchor"></a> 。无论访问的RHT类型如何，都应调用TIP终止函数来清理和终止与RHT的对话。在RHT终止之前，可以从网关服务器终止与持久性RHT的对话，或者RHT可能已经终止。TIP也必须执行其清理，并且仅在客户端应用程序的终止请求时执行此清理。
                           </p>
                           <p>客户端应用程序可以请求正常或中止终止。</p>
                           <p>有关更多信息，请参阅<span class="q">“ <a href="developing-appc-client-app-sna-only.html#GUID-3CDB9504-3937-4909-A6FE-3B63FC25BF75">终止对话</a> ”</span> 。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-A3323A41-AEDA-48EA-90D2-4C150D708D8E__GUID-593ABAAC-F841-4C3F-9E40-C787577267B5">多会话远程主机事务客户端应用程序必须：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>声明要交换的RHT / TIP数据类型。 <a id="d17239e1424" class="indexterm-anchor"></a> 所有客户端应用程序必须使用TIP声明要与RHT交换的变量。<a id="d17239e1431" class="indexterm-anchor"></a>这些变量的PL / SQL数据类型已经在每个RHT对应的TIP中定义，客户端应用程序只需要在其声明中引用TIP数据类型。有关更多信息，请参阅<span class="q">“ <a href="developing-appc-client-app-sna-only.html#GUID-26AFD2F9-2126-418D-9B71-B01D2A06E7E6">声明TIP变量</a> ”</span> 。有关这些变量的确切用法的更多信息，另请参阅特定TIP / RHT的TIP内容文档文件。
                           </p>
                        </li>
                        <li>
                           <p>使用TIP初始化函数初始化所涉及的每个RHT <a id="d17239e1444" class="indexterm-anchor"></a> 。PG DD中定义的每个RHT都有一个特定的定制TIP。控制多个RHT的客户端应用程序是多会话的，必须启动每个RHT及其关联的对话。这是通过像以前一样调用每个TIP初始化函数来完成的;但是多个TIP被初始化。
                           </p>
                           <p>如果单个RHT被设计为为一个或多个呼叫者执行多个服务，并且如果客户端应用程序被设计为使用该RHT，则客户端应用程序可以多次初始化与该RHT相对应的TIP。</p>
                           <p>客户端应用程序随后使用以下方法区分其控制下的活动RHT：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>当控制多个TIP / <code class="codeph">tipname.callname</code>时，TIP模式<code class="codeph">tipname.callname</code> 。通过在TIP用户调用上编码相同的TIP模式名称，客户端应用程序指定正在进行呼叫的RHT。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">tranuse</code> <code class="codeph">IN OUT</code>当相同TIP的多个实例/ RHT被控制参数值。这是TIP初始化函数调用返回的值，随后作为<code class="codeph">IN</code>参数传递给用户定义的TIP函数调用。返回的<code class="codeph">tranuse</code>值对应于连接到RHT的给定实例的对话。通过在TIP用户调用上提供相同的<code class="codeph">tranuse</code>值，客户端应用程序指定正在进行给定RHT调用的RHT实例。
                                 </p>
                              </li>
                           </ul>
                           <p>客户端应用程序逻辑必须跟踪哪些RHT已启动以及哪些TIP和<code class="codeph">tranuse</code>值对应于已启动的RHT。
                           </p>
                        </li>
                        <li>
                           <p>使用TIP用户功能一次或重复地与每个RHT交换数据<a id="d17239e1487" class="indexterm-anchor"></a>如果RHT是一次性的或持久性的。客户端应用程序逻辑必须按照正确的RHT操作通过其允许的步骤对RHT进行排序，用户以交互方式操作RHT也是如此。
                           </p>
                           <p>客户端应用程序逻辑还必须执行可能需要的任何跨RHT结果分析或数据传输。所有TIP都彼此隔离执行。</p>
                           <p>作为输入到另一个RHT的一个RHT的输出必须在客户端应用程序中作为来自第一个RHT的<code class="codeph">IN</code>或<code class="codeph">IN OUT</code>参数接收，并作为<code class="codeph">IN</code>或<code class="codeph">IN OUT</code>参数从客户端应用程序发送到第二个RHT。所有TIP-to-RHT函数调用必须由客户端应用程序执行，并且交换的数据参数必须已由客户端应用程序声明为变量。TIP为客户端应用程序提供所需的数据类型定义和RHT函数调用。
                           </p>
                           <p>有关TIP函数调用的确切语法和交换的参数数据类型的定义，请参阅每个特定TIP / RHT的TIP内容文档文件。</p>
                        </li>
                        <li>
                           <p>终止每个初始化的RHT <a id="d17239e1515" class="indexterm-anchor"></a> ，使用TIP终止功能。要终止RHT，必须调用其相应的TIP终止函数来终止RHT及其对话并启动TIP清理。要终止的RHT由其TIP模式名称（与其数据交换函数调用相同的模式）和当终止同一RHT的多个实例时的<code class="codeph">tranuse</code>值指定。
                           </p>
                           <p>RHT及其相应的TIP可以以客户端应用程序所需的任何顺序终止，并且不必以它们被初始化的相同顺序终止。</p>
                           <div class="infoboxnote" id="GUID-A3323A41-AEDA-48EA-90D2-4C150D708D8E__GUID-0685857D-C793-43B8-8CEC-C04933C85D14">
                              <p class="notep1">注意：</p>
                              <p>各种TIP数据交换变量函数调用的具体语法与先前在PG DD中针对特定RHT定义的相同，可以通过检查TIP内容文档文件来研究<a id="d17239e1530" class="indexterm-anchor"></a><a id="d17239e1532" class="indexterm-anchor"></a> （ <code class="codeph">tipname.doc</code> ）或生成TIP时生成的TIP规范文件。如果尚未为正在访问的RHT生成TIP，请参阅<a href="creating-tip-oracle-database-gateway-appc.html#GUID-78D4439E-7DD6-45DF-842E-35007FCC572B">创建提示</a>和<span class="q">“ <a href="developing-appc-client-app-sna-only.html#GUID-2EE274FF-C15C-4E8A-9245-ACE1F41D147E">数据通信</a> ”</span> ， <span class="q">“ <a href="developing-appc-client-app-sna-only.html#GUID-5CB6DA00-C709-43E5-B3D1-3937D097E48F">CALL通信</a> ”</span>和<span class="q">“ <a href="developing-appc-client-app-sna-only.html#GUID-21400950-327F-4A8B-831D-3F34333C3264">事务通信</a> ”</span>以获取更多信息。但是，最好先定义并生成TIP，以便在需要时可以使用客户端应用程序参考文档。
                              </p>
                           </div>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="APPUG980"></a><div class="props_rev_3"><a id="GUID-B264D759-308E-46B3-B303-7E651B4AF83C" name="GUID-B264D759-308E-46B3-B303-7E651B4AF83C"></a><h3 id="APPUG-GUID-B264D759-308E-46B3-B303-7E651B4AF83C" class="sect3">确保TIP和远程交易程序通信</h3>
               <div>
                  <p>远程主机事务程序及其与客户端应用程序的相关TIP必须对应<a id="d17239e1605" class="indexterm-anchor"></a>两个关键要求：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>参数数据类型转换，由定义事务<code class="codeph">DATA</code>的方式产生。有关PGAU生成的TIP如何根据数据定义转换数据的讨论，请参阅<a href="data-type-conversion-oracle-database-gateway-appc.html#GUID-FEB0C201-9C07-4932-A328-B048B582B18A">数据类型转换</a> 。
                        </p>
                     </li>
                     <li>
                        <p>APPC发送/接收同步，这是由定义事务<code class="codeph">CALL</code>的方式产生的</p>
                     </li>
                  </ul>
                  <p>然后，这些<code class="codeph">DATA</code>和<code class="codeph">CALL</code>定义通过引用包含在<code class="codeph">TRANSACTION</code>定义中。
                  </p>
               </div><a id="APPUG981"></a><div class="props_rev_3"><a id="GUID-2EE274FF-C15C-4E8A-9245-ACE1F41D147E" name="GUID-2EE274FF-C15C-4E8A-9245-ACE1F41D147E"></a><h4 id="APPUG-GUID-2EE274FF-C15C-4E8A-9245-ACE1F41D147E" class="sect4">数据通讯</h4>
                  <div>
                     <p>使用以远程主机事务语言编写的数据定义， <a id="d17239e1684" class="indexterm-anchor"></a><a id="d17239e1688" class="indexterm-anchor"></a> PGAU <code class="codeph">DEFINE DATA</code>命令存储在<a id="d17239e1694" class="indexterm-anchor"></a> PG DD所需的信息<a id="d17239e1699" class="indexterm-anchor"></a><a id="d17239e1701" class="indexterm-anchor"></a> PGAU <code class="codeph">GENERATE</code>创建TIP函数逻辑来执行：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>从接收远程主机事务提供的PL / SQL <code class="codeph">IN</code>参数的所有数据转换</p>
                        </li>
                        <li>
                           <p>所有缓冲到接收远程主机事务所期望的格式</p>
                        </li>
                        <li>
                           <p>所有数据都不受发送远程主机事务提供的格式的影响</p>
                        </li>
                        <li>
                           <p>所有数据转换为发送远程主机事务提供的PL / SQL <code class="codeph">OUT</code>参数</p>
                        </li>
                     </ul>
                     <p>PGAU根据远程主机事务程序中包含的数据定义确定生成转换和缓冲逻辑所需的信息。PGAU <code class="codeph">DEFINE DATA</code>从文件中读取此信息，例如COBOL副本，或从脚本中插入，并将其保存在PG DD中以供重复使用。网关管理员需要将这些定义文件从远程主机传输到运行PGAU的Oracle主机。
                     </p>
                     <p>根据存储在PG DD中的数据定义，PGAU <code class="codeph">GENERATE</code>确定远程主机数据类型并将其与适当的数据类型匹配<a id="d17239e1739" class="indexterm-anchor"></a> PL / SQL数据类型。它还确定记录和缓冲区中的数据长度和偏移量，并在TIP中生成所需的PL / SQL逻辑。有关详细信息，请参阅<span class="q">“</span> <a href="pga-utility-oracle-database-gateway-appc.html#GUID-F73E20E7-D94C-468F-BA65-CC34F6373F19">过程网关管理实用程序</a> <span class="q">”中</span>的PGAU <span class="q">“ <a href="pga-utility-oracle-database-gateway-appc.html#GUID-A39AE344-8E2F-49EE-9791-6BAF4ECF4F6B">DEFINE DATA</a> ”</span>语句和<span class="q">“</span> <a href="admin-utility-samples-oracle-database-gateway-appc.html#GUID-AA9B8762-BDAF-4EED-A8B0-09F8A937F04E">管理实用程序示例</a> <span class="q">”</span>中的<span class="q">“ <a href="admin-utility-samples-oracle-database-gateway-appc.html#GUID-F0ACAA50-16F8-4C5C-83FE-C0D280981772">示例PGAU DEFINE DATA语句</a> ”</span> 。
                     </p>
                     <p>必须首先使用PGAU <code class="codeph">DEFINE DATA</code>定义后续调用作为参数引用的所有数据。可以定义简单数据项，例如单个数字或字符串，以及复杂的多字段数据聚合，例如记录或结构。PGAU自动生成等效的PL / SQL变量和字段或表的记录，供客户端应用程序在其对生成的TIP的调用中引用。</p>
                     <p>如上所述，参数可以是简单的数据项，例如员工编号，也可以是复杂的项目，例如员工记录。PGAU <code class="codeph">DEFINE DATA</code>自动从输入程序数据定义文件中提取所需的数据类型信息。
                     </p>
                     <p>在此示例中， <code class="codeph">empno</code>和<code class="codeph">emprec</code>是要交换的参数。
                     </p><pre class="oac_no_warn" dir="ltr">pgadb2i_main（trannum，EMPNO，emprec）</pre><p>因此，必须为每个参数发出PGAU <code class="codeph">DEFINE DATA</code>语句：</p><pre class="oac_no_warn" dir="ltr">DEFINE DATA EMPNO PLSDNAME（EMPNO）使用（通过）语言（IBMVSCOBOLII）（01 EMP-NO PIC X（6）。）; DEFINE DATA EMPREC PLSDNAME（DCLEMP）使用（通过）语言（IBMVSCOBOLII）INFILE（“emp.cob”）;</pre><p>请注意， <code class="codeph">trannum</code>参数不需要定义。这是APPC会话标识符，不需要PGAU中的定义。</p>
                  </div>
               </div><a id="APPUG982"></a><div class="props_rev_3"><a id="GUID-5CB6DA00-C709-43E5-B3D1-3937D097E48F" name="GUID-5CB6DA00-C709-43E5-B3D1-3937D097E48F"></a><h4 id="APPUG-GUID-5CB6DA00-C709-43E5-B3D1-3937D097E48F" class="sect4">CALL通讯</h4>
                  <div>
                     <p>要求同步<a id="d17239e1847" class="indexterm-anchor"></a> APPC <code class="codeph">SEND</code>和<code class="codeph">RECEIVE</code>表示当远程事务程序期望输入数据参数时，它会发出APPC <code class="codeph">RECEIVE</code>来读取数据参数。因此，TIP必须使网关发出APPC <code class="codeph">SEND</code>以将数据参数写入远程事务程序。当远程事务程序发出APPC <code class="codeph">SEND</code>时，TIP还必须使网关发出APPC <code class="codeph">RECEIVE</code> 。
                     </p>
                     <p>PGAU <code class="codeph">DEFINE CALL</code>语句指定客户端应用程序如何<code class="codeph">DEFINE CALL</code>生成的TIP以及与该调用的远程主机事务交换哪些数据参数。每个PGAU <code class="codeph">DEFINE CALL</code>语句可以指定TIP函数的名称，一个或多个数据参数以及每个数据参数的<code class="codeph">IN/OUT</code>模式。必须先使用PGAU <code class="codeph">DEFINE DATA</code>语句<code class="codeph">DEFINE DATA</code> 。有关详细信息，请参阅<span class="q">“</span> <a href="pga-utility-oracle-database-gateway-appc.html#GUID-F73E20E7-D94C-468F-BA65-CC34F6373F19">过程网关管理实用程序</a> <span class="q">”</span>中的<span class="q">“ <a href="pga-utility-oracle-database-gateway-appc.html#GUID-01EEB1ED-7AB6-4BFA-AF6F-A9D36A44C0B1">DEFINE CALL</a> ”</span>和<span class="q">“</span> <a href="admin-utility-samples-oracle-database-gateway-appc.html#GUID-AA9B8762-BDAF-4EED-A8B0-09F8A937F04E">管理实用程序示例</a> <span class="q">”</span>中的<span class="q">“ <a href="admin-utility-samples-oracle-database-gateway-appc.html#GUID-336981E2-C7F9-47C1-8B18-330187556305">示例PGAU DEFINE CALL语句</a> ”</span> 。
                     </p>
                     <p>PGAU <code class="codeph">DEFINE CALL</code>处理将指定信息存储在PG DD中，供PGAU <code class="codeph">GENERATE</code>稍后使用。然后，PGAU <code class="codeph">GENERATE</code>在TIP包规范中创建以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>对于在<code class="codeph">CALL</code>指定的每个<code class="codeph">DATA</code>定义使用PL / SQL参数定义的每个<code class="codeph">CALL</code>的公共PL / SQL函数的声明</p>
                        </li>
                        <li>
                           <p>公共PL / SQL数据参数的声明</p>
                        </li>
                     </ul>
                     <p>客户端应用程序使用PGAU <code class="codeph">DEFINE CALL</code>语句中指定的函数名称和参数列表将TIP公共函数作为PL / SQL函数调用进行<code class="codeph">DEFINE CALL</code> 。客户端应用程序还可以通过引用声明与TIP公共数据参数具有相同数据类型的私有变量，以便于在客户端应用程序中传递和处理数据，从而共享由PGAU <code class="codeph">GENERATE</code>创建的声明。</p>
                     <p>在此示例中，必须发出以下PGAU <code class="codeph">DEFINE CALL</code>语句来定义TIP公共函数：</p><pre class="oac_no_warn" dir="ltr">DEFINE CALL DB2IMAIN PKGCALL（pgadb2i_main）PARMS（（empno IN），（emprec OUT））;</pre></div><a id="APPUG983"></a><div class="props_rev_3"><a id="GUID-0522D9DF-E342-4451-A167-0FD0E5ADD13D" name="GUID-0522D9DF-E342-4451-A167-0FD0E5ADD13D"></a><h5 id="APPUG-GUID-0522D9DF-E342-4451-A167-0FD0E5ADD13D" class="sect5">灵活的呼叫顺序</h5>
                     <div>
                        <p><a id="d17239e1984" class="indexterm-anchor"></a><a id="d17239e1988" class="indexterm-anchor"></a>只要远程事务程序的<code class="codeph">SEND/RECEIVE</code>请求得到满足，每次调用时在TIP和网关之间交换的数据参数的数量可以由用户自行决定。例如，远程事务程序数据交换序列可能是：</p><pre class="oac_no_warn" dir="ltr">APPC SEND 5字段（field1-field5）APPC RECEIVE 1字段（field6）APPC SEND 1字段（field7）APPC RECEIVE 3字段（field8-field10）</pre><p>生成的TIP /应用程序调用序列可以是：</p><pre class="oac_no_warn" dir="ltr">tip_call1（parm1 OUT，&lt; -  APPC SEND field1来自远程TP parm2 OUT，&lt; -  APPC SEND field2来自远程TP parm3 OUT）; &lt; -  APPC SEND field3来自远程TP tip_call2（parm4 OUT，&lt; -  APPC SEND field4来自远程TP parm5 OUT）; &lt; -  APPC SEND field5来自远程TP tip_call3（parm6 IN OUT）; - &gt; APPC RECEIVE field6在远程TP &lt; -  APPC SEND field7从远程TP tip_call4（parm8 IN， - &gt; APPC RECEIVE field8到远程TP parm9 IN， - &gt; APPC RECEIVE field9到远程TP parm10 IN）; - &gt; APPC RECEIVE field10进入远程TP</pre><p>要将这四个公共函数定义到TIP，必须发出四个PGAU <code class="codeph">DEFINE CALL</code>语句，每个语句都指定其唯一的公共函数名称（ <code class="codeph">tip_callx</code> ）和要交换的数据参数列表。一旦使用<code class="codeph">DEFINE DATA</code>定义了数据项，就可以在任何模式（ <code class="codeph">IN</code> ， <code class="codeph">OUT</code>或<code class="codeph">IN OUT</code> ）中多次调用它。例如， <code class="codeph">parm5</code>可以用来代替第二时间<code class="codeph">parm6</code> 。这意味着相同的数据被在这两种情况下进行交换，接收到的TIP和应用上<code class="codeph">tip_call2</code>并返回，可能被更新，以在远程主机<code class="codeph">tip_call4</code> 。
                        </p>
                        <p>另请注意，远程事务程序的前五个写入字段由两个单独的TIP函数调用<code class="codeph">tip_call1</code>和<code class="codeph">tip_call2</code> 。这也可以通过每个<code class="codeph">OUT</code>参数的五个TIP函数调用或具有五个<code class="codeph">OUT</code>参数的单个TIP函数调用等效地完成。然后远程交易程序的第一读字段（ <code class="codeph">field6</code> ）和随后的写入字段（ <code class="codeph">field7</code> ）对应于单个TIP函数调用（ <code class="codeph">tip_call3</code> ）与单个<code class="codeph">IN OUT</code>参数（ <code class="codeph">parm6</code> ）。
                        </p>
                        <p>这种使用单一的<code class="codeph">IN OUT</code>参数意味着远程交易程序的数据类型为<code class="codeph">field6</code>和<code class="codeph">field7</code>都是相同的，并且对应于用于的数据类型执行转换<code class="codeph">parm6</code> 。如果<code class="codeph">field6</code>和<code class="codeph">field7</code>的数据类型不同，那么它们必须对应于不同的PL / SQL参数（例如， <code class="codeph">parm6</code> <code class="codeph">IN</code>和<code class="codeph">parm7</code> <code class="codeph">OUT</code> ）。但是，它们仍然可以在单个TIP呼叫上交换为两个参数，或者在两个TIP呼叫中交换为一个参数。
                        </p>
                        <p>最后，远程事务程序的剩余三个<code class="codeph">RECEIVE</code>字段由<code class="codeph">tip_call4</code>参数8-10提供。它们也可以通过三个TIP调用完成，每个参数传递一个参数，或者两个TIP调用在一个调用中传递一个参数，在另一个调用中传递两个参数，以任一顺序。这种灵活性允许用户以最适合用户的任何方式定义远程交易程序的操作和TIP函数调用之间的对应关系。
                        </p>
                     </div>
                  </div><a id="APPUG984"></a><div class="props_rev_3"><a id="GUID-14708CCA-BE3B-4571-9F1D-CA2158D51816" name="GUID-14708CCA-BE3B-4571-9F1D-CA2158D51816"></a><h5 id="APPUG-GUID-14708CCA-BE3B-4571-9F1D-CA2158D51816" class="sect5">致电通信订单限制</h5>
                     <div>
                        <p><a id="d17239e2145" class="indexterm-anchor"></a>每个TIP公共函数在接收任何<code class="codeph">OUT</code>参数之前首先发送所有<code class="codeph">IN</code>参数。因此，期望发送一个字段然后接收一个字段的远程事务程序必须对应于单独的TIP调用。
                        </p>
                        <p>例如：</p><pre class="oac_no_warn" dir="ltr">tip_callO（parmO OUT）; &lt; -  APPC发送远程TP的外场</pre><p><code class="codeph">PGAXFER</code> RPC首先检查要发送的参数，但是找不到并继续接收参数：</p><pre class="oac_no_warn" dir="ltr">tip_callI（parmI IN）; - &gt; APPC RECEIVE内场到远程TP</pre><p><code class="codeph">PGAXFER</code> RPC处理要发送的参数，然后检查要接收的参数，但找不到并完成;因此，具有<code class="codeph">OUT</code>参数后跟<code class="codeph">IN</code>参数的单个TIP公共函数不起作用，因为首先处理<code class="codeph">IN</code>参数 - 无论其在参数列表中的位置如何。
                        </p>
                     </div>
                  </div>
               </div><a id="APPUG985"></a><div class="props_rev_3"><a id="GUID-21400950-327F-4A8B-831D-3F34333C3264" name="GUID-21400950-327F-4A8B-831D-3F34333C3264"></a><h4 id="APPUG-GUID-21400950-327F-4A8B-831D-3F34333C3264" class="sect4">交易通信</h4>
                  <div>
                     <p>该<a id="d17239e2234" class="indexterm-anchor"></a>远程主机事务使用PGAU <code class="codeph">DEFINE TRANSACTION</code>语句定义，并附加对事务支持的<code class="codeph">CALL</code>的先前定义的引用。
                     </p>
                     <p>你指定了<a id="d17239e2247" class="indexterm-anchor"></a>远程主机事务属性，例如：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>交易ID或名称</p>
                        </li>
                        <li>
                           <p>网络地址或位置</p>
                        </li>
                        <li>
                           <p>系统类型（例如IBM370）</p>
                        </li>
                        <li>
                           <p>Oracle National语言的远程主机</p>
                           <div class="infoboxnote" id="GUID-21400950-327F-4A8B-831D-3F34333C3264__GUID-51349B34-B64C-4BB1-9549-15EC0CACC394">
                              <p class="notep1">注意：</p>
                              <p>该<a id="d17239e2268" class="indexterm-anchor"></a>定义事务时指定PL / SQL包名称;这是引用TIP的名称，以及公共函数调用的名称包含在TIP中。每个公共函数必须先前已使用PGAU <code class="codeph">DEFINE CALL</code>语句定义，该语句已存储在PG DD中。如果未在<code class="codeph">GENERATE</code>语句中指定包名称（TIP名称），则默认情况下，您指定的事务名称将成为包名称。在这种情况下，事务名称（ <span class="italic"><code class="codeph">tname)</code></span>必须是唯一的，并且必须在包含PL / SQL包的数据库中的有效PL / SQL语法中。
                              </p>
                              <p>欲了解更多信息，请参阅<span class="q">“ <a href="pga-utility-oracle-database-gateway-appc.html#GUID-EC8B6848-0566-45CD-BA08-78F15ED0EEB4">定义事务处理</a></span>中的<span class="q">”</span> <a href="pga-utility-oracle-database-gateway-appc.html#GUID-F73E20E7-D94C-468F-BA65-CC34F6373F19">程序网关管理实用程序</a>和<span class="q">“ <a href="admin-utility-samples-oracle-database-gateway-appc.html#GUID-C8F9DE40-9DE6-4F49-A765-BFFDEC3065F9">样品PGAU定义事务处理的声明</a> ”，</span>在<a href="admin-utility-samples-oracle-database-gateway-appc.html#GUID-AA9B8762-BDAF-4EED-A8B0-09F8A937F04E">管理实用程序样本</a> 。
                              </p>
                           </div>
                        </li>
                     </ul>
                     <p>在此示例中，以下<code class="codeph">DEFINE TRANSACTION</code>语句用于定义名为<code class="codeph">DB2I</code>的远程CICS事务：</p><pre class="oac_no_warn" dir="ltr">DEFINE TRANSACTION DB2I CALL（DB2IMAIN，DB2IDIAG）SIDEPROFILE（CICSPROD）TPNAME（DB2I）LOGMODE（ORAPLU62）SYNCLEVEL（0）NLS_LANGUAGE（“AMERICAN_AMERICA.WE8EBCDIC37C”）;</pre></div>
               </div>
            </div><a id="APPUG986"></a><div class="props_rev_3"><a id="GUID-1C0A2278-D220-4DDB-888C-F691D057BB78" name="GUID-1C0A2278-D220-4DDB-888C-F691D057BB78"></a><h3 id="APPUG-GUID-1C0A2278-D220-4DDB-888C-F691D057BB78" class="sect3">从客户端应用程序调用TIP</h3>
               <div>
                  <p>创建TIP后，必须编写客户端应用程序以与TIP接口。调用TIP函数的客户端应用程序必须包含五个逻辑部分：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>声明TIP变量</p>
                     </li>
                     <li>
                        <p>初始化对话</p>
                     </li>
                     <li>
                        <p>交换数据</p>
                     </li>
                     <li>
                        <p>终止谈话</p>
                     </li>
                     <li>
                        <p>错误处理</p>
                     </li>
                  </ul>
               </div><a id="APPUG1304"></a><a id="APPUG1305"></a><a id="APPUG987"></a><div class="props_rev_3"><a id="GUID-26AFD2F9-2126-418D-9B71-B01D2A06E7E6" name="GUID-26AFD2F9-2126-418D-9B71-B01D2A06E7E6"></a><h4 id="APPUG-GUID-26AFD2F9-2126-418D-9B71-B01D2A06E7E6" class="sect4">声明TIP变量</h4>
                  <div>
                     <p><code class="codeph">tipname.doc</code>文件的用户声明部分记录了所需的声明。
                     </p>
                     <p>路过时<a id="d17239e2425" class="indexterm-anchor"></a>调用TIP函数时的PL / SQL参数，客户端应用程序必须使用与TIP函数参数完全相同的PL / SQL数据类型，如其规范部分中的TIP所定义。例如，假设以下是TIP规范或<code class="codeph">tipname.doc:</code></p><pre class="oac_no_warn" dir="ltr">功能<span class="italic">tip_call1</span> <span class="italic">tranuse</span> ，IN BINARY_INTEGER， <span class="italic">tip_var1 io_mode pls_type1，</span> <span class="italic">tip_record io_mode tran_rectype）</span> RETURN INTEGER; TYPE <span class="italic">tran_rectype</span>是RECORD <span class="italic">（rec_field1 pls_type1</span> ，...
      <span class="italic">rec_fieldN pls_typeN）</span> ;</pre><p><a href="developing-appc-client-app-sna-only.html#GUID-26AFD2F9-2126-418D-9B71-B01D2A06E7E6__G1013935" title="这个2列表提供了函数声明的描述。">表4-2</a>提供了函数声明的说明：</p>
                     <div class="tblformal" id="GUID-26AFD2F9-2126-418D-9B71-B01D2A06E7E6__G1013935">
                        <p class="titleintable">表4-2功能声明</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="功能声明" width="100%" border="1" summary="This 2 column table provides a description of the function declaration." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="31%" id="d17239e2472">项目</th>
                                 <th align="left" valign="bottom" width="69%" id="d17239e2475">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d17239e2480" headers="d17239e2472 ">
                                    <p><span class="italic"><code class="codeph">tip_call1</code></span> 
                                    </p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d17239e2480 d17239e2475 ">
                                    <p>TIP函数名称，在包规范中定义。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d17239e2490" headers="d17239e2472 ">
                                    <p><span class="italic"><code class="codeph">tranuse</code></span></p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d17239e2490 d17239e2475 ">
                                    <p>从TIP初始化函数返回的远程事务实例参数，用于标识此TIP调用将在其上交换数据的对话。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d17239e2499" headers="d17239e2472 ">
                                    <p><span class="italic"><code class="codeph">tran_rectype</code></span> 
                                    </p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d17239e2499 d17239e2475 ">
                                    <p>在<code class="codeph">tipname</code>声明的PL / SQL记录数据类型<span class="italic"> </span>提示规范。这与TYPE中的值相同<span class="italic"> </span> <span class="italic"><code class="codeph">tran_rectype</code></span> <code class="codeph">is RECORD</code>语句。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d17239e2522" headers="d17239e2472 ">
                                    <p><span class="italic"><code class="codeph">pls_typeN</code></span></p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d17239e2522 d17239e2475 ">
                                    <p>是PL / SQL原子数据类型。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d17239e2531" headers="d17239e2472 ">
                                    <p><span class="italic"><code class="codeph">rec_fieldN</code></span></p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d17239e2531 d17239e2475 ">
                                    <p>PL / SQL记录字段是否对应于远程事务程序记录字段。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>在客户端应用程序中，PL / SQL原子数据类型应定义为TIP函数定义中相应参数的完全相同的数据类型。应在<code class="codeph">BEGIN</code>命令之前在客户端应用程序中编码以下内容：</p><pre class="oac_no_warn" dir="ltr"><span class="italic">appl_var pls_type1</span> ; / *声明appl变量....* /</pre><p>无需重新定义TIP数据类型。它们必须在客户端应用程序中<code class="codeph">locally</code>声明，在<code class="codeph">BEGIN</code>之前出现在客户端应用程序中：</p><pre class="oac_no_warn" dir="ltr"><span class="italic">appl_record tipname.tran_rectype;</span> / *声明appl记录* /</pre><p><a href="developing-appc-client-app-sna-only.html#GUID-26AFD2F9-2126-418D-9B71-B01D2A06E7E6__G1013965" title="此2列表描述了命令行参数。">表4-3说明</a>了命令行参数：</p>
                     <div class="tblformal" id="GUID-26AFD2F9-2126-418D-9B71-B01D2A06E7E6__G1013965">
                        <p class="titleintable">表4-3命令行参数</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="命令行参数" width="100%" border="1" summary="This 2 column table describes the command line arguments." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="31%" id="d17239e2576">项目</th>
                                 <th align="left" valign="bottom" width="69%" id="d17239e2579">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d17239e2584" headers="d17239e2576 ">
                                    <p><span class="italic"><code class="codeph">tip_call1</code></span> 
                                    </p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d17239e2584 d17239e2579 ">
                                    <p>TIP函数名称，在包规范中定义。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d17239e2594" headers="d17239e2576 ">
                                    <p><span class="italic"><code class="codeph">tranuse</code></span></p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d17239e2594 d17239e2579 ">
                                    <p>从TIP初始化函数返回的远程事务实例参数，用于标识此TIP调用将在其上交换数据的对话。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d17239e2603" headers="d17239e2576 ">
                                    <p><span class="italic"><code class="codeph">tran_rectype</code></span> 
                                    </p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d17239e2603 d17239e2579 ">
                                    <p>在<code class="codeph">tipname</code>声明的PL / SQL记录数据类型<span class="italic"> </span>提示规范。这与<code class="codeph">TYPE</code>值相同<span class="italic">                    </span> <span class="italic"><code class="codeph">tran_rectype</code></span> <code class="codeph">is RECORD</code>语句。
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>有关您可以引用的用户声明的完整说明，请参阅<span class="italic"><code class="codeph">tipname</code></span> <code class="codeph">.doc</code>内容文件。
                     </p>
                     <p>客户端应用程序调用TIP公共函数，就像它是任何本地PL / SQL函数一样：</p><pre class="oac_no_warn" dir="ltr">rc = tip_call1（tranuse，appl_var，appl_record）;</pre><p>在CICS-DB2查询示例中，PL / SQL驱动程序为<code class="codeph">pgadb2id.sql</code> ，即<span class="bold"> </span>位于<code class="codeph">%ORACLE_HOME%\dg4appc\demo\CICS</code> Windows的<code class="codeph">%ORACLE_HOME%\dg4appc\demo\CICS</code>目录和基于UNIX的系统的<code class="codeph">$ORACLE_HOME/dg4appc/demo/CICS</code>目录中，是客户端应用程序，包括以下声明：</p><pre class="oac_no_warn" dir="ltr">......创建或替换过程db2idriv（empno IN CHAR）是tranuse INTEGER：= 0 / *事务使用号* / DCLEMP PGADB2I.DCLEMP_typ; / * DB2 EMP行定义* / DB2 PGADB2I.DB2_typ; / * DB2诊断信息* / rc INTEGER：= 0 / * PGA RPC返回码* /行VARCHAR2（132）; / *工作缓冲区用于输出* / term INTEGER：= 0; / * 1如果pgadb2i_term调用* / ......</pre></div>
               </div><a id="APPUG988"></a><div class="props_rev_3"><a id="GUID-41ABD528-5797-468E-A436-B6B3434ADF34" name="GUID-41ABD528-5797-468E-A436-B6B3434ADF34"></a><h4 id="APPUG-GUID-41ABD528-5797-468E-A436-B6B3434ADF34" class="sect4">初始化对话</h4>
                  <div>
                     <p>打电话给<a id="d17239e2688" class="indexterm-anchor"></a>初始化对话有以下几个目的：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>使PL / SQL包，TIP加载并执行TIP初始化部分中编程的初始化逻辑。</p>
                        </li>
                        <li>
                           <p>使TIP init函数调用<code class="codeph">PGAINIT</code>远程过程调用（RPC），后者又建立与远程事务程序（RTP）的通信，并将事务实例号返回给应用程序。
                           </p>
                        </li>
                     </ul>
                     <p>（可选）初始化对话的调用可用于：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>覆盖默认的RHT / OLTP标识，网络地址属性和对话安全用户标识和密码。</p>
                        </li>
                        <li>
                           <p>指定什么诊断<a id="d17239e2712" class="indexterm-anchor"></a>跟踪TIP是为了生产。有关诊断跟踪的详细信息，请参阅<a href="troubleshooting-oracle-database-gateway-appc.html#GUID-6A2105DD-D6F0-4368-BE63-F8A85D5C959F">故障排除</a> 。
                           </p>
                        </li>
                     </ul>
                     <p>PGAU生成的TIP提供四种不同的初始化函数，客户端应用程序可以调用它们。这些是重载函数，它们都具有相同的名称，但在传递的参数类型方面有所不同。</p>
                     <p>传递三个初始化参数：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>RHT会话标识的事务实例编号。所有TIP初始化都需要<code class="codeph">tranuse</code>参数。
                           </p>
                        </li>
                        <li>
                           <p>TIP运行时诊断控件的TIP诊断标志。<code class="codeph">tipdiag</code>参数是可选的。有关TIP诊断的讨论，请参阅<a href="troubleshooting-oracle-database-gateway-appc.html#GUID-6A2105DD-D6F0-4368-BE63-F8A85D5C959F">故障排除</a> 。
                           </p>
                        </li>
                        <li>
                           <p>覆盖OLTP和网络属性的提示默认覆盖。<code class="codeph">override</code>参数是可选的。
                           </p>
                        </li>
                     </ul>
                     <p>显示以下四个功能，因为它们可能出现在TIP内容文档文件中。稍后提供客户端应用程序使用的示例。</p><pre class="oac_no_warn" dir="ltr">TYPE override_Typ IS RECORD（tranname VARCHAR2（255），/ * Transaction Program * / transync BINARY_INTEGER，/ * RESERVED * / trannls VARCHAR2（50），/ * RESERVED * / oltpname VARCHAR2（255），/ * Logical Unit * / oltpmode VARCHAR2 （255），/ * LOG模式条目* / netaddr VARCHAR2（255），/ * Side Profile * / oltpuser VARCHAR2（8），/ * userid用于OLTP访问* / oltppass VARCHAR2（8））; / * OLTP访问密码* / FUNCTION pgadb2i_init（/ * init standard * / tranuse IN OUT BINARY_INTEGER）RETURN INTEGER;功能pgadb2i_init（/ * init override * / tranuse IN OUT BINARY_INTEGER，覆盖IN override_Typ）RETURN INTEGER;功能pgadb2i_init（/ * init diagnostic * / tranuse IN OUT BNARY_INTEGER，tipdiag IN CHAR）RETURN INTEGER;功能pgadb2i_init（/ * init over-diag * / tranuse IN OUT BINARY_INTEGER，覆盖IN override_Typ，tipdiag IN CHAR）RETURN INTEGER;</pre></div><a id="APPUG989"></a><div class="props_rev_3"><a id="GUID-29DC252A-A067-4092-87B8-80AB1AC6AC04" name="GUID-29DC252A-A067-4092-87B8-80AB1AC6AC04"></a><h5 id="APPUG-GUID-29DC252A-A067-4092-87B8-80AB1AC6AC04" class="sect5">交易实例参数</h5>
                     <div>
                        <p>此事务实例编号（在示例中显示为<code class="codeph">tranuse</code> ）必须传递给后续的TIP交换和终止函数。它向网关标识APPC对话 - 以及远程事务程序的哪次迭代 - 数据将被传输或通信终止。
                        </p>
                        <p>单个客户端应用程序可以同时控制同一远程事务程序或多个不同远程事务程序的多个实例。事务实例编号是TIP的机制，用于通过网关将客户端应用程序调用路由到预期的远程事务程序。</p>
                        <p>客户端应用程序负责保存每个活动事务的事务实例编号，并将正确的事务传递给为该事务调用的每个TIP函数。</p>
                        <p>客户端应用程序调用TIP初始化函数，就好像它是任何本地PL / SQL函数一样。例如：</p><pre class="oac_no_warn" dir="ltr">......tranuse INTEGER：= 0; / *交易使用数* / ......BEGIN rc：= pgadb2i.pgadb2i_init（tranuse）; ......</pre></div>
                  </div><a id="APPUG990"></a><div class="props_rev_3"><a id="GUID-125BF246-33A2-46AF-87E8-7344F3B4F573" name="GUID-125BF246-33A2-46AF-87E8-7344F3B4F573"></a><h5 id="APPUG-GUID-125BF246-33A2-46AF-87E8-7344F3B4F573" class="sect5">覆盖TIP初始化</h5>
                     <div>
                        <p>请注意，在前面的示例中，客户端应用程序未指定任何远程事务程序名称，网络连接或安全信息。TIP将此类信息内部编码为默认值，客户端应用程序只是为所选的远程事务程序调用适当的TIP。但是，客户端应用程序可以选择覆盖某些TIP默认值并提供安全信息。</p>
                        <p>您无需更改任何不需要覆盖的客户端应用程序。</p>
                        <p>在PG DD中定义远程主机事务时， <code class="codeph">DEFINE TRANSACTION</code>语句指定了可以覆盖的某些默认OLTP和网络标识属性：<a id="d17239e2852" class="indexterm-anchor"></a><a id="d17239e2856" class="indexterm-anchor"></a><a id="d17239e2860" class="indexterm-anchor"></a><a id="d17239e2864" class="indexterm-anchor"></a></p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="italic"><code class="codeph">TPNAME</code></span></p>
                           </li>
                           <li>
                              <p><span class="italic"><code class="codeph">LUNAME</code></span></p>
                           </li>
                           <li>
                              <p><code class="codeph">LOGMODE</code></p>
                           </li>
                           <li>
                              <p><span class="italic"><code class="codeph">侧面轮廓</code></span></p>
                           </li>
                        </ul>
                        <p>有关<code class="codeph">DEFINE TRANSACTION</code>语句的更多信息，请参阅<a href="pga-utility-oracle-database-gateway-appc.html#GUID-F73E20E7-D94C-468F-BA65-CC34F6373F19">Procedural Gateway Administration Utility中的</a> <span class="q">“ <a href="pga-utility-oracle-database-gateway-appc.html#GUID-EC8B6848-0566-45CD-BA08-78F15ED0EEB4">DEFINE TRANSACTION</a> ”</span> 。
                        </p>
                        <p>这些PG DD定义的事务属性作为默认值生成到TIP中，并且可以在其中被覆盖<a id="d17239e2904" class="indexterm-anchor"></a>提示初始化时间。这便于使用一个TIP，该TIP可以与测试事务或系统一起使用，并且稍后可以与生产事务或系统一起使用，而不必重新生成TIP。</p>
                        <p><code class="codeph">override_Typ</code>记录数据类型描述了客户端应用程序可以覆盖的各种事务属性。目前支持以下o verrides：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">tranname</code>可以设置为覆盖<code class="codeph">DEFINE TRANSACTION</code>语句的<code class="codeph">TPNAME</code>参数指定的值</p>
                           </li>
                           <li>
                              <p><code class="codeph">oltpname</code>可以设置为覆盖<code class="codeph">DEFINE TRANSACTION</code>语句的<code class="codeph">LUNAME</code>参数指定的值</p>
                           </li>
                           <li>
                              <p><code class="codeph">oltpmode</code>可以设置为覆盖<code class="codeph">DEFINE TRANSACTION</code>语句的<code class="codeph">LOGMODE</code>参数指定的值</p>
                           </li>
                           <li>
                              <p><code class="codeph">netaddr</code>可以设置为覆盖<code class="codeph">DEFINE TRANSACTION</code>语句的<code class="codeph">SIDEPROFILE</code>参数指定的值</p>
                           </li>
                        </ul>
                        <p>除了在中定义的事务属性<a id="d17239e2968" class="indexterm-anchor"></a> PG DD，有两个与安全相关的参数，会话安全用户ID和会话安全密码，可以在TIP初始化时覆盖。这些参数的值通常来自用于访问网关的数据库链接或Oracle数据库会话。有些情况下，Oracle数据库用户标识不足以访问OLTP系统。用户标识和密码重写提供了一种向OLTP系统指定这些参数的方法。
                        </p>
                        <p>目前支持以下覆盖：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">oltpuser</code>可以设置为覆盖用于初始化OLTP对话的用户ID</p>
                           </li>
                           <li>
                              <p><code class="codeph">oltppass</code>可以设置为覆盖用于初始化OLTP对话的密码</p>
                           </li>
                        </ul>
                        <p>仅当在网关初始化文件中指定了<code class="codeph">PGA_SECURITY_TYPE=PROGRAM</code>且OLTP系统配置为接收传入会话请求的用户ID和密码时，安全覆盖才会生效。
                        </p>
                        <p><code class="codeph">transync</code> （APPC <code class="codeph">SYNCLEVEL</code> ）和<code class="codeph">trannls</code> （全球化支持字符集）在覆盖记录数据类型中定义，但保留供将来使用。无法覆盖RHT <code class="codeph">SYNCLEVEL</code>和全球化支持名称。
                        </p>
                        <p>客户端应用程序可能会在TIP初始化时覆盖默认属性，原因如下：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>启动不同版本的RHT（例如生产而不是测试）</p>
                           </li>
                           <li>
                              <p>更改包含RHT的OLTP的位置（如果由于迁移或切换到备份配置而移动了OLTP）</p>
                           </li>
                        </ul>
                        <p>需要覆盖的客户端应用程序可以使用覆盖和初始化参数的任意组合，并且可以随时更改组合，而无需重新生成TIP或影响不覆盖参数的应用程序。</p>
                        <p>要覆盖TIP默认值，必须将其他客户端应用程序记录变量声明为<code class="codeph">override_Typ</code>数据类型，必须将值分配给覆盖子字段，并且必须在客户端应用程序的TIP初始化调用上传递覆盖记录变量。
                        </p>
                        <p>例如：</p><pre class="oac_no_warn" dir="ltr">......my_overrides pgadb2i.override_Typ; -  宣言 ......my_overrides.oltpname：='CICSPROD'; - 交换到生产CICS my_overrides.tranname：='TNEW'; - 新事务名称BEGIN rc：= pgadb2i.pgadb2i_init（tranuse，my_overrides）; -  在里面 ......
</pre><p>在TIP中，检查覆盖属性的语法问题并将其传递给网关服务器。</p>
                     </div>
                  </div><a id="APPUG991"></a><div class="props_rev_3"><a id="GUID-01314972-B6A2-403B-BFD0-81F5BA60F3E2" name="GUID-01314972-B6A2-403B-BFD0-81F5BA60F3E2"></a><h5 id="APPUG-GUID-01314972-B6A2-403B-BFD0-81F5BA60F3E2" class="sect5">安全考虑因素</h5>
                     <div>
                        <p>该<a id="d17239e3061" class="indexterm-anchor"></a><a id="d17239e3065" class="indexterm-anchor"></a>默认和重写的OLTP的安全要求必须相同，因为在任一对话中使用相同的网关服务器，如PGA RPC调用中的数据库链接名称所指示的那样。网关服务器启动安全模式在网关服务器初始化时设置，并在TIP或会话初始化时未更改地传递给OLTP。
                        </p>
                     </div>
                  </div>
               </div>
            </div><a id="APPUG992"></a><div class="props_rev_3"><a id="GUID-62418ADB-1A9B-4DCC-A2D5-70940D7ECBFC" name="GUID-62418ADB-1A9B-4DCC-A2D5-70940D7ECBFC"></a><h3 id="APPUG-GUID-62418ADB-1A9B-4DCC-A2D5-70940D7ECBFC" class="sect3">交换数据</h3>
               <div>
                  <div class="section">
                     <p>客户端应用程序应传递从先前的<code class="codeph">tip_init</code>调用返回的事务实例号，以识别受影响的远程事务程序，并识别要与远程事务程序交换的任何客户端应用程序数据参数。
                     </p>
                     <p>在此CICS-DB2查询示例中，我们传递员工编号并接收员工记录：</p><pre class="oac_no_warn" dir="ltr">rc = pgadb2i.pgadb2i_main（tranuse，/ * transfer data * / empno，/ *员工编号* / DCLEMP）; / *返回员工记录* /</pre></div>
                  <!-- class="section" -->
               </div><a id="APPUG993"></a><div class="props_rev_3"><a id="GUID-3CDB9504-3937-4909-A6FE-3B63FC25BF75" name="GUID-3CDB9504-3937-4909-A6FE-3B63FC25BF75"></a><h4 id="APPUG-GUID-3CDB9504-3937-4909-A6FE-3B63FC25BF75" class="sect4">终止对话</h4>
                  <div>
                     <p>客户端应用程序调用TIP终止函数，就好像它是任何本地PL / SQL函数一样。例如：</p><pre class="oac_no_warn" dir="ltr">......术语：= 1; / *表示名为* * / rc的术语：= pgadb2i.pgadb2i_term（tranuse，0）; / *正常终止* / ......
</pre><p>在TIP终止调用上传递事务实例号以终止事务之后，或者在远程事务程序已经终止之后，可能忘记该特定事务实例号。</p>
                  </div>
               </div><a id="APPUG994"></a><div class="props_rev_3"><a id="GUID-4A799962-BFF3-47FD-AB6D-C99474E157D8" name="GUID-4A799962-BFF3-47FD-AB6D-C99474E157D8"></a><h4 id="APPUG-GUID-4A799962-BFF3-47FD-AB6D-C99474E157D8" class="sect4">错误处理</h4>
                  <div>
                     <p>客户端应用程序应包含一个异常处理程序，可以在客户端应用程序终止之前清除任何活动的APPC对话。<code class="codeph">pgadb2id.sql</code>中提供的示例客户端应用程序包含异常处理的示例。
                     </p>
                     <p>网关例外报告在PGA-20900至PGA-20999范围内。发生异常时，应为先前调用TIP初始化函数启动的任何活动对话调用TIP终止函数。</p>
                     <p>例如：</p><pre class="oac_no_warn" dir="ltr">如果等于等于等于等于0，则终止函数尚未被调用* / rc：= pgadb2i.pgadb2i_term（tranuse，1）; / *异常终止* / END IF;提高; ......
</pre><p>远程事务还应包括错误处理和调试的规定，例如将调试信息写入CICS临时存储队列区域。有关如何拦截和处理Oracle异常的讨论，请参阅<a href="../lnpls/plsql-error-handling.html#LNPLS00701" target="_blank"><span class="italic">Oracle数据库PL / SQL语言参考</span></a> 。
                     </p>
                  </div>
               </div><a id="APPUG995"></a><div class="props_rev_3"><a id="GUID-4FFF7E49-C061-4A57-A575-3EF98E2A1E50" name="GUID-4FFF7E49-C061-4A57-A575-3EF98E2A1E50"></a><h4 id="APPUG-GUID-4FFF7E49-C061-4A57-A575-3EF98E2A1E50" class="sect4">授予执行权限</h4>
                  <div>
                     <div class="section">
                        <p>TIP是一个标准<a id="d17239e3264" class="indexterm-anchor"></a>必须向从客户端应用程序调用TIP的用户授予PL / SQL包和执行权限。在这个例子中，我们将<code class="codeph">PGADB2I</code>包的执行权授予用户<code class="codeph">SCOTT</code> ：</p><pre class="oac_no_warn" dir="ltr">授予PGADB2I到SCOTT的授权</pre><p>有关详细信息，请参阅“ <a href="../admin/getting-started-with-database-administration.html#ADMIN11062" target="_blank"><span class="italic">Oracle数据库管理员指南”</span></a> 。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="APPUG996"></a><div class="props_rev_3"><a id="GUID-19815A38-8520-41D5-9418-2DB46AFDB9AA" name="GUID-19815A38-8520-41D5-9418-2DB46AFDB9AA"></a><h3 id="APPUG-GUID-19815A38-8520-41D5-9418-2DB46AFDB9AA" class="sect3">执行申请</h3>
               <div>
                  <div class="section">
                     <p>在执行客户端应用程序之前，请确保已建立与主机的连接并且接收伙伴可用。在此示例中，我们使用PL / SQL驱动程序<code class="codeph">DB2IDRIV</code>来执行CICS-DB2查询。要执行此客户端应用程序，请从SQL * Plus输入：</p><pre class="oac_no_warn" dir="ltr">在执行DB2IDRIV（ <span class="italic">'nnnnnn'</span> <span class="italic"><code class="codeph">)</code></span>设置serveroutput;</pre></div>
                  <!-- class="section" -->
               </div>
            </div><a id="APPUG997"></a><div class="props_rev_3"><a id="GUID-E02BE2D4-97BA-407C-B1D6-4503D79561D7" name="GUID-E02BE2D4-97BA-407C-B1D6-4503D79561D7"></a><h3 id="APPUG-GUID-E02BE2D4-97BA-407C-B1D6-4503D79561D7" class="sect3">APPC对话共享</h3>
               <div>
                  <p>多个TIP可以与一个或多个共享相同的APPC对话<a id="d17239e3375" class="indexterm-anchor"></a>远程主机事务（RHT），它们也共享同一个对话。这个功能有两个好处：<a id="d17239e3380" class="indexterm-anchor"></a></p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>Oracle Database Gateway for APPC支持依赖于对话的传递控制的现有RHT。</p>
                     </li>
                     <li>
                        <p>对于PL / SQL编译而言太大的TIP可以分成多个较小的TIP，每个TIP具有较少的用户定义函数，为客户端应用程序提供相同的函数调用和数据定义集，而无需对RHT进行任何更改。</p>
                     </li>
                  </ul>
               </div><a id="APPUG998"></a><div class="props_rev_3"><a id="GUID-7C9B4EAB-3D8C-4DF0-8E32-F45845336F1A" name="GUID-7C9B4EAB-3D8C-4DF0-8E32-F45845336F1A"></a><h4 id="APPUG-GUID-7C9B4EAB-3D8C-4DF0-8E32-F45845336F1A" class="sect4">APPC会话共享概念</h4>
                  <div>
                     <p>大型机OLTP（例如IMS）允许事务通过在事务调用另一个事务时传递它来共享单个APPC对话。RHT被定义为PGAU，作为具有调用，输入和输出的单个事务，PGAU为其生成具有与该特定RHT对应的初始化，传输和终止功能的单个TIP。</p>
                     <p>每个TIP生成的逻辑允许TIP：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>在调用init函数时启动新会话，或者</p>
                        </li>
                        <li>
                           <p>在调用用户定义的函数时传输现有会话上的数据，或者</p>
                        </li>
                        <li>
                           <p>在调用其“term”函数时终止现有会话。</p>
                        </li>
                     </ul>
                     <p>APPC对话被视为由多个TIP共享和管理的资源。不要求任何TIP成为APPC对话的唯一用户。</p>
                     <p>任何<a id="d17239e3447" class="indexterm-anchor"></a>在3.4.0或更高版本生成的TIP可以执行以下任何服务组合：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>发起</p>
                        </li>
                        <li>
                           <p>启动和转移</p>
                        </li>
                        <li>
                           <p>启动，转移和终止（标准操作）</p>
                        </li>
                        <li>
                           <p>传递</p>
                        </li>
                        <li>
                           <p>转移和终止</p>
                        </li>
                        <li>
                           <p>终止</p>
                        </li>
                        <li>
                           <p>启动和终止（假设其他TIP执行转移）</p>
                        </li>
                     </ul>
                     <p>可以通过以下方式共享单个APPC对话：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>从一个TIP到多个RHT</p>
                        </li>
                        <li>
                           <p>从多个TIP到一个RHT</p>
                        </li>
                        <li>
                           <p>从多个TIP到多个RHT</p>
                        </li>
                     </ul>
                     <p>如果没有APPC会话共享，则必须定义单个TIP，其中包含客户端应用程序可能需要调用的所有RHT的所有功能和数据。使用RHT的超集创建TIP通常会导致此类TIP过大而无法编译PL / SQL。</p>
                     <p>相反，通过APPC会话共享，可以在单个TIP中定义每个RHT（甚至用于执行多个不同数据交换操作的RHT的每个RHT数据交换），该TIP更小并且不太可能超过PL / SQL编译限制。</p>
                  </div>
               </div><a id="APPUG999"></a><div class="props_rev_3"><a id="GUID-D7BCC8CE-C9A1-479E-B53E-53EFCFEB44F8" name="GUID-D7BCC8CE-C9A1-479E-B53E-53EFCFEB44F8"></a><h4 id="APPUG-GUID-D7BCC8CE-C9A1-479E-B53E-53EFCFEB44F8" class="sect4">APPC会话共享使用</h4>
                  <div>
                     <p>APPC会话共享在3.4.0或更高版本生成的每个TIP中自动可用。3.4.0之前没有生成的TIP可以参与APPC会话共享。必须使用PGAU 3.4.0重新生成3.4.0之前生成的TIP。或者以后参加APPC会话分享。PGAU向上兼容，再生应该是透明的，只要重新编译再生的TIP体（ <span class="italic"><code class="codeph">tipname</code></span> <code class="codeph">.pkb</code> ）。如果还重新编译TIP规范，则客户端应用程序也需要重新编译。有关更多详细信息，请参阅<a href="tip-internals-oracle-database-gateway-appc.html#GUID-9F4E3177-13B0-43CE-AD0A-5BCD66B3FD17">Tip Internals</a> 。
                     </p>
                     <p>如先前在第1,2和3章中讨论的那样完成TIP的定义和生成。不需要指定其他选项或参数。</p>
                     <p><a id="d17239e3541" class="indexterm-anchor"></a>运行时使用APPC会话共享受客户端应用程序的控制。它只需通过调用其中一个共享对话的TIP的init函数并将返回的<code class="codeph">tranuse</code>值传递给其他TIP函数来完成，因为每个函数都以其所需的顺序调用。可以使用任何TIP初始化函数，前提是所有TIP都使用相同的<code class="codeph">DEFINE TRANSACTION TPNAME</code>或<code class="codeph">SIDEPROFILE</code>值定义。<code class="codeph">TPNAME</code>或<code class="codeph">SIDEPROFILE</code>值指定要初始化的RHT。
                     </p>
                     <p>当调用支持APPC会话共享的TIP的init功能来初始化会话时，返回的<code class="codeph">tranuse</code>值表示启用了会话共享。通过在其他TIP中调用函数时传递相同的<code class="codeph">tranuse</code>值，那些其他TIP在已初始化的同一对话上执行传输，前提是所涉及的所有TIP都是在3.4.0或更高版本生成的。
                     </p>
                  </div>
               </div><a id="APPUG1000"></a><div class="props_rev_3"><a id="GUID-5B01C80D-5FC0-45B8-B17B-D1BDBD882BD7" name="GUID-5B01C80D-5FC0-45B8-B17B-D1BDBD882BD7"></a><h4 id="APPUG-GUID-5B01C80D-5FC0-45B8-B17B-D1BDBD882BD7" class="sect4">APPC会话共享TIP兼容性</h4>
                  <div>
                     <p>TIPs产生于3.4.0或更高版本<a id="d17239e3612" class="indexterm-anchor"></a>与3.4.0之前的TIP相比，数据库网关使用并期望不同的<code class="codeph">tranuse</code>值。如果使用3.4.0之前的TIP初始化会话并将其<code class="codeph">tranuse</code>值传递给3.4.0或更高版本的TIP，则会引发以下异常：</p><pre class="oac_no_warn" dir="ltr">ORA-20704 PGA_TIP：无法共享tranuse值</pre><p>但是，3.4.0之前生成的TIP不会检测共享对话的不同<code class="codeph">tranuse</code>值，这可能会导致不可预测的错误。
                     </p>
                     <div class="infoboxnote" id="GUID-5B01C80D-5FC0-45B8-B17B-D1BDBD882BD7__GUID-83D84FD1-D319-4532-A54A-E4A07FD62E59">
                        <p class="notep1">注意：</p>
                        <p>必须在3.4.0或更高版本生成在共享对话中调用的所有TIP。</p>
                        <p>3.4.0之前没有生成的TIP可以参与APPC会话共享。</p>
                     </div>
                     <p><code class="codeph">tranuse</code>值在3.4.0之前和3.4.0或更高版本之间不兼容。由于以下原因，这不应该对您造成问题：在3.4.0之前，必须通过该TIP函数调用TIP中定义的所有RHT函数，并且必须首先调用相同TIP的init函数来初始化会话。<code class="codeph">tranuse</code>值仅对初始化它的TIP有效。因此，除非您进行编程更改，否则现有应用程序无法意外地混合<code class="codeph">tranuse</code>值。
                     </p>
                     <p>3.4.0之前的TIP和客户端应用程序可以继续使用而无需更改，旧的客户端应用程序可以无需更改即可调用新的3.4.0或更高版本的TIP。当旧的TIP体被重新生成和编译时，这是可能的。即使旧的客户端应用程序没有改变，TIP现在也能够进行APPC会话共享。</p>
                     <p>3.4.0之前的TIP的所有功能都不能共享APPC会话。但是，一旦TIP在3.4.0或更高版本重新生成，其任何功能都可以共享APPC对话。</p>
                  </div>
               </div><a id="APPUG1306"></a><a id="APPUG1001"></a><div class="props_rev_3"><a id="GUID-CA0E1792-1F88-4DA0-BFCC-D4F40F7B5673" name="GUID-CA0E1792-1F88-4DA0-BFCC-D4F40F7B5673"></a><h4 id="APPUG-GUID-CA0E1792-1F88-4DA0-BFCC-D4F40F7B5673" class="sect4">针对过大的TIP的APPC会话共享</h4>
                  <div>
                     <p><a id="d17239e3692" class="indexterm-anchor"></a>您可以使用会话共享来规避太大而无法编译的TIP。这是由' <code class="codeph">PLS-00123 - package too large to compile</code> '或其他一些问题症状如PL / SQL编译挂起来识别的。在这种情况下，您必须选择要从之前的TIP中删除哪些函数调用并定义为新的TIP。
                     </p>
                     <p>具体来说，你必须决定哪个<a id="d17239e3704" class="indexterm-anchor"></a><a id="d17239e3708" class="indexterm-anchor"></a> PGAU <code class="codeph">DEFINE CALL</code>语句及其相关内容<a id="d17239e3714" class="indexterm-anchor"></a><a id="d17239e3716" class="indexterm-anchor"></a>应将<code class="codeph">DEFINE DATA</code>语句从旧的PGAU控制文件（ <code class="codeph">.ctl</code> ）移动到一个或多个新的PGAU控制文件中。此外，您必须决定在定义每个新TIP的每个新PGAU控制文件中应包含哪些P GAU <code class="codeph">DEFINE TRANSACTION</code>语句。</p>
                     <p>你必须考虑几个PGAU陈述;有关PGAU语句及其说明的列表，请参阅<a href="developing-appc-client-app-sna-only.html#GUID-CA0E1792-1F88-4DA0-BFCC-D4F40F7B5673__G1013981" title="这2列表列出了PGAU语句及其描述">表4-4</a> ：</p>
                     <div class="tblformal" id="GUID-CA0E1792-1F88-4DA0-BFCC-D4F40F7B5673__G1013981">
                        <p class="titleintable">表4-4 PGAU语句</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="PGAU声明" width="100%" border="1" summary="This 2 column table lists the PGAU statements and their descriptions" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="31%" id="d17239e3754">声明</th>
                                 <th align="left" valign="bottom" width="69%" id="d17239e3757">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d17239e3762" headers="d17239e3754 ">
                                    <p><code class="codeph">DEFINE DATA</code>语句</p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d17239e3762 d17239e3757 ">
                                    <p>必须是独特的。它们可以由所有受影响的PGAU控制文件共享，前提是它们在被<code class="codeph">DEFINE CALL</code>语句引用之前被定义为过程网关数据字典（PG DD）。这些陈述无需更改。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d17239e3774" headers="d17239e3754 ">
                                    <p><code class="codeph">DEFINE CALL</code>语句</p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d17239e3774 d17239e3757 ">
                                    <p>必须是独特的。它们只需要包含它们的TIP的新<code class="codeph">DEFINE TRANSACTION</code>语句引用，只要它们在被<code class="codeph">DEFINE TRANSACTION</code>语句引用之前定义到PG DD即可。可以选择将<code class="codeph">DEFINE CALL</code>语句移动到包含它们的TIP的新PGAU控制文件中。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d17239e3792" headers="d17239e3754 ">
                                    <p><code class="codeph">DEFINE TRANSACTION</code>声明</p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d17239e3792 d17239e3757 ">
                                    <p>为每个期望的新TIP指定，并将引用从前一个大TIP移动到新的小TIP的那些呼叫定义。没有任何交易属性会改变。这允许任何新的TIP使用与前一个大TIP相同的RHT执行相同的初始化或终止。旧的<code class="codeph">DEFINE TRANSACTION</code>语句（以前的大型TIP）现在应该排除任何被移动到新的小TIP的调用定义。
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
               </div><a id="APPUG1307"></a><a id="APPUG1308"></a><a id="APPUG1309"></a><a id="APPUG1002"></a><div class="props_rev_3"><a id="GUID-7194BAD8-2440-48AE-BF6C-3A9BEB8CCF8F" name="GUID-7194BAD8-2440-48AE-BF6C-3A9BEB8CCF8F"></a><h4 id="APPUG-GUID-7194BAD8-2440-48AE-BF6C-3A9BEB8CCF8F" class="sect4">APPC对话共享示例</h4>
                  <div>
                     <p>假设存在RHT <code class="codeph">A</code> ， <code class="codeph">B</code>和<code class="codeph">C</code> ，并且RHT <code class="codeph">A</code>执行菜单选择并调用RHT <code class="codeph">B</code>用于查询函数，或调用RHT <code class="codeph">C</code>用于更新，然后是select函数。
                     </p>
                     <p>您可以定义以下<code class="codeph">DATA</code>和<code class="codeph">CALL</code> ：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">DEFINE DATA</code> <span class="italic"><code class="codeph">choice ...</code></span> 
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">DEFINE DATA</code> <span class="italic"><code class="codeph">input ...</code></span> 
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">DEFINE DATA</code> <span class="italic"><code class="codeph">answer ...</code></span></p>
                        </li>
                        <li>
                           <p><code class="codeph">DEFINE DATA</code> <span class="italic"><code class="codeph">record ...</code></span></p>
                        </li>
                        <li>
                           <p><code class="codeph">DEFINE CALL menu_一个callname（pick）parms（选择）;</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">DEFINE CALL query_B callname（query）parms（（输入），（answer out））;</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">DEFINE CALL update_C callname（update）parms（record in）;</code> 
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">DEFINE CALL select_C callname（select）parms（记录输出）;</code></p>
                        </li>
                     </ul>
                     <p>可以定义以下示例TIP：</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-7194BAD8-2440-48AE-BF6C-3A9BEB8CCF8F__GUID-5B4B8ECC-AC78-4EF8-BABB-EF572686AACE">例1</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>此示例不使用APPC会话共享，但它是在版本3.4.0之前创建的有效TIP定义，它结合了RHT <code class="codeph">A</code> ， <code class="codeph">B</code>和<code class="codeph">C</code> 。</p><pre class="oac_no_warn" dir="ltr">DEFINE TRANSACTION rhtABC调用（menu_A，query_B，update_C，select_C）tpname（RHTA）;</pre><p>此TIP包括所有数据定义和调用，可能太大而无法编译。此TIP不使用APPC会话共享，因为只有一个TIP， <code class="codeph">rhtABC</code> 。但是，RHT会在远程主机上执行正常的会话共享。如果TIP足够小以进行编译，则客户端应用程序调用TIP函数，如下所示：</p><pre class="oac_no_warn" dir="ltr">rc：= rhtABC.rhtABC_init（tranuse）; rc：= rhtABC.pick（tranuse，choice）; rc：= rhtABC.query（tranuse，input，answer）; rc：= rhtABC.update（tranuse，record）; rc：= rhtABC.select（tranuse，record）; rc：= rhtABC.rhtABC_term（tranuse）;</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-7194BAD8-2440-48AE-BF6C-3A9BEB8CCF8F__GUID-DD54E1E7-B689-4945-8135-44BB7EBEDE53">例2</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>此示例演示如何使用APPC会话共享定义一组TIP，将RHT <code class="codeph">A</code> ， <code class="codeph">B</code>和<code class="codeph">C</code>分为三个TIP：</p><pre class="oac_no_warn" dir="ltr">DEFINE TRANSACTION rhtA调用（menu_A）tpname（RHTA）; DEFINE TRANSACTION rhtB调用（query_B）tpname（RHTA）; DEFINE TRANSACTION rhtC调用（update_C，select_C）tpname（RHTA）;</pre><p>每个TIP仅包括它所需的呼叫和数据，并且每个TIP自动执行APPC会话共享。客户端应用程序调用这些函数如下：</p><pre class="oac_no_warn" dir="ltr">rc：= rhtA.rhtA_init（tranuse）; rc：= rhtA.pick（tranuse，choice）; rc：= rhtB.query（tranuse，input，answer）; rc：= rhtC.update（tranuse，record）; rc：= rhtC.select（tranuse，record）; rc：= rhtB.rhtB_term（tranuse）;</pre><p>两个示例之间唯一的客户端应用程序区别在于每个TIP调用的模式限定符。这是因为被调用的函数位于不同的TIP中，该TIP在数据库中具有不同的包名称。</p>
                        <p>只需要新的<code class="codeph">DEFINE TRANSACTION</code>语句即可使用APPC会话共享。<code class="codeph">CALL</code>和<code class="codeph">DATA</code>定义按原样使用。这意味着旧的TIP <code class="codeph">rhtABC</code>仍然按原样定义，并且可能仍然太大而无法编译。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-7194BAD8-2440-48AE-BF6C-3A9BEB8CCF8F__GUID-ED341DA9-8EA1-466F-822A-7D99BC723ABC">例3</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>如果您执行了示例2，但仍然认为TIP可能太大而无法编译，请尝试以下操作：</p><pre class="oac_no_warn" dir="ltr">DEFINE TRANSACTION rhtABC调用（menu_A）tpname（RHTA）; DEFINE TRANSACTION rhtB调用（query_B）tpname（RHTA）; DEFINE TRANSACTION rhtCU调用（update_C）tpname（RHTA）; DEFINE TRANSACTION rhtCS调用（select_C）tpname（RHTA）;</pre><p>提示<code class="codeph">rhtABC</code>删除了三个函数，因此它现在更小，更有可能编译。提示<code class="codeph">rhtB</code>具有一个功能，即使相应的主机功能保留在单个RHT中，TIP <code class="codeph">rhtC</code>也已被分成两个TIP。</p>
                        <p>客户端应用程序调用这些函数如下：</p><pre class="oac_no_warn" dir="ltr">rc：= rhtB.rhtB_init（tranuse）; rc：= rhtABC.pick（tranuse，choice）; rc：= rhtB.query（tranuse，input）; rc：= rhtCU.update（tranuse，record）; rc：= rhtCS.select（tranuse，record）; rc：= rhtABC.rhtABC_term（tranuse）;</pre><p>使用不同的TIP进行初始化，说明所有TIP都包含init和term函数，并且因为<code class="codeph">DEFINE TRANSACTION</code>语句都指定了相同的<code class="codeph">tpname(RHTA)</code> ，所以始终调用相同的远程主机事务进行初始化。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="APPUG1003"></a><div class="props_rev_3"><a id="GUID-B04E6B1E-4AA9-4CD2-8976-A19B782D99C1" name="GUID-B04E6B1E-4AA9-4CD2-8976-A19B782D99C1"></a><h4 id="APPUG-GUID-B04E6B1E-4AA9-4CD2-8976-A19B782D99C1" class="sect4">APPC会话共享覆盖和诊断</h4>
                  <div>
                     <p><a id="d17239e4060" class="indexterm-anchor"></a> TIP默认覆盖参数在TIP初始化函数中处理，该函数被调用以执行初始化。一旦建立了APPC会话，就不需要进一步共享覆盖参数。除了将覆盖传递给TIP初始化函数之外，您无需做任何其他事情。
                     </p>
                     <p><a id="d17239e4066" class="indexterm-anchor"></a> TIP诊断参数在共享给定对话的所有TIP之间共享。实际上，请求对TIP执行初始化的诊断导致对共享该对话的所有TIP请求相同的诊断。仅可以从一个共享对话的TIP请求诊断是不可能的。应用程序设计者或用户只需将TIP运行时跟踪控件传递给TIP初始化函数。
                     </p>
                  </div>
               </div>
            </div><a id="APPUG1004"></a><div class="props_rev_3"><a id="GUID-2F5FD89A-06E6-47DF-84CD-525B6515B25F" name="GUID-2F5FD89A-06E6-47DF-84CD-525B6515B25F"></a><h3 id="APPUG-GUID-2F5FD89A-06E6-47DF-84CD-525B6515B25F" class="sect3">支持多字节字符集的应用程序开发</h3>
               <div>
                  <p><a id="d17239e4114" class="indexterm-anchor"></a> COBOL目前只支持<a id="d17239e4119" class="indexterm-anchor"></a>双字节字符集（ <a id="d17239e4124" class="indexterm-anchor"></a> DBCS）for <a id="d17239e4129" class="indexterm-anchor"></a> <code class="codeph">PIC G</code>数据类型。
                  </p>
                  <p>PGAU将COBOLII <code class="codeph">PIC G</code>数据类型作为PL / SQL <code class="codeph">VARCHAR2</code>变量处理，并生成TIP，根据为远程主机数据和本地Oracle数据指定的Oracle <code class="codeph">NLS_LANGUAGE</code>自动转换数据。
                  </p>
                  <p>可以将这些Oracle <code class="codeph">NLS_LANGUAGE</code>指定为TIP与远程事务交换的所有<code class="codeph">PIC G</code>数据的默认值（请参阅<code class="codeph">DEFINE TRANSACTION</code> <code class="codeph">...</code><code class="codeph">REMOTE_MBCS</code>或<code class="codeph">LOCAL_MBCS</code> ）。可以进一步覆盖任何单个<code class="codeph">PIC G</code>数据项的Oracle <code class="codeph">NLS_LANGUAGE</code> （请参阅<code class="codeph">REDEFINE DATA</code> <code class="codeph">...</code><code class="codeph">REMOTE</code>或<code class="codeph">LOCAL_LANGUAGE</code> ）。
                  </p>
                  <p>DBCS数据可以以受支持的DBCS字符集的任意组合进行编码。例如，Oracle数据库网关支持一个远程主机应用程序，该应用程序允许记录中每个数据字段使用不同的代码页<a id="d17239e4186" class="indexterm-anchor"></a> MBCS <a id="d17239e4189" class="indexterm-anchor"></a>支持。
                  </p>
                  <p>使用<code class="codeph">REDEFINE DATA ...还支持<code class="codeph">PIC X</code>项目上的REMOTE_LANGUAGE</code>或<code class="codeph">LOCAL_LANGUAGE</code> 。因此，除了剩余的<code class="codeph">PIC X</code>数据字段的默认SBCS转换之外，TIP还可以对指定的<code class="codeph">PIC X</code>数据字段执行DBCS或MBCS转换。默认SBCS转换是根据<code class="codeph">DEFINE TRANSACTION...NLS_LANGUAGE</code>和本地Oracle默认<code class="codeph">LANGUAGE</code>环境值。
                  </p>
                  <p>当PGAU生成TIP时， <code class="codeph">PIC G</code>数据类型将转换为PL / SQL <code class="codeph">VARCHAR2</code>数据类型。通过TIP转换后，由于删除了shift-out和shift-in元字符，收到的<code class="codeph">'PIC G' VARCHAR2</code>数据类型的长度可以小于最大值，并且发送的<code class="codeph">'PIC G'</code> G'RAWs将具有移出和移位-in根据指定的远程主机字符集的要求插入字符。
                  </p>
                  <p>这与为<code class="codeph">PIC X</code>数据执行的转换不同，后者始终是已知的固定长度，因此<code class="codeph">CHAR</code>数据类型在TIP中用于<code class="codeph">PIC X</code>数据字段。但是，即使<code class="codeph">PIC X</code>字段包含DBCS或MBCS数据，仍然会使用<code class="codeph">CHAR</code>变量，并在需要时填充空白。
                  </p>
                  <p>某些远程主机应用程序将<code class="codeph">PIC G</code>字段与<code class="codeph">PIC X</code>字节组合在一起，用于移出，移入元字符插入。这样的COBOL定义可能如下所示：</p><pre class="oac_no_warn" dir="ltr">01 MY_RECORD。 05 SO PIC X. 05 MY_SBCS_DATA PIC G（52）。05 SI PIC X.</pre><p>PGAU无法正确处理这一点，因为在执行转换时，所有三个字段都被定义并因此被视为单独的数据项。</p>
                  <p>要正确处理，输入到PGAU的定义应为：</p><pre class="oac_no_warn" dir="ltr">01 MY_RECORD。 05 MY_MBCS_DATA PIC G（51）。
</pre><p>PGAU <code class="codeph">REDEFINE DATA</code>语句可以通过在字段<code class="codeph">SO</code>和<code class="codeph">SI</code>以及<code class="codeph">'05 MY_MBCS_DATA PIC G(51).'</code>上指定<code class="codeph">USAGE(SKIP)</code>来将3字段定义重新定义为1字段定义<code class="codeph">'05 MY_MBCS_DATA PIC G(51).'</code>重新定义<code class="codeph">MY_MBCS_DATA</code> 。三个<code class="codeph">REDEFINE</code>语句可以放在PGAU输入控制文件中，因此不需要更改远程主机定义。
                  </p>
               </div>
            </div><a id="APPUG1005"></a><div class="props_rev_3"><a id="GUID-B118F27C-0B26-4429-8B70-3CC5B01C6A93" name="GUID-B118F27C-0B26-4429-8B70-3CC5B01C6A93"></a><h3 id="APPUG-GUID-B118F27C-0B26-4429-8B70-3CC5B01C6A93" class="sect3">修改面向终端的事务以使用APPC</h3>
               <div>
                  <p><a id="d17239e4322" class="indexterm-anchor"></a><a id="d17239e4326" class="indexterm-anchor"></a>远程事务程序必须包括映射的APPC动词以启动，通信和终止APPC对话。但是，当远程事务程序面向终端时，可以使用以下选项：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>您可以将终端逻辑与应用程序和I / O逻辑分开。一旦实现这种分离，就可以编写一个小的前端远程事务程序，以便在网关调用和事务应用程序逻辑之间进行接口。例如，在CICS中，CICS <code class="codeph">LINK</code>用于实现此技术。
                        </p>
                     </li>
                     <li>
                        <p>您可以修改现有程序，以便嵌入APPC调用。在示例<code class="codeph">PGADB2I</code> ，我们使用CICS及其关联的映射APPC动词，如下所示：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>EXEC CICS <code class="codeph">ASSIGN</code>接受网关发起的对话。
                              </p>
                           </li>
                           <li>
                              <p>EXEC CICS <code class="codeph">RECEIVE</code>接收参数。
                              </p>
                           </li>
                           <li>
                              <p>EXEC CICS <code class="codeph">SEND</code>结束结果。
                              </p>
                           </li>
                           <li>
                              <p>EXEC CICS <code class="codeph">RETURN</code>终止对话。
                              </p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>如果您不想修改面向终端的事务，则可以在面向终端的程序和网关之间插入支持APPC的接口，例如IBM Corporation的面向z / OS的CICS Transaction Server的FEPI。</p>
                     </li>
                     <li>
                        <p>使用IMS / TM，可以使用隐式APPC工具通过网关访问现有的未修改IMS事务。使用隐式APPC，当通过APPC调用IMS事务时，使用I / O PCB的标准DLI GU，GN和ISRT调用将自动转换为适当的APPC发送或接收调用。<a id="d17239e4375" class="indexterm-anchor"></a></p>
                     </li>
                  </ul>
               </div>
            </div><a id="APPUG1006"></a><div class="props_rev_3"><a id="GUID-8E530425-F978-4095-8A39-B8FD8BE2A47A" name="GUID-8E530425-F978-4095-8A39-B8FD8BE2A47A"></a><h3 id="APPUG-GUID-8E530425-F978-4095-8A39-B8FD8BE2A47A" class="sect3">使用TIP所需的权限</h3>
               <div>
                  <p>必须向TIP或过程的调用者显式授予执行权限。无法通过角色授予此权限。</p>
                  <p>任何想要跟踪TIP的TIP用户都必须被授予对rtrace和ptrace过程的执行权限。有关详细信息，请参阅安装指南中适用于您的通信协议的章节中的“配置PGAU”部分。</p>
                  <p>例如，在Microsoft Windows上：</p><pre class="oac_no_warn" dir="ltr">C：\&gt; sqlplus pgaadmin \ <span class="italic">pw @ database_specification_string</span> SQL&gt;将<span class="italic">pgaadmin.purge_trace</span>上的执行权授予<span class="italic">tip_user_userid</span> ; SQL&gt;将<span class="italic">pgaadmin.read_trace</span>上的执行权限授予<span class="italic">tip_user_userid;</span> 
</pre><p>在基于UNIX的系统上：</p><pre class="oac_no_warn" dir="ltr">$ sqlplus pgaadmin / <span class="italic">pw @ database_specification_string</span> SQL&gt;将<span class="italic">pgaadmin.purge_trace</span>上的执行权授予<span class="italic">tip_user_userid</span> ; SQL&gt;将<span class="italic">pgaadmin.read_trace</span>上的执行权限授予<span class="italic">tip_user_userid;</span> 
</pre><p>在开发TIP之后，必须由TIP所有者授予TIP用户对TIP的执行权限。TIP所有者通常是<code class="codeph">PGAADMIN</code> ，但可以是另一个被授予<code class="codeph">PGDDDEF</code>或<code class="codeph">PGDDGEN</code>角色的用户。
                  </p>
                  <p>例如，在Microsoft Windows上：</p><pre class="oac_no_warn" dir="ltr">C：\&gt; sqlplus tip_owner \ <span class="italic">pw @ database_specification_string</span> SQL&gt;在tipname <span class="italic">上将</span>执行权限授予<span class="italic">tip_user_userid</span> ;</pre><p>在基于UNIX的系统上：</p><pre class="oac_no_warn" dir="ltr">$ sqlplus tip_owner / <span class="italic">pw @ database_specification_string</span> SQL&gt;将<span class="italic">tip命令</span>执行到<span class="italic">tip_user_userid</span> ;</pre><p>其中<span class="italic"><code class="codeph">database_specification_string</code></span>是<a id="d17239e4493" class="indexterm-anchor"></a>安装了网关<code class="codeph">UTL_RAW</code>和<code class="codeph">UTL_PG</code>组件的Oracle数据库的Oracle Net标识符。这与执行TIP的Oracle数据库相同，并且从TIP所有者用户ID执行TIP上的授权。</p>
                  <p>Microsoft Windows上的<code class="codeph">%ORACLE_HOME%\dg4appc\admin</code>目录和基于UNIX的系统上的<code class="codeph">$ORACLE_HOME/dg4appc/admin</code>目录中提供了用于执行这些授权的SQL脚本。该<a id="d17239e4510" class="indexterm-anchor"></a><a id="d17239e4512" class="indexterm-anchor"></a> <code class="codeph">pgddausr.sql</code>脚本执行授权，以便由单个TIP用户对包进行私有访问。如果要使用私有授权，则必须为每个TIP用户的用户ID运行一次<code class="codeph">pgddausr.sql</code>脚本。</p>
                  <p>要运行这些脚本，请使用SQL * Plus以<code class="codeph">PGAADMIN</code>用户<code class="codeph">PGAADMIN</code>连接到Oracle数据库。从SQL * Plus，在Microsoft Windows上的<code class="codeph">%ORACLE_HOME%\dg4appc\admin</code>目录或基于UNIX的系统上的<code class="codeph">$ORACLE_HOME/dg4appc/admin</code>目录中运行<code class="codeph">pgddausr.sql</code>脚本。该脚本执行必要的授权，如前所述。系统会提示您输入所需的用户标识，密码和数据库规范字符串。如果您使用的是私有授权，请对需要访问软件包的每个用户ID重复此步骤。
                  </p>
                  <p>没有提供脚本来执行公共拨款。为此，请发出以下命令：</p>
                  <p>对于Microsoft Windows：</p><pre class="oac_no_warn" dir="ltr">C：\&gt; sqlplus tip_owner \ <span class="italic">pw @ database_specification_string</span> SQL&gt;将tipname上的execute赋予PUBLIC;</pre><p>对于基于UNIX的系统：</p><pre class="oac_no_warn" dir="ltr">$ sqlplus tip_owner / <span class="italic">pw @ database_specification_string</span> SQL&gt;将tipname上的execute赋予PUBLIC;</pre></div>
            </div>
         </div>
      </article>
   </body>
</html>