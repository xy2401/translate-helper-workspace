<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>使用嵌入式SQL</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Programmer&#39;s Guide to the Oracle Precompilers"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Programmer&#39;s Guide to the Oracle Precompilers"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="programmers-guide-oracle-precompilers.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-11T01:36:30-08:00"></meta>
      <meta name="dcterms.title" content="Programmer&#39;s Guide to the Oracle Precompilers"></meta>
      <meta name="dcterms.dateCopyrighted" content="2008, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96474-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="meeting-program-requirements.html" title="Previous" type="text/html"></link>
      <link rel="next" href="using-embedded-PLSQL.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="ZZPRE"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="meeting-program-requirements.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="using-embedded-PLSQL.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">程序员指南Oracle预编译器</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用嵌入式SQL</li>
            </ol>
            <a id="GUID-BDAC918C-E2AB-4F97-8F36-C2B7094CCB98" name="GUID-BDAC918C-E2AB-4F97-8F36-C2B7094CCB98"></a><a id="ZZPRE260"></a>
            
            <h2 id="ZZPRE-GUID-BDAC918C-E2AB-4F97-8F36-C2B7094CCB98" class="sect2"><span class="enumeration_chapter">4</span>使用嵌入式SQL</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章包含以下内容：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="using-embedded-SQL.html#GUID-3FB978C8-7088-4BB5-8875-31FAD7D30470">关于使用主机变量</a></p>
                  </li>
                  <li>
                     <p><a href="using-embedded-SQL.html#GUID-E4FC1AF8-5BCC-49CB-B3A5-83C99CA7A45A">关于使用指标变量</a></p>
                  </li>
                  <li>
                     <p><a href="using-embedded-SQL.html#GUID-361C97AB-8CFF-4029-AB10-D478618F47CC">基本SQL语句</a></p>
                  </li>
                  <li>
                     <p><a href="using-embedded-SQL.html#GUID-0327E691-23A7-48C4-91D7-3447B298545D">游标</a></p>
                  </li>
                  <li>
                     <p><a href="using-embedded-SQL.html#GUID-3A7191D8-EAF2-4F34-A24F-3455CCA9C9AC">游标变量</a></p>
                  </li>
               </ul>
               <p>本章帮助您理解和应用嵌入式SQL编程的基本技术。您将学习如何使用主机变量，指示符变量，游标，游标变量以及插入，更新，选择和删除Oracle数据的基本SQL命令。</p>
            </div><a id="ZZPRE261"></a><div class="props_rev_3"><a id="GUID-3FB978C8-7088-4BB5-8875-31FAD7D30470" name="GUID-3FB978C8-7088-4BB5-8875-31FAD7D30470"></a><h3 id="ZZPRE-GUID-3FB978C8-7088-4BB5-8875-31FAD7D30470" class="sect3"><span class="enumeration_section">4.1</span>关于使用主机变量</h3>
               <div>
                  <p><a id="d27112e69" class="indexterm-anchor"></a> Oracle使用主机变量将数据和状态信息传递给您的程序;您的程序使用主机变量将数据传递给Oracle。
                  </p>
               </div><a id="ZZPRE262"></a><div class="props_rev_3"><a id="GUID-12C7FB41-F1C3-4C70-A92F-6CA81CD1111C" name="GUID-12C7FB41-F1C3-4C70-A92F-6CA81CD1111C"></a><h4 id="ZZPRE-GUID-12C7FB41-F1C3-4C70-A92F-6CA81CD1111C" class="sect4"><span class="enumeration_section">4.1.1</span>输出与输入主机变量</h4>
                  <div>
                     <p><a id="d27112e99" class="indexterm-anchor"></a>根据它们的使用方式，主变量称为输出或输入主变量。<code class="codeph">SELECT</code>或<code class="codeph">FETCH</code>语句的<code class="codeph">INTO</code>子句中的主机变量称为<span class="italic">输出</span>主机变量，因为它们包含Oracle输出的列值。Oracle将列值分配给<code class="codeph">INTO</code>子句中的相应输出主机变量。
                     </p>
                     <p>SQL语句中的所有其他主机变量都称为<span class="italic">输入</span>主机变量，因为您的程序将其值输入到Oracle。例如，您在<code class="codeph">INSERT</code>语句的<code class="codeph">VALUES</code>子句和<code class="codeph">UPDATE</code>语句的<code class="codeph">SET</code>子句中使用输入主机变量。<a id="d27112e137" class="indexterm-anchor"></a>它们也用在<code class="codeph">WHERE</code> ， <code class="codeph">HAVING</code>和<code class="codeph">FOR</code>子句中。事实上，只要允许值或表达式，输入主变量就可以出现在SQL语句中。
                     </p>
                     <p>在<code class="codeph">ORDER</code> <code class="codeph">BY</code>子句中，您<span class="italic">可以</span>使用主机变量，但它被视为常量或文字，因此主机变量的内容无效。例如，SQL语句</p><pre class="oac_no_warn" dir="ltr">EXEC SQL SELECT ename，empno INTO：name，：number FROM emp ORDER BY：ord;</pre><p>似乎包含输入主机变量<span class="italic">ord</span> 。但是，在这种情况下，主变量被视为常量，并且无论<span class="italic">ord</span>的值如何，都不进行排序。
                     </p>
                     <p><a id="d27112e173" class="indexterm-anchor"></a>您不能使用输入主机变量来提供SQL关键字或数据库对象的名称。因此，您不能在数据定义语句（有时称为<span class="italic">DDL</span> ）中使用输入主机变量，例如<code class="codeph">ALTER</code> ， <code class="codeph">CREATE</code>和<code class="codeph">DROP</code> 。在以下示例中， <code class="codeph">DROP</code> <code class="codeph">TABLE</code>语句<span class="italic">无效</span> ：<a id="d27112e200" class="indexterm-anchor"></a></p><pre class="oac_no_warn" dir="ltr">EXEC SQL BEGIN DECLARE SECTION; table_name CHARACTER（30）; EXEC SQL END DECLARE SECTION;显示'表名？“; read table_name; EXEC SQL DROP TABLE：table_name; - 不允许使用主变量</pre><p>在Oracle执行包含输入主机变量的SQL语句之前，程序必须为它们分配值。请考虑以下示例：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL BEGIN DECLARE SECTION; emp_number INTEGER; emp_name CHARACTER（20）; EXEC SQL END DECLARE SECTION; - 获取输入主变量的值显示'员工编号？“;读取emp_number;显示'员工姓名？“;读取emp_name; EXEC SQL INSERT INTO EMP（EMPNO，ENAME）VALUES（：emp_number，：emp_name）;</pre><p>请注意， <code class="codeph">INSERT</code>语句的<code class="codeph">VALUES</code>子句中的输入主机变量以冒号为前缀。
                     </p>
                  </div>
               </div>
            </div><a id="ZZPRE263"></a><div class="props_rev_3"><a id="GUID-E4FC1AF8-5BCC-49CB-B3A5-83C99CA7A45A" name="GUID-E4FC1AF8-5BCC-49CB-B3A5-83C99CA7A45A"></a><h3 id="ZZPRE-GUID-E4FC1AF8-5BCC-49CB-B3A5-83C99CA7A45A" class="sect3"><span class="enumeration_section">4.2</span>关于使用指标变量</h3>
               <div>
                  <p><a id="d27112e239" class="indexterm-anchor"></a>您可以将任何主机变量与可选的指示符变量相关联。每次在SQL语句中使用主机变量时，结果代码都存储在其关联的指示符变量中。因此，指标变量可让您监控主变量。
                  </p>
                  <p>您可以在<code class="codeph">VALUES</code>或<code class="codeph">SET</code>子句中使用指示符变量将空值分配给输入主机变量，并在<code class="codeph">INTO</code>子句中检测输出主机变量中的空值或截断值。
                  </p>
               </div><a id="ZZPRE264"></a><div class="props_rev_3"><a id="GUID-048AC3F5-7DE9-484A-B711-568A504DB951" name="GUID-048AC3F5-7DE9-484A-B711-568A504DB951"></a><h4 id="ZZPRE-GUID-048AC3F5-7DE9-484A-B711-568A504DB951" class="sect4"><span class="enumeration_section">4.2.1</span>输入变量</h4>
                  <div>
                     <div class="section">
                        <p>对于输入主变量，程序可以赋给指标变量的值具有以下含义：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>-1：Oracle将为列分配null，忽略主变量的值。</p>
                           </li>
                           <li>
                              <p>&gt; = 0： <a id="d27112e283" class="indexterm-anchor"></a> Oracle会将主变量的值分配给列。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE265"></a><div class="props_rev_3"><a id="GUID-D26B7FAC-FD86-4F0D-967A-317ED9470CD4" name="GUID-D26B7FAC-FD86-4F0D-967A-317ED9470CD4"></a><h4 id="ZZPRE-GUID-D26B7FAC-FD86-4F0D-967A-317ED9470CD4" class="sect4"><span class="enumeration_section">4.2.2</span>输出变量</h4>
                  <div>
                     <div class="section">
                        <p><a id="d27112e310" class="indexterm-anchor"></a>输出<a id="d27112e315" class="indexterm-anchor"></a>主变量，Oracle可以赋给指标变量的值具有以下含义：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>-2：Oracle分配了一个<a id="d27112e324" class="indexterm-anchor"></a>截断列值到主变量，但无法将列值的原始长度分配给指示符变量，因为数字太大。
                              </p>
                           </li>
                           <li>
                              <p>-1：列值为null，因此宿主变量的值是不确定的。</p>
                           </li>
                           <li>
                              <p>0：Oracle为主机变量分配了完整的列值。</p>
                           </li>
                           <li>
                              <p>&gt; 0：Oracle为主变量分配了一个截断的列值，将原始列长度（以字节，而不是字节表示，用于多字节全球化支持主机变量）分配给指示符变量，并将SQLCA中的SQLCODE设置为零。</p>
                           </li>
                        </ul>
                        <p>请记住，必须在声明部分中将指示符变量定义为2字节整数，并且在SQL语句中，必须以冒号为前缀并附加到其主变量（除非使用关键字INDICATOR）。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE266"></a><div class="props_rev_3"><a id="GUID-D512383C-36DB-463E-889E-FF6D4D0454FD" name="GUID-D512383C-36DB-463E-889E-FF6D4D0454FD"></a><h4 id="ZZPRE-GUID-D512383C-36DB-463E-889E-FF6D4D0454FD" class="sect4"><span class="enumeration_section">4.2.3</span>插入空格</h4>
                  <div>
                     <div class="section">
                        <p><a id="d27112e363" class="indexterm-anchor"></a>您可以使用指示符变量来插入空值。在插入之前，对于每个要为null的列，将相应的指示符变量设置为-1，如以下示例所示：</p><pre class="oac_no_warn" dir="ltr">设置ind_comm = -1; EXEC SQL INSERT INTO EMP（EMPNO，COMM）VALUES（：emp_number，：commission：ind_comm）;</pre><p>指示符变量<span class="italic">ind_comm</span>指定将在<code class="codeph">COMM</code>列中存储null。
                        </p>
                        <p>您可以<a id="d27112e380" class="indexterm-anchor"></a>硬编码null，如下所示：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL INSERT INTO EMP（EMPNO，COMM）VALUES（：emp_number，NULL）;</pre><p>虽然这不太灵活，但可能更具可读性。</p>
                        <p>通常，您有条件地插入空值，如下一个示例所示：</p><pre class="oac_no_warn" dir="ltr">显示'输入员工编号，如果不可用则输入0：';读取emp_number;如果emp_number = 0那么设置ind_empnum = -1; ELSE设置ind_empnum = 0;万一; EXEC SQL INSERT INTO EMP（EMPNO，SAL）VALUES（：emp_number：ind_empnum，：salary）;</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE267"></a><div class="props_rev_3"><a id="GUID-69547774-BCF8-4E5A-A8E0-89E8A2FD8319" name="GUID-69547774-BCF8-4E5A-A8E0-89E8A2FD8319"></a><h4 id="ZZPRE-GUID-69547774-BCF8-4E5A-A8E0-89E8A2FD8319" class="sect4"><span class="enumeration_section">4.2.4</span>处理返回的空值</h4>
                  <div>
                     <div class="section">
                        <p><a id="d27112e415" class="indexterm-anchor"></a>您还可以使用指示符变量来操作返回的空值，如以下示例所示：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL SELECT ENAME，SAL，COMM INTO：emp_name，：salary，：commission：ind_comm FROM EMP WHERE EMPNO =：emp_number;如果ind_comm = -1则设置pay = salary; - 佣金为空;忽略它ELSE设定薪水=工资+佣金;万一;<a id="d27112e422" class="indexterm-anchor"></a></pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE268"></a><div class="props_rev_3"><a id="GUID-A5C0B04B-8D8F-476F-B1A8-5D9F246F5B9B" name="GUID-A5C0B04B-8D8F-476F-B1A8-5D9F246F5B9B"></a><h4 id="ZZPRE-GUID-A5C0B04B-8D8F-476F-B1A8-5D9F246F5B9B" class="sect4"><span class="enumeration_section">4.2.5</span>获取空值</h4>
                  <div>
                     <div class="section">
                        <p>当DBMS = NATIVE，V7或V8时，如果在缺少指示符变量的主机变量中选择或获取空值，Oracle会发出以下错误消息：<a id="d27112e449" class="indexterm-anchor"></a></p><pre class="oac_no_warn" dir="ltr">ORA-01405：获取的列值为NULL</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE269"></a><div class="props_rev_3"><a id="GUID-6EE7EA55-D0C3-416F-BE5A-35966F37DC27" name="GUID-6EE7EA55-D0C3-416F-BE5A-35966F37DC27"></a><h4 id="ZZPRE-GUID-6EE7EA55-D0C3-416F-BE5A-35966F37DC27" class="sect4"><span class="enumeration_section">4.2.6</span>测试空值</h4>
                  <div>
                     <div class="section">
                        <p><a id="d27112e478" class="indexterm-anchor"></a>您<a id="d27112e483" class="indexterm-anchor"></a>可以在<code class="codeph">WHERE</code>子句中使用指示符变量来测试空值，如以下示例所示：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL SELECT ENAME，SAL INTO：emp_name，：salary FROM EMP WHERE：commission：ind_comm IS NULL ...
</pre><p><a id="d27112e494" class="indexterm-anchor"></a>但是，您不能使用关系运算符来比较空值或其他值。例如，如果<code class="codeph">COMM</code>列包含一个或多个空值，则以下<code class="codeph">SELECT</code>语句将失败：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL SELECT ENAME，SAL INTO：emp_name，：salary FROM EMP WHERE COMM =：commission：ind_comm;</pre><p>下一个示例显示了当其中一些值可能为空时，如何比较相等的值：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL SELECT ENAME，SAL INTO：emp_name，：salary FROM EMP WHERE（COMM =：commission）OR（（COMM IS NULL）AND（：commission：ind_comm IS NULL））;</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE270"></a><div class="props_rev_3"><a id="GUID-B715DA66-1952-421D-8A9E-A9F0A85369BE" name="GUID-B715DA66-1952-421D-8A9E-A9F0A85369BE"></a><h4 id="ZZPRE-GUID-B715DA66-1952-421D-8A9E-A9F0A85369BE" class="sect4"><span class="enumeration_section">4.2.7</span>获取截断值</h4>
                  <div>
                     <div class="section">
                        <p><a id="d27112e533" class="indexterm-anchor"></a>如果在缺少指示符变量的主变量中选择或获取截断的列值，则不会生成错误。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="ZZPRE271"></a><div class="props_rev_3"><a id="GUID-361C97AB-8CFF-4029-AB10-D478618F47CC" name="GUID-361C97AB-8CFF-4029-AB10-D478618F47CC"></a><h3 id="ZZPRE-GUID-361C97AB-8CFF-4029-AB10-D478618F47CC" class="sect3"><span class="enumeration_section">4.3</span>基本SQL语句</h3>
               <div>
                  <p>可执行的SQL语句使您可以查询，操作和控制Oracle数据<a id="d27112e559" class="indexterm-anchor"></a>创建，定义和维护Oracle对象，例如表，视图和索引。本章重点介绍<a id="d27112e564" class="indexterm-anchor"></a>数据操作语句（有时称为<span class="italic">DML</span> ）和游标控制语句。以下SQL语句允许您查询和<a id="d27112e570" class="indexterm-anchor"></a>操纵Oracle数据：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><code class="codeph">SELECT</code> ：返回一个或多个表中的行。
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">INSERT</code> ：向表中添加新行。
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">UPDATE</code> ：修改表中的行。
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">DELETE</code> ：从表中删除行。
                        </p>
                     </li>
                  </ul>
                  <p>在执行<code class="codeph">INSERT</code> ， <code class="codeph">UPDATE</code>或<code class="codeph">DELETE</code>等数据操作语句时，除了设置任何输入主机变量的值之外，唯一需要考虑的是语句是成功还是失败。要找到答案，您只需查看SQLCA即可。 （执行任何SQL语句都会设置SQLCA变量。）您可以通过以下两种方式办理登机手续：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>使用<code class="codeph">WHENEVER</code>语句进行隐式检查</p>
                     </li>
                     <li>
                        <p>显式检查SQLCA变量</p>
                     </li>
                  </ul>
                  <p>或者，当<code class="codeph">MODE={ANSI|ANSI14}</code> ，您可以检查状态变量<code class="codeph">SQLSTATE</code>或<code class="codeph">SQLCODE</code> 。有关更多信息，请参阅<span class="q">“ <a href="error-handling-diagnostics.html#GUID-2C54DB16-AE8F-4D16-901F-C1A2EF5DD8CD">关于在MODE = {ANSI | ANSI14}时使用状态变量</a> ”</span> 。
                  </p>
                  <p>执行<code class="codeph">SELECT</code>语句时（ <a id="d27112e638" class="indexterm-anchor"></a>但是，您还必须处理它返回的数据行。查询可分为以下几类：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>不返回任何行的查询（即仅检查是否存在）</p>
                     </li>
                     <li>
                        <p>只返回一行的查询</p>
                     </li>
                     <li>
                        <p>返回多行的查询</p>
                     </li>
                  </ul>
                  <p><a id="d27112e652" class="indexterm-anchor"></a>返回多行的查询需要显式声明的游标或游标变量（或使用主机数组，这在<a href="using-host-arrays.html#GUID-F8DD2840-4F8C-4093-A4F9-51C9FE9FA59F">使用主机阵列</a>中讨论）。以下嵌入式SQL语句允许您定义和控制显式游标：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><code class="codeph">DECLARE</code> ：命名游标并将其与查询相关联。
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">OPEN</code> ：执行查询并识别活动集。
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">FETCH</code> ：前进游标并逐个检索活动集中的每一行。
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">CLOSE</code> ：禁用光标（活动集变为未定义）。
                        </p>
                     </li>
                  </ul>
                  <p>在以下部分中，首先将学习如何编写<code class="codeph">INSERT</code> ， <code class="codeph">UPDATE</code> ， <code class="codeph">DELETE</code>和单行<code class="codeph">SELECT</code>语句的代码。然后，您将进入多行<code class="codeph">SELECT</code>语句。
                  </p>
               </div><a id="ZZPRE272"></a><div class="props_rev_3"><a id="GUID-B735173A-E65B-4108-954E-20A19204D18E" name="GUID-B735173A-E65B-4108-954E-20A19204D18E"></a><h4 id="ZZPRE-GUID-B735173A-E65B-4108-954E-20A19204D18E" class="sect4"><span class="enumeration_section">4.3.1</span>选择行</h4>
                  <div>
                     <div class="section">
                        <p><a id="d27112e725" class="indexterm-anchor"></a>查询数据库是一种常见的SQL操作。要发出查询，请使用<a id="d27112e730" class="indexterm-anchor"></a> <code class="codeph">SELECT</code>语句。在下面的<a id="d27112e735" class="indexterm-anchor"></a>例如，您查询<code class="codeph">EMP</code>表：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL SELECT ENAME，JOB，SAL + 2000 INTO：emp_name，：job_title，：salary FROM EMP WHERE EMPNO =：emp_number;</pre><p><a id="d27112e746" class="indexterm-anchor"></a>关键字<code class="codeph">SELECT</code>后面的列名和表达式构成<span class="italic">选择列表</span> 。我们示例中的选择列表包含三个项目。在<code class="codeph">WHERE</code>子句（以及以下子句，如果存在）中指定的条件下，Oracle将列值返回到<code class="codeph">INTO</code>子句中的主变量。选择列表中的项目数应该等于<code class="codeph">INTO</code>子句中的主机变量数，因此可以存储每个返回的值。
                        </p>
                        <p><a id="d27112e767" class="indexterm-anchor"></a>在最简单的情况下，当查询返回一行时，其形式如上一个示例所示（其中<code class="codeph">EMPNO</code>是唯一键）。但是，如果查询可以返回多行，则必须使用游标获取行或将其选择到主机数组中。
                        </p>
                        <p>如果您编写查询以仅返回一行但实际上可能返回多行，则结果取决于您指定<code class="codeph">SELECT_ERROR</code>选项的方式。当<code class="codeph">SELECT_ERROR</code> <code class="codeph">=</code> <code class="codeph">YES</code> （缺省值）时，如果返回多行，Oracle会发出以下错误消息：</p><pre class="oac_no_warn" dir="ltr">ORA-01422：精确提取返回超过请求的行数</pre><p>当<code class="codeph">SELECT_ERROR=NO</code> ，返回一行，Oracle不会生成错误。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE273"></a><div class="props_rev_3"><a id="GUID-45429AA7-E4F8-46D8-8230-299F07E5971D" name="GUID-45429AA7-E4F8-46D8-8230-299F07E5971D"></a><h4 id="ZZPRE-GUID-45429AA7-E4F8-46D8-8230-299F07E5971D" class="sect4"><span class="enumeration_section">4.3.2</span>可用条款</h4>
                  <div>
                     <p>您可以在<code class="codeph">SELECT</code>语句中使用以下所有标准SQL子句： <code class="codeph">INTO</code> ， <code class="codeph">FROM</code> ， <code class="codeph">WHERE</code> ， <code class="codeph">CONNECT</code> <code class="codeph">BY</code> ， <code class="codeph">START</code> <code class="codeph">WITH</code> ， <code class="codeph">GROUP</code> <code class="codeph">BY</code> ， <code class="codeph">HAVING</code> ， <code class="codeph">ORDER</code> <code class="codeph">BY</code>和<code class="codeph">FOR</code> <code class="codeph">UPDATE</code> <code class="codeph">OF</code> 。</p>
                  </div>
               </div><a id="ZZPRE274"></a><div class="props_rev_3"><a id="GUID-DBBFD998-6FCA-477A-A52E-AF7DB3DC94FD" name="GUID-DBBFD998-6FCA-477A-A52E-AF7DB3DC94FD"></a><h4 id="ZZPRE-GUID-DBBFD998-6FCA-477A-A52E-AF7DB3DC94FD" class="sect4"><span class="enumeration_section">4.3.3</span>插入行</h4>
                  <div>
                     <div class="section">
                        <p><a id="d27112e895" class="indexterm-anchor"></a>您可以使用<code class="codeph">INSERT</code>语句将行添加到表或视图中。在以下示例中，您向<code class="codeph">EMP</code>表添加一行：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL INSERT INTO EMP（EMPNO，ENAME，SAL，DEPTNO）VALUES（：emp_number，：emp_name，：salary，：dept_number）;</pre><p><a id="d27112e909" class="indexterm-anchor"></a>您在列列表中指定的每个列都必须属于在该列表中指定的表<a id="d27112e914" class="indexterm-anchor"></a> <code class="codeph">INTO</code> <a id="d27112e921" class="indexterm-anchor"></a>条款。<code class="codeph">VALUES</code>子句指定要插入的值行。值可以是常量，主变量，SQL表达式或伪列，例如<code class="codeph">USER</code>和<code class="codeph">SYSDATE</code> 。</p>
                        <p><code class="codeph">VALUES</code>子句中的<code class="codeph">VALUES</code>数必须等于列列表中的名称数。但是，如果<code class="codeph">VALUES</code>子句包含表中每列的值，则可以省略列列表，其顺序与<code class="codeph">CREATE</code> <code class="codeph">TABLE</code>定义的顺序相同。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE275"></a><div class="props_rev_3"><a id="GUID-B05FC120-CF3B-4A9B-B081-69834E1F1FBB" name="GUID-B05FC120-CF3B-4A9B-B081-69834E1F1FBB"></a><h4 id="ZZPRE-GUID-B05FC120-CF3B-4A9B-B081-69834E1F1FBB" class="sect4"><span class="enumeration_section">4.3.4</span>使用子查询</h4>
                  <div>
                     <div class="section">
                        <p>一个<a id="d27112e973" class="indexterm-anchor"></a> <span class="italic">子查询</span>是一个嵌套的<code class="codeph">SELECT</code>语句。子查询允许您进行多部分搜索。他们可以习惯</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>提供<code class="codeph">SELECT</code> ， <code class="codeph">UPDATE</code>和<code class="codeph">DELETE</code>语句的<code class="codeph">WHERE</code> ， <code class="codeph">HAVING</code>和<code class="codeph">START</code> <code class="codeph">WITH</code>子句中的比较值</p>
                           </li>
                           <li>
                              <p>定义要由<code class="codeph">CREATE</code> <code class="codeph">TABLE</code>或<code class="codeph">INSERT</code>语句插入的行集</p>
                           </li>
                           <li>
                              <p>定义<code class="codeph">UPDATE</code>语句的<code class="codeph">SET</code>子句的值</p>
                           </li>
                        </ul>
                        <p><a id="d27112e1030" class="indexterm-anchor"></a><a id="d27112e1034" class="indexterm-anchor"></a><a id="d27112e1038" class="indexterm-anchor"></a>对于<a id="d27112e1043" class="indexterm-anchor"></a>例如，要将行从一个表复制到另一个表，请将<code class="codeph">INSERT</code>语句中的<code class="codeph">VALUES</code>子句替换为子查询，如下所示：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL INSERT INTO EMP2（EMPNO，ENAME，SAL，DEPTNO）从EMP中选择EMPNO，ENAME，SAL，DEPTNO WHERE JOB =：job_title;</pre><p>请注意<code class="codeph">INSERT</code>语句如何使用子查询来获取中间结果。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE276"></a><div class="props_rev_3"><a id="GUID-A9C81554-7B93-4543-A103-8B6BA375681A" name="GUID-A9C81554-7B93-4543-A103-8B6BA375681A"></a><h4 id="ZZPRE-GUID-A9C81554-7B93-4543-A103-8B6BA375681A" class="sect4"><span class="enumeration_section">4.3.5</span>更新行</h4>
                  <div>
                     <div class="section">
                        <p><a id="d27112e1083" class="indexterm-anchor"></a>你用的是<a id="d27112e1088" class="indexterm-anchor"></a><a id="d27112e1090" class="indexterm-anchor"></a> <code class="codeph">UPDATE</code>语句，用于更改表或视图中指定列的值。在以下示例中，您将更新<code class="codeph">EMP</code>表中的<code class="codeph">SAL</code>和<code class="codeph">COMM</code>列：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL UPDATE EMP SET SAL =：salary，COMM =：Commission WHERE EMPNO =：emp_number;</pre><p>您可以使用可选的<code class="codeph">WHERE</code>子句指定更新行的条件。请参阅<span class="q">“ <a href="using-embedded-SQL.html#GUID-45F5EA0B-C639-4A68-9956-8A8C71160357">使用WHERE子句</a> ”</span> 。
                        </p>
                        <p><a id="d27112e1119" class="indexterm-anchor"></a><a id="d27112e1123" class="indexterm-anchor"></a><a id="d27112e1127" class="indexterm-anchor"></a>该<a id="d27112e1132" class="indexterm-anchor"></a><a id="d27112e1134" class="indexterm-anchor"></a> <code class="codeph">SET</code>子句列出了必须为其提供值的一个或多个列的名称。您可以使用子查询来提供值，如以下示例所示：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL UPDATE EMP SET SAL =（SELECT AVG（SAL）* 1.1 from EMP WHERE DEPTNO = 20）WHERE EMPNO =：emp_number;</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE277"></a><div class="props_rev_3"><a id="GUID-5374A5E2-CEAF-4E29-981E-86C833A88494" name="GUID-5374A5E2-CEAF-4E29-981E-86C833A88494"></a><h4 id="ZZPRE-GUID-5374A5E2-CEAF-4E29-981E-86C833A88494" class="sect4"><span class="enumeration_section">4.3.6</span>删除行</h4>
                  <div>
                     <div class="section">
                        <p><a id="d27112e1166" class="indexterm-anchor"></a>您使用<code class="codeph">DELETE</code>语句从表或视图中删除行。在以下示例中，您将从<code class="codeph">EMP</code>表中删除给定部门中的所有员工：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL DELETE FROM EMP WHERE DEPTNO =：dept_number;</pre><p><a id="d27112e1180" class="indexterm-anchor"></a>您可以使用可选的<code class="codeph">WHERE</code>子句指定删除行的条件。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE278"></a><div class="props_rev_3"><a id="GUID-45F5EA0B-C639-4A68-9956-8A8C71160357" name="GUID-45F5EA0B-C639-4A68-9956-8A8C71160357"></a><h4 id="ZZPRE-GUID-45F5EA0B-C639-4A68-9956-8A8C71160357" class="sect4"><span class="enumeration_section">4.3.7</span>使用WHERE子句</h4>
                  <div>
                     <div class="section">
                        <p><a id="d27112e1220" class="indexterm-anchor"></a>您可以使用<code class="codeph">WHERE</code>子句仅选择，更新或删除满足搜索条件的表或视图中的那些行。<code class="codeph">WHERE</code> -clause <span class="italic">搜索条件</span>是一个布尔表达式，可以包括标量主变量，主机数组（不在<code class="codeph">SELECT</code>语句中）和子查询。
                        </p>
                        <p>如果省略<code class="codeph">WHERE</code>子句，则处理表或视图中的所有行。如果省略<code class="codeph">UPDATE</code>或<code class="codeph">DELETE</code>语句中的<code class="codeph">WHERE</code>子句，Oracle会将SQLCA中的SQLWARN（5）设置为“W”，以警告所有行都已处理。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="ZZPRE279"></a><div class="props_rev_3"><a id="GUID-0327E691-23A7-48C4-91D7-3447B298545D" name="GUID-0327E691-23A7-48C4-91D7-3447B298545D"></a><h3 id="ZZPRE-GUID-0327E691-23A7-48C4-91D7-3447B298545D" class="sect3"><span class="enumeration_section">4.4</span>游标</h3>
               <div>
                  <p><a id="d27112e1272" class="indexterm-anchor"></a>当查询返回多个时<a id="d27112e1275" class="indexterm-anchor"></a>行，您可以显式定义游标：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>处理超出查询返回的第一行</p>
                     </li>
                     <li>
                        <p>跟踪当前正在处理的行</p>
                     </li>
                  </ul>
                  <p><a id="d27112e1288" class="indexterm-anchor"></a>游标标识查询返回的行集中的当前行。这允许您的程序一次处理一行。以下语句允许您定义和操作游标：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><code class="codeph">宣布</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">打开</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">取</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">关</code></p>
                     </li>
                  </ul>
                  <p><a id="d27112e1311" class="indexterm-anchor"></a>第一<a id="d27112e1316" class="indexterm-anchor"></a>您使用<code class="codeph">DECLARE</code>语句来命名游标并将其与查询相关联。
                  </p>
                  <p><code class="codeph">OPEN</code>语句执行查询并标识满足查询搜索条件的所有行。这些行形成一个称为光标活动集的集合。<a id="d27112e1329" class="indexterm-anchor"></a>打开游标后，您可以使用它来检索其关联查询返回的行。
                  </p>
                  <p>逐个检索活动集的行（除非您使用主机数组）。您使用<code class="codeph">FETCH</code>语句来检索活动集中的当前行。您可以重复执行<code class="codeph">FETCH</code> ，直到检索到所有行。
                  </p>
                  <p>完成从活动集中获取行时，使用<code class="codeph">CLOSE</code>语句禁用游标，并且活动集变为未定义。
                  </p>
               </div><a id="ZZPRE280"></a><div class="props_rev_3"><a id="GUID-25DA2AA4-8E1D-45BB-9FC6-CEC7ED9B7FCD" name="GUID-25DA2AA4-8E1D-45BB-9FC6-CEC7ED9B7FCD"></a><h4 id="ZZPRE-GUID-25DA2AA4-8E1D-45BB-9FC6-CEC7ED9B7FCD" class="sect4"><span class="enumeration_section">4.4.1</span>声明游标</h4>
                  <div>
                     <div class="section">
                        <p><a id="d27112e1367" class="indexterm-anchor"></a><a id="d27112e1371" class="indexterm-anchor"></a>您可以使用<code class="codeph">DECLARE</code>语句通过为游标指定名称并将其与查询相关联来定义游标，如以下示例所示：</p><pre class="oac_no_warn" dir="ltr"><a id="d27112e1380" class="indexterm-anchor"></a> EXEC SQL DECLARE emp_cursor CURSOR FOR SELECT ENAME，EMPNO，SAL from EMP WHERE DEPTNO =：dept_number;</pre><p><a id="d27112e1386" class="indexterm-anchor"></a>该<a id="d27112e1391" class="indexterm-anchor"></a>游标名称是预编译器使用的标识符， <span class="italic">而不是</span>主机或程序变量，不应在声明部分中定义。因此，游标名称不能从一个预编译单元传递到另一个预编译单元。此外，游标名称不能连字符。它们可以是任意长度，但只有前31个字符才有意义。对于ANSI兼容性，请使用不超过18个字符的游标名称。
                        </p>
                        <p>与游标关联的<code class="codeph">SELECT</code>语句不能包含<code class="codeph">INTO</code>子句。相反， <code class="codeph">INTO</code>子句和输出主机变量列表是<code class="codeph">FETCH</code>语句的一部分。
                        </p>
                        <p><a id="d27112e1414" class="indexterm-anchor"></a>因为它是声明性的，所以<code class="codeph">DECLARE</code>语句必须在物理上（不仅仅是逻辑上）在引用游标的所有其他SQL语句之前。那是， <a id="d27112e1422" class="indexterm-anchor"></a>不允许对游标进行前向引用。在以下示例中， <code class="codeph">OPEN</code>语句放错了位置：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL OPEN emp_cursor; - 错误的OPEN语句EXEC SQL DECLARE emp_cursor CURSOR FOR SELECT ENAME，EMPNO，SAL FROM EMP WHERE ENAME =：emp_name;</pre><p>游标控制语句必须全部出现在同一预编译单元中。例如，您不能在文件A中声明游标，然后在文件B中打开它。</p>
                        <p>您的宿主程序可以根据需要声明尽可能多的游标。但是，在给定文件中，每个<code class="codeph">DECLARE</code>语句都必须是唯一的。也就是说，您不能在一个预编译单元中声明两个具有相同名称的游标，即使是跨块或过程也是如此，因为范围<a id="d27112e1437" class="indexterm-anchor"></a>光标在文件中是全局的。 <a id="d27112e1440" class="indexterm-anchor"></a> 如果您将使用多个游标，则可能需要指定<code class="codeph">MAXOPENCURSORS</code>选项。有关更多信息，请参阅<span class="q">“ <a href="running-Oracle-precompilers.html#GUID-26711A61-6CA5-47C3-9048-F008760EFDA2">MAXOPENCURSORS</a> ”</span> 。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE281"></a><div class="props_rev_3"><a id="GUID-011D5621-6E16-4175-BD85-AE4C4AE3A38C" name="GUID-011D5621-6E16-4175-BD85-AE4C4AE3A38C"></a><h4 id="ZZPRE-GUID-011D5621-6E16-4175-BD85-AE4C4AE3A38C" class="sect4"><span class="enumeration_section">4.4.2</span>打开光标</h4>
                  <div>
                     <div class="section">
                        <p>使用<a id="d27112e1476" class="indexterm-anchor"></a> <code class="codeph">OPEN</code>语句，用于执行查询并识别活动集。在下面的<a id="d27112e1481" class="indexterm-anchor"></a>例如，打开名为<span class="italic">emp_cursor</span>的游标。
                        </p><pre class="oac_no_warn" dir="ltr">EXEC SQL OPEN emp_cursor;</pre><p><code class="codeph">OPEN</code>将光标定位在活动集的第一行之前。它还将SQLCA中SQLERRD（3）保留的行处理计数归零。但是，此时实际上没有检索到任何行。这将由<code class="codeph">FETCH</code>语句完成。
                        </p>
                        <p>打开游标后，在重新打开游标之前，不会重新检查查询的输入主机变量。因此，活动集不会改变。<a id="d27112e1500" class="indexterm-anchor"></a>要更改活动集，必须重新打开游标。
                        </p>
                        <p><a id="d27112e1506" class="indexterm-anchor"></a>通常，您应该在重新打开之前关闭游标。但是，如果指定<code class="codeph">MODE=ORACLE</code> （默认值），则无需在重新打开之前关闭游标。这可以提高性能;有关详细信息，请参阅<a href="performance-tuning.html#GUID-3E208ADC-D434-4B51-B1D2-B78A04C564DE">性能调整</a> 
                        </p>
                        <p>OPEN完成的工作量取决于三个预编译器选项的值： <code class="codeph">HOLD_CURSOR, RELEASE_CURSOR</code>和<code class="codeph">MAXOPENCURSORS</code> 。有关更多信息，请参阅<span class="q">“ <a href="running-Oracle-precompilers.html#GUID-3B46BD40-209C-4426-B8C3-4ABF97C44507">关于使用预编译器选项</a> ”</span> 。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE282"></a><div class="props_rev_3"><a id="GUID-633132E8-77E9-4FEC-A337-CAE14E2A83FF" name="GUID-633132E8-77E9-4FEC-A337-CAE14E2A83FF"></a><h4 id="ZZPRE-GUID-633132E8-77E9-4FEC-A337-CAE14E2A83FF" class="sect4"><span class="enumeration_section">4.4.3</span>从光标中获取</h4>
                  <div>
                     <div class="section">
                        <p>您可以使用<code class="codeph">FETCH</code>语句从活动集中检索行，并指定将包含结果的输出主机变量。回想一下，与游标关联的<code class="codeph">SELECT</code>语句不能包含<code class="codeph">INTO</code>子句。相反， <code class="codeph">INTO</code>子句和输出主机变量列表是<code class="codeph">FETCH</code>语句的一部分。在以下示例中，您将获取三个主机变量：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL FETCH emp_cursor INTO：emp_name，：emp_number，：salary;</pre><p>必须先声明并打开游标。第一次执行<code class="codeph">FETCH</code> ，光标从活动集中的第一行之前移动到第一行。该行成为当前行。<code class="codeph">FETCH</code>每次后续执行都会将光标前进到活动集中的下一行，从而更改当前行。光标只能在活动集中向前移动。要返回已经获取的行，必须重新打开游标，然后在活动集的第一行再次开始。
                        </p>
                        <p><a id="d27112e1581" class="indexterm-anchor"></a>如果要更改活动集，则必须将新值分配给与游标关联的查询中的输入主机变量，然后重新打开游标。当<code class="codeph">MODE={ANSI | ANSI14 | ANSI13}</code> ，您必须在重新打开之前关闭光标。
                        </p>
                        <p>如下一个示例所示，您可以使用不同的输出主机变量集从同一游标中获取。但是，每个<code class="codeph">FETCH</code>语句的<code class="codeph">INTO</code>子句中的相应主机变量必须具有相同的数据类型。
                        </p><pre class="oac_no_warn" dir="ltr">EXEC SQL DECLARE emp_cursor CURSOR FOR SELECT ENAME，SAL FROM EMP WHERE DEPTNO = 20; ...EXEC SQL OPEN emp_cursor; EXEC SQL WHENEVER NOT FOUND DO ...LOOP EXEC SQL FETCH emp_cursor INTO：emp_name1，：salary1; EXEC SQL FETCH emp_cursor INTO：emp_name2，：salary2; EXEC SQL FETCH emp_cursor INTO：emp_name3，：salary3; ...ENDLOOP;</pre><p><a id="d27112e1600" class="indexterm-anchor"></a>如果<a id="d27112e1603" class="indexterm-anchor"></a>如果活动集为空或不包含更多行，则<code class="codeph">FETCH</code>将“无数据找到”Oracle警告代码返回到SQLCA中的<code class="codeph">SQLCODE</code> （或者当MODE = ANSI时，返回到状态变量<code class="codeph">SQLSTATE</code> ）。输出主机变量的状态是不确定的。（在典型程序中， <code class="codeph">WHENEVER NOT FOUND</code>语句检测到此错误。）要重新使用游标，必须重新打开它。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE283"></a><div class="props_rev_3"><a id="GUID-9ABBDACE-A92C-4836-8A32-B4586D942738" name="GUID-9ABBDACE-A92C-4836-8A32-B4586D942738"></a><h4 id="ZZPRE-GUID-9ABBDACE-A92C-4836-8A32-B4586D942738" class="sect4"><span class="enumeration_section">4.4.4</span>关闭光标</h4>
                  <div>
                     <div class="section">
                        <p><a id="d27112e1642" class="indexterm-anchor"></a>完成从活动集中获取行后，关闭游标以释放通过打开游标获取的资源，例如存储。关闭游标时，将释放解析锁。释放的资源取决于您如何指定<code class="codeph">HOLD_CURSOR</code>和<code class="codeph">RELEASE_CURSOR</code>选项。在以下示例中，您将关闭名为<code class="codeph">emp_cursor</code>的游标： <a id="d27112e1654" class="indexterm-anchor"></a> 
                        </p><pre class="oac_no_warn" dir="ltr">EXEC SQL CLOSE emp_cursor;</pre><p>您无法从关闭的游标中获取，因为它的活动集变为未定义。如有必要，您可以重新打开游标（例如，使用输入主机变量的新值）。</p>
                        <p>当<code class="codeph">MODE={ANSI13|ORACLE}</code> ，发出提交或回滚将关闭<code class="codeph">CURRENT OF</code>子句中引用的游标。其他游标不受提交或回滚的影响，如果打开，则保持打开状态。但是，当<code class="codeph">MODE={ANSI|ANSI14}</code> ，发出提交或回滚将关闭<span class="italic">所有</span>显式游标。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE284"></a><div class="props_rev_3"><a id="GUID-272729B1-06E6-44B7-8822-0C61CE6E7BF5" name="GUID-272729B1-06E6-44B7-8822-0C61CE6E7BF5"></a><h4 id="ZZPRE-GUID-272729B1-06E6-44B7-8822-0C61CE6E7BF5" class="sect4"><span class="enumeration_section">4.4.5</span>使用CURRENT OF子句</h4>
                  <div>
                     <div class="section">
                        <p><a id="d27112e1699" class="indexterm-anchor"></a>您可以在<code class="codeph">DELETE</code>或<code class="codeph">UPDATE</code>语句中使用<code class="codeph">CURRENT OF</code> <span class="italic">cursor_name</span>子句来引用从命名游标中获取的最新行。光标必须打开并放在一行上。如果未执行提取或游标未打开，则<code class="codeph">CURRENT OF</code>子句将导致错误并且不处理任何行。
                        </p>
                        <p>声明在<code class="codeph">UPDATE</code>或<code class="codeph">DELETE</code>语句的<code class="codeph">CURRENT OF</code>子句中引用的游标时， <code class="codeph">FOR UPDATE OF</code>子句是可选的。<code class="codeph">CURRENT OF</code>子句指示预编译器在必要时添加<code class="codeph">FOR UPDATE</code>子句。有关更多信息，请参阅<span class="q">“ <a href="defining-controlling-transactions.html#GUID-984FD738-22DD-4171-AC4D-A12B3BAAB3BC">关于使用FOR UP UPDATE OF子句</a> ”</span> 。
                        </p>
                        <p><a id="d27112e1744" class="indexterm-anchor"></a>在以下示例中，您使用<code class="codeph">CURRENT OF</code>子句来引用从名为<span class="italic">emp_cursor</span>的游标中获取的最新行：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL DECLARE emp_cursor CURSOR FOR SELECT ENAME，SAL from EMP WHERE JOB ='CLERK'FOR SALDATE SAL; ...EXEC SQL OPEN emp_cursor; EXEC SQL WHENEVER NOT FOUND DO ...LOOP EXEC SQL FETCH emp_cursor INTO：emp_name，：salary; ...EXEC SQL UPDATE EMP SET SAL =：new_salary WHERE CURRENT OF emp_cursor; ENDLOOP;</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE285"></a><div class="props_rev_3"><a id="GUID-545F0608-61CA-4152-B3F8-F11746009412" name="GUID-545F0608-61CA-4152-B3F8-F11746009412"></a><h4 id="ZZPRE-GUID-545F0608-61CA-4152-B3F8-F11746009412" class="sect4"><span class="enumeration_section">4.4.6</span>限制</h4>
                  <div>
                     <p><a id="d27112e1779" class="indexterm-anchor"></a>显式<code class="codeph">FOR UPDATE OF</code>或隐式<code class="codeph">FOR UPDATE</code>获取独占行锁。所有行都在打开时锁定，而不是在提取时锁定，并在提交或回滚时释放。如果在提交后尝试从<code class="codeph">FOR UPDATE</code>游标获取，Oracle会生成以下错误：</p><pre class="oac_no_warn" dir="ltr">ORA-01002：取消顺序</pre><p>您不能将主机数组与<code class="codeph">CURRENT OF</code>子句一起使用。有关替代方案，请参阅<span class="q">“ <a href="using-host-arrays.html#GUID-5E5021B0-116F-4242-8053-6CEE6B7B154E">关于模仿当前条款</a> ”</span> 。此外，您不能在关联的<code class="codeph">FOR UPDATE OF</code>子句中引用多个表，这意味着您无法与<code class="codeph">CURRENT OF</code>子句进行连接。最后，您不能在动态SQL中使用<code class="codeph">CURRENT OF</code>子句。</p>
                  </div>
               </div><a id="ZZPRE286"></a><div class="props_rev_3"><a id="GUID-1E88E95D-DD96-4FE2-88C0-A2D8E42EBEE0" name="GUID-1E88E95D-DD96-4FE2-88C0-A2D8E42EBEE0"></a><h4 id="ZZPRE-GUID-1E88E95D-DD96-4FE2-88C0-A2D8E42EBEE0" class="sect4"><span class="enumeration_section">4.4.7</span>典型的陈述顺序</h4>
                  <div>
                     <p>以下示例显示了应用程序中光标控制语句的典型顺序：</p><pre class="oac_no_warn" dir="ltr">- 定义光标。EXEC SQL DECLARE emp_cursor CURSOR FOR SELECT ENAME，JOB from EMP WHERE EMPNO =：emp_number FOR JODATE OF JOB; - 打开光标并识别活动集。EXEC SQL OPEN emp_cursor; - 如果最后一行已被提取，则退出。EXEC SQL WHENEVER NOT FOUND DO no_more; - 循环中获取和处理数据。LOOP EXEC SQL FETCH emp_cursor INTO：emp_name，：job_title; - 对获取的数据进行操作的主机语言语句EXEC SQL UPDATE EMP SET JOB =：new_job_title WHERE CURRENT OF emp_cursor; ENDLOOP; ...ROUTINE no_more BEGIN  - 禁用光标。EXEC SQL CLOSE emp_cursor; EXEC SQL COMMIT WORK RELEASE;退出计划;结束no_more;</pre></div>
               </div><a id="ZZPRE287"></a><div class="props_rev_3"><a id="GUID-E003DD77-F11A-4195-B0E7-4A037D99373C" name="GUID-E003DD77-F11A-4195-B0E7-4A037D99373C"></a><h4 id="ZZPRE-GUID-E003DD77-F11A-4195-B0E7-4A037D99373C" class="sect4"><span class="enumeration_section">4.4.8</span>完整的例子</h4>
                  <div>
                     <p>以下程序说明了游标和<code class="codeph">FETCH</code>语句的使用。程序会提示输入部门编号，然后显示该部门中所有员工的姓名。
                     </p>
                     <p>除最后一个之外的所有提取都返回一行，如果在提取期间没有检测到错误，则返回成功状态代码。最终提取失败并将“无数据发现”Oracle警告代码返回到SQLCA中的<code class="codeph">SQLCODE</code> 。实际获取的累计行数可在SQLCA的<code class="codeph">SQLERRD(3)</code>中找到。</p><pre class="oac_no_warn" dir="ltr">- 声明主机变量EXEC SQL BEGIN DECLARE SECTION;用户名CHARACTER（20）;密码CHARACTER（20）; emp_name CHARACTER（10）; dept_number INTEGER; EXEC SQL END DECLARE SECTION; - 复制SQL通讯区EXEC SQL INCLUDE SQLCA;显示'用户名？“;读取用户名;显示'密码？“;读密码; - 处理错误EXEC SQL WHENEVER SQLERROR DO sql_error; - 登录Oracle EXEC SQL CONNECT：用户名IDENTIFIED BY：密码;显示'连接到Oracle'; - 声明一个游标EXEC SQL DECLARE emp_cursor CURSOR FOR ENAME from EMP WHERE DEPTNO =：dept_number;显示'部门号码？“;读dept_number; - 打开游标并识别活动集EXEC SQL OPEN emp_cursor; - 如果最后一行已被提取则退出EXEC SQL WHENEVER NOT FOUND DO no_more;显示'员工姓名';显示'-------------'; - 在循环中获取和处理数据LOOP EXEC SQL FETCH emp_cursor INTO：emp_name; display emp_name; ENDLOOP; ROUTINE no_more BEGIN EXEC SQL CLOSE emp_cursor; EXEC SQL COMMIT WORK RELEASE;显示'程序结束';退出计划;结束no_more; ROUTINE sql_error BEGIN EXEC SQL WHENEVER SQLERROR CONTINUE; EXEC SQL ROLLBACK工作版;显示'处理错误';退出程序有错误; END sql_error;</pre></div>
               </div>
            </div><a id="ZZPRE288"></a><div class="props_rev_3"><a id="GUID-3A7191D8-EAF2-4F34-A24F-3455CCA9C9AC" name="GUID-3A7191D8-EAF2-4F34-A24F-3455CCA9C9AC"></a><h3 id="ZZPRE-GUID-3A7191D8-EAF2-4F34-A24F-3455CCA9C9AC" class="sect3"><span class="enumeration_section">4.5</span>光标变量</h3>
               <div>
                  <p>本节简要概述了游标变量。有关更多信息，请参阅宿主语言补充和<a href="../lnpls/static-sql.html#LNPLS-GUID-4A6E054A-4002-418D-A1CA-DE849CD7E6D5" target="_blank">光标变量</a> 。
                  </p>
                  <p>将静态嵌入式SQL与Pro * COBOL和Pro * FORTRAN预编译器一起使用时，可以声明游标变量。与游标一样，游标变量指向多行查询的活动集中的当前行。游标与常量与变量的不同之处不同于游标变量。当游标是静态的时，游标变量是动态的，因为它不依赖于特定的查询。您可以为任何类型兼容的查询打开游标变量。</p>
                  <p>此外，您可以为游标变量分配新值，并将其作为参数传递给子程序，包括存储在Oracle数据库中的子程序。这为您提供了一种集中数据检索的便捷方式。</p>
                  <p>首先，声明游标变量。声明变量后，使用四个语句来控制游标变量：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><code class="codeph">分配</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">打开......对于</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">取</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">关</code></p>
                     </li>
                  </ul>
                  <p>声明游标变量并为其分配内存后，必须将其作为输入主机变量（绑定变量）传递给PL / SQL，打开它以便在服务器端进行多行查询，在客户端进行<code class="codeph">FETCH</code>查询，然后<code class="codeph">CLOSE</code>它的任何一方。
                  </p>
               </div><a id="ZZPRE289"></a><div class="props_rev_3"><a id="GUID-7B44C2B9-39F2-4344-9F43-5363DB83AAAD" name="GUID-7B44C2B9-39F2-4344-9F43-5363DB83AAAD"></a><h4 id="ZZPRE-GUID-7B44C2B9-39F2-4344-9F43-5363DB83AAAD" class="sect4"><span class="enumeration_section">4.5.1</span>关于声明游标变量</h4>
                  <div>
                     <p>声明游标变量的方式取决于您的宿主语言。有关声明游标变量的说明，请参阅主机语言补充。</p>
                  </div>
               </div><a id="ZZPRE290"></a><div class="props_rev_3"><a id="GUID-6EB733A2-2737-4407-BD1B-5F30A36BCAD7" name="GUID-6EB733A2-2737-4407-BD1B-5F30A36BCAD7"></a><h4 id="ZZPRE-GUID-6EB733A2-2737-4407-BD1B-5F30A36BCAD7" class="sect4"><span class="enumeration_section">4.5.2</span>分配游标变量</h4>
                  <div>
                     <div class="section">
                        <p>您使用<code class="codeph">ALLOCATE</code>语句为游标变量分配内存。语法如下：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL ALLOCATE &lt;cursor_variable&gt;;</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE291"></a><div class="props_rev_3"><a id="GUID-79454522-5A3F-4DB6-A4A0-20D93715E6E9" name="GUID-79454522-5A3F-4DB6-A4A0-20D93715E6E9"></a><h4 id="ZZPRE-GUID-79454522-5A3F-4DB6-A4A0-20D93715E6E9" class="sect4"><span class="enumeration_section">4.5.3</span>打开游标变量</h4>
                  <div>
                     <div class="section">
                        <p><a id="d27112e2003" class="indexterm-anchor"></a>你用的是<a id="d27112e2008" class="indexterm-anchor"></a> <code class="codeph">OPEN ...FOR</code>语句将游标变量与多行查询相关联，执行查询并标识活动集。语法如下：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL OPEN &lt;cursor_variable&gt; FOR &lt;select_statement&gt;;</pre><p><code class="codeph">SELECT</code>语句可以引用输入主机变量和PL / SQL变量，参数和函数，但不能是<code class="codeph">FOR UPDATE</code> 。在以下示例中，您将打开名为<span class="italic">emp_cv</span>的游标变量：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL OPEN emp_cv FOR SELECT * FROM EMP;</pre><p><a id="d27112e2029" class="indexterm-anchor"></a>您必须在服务器端打开游标变量。您可以通过将其作为输入主机变量传递给匿名PL / SQL块来实现。在运行时，该块将发送到Oracle Server以供执行。在下面的示例中，您声明并初始化游标变量，然后将其传递给PL / SQL块，这将打开游标变量：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL BEGIN DECLARE SECTION; ...- 声明游标变量emp_cur SQL_CURSOR; EXEC SQL END DECLARE SECTION; - 初始化游标变量EXEC SQL ALLOCATE：emp_cur; EXEC SQL EXECUTE  - 将游标变量传递给PL / SQL块BEGIN  - 打开游标变量OPEN：emp_cur FOR SELECT * FROM EMP;结束; END-EXEC;</pre><p>通常，通过调用存储过程将游标变量传递给PL / SQL，该存储过程将游标变量声明为其形式参数之一。例如，以下打包过程打开名为<span class="italic">emp_cv</span>的游标变量：</p><pre class="oac_no_warn" dir="ltr">CREATE PACKAGE emp_data AS  - 定义REF CURSOR类型TYPE EmpCurTyp IS REF CURSOR RETURN emp％ROWTYPE; - 声明该类型的正式参数PROCEDURE open_emp_cv（emp_cv IN OUT EmpCurTyp）; END emp_data; CREATE PACKAGE BODY emp_data AS PROCEDURE open_emp_cv（emp_cv IN OUT EmpCurTyp）IS BEGIN  - 打开游标变量OPEN emp_cv FOR SELECT * FROM emp; END open_emp_cv; END emp_data;</pre><p>您可以从任何应用程序调用该过程，如下所示：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL EXECUTE BEGIN emp_data.open_emp_cv（：emp_cur）;结束; END-EXEC;</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE292"></a><div class="props_rev_3"><a id="GUID-7625CEB0-92B0-4627-AF4D-9B2BF86F0DD6" name="GUID-7625CEB0-92B0-4627-AF4D-9B2BF86F0DD6"></a><h4 id="ZZPRE-GUID-7625CEB0-92B0-4627-AF4D-9B2BF86F0DD6" class="sect4"><span class="enumeration_section">4.5.4</span>从游标变量中获取</h4>
                  <div>
                     <div class="section">
                        <p><a id="d27112e2067" class="indexterm-anchor"></a>打开多行查询的游标变量后，使用<code class="codeph">FETCH</code>语句一次从活动集中检索行。语法如下：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL FETCH cursor_variable_name INTO {record_name | variable_name [，variable_name，...]};</pre><p>游标变量返回的每个列值都分配给<code class="codeph">INTO</code>子句中的相应字段或变量， <code class="codeph">INTO</code>是它们的数据类型是兼容的。
                        </p>
                        <p><a id="d27112e2081" class="indexterm-anchor"></a>必须在客户端执行<code class="codeph">FETCH</code>语句。在下面的<a id="d27112e2087" class="indexterm-anchor"></a>例如，您将行提取到名为<span class="italic">emp_rec</span>的主机记录中：</p><pre class="oac_no_warn" dir="ltr">- 完成提取后退出循环执行SQL WHENEVER NOT FOUND DO no_more; LOOP  - 将行提取到记录EXEC SQL FETCH：emp_cur INTO：emp_rec; - 处理数据ENDLOOP;</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE293"></a><div class="props_rev_3"><a id="GUID-9EDBE1BA-2041-46A9-9326-4FD959D07DFC" name="GUID-9EDBE1BA-2041-46A9-9326-4FD959D07DFC"></a><h4 id="ZZPRE-GUID-9EDBE1BA-2041-46A9-9326-4FD959D07DFC" class="sect4"><span class="enumeration_section">4.5.5</span>关闭游标变量</h4>
                  <div>
                     <div class="section">
                        <p><a id="d27112e2119" class="indexterm-anchor"></a>使用<code class="codeph">CLOSE</code>语句关闭游标变量，此时其活动集变为未定义。语法如下：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL CLOSE cursor_variable_name;</pre><p><code class="codeph">CLOSE</code>语句可以在客户端或服务器端执行。在以下示例中，处理最后一行时，关闭游标变量<span class="italic">emp_cur</span> ：</p><pre class="oac_no_warn" dir="ltr">- 关闭游标变量EXEC SQL CLOSE：emp_cur;</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>