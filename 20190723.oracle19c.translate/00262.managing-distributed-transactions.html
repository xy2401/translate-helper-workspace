<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="Managing distributed transactions includes tasks such as specifying the comment point strength of a node, naming transactions, and managing in-doubt transactions."></meta>
      <meta name="description" content="Managing distributed transactions includes tasks such as specifying the comment point strength of a node, naming transactions, and managing in-doubt transactions."></meta>
      <title>管理分布式事务</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Database Administrator’s Guide "></meta>
      <meta property="og:description" content="Managing distributed transactions includes tasks such as specifying the comment point strength of a node, naming transactions, and managing in-doubt transactions."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Database Administrator’s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-administrators-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-03-14T11:02:35-07:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96348-04"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="distributed-transactions-concepts.html" title="Previous" type="text/html"></link>
      <link rel="next" href="managing-read-only-materialized-views.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Administrator&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="ADMIN"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="distributed-transactions-concepts.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="managing-read-only-materialized-views.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据库管理员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="distributed-database-management.html" property="item" typeof="WebPage"><span property="name">分布式数据库管理</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">管理分布式事务</li>
            </ol>
            <a id="GUID-AB19431E-BF9F-4181-BC57-699F8A06149D" name="GUID-AB19431E-BF9F-4181-BC57-699F8A06149D"></a><a id="ADMIN032"></a>
            
            <h2 id="ADMIN-GUID-AB19431E-BF9F-4181-BC57-699F8A06149D" class="sect2"><span class="enumeration_chapter">35</span>管理分布式事务</h2>
         </header>
         <div class="ind">
            <p>管理分布式事务包括诸如指定节点的注释点强度，命名事务和管理不确定事务之类的任务。</p>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-45329B02-514E-446E-89FE-14BA008BEA07">指定节点的提交点强度</a><br>具有最高提交点强度的数据库确定哪个节点在分布式事务中首先提交。
                  </li>
                  <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-7DCF2E63-08EC-4085-BC76-7D041D6EE96E">命名事务</a><br>您可以为交易命名。这对于标识特定的分布式事务很有用，并且为此目的替换了<code class="codeph">COMMIT COMMENT</code>语句的使用。
                  </li>
                  <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-8D0E2B32-D23A-4885-941B-E6ADEC46F6B6">查看分布式事务的信息</a><br>每个数据库的数据字典存储有关所有打开的分布式事务的信息。您可以使用数据字典表和视图来获取有关事务的信息。
                  </li>
                  <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-297F05FA-6F3E-40E6-8C11-C6B68CFAD9FE">决定如何处理疑难事务</a><br>当两阶段提交的任何方面出现故障时，事务是不确定的。分布式事务在以下方面变得不确定：运行Oracle数据库软件的服务器系统崩溃，分布式处理中涉及的两个或多个Oracle数据库之间的网络连接断开，或者发生未处理的软件错误。
                  </li>
                  <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-ED8FA97B-AA2E-4CB8-9F9F-D9575CBE3E93">手动覆盖疑难事务</a><br>使用带有<code class="codeph">FORCE</code>选项的<code class="codeph">COMMIT</code>或<code class="codeph">ROLLBACK</code>语句以及指示要提交的不确定事务的本地或全局事务ID的文本字符串。
                  </li>
                  <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-C4AC1D9D-1ED1-4210-A416-57023F4BC32D">从数据字典中清除待处理的行</a><br>您可以从数据字典中清除待处理行以进行不确定的事务。
                  </li>
                  <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-79B20A57-048B-4C66-9803-0C4FE81A4A84">手动提交疑难事务：示例</a><br>示例说明了手动提交不确定事务。
                  </li>
                  <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-AFA3EFDD-95BA-4FAD-B465-8ED6776D1E59">锁定导致数据访问失败</a><br>发出SQL语句时，数据库会尝试锁定成功执行语句所需的资源。但是，如果请求的数据当前由其他未提交的事务的语句保留，并且长时间保持锁定状态，则会发生超时。
                  </li>
                  <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-26729889-99BC-4315-9903-AB8C171C557F">模拟分布式事务失败</a><br>您可以强制分布式事务的失败，以观察RECO自动解析事务的本地部分，或者练习手动解决不确定的分布式事务并观察结果。
                  </li>
                  <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-195124A5-FF1B-40BA-BAF9-CB5272E8BFD3">管理读一致性</a><br>分布式读取一致性的Oracle数据库实现存在一个重要的限制。
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="distributed-database-management.html#GUID-43B1A794-4C8E-4CC5-BF5B-A408A50EB6FA" title="您可以管理分布式数据库环境。">分布式数据库管理</a></p>
                  </div>
               </div>
            </div>
            <a id="ADMIN12247"></a><div class="props_rev_3"><a id="GUID-45329B02-514E-446E-89FE-14BA008BEA07" name="GUID-45329B02-514E-446E-89FE-14BA008BEA07"></a><h3 id="ADMIN-GUID-45329B02-514E-446E-89FE-14BA008BEA07" class="sect3"><span class="enumeration_section">35.1</span>指定节点的提交点强度</h3>
               <div>
                  <p>具有最高提交点强度的数据库确定哪个节点在分布式事务中首先提交。</p>
                  <div class="section">
                     <p>为每个节点指定提交点强度时，如果在准备或提交阶段发生故障，请确保最关键的服务器是非阻塞的。<code class="codeph">COMMIT_POINT_STRENGTH</code>初始化参数确定节点的提交点强度。
                     </p>
                     <p>默认值取决于操作系统。值的范围是0到255之间的任何整数。例如，要将数据库的提交点强度设置为200，请在数据库初始化参数文件中包含以下行：</p><pre class="oac_no_warn" dir="ltr">COMMIT_POINT_STRENGTH = 200</pre><p>提交点强度仅用于确定分布式事务中的提交点站点。</p>
                     <p>为数据库设置提交点强度时，请注意以下注意事项：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>由于提交点站点存储有关事务状态的信息，因此提交点站点不应是经常不可靠或不可用的节点，以防其他节点需要有关事务状态的信息。</p>
                        </li>
                        <li>
                           <p>相对于数据库中的关键共享数据量，设置数据库的提交点强度。例如，大型计算机上的数据库通常在用户之间共享比PC上的数据库更多的数据。因此，将主机的提交点强度设置为高于PC的值。</p>
                           <div class="infoboxnotealso" id="GUID-45329B02-514E-446E-89FE-14BA008BEA07__GUID-00EE1E2C-021C-47E8-AA27-E8C02C382181">
                              <p class="notep1">也可以看看：</p>
                              <p><span class="q">“ <a href="distributed-transactions-concepts.html#GUID-FB773DD4-B700-423F-A9EB-8D6F6765583E" title="The job of the commit point site is to initiate a commit or roll back operation as instructed by the global coordinator.">提交点站点</a> ”，</span>用于<span class="q"><a href="distributed-transactions-concepts.html#GUID-FB773DD4-B700-423F-A9EB-8D6F6765583E" title="提交点站点的工作是按照全局协调器的指示启动提交或回滚操作。">提交点</a></span>的概念性概述</p>
                           </div>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-AB19431E-BF9F-4181-BC57-699F8A06149D" title="管理分布式事务包括诸如指定节点的注释点强度，命名事务和管理不确定事务之类的任务。">管理分布式事务</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADMIN12248"></a><div class="props_rev_3"><a id="GUID-7DCF2E63-08EC-4085-BC76-7D041D6EE96E" name="GUID-7DCF2E63-08EC-4085-BC76-7D041D6EE96E"></a><h3 id="ADMIN-GUID-7DCF2E63-08EC-4085-BC76-7D041D6EE96E" class="sect3"><span class="enumeration_section">35.2</span>命名事务</h3>
               <div>
                  <p>您可以为交易命名。这对于标识特定的分布式事务很有用，并且为此目的替换了<code class="codeph">COMMIT COMMENT</code>语句的使用。
                  </p>
                  <div class="section">
                     <p>要命名事务，请使用<code class="codeph">SET TRANSACTION...NAME</code>声明。例如：</p><pre class="oac_no_warn" dir="ltr">SET TRANSACTION ISOLATION LEVEL SERIALIZABLE NAME'更新库存检查点0';</pre><p>此示例显示用户启动了一个隔离级别等于<code class="codeph">SERIALIZABLE</code>的新事务，并将其命名为<code class="codeph">'update inventory checkpoint 0'</code> 。
                     </p>
                     <p>对于分布式事务，在提交事务时将名称发送到参与的站点。如果存在<code class="codeph">COMMIT COMMENT</code> ，则在事务名称存在时将忽略它。
                     </p>
                     <p>事务名称显示在<code class="codeph">V$TRANSACTION</code>视图的<code class="codeph">NAME</code>列中，并在提交事务时显示在<code class="codeph">DBA_2PC_PENDING</code>视图的<code class="codeph">TRAN_COMMENT</code>字段中。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-AB19431E-BF9F-4181-BC57-699F8A06149D" title="管理分布式事务包括诸如指定节点的注释点强度，命名事务和管理不确定事务之类的任务。">管理分布式事务</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADMIN12249"></a><div class="props_rev_3"><a id="GUID-8D0E2B32-D23A-4885-941B-E6ADEC46F6B6" name="GUID-8D0E2B32-D23A-4885-941B-E6ADEC46F6B6"></a><h3 id="ADMIN-GUID-8D0E2B32-D23A-4885-941B-E6ADEC46F6B6" class="sect3"><span class="enumeration_section">35.3</span>查看分布式事务的信息</h3>
               <p>每个数据库的数据字典存储有关所有打开的分布式事务的信息。您可以使用数据字典表和视图来获取有关事务的信息。</p>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-CF29B5D4-0FBF-4A72-9EAD-A4618B7A6BC6">确定准备交易的ID号和状态</a><br>使用<code class="codeph">DBA_2PC_PENDING</code>视图确定特定事务ID的全局提交编号。手动解决不确定事务时，可以使用此全局提交编号。
                     </li>
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-161034B0-BAEB-4750-9054-328356881B74">跟踪毫无疑问事务的会话树</a><br><code class="codeph">DBA_2PC_NEIGHBORS</code>视图显示哪些<code class="codeph">DBA_2PC_NEIGHBORS</code>事务是从远程客户端传入的，哪些是传出到远程服务器的。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-AB19431E-BF9F-4181-BC57-699F8A06149D" title="管理分布式事务包括诸如指定节点的注释点强度，命名事务和管理不确定事务之类的任务。">管理分布式事务</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADMIN13153"></a><a id="ADMIN12250"></a><div class="props_rev_3"><a id="GUID-CF29B5D4-0FBF-4A72-9EAD-A4618B7A6BC6" name="GUID-CF29B5D4-0FBF-4A72-9EAD-A4618B7A6BC6"></a><h4 id="ADMIN-GUID-CF29B5D4-0FBF-4A72-9EAD-A4618B7A6BC6" class="sect4"><span class="enumeration_section">35.3.1</span>确定准备交易的ID号和状态</h4>
                  <div>
                     <p>使用<code class="codeph">DBA_2PC_PENDING</code>视图确定特定事务ID的全局提交编号。手动解决不确定事务时，可以使用此全局提交编号。
                     </p>
                     <div class="section">
                        <p>以下视图显示已在本地数据库中定义并存储在数据字典中的数据库链接：</p>
                        <div class="tblformal" id="GUID-CF29B5D4-0FBF-4A72-9EAD-A4618B7A6BC6__GUID-6813CD87-053D-41D2-AA35-3B224ADE284C">
                           <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="Column 1 lists the names of views used to display the database links; column 2 describes each view." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="42%" id="d320711e414">视图</th>
                                    <th align="left" valign="bottom" width="58%" id="d320711e417">目的</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="42%" id="d320711e422" headers="d320711e414 ">
                                       <p><code class="codeph">DBA_2PC_PENDING</code></p>
                                    </td>
                                    <td align="left" valign="top" width="58%" headers="d320711e422 d320711e417 ">
                                       <p>列出所有不确定的分布式事务。视图为空，直到由不确定的事务填充。解决了事务后，将清除视图。</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>下表显示了最相关的列（有关视图中所有列的说明，请参阅<a href="../refrn/DBA_2PC_PENDING.html#REFRN23002" target="_blank"><span class="italic">Oracle数据库参考</span></a> ）：</p>
                        <div class="tblformal" id="GUID-CF29B5D4-0FBF-4A72-9EAD-A4618B7A6BC6__G1008762">
                           <p class="titleintable">表35-1 DBA_2PC_PENDING</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="DBA_2PC_PENDING" width="100%" border="1" summary="Column 1 contains the view column name; column 2 describes the column." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="29%" id="d320711e446">柱</th>
                                    <th align="left" valign="bottom" width="71%" id="d320711e449">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d320711e454" headers="d320711e446 ">
                                       <p><code class="codeph">LOCAL_TRAN_ID</code> 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d320711e454 d320711e449 ">
                                       <p>本地事务标识符，格式为<span class="italic">整数</span> 。 <span class="italic">整数</span> 。 <span class="italic">整数</span> 。
                                       </p>
                                       <p><span class="bold">注意：</span>当连接的<code class="codeph">LOCAL_TRAN_ID</code>和<code class="codeph">GLOBAL_TRAN_ID</code>相同时，该节点是事务的全局协调器。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d320711e482" headers="d320711e446 ">
                                       <p><code class="codeph">GLOBAL_TRAN_ID</code> 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d320711e482 d320711e449 ">
                                       <p>全局数据库标识符，格式为<span class="italic">global_db_nam</span> e。 <span class="italic">db_hex_id</span> 。 <span class="italic">local_tran_id</span> ，其中<span class="italic">db_hex_id</span>是用于唯一标识数据库的八字符十六进制值。对于分布式事务，此公共事务ID在每个节点上都是相同的。
                                       </p>
                                       <p><span class="bold">注意：</span>当连接的<code class="codeph">LOCAL_TRAN_ID</code>和<code class="codeph">GLOBAL_TRAN_ID</code>相同时，该节点是事务的全局协调器。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d320711e513" headers="d320711e446 ">
                                       <p><code class="codeph">州</code> 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d320711e513 d320711e449 ">
                                       <p><code class="codeph">STATE</code>可以具有以下值：</p>
                                       <ul style="list-style-type:disc">
                                          <li>
                                             <p>搜集</p>
                                             <p>此类别通常仅适用于全球协调员或当地协调员。该节点当前正在从其他数据库服务器收集信息，然后才能决定是否可以准备。</p>
                                          </li>
                                          <li>
                                             <p>准备</p>
                                             <p>该节点已准备好，可能已经或可能没有向其本地协调器通过准备好的消息确认这一点。但是，没有收到任何提交请求。节点保持准备状态，保存事务提交所需的任何本地资源锁。</p>
                                          </li>
                                          <li>
                                             <p>承诺</p>
                                             <p>节点（任何类型）已提交事务，但事务中涉及的其他节点可能没有完成相同的操作。也就是说，事务仍在一个或多个节点处待决。</p>
                                          </li>
                                          <li>
                                             <p>强制提交</p>
                                             <p>可以根据数据库管理员的判断强制提交挂起的事务。如果在本地节点上手动提交事务，则会发生此条目。</p>
                                          </li>
                                          <li>
                                             <p>强制终止（回滚）</p>
                                             <p>可以根据数据库管理员的判断强制退回挂起的事务。如果在本地节点上手动回滚此事务，则会发生此条目。</p>
                                          </li>
                                       </ul>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d320711e550" headers="d320711e446 ">
                                       <p><code class="codeph">混合</code> 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d320711e550 d320711e449 ">
                                       <p><code class="codeph">YES</code>表示事务的一部分在一个节点上提交，并在另一个节点上回滚。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d320711e561" headers="d320711e446 ">
                                       <p><code class="codeph">TRAN_COMMENT</code></p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d320711e561 d320711e449 ">
                                       <p>事务注释，或者，如果使用事务命名，则在提交事务时将事务名称放在此处。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d320711e569" headers="d320711e446 ">
                                       <p><code class="codeph">主办</code> 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d320711e569 d320711e449 ">
                                       <p>主机系统的名称。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d320711e578" headers="d320711e446 ">
                                       <p><code class="codeph">承诺＃</code> 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d320711e578 d320711e449 ">
                                       <p>已提交事务的全局提交编号。</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>执行以下脚本，名为<code class="codeph">pending_txn_script</code> ，以查询<code class="codeph">DBA_2PC_PENDING</code>相关信息（包括样本输出）：</p><pre class="oac_no_warn" dir="ltr">COL LOCAL_TRAN_ID格式A13 COL GLOBAL_TRAN_ID格式A30 COL状态格式A8 COL混合格式A3 COL主机格式A10 COL COMMIT #FORMAT A10 SELECT LOCAL_TRAN_ID，GLOBAL_TRAN_ID，STATE，MIXED，HOST，COMMIT＃FROM DBA_2PC_PENDING / SQL&gt; @pending_txn_script LOCAL_TRAN_ID GLOBAL_TRAN_ID STATE MIX HOST COMMIT＃------------- ------------------------------ ----- --- --- ---------- ---------- 1.15.870 HQ.EXAMPLE.COM.ef192da4.1.15.870 commit no dlsun183 115499</pre><p>此输出指示已在此节点上提交本地事务<code class="codeph">1.15.870</code> ，但它可能在一个或多个其他节点上挂起。由于<code class="codeph">LOCAL_TRAN_ID</code>和当地部分<code class="codeph">GLOBAL_TRAN_ID</code>是相同的，该节点是该交易的全球协调人。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-8D0E2B32-D23A-4885-941B-E6ADEC46F6B6" title="每个数据库的数据字典存储有关所有打开的分布式事务的信息。您可以使用数据字典表和视图来获取有关事务的信息。">查看有关分布式事务的信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN13154"></a><a id="ADMIN12251"></a><div class="props_rev_3"><a id="GUID-161034B0-BAEB-4750-9054-328356881B74" name="GUID-161034B0-BAEB-4750-9054-328356881B74"></a><h4 id="ADMIN-GUID-161034B0-BAEB-4750-9054-328356881B74" class="sect4"><span class="enumeration_section">35.3.2</span>跟踪怀疑事务的会话树</h4>
                  <div>
                     <p><code class="codeph">DBA_2PC_NEIGHBORS</code>视图显示哪些<code class="codeph">DBA_2PC_NEIGHBORS</code>事务是从远程客户端传入的，哪些是传出到远程服务器的。
                     </p>
                     <div class="section">
                        <p></p>
                        <div class="tblformal" id="GUID-161034B0-BAEB-4750-9054-328356881B74__GUID-D935C643-AB6F-4B07-92A7-B9006B291B71">
                           <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="Column 1 lists the view name and column 2 describes the purpose of the view." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="33%" id="d320711e689">视图</th>
                                    <th align="left" valign="bottom" width="67%" id="d320711e692">目的</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="33%" id="d320711e697" headers="d320711e689 ">
                                       <p><code class="codeph">DBA_2PC_NEIGHBORS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="67%" headers="d320711e697 d320711e692 ">
                                       <p>列出所有传入（来自远程客户端）和传出（到远程服务器）的不确定分布式事务。它还指示本地节点是否是事务中的提交点站点。</p>
                                       <p>视图为空，直到由不确定的事务填充。解决了事务后，将清除视图。</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>当事务不确定时，您可能需要确定哪些节点在会话树中执行了哪些角色。用于此视图以确定：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>给定事务的所有传入和传出连接</p>
                           </li>
                           <li>
                              <p>节点是否是给定事务中的提交点站点</p>
                           </li>
                           <li>
                              <p>节点是否是给定事务中的全局协调器（因为其本地事务ID和全局事务ID相同）</p>
                           </li>
                        </ul>
                        <p>下表显示了最相关的列（对于视图中所有列的帐户，请参阅<span class="italic"> </span> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/admin&amp;id=REFRN23002" target="_blank"><span class="italic">Oracle数据库参考</span></a> ）：</p>
                        <div class="tblformal" id="GUID-161034B0-BAEB-4750-9054-328356881B74__GUID-247C1BC6-2BB4-42DF-A945-8EAED654144C">
                           <p class="titleintable">表35-2 DBA_2PC_NEIGHBORS</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="DBA_2PC_NEIGHBORS" width="100%" border="1" summary="Column 1 contains the view column name; column 2 describes the column." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="29%" id="d320711e738">柱</th>
                                    <th align="left" valign="bottom" width="71%" id="d320711e741">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d320711e746" headers="d320711e738 ">
                                       <p><code class="codeph">LOCAL_TRAN_ID</code> 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d320711e746 d320711e741 ">
                                       <p>本地事务标识符，格式为<span class="italic">整数</span> 。 <span class="italic">整数</span> 。 <span class="italic">整数</span> 。
                                       </p>
                                       <p><span class="bold">注意：</span>当<code class="codeph">LOCAL_TRAN_ID</code>和<code class="codeph">GLOBAL_TRAN_ID</code> 。连接的<code class="codeph">DBA_2PC_PENDING</code>是相同的，节点是事务的全局协调器。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d320711e777" headers="d320711e738 ">
                                       <p><code class="codeph">进出</code> 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d320711e777 d320711e741 ">
                                       <p><code class="codeph">IN</code>用于传入交易; <code class="codeph">OUT</code>用于传出事务。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d320711e791" headers="d320711e738 ">
                                       <p><code class="codeph">数据库</code> 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d320711e791 d320711e741 ">
                                       <p>对于传入事务，请求来自此本地节点的信息的客户端数据库的名称;对于传出事务，用于访问远程服务器上的信息的数据库链接的名称。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d320711e800" headers="d320711e738 ">
                                       <p><code class="codeph">DBUSER_OWNER</code> 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d320711e800 d320711e741 ">
                                       <p>对于传入事务，本地帐户用于通过远程数据库链接进行连接;对于传出事务，数据库链接的所有者。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d320711e809" headers="d320711e738 ">
                                       <p><code class="codeph">接口</code> 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d320711e809 d320711e741 ">
                                       <p><code class="codeph">C</code>是提交消息; <code class="codeph">N</code>是指示准备状态的消息或者是只读提交的请求。
                                       </p>
                                       <p>当<code class="codeph">IN_OUT</code>为<code class="codeph">OUT</code> ， <code class="codeph">C</code>表示连接远程端的子节点是提交点站点，并且知道是提交还是终止。<code class="codeph">N</code>表示本地节点通知远程节点它已准备好。
                                       </p>
                                       <p>当<code class="codeph">IN_OUT</code>为<code class="codeph">IN</code> ， <code class="codeph">C</code>表示本地节点或传出连接远程端的数据库是提交点站点。<code class="codeph">N</code>表示远程节点通知本地节点它已准备好。
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>执行以下脚本，名为<code class="codeph">neighbors_script</code> ，以查询<code class="codeph">DBA_2PC_PENDING</code>相关信息（包括样本输出）：</p><pre class="oac_no_warn" dir="ltr">COL LOCAL_TRAN_ID格式A13 COL IN_OUT格式A6 COL数据库格式A25 COL DBUSER_OWNER格式A15 COL接口格式A3 SELECT LOCAL_TRAN_ID，IN_OUT，DATABASE，DBUSER_OWNER，INTERFACE FROM DBA_2PC_NEIGHBORS / SQL&gt; CONNECT SYS@hq.example.com AS SYSDBA SQL&gt; @neighbors_script LOCAL_TRAN_ID IN_OUT DATABASE DBUSER_OWNER INT ------------- ------ -------------------------  - ------------- --- 1.15.870 out SALES.EXAMPLE.COM SYS C.</pre><p>此输出指示本地节点向远程服务器<code class="codeph">sales</code>发送传出请求以提交事务<code class="codeph">1.15.870</code> 。如果<code class="codeph">sales</code>提交了事务但没有其他节点，那么您知道<code class="codeph">sales</code>是提交点站点，因为提交点站点始终首先提交。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-8D0E2B32-D23A-4885-941B-E6ADEC46F6B6" title="每个数据库的数据字典存储有关所有打开的分布式事务的信息。您可以使用数据字典表和视图来获取有关事务的信息。">查看有关分布式事务的信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="ADMIN12252"></a><div class="props_rev_3"><a id="GUID-297F05FA-6F3E-40E6-8C11-C6B68CFAD9FE" name="GUID-297F05FA-6F3E-40E6-8C11-C6B68CFAD9FE"></a><h3 id="ADMIN-GUID-297F05FA-6F3E-40E6-8C11-C6B68CFAD9FE" class="sect3"><span class="enumeration_section">35.4</span>决定如何处理疑难事务</h3>
               <div>
                  <p>当两阶段提交的任何方面出现故障时，事务是不确定的。分布式事务在以下方面变得不确定：运行Oracle数据库软件的服务器系统崩溃，分布式处理中涉及的两个或多个Oracle数据库之间的网络连接断开，或者发生未处理的软件错误。</p>
                  <p>您可以手动强制提交或回滚本地的，不确定的分布式事务。由于此操作可能会生成一致性问题，因此仅在存在特定条件时才执</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-A5D6851D-FE93-4A3F-A1A0-AFF0B47F85AC">发现两阶段提交的问题</a><br>当分布式事务出现问题时，错误消息会通知应用程序。
                     </li>
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-EE0D5633-6B92-47AC-A02E-7202A0C64094">确定是否执行手动覆盖</a><br>您应该仅在某些条件下覆盖不确定的交易。
                     </li>
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-32CDEA9B-5102-49A9-9893-E84D11205418">分析交易数据</a><br>如果您决定强制完成事务，则分析可用信息。
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-297F05FA-6F3E-40E6-8C11-C6B68CFAD9FE__GUID-D15E1B17-56CE-4C85-8EB1-A1E5E916983F">
                     <p class="notep1">也可以看看：</p><a href="distributed-transactions-concepts.html#GUID-364CA7BD-A02E-4A74-AF72-45021CAC3E3C" title="两阶段提交机制确保所有节点一起提交或执行回滚。如果由于系统或网络错误导致三个阶段中的任何一个失败，会发生什么？交易变得毫无疑问。">怀疑交易</a></div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-AB19431E-BF9F-4181-BC57-699F8A06149D" title="管理分布式事务包括诸如指定节点的注释点强度，命名事务和管理不确定事务之类的任务。">管理分布式事务</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADMIN12253"></a><div class="props_rev_3"><a id="GUID-A5D6851D-FE93-4A3F-A1A0-AFF0B47F85AC" name="GUID-A5D6851D-FE93-4A3F-A1A0-AFF0B47F85AC"></a><h4 id="ADMIN-GUID-A5D6851D-FE93-4A3F-A1A0-AFF0B47F85AC" class="sect4"><span class="enumeration_section">35.4.1</span>发现两阶段提交的问题</h4>
                  <div>
                     <p>当分布式事务出现问题时，错误消息会通知应用程序。</p>
                     <div class="section">
                        <p>提交分布式事务的用户应用程序通过以下错误消息之一通知问题：</p><pre class="oac_no_warn" dir="ltr">ORA-02050：事务<span class="italic">ID</span>回滚，某些远程dbs可能不确定ORA-02053：事务<span class="italic">ID已</span>提交，某些远程dbs可能存在疑问ORA-02054：事务<span class="italic">ID</span>不确定</pre><p>如果一个强大的应用程序收到任何前面的错误，它应该保存有关事务的信息。如果需要手动分布式事务恢复，可以在以后使用此信息。</p>
                        <p>由于网络或系统故障，具有一个或多个不确定分布式事务的任何节点的管理员无需执行任何操作。数据库的自动恢复功能透明地完成任何不确定的事务，以便在解决网络或系统故障后，在会话树的所有节点上（即，所有提交或全部回滚）发生相同的结果。</p>
                        <p>但是，在延长的中断中，您可以强制提交或回滚事务以释放任何锁定的数据。应用程序必须考虑这些可能性。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-297F05FA-6F3E-40E6-8C11-C6B68CFAD9FE" title="当两阶段提交的任何方面出现故障时，事务是不确定的。分布式事务在以下方面变得不确定：运行Oracle数据库软件的服务器系统崩溃，分布式处理中涉及的两个或多个Oracle数据库之间的网络连接断开，或者发生未处理的软件错误。">决定如何处理疑难事务</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN12254"></a><div class="props_rev_3"><a id="GUID-EE0D5633-6B92-47AC-A02E-7202A0C64094" name="GUID-EE0D5633-6B92-47AC-A02E-7202A0C64094"></a><h4 id="ADMIN-GUID-EE0D5633-6B92-47AC-A02E-7202A0C64094" class="sect4"><span class="enumeration_section">35.4.2</span>确定是否执行手动覆盖</h4>
                  <div>
                     <p>您应该仅在某些条件下覆盖不确定的交易。</p>
                     <div class="section">
                        <p><span class="italic">仅</span>在存在以下某个条件时手动覆盖特定的不确定事务：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>不确定事务锁定其他事务所需的数据。当<code class="codeph">ORA-01591</code>错误消息干扰用户事务时，会发生这种情况。
                              </p>
                           </li>
                           <li>
                              <p>不确定事务会阻止撤消段的范围被其他事务使用。<code class="codeph">DBA_2PC_PENDING.</code>分布式事务的本地事务ID的第一部分对应于由数据字典视图<code class="codeph">DBA_2PC_PENDING.</code>列出的还原段的ID <code class="codeph">DBA_2PC_PENDING.</code></p>
                           </li>
                           <li>
                              <p>在可接受的时间段内无法纠正阻止两阶段提交阶段完成的故障。这种情况的示例包括已经损坏的电信网络或需要长恢复时间的损坏的数据库。</p>
                           </li>
                        </ul>
                        <p>通常情况下，您应该与其他地方的管理员协商，在当地强制执行不确定的分布式交易。错误的决策可能导致难以跟踪的数据库不一致，您必须手动更正。</p>
                        <p>如果这些条件都不适用，请<span class="italic">始终</span>允许数据库的自动恢复功能完成事务。但是，如果满足任何这些条件，请考虑本地覆盖不确定事务。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-297F05FA-6F3E-40E6-8C11-C6B68CFAD9FE" title="当两阶段提交的任何方面出现故障时，事务是不确定的。分布式事务在以下方面变得不确定：运行Oracle数据库软件的服务器系统崩溃，分布式处理中涉及的两个或多个Oracle数据库之间的网络连接断开，或者发生未处理的软件错误。">决定如何处理疑难事务</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN12255"></a><div class="props_rev_3"><a id="GUID-32CDEA9B-5102-49A9-9893-E84D11205418" name="GUID-32CDEA9B-5102-49A9-9893-E84D11205418"></a><h4 id="ADMIN-GUID-32CDEA9B-5102-49A9-9893-E84D11205418" class="sect4"><span class="enumeration_section">35.4.3</span>分析交易数据</h4>
                  <p>如果您决定强制完成事务，则分析可用信息。</p>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-B4297A79-212F-445A-A0FA-091D67467459">查找已提交或已回滚的节点</a><br>使用<code class="codeph">DBA_2PC_PENDING</code>视图查找已提交或回滚事务的节点。
                        </li>
                        <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-329C351B-055E-407E-9329-B4AF632BB2F7">寻找交易评论</a><br>查看<code class="codeph">TRAN_COMMENT</code>列中<code class="codeph">DBA_2PC_PENDING</code>为分布式事务提供了任何信息。
                        </li>
                        <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-70DA3373-1BC5-44E8-8947-4E57D62FE2CA">寻找交易建议</a><br>查看<code class="codeph">DBA_2PC_PENDING</code>的<code class="codeph">ADVICE</code>列中<code class="codeph">DBA_2PC_PENDING</code>为分布式事务提供了任何信息。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-297F05FA-6F3E-40E6-8C11-C6B68CFAD9FE" title="当两阶段提交的任何方面出现故障时，事务是不确定的。分布式事务在以下方面变得不确定：运行Oracle数据库软件的服务器系统崩溃，分布式处理中涉及的两个或多个Oracle数据库之间的网络连接断开，或者发生未处理的软件错误。">决定如何处理疑难事务</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="ADMIN12256"></a><div class="props_rev_3"><a id="GUID-B4297A79-212F-445A-A0FA-091D67467459" name="GUID-B4297A79-212F-445A-A0FA-091D67467459"></a><h5 id="ADMIN-GUID-B4297A79-212F-445A-A0FA-091D67467459" class="sect5"><span class="enumeration_section">35.4.3.1</span>查找已提交或已<span class="enumeration_section">回滚</span>的节点</h5>
                     <div>
                        <p>使用<code class="codeph">DBA_2PC_PENDING</code>视图查找已提交或回滚事务的节点。
                        </p>
                        <div class="section">
                           <p>如果您可以找到已解决该事务的节点，则可以按照该节点上执行的操作进行操作。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-32CDEA9B-5102-49A9-9893-E84D11205418" title="如果您决定强制完成事务，则分析可用信息。">分析事务数据</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN12257"></a><div class="props_rev_3"><a id="GUID-329C351B-055E-407E-9329-B4AF632BB2F7" name="GUID-329C351B-055E-407E-9329-B4AF632BB2F7"></a><h5 id="ADMIN-GUID-329C351B-055E-407E-9329-B4AF632BB2F7" class="sect5"><span class="enumeration_section">35.4.3.2</span>查找交易评论</h5>
                     <div>
                        <p>查看<code class="codeph">TRAN_COMMENT</code>列中<code class="codeph">DBA_2PC_PENDING</code>为分布式事务提供了任何信息。
                        </p>
                        <div class="section">
                           <p>注释包含在<code class="codeph">COMMIT</code>语句的<code class="codeph">COMMENT</code>子句中，或者如果使用事务命名，则事务名称在<code class="codeph">TRAN_COMMENT</code>事务时放在<code class="codeph">TRAN_COMMENT</code>字段中。
                           </p>
                           <p>例如，不确定的分布式事务的注释可以指示事务的来源以及它是什么类型的事务：<code class="codeph"></code></p><pre class="oac_no_warn" dir="ltr">COMMIT COMMENT'Finance / Accts_pay / Trans_type 10B';</pre><p><code class="codeph">SET TRANSACTION...也可以使用NAME</code>语句（并且更可取）在事务名称中提供此信息。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-329C351B-055E-407E-9329-B4AF632BB2F7__GUID-C912BFCC-6A15-4B34-963E-905B4EBF4066">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="managing-distributed-transactions.html#GUID-7DCF2E63-08EC-4085-BC76-7D041D6EE96E" title="您可以为交易命名。这对于标识特定的分布式事务很有用，并且为此目的替换了COMMIT COMMENT语句的使用。">命名交易</a> ”</span></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-32CDEA9B-5102-49A9-9893-E84D11205418" title="如果您决定强制完成事务，则分析可用信息。">分析事务数据</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN12258"></a><div class="props_rev_3"><a id="GUID-70DA3373-1BC5-44E8-8947-4E57D62FE2CA" name="GUID-70DA3373-1BC5-44E8-8947-4E57D62FE2CA"></a><h5 id="ADMIN-GUID-70DA3373-1BC5-44E8-8947-4E57D62FE2CA" class="sect5"><span class="enumeration_section">35.4.3.3</span>查找交易建议</h5>
                     <div>
                        <p>查看<code class="codeph">DBA_2PC_PENDING</code>的<code class="codeph">ADVICE</code>列中<code class="codeph">DBA_2PC_PENDING</code>为分布式事务提供了任何信息。
                        </p>
                        <div class="section">
                           <p>应用程序可以使用<code class="codeph">ALTER SESSION</code>语句的<code class="codeph">ADVISE</code>子句规定是否强制提交或强制回滚分布式事务的单独部分的建议。
                           </p>
                           <p>在准备阶段期间向每个节点发送的建议是在当前事务中在该数据库处执行的最新DML语句时有效的建议。</p>
                           <p>例如，考虑一个分布式事务从所述移动雇员记录<code class="codeph">emp</code>表在一个节点到<code class="codeph">emp</code>在另一节点表。事务可以保护记录 - 即使管理员通过包含以下SQL语句序列来独立强制每个节点上的不确定事务 -</p><pre class="oac_no_warn" dir="ltr">ALTER SESSION ADVISE COMMIT; INSERT INTO \ temp @ hq ...; / *建议在总部* / ALTER SESSION ADVISE ROLLBACK承诺;删除来自emp @ sales ...; / *建议在SALES * / ALTER SESSION ADVISE NOTHING回滚;</pre><p>如果您按照给定的建议手动强制执行不确定事务，则可能发生的最坏情况是每个节点都有员工记录的副本;记录不能消失。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-32CDEA9B-5102-49A9-9893-E84D11205418" title="如果您决定强制完成事务，则分析可用信息。">分析事务数据</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div><a id="ADMIN12259"></a><div class="props_rev_3"><a id="GUID-ED8FA97B-AA2E-4CB8-9F9F-D9575CBE3E93" name="GUID-ED8FA97B-AA2E-4CB8-9F9F-D9575CBE3E93"></a><h3 id="ADMIN-GUID-ED8FA97B-AA2E-4CB8-9F9F-D9575CBE3E93" class="sect3"><span class="enumeration_section">35.5</span>手动覆盖疑难事务</h3>
               <div>
                  <p>使用带有<code class="codeph">FORCE</code>选项的<code class="codeph">COMMIT</code>或<code class="codeph">ROLLBACK</code>语句以及指示要提交的不确定事务的本地或全局事务ID的文本字符串。
                  </p>
                  <div class="infoboxnote" id="GUID-ED8FA97B-AA2E-4CB8-9F9F-D9575CBE3E93__GUID-E9E504BB-DE89-4D79-B1B4-B969B6C40951">
                     <p class="notep1">注意：</p>
                     <p>在所有示例中，事务在本地节点上提交或回滚，并且本地挂起事务表记录此事务的行的<code class="codeph">STATE</code>列的强制提交或强制终止的值。
                     </p>
                  </div>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-94CB1DFF-1100-4D3B-8E83-902CA85B5551">手动提交疑难事务</a><br>您可以使用事务ID或SCN手动提交不确定事务。</li>
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-370CCC2F-4F04-450F-A280-1394C661D836">手动回滚疑难事务</a><br>您可以使用事务ID回滚不确定的事务。</li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-AB19431E-BF9F-4181-BC57-699F8A06149D" title="管理分布式事务包括诸如指定节点的注释点强度，命名事务和管理不确定事务之类的任务。">管理分布式事务</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-94CB1DFF-1100-4D3B-8E83-902CA85B5551" name="GUID-94CB1DFF-1100-4D3B-8E83-902CA85B5551"></a><h4 id="ADMIN-GUID-94CB1DFF-1100-4D3B-8E83-902CA85B5551" class="sect4"><span class="enumeration_section">35.5.1</span>手动提交<span class="enumeration_section">疑难</span>事务</h4>
                  <p>您可以使用事务ID或SCN手动提交不确定事务。</p>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-6DA6A749-FA02-4B3E-8416-3239D32A2B80">提交疑难事务所需的权限</a><br>在尝试提交事务之前，请确保您具有适当的权限。
                        </li>
                        <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-EB1D9627-1410-4DE7-B190-6539441B7D7B">仅使用事务ID进行提交</a><br>您可以使用事务ID提交不确定事务。</li>
                        <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-672BECA8-8B03-43A7-AC93-14AFB76CB07C">使用SCN进行提交</a><br>您可以使用SCN提交不确定的事务。</li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-ED8FA97B-AA2E-4CB8-9F9F-D9575CBE3E93" title="使用带有FORCE选项的COMMIT或ROLLBACK语句以及指示要提交的不确定事务的本地或全局事务ID的文本字符串。">手动覆盖疑难事务</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="ADMIN12260"></a><div class="props_rev_3"><a id="GUID-6DA6A749-FA02-4B3E-8416-3239D32A2B80" name="GUID-6DA6A749-FA02-4B3E-8416-3239D32A2B80"></a><h5 id="ADMIN-GUID-6DA6A749-FA02-4B3E-8416-3239D32A2B80" class="sect5"><span class="enumeration_section">35.5.1.1</span>提交<span class="enumeration_section">疑难事务所需的</span>权限</h5>
                     <div>
                        <p>在尝试提交事务之前，请确保您具有适当的权限。</p>
                        <p>请注意以下要求：</p>
                        <div class="tblformal" id="GUID-6DA6A749-FA02-4B3E-8416-3239D32A2B80__GUID-1C158FB9-14DD-4704-AE21-4D209F14CD8B">
                           <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="Column 1 lists who is attempting to commit a transaction.; column 2 lists the associated privileges that are required." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="45%" id="d320711e1612">用户提交交易</th>
                                    <th align="left" valign="bottom" width="55%" id="d320711e1615">特权要求</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="45%" id="d320711e1620" headers="d320711e1612 ">
                                       <p>您</p>
                                    </td>
                                    <td align="left" valign="top" width="55%" headers="d320711e1620 d320711e1615 ">
                                       <p><code class="codeph">强制交易</code> 
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="45%" id="d320711e1629" headers="d320711e1612 ">
                                       <p>另一个用户</p>
                                    </td>
                                    <td align="left" valign="top" width="55%" headers="d320711e1629 d320711e1615 ">
                                       <p><code class="codeph">强迫任何交易</code> 
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-94CB1DFF-1100-4D3B-8E83-902CA85B5551" title="您可以使用事务ID或SCN手动提交不确定事务。">手动提交疑难事务</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN12261"></a><div class="props_rev_3"><a id="GUID-EB1D9627-1410-4DE7-B190-6539441B7D7B" name="GUID-EB1D9627-1410-4DE7-B190-6539441B7D7B"></a><h5 id="ADMIN-GUID-EB1D9627-1410-4DE7-B190-6539441B7D7B" class="sect5"><span class="enumeration_section">35.5.1.2</span>仅使用事务ID进行提交</h5>
                     <div>
                        <p>您可以使用事务ID提交不确定事务。</p>
                        <div class="section">
                           <p>以下SQL语句提交了一个不确定的事务：</p><pre class="oac_no_warn" dir="ltr">COMMIT FORCE <span class="italic">'TRANSACTION_ID';</span></pre><p>变量<span class="italic">transaction_id</span>是<code class="codeph">DBA_2PC_PENDING</code>数据字典视图的<code class="codeph">LOCAL_TRAN_ID</code>或<code class="codeph">GLOBAL_TRAN_ID</code>列中指定的事务的标识符。
                           </p>
                           <p>例如，假设您查询<code class="codeph">DBA_2PC_PENDING</code>并确定分布式事务的<code class="codeph">LOCAL_TRAN_ID</code>是<code class="codeph">1:45.13</code> 。
                           </p>
                           <p>然后，您发出以下SQL语句以强制提交此不确定事务：</p><pre class="oac_no_warn" dir="ltr">COMMIT FORCE'1.45.13';</pre></div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-94CB1DFF-1100-4D3B-8E83-902CA85B5551" title="您可以使用事务ID或SCN手动提交不确定事务。">手动提交疑难事务</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN12262"></a><div class="props_rev_3"><a id="GUID-672BECA8-8B03-43A7-AC93-14AFB76CB07C" name="GUID-672BECA8-8B03-43A7-AC93-14AFB76CB07C"></a><h5 id="ADMIN-GUID-672BECA8-8B03-43A7-AC93-14AFB76CB07C" class="sect5"><span class="enumeration_section">35.5.1.3</span>使用SCN进行提交</h5>
                     <div>
                        <p>您可以使用SCN提交不确定的事务。</p>
                        <div class="section">
                           <p>（可选）强制事务提交时，可以为事务指定SCN。此功能允许您在其他节点上提交时分配的SCN提交不确定事务。</p>
                           <p>因此，即使出现故障，也可以维护分布式事务的同步提交时间。仅当您可以确定已在另一个节点上提交的同一事务的SCN时，才指定SCN。</p>
                           <p>例如，假设您要手动提交具有以下全局事务ID的事务：</p><pre class="oac_no_warn" dir="ltr">SALES.EXAMPLE.COM.55d1c563.1.93.29</pre><p>首先，查询与相关事务有关的远程数据库的<code class="codeph">DBA_2PC_PENDING</code>视图。请注意用于在该节点上提交事务的SCN。在本地节点上提交事务时指定SCN。例如，如果SCN是<code class="codeph">829381993</code> ，则发出：</p><pre class="oac_no_warn" dir="ltr">COMMIT FORCE'SALES.EXAMPLE.COM.55d1c563.1.93.29'，829381993;</pre></div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-672BECA8-8B03-43A7-AC93-14AFB76CB07C__GUID-5ECA3ABD-9DFA-44D3-854A-A24B45659370">
                           <p class="notep1">也可以看看：</p>
                           <p>有关使用<code class="codeph">COMMIT</code>语句的更多信息，请<a href="../sqlrf/COMMIT.html#SQLRF01110" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-94CB1DFF-1100-4D3B-8E83-902CA85B5551" title="您可以使用事务ID或SCN手动提交不确定事务。">手动提交疑难事务</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="ADMIN12263"></a><div class="props_rev_3"><a id="GUID-370CCC2F-4F04-450F-A280-1394C661D836" name="GUID-370CCC2F-4F04-450F-A280-1394C661D836"></a><h4 id="ADMIN-GUID-370CCC2F-4F04-450F-A280-1394C661D836" class="sect4"><span class="enumeration_section">35.5.2</span>手动回滚<span class="enumeration_section">疑难</span>事务</h4>
                  <div>
                     <p>您可以使用事务ID回滚不确定的事务。</p>
                     <div class="section">
                        <p>在尝试回滚不确定的分布式事务之前，请确保您具有适当的权限。请注意以下要求：</p>
                        <div class="tblformal" id="GUID-370CCC2F-4F04-450F-A280-1394C661D836__GUID-0E7D5D5B-287B-4311-89B1-10F4AECA95E6">
                           <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="Column 1 lists who is attempting to commit a transaction.; column 2 lists the associated privileges that are required." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="45%" id="d320711e1861">用户提交交易</th>
                                    <th align="left" valign="bottom" width="55%" id="d320711e1864">特权要求</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="45%" id="d320711e1869" headers="d320711e1861 ">
                                       <p>您</p>
                                    </td>
                                    <td align="left" valign="top" width="55%" headers="d320711e1869 d320711e1864 ">
                                       <p><code class="codeph">强制交易</code> 
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="45%" id="d320711e1878" headers="d320711e1861 ">
                                       <p>另一个用户</p>
                                    </td>
                                    <td align="left" valign="top" width="55%" headers="d320711e1878 d320711e1864 ">
                                       <p><code class="codeph">强迫任何交易</code> 
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>以下SQL语句回滚了一个不确定的事务：</p><pre class="oac_no_warn" dir="ltr">ROLLBACK FORCE <span class="italic">'TRANSACTION_ID';</span></pre><p>变量<span class="italic">transaction_id</span>是<code class="codeph">DBA_2PC_PENDING</code>数据字典视图的<code class="codeph">LOCAL_TRAN_ID</code>或<code class="codeph">GLOBAL_TRAN_ID</code>列中指定的事务的标识符。
                        </p>
                        <p>例如，要使用本地事务ID <code class="codeph">2.9.4</code>回滚<code class="codeph">2.9.4</code>事务，请使用以下语句：</p><pre class="oac_no_warn" dir="ltr">ROLLBACK FORCE'2.9.4';</pre><div class="infoboxnote" id="GUID-370CCC2F-4F04-450F-A280-1394C661D836__GUID-D0D56CA1-084E-4B99-8CC9-1E0354EA1401">
                           <p class="notep1">注意：</p>
                           <p>您无法将不确定的事务回滚到保存点。</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-370CCC2F-4F04-450F-A280-1394C661D836__GUID-7664189D-A1AB-4FD5-A92C-97075C3CE99F">
                        <p class="notep1">也可以看看：</p>
                        <p>有关使用<code class="codeph">ROLLBACK</code>语句的更多信息，请<a href="../sqlrf/ROLLBACK.html#SQLRF01610" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-ED8FA97B-AA2E-4CB8-9F9F-D9575CBE3E93" title="使用带有FORCE选项的COMMIT或ROLLBACK语句以及指示要提交的不确定事务的本地或全局事务ID的文本字符串。">手动覆盖疑难事务</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="sect2"><a id="GUID-C4AC1D9D-1ED1-4210-A416-57023F4BC32D" name="GUID-C4AC1D9D-1ED1-4210-A416-57023F4BC32D"></a><h3 id="ADMIN-GUID-C4AC1D9D-1ED1-4210-A416-57023F4BC32D" class="sect3"><span class="enumeration_section">35.6</span>从数据字典中清除待处理的行</h3>
               <p>您可以从数据字典中清除待处理行以进行不确定的事务。</p>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-FFA59211-8013-4ACB-BDCF-01162A42509F">关于从数据字典中清除待处理的行</a><br>您可以使用<code class="codeph">DBMS_TRANSACTION.PURGE_MIXED</code>过程或<code class="codeph">DBMS_TRANSACTION.PURGE_LOST_DB_ENTRY</code>过程从数据字典中清除对于<code class="codeph">DBMS_TRANSACTION.PURGE_MIXED</code>事务的挂起行。
                     </li>
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-9F7188E7-7439-4C57-9ADC-3200EDF3B406">执行PURGE_LOST_DB_ENTRY过程</a><br>使用<code class="codeph">DBMS_TRANSACTION.PURGE_LOST_DB_ENTRY</code>过程清除数据字典中<code class="codeph">DBMS_TRANSACTION.PURGE_LOST_DB_ENTRY</code>事务的条目。
                     </li>
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-AB1231EB-BDA1-409A-8A61-A7D5F346EAA1">确定何时使用DBMS_TRANSACTION</a><br>您通常应该根据分布式事务的状态执行特定操作。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-AB19431E-BF9F-4181-BC57-699F8A06149D" title="管理分布式事务包括诸如指定节点的注释点强度，命名事务和管理不确定事务之类的任务。">管理分布式事务</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADMIN12264"></a><div class="props_rev_3"><a id="GUID-FFA59211-8013-4ACB-BDCF-01162A42509F" name="GUID-FFA59211-8013-4ACB-BDCF-01162A42509F"></a><h4 id="ADMIN-GUID-FFA59211-8013-4ACB-BDCF-01162A42509F" class="sect4"><span class="enumeration_section">35.6.1</span>关于从数据字典中清除待处理的行</h4>
                  <div>
                     <p>您可以使用<code class="codeph">DBMS_TRANSACTION.PURGE_MIXED</code>过程或<code class="codeph">DBMS_TRANSACTION.PURGE_LOST_DB_ENTRY</code>过程从数据字典中清除对于<code class="codeph">DBMS_TRANSACTION.PURGE_MIXED</code>事务的挂起行。
                     </p>
                     <p>在RECO恢复<code class="codeph">DBA_2PC_PENDING.STATE</code>事务之前，事务在<code class="codeph">DBA_2PC_PENDING.STATE</code>显示为<code class="codeph">COLLECTING</code> ， <code class="codeph">COMMITTED</code>或<code class="codeph">PREPARED</code> 。如果使用<code class="codeph">COMMIT FORCE</code>或<code class="codeph">ROLLBACK FORCE</code> <code class="codeph">FORCED COMMIT</code>事务，则可能会出现<code class="codeph">FORCED COMMIT</code>或<code class="codeph">FORCED ROLLBACK</code>状态。
                     </p>
                     <p>自动恢复通常会删除这些状态中的条目。唯一的例外是当恢复发现处于与事务中其他站点不一致的状态的强制事务时。在这种情况下，条目可以保留在表中， <code class="codeph">DBA_2PC_PENDING</code>的<code class="codeph">MIXED</code>列的值为<code class="codeph">YES</code> 。可以使用<code class="codeph">DBMS_TRANSACTION.PURGE_MIXED</code>过程清除这些条目。
                     </p>
                     <p>如果由于远程数据库永久丢失而无法自动恢复，则恢复无法识别重新创建的数据库，因为它在重新创建时会收到新的数据库ID。在这种情况下，必须使用<code class="codeph">DBMS_TRANSACTION</code>包中的<code class="codeph">PURGE_LOST_DB_ENTRY</code>过程来清理条目。这些条目不会占用数据库资源，因此不需要清理它们。
                     </p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-FFA59211-8013-4ACB-BDCF-01162A42509F__GUID-9BB1AED1-4DB2-41FC-A0BA-A59F7B7040A3">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<code class="codeph">DBMS_TRANSACTION</code>包的更多信息，请<code class="codeph">DBMS_TRANSACTION</code> <a href="../arpls/DBMS_TRANSACTION.html#ARPLS062" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-C4AC1D9D-1ED1-4210-A416-57023F4BC32D" title="您可以从数据字典中清除待处理行以进行不确定的事务。">从数据字典中清除待处理的行</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN12265"></a><div class="props_rev_3"><a id="GUID-9F7188E7-7439-4C57-9ADC-3200EDF3B406" name="GUID-9F7188E7-7439-4C57-9ADC-3200EDF3B406"></a><h4 id="ADMIN-GUID-9F7188E7-7439-4C57-9ADC-3200EDF3B406" class="sect4"><span class="enumeration_section">35.6.2</span>执行PURGE_LOST_DB_ENTRY过程</h4>
                  <div>
                     <p>使用<code class="codeph">DBMS_TRANSACTION.PURGE_LOST_DB_ENTRY</code>过程清除数据字典中<code class="codeph">DBMS_TRANSACTION.PURGE_LOST_DB_ENTRY</code>事务的条目。
                     </p>
                     <div class="section">
                        <p>要从数据字典中手动删除条目，请使用以下语法（其中<span class="italic">trans_id</span>是事务的标识符）：</p><pre class="oac_no_warn" dir="ltr">DBMS_TRANSACTION.PURGE_LOST_DB_ENTRY（' <span class="italic">trans_id</span> '）;</pre><p>例如，要清除挂起的分布式事务<code class="codeph">1.44.99</code> ，请在SQL * Plus中输入以下语句：</p><pre class="oac_no_warn" dir="ltr">EXECUTE DBMS_TRANSACTION.PURGE_LOST_DB_ENTRY（'1.44.99'）;</pre><p>仅在发生重大重新配置时执行此过程，以便自动恢复无法解决事务。例子包括：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>远程数据库完全丢失</p>
                           </li>
                           <li>
                              <p>在软件中重新配置导致两阶段提交能力丧失</p>
                           </li>
                           <li>
                              <p>来自外部事务协调器（如TPMonitor）的信息丢失</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-C4AC1D9D-1ED1-4210-A416-57023F4BC32D" title="您可以从数据字典中清除待处理行以进行不确定的事务。">从数据字典中清除待处理的行</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN12266"></a><div class="props_rev_3"><a id="GUID-AB1231EB-BDA1-409A-8A61-A7D5F346EAA1" name="GUID-AB1231EB-BDA1-409A-8A61-A7D5F346EAA1"></a><h4 id="ADMIN-GUID-AB1231EB-BDA1-409A-8A61-A7D5F346EAA1" class="sect4"><span class="enumeration_section">35.6.3</span>确定何时使用DBMS_TRANSACTION</h4>
                  <div>
                     <p>您通常应该根据分布式事务的状态执行特定操作。</p>
                     <p>下表显示了各种状态对分布式事务的指示以及管理员的操作应该是什么：</p>
                     <div class="tblformal" id="GUID-AB1231EB-BDA1-409A-8A61-A7D5F346EAA1__GUID-C5020E94-6234-49C8-966F-088FCCA8903E">
                        <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="Column 1 lists the possible STATE column settings for a distributed transaction; column 2 lists the state of a global transaction; column 3 lists the state of a local transaction; column 4 lists the normal action that is required; column 5 lists alternative actions." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="19%" id="d320711e2245">STATE专栏</th>
                                 <th align="left" valign="bottom" width="19%" id="d320711e2248">全球交易状况</th>
                                 <th align="left" valign="bottom" width="19%" id="d320711e2251">本地交易状况</th>
                                 <th align="left" valign="bottom" width="18%" id="d320711e2254">正常行动</th>
                                 <th align="left" valign="bottom" width="25%" id="d320711e2257">替代行动</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="19%" id="d320711e2262" headers="d320711e2245 ">
                                    <p>搜集</p>
                                 </td>
                                 <td align="left" valign="top" width="19%" headers="d320711e2262 d320711e2248 ">
                                    <p>回滚</p>
                                 </td>
                                 <td align="left" valign="top" width="19%" headers="d320711e2262 d320711e2251 ">
                                    <p>回滚</p>
                                 </td>
                                 <td align="left" valign="top" width="18%" headers="d320711e2262 d320711e2254 ">
                                    <p>没有</p>
                                 </td>
                                 <td align="left" valign="top" width="25%" headers="d320711e2262 d320711e2257 ">
                                    <p><code class="codeph">PURGE_LOST_DB_ENTRY</code> （仅当autorecovery无法解析事务时）</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="19%" id="d320711e2280" headers="d320711e2245 ">
                                    <p>承诺</p>
                                 </td>
                                 <td align="left" valign="top" width="19%" headers="d320711e2280 d320711e2248 ">
                                    <p>承诺</p>
                                 </td>
                                 <td align="left" valign="top" width="19%" headers="d320711e2280 d320711e2251 ">
                                    <p>承诺</p>
                                 </td>
                                 <td align="left" valign="top" width="18%" headers="d320711e2280 d320711e2254 ">
                                    <p>没有</p>
                                 </td>
                                 <td align="left" valign="top" width="25%" headers="d320711e2280 d320711e2257 ">
                                    <p><code class="codeph">PURGE_LOST_DB_ENTRY</code> （仅当autorecovery无法解析事务时）</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="19%" id="d320711e2298" headers="d320711e2245 ">
                                    <p>准备</p>
                                 </td>
                                 <td align="left" valign="top" width="19%" headers="d320711e2298 d320711e2248 ">
                                    <p>未知</p>
                                 </td>
                                 <td align="left" valign="top" width="19%" headers="d320711e2298 d320711e2251 ">
                                    <p>准备</p>
                                 </td>
                                 <td align="left" valign="top" width="18%" headers="d320711e2298 d320711e2254 ">
                                    <p>没有</p>
                                 </td>
                                 <td align="left" valign="top" width="25%" headers="d320711e2298 d320711e2257 ">
                                    <p>强制提交或回滚</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="19%" id="d320711e2314" headers="d320711e2245 ">
                                    <p>强制提交</p>
                                 </td>
                                 <td align="left" valign="top" width="19%" headers="d320711e2314 d320711e2248 ">
                                    <p>未知</p>
                                 </td>
                                 <td align="left" valign="top" width="19%" headers="d320711e2314 d320711e2251 ">
                                    <p>承诺</p>
                                 </td>
                                 <td align="left" valign="top" width="18%" headers="d320711e2314 d320711e2254 ">
                                    <p>没有</p>
                                 </td>
                                 <td align="left" valign="top" width="25%" headers="d320711e2314 d320711e2257 ">
                                    <p><code class="codeph">PURGE_LOST_DB_ENTRY</code> （仅当autorecovery无法解析事务时）</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="19%" id="d320711e2332" headers="d320711e2245 ">
                                    <p>强制回滚</p>
                                 </td>
                                 <td align="left" valign="top" width="19%" headers="d320711e2332 d320711e2248 ">
                                    <p>未知</p>
                                 </td>
                                 <td align="left" valign="top" width="19%" headers="d320711e2332 d320711e2251 ">
                                    <p>回滚</p>
                                 </td>
                                 <td align="left" valign="top" width="18%" headers="d320711e2332 d320711e2254 ">
                                    <p>没有</p>
                                 </td>
                                 <td align="left" valign="top" width="25%" headers="d320711e2332 d320711e2257 ">
                                    <p><code class="codeph">PURGE_LOST_DB_ENTRY</code> （仅当autorecovery无法解析事务时）</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="19%" id="d320711e2350" headers="d320711e2245 ">
                                    <p>强制提交</p>
                                 </td>
                                 <td align="left" valign="top" width="19%" headers="d320711e2350 d320711e2248 ">
                                    <p>杂</p>
                                 </td>
                                 <td align="left" valign="top" width="19%" headers="d320711e2350 d320711e2251 ">
                                    <p>承诺</p>
                                 </td>
                                 <td align="left" valign="top" width="18%" headers="d320711e2350 d320711e2254 ">
                                    <p>手动删除不一致，然后使用<code class="codeph">PURGE_MIXED</code></p>
                                 </td>
                                 <td align="left" valign="top" width="25%" headers="d320711e2350 d320711e2257 ">
                                    <p>-</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="19%" id="d320711e2368" headers="d320711e2245 ">
                                    <p>强制回滚</p>
                                 </td>
                                 <td align="left" valign="top" width="19%" headers="d320711e2368 d320711e2248 ">
                                    <p>杂</p>
                                 </td>
                                 <td align="left" valign="top" width="19%" headers="d320711e2368 d320711e2251 ">
                                    <p>回滚</p>
                                 </td>
                                 <td align="left" valign="top" width="18%" headers="d320711e2368 d320711e2254 ">
                                    <p>手动删除不一致，然后使用<code class="codeph">PURGE_MIXED</code></p>
                                 </td>
                                 <td align="left" valign="top" width="25%" headers="d320711e2368 d320711e2257 ">
                                    <p>-</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-C4AC1D9D-1ED1-4210-A416-57023F4BC32D" title="您可以从数据字典中清除待处理行以进行不确定的事务。">从数据字典中清除待处理的行</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="ADMIN13155"></a><a id="ADMIN12267"></a><div class="props_rev_3"><a id="GUID-79B20A57-048B-4C66-9803-0C4FE81A4A84" name="GUID-79B20A57-048B-4C66-9803-0C4FE81A4A84"></a><h3 id="ADMIN-GUID-79B20A57-048B-4C66-9803-0C4FE81A4A84" class="sect3"><span class="enumeration_section">35.7</span>手动提交疑难事务：示例</h3>
               <div>
                  <p>示例说明了手动提交不确定事务。</p>
                  <p><a href="managing-distributed-transactions.html#GUID-79B20A57-048B-4C66-9803-0C4FE81A4A84__i1008140">图35-1</a>说明了提交分布式事务期间的失败。在此故障情况下，准备阶段完成。但是，在提交阶段，即使提交点站点提交了事务，提交点站点的提交确认也永远不会到达全局协调器。库存数据已锁定且无法访问，因为不确定事务对其他事务至关重要。此外，必须保持锁定，直到不确定事务提交或回滚为止。
                  </p>
                  <div class="figure" id="GUID-79B20A57-048B-4C66-9803-0C4FE81A4A84__i1008140">
                     <p class="titleinfigure">图35-1疑难分布式事务示例</p><img src="img/admin037.png" width="450" alt="下面是图35-1的描述" title="下面是图35-1的描述" longdesc="img_text/admin037.html"><br><a href="img_text/admin037.html">“图35-1疑难分布式事务示例”的说明</a></div>
                  <!-- class="figure" -->
                  <p>您可以手动强制执行不确定事务的本地部分。</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-E55796F7-C66C-4B63-B0CC-592FA26B1DC9">第1步：记录用户反馈</a><br>示例说明了记录用户对不确定事务的反馈。
                     </li>
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-FA9DB4D8-F8CE-43BE-9D90-8CDB7D0F1DB9">第2步：查询DBA_2PC_PENDING</a><br>示例说明了查询<code class="codeph">DBA_2PC_PENDING</code>数据字典视图以获取有关<code class="codeph">DBA_2PC_PENDING</code>事务的信息。
                     </li>
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-32C9C1FE-ACE1-4560-91E1-F04A916821F1">步骤3：在本地节点上查询DBA_2PC_NEIGHBORS</a><br>此步骤的目的是爬上会话树，以便找到协调员，最终到达全局协调员。
                     </li>
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-B9228B48-2EF4-4D81-9A87-ECADDBF91F6F">第4步：在所有节点上查询数据字典视图</a><br>此时，您可以联系位于节点的管理员，并要求每个人使用全局事务ID重复步骤2和3。</li>
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-43E8473A-6159-425C-B6E1-9A09D1FC3666">第5步：提交疑难事务</a><br>使用全局ID提交不确定事务。
                     </li>
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-C93E137C-17F7-4CC4-9016-C3C3DB217CEF">第6步：使用DBA_2PC_PENDING检查混合结果</a><br>手动强制提交或回滚事务后，挂起的事务表中的相应行仍然存在。根据您强制执行交易的方式更改交易状态。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-AB19431E-BF9F-4181-BC57-699F8A06149D" title="管理分布式事务包括诸如指定节点的注释点强度，命名事务和管理不确定事务之类的任务。">管理分布式事务</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADMIN12268"></a><div class="props_rev_3"><a id="GUID-E55796F7-C66C-4B63-B0CC-592FA26B1DC9" name="GUID-E55796F7-C66C-4B63-B0CC-592FA26B1DC9"></a><h4 id="ADMIN-GUID-E55796F7-C66C-4B63-B0CC-592FA26B1DC9" class="sect4"><span class="enumeration_section">35.7.1</span>第1步：记录用户反馈</h4>
                  <div>
                     <p>示例说明了记录用户对不确定事务的反馈。</p>
                     <div class="section">
                        <p>与不确定事务的锁冲突的本地数据库系统的用户收到以下错误消息：</p><pre class="oac_no_warn" dir="ltr">ORA-01591：由不确定的分布式事务1.21.17持有的锁</pre><p>在这种情况下， <code class="codeph">1.21.17</code>是<code class="codeph">1.21.17</code>分布式事务的本地事务ID。您应该向报告问题的用户请求并记录此ID号，以确定应强制执行哪些不确定的事务。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-79B20A57-048B-4C66-9803-0C4FE81A4A84" title="示例说明了手动提交不确定事务。">手动提交疑难事务：示例</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN12269"></a><div class="props_rev_3"><a id="GUID-FA9DB4D8-F8CE-43BE-9D90-8CDB7D0F1DB9" name="GUID-FA9DB4D8-F8CE-43BE-9D90-8CDB7D0F1DB9"></a><h4 id="ADMIN-GUID-FA9DB4D8-F8CE-43BE-9D90-8CDB7D0F1DB9" class="sect4"><span class="enumeration_section">35.7.2</span>第2步：查询DBA_2PC_PENDING</h4>
                  <div>
                     <p>示例说明了查询<code class="codeph">DBA_2PC_PENDING</code>数据字典视图以获取有关<code class="codeph">DBA_2PC_PENDING</code>事务的信息。
                     </p>
                     <div class="section">
                        <p>在将SQL * Plus连接到<code class="codeph">warehouse</code> ，查询本地<code class="codeph">DBA_2PC_PENDING</code>数据字典视图以获取有关<code class="codeph">DBA_2PC_PENDING</code>事务的信息：</p><pre class="oac_no_warn" dir="ltr">CONNECT SYS@warehouse.example.com AS SYSDBA SELECT * FROM DBA_2PC_PENDING WHERE LOCAL_TRAN_ID ='1.21.17';</pre><p>数据库返回以下信息：</p><pre class="oac_no_warn" dir="ltr">列名值---------------------- ------------------------- ------------- LOCAL_TRAN_ID 1.21.17 GLOBAL_TRAN_ID SALES.EXAMPLE.COM.55d1c563.1.93.29 STATE准备混合没有建议TRAN_COMMENT销售/新订单/ Trans_type 10B FAIL_TIME 31-MAY-91 FORCE_TIME RETRY_TIME 31-MAY-91 OS_USER SWILLIAMS OS_TERMINAL TWA139：主机系统1 DB_USER SWILLIAMS COMMIT＃</pre></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-0A5604A6-E05B-44A8-95BD-E76CBC694FE2">确定全局交易ID</a><br>全局事务ID是在分布式事务的每个节点上相同的公共事务ID。
                        </li>
                        <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-14445E6B-0F41-4D6C-8C10-A334CB4F4C95">确定交易状态</a><br><code class="codeph">DBA_2PC_PENDING</code>数据字典视图的<code class="codeph">STATE</code>列显示事务的状态。
                        </li>
                        <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-17F172BF-E1F2-4283-803F-B47AA166FE0E">寻找意见或建议</a><br><code class="codeph">DBA_2PC_PENDING</code>数据字典视图的<code class="codeph">TRANS_COMMENT</code>列显示事务中包含的注释，而<code class="codeph">ADVICE</code>列提供建议。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-79B20A57-048B-4C66-9803-0C4FE81A4A84" title="示例说明了手动提交不确定事务。">手动提交疑难事务：示例</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="ADMIN12270"></a><div class="props_rev_3"><a id="GUID-0A5604A6-E05B-44A8-95BD-E76CBC694FE2" name="GUID-0A5604A6-E05B-44A8-95BD-E76CBC694FE2"></a><h5 id="ADMIN-GUID-0A5604A6-E05B-44A8-95BD-E76CBC694FE2" class="sect5"><span class="enumeration_section">35.7.2.1</span>确定全局事务ID</h5>
                     <div>
                        <p>全局事务ID是在分布式事务的每个节点上相同的公共事务ID。</p>
                        <div class="section">
                           <p>它的形式如下：</p>
                           <p><span class="italic"><code class="codeph">global_database_name</code></span> 。 <span class="italic"><code class="codeph">hhhhhhhh.local</code></span> _ <span class="italic"><code class="codeph">transaction_id</code></span></p>
                           <p>哪里：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="italic"><code class="codeph">global_database_name</code></span>是全局协调器的数据库名称。
                                 </p>
                              </li>
                              <li>
                                 <p><span class="italic"><code class="codeph">hhhhhhhh</code></span>是全局协调器的内部数据库标识符（十六进制）。
                                 </p>
                              </li>
                              <li>
                                 <p><span class="italic"><code class="codeph">local_transaction_id</code></span>是在全局协调器上分配的相应本地事务ID。
                                 </p>
                              </li>
                           </ul>
                           <p>请注意，全局事务ID的最后一部分和本地事务ID在全局协调器处匹配。在该示例中，您可以告诉<code class="codeph">warehouse</code> <span class="italic">不是</span>全局协调器，因为这些数字不匹配：</p><pre class="oac_no_warn" dir="ltr">LOCAL_TRAN_ID 1.21.17 GLOBAL_TRAN_ID ......1.93.29</pre></div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-FA9DB4D8-F8CE-43BE-9D90-8CDB7D0F1DB9" title="示例说明了查询DBA_2PC_PENDING数据字典视图以获取有关不确定事务的信息。">步骤2：查询DBA_2PC_PENDING</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN12271"></a><div class="props_rev_3"><a id="GUID-14445E6B-0F41-4D6C-8C10-A334CB4F4C95" name="GUID-14445E6B-0F41-4D6C-8C10-A334CB4F4C95"></a><h5 id="ADMIN-GUID-14445E6B-0F41-4D6C-8C10-A334CB4F4C95" class="sect5"><span class="enumeration_section">35.7.2.2</span>确定交易状态</h5>
                     <div>
                        <p><code class="codeph">DBA_2PC_PENDING</code>数据字典视图的<code class="codeph">STATE</code>列显示事务的状态。
                        </p>
                        <div class="section">
                           <p>此节点上的事务处于准备状态：</p><pre class="oac_no_warn" dir="ltr">国家准备好了</pre><p>因此， <code class="codeph">warehouse</code>等待其协调器发送提交或回滚请求。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-FA9DB4D8-F8CE-43BE-9D90-8CDB7D0F1DB9" title="示例说明了查询DBA_2PC_PENDING数据字典视图以获取有关不确定事务的信息。">步骤2：查询DBA_2PC_PENDING</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN12272"></a><div class="props_rev_3"><a id="GUID-17F172BF-E1F2-4283-803F-B47AA166FE0E" name="GUID-17F172BF-E1F2-4283-803F-B47AA166FE0E"></a><h5 id="ADMIN-GUID-17F172BF-E1F2-4283-803F-B47AA166FE0E" class="sect5"><span class="enumeration_section">35.7.2.3</span>寻找意见或建议</h5>
                     <div>
                        <p><code class="codeph">DBA_2PC_PENDING</code>数据字典视图的<code class="codeph">TRANS_COMMENT</code>列显示事务中包含的注释，而<code class="codeph">ADVICE</code>列提供建议。
                        </p>
                        <div class="section">
                           <p>交易评论或建议可包括有关此交易的信息。如果是这样，请使用此评论。在此示例中，origin和transaction类型位于事务注释中：</p><pre class="oac_no_warn" dir="ltr">TRAN_COMMENT销售/新订单/ Trans_type 10B</pre><p>它也可以作为事务名称提供，具有<code class="codeph">SET TRANSACTION...NAME</code>声明。
                           </p>
                           <p>此信息可以揭示某些内容，帮助您决定是提交还是回滚事务的本地部分。如果有用的注释不包含在不确定的事务中，则必须完成一些额外的管理工作以跟踪会话树并找到已解决该事务的节点。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-FA9DB4D8-F8CE-43BE-9D90-8CDB7D0F1DB9" title="示例说明了查询DBA_2PC_PENDING数据字典视图以获取有关不确定事务的信息。">步骤2：查询DBA_2PC_PENDING</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="ADMIN12273"></a><div class="props_rev_3"><a id="GUID-32C9C1FE-ACE1-4560-91E1-F04A916821F1" name="GUID-32C9C1FE-ACE1-4560-91E1-F04A916821F1"></a><h4 id="ADMIN-GUID-32C9C1FE-ACE1-4560-91E1-F04A916821F1" class="sect4"><span class="enumeration_section">35.7.3</span>第3步：在本地节点上查询DBA_2PC_NEIGHBORS</h4>
                  <div>
                     <p>此步骤的目的是爬上会话树，以便找到协调员，最终到达全局协调员。</p>
                     <div class="section">
                        <p>在此过程中，您可能会找到已解决该事务的协调员。如果没有，您最终可以通过自己的方式进入提交点站点，这将始终解决不确定的事务。要跟踪会话树，请查询每个节点上的<code class="codeph">DBA_2PC_NEIGHBORS</code>视图。
                        </p>
                        <p>在这种情况下，您在<code class="codeph">warehouse</code>数据库中查询此视图：</p><pre class="oac_no_warn" dir="ltr">CONNECT SYS@warehouse.example.com AS SYSDBA SELECT * FROM DBA_2PC_NEIGHBORS WHERE LOCAL_TRAN_ID ='1.21.17'ORDER BY SESS＃，IN_OUT;列名值---------------------- ------------------------- ------------- LOCAL_TRAN_ID 1.21.17 IN_OUT在DATABASE SALES.EXAMPLE.COM中DBUSER_OWNER SWILLIAMS接口N DBID 000003F4 SESS＃1 BRANCH 0100</pre></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-DFF2FCFE-BF33-450F-A329-B35329B206AD">获取数据库角色和数据库链接信息</a><br><code class="codeph">DBA_2PC_NEIGHBORS</code>视图提供有关与<code class="codeph">DBA_2PC_NEIGHBORS</code>事务关联的连接的信息。
                        </li>
                        <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-255782A9-AD10-43C2-8C64-6127385800DB">确定提交点站点</a><br><code class="codeph">INTERFACE</code>列指示本地节点或从属节点是否为提交点站点。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-79B20A57-048B-4C66-9803-0C4FE81A4A84" title="示例说明了手动提交不确定事务。">手动提交疑难事务：示例</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="ADMIN12274"></a><div class="props_rev_3"><a id="GUID-DFF2FCFE-BF33-450F-A329-B35329B206AD" name="GUID-DFF2FCFE-BF33-450F-A329-B35329B206AD"></a><h5 id="ADMIN-GUID-DFF2FCFE-BF33-450F-A329-B35329B206AD" class="sect5"><span class="enumeration_section">35.7.3.1</span>获取数据库角色和数据库链接信息</h5>
                     <div>
                        <p><code class="codeph">DBA_2PC_NEIGHBORS</code>视图提供有关与<code class="codeph">DBA_2PC_NEIGHBORS</code>事务关联的连接的信息。
                        </p>
                        <div class="section">
                           <p>根据连接是<span class="bold">入站</span> （ <code class="codeph">IN_OUT = in</code> ）还是<span class="bold">出站</span> （ <code class="codeph">IN_OUT = out</code> ），每个连接的信息不同：</p>
                           <div class="tblformal" id="GUID-DFF2FCFE-BF33-450F-A329-B35329B206AD__GUID-BDAAFDE9-14E3-4ABA-BED3-18A3185040A3">
                              <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="Column 1 lists the value of the IN_OUT column; column 2 explains the meaning of the value; column 3 explains the significance of the DATABASE column; column 4 explains the significance of the DBUSER_OWNER column." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="12%" id="d320711e2949">进出</th>
                                       <th align="left" valign="bottom" width="20%" id="d320711e2952">含义</th>
                                       <th align="left" valign="bottom" width="26%" id="d320711e2955">数据库</th>
                                       <th align="left" valign="bottom" width="42%" id="d320711e2958">DBUSER_OWNER</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="12%" id="d320711e2963" headers="d320711e2949 ">
                                          <p>在</p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d320711e2963 d320711e2952 ">
                                          <p>您的节点是另一个节点的服务器。</p>
                                       </td>
                                       <td align="left" valign="top" width="26%" headers="d320711e2963 d320711e2955 ">
                                          <p>列出连接到节点的客户端数据库的名称。</p>
                                       </td>
                                       <td align="left" valign="top" width="42%" headers="d320711e2963 d320711e2958 ">
                                          <p>列出与不确定事务对应的数据库链接连接的本地帐户。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="12%" id="d320711e2976" headers="d320711e2949 ">
                                          <p>出</p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d320711e2976 d320711e2952 ">
                                          <p>您的节点是其他服务器的客户端。</p>
                                       </td>
                                       <td align="left" valign="top" width="26%" headers="d320711e2976 d320711e2955 ">
                                          <p>列出连接到远程节点的数据库链接的名称。</p>
                                       </td>
                                       <td align="left" valign="top" width="42%" headers="d320711e2976 d320711e2958 ">
                                          <p>列出不确定事务的数据库链接的所有者。</p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p>在此示例中， <code class="codeph">IN_OUT</code>列显示<code class="codeph">warehouse</code>数据库是<code class="codeph">sales</code>客户端的服务器，如DATABASE列中所指定：</p><pre class="oac_no_warn" dir="ltr">DATABASE SALES.EXAMPLE.COM中的IN_OUT</pre><p>到连接<code class="codeph">warehouse</code>通过从数据库链接成立<code class="codeph">swilliams</code>帐户，如由<code class="codeph">DBUSER_OWNER</code>柱：</p><pre class="oac_no_warn" dir="ltr">DBUSER_OWNER SWILLIAMS</pre></div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-32C9C1FE-ACE1-4560-91E1-F04A916821F1" title="此步骤的目的是爬上会话树，以便找到协调员，最终到达全局协调员。">步骤3：在本地节点上查询DBA_2PC_NEIGHBORS</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN12275"></a><div class="props_rev_3"><a id="GUID-255782A9-AD10-43C2-8C64-6127385800DB" name="GUID-255782A9-AD10-43C2-8C64-6127385800DB"></a><h5 id="ADMIN-GUID-255782A9-AD10-43C2-8C64-6127385800DB" class="sect5"><span class="enumeration_section">35.7.3.2</span>确定提交点站点</h5>
                     <div>
                        <p><code class="codeph">INTERFACE</code>列指示本地节点或从属节点是否为提交点站点。
                        </p>
                        <div class="section"><pre class="oac_no_warn" dir="ltr">接口N.</pre><p><code class="codeph">warehouse</code>及其任何后代都不是提交点站点，如<code class="codeph">INTERFACE</code>列所示。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-32C9C1FE-ACE1-4560-91E1-F04A916821F1" title="此步骤的目的是爬上会话树，以便找到协调员，最终到达全局协调员。">步骤3：在本地节点上查询DBA_2PC_NEIGHBORS</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="ADMIN12276"></a><div class="props_rev_3"><a id="GUID-B9228B48-2EF4-4D81-9A87-ECADDBF91F6F" name="GUID-B9228B48-2EF4-4D81-9A87-ECADDBF91F6F"></a><h4 id="ADMIN-GUID-B9228B48-2EF4-4D81-9A87-ECADDBF91F6F" class="sect4"><span class="enumeration_section">35.7.4</span>第4步：查询所有节点上的数据字典视图</h4>
                  <div>
                     <p>此时，您可以联系位于节点的管理员，并要求每个人使用全局事务ID重复步骤2和3。</p>
                     <p></p>
                     <div class="infoboxnote" id="GUID-B9228B48-2EF4-4D81-9A87-ECADDBF91F6F__GUID-310E0A73-60F0-47D1-8CEA-700CEB8C753C">
                        <p class="notep1">注意：</p>
                        <p>如果您可以使用其他网络直接连接到这些节点，则可以自己重复步骤2和3。</p>
                     </div>
                     <p>例如，在<code class="codeph">sales</code>和<code class="codeph">hq</code>执行步骤2和3时，将返回以下结果。
                     </p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-34D04555-C8E1-4DF9-98BC-F352FB7558FD">检查销售中待处理交易的状态</a><br>在此阶段， <code class="codeph">sales</code>管理员查询<code class="codeph">DBA_2PC_PENDING</code>数据字典视图。
                        </li>
                        <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-D2B69038-C8A4-4951-9FE9-8EF2E2994A51">在销售中确定协调员和提交点站点</a><br>接下来， <code class="codeph">sales</code>管理员查询<code class="codeph">DBA_2PC_NEIGHBORS</code>以确定全局和本地协调器以及提交点站点。
                        </li>
                        <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-1737EA48-120D-4586-B792-0999DE6E329D">检查总部待处理交易的状态</a><br>在此阶段， <code class="codeph">hq</code>管理员查询<code class="codeph">DBA_2PC_PENDING</code>数据字典视图。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-79B20A57-048B-4C66-9803-0C4FE81A4A84" title="示例说明了手动提交不确定事务。">手动提交疑难事务：示例</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="ADMIN12277"></a><div class="props_rev_3"><a id="GUID-34D04555-C8E1-4DF9-98BC-F352FB7558FD" name="GUID-34D04555-C8E1-4DF9-98BC-F352FB7558FD"></a><h5 id="ADMIN-GUID-34D04555-C8E1-4DF9-98BC-F352FB7558FD" class="sect5"><span class="enumeration_section">35.7.4.1</span>检查销售中待处理事务的状态</h5>
                     <div>
                        <p>在此阶段， <code class="codeph">sales</code>管理员查询<code class="codeph">DBA_2PC_PENDING</code>数据字典视图。
                        </p>
                        <div class="section"><pre class="oac_no_warn" dir="ltr">SQL&gt; CONNECT SYS@sales.example.com AS SYSDBA SQL&gt; SELECT * FROM DBA_2PC_PENDING&gt; WHERE GLOBAL_TRAN_ID ='SALES.EXAMPLE.COM.55d1c563.1.93.29';列名值---------------------- ------------------------- ------------- LOCAL_TRAN_ID 1.93.29 GLOBAL_TRAN_ID SALES.EXAMPLE.COM.55d1c563.1.93.29 STATE准备混合没有建议TRAN_COMMENT销售/新订单/ Trans_type 10B FAIL_TIME 31-MAY-91 FORCE_TIME RETRY_TIME 31-MAY-91 OS_USER SWILLIAMS OS_TERMINAL TWA139：主机系统1 DB_USER SWILLIAMS COMMIT＃</pre></div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-B9228B48-2EF4-4D81-9A87-ECADDBF91F6F" title="此时，您可以联系位于节点的管理员，并要求每个人使用全局事务ID重复步骤2和3。">步骤4：在所有节点上查询数据字典视图</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN12278"></a><div class="props_rev_3"><a id="GUID-D2B69038-C8A4-4951-9FE9-8EF2E2994A51" name="GUID-D2B69038-C8A4-4951-9FE9-8EF2E2994A51"></a><h5 id="ADMIN-GUID-D2B69038-C8A4-4951-9FE9-8EF2E2994A51" class="sect5"><span class="enumeration_section">35.7.4.2</span>确定销售时的协调员和提交点站点</h5>
                     <div>
                        <p>接下来， <code class="codeph">sales</code>管理员查询<code class="codeph">DBA_2PC_NEIGHBORS</code>以确定全局和本地协调器以及提交点站点。
                        </p>
                        <div class="section"><pre class="oac_no_warn" dir="ltr">SELECT * FROM DBA_2PC_NEIGHBORS WHERE GLOBAL_TRAN_ID ='SALES.EXAMPLE.COM.55d1c563.1.93.29'按顺序排序＃，IN_OUT;</pre><p>此查询返回三行：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>与<code class="codeph">warehouse</code>的连接</p>
                              </li>
                              <li>
                                 <p>与<code class="codeph">hq</code>的连接</p>
                              </li>
                              <li>
                                 <p>用户建立的连接</p>
                              </li>
                           </ul>
                           <p>与<code class="codeph">warehouse</code>连接的行对应的重新格式化信息如下所示：</p><pre class="oac_no_warn" dir="ltr">列名值---------------------- ------------------------- ------------- LOCAL_TRAN_ID 1.93.29 IN_OUT OUT DATABASE WAREHOUSE.EXAMPLE.COM DBUSER_OWNER SWILLIAMS INTERFACE N DBID 55d1c563 SESS＃1 BRANCH 1</pre><p>对应于<code class="codeph">hq</code>连接的行的重新格式化信息如下所示：</p><pre class="oac_no_warn" dir="ltr">列名值---------------------- ------------------------- ------------- LOCAL_TRAN_ID 1.93.29 IN_OUT OUT DATABASE HQ.EXAMPLE.COM DBUSER_OWNER ALLEN接口C DBID 00000390 SESS＃1 BRANCH 1</pre><p>先前查询的信息显示以下内容：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">sales</code>是全局协调者，因为本地事务ID和全局事务ID匹配。
                                 </p>
                              </li>
                              <li>
                                 <p>从此节点建立两个出站连接，但没有入站连接。 <code class="codeph">sales</code>不是另一个节点的服务器。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">hq</code>或其中一个服务器是提交点站点。
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-B9228B48-2EF4-4D81-9A87-ECADDBF91F6F" title="此时，您可以联系位于节点的管理员，并要求每个人使用全局事务ID重复步骤2和3。">步骤4：在所有节点上查询数据字典视图</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN12279"></a><div class="props_rev_3"><a id="GUID-1737EA48-120D-4586-B792-0999DE6E329D" name="GUID-1737EA48-120D-4586-B792-0999DE6E329D"></a><h5 id="ADMIN-GUID-1737EA48-120D-4586-B792-0999DE6E329D" class="sect5"><span class="enumeration_section">35.7.4.3</span>检查总部待处理事务的状态</h5>
                     <div>
                        <p>在此阶段， <code class="codeph">hq</code>管理员查询<code class="codeph">DBA_2PC_PENDING</code>数据字典视图。
                        </p>
                        <div class="section"><pre class="oac_no_warn" dir="ltr">SELECT * FROM DBA_2PC_PENDING@hq.example.com WHERE GLOBAL_TRAN_ID ='SALES.EXAMPLE.COM.55d1c563.1.93.29';列名值---------------------- ------------------------- ------------- LOCAL_TRAN_ID 1.45.13 GLOBAL_TRAN_ID SALES.EXAMPLE.COM.55d1c563.1.93.29状态委托混合无操作TRAN_COMMENT销售/新订单/ Trans_type 10B FAIL_TIME 31-MAY-91 FORCE_TIME RETRY_TIME 31-MAY-91 OS_USER SWILLIAMS OS_TERMINAL TWA139：主机系统1 DB_USER SWILLIAMS COMMIT＃129314</pre><p>此时，您找到了一个解决该事务的节点。如视图所示，已提交并分配了提交ID号：</p><pre class="oac_no_warn" dir="ltr">STATE COMMIT COMMIT＃129314</pre><p>因此，您可以强制不确定事务在本地数据库中提交。最好联系您认识的任何其他管理员，这些管理员也可以从您的调查中受益。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-B9228B48-2EF4-4D81-9A87-ECADDBF91F6F" title="此时，您可以联系位于节点的管理员，并要求每个人使用全局事务ID重复步骤2和3。">步骤4：在所有节点上查询数据字典视图</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="ADMIN12280"></a><div class="props_rev_3"><a id="GUID-43E8473A-6159-425C-B6E1-9A09D1FC3666" name="GUID-43E8473A-6159-425C-B6E1-9A09D1FC3666"></a><h4 id="ADMIN-GUID-43E8473A-6159-425C-B6E1-9A09D1FC3666" class="sect4"><span class="enumeration_section">35.7.5</span>第5步：提交<span class="enumeration_section">疑难</span>事务</h4>
                  <div>
                     <p>使用全局ID提交不确定事务。</p>
                     <div class="section">
                        <p>您可以联系<code class="codeph">sales</code>数据库的管理员，该数据库使用全局ID手动提交不确定事务：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; CONNECT SYS@sales.example.com AS SYSDBA SQL&gt; COMMIT FORCE'SALES.EXAMPLE.COM.55d1c563.1.93.29';</pre><p>作为<code class="codeph">warehouse</code>数据库的管理员，您使用全局ID手动提交不确定事务：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; CONNECT SYS@warehouse.example.com AS SYSDBA SQL&gt; COMMIT FORCE'SALES.EXAMPLE.COM.55d1c563.1.93.29';</pre></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-79B20A57-048B-4C66-9803-0C4FE81A4A84" title="示例说明了手动提交不确定事务。">手动提交疑难事务：示例</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN12281"></a><div class="props_rev_3"><a id="GUID-C93E137C-17F7-4CC4-9016-C3C3DB217CEF" name="GUID-C93E137C-17F7-4CC4-9016-C3C3DB217CEF"></a><h4 id="ADMIN-GUID-C93E137C-17F7-4CC4-9016-C3C3DB217CEF" class="sect4"><span class="enumeration_section">35.7.6</span>步骤6：使用DBA_2PC_PENDING检查混合结果</h4>
                  <div>
                     <p>手动强制提交或回滚事务后，挂起的事务表中的相应行仍然存在。根据您强制执行交易的方式更改交易状态。</p>
                     <div class="section">
                        <p>每个Oracle数据库都有一个<span class="bold">待处理的事务表</span> 。这是一个特殊的表，用于存储有关分布式事务在两阶段提交阶段进行的信息。您可以通过<code class="codeph">DBA_2PC_PENDING</code>数据字典视图查询数据库的挂起事务表（请参阅<span class="q">“ <a href="managing-distributed-transactions.html#GUID-CF29B5D4-0FBF-4A72-9EAD-A4618B7A6BC6" title="使用DBA_2PC_PENDING视图确定特定事务ID的全局提交编号。手动解决不确定事务时，可以使用此全局提交编号。">确定准备事务的ID号和状态</a> ”</span> ）。
                        </p>
                        <p>在挂起的事务表中特别感兴趣的是混合结果标志，如<code class="codeph">DBA_2PC_PENDING.MIXED</code> 。如果挂起的事务被强制提交或回滚，则可以做出错误的选择。例如，本地管理员回滚事务，但其他节点提交它。自动检测到错误的决策，并设置相应的待处理事务记录的损坏标志（ <code class="codeph">MIXED=yes</code> ）。
                        </p>
                        <p>RECO（Recoverer）后台进程使用挂起事务表中的信息来确定不确定事务的状态。您还可以使用挂起事务表中的信息手动覆盖挂起的分布式事务的自动恢复过程。</p>
                        <p>RECO自动解决的所有事务都将从挂起的事务表中删除。此外，管理员正确解析的有关不确定事务的所有信息（在RECO重新建立通信时检查）将自动从挂起的事务表中删除。但是，管理员解析的导致节点混合结果的所有行都保留在所有相关节点的挂起事务表中，直到使用<code class="codeph">DBMS_TRANSACTIONS.PURGE_MIXED</code>手动删除它们<code class="codeph">DBMS_TRANSACTIONS.PURGE_MIXED</code> 。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-79B20A57-048B-4C66-9803-0C4FE81A4A84" title="示例说明了手动提交不确定事务。">手动提交疑难事务：示例</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="ADMIN12282"></a><div class="props_rev_3"><a id="GUID-AFA3EFDD-95BA-4FAD-B465-8ED6776D1E59" name="GUID-AFA3EFDD-95BA-4FAD-B465-8ED6776D1E59"></a><h3 id="ADMIN-GUID-AFA3EFDD-95BA-4FAD-B465-8ED6776D1E59" class="sect3"><span class="enumeration_section">35.8</span>锁定导致数据访问失败</h3>
               <p>发出SQL语句时，数据库会尝试锁定成功执行语句所需的资源。但是，如果请求的数据当前由其他未提交的事务的语句保留，并且长时间保持锁定状态，则会发生超时。</p>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-C2D78CB2-02D7-43ED-9603-A5DDFF392272">交易超时</a><br>如果另一个事务拥有对请求数据的锁定，则可以阻止需要在远程数据库上锁定的DML语句。
                     </li>
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-20B9F64E-3EC3-4967-9391-4EF7445C2ED9">来自疑难事务的锁定</a><br>由于不确定的分布式事务的锁定资源，可以无限期地阻止需要在本地数据库上锁定的查询或DML语句。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-AB19431E-BF9F-4181-BC57-699F8A06149D" title="管理分布式事务包括诸如指定节点的注释点强度，命名事务和管理不确定事务之类的任务。">管理分布式事务</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADMIN12283"></a><div class="props_rev_3"><a id="GUID-C2D78CB2-02D7-43ED-9603-A5DDFF392272" name="GUID-C2D78CB2-02D7-43ED-9603-A5DDFF392272"></a><h4 id="ADMIN-GUID-C2D78CB2-02D7-43ED-9603-A5DDFF392272" class="sect4"><span class="enumeration_section">35.8.1</span>交易超时</h4>
                  <div>
                     <p>如果另一个事务拥有对请求数据的锁定，则可以阻止需要在远程数据库上锁定的DML语句。</p>
                     <p>如果这些锁继续阻止请求的SQL语句，则会发生以下事件序列：</p>
                     <ol>
                        <li>
                           <p>发生超时。</p>
                        </li>
                        <li>
                           <p>数据库回滚语句。</p>
                        </li>
                        <li>
                           <p>数据库将此错误消息返回给用户：</p><pre class="oac_no_warn" dir="ltr">ORA-02049：超时：等待锁定的分布式事务</pre></li>
                     </ol>
                     <p>由于事务未修改数据，因此超时不需要执行任何操作。应用程序应该像遇到死锁一样继续进行。执行该语句的用户可以尝试稍后重新执行该语句。如果锁定仍然存在，则用户应与管理员联系以报告问题。</p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-AFA3EFDD-95BA-4FAD-B465-8ED6776D1E59" title="发出SQL语句时，数据库会尝试锁定成功执行语句所需的资源。但是，如果请求的数据当前由其他未提交的事务的语句保留，并且长时间保持锁定状态，则会发生超时。">由于锁定导致的数据访问失败</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN12284"></a><div class="props_rev_3"><a id="GUID-20B9F64E-3EC3-4967-9391-4EF7445C2ED9" name="GUID-20B9F64E-3EC3-4967-9391-4EF7445C2ED9"></a><h4 id="ADMIN-GUID-20B9F64E-3EC3-4967-9391-4EF7445C2ED9" class="sect4"><span class="enumeration_section">35.8.2</span>来自疑问事务的锁定</h4>
                  <div>
                     <p>由于不确定的分布式事务的锁定资源，可以无限期地阻止需要在本地数据库上锁定的查询或DML语句。</p>
                     <p>在这种情况下，数据库发出以下错误消息：</p><pre class="oac_no_warn" dir="ltr">ORA-01591：由不确定的分布式事务<span class="italic">标识符</span>持有的锁
</pre><p>在这种情况下，数据库立即回滚SQL语句。执行该语句的用户可以尝试稍后重新执行该语句。如果锁定仍然存在，则用户应联系管理员以报告问题， <span class="italic">包括</span>疑似分布式事务的ID。
                     </p>
                     <p>考虑到在两阶段提交的关键部分期间失败的可能性低，这些情况发生的可能性很少。即使发生这种故障，并假设从网络或系统故障中快速恢复，问题也会自动解决而无需人工干预。因此，问题通常在用户或数据库管理员可以检测到之前解决。</p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-AFA3EFDD-95BA-4FAD-B465-8ED6776D1E59" title="发出SQL语句时，数据库会尝试锁定成功执行语句所需的资源。但是，如果请求的数据当前由其他未提交的事务的语句保留，并且长时间保持锁定状态，则会发生超时。">由于锁定导致的数据访问失败</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="ADMIN12285"></a><div class="props_rev_3"><a id="GUID-26729889-99BC-4315-9903-AB8C171C557F" name="GUID-26729889-99BC-4315-9903-AB8C171C557F"></a><h3 id="ADMIN-GUID-26729889-99BC-4315-9903-AB8C171C557F" class="sect3"><span class="enumeration_section">35.9</span>模拟分布式事务失败</h3>
               <p>您可以强制分布式事务的失败，以观察RECO自动解析事务的本地部分，或者练习手动解决不确定的分布式事务并观察结果。</p>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-E8A4CA95-AA4B-4796-BE1F-BC5D71BDF51F">强制分布式事务失败</a><br>您可以在<code class="codeph">COMMIT</code>语句的<code class="codeph">COMMENT</code>参数中包含注释。
                     </li>
                     <li class="ulchildlink"><a href="managing-distributed-transactions.html#GUID-326C26E8-9007-49C6-8080-D127FE920EEC">禁用和启用RECO</a><br>Oracle数据库实例的RECO后台进程自动解决涉及分布式事务的故障。在指数增长的时间间隔，节点的RECO后台进程尝试恢复不确定的分布式事务的本地部分。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-AB19431E-BF9F-4181-BC57-699F8A06149D" title="管理分布式事务包括诸如指定节点的注释点强度，命名事务和管理不确定事务之类的任务。">管理分布式事务</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADMIN12286"></a><div class="props_rev_3"><a id="GUID-E8A4CA95-AA4B-4796-BE1F-BC5D71BDF51F" name="GUID-E8A4CA95-AA4B-4796-BE1F-BC5D71BDF51F"></a><h4 id="ADMIN-GUID-E8A4CA95-AA4B-4796-BE1F-BC5D71BDF51F" class="sect4"><span class="enumeration_section">35.9.1</span>强制分布式事务失败</h4>
                  <div>
                     <p>您可以在<code class="codeph">COMMIT</code>语句的<code class="codeph">COMMENT</code>参数中包含注释。
                     </p>
                     <div class="section">
                        <p>要在分布式事务的两阶段提交阶段故意引发故障，请在<code class="codeph">COMMENT</code>参数中包含以下注释：</p><pre class="oac_no_warn" dir="ltr">COMMIT COMMENT'ORA-2PC-CRASH-TEST- <span class="italic">n</span> ';</pre><p>其中<span class="italic">n</span>是以下整数之一：</p>
                        <div class="tblformal" id="GUID-E8A4CA95-AA4B-4796-BE1F-BC5D71BDF51F__GUID-2E17040A-3774-475E-97B3-37EC43FF3B9A">
                           <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="This table lists the possible values of n and their effect." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="33%" id="d320711e3792">ñ</th>
                                    <th align="left" valign="bottom" width="67%" id="d320711e3795">影响</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="33%" id="d320711e3800" headers="d320711e3792 ">
                                       <p>1</p>
                                    </td>
                                    <td align="left" valign="top" width="67%" headers="d320711e3800 d320711e3795 ">
                                       <p>收集后崩溃提交点</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="33%" id="d320711e3807" headers="d320711e3792 ">
                                       <p>2</p>
                                    </td>
                                    <td align="left" valign="top" width="67%" headers="d320711e3807 d320711e3795 ">
                                       <p>收集后崩溃非提交点站点</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="33%" id="d320711e3814" headers="d320711e3792 ">
                                       <p>3</p>
                                    </td>
                                    <td align="left" valign="top" width="67%" headers="d320711e3814 d320711e3795 ">
                                       <p>准备前崩溃（非提交点网站）</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="33%" id="d320711e3821" headers="d320711e3792 ">
                                       <p>4</p>
                                    </td>
                                    <td align="left" valign="top" width="67%" headers="d320711e3821 d320711e3795 ">
                                       <p>准备后崩溃（非提交点网站）</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="33%" id="d320711e3828" headers="d320711e3792 ">
                                       <p>五</p>
                                    </td>
                                    <td align="left" valign="top" width="67%" headers="d320711e3828 d320711e3795 ">
                                       <p>提交前崩溃提交点站点</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="33%" id="d320711e3835" headers="d320711e3792 ">
                                       <p>6</p>
                                    </td>
                                    <td align="left" valign="top" width="67%" headers="d320711e3835 d320711e3795 ">
                                       <p>提交后崩溃提交点站点</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="33%" id="d320711e3842" headers="d320711e3792 ">
                                       <p>7</p>
                                    </td>
                                    <td align="left" valign="top" width="67%" headers="d320711e3842 d320711e3795 ">
                                       <p>在提交之前崩溃非提交点站点</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="33%" id="d320711e3849" headers="d320711e3792 ">
                                       <p>8</p>
                                    </td>
                                    <td align="left" valign="top" width="67%" headers="d320711e3849 d320711e3795 ">
                                       <p>提交后崩溃非提交点站点</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="33%" id="d320711e3856" headers="d320711e3792 ">
                                       <p>9</p>
                                    </td>
                                    <td align="left" valign="top" width="67%" headers="d320711e3856 d320711e3795 ">
                                       <p>忘记之前崩溃提交点网站</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="33%" id="d320711e3863" headers="d320711e3792 ">
                                       <p>10</p>
                                    </td>
                                    <td align="left" valign="top" width="67%" headers="d320711e3863 d320711e3795 ">
                                       <p>在忘记之前崩溃非提交点站点</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>例如，如果本地提交点强度大于远程提交点强度并且两个节点都已更新，则以下语句将返回以下消息：</p><pre class="oac_no_warn" dir="ltr">COMMIT COMMENT'ORA-2PC-CRASH-TEST-7'; ORA-02054：交易1.93.29不确定ORA-02059：ORA_CRASH_TEST_7在提交评论中</pre><p>此时， <code class="codeph">DBA_2PC_PENDING</code>分布式事务将显示在<code class="codeph">DBA_2PC_PENDING</code>视图中。如果启用，RECO会自动解决该事务。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-26729889-99BC-4315-9903-AB8C171C557F" title="您可以强制分布式事务的失败，以观察RECO自动解析事务的本地部分，或者练习手动解决不确定的分布式事务并观察结果。">模拟分布式事务失败</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN12287"></a><div class="props_rev_3"><a id="GUID-326C26E8-9007-49C6-8080-D127FE920EEC" name="GUID-326C26E8-9007-49C6-8080-D127FE920EEC"></a><h4 id="ADMIN-GUID-326C26E8-9007-49C6-8080-D127FE920EEC" class="sect4"><span class="enumeration_section">35.9.2</span>禁用和启用RECO</h4>
                  <div>
                     <p>Oracle数据库实例的RECO后台进程自动解决涉及分布式事务的故障。在指数增长的时间间隔，节点的RECO后台进程尝试恢复不确定的分布式事务的本地部分。</p>
                     <div class="section">
                        <p></p>
                        <p>RECO可以使用现有连接或与失败事务中涉及的其他节点建立新连接。建立连接后，RECO会自动解决所有不确定的事务。对应于任何已解决的不确定事务的行将自动从每个数据库的挂起事务表中删除。</p>
                        <p>您可以使用带有<code class="codeph">ENABLE</code> / <code class="codeph">DISABLE DISTRIBUTED RECOVERY</code>选项的<code class="codeph">ALTER SYSTEM</code>语句启用和禁用RECO。例如，您可以暂时禁用RECO以强制两阶段提交失败并手动解决不确定事务。
                        </p>
                        <p>以下语句禁用RECO：</p><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM DISABLE DISTRIBUTED RECOVERY;</pre><p>或者，以下语句启用RECO，以便自动解决不确定事务：</p><pre class="oac_no_warn" dir="ltr">更改系统可实现分布式恢复;</pre></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-26729889-99BC-4315-9903-AB8C171C557F" title="您可以强制分布式事务的失败，以观察RECO自动解析事务的本地部分，或者练习手动解决不确定的分布式事务并观察结果。">模拟分布式事务失败</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="ADMIN12288"></a><div class="props_rev_3"><a id="GUID-195124A5-FF1B-40BA-BAF9-CB5272E8BFD3" name="GUID-195124A5-FF1B-40BA-BAF9-CB5272E8BFD3"></a><h3 id="ADMIN-GUID-195124A5-FF1B-40BA-BAF9-CB5272E8BFD3" class="sect3"><span class="enumeration_section">35.10</span>管理读一致性</h3>
               <div>
                  <p>分布式读取一致性的Oracle数据库实现存在一个重要的限制。</p>
                  <div class="section">
                     <p>出现问题的原因是每个系统都有自己的SCN，您可以将其视为数据库内部时间戳。Oracle数据库服务器使用SCN来确定从查询返回的数据版本。</p>
                     <p>分布式事务中的SCN在每个远程SQL语句的末尾以及每个事务的开始和结束时进行同步。在具有大量流量且特别是分布式更新的两个节点之间，同步是频繁的。然而，没有实际的方法来保持分布式系统中的SCN绝对同步：总是存在一个窗口，其中一个节点可能具有相对于另一个节点的SCN在某种程度上过去的SCN。</p>
                     <p>由于SCN差距，您可以执行使用稍微旧的快照的查询，以便不会看到对远程数据库的最新更改。因此，根据读取一致性，查询可以检索一致但过时的数据。请注意，查询检索的所有数据都来自旧SCN，因此，如果本地执行的更新事务更新远程节点上的两个表，则从下一个远程访问中的两个表中选择的数据包含更新前的数据。</p>
                     <p>SCN差距的一个结果是，即使两个语句之间没有执行DML，两个连续的<code class="codeph">SELECT</code>语句也可以检索不同的数据。例如，您可以发出更新语句，然后在远程数据库上提交更新。在基于此远程表的视图上发出<code class="codeph">SELECT</code>语句时，视图不会显示对该行的更新。下次发出<code class="codeph">SELECT</code>语句时，将出现更新。
                     </p>
                     <p>您可以使用以下技术确保在查询之前同步两个系统的SCN：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>因为SCN在远程查询结束时是同步的，所以在每个远程查询之前使用虚拟远程查询到同一站点，例如， <code class="codeph">SELECT * FROM DUAL@REMOTE</code> 。</p>
                        </li>
                        <li>
                           <p>由于SCN在每个远程事务开始时都是同步的，因此在发出远程查询之前提交或回滚当前事务。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-distributed-transactions.html#GUID-AB19431E-BF9F-4181-BC57-699F8A06149D" title="管理分布式事务包括诸如指定节点的注释点强度，命名事务和管理不确定事务之类的任务。">管理分布式事务</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>