<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="Learn how to use Oracle Data Guard broker to manage databases during switchover and failover."></meta>
      <meta name="description" content="Learn how to use Oracle Data Guard broker to manage databases during switchover and failover."></meta>
      <title>切换和故障转移操作</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Broker "></meta>
      <meta property="og:description" content="Learn how to use Oracle Data Guard broker to manage databases during switchover and failover."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Broker"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="data-guard-broker.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-03-29T04:14:25-07:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1999, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96245-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="managing-oracle-data-guard-broker-configuration-members.html" title="Previous" type="text/html"></link>
      <link rel="next" href="examples-using-data-guard-broker-DGMGRL-utility.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Data Guard Broker"></meta>
    <meta name="dcterms.isVersionOf" content="DGBKR"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="managing-oracle-data-guard-broker-configuration-members.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="examples-using-data-guard-broker-DGMGRL-utility.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">经纪人</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">切换和故障转移操作</li>
            </ol>
            <a id="GUID-44E7A982-7CD4-4A51-B00E-62C0698C5CD6" name="GUID-44E7A982-7CD4-4A51-B00E-62C0698C5CD6"></a><a id="DGBKR330"></a>
            
            <h2 id="DGBKR-GUID-44E7A982-7CD4-4A51-B00E-62C0698C5CD6" class="sect2"><span class="enumeration_chapter">5</span>切换和故障转移操作</h2>
         </header>
         <div class="ind">
            <div>
               <p>了解如何使用Oracle Data Guard代理在切换和故障转移期间管理数据库。</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-7F6C5802-E4AF-4680-91F6-AD380679A555" title="Oracle Data Guard可帮助您使用切换或故障切换操作更改主数据库与备用数据库之间的数据库角色。">Broker环境中的切换和故障转移概述</a></p>
                  </li>
                  <li>
                     <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-2AEF86C4-3CFA-4CF5-AEF3-E25871298363" title="在切换或故障转移后选择备用数据库作为下一个主数据库时，需要考虑几个因素。">选择目标备用数据库</a></p>
                  </li>
                  <li>
                     <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-AC6A6D2B-1112-422B-8A41-02FAC40E2078" title="切换是主数据库与其中一个备用数据库之间的角色转换。">切换</a></p>
                  </li>
                  <li>
                     <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-9A988501-7E18-4A62-8CD6-4BDDFA355C98" title="在手动故障转移中，您将备用数据库转换为主数据库，因为原始主数据库失败，并且不可能及时恢复主数据库。">手动故障转移</a></p>
                  </li>
                  <li>
                     <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-995CED84-BEA1-4675-9C68-B37CB996924F" title="快速启动故障转移允许代理在丢失主数据库时自动故障转移到先前选择的备用数据库。">快速启动故障转移</a></p>
                  </li>
                  <li>
                     <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-790C40A3-B712-4AEB-B70E-1B7987C6315C" title="发生代理管理的故障转移时，事件通知和数据库连接故障转移支持可用于连接到本地数据库服务的数据库客户端。">数据库客户端注意事项</a></p>
                  </li>
               </ul>
            </div><a id="DGBKR3401"></a><div class="props_rev_3"><a id="GUID-7F6C5802-E4AF-4680-91F6-AD380679A555" name="GUID-7F6C5802-E4AF-4680-91F6-AD380679A555"></a><h3 id="DGBKR-GUID-7F6C5802-E4AF-4680-91F6-AD380679A555" class="sect3"><span class="enumeration_section">5.1</span> Broker环境中的切换和故障切换概述</h3>
               <div>
                  <p>Oracle Data Guard可帮助您使用切换或故障切换操作更改主数据库与备用数据库之间的数据库角色。</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><span class="bold">切换</span>是主数据库与其中一个备用数据库之间的角色转换。切换可确保不丢失数据，通常用于主系统的计划维护。在切换期间，主数据库转换为备用角色，备用数据库转换为主角色。
                        </p>
                     </li>
                     <li>
                        <p>故障转移是一种角色转换，其中一个备用数据库在主数据库（Oracle RAC数据库中的所有实例）失败或无法访问后转换为主角色。故障转移可能会也可能不会导致数据丢失，具体取决于故障转移时生效的保护模式。</p>
                     </li>
                  </ul>
                  <div class="p">代理通过允许您使用Oracle Enterprise Manager云控制（云控制）中的单个键单击或DGMGRL命令行界面中的单个命令（在本文档中称为）来调用切换和故障转移，从而简化了切换和故障转移<a id="d12681e129" class="indexterm-anchor"></a> <span class="italic">手动</span>故障转移）。作为管理切换的一部分，代理会自动执行以下操作：<ul style="list-style-type:disc">
                        <li>
                           <p>设置从新主服务器到配置的其他成员的重做传输</p>
                        </li>
                        <li>
                           <p>在新备用数据库上启动重做应用服务</p>
                        </li>
                        <li>
                           <p>确保代理配置中的其他备用数据库对新主数据库可行</p>
                        </li>
                        <li>
                           <p>与Oracle Clusterware和Oracle全球数据服务（GDS）集成，以确保在角色更改后启动正确的服务</p>
                        </li>
                     </ul>
                  </div>
                  <p>启用快速启动故障切换后，代理会确定是否需要进行故障切换，并自动启动故障切换到当前目标备用数据库，而无需手动干预。减少对人工干预的需求可以提高可用性，而不会增加管理成本。通过手动故障转移，您可以准确控制故障转移的时间以及目标备用数据库。无论您选择哪种方法，代理都会协调配置中所有数据库的角色转换。</p>
               </div>
            </div><a id="DGBKR3650"></a><a id="DGBKR3310"></a><div class="props_rev_3"><a id="GUID-2AEF86C4-3CFA-4CF5-AEF3-E25871298363" name="GUID-2AEF86C4-3CFA-4CF5-AEF3-E25871298363"></a><h3 id="DGBKR-GUID-2AEF86C4-3CFA-4CF5-AEF3-E25871298363" class="sect3"><span class="enumeration_section">5.2</span>选择目标备用数据库</h3>
               <div>
                  <p>在切换或故障转移后选择备用数据库作为下一个主数据库时，需要考虑几个因素。</p>
                  <p><a id="d12681e174" class="indexterm-anchor"></a><a id="d12681e178" class="indexterm-anchor"></a><a id="d12681e182" class="indexterm-anchor"></a><a id="d12681e186" class="indexterm-anchor"></a>您需要在构建Oracle Data Guard配置时考虑所有选项，包括物理备用数据库与逻辑备用数据库与快照备用数据库的特性，备用数据库站点的网络延迟，计算能力等因素。未来的主数据库站点，等等。
                  </p>
                  <div class="infoboxnote" id="GUID-2AEF86C4-3CFA-4CF5-AEF3-E25871298363__GUID-B59A8AAF-681E-44D6-A0D8-2FA4439D2590">
                     <p class="notep1">注意：</p>
                     <p>快照备用数据库不能成为切换或快速启动故障切换操作的目标。但是，您可以对快照备用数据库执行手动故障转移。</p>
                     <p>远程同步实例或零数据丢失恢复设备不是数据库，因此不能成为角色转换的目标。</p>
                  </div>
                  <p>对于切换，了解所有因素可以简化选择哪个备用数据库作为新的主数据库。在需要进行故障转移的灾难情况下，您可能会更加局限于哪个备用数据库是获取故障主数据库活动的最佳备用数据库。<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-A3140CC4-EFFF-465E-86FB-D68B15BF130E" title="When performing a switchover in a configuration whose standby databases are all of the same type (all physical or all logical standby databases), choose the standby database that has the least amount of unapplied redo.">为切换</a> <a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-0AC8540A-6BB6-4B80-8D55-A3D72AD02486" title="When performing a failover in a configuration whose standbys are all of the same type, choose the standby database that has the smallest transport lag.">选择目标备用数据库并为故障</a> <a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-A3140CC4-EFFF-465E-86FB-D68B15BF130E" title="在备用数据库全部属于同一类型（所有物理或所有逻辑备用数据库）的配置中执行切换时，请选择具有最少未应用重做的备用数据库。">切换</a> <a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-0AC8540A-6BB6-4B80-8D55-A3D72AD02486" title="在备用数据库类型相同的配置中执行故障转移时，请选择具有最小传输延迟的备用数据库。">选择目标备用数据库</a>提供了指导，可帮助您选择目标备用数据库。
                  </p>
                  <div class="infoboxnote" id="GUID-2AEF86C4-3CFA-4CF5-AEF3-E25871298363__GUID-4A178293-C945-4288-A4E8-2F1D57AC2793">
                     <p class="notep1">注意：</p>对于快速启动故障转移，必须预先选择至少一个目标备用数据库。如果您愿意，也可以预先选择多个目标;选择不必是互惠的。
                  </div>
                  <div class="section">
                     <p class="subhead2" id="GUID-2AEF86C4-3CFA-4CF5-AEF3-E25871298363__GUID-342248BC-633E-43BC-B1F0-DDD7B17F2999">确定数据库准备改变角色</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>为帮助您选择适当的切换或故障转移目标，请使用以下DGMGRL命令对数据库执行检查，以确定其是否准备好完成角色更改。</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="oracle-data-guard-broker-commands.html#GUID-06ED8F7F-4547-4D4D-9D1A-4A84FF234A12" title="VALIDATE DATABASE命令在角色更改之前执行一组全面的数据库检查。">验证数据库</a></p>
                        </li>
                        <li>
                           <p><a href="oracle-data-guard-broker-commands.html#GUID-73D1C824-B71C-4BED-884B-3398D68157AF" title="VALIDATE NETWORK CONFIGURATION命令在配置成员之间执行网络连接检查。">验证网络配置</a></p>
                        </li>
                        <li>
                           <p><a href="oracle-data-guard-broker-commands.html#GUID-D8A6F0CF-959E-490D-9384-B746821836B4" title="VALIDATE DATABASE SPFILE命令执行主数据库与指定备用数据库之间的服务器参数文件（SPFILE）条目的比较。">验证数据库SPFILE</a></p>
                        </li>
                        <li>
                           <p><a href="oracle-data-guard-broker-commands.html#GUID-C3E2884B-E0A7-492A-9A42-EEB4D6CCCBE6" title="VALIDATE STATIC CONNECT IDENTIFIER命令验证数据库的静态连接标识符。">确认静态连接标识符</a></p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-2AEF86C4-3CFA-4CF5-AEF3-E25871298363__GUID-23266E9A-13AA-4521-BA39-3FF522BB8FEB">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="examples-using-data-guard-broker-DGMGRL-utility.html#GUID-1403D1C3-8944-42D0-8BDA-21D695C7958A" title="您可以使用SWITCHOVER命令切换主数据库和备用数据库的角色。">场景9：执行切换操作</a> ”</span> ，以获取使用<code class="codeph">VALIDATE DATABASE</code>命令显示数据库是否已准备好完成角色切换的示例</p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="examples-using-data-guard-broker-DGMGRL-utility.html#GUID-630F5987-328C-410C-AE3B-A9D66EB233D4" title="您可以调用故障转移操作以响应紧急情况，通常是在无法访问主数据库或不可用时。">方案10：执行手动故障转移操作</a> ”</span> ，以获取使用<code class="codeph">VALIDATE DATABASE</code>命令显示数据库是否已准备好完成角色故障转移的示例</p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="DGBKR3402"></a><div class="props_rev_3"><a id="GUID-A3140CC4-EFFF-465E-86FB-D68B15BF130E" name="GUID-A3140CC4-EFFF-465E-86FB-D68B15BF130E"></a><h4 id="DGBKR-GUID-A3140CC4-EFFF-465E-86FB-D68B15BF130E" class="sect4"><span class="enumeration_section">5.2.1</span>选择目标备用数据库进行切换</h4>
                  <div>
                     <p>在备用数据库全部属于同一类型（所有物理或所有逻辑备用数据库）的配置中执行切换时，请选择具有最少未应用重做的备用数据库。</p>
                     <p>通过选择具有最少未应用重做的备用数据库，可以最大限度地缩短完成切换操作所需的总时间。例如：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>使用DGMGRL，您可以通过检查<code class="codeph">SHOW CONFIGURATION LAG</code>的输出来完成此操作。</p>
                        </li>
                        <li>
                           <p>使用Cloud Control，您可以在Oracle Data Guard概述页面的<code class="codeph">Standby</code> <code class="codeph">Databases</code>部分中查看每个备用数据库的<code class="codeph">ApplyLag</code>列的值。
                           </p>
                        </li>
                     </ul>
                     <p>如果配置包含物理和逻辑备用数据库，请考虑选择物理备用数据库（具有最少量未应用的重做）作为目标备用数据库。切换到物理备用数据库是首选，因为在切换操作完成后，配置中的所有数据库都可用作新主数据库的备用数据库。切换到逻辑备用数据库将使配置中的所有物理和快照备用数据库无效并禁用。然后，您需要从新主数据库的副本重新创建物理备用数据库，然后才能重新启用它们。或者，如果您打算相对较快地切换回原始主数据库，则可以在切换回后重新启用已禁用的备用数据库。</p>
                     <p>除非先将其转换回物理备用数据库，否则无法切换到快照备用数据库。</p>
                     <div class="infoboxnote" id="GUID-A3140CC4-EFFF-465E-86FB-D68B15BF130E__GUID-C58A0859-AAD8-4383-B951-72CF68AE4CEE">
                        <p class="notep1">注意：</p>
                        <p>如果Oracle Data Guard配置在最大保护模式下运行，则代理不允许切换到逻辑备用数据库。配置必须在最大可用性模式或最高性能模式下运行，以便能够切换到逻辑备用数据库。</p>
                     </div>
                  </div>
               </div><a id="DGBKR3403"></a><div class="props_rev_3"><a id="GUID-0AC8540A-6BB6-4B80-8D55-A3D72AD02486" name="GUID-0AC8540A-6BB6-4B80-8D55-A3D72AD02486"></a><h4 id="DGBKR-GUID-0AC8540A-6BB6-4B80-8D55-A3D72AD02486" class="sect4"><span class="enumeration_section">5.2.2</span>为故障转移选择目标备用数据库</h4>
                  <div>
                     <p>在备用数据库类型相同的配置中执行故障转移时，请选择具有最小传输延迟的备用数据库。</p>
                     <p>选择具有最小传输延迟的备用数据库可以最大限度地减少数据丢失量，并且在某些情况下，根本不会导致数据丢失。</p>
                     <p>如果配置包含物理，快照和逻辑备用数据库，请考虑选择物理备用数据库作为目标备用数据库。故障转移到物理备用数据库是首选，因为在故障转移操作完成后，配置中的所有备用数据库可能仍可用作新主数据库的备用数据库。</p>
                     <p>您可以故障转移到快照备用数据库。但是，故障转移到快照备用数据库将需要更多时间，因为代理必须首先将其转换回物理备用数据库。转换后，代理将启动Redo Apply以应用累积的重做数据，然后将数据库故障转移到主要角色。由于代理在将快照备用数据库转换为物理备用数据库后执行故障转移，因此在故障转移操作完成后，配置中的所有备用数据库可能仍可用作新主数据库的备用数据库。</p>
                     <p>故障转移到逻辑备用数据库要求在故障转移完成后从新主数据库的副本重新创建所有物理和快照备用数据库。此外，逻辑备用数据库可以仅包含主数据库中存在的数据的子集。（例如，如果使用<code class="codeph">DBMS_LOGSTDBY.SKIP</code>过程来指定在主数据库上完成的数据库操作将不会应用于逻辑备用数据库。）
                     </p>
                     <p>但是，建议选择物理备用数据库作为目标备用数据库可能有例外。例如，如果您的所有物理备用数据库也不可用，则故障转移到逻辑备用数据库是您唯一的选择。</p>
                  </div>
               </div>
            </div><a id="DGBKR335"></a><div class="props_rev_3"><a id="GUID-AC6A6D2B-1112-422B-8A41-02FAC40E2078" name="GUID-AC6A6D2B-1112-422B-8A41-02FAC40E2078"></a><h3 id="DGBKR-GUID-AC6A6D2B-1112-422B-8A41-02FAC40E2078" class="sect3"><span class="enumeration_section">5.3</span>切换</h3>
               <div>
                  <p>切换是主数据库与其中一个备用数据库之间的角色转换。</p>
                  <p><a id="d12681e409" class="indexterm-anchor"></a><a id="d12681e413" class="indexterm-anchor"></a><a id="d12681e417" class="indexterm-anchor"></a><a id="d12681e423" class="indexterm-anchor"></a>切换可确保不丢失数据，通常用于主系统的计划维护。在切换期间，主数据库转换为备用角色，备用数据库转换为主角色。
                  </p>
                  <p>只要有可能，您应该切换到物理备用数据库：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>如果<a id="d12681e436" class="indexterm-anchor"></a><a id="d12681e442" class="indexterm-anchor"></a>切换将物理备用数据库转换为主要角色，然后：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>原始主数据库将切换为物理备用角色。</p>
                           </li>
                           <li>
                              <p>配置的其他成员将根据新的主要来自指定的重做源接收重做。</p>
                           </li>
                           <li>
                              <p>原始主数据库将作为切换操作的一部分重新启动。请注意，不需要重新启动新的主数据库。</p>
                              <p>不参与切换的备用数据库（称为旁观者备用数据库） <a id="d12681e459" class="indexterm-anchor"></a>继续在切换发生之前的状态下运行，并自动开始应用从新主数据库接收的重做数据。
                              </p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>如果<a id="d12681e465" class="indexterm-anchor"></a><a id="d12681e471" class="indexterm-anchor"></a>切换将逻辑备用数据库转换为主要角色，然后：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>原始主数据库将切换到逻辑备用角色。</p>
                           </li>
                           <li>
                              <p>在切换完成后，不需要重新启动主数据库和逻辑备用数据库。</p>
                              <p>切换后，代理配置中的其他逻辑备用旁观者数据库仍然可行。将禁用所有物理和快照备用数据库，并且必须在切换到逻辑备用数据库后从新主数据库的副本重新创建。</p>
                           </li>
                        </ul>
                        <p>当配置在最大保护模式下运行时，不允许切换到逻辑备用数据库。</p>
                        <div class="infoboxnotewarn" id="GUID-AC6A6D2B-1112-422B-8A41-02FAC40E2078__GUID-7838909A-983C-4134-9B67-5DFB6ECAABDF">
                           <p class="notep1">警告：</p>
                           <p>切换到逻辑备用数据库会导致代理禁用代理配置中的快照和物理备用数据库，从而使这些数据库不再可用作备用数据库。<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D1C0709A-FBF0-4635-95A4-385506A5EC2D" title="To restore your original disaster-recovery solution after switchover to a logical standby database or after failover to any standby database, you may need to perform additional steps.">角色更改后重新启用已禁用的数据库</a>描述如何将其<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D1C0709A-FBF0-4635-95A4-385506A5EC2D" title="要在切换到逻辑备用数据库后或故障转移到任何备用数据库后还原原始灾难恢复解决方案，可能需要执行其他步骤。">可用性</a>恢复为备用数据库。
                           </p>
                           <p>如果您打算相对较快地切换回原始主数据库，则可以允许物理和快照备用数据库保持禁用状态。完成切换回原始主数据库后，您可以重新启用物理和快照备用数据库，因为它们仍然是原始主数据库的可行备用数据库。</p>
                        </div>
                     </li>
                  </ul>
               </div><a id="DGBKR340"></a><div class="props_rev_3"><a id="GUID-F910D713-A55D-4F5B-8744-BF7C98E2843C" name="GUID-F910D713-A55D-4F5B-8744-BF7C98E2843C"></a><h4 id="DGBKR-GUID-F910D713-A55D-4F5B-8744-BF7C98E2843C" class="sect4"><span class="enumeration_section">5.3.1</span>执行切换操作前</h4>
                  <div>
                     <p>在开始切换之前，需要考虑以下几点。</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>当您开始切换时，代理会验证至少一个备用数据库（包括即将转换到备用角色的主数据库）配置为支持整体保护模式（最大保护，最大可用性或最高性能）切换完成后。</p>
                        </li>
                        <li>
                           <p>事先准备主数据库，以便将来可能在整体保护模式的上下文中充当备用数据库（请参阅<a href="managing-oracle-data-guard-broker-configuration-members.html#GUID-994BE350-859F-41DC-A1D3-B6E8D5EEF2C8" title="您可以使用代理设置具有任何不同数据保护模式的配置。">管理数据保护模式</a> ）。这种准备包括：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>确保在主数据库上配置备用重做日志文件。</p>
                              </li>
                              <li>
                                 <p>预设与重做传输服务相关的数据库属性，例如<code class="codeph">LogXptMode</code> ， <code class="codeph">NetTimeout</code> ， <code class="codeph">StandbyArchiveLocation</code> ， <code class="codeph">StandbyAlternateLocation</code>和<code class="codeph">RedoRoutes</code> 。有关使用数据库属性管理重做传输服务的更多详细信息，请参阅<a href="managing-oracle-data-guard-broker-configuration-members.html#GUID-6DC53E53-63F3-42D7-865E-C7689AEBD44A" title="要管理重做传输服务，请在每个配置成员上指定可配置属性。">管理重做传输服务</a> 。
                                 </p>
                              </li>
                              <li>
                                 <p>重置与Redo Apply服务相关的数据库属性，例如<code class="codeph">DelayMins</code> 。在开始切换之前，必须删除任何应用延迟。代理将不允许切换到已配置应用延迟的备用数据库（ <code class="codeph">DelayMins</code>属性设置为非零值）。有关使用属性管理Redo Apply服务的更多详细信息，请参阅<a href="managing-oracle-data-guard-broker-configuration-members.html#GUID-6753936C-E2E3-471E-BCC5-0C4697AD4255" title="您可以使用与log apply相关的数据库属性在物理和逻辑备用数据库上管理Redo Apply和SQL Apply。">管理日志应用服务</a> 。
                                 </p>
                              </li>
                              <li>
                                 <p>对于每个临时表，验证备用数据库上是否还存在与主数据库上的该表关联的临时文件。</p>
                              </li>
                           </ul>
                           <p>请注意，在您实际将主数据库切换到备用角色之前，代理不会使用这些属性来设置重做传输服务和重做应用服务。因此，直到切换之后才验证这些属性的值的有效性。设置这些属性后，它们的值将在切换和故障转移期间通过角色更改保持不变。</p>
                        </li>
                        <li>
                           <p>如果启用了快速启动故障切换，则只能对预先指定的目标备用数据库执行切换，并且仅当备用数据库与主数据库同步或在配置的滞后限制内时才能执行切换，以获得最大可用性和最大性能模式分别。有关启用快速启动故障转移的信息，请参阅<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D26D79F2-0093-4C0E-98CD-224A5C8CBFA4" title="您可以在连接到代理配置中的任何数据库时从任何站点启用快速启动故障转移。">启用快速启动故障转移</a> 。
                           </p>
                        </li>
                        <li>
                           <p>您可以使用<code class="codeph">SHOW CONFIGURATION WHEN PRIMARY IS</code>命令显示重做传输配置（基于每个成员的<code class="codeph">RedoRoutes</code>属性设置），如果指定的数据库是主数据库，则该配置将生效。您可以使用此信息提前识别角色更改后不正确的任何重做传输配置，包括因未正确配置<code class="codeph">RedoRoutes</code>属性而无法接收重做的任何备用数据库。
                           </p>
                        </li>
                     </ul>
                     <p>切换完成后，代理通过将保护模式保持在切换前的相同保护级别（最大保护，最大可用性或最高性能），将整个Oracle Data Guard保护模式保留为切换过程的一部分。在所有其他旁观者备用数据库上应用服务会自动开始应用从新主数据库接收的重做数据。</p>
                     <p>如果配置中存在物理或快照备用数据库，并且逻辑备用数据库发生切换，则需要从新主数据库的副本重新创建这些数据库，然后重新启用这些数据库，如重新启用<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D1C0709A-FBF0-4635-95A4-385506A5EC2D" title="要在切换到逻辑备用数据库后或故障转移到任何备用数据库后还原原始灾难恢复解决方案，可能需要执行其他步骤。">已禁用的数据库中所述角色转变</a> 。
                     </p>
                     <div class="infoboxnote" id="GUID-F910D713-A55D-4F5B-8744-BF7C98E2843C__GUID-D2E84FB3-E703-4077-B5A8-25937D0DD3C0">
                        <p class="notep1">注意：</p>
                        <p>在Oracle Data Guard配置中，SRVCTL <code class="codeph">-startoption</code>和<code class="codeph">-role</code>被切换后更新以反映新的主数据库和备用数据库当前打开的模式和数据库角色。有关代理如何与Oracle Restart交互的其他信息，请参阅<span class="q">“ <a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-05918DD1-FB0F-435B-873B-A43BEC1C7638" title="可以将数据库服务配置为在Oracle RAC数据库和Oracle Restart管理的单实例数据库上的特定数据库角色中处于活动状态。">数据库服务配置要求</a> ”</span> 。
                        </p>
                     </div>
                  </div>
               </div><a id="DGBKR3404"></a><div class="props_rev_3"><a id="GUID-B31291C3-818E-45E6-8461-3804B1D4BF39" name="GUID-B31291C3-818E-45E6-8461-3804B1D4BF39"></a><h4 id="DGBKR-GUID-B31291C3-818E-45E6-8461-3804B1D4BF39" class="sect4"><span class="enumeration_section">5.3.2</span>启动切换</h4>
                  <div>
                     <p>启动切换时，所涉及的主数据库和备用数据库应具有尽可能小的重做延迟。</p>
                     <div class="section">
                        <p>转换角色的行为应该是精心策划的活动。<a href="../sbydb/managing-oracle-data-guard-role-transitions.html#SBYDB00600" target="_blank"><span class="italic">Oracle Data Guard概念和管理</span></a>提供有关在准备切换时设置数据库的信息。
                        </p>
                        <p>要使用Cloud Control启动切换，请选择要更改为主角色的备用数据库，然后单击“ <span class="bold">切换”</span> 。使用DGMGRL时，需要发出<code class="codeph">SWITCHOVER</code>命令，指定要更改为主角色的备用数据库的名称。
                        </p>
                        <p>代理控制剩余的切换。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DGBKR350"></a><div class="props_rev_3"><a id="GUID-7A7E5C06-C98F-4517-AA85-3211386280DA" name="GUID-7A7E5C06-C98F-4517-AA85-3211386280DA"></a><h4 id="DGBKR-GUID-7A7E5C06-C98F-4517-AA85-3211386280DA" class="sect4"><span class="enumeration_section">5.3.3</span>代理如何执行切换</h4>
                  <div>
                     <p>这些是代理在您开始切换后执行的操作。</p>
                     <ol>
                        <li>
                           <p>验证主数据库和目标备用数据库是否处于以下状态：</p>
                           <ol type="a">
                              <li>
                                 <p>主数据库已启用且处于<code class="codeph">TRANSPORT-ON</code>状态。
                                 </p>
                              </li>
                              <li>
                                 <p>目标备用数据库已启用且处于<code class="codeph">APPLY-ON</code>状态。
                                 </p>
                              </li>
                           </ol>
                           <p>只要主数据库和您选择参与切换操作的备用数据库没有错误，代理就允许切换继续进行。任何其他配置成员发生的错误都不会妨碍切换。</p>
                        </li>
                        <li>
                           <p>切换主数据库和备用数据库之间的角色。</p>
                           <p>代理首先将原始主数据库转换为以备用角色运行。如果在任一转换期间发生任何错误，代理将停止切换。有关详细信息，请参阅<a href="troubleshooting-oracle-data-guard-broker.html#GUID-E417A951-84C5-4693-9136-8480FB8B1876" title="如果由于配置问题导致切换失败，则代理会报告在警报日志文件或代理日志文件中遇到的任何问题。">切换操作期间的故障排除</a> 。
                           </p>
                        </li>
                        <li>
                           <p>更新代理配置文件以记录角色的更改。</p>
                           <p>这允许在以后因任何原因重新启动数据库时启动相应的Data Guard服务，例如重做传输或重做应用。</p>
                        </li>
                        <li>
                           <p>如果切换到物理备用数据库，则重新启动新的备用数据库（以前的主数据库），并且重做应用开始从新的主数据库应用重做数据。如果这是Oracle Clusterware管理的Oracle RAC物理备用数据库，则代理会指示Oracle Clusterware重新启动新的备用数据库。</p>
                        </li>
                        <li>
                           <p>新的主数据库以读/写模式打开，并启动重做传输服务。</p>
                           <p>如果以前的物理备用数据库在启用实时查询的情况下运行，则新的物理备用数据库将在启用实时查询的情况下运行。</p>
                        </li>
                     </ol>
                     <p>代理验证数据库的状态和状态，以确保切换正确地将数据库转换为新角色。切换后未被代理禁用的旁观者备用数据库将继续在切换之前的状态下运行。所有其他旁观者备用数据库上的SQL Apply自动开始应用从新主数据库接收的重做数据。</p>
                     <p>在极少数情况下，如果切换操作失败并且您没有主数据库，请重试切换命令。您可以切换回原始主服务器，然后重新尝试切换到原始目标服务器，或者在配置中选择另一个服务器切换到。</p>
                  </div>
               </div>
            </div><a id="DGBKR360"></a><div class="props_rev_3"><a id="GUID-9A988501-7E18-4A62-8CD6-4BDDFA355C98" name="GUID-9A988501-7E18-4A62-8CD6-4BDDFA355C98"></a><h3 id="DGBKR-GUID-9A988501-7E18-4A62-8CD6-4BDDFA355C98" class="sect3"><span class="enumeration_section">5.4</span>手动故障转移</h3>
               <div>
                  <p>在手动故障转移中，您将备用数据库转换为主数据库，因为原始主数据库失败，并且不可能及时恢复主数据库。</p>
                  <p>根据主数据库故障时主数据库和目标备用数据库是否同步，可能会丢失数据，也可能不会丢失数据。字<span class="italic">手册</span>使用具有快速启动故障（在所描述的对比这种类型的故障切换的<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-995CED84-BEA1-4675-9C68-B37CB996924F" title="快速启动故障转移允许代理在丢失主数据库时自动故障转移到先前选择的备用数据库。">快速启动故障</a> ）。
                  </p>
                  <div class="infoboxnote" id="GUID-9A988501-7E18-4A62-8CD6-4BDDFA355C98__GUID-A04710D2-38EC-4CC2-8074-406D1E123E0E">
                     <p class="notep1">注意：</p>
                     <p>即使启用了快速启动故障转移，也可以执行手动故障转移。有关详细信息，请参阅<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-0A81C376-FB77-4EB5-AF59-BD872A875FAE" title="如果启用了快速启动故障切换，则只要满足某些条件，您仍可以执行切换或手动故障切换。">启用快速启动故障转移时执行手动角色更改</a> 。
                     </p>
                  </div>
                  <p>以下部分描述了如何执行手动故障转移：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-F2E287D9-48A9-4B56-9140-08B3A54185ED" title="您可以使用Cloud Control或DGMGRL执行完整（推荐）或立即故障转移。">完整且即时的手动故障转移</a></p>
                     </li>
                     <li>
                        <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-89BF9FC5-1E3F-4C0B-90CB-AF4B39B5245E" title="在开始故障转移之前，首先确定不可能及时恢复主数据库，并确保关闭主数据库。">执行手动故障转移操作</a></p>
                     </li>
                     <li>
                        <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D1C0709A-FBF0-4635-95A4-385506A5EC2D" title="要在切换到逻辑备用数据库后或故障转移到任何备用数据库后还原原始灾难恢复解决方案，可能需要执行其他步骤。">角色更改后重新启用已禁用的数据库</a></p>
                     </li>
                  </ul>
               </div><a id="DGBKR3405"></a><div class="props_rev_3"><a id="GUID-F2E287D9-48A9-4B56-9140-08B3A54185ED" name="GUID-F2E287D9-48A9-4B56-9140-08B3A54185ED"></a><h4 id="DGBKR-GUID-F2E287D9-48A9-4B56-9140-08B3A54185ED" class="sect4"><span class="enumeration_section">5.4.1</span>完整且即时的手动故障转移</h4>
                  <div>
                     <p>您可以使用Cloud Control或DGMGRL执行<span class="italic">完整</span> （推荐）或<span class="italic">立即</span>故障转移。
                     </p>
                     <p></p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>一个<a id="d12681e959" class="indexterm-anchor"></a><a id="d12681e961" class="indexterm-anchor"></a><a id="d12681e965" class="indexterm-anchor"></a> <span class="italic">完整</span>故障转移是推荐的默认故障转移选项。它会自动恢复配置运行的保护模式的最大重做数据量。完整的故障转移还会尝试避免禁用任何不是故障转移目标的备用数据库，以便它们可以继续作为备用数据库提供给新的主数据库。
                           </p>
                           <p>是否禁用了不是故障转移目标的备用数据库（旁观者备用数据库）取决于它们相对于故障转移目标应用了多少重做数据以及故障转移目标的备用类型：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>如果故障转移目标是物理或快照备用数据库，则必须恢复或重新创建原始主数据库才能成为新主数据库的备用数据库。此外，如果代理检测到已在应用新主数据库的位置之外应用了重做，则代理可能会在故障转移期间禁用某些备用数据库。必须恢复或重新创建代理禁用的任何备用数据库，如在<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D1C0709A-FBF0-4635-95A4-385506A5EC2D" title="To restore your original disaster-recovery solution after switchover to a logical standby database or after failover to any standby database, you may need to perform additional steps.">角色更改后</a>重新<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D1C0709A-FBF0-4635-95A4-385506A5EC2D" title="要在切换到逻辑备用数据库后或故障转移到任何备用数据库后还原原始灾难恢复解决方案，可能需要执行其他步骤。">启用已禁用的数据库中所述</a> ，然后才能成为新主数据库的备用数据库。
                                 </p>
                                 <p>请注意，如果在快照备用数据库上执行了故障转移，则必须将旧主节点恢复或重新创建为物理备用数据库。</p>
                              </li>
                              <li>
                                 <p>如果故障转移目标是逻辑备用数据库，则将禁用配置中的原始主数据库和所有物理和快照备用数据库。如果启用了闪回数据库，则可以恢复主数据库。必须从新主数据库的副本重新创建物理和快照备用数据库。有关更多信息，请参阅<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D1C0709A-FBF0-4635-95A4-385506A5EC2D" title="要在切换到逻辑备用数据库后或故障转移到任何备用数据库后还原原始灾难恢复解决方案，可能需要执行其他步骤。">角色更改后重新启用已禁用的数据库</a> 。
                                 </p>
                              </li>
                           </ul>
                           <p>如果可以装入主数据库，则可以使用<code class="codeph">ALTER SYSTEM FLUSH REDO</code> SQL语句将任何未发送的重做数据从主数据库刷新到目标备用数据库。如果此操作成功，即使主数据库未处于零数据丢失保护模式，也可能实现零数据丢失故障转移。有关使用<code class="codeph">ALTER SYSTEM FLUSH REDO</code>语句的更多信息，请参阅<a href="../sbydb/managing-oracle-data-guard-role-transitions.html#SBYDB5171" target="_blank"><span class="italic">Oracle Data Guard概念和管理</span></a> 。
                           </p>
                           <p>在完全故障转移期间，代理执行“代理<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-2CB6E14E-C211-420C-8757-0BCFB1BE9F95" title="这些是代理在您开始完全故障转移后执行的操作。">如何执行完整故障转移操作”中</a>所述的故障转移步骤。
                           </p>
                        </li>
                        <li>
                           <p><span class="italic">立即</span>故障转移是最快的故障转移类型。但是，一旦调用故障转移，就不会在备用数据库上应用其他数据。立即故障转移的另一个后果是配置中的所有其他数据库都被禁用，必须先恢复或重新创建，然后才能充当新主数据库的备用数据库。<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D1C0709A-FBF0-4635-95A4-385506A5EC2D" title="要在切换到逻辑备用数据库后或故障转移到任何备用数据库后还原原始灾难恢复解决方案，可能需要执行其他步骤。">角色更改后重新启用已禁用的数据库</a>描述了如何执行此操作。在立即故障转移期间，代理执行“代理<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-1B89CB0D-6C5A-4D3E-8AC0-467D24F4E3B0" title="要立即启动故障转移，请使用DGMGRL FAILOVER TO数据库名称IMMEDIATE命令。">如何执行立即故障转移操作”中</a>所述的故障转移步骤。
                           </p>
                           <div class="infoboxnote" id="GUID-F2E287D9-48A9-4B56-9140-08B3A54185ED__GUID-2D1FF377-B44B-4315-9B79-195D945BC082">
                              <p class="notep1">注意：</p>
                              <p>始终尝试首先执行完整的故障转移，除非由于<code class="codeph">ORA-752</code>或<code class="codeph">ORA-600</code> <code class="codeph">[3020]</code>错误而在故障转移目标处停止重做应用。如果发生了其中一个错误，请在继续之前遵循My Oracle Support说明1265884.1中“解决备用恢复期间的ORA-752或ORA-600 [3020]”中的准则。此支持说明可从<a href="http://support.oracle.com" target="_blank"><code class="codeph">http://support.oracle.com</code></a> 。</p>
                              <p>只有在完全故障转移失败或刚刚提到的错误情况下才应执行立即故障转移。完全故障转移可以在没有任何数据丢失的情况下发生，具体取决于重做传输服务的目标属性，但立即进行故障转移通常会导致一些数据丢失。</p>
                           </div>
                        </li>
                     </ul>
                  </div>
               </div><a id="DGBKR370"></a><div class="props_rev_3"><a id="GUID-89BF9FC5-1E3F-4C0B-90CB-AF4B39B5245E" name="GUID-89BF9FC5-1E3F-4C0B-90CB-AF4B39B5245E"></a><h4 id="DGBKR-GUID-89BF9FC5-1E3F-4C0B-90CB-AF4B39B5245E" class="sect4"><span class="enumeration_section">5.4.2</span>执行手动故障转移操作</h4>
                  <div>
                     <p>在开始故障转移之前，首先确定不可能及时恢复主数据库，并确保关闭主数据库。</p>
                     <p>本节中的步骤描述了执行手动故障转移所涉及的任务。根据故障转移和所涉及的备用数据库类型，可能需要恢复或重新创建某些数据库。</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-B377087B-2369-4C1E-9A61-D1D058059C27" title="这些是选择目标备用数据库的准则。">执行手动故障转移任务1：确定哪些可用备用数据库是故障转移的最佳目标</a></p>
                        </li>
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-C37C8655-9A78-4857-B302-A015CE54B48C" title="使用Cloud Control或DGMGRL执行完整（推荐）或立即故障转移。">执行手动故障转移任务2：启动故障转移</a></p>
                        </li>
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-0C37ACF2-4399-49B0-B9B4-982157FCDDED" title="此列表描述了在手动故障转移（完整或即时）后如何处理整体Oracle Data Guard保护模式。">执行手动故障转移任务3：重置保护模式</a></p>
                        </li>
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-FB1760EA-1393-4522-8F06-9B893F936FFC" title="要在发生其他灾难时维护可行的灾难恢复解决方案，您可能需要执行其他步骤。">执行手动故障转移任务4：重新建立灾难恢复配置</a></p>
                        </li>
                     </ul>
                  </div>
                  <div class="props_rev_3"><a id="GUID-B377087B-2369-4C1E-9A61-D1D058059C27" name="GUID-B377087B-2369-4C1E-9A61-D1D058059C27"></a><h5 id="DGBKR-GUID-B377087B-2369-4C1E-9A61-D1D058059C27" class="sect5"><span class="enumeration_section">5.4.2.1</span>执行手动故障转移任务1：确定哪些可用备用数据库是故障转移的最佳目标</h5>
                     <div>
                        <p>这些是选择目标备用数据库的准则。</p>
                        <div class="section">
                           <p>请参阅<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-2AEF86C4-3CFA-4CF5-AEF3-E25871298363" title="在切换或故障转移后选择备用数据库作为下一个主数据库时，需要考虑几个因素。">选择目标备用数据库</a> 。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-C37C8655-9A78-4857-B302-A015CE54B48C" name="GUID-C37C8655-9A78-4857-B302-A015CE54B48C"></a><h5 id="DGBKR-GUID-C37C8655-9A78-4857-B302-A015CE54B48C" class="sect5"><span class="enumeration_section">5.4.2.2</span>执行手动故障转移任务2：启动故障转移</h5>
                     <div>
                        <p>使用Cloud Control或DGMGRL执行<span class="italic">完整</span> （推荐）或<span class="italic">立即</span>故障转移。
                        </p>
                        <div class="section">
                           <p><span class="bold">使用云控制手动故障转移：</span></p>
                           <p>在Cloud Control中的Oracle Data Guard Overview页面上，选择要更改为主角色的备用数据库，然后单击<span class="bold">Failover</span> 。然后，在“故障转移确认”页面上，单击“ <span class="bold">是”</span>以调用默认的“完全故障转移”选项。
                           </p>
                           <p><span class="bold">使用DGMGRL手动故障转移：</span></p>
                           <p>连接到目标备用数据库并发出<code class="codeph">FAILOVER</code>命令以执行故障转移，指定要成为主数据库的备用数据库的名称：</p><pre class="oac_no_warn" dir="ltr">DGMGRL&gt; FAILOVER TO <span class="italic">数据库名称</span> ;</pre><p>如果满足以下任一条件，请指定可选的<code class="codeph">IMMEDIATE</code>子句以执行立即故障转移：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>备用数据库发生<code class="codeph">ORA-752</code>错误</p>
                              </li>
                              <li>
                                 <p>备用数据库发生<code class="codeph">ORA-600</code> <code class="codeph">[3020]</code>错误，Oracle支持人员确定它是由主数据库中的写入丢失引起的</p>
                              </li>
                              <li>
                                 <p>无法完成故障转移</p>
                              </li>
                           </ul><pre class="oac_no_warn" dir="ltr">DGMGRL&gt; FAILOVER TO数据库名称IMMEDIATE;</pre><div class="infoboxnotealso" id="GUID-C37C8655-9A78-4857-B302-A015CE54B48C__GUID-B1EA2A74-73C7-483C-9300-CFBC7AA03148">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="oracle-data-guard-broker-commands.html#GUID-F472B33F-FED1-49C6-A881-8FDA38A25627" title="FAILOVER命令调用故障转移，将命名（目标）备用数据库转换为主数据库的角色。">故障切换</a></p>
                                 </li>
                              </ul>
                           </div>
                           <p>如果要执行完整故障转移，则在将数据库角色更改为主要数据之前应用所有累积的重做数据。如果您正在执行立即故障转移，则数据库角色将更改为主数据库，而不应用任何累积的重做数据。</p>
                           <p>如果目标是快照备用数据库，则代理首先将数据库转换为物理备用数据库。</p>
                           <p>如果目标备用数据库是物理备用数据库或逻辑备用数据库，则在执行故障转移时不会关闭任何实例。如果目标备用数据库是快照备用数据库，则必须在执行故障转移之前将其所有实例重新启动到装入模式。Cloud Control和DGMGRL CLI都将在故障转移过程中自动执行此操作。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-0C37ACF2-4399-49B0-B9B4-982157FCDDED" name="GUID-0C37ACF2-4399-49B0-B9B4-982157FCDDED"></a><h5 id="DGBKR-GUID-0C37ACF2-4399-49B0-B9B4-982157FCDDED" class="sect5"><span class="enumeration_section">5.4.2.3</span>执行手动故障转移任务3：重置保护模式</h5>
                     <div>
                        <p>此列表描述了在手动故障转移（完整或即时）后如何处理整体Oracle Data Guard保护模式。</p>
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>如果保护模式处于最大保护状态，则会将其重置为最高性能。如有必要，可以稍后升级保护模式，如<a href="managing-oracle-data-guard-broker-configuration-members.html#GUID-A938EA13-B128-4D54-8A99-6871D93F01CE" title="以下是为配置设置保护模式的步骤。">设置配置的保护模式中所述</a> 。
                                 </p>
                              </li>
                              <li>
                                 <p>如果保护模式处于最大可用性或最大性能，则保持模式保持不变。</p>
                              </li>
                           </ul>
                           <div class="infoboxnote" id="GUID-0C37ACF2-4399-49B0-B9B4-982157FCDDED__GUID-9886CA67-459B-45AA-B5E4-F079696F9F6F">
                              <p class="notep1">注意：</p>
                              <p>如果在启用快速启动故障转移时执行手动故障转移：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>只能对当前目标备用数据库执行故障转移。</p>
                                 </li>
                                 <li>
                                    <p>代理保留在故障转移之前生效的保护模式。</p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-FB1760EA-1393-4522-8F06-9B893F936FFC" name="GUID-FB1760EA-1393-4522-8F06-9B893F936FFC"></a><h5 id="DGBKR-GUID-FB1760EA-1393-4522-8F06-9B893F936FFC" class="sect5"><span class="enumeration_section">5.4.2.4</span>执行手动故障转移任务4：重新建立灾难恢复配置</h5>
                     <div>
                        <p>要在发生其他灾难时维护可行的灾难恢复解决方案，您可能需要执行其他步骤。</p>
                        <div class="section">
                           <p>请参阅<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D1C0709A-FBF0-4635-95A4-385506A5EC2D" title="要在切换到逻辑备用数据库后或故障转移到任何备用数据库后还原原始灾难恢复解决方案，可能需要执行其他步骤。">角色更改后重新启用已禁用的数据库</a></p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>恢复原始主数据库以在新配置中充当备用数据库。</p>
                                 <div class="infoboxnote" id="GUID-FB1760EA-1393-4522-8F06-9B893F936FFC__GUID-EB408EAD-2BCD-4546-9905-BDF0A3060C44">
                                    <p class="notep1">警告：</p>
                                    <p>如果在故障转移目标上发生<code class="codeph">ORA-752</code>或<code class="codeph">ORA-600</code> <code class="codeph">[3020]</code>错误，请勿尝试恢复旧的主数据库。相反，必须使用<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-CA638065-9E57-420F-852B-D05065B6DE24" title="If you re-create the old primary database, it must be created as the standby type of the old standby database.">如何重新创建和重新启用已禁用数据库中</a>所述的过程，从新主数据库的备份中将旧主数据库重新创建为备用<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-CA638065-9E57-420F-852B-D05065B6DE24" title="如果重新创建旧的主数据库，则必须将其创建为旧备用数据库的备用类型。">数据库</a> 。
                                    </p>
                                 </div>
                              </li>
                              <li>
                                 <p>在已由代理禁用的配置中恢复或重新创建备用数据库。</p>
                                 <p>完成故障转移完成后，代理将禁用任何不可用作新主数据库备用数据库的旁观者备用数据库。这可能由于以下原因之一而发生：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>旁观者备用数据库应用了比新主数据库本身在备用数据库时应用的重做数据更多的重做数据。必须先重新创建或恢复备用数据库，然后才能将其用作新主数据库的备用数据库。</p>
                                    </li>
                                    <li>
                                       <p>故障转移是逻辑备用数据库。代理会禁用配置中的所有物理和快照备用数据库。必须先重新创建它们，然后才能将其作为新主数据库的备用数据库。</p>
                                    </li>
                                 </ul>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="DGBKR3856"></a><a id="DGBKR3857"></a><a id="DGBKR375"></a><div class="props_rev_3"><a id="GUID-2CB6E14E-C211-420C-8757-0BCFB1BE9F95" name="GUID-2CB6E14E-C211-420C-8757-0BCFB1BE9F95"></a><h5 id="DGBKR-GUID-2CB6E14E-C211-420C-8757-0BCFB1BE9F95" class="sect5"><span class="enumeration_section">5.4.2.5</span>代理如何执行完整的故障转移操作</h5>
                     <div>
                        <p>这些是代理在您开始完全故障转移后执行的操作。</p>
                        <ol>
                           <li>
                              <p>验证是否已启用目标备用数据库。如果未启用数据库，则无法对此数据库执行故障转移。</p>
                           </li>
                           <li>
                              <p>在停止Redo Apply（如果目标是物理备用数据库）或SQL Apply（如果目标是逻辑备用数据库）之前，等待目标备用数据库完成应用任何未应用的重做数据。</p>
                              <p>如果目标是快照备用数据库，则代理首先将数据库转换回物理备用数据库，然后启动重做应用以在完成故障转移并将数据库作为主数据库打开之前应用所有累积的重做。</p>
                           </li>
                           <li>
                              <p>将目标备用数据库转换为主数据库角色，如下所示：</p>
                              <ol type="a">
                                 <li>
                                    <p>将数据库的角色从备用数据库更改为主数据库。</p>
                                 </li>
                                 <li>
                                    <p>以读/写模式打开新的主数据库。</p>
                                 </li>
                                 <li>
                                    <p>确定未参与故障转移操作的任何备用数据库是否已在新主数据库之外应用重做数据，因此需要禁用。</p>
                                    <p>如果在此故障转移期间代理未禁用旁观者备用数据库，则它将保持在故障转移之前的状态。例如，如果物理备用数据库处于<code class="codeph">APPLY-OFF</code>状态，它将保持<code class="codeph">APPLY-OFF</code>状态。
                                    </p>
                                    <p>默认情况下，代理始终确定旁观者备用数据库在执行完整故障转移时是否为新主数据库的可行备用数据库。如果希望代理在完全故障转移期间跳过旁观者备用数据库的此可行性检查，从而减少整体故障转移时间，请将<code class="codeph">BystandersFollowRoleChange</code>配置属性设置为<code class="codeph">NONE</code> 。</p>
                                    <p>当此属性设置为<code class="codeph">NONE</code> ，代理将禁用所有旁观者备用数据库，而不检查它们是否应用了比新主数据库更多的重做数据。故障转移完成后，您必须恢复或重新创建（请参阅<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D1C0709A-FBF0-4635-95A4-385506A5EC2D" title="To restore your original disaster-recovery solution after switchover to a logical standby database or after failover to any standby database, you may need to perform additional steps.">在角色更改后</a>重新<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D1C0709A-FBF0-4635-95A4-385506A5EC2D" title="要在切换到逻辑备用数据库后或故障转移到任何备用数据库后还原原始灾难恢复解决方案，可能需要执行其他步骤。">启用已禁用的数据库</a> ）备用数据库。<code class="codeph">SHOW CONFIGURATION</code>命令将显示可以恢复哪些数据库以及必须重新创建哪些数据库。使用<code class="codeph">SHOW CONFIGURATION BystandersFollowRoleChange</code>命令查看此属性的值。默认值为<code class="codeph">ALL</code> 。</p>
                                    <p>此属性还会影响代理在发生快速启动故障转移时是否跳过旁观者备用数据库的可行性检查。</p>
                                 </li>
                                 <li>
                                    <p>启动重做传输服务以开始将重做数据传输到未禁用的所有旁观者备用数据库。</p>
                                    <div class="infoboxnote" id="GUID-2CB6E14E-C211-420C-8757-0BCFB1BE9F95__GUID-171DBC84-762D-40B6-860D-048067251E68">
                                       <p class="notep1">注意：</p>
                                       <p>在故障转移期间，代理可以禁用旁观者备用数据库，并且必须先恢复或重新创建它们，然后才能充当新主数据库的备用数据库。Oracle建议在每个数据库上配置闪回数据库，以便在物理备用数据库发生故障转移时，可以更轻松地恢复任何已禁用的备用数据库。如果逻辑备用数据库发生故障转移，则代理将禁用所有物理和快照备用数据库。在这种情况下，闪回数据库不能用于恢复数据库。必须从新主数据库的副本重新创建它们。可以恢复在故障转移期间禁用的逻辑备用数据库。</p>
                                    </div>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>如果故障转移目标数据库是Oracle RAC物理或快照备用数据库，则代理会指示Oracle Clusterware重新启动在故障转移之前可能已关闭的所有实例。</p>
                           </li>
                        </ol>
                        <p>只要您选择参与故障转移的备用数据库没有错误，代理就允许故障转移继续。任何其他配置成员发生的错误都不会妨碍切换。如果您启动了完整的故障转移并且失败，则可能需要立即使用故障转移。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-2CB6E14E-C211-420C-8757-0BCFB1BE9F95__GUID-AF692226-A7E1-4D5D-864B-D24F4FCDD8CD">使用远程同步实例完成配置中的故障转移</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>可以手动执行到远程同步实例接收重做数据的备用数据库的完成者故障转移。要进行故障转移，请连接到备用数据库并使用DGMGRL <code class="codeph">FAILOVER</code> <code class="codeph">TO</code> <span class="italic"><code class="codeph">db-unique-name</code></span>命令。驻留在远同步实例上的任何未发送的重做数据在将物理备用数据库转换为主数据库之前被发送到目标物理备用数据库。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-2CB6E14E-C211-420C-8757-0BCFB1BE9F95__GUID-87810F86-F2A2-409A-9E2F-B8CAED2A82F1">使用级联备用数据库完成配置故障转移</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>在完整的故障转移中，还可以故障转移到从另一个备用数据库（cascader）重做的备用数据库（终端备用数据库）。在这种情况下，不会尝试将任何未发送的重做从级联发送到终端备用。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="DGBKR3858"></a><a id="DGBKR3859"></a><a id="DGBKR380"></a><div class="props_rev_3"><a id="GUID-1B89CB0D-6C5A-4D3E-8AC0-467D24F4E3B0" name="GUID-1B89CB0D-6C5A-4D3E-8AC0-467D24F4E3B0"></a><h5 id="DGBKR-GUID-1B89CB0D-6C5A-4D3E-8AC0-467D24F4E3B0" class="sect5"><span class="enumeration_section">5.4.2.6</span>代理如何执行立即故障转移操作</h5>
                     <div>
                        <p>要立即启动故障转移，请使用DGMGRL <code class="codeph">FAILOVER TO <span class="variable" translate="no">database-name</span> IMMEDIATE</code>命令。
                        </p>
                        <p>一旦立即启动故障转移，经纪人：</p>
                        <ol>
                           <li>
                              <p>验证是否已启用目标备用数据库。如果未通过代理启用备用数据库进行管理，则无法进行故障转移。</p>
                           </li>
                           <li>
                              <p>立即停止备用数据库上的重做应用或SQL应用，而不等待所有可用的重做数据都已应用。这可能会导致数据丢失。</p>
                           </li>
                           <li>
                              <p>将目标备用数据库转换为主要角色，以读/写模式打开新的主数据库，并启动重做传输服务。</p>
                              <p>立即进行故障转移完成后，将禁用配置中的所有备用数据库，无论其类型如何。如果在这些数据库上启用了闪回数据库，则可以恢复它们。否则，必须从新主数据库的副本重新创建它们。</p>
                           </li>
                        </ol>
                        <p>只要您选择参与故障转移的备用数据库上没有错误，代理就允许完成故障转移。</p>
                        <p>即使您选择参与故障转移的备用数据库上存在错误，代理也允许立即进行故障转移。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-1B89CB0D-6C5A-4D3E-8AC0-467D24F4E3B0__GUID-6975836C-69AA-4C01-B1B4-1C7CD18685F7">使用远程同步实例的配置中的立即故障转移</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>可以手动执行到远程同步实例接收重做数据的备用数据库的立即故障转移。在这种情况下，在将物理备用数据库转换为主数据库之前，不会尝试将任何未发送的重做从远程同步实例传输到目标物理备用数据库。</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-1B89CB0D-6C5A-4D3E-8AC0-467D24F4E3B0__GUID-A679E267-5666-48C7-930D-139752632A28">使用级联备用数据库的配置中的即时故障转移</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>在立即故障转移中，还可以故障转移到从另一个备用数据库（cascader）重做的备用数据库（终端备用数据库）。在这种情况下，不会尝试将任何未发送的重做从级联发送到终端备用。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="DGBKR385"></a><div class="props_rev_3"><a id="GUID-D1C0709A-FBF0-4635-95A4-385506A5EC2D" name="GUID-D1C0709A-FBF0-4635-95A4-385506A5EC2D"></a><h4 id="DGBKR-GUID-D1C0709A-FBF0-4635-95A4-385506A5EC2D" class="sect4"><span class="enumeration_section">5.4.3</span>角色更改后重新启用已禁用的数据库</h4>
                  <div>
                     <p>要在切换到逻辑备用数据库后或故障转移到任何备用数据库后还原原始灾难恢复解决方案，可能需要执行其他步骤。</p>
                     <div class="section">
                        <p>角色转换后已禁用的数据库不会从代理配置中<span class="italic">删除</span> ，但它们不再由代理管理。
                        </p>
                        <p>要重新启用这些数据库的代理管理，必须使用以下过程之一恢复或重新创建数据库：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>如果可以恢复数据库，则数据库将显示以下状态：</p><pre class="oac_no_warn" dir="ltr">ORA-16661：需要恢复备用数据库</pre><p>使用DGMGRL <code class="codeph">REINSTATE DATABASE</code>命令或Cloud Control中的恢复选项<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-1899954F-C227-4BC4-A3C9-098A0282AEAC" title="You can use the broker&#39;s reinstate capability to make a failed primary database a viable standby database for the new primary.">恢复数据库</a> ，如<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-1899954F-C227-4BC4-A3C9-098A0282AEAC" title="您可以使用代理的恢复功能使发生故障的主数据库成为新主数据库的可行备用数据库。">如何恢复数据库中所述</a> 。作为恢复数据库的一部分，代理会自动重新启用数据库。
                              </p>
                           </li>
                           <li>
                              <p>如果必须从新主数据库的副本重新创建数据库，则它将具有以下状态：</p><pre class="oac_no_warn" dir="ltr">ORA-16795：需要重新创建备用数据库</pre><p>从主数据库的副本重新创建备用数据库，然后重新启用它，如<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-CA638065-9E57-420F-852B-D05065B6DE24" title="如果重新创建旧的主数据库，则必须将其创建为旧备用数据库的备用类型。">如何重新创建和重新启用已禁用的数据库中所述</a> 。
                              </p>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-D1C0709A-FBF0-4635-95A4-385506A5EC2D__GUID-40AA72DC-633D-437B-9350-5951B2BD2659">
                           <p class="notep1">注意：</p>
                           <p>执行多个角色更改时禁用的任何数据库都无法恢复。您必须从当前主数据库的副本手动重新创建数据库，然后在代理配置中重新启用数据库。</p>
                        </div>
                        <p>是否恢复或重新创建数据库取决于您是作为操作目标的备用数据库类型执行切换还是故障转移，以及是否有足够的闪回日志。请注意，对逻辑备用数据库的角色更改始终会导致禁用物理备用数据库旁观者。他们无法恢复。必须从新主数据库的副本重新创建它们。</p>
                        <p>以下部分描述了如何恢复或重新启用数据库。</p>
                     </div>
                     <!-- class="section" -->
                  </div><a id="DGBKR3406"></a><div class="props_rev_3"><a id="GUID-1899954F-C227-4BC4-A3C9-098A0282AEAC" name="GUID-1899954F-C227-4BC4-A3C9-098A0282AEAC"></a><h5 id="DGBKR-GUID-1899954F-C227-4BC4-A3C9-098A0282AEAC" class="sect5"><span class="enumeration_section">5.4.3.1</span>如何恢复数据库</h5>
                     <div>
                        <p>您可以使用代理的恢复功能使发生故障的主数据库成为新主数据库的可行备用数据库。</p>
                        <p>无论是对物理，逻辑还是快照备用数据库进行故障转移，都可以执行此操作。</p>
                        <p>您还可以恢复在故障转移操作期间禁用的旁观者备用数据库。</p>
                        <p>可以恢复的数据库将具有以下状态值：</p><pre class="oac_no_warn" dir="ltr"><a id="d12681e1775" class="indexterm-anchor"></a><a id="d12681e1779" class="indexterm-anchor"></a> ORA-16661：需要恢复备用数据库</pre><p>要使<code class="codeph">REINSTATE</code>命令成功， <a id="d12681e1789" class="indexterm-anchor"></a><a id="d12681e1793" class="indexterm-anchor"></a>必须在故障转移之前在数据库上启用闪回数据库，并且必须足够<a id="d12681e1798" class="indexterm-anchor"></a><a id="d12681e1802" class="indexterm-anchor"></a><a id="d12681e1806" class="indexterm-anchor"></a>闪回登录该数据库。此外，要恢复的数据库和新的主数据库必须具有网络连接。
                        </p>
                        <p>要恢复数据库：</p>
                        <ol>
                           <li>
                              <p>将数据库重新启动到已装入状态</p>
                           </li>
                           <li>
                              <p>连接到新的主数据库</p>
                           </li>
                           <li>
                              <p>使用Cloud Control或DGMGRL恢复数据库</p>
                           </li>
                        </ol>
                        <p>代理将故障主数据库恢复为与旧备用数据库相同类型（物理或逻辑备用数据库）的备用数据库。唯一的例外是对快照备用数据库的故障转移。在这种情况下，故障主数据库将恢复为物理备用数据库。</p>
                        <p>代理将故障转移期间禁用的旁观者备用数据库恢复为备用数据库到新的主数据库。</p>
                        <p><span class="bold">使用云控制进行恢复</span><a id="d12681e1830" class="indexterm-anchor"></a></p>
                        <p>在“Oracle Data Guard概述”页面上，单击“ <span class="bold">数据库必须已恢复”</span> 。这将打开“常规属性”页面，其中提供“ <span class="bold">恢复”</span>按钮。单击“ <span class="bold">恢复”</span>按钮后，Cloud Control将开始恢复数据库。
                        </p>
                        <p>该过程完成后，数据库将作为备用数据库启用到新的主数据库，Cloud Control将显示Oracle Data Guard概述页面。</p>
                        <p><span class="bold">使用DGMGRL恢复</span></p>
                        <p>连接到代理配置中的任何数据库时发出以下命令，但要恢复的数据库除外：</p><pre class="oac_no_warn" dir="ltr">DGMGRL&gt; REINSTATE DATABASE <span class="italic">db_unique_name</span> ;</pre><p>新恢复的备用数据库将开始作为新主数据库的备用数据库。如果恢复数据库失败，其状态将更改为<code class="codeph">ORA-16795: the standby database needs to be re-created</code> 。然后，必须从新主数据库的副本重新创建它，并按照<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-CA638065-9E57-420F-852B-D05065B6DE24" title="如果重新创建旧的主数据库，则必须将其创建为旧备用数据库的备用类型。">如何重新创建和重新启用已禁用的数据库中的说明</a>重新启用它。
                        </p>
                     </div>
                  </div><a id="DGBKR3407"></a><div class="props_rev_3"><a id="GUID-CA638065-9E57-420F-852B-D05065B6DE24" name="GUID-CA638065-9E57-420F-852B-D05065B6DE24"></a><h5 id="DGBKR-GUID-CA638065-9E57-420F-852B-D05065B6DE24" class="sect5"><span class="enumeration_section">5.4.3.2</span>如何重新创建和重新启用已禁用的数据库</h5>
                     <div>
                        <p>如果重新创建旧的主数据库，则必须将其创建为旧备用数据库的备用类型。</p>
                        <div class="section">
                           <p>例如，如果旧备用数据库是物理备用数据库或快照备用数据库，则必须将旧主数据库重新创建为物理备用数据库。</p>
                           <p>重新创建数据库后，使用DGMGRL <code class="codeph">ENABLE DATABASE</code>命令<code class="codeph">ENABLE DATABASE</code>对重新创建的备用数据库的代理管理。
                           </p>
                           <p>如果执行了故障转移或切换，需要重新创建在角色转换期间禁用的故障主数据库或备用数据库，请按照<a href="../sbydb/creating-oracle-data-guard-physical-standby.html#SBYDB00200" target="_blank"><span class="italic">Oracle Data Guard概念和管理</span></a>章节“创建物理备用数据库”中的过程进行操作。以及<a href="../sbydb/creating-oracle-data-guard-logical-standby.html#SBYDB00300" target="_blank"><span class="italic">Oracle Data Guard概念和管理</span></a>章节“创建逻辑备用数据库”。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="DGBKR3541"></a><a id="DGBKR390"></a><div class="props_rev_3"><a id="GUID-995CED84-BEA1-4675-9C68-B37CB996924F" name="GUID-995CED84-BEA1-4675-9C68-B37CB996924F"></a><h3 id="DGBKR-GUID-995CED84-BEA1-4675-9C68-B37CB996924F" class="sect3"><span class="enumeration_section">5.5</span>快速启动故障转移</h3>
               <div>
                  <p><span class="bold">快速启动故障转移</span>允许代理在丢失主数据库时自动故障转移到先前选择的备用数据库。
                  </p>
                  <p><a id="d12681e1976" class="indexterm-anchor"></a>快速启动故障转移可以快速可靠地将目标备用数据库故障转移到主数据库角色，而无需执行任何手动步骤来调用故障转移。快速启动故障转移只能在代理配置中使用，并且只能通过DGMGRL或Cloud Control进行配置。
                  </p>
                  <p>如果主数据库具有多个备用数据库，则可以使用<code class="codeph">FastStartFailoverTarget</code>属性指定多个快速启动故障转移目标。目标被称为候选目标。代理根据在<code class="codeph">FaststartFailoverTarget</code>属性上指定目标的顺序选择目标。如果指定的快速启动故障转移目标出现问题且无法成为故障转移的目标，则代理会自动将快速启动故障转移目标更改为其他候选目标之一。
                  </p>
                  <p>您可以使用任何具有快速启动故障转移的保护模式。最大保护和最大可用性模式提供自动故障转移环境，保证不会丢失任何数据。最高性能模式提供自动故障转移环境，保证不会丢失不超过<code class="codeph">FastStartFailoverLagLimit</code>配置属性指定的数据量（以秒为单位）。此属性指示允许自动故障转移发生的最大数据丢失量。仅在启用快速启动故障切换且配置在最高性能模式下运行时使用。
                  </p>
                  <p>启用快速启动故障切换后，代理将确保只有在可以维护配置的数据丢失保证时才能实现快速启动故障切换。如果无法维护配置的数据丢失保证，则主数据库上的重做生成将停止。在最大可用性和最大性能模式中，为了避免长时间停顿，观察者或目标备用数据库可能允许主数据库在首次记录之后继续重做生成，从而无法进行快速启动故障转移。</p>
                  <p>在最大可用性模式下，一旦目标备用数据库收到所有缺少的重做数据，就会恢复自动故障转移的能力。在最高性能模式和最大可用性模式下，一旦目标备用数据库的重做应用点不再滞后主数据库的重做生成点超过<code class="codeph">FastStartFailoverLagLimit</code>配置属性指定的值，就会恢复自动故障转移的能力。在最大保护模式下，始终可以自动进行故障转移，因为代理在重新获得与目标备用数据库的连接之前不允许主数据库提交事务。因此，目标备用数据库永远不会落后于主数据库（因为它可能在最大可用性和最高性能模式下）。
                  </p>
                  <p>下表总结了启用快速启动故障切换时，哪些保护模式支持哪些备用类型。（快照备用数据库不包含在表中，因为它们不支持作为快速启动故障转移目标。）</p>
                  <div class="tblformal" id="GUID-995CED84-BEA1-4675-9C68-B37CB996924F__GUID-2C5423FB-E23E-4B9F-B68C-D76779DF0457">
                     <table cellpadding="4" cellspacing="0" class="Formal" title="" border="1" summary="This table describes which standby types are supported in which protection modes when fast-start failover is enabled" frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="20%" id="d12681e2013">保护模式</th>
                              <th align="left" valign="bottom" width="20%" id="d12681e2015">物理备用支持？</th>
                              <th align="left" valign="bottom" width="20%" id="d12681e2017">支持逻辑备用数据库？</th>
                              <th align="left" valign="bottom" width="20%" id="d12681e2019">支持发送重做的远程同步实例？</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d12681e2023" headers="d12681e2013 ">最大保护</td>
                              <td align="left" valign="top" width="20%" headers="d12681e2023 d12681e2015 ">是</td>
                              <td align="left" valign="top" width="20%" headers="d12681e2023 d12681e2017 ">没有</td>
                              <td align="left" valign="top" width="20%" headers="d12681e2023 d12681e2019 ">没有</td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d12681e2032" headers="d12681e2013 ">最高可用性</td>
                              <td align="left" valign="top" width="20%" headers="d12681e2032 d12681e2015 ">是</td>
                              <td align="left" valign="top" width="20%" headers="d12681e2032 d12681e2017 ">是</td>
                              <td align="left" valign="top" width="20%" headers="d12681e2032 d12681e2019 ">是</td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d12681e2041" headers="d12681e2013 ">最高性能</td>
                              <td align="left" valign="top" width="20%" headers="d12681e2041 d12681e2015 ">是</td>
                              <td align="left" valign="top" width="20%" headers="d12681e2041 d12681e2017 ">是</td>
                              <td align="left" valign="top" width="20%" headers="d12681e2041 d12681e2019 ">没有</td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <p>如表中所示，当快速启动故障转移目标是从远程同步实例接收重做数据的逻辑或物理备用数据库时，可以在最大可用性模式下启用快速启动故障转移。这使您可以在为任何距离的零数据丢失保护设置的配置中利用代理的自动故障转移功能。请参阅<a href="examples-using-data-guard-broker-DGMGRL-utility.html#GUID-09A3230B-A2A2-449D-89E0-EDDBD76A157C" title="当快速启动故障转移目标是从远程同步实例接收重做数据的逻辑或物理备用数据库时，可以在最大可用性模式下启用快速启动故障转移。">方案7：使用远程同步实例时启用快速启动故障转移，以</a>获取有关如何进行此设置的示例。
                  </p>
                  <p>以下各节中的主题介绍了如何启用快速启动故障转移和监视快速启动故障转移环境的<strong class="term">观察者</strong>站点。观察者是独立的OCI客户端组件，它们在与主数据库和备用数据库不同的计算机上运行，并监视主数据库的可用性。管理观察者中更详细地描述<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-5E2A8696-38B4-4782-B8EF-95C0975CD7C6" title="观察器进程集成在代理的DGMGRL客户端组件中，通常在与主数据库或备用数据库不同的计算机上以及从您管理代理配置的计算机上运行。">了观察者</a> 。
                  </p>
                  <p>一旦观察者启动，就不需要进一步的用户交互。如果观察者和指定的备用数据库都失去与主数据库的连接的时间超过<code class="codeph">FastStartFailoverThreshold</code>配置属性指定的秒数，则观察者将启动到备用数据库的快速启动故障转移。此外，如果<code class="codeph">FastStartFailoverPmyShutdown</code>配置属性设置为<code class="codeph">TRUE</code> ，则主数据库将在超过<code class="codeph">FastStartFailoverThreshold</code>秒的时间段内感知到连接丢失时将关闭。故障转移完成后，如果<code class="codeph">FastStartFailoverAutoReinstate</code>配置属性设置为<code class="codeph">TRUE</code> ，则在重新建立与其的连接时，以前的主数据库将自动恢复为备用数据库。</p>
                  <div class="infoboxnote" id="GUID-995CED84-BEA1-4675-9C68-B37CB996924F__GUID-0C36AC29-9EF1-4232-8C70-0902FD50F330">
                     <p class="notep1">注意：</p>
                     <p>由于检测到用户可配置的快速启动故障切换条件或应用程序通过调用<code class="codeph">DBMS_DG.INITIATE_FS_FAILOVER</code>函数启动快速启动故障切换而发生快速启动故障切换时，以前的主数据库始终处于关闭状态且永远不会自动恢复。无论<code class="codeph">FastStartFailoverPmyShutdown</code>和<code class="codeph">FastStartFailoverAutoReinstate</code>配置属性的设置如何，都是如此。有关更多信息，请参阅<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D26D79F2-0093-4C0E-98CD-224A5C8CBFA4" title="您可以在连接到代理配置中的任何数据库时从任何站点启用快速启动故障转移。">启用快速启动故障转移</a> 。
                     </p>
                  </div>
                  <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-995CED84-BEA1-4675-9C68-B37CB996924F__BCGIAIIF">图5-1</a>显示了快速启动故障转移期间主数据库，目标备用数据库和观察器之间的关系：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><span class="bold">在快速启动故障转移之前：</span> Oracle Data Guard在稳定状态下运行，主数据库将重做数据传输到目标备用数据库，监视器监视整个配置的状态。
                        </p>
                     </li>
                     <li>
                        <p><span class="bold">FastStart故障转移保证：</span>灾难袭击主数据库，并且它与观察者和目标备用数据库的网络连接都将丢失。在检测到通信中断后，观察者会尝试在启动快速启动故障转移之前，与主数据库重新建立与<code class="codeph">FastStartFailoverThreshold</code>属性定义的时间量的连接。如果观察者无法在指定时间内重新获得与主数据库的连接，并且目标备用数据库已准备好进行快速启动故障转移，则会发生快速启动故障转移。
                        </p>
                     </li>
                     <li>
                        <p><span class="bold">快速启动故障转移后：</span>快速启动故障转移已完成，目标备用数据库正在主数据库角色中运行。在修复了以前的主数据库之后，观察者重新建立与该数据库的连接并将其恢复为新的备用数据库。新的主数据库开始将重做数据传输到新的备用数据库。
                        </p>
                     </li>
                  </ul>
                  <div class="figure" id="GUID-995CED84-BEA1-4675-9C68-B37CB996924F__BCGIAIIF">
                     <p class="titleinfigure">图5-1主数据库和备用数据库与观察者的关系</p><img src="img/dgbkr004.gif" alt="下面是图5-1的描述" title="下面是图5-1的描述" longdesc="img_text/dgbkr004.html"><br><a href="img_text/dgbkr004.html">“图5-1主数据库和备用数据库与观察者的关系”的说明</a></div>
                  <!-- class="figure" -->
                  <p>以下部分描述了这些主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-7EAF1865-2F92-4451-8565-D3C6EC4F8005" title="在代理允许您启用快速启动故障转移之前，必须满足一些先决条件。">启用快速启动故障转移的先决条件</a></p>
                     </li>
                     <li>
                        <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D26D79F2-0093-4C0E-98CD-224A5C8CBFA4" title="您可以在连接到代理配置中的任何数据库时从任何站点启用快速启动故障转移。">启用快速启动故障转移</a></p>
                     </li>
                     <li>
                        <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-47C45F0E-ABFA-40D7-83E8-5CCCEED524E5" title="要验证观察器是否已启动且配置是否已准备好进行快速启动故障转移，您可以发出DGMGRL SHOW DATABASE &lt;target-standby-database&gt;命令。">查看快速启动故障转移配置统计信息和状态</a></p>
                     </li>
                     <li>
                        <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-67878B37-39B5-402A-A219-69E7483405A1" title="禁用快速启动故障转移可防止观察者启动到目标备用数据库的故障转移。">禁用快速启动故障转移</a></p>
                     </li>
                     <li>
                        <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D2166F5B-9347-46AB-B291-D008C7D95B3A" title="此列表包含一些建议，以便在使用快速启动故障转移时获得更好的性能。">快速启动故障转移的性能注意事项</a></p>
                     </li>
                     <li>
                        <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-5E2A8696-38B4-4782-B8EF-95C0975CD7C6" title="观察器进程集成在代理的DGMGRL客户端组件中，通常在与主数据库或备用数据库不同的计算机上以及从您管理代理配置的计算机上运行。">管理观察者</a></p>
                     </li>
                     <li>
                        <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-319C443F-4386-49B1-A0FC-9C4166D061CA" title="还原可以恢复代理配置的高可用性，以便在新主数据库发生故障时，可以进行另一次快速启动故障转移。">在Broker配置中恢复前主数据库</a></p>
                     </li>
                     <li>
                        <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-350624B9-ABAD-4894-89AE-7431D52D3818" title="如有必要，可以在快速启动故障转移环境中关闭主数据库或目标备用数据库。">在快速启动故障转移环境中关闭数据库</a></p>
                     </li>
                  </ul>
               </div><a id="DGBKR391"></a><div class="props_rev_3"><a id="GUID-7EAF1865-2F92-4451-8565-D3C6EC4F8005" name="GUID-7EAF1865-2F92-4451-8565-D3C6EC4F8005"></a><h4 id="DGBKR-GUID-7EAF1865-2F92-4451-8565-D3C6EC4F8005" class="sect4"><span class="enumeration_section">5.5.1</span>启用快速启动故障转移的先决条件</h4>
                  <div>
                     <p>在代理允许您启用快速启动故障转移之前，必须满足一些先决条件。</p>
                     <p>先决条件如下：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>配置保护模式。请参阅<a href="managing-oracle-data-guard-broker-configuration-members.html#GUID-A938EA13-B128-4D54-8A99-6871D93F01CE" title="以下是为配置设置保护模式的步骤。">为配置设置保护模式</a> 。
                           </p>
                        </li>
                        <li>
                           <p>将成为快速启动故障转移目标的所选备用数据库必须直接从主数据库接收重做。</p>
                        </li>
                        <li>
                           <div class="p">确保您选择作为快速启动故障转移目标的备用数据库的<code class="codeph">LogXptMode</code>属性设置如下，具体取决于保护模式：<ul style="list-style-type:disc">
                                 <li>
                                    <p>最大保护 - <code class="codeph">SYNC</code></p>
                                 </li>
                                 <li>
                                    <p>最大可用性 - <code class="codeph">SYNC</code>或<code class="codeph">FASTSYNC</code></p>
                                 </li>
                                 <li>
                                    <p>最高性能 - <code class="codeph">ASYNC</code></p>
                                 </li>
                              </ul> 
                           </div>
                           <p>当前主数据库必须<code class="codeph">LogXptMode</code>设置其<code class="codeph">LogXptMode</code>属性，并且必须配置备用重做日志。或者，使用<code class="codeph">RedoRoutes</code>属性为目标备用数据库和当前处于主要角色的数据库配置重做传输模式。
                           </p>
                        </li>
                        <li>
                           <p>要将远程同步实例与快速启动故障转移一起使用，必须将远程同步实例传输模式设置为<code class="codeph">SYNC</code>或<code class="codeph">FASTSYNC</code>并且必须将目标备用数据库传输模式设置为<code class="codeph">ASYNC</code> 。远程同步实例不能用于最大保护模式或最高性能模式。
                           </p>
                        </li>
                        <li>
                           <p>如<a href="oracle-data-guard-broker-installation-requirements.html#GUID-DBCAC77D-8B4D-4727-B89E-6CFA69302187" title="Oracle Data Guard包含在Oracle数据库软件的企业版和个人版中。">Oracle Data Guard安装中</a>所述，在观察器计算机上安装DGMGRL命令行界面。
                           </p>
                        </li>
                        <li>
                           <p>在观察器系统上配置<code class="codeph">TNSNAMES.ORA</code>文件，以便观察者能够连接到主数据库和预先选择的目标备用数据库。
                           </p>
                        </li>
                        <li>
                           <p>如果您未使用Oracle Clusterware或Oracle Restart，则必须创建静态服务名称，以便观察者可以在恢复时自动重新启动数据库。使用<code class="codeph">VALIDATE STATIC CONNECT IDENTIFIER</code>命令确保已正确配置静态服务。有关更多信息，请参阅<a href="oracle-data-guard-broker-installation-requirements.html#GUID-BFDA8675-DA97-4910-B3FF-5DD5CFF5CC6D" title="这些是您在使用代理之前必须满足的条件。">先决条件</a> 。
                           </p>
                        </li>
                     </ul>
                  </div>
               </div><a id="DGBKR392"></a><div class="props_rev_3"><a id="GUID-D26D79F2-0093-4C0E-98CD-224A5C8CBFA4" name="GUID-D26D79F2-0093-4C0E-98CD-224A5C8CBFA4"></a><h4 id="DGBKR-GUID-D26D79F2-0093-4C0E-98CD-224A5C8CBFA4" class="sect4"><span class="enumeration_section">5.5.2</span>启用快速启动故障转移</h4>
                  <div>
                     <p>您可以在连接到代理配置中的任何数据库时从任何站点启用快速启动故障转移。</p>
                     <p>启用快速启动故障转移不会触发故障转移。相反，它允许监视配置的观察者在数据库条件允许故障转移时启动快速启动故障转移。（如果存在其他条件，对应用程序而言是唯一的，可以保证快速启动故障转移，则可以将应用程序设置为调用<code class="codeph">DBMS_DG.INITIATE_FS_FAILOVER</code>函数，并在发生任何这些条件时立即启动快速启动故障转移。请参阅<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-C98DB3F7-2894-4855-9BBD-E3593E59383C" title="您可以使用DBMS_DG PL / SQL程序包为特定应用程序自定义快速启动故障转移设置。">从应用程序指导快速启动故障转移</a> ）</p>
                     <p>启用快速启动故障转移和启动观察器进程涉及以下任务。这些任务假定您以<code class="codeph">SYS</code>或<code class="codeph">SYSDG</code>连接，并且已在代理配置中设置主数据库和备用数据库。
                     </p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-559CC392-EE89-4C57-87F8-14BFDAEA896C" title="您必须确定哪些可用的备用数据库应成为故障转移的目标。">启用快速启动故障转移任务1：确定哪些可用备用数据库是故障转移的最佳目标</a></p>
                        </li>
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-ACD0E8F5-EA59-4823-8694-1538A8064C75" title="使用当前主数据库上的FastStartFailoverTarget配置属性指定一个或多个快速启动故障转移目标。">启用快速启动故障转移任务2：使用FastStartFailoverTarget配置属性指定目标备用数据库</a></p>
                        </li>
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-94C97FD2-54E3-4DEE-8EF4-0631CE3A3C65" title="如果您无法容忍任何数据丢失，请确保将配置保护模式设置为最大可用性或最大保护。对于最大可用性模式下的零数据丢失，必须将FastStartFailoverLagLimit属性设置为零。">启用快速启动故障转移任务3：确定所需的保护模式</a></p>
                        </li>
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-68161F2B-991E-47B6-8D52-9651248A8162" title="如果观察者和目标备用数据库在FastStartFailoverThreshold配置属性指定的时间段内失去与主数据库的连接，则会发生快速启动故障转移。">启用快速启动故障转移任务4：设置FastStartFailoverThreshold配置属性</a></p>
                        </li>
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-76F11A61-6A47-4DCA-BFF9-7CD800604290" title="此表描述了可以设置的可选数据库属性。">启用快速启动故障转移任务5：设置与快速启动故障转移相关的其他属性（可选）</a></p>
                        </li>
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-173419E6-3EDF-4580-B339-B687FE37AB56" title="默认情况下，在经过配置的时间阈值（FastStartFailoverThreshold）后，观察者和备用数据库都无法到达主数据库时，将完成快速启动故障转移。">启用快速启动故障转移任务6：启用其他快速启动故障转移条件（可选）</a></p>
                        </li>
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-A9033D52-EB52-4C33-AB4A-4AEC4AC8C1B9" title="使用Cloud Control快速启动故障转移向导或DGMGRL ENABLE FAST_START FAILOVER命令启用快速启动故障转移。">启用快速启动故障转移任务7：使用DGMGRL或云控制</a></p>
                        </li>
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-2D75365F-E3D1-4229-B55B-C58DA9EBFBE9" title="必须运行主数据库才能启动观察者。">启用快速启动故障转移任务8：启动Observer</a></p>
                        </li>
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-BA6A87D4-26A1-4CAA-9B71-E91728B21355" title="要验证快速启动故障转移配置的准备情况，请在主数据库上发出DGMGRL SHOW CONFIGURATION VERBOSE命令或SHOW FAST_START FAILOVER命令。">启用快速启动故障转移任务9：验证快速启动故障转移环境</a></p>
                        </li>
                     </ul>
                  </div>
                  <div class="props_rev_3"><a id="GUID-559CC392-EE89-4C57-87F8-14BFDAEA896C" name="GUID-559CC392-EE89-4C57-87F8-14BFDAEA896C"></a><h5 id="DGBKR-GUID-559CC392-EE89-4C57-87F8-14BFDAEA896C" class="sect5"><span class="enumeration_section">5.5.2.1</span>启用快速启动故障转移任务1：确定哪些可用的备用数据库应该用于故障转移</h5>
                     <div>
                        <p>您必须确定哪些可用的备用数据库应成为故障转移的目标。</p>
                        <div class="section">
                           <p>请遵循<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-2AEF86C4-3CFA-4CF5-AEF3-E25871298363" title="在切换或故障转移后选择备用数据库作为下一个主数据库时，需要考虑几个因素。">选择目标备用数据库中</a>描述的准则。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-ACD0E8F5-EA59-4823-8694-1538A8064C75" name="GUID-ACD0E8F5-EA59-4823-8694-1538A8064C75"></a><h5 id="DGBKR-GUID-ACD0E8F5-EA59-4823-8694-1538A8064C75" class="sect5"><span class="enumeration_section">5.5.2.2</span>启用快速启动故障转移任务2：使用FastStartFailoverTarget配置属性指定目标备用数据库</h5>
                     <div>
                        <p>使用当前主数据库上的<code class="codeph">FastStartFailoverTarget</code>配置属性指定一个或多个快速启动故障转移目标。
                        </p>
                        <div class="section">
                           <p>代理根据属性中指定的顺序选择目标备用数据库。</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>如果配置中只有一个备用数据库，则可以跳过此步骤并继续执行任务3。</p>
                              </li>
                              <li>
                                 <p>如果配置中有多个备用数据库，则必须在主数据库上显式设置<code class="codeph">FastStartFailoverTarget</code>属性以命名一个或多个候选目标备用数据库。启用快速启动故障转移时，代理会验证该属性是否指示现有备用数据库。（请注意，目标备用数据库不能是远程同步实例。但是，目标可以从远程同步实例接收重做。）
                                 </p>
                                 <div class="infoboxnote" id="GUID-ACD0E8F5-EA59-4823-8694-1538A8064C75__GUID-63B8586B-CBCC-4F47-BFF9-9DE942AE6C00">
                                    <p class="notep1">注意：</p>
                                    <p>要将<code class="codeph">FastStartFailoverTarget</code>属性更改为指向其他备用数据库，请禁用快速启动故障转移，设置<code class="codeph">FastStartFailoverTarget</code>属性，然后重新启用快速启动故障转移。
                                    </p>
                                 </div>
                              </li>
                           </ul>
                           <p>有关此属性的更多信息，请参见<a href="oracle-data-guard-broker-properties.html#GUID-63108DF8-4DAD-40F1-88B1-458C3FCB6C84" title="FastStartFailoverTarget配置属性指定一个或多个备用数据库的DB_UNIQUE_NAME，当设置了该属性的数据库是主数据库时，该数据库可以在快速启动故障转移情况下充当目标数据库。">FastStartFailoverTarget</a> 。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-94C97FD2-54E3-4DEE-8EF4-0631CE3A3C65" name="GUID-94C97FD2-54E3-4DEE-8EF4-0631CE3A3C65"></a><h5 id="DGBKR-GUID-94C97FD2-54E3-4DEE-8EF4-0631CE3A3C65" class="sect5"><span class="enumeration_section">5.5.2.3</span>启用快速启动故障转移任务3：确定所需的保护模式</h5>
                     <div>
                        <p>如果您无法容忍任何数据丢失，请确保将配置保护模式设置为最大可用性或最大保护。对于最大可用性模式下的零数据丢失，必须将<code class="codeph">FastStartFailoverLagLimit</code>属性设置为零。
                        </p>
                        <div class="section">
                           <p>在最大可用性模式下，将主备用数据库和目标备用数据库的<code class="codeph">LogXptMode</code>数据库属性设置为<code class="codeph">SYNC</code>或<code class="codeph">FASTSYNC</code> 。在最大保护模式下，将<code class="codeph">LogXptMode</code>数据库属性设置为<code class="codeph">SYNC</code> （请注意，在最大保护模式下，远程同步实例不能用于将重做发送到备用数据库）。以下是设置<code class="codeph">LogXptMode</code>属性的示例：</p><pre class="oac_no_warn" dir="ltr">DGMGRL&gt; EDIT DATABASE'North_Sales'Set PROPERTY LogXptMode = SYNC; DGMGRL&gt;编辑数据库'South_Sales'Set PROPERTY LogXptMode = SYNC; DGMGRL&gt;编辑配置设置保护模式为MaxAvailability;</pre><p>或者，使用<code class="codeph">RedoRoutes</code>属性为目标备用数据库和当前处于主要角色的数据库设置重做传输模式。然后将配置保护模式设置为最大可用性。
                           </p>
                           <p>如果您更关心主数据库的性能而不是最小的数据丢失，请考虑在配置保护模式设置为最高性能时启用快速启动故障转移。在此模式下，您需要考虑以秒为单位可接受的数据丢失量，并相应地设置<code class="codeph">FastStartFailoverLagLimit</code>配置属性。此属性指定目标备用数据库在重做应用方面可能落后于主数据库的数据量（以秒为单位）。如果备用数据库的重做应用点位于主数据库重做生成点的许多秒内，则将允许快速启动故障转移。<code class="codeph">FastStartFailoverLagLimit</code>配置属性仅在为在最高性能模式下运行的配置启用快速启动故障转移时由代理使用。默认值为30秒，最低可能值为5秒。
                           </p>
                           <p>除了将配置保护模式设置为最高性能之外，还需要确保将<code class="codeph">LogXptMode</code>数据库和目标备用数据库的<code class="codeph">LogXptMode</code>数据库属性设置为<code class="codeph">ASYNC</code> 。例如：</p><pre class="oac_no_warn" dir="ltr">DGMGRL&gt; EDIT DATABASE'North_Sales'Set PROPERTY LogXptMode = ASYNC; DGMGRL&gt;编辑数据库'South_Sales'Set PROPERTY LogXptMode = ASYNC; DGMGRL&gt;编辑配置设置保护模式为MaxPerformance; DGMGRL&gt; EDIT CONFIGURATION SET PROPERTY FastStartFailoverLagLimit = 45;</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-68161F2B-991E-47B6-8D52-9651248A8162" name="GUID-68161F2B-991E-47B6-8D52-9651248A8162"></a><h5 id="DGBKR-GUID-68161F2B-991E-47B6-8D52-9651248A8162" class="sect5"><span class="enumeration_section">5.5.2.4</span>启用快速启动故障转移任务4：设置FastStartFailoverThreshold配置属性</h5>
                     <div>
                        <p>如果观察者和目标备用数据库在<code class="codeph">FastStartFailoverThreshold</code>配置属性指定的时间段内失去与主数据库的连接，则会发生快速启动故障转移。
                        </p>
                        <div class="section">
                           <p>设置<a id="d12681e2655" class="indexterm-anchor"></a><a id="d12681e2659" class="indexterm-anchor"></a><a id="d12681e2663" class="indexterm-anchor"></a> <code class="codeph">FastStartFailoverThreshold</code>属性，用于指定在启动故障转移之前，观察者和目标备用数据库要等待的秒数（在检测到主数据库不可用之后）。例如：</p><pre class="oac_no_warn" dir="ltr">DGMGRL&gt; EDIT CONFIGURATION SET PROPERTY FastStartFailoverThreshold = 45;</pre><p><code class="codeph">FastStartFailoverThreshold</code>属性的默认值为30秒，最低可能值为6秒。如果您有Oracle RAC主数据库，请考虑指定更高的值，以最大程度地降低在实例发生故障时发生错误故障转移的可能性。
                           </p>
                           <p>当观察者首次失去与主数据库的连接时，时间间隔开始。如果观察者无法在指定时间内重新获得与主数据库的连接，则观察者将开始快速启动故障转移，前提是备用数据库已准备好进行故障转移。虽然默认值30秒通常足以检测大多数配置的中断和故障，但您可以使用此属性调整故障转移灵敏度，以降低在临时不稳定环境中发生虚假故障转移的可能性。</p>
                           <p>如果<code class="codeph">FastStartFailoverPmyShutdown</code>配置属性设置为<code class="codeph">TRUE</code> ，则如果重做生成已停止并且主数据库无法重新建立与观察者或目标备用数据库的连接，则在<code class="codeph">FastStartFailoverThreshold</code>秒后，主数据库将关闭。
                           </p>
                           <p>请注意，即使启用了快速启动故障转移，也可以更改<code class="codeph">FastStartFailoverThreshold</code>属性。
                           </p>
                           <div class="infoboxnotealso" id="GUID-68161F2B-991E-47B6-8D52-9651248A8162__GUID-82EDCFCF-D321-44E8-ADE7-704975472A27">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="oracle-data-guard-broker-properties.html#GUID-B61FE085-699E-4C00-BF09-794D42161C8F" title="FastStartFailoverThreshold配置属性定义主观察器在启动快速启动故障转移之前尝试重新连接到主数据库的秒数。">FastStartFailoverThreshold，</a>用于有关<code class="codeph">FastStartFailoverThreshold</code>属性的参考信息</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-76F11A61-6A47-4DCA-BFF9-7CD800604290" name="GUID-76F11A61-6A47-4DCA-BFF9-7CD800604290"></a><h5 id="DGBKR-GUID-76F11A61-6A47-4DCA-BFF9-7CD800604290" class="sect5"><span class="enumeration_section">5.5.2.5</span>启用快速启动故障切换任务5：设置与快速启动故障切换相关的其他属性（可选）</h5>
                     <div>
                        <p>此表描述了可以设置的可选数据库属性。</p>
                        <div class="section">
                           <div class="tblformal" id="GUID-76F11A61-6A47-4DCA-BFF9-7CD800604290__GUID-9224833B-ADC1-4217-B4B6-CAE12DB5F941">
                              <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="This 3 column table shows the properties that can be optionally set to tune fast-start failover. Column 1 is the property name. Column 2 is a description of that property. Column 3 is the default value for that property. " frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="38%" id="d12681e2742">物业名称</th>
                                       <th align="left" valign="bottom" width="47%" id="d12681e2745">描述</th>
                                       <th align="left" valign="bottom" width="15%" id="d12681e2748">默认值</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d12681e2753" headers="d12681e2742 ">
                                          <p><code class="codeph">FastStartFailoverPmyShutdown</code></p>
                                       </td>
                                       <td align="left" valign="top" width="47%" headers="d12681e2753 d12681e2745 ">
                                          <p>如果启用了快速启动故障切换，并且<code class="codeph">V$DATABASE.FS_FAILOVER_STATUS</code>指示主<code class="codeph">STALLED</code>已经<code class="codeph">STALLED</code>超过<code class="codeph">FastStartFailoverThreshold</code>秒，则此配置属性会导致主数据库关闭。值<code class="codeph">TRUE</code>有助于确保隔离的主数据库无法满足用户查询。
                                          </p>
                                          <p>如果由于检测到用户配置条件或应用程序通过调用<code class="codeph">DBMS_DG.INITIATE_FS_FAILOVER</code>函数请求了用户配置条件，则此属性不能用于防止主数据库在发生快速启动故障转移时关闭。
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="15%" headers="d12681e2753 d12681e2748 ">
                                          <p><code class="codeph">真正</code></p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d12681e2782" headers="d12681e2742 ">
                                          <p><code class="codeph">FastStartFailoverLagLimit</code></p>
                                       </td>
                                       <td align="left" valign="top" width="47%" headers="d12681e2782 d12681e2745 ">
                                          <p>此配置属性建立了一个可接受的限制（以秒为单位），在应用重做时允许备用数据库落后于主数据库，超过此限制将不允许快速启动故障转移。最低可能值为5秒。</p>
                                          <p></p>
                                       </td>
                                       <td align="left" valign="top" width="15%" headers="d12681e2782 d12681e2748 ">
                                          <p>30秒</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d12681e2794" headers="d12681e2742 ">
                                          <p><code class="codeph">FastStartFailoverAutoReinstate</code></p>
                                       </td>
                                       <td align="left" valign="top" width="47%" headers="d12681e2794 d12681e2745 ">
                                          <p>如果由于主数据库已隔离或已崩溃而启动了快速启动故障转移，则此配置属性会导致自动恢复以前的主数据库。要防止在这些情况下自动恢复以前的主数据库，请将此配置属性设置为<code class="codeph">FALSE</code> 。如果由于检测到用户配置条件或由调用<code class="codeph">DBMS_DG.INITIATE_FS_FAILOVER</code>函数的应用程序请求启动快速启动故障转移，则代理永远不会自动恢复以前的主数据库。
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="15%" headers="d12681e2794 d12681e2748 ">
                                          <p><code class="codeph">真正</code></p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d12681e2812" headers="d12681e2742 ">
                                          <p><code class="codeph">ObserverConnectIdentifier</code></p>
                                       </td>
                                       <td align="left" valign="top" width="47%" headers="d12681e2812 d12681e2745 ">
                                          <p>此数据库属性用于指定观察者应如何连接和监视主数据库和备用数据库。如果希望观察者使用与用于发送重做数据的连接标识符不同的连接标识符（即<code class="codeph">DGConnectIdentifier</code>属性指定的连接标识符），请为主数据库和目标备用数据库设置此属性。
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="15%" headers="d12681e2812 d12681e2748 ">
                                          <p>Observer使用<code class="codeph">DGConnectIdentifier</code>属性的值连接并监视主数据库和目标备用数据库。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d12681e2829" headers="d12681e2742 ">
                                          <p><code class="codeph">ObserverOverride</code></p>
                                       </td>
                                       <td align="left" valign="top" width="47%" headers="d12681e2829 d12681e2745 ">
                                          <p><code class="codeph">ObserverOverride</code>配置属性设置为<code class="codeph">TRUE</code> ，允许在观察者失去与主服务器的连接时进行自动故障转移，即使备用服务器与主服务器具有健康的连接也是如此。
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="15%" headers="d12681e2829 d12681e2748 ">
                                          <p><code class="codeph">假</code></p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d12681e2847" headers="d12681e2742 ">
                                          <p><code class="codeph">ObserverReconnect</code></p>
                                       </td>
                                       <td align="left" valign="top" width="47%" headers="d12681e2847 d12681e2745 ">
                                          <p><code class="codeph">ObserverReconnect</code>配置属性指定观察者建立与主数据库的新连接的频率。当此属性设置为默认值0时，它会阻止观察者定期与主数据库建立新连接。虽然这消除了与定期建立与主数据库的新观察者连接相关联的处理开销，但它也阻止观察者检测到不可能创建到主数据库的新连接。Oracle建议将此属性设置为足够小的值，以便及时检测主数据库中的故障，但大到足以将与定期观察者连接相关的开销限制在可接受的级别。
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="15%" headers="d12681e2847 d12681e2748 ">
                                          <p>0（零）</p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-173419E6-3EDF-4580-B339-B687FE37AB56" name="GUID-173419E6-3EDF-4580-B339-B687FE37AB56"></a><h5 id="DGBKR-GUID-173419E6-3EDF-4580-B339-B687FE37AB56" class="sect5"><span class="enumeration_section">5.5.2.6</span>启用快速启动故障切换任务6：启用其他快速启动故障切换条件（可选）</h5>
                     <div>
                        <p>默认情况下，在经过配置的时间阈值（ <code class="codeph">FastStartFailoverThreshold</code> ）后，观察者和备用数据库都无法到达主数据库时，将完成快速启动故障转移。
                        </p>
                        <div class="section">
                           <p>您可以选择指示应导致快速启动故障转移的数据库运行状况。这些条件如下表所述：</p>
                           <div class="tblformal" id="GUID-173419E6-3EDF-4580-B339-B687FE37AB56__GUID-2D3C1F39-3FE8-4DD0-A055-9C1263752EDD">
                              <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="This 2 column table describes the health conditions for FSFO. Column 1 is the health condition. Column 2 is a description of that condition. Column 3 indicates if it is enabled by default. " frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="25%" id="d12681e2896">健康状况</th>
                                       <th align="left" valign="bottom" width="60%" id="d12681e2899">描述</th>
                                       <th align="left" valign="bottom" width="16%" id="d12681e2902">默认启用</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d12681e2907" headers="d12681e2896 ">数据文件写入错误</td>
                                       <td align="left" valign="top" width="60%" headers="d12681e2907 d12681e2899 ">如果启用了快速启动故障切换并且指定了“数据文件写入错误”条件，则在任何数据文件（包括临时文件，系统数据文件和撤消文件）中遇到写入错误时，将启动快速启动故障切换。</td>
                                       <td align="left" valign="top" width="16%" headers="d12681e2907 d12681e2902 ">是</td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d12681e2914" headers="d12681e2896 ">
                                          <p>腐败的字典</p>
                                       </td>
                                       <td align="left" valign="top" width="60%" headers="d12681e2914 d12681e2899 ">
                                          <p>关键数据库的字典损坏。目前，只有在数据库打开时才能检测到此状态</p>
                                       </td>
                                       <td align="left" valign="top" width="16%" headers="d12681e2914 d12681e2902 ">
                                          <p>是</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d12681e2924" headers="d12681e2896 ">
                                          <p>损坏的控制文件</p>
                                       </td>
                                       <td align="left" valign="top" width="60%" headers="d12681e2924 d12681e2899 ">
                                          <p>由于磁盘故障，Controlfile永久损坏。</p>
                                       </td>
                                       <td align="left" valign="top" width="16%" headers="d12681e2924 d12681e2902 ">
                                          <p>是</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d12681e2934" headers="d12681e2896 ">
                                          <p>无法访问的日志文件</p>
                                       </td>
                                       <td align="left" valign="top" width="60%" headers="d12681e2934 d12681e2899 ">
                                          <p>由于I / O错误，LGWR无法写入日志组的任何成员</p>
                                       </td>
                                       <td align="left" valign="top" width="16%" headers="d12681e2934 d12681e2902 ">
                                          <p>没有</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d12681e2944" headers="d12681e2896 ">
                                          <p>Stuck Archiver</p>
                                       </td>
                                       <td align="left" valign="top" width="60%" headers="d12681e2944 d12681e2899 ">
                                          <p>Archiver无法归档重做日志，因为设备已满或不可用。</p>
                                       </td>
                                       <td align="left" valign="top" width="16%" headers="d12681e2944 d12681e2902 ">
                                          <p>没有</p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p>在Oracle RAC配置中，Inaccessible Logfile和Stuck Archiver运行状况可能仅适用于单个实例。在为这些条件中的任何一个启用快速启动故障转移之前，应该仔细考虑，因为这样做将取代Oracle Clusterware提供的可用性选项。</p>
                           <p>您可以使用Cloud Control或DGMGRL <code class="codeph">ENABLE FAST_START FAILOVER CONDITION</code>和<code class="codeph">DISABLE FAST_START FAILOVER CONDITION</code>命令指定应进行快速启动故障转移的特定条件。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-A9033D52-EB52-4C33-AB4A-4AEC4AC8C1B9" name="GUID-A9033D52-EB52-4C33-AB4A-4AEC4AC8C1B9"></a><h5 id="DGBKR-GUID-A9033D52-EB52-4C33-AB4A-4AEC4AC8C1B9" class="sect5"><span class="enumeration_section">5.5.2.7</span>启用快速启动故障转移任务7：使用DGMGRL或云控制</h5>
                     <div>
                        <p>使用Cloud Control快速启动故障转移向导或DGMGRL <code class="codeph">ENABLE FAST_START FAILOVER</code>命令启用快速启动故障转移。
                        </p>
                        <div class="section">
                           <p>要启用快速启动故障转移，主数据库和目标备用数据库都必须正在运行并具有连接性，并且满足<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-7EAF1865-2F92-4451-8565-D3C6EC4F8005" title="在代理允许您启用快速启动故障转移之前，必须满足一些先决条件。">启用快速启动故障转移</a>的先决条件中列出的所有先决条件。
                           </p>
                           <div class="infoboxnote" id="GUID-A9033D52-EB52-4C33-AB4A-4AEC4AC8C1B9__GUID-55EC2CAA-8D74-4CFF-97C0-BE30B1D912AA">
                              <p class="notep1">注意：</p>Cloud Control快速启动故障转移向导当前不支持多个目标的规范。如果要指定多个目标，则必须使用DGMGRL实用程序。
                           </div>
                           <p><span class="bold">使用云控制启用快速启动故障转移</span></p>
                           <p>要在Cloud Control中启用快速启动故障转移，请使用快速启动故障转移向导。在“快速启动故障转移状态”字段旁边的“Oracle Data Guard概述”页上，单击“ <span class="bold">已禁用”</span>以调用“快速启动故障转移”页面。然后，在“快速启动故障转移更改模式”页上，单击“已<span class="bold">启用”</span> 。Cloud Control将启动观察者。然后，在“快速启动故障转移配置”页面上，选择应成为故障转移目标的备用数据库。请参阅<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-2AEF86C4-3CFA-4CF5-AEF3-E25871298363" title="在切换或故障转移后选择备用数据库作为下一个主数据库时，需要考虑几个因素。">选择目标备用数据库</a>以获取有用的建议。此页面不允许您更改保护模式。相反，将根据当前保护模式启用快速启动故障转移。如果当前配置的模式是最大保护，则Cloud Control会将模式降级为最大可用性。
                           </p>
                           <p><span class="bold">使用DGMGRL启用快速启动故障转移</span></p>
                           <p>要使用DGMGRL启用快速启动故障转移，请在连接到代理配置中的任何数据库（包括观察器计算机）时发出<code class="codeph">ENABLE FAST_START FAILOVER</code>命令。例如：</p><pre class="oac_no_warn" dir="ltr">DGMGRL&gt; ENABLE FAST_START FAILOVER;启用。</pre><div class="infoboxnotealso" id="GUID-A9033D52-EB52-4C33-AB4A-4AEC4AC8C1B9__GUID-B1A4C7A2-AF7C-4DC6-9DDF-DB797FD1732D">
                              <p class="notep1">也可以看看：</p>
                              <p></p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="oracle-data-guard-broker-commands.html#GUID-A521B8A7-825D-429D-B6CA-E8DDAC02672B" title="ENABLE FAST_START FAILOVER命令使代理能够在丢失主数据库时故障转移到特定选择的备用数据库，而无需任何手动步骤。">启用FAST_START FAILOVER</a></p>
                                 </li>
                                 <li>
                                    <p><a href="examples-using-data-guard-broker-DGMGRL-utility.html#GUID-AAE5EA1A-53A2-4D8D-BF59-A2856B38C99D" title="您可以在连接到代理配置中的任何数据库时，从任何站点（包括观察站点）启用快速启动故障转移。">方案6：启用快速启动故障转移并启动观察器</a></p>
                                 </li>
                              </ul>
                           </div>
                           <div class="infoboxnote" id="GUID-A9033D52-EB52-4C33-AB4A-4AEC4AC8C1B9__GUID-80629102-1B63-4C8C-8F68-382F90E141A2">
                              <p class="notep1">注意：</p>
                              <p>目标备用站点的管理应该与主站点上的管理一样全面，因为备用数据库可能在不事先通知的情况下承担主要角色。两个站点的员工支持，硬件和软件，安全性（软件和站点），网络连接和带宽应相同。</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-2D75365F-E3D1-4229-B55B-C58DA9EBFBE9" name="GUID-2D75365F-E3D1-4229-B55B-C58DA9EBFBE9"></a><h5 id="DGBKR-GUID-2D75365F-E3D1-4229-B55B-C58DA9EBFBE9" class="sect5"><span class="enumeration_section">5.5.2.8</span>启用快速启动故障转移任务8：启动Observer</h5>
                     <div>
                        <p>必须运行主数据库才能启动观察者。</p>
                        <div class="section">
                           <p>您可以在启用快速启动故障转移之前或之后启动观察器。如果已启用快速启动故障转移，则观察器立即开始监视主数据库和目标备用数据库的状态和连接。如果尚未启用快速启动故障转移，则观察程序将等待，直到启用快速启动故障转移，然后开始监视。</p>
                           <p><span class="bold">使用云控制启动Observer</span></p>
                           <p>如果Cloud Control代理程序安装在观察器计算机上，则当您通过Cloud Control启用快速启动故障转移时，它会自动启动观察程序。如果代理程序不存在，则必须使用DGMGRL命令行界面的以下说明手动启动观察程序。</p>
                           <p><span class="bold">使用DGMGRL启动观察者</span></p>
                           <p>要使用DGMGRL启动观察者，请在观察者计算机上发出以下命令：</p><pre class="oac_no_warn" dir="ltr">DGMGRL&gt; START OBSERVER;</pre><p>观察者是在发出<code class="codeph">START OBSERVER</code>命令时创建的连续执行进程。因此，在您从另一个DGMGRL会话发出<code class="codeph">STOP OBSERVER</code>命令之前，观察器计算机上的命令行提示不会返回。要发出命令并与代理配置交互，您必须通过另一个DGMGRL客户端会话进行连接。
                           </p>
                           <p>单个Data Guard配置最多可以有三个观察者。一个是主观察者，其他人是备用观察者。</p>
                           <p><span class="bold">使用DGMGRL将观察者作为后台进程启动</span></p>
                           <p>要将观察者作为后台进程启动，请使用DGMGRL命令<code class="codeph">START OBSERVER IN BACKGROUND</code> 。如果成功提交此命令，则会向您返回观察器计算机上的命令行提示符，以便您可以继续发出命令并与代理程序配置进行交互。这是启动观察者的首选方法。
                           </p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>请参阅<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-11EF3897-8FCA-4A54-B63B-E8C1668AE21B" title="应在与主系统和备用系统分开的计算机系统上安装和运行观察器。">安装和启动Observer</a> 。
                                 </p>
                              </li>
                              <li>
                                 <p>请参阅<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-5E2A8696-38B4-4782-B8EF-95C0975CD7C6" title="观察器进程集成在代理的DGMGRL客户端组件中，通常在与主数据库或备用数据库不同的计算机上以及从您管理代理配置的计算机上运行。">管理观察者</a></p>
                              </li>
                              <li>
                                 <p>有关将observer作为前台进程启动的更多信息，请参阅<a href="oracle-data-guard-broker-commands.html#GUID-8AADB389-6E31-46D6-AB1C-4FBB8EB6C411" title="START OBSERVER命令在此主机（运行DGMGRL会话的位置）上启动快速启动故障转移观察器，如果此主机上没有为此配置运行的已注册观察器。">START OBSERVER</a>命令。
                                 </p>
                              </li>
                              <li>
                                 <p>有关将观察者作为后台进程启动的更多信息，请参阅<a href="oracle-data-guard-broker-commands.html#GUID-2545CEB9-6E76-4F35-8B43-AFED62A9766C" title="START OBSERVER IN BACKGROUND命令在此主机（运行此DGMGRL会话）上启动快速启动故障转移观察器作为后台进程。">START OBSERVER IN BACKGROUND</a> 。
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-BA6A87D4-26A1-4CAA-9B71-E91728B21355" name="GUID-BA6A87D4-26A1-4CAA-9B71-E91728B21355"></a><h5 id="DGBKR-GUID-BA6A87D4-26A1-4CAA-9B71-E91728B21355" class="sect5"><span class="enumeration_section">5.5.2.9</span>启用快速启动故障切换任务9：验证快速启动故障切换环境</h5>
                     <div>
                        <p>要验证快速启动故障转移配置的准备情况，请在主数据库上发出DGMGRL <code class="codeph">SHOW CONFIGURATION VERBOSE</code>命令或<code class="codeph">SHOW FAST_START FAILOVER</code>命令。
                        </p>
                        <div class="section">
                           <p></p>
                           <p>例如：</p><pre class="oac_no_warn" dir="ltr">DGMGRL&gt; SHOW FAST_START FAILOVER;快速启动故障转移：在零数据丢失模式保护模式下启用：MaxAvailability滞后限制：0秒阈值：180秒活动目标：South_Sales潜在目标：East_Sales，West_Sales East_Sales有效West_Sales有效观察者：observer.example.com关闭主要：TRUE Auto -reinstate：TRUE Observer重新连接:(无）观察者覆盖：FALSE可配置故障转移条件健康状况：损坏的控制文件是损坏的字典是无法访问的日志文件没有Stuck Archiver没有数据文件写入错误是Oracle错误条件:(无）</pre><p>以下部分提供有关快速启动故障转移环境的更多信息：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-824C3FEF-9D1D-4AA7-9C7A-DBDBADC77F47" title="启用快速启动故障转移并启动最多三个观察者后，将指定一个观察者作为主观察者，持续监视环境以确保主数据库可用。">启用快速启动故障转移并且观察器正在运行时</a></p>
                              </li>
                              <li>
                                 <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-3DAD4204-B8FB-425D-9D22-0602C62FA89A" title="此列表描述启用快速启动故障转移时的限制。">启用快速启动故障转移时的限制</a></p>
                              </li>
                              <li>
                                 <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-0F672CAD-FBDC-4F21-A96F-B5F08993C453" title="如果主数据库或备用数据库正常关闭，则不会触发快速启动故障转移。">启用快速启动故障转移时关闭主数据库</a></p>
                              </li>
                              <li>
                                 <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-0A81C376-FB77-4EB5-AF59-BD872A875FAE" title="如果启用了快速启动故障切换，则只要满足某些条件，您仍可以执行切换或手动故障切换。">启用快速启动故障转移时执行手动角色更改</a></p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="DGBKR3408"></a><div class="props_rev_3"><a id="GUID-824C3FEF-9D1D-4AA7-9C7A-DBDBADC77F47" name="GUID-824C3FEF-9D1D-4AA7-9C7A-DBDBADC77F47"></a><h5 id="DGBKR-GUID-824C3FEF-9D1D-4AA7-9C7A-DBDBADC77F47" class="sect5"><span class="enumeration_section">5.5.2.10</span>启用快速启动故障切换且观察器正在运行时</h5>
                     <div>
                        <p>启用快速启动故障转移并启动最多三个观察者后，将指定一个观察者作为主观察者，持续监视环境以确保主数据库可用。</p>
                        <p>本节列出了主观察器用于确定是否需要快速启动故障转移的步骤，然后在必要时执行一个步骤。</p>
                        <ol>
                           <li>
                              <p>监视环境以确保主数据库可用。</p>
                              <p>当主数据库崩溃或与观察者失去连接时，主观察者在尝试快速启动故障转移之前等待<code class="codeph">FastStartFailoverThreshold</code>配置属性指定的秒数，如下列情况：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>主数据库失去与观察者和目标备用数据库的连接</p>
                                 </li>
                                 <li>
                                    <p>我的失败</p>
                                    <p>如果是单实例主数据库（Oracle RAC或非Oracle RAC），或者Oracle RAC主数据库的所有实例都出现故障，则观察者会尝试快速启动故障转移。</p>
                                 </li>
                                 <li>
                                    <p><a id="d12681e3288" class="indexterm-anchor"></a><a id="d12681e3290" class="indexterm-anchor"></a><a id="d12681e3294" class="indexterm-anchor"></a><a id="d12681e3300" class="indexterm-anchor"></a>关机中止</p>
                                    <p>如果使用<code class="codeph">ABORT</code>选项关闭单实例主数据库（Oracle RAC或非Oracle RAC）或Oracle RAC主数据库的所有实例，则观察者会尝试快速启动故障转移。对于其他类型的数据库关闭（ <code class="codeph">NORMAL</code> ， <code class="codeph">IMMEDIATE</code> ， <code class="codeph">TRANSACTIONAL</code> ），不会尝试快速启动故障转移。
                                    </p>
                                 </li>
                              </ul>
                              <p>在以下情况下，主观察者永远不会等待阈值到期以执行快速启动故障转移：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>用户可配置的条件</p>
                                    <p>如果主观察者确定已检测到任何用户可配置的条件，则它会尝试快速启动故障转移。</p>
                                 </li>
                                 <li>
                                    <p>应用程序调用<code class="codeph">DBMS_DG.INITIATE_FS_FAILOVER</code></p>
                                    <p>如果应用程序已调用此函数并且它已收到<code class="codeph">SUCCESS</code>状态，则主观察器将尝试快速启动故障转移。
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>在<code class="codeph">FastStartFailoverThreshold</code>属性指定的时间内重新连接。
                              </p>
                              <p>如果主观察器检测到主数据库存在可用性问题，则它通常会尝试在<code class="codeph">FastStartFailoverThreshold</code>配置属性指定的时间内重新连接到主数据库。当观察者首次检测到主数据库可能出现故障时， <code class="codeph">FastStartFailoverThreshold</code>时间间隔开始。
                              </p>
                              <p>如果主观察器检测到用户可配置的条件已发生或者<code class="codeph">DBMS_DG.INITIATE_FS_FAILOVER</code>函数已请求快速启动故障转移，则忽略<code class="codeph">FastStartFailoverThreshold</code>属性指定的时间间隔。
                              </p>
                              <p>如果主数据库是Oracle <a id="d12681e3363" class="indexterm-anchor"></a>真正的应用集群（Oracle RAC） <a id="d12681e3368" class="indexterm-anchor"></a><a id="d12681e3372" class="indexterm-anchor"></a>数据库，主观察者将尝试连接到其余的主要实例之一。除非认为包含Oracle RAC主数据库的所有实例都已失败，否则不会发生快速启动故障转移。主观察器使用<code class="codeph">DGConnectIdentifier</code>或<code class="codeph">ObserverConnectIdentifier</code>数据库属性指定的值连接到主要和快速启动故障转移目标备用数据库。为这些属性中的任何一个指定的值应允许主观察器连接到Oracle RAC数据库的任何实例。
                              </p>
                           </li>
                           <li>
                              <p>验证目标备用数据库是否已准备好进行故障转移。</p>
                              <p>如果启动了快速启动故障转移，则主观察器将验证目标备用数据库是否已准备好故障转移到主数据库角色。</p>
                              <p>如果出现以下情况，则<span class="italic">无法</span>快速启动故障转移</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>不再启用快速启动故障转移</p>
                                 </li>
                                 <li>
                                    <p>主观察器无法连接到目标备用数据库</p>
                                    <div class="infoboxnotealso" id="GUID-824C3FEF-9D1D-4AA7-9C7A-DBDBADC77F47__GUID-B3DBF670-4C93-434A-A07F-FAE834A4F9C6">
                                       <p class="notep1">也可以看看：</p>
                                       <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-50C2F974-E9F8-44A8-B4BE-5238A22A623C" title="如果主观察器失败，则代理的行为取决于代理配置是具有一个观察者还是多个观察者。">如果观察者失败会发生什么？</a> 如果观察者没有跑步</p>
                                    </div>
                                 </li>
                                 <li>
                                    <p>主观察器和目标备用数据库在代理配置的当前状态方面不一致</p>
                                 </li>
                                 <li>
                                    <p>主观察者没有运行</p>
                                 </li>
                                 <li>
                                    <p>如果保护模式为最大可用性或最大保护，并且目标备用数据库在主数据库发生故障时未与主数据库同步</p>
                                 </li>
                                 <li>
                                    <p>如果保护模式是最高性能，并且目标备用数据库的应用点滞后主数据库的重做生成点超过主数据库失败时<code class="codeph">FastStartFailoverLagLimit</code>配置属性指定的数量</p>
                                 </li>
                                 <li>
                                    <p>目标备用数据库与主数据库有联系。但是，如果<code class="codeph">ObserverOverride</code>配置属性设置为<code class="codeph">TRUE</code> ，则尝试进行故障转移。</p>
                                 </li>
                                 <li>
                                    <p>目标备用数据库的<code class="codeph">V$DATABASE</code>视图中的<code class="codeph">FS_FAILOVER_STATUS</code>列显示无法进行快速启动故障转移的原因</p>
                                 </li>
                                 <li>
                                    <p>手动故障转移已在进行中。有关<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-9A988501-7E18-4A62-8CD6-4BDDFA355C98" title="In a manual failover, you convert a standby database to a primary database because the original primary database failed and there is no possibility of recovering the primary database in a timely manner.">手动故障转移</a>的完整信息，请参阅<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-9A988501-7E18-4A62-8CD6-4BDDFA355C98" title="在手动故障转移中，您将备用数据库转换为主数据库，因为原始主数据库失败，并且不可能及时恢复主数据库。">手动故障</a>转移。
                                    </p>
                                 </li>
                                 <li>
                                    <p>主数据库在不使用<code class="codeph">ABORT</code>选项的情况下关闭</p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>启动快速启动故障转移。</p>
                              <p>如果目标备用数据库已准备好进行故障转移，则主观察器会立即指示目标备用数据库故障转移到主数据库角色。如果由于某种原因无法进行故障转移，则主观察器将继续检查备用数据库是否已准备好进行故障转移。但它也将继续尝试无限期地重新连接到主数据库。如果在备用数据库同意进行故障转移之前它重新连接到主数据库，则主观察器将停止尝试启动快速启动故障转移。</p>
                           </li>
                           <li>
                              <p>将以前的主数据库恢复为新的备用数据库。</p>
                              <p>快速启动故障转移成功完成后，当重新建立与先前主数据库的连接并且<code class="codeph">FastStartFailoverAutoReinstate</code>配置属性设置为<code class="codeph">TRUE</code>时，主观察器将尝试将以前的主数据库恢复为新的备用数据库。如果<code class="codeph">FastStartFailoverPmyShutdown</code>配置属性设置为<code class="codeph">TRUE</code> ，则前主数据库将自动关闭，必须手动重新启动，然后主观察器才能尝试恢复它。
                              </p>
                              <p>请注意，这些属性仅影响是否由于主要崩溃或与观察者和目标备用数据库隔离而发生快速启动故障转移时是否执行主关闭和自动恢复。</p>
                              <div class="infoboxnotealso" id="GUID-824C3FEF-9D1D-4AA7-9C7A-DBDBADC77F47__GUID-96B2471D-4CC1-49DD-B35D-C71BAB900539">
                                 <p class="notep1">也可以看看：</p>
                                 <p>有关恢复的更多信息<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-319C443F-4386-49B1-A0FC-9C4166D061CA" title="还原可以恢复代理配置的高可用性，以便在新主数据库发生故障时，可以进行另一次快速启动故障转移。">，请在代理配置中恢复前主数据库</a></p>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="DGBKR393"></a><div class="props_rev_3"><a id="GUID-3DAD4204-B8FB-425D-9D22-0602C62FA89A" name="GUID-3DAD4204-B8FB-425D-9D22-0602C62FA89A"></a><h5 id="DGBKR-GUID-3DAD4204-B8FB-425D-9D22-0602C62FA89A" class="sect5"><span class="enumeration_section">5.5.2.11</span>启用快速启动故障转移时的限制</h5>
                     <div>
                        <p>此列表描述启用快速启动故障转移时的限制。</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>更改：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>配置保护模式</p>
                                 </li>
                                 <li>
                                    <p>重做传输模式用于将重做发送到目标备用数据库或当前处于主要角色的数据库</p>
                                 </li>
                                 <li>
                                    <p>除非新属性值包含当前的快速启动故障转移目标，否则主<a href="oracle-data-guard-broker-properties.html#GUID-63108DF8-4DAD-40F1-88B1-458C3FCB6C84" title="The FastStartFailoverTarget configuration property specifies the DB_UNIQUE_NAME of one or more standby databases that can act as target databases in a fast-start failover situation when the database on which the property is set is the primary database.">节点</a>上的<a href="oracle-data-guard-broker-properties.html#GUID-63108DF8-4DAD-40F1-88B1-458C3FCB6C84" title="FastStartFailoverTarget配置属性指定一个或多个备用数据库的DB_UNIQUE_NAME，当设置了该属性的数据库是主数据库时，该数据库可以在快速启动故障转移情况下充当目标数据库。">FastStartFailoverTarget</a>配置属性。
                                    </p>
                                 </li>
                                 <li>
                                    <p>如果新值将导致主服务器无法将重做发送到当前快速启动故障转移目标备用<code class="codeph">RedoRoutes</code> ，则主<code class="codeph">RedoRoutes</code>上的<code class="codeph">RedoRoutes</code>属性。（允许在所有备用数据库（包括目标备用数据库）上更改<code class="codeph">RedoRoutes</code>属性。）
                                    </p>
                                 </li>
                                 <li>
                                    <p>远程同步实例上的<code class="codeph">RedoRoutes</code>属性，如果它用于从主数据库接收重做并将重做发送到目标备用数据库</p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>禁用或删除：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>代理配置</p>
                                 </li>
                                 <li>
                                    <p>作为快速启动故障转移目标的备用数据库</p>
                                 </li>
                                 <li>
                                    <p>远程同步实例，如果它用于从主数据库接收重做并将重做发送到目标备用数据库</p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>执行手动故障转移：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>除非满足<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-0A81C376-FB77-4EB5-AF59-BD872A875FAE" title="如果启用了快速启动故障切换，则只要满足某些条件，您仍可以执行切换或手动故障切换。">启用快速启动故障转移时执行手动角色更改中</a>列出的条件</p>
                                 </li>
                                 <li>
                                    <p>到未配置为快速启动故障转移目标的备用数据库</p>
                                    <p>要确定配置是否已准备好进行快速启动故障转移，请发出DGMGRL <code class="codeph">SHOW DATABASE &lt;target-standby-database&gt;</code>命令，或查询<a id="d12681e3593" class="indexterm-anchor"></a><a id="d12681e3597" class="indexterm-anchor"></a><a id="d12681e3601" class="indexterm-anchor"></a>主数据库或目标备用数据库上的<code class="codeph">V$DATABASE</code>视图。<code class="codeph">V$DATABASE.FS_FAILOVER_STATUS</code>的列值将在以最大可用性模式运行的配置中进行<code class="codeph">SYNCHRONIZED</code> ，并且在准备快速启动故障切换时，在最高性能模式下运行的配置中将为<code class="codeph">TARGET UNDER LAG LIMIT</code> 。<code class="codeph">FS_FAILOVER_OBSERVER_PRESENT</code>目标备用数据库显示<code class="codeph">YES</code> 。
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>执行切换到未配置为快速启动故障切换目标的备用数据库</p>
                           </li>
                           <li>
                              <p>除非备用数据库与主数据库同步，否则请在以最高可用性模式运行的配置中切换到目标备用数据库</p>
                           </li>
                           <li>
                              <p>除非备用数据库在主数据库的滞后限制内，否则在以最高性能模式运行的配置中执行到目标备用数据库的切换</p>
                           </li>
                           <li>
                              <p>尝试打开主数据库，或者可能返回以下错误：</p><pre class="oac_no_warn" dir="ltr">ORA-16649：可能故障转移到另一个数据库会阻止打开此数据库</pre><p>如果快速启动故障转移有效性检查失败或在两分钟内未完成，则可能会返回此错误。</p>
                           </li>
                           <li>
                              <p>使用SQL <code class="codeph">ALTER DATABASE MOVE DATAFILE</code>命令重命名或重新定位物理备用数据库上的联机数据文件，如果备用数据库已挂载但未打开，则该数据库是快速启动故障转移目标。
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-B10220C5-33C1-4F19-AE2B-7F2C86B578FD" name="GUID-B10220C5-33C1-4F19-AE2B-7F2C86B578FD"></a><h5 id="DGBKR-GUID-B10220C5-33C1-4F19-AE2B-7F2C86B578FD" class="sect5"><span class="enumeration_section">5.5.2.12</span>在仅观察模式下配置快速启动故障转移</h5>
                     <div>
                        <p>通过快速启动故障切换的仅观察模式，您可以测试快速启动故障切换在您的环境中的工作方式。对您当前的配置或应用程序没有任何影响。</p>
                        <div class="section">
                           <p>在此模式下，不会对Broker配置进行实际更改。当满足快速启动故障转移的条件时，Broker会向观察者日志和代理日志添加消息，指示已启动快速启动故障转移。日志还包含有关在发生故障转移时将执行的操作的其他详细信息。</p>
                           <p>请注意以下关于仅观察模式的要点：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>主数据库可以在没有来自观察者或目标备用数据库的确认的情况下进入<code class="codeph">UNSYNC</code>或<code class="codeph">LAGGING</code>状态。
                                 </p>
                              </li>
                              <li>
                                 <p>即使没有来自观察者或目标备用数据库的确认，也可以打开主数据库。</p>
                              </li>
                              <li>
                                 <p>可以在不接收来自观察者的确认的情况下执行到快速启动故障转移目标的手动故障转移。</p>
                              </li>
                              <li>
                                 <p>即使不满足前置条件检查，也可以执行手动故障转移。这包括以下内容：代理配置处于<code class="codeph">UNSYNC</code>或<code class="codeph">LAGGING</code>状态或未观察状态，故障转移目标无效，正在进行恢复，或者正在进行主观察器切换。
                                 </p>
                              </li>
                              <li>
                                 <p>您可以切换或手动故障转移到旁观者数据库。</p>
                              </li>
                           </ul>
                           <p>要在仅观察模式下配置快速启动故障转移：</p><pre class="pre codeblock"><code>DGMGRL&gt;仅启用FAST_START FAILOVER OBSERVE;</code></pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="DGBKR3409"></a><div class="props_rev_3"><a id="GUID-0F672CAD-FBDC-4F21-A96F-B5F08993C453" name="GUID-0F672CAD-FBDC-4F21-A96F-B5F08993C453"></a><h5 id="DGBKR-GUID-0F672CAD-FBDC-4F21-A96F-B5F08993C453" class="sect5"><span class="enumeration_section">5.5.2.13</span>启用快速启动故障切换时关闭主数据库</h5>
                     <div>
                        <p>如果主数据库或备用数据库正常关闭，则不会触发快速启动故障转移。</p>
                        <p>正常关闭使用<code class="codeph">SHUTDOWN NORMAL</code> ， <code class="codeph">SHUTDOWN IMMEDIATE</code>或<code class="codeph">SHUTDOWN TRANSACTIONAL</code> 。正常关闭会阻止快速启动故障转移，直到主数据库和备用数据库连接并再次通信为止。
                        </p>
                     </div>
                  </div><a id="DGBKR3410"></a><div class="props_rev_3"><a id="GUID-0A81C376-FB77-4EB5-AF59-BD872A875FAE" name="GUID-0A81C376-FB77-4EB5-AF59-BD872A875FAE"></a><h5 id="DGBKR-GUID-0A81C376-FB77-4EB5-AF59-BD872A875FAE" class="sect5"><span class="enumeration_section">5.5.2.14</span>启用快速启动故障切换时执行手动角色更改</h5>
                     <div>
                        <p>如果启用了快速启动故障切换，则只要满足某些条件，您仍可以执行切换或手动故障切换。</p>
                        <p>条件如下：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>角色更改将定向到为主数据库上的<code class="codeph">FastStartFailoverTarget</code>数据库属性指定的同一备用数据库。
                              </p>
                           </li>
                           <li>
                              <p>如果目标备用数据库是以最大可用性或最大保护模式运行的配置，则目标备用数据库与主数据库同步，或者如果目标备用数据库是以最高性能模式运行的配置，则目标备用数据库在滞后限制内。</p>
                           </li>
                           <li>
                              <p>对于手动故障转移，将启动观察器并与目标备用数据库通信。在执行手动故障转移之前，必须确保关闭主数据库。</p>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-0A81C376-FB77-4EB5-AF59-BD872A875FAE__GUID-7A318476-723B-44CA-87D9-31461DCFCD44">
                           <p class="notep1">注意：</p>
                           <p>如有必要，可以使用<code class="codeph">FORCE</code>选项禁用快速启动故障转移。请参阅<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-67878B37-39B5-402A-A219-69E7483405A1" title="禁用快速启动故障转移可防止观察者启动到目标备用数据库的故障转移。">禁用快速启动故障转移</a> 。
                           </p>
                        </div>
                        <div class="infoboxnotealso" id="GUID-0A81C376-FB77-4EB5-AF59-BD872A875FAE__GUID-DEF02924-EC39-472C-B489-340B41C39B00">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-AC6A6D2B-1112-422B-8A41-02FAC40E2078" title="切换是主数据库与其中一个备用数据库之间的角色转换。">有关切换</a>和<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-9A988501-7E18-4A62-8CD6-4BDDFA355C98" title="在手动故障转移中，您将备用数据库转换为主数据库，因为原始主数据库失败，并且不可能及时恢复主数据库。">手动故障切换</a>的详细信息，请分别进行切换和手动故障切换</p>
                        </div>
                     </div>
                  </div>
               </div><a id="DGBKR3411"></a><div class="props_rev_3"><a id="GUID-C98DB3F7-2894-4855-9BBD-E3593E59383C" name="GUID-C98DB3F7-2894-4855-9BBD-E3593E59383C"></a><h4 id="DGBKR-GUID-C98DB3F7-2894-4855-9BBD-E3593E59383C" class="sect4"><span class="enumeration_section">5.5.3</span>从应用程序引导快速启动故障转移</h4>
                  <div>
                     <p>您可以使用<code class="codeph">DBMS_DG</code> PL / SQL程序包为特定应用程序自定义快速启动故障转移设置。
                     </p>
                     <p>当检测到应用程序唯一已知的严重条件时，应用程序可以调用<code class="codeph">DBMS_DG.INITIATE_FS_FAILOVER</code>函数来启动立即快速启动故障转移。可以通过与配置中的主服务器或任何备用服务器的连接来调用此功能。调用该过程的数据库通知观察者。只要故障转移目标数据库处于有效的快速启动故障转移状态（“观察”并且“同步”或“滞后”），观察者就会立即启动快速启动故障转移，以接受故障转移。一旦观察者启动了快速启动故障转移，主数据库将自动关闭。观察者不会尝试恢复以前的主数据库。
                     </p>
                     <p>如果配置不可用，则<code class="codeph">DBMS_DG.INITIATE_FS_FAILOVER</code>函数返回<code class="codeph">ORA</code>错误号（它不表示异常），通知调用方无法执行快速启动故障转移。
                     </p>
                     <div class="infoboxnote" id="GUID-C98DB3F7-2894-4855-9BBD-E3593E59383C__GUID-666284B9-01E5-46B1-9C87-6801EEF629F6">
                        <p class="notep1">注意：</p>
                        <p>应用程序在调用<code class="codeph">DBMS_DG.INITIATE_FS_FAILOVER</code>函数时应该小心，因为观察者将启动故障转移（如果可能的话）。
                        </p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-C98DB3F7-2894-4855-9BBD-E3593E59383C__GUID-5D4817B2-11A6-4791-BB2E-2F192758D87D">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<code class="codeph">DBMS_DG</code>包的更多信息，请<code class="codeph">DBMS_DG</code> <a href="../arpls/DBMS_DG.html#ARPLS920" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a></p>
                     </div>
                  </div>
               </div><a id="DGBKR3412"></a><div class="props_rev_3"><a id="GUID-47C45F0E-ABFA-40D7-83E8-5CCCEED524E5" name="GUID-47C45F0E-ABFA-40D7-83E8-5CCCEED524E5"></a><h4 id="DGBKR-GUID-47C45F0E-ABFA-40D7-83E8-5CCCEED524E5" class="sect4"><span class="enumeration_section">5.5.4</span>查看快速启动故障切换配置统计信息和状态</h4>
                  <div>
                     <p>要验证观察器是否已启动且配置是否已准备好进行快速启动故障转移，您可以发出DGMGRL <code class="codeph">SHOW DATABASE &lt;target-standby-database&gt;</code>命令。
                     </p>
                     <div class="section">
                        <p>或者，您可以在目标备用数据库上查询<code class="codeph">V$DATABASE</code>视图。
                        </p>
                        <p>您还可以查询<code class="codeph">V$FS_FAILOVER_STATS</code>视图以显示有关系统上发生的快速启动故障转移的统计信息。
                        </p>
                        <p>本节的其余部分提供了使用DGMGRL <code class="codeph">SHOW</code>命令显示快速启动故障转移信息的示例，并包含描述以下视图的部分：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-F00FD0C8-2A9C-4CA6-A629-F35CED45852F" title="您可以查询V $ DATABASE视图以验证观察者是否已启动，并且配置已准备好进行快速启动故障转移。">V $ DATABASE查看</a></p>
                           </li>
                           <li>
                              <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-FFD3C117-7DE2-4EA3-BB58-BA2690C2F781" title="您可以查询主数据库上的V $ FS_FAILOVER_STATS视图，以显示有关系统上发生的快速启动故障转移的统计信息。">V $ FS_FAILOVER_STATS查看</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-47C45F0E-ABFA-40D7-83E8-5CCCEED524E5__GUID-14A1E26A-217A-465C-8CED-893A26D03C1B">示例1：显示FAST_START FAILOVER</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p></p>
                        <p>DGMGRL <code class="codeph">SHOW FAST-START FAILOVER</code>命令显示所有快速启动故障转移相关信息。例如：</p><pre class="oac_no_warn" dir="ltr">DGMGRL&gt; SHOW FAST_START FAILOVER;快速启动故障转移：在零数据丢失模式保护模式下启用：MaxAvailability滞后限制：0秒阈值：180秒活动目标：South_Sales潜在目标：East_Sales，West_Sales East_Sales有效West_Sales有效观察者：observer.example.com关闭主要：TRUE Auto -reinstate：TRUE Observer重新连接:(无）观察者覆盖：FALSE可配置故障转移条件健康状况：损坏的控制文件是损坏的字典是无法访问的日志文件没有Stuck Archiver没有数据文件写入错误是Oracle错误条件:(无）</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-47C45F0E-ABFA-40D7-83E8-5CCCEED524E5__GUID-AC4CC2A5-C471-49AE-AF22-B5CF1F9CB368">示例2：显示配置VERBOSE</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p></p>
                        <p>以下示例显示DRSolution配置的快速启动故障转移信息：</p><pre class="oac_no_warn" dir="ltr">配置 -  DRSolution保护模式：MaxAvailability成员：North_Sales  - 主数据库South_Sales  - （*）物理备用数据库（*）快速启动故障转移目标属性：FastStartFailoverThreshold ='60'CommonTimeout ='30'TraceLevel ='USER'FastStartFailoverLagLimit = '30 'CommunicationTimeout ='180'ObserverReconnect ='0'FastStartFailoverAutoReinstate ='TRUE'FastStartFailoverPmyShutdown ='TRUE'BeopledersFollowRoleChange ='ALL'ObserverOverride ='FALSE'ExternalDestination1 =''ExternalDestination2 =''PrimaryLostWriteAction ='CONTINUE'ConfigurationWideServiceName ='North_Sales_CFG'Fast -Start故障转移：在零数据丢失模式下启用滞后限制：0秒阈值：30秒活动目标：South_Sales潜在目标：“South_Sales”South_Sales有效观察者：observer.example.com关闭主要：TRUE自动恢复：TRUE观察者重新连接： （无）观察者覆盖：FALSE配置状态：成功</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-47C45F0E-ABFA-40D7-83E8-5CCCEED524E5__GUID-127761FA-5B17-4E30-AFFF-67EF8F33DFF7">例3：SHOW OBSERVER</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p></p>
                        <p>以下<code class="codeph">SHOW OBSERVER</code>命令显示有关<code class="codeph">DRSolution</code>代理配置中的多个观察者的信息。
                        </p><pre class="pre codeblock"><code>DGMGRL&gt; SHOW OBSERVER;配置 -  DRSolution主要：North_Sales活动目标待机：South_Sales Observer“ob2” - 主机主机名：observer2.example.com最后Ping到主要：1秒前最后Ping到目标：2秒前Observer“ob1” - 备份主机名： observer1.example.com最后Ping到主要：1秒前最后Ping到目标：3秒前Observer“ob3” - 备份主机名：observer3.example.com最后Ping到主要：4秒前最后Ping到目标：5秒前</code></pre></div>
                     <!-- class="section" -->
                  </div><a id="DGBKR3542"></a><a id="DGBKR3413"></a><div class="props_rev_3"><a id="GUID-F00FD0C8-2A9C-4CA6-A629-F35CED45852F" name="GUID-F00FD0C8-2A9C-4CA6-A629-F35CED45852F"></a><h5 id="DGBKR-GUID-F00FD0C8-2A9C-4CA6-A629-F35CED45852F" class="sect5"><span class="enumeration_section">5.5.4.1</span> V $ DATABASE视图</h5>
                     <div>
                        <p>您可以查询<code class="codeph">V$DATABASE</code>视图以验证观察者是否已启动，并且配置已准备好进行快速启动故障转移。
                        </p>
                        <p> <a id="d12681e4043" class="indexterm-anchor"></a><a id="d12681e4047" class="indexterm-anchor"></a>查询<code class="codeph">V$DATABASE</code>视图时，请特别注意以下事项：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">FS_FAILOVER_STATUS</code>列，可以包含<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-F00FD0C8-2A9C-4CA6-A629-F35CED45852F__CHDIDBGI" title="列出V $ DATABASE视图的FS_FAILOVER_STATUS列的值。">表5-1中</a>描述的值。请注意，如果<code class="codeph">V$DATABASE.FS_FAILOVER_STATUS</code>列的值为<code class="codeph">DISABLED</code> ，则与快速启动故障转移（ <code class="codeph">V$DATABASE.FS_FAILOVER_*</code> ）相关的其余列返回的任何值都将变得无关紧要。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">FS_FAILOVER_OBSERVER_PRESENT</code>列，指示观察者是否正在运行并主动ping数据库。
                              </p>
                           </li>
                        </ul>
                        <div class="tblformal" id="GUID-F00FD0C8-2A9C-4CA6-A629-F35CED45852F__CHDIDBGI">
                           <p class="titleintable">表5-1 V $ DATABASE视图的FS_FAILOVER_STATUS列</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="FS_FAILOVER_STATUS V $ DATABASE视图的列" width="100%" border="1" summary="Lists the values for the FS_FAILOVER_STATUS column of the V$DATABASE view." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="21%" id="d12681e4095">列值</th>
                                    <th align="left" valign="bottom" width="49%" id="d12681e4098">描述</th>
                                    <th align="left" valign="bottom" width="31%" id="d12681e4101">快速启动故障转移...</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d12681e4106" headers="d12681e4095 ">
                                       <p><code class="codeph">旁观者</code></p>
                                    </td>
                                    <td align="left" valign="top" width="49%" headers="d12681e4106 d12681e4098 ">
                                       <p>启用快速启动故障转移，但此备用数据库不是快速启动故障转移的目标。数据库无法提供快速启动故障转移状态信息。</p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d12681e4106 d12681e4101 ">
                                       <p>已启用</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d12681e4117" headers="d12681e4095 ">
                                       <p><code class="codeph">禁用</code></p>
                                    </td>
                                    <td align="left" valign="top" width="49%" headers="d12681e4117 d12681e4098 ">
                                       <p>禁用快速启动故障转移。</p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d12681e4117 d12681e4101 ">
                                       <p>不可能</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d12681e4128" headers="d12681e4095 ">
                                       <p><code class="codeph">加载字典</code></p>
                                    </td>
                                    <td align="left" valign="top" width="49%" headers="d12681e4128 d12681e4098 ">
                                       <p>仅在尚未完成加载主数据库数据字典副本的逻辑备用数据库上显示。</p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d12681e4128 d12681e4101 ">
                                       <p>不可能</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d12681e4139" headers="d12681e4095 ">
                                       <p><code class="codeph">初步未观察到</code></p>
                                    </td>
                                    <td align="left" valign="top" width="49%" headers="d12681e4139 d12681e4098 ">
                                       <p>仅在目标备用数据库与<code class="codeph">SYNCHRONIZED</code>一起显示时，或者是主数据库的<code class="codeph">TARGET UNDER LAG LIMIT</code> ，与观察者连接，但主数据库没有与观察者的连接。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d12681e4139 d12681e4101 ">
                                       <p>不可能</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d12681e4156" headers="d12681e4095 ">
                                       <p><code class="codeph">重新失败</code></p>
                                    </td>
                                    <td align="left" valign="top" width="49%" headers="d12681e4156 d12681e4098 ">
                                       <p>将失败的主数据库恢复为新的备用数据库失败。有关代理的详细<a href="troubleshooting-oracle-data-guard-broker.html#GUID-A7D1301B-635F-46C6-9E33-FDA2093B8ABA" title="The Oracle Data Guard broker provides information about its activities in several forms.">信息</a> ，请参阅<a href="troubleshooting-oracle-data-guard-broker.html#GUID-A7D1301B-635F-46C6-9E33-FDA2093B8ABA" title="Oracle Data Guard代理以多种形式提供有关其活动的信息。">诊断信息来源</a> <a id="d12681e4170" class="indexterm-anchor"></a><a id="d12681e4174" class="indexterm-anchor"></a><a id="d12681e4180" class="indexterm-anchor"></a> <code class="codeph">drc*</code>日志文件。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d12681e4156 d12681e4101 ">
                                       <p>已经完成了</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d12681e4191" headers="d12681e4095 ">
                                       <p><code class="codeph">需要重新加入</code></p>
                                    </td>
                                    <td align="left" valign="top" width="49%" headers="d12681e4191 d12681e4098 ">
                                       <p>发生故障的主数据库需要恢复为新主数据库的新备用数据库。观察者自动开始恢复过程。<code class="codeph">REINSTATE REQUIRED</code>仅在发生快速启动故障转移后出现，并在新主数据库和正在恢复的数据库上显示。恢复完成后，两者都会清除。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d12681e4191 d12681e4101 ">
                                       <p>已经完成了</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d12681e4205" headers="d12681e4095 ">
                                       <p><code class="codeph">STALLED</code></p>
                                    </td>
                                    <td align="left" valign="top" width="49%" headers="d12681e4205 d12681e4098 ">
                                       <p>失去与目标备用数据库的连接后，在主数据库上显示，并且目标备用数据库或目标备用数据库无法确认更改为<code class="codeph">UNSYNCHRONIZED</code>状态（最大可用性模式）或更改为<code class="codeph">TARGET OVER LAG LIMIT</code>状态（最高性能模式）观察者。请注意， <code class="codeph">FastStartFailoverPmyShutdown</code>配置属性的值必须为<code class="codeph">FALSE</code> ，以便主节点在这些条件下无限期地停止。如果此属性的值为<code class="codeph">TRUE</code> ，则主节点将在被<code class="codeph">FastStartFailoverThreshold</code>属性指定的秒数停顿后关闭。
                                       </p>
                                       <p>它会关闭或停止，因为可能发生了故障转移。</p>
                                       <p><span class="bold">注意</span> ：此状态也会在启动期间在主数据库上发生，此时可以进行快速启动故障转移，并且目标备用数据库和观察器都不存在以确认可以继续打开数据库。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d12681e4205 d12681e4101 ">
                                       <p>有可能</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d12681e4241" headers="d12681e4095 ">
                                       <p><code class="codeph">以限制为目标</code></p>
                                    </td>
                                    <td align="left" valign="top" width="49%" headers="d12681e4241 d12681e4098 ">
                                       <p>如果备用数据库的重做应用点滞后于主数据库的重做生成点超过<code class="codeph">FastStartFailoverLagLimit</code>配置属性指定的秒数，并且配置在最高性能模式下运行，则显示。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d12681e4241 d12681e4101 ">
                                       <p>不可能</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d12681e4255" headers="d12681e4095 ">
                                       <p><code class="codeph">目标在限制下</code></p>
                                    </td>
                                    <td align="left" valign="top" width="49%" headers="d12681e4255 d12681e4098 ">
                                       <p>显示备用数据库的重做应用点是否滞后于主数据库的重做生成点超过<code class="codeph">FastStartFailoverLagLimit</code>配置属性指定的秒数，并且配置在最高性能模式下运行。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d12681e4255 d12681e4101 ">
                                       <p>有可能</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d12681e4269" headers="d12681e4095 ">
                                       <p><code class="codeph">悬</code></p>
                                    </td>
                                    <td align="left" valign="top" width="49%" headers="d12681e4269 d12681e4098 ">
                                       <p>当主数据库或目标备用数据库以受控方式关闭时（使用<code class="codeph">NORMAL</code> ， <code class="codeph">IMMEDIATE</code>或<code class="codeph">TRANSACTIONAL</code>选项，但不使用<code class="codeph">ABORT</code>选项），仅在目标备用数据库上显示。在这种情况下，禁止快速启动故障转移。恢复与主数据库的连接后，将清除<code class="codeph">SUSPENDED</code> 。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d12681e4269 d12681e4101 ">
                                       <p>不可能</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d12681e4295" headers="d12681e4095 ">
                                       <p><code class="codeph">SYNCHRONIZED</code></p>
                                    </td>
                                    <td align="left" valign="top" width="49%" headers="d12681e4295 d12681e4098 ">
                                       <p>在主数据库和目标备用数据库同步且配置在最大可用性模式下运行时显示。</p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d12681e4295 d12681e4101 ">
                                       <p>如果目标备用数据库显示<code class="codeph">SYNCHRONIZED</code>且<code class="codeph">FS_FAILOVER_OBSERVER_PRESENT</code>列显示<code class="codeph">YES</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d12681e4315" headers="d12681e4095 ">
                                       <p><code class="codeph">不同步</code></p>
                                    </td>
                                    <td align="left" valign="top" width="49%" headers="d12681e4315 d12681e4098 ">
                                       <p>当目标备用数据库没有所有主数据库重做数据且配置在最大可用性模式下运行时显示。</p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d12681e4315 d12681e4101 ">
                                       <p>不可能</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d12681e4326" headers="d12681e4095 ">
                                       <p><code class="codeph">FS_FAILOVER_MODE</code></p>
                                    </td>
                                    <td align="left" valign="top" width="49%" headers="d12681e4326 d12681e4098 ">
                                       <p></p>
                                       <p>显示当前的快速启动故障转移模式。</p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d12681e4326 d12681e4101 ">
                                       <p>该模式可以具有以下值之一：</p>
                                       <ul style="list-style-type:disc">
                                          <li>
                                             <p><code class="codeph">DISABLED</code> ： <code class="codeph">DISABLED</code>快速启动故障转移。
                                             </p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">OBSERVE-ONLY</code>观察：在仅观察模式下启用快速启动故障转移。
                                             </p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">ZERO DATA LOSS</code> ：启用快速启动故障切换，零数据丢失。在此模式下， <code class="codeph">FastStartFailoverLagLimit</code>配置属性设置为零。
                                             </p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">POTENTIAL DATA LOSS</code> ：启用快速启动故障转移并导致数据丢失。在此模式下， <code class="codeph">FastStartFailoverLagLimit</code>配置属性设置为非零值。快速启动故障转移可能会在<code class="codeph">FastStartFailoverlagLimit</code>指定的时间内导致数据丢失。
                                             </p>
                                          </li>
                                       </ul>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                  </div><a id="DGBKR3414"></a><div class="props_rev_3"><a id="GUID-FFD3C117-7DE2-4EA3-BB58-BA2690C2F781" name="GUID-FFD3C117-7DE2-4EA3-BB58-BA2690C2F781"></a><h5 id="DGBKR-GUID-FFD3C117-7DE2-4EA3-BB58-BA2690C2F781" class="sect5"><span class="enumeration_section">5.5.4.2</span> V $ FS_FAILOVER_STATS视图</h5>
                     <div>
                        <p>您可以查询主数据库上的<code class="codeph">V$FS_FAILOVER_STATS</code>视图，以显示有关系统上发生的快速启动故障转移的统计信息。
                        </p>
                        <p>执行此类查询非常有用，因为快速启动故障转移是完全自动化的，可以随时进行。可以监控的一些统计数据如下：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">LAST_FAILOVER_TIME</code> ，显示上次快速启动故障转移的时间戳</p>
                           </li>
                           <li>
                              <p><code class="codeph">LAST_FAILOVER_REASON</code> ，显示上次快速启动故障转移的原因</p>
                           </li>
                        </ul>
                        <p>以下是查询<code class="codeph">V$FS_FAILOVER_STATS</code>视图的示例：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT LAST_FAILOVER_TIME，LAST_FAILOVER_REASON FROM V $ FS_FAILOVER_STATS; LAST_FAILOVER_TIME -------------------- LAST_FAILOVER_REASON ---------------------------- -------------------------------------------------- -------------------------------------------------- ---- 02/13/2007 16:53:10主要断开连接</pre></div>
                  </div>
               </div><a id="DGBKR3543"></a><a id="DGBKR3390"></a><div class="props_rev_3"><a id="GUID-67878B37-39B5-402A-A219-69E7483405A1" name="GUID-67878B37-39B5-402A-A219-69E7483405A1"></a><h4 id="DGBKR-GUID-67878B37-39B5-402A-A219-69E7483405A1" class="sect4"><span class="enumeration_section">5.5.5</span>禁用快速启动故障转移</h4>
                  <div>
                     <p>禁用快速启动故障转移可防止观察者启动到目标备用数据库的故障转移。</p>
                     <div class="section">
                        <p><a id="d12681e4443" class="indexterm-anchor"></a><a id="d12681e4447" class="indexterm-anchor"></a>如果禁用快速启动故障转移，则仍可以进行手动故障转移。有关<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-9A988501-7E18-4A62-8CD6-4BDDFA355C98" title="In a manual failover, you convert a standby database to a primary database because the original primary database failed and there is no possibility of recovering the primary database in a timely manner.">手动故障转移</a>的信息，请参见<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-9A988501-7E18-4A62-8CD6-4BDDFA355C98" title="在手动故障转移中，您将备用数据库转换为主数据库，因为原始主数据库失败，并且不可能及时恢复主数据库。">手动故障</a>转移。
                        </p>
                        <div class="infoboxnote" id="GUID-67878B37-39B5-402A-A219-69E7483405A1__GUID-68843206-9EBC-4EFD-83AB-4C203F295A05">
                           <p class="notep1">注意：</p>
                           <p>禁用快速启动故障转移不会停止观察者。要停止观察者，请参阅<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-4B70523D-7E11-445C-A585-502ED93CBAB2" title="您可以手动停止特定观察者或所有观察者。">停止观察者</a> 。
                           </p>
                        </div>
                        <p>要禁用快速启动故障转移，请使用Cloud Control中的Fast-S tart Failover向导或DGMGRL <code class="codeph">DISABLE FAST_START FAILOVER</code> <code class="codeph">[FORCE]</code>命令。即使出现错误， <code class="codeph">FORCE</code>选项也会禁用与您连接的数据库的快速启动故障转移。是否需要<code class="codeph">FORCE</code>选项主要取决于主数据库和目标备用数据库是否具有网络连接：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>如果主数据库和目标备用数据库具有网络连接，并且您连接的数据库与主数据库具有网络连接，则<code class="codeph">FORCE</code>选项无效。只需使用<code class="codeph">DISABLE FAST_START FAILOVER</code> 。此方法将禁用代理配置中所有数据库的快速启动故障转移。
                              </p>
                              <p>如果在禁用操作期间发生错误，代理将返回错误消息并停止禁用操作。</p>
                           </li>
                           <li>
                              <p>如果主备用数据库和目标备用数据库没有网络连接，或者您连接的数据库与主数据库没有网络连接，请考虑使用<span class="italic">带有</span> <code class="codeph">FORCE</code>选项的<code class="codeph">DISABLE FAST_START FAILOVER</code> 。
                              </p>
                              <p>当您发出<code class="codeph">DISABLE FAST_START FAILOVER FORCE</code>命令时，代理可能无法在代理配置中的所有数据库上进行快速启动故障转移。因此，如果观察者确定条件允许故障转移，则无法保证观察者不会执行到目标备用数据库的快速启动故障转移。以下列表指示在主数据库，目标备用数据库和非快速启动故障转移目标的备用数据库上发出<code class="codeph">DISABLE FAST_START FAILOVER FORCE</code>命令时，代理配置中<code class="codeph">DISABLE FAST_START FAILOVER FORCE</code>快速启动故障转移的程度。
                              </p>
                              <p>如果您发出以下命令：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>目标备用数据库与主数据库没有连接时，仅在目标备用数据库上禁用快速启动故障转移。在这种情况下，即使条件允许故障转移，观察者也无法执行快速启动故障转移。连接到目标备用数据库时，使用<code class="codeph">FORCE</code>选项禁用快速启动故障转移可确保不会发生快速启动故障转移。
                                    </p>
                                    <p>当主数据库和目标备用数据库重新获得网络连接时，代理将禁用整个代理配置的快速启动故障转移。</p>
                                 </li>
                                 <li>
                                    <p>在主数据库中，它尝试在与其具有网络连接的配置中的多个数据库上禁用快速启动故障转移。如果主数据库与目标备用数据库没有连接，则目标备用数据库上的快速启动故障转移仍保持启用状态，如果条件允许故障转移，则观察者仍可尝试快速启动故障转移。</p>
                                    <div class="infoboxnote" id="GUID-67878B37-39B5-402A-A219-69E7483405A1__GUID-3A17624B-8CF5-4D60-A92D-D8190E9B4E75">
                                       <p class="notep1">警告：</p>
                                       <p>此操作可能导致配置中的两个数据库同时假定主数据库角色应该快速启动故障转移。因此，您应首先在目标备用数据库上发出此命令。</p>
                                    </div>
                                 </li>
                                 <li>
                                    <p>另一个与主数据库没有连接的备用数据库，此数据库禁用快速启动故障转移。由于未在目标备用数据库上禁用快速启动故障转移，因此如果条件允许故障转移，则观察程序仍可尝试快速启动故障转移到目标备用数据库。</p>
                                    <p>当主数据库和（非目标）备用数据库重新获得网络连接时，代理会将其当前的快速启动故障转移设置（ <code class="codeph">ENABLED</code>或<code class="codeph">DISABLED</code> ）传播到非目标备用数据库。
                                    </p>
                                    <div class="infoboxnote" id="GUID-67878B37-39B5-402A-A219-69E7483405A1__GUID-EF488809-BE46-45CA-89E4-554A32653BBB">
                                       <p class="notep1">警告：</p>
                                       <p>当您遇到网络断开连接并在主数据库或未与主数据库连接的备用数据库上发出<code class="codeph">DISABLE FAST_START FAILOVER FORCE</code>命令时，可能不会对代理配置中的所有数据库禁用快速启动故障转移。因此，如果条件允许故障转移，则观察者仍可以启动到目标备用数据库的快速启动故障转移。这可能导致配置中的两个数据库同时承担主数据库角色。
                                       </p>
                                    </div>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-67878B37-39B5-402A-A219-69E7483405A1__GUID-1CF6AE66-77FA-4A47-877D-512CE680086D">需要FORCE选项的条件</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>仅当发出命令的数据库与主数据库建立网络连接并且主数据库和目标备用数据库具有网络连接时，禁用不带<code class="codeph">FORCE</code>选项的快速启动故障转移才能成功。这是禁用快速启动故障转移的推荐方法。
                        </p>
                        <p>但是，在主数据库和目标备用数据库没有网络连接时，或者您发出disable fast-start failover命令的数据库没有网络时，可能会出现必须禁用快速启动故障转移的情况。连接到主数据库。如果网络连接丢失，请注意，如果条件允许故障转移，观察者可能会尝试快速启动故障转移到目标备用数据库。在以下情况下， <code class="codeph">FORCE</code>选项可能是禁用快速启动故障转移的首选方法：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>在存在可保证故障转移的条件之前，网络中断会将主数据库与观察者和目标备用数据库隔离开来。</p>
                              <p>在这种情况下，主数据库会停止并阻止任何进一步的事务提交，因为在隔离时可能发生了快速启动故障转移。如果您希望网络长时间断开连接并且需要使主数据库可用，请首先确认目标备用数据库未发生快速启动故障转移。然后，使用主数据库上的<code class="codeph">FORCE</code>选项禁用快速启动故障转移。如果可能，请确认在使用主数据库上的<code class="codeph">FORCE</code>选项禁用快速启动故障转移之前，目标备用数据库未发生快速启动故障转移。
                              </p>
                              <div class="infoboxnote" id="GUID-67878B37-39B5-402A-A219-69E7483405A1__GUID-1BB0D4BC-2006-411D-AC4C-365A4F802318">
                                 <p class="notep1">警告：</p>
                                 <p>此操作可能导致配置中的两个数据库同时承担主数据库角色。首先使用目标备用数据库上的<code class="codeph">FORCE</code>选项禁用快速启动故障转移，可以避免这种情况。
                                 </p>
                              </div>
                           </li>
                           <li>
                              <p>你想进行一次<a id="d12681e4607" class="indexterm-anchor"></a><a id="d12681e4611" class="indexterm-anchor"></a><a id="d12681e4615" class="indexterm-anchor"></a>手动故障转移到配置中的任何备用数据库（例如，因为在主数据库和目标备用数据库未准备好进行故障转移时主数据库上发生故障）。
                              </p>
                              <p>在这种情况下，不会发生快速启动故障转移，因为数据库尚未准备好进行故障转移。出于同样的原因，您无法对目标备用数据库执行手动故障转移。要继续，必须首先使用<code class="codeph">FORCE</code>选项禁用快速启动故障转移，然后执行手动故障转移。
                              </p>
                              <div class="infoboxnote" id="GUID-67878B37-39B5-402A-A219-69E7483405A1__GUID-A20C8CDB-E1E8-498D-877A-691EC2AD6C2A">
                                 <p class="notep1">警告：</p>
                                 <p>此操作将导致数据丢失以及配置中两个数据库同时承担主数据库角色的可能性。首先使用目标备用数据库上的<code class="codeph">FORCE</code>选项禁用快速启动故障转移，可以避免这种情况。
                                 </p>
                              </div>
                           </li>
                           <li>
                              <p>到目标备用数据库的快速启动故障转移失败。</p>
                              <p>如果故障转移因任何原因失败，则无论目标备用数据库是否准备好进行故障转移，都可能使目标备用数据库无法运行。如果有另一个备用数据库可用于故障转移，则可以在首次使用该备用数据库上的<code class="codeph">FORCE</code>选项禁用快速启动故障转移后，对该备用数据库执行手动故障转移。
                              </p>
                           </li>
                           <li>
                              <p>您希望防止发生快速启动故障转移，因为主数据库将很快恢复服务。</p>
                              <p>在这种情况下，请使用目标备用数据库上的<code class="codeph">FORCE</code>选项禁用快速启动故障转移。主数据库重新获得与目标备用数据库的连接后，将禁用配置中所有数据库的快速启动故障转移。
                              </p>
                           </li>
                        </ul>
                        <p><span class="bold">使用云控制禁用快速启动故障转移</span></p>
                        <p>在“快速启动故障转移”向导中单击“ <span class="bold">禁用</span> ”。然后，单击“ <span class="bold">继续”</span>以继续下一页。有关更多信息，请参阅Cloud Control联机帮助。
                        </p>
                        <p><span class="bold">使用DGMGRL禁用快速启动故障转移</span></p>
                        <p>发出<code class="codeph">DISABLE FAST_START FAILOVER</code>命令或<code class="codeph">DISABLE FAST_START FAILOVER</code> <code class="codeph">FORCE</code>命令。有关详细信息，请参阅<a href="oracle-data-guard-broker-commands.html#GUID-E7889124-C414-466F-9FBB-B8F035881F89" title="使用命令参考了解如何使用Data Guard代理命令行界面（DGMGRL）来管理代理配置。">Oracle Data Guard命令行界面参考中</a>的<span class="q">“ <a href="oracle-data-guard-broker-commands.html#GUID-0774E121-0DA8-44FD-BD28-2FDF3E3F63E9" title="DISABLE FAST_START FAILOVER命令可防止观察者启动到目标备用数据库的故障转移。">DISABLE FAST_START FAILOVER</a> ”</span>命令。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DGBKR396"></a><div class="props_rev_3"><a id="GUID-D2166F5B-9347-46AB-B291-D008C7D95B3A" name="GUID-D2166F5B-9347-46AB-B291-D008C7D95B3A"></a><h4 id="DGBKR-GUID-D2166F5B-9347-46AB-B291-D008C7D95B3A" class="sect4"><span class="enumeration_section">5.5.6</span>快速启动故障转移的性能注意事项</h4>
                  <div>
                     <p>此列表包含一些建议，以便在使用快速启动故障转移时获得更好的性能。</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>故障转移时间取决于目标备用数据库（物理备用数据库）是否已应用从主数据库接收的所有重做数据。</p>
                        </li>
                        <li>
                           <p>在以最高性能模式运行的配置中启用快速启动故障转移可在主数据库上提供更好的整体性能，因为重做数据将异步发送到目标备用数据库。请注意，这并不能保证不会丢失任何数据。</p>
                        </li>
                        <li>
                           <p>当您采取措施优化恢复时，快速启动故障转移会更快，以便重做数据到备用数据库的应用程序与主数据库的重做应用程序速率保持同步。要优化日志应用率：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>不要将<code class="codeph">DelayMins</code>数据库属性配置为延迟将归档重做日志文件应用于备用数据库（有关更多信息，请参阅<a href="managing-oracle-data-guard-broker-configuration-members.html#GUID-6753936C-E2E3-471E-BCC5-0C4697AD4255" title="您可以使用与log apply相关的数据库属性在物理和逻辑备用数据库上管理Redo Apply和SQL Apply。">管理日志应用服务</a> ）。
                                 </p>
                              </li>
                              <li>
                                 <p>有关调整物理备用数据库的日志应用率的信息，请参阅<a href="../sbydb/managing-oracle-data-guard-physical-standby-databases.html#SBYDB00580" target="_blank"><span class="italic">Oracle Data Guard概念和管理</span></a> 。
                                 </p>
                              </li>
                              <li>
                                 <p>请参阅<span class="italic">Oracle最高可用性架构</span>白皮书：</p>
                                 <p><a href="http://www.oracle.com/goto/maa" target="_blank"><code class="codeph">http://www.oracle.com/goto/maa</code></a></p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>设置<code class="codeph">FastStartFailoverLagLimit</code>配置属性时，请考虑性能和潜在数据丢失之间的这些权衡：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>低滞后限制将最大限度地减少数据丢失，但可能会影响主数据库的性能。</p>
                              </li>
                              <li>
                                 <p>高滞后限制可能会导致更多数据丢失，但可能会降低主数据库的性能影响。</p>
                              </li>
                           </ul>
                        </li>
                     </ul>
                  </div>
               </div><a id="DGBKR3544"></a><a id="DGBKR394"></a><div class="props_rev_3"><a id="GUID-5E2A8696-38B4-4782-B8EF-95C0975CD7C6" name="GUID-5E2A8696-38B4-4782-B8EF-95C0975CD7C6"></a><h4 id="DGBKR-GUID-5E2A8696-38B4-4782-B8EF-95C0975CD7C6" class="sect4"><span class="enumeration_section">5.5.7</span>管理观察者</h4>
                  <div>
                     <p>观察器进程集成在代理的DGMGRL客户端组件中，通常在与主数据库或备用数据库不同的计算机上以及从您管理代理配置的计算机上运行。</p>
                     <p>单个Data Guard配置最多可以有三个观察者。观察者持续监视快速启动故障转移环境以确保主数据库可用（在<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-824C3FEF-9D1D-4AA7-9C7A-DBDBADC77F47" title="启用快速启动故障转移并启动最多三个观察者后，将指定一个观察者作为主观察者，持续监视环境以确保主数据库可用。">启用快速启动故障转移和运行观察程序时描述</a> ）。观察者的主要目的是通过减少手动故障转移过程所需的人为干预来增强高可用性并<span class="italic">熄灭</span>计算，这可能会增加停机时间或分钟。
                     </p>
                     <p>您可以通过Cloud Control中的Oracle Data Guard概述页面或使用DGMGRL命令来管理观察者。<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-5E2A8696-38B4-4782-B8EF-95C0975CD7C6__BCGDGADE">图5-2</a>显示了监视快速启动故障转移配置的观察器。
                     </p>
                     <div class="figure" id="GUID-5E2A8696-38B4-4782-B8EF-95C0975CD7C6__BCGDGADE">
                        <p class="titleinfigure">图5-2快速启动故障转移环境中的Observer</p><img src="img/dgbkr007.png" alt="下面是图5-2的描述" title="下面是图5-2的描述" longdesc="img_text/dgbkr007.html"><br><a href="img_text/dgbkr007.html">“图5-2快速启动故障转移环境中的观察器”的说明</a></div>
                     <!-- class="figure" -->
                     <p>以下部分提供有关管理观察者的信息：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-11EF3897-8FCA-4A54-B63B-E8C1668AE21B" title="应在与主系统和备用系统分开的计算机系统上安装和运行观察器。">安装和启动观察器</a></p>
                        </li>
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-EDCB8EF3-1B69-483B-BFE5-8AE62B126E1D" title="您可以通过查询V $ DATABASE视图找到有关主观察器的信息。">查看有关观察者的信息</a></p>
                        </li>
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-50C2F974-E9F8-44A8-B4BE-5238A22A623C" title="如果主观察器失败，则代理的行为取决于代理配置是具有一个观察者还是多个观察者。">如果观察者失败会发生什么？</a></p>
                        </li>
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-4B70523D-7E11-445C-A585-502ED93CBAB2" title="您可以手动停止特定观察者或所有观察者。">停止观察者</a></p>
                        </li>
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-354F00F7-7B09-4EE3-9422-DD2F00A497D0" title="观察者可以通过在一个系统上停止并在另一个系统上重新启动它的过程从一台计算机移动到另一台计算机。">将观察者移动到另一台计算机</a></p>
                        </li>
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-5544AF97-A37C-4F2E-9C72-DCF5FF591A0A" title="观察者持久地维护有关在启动观察者的工作目录中创建的二进制文件中的快速启动故障转移配置的信息。">观察者如何维护快速启动故障转移配置信息</a></p>
                        </li>
                        <li>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-2C8EF307-908F-4C3F-A6C1-AF995AA77947" title="要修补运行Observer并启用快速启动故障转移的环境，请在应用修补程序之前执行以下步骤。">在观察器运行并启用快速启动故障转移时修补环境</a></p>
                        </li>
                     </ul>
                  </div><a id="DGBKR3721"></a><a id="DGBKR3415"></a><div class="props_rev_3"><a id="GUID-11EF3897-8FCA-4A54-B63B-E8C1668AE21B" name="GUID-11EF3897-8FCA-4A54-B63B-E8C1668AE21B"></a><h5 id="DGBKR-GUID-11EF3897-8FCA-4A54-B63B-E8C1668AE21B" class="sect5"><span class="enumeration_section">5.5.7.1</span>安装和启动观察器</h5>
                     <div>
                        <p>应在与主系统和备用系统分开的计算机系统上安装和运行观察器。</p>
                        <p>安装和启动观察器是使用快速启动故障转移的一个组成部分，将在以下各节中详细介绍：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="oracle-data-guard-broker-installation-requirements.html#GUID-DBCAC77D-8B4D-4727-B89E-6CFA69302187" title="Oracle Data Guard包含在Oracle数据库软件的企业版和个人版中。">Oracle Data Guard安装</a>说明您既可以安装Oracle客户端管理员，也可以在观察系统上安装完整的Oracle数据库企业版或个人版。
                              </p>
                           </li>
                           <li>
                              <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D26D79F2-0093-4C0E-98CD-224A5C8CBFA4" title="You can enable fast-start failover from any site while connected to any database in the broker configuration.">启用快速启动故障切换</a>描述了如何启动观察器作为<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D26D79F2-0093-4C0E-98CD-224A5C8CBFA4" title="您可以在连接到代理配置中的任何数据库时从任何站点启用快速启动故障转移。">启用快速启动故障切换</a>的逐步过程的一部分。使用DGMGRL启动观察者的示例包含在<a href="examples-using-data-guard-broker-DGMGRL-utility.html#GUID-AAE5EA1A-53A2-4D8D-BF59-A2856B38C99D" title="您可以在连接到代理配置中的任何数据库时，从任何站点（包括观察站点）启用快速启动故障转移。">方案6：启用快速启动故障转移和启动观察器中</a> 。
                              </p>
                           </li>
                        </ul>
                        <p>要启动观察者，您必须能够使用具有<code class="codeph">SYSDG</code>或<code class="codeph">SYSDBA</code>权限的帐户登录DGMGRL。观察者是OCI客户端，它使用您使用DGMGRL连接到Oracle Data Guard配置时使用的相同<code class="codeph">SYS</code>凭据连接到主数据库和目标备用数据库。</p>
                        <div class="infoboxnotealso" id="GUID-11EF3897-8FCA-4A54-B63B-E8C1668AE21B__GUID-AC60B395-4F0B-44F9-B1A4-D5B40518E2A0">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关观察者与DGMGRL之间兼容性要求的信息，请访问<a href="http://support.oracle.com" target="_blank"><code class="codeph">http://support.oracle.com</code></a>的My Oracle Support说明1625597.1</p>
                              </li>
                           </ul>
                        </div>
                        <div class="section">
                           <p class="subhead3" id="GUID-11EF3897-8FCA-4A54-B63B-E8C1668AE21B__GUID-C6943656-0BB3-4219-838C-7CD5F40F75F2">在Data Guard Broker配置上启动多个观察器</p>
                           <div class="infoboxnote" id="GUID-11EF3897-8FCA-4A54-B63B-E8C1668AE21B__GUID-0B0E857E-25D5-4DF0-8BAC-451350512CD9">
                              <p class="notep1">注意：</p>
                              <p>对于Oracle Database 12.2及更高版本，Oracle Enterprise Manager云控制（云控制）支持使用企业管理器命令行界面（EM CLI）配置多个观察者。使用EMCLI动词<code class="codeph">dg_configure_observers</code> 。此动词的子命令包括<code class="codeph">start</code> ， <code class="codeph">stop</code> ， <code class="codeph">setMaster</code> ， <code class="codeph">show</code>和<code class="codeph">delete_alternate_observer</code> 。请参阅<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/dgbkr&amp;id=EMCLI-GUID-389D3993-17B9-4D8F-A989-CA4CF6CB175E" target="_blank">Oracle Enterprise Manager命令行界面</a> 。
                              </p>
                           </div>
                           <p>您最多可以注册三个观察者来监视单个Data Guard代理配置。每个观察者都由您在发出<code class="codeph">START</code> <code class="codeph">OBSERVER</code>命令时提供的名称标识。当为一个配置注册多个观察者时，以下条件适用：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>启用快速启动故障转移时，其中一个观察者是主观察者。其余观察员称为备用观察员。禁用快速启动故障转移时，没有观察者被称为主观察者;所有观察者都具有相同的功能。</p>
                              </li>
                              <li>
                                 <p>同一Data Guard Broker配置中没有两个观察者可以具有相同的名称。</p>
                              </li>
                              <li>
                                 <p>如果没有为观察者指定名称，则使用默认观察者名称，即发出<code class="codeph">START OBSERVER</code>命令的机器的主机名。
                                 </p>
                              </li>
                              <li>
                                 <p>观察者名称不区分大小写。</p>
                              </li>
                              <li>
                                 <p>字符串“NONAME”不能用作观察者名称。</p>
                              </li>
                              <li>
                                 <p>每个观察者都有自己的日志文件。使用<code class="codeph">START OBSERVER</code>命令的<code class="codeph">LOGFILE IS</code>选项指定日志文件名。如果无法访问指定的日志文件，或者未使用<code class="codeph">LOGFILE IS</code>选项，则观察器输出将发送到标准输出。
                                 </p>
                              </li>
                              <li>
                                 <p>除测试目的外，不建议您在同一主机上为Data Guard代理配置启动多个观察者。</p>
                              </li>
                              <li>
                                 <p>命令<code class="codeph">SHOW FAST_START FAILOVER</code>显示已注册观察者的列表，并指出哪一个是主人。
                                 </p>
                              </li>
                              <li>
                                 <p>命令<code class="codeph">SHOW OBSERVER</code>提供有关已注册观察者的详细信息。
                                 </p>
                              </li>
                           </ul> 
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-11EF3897-8FCA-4A54-B63B-E8C1668AE21B__GUID-524871C6-B879-466C-88A8-B63AFC11B38A">主观察员和备用观察员</p>
                           <div class="infoboxnote" id="GUID-11EF3897-8FCA-4A54-B63B-E8C1668AE21B__GUID-49B23416-7DAE-4B9D-87C8-73BA027C3599">
                              <p class="notep1">注意：</p>主观察者的工作方式与单个观察者在Oracle Database 12 <span class="italic">c</span>第2版（12.2.0.1）中的多个观察者出现之前工作的方式相同。
                           </div>
                           <p>禁用快速启动故障转移时，观察者无需协调快速启动故障转移，因此在启用快速启动故障转移之前，主要和目标备用数据库不会指定主观察器。启用快速启动故障切换后，主服务器和备用服务器会随机选择一个已注册的观察者作为主服务器。如果启用快速启动故障转移时没有已注册的观察者，则第一个启动的观察者被指定为主观察者，之后启动的所有其他观察者都是备份观察者。只有主观察者才能与Data Guard代理协调快速启动故障转移。所有其他注册观察员都被视为备用观察员。</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-11EF3897-8FCA-4A54-B63B-E8C1668AE21B__GUID-C5001552-C474-4E3C-A991-3CC76C15AB81">手动更改主观察者</p>
                           <div class="p">如有必要，可以使用<code class="codeph">SET MASTEROBSERVER TO</code> <span class="variable" translate="no">Observer-Name</span>命令更改哪个观察者是主<code class="codeph">SET MASTEROBSERVER TO</code> 。例如：<pre class="pre codeblock"><code>DGMGRL&gt;为波士顿观察员设置MASTEROBSERVER;成功了。</code></pre> </div>
                           <p>发出此命令后，实际切换不会发生，直到下次主要联系目标备用数据库时，如果启用了快速启动故障切换，则通常在三秒钟内。您可以发出<code class="codeph">SHOW OBSERVER</code>命令以确认发生了切换。有关更多信息，请参阅<a href="oracle-data-guard-broker-commands.html#GUID-99AD3268-4D63-4329-A703-5C71E31DCBD6" title="SET MASTEROBSERVER TO命令允许您手动更改哪个观察者被识别为主观察者。">SET MASTEROBSERVER TO</a> 。</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-11EF3897-8FCA-4A54-B63B-E8C1668AE21B__GUID-5258D050-3E53-4C12-9984-E2682F697FD0">启动观察者作为后台进程</p>
                           <p>要将观察者作为后台进程运行，请使用DGMGRL命令<code class="codeph">START OBSERVER IN BACKGROUND</code> 。您必须提供连接标识符，通过该标识符可以访问特定代理配置中的一个或多个数据库。以下是将观察者作为后台进程启动的示例：</p><pre class="pre codeblock"><code>DGMGRL&gt;在背景文件中启动观察者是/net/sales/dat/oracle/broker/fsfo.dat LOGFILE是/net/sales/dat/oracle/broker/observer.log CONNECT IDENTIFIER是sales_p使用connect提交的命令“START OBSERVER”标识符“sales_p”DGMGRL&gt;</code></pre><p><code class="codeph">START OBSERVER IN BACKGROUND</code>命令使用Oracle钱包获取凭据以登录数据库服务器并注册观察者。即使您已使用<code class="codeph">CONNECT</code>命令成功连接到代理配置中的数据库服务器，此命令也会忽略现有连接并使用存储在Oracle钱包中的凭据。有关更多信息，请参阅<a href="oracle-data-guard-broker-commands.html#GUID-2545CEB9-6E76-4F35-8B43-AFED62A9766C" title="START OBSERVER IN BACKGROUND命令在此主机（运行此DGMGRL会话）上启动快速启动故障转移观察器作为后台进程。">背景中的START OBSERVER</a> 。</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-11EF3897-8FCA-4A54-B63B-E8C1668AE21B__GUID-1481C183-EFD8-430C-827D-AC89AB71A62F">在单个主机上启动多个观察者</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>如果要使用一个Oracle主目录启动多个观察者，并且每个观察者监视不同的快速启动故障转移配置，请使用<code class="codeph">FILE</code>限定符为要监视的每个配置指定唯一的观察者配置文件位置。如果要捕获观察者生成的任何日志记录，请使用<code class="codeph">START OBSERVER</code>命令上的<code class="codeph">LOGFILE IS</code>选项，并确保文件名是唯一的。例如：</p><pre class="pre codeblock"><code>％dgmgrl DGMGRL&gt; CONNECT / @ primary1; DGMGRL&gt; START OBSERVER FILE是'/ u01 / oracle / dbs / config1.dat'LOGFILE IS'/u01/oracle/log/config1.log'%dgmgrl DGMGRL&gt; CONNECT / @ primary2; DGMGRL&gt; START OBSERVER FILE是'/ u01 /oracle/dbs/config2.dat'logFILE是'/u01/oracle/log/config2.log'</code></pre><div class="infoboxnote" id="GUID-11EF3897-8FCA-4A54-B63B-E8C1668AE21B__GUID-18940ECB-FC02-472E-9786-9F23A7A81724">
                              <p class="notep1">注意：</p>自Oracle Database 12 <span class="italic">c</span>第2版（12.2.0.1）起，不推荐使用DGMGRL <code class="codeph">-logfile</code>选项。它仅支持向后兼容性。而是应该使用<code class="codeph">START OBSERVER</code>命令上的<code class="codeph">LOGFILE IS</code>子句指定日志文件。
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="DGBKR3545"></a><a id="DGBKR3416"></a><div class="props_rev_3"><a id="GUID-EDCB8EF3-1B69-483B-BFE5-8AE62B126E1D" name="GUID-EDCB8EF3-1B69-483B-BFE5-8AE62B126E1D"></a><h5 id="DGBKR-GUID-EDCB8EF3-1B69-483B-BFE5-8AE62B126E1D" class="sect5"><span class="enumeration_section">5.5.7.2</span>查看关于主观察器的信息</h5>
                     <div>
                        <p>您可以通过查询<code class="codeph">V$DATABASE</code>视图找到有关主观察器的信息。
                        </p>
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">FS_FAILOVER_OBSERVER_HOST</code> <a id="d12681e5161" class="indexterm-anchor"></a> <a id="d12681e5165" class="indexterm-anchor"></a><a id="d12681e5169" class="indexterm-anchor"></a>显示运行主观察器的计算机的名称</p>
                              </li>
                              <li>
                                 <p><code class="codeph">FS_FAILOVER_OBSERVER_PRESENT</code> <a id="d12681e5178" class="indexterm-anchor"></a> <a id="d12681e5182" class="indexterm-anchor"></a><a id="d12681e5186" class="indexterm-anchor"></a><a id="d12681e5190" class="indexterm-anchor"></a>显示主观察者是否连接到本地数据库</p>
                              </li>
                           </ul>
                           <p>下表中的列值在Oracle Real Applications Clusters（Oracle RAC）环境中的实例之间是一致的。也就是说，如果观察者连接到Oracle RAC中的任何实例，则所有实例都将显示值<code class="codeph">YES</code> 。</p>
                           <div class="tblformal" id="GUID-EDCB8EF3-1B69-483B-BFE5-8AE62B126E1D__GUID-8031AB26-0FAB-4308-A066-D5D916E28F58">
                              <p class="titleintable">表5-2 V $ DATABASE视图的FS_FAILOVER_OBSERVER_PRESENT列</p>
                              <table cellpadding="4" cellspacing="0" class="Formal" title="FS_FAILOVER_OBSERVER_PRESENT V $ DATABASE视图的列" width="100%" border="1" summary="This two column tables describes the possible values for the FS_FAILOVER_OBSERVER_PRESENT column in the V$DATABASE view. Column 1 is the value. Column 2 is a description of that value. " frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="31%" id="d12681e5210">列值</th>
                                       <th align="left" valign="bottom" width="69%" id="d12681e5213">描述</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="31%" id="d12681e5218" headers="d12681e5210 ">
                                          <p><code class="codeph">是</code></p>
                                       </td>
                                       <td align="left" valign="top" width="69%" headers="d12681e5218 d12681e5213 ">
                                          <p>主观察器当前连接到本地数据库</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="31%" id="d12681e5226" headers="d12681e5210 ">
                                          <p><code class="codeph">没有</code></p>
                                       </td>
                                       <td align="left" valign="top" width="69%" headers="d12681e5226 d12681e5213 ">
                                          <p>主观察器未连接到本地数据库</p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p>例如，要确定是否可以进行快速启动故障转移， <code class="codeph">FS_FAILOVER_STATUS</code>列将显示<code class="codeph">SYNCHRONIZED</code>或<code class="codeph">TARGET UNDER LAG LIMIT</code> ，并且<code class="codeph">FS_FAILOVER_OBSERVER_PRESENT</code>列显示目标备用数据库的<code class="codeph">YES</code> 。例如：</p>
                           <div class="tblformal" id="GUID-EDCB8EF3-1B69-483B-BFE5-8AE62B126E1D__GUID-E44B2782-E719-4AEE-9FB0-B40B52ACDFEA">
                              <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="Provides an example of the FS_FAILOVER_STATUS column and the FS_FAILOVER OBSERVER_PRESENT column when connectivity between the primary database and observer is broken." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="17%" id="d12681e5260">数据库</th>
                                       <th align="left" valign="bottom" width="32%" id="d12681e5263">FS_FAILOVER_STATUS</th>
                                       <th align="left" valign="bottom" width="20%" id="d12681e5268">保护模式</th>
                                       <th align="left" valign="bottom" width="31%" id="d12681e5271">FS_FAILOVER_OBSERVER_PRESENT</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="17%" id="d12681e5278" headers="d12681e5260 ">
                                          <p>主</p>
                                       </td>
                                       <td align="left" valign="top" width="32%" headers="d12681e5278 d12681e5263 ">
                                          <p><code class="codeph">SYNCHRONIZED</code></p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d12681e5278 d12681e5268 ">
                                          <p>最高可用性</p>
                                       </td>
                                       <td align="left" valign="top" width="31%" headers="d12681e5278 d12681e5271 ">
                                          <p><code class="codeph">是</code></p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="17%" id="d12681e5293" headers="d12681e5260 ">
                                          <p>支持</p>
                                       </td>
                                       <td align="left" valign="top" width="32%" headers="d12681e5293 d12681e5263 ">
                                          <p><code class="codeph">SYNCHRONIZED</code></p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d12681e5293 d12681e5268 ">
                                          <p>最高可用性</p>
                                       </td>
                                       <td align="left" valign="top" width="31%" headers="d12681e5293 d12681e5271 ">
                                          <p><code class="codeph">是</code></p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="17%" id="d12681e5308" headers="d12681e5260 ">
                                          <p>主</p>
                                       </td>
                                       <td align="left" valign="top" width="32%" headers="d12681e5308 d12681e5263 ">
                                          <p><code class="codeph">目标在限制下</code></p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d12681e5308 d12681e5268 ">
                                          <p>最高性能</p>
                                       </td>
                                       <td align="left" valign="top" width="31%" headers="d12681e5308 d12681e5271 ">
                                          <p><code class="codeph">是</code></p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="17%" id="d12681e5323" headers="d12681e5260 ">
                                          <p>支持</p>
                                       </td>
                                       <td align="left" valign="top" width="32%" headers="d12681e5323 d12681e5263 ">
                                          <p><code class="codeph">目标在限制下</code></p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d12681e5323 d12681e5268 ">
                                          <p>最高性能</p>
                                       </td>
                                       <td align="left" valign="top" width="31%" headers="d12681e5323 d12681e5271 ">
                                          <p><code class="codeph">是</code></p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p>在以下示例中，假设主数据库和观察者之间的网络已失败。在这种情况下，将显示<code class="codeph">FS_FAILOVER_STATUS</code>和<code class="codeph">FS_FAILOVER_OBSERVER_PRESENT</code>列，如下表所示，并且不会发生快速启动故障转移：</p>
                           <div class="tblformal" id="GUID-EDCB8EF3-1B69-483B-BFE5-8AE62B126E1D__GUID-2B1F5C99-B747-41C8-BF35-853AD1A84716">
                              <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="Provides an example of the FS_FAILOVER_STATUS column and the FS_FAILOVER OBSERVER_PRESENT column when connectivity between the primary database and observer is broken." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="20%" id="d12681e5354">数据库</th>
                                       <th align="left" valign="bottom" width="36%" id="d12681e5357">FS_FAILOVER_STATUS</th>
                                       <th align="left" valign="bottom" width="44%" id="d12681e5362">FS_FAILOVER_OBSERVER_PRESENT</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d12681e5369" headers="d12681e5354 ">
                                          <p>主</p>
                                       </td>
                                       <td align="left" valign="top" width="36%" headers="d12681e5369 d12681e5357 ">
                                          <p><code class="codeph">SYNCHRONIZED</code></p>
                                       </td>
                                       <td align="left" valign="top" width="44%" headers="d12681e5369 d12681e5362 ">
                                          <p><code class="codeph">没有</code></p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d12681e5381" headers="d12681e5354 ">
                                          <p>支持</p>
                                       </td>
                                       <td align="left" valign="top" width="36%" headers="d12681e5381 d12681e5357 ">
                                          <p><code class="codeph">初步未观察到</code></p>
                                       </td>
                                       <td align="left" valign="top" width="44%" headers="d12681e5381 d12681e5362 ">
                                          <p><code class="codeph">是</code></p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <div class="infoboxnotealso" id="GUID-EDCB8EF3-1B69-483B-BFE5-8AE62B126E1D__GUID-98183EC2-61CA-4993-A140-84C4AA446CAE">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>有关<code class="codeph">V$DATABASE</code>视图的更多信息，请<a href="../refrn/V-DATABASE.html#REFRN-GUID-C62A7B96-2DD4-4E70-A0D9-26EE4BFBE256" target="_blank"><span><cite>参见Oracle数据库参考</cite></span></a> 。
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-9AECB993-F004-4061-8B76-D681BC5CD628" name="GUID-9AECB993-F004-4061-8B76-D681BC5CD628"></a><h5 id="DGBKR-GUID-9AECB993-F004-4061-8B76-D681BC5CD628" class="sect5"><span class="enumeration_section">5.5.7.3</span>查看所有观察者的信息</h5>
                     <div>
                        <p>您可以在<code class="codeph">V$FS_FAILOVER_OBSERVERS</code>视图中找到有关所有观察者的详细信息，包括主观察者和备用观察者。
                        </p>
                        <p>对于每个观察者， <code class="codeph">V$FS_FAILOVER_OBSERVERS</code>视图提供观察者名称，主机，它是否是主观察者， <code class="codeph">V$FS_FAILOVER_OBSERVERS</code>为主观察者，以及它当前是否连接到主要和目标备用数据库。
                        </p>
                        <div class="infoboxnotealso" id="GUID-9AECB993-F004-4061-8B76-D681BC5CD628__GUID-218D5153-7F05-4766-AB7F-7DDD63C1412B">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">V$FS_FAILOVER_OBSERVERS</code>视图的更多信息，请<a href="../refrn/V-FS_FAILOVER_OBSERVERS.html#REFRN-GUID-4367B152-DD86-443E-80C1-54035C2B385D" target="_blank"><span><cite>参见Oracle数据库参考</cite></span></a> 。
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="DGBKR3417"></a><div class="props_rev_3"><a id="GUID-50C2F974-E9F8-44A8-B4BE-5238A22A623C" name="GUID-50C2F974-E9F8-44A8-B4BE-5238A22A623C"></a><h5 id="DGBKR-GUID-50C2F974-E9F8-44A8-B4BE-5238A22A623C" class="sect5"><span class="enumeration_section">5.5.7.4</span>主观察员失败会发生什么？
                     </h5>
                     <div>
                        <p>如果主观察器失败，则代理的行为取决于代理配置是具有一个观察者还是多个观察者。</p>
                        <p>如果只有一个观察者，那么它被认为是主观察者。如果有多个观察者，那么其中只有一个是主观察者。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-50C2F974-E9F8-44A8-B4BE-5238A22A623C__GUID-B1477547-9681-43C2-87F2-2EBA34295783">代理配置只有一个注册的观察者</p>
                           <p>当配置只有一个已注册的观察者时，如果主数据库和目标备用数据库保持连接但与观察者的连接丢失，则代理报告未遵守配置<a id="d12681e5476" class="indexterm-anchor"></a><a id="d12681e5478" class="indexterm-anchor"></a><a id="d12681e5482" class="indexterm-anchor"></a><a id="d12681e5486" class="indexterm-anchor"></a><a id="d12681e5490" class="indexterm-anchor"></a> 。观察者未运行的配置和数据库状态报告并返回以下状态消息之一：</p><pre class="oac_no_warn" dir="ltr">ORA-16658：未观察到的快速启动故障转移配置ORA-16820：快速启动故障转移观察器不再观察此数据库</pre><p>当配置处于未观察状态时，不会发生快速启动故障转移。因此，即使目标备用数据库失败，主数据库也可以继续处理事务。观察者重新建立与主数据库的连接后，配置状态将返回<code class="codeph">SUCCESS</code>状态，然后主数据库通知目标备用数据库。
                           </p>
                           <div class="infoboxnotealso" id="GUID-50C2F974-E9F8-44A8-B4BE-5238A22A623C__GUID-F432C66E-CE7E-4659-8684-4B56EE992317">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-47C45F0E-ABFA-40D7-83E8-5CCCEED524E5" title="要验证观察器是否已启动且配置是否已准备好进行快速启动故障转移，您可以发出DGMGRL SHOW DATABASE &lt;target-standby-database&gt;命令。">查看快速启动故障转移配置统计信息和状态</a></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-50C2F974-E9F8-44A8-B4BE-5238A22A623C__GUID-05C6EEEF-023D-4D6D-9989-2F1F24CD930D">经纪人配置有多个注册观察员</p>
                           <p>当配置具有多个已注册的观察者时，如果主数据库和目标备用数据库保持连接但与主观察者的连接丢失，则代理会尝试将备份观察者指定为新的主观察者。此提名在观察者日志文件和代理日志文件（drc * .log）中注明。此外，在为<code class="codeph">SHOW FAST_START FAILOVER</code>和<code class="codeph">SHOW OBSERVER</code>命令显示的输出中标识新的主观察<code class="codeph">SHOW OBSERVER</code> 。
                           </p>
                           <div class="infoboxnote" id="GUID-50C2F974-E9F8-44A8-B4BE-5238A22A623C__GUID-E7F847C2-9171-4690-8CB4-FD705E0C8276">
                              <p class="notep1">注意：</p>在识别新的主观察器期间，在选择新的主观察器并观察配置之前，不会发生快速启动故障转移。
                           </div>
                           <p>如果主备用数据库或目标备用数据库失去与所有备份观察者的连接，则代理不会尝试将备份观察者指定为新的主观察者，并且代理报告未观察到配置。配置和数据库状态报告的错误消息与只有一个已注册的观察者时返回的错误消息相同。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="DGBKR3860"></a><div class="props_rev_3"><a id="GUID-DF791395-CE3C-4086-8B43-3B0F4377A581" name="GUID-DF791395-CE3C-4086-8B43-3B0F4377A581"></a><h5 id="DGBKR-GUID-DF791395-CE3C-4086-8B43-3B0F4377A581" class="sect5"><span class="enumeration_section">5.5.7.5</span>管理Observer与主<span class="enumeration_section">节点</span>的连接</h5>
                     <div>
                        <p><code class="codeph">ObserverOverride</code>和<code class="codeph">ObserverReconnect</code>属性允许您进一步控制与主服务器的连接。
                        </p>
                        <p>当观察者失去与主数据库的连接的时间超过<code class="codeph">FastStartFailoverThreshold</code>属性指定的时间段时，它会尝试故障转移到备用数据库。但是，如果备用数据库在<code class="codeph">FastStartFailoverThreshold</code>属性指定的时间段内与主数据库建立了联系，则备用数据库将阻止故障转移尝试。
                        </p>
                        <p>要覆盖此行为并允许在观察者无法联系主<code class="codeph">FastStartFailoverThreshold</code>超过<code class="codeph">FastStartFailoverThreshold</code>秒时发生快速启动故障转移，请将<code class="codeph">ObserverOverride</code>属性设置为<code class="codeph">TRUE</code> 。例如：</p><pre class="oac_no_warn" dir="ltr">DGMGRL&gt; EDIT CONFIGURATION SET PROPERTY ObserverOverride = TRUE;</pre><p>通常，观察者连接一次到主要，除非连接失败，否则不会尝试重新连接。但是，如果您希望观察者定期重新连接到主数据库，以测试与主数据库的网络连接的运行状况，则使用<code class="codeph">ObserverReconnect</code>配置属性。这指定观察者建立与主数据库的新连接的频率。在以下示例中， <code class="codeph">ObserverReconnect</code>设置为30秒。这导致观察者每30秒与主数据库建立新连接。
                        </p><pre class="oac_no_warn" dir="ltr">DGMGRL&gt; EDIT CONFIGURATION SET PROPERTY ObserverReconnect = 30;</pre></div>
                  </div><a id="DGBKR3418"></a><div class="props_rev_3"><a id="GUID-4B70523D-7E11-445C-A585-502ED93CBAB2" name="GUID-4B70523D-7E11-445C-A585-502ED93CBAB2"></a><h5 id="DGBKR-GUID-4B70523D-7E11-445C-A585-502ED93CBAB2" class="sect5"><span class="enumeration_section">5.5.7.6</span>停止观察者</h5>
                     <div>
                        <p>您可以手动停止特定观察者或所有观察者。</p>
                        <div class="section">
                           <p>在停止观察者之前，请注意以下事项：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>发出<code class="codeph">STOP OBSERVER</code>命令时，观察者不会立即<code class="codeph">STOP OBSERVER</code> 。在代理收到<code class="codeph">STOP OBSERVER</code>请求之后，下次观察者与代理联系时，请求将被传递给观察者，然后观察者自行停止。
                                 </p>
                              </li>
                              <li>
                                 <p>停止观察者不会禁用快速启动故障转移。但是，当目标备用数据库处于未观察状态时，不会发生快速启动故障转移。</p>
                              </li>
                              <li>
                                 <p>要在禁用快速启动故障转移时停止观察者，主数据库必须正在运行。</p>
                              </li>
                              <li>
                                 <p>要在启用快速启动故障转移时停止观察者，必须连接主数据库和目标备用数据库并相互通信。如果它们彼此隔离，则必须首先使用<code class="codeph">FORCE</code>选项禁用快速启动故障转移，然后停止观察器。（有关使用<code class="codeph">FORCE</code>选项时的重要注意事项，请参阅<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-67878B37-39B5-402A-A219-69E7483405A1" title="禁用快速启动故障转移可防止观察者启动到目标备用数据库的故障转移。">禁用快速启动故障转移</a> 。）
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-4B70523D-7E11-445C-A585-502ED93CBAB2__GUID-D280C109-317C-4DBD-A814-5620ED00F445">停止所有观察员</p>
                           <p>您可以指定<code class="codeph">STOP OBSERVER ALL</code>以停止在代理配置中注册的所有观察者。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-4B70523D-7E11-445C-A585-502ED93CBAB2__GUID-1F1BAFA7-B11B-4640-B81D-65327E97030E">有多个观察者时停止特定观察者</p>
                           <p>要在有多个已注册的观察者运行时停止特定的观察者，请发出以下命令：</p><pre class="pre codeblock"><code>DGMGRL&gt; STOP OBSERVER <span class="variable" translate="no">observer_name</span> ;</code></pre><p>您可以从任何机器登录DGMGRL以阻止观察者。例如，您可以登录运行<code class="codeph">observer1</code>的系统来停止<code class="codeph">observer2</code> 。
                           </p>
                           <p>在配置了多个观察者的环境中，除非是最后运行的观察者，否则不允许停止主观察者。要停止当前指定为主观察者的观察者，首先发出<code class="codeph">SET MASTEROBSERVER</code>命令以将不同的观察者指定为主观察者。然后可以在前主观察器上成功发出<code class="codeph">STOP OBSERVER</code>命令。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-4B70523D-7E11-445C-A585-502ED93CBAB2__GUID-68639FEC-E9E3-43C7-82C0-FF361F1BC568">当只有一个观察者时停止观察者</p>
                           <p>如果只有一个注册的观察者，那么它的工作方式与单个观察者在Oracle Database 12 <span class="italic">c</span> Release 2（12.2.0.1）中出现多个观察者之前的工作方式相同。要停止它，您可以执行以下任一操作：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>使用云控制</p>
                                 <p>选择快速启动故障转移向导第一页上的“ <span class="bold">停止观察者”</span>选项，然后单击页面底部的“ <span class="bold">继续</span> ”。有关更多信息，请参阅Cloud Control联机帮助。
                                 </p>
                              </li>
                              <li>
                                 <p>使用DGMGRL</p>
                                 <p>发出以下命令：</p><pre class="pre codeblock"><code>DGMGRL&gt;停止观察员;</code></pre><p>如果有多个已注册的观察者，则此命令返回错误;如果有多个观察者，则需要名称。</p>
                              </li>
                           </ul>
                           <div class="infoboxnote" id="GUID-4B70523D-7E11-445C-A585-502ED93CBAB2__GUID-F25E871D-8225-4B61-A277-6631753B2C51">
                              <p class="notep1">注意：</p>有关更多信息，请参见<a href="oracle-data-guard-broker-commands.html#GUID-F9D213F3-12FA-4890-9AD7-A3000D344F3E" title="STOP OBSERVER命令停止快速启动故障转移观察器。">STOP OBSERVER</a>命令。
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="DGBKR3419"></a><div class="props_rev_3"><a id="GUID-354F00F7-7B09-4EE3-9422-DD2F00A497D0" name="GUID-354F00F7-7B09-4EE3-9422-DD2F00A497D0"></a><h5 id="DGBKR-GUID-354F00F7-7B09-4EE3-9422-DD2F00A497D0" class="sect5"><span class="enumeration_section">5.5.7.7</span>将观察者移动到另一台计算机</h5>
                     <div>
                        <p>观察者可以通过在一个系统上停止并在另一个系统上重新启动它的过程从一台计算机移动到另一台计算机。</p>
                        <div class="section">
                           <p>要将观察者移动到另一台计算机：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li><span>停止代理配置中任何计算机系统的观察者，如<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-4B70523D-7E11-445C-A585-502ED93CBAB2" title="您可以手动停止特定观察者或所有观察者。">停止观察者中所述</a> 。</span></li>
                           <li><span>在新计算机系统上启动观察器，如<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D26D79F2-0093-4C0E-98CD-224A5C8CBFA4" title="您可以在连接到代理配置中的任何数据库时从任何站点启用快速启动故障转移。">启用快速启动故障转移的</a>步骤8中所述。</span></li>
                        </ol>
                        <div class="section">
                           <p>移动观察者时无需禁用快速启动故障转移。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="DGBKR3420"></a><div class="props_rev_3"><a id="GUID-5544AF97-A37C-4F2E-9C72-DCF5FF591A0A" name="GUID-5544AF97-A37C-4F2E-9C72-DCF5FF591A0A"></a><h5 id="DGBKR-GUID-5544AF97-A37C-4F2E-9C72-DCF5FF591A0A" class="sect5"><span class="enumeration_section">5.5.7.8</span>观察者如何维护快速启动故障转移配置信息</h5>
                     <div>
                        <p>观察者持久地维护有关在启动观察者的工作目录中创建的二进制文件中的快速启动故障转移配置的信息。</p>
                        <p>默认情况下，观察者在启动时在当前工作目录中创建此文件，并将文件命名为<code class="codeph">fsfo.dat</code> 。此文件包含主数据库和目标备用数据库的连接标识符。
                        </p>
                        <p>确保未经授权的用户无法读取此文件。</p>
                        <p>启动观察器后，您无法更改文件的名称和位置。但是，如果使用DGMGRL <code class="codeph">START OBSERVER</code>命令启动观察者并包含<code class="codeph">FILE IS</code>限定符，则可以更改文件的名称或位置。有关更多信息，请参阅<a href="oracle-data-guard-broker-commands.html#GUID-8AADB389-6E31-46D6-AB1C-4FBB8EB6C411" title="START OBSERVER命令在此主机（运行DGMGRL会话的位置）上启动快速启动故障转移观察器，如果此主机上没有为此配置运行的已注册观察器。">START OBSERVER</a>命令。
                        </p>
                        <div class="infoboxnote" id="GUID-5544AF97-A37C-4F2E-9C72-DCF5FF591A0A__GUID-73B1F59D-3672-4F28-B42C-2F706D58613B">
                           <p class="notep1">注意：</p>
                           <p>如果观察者异常停止（例如，通过键入<code class="codeph">CTRL/C</code> ），请重新启动它并使用<code class="codeph">FILE IS</code>限定符引用现有的<code class="codeph">fsfo.dat</code>文件。
                           </p>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-BC513CDB-1E06-4EB3-9FE1-E1331E15E492" name="GUID-BC513CDB-1E06-4EB3-9FE1-E1331E15E492"></a><h5 id="DGBKR-GUID-BC513CDB-1E06-4EB3-9FE1-E1331E15E492" class="sect5"><span class="enumeration_section">5.5.7.9</span>管理多个配置的观察者</h5>
                     <div>
                        <p>DGMGRL可用于管理一组代理配置中的多个观察者。</p>
                        <p>您可以启动，停止和显示一组配置的观察者。您还可以将一组配置的主观察器主机切换到一个特定主机。</p>
                        <p>要管理的代理配置组在观察器配置文件中声明。默认组是观察器配置文件中定义的所有配置。如果您不想使用默认值，则可以定义特定组。观察者配置文件是一个文本文件，定义观察者和组的语法类似于<code class="codeph">listener.ora</code>或<code class="codeph">tnsnames.ora</code>文件中使用的语法。它按以下顺序分为两部分：</p>
                        <ol>
                           <li>
                              <p>配置声明 - 此部分是必需的。它必须显示为观察者配置文件的第一部分。</p>
                           </li>
                           <li>
                              <p>组定义 - 此部分是可选的。如果提供，则每个组需要在第二部分中声明至少一个代理配置。</p>
                           </li>
                        </ol>
                        <div class="section">
                           <p class="subhead3" id="GUID-BC513CDB-1E06-4EB3-9FE1-E1331E15E492__GUID-5B988511-83E3-4CEF-B99A-274FAD475880">强制配置声明的语法</p>
                           <p>配置声明的语法是：</p><pre class="pre codeblock"><code>BROKER_CONFIGS =（（configuration1-definition）（configuration2-definition）...（配置-n-definition））</code></pre><p>每个代理配置的定义是：</p><pre class="pre codeblock"><code>CONFIG =（NAME = configuration-name）（CONNECT_ID = connect-identifier）（CONFIG_HOME = config-home-location））</code></pre><p>请注意以下事项：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">configuration-name</code>可以与Data Guard Broker配置的元数据中定义的名称不同。（这很有用，因为元数据中定义的名称可能包含空格和国际字符，观察者配置文件不允许这样做。）
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">connect-identifier</code>是<code class="codeph">tnsnames.ora</code>定义的TNS别名，通过该别名可以访问此Data Guard代理配置中所有数据库的所有实例。
                                 </p>
                              </li>
                              <li><code class="codeph">Config-home-location</code>指定观察者日志文件和<code class="codeph">FSFO.dat</code>文件的位置。
                              </li>
                              <li>
                                 <p>不允许在配置定义中使用重复的配置名称。</p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-BC513CDB-1E06-4EB3-9FE1-E1331E15E492__GUID-A6039E93-EA99-4E1B-A722-1B6C89BA5340">可选组定义的语法</p>
                           <p>代理配置组的可选定义的语法是：</p><pre class="pre codeblock"><code>CONFIG_GROUPS =（（group1-definition）（group2-definition）...（group-n-definition））</code></pre><p>每组的定义是：</p><pre class="pre codeblock"><code>GROUP =（NAME = group-name）（CONFIG_LIST =（NAME = configuration1-name）（NAME = configuration2-name）...（NAME = configuration-n-name））</code></pre><p>请注意以下事项：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>组定义部分是可选的。如果未定义组，您仍可以对文件中定义的所有配置进行操作。</p>
                              </li>
                              <li>
                                 <p>单词<code class="codeph">ALL</code>不能用作组名，因为它是保留关键字。
                                 </p>
                              </li>
                              <li>不允许重复的组名。</li>
                              <li>您定义的每个组必须至少具有一个代理配置。</li>
                              <li>引用的任何代理配置名称必须存在于配置声明部分中。</li>
                              <li>代理配置可以属于多个组。</li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-BC513CDB-1E06-4EB3-9FE1-E1331E15E492__GUID-54EFC412-348B-42A5-A838-BE69830C4011">指定观察者配置文件</p>
                           <p>执行影响多个观察者的命令时，如果尚未指定观察者配置文件的名称和位置，则代理会在当前工作目录中搜索名为<code class="codeph">observer.ora</code>的文件。如果文件不存在，该命令将失败。
                           </p>
                           <p>但是，您可以选择为观察者配置文件指定名称和位置。为此，请使用<code class="codeph">SET ObserverConfigFile</code>和<code class="codeph">SHOW ObserverConfigFile</code>命令。这些命令可以从DGMGRL命令行发出，但在使用它们之前无需登录。
                           </p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">SET ObserverConfigFile</code> - 用于指定自定义的观察者配置文件。<code class="codeph">ObserverConfigFile</code>是DGMGRL会话运行时属性。每次启动新的DGMGRL客户端时都必须指定它。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">SHOW ObserverConfigFile</code> - 用于检查运行时属性<code class="codeph">ObserverConfigFile</code> 。如果在启动当前DGMGRL客户端后未使用<code class="codeph">SET ObserverConfigFile</code>命令，则结果将始终为： <code class="codeph">ObserverConfigFile=observer.ora</code> 。
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-BC513CDB-1E06-4EB3-9FE1-E1331E15E492__GUID-7B87E09D-7A58-4ED9-AEFA-536343D23E86">用于管理多个配置的观察者的命令</p>
                           <p>可以为一组配置执行的命令（在观察器配置文件中声明）如下所示。</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">START OBSERVING</code> [ <span class="variable" translate="no">cfg_group_name</span> ]  - 为指定组中的每个代理配置启动一个新观察者。如果未提供组名，则会为observer.ora中定义的每个代理配置启动一个新的观察者。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">STOP OBSERVING</code> [ <span class="variable" translate="no">cfg_group_name</span> ]  - 对于指定组中的所有代理配置，停止在此主机（此DGMGRL正在运行）上运行的LOCAL观察者</p>
                              </li>
                              <li>
                                 <p><code class="codeph">SHOW OBSERVERS [FOR</code> <span class="variable" translate="no">fg_group_nam</span> e <code class="codeph">]</code> - 显示有关指定组中所有配置的观察者的信息。此命令显示的信息与每个配置上的<code class="codeph">SHOW OBSERVER</code>命令所显示的信息相同。如果未指定组名，则仅<code class="codeph">SHOW OBSERVERS</code>也是有效命令。它的行为与<code class="codeph">START OBSERVING</code>和<code class="codeph">STOP OBSERVING</code> ，可以对观察者配置文件中定义的所有配置进行操作。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">SET MASTEROBSERVER TO</code> - 允许您手动更改观察者配置文件。
                                 </p>
                              </li>
                           </ul>
                           <div class="infoboxnotealso" id="GUID-BC513CDB-1E06-4EB3-9FE1-E1331E15E492__GUID-9AB8BE37-D961-4010-8BD7-DBF1A7AE8040">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>有关这些代理命令的更多信息，请<a href="oracle-data-guard-broker-commands.html#GUID-E7889124-C414-466F-9FBB-B8F035881F89" title="使用命令参考了解如何使用Data Guard代理命令行界面（DGMGRL）来管理代理配置。">参见Oracle Data Guard命令行界面参考</a> 。
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-BC513CDB-1E06-4EB3-9FE1-E1331E15E492__GUID-894BE20C-1933-411F-9BB2-45610D4F9507">访问代理配置所需的凭据</p>
                           <p>您必须使用Oracle钱包来存储要管理的所有代理配置的凭据。Data Guard代理不管理或存储凭据。它使用observer配置文件中指定的连接标识符来查找Oracle钱包中代理配置的凭据。如果无法获取凭据，则尝试的命令将失败（但仅适用于尚未获取其凭据的代理配置）。</p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-BC513CDB-1E06-4EB3-9FE1-E1331E15E492__GUID-3334F3DC-A534-479A-AC3E-6CABB76BCDA0">
                           <p class="titleinexample">示例5-1示例观察者配置文件</p>
                           <p>以下是示例观察者配置文件：</p><pre class="pre codeblock"><code>＃是此文件中的注释符号BROKER_CONFIGS =（#Broker配置'SALES';连接ID为'SALES_P'（CONFIG =（NAME = SALES）（CONNECT_ID = SALES_P）（CONFIG_HOME = ORACLE_HOME / LOG /））＃Broker配置'HR';连接ID为'HR_P'（CONFIG =（NAME = HR）（CONNECT_ID = HR_P）（CONFIG_HOME = ORACLE_HOME / LOG /））＃Broker配置'CUSTOMER';连接ID为'CUSTOMER_P'（CONFIG = （NAME = CUSTOMER）（CONNECT_ID = CUSTOMER_P）（CONFIG_HOME = ORACLE_HOME / LOG1 /）））＃部分'CONFIG_GROUP'列出＃所有代理配置组的定义CONFIG_GROUPS =（#Configuration'GRP_A'包括'SALES'和'HR' （GROUP =（NAME = GRP_A）（CONFIG_LIST =（NAME = SALES）（NAME = HR）））＃配置'GRP_B'包括'SALES'和'CUSTOMER'（GROUP =（NAME = GRP_B）（CONFIG_LIST =（NAME =销售）（NAME = CUSTOMER））））</code></pre><p>由于代理配置<code class="codeph">SALES</code>由三个数据库（ <code class="codeph">Boston</code> ， <code class="codeph">Chicago</code>和<code class="codeph">Dallas</code> ， <code class="codeph">CONNECT_ID</code>为<code class="codeph">SALES_P</code> ，因此必须定义<code class="codeph">SALES_P</code>连接标识符，以便它可以访问配置中任何数据库的任何实例。新的<code class="codeph">ConfigurationWideServiceName</code>配置属性可用于简化设置此连接标识符。Data Guard代理在每个实例启动时发布此服务，并初始化实例的代理管理：</p><pre class="pre codeblock"><code>SALES_P =（DESCRIPTION =（ADDRESS_LIST =（ADDRESS =（PROTOCOL = TCP）（HOST = boston-cluster）（PORT = 1521））（ADDRESS =（PROTOCOL = TCP）（HOST = chicago-cluster）（PORT = 1521）） （ADDRESS =（PROTOCOL = TCP）（HOST = dallas-cluster）（PORT = 1521）））（CONNECT_DATA =（SERVER = DEDICATED）（SERVICE_NAME = cfgSvc.us.example.com）））</code></pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="DGBKR3936"></a><div class="props_rev_3"><a id="GUID-2C8EF307-908F-4C3F-A6C1-AF995AA77947" name="GUID-2C8EF307-908F-4C3F-A6C1-AF995AA77947"></a><h5 id="DGBKR-GUID-2C8EF307-908F-4C3F-A6C1-AF995AA77947" class="sect5"><span class="enumeration_section">5.5.7.10</span>运行Observer时修补环境并启用快速启动故障转移</h5>
                     <div>
                        <p>要修补运行Observer并启用快速启动故障转移的环境，请在应用修补程序之前执行以下步骤。</p>
                        <div class="section">
                           <ol>
                              <li>
                                 <p>使用DGMGRL <code class="codeph">STOP</code> <code class="codeph">OBSERVER</code>命令停止观察者。如果已为配置启动了多个观察者，请确保指定要修补其环境的<span class="variable" translate="no">observer-name</span> （ <code class="codeph">STOP OBSERVER</code> <span class="variable" translate="no">observer-name</span> ）。主要和目标备用数据库必须具有连接，以便<code class="codeph">STOP OBSERVER</code>命令成功完成。
                                 </p>
                              </li>
                              <li>
                                 <p>使用DGMGRL <code class="codeph">DISABLE</code> <code class="codeph">FAST_START</code> <code class="codeph">FAILOVER</code>命令禁用快速启动故障转移。请注意，主要和目标备用数据库必须具有此命令的连接才能成功完成。
                                 </p>
                                 <div class="infoboxnote" id="GUID-2C8EF307-908F-4C3F-A6C1-AF995AA77947__GUID-2B585D69-B115-45A1-900F-28C62BC0EF1C">
                                    <p class="notep1">注意：</p>如果只有备份观察者，但没有主要观察者在要修补的环境中运行，则无需禁用快速启动故障转移。
                                 </div>
                              </li>
                           </ol>
                           <p>将修补程序成功应用于所有数据库后，请执行以下步骤以启用快速启动故障转移并启动观察器。</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li><span>使用DGMGRL <code class="codeph">ENABLE</code> <code class="codeph">FAST_START</code> <code class="codeph">FAILOVER</code>命令启用快速启动故障转移。主要和目标备用数据库必须具有连接才能成功完成此命令。</span></li>
                           <li><span>使用DGMGRL <code class="codeph">START</code> <code class="codeph">OBSERVER</code>命令启动观察者。如果配置有多个观察者，那么请确保指定其环境刚被修补的<span class="variable" translate="no">observer-name</span> （ <code class="codeph">START OBSERVER</code> <span class="variable" translate="no">observer-name</span> ）。</span></li>
                        </ol>
                     </div>
                  </div>
               </div><a id="DGBKR395"></a><div class="props_rev_3"><a id="GUID-319C443F-4386-49B1-A0FC-9C4166D061CA" name="GUID-319C443F-4386-49B1-A0FC-9C4166D061CA"></a><h4 id="DGBKR-GUID-319C443F-4386-49B1-A0FC-9C4166D061CA" class="sect4"><span class="enumeration_section">5.5.8</span>在Broker配置中恢复前主数据库</h4>
                  <div>
                     <p><span class="bold">恢复原状</span>恢复高可用性代理配置，以便在新的主数据库发生故障的情况下，可能会出现另一种快速启动故障。
                     </p>
                     <p>如果由于主数据库崩溃或丢失与主观察器和目标备用数据库的连接而启动了快速启动故障转移，则主观察器会自动尝试将以前的主数据库<span class="italic">恢复</span>为备用数据库，如果设置了<code class="codeph">FastStartFailoverAutoReinstate</code>配置属性为<code class="codeph">TRUE</code> 。恢复的数据库充当新主数据库的快速启动故障转移目标，从而使后续的快速启动故障转移成为可能。当新备用数据库开始接收从新主数据库接收的重做数据时，它是故障转移的可行目标。
                     </p>
                     <p>要允许主观察器自动恢复以前的主数据库，必须启动并装入数据库。如果启用了快速启动故障转移，则不允许在任何情况下打开它。代理将数据库恢复为与新主数据库的旧备用数据库相同类型的备用数据库。</p>
                     <p>如果无法自动恢复以前的主数据库，则可以使用DGMGRL <code class="codeph">REINSTATE</code>命令或Cloud Control手动恢复它。有关手动恢复的分步说明，请<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D1C0709A-FBF0-4635-95A4-385506A5EC2D" title="To restore your original disaster-recovery solution after switchover to a logical standby database or after failover to any standby database, you may need to perform additional steps.">参阅角色更改后</a>重新<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D1C0709A-FBF0-4635-95A4-385506A5EC2D" title="要在切换到逻辑备用数据库后或故障转移到任何备用数据库后还原原始灾难恢复解决方案，可能需要执行其他步骤。">启用已禁用的数据库</a> 。
                     </p>
                  </div><a id="DGBKR3421"></a><div class="props_rev_3"><a id="GUID-05BB6664-5DDD-4B07-B076-79BB7BBCED2B" name="GUID-05BB6664-5DDD-4B07-B076-79BB7BBCED2B"></a><h5 id="DGBKR-GUID-05BB6664-5DDD-4B07-B076-79BB7BBCED2B" class="sect5"><span class="enumeration_section">5.5.8.1</span>要求</h5>
                     <div>
                        <p>仅在代理配置中进行故障转移后才支持恢复。它还要求在主数据库和目标备用数据库上启用闪回数据库。</p>
                        <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-7EAF1865-2F92-4451-8565-D3C6EC4F8005" title="在代理允许您启用快速启动故障转移之前，必须满足一些先决条件。">启用快速启动故障切换的先决条件</a>提供了有关所有快速启动故障切换和恢复要求的完整信息。
                        </p>
                     </div>
                  </div><a id="DGBKR3422"></a><div class="props_rev_3"><a id="GUID-B6311A77-B9C9-4A54-AED0-94C373357973" name="GUID-B6311A77-B9C9-4A54-AED0-94C373357973"></a><h5 id="DGBKR-GUID-B6311A77-B9C9-4A54-AED0-94C373357973" class="sect5"><span class="enumeration_section">5.5.8.2</span>恢复限制</h5>
                     <div>
                        <p>此列表描述代理无法自动恢复以前的主数据库的条件。</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>发生快速启动故障转移是因为检测到用户可配置的条件或者应用程序通过调用<code class="codeph">DBMS_DG.INITIATE_FS_FAILOVER</code>函数请求了该<code class="codeph">DBMS_DG.INITIATE_FS_FAILOVER</code> 。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">FastStartFailoverAutoReinstate</code>设置为<code class="codeph">FALSE</code></p>
                           </li>
                           <li>
                              <p>另一种故障切换或转移的快速启动故障切换完成<span class="italic">后</span>发生，但重新启动以前的主数据库<span class="italic">之前</span></p>
                           </li>
                           <li>
                              <p>快速启动故障转移已禁用</p>
                           </li>
                           <li>
                              <p>主观察者无法连接到以前的主数据库</p>
                           </li>
                           <li>
                              <p>以前的主数据库无法连接到新的主数据库</p>
                           </li>
                           <li>
                              <p>前一个主数据库和新主数据库未在同一快速启动故障转移环境中配置</p>
                           </li>
                           <li>
                              <p>由于在禁用快速启动故障转移时手动进行故障转移，因此禁用了以前的主数据库</p>
                              <div class="infoboxnote" id="GUID-B6311A77-B9C9-4A54-AED0-94C373357973__GUID-4BE58E77-82E3-4795-9A2F-D6F031E33907">
                                 <p class="notep1">注意：</p>
                                 <p>在切换，手动故障转移或快速启动故障转移期间禁用的备用数据库不会自动恢复。</p>
                              </div>
                           </li>
                        </ul>
                        <p>如果自动恢复失败，代理将记录错误，并且以前的主数据库将保持挂载状态。此时，您可以：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>禁用快速启动故障转移（在<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-67878B37-39B5-402A-A219-69E7483405A1" title="禁用快速启动故障转移可防止观察者启动到目标备用数据库的故障转移。">禁用快速</a>启动故障转移中描述）并尝试打开以前的主数据库</p>
                           </li>
                           <li>
                              <p>手动恢复以前的主数据库，如<a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-D1C0709A-FBF0-4635-95A4-385506A5EC2D" title="要在切换到逻辑备用数据库后或故障转移到任何备用数据库后还原原始灾难恢复解决方案，可能需要执行其他步骤。">角色更改后重新启用已禁用的数据库中所述</a></p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="DGBKR3423"></a><div class="props_rev_3"><a id="GUID-A8921D04-D4E3-4C4F-8441-FFAA279F7835" name="GUID-A8921D04-D4E3-4C4F-8441-FFAA279F7835"></a><h5 id="DGBKR-GUID-A8921D04-D4E3-4C4F-8441-FFAA279F7835" class="sect5"><span class="enumeration_section">5.5.8.3</span>代理如何处理失败的恢复</h5>
                     <div>
                        <p>如果正在进行恢复操作（自动或手动）时发生故障，则代理会在代理配置文件和代理日志文件中记录相应的信息。</p>
                        <p>以前的主数据库已禁用。无法重新启动大多数正在进行的故障（例如，主数据库上的归档重做日志文件损坏）。您必须手动将数据库重新创建为备用数据库，然后重新启用它。<a id="d12681e6393" class="indexterm-anchor"></a><a id="d12681e6397" class="indexterm-anchor"></a><a id="d12681e6401" class="indexterm-anchor"></a></p>
                        <div class="infoboxnotealso" id="GUID-A8921D04-D4E3-4C4F-8441-FFAA279F7835__GUID-46F7B537-3907-468D-AB83-C6AA64891507">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="using-data-guard-broker-to-manage-switchovers-failovers.html#GUID-CA638065-9E57-420F-852B-D05065B6DE24" title="如果重新创建旧的主数据库，则必须将其创建为旧备用数据库的备用类型。">如何重新创建和重新启用已禁用的数据库</a></p>
                        </div>
                     </div>
                  </div>
               </div><a id="DGBKR3424"></a><div class="props_rev_3"><a id="GUID-350624B9-ABAD-4894-89AE-7431D52D3818" name="GUID-350624B9-ABAD-4894-89AE-7431D52D3818"></a><h4 id="DGBKR-GUID-350624B9-ABAD-4894-89AE-7431D52D3818" class="sect4"><span class="enumeration_section">5.5.9</span>在快速启动故障转移环境中关闭数据库</h4>
                  <div>
                     <p>如有必要，可以在快速启动故障转移环境中关闭主数据库或目标备用数据库。</p>
                     <div class="section">
                        <p>执行以下步骤：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li><span>停止观察者并等待<code class="codeph">V$FS_FAILOVER_OBSERVERS</code>修复视图中所有行的<code class="codeph">REGISTERED</code>列包含主数据库和目标备用数据库的值<code class="codeph">NO</code> 。这可确保在关闭主数据库时不会发生快速启动故障转移。</span></li>
                        <li><span>使用DGMGRL <code class="codeph">SHUTDOWN</code>命令或SQL * Plus <code class="codeph">SHUTDOWN</code>语句关闭主数据库和目标备用数据库。</span></li>
                     </ol>
                     <div class="section">
                        <p>什么时候<a id="d12681e6463" class="indexterm-anchor"></a><a id="d12681e6469" class="indexterm-anchor"></a><a id="d12681e6473" class="indexterm-anchor"></a>重新启动数据库，您可以按任何顺序重新启动它们。重新启动两个数据库后，您可以重新启动观察器。
                        </p>
                        <p>旁观者备用数据库可以随时以任何顺序关闭，而不会影响快速启动故障转移。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="DGBKR3425"></a><div class="props_rev_3"><a id="GUID-790C40A3-B712-4AEB-B70E-1B7987C6315C" name="GUID-790C40A3-B712-4AEB-B70E-1B7987C6315C"></a><h3 id="DGBKR-GUID-790C40A3-B712-4AEB-B70E-1B7987C6315C" class="sect3"><span class="enumeration_section">5.6</span>数据库客户端注意事项</h3>
               <div>
                  <p>发生代理管理的故障转移时，事件通知和数据库连接故障转移支持可用于连接到本地数据库服务的数据库客户端。</p>
                  <p>有关全局服务的事件通知和数据库连接故障转移支持的信息，请参阅“ <a href="../gsmug/intro-global-data-services.html#GSMUG123" target="_blank"><span class="italic">Oracle数据库全局数据服务概念和管理指南”</span></a> 。
                  </p>
                  <p>故障转移后，代理发布快速应用程序通知（FAN）事件。这些FAN事件可以通过以下方式使用：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>如果应用程序使用其中一个Oracle集成数据库客户端，则可以使用FAN而无需进行编程更改：Oracle数据库JDBC，Oracle数据库Oracle调用接口（OCI），Oracle数据提供程序（ODP.NET）或Java通用连接池。可以将这些客户端配置为快速连接故障转移（FCF），以便在故障转移后自动连接到新的主数据库。</p>
                     </li>
                     <li>
                        <p>JAVA应用程序可以通过使用JDBC FAN应用程序编程接口以编程方式使用FAN来订阅FAN事件并在收到事件时执行事件处理操作。</p>
                     </li>
                     <li>
                        <p>可以在数据库层上配置FAN服务器端标注。</p>
                     </li>
                  </ul>
                  <p>使用Oracle Notification Services（ONS）为Oracle Database 12c及更高版本中的所有Oracle集成数据库客户端发布FAN事件。在以前的版本中，OCI和ODP.NET客户端通过Oracle Advanced Queuing（AQ）接收FAN通知。</p>
                  <div class="infoboxnote" id="GUID-790C40A3-B712-4AEB-B70E-1B7987C6315C__GUID-6A2DEF78-1B69-4A99-89B0-47BAF4AC0F70">
                     <p class="notep1">注意：</p>
                     <p>必须在Oracle Restart中注册单实例数据库才能通过ONS发布FAN事件。</p>
                  </div>
                  <div class="infoboxnotealso" id="GUID-790C40A3-B712-4AEB-B70E-1B7987C6315C__GUID-8E2591C6-B494-4B25-A536-173A942D7F59">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>有关在Oracle Real Application Clusters（Oracle RAC）数据库上配置FAN，FCF和ONS的详细信息，请参阅<a href="../racad/ensuring-application-continuity.html#RACAD7128" target="_blank"><span class="italic">“Oracle Real Application Clusters管理和部署指南”</span></a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="DGBKR3546"></a><div class="props_rev_3"><a id="GUID-DFFDAA2B-A889-49AD-AB85-747D73FF0FF5" name="GUID-DFFDAA2B-A889-49AD-AB85-747D73FF0FF5"></a><h4 id="DGBKR-GUID-DFFDAA2B-A889-49AD-AB85-747D73FF0FF5" class="sect4"><span class="enumeration_section">5.6.1</span> Oracle Data Guard特定的FAN和FCF配置要求</h4>
                  <div>
                     <p>必须满足配置要求才能发布和正确处理由代理管理的故障转移生成的FAN事件。</p>
                     <p>这些要求是对先前引用的文档和以下客户特定指南中描述的要求的补充：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="../jjdbc/JDBC-getting-started.html#JJDBC20000" target="_blank"><span class="italic">Oracle数据库JDBC开发人员指南</span></a></p>
                        </li>
                        <li>
                           <p><a href="../lnoci/oci-programming-basics.html#LNOCI020" target="_blank"><span class="italic">Oracle调用接口程序员指南</span></a></p>
                        </li>
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/dgbkr&amp;id=ODPNT130" target="_blank"><span class="italic">适用于Microsoft Windows的Oracle数据提供程序开发人员指南</span></a></p>
                        </li>
                     </ul>
                  </div><a id="DGBKR3547"></a><div class="props_rev_3"><a id="GUID-47350552-679A-4567-82DC-A316F7DE3FA2" name="GUID-47350552-679A-4567-82DC-A316F7DE3FA2"></a><h5 id="DGBKR-GUID-47350552-679A-4567-82DC-A316F7DE3FA2" class="sect5"><span class="enumeration_section">5.6.1.1</span> Oracle Net配置要求</h5>
                     <div>
                        <p>要进行快速连接故障转移（FCF），客户端必须能够在故障转移后找到新的主数据库。</p>
                        <div class="section">
                           <p>本节介绍如何配置满足此要求的Oracle Net连接描述符。</p>
                           <p>可以使用以下两种方法之一配置连接描述符：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>配置连接描述符以进行连接时故障转移。将主数据库和每个备用数据库添加到地址列表中。将<code class="codeph">CONNECT_TIMEOUT</code>参数设置为较小的值，以最大限度地减少网络地址不可用时所经历的延迟。如果资源争用导致在正常操作期间发生连接超时，请增加此参数的值。</span><div>
                                 <p>例如：</p><pre class="oac_no_warn" dir="ltr">sales =（DESCRIPTION =（FAILOVER = ON）（CONNECT_TIMEOUT = 5）（ADDRESS_LIST =（ADDRESS =（HOST = boston-scan）（PORT = 1521））（ADDRESS =（HOST = dallas-scan）（PORT = 1521）） ）（CONNECT_DATA =（SERVICE_NAME =销售）））</pre></div>
                           </li>
                           <li class="stepexpand"><span>使用向全局命名服务（如DNS或LDAP）注册的单个网络名称配置连接描述符。根据<code class="codeph">DB_ROLE_CHANGE</code>系统事件创建触发器，该事件在故障转移后将与网络名称关联的网络地址更改为新主数据库的网络地址。</span><div>
                                 <div class="infoboxnotealso" id="GUID-47350552-679A-4567-82DC-A316F7DE3FA2__GUID-A4F2387C-C35F-4C35-83BF-03E126F4EB0E">
                                    <p class="notep1">也可以看看：</p>
                                    <p></p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p>有关<code class="codeph">DB_ROLE_CHANGE</code>系统事件的更多信息，请<a href="../lnpls/plsql-triggers.html#LNPLS20141" target="_blank"><span class="italic">参见Oracle Database PL / SQL语言参考</span></a></p>
                                       </li>
                                    </ul>
                                 </div>
                              </div>
                           </li>
                        </ol>
                        <div class="section">
                           <p>在任何一种情况下，连接描述符都必须包含<code class="codeph">SERVICE_NAME</code>参数。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="DGBKR3548"></a><div class="props_rev_3"><a id="GUID-05918DD1-FB0F-435B-873B-A43BEC1C7638" name="GUID-05918DD1-FB0F-435B-873B-A43BEC1C7638"></a><h5 id="DGBKR-GUID-05918DD1-FB0F-435B-873B-A43BEC1C7638" class="sect5"><span class="enumeration_section">5.6.1.2</span>数据库服务配置要求</h5>
                     <div>
                        <p>可以将数据库服务配置为在Oracle RAC数据库和Oracle Restart管理的单实例数据库上的特定数据库角色中处于活动状态。</p>
                        <p>代理与Oracle Clusterware或Oracle Restart交互以确保相应的数据库服务处于活动状态，并在角色更改后发布相应的FAN事件。</p>
                        <p>FAN事件总是通过ONS发布。但是，仅当数据库在新主数据库中处于主要角色时，才会为已配置为活动的数据库服务发布通知故障转移的事件。</p>
                        <p>必须在任何给定数据库角色（主，物理备用，逻辑备用或快照备用）中处于活动状态的服务必须在服务必须处于活动状态的每个数据库上显式配置服务器控制实用程序（SRVCTL）。</p>
                        <p>在以下示例命令中，名为<code class="codeph">PAYROLL</code>的服务配置为在主数据库<code class="codeph">NORTH</code>上的<code class="codeph">PRIMARY</code>角色中处于活动状态。然后，将服务配置为在备用数据库<code class="codeph">SOUTH</code>上的<code class="codeph">PRIMARY</code>角色中处于活动状态，以便在角色转换后它将在该数据库上处于活动状态。在这些示例命令中，椭圆（...）表示您希望提供的任何其他<code class="codeph">add service</code>选项。
                        </p>
                        <div class="infoboxnote" id="GUID-05918DD1-FB0F-435B-873B-A43BEC1C7638__GUID-F77BB3A9-2967-468F-9BDB-B2A904222227">
                           <p class="notep1">注意：</p>
                           <p>本节中显示的示例不一定显示您可能需要在自己的环境中使用的特定属性。所需属性因您的配置而异（包括您的环境是基于Oracle RAC还是单实例）。有关详细信息，请参阅相应的Oracle RAC或Oracle Restart文档。</p>
                        </div>
                        <p>在主数据库<code class="codeph">NORTH</code> ，执行以下命令：</p><pre class="oac_no_warn" dir="ltr">srvctl添加服务-db NORTH -service PAYROLL -role PRIMARY ...
</pre><p>在备用数据库<code class="codeph">SOUTH</code> ，执行以下命令：</p><pre class="oac_no_warn" dir="ltr">srvctl添加服务-db SOUTH -service PAYROLL -role PRIMARY ...
</pre><p>无论是否在该数据库上启动该服务，还必须在当前主数据库上创建并启动在数据库处于物理备用角色时要处于活动状态的服务。这是为了确保服务定义通过重做流传播到物理备用数据库，从而允许在物理备用数据库上启动服务。只有在应用了启动服务生成的重做之后，才能在物理备用服务器上启动该服务。重要的是所有SRVCTL <code class="codeph">add</code> <code class="codeph">service</code>选项在所有数据库上都是相同的，以便服务在角色更改之前和之后的行为方式相同。
                        </p>
                        <p>如果所有数据库都没有相同的值，则SRVCTL会尝试覆盖这些值，这些值将在物理备用数据库上失败，因为它是以只读方式打开的。在以下示例中，名为<code class="codeph">sales</code>的服务配置为在主数据库<code class="codeph">NORTH</code>上的<code class="codeph">PHYSICAL_STANDBY</code>角色中处于活动状态。然后在主数据库上启动和停止它。如果无意在当前主数据库上运行此服务，也可以选择从主数据库中删除它。然后将其配置为在物理备用数据库<code class="codeph">SOUTH</code>上的<code class="codeph">PHYSICAL_STANDBY</code>角色中处于活动状态。</p>
                        <p>在主数据库<code class="codeph">NORTH</code>上执行以下操作：</p><pre class="oac_no_warn" dir="ltr">srvctl add service -db NORTH -service SALES -role PHYSICAL_STANDBY ...srvctl启动服务-db NORTH -service SALES srvctl stop service -db NORTH -service SALES</pre><p>在物理备用数据库<code class="codeph">SOUTH</code>上执行以下操作：</p><pre class="oac_no_warn" dir="ltr">srvctl添加服务-db SOUTH -service SALES -role PHYSICAL_STANDBY ...
</pre><p>如果代理现在执行切换或故障转移，它将根据数据库的角色自动在正确的数据库上启动<code class="codeph">SALES</code>服务。
                        </p>
                        <p>前面的示例涉及在数据库上仅设置一个服务。以下示例说明如何在数据库上设置多个服务以及如何使用代理确保在正确的数据库上启动正确的服务。</p>
                        <p>假设您有一个主数据库， <code class="codeph">BOSTON</code>和备用数据库<code class="codeph">CHICAGO</code> 。发出以下SRVCTL命令，以便Data Guard配置中的两个数据库都知道每个数据库的两个潜在服务：</p>
                        <p>在<code class="codeph">BOSTON</code></p><pre class="oac_no_warn" dir="ltr">srvctl添加服务-db BOSTON -service SALESRW -role PRIMARY -y AUTOMATIC srvctl add service -db BOSTON -service SALESRO -role PHYSICAL_STANDBY -policy AUTOMATIC</pre><p>在<code class="codeph">CHICAGO</code> ：</p><pre class="oac_no_warn" dir="ltr">srvctl添加服务-db CHICAGO -s SALESRW -role PRIMARY -y AUTOMATIC srvctl add service -db CHICAGO -s SALESRO -role PHYSICAL_STANDBY -policy AUTOMATIC</pre><p>要最初启动，必须在右侧节点上手动启动服务。您还必须在主服务器上启动和停止<code class="codeph">SALESRO</code>服务，以便可以在备用服务器上启动它。发出以下SRVCTL命令：</p>
                        <p>在<code class="codeph">BOSTON</code> ：</p><pre class="oac_no_warn" dir="ltr">srvctl启动服务-db BOSTON -service SALESRW srvctl启动服务-db BOSTON -service SALESRO srvctl停止服务-db BOSTON -service SALESRO</pre><p>在<code class="codeph">CHICAGO</code> ：</p><pre class="oac_no_warn" dir="ltr">srvctl启动服务-db CHICAGO -service SALESRO</pre><p>现在正确的服务正在正确的数据库上运行。</p>
                        <p>如果代理执行切换或故障转移，则它将根据数据库的当前角色启动服务<code class="codeph">SALESRW</code>或<code class="codeph">SALESRO</code> 。所以<code class="codeph">SALESRW</code>将从<code class="codeph">CHICAGO</code> （现在是主要的）开始， <code class="codeph">SALESRO</code>将从<code class="codeph">BOSTON</code>开始（现在是物理待机）。如果关闭并启动任一数据库，则会发生同样的情况 - 启动的服务是与正在启动的数据库的角色匹配的服务。
                        </p>
                        <p>请注意，如果在这些数据库中的任何一个上发出以下手动命令，则无论先前使用SRVCTL  - <code class="codeph">role</code>限定符指定了什么，都将在数据库上启动<code class="codeph">SALESRO</code>和<code class="codeph">SALESRW</code>服务。这是因为 - <code class="codeph">role</code>限定符仅由Data Guard代理和数据库启动时考虑在内。
                        </p>
                        <p>在<code class="codeph">BOSTON</code> ：</p><pre class="oac_no_warn" dir="ltr">srvctl启动服务-db CHICAGO</pre><p>在<code class="codeph">CHICAGO</code> ：</p><pre class="oac_no_warn" dir="ltr">srvctl启动服务-db BOSTON</pre><p>SRVCTL实用程序不会自动考虑数据库角色，因此每次手动启动服务时，都必须指定要启动的服务的名称。</p>
                        <div class="infoboxnote" id="GUID-05918DD1-FB0F-435B-873B-A43BEC1C7638__GUID-CA4443C9-B16B-445D-929C-E1167B85CD51">
                           <p class="notep1">注意：</p>
                           <p>如果服务已配置为自动启动（ <code class="codeph">-policy AUTOMATIC</code> ），则只有在更改数据库角色后，服务才会自动启动。
                           </p>
                        </div>
                        <div class="infoboxnote" id="GUID-05918DD1-FB0F-435B-873B-A43BEC1C7638__GUID-18690383-DF19-43C4-B68D-92C17301234D">
                           <p class="notep1">注意：</p>
                           <p>在Oracle Data Guard配置中，备用数据库的SRVCTL -start <code class="codeph">-startoption</code>在切换后始终设置为<code class="codeph">OPEN</code> 。
                           </p>
                        </div>
                        <div class="infoboxnotealso" id="GUID-05918DD1-FB0F-435B-873B-A43BEC1C7638__GUID-F4262129-FED3-488C-AD6D-B59F0C2271B1">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关Oracle RAC数据库，请参阅“ <a href="../racad/server-control-utility-reference.html#RACAD-GUID-803F603E-8638-4946-84D4-CB24D21C893C" target="_blank"><span><cite>Oracle Real Application Clusters管理和部署指南”</cite></span></a> ，以获取有关使用SRVCTL实用程序配置数据库服务的更多信息</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="DGBKR3549"></a><div class="props_rev_3"><a id="GUID-28A09260-5225-4C71-983A-ED99B5329CB2" name="GUID-28A09260-5225-4C71-983A-ED99B5329CB2"></a><h5 id="DGBKR-GUID-28A09260-5225-4C71-983A-ED99B5329CB2" class="sect5"><span class="enumeration_section">5.6.1.3</span> ONS配置要求</h5>
                     <div>
                        <p>如果使用客户端ONS配置，则客户端ONS配置文件必须指定主数据库和每个备用数据库的ONS守护程序的主机名和端口。</p>
                        <p>如果客户端使用远程ONS订阅，则客户端必须指定主数据库和每个备用数据库的ONS守护程序的主机名和端口。</p>
                     </div>
                  </div><a id="DGBKR3926"></a><div class="props_rev_3"><a id="GUID-84302AF8-2D6D-436C-AEC9-CD36D76C9F7D" name="GUID-84302AF8-2D6D-436C-AEC9-CD36D76C9F7D"></a><h5 id="DGBKR-GUID-84302AF8-2D6D-436C-AEC9-CD36D76C9F7D" class="sect5"><span class="enumeration_section">5.6.1.4</span>应用程序连续性</h5>
                     <div>
                        <p>应用程序连续性是一种Oracle数据库功能，可在发生数据库会话不可用的可恢复错误后，对数据库进行快速，无中断的请求重放。</p>
                        <p>Oracle Data Guard切换到物理备用数据库支持应用程序连续性。它还支持在最大可用性数据保护模式下快速启动到物理备用数据库的故障转移。请注意，必须为Oracle RAC或Oracle Active Data Guard许可主数据库和备用数据库才能使用应用程序连续性。</p>
                        <div class="infoboxnotealso" id="GUID-84302AF8-2D6D-436C-AEC9-CD36D76C9F7D__GUID-F0097D5D-B12F-498A-8253-FA60778B27A5">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关应用程序连续性的信息<a href="../racad/ensuring-application-continuity.html#RACAD-GUID-BD699AEB-9F85-42A8-8687-5A979918938D" target="_blank"><span><cite>，请参见“Oracle Real Application Clusters管理和部署指南”</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>