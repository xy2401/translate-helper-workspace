<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>执行用户管理的恢复：高级方案</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96241-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="user-managed-flashback-dbpitr.html" title="Previous" type="text/html"></link>
      <link rel="next" href="glossary.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="BRADV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="user-managed-flashback-dbpitr.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="glossary.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复用户指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-user-managed-backup-recovery.html" property="item" typeof="WebPage"><span property="name">执行用户管理的备份和恢复</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">执行用户管理的恢复：高级方案</li>
            </ol>
            <a id="GUID-24903185-E2CE-452E-8370-E4A47AD2632B" name="GUID-24903185-E2CE-452E-8370-E4A47AD2632B"></a><a id="BRADV018"></a>
            
            <h2 id="BRADV-GUID-24903185-E2CE-452E-8370-E4A47AD2632B" class="sect2"><span class="enumeration_chapter">31</span>执行用户管理的恢复：高级方案</h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d146940e69" class="indexterm-anchor"></a><a id="d146940e73" class="indexterm-anchor"></a>这个<a id="d146940e78" class="indexterm-anchor"></a>本章介绍几种常见的媒体故障情况。它显示了在使用用户管理的备份和恢复策略（即不依赖于Recovery Manager的策略）时如何从每个故障中恢复。本章包含以下主题：<a id="d146940e83" class="indexterm-anchor"></a><a id="d146940e87" class="indexterm-anchor"></a></p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="user-managed-recovery-advanced.html#GUID-22AD5382-06ED-4FDF-BDD4-C8CD682F83E0">响应当前控制文件的子集丢失</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-recovery-advanced.html#GUID-3913B513-ECF0-469A-A50A-A5A573C85DC0">丢失所有当前控制文件后恢复</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-recovery-advanced.html#GUID-9152B9A8-308A-4871-B835-53AF7593E65D">重新创建控制文件</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-recovery-advanced.html#GUID-E0032019-E245-4EBD-B275-1343AA175239">备份不可用时重新创建数据文件</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-recovery-advanced.html#GUID-617A3664-A605-4570-B22B-FE6793C469DF">恢复NOLOGGING表和索引</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-recovery-advanced.html#GUID-22FCD8A3-128E-4BFA-8744-5969695034E9">恢复可传输的表空间</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-recovery-advanced.html#GUID-BF09DCB4-AB6F-4886-AAC1-C2747BDF05D2">在线重做日志文件丢失后恢复</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-recovery-advanced.html#GUID-26C74474-50A7-46AA-A0EA-0649A795D5EA">在不使用闪回功能的情况下从丢弃的表中恢复</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-recovery-advanced.html#GUID-834054AF-7189-4CD6-93D4-1CD4EB6BF1F1">使用SQL * Plus删除数据库</a></p>
                  </li>
               </ul>
            </div><a id="BRADV90039"></a><div class="props_rev_3"><a id="GUID-22AD5382-06ED-4FDF-BDD4-C8CD682F83E0" name="GUID-22AD5382-06ED-4FDF-BDD4-C8CD682F83E0"></a><h3 id="BRADV-GUID-22AD5382-06ED-4FDF-BDD4-C8CD682F83E0" class="sect3"><span class="enumeration_section">31.1</span>响应当前控制文件子集的丢失</h3>
               <div>
                  <p><a id="d146940e208" class="indexterm-anchor"></a><a id="d146940e214" class="indexterm-anchor"></a>如果永久性介质故障已损坏数据库的一个或多个控制文件且至少有一个当前控制文件<span class="italic">未被</span>介质故障损坏，请使用以下过程恢复数据库。
                  </p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="user-managed-recovery-advanced.html#GUID-A4F29C29-95A7-4F05-8638-9C921AF9E0DC">将多路复用控制文件复制到默认位置</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-recovery-advanced.html#GUID-49F97453-C0B3-4F18-B94C-63FB5C780BC3">将多路复用控制文件复制到非默认位置</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV508"></a><a id="BRADV90040"></a><div class="props_rev_3"><a id="GUID-A4F29C29-95A7-4F05-8638-9C921AF9E0DC" name="GUID-A4F29C29-95A7-4F05-8638-9C921AF9E0DC"></a><h4 id="BRADV-GUID-A4F29C29-95A7-4F05-8638-9C921AF9E0DC" class="sect4"><span class="enumeration_section">31.1.1</span>将多路复用控制文件复制到默认位置</h4>
                  <div>
                     <div class="section">
                        <p><a id="d146940e322" class="indexterm-anchor"></a><a id="d146940e326" class="indexterm-anchor"></a>如果包含丢失的控制文件的磁盘和文件系统完好无损，则只需将完整的控制文件复制到丢失的控制文件的位置即可。在这种情况下，您不必编辑<code class="codeph">CONTROL_FILES</code>初始化参数。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-A4F29C29-95A7-4F05-8638-9C921AF9E0DC__GUID-F4D4B429-E2B1-42EE-AD44-87ACD392F046">要通过复制多路复用控制文件来替换损坏的控制文件：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span><a id="d146940e338" class="indexterm-anchor"></a><a id="d146940e342" class="indexterm-anchor"></a><a id="d146940e348" class="indexterm-anchor"></a><a id="d146940e352" class="indexterm-anchor"></a>如果实例仍在运行，请将其关闭：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; SHUTDOWN ABORT</pre></div>
                        </li>
                        <li class="stepexpand"><span>纠正导致介质故障的硬件问题。如果无法快速修复硬件问题，请通过将损坏的控制文件还原到备用存储设备来继续进行数据库恢复，如<span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-49F97453-C0B3-4F18-B94C-63FB5C780BC3">将多路复用控制文件复制到非默认位置</a> ”中所述</span> 。</span></li>
                        <li class="stepexpand"><span>使用数据库当前控制文件的完整多路复用副本来复制损坏的控制文件。例如，要将<code class="codeph">bad_cf.f</code>替换为<code class="codeph">good_cf.f</code> ，您可以输入：</span><div><pre class="oac_no_warn" dir="ltr">％cp /oracle/good_cf.f /oracle/dbs/bad_cf.f</pre></div>
                        </li>
                        <li class="stepexpand"><span>启动一个新实例并装入并打开数据库。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; STARTUP</pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV509"></a><a id="BRADV90041"></a><div class="props_rev_3"><a id="GUID-49F97453-C0B3-4F18-B94C-63FB5C780BC3" name="GUID-49F97453-C0B3-4F18-B94C-63FB5C780BC3"></a><h4 id="BRADV-GUID-49F97453-C0B3-4F18-B94C-63FB5C780BC3" class="sect4"><span class="enumeration_section">31.1.2</span>将多路复用控制文件复制到非缺省位置</h4>
                  <div>
                     <div class="section">
                        <p>如果包含丢失的控制文件的磁盘和文件系统不完整，则无法将良好的控制文件复制到丢失的控制文件的位置。在这种情况下，您必须更改<code class="codeph">CONTROL_FILES</code>初始化参数以指示缺少的控制文件的新位置。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-49F97453-C0B3-4F18-B94C-63FB5C780BC3__GUID-D6A4A3CA-2FEA-40E9-AB13-037D4F41D1F8">要将控制文件还原到非默认位置：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span><a id="d146940e481" class="indexterm-anchor"></a><a id="d146940e485" class="indexterm-anchor"></a><a id="d146940e491" class="indexterm-anchor"></a><a id="d146940e495" class="indexterm-anchor"></a>如果实例仍在运行，请将其关闭：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; SHUTDOWN ABORT</pre></div>
                        </li>
                        <li class="stepexpand"><span>如果无法更正导致介质故障的硬件问题，请将完整的控制文件复制到备用位置。</span><div>
                              <p>例如，要将良好版本的<code class="codeph">control01.dbf</code>复制到新磁盘位置，可以发出以下命令：</p><pre class="oac_no_warn" dir="ltr">％cp /disk1/oradata/trgt/control01.dbf /new_disk/control01.dbf</pre></div>
                        </li>
                        <li class="stepexpand"><span>编辑数据库的参数文件，以便<a id="d146940e517" class="indexterm-anchor"></a><a id="d146940e521" class="indexterm-anchor"></a> <code class="codeph">CONTROL_FILES</code>参数反映所有控制文件的当前位置，并排除未还原的所有控制文件。</span><div>
                              <p>假设初始化参数文件包含以下设置：</p><pre class="oac_no_warn" dir="ltr">CONTROL_FILES = '/磁盘1 / ORADATA / TRGT / control01.dbf'， '/ bad_disk / control02.dbf'</pre><p>您可以编辑<code class="codeph">CONTROL_FILES</code>初始化参数，如下所示：</p><pre class="oac_no_warn" dir="ltr">CONTROL_FILES = '/磁盘1 / ORADATA / TRGT / control01.dbf'， '/ new_disk / control02.dbf'</pre></div>
                        </li>
                        <li class="stepexpand"><span>启动一个新实例并装入并打开数据库。例如：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; STARTUP</pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div><a id="BRADV510"></a><a id="BRADV90042"></a><div class="props_rev_3"><a id="GUID-3913B513-ECF0-469A-A50A-A5A573C85DC0" name="GUID-3913B513-ECF0-469A-A50A-A5A573C85DC0"></a><h3 id="BRADV-GUID-3913B513-ECF0-469A-A50A-A5A573C85DC0" class="sect3"><span class="enumeration_section">31.2</span>丢失所有当前控制文件后恢复</h3>
               <div>
                  <p>如果永久性介质故障已损坏数据库的所有控制文件并且您具有控制文件的备份，请使用以下过程还原备份控制文件。当控制文件不可访问时，您可以启动实例，但不能装入数据库。如果在控制文件不可用时尝试装入数据库，则会收到以下错误消息：</p><pre class="oac_no_warn" dir="ltr">ORA-00205：识别控制文件时出错，请查看警报日志以获取更多信息</pre><div class="infoboxnote" id="GUID-3913B513-ECF0-469A-A50A-A5A573C85DC0__GUID-57E684EC-3EB5-4A93-9DA9-7372ECBB8C89">
                     <p class="notep1">注意：</p>
                     <p>查找跟踪文件和警报日志的最简单方法是运行以下SQL查询： <code class="codeph">SELECT NAME, VALUE FROM V$DIAG_INFO</code> 。</p>
                  </div>
                  <p>在再次访问控制文件之前，无法装入和打开数据库。如果还原备份控制文件，则必须使用<code class="codeph">RESETLOGS</code>选项打开数据库。
                  </p>
                  <p>如<a href="user-managed-recovery-advanced.html#GUID-3913B513-ECF0-469A-A50A-A5A573C85DC0__CHDHFGEI" title="此表列出了控制文件丢失的几种方案的还原过程，具体取决于联机日志和数据文件的状态。">表31-1所示</a> ，恢复控制文件的过程取决于联机重做日志是否可用。
                  </p>
                  <div class="tblformal" id="GUID-3913B513-ECF0-469A-A50A-A5A573C85DC0__CHDHFGEI">
                     <p class="titleintable">表31-1控制文件丢失时的方案</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="控制文件丢失时的方案" width="100%" border="1" summary="This table lists restore procedures for several scenarios in which the control files are lost, depending upon the status of the online logs and datafiles." frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="25%" id="d146940e648">在线日志的状态</th>
                              <th align="left" valign="bottom" width="25%" id="d146940e651">数据文件的状态</th>
                              <th align="left" valign="bottom" width="50%" id="d146940e654">恢复程序</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="25%" id="d146940e659" headers="d146940e648 ">
                                 <p>可得到</p>
                              </td>
                              <td align="left" valign="top" width="25%" headers="d146940e659 d146940e651 ">
                                 <p>当前</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d146940e659 d146940e654 ">
                                 <p>如果联机日志包含恢复所需的重做，则还原备份控制文件并在恢复期间应用日志。您必须指定包含更改的联机日志的文件名以打开数据库。恢复后，使用<code class="codeph">RESETLOGS</code>选项打开数据库。
                                 </p>
                                 <p><span class="bold">注意：</span>如果重新创建控制文件，则在恢复后可以访问联机重做日志时无需使用<code class="codeph">OPEN</code> <code class="codeph">RESETLOGS</code>选项。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="25%" id="d146940e682" headers="d146940e648 ">
                                 <p>不可用</p>
                              </td>
                              <td align="left" valign="top" width="25%" headers="d146940e682 d146940e651 ">
                                 <p>当前</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d146940e682 d146940e654 ">
                                 <p>如果联机日志包含恢复所需的重做，则重新创建控制文件。由于无法访问联机重做日志，请打开<code class="codeph">RESETLOGS</code> 。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="25%" id="d146940e695" headers="d146940e648 ">
                                 <p>可得到</p>
                              </td>
                              <td align="left" valign="top" width="25%" headers="d146940e695 d146940e651 ">
                                 <p>备用</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d146940e695 d146940e654 ">
                                 <p>还原备份控制文件，执行完全恢复，然后使用<code class="codeph">RESETLOGS</code>选项打开数据库。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="25%" id="d146940e708" headers="d146940e648 ">
                                 <p>不可用</p>
                              </td>
                              <td align="left" valign="top" width="25%" headers="d146940e708 d146940e651 ">
                                 <p>备用</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d146940e708 d146940e654 ">
                                 <p>还原备份控制文件，执行不完整的恢复，然后打开<code class="codeph">RESETLOGS</code> 。</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="user-managed-recovery-advanced.html#GUID-B798CEB4-E8BE-467A-B17D-DBB993E912BE">使用默认位置中的备份控制文件进行恢复</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-recovery-advanced.html#GUID-48CAA587-BD0E-4F94-BD6B-BF21520E53EF">使用非默认位置中的备份控制文件进行恢复</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-recovery-advanced.html#GUID-88CAB555-C409-4805-B6A4-C92401422EF7">使用备份控制文件通过添加的数据文件进行恢复</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-recovery-advanced.html#GUID-CEF04736-4A56-4560-AD8E-948300F6C80F">使用备份控制文件恢复只读表空间</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV511"></a><a id="BRADV90043"></a><div class="props_rev_3"><a id="GUID-B798CEB4-E8BE-467A-B17D-DBB993E912BE" name="GUID-B798CEB4-E8BE-467A-B17D-DBB993E912BE"></a><h4 id="BRADV-GUID-B798CEB4-E8BE-467A-B17D-DBB993E912BE" class="sect4"><span class="enumeration_section">31.2.1</span>使用默认位置中的备份控制文件进行恢复</h4>
                  <div>
                     <div class="section">
                        <p>如果可能，将控制文件还原到其原始位置。这样，您就可以避免在初始化参数文件中指定新的控制文件位置。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-B798CEB4-E8BE-467A-B17D-DBB993E912BE__GUID-71BA3FD2-A0D7-492F-88A9-F0CF492BACF2">要将备份控制文件还原到其默认位置：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>如果实例仍在运行，请将其关闭：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; SHUTDOWN ABORT</pre></div>
                        </li>
                        <li class="stepexpand"><span>纠正导致介质故障的硬件问题。</span></li>
                        <li class="stepexpand"><span>将备份控制文件还原到服务器参数文件或初始化参数文件中<code class="codeph">CONTROL_FILES</code>参数中指定的所有位置。例如，如果<code class="codeph">/disk1/oradata/trgt/control01.dbf</code>和<code class="codeph">/disk2/oradata/trgt/control02.dbf</code>是服务器参数文件中列出的控制文件位置，则使用操作系统实用程序将备份控制文件还原到这些地点：</span><div><pre class="oac_no_warn" dir="ltr">％cp /backup/control01.dbf /disk1/oradata/trgt/control01.dbf%cp/backup/control02.dbf /disk2/oradata/trgt/control02.dbf</pre></div>
                        </li>
                        <li class="stepexpand"><span>启动新实例并装入数据库。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; STARTUP MOUNT</pre></div>
                        </li>
                        <li class="stepexpand"><span>通过<code class="codeph">USING</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code>子句执行<code class="codeph">RECOVER</code>命令开始恢复。如果执行不完全恢复，请指定<code class="codeph">UNTIL</code> <code class="codeph">CANCEL</code> 。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; RECOVER DATABASE使用备份控制文件直到取消</pre></div>
                        </li>
                        <li class="stepexpand"><span>应用提示的存档日志。如果您随后收到另一条消息，指出缺少所需的归档日志，则可能意味着必要的重做记录位于联机重做日志中。当实例失败时，在联机日志中找到未归档的更改时，可能会发生这种情况。</span><div>
                              <p>例如，假设您看到以下内容：</p><pre class="oac_no_warn" dir="ltr">ORA-00279：更改55636生成于11/08/2002 16:59:47线程1 ORA-00289：建议：/oracle/work/arc_dest/arcr_1_111.arc ORA-00280：更改55636为线程1按顺序＃111指定日志：{&lt;RET&gt; =建议|文件名|自动|取消}</pre><p>您可以指定在线重做日志的名称，然后按Enter键（您可能需要尝试几次，直到找到正确的日志）：</p><pre class="oac_no_warn" dir="ltr"><span class="italic">ORACLE_HOME</span> /oradata/redo01.dbf已应用日志。媒体恢复完成。
</pre><p>如果无法访问在线日志，则可以取消恢复而不应用它们。如果所有数据文件都是最新的，并且如果需要在联机日志中重做进行恢复，则无法在不应用联机日志的情况下打开数据库。如果无法访问联机日志，则必须使用<span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-9152B9A8-308A-4871-B835-53AF7593E65D">重新创建控制文件</a> ”中</span>描述的过程<span class="q"><a href="user-managed-recovery-advanced.html#GUID-9152B9A8-308A-4871-B835-53AF7593E65D">重新创建控制文件</a></span> 。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>完成恢复后，使用<code class="codeph">RESETLOGS</code>选项打开数据库：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE OPEN RESETLOGS;</pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV512"></a><a id="BRADV90044"></a><div class="props_rev_3"><a id="GUID-48CAA587-BD0E-4F94-BD6B-BF21520E53EF" name="GUID-48CAA587-BD0E-4F94-BD6B-BF21520E53EF"></a><h4 id="BRADV-GUID-48CAA587-BD0E-4F94-BD6B-BF21520E53EF" class="sect4"><span class="enumeration_section">31.2.2</span>使用非默认位置中的备份控制文件进行恢复</h4>
                  <div>
                     <div class="section">
                        <p>如果由于介质损坏太严重而无法将控制文件还原到其原始位置，则必须在服务器参数文件中指定新的控制文件位置。<code class="codeph">CONTROL_FILES</code>初始化参数指定的所有位置都必须有一个有效的控制文件。如果没有，则数据库阻止您安装数据库。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-48CAA587-BD0E-4F94-BD6B-BF21520E53EF__GUID-E9C5452B-6BB6-4799-98F2-E351AB872C48">要将控制文件还原到非默认位置：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>如果实例仍在运行，请将其关闭：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; SHUTDOWN ABORT</pre></div>
                        </li>
                        <li class="stepexpand"><span>纠正导致介质故障的硬件问题。</span></li>
                        <li class="stepexpand"><span>编辑<code class="codeph">CONTROL_FILES</code>初始化参数中指定的所有位置以反映新的控制文件位置。假设服务器参数文件中列出的控制文件位置如下，并且两个磁盘都不可访问：</span><div><pre class="oac_no_warn" dir="ltr">CONTROL_FILES ='/ disk1 / oradata / trgt / control01.dbf'，'/ disk2 / oradata / trgt / control02.dbf'</pre><p>您可以编辑初始化参数文件并指定可访问的位置，如以下示例所示：</p><pre class="oac_no_warn" dir="ltr">CONTROL_FILES = '/磁盘3 / CF / control01.dbf'， '/磁盘4 / CF / control02.dbf'</pre></div>
                        </li>
                        <li class="stepexpand"><span>将备份控制文件还原到服务器参数文件或初始化参数文件中<code class="codeph">CONTROL_FILES</code>参数中指定的所有位置。例如，如果<code class="codeph">/disk1/oradata/trgt/control01.dbf</code>和<code class="codeph">/disk2/oradata/trgt/control02.dbf</code>是服务器参数文件中列出的控制文件位置，则使用操作系统实用程序将备份控制文件还原到这些地点：</span><div><pre class="oac_no_warn" dir="ltr">％cp /backup/control01.dbf /disk1/oradata/trgt/control01.dbf%cp/backup/control02.dbf /disk2/oradata/trgt/control02.dbf</pre></div>
                        </li>
                        <li class="stepexpand"><span>启动新实例并装入数据库。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; STARTUP MOUNT</pre></div>
                        </li>
                        <li class="stepexpand"><span>通过<code class="codeph">USING</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code>子句执行<code class="codeph">RECOVER</code>命令开始恢复。如果执行不完全恢复，请指定<code class="codeph">UNTIL</code> <code class="codeph">CANCEL</code> 。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; RECOVER DATABASE使用备份控制文件直到取消</pre></div>
                        </li>
                        <li class="stepexpand"><span>应用提示的存档日志。如果您随后收到另一条消息，指出缺少所需的归档日志，则可能意味着必要的重做记录位于联机重做日志中。当实例失败时，在联机日志中找到未归档的更改时，可能会发生这种情况。</span><div>
                              <p>例如，假设您看到以下内容：</p><pre class="oac_no_warn" dir="ltr">ORA-00279：更改55636生成于11/08/2002 16:59:47线程1 ORA-00289：建议：/oracle/work/arc_dest/arcr_1_111.arc ORA-00280：更改55636为线程1按顺序＃111指定日志：{&lt;RET&gt; =建议|文件名|自动|取消}</pre><p>您可以指定在线重做日志的名称，然后按Enter键（您可能需要尝试几次，直到找到正确的日志）：</p><pre class="oac_no_warn" dir="ltr"><span class="italic">ORACLE_HOME</span> /oradata/redo01.dbf已应用日志。媒体恢复完成。
</pre><p>如果无法访问在线日志，则可以取消恢复而不应用它们。如果所有数据文件都是最新的，并且如果需要在联机日志中重做进行恢复，则无法在不应用联机日志的情况下打开数据库。如果无法访问联机日志，则必须使用<span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-9152B9A8-308A-4871-B835-53AF7593E65D">重新创建控制文件</a> ”中</span>描述的过程<span class="q"><a href="user-managed-recovery-advanced.html#GUID-9152B9A8-308A-4871-B835-53AF7593E65D">重新创建控制文件</a></span> 。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>完成恢复后，使用<code class="codeph">RESETLOGS</code>选项打开数据库：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE OPEN RESETLOGS;</pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV513"></a><a id="BRADV223"></a><div class="props_rev_3"><a id="GUID-88CAB555-C409-4805-B6A4-C92401422EF7" name="GUID-88CAB555-C409-4805-B6A4-C92401422EF7"></a><h4 id="BRADV-GUID-88CAB555-C409-4805-B6A4-C92401422EF7" class="sect4"><span class="enumeration_section">31.2.3</span>使用备份控制文件通过添加的数据文件进行恢复</h4>
                  <div>
                     <div class="section">
                        <p><a id="d146940e1158" class="indexterm-anchor"></a><a id="d146940e1162" class="indexterm-anchor"></a><a id="d146940e1166" class="indexterm-anchor"></a>如果使用备份控制文件的数据库恢复通过<code class="codeph">CREATE</code> <code class="codeph">TABLESPACE</code>或<code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code> <code class="codeph">ADD</code> <code class="codeph">DATAFILE</code>操作前滚，则数据库会在为添加的文件应用重做记录时停止恢复，并允许您确认文件名。
                        </p>
                        <p>例如，假设发生以下事件序列：</p>
                        <ol>
                           <li>
                              <p>您备份数据库。</p>
                           </li>
                           <li>
                              <p>您创建一个包含以下数据文件的表空间： <code class="codeph">/disk1/oradata/trgt/test01.dbf</code>和<code class="codeph">/disk1/oradata/trgt/test02.dbf</code> 。
                              </p>
                           </li>
                           <li>
                              <p><a id="d146940e1207" class="indexterm-anchor"></a>您可以通过<code class="codeph">CREATE</code> <code class="codeph">TABLESPACE</code>操作还原备份控制文件并执行介质恢复。
                              </p>
                           </li>
                        </ol>
                        <p>应用<code class="codeph">CREATE</code> <code class="codeph">TABLESPACE</code>重做数据时，您可能会看到以下错误：</p><pre class="oac_no_warn" dir="ltr">ORA-00283：由于错误而取消恢复会话ORA-01244：通过介质恢复添加到控制文件的未命名数据文件ORA-01110：数据文件11：'/ disk1 / odata / strgt / test02.dbf'ORA-01110：数据文件10：'/ disk1 / oddata / strgt / test01.dbf'</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-88CAB555-C409-4805-B6A4-C92401422EF7__GUID-EED3CD8C-3581-40D7-B59B-E2DE3DD06F0B">要通过ADD DATAFILE操作恢复：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>查看通过查询<code class="codeph">V$DATAFILE</code> 。添加的文件，如下例所示：</span><div><pre class="oac_no_warn" dir="ltr">SELECT FILE＃，NAME FROM V $ DATAFILE; FILE＃NAME --------------- ---------------------- 1 / disk1 / oradata / trgt / system01。 dbf。。。10 / disk1 / oradata / trgt / UNNAMED00001 11 / disk1 / oradata / trgt / UNNAMED00002</pre></div>
                        </li>
                        <li class="stepexpand"><span>如果存在多个未命名文件，则使用以下方法之一确定哪个未命名文件对应于哪个数据文件：</span><div>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>打开<code class="codeph">alert_</code> <span class="italic"><code class="codeph">SID</code></span> <code class="codeph">.log</code> ，其中包含有关每个未命名文件的原始文件位置的消息。
                                    </p>
                                 </li>
                                 <li>
                                    <p>从错误消息和<code class="codeph">V$DATAFILE</code>导出每个未命名文件的原始文件位置：每个未命名文件对应于错误消息中具有相同文件号的文件。
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>发出<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">RENAME</code> <code class="codeph">FILE</code>语句以重命名数据文件。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE RENAME FILE'/ db / UNNAMED00001'to'/disk1/oradata/trgt/test01.dbf'; ALTER DATABASE RENAME FILE'/ db / UNNAMED00002'to'/disk1/oradata/trgt/test02.dbf';</pre></div>
                        </li>
                        <li class="stepexpand"><span>通过发出恢复声明继续恢复。例如：</span><div><pre class="oac_no_warn" dir="ltr">使用备份控制文件直到取消恢复自动数据库</pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV227"></a><div class="props_rev_3"><a id="GUID-CEF04736-4A56-4560-AD8E-948300F6C80F" name="GUID-CEF04736-4A56-4560-AD8E-948300F6C80F"></a><h4 id="BRADV-GUID-CEF04736-4A56-4560-AD8E-948300F6C80F" class="sect4"><span class="enumeration_section">31.2.4</span>使用备份控制文件恢复只读表空间</h4>
                  <div>
                     <div class="section">
                        <p>如果您在只读或慢速介质上有只读表空间，那么在使用“只读”或“慢速介质”进行恢复时可能会遇到错误或性能不佳<a id="d146940e1358" class="indexterm-anchor"></a> <code class="codeph">USING</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code>选项。当备份控制文件指示在备份控制文件时读/写表空间时，会出现这种情况。在这种情况下，介质恢复可能会尝试写入文件。对于只读介质，数据库会发出错误消息，指出它无法写入文件。对于慢速介质，例如由磁带备份的分层存储系统，性能可能会受到影响。
                        </p>
                        <p>要避免这些问题，请使用当前控制文件而不是备份来恢复数据库。如果必须使用备份控制文件，那么如果只读表空间没有出现介质故障，也可以避免此问题。使用备份控制文件时，您可以使用以下备选方法来恢复只读和慢速介质：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>在使用备份控制文件进行恢复之前，将只读表空间中的数据文件脱机，然后在介质恢复后将文件联机。</p>
                           </li>
                           <li>
                              <p>使用正确版本的控制文件进行恢复。如果恢复完成时表空间是只读的，则控制文件备份必须来自表空间为只读时。同样，如果恢复后表空间是读/写，则控制文件必须是从表空间读/写时开始。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV514"></a><a id="BRADV515"></a><a id="BRADV657"></a><a id="BRADV90045"></a><div class="props_rev_3"><a id="GUID-9152B9A8-308A-4871-B835-53AF7593E65D" name="GUID-9152B9A8-308A-4871-B835-53AF7593E65D"></a><h3 id="BRADV-GUID-9152B9A8-308A-4871-B835-53AF7593E65D" class="sect3"><span class="enumeration_section">31.3</span>重新创建控制文件</h3>
               <div>
                  <div class="section">
                     <p><a id="d146940e1463" class="indexterm-anchor"></a><a id="d146940e1467" class="indexterm-anchor"></a><a id="d146940e1471" class="indexterm-anchor"></a>如果所有控制文件在永久性介质故障中丢失，但所有联机重做日志成员保持不变，则可以在创建新控制文件后恢复数据库。您<span class="italic">不需要</span>与打开数据库<code class="codeph">RESETLOGS</code>后恢复选项。
                     </p>
                     <p>根据控制文件备份的存在和货币，您可以使用<a href="user-managed-recovery-advanced.html#GUID-9152B9A8-308A-4871-B835-53AF7593E65D__CHDJJGII" title="此表详细说明了根据可用资源重新创建控制文件的不同选项。">表31-2中</a>列出的选项来生成<code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code>语句的文本。对数据库的更改将记录在<span class="italic">alert_SID.log中</span> ，因此在决定选择哪个选项时请检查此日志。
                     </p>
                     <div class="tblformal" id="GUID-9152B9A8-308A-4871-B835-53AF7593E65D__CHDJJGII">
                        <p class="titleintable">表31-2创建控制文件的选项</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="创建控制文件的选项" width="100%" border="1" summary="This table details different options for recreating your control file, depending upon available resources." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="50%" id="d146940e1508">如果你...</th>
                                 <th align="left" valign="bottom" width="50%" id="d146940e1511">然后...</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="50%" id="d146940e1516" headers="d146940e1508 ">
                                    <p>执行<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">TO</code> <code class="codeph">TRACE</code> <code class="codeph">NORESETLOGS</code>你做数据库的最后结构变化后，如果您已保存了SQL命令跟踪输出</p>
                                 </td>
                                 <td align="left" valign="top" width="50%" headers="d146940e1516 d146940e1511 ">
                                    <p>按原样使用跟踪输出中的<code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code>语句。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="50%" id="d146940e1551" headers="d146940e1508 ">
                                    <p>执行您最近的执行<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">TO</code> <code class="codeph">TRACE</code>你做出对数据库进行结构性改变之前</p>
                                 </td>
                                 <td align="left" valign="top" width="50%" headers="d146940e1551 d146940e1511 ">
                                    <p>编辑输出<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">TO</code> <code class="codeph">TRACE</code>以反映更改。例如，如果您最近将数据文件添加到数据库，则将此数据文件添加到<code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code>语句的<code class="codeph">DATAFILE</code>子句中。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="50%" id="d146940e1605" headers="d146940e1508 ">
                                    <p>使用<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">TO</code> <span class="italic"><code class="codeph">filename</code></span>语句（而不是<code class="codeph">TO</code> <code class="codeph">TRACE</code>选项） <code class="codeph">BACKUP</code>控制文件</p>
                                 </td>
                                 <td align="left" valign="top" width="50%" headers="d146940e1605 d146940e1511 ">
                                    <p>使用控制文件副本获取SQL输出。创建临时数据库实例，装入备份控制文件，然后运行<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">TO</code> <code class="codeph">TRACE</code> <code class="codeph">NORESETLOGS</code> 。如果控制文件副本早于最近的结构更改，则编辑跟踪选项以反映更改。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="50%" id="d146940e1660" headers="d146940e1508 ">
                                    <p>没有<code class="codeph">TO</code> <code class="codeph">TRACE</code>格式或<code class="codeph">TO</code> <span class="italic"><code class="codeph">filename</code></span>格式的控制文件备份</p>
                                 </td>
                                 <td align="left" valign="top" width="50%" headers="d146940e1660 d146940e1511 ">
                                    <p>手动执行<code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code>语句（请参阅<a href="../sqlrf/CREATE-CONTROLFILE.html#SQLRF01203" target="_blank"><span class="italic">Oracle数据库SQL语言参考</span></a> ）。
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="infoboxnote" id="GUID-9152B9A8-308A-4871-B835-53AF7593E65D__GUID-B53F9FE3-6505-4B59-AC76-0B18995DFA00">
                        <p class="notep1">注意：</p>
                        <p>如果您的字符集不是默认的US7ASCII，则必须将字符集指定为<code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code>语句的参数。数据库字符集在启动时写入警报日志。字符集信息也记录在<code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">TO</code> <code class="codeph">TRACE</code>输出中。
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-9152B9A8-308A-4871-B835-53AF7593E65D__GUID-63D4BC43-C6FE-4923-942D-B11C6DF4A781">要创建控制文件并恢复数据库：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ol>
                        <li>
                           <p>以<code class="codeph">NOMOUNT</code>模式启动数据库。例如，输入：</p><pre class="oac_no_warn" dir="ltr">启动NOMOUNT</pre></li>
                        <li>
                           <p>使用<code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code>语句创建控制文件，指定<code class="codeph">NORESETLOGS</code>选项（有关选项，请参阅<a href="user-managed-recovery-advanced.html#GUID-9152B9A8-308A-4871-B835-53AF7593E65D__CHDJJGII" title="此表详细说明了根据可用资源重新创建控制文件的不同选项。">表31-2</a> ）。以下示例假定字符集是默认的US7ASCII：</p><pre class="oac_no_warn" dir="ltr">创建控制文件重新使用数据库销售NORESETLOGS ARCHIVELOG MAXLOGFILES 32 MAXLOGMEMBERS 2 MAXDATAFILES 32 MAXINSTANCES 16 MAXLOGHISTORY 1600 LOGFILE GROUP 1（'/ diska/prod/sales/db/log1t1.dbf','/diskb/prod/sales/db/log1t2.dbf' ）SIZE 100K，GROUP 2（'/diska/prod/sales/db/log2t1.dbf'，'/ diskb / prod / reports / db / log2t2.dbf'）SIZE 100K DATAFILE'/ diska / prod / sales / db / database1.dbf'，'/ diskb / prod /ales / db / filea.dbf';</pre><p>创建控制文件后，实例将装入数据库。</p>
                        </li>
                        <li>
                           <p>像往常一样恢复数据库（ <span class="italic">不</span>指定<code class="codeph">USING</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code>子句）：</p><pre class="oac_no_warn" dir="ltr">恢复数据库</pre></li>
                        <li>
                           <p>恢复完成后打开数据库（不需要<code class="codeph">RESETLOGS</code>选项）：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN;</pre></li>
                        <li>
                           <p>立即备份控制文件。以下SQL语句将数据库的控制文件备份到<code class="codeph">/backup/control01.dbf</code> ：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE BACKUP CONTROLFILE TO'/backup/control01.dbf'REUSE;</pre></li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-9152B9A8-308A-4871-B835-53AF7593E65D__GUID-E92CB189-57E9-4D69-9641-02E9FD2909CF">要为多租户容器数据库创建控制文件：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li><span>确保未在任何实例中装入<a href="glossary.html#GUID-3E156A59-F6CC-4A2A-9749-DB7D1CE25F13"><span class="xrefglossterm">多租户容器数据库（CDB）</span></a> 。</span></li>
                     <li><span>打开SQL * Plus。</span></li>
                     <li><span>以具有<code class="codeph">SYSDBA</code>权限的用户身份连接到<a href="glossary.html#GUID-EA3DB8F4-F68E-4FC5-A599-32A4886FFF8A"><span class="xrefglossterm">root</span></a> 。</span></li>
                     <li><span>按照上一过程创建控制文件并恢复数据库。</span></li>
                  </ol>
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-9152B9A8-308A-4871-B835-53AF7593E65D__GUID-B0994BAA-93B1-4E4D-9499-C183AB4EEE98">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="user-managed-database-backups.html#GUID-BB09FC55-6D5A-4B8E-BA6A-65F4B28759FD">将控制文件备份到跟踪文件</a> ”</span>和<span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-E0032019-E245-4EBD-B275-1343AA175239">备份不可用时重新创建数据文件</a> ”</span></p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="BRADV225"></a><div class="props_rev_3"><a id="GUID-FFEB9655-0049-4AF5-9412-2C3F97375100" name="GUID-FFEB9655-0049-4AF5-9412-2C3F97375100"></a><h4 id="BRADV-GUID-FFEB9655-0049-4AF5-9412-2C3F97375100" class="sect4"><span class="enumeration_section">31.3.1</span>使用创建的控制文件通过RESETLOGS进行恢复</h4>
                  <div>
                     <div class="section">
                        <p>您可以通过<code class="codeph">OPEN</code> <code class="codeph">RESETLOGS</code>操作恢复备份，只要：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您有一个当前，备份或创建的控制文件，可以检测先前的化身</p>
                           </li>
                           <li>
                              <p>您拥有所有可用的归档重做日志</p>
                           </li>
                        </ul>
                        <p>如果必须重新创建控制文件，则<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">TO</code> <code class="codeph">TRACE</code>生成的跟踪文件包含重建完整化身历史记录的必要命令。<code class="codeph">V$DATABASE_INCARNATION</code>视图显示控制文件的<code class="codeph">RESETLOGS</code>历史记录， <code class="codeph">V$LOG_HISTORY</code>视图显示存档的日志历史记录。
                        </p>
                        <p>在重新创建的控制文件中，化身历史可能是不完整的。例如，可能缺少恢复所需的存档日志。在这种情况下，可以使用<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">REGISTER</code> <code class="codeph">LOGFILE</code>语句显式创建化身记录。
                        </p>
                        <p>在以下示例中，您注册了四个恢复所需的日志，但未记录在重新创建的控制文件中，然后恢复数据库：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE REGISTER LOGFILE'/disk1/oradata/trgt/arch/arcr_1_1_42343523.arc'; ALTER DATABASE REGISTER LOGFILE'/disk1/oradata/trgt/arch/arcr_1_1_34546466.arc'; ALTER DATABASE REGISTER LOGFILE'/disk1/oradata/trgt/arch/arcr_1_1_23435466.arc'; ALTER DATABASE REGISTER LOGFILE'/disk1/oradata/trgt/arch/arcr_1_1_12343533.arc';恢复自动数据库;</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV516"></a><a id="BRADV90046"></a><div class="props_rev_3"><a id="GUID-6FEEA424-52E9-49C6-8E35-DD3AC9B8CBE6" name="GUID-6FEEA424-52E9-49C6-8E35-DD3AC9B8CBE6"></a><h4 id="BRADV-GUID-6FEEA424-52E9-49C6-8E35-DD3AC9B8CBE6" class="sect4"><span class="enumeration_section">31.3.2</span>使用重新创建的控制文件恢复只读文件</h4>
                  <div>
                     <div class="section">
                        <p>如果当前或备份控制文件不可用于恢复，则可以执行<code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code>语句。不要在<code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code>语句中列出只读文件，以便恢复可以跳过它们。除非在读/写数据文件时还原这些文件的备份，否则只读数据文件不需要恢复。
                        </p>
                        <p>创建控制文件并尝试装入并打开数据库后，数据库将对控制文件中列出的文件执行数据字典检查。对于未在<code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code>语句中列出但存在于数据字典中的每个文件，将在控制文件中为它们创建一个条目。这些文件命名为<code class="codeph">MISSING</code> <span class="italic"><code class="codeph">nnnnn</code></span> ，其中<span class="italic"><code class="codeph">nnnnn</code></span>是一个以<code class="codeph">0</code>开头的5位数字。
                        </p>
                        <p>打开数据库后，通过对名称前缀为<code class="codeph">MISSING</code>所有文件执行<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">RENAME</code> <code class="codeph">FILE</code>语句，将只读文件重命名为正确的文件名。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-6FEEA424-52E9-49C6-8E35-DD3AC9B8CBE6__GUID-DAFB2343-4CCC-414D-9B7C-B24EEA12AF8E">要准备可能需要重新创建控制文件的方案：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>装入或打开数据库时运行以下语句以获取<code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code>语法：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE BACKUP CONTROLFILE to TRACE;</pre><p>前面的SQL语句生成一个跟踪文件，您可以编辑该文件并将其用作脚本以重新创建控制文件。您可以指定<code class="codeph">RESETLOGS</code>或<code class="codeph">NORESETLOGS</code> （默认）关键字来生成<code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">...</code> <code class="codeph">RESETLOGS</code>或<code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">...</code> <code class="codeph">NORESETLOGS</code>版本的脚本。
                        </p>
                        <p>与<code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code>语句中的只读文件相关的所有限制也适用于脱机正常表空间，但必须在数据库打开后使表空间联机。从<code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code>语句中省略临时文件，并在打开数据库后添加它们。
                        </p>
                        <div class="infoboxnotealso" id="GUID-6FEEA424-52E9-49C6-8E35-DD3AC9B8CBE6__GUID-1AD30680-DCDF-428B-A8D7-A43A757868B9">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="user-managed-database-backups.html#GUID-BB09FC55-6D5A-4B8E-BA6A-65F4B28759FD">将控制文件备份到跟踪文件</a> ”</span>以了解如何对控制文件进行跟踪备份</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV517"></a><a id="BRADV224"></a><div class="props_rev_3"><a id="GUID-E0032019-E245-4EBD-B275-1343AA175239" name="GUID-E0032019-E245-4EBD-B275-1343AA175239"></a><h3 id="BRADV-GUID-E0032019-E245-4EBD-B275-1343AA175239" class="sect3"><span class="enumeration_section">31.4</span>备份不可用时重新创建数据文件</h3>
               <div>
                  <div class="section">
                     <p>如果数据文件损坏且没有可用的文件备份，则在以下情况下仍可以恢复数据文件：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>创建原始数据文件后写入的所有归档日志文件都可用</p>
                        </li>
                        <li>
                           <p>控制文件包含损坏文件的名称（即，控制文件是最新的，或者是在将损坏的数据文件添加到数据库后进行的备份）</p>
                           <div class="infoboxnote" id="GUID-E0032019-E245-4EBD-B275-1343AA175239__GUID-42FEA55F-0769-4936-98E4-B5F24E420C5D">
                              <p class="notep1">注意：</p>
                              <p>您不能使用<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code>语句的<code class="codeph">CREATE</code> <code class="codeph">DATAFILE</code>子句为<code class="codeph">SYSTEM</code>表空间重新创建任何数据文件，因为必需的重做不可用。
                              </p>
                           </div>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-E0032019-E245-4EBD-B275-1343AA175239__GUID-113B3160-ADE3-49BE-8F27-102CBCFE7CE8">要重新创建用于恢复的数据文件：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span><a id="d146940e2251" class="indexterm-anchor"></a>创建一个空数据文件以替换没有相应备份的损坏数据文件。例如，假设数据文件<code class="codeph">/disk1/oradata/trgt/users01.dbf</code>已损坏，并且没有可用的备份。以下语句在<code class="codeph">disk2</code>上重新创建原始数据文件（大小相同）：</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE CREATE DATAFILE'/disk1/oradata/trgt/users01.dbf'AS'/disk2/users01.dbf';</pre><p>此语句创建一个与丢失文件大小相同的空文件。数据库查看控制文件和数据字典中的信息以获取大小信息。旧数据文件重命名为新数据文件。</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>在空数据文件上执行介质恢复。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">RECOVER DATAFILE'/disk2/users01.dbf'</pre></div>
                     </li>
                     <li class="stepexpand"><span>创建原始数据文件后写入的所有归档日志必须在恢复期间应用于丢失数据文件的新空版本。</span></li>
                  </ol>
               </div>
            </div><a id="BRADV90047"></a><div class="props_rev_3"><a id="GUID-617A3664-A605-4570-B22B-FE6793C469DF" name="GUID-617A3664-A605-4570-B22B-FE6793C469DF"></a><h3 id="BRADV-GUID-617A3664-A605-4570-B22B-FE6793C469DF" class="sect3"><span class="enumeration_section">31.5</span>恢复NOLOGGING表和索引</h3>
               <div>
                  <div class="section">
                     <p>您可以使用。创建表和索引<a id="d146940e2347" class="indexterm-anchor"></a><a id="d146940e2351" class="indexterm-anchor"></a><a id="d146940e2355" class="indexterm-anchor"></a> <code class="codeph">CREATE</code> <code class="codeph">TABLE</code> <code class="codeph">AS</code> <code class="codeph">SELECT</code>语句。您还可以指定数据库使用<code class="codeph">NOLOGGING</code>选项创建它们。将表或索引创建为<code class="codeph">NOLOGGING</code> ，数据库不会为操作生成重做日志记录。因此，即使在<code class="codeph">ARCHIVELOG</code>模式下运行，也无法恢复使用<code class="codeph">NOLOGGING</code>创建的对象。
                     </p>
                     <div class="infoboxnote" id="GUID-617A3664-A605-4570-B22B-FE6793C469DF__GUID-20BD200D-F92D-43EA-80E4-2A7AB347A4B8">
                        <p class="notep1">注意：</p>
                        <p>如果您无法承受丢失使用<code class="codeph">NOLOGGING</code>创建的表或索引，请在创建不可恢复的表或索引后进行备份。
                        </p>
                     </div>
                     <p>请注意，执行介质恢复时，某些表或索引是正常创建的，而其他表是使用<code class="codeph">NOLOGGING</code>选项创建的，否则<code class="codeph">NOLOGGING</code>对象会被<code class="codeph">RECOVER</code>操作标记为逻辑损坏。任何访问不可恢复对象的尝试都会返回<a id="d146940e2401" class="indexterm-anchor"></a><a id="d146940e2405" class="indexterm-anchor"></a><a id="d146940e2409" class="indexterm-anchor"></a> <code class="codeph">ORA-01578</code>错误消息。删除<code class="codeph">NOLOGGING</code>对象并根据需要重新创建它们。
                     </p>
                     <p>因为可以使用<code class="codeph">NOLOGGING</code>选项创建表，然后在该表上使用<code class="codeph">LOGGING</code>选项创建索引，所以在执行介质恢复后，索引不会被标记为逻辑损坏。该表是不可恢复的（因此在恢复后标记为损坏），因此索引指向损坏的块。必须删除索引，必要时必须重新创建表和索引。
                     </p>
                     <div class="infoboxnotealso" id="GUID-617A3664-A605-4570-B22B-FE6793C469DF__GUID-2FAA8975-53CD-4BE8-8281-533CBFF84F2E">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<code class="codeph">NOLOGGING</code>对数据库影响的信息，请参阅<a href="../sbydb/examples-of-using-oracle-data-guard.html#SBYDB00920" target="_blank"><span class="italic">Oracle Data Guard概念和管理</span></a></p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="BRADV518"></a><a id="BRADV228"></a><div class="props_rev_3"><a id="GUID-22FCD8A3-128E-4BFA-8744-5969695034E9" name="GUID-22FCD8A3-128E-4BFA-8744-5969695034E9"></a><h3 id="BRADV-GUID-22FCD8A3-128E-4BFA-8744-5969695034E9" class="sect3"><span class="enumeration_section">31.6</span>恢复可传输表空间</h3>
               <div>
                  <div class="section">
                     <p><a id="d146940e2510" class="indexterm-anchor"></a><a id="d146940e2514" class="indexterm-anchor"></a><a id="d146940e2518" class="indexterm-anchor"></a> Oracle数据库的可<a href="glossary.html#GUID-E843F9DE-6FCC-4614-BA56-486F6D9BBD25"><span class="xrefglossterm">传输表空间</span></a>功能使用户能够将一组表空间从一个数据库传输到另一个数据库。将表空间传输到数据库就像创建一个包含已加载数据的表空间。由于以下原因，使用此功能通常是一个优势：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>它比使用Data Pump Export或SQL * Loader实用程序更快，因为它只涉及复制数据文件和集成元数据</p>
                        </li>
                        <li>
                           <p>您可以使用它来移动索引数据，从而避免重建索引的必要性</p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-22FCD8A3-128E-4BFA-8744-5969695034E9__GUID-60223743-B8B0-4F92-A37A-F7FC3940DAAA">
                        <p class="notep1">也可以看看：</p>
                        <p>有关使用可传输表空间功能的详细信息，请参见<a href="../admin/managing-tablespaces.html#ADMIN011" target="_blank"><span class="italic">“Oracle数据库管理员指南”</span></a></p>
                     </div>
                     <p>与普通表空间一样，可传输表空间是可恢复的。但是，即使您可以在没有备份的情况下恢复正常的表空间，也必须具有一致版本的传输数据文件才能恢复传输的表空间。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-22FCD8A3-128E-4BFA-8744-5969695034E9__GUID-E433F5EA-017F-4FCA-8FCF-434DD094B208">要恢复可传输的表空间，请使用以下过程：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>如果数据库已打开，则使传输的表空间脱机。例如，如果要恢复<code class="codeph">users</code>表空间，请发出以下语句：</span><div><pre class="oac_no_warn" dir="ltr">ALTER TABLESPACE用户立即离线;</pre></div>
                     </li>
                     <li class="stepexpand"><span>使用操作系统实用程序还原传输的数据文件的备份。备份可以是传输的数据文件的初始版本，也可以是传输表空间后进行的任何备份。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">％cp /backup/users.dbf $ ORACLE_HOME / oradata / trgt / users01.dbf</pre></div>
                     </li>
                     <li class="stepexpand"><span>像往常一样恢复表空间。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">RECOVER TABLESPACE用户</pre></div>
                     </li>
                  </ol>
                  <div class="section">
                     <p>通过可传输的表空间操作恢复时，您可能会看到错误<code class="codeph">ORA-01244</code> ，就像通过<code class="codeph">CREATE</code> <code class="codeph">TABLESPACE</code>操作恢复一样。在这种情况下，使用<span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-88CAB555-C409-4805-B6A4-C92401422EF7">使用备份控制文件通过添加的数据文件恢复</a> ”中</span>的过程将未命名的文件重命名为正确的位置。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="BRADV519"></a><a id="BRADV229"></a><div class="props_rev_3"><a id="GUID-BF09DCB4-AB6F-4886-AAC1-C2747BDF05D2" name="GUID-BF09DCB4-AB6F-4886-AAC1-C2747BDF05D2"></a><h3 id="BRADV-GUID-BF09DCB4-AB6F-4886-AAC1-C2747BDF05D2" class="sect3"><span class="enumeration_section">31.7</span>在线重做日志文件丢失后恢复</h3>
               <div>
                  <p><a id="d146940e2658" class="indexterm-anchor"></a><a id="d146940e2662" class="indexterm-anchor"></a><a id="d146940e2668" class="indexterm-anchor"></a>如果介质故障影响了数据库的联机重做日志，则相应的恢复过程取决于以下注意事项：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>联机重做日志的配置：镜像或非镜像</p>
                     </li>
                     <li>
                        <p>媒体失败的类型：临时或永久</p>
                     </li>
                     <li>
                        <p>受媒体故障影响的联机重做日志文件类型：当前，活动，未归档或非活动</p>
                     </li>
                  </ul>
                  <p>下表显示了<code class="codeph">V$LOG</code>状态信息，这些信息在涉及联机重做日志的恢复情况下至关重要。
                  </p>
                  <div class="tblformal" id="GUID-BF09DCB4-AB6F-4886-AAC1-C2747BDF05D2__G1010854">
                     <p class="titleintable">表31-3 V $ LOG的STATUS列</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="状态V $ LOG的列" width="100%" border="1" summary="This table explains possible values for V$LOG.STATUS and their meaning." frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" id="d146940e2698">状态</th>
                              <th align="left" valign="bottom" id="d146940e2701">描述</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d146940e2706" headers="d146940e2698 ">
                                 <p><code class="codeph">没用过</code></p>
                              </td>
                              <td align="left" valign="top" headers="d146940e2706 d146940e2701 ">
                                 <p>从未写过在线重做日志。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d146940e2714" headers="d146940e2698 ">
                                 <p><code class="codeph">当前</code></p>
                              </td>
                              <td align="left" valign="top" headers="d146940e2714 d146940e2701 ">
                                 <p>联机重做日志处于活动状态，即实例恢复所需，它是数据库当前正在写入的日志。重做日志可以打开或关闭。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d146940e2722" headers="d146940e2698 ">
                                 <p><code class="codeph">活性</code></p>
                              </td>
                              <td align="left" valign="top" headers="d146940e2722 d146940e2701 ">
                                 <p>联机重做日志处于活动状态，即实例恢复所需，但不是数据库当前正在写入的日志。它可能用于块恢复，可能存档也可能不存档。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d146940e2730" headers="d146940e2698 ">
                                 <p><code class="codeph">清算</code></p>
                              </td>
                              <td align="left" valign="top" headers="d146940e2730 d146940e2701 ">
                                 <p>在<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">CLEAR</code> <code class="codeph">LOGFILE</code>语句之后，日志将重新创建为空日志。清除日志后，状态将更改为<code class="codeph">UNUSED</code> 。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d146940e2753" headers="d146940e2698 ">
                                 <p><code class="codeph">CLEARING_CURRENT</code> 
                                 </p>
                              </td>
                              <td align="left" valign="top" headers="d146940e2753 d146940e2701 ">
                                 <p>正在清除当前日志的已关闭线程。如果交换机出现故障（例如写入新日志标头的I / O错误），则日志可以保持此状态。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d146940e2762" headers="d146940e2698 ">
                                 <p><code class="codeph">INACTIVE</code></p>
                              </td>
                              <td align="left" valign="top" headers="d146940e2762 d146940e2701 ">
                                 <p>实例恢复不再需要日志。它可能用于媒体恢复，可能存档也可能不存档。</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="user-managed-recovery-advanced.html#GUID-7E300605-16F5-41FA-A368-927C00C79782">丢失多路复用在线重做日志组成员后恢复</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-recovery-advanced.html#GUID-81859D09-E1A9-44C4-82EE-ED28DE5F8344">丢失在线重做日志组的所有成员后恢复</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV90048"></a><div class="props_rev_3"><a id="GUID-7E300605-16F5-41FA-A368-927C00C79782" name="GUID-7E300605-16F5-41FA-A368-927C00C79782"></a><h4 id="BRADV-GUID-7E300605-16F5-41FA-A368-927C00C79782" class="sect4"><span class="enumeration_section">31.7.1</span>丢失多路复用在线重做日志组成员后恢复</h4>
                  <div>
                     <div class="section">
                        <p>丢失多路复用联机重做日志组的成员后，您可以恢复。在以下情况下，数据库将继续照常运行：</p>
                        <p>如果多路复用数据库的联机重做日志，并且每个联机重做日志组中至少有一个成员不受介质故障影响，则数据库将继续照常运行，但会将错误消息写入日志写入器跟踪文件和数据库的<code class="codeph">alert_</code> <span class="italic"><code class="codeph">SID</code></span> <code class="codeph">.log</code> 。
                        </p>
                        <p>您可以通过执行以下操作之一来解决多路复用联机重做日志组中缺少成员的问题：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>如果硬件问题是暂时的，则更正它。日志写入器进程访问以前不可用的联机重做日志文件，就好像问题从未存在过一样。</p>
                           </li>
                           <li>
                              <p>如果硬件问题是永久性的，则删除损坏的成员并使用以下过程添加新成员。<span class="bold"></span></p>
                              <div class="infoboxnote" id="GUID-7E300605-16F5-41FA-A368-927C00C79782__GUID-CAFE15AC-8B76-4B66-89F8-A6ADFDAACC56">
                                 <p class="notep1">注意：</p>
                                 <p>在重新使用日志组之前，新添加的成员不提供冗余。</p>
                              </div>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>找到损坏成员的文件名<a id="d146940e2889" class="indexterm-anchor"></a> <code class="codeph">V$LOGFILE</code> 。如果文件不可访问，则状态为<code class="codeph">INVALID</code> ：<a id="d146940e2897" class="indexterm-anchor"></a><a id="d146940e2899" class="indexterm-anchor"></a><a id="d146940e2901" class="indexterm-anchor"></a><a id="d146940e2905" class="indexterm-anchor"></a><a id="d146940e2909" class="indexterm-anchor"></a><a id="d146940e2914" class="indexterm-anchor"></a><a id="d146940e2918" class="indexterm-anchor"></a></span><div><pre class="oac_no_warn" dir="ltr">SELECT GROUP＃，STATUS，成员来自V $ LOGFILE WHERE STATUS ='INVALID'; GROUP＃STATUS会员------- ----------- --------------------- 0002 INVALID / disk1 / oradata / TRGT / redo02.log</pre></div>
                        </li>
                        <li class="stepexpand"><span>掉落受损的会员。例如，要从组<code class="codeph">2</code>删除成员<code class="codeph">redo02.log</code> ，请发出以下语句：</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE DROP LOGFILE MEMBER'/disk1/oradata/trgt/redo02.log';</pre></div>
                        </li>
                        <li class="stepexpand"><span>向该组添加新成员。例如，要将<code class="codeph">redo02.log</code>添加到组<code class="codeph">2</code> ，请发出以下语句：</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE将LOGFILE成员'/disk1/oradata/trgt/redo02b.log'添加到组2;</pre><p>如果要添加的文件已存在，则它必须与其他组成员的大小相同，并且必须指定<code class="codeph">REUSE</code>选项。例如：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE添加LOGFILE成员'/disk1/oradata/trgt/redo02b.log'重新使用第2组;</pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV520"></a><a id="BRADV605"></a><a id="BRADV90049"></a><div class="props_rev_3"><a id="GUID-81859D09-E1A9-44C4-82EE-ED28DE5F8344" name="GUID-81859D09-E1A9-44C4-82EE-ED28DE5F8344"></a><h4 id="BRADV-GUID-81859D09-E1A9-44C4-82EE-ED28DE5F8344" class="sect4"><span class="enumeration_section">31.7.2</span>丢失在线重做日志组的所有成员后恢复</h4>
                  <div>
                     <div class="section">
                        <p><a id="d146940e3030" class="indexterm-anchor"></a><a id="d146940e3034" class="indexterm-anchor"></a><a id="d146940e3040" class="indexterm-anchor"></a><a id="d146940e3046" class="indexterm-anchor"></a>如果介质故障损坏联机重做日志组的所有成员，则可能会出现不同的方案，具体取决于受故障影响的联机重做日志组的类型以及数据库的归档模式。
                        </p>
                        <p>如果损坏的联机重做日志组是当前活动的，则需要进行崩溃恢复;否则，它不是。<a href="user-managed-recovery-advanced.html#GUID-81859D09-E1A9-44C4-82EE-ED28DE5F8344__CACFJDBG" title="此表描述了丢失在线日志组的所有成员的方案和响应。">表31-4</a>概述了各种恢复方案。
                        </p>
                        <div class="tblformal" id="GUID-81859D09-E1A9-44C4-82EE-ED28DE5F8344__CACFJDBG">
                           <p class="titleintable">表31-4在线重做日志组丢失后恢复</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="丢失在线重做日志组后恢复" width="100%" border="1" summary="This table describes scenarios and responses for the loss of all members of an online log group." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="17%" id="d146940e3071">如果集团是......</th>
                                    <th align="left" valign="bottom" width="33%" id="d146940e3074">然后...</th>
                                    <th align="left" valign="bottom" width="50%" id="d146940e3077">你可以......</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="17%" id="d146940e3082" headers="d146940e3071 ">
                                       <p>待用</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d146940e3082 d146940e3074 ">
                                       <p>崩溃恢复不需要它</p>
                                    </td>
                                    <td align="left" valign="top" width="50%" headers="d146940e3082 d146940e3077 ">
                                       <p>清除已存档或未存档的组。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="17%" id="d146940e3092" headers="d146940e3071 ">
                                       <p>活性</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d146940e3092 d146940e3074 ">
                                       <p>崩溃恢复需要它</p>
                                    </td>
                                    <td align="left" valign="top" width="50%" headers="d146940e3092 d146940e3077 ">
                                       <p>尝试发出检查点并清除日志;如果不可能，那么您必须使用闪回数据库或恢复备份并执行不完全恢复，直到最新的可用重做日志。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="17%" id="d146940e3102" headers="d146940e3071 ">
                                       <p>当前</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d146940e3102 d146940e3074 ">
                                       <p>它是数据库当前正在写入的重做日志</p>
                                    </td>
                                    <td align="left" valign="top" width="50%" headers="d146940e3102 d146940e3077 ">
                                       <p>尝试清除日志;如果不可能，那么您必须使用闪回数据库或恢复备份并执行不完全恢复，直到最新的可用重做日志。</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-81859D09-E1A9-44C4-82EE-ED28DE5F8344__GUID-A9358945-0EB8-4988-BE25-D59792AB5FB5">确定受损组是活动还是非活动。</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>找到丢失的重做日志的文件名<a id="d146940e3118" class="indexterm-anchor"></a> <code class="codeph">V$LOGFILE</code>然后查找对应的组号。 <a id="d146940e3123" class="indexterm-anchor"></a><a id="d146940e3125" class="indexterm-anchor"></a><a id="d146940e3129" class="indexterm-anchor"></a><a id="d146940e3133" class="indexterm-anchor"></a><a id="d146940e3137" class="indexterm-anchor"></a><a id="d146940e3141" class="indexterm-anchor"></a><a id="d146940e3145" class="indexterm-anchor"></a> 例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">SELECT GROUP＃，STATUS，成员来自V $ LOGFILE; GROUP＃STATUS MEMBER ------- ----------- --------------------- 0001 / oracle / dbs / log1a .f 0001 /oracle/dbs/log1b.f 0002 INVALID /oracle/dbs/log2a.f 0002 INVALID /oracle/dbs/log2b.f 0003/oracle/dbs/log3a.f 0003 /oracle/dbs/log3b.f</pre></div>
                        </li>
                        <li class="stepexpand"><span>确定哪些组处于活动状态。</span><div>
                              <p>例如，执行以下SQL查询（包括示例输出）：</p><pre class="oac_no_warn" dir="ltr">SELECT GROUP＃，MEMBERS，STATUS，从V $ LOG归档; GROUP＃MEMBERS STATUS ARCHIVED ------ ------- --------- ----------- 0001 2非活动是0002 2活动否0003 2当前没有</pre></div>
                        </li>
                        <li class="stepexpand"><span>请执行以下操作之一：</span><div>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>如果受影响的组处于非活动状态，请按照<span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-C006356E-662D-4C51-B11F-16DDACC8EE76">丢失非活动的联机重做日志组</a> ”中的步骤进行操作</span> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p>如果受影响的组处于活动状态（如上例所示），请按照<span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-D19E8220-E774-401F-8CD8-6F2FCC125608">丢失活动的联机重做日志组</a> ”中的步骤进行操作</span> 。
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                     </ol>
                  </div><a id="BRADV90050"></a><div class="props_rev_3"><a id="GUID-C006356E-662D-4C51-B11F-16DDACC8EE76" name="GUID-C006356E-662D-4C51-B11F-16DDACC8EE76"></a><h5 id="BRADV-GUID-C006356E-662D-4C51-B11F-16DDACC8EE76" class="sect5"><span class="enumeration_section">31.7.2.1</span>丢失非活动的联机重做日志组</h5>
                     <div>
                        <p><a id="d146940e3251" class="indexterm-anchor"></a><a id="d146940e3255" class="indexterm-anchor"></a><a id="d146940e3259" class="indexterm-anchor"></a>如果具有<code class="codeph">INACTIVE</code>状态的联机重做日志组的所有成员都已损坏，则该过程取决于您是否可以修复损坏非活动重做日志组的介质问题。如果故障是暂时的，那么解决问题。日志编写器可以在需要时重用重做日志组。如果故障是永久性的，则损坏的非活动联机重做日志组最终会暂停正常的数据库操作。通过发出<code class="codeph">ALTER DATABASE CLEAR LOGFILE</code>语句手动重新初始化受损组，如本节所述。
                        </p>
                     </div><a id="BRADV521"></a><a id="BRADV90051"></a><div class="props_rev_3"><a id="GUID-96583130-3C77-44DB-B88D-387DE6B03A70" name="GUID-96583130-3C77-44DB-B88D-387DE6B03A70"></a><h6 id="BRADV-GUID-96583130-3C77-44DB-B88D-387DE6B03A70" class="sect6"><span class="enumeration_section">31.7.2.1.1</span>清除不活动的归档重做</h6>
                        <div>
                           <div class="section">
                              <p>您可以在打开或关闭数据库时清除非活动的重做日志组。该过程取决于受损组是否已归档。</p>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3" id="GUID-96583130-3C77-44DB-B88D-387DE6B03A70__GUID-B3B1B822-E76E-40A2-8D8F-B8237CE16573">要清除已归档的非活动联机重做日志组，请执行以下操作：</p>
                           </div>
                           <!-- class="section" -->
                           <ol>
                              <li class="stepexpand"><span>如果数据库已关闭，则启动新实例并装入数据库：</span><div><pre class="oac_no_warn" dir="ltr">启动安装</pre></div>
                              </li>
                              <li class="stepexpand"><span>重新初始化损坏的日志组。例如，要清除重做日志组<code class="codeph">2</code> ，请发出以下语句：</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE CLEAR LOGFILE GROUP 2;</pre></div>
                              </li>
                           </ol>
                        </div>
                     </div><a id="BRADV522"></a><a id="BRADV90052"></a><div class="props_rev_3"><a id="GUID-4DE6BAEB-17E3-4DE0-AFC0-DECAE51996B1" name="GUID-4DE6BAEB-17E3-4DE0-AFC0-DECAE51996B1"></a><h6 id="BRADV-GUID-4DE6BAEB-17E3-4DE0-AFC0-DECAE51996B1" class="sect6"><span class="enumeration_section">31.7.2.1.2</span>清除不活动的，未归档的重做</h6>
                        <div>
                           <div class="section">
                              <p>清除尚未归档的重做日志允许在不归档的情况下重用它。如果在日志中的最后一次更改之前启动备份，则此操作会使备份无法使用，除非在日志中第一次更改之前文件已脱机。因此，如果您需要已清除的日志文件来恢复备份，则无法恢复该备份。清除尚未归档的重做日志会阻止由于缺少日志而从备份中完全恢复。</p>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3" id="GUID-4DE6BAEB-17E3-4DE0-AFC0-DECAE51996B1__GUID-0D718E98-4510-463C-8199-A3AF8331DF55">要清除尚未归档的非活动联机重做日志组，请执行以下操作：</p>
                           </div>
                           <!-- class="section" -->
                           <ol>
                              <li class="stepexpand"><span>如果数据库已关闭，则启动新实例并装入数据库：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; STARTUP MOUNT</pre></div>
                              </li>
                              <li class="stepexpand"><span>使用<code class="codeph">UNARCHIVED</code>关键字清除日志。</span><div>
                                    <p>例如，要清除日志组<code class="codeph">2</code> ，请发出以下SQL语句：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE CLEAR UNARCHIVED LOGFILE GROUP 2;</pre><p>如果存在需要清除日志使其联机的脱机数据文件，则需要关键字<code class="codeph">UNRECOVERABLE</code> <code class="codeph">DATAFILE</code> 。必须删除数据文件，因为正在清除使数据文件联机所需的重做日志，并且没有它的副本。例如，输入：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE CLEAR UNARCHIVED LOGFILE GROUP 2 UNRECOVERABLE DATAFILE;</pre></div>
                              </li>
                              <li class="stepexpand"><span>使用操作系统实用程序立即备份数据库中的所有数据文件，以便您可以使用备份进行完全恢复，而无需依赖已清除的日志组。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">％cp /disk1/oracle/dbs/*.dbf / disk2 / backup</pre></div>
                              </li>
                              <li class="stepexpand"><span>使用<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code>语句备份数据库的控制文件。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE BACKUP CONTROLFILE to'/oracle/dbs/cf_backup.f';</pre></div>
                              </li>
                           </ol>
                        </div>
                     </div><a id="BRADV90053"></a><div class="props_rev_3"><a id="GUID-3F21CA05-FAE8-4179-91A1-6CCEB67C0A23" name="GUID-3F21CA05-FAE8-4179-91A1-6CCEB67C0A23"></a><h6 id="BRADV-GUID-3F21CA05-FAE8-4179-91A1-6CCEB67C0A23" class="sect6"><span class="enumeration_section">31.7.2.1.3</span> CLEAR LOGFILE操作失败</h6>
                        <div>
                           <p><a id="d146940e3575" class="indexterm-anchor"></a><a id="d146940e3579" class="indexterm-anchor"></a><a id="d146940e3585" class="indexterm-anchor"></a>当无法执行以下操作时，由于介质故障， <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">CLEAR</code> <code class="codeph">LOGFILE</code>语句可能会因I / O错误而失败：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>通过在当前配置的重做日志文件名下重新创建重做日志文件，将其重新定位到备用介质上</p>
                              </li>
                              <li>
                                 <p>重新使用当前配置的日志文件名重新创建重做日志文件，因为名称本身无效或不可用（例如，由于介质故障）</p>
                              </li>
                           </ul>
                           <p>在这些情况下， <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">CLEAR</code> <code class="codeph">LOGFILE</code>语句（在收到I / O错误之前）成功通知控制文件正在清除日志并且不需要存档。在<code class="codeph">CLEAR</code> <code class="codeph">LOGFILE</code>语句尝试创建新重做日志文件并向其写入零的步骤中发生I / O错误。这个事实反映在<code class="codeph">V$LOG.CLEARING_CURRENT</code> 。</p>
                        </div>
                     </div>
                  </div><a id="BRADV90054"></a><div class="props_rev_3"><a id="GUID-D19E8220-E774-401F-8CD8-6F2FCC125608" name="GUID-D19E8220-E774-401F-8CD8-6F2FCC125608"></a><h5 id="BRADV-GUID-D19E8220-E774-401F-8CD8-6F2FCC125608" class="sect5"><span class="enumeration_section">31.7.2.2</span>丢失主动在线重做日志组</h5>
                     <div>
                        <p>如果数据库仍在运行且丢失的活动重做日志<span class="italic">不是</span>当前日志，则发出<code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">CHECKPOINT</code>语句。如果操作成功，则活动重做日志将变为非活动状态，您可以按照<span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-C006356E-662D-4C51-B11F-16DDACC8EE76">丢失非活动联机重做日志组</a> ”中的过程进行操作</span> 。如果操作不成功，或者数据库已暂停，则执行本节中的一个过程，具体取决于归档模式。
                        </p>
                        <p>当前日志是<code class="codeph">LGWR</code>当前正在写入的日志。如果<code class="codeph">LGWR</code> I / O操作失败，则LGWR终止并且实例失败。在这种情况下，您必须使用<code class="codeph">RESETLOGS</code>选项还原备份，执行不完全恢复并打开数据库。
                        </p>
                     </div><a id="BRADV523"></a><a id="BRADV90055"></a><div class="props_rev_3"><a id="GUID-2D31AAD0-E337-4B17-9ACB-54B00BFC0E4C" name="GUID-2D31AAD0-E337-4B17-9ACB-54B00BFC0E4C"></a><h6 id="BRADV-GUID-2D31AAD0-E337-4B17-9ACB-54B00BFC0E4C" class="sect6"><span class="enumeration_section">31.7.2.2.1</span>从NOARCHIVELOG模式中的活动日志丢失中恢复</h6>
                        <div>
                           <div class="section">
                              <p>在此方案中，数据库归档模式为<code class="codeph">NOARCHIVELOG</code> 。</p>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3" id="GUID-2D31AAD0-E337-4B17-9ACB-54B00BFC0E4C__GUID-EB14035E-3C35-46BA-8396-81F6093CF639">要从NOARCHIVELOG模式中丢失活动的在线日志组中恢复：</p>
                           </div>
                           <!-- class="section" -->
                           <ol>
                              <li class="stepexpand"><span><a id="d146940e3816" class="indexterm-anchor"></a><a id="d146940e3820" class="indexterm-anchor"></a>如果介质故障是临时故障，则更正问题，以便数据库可以在需要时重用该组。</span></li>
                              <li class="stepexpand"><span>从一致的整个数据库备份（数据文件和控制文件）还原数据库。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">％cp /disk2/backup/*.dbf $ ORACLE_HOME / oradata / trgt /</pre></div>
                              </li>
                              <li class="stepexpand"><span>挂载数据库：</span><div><pre class="oac_no_warn" dir="ltr">启动安装</pre></div>
                              </li>
                              <li class="stepexpand"><span>由于未备份联机重做日志，因此无法使用数据文件和控制文件对其进行还原。要允许数据库重置联机重做日志，必须先模仿不完全恢复：</span><div><pre class="oac_no_warn" dir="ltr">恢复数据库直到取消取消</pre></div>
                              </li>
                              <li class="stepexpand"><span>使用<code class="codeph">RESETLOGS</code>选项打开数据库：</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN RESETLOGS;</pre></div>
                              </li>
                              <li class="stepexpand"><span>一致地关闭数据库。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">立即关闭</pre></div>
                              </li>
                              <li class="stepexpand"><span>进行整个数据库备份。</span></li>
                           </ol>
                           <div class="section">
                              <p><a id="d146940e3865" class="indexterm-anchor"></a><a id="d146940e3869" class="indexterm-anchor"></a>如果介质故障是临时故障，则更正问题，以便数据库可以在需要时重用该组。如果介质故障不是暂时的，请使用以下过程。
                              </p>
                           </div>
                           <!-- class="section" -->
                        </div>
                     </div><a id="BRADV524"></a><a id="BRADV90056"></a><div class="props_rev_3"><a id="GUID-1E30E152-72CF-4BC6-BF0B-720878A84A66" name="GUID-1E30E152-72CF-4BC6-BF0B-720878A84A66"></a><h6 id="BRADV-GUID-1E30E152-72CF-4BC6-BF0B-720878A84A66" class="sect6"><span class="enumeration_section">31.7.2.2.2</span>从ARCHIVELOG模式中的活动日志丢失中恢复</h6>
                        <div>
                           <div class="section">
                              <p>在此方案中，数据库归档模式为<code class="codeph">ARCHIVELOG</code> 。</p>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3" id="GUID-1E30E152-72CF-4BC6-BF0B-720878A84A66__GUID-C6E1D142-7E0B-48D5-8EC1-201B1E273F29">要在ARCHIVELOG模式下从活动联机重做日志组丢失中恢复，请执行以下操作：</p>
                           </div>
                           <!-- class="section" -->
                           <ol>
                              <li class="stepexpand"><span>开始不完整的介质恢复，在损坏的日志之前通过日志恢复。</span></li>
                              <li class="stepexpand"><span>确保丢失的重做日志的当前名称可用于新创建的文件。如果没有，则将损坏的联机重做日志组的成员重命名为新位置。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE RENAME FILE“/disk1/oradata/trgt/redo01.log”TO“/tmp/redo01.log”; ALTER DATABASE RENAME FILE“/disk1/oradata/trgt/redo02.log”TO“/tmp/redo02.log”;</pre></div>
                              </li>
                              <li class="stepexpand"><span>使用<code class="codeph">RESETLOGS</code>选项打开数据库：</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN RESETLOGS;</pre><div class="infoboxnote" id="GUID-1E30E152-72CF-4BC6-BF0B-720878A84A66__GUID-02A49855-3B97-41F9-86CA-C0BEDD0ED759">
                                       <p class="notep1">注意：</p>
                                       <p>必须重新执行从不完全恢复的结束点到现在执行的所有更新。</p>
                                    </div>
                                 </div>
                              </li>
                           </ol>
                        </div>
                     </div>
                  </div><a id="BRADV90057"></a><div class="props_rev_3"><a id="GUID-C9590C93-758D-46FF-B6FA-1FD934545377" name="GUID-C9590C93-758D-46FF-B6FA-1FD934545377"></a><h5 id="BRADV-GUID-C9590C93-758D-46FF-B6FA-1FD934545377" class="sect5"><span class="enumeration_section">31.7.2.3</span>多个重做日志组丢失</h5>
                     <div>
                        <p><a id="d146940e4050" class="indexterm-anchor"></a>如果丢失了多组联机重做日志，则使用恢复方法来恢复最困难的日志。从最困难到最不困难的难度顺序如下：</p>
                        <ol>
                           <li>
                              <p>当前的在线重做日志</p>
                           </li>
                           <li>
                              <p>一个活跃的在线重做日志</p>
                           </li>
                           <li>
                              <p>未归档的在线重做日志</p>
                           </li>
                           <li>
                              <p>一个不活跃的在线重做日志</p>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV525"></a><a id="BRADV99985"></a><div class="props_rev_3"><a id="GUID-26C74474-50A7-46AA-A0EA-0649A795D5EA" name="GUID-26C74474-50A7-46AA-A0EA-0649A795D5EA"></a><h3 id="BRADV-GUID-26C74474-50A7-46AA-A0EA-0649A795D5EA" class="sect3"><span class="enumeration_section">31.8</span>在不使用闪回功能的情况下从丢弃的表中恢复</h3>
               <div>
                  <div class="section">
                     <p><a id="d146940e4149" class="indexterm-anchor"></a><a id="d146940e4153" class="indexterm-anchor"></a>一个常见错误是从数据库中意外删除表。通常，最快和最简单的解决方案是使用闪回删除功能来反转表的删除。如果您无法使用闪回表（例如，因为禁用了闪回删除或使用<code class="codeph">PURGE</code>选项删除了表），则可以执行本节中的过程。
                     </p>
                     <p>在这种情况下，假设您没有启用闪回数据库功能，因此<code class="codeph">FLASHBACK</code> <code class="codeph">DATABASE</code>命令不是一个选项。但是，您确实拥有数据库的物理备份。如果可能，请将遇到用户错误的数据库保持在线并可供使用。
                     </p>
                     <div class="infoboxnote" id="GUID-26C74474-50A7-46AA-A0EA-0649A795D5EA__GUID-DB4D6812-F3C5-4343-8A9C-845A167A9A12">
                        <p class="notep1">注意：</p>
                        <p>仅向适当的用户授予强大的权限，以最大限度地减少需要恢</p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-26C74474-50A7-46AA-A0EA-0649A795D5EA__GUID-B454AE41-C0DA-4B7A-8CD8-7647B3F4F896">要恢复意外删除的表：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>如果在此过程的其余步骤中发生错误，请备份现有数据库的所有数据文件。</span></li>
                     <li class="stepexpand"><span>将数据库的部分备份还原到备用位置。至少，恢复以下内容：</span><div>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">SYSTEM</code>和<code class="codeph">SYSAUX</code>表空间</p>
                              </li>
                              <li>
                                 <p>包含撤消或回滚段的表空间</p>
                              </li>
                              <li>
                                 <p>包含要检索的数据的自包含表空间</p>
                              </li>
                           </ul>
                        </div>
                     </li>
                     <li class="stepexpand"><span>使用还原的备份控制文件执行此备份的不完全恢复，直到删除表之前。</span></li>
                     <li class="stepexpand"><span>使用Data Pump Export从数据库的临时恢复版本导出丢失的数据。在这种情况下，导出意外删除的表。</span><div>
                           <div class="infoboxnote" id="GUID-26C74474-50A7-46AA-A0EA-0649A795D5EA__GUID-49C06018-C485-440B-B2C0-70F2097220B2">
                              <p class="notep1">注意：</p>
                              <p>系统审计选项已导出。</p>
                           </div>
                        </div>
                     </li>
                     <li class="stepexpand"><span>使用数据泵导入实用程序将数据导回到生产数据库。</span></li>
                     <li class="stepexpand"><span>删除数据库临时副本的文件以节省空间。</span></li>
                  </ol>
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-26C74474-50A7-46AA-A0EA-0649A795D5EA__GUID-BDBEA9E9-E3ED-4D11-AB65-60CA08BD0A15">
                        <p class="notep1">也可以看看：</p>
                        <p>有关Oracle Data Pump的更多信息，请参见<a href="../sutil/oracle-data-pump-overview.html#SUTIL100" target="_blank"><span class="italic">Oracle数据库实用程序</span></a></p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="BRADV606"></a><a id="BRADV233"></a><div class="props_rev_3"><a id="GUID-834054AF-7189-4CD6-93D4-1CD4EB6BF1F1" name="GUID-834054AF-7189-4CD6-93D4-1CD4EB6BF1F1"></a><h3 id="BRADV-GUID-834054AF-7189-4CD6-93D4-1CD4EB6BF1F1" class="sect3"><span class="enumeration_section">31.9</span>使用SQL * Plus删除数据库</h3>
               <div>
                  <div class="section">
                     <p>您可能需要从操作系统中删除数据库，即构成数据库的数据库文件。例如，当您创建测试数据库然后不再使用它时，就会发生这种情况。SQL语句<code class="codeph">DROP</code> <code class="codeph">DATABASE</code>可以执行此功能。
                     </p>
                     <div class="infoboxnotealso" id="GUID-834054AF-7189-4CD6-93D4-1CD4EB6BF1F1__GUID-1A6B050E-D323-42E5-A4E4-4A59770E53BD">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="maintaining-rman-backups.html#GUID-45EFE02D-488C-4F55-A648-6FFF5CB7A32F" title="要从操作系统中删除数据库，可以在RMAN中使用DROP DATABASE命令。 RMAN删除服务器参数文件，所有数据文件，联机重做日志和属于目标数据库的控制文件。">删除数据库</a> ”</span>以了解如何使用等效的RMAN命令<code class="codeph">DROP</code> <code class="codeph">DATABASE</code></p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-834054AF-7189-4CD6-93D4-1CD4EB6BF1F1__GUID-8B126D8A-463E-4C8E-9989-955640212CD4">要使用SQL * Plus删除数据库：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>使用管理员权限连接到数据库后，请确保已在受限模式下挂载或打开数据库，且未连接任何用户。</span><div>
                           <p>例如，输入以下命令：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; STARTUP RESTRICT FORCE MOUNT</pre></div>
                     </li>
                     <li class="stepexpand"><span>从操作系统中删除数据文件和控制文件。</span><div>
                           <p>例如，输入以下命令：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; DROP DATABASE; ＃删除所有数据库文件，包括ASM和非ASM</pre><p>如果数据库位于原始磁盘上，则该命令不会删除实际的原始磁盘特殊文件。</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>使用操作系统实用程序删除与数据库关联的所有备份和归档日志。</span><div>
                           <p>例如，在Linux和UNIX上输入以下命令：</p><pre class="oac_no_warn" dir="ltr">％rm / backup / * / disk1 / oradata / trgt / arch / *</pre></div>
                     </li>
                  </ol>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>