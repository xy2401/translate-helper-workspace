<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="These topics address how to upgrade and downgrade an Oracle database when a physical or logical standby database is present in the Oracle Data Guard configuration."></meta>
      <meta name="description" content="These topics address how to upgrade and downgrade an Oracle database when a physical or logical standby database is present in the Oracle Data Guard configuration."></meta>
      <title>在Oracle Data Guard配置中修补，升级和降级数据库</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Concepts and Administration "></meta>
      <meta property="og:description" content="These topics address how to upgrade and downgrade an Oracle database when a physical or logical standby database is present in the Oracle Data Guard configuration."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Concepts and Administration"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="data-guard-concepts-and-administration.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-02-12T10:50:21-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1999, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96244-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="troubleshooting-oracle-data-guard.html" title="Previous" type="text/html"></link>
      <link rel="next" href="data-type-ddl-support-on-logical-standby-databases.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Data Guard Concepts and Administration"></meta>
    <meta name="dcterms.isVersionOf" content="SBYDB"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="troubleshooting-oracle-data-guard.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="data-type-ddl-support-on-logical-standby-databases.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">概念和管理</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="oracle-data-guard-supplemental-information.html" property="item" typeof="WebPage"><span property="name">附录</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">在Oracle Data Guard配置中修补，升级和降级数据库</li>
            </ol>
            <a id="GUID-A4FBE490-7E7E-4998-B80E-01C93C77AE2F" name="GUID-A4FBE490-7E7E-4998-B80E-01C93C77AE2F"></a><a id="SBYDB1200"></a>
            
            <h2 id="SBYDB-GUID-A4FBE490-7E7E-4998-B80E-01C93C77AE2F" class="sect2"><span class="enumeration_chapter">B</span>在Oracle Data Guard配置中修补，升级和降级数据库</h2>
         </header>
         <div class="ind">
            <div>
               <p>这些主题介绍了在Oracle Data Guard配置中存在物理或逻辑备用数据库时如何升级和降级Oracle数据库。</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="upgrading-patching-downgrading-oracle-data-guard-configuration.html#GUID-784C06D8-9CFA-4244-BA55-D7003CAB3F1E" title="在开始修补或升级Oracle数据库软件之前，需要考虑几点。">在升级Oracle数据库软件之前</a></p>
                  </li>
                  <li>
                     <p><a href="upgrading-patching-downgrading-oracle-data-guard-configuration.html#GUID-A5226768-DB6B-4714-BB9A-0A3EF17A01C8" title="Oracle Data Guard Standby-First Patch Apply为主数据库及其物理备用数据库之间的不同数据库主页软件提供支持。">使用备用第一补丁修补Oracle数据库</a></p>
                  </li>
                  <li>
                     <p><a href="upgrading-patching-downgrading-oracle-data-guard-configuration.html#GUID-6431EFBF-6B00-4E7D-A106-63574225BDD9" title="这些步骤说明了在配置中存在物理备用数据库时如何升级到Oracle Database 12c第2版（12.2）。">使用物理备用数据库升级Oracle数据库</a></p>
                  </li>
                  <li>
                     <p><a href="upgrading-patching-downgrading-oracle-data-guard-configuration.html#GUID-5AF5983E-E481-4599-88B9-311A43EB5C80" title="这些步骤描述了使用逻辑备用数据库升级Oracle数据库软件的传统方法。">使用逻辑备用数据库升级Oracle数据库</a></p>
                  </li>
                  <li>
                     <p><a href="upgrading-patching-downgrading-oracle-data-guard-configuration.html#GUID-253C94C1-8E40-4378-A0A5-2627C248D873" title="升级到新版本的Oracle数据库时，某些新功能可能会使您的数据库与以前的版本不兼容。">升级后修改COMPATIBLE初始化参数</a></p>
                  </li>
                  <li>
                     <p><a href="upgrading-patching-downgrading-oracle-data-guard-configuration.html#GUID-F087E74B-ED71-42DF-A730-2A8A5FAA1A84" title="执行以下步骤以在不包含逻辑备用数据库的Oracle Data Guard配置中降级Oracle数据库。">在没有逻辑备用的情况下降级Oracle数据库</a></p>
                  </li>
                  <li>
                     <p><a href="upgrading-patching-downgrading-oracle-data-guard-configuration.html#GUID-FDB0FA2C-EA66-423C-AFD9-51F3FA4899F8" title="执行以下步骤以在Oracle Data Guard配置中降级Oracle数据库，该配置包含逻辑备用数据库或逻辑和物理备用数据库的混合。">使用逻辑备用数据降级Oracle数据库</a></p>
                  </li>
               </ul>
            </div><a id="SBYDB4931"></a><div class="props_rev_3"><a id="GUID-784C06D8-9CFA-4244-BA55-D7003CAB3F1E" name="GUID-784C06D8-9CFA-4244-BA55-D7003CAB3F1E"></a><h3 id="SBYDB-GUID-784C06D8-9CFA-4244-BA55-D7003CAB3F1E" class="sect3"><span class="enumeration_section">B.1</span>修补或升级Oracle数据库软件之前</h3>
               <div>
                  <p>在开始修补或升级Oracle数据库软件之前，需要考虑几点。</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>如果您使用Oracle Data Guard代理来管理配置，请按照<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=DGBKR1200" target="_blank"><span class="italic">Oracle Data Guard Broker</span></a>手册中的说明获取有关删除或禁用代理配置的信息。
                        </p>
                     </li>
                     <li>
                        <p>这些主题中描述的过程将与“ <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=UPGRD001" target="_blank"><span class="italic">Oracle数据库升级指南”中</span></a>包含的过程一起使用。
                        </p>
                     </li>
                     <li>
                        <p>检查nologging操作。如果已执行nologging操作，则必须更新备用数据库。有关详细信息，请参阅<a href="examples-of-using-oracle-data-guard.html#GUID-BD9E85AB-D812-4659-9C85-26CDFF115A8A" title="某些SQL语句允许您指定NOLOGGING子句，以便在联机重做日志文件中不记录该操作。">指定NOLOGGING子句后的恢复</a> 。
                        </p>
                     </li>
                     <li>
                        <p>记下由于<code class="codeph">OFFLINE IMMEDIATE</code>而需要恢复的任何表空间或数据文件。在升级之前，应该在线或离线恢复表空间或数据文件。
                        </p>
                     </li>
                     <li>
                        <p>在Oracle Data Guard配置中，所有物理和快照备用数据库都必须使用主数据库中密码文件的副本。如Oracle数据库12的<span class="italic">c</span>解除2（12.2.0.1），在主数据库上进行密码文件的变化将自动传播到备用数据库。（密码文件更改包括授予或撤销管理权限（ <code class="codeph">SYSDG</code> ， <code class="codeph">SYSOPER</code> ， <code class="codeph">SYSDBA</code>等）的时间，以及更改具有管理权限的任何用户的密码时。）
                        </p>
                        <p>远程同步实例是自动更新功能的一个例外。更新的密码文件仍必须手动复制到远程同步实例，因为远程同步实例会接收重做，但不会应用它。在远程同步实例上手动更新密码文件时，包含来自主数据库的相同密码更改的重做会自动传播到设置为从该远程同步实例接收重做的任何备用数据库。应用重做时，备用数据库上的密码文件会更新。</p>
                     </li>
                  </ul>
                  <div class="infoboxnote" id="GUID-784C06D8-9CFA-4244-BA55-D7003CAB3F1E__GUID-5FE1991A-D491-4F8B-8DBB-2BE371A44759">
                     <p class="notep1">注意：</p>
                     <p>如果您的配置中存在级联备用数据库，那么这些级联备用数据库必须遵循与任何其他备用数据库相同的规则，但应该最后关闭并首先在新家中重新启动。</p>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-A5226768-DB6B-4714-BB9A-0A3EF17A01C8" name="GUID-A5226768-DB6B-4714-BB9A-0A3EF17A01C8"></a><h3 id="SBYDB-GUID-A5226768-DB6B-4714-BB9A-0A3EF17A01C8" class="sect3"><span class="enumeration_section">B.2</span>使用备用第一补丁修补Oracle数据库</h3>
               <div>
                  <p>Oracle Data Guard Standby-First Patch Apply为主数据库及其物理备用数据库之间的不同数据库主页软件提供支持。</p>
                  <p>提供此支持的目的是以滚动方式应用和验证Oracle修补程序和修补程序包，同时将主数据库的风险降至最低。例如，使用Data Guard Standby-First Patch Apply，您首先将数据库主补丁应用于物理备用数据库。备用数据库用于运行只读工作负载，如果是快照备用数据库，则用于读写工作负载，用于测试和评估补丁。在通过评估之后，然后将补丁安装在主系统上，更好地保证数据库主补丁的有效性和稳定性。</p>
                  <p>Oracle Data Guard Standby-First Patch Apply仅支持Oracle Databaseered Systems上的Oracle Database 11.2.0.1及更高版本的经过认证的临时修补程序和修补程序包（例如，修补程序集更新或Exadata数据库修补程序）（例如，Exadata， SuperCluster）和非工程系统。Data Guard Standby-First认证的补丁和补丁包在补丁自述文件中说明以下内容：</p>
                  <p><code class="codeph">Data Guard Standby-First Installable</code></p>
                  <p>以下类型的补丁是Data Guard Standby-First认证的候选者：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>数据库主页临时补丁</p>
                     </li>
                     <li>
                        <p>Exadata捆绑包修补程序（例如，Exadata的每月和每季度数据库修补程序）</p>
                     </li>
                     <li>
                        <p>数据库补丁集更新</p>
                     </li>
                  </ul>
                  <p>更新可能会破坏运行不同数据库家庭软件的主要和物理备用系统之间的互操作性的模块的修补程序和修补软件包未经过“Data Guard Standby-First Installable”认证，并且未在修补程序自述文件中说明。</p>
                  <p>Oracle补丁集和主要版本升级不符合Data Guard Standby-First Patch Apply的条件。例如，从11.2.0.2到11.2.0.3或11.2到12.1的升级不符合条件。对数据库修补程序集和主要版本使用Data Guard临时逻辑备用滚动升级过程。</p>
                  <p>此外，从Oracle Database <span class="italic">11g</span>第2版（11.2.0.1）开始，可以使用物理备用数据库以滚动方式安装符合条件的一次性修补程序，修补程序集更新（PSU）和关键修补程序更新（CPU）。有关此功能的更多信息，请参阅<a href="http://support.oracle.com" target="_blank"><code class="codeph">http://support.oracle.com</code></a>的My Oracle Support说明1265700.1。</p>
               </div>
            </div><a id="SBYDB4932"></a><div class="props_rev_3"><a id="GUID-6431EFBF-6B00-4E7D-A106-63574225BDD9" name="GUID-6431EFBF-6B00-4E7D-A106-63574225BDD9"></a><h3 id="SBYDB-GUID-6431EFBF-6B00-4E7D-A106-63574225BDD9" class="sect3"><span class="enumeration_section">B.3</span>使用物理备用数据库升级Oracle数据库</h3>
               <div>
                  <p>这些步骤说明了在配置中存在物理备用数据库时如何升级到Oracle Database 12 <span class="italic">c</span>第2版（12.2）。
                  </p>
                  <ol>
                     <li class="stepexpand">
                        <div class="infoboxnote" id="GUID-6431EFBF-6B00-4E7D-A106-63574225BDD9__GUID-36698435-76E9-4FDC-825F-1129F8FDD8CD">
                           <p class="notep1">注意：</p>如果要升级的数据库是Oracle Data Guard代理配置的成员，则在继续之前必须禁用快速启动故障转移并关闭代理。有关如何执行此操作的信息，请参阅<a href="../dgbkr/upgrading-downgrading-in-data-guard-broker-configuration.html#DGBKR-GUID-9B424C49-A005-4106-9EF8-CB7479F9ACB8" target="_blank"><span><cite>Oracle Data Guard Broker</cite></span></a> 。
                        </div><span>查看并执行“ <a href="../upgrd/tasks-prepare-upgrade-oracle-database.html#UPGRD002" target="_blank"><span class="italic">Oracle数据库升级指南</span></a> ”的“准备升级”一章中列出的步骤。</span></li>
                     <li class="stepexpand"><span>如<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=UPGRD003" target="_blank"><span class="italic">Oracle数据库升级指南中</span></a>所述，将新版本的Oracle软件安装到物理备用数据库和主数据库系统上的新Oracle主目录中。</span></li>
                     <li class="stepexpand"><span>关闭主数据库。</span></li>
                     <li class="stepexpand"><span>关闭物理备用数据库。</span></li>
                     <li class="stepexpand"><span>停止在要升级的Oracle主目录中运行的所有侦听器，代理程序和其他进程。在Oracle Real Application Clusters（Oracle RAC）环境中的所有节点上执行此步骤。</span></li>
                     <li class="stepexpand"><span>如果正在使用Oracle自动存储管理（Oracle ASM），请关闭所有使用Oracle ASM的数据库，然后关闭所有Oracle ASM实例。</span></li>
                     <li class="stepexpand"><span>在新的Oracle主目录中，重新启动在步骤5中停止的所有侦听器，代理和其他进程。</span></li>
                     <li class="stepexpand"><span>在新的Oracle主目录（升级版本）上挂载物理备用数据库。有关如何<a href="creating-oracle-data-guard-physical-standby.html#GUID-3D65210D-9FE5-490E-938E-57FC2E07A569" title="These are the steps to start the physical standby database and Redo Apply.">启动物理备用数据库</a>的信息，请参阅<a href="creating-oracle-data-guard-physical-standby.html#GUID-3D65210D-9FE5-490E-938E-57FC2E07A569" title="这些是启动物理备用数据库和重做应用的步骤。">启动</a>物理备用数据库。</span><div>
                           <div class="infoboxnote" id="GUID-6431EFBF-6B00-4E7D-A106-63574225BDD9__GUID-C3C376B0-7DA4-4025-AB89-A41256B2DC81">
                              <p class="notep1">注意：</p>
                              <p>在主数据库升级完成之前，请勿打开备用数据库。</p>
                           </div>
                        </div>
                     </li>
                     <li class="stepexpand"><span>在物理备用数据库上启动Redo Apply。有关如何启动重做应用的信息，请参阅<a href="creating-oracle-data-guard-physical-standby.html#GUID-3D65210D-9FE5-490E-938E-57FC2E07A569" title="这些是启动物理备用数据库和重做应用的步骤。">启动物理备用数据库</a> 。</span></li>
                     <li class="stepexpand"><span>按照“ <a href="../upgrd/upgrading-oracle-database.html#UPGRD003" target="_blank"><span class="italic">Oracle数据库升级指南”</span></a>中的说明升级主数据库。当应用主数据库升级时生成的重做时，将升级物理备用数据库。</span></li>
                     <li class="stepexpand"><span>打开已升级的主数据库。</span></li>
                     <li class="stepexpand"><span>如果在升级之前使用了Oracle Active Data Guard，请参阅<a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-07CB190C-C248-4FF5-AB64-EAA9C6D42677" title="必须将COMPATIBLE数据库初始化参数设置为11.0或更高才能使用Oracle Active Data Guard选项的实时查询功能。">实时查询</a>以获取有关如何在升级后重新启用它的信息。</span></li>
                     <li class="stepexpand"><span>可选地，修改<code class="codeph">COMPATIBLE</code>初始化参数，以下中所述的程序<a href="upgrading-patching-downgrading-oracle-data-guard-configuration.html#GUID-253C94C1-8E40-4378-A0A5-2627C248D873" title="升级到新版本的Oracle数据库时，某些新功能可能会使您的数据库与以前的版本不兼容。">修改兼容初始化参数升级后</a> 。</span><div>
                           <div class="infoboxnote" id="GUID-6431EFBF-6B00-4E7D-A106-63574225BDD9__GUID-B0BEBCE6-1B7A-49E3-A5FB-0A1A06023CDB">
                              <p class="notep1">注意：</p>
                              <p>在Windows平台上，必须使用ORADIM实用程序删除数据库服务（对于旧数据库版本）并为新数据库版本创建新的数据库服务。必须在主服务器和备用服务器上替换<code class="codeph">OracleService&lt;SID&gt;</code> 。
                              </p>
                           </div>
                        </div>
                     </li>
                  </ol>
               </div>
            </div><a id="SBYDB4933"></a><div class="props_rev_3"><a id="GUID-5AF5983E-E481-4599-88B9-311A43EB5C80" name="GUID-5AF5983E-E481-4599-88B9-311A43EB5C80"></a><h3 id="SBYDB-GUID-5AF5983E-E481-4599-88B9-311A43EB5C80" class="sect3"><span class="enumeration_section">B.4</span>使用逻辑备用数据库升级Oracle数据库</h3>
               <div>
                  <p>这些步骤描述了使用逻辑备用数据库升级Oracle数据库软件的传统方法。</p>
                  <div class="section">
                     <div class="infoboxnote" id="GUID-5AF5983E-E481-4599-88B9-311A43EB5C80__GUID-D413D6D2-300D-4F68-AA22-C3396791B5A7">
                        <p class="notep1">注意：</p>
                        <p><a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-290F632F-5295-47F3-AEF1-2D37C69C00D7" title="您可以使用逻辑备用数据库执行Oracle数据库软件的滚动升级。">使用SQL Apply升级Oracle数据库</a>提供了另一种方法，可以使用逻辑备用数据库以滚动方式执行升级，以最大限度地减少停机时间。仅使用一种方法中的步骤执行完整升级。在执行升级过程时，请勿尝试使用这两种方法或组合这两种方法中的步骤。
                        </p>
                     </div>
                     <p>当配置中存在逻辑备用数据库时，请执行以下步骤以升级到Oracle Database 12 <span class="italic">c</span>第2版（12.2）。这些步骤假定主数据库在<code class="codeph">MAXIMUM PERFORMANCE</code>数据保护模式下运行。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="p">查看并执行“ <a href="../upgrd/tasks-prepare-upgrade-oracle-database.html#UPGRD002" target="_blank"><span><cite>Oracle数据库升级指南</cite></span></a> ”的“准备升级”一章中列出的步骤</div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>如果需要，在主数据库中将数据保护模式设置为<code class="codeph">MAXIMUM PERFORMANCE</code> ：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE SET STANDBY DATABASE以最大限度地提高性能;</pre></div>
                     </li>
                     <li class="stepexpand"><span>在主数据库上，停止所有用户活动并推迟与逻辑备用数据库关联的远程归档目标（对于此过程，假定<code class="codeph">LOG_ARCHIVE_DEST_2</code>与逻辑备用数据库关联）：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER SYSTEM SET LOG_ARCHIVE_DEST_STATE_2 = DEFER SCOPE = BOTH; SQL&gt; ALTER SYSTEM ARCHIVE LOG CURRENT;</pre></div>
                     </li>
                     <li class="stepexpand"><span>在逻辑备用数据库上停止SQL Apply：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE STOP LOGICAL STANDBY APPLY;</pre></div>
                     </li>
                     <li class="stepexpand"><span>在主数据库上安装较新版本的Oracle软件。 。</span></li>
                     <li class="stepexpand"><span>在逻辑备用数据库上，安装较新版本的Oracle软件。</span><div>
                           <div class="infoboxnote" id="GUID-5AF5983E-E481-4599-88B9-311A43EB5C80__GUID-9C5473C8-2AAA-4341-80F4-34107983369D">
                              <p class="notep1">注意：</p>
                              <p>可以同时执行步骤4和5（换句话说，可以同时升级主数据库和备用数据库）以减少升级过程期间的停机时间。</p>
                           </div>
                        </div>
                     </li>
                     <li class="stepexpand"><span>在已升级的逻辑备用数据库上，重新启动SQL Apply。如果您使用的是Oracle RAC，请启动其他备用数据库实例：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE START LOGICAL STANDBY立即申请;</pre></div>
                     </li>
                     <li class="stepexpand"><span>打开已升级的主数据库并允许用户进行连接。如果您使用的是Oracle RAC，请启动其他主数据库实例。</span><div>
                           <p>此外，启用对已升级的逻辑备用数据库的归档，如下所示：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER SYSTEM SET LOG_ARCHIVE_DEST_STATE_2 = ENABLE;</pre></div>
                     </li>
                     <li class="stepexpand"><span>（可选）如果在步骤1中更改了原始数据保护模式，请将其重置为原始数</span></li>
                     <li class="stepexpand"><span>（可选）修改<code class="codeph">COMPATIBLE</code>初始化参数。</span></li>
                  </ol>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=UPGRD-GUID-CC88F262-3370-4FFA-8604-EDA9F20F56D9" target="_blank"><span><cite>Oracle数据库升级指南</cite></span></a></li>
                     </ul>
                  </div>
               </div>
            </div><a id="SBYDB5129"></a><div class="props_rev_3"><a id="GUID-253C94C1-8E40-4378-A0A5-2627C248D873" name="GUID-253C94C1-8E40-4378-A0A5-2627C248D873"></a><h3 id="SBYDB-GUID-253C94C1-8E40-4378-A0A5-2627C248D873" class="sect3"><span class="enumeration_section">B.5</span>升级后修改COMPATIBLE初始化参数</h3>
               <div>
                  <p>升级到新版本的Oracle数据库时，某些新功能可能会使您的数据库与以前的版本不兼容。</p>
                  <div class="section">
                     <p>Oracle数据库使您可以控制数据库与<code class="codeph">COMPATIBLE</code>初始化的<code class="codeph">COMPATIBLE</code> <a id="d60832e824" class="indexterm-anchor"></a><a id="d60832e828" class="indexterm-anchor"></a>参数。
                     </p>
                     <p>升级完成后，您可以将<code class="codeph">COMPATIBLE</code>初始化参数的设置增加到新Oracle Database版本的最高级别。如果您确定不再需要将数据库降级回其原始版本的能力，请根据新数据库所需的兼容级别设置<code class="codeph">COMPATIBLE</code>初始化参数。
                     </p>
                     <p>在Oracle Data Guard配置中，如果您决定在升级后增加<code class="codeph">COMPATIBLE</code>初始化参数的设置，则必须按所示顺序执行以下步骤（确保备用数据库的<code class="codeph">COMPATIBLE</code>设置等于，或者高于，初级）：</p>
                     <ol>
                        <li>
                           <p>首先在配置中的所有备用数据库上增加<code class="codeph">COMPATIBLE</code>初始化参数的值，如下所示：</p>
                           <ol type="a">
                              <li>
                                 <p>确保在备用数据库上应用是最新的。</p>
                              </li>
                              <li>
                                 <p>在每个备用数据库的一个实例上，执行以下SQL语句：</p><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SET COMPATIBLE = &lt; <span class="italic">值</span> &gt; SCOPE = SPFILE;</pre></li>
                              <li>
                                 <p>如果正在运行Redo Apply或SQL Apply，则将其停止。</p>
                              </li>
                              <li>
                                 <p>重新启动备用数据库的所有实例。</p>
                              </li>
                              <li>
                                 <p>如果您之前已停止重做应用或SQL应用，请重新启动它们。</p>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p>增加主数据库上<code class="codeph">COMPATIBLE</code>初始化参数的值，如下所示：</p>
                           <ol type="a">
                              <li>
                                 <p>在主数据库的一个实例上，执行以下SQL语句：</p><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SET COMPATIBLE = &lt; <span class="italic">值</span> &gt; SCOPE = SPFILE;</pre></li>
                              <li>
                                 <p>重新启动主数据库的所有实例。</p>
                              </li>
                           </ol>
                        </li>
                     </ol>
                     <div class="infoboxnotealso" id="GUID-253C94C1-8E40-4378-A0A5-2627C248D873__GUID-EF5E8579-5753-4377-9BA7-D8DD09CE8C36">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关兼容性设置的详细信息，请参阅<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=UPGRD12472" target="_blank"><span class="italic">“Oracle数据库升</span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="SBYDB5132"></a><div class="props_rev_3"><a id="GUID-F087E74B-ED71-42DF-A730-2A8A5FAA1A84" name="GUID-F087E74B-ED71-42DF-A730-2A8A5FAA1A84"></a><h3 id="SBYDB-GUID-F087E74B-ED71-42DF-A730-2A8A5FAA1A84" class="sect3"><span class="enumeration_section">B.6</span>在没有逻辑备用的情况下降级Oracle数据库</h3>
               <div>
                  <p>执行以下步骤以在<span class="italic">不</span>包含逻辑备用数据库的Oracle Data Guard配置中降级Oracle数据库。
                  </p>
                  <ol>
                     <li class="stepexpand"><span>确保已装入所有物理备用数据库，但未打开。在应用由主数据库降级生成的所有重做之前，请勿打开备用数据库。</span></li>
                     <li class="stepexpand"><span>在实时应用模式下，在物理备用数据库上启动重做应用。</span></li>
                     <li class="stepexpand"><span>使用“ <a href="../upgrd/downgrading-oracle-db-after-upgrade.html#UPGRD007" target="_blank"><span class="italic">Oracle数据库升级指南”中</span></a>描述的过程降级主数据库，并记住以下几点：</span><div>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>在执行脚本的降级过程的每个步骤中，仅在主数据库上执行脚本。在主数据库中执行脚本所生成的所有重做已应用于每个物理备用数据库之前，请勿执行下一个降级步骤。</p>
                              </li>
                              <li>
                                 <p>在降级过程的每个步骤中，执行除运行脚本之外的操作，首先在主数据库中执行步骤，然后在每个物理备用数据库上执行。在每个物理备用数据库执行操作之前，请勿在主数据库上执行下一个降级步骤。</p>
                              </li>
                           </ul>
                        </div>
                     </li>
                     <li class="stepexpand"><span>如果在降级期间需要执行故障转移，请执行故障转移，然后在新的主数据库上继续执行降级过程。</span></li>
                  </ol>
               </div>
            </div><a id="SBYDB5133"></a><div class="props_rev_3"><a id="GUID-FDB0FA2C-EA66-423C-AFD9-51F3FA4899F8" name="GUID-FDB0FA2C-EA66-423C-AFD9-51F3FA4899F8"></a><h3 id="SBYDB-GUID-FDB0FA2C-EA66-423C-AFD9-51F3FA4899F8" class="sect3"><span class="enumeration_section">B.7</span>使用逻辑备用<span class="enumeration_section">磁盘</span>降级Oracle数据库</h3>
               <div>
                  <p>执行以下步骤以在Oracle Data Guard配置中降级Oracle数据库，该配置包含逻辑备用数据库或逻辑和物理备用数据库的混合。</p>
                  <ol>
                     <li class="stepexpand"><span>在降级之前，在主数据库（数据库P，为此讨论）发出以下命令：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE COMMIT to SWITCHOVER to LOGICAL STANDBY;</pre><p>数据库P不再是主数据库角色。</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>等待配置中的<span class="italic">所有</span>备用数据库完成应用所有可用的重做。要确定每个备用数据库是否已完成应用所有可用重做，请在每个备用数据库上运行以下查询：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT SWITCHOVER_STATUS FROM V $ DATABASE; SWITCHOVER_STATUS -----------------初级</pre><p>在查询为配置中的所有备用数据库返回<code class="codeph">TO PRIMARY</code>值之前，请不要继续执行步骤3。
                           </p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>使用“ <a href="../upgrd/downgrading-oracle-db-after-upgrade.html#UPGRD007" target="_blank"><span class="italic">Oracle数据库升级指南”中</span></a>描述的过程降级逻辑备用数据库，并记住以下几点：</span><div>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>在执行脚本的降级过程的每个步骤中，仅在逻辑备用数据库上执行脚本。不要执行下一个降级步骤，直到通过在最近位于主要角色（数据库P）的逻辑备用数据库上执行脚本生成的所有重做已应用于每个物理备用数据库。</p>
                              </li>
                              <li>
                                 <p>在执行除运行脚本以外的操作的降级过程的每个步骤中，首先在最近处于主要角色（数据库P）的逻辑备用数据库中执行步骤，然后在每个物理备用数据库上执行该步骤。在最近处于主要角色（数据库P）的逻辑备用数据库中，不执行下一个降级步骤，直到在每个物理备用数据库上执行操作为止。</p>
                              </li>
                           </ul>
                        </div>
                     </li>
                     <li class="stepexpand"><span>在最近处于主要角色（数据库P）的逻辑备用数据库已成功降级后，打开它，并发出以下命令：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE激活LOGICAL STANDBY DATABASE;</pre><p>数据库P现在回到主要角色。</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>在配置中的每个逻辑备用数据库上，发出以下命令（请注意，该命令要求在所有逻辑备用数据库中存在返回主数据库的数据库链接）：</span><div>
                           <p></p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE START LOGICAL STANDBY立即申请新PRIMARY <span class="italic">prim_db_link</span> ;</pre></div>
                     </li>
                  </ol>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>