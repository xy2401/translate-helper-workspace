<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="Lists and describes the transaction functions."></meta>
      <meta name="description" content="Lists and describes the transaction functions."></meta>
      <title>交易功能</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Programmer&#39;s Guide"></meta>
      <meta property="og:description" content="Lists and describes the transaction functions."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Programmer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="oracle-call-interface-programmers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-14T08:46:00-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96204-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="thread-management-functions.html" title="Previous" type="text/html"></link>
      <link rel="next" href="shard-functions.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Oracle Call Interface Programmer&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="LNOCI"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="thread-management-functions.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="shard-functions.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">程序员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="more-database-access-c-api.html" property="item" typeof="WebPage"><span property="name">更多Oracle Database Access C API</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">交易功能</li>
            </ol>
            <a id="GUID-69F748A0-89C2-431C-A126-1C0DF0552084" name="GUID-69F748A0-89C2-431C-A126-1C0DF0552084"></a><a id="LNOCI17276"></a><a id="LNOCI166"></a>
            
            <h2 id="LNOCI-GUID-69F748A0-89C2-431C-A126-1C0DF0552084" class="sect2"><span class="enumeration_section">26.7</span>交易功能</h2>
         </header>
         <div class="ind">
            <div>
               <p>列出并描述交易功能。</p>
               <div class="section">
                  <p><a href="transaction-functions.html#GUID-69F748A0-89C2-431C-A126-1C0DF0552084__CIHFIBHC" title="该表有2列。第1列是OCI函数名称，第2列描述其目的。">表26-6</a>列出了本节中描述的事务功能。
                  </p>
               </div>
               <!-- class="section" -->
               <div class="tblformalwide" id="GUID-69F748A0-89C2-431C-A126-1C0DF0552084__CIHFIBHC">
                  <p class="titleintable">表26-6事务功能</p>
                  <table cellpadding="4" cellspacing="0" class="FormalWide" title="交易功能" width="100%" border="1" summary="This table has 2 columns. Column 1 is the OCI function name and column 2 describes its purpose. " frame="hsides" rules="rows">
                     <thead>
                        <tr align="left" valign="top">
                           <th align="left" valign="bottom" width="61%" id="d223602e207">功能</th>
                           <th align="left" valign="bottom" width="39%" id="d223602e210">目的</th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="61%" id="d223602e215" headers="d223602e207 ">
                              <p><a href="transaction-functions.html#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="提交与指定服务上下文关联的事务。">OCITransCommit（）</a></p>
                           </td>
                           <td align="left" valign="top" width="39%" headers="d223602e215 d223602e210 ">
                              <p>在服务上下文上提交事务</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="61%" id="d223602e227" headers="d223602e207 ">
                              <p><a href="transaction-functions.html#GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09" title="分离全局事务。">OCITransDetach（）</a></p>
                           </td>
                           <td align="left" valign="top" width="39%" headers="d223602e227 d223602e210 ">
                              <p>从服务上下文中分离事务</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="61%" id="d223602e239" headers="d223602e207 ">
                              <p><a href="transaction-functions.html#GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00" title="导致服务器忘记启发式完成的全局事务。">OCITransForget（）</a></p>
                           </td>
                           <td align="left" valign="top" width="39%" headers="d223602e239 d223602e210 ">
                              <p>忘记准备好的全球交易</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="61%" id="d223602e251" headers="d223602e207 ">
                              <p><a href="transaction-functions.html#GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7" title="在一次调用中准备具有多个分支的事务。">OCITransMultiPrepare（）</a></p>
                           </td>
                           <td align="left" valign="top" width="39%" headers="d223602e251 d223602e210 ">
                              <p>在单个单元格中准备具有多个分支的事务</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="61%" id="d223602e263" headers="d223602e207 ">
                              <p><a href="transaction-functions.html#GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3" title="准备提交的全局事务。">OCITransPrepare（）</a></p>
                           </td>
                           <td align="left" valign="top" width="39%" headers="d223602e263 d223602e210 ">
                              <p>准备提交的全局事务</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="61%" id="d223602e275" headers="d223602e207 ">
                              <p><a href="transaction-functions.html#GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366" title="回滚当前交易。">OCITransRollback（）</a></p>
                           </td>
                           <td align="left" valign="top" width="39%" headers="d223602e275 d223602e210 ">
                              <p>回滚交易</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="61%" id="d223602e287" headers="d223602e207 ">
                              <p><a href="transaction-functions.html#GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8" title="设置事务的开始。">OCITransStart（）</a></p>
                           </td>
                           <td align="left" valign="top" width="39%" headers="d223602e287 d223602e210 ">
                              <p>在服务上下文上启动事务</p>
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </div>
               <!-- class="inftblhruleinformal" -->
            </div><a id="LNOCI13112"></a><div class="props_rev_3"><a id="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" name="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4"></a><h3 id="LNOCI-GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" class="sect3"><span class="enumeration_section">26.7.1</span> OCITransCommit（）</h3>
               <div>
                  <p>提交与指定服务上下文关联的事务。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-EEC30B29-0E58-40F6-8C0E-A8DF541065C0">目的</p>
                     <p>提交与指定服务上下文关联的事务。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-08C1266D-FCEF-45CE-9A65-9ED4F5067F3B">句法</p><pre class="oac_no_warn" dir="ltr">剑OCITransCommit（OCISvcCtx * svchp，OCIError * errhp，ub4标志）;</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-0E9162B4-8DB6-41DA-A21F-B75F0D062919">参数</p>
                     <dl>
                        <dt class="dlterm"><a name="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-F2FFDCD2-C177-4BE8-9989-98BCFF07B452"><!-- --></a> <span class="bold">svchp</span> （IN）</dt>
                        <dd>
                           <p>服务上下文句柄。</p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-176CA3A7-9C2E-4886-B7B0-F90E94DD427C"><!-- --></a> <span class="bold">errhp</span> （IN）</dt>
                        <dd>
                           <p>一个错误句柄，您可以在出现错误时传递给<code class="codeph">OCIErrorGet()</code>以获取诊断信息。
                           </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-45DB65B3-D111-49F2-8340-80B03783E248"><!-- --></a> <span class="bold">标志（IN）</span></dt>
                        <dd>
                           <p>用于全局事务中的一阶段提交优化的标志。</p>
                           <p><code class="codeph">OCI_DEFAULT</code> - 如果事务是非分布式的，则忽略flags参数，并且可以将<code class="codeph">OCI_DEFAULT</code>作为其值传递。
                           </p>
                           <p><code class="codeph">OCI_TRANS_TWOPHASE</code> - 管理全局事务的OCI应用程序应将此值传递给flags参数以进行两阶段提交。默认值是单阶段提交。
                           </p>
                           <p><code class="codeph">OCI_TRANS_WRITEIMMED</code> -  I / O由LGWR（后台的Log Writer Process）启动，将（内存中）重做缓冲区写入联机重做日志。<code class="codeph">IMMEDIATE</code>表示通过向LGWR发送消息立即写出事务的重做缓冲区，LGWR立即处理消息。
                           </p>
                           <p><code class="codeph">OCI_TRANS_WRITEBATCH</code> -  LGWR没有发出I / O来将事务的内存中重做缓冲区写入联机重做日志。<code class="codeph">BATCH</code>意味着LGWR在启动整个批次的I / O之前批量重做缓冲区。指定<code class="codeph">BATCH</code>和<code class="codeph">IMMEDIATE</code>时发生错误。 <code class="codeph">IMMEDIATE</code>是默认值。
                           </p>
                           <p><code class="codeph">OCI_TRANS_WRITEWAIT</code> - 请求LGWR将提交的重做写入联机重做日志，并且提交等待将重做缓冲区写入联机重做日志。<code class="codeph">WAIT</code>表示在对应于事务的内存中重做缓冲区写入（持久性）联机重做日志之前，提交不会返回。
                           </p>
                           <p><code class="codeph">OCI_TRANS_WRITENOWAIT</code> - 请求LGWR将提交的重做写入联机重做日志，但提交将返回，而不等待将缓冲区写入联机重做日志。<code class="codeph">NOWAIT</code>意味着在将内存中重做缓冲区刷新到联机重做日志之前，提交将返回给用户。指定<code class="codeph">WAIT</code>和<code class="codeph">NOWAIT</code>时发生错误。 <code class="codeph">WAIT</code>是默认值。
                           </p>
                           <div class="infoboxnote" id="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-A46BB779-9928-4668-9C5A-49164B5A3A6B">
                              <p class="notep1">注意：</p>
                              <p>使用<code class="codeph">OCI_TRANS_WRITENOWAIT</code>时，可能会发生静默事务丢失。使用shutdown abort，startup force以及任何实例或节点故障，都会以静默方式发生事务丢失。在Oracle RAC系统上，异步提交的更改可能无法立即在其他实例上读取。
                              </p>
                           </div>
                           <p>最后四个选项仅影响顶级非分布式事务的提交，并且对于外部协调的分布式事务将被忽略。根据规定的限制，可以使用<code class="codeph">OR</code>运算符组合它们。
                           </p>
                        </dd>
                     </dl>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-8C301DFF-2B62-4DAA-9F7D-47007103FAD3">评论</p>
                     <p>当前与服务上下文关联的事务已提交。如果它是服务器无法提交的全局事务，则此调用还会从数据库中检索事务的状态，以便在错误句柄中返回给用户。</p>
                     <p>如果应用程序已定义多个事务，则此函数对当前与服务上下文关联的事务进行操作。如果应用程序仅使用在进行数据库更改时创建的隐式本地事务，则提交该隐式事务。</p>
                     <p>如果应用程序在对象模式下运行，则此事务的对象高速缓存中的已修改或更新的对象也将被刷新并提交。</p>
                     <p>在正常情况下， <code class="codeph">OCITransCommit()</code>返回一个状态，指示事务已提交或回滚。对于全局事务，事务现在可能存在疑问，这意味着事务既未提交也未终止。在这种情况下， <code class="codeph">OCITransCommit()</code>尝试从服务器检索事务的状态。状态将返回。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-32C4D474-9872-40C7-A73D-E509D4D6CC76">例</p>
                     <p>以下代码示例演示如何使用简单本地事务，如<span class="q">“ <a href="managing-scalable-platforms.html#GUID-7190D8FF-EA02-4D7B-9967-62A3FC458605" title="许多应用程序仅使用简单的本地事务。">简单本地事务</a> ”中所述</span> 。
                     </p>
                     <p>在简单本地事务中使用OCITransCommit（）</p><pre class="oac_no_warn" dir="ltr">int main（）{OCIEnv * envhp; OCIServer * srvhp; OCIError * errhp; OCISvcCtx * svchp; OCIStmt * stmthp; void * tmp; text sqlstmt [128]; OCIEnvCreate（＆envhp，OCI_DEFAULT，（void *）0,0,0,0，（size_t）0，（void *）0）; OCIHandleAlloc（（void *）envhp，（void **）＆errhp，（ub4）OCI_HTYPE_ERROR，（size_t）0，（void **）0）; OCIHandleAlloc（（void *）envhp，（void **）＆srvhp，（ub4）OCI_HTYPE_SERVER，（size_t）0，（void **）0）; OCIServerAttach（srvhp，errhp，（text *）0，（sb4）0，（ub4）OCI_DEFAULT）; OCIHandleAlloc（（void *）envhp，（void **）＆svchp，（ub4）OCI_HTYPE_SVCCTX，（size_t）0，（void **）0）; OCIHandleAlloc（（void *）envhp，（void **）＆stmthp，OCI_HTYPE_STMT，0,0）; OCIAttrSet（（void *）svchp，OCI_HTYPE_SVCCTX，（void *）srvhp，0，OCI_ATTR_SERVER，errhp）; OCILogon（envhp，errhp，＆svchp，（text *）“HR”，strlen（“HR”），（text *）“HR”，strlen（“HR”），0,0）; / * update hr.employees employee_id = 7902，增加工资* / sprintf（（char *）sqlstmt，“UPDATE EMPLOYEES SET SALARY = SALARY + 1 \ WHERE EMPLOYEE_ID = 7902”）; OCIStmtPrepare（stmthp，errhp，sqlstmt，strlen（（char *）sqlstmt），OCI_NTV_SYNTAX，0）; OCIStmtExecute（svchp，stmthp，errhp，1,0,0,0,0）; OCITransCommit（svchp，errhp，（ub4）0）; / * update hr.employees employee_id = 7902，再次增加工资，但回滚* / OCIStmtExecute（svchp，stmthp，errhp，1,0,0,0,0）; OCITransRollback（svchp，errhp，（ub4）0）; }</pre></div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="transaction-functions.html#GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366" title="回滚当前交易。">OCITransRollback（）</a></li>
                        <li><a href="miscellaneous-functions.html#GUID-4B99087C-74F6-498A-8310-D6645172390A" title="返回错误消息和Oracle数据库错误代码。">OCIErrorGet（）</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="LNOCI17277"></a><div class="props_rev_3"><a id="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09" name="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09"></a><h3 id="LNOCI-GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09" class="sect3"><span class="enumeration_section">26.7.2</span> OCITransDetach（）</h3>
               <div>
                  <p>分离全局事务。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-C9C5AF56-03E9-48DC-A81D-2AC65BD899D8">目的</p>
                     <p>分离全局事务。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-AABF22E7-1CDB-43BB-BEC1-F2E1FFC92E8D">句法</p><pre class="oac_no_warn" dir="ltr">剑OCITransDetach（OCISvcCtx * svchp，OCIError * errhp，ub4标志）;</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-B211FFD9-1A66-4D89-BFE5-8C37CB7A82A0">参数</p>
                     <dl>
                        <dt class="dlterm"><a name="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-5379F0BF-8DF7-42D6-B8FA-2744C8215BC0"><!-- --></a> <span class="bold">svchp</span> （IN）</dt>
                        <dd>
                           <p>服务上下文句柄。</p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-8DA3D419-4C2A-4641-9367-3097C3C57FF1"><!-- --></a> <span class="bold">errhp</span> （IN）</dt>
                        <dd>
                           <p>一个错误句柄，您可以在出现错误时传递给<code class="codeph">OCIErrorGet()</code>以获取诊断信息。
                           </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-C1F25EAD-6D17-4D95-9A91-912900F4F8C7"><!-- --></a> <span class="bold">标志</span> （IN）</dt>
                        <dd>
                           <p>您必须为此参数传递值<code class="codeph">OCI_DEFAULT</code> 。
                           </p>
                        </dd>
                     </dl>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-8A268D13-EC7C-4F99-B000-B4DEEEEA95CD">评论</p>
                     <p>从服务上下文句柄中分离全局事务。当前附加到服务上下文句柄的事务在此调用结束时变为非活动状态。稍后可以通过调用<code class="codeph">OCITransStart()</code>来指定<code class="codeph">OCI_TRANS_RESUME</code>的标志值来恢复该事务。</p>
                     <p>分离事务时，启动事务时在<code class="codeph">OCITransStart()</code>的<code class="codeph">timeout</code>参数中指定的值用于确定分支在被服务器的<code class="codeph">PMON</code>进程删除之前保持非活动状态的时间。
                     </p>
                     <div class="infoboxnote" id="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-2B3BD6E7-81B9-47C4-B59B-3DE789B39609">
                        <p class="notep1">注意：</p>
                        <p>如果事务具有相同的授权，则事务可以通过与分离事务不同的进程来恢复。如果在实际启动事务之前调用此函数，则此函数无效。</p>
                     </div>
                     <p>例如代码演示使用<code class="codeph">OCITransDetach()</code>见实施例部分<code class="codeph">OCITransStart()</code>
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="transaction-functions.html#GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8" title="设置事务的开始。">OCITransStart（）</a></li>
                        <li><a href="miscellaneous-functions.html#GUID-4B99087C-74F6-498A-8310-D6645172390A" title="返回错误消息和Oracle数据库错误代码。">OCIErrorGet（）</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="LNOCI17278"></a><div class="props_rev_3"><a id="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00" name="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00"></a><h3 id="LNOCI-GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00" class="sect3"><span class="enumeration_section">26.7.3</span> OCITransForget（）</h3>
               <div>
                  <p>导致服务器忘记启发式完成的全局事务。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00__GUID-86C34B86-B4E2-419A-92D9-11435E9E9998">目的</p>
                     <p>导致服务器忘记启发式完成的全局事务。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00__GUID-A928B2E0-CAA9-4EC9-85D9-2DCE11266E2D">句法</p><pre class="oac_no_warn" dir="ltr">剑OCITransForget（OCISvcCtx * svchp，OCIError * errhp，ub4标志）;</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00__GUID-C8B38AC7-A6CA-4B26-BBC0-4ABABD235926"><span class="bold">参数</span></p>
                     <dl>
                        <dt class="dlterm"><a name="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00__GUID-9E30D41E-0CC7-4349-A6B8-DB61CAA0EF3E"><!-- --></a> <span class="bold">svchp</span> （IN）</dt>
                        <dd>
                           <p>事务所在的服务上下文句柄。</p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00__GUID-D268B6A8-DC7E-43D7-A799-5A4C01BC7E18"><!-- --></a> <span class="bold">errhp</span> （IN）</dt>
                        <dd>
                           <p>一个错误句柄，您可以在出现错误时传递给<code class="codeph">OCIErrorGet()</code>以获取诊断信息。
                           </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00__GUID-3FB91A76-F11C-4E94-AC37-A427116D1864"><!-- --></a>标志（IN）</dt>
                        <dd>
                           <p>您必须为此参数传递<code class="codeph">OCI_DEFAULT</code> 。
                           </p>
                        </dd>
                     </dl>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00__GUID-64795878-86AD-462E-BDA4-405A2097DA55">评论</p>
                     <p>忘记启发式完成的全球交易。服务器从系统的挂起事务表中删除事务的状态。</p>
                     <p>您将要忘记的事务的XID设置为事务句柄的属性（ <code class="codeph">OCI_ATTR_XID</code> ）。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="transaction-functions.html#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="提交与指定服务上下文关联的事务。">OCITransCommit（）</a></li>
                        <li><a href="transaction-functions.html#GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366" title="回滚当前交易。">OCITransRollback（）</a></li>
                        <li><a href="miscellaneous-functions.html#GUID-4B99087C-74F6-498A-8310-D6645172390A" title="返回错误消息和Oracle数据库错误代码。">OCIErrorGet（）</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="LNOCI17279"></a><div class="props_rev_3"><a id="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7" name="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7"></a><h3 id="LNOCI-GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7" class="sect3"><span class="enumeration_section">26.7.4</span> OCITransMultiPrepare（）</h3>
               <div>
                  <p>在一次调用中准备具有多个分支的事务。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-329956AC-2CD5-48A0-BE00-20C0FFDD710C">目的</p>
                     <p>在一次调用中准备具有多个分支的事务。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-8F0D93C6-B342-4162-8628-14D1A5688742">句法</p><pre class="oac_no_warn" dir="ltr">剑OCITransMultiPrepare（OCISvcCtx * svchp，ub4 numBranches，OCITrans ** txns，OCIError ** errhp）;</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-E8BFF08D-85F0-420F-8E7D-3F56AA47EE83"><span class="bold">参数</span></p>
                     <dl>
                        <dt class="dlterm"><a name="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-70A94F00-E8BD-459C-AE69-EC25E072F567"><!-- --></a> srvchp（IN）</dt>
                        <dd>
                           <p>服务上下文句柄。</p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-DB67F55E-54F6-4268-876B-F0D293E55BD5"><!-- --></a> numBranches（IN）</dt>
                        <dd>
                           <p>预期的分支数量。它也是接下来两个参数的数组大小。</p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-32F5BC4B-2123-4E2D-AD15-2B0B75A7452D"><!-- --></a> txns（IN）</dt>
                        <dd>
                           <p>要准备分支的事务句柄数组。它们都应该设置<code class="codeph">OCI_ATTR_XID</code> 。全局事务ID应该相同。
                           </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-A4F40037-4E87-4A13-BA0D-6211F218076B"><!-- --></a> errhp（IN）</dt>
                        <dd>
                           <p>错误句柄数组。如果未返回<code class="codeph">OCI_SUCCESS</code> ，则这些指示哪些分支接收到哪些错误。
                           </p>
                        </dd>
                     </dl>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-7C2079DB-FC91-49ED-B523-E60398107F3D">评论</p>
                     <p>准备指定的全局事务以进行提交。此调用仅对分布式事务有效。此调用是一种高级性能功能，仅用于调用者负责准备事务中所有分支的情况。</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="transaction-functions.html#GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3" title="准备提交的全局事务。">OCITransPrepare（）</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="LNOCI17280"></a><div class="props_rev_3"><a id="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3" name="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3"></a><h3 id="LNOCI-GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3" class="sect3"><span class="enumeration_section">26.7.5</span> OCITransPrepare（）</h3>
               <div>
                  <p>准备提交的全局事务。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3__GUID-201EC530-CFC2-4C64-BCA9-E1637EAFB35F">目的</p>
                     <p>准备提交的全局事务。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3__GUID-3B503B20-48F9-4AF3-8D57-8D91F3661DAB">句法</p><pre class="oac_no_warn" dir="ltr">剑OCITransPrepare（OCISvcCtx * svchp，OCIError * errhp，ub4标志）;</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3__GUID-D323588C-124A-4663-9095-EBFE675BB81D"><span class="bold">参数</span></p>
                     <dl>
                        <dt class="dlterm"><a name="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3__GUID-BAE1828C-ED34-4CAA-BAB3-D97473F3FC8C"><!-- --></a> <span class="bold">svchp</span> （IN）</dt>
                        <dd>
                           <p>服务上下文句柄。</p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3__GUID-25447DA7-DB1B-4ABC-9799-0598248D40E6"><!-- --></a> <span class="bold">errhp</span> （IN）</dt>
                        <dd>
                           <p>一个错误句柄，您可以在出现错误时传递给<code class="codeph">OCIErrorGet()</code>以获取诊断信息。
                           </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3__GUID-900E10FB-C0CA-4C81-A595-50903A9EB92B"><!-- --></a>标志（IN）</dt>
                        <dd>
                           <p>您必须为此参数传递<code class="codeph">OCI_DEFAULT</code> 。
                           </p>
                        </dd>
                     </dl>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3__GUID-667EAAAE-CB3D-4084-BBC3-D115E4EC706D">评论</p>
                     <p>准备指定的全局事务以进行提交。</p>
                     <p>此调用仅对全局事务有效。</p>
                     <p>如果事务未进行任何更改，则调用返回<code class="codeph">OCI_SUCCESS_WITH_INFO</code> 。错误句柄表示事务是只读的。目前不使用<code class="codeph">flags</code>参数。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="transaction-functions.html#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="提交与指定服务上下文关联的事务。">OCITransCommit（）</a></li>
                        <li><a href="transaction-functions.html#GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00" title="导致服务器忘记启发式完成的全局事务。">OCITransForget（）</a></li>
                        <li><a href="miscellaneous-functions.html#GUID-4B99087C-74F6-498A-8310-D6645172390A" title="返回错误消息和Oracle数据库错误代码。">OCIErrorGet（）</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="LNOCI17281"></a><div class="props_rev_3"><a id="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366" name="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366"></a><h3 id="LNOCI-GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366" class="sect3"><span class="enumeration_section">26.7.6</span> OCITransRollback（）</h3>
               <div>
                  <p>回滚当前交易。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366__GUID-F3002757-A55A-4965-A9B0-1BA9F307DA42">目的</p>
                     <p>回滚当前交易。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366__GUID-0F07F1F4-788A-4F77-9595-F4451DADB7BE">句法</p><pre class="oac_no_warn" dir="ltr">剑OCITransRollback（void * svchp，OCIError * errhp，ub4 flags）;</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366__GUID-C9BECF36-DB41-46B3-9A08-35416D459F94">参数</p>
                     <dl>
                        <dt class="dlterm"><a name="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366__GUID-AE70ED24-0E28-4901-BD15-C73716DE1703"><!-- --></a> <span class="bold">svchp</span> （IN）</dt>
                        <dd>
                           <p>服务上下文句柄。回滚当前在服务上下文句柄中设置的事务。</p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366__GUID-E73915F8-9EC3-4E9B-8002-F7B8453D1FF6"><!-- --></a> <span class="bold">errhp</span> （IN）</dt>
                        <dd>
                           <p>一个错误句柄，您可以在出现错误时传递给<code class="codeph">OCIErrorGet()</code>以获取诊断信息。
                           </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366__GUID-86DAAED8-945D-4FED-BFEF-47DDECC421CA"><!-- --></a> <span class="bold">标志</span> （IN）</dt>
                        <dd>
                           <p>您必须为此参数传递值<code class="codeph">OCI_DEFAULT</code> 。
                           </p>
                        </dd>
                     </dl>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366__GUID-D2637ACF-3825-4DC4-9EED-5D0DAB3CE212">评论</p>
                     <p>当前事务 - 定义为自上一次<code class="codeph">OCITransCommit()</code>或自<code class="codeph">OCISessionBegin()</code>回滚以来执行的语句集。
                     </p>
                     <p>如果应用程序在对象模式下运行，则还会回滚此事务的对象高速缓存中的已修改或更新对象。</p>
                     <p>尝试回滚当前未处于活动状态的全局事务会导致错误。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366__GUID-9122FF44-CCB6-462C-B80C-B704522A77C3">例子</p>
                     <p>例如代码演示使用<code class="codeph">OCITransRollback()</code>参见实施例部分<a href="transaction-functions.html#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="提交与指定服务上下文关联的事务。">OCITransCommit（） 。</a>
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="transaction-functions.html#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="提交与指定服务上下文关联的事务。">OCITransCommit（）</a></li>
                        <li><a href="connect-authorize-and-initialize-functions.html#GUID-31B1FDB3-056E-4AF9-9B89-8DA6AA156947" title="创建用户会话并开始给定服务器的用户会话。">OCISessionBegin（）</a></li>
                        <li><a href="miscellaneous-functions.html#GUID-4B99087C-74F6-498A-8310-D6645172390A" title="返回错误消息和Oracle数据库错误代码。">OCIErrorGet（）</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="LNOCI17282"></a><div class="props_rev_3"><a id="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8" name="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8"></a><h3 id="LNOCI-GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8" class="sect3"><span class="enumeration_section">26.7.7</span> OCITransStart（）</h3>
               <div>
                  <p>设置事务的开始。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-FBC9198D-B206-4E74-8387-9EDB52244D42">目的</p>
                     <p>设置事务的开始。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-ACDB61EF-7119-4FF6-9B64-3A3234DB9BF9">句法</p><pre class="oac_no_warn" dir="ltr">剑OCITransStart（OCISvcCtx * svchp，OCIError * errhp，uword timeout，ub4 flags）;</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-38CF5412-0439-465B-AD25-41518926FF7B">参数</p>
                     <dl>
                        <dt class="dlterm"><a name="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-8BF25001-5A67-4497-83BD-5698FC9240E7"><!-- --></a> <span class="bold">svchp</span> （IN / OUT）</dt>
                        <dd>
                           <p>服务上下文句柄。如果标志指定了要启动的新事务，则在调用结束时初始化服务上下文句柄中的事务上下文。</p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-B73FF5FF-B936-4376-919F-0D2B651DCED1"><!-- --></a> errhp（输入/输出）</dt>
                        <dd>
                           <p>OCI错误句柄。如果有错误， <code class="codeph">OCI_ERROR</code> <code class="codeph">err</code>记录，此函数返回<code class="codeph">OCI_ERROR</code> 。可以通过调用<code class="codeph">OCIErrorGet()</code>获取诊断信息。
                           </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-75388E09-1371-4AF8-99FA-3A53B5FE6A9D"><!-- --></a>超时（IN）</dt>
                        <dd>
                           <p>指定<code class="codeph">OCI_TRANS_RESUME</code>时等待事务可用于恢复的时间（以秒为<code class="codeph">OCI_TRANS_RESUME</code> ）。指定<code class="codeph">OCI_TRANS_NEW</code> ，timeout参数指示事务在系统自动终止之前可以处于非活动状态的秒数。在事务分离（使用<code class="codeph">OCITransDetach()</code> ）与使用<code class="codeph">OCITransStart()</code>恢复的时间之间，事务处于非活动状态。
                           </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-22062DD4-2877-4E4F-9F18-37CB68F33402"><!-- --></a>标志（IN）</dt>
                        <dd>
                           <p>指定是启动新事务还是恢复现有事务。还指定可序列化或只读状态。可以指定多个值。默认情况下，启动读/写事务。标志值为：</p>
                        </dd>
                     </dl>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">OCI_TRANS_NEW</code> - 启动新的事务分支。默认情况下，启动紧密耦合和可迁移的分支。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">OCI_TRANS_TIGHT</code> - 明确指定紧耦合分支。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">OCI_TRANS_LOOSE</code> - 指定松散耦合的分支。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">OCI_TRANS_RESUME</code> - 恢复现有的事务分支。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">OCI_TRANS_READONLY</code> - 启动只读事务。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">OCI_TRANS_SERIALIZABLE</code> - 启动可序列化的事务。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">OCI_TRANS_SEPARABLE</code> - 在每次调用后分离事务。
                           </p>
                           <p>此标志会导致警告事务是使用<span class="italic">常规</span>事务启动的。服务器的9.0.1版不支持单独的事务。
                           </p>
                        </li>
                     </ul>
                     <p>如果代码或事务服务中存在错误，则会出现错误消息。该错误表示您尝试对已准备好的事务执行操作。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-74DFE040-FF6C-439D-8B4B-CA35BE84811D">评论</p>
                     <p>此函数设置全局或可序列化事务的开始。如果<code class="codeph">flags</code>参数指定应该启动新事务，则在调用结束时初始化当前与服务上下文句柄关联的事务上下文。
                     </p>
                     <p>事务的XID被设置为事务句柄的属性（ <code class="codeph">OCI_ATTR_XID</code> ）</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-2CD8B3E5-8089-4B2B-BEB7-B1D730CF9037">例子</p>
                     <p>下面的代码示例和后面的代码示例演示了如何使用OCI事务调用来操作全局事务。如下面的代码示例所示，在不同分支上运行的单个会话的概念<a href="managing-scalable-platforms.html#GUID-9C16201F-7975-4E14-8162-62695B1C9AE4__I433197">如图10-2所示</a> 。
                     </p>
                     <p>在不同分支上运行的单个会话中使用OCITransStart（）</p><pre class="oac_no_warn" dir="ltr">int main（）{OCIEnv * envhp; OCIServer * srvhp; OCIError * errhp; OCISvcCtx * svchp; OCISession * usrhp; OCIStmt * stmthp1，* stmthp2; OCITrans * txnhp1，* txnhp2; void * tmp; XID gxid; text sqlstmt [128]; OCIEnvCreate（＆envhp，OCI_DEFAULT，（void *）0,0,0,0，（size_t）0，（void *）0）; OCIHandleAlloc（（void *）envhp，（void **）＆errhp，（ub4）OCI_HTYPE_ERROR，52，（void **）＆tmp）; OCIHandleAlloc（（void *）envhp，（void **）＆srvhp，（ub4）OCI_HTYPE_SERVER，52，（void **）＆tmp）; OCIServerAttach（srvhp，errhp，（text *）0，（sb4）0，（ub4）OCI_DEFAULT）; OCIHandleAlloc（（void *）envhp，（void **）＆svchp，（ub4）OCI_HTYPE_SVCCTX，52，（void **）＆tmp）; OCIHandleAlloc（（void *）envhp，（void **）＆stmthp1，OCI_HTYPE_STMT，0,0）; OCIHandleAlloc（（void *）envhp，（void **）＆stmthp2，OCI_HTYPE_STMT，0,0）; OCIAttrSet（（void *）svchp，OCI_HTYPE_SVCCTX，（void *）srvhp，0，OCI_ATTR_SERVER，errhp）; / *在服务器句柄中设置外部名称和内部名称* / OCIAttrSet（（void *）srvhp，OCI_HTYPE_SERVER，（void *）“demo”，0，OCI_ATTR_EXTERNAL_NAME，errhp）; OCIAttrSet（（void *）srvhp，OCI_HTYPE_SERVER，（void *）“txn demo”，0，OCI_ATTR_INTERNAL_NAME，errhp）; / *分配用户上下文句柄* / OCIHandleAlloc（（void *）envhp，（void **）＆usrhp，（ub4）OCI_HTYPE_SESSION，（size_t）0，（void **）0）; OCIAttrSet（（void *）usrhp，（ub4）OCI_HTYPE_SESSION，（void *）“HR”，（ub4）strlen（“HR”），OCI_ATTR_USERNAME，errhp）; OCIAttrSet（（void *）usrhp，（ub4）OCI_HTYPE_SESSION，（void *）“HR”，（ub4）strlen（“HR”），OCI_ATTR_PASSWORD，errhp）; OCISessionBegin（svchp，errhp，usrhp，OCI_CRED_RDBMS，0）; OCIAttrSet（（void *）svchp，（ub4）OCI_HTYPE_SVCCTX，（void *）usrhp，（ub4）0，OCI_ATTR_SESSION，errhp）; / *分配事务句柄1并将其设置在服务句柄* / OCIHandleAlloc（（void *）envhp，（void **）＆txnhp1，OCI_HTYPE_TRANS，0,0）; OCIAttrSet（（void *）svchp，OCI_HTYPE_SVCCTX，（void *）txnhp1,0，OCI_ATTR_TRANS，errhp）; / *以全局事务id = [1000,123,1] * / gxid.formatID = 1000开始事务; / * format id = 1000 * / gxid.gtrid_length = 3; / * gtrid = 123 * / gxid.data [0] = 1; gxid.data [1] = 2; gxid.data [2] = 3; gxid.bqual_length = 1; / * bqual = 1 * / gxid.data [3] = 1; OCIAttrSet（（void *）txnhp1，OCI_HTYPE_TRANS，（void *）＆gxid，sizeof（XID），OCI_ATTR_XID，errhp）; / *以分离的* / OCITransStart（svchp，errhp，60，OCI_TRANS_NEW）生成60秒的时间启动全局事务1; / * update hr.employees employee_id = 7902，增加工资* / sprintf（（char *）sqlstmt，“UPDATE EMPLOYEES SET SALARY = SALARY + 1 \ WHERE EMPLOYEE_ID = 7902”）; OCIStmtPrepare（stmthp1，errhp，sqlstmt，strlen（（char *）sqlstmt），OCI_NTV_SYNTAX，0）; OCIStmtExecute（svchp，stmthp1，errhp，1,0,0,0,0）; / *分离事务* / OCITransDetach（svchp，errhp，0）; / *分配事务句柄2并将其设置在服务句柄* / OCIHandleAlloc（（void *）envhp，（void **）＆txnhp2，OCI_HTYPE_TRANS，0,0）; OCIAttrSet（（void *）svchp，OCI_HTYPE_SVCCTX，（void *）txnhp2,0，OCI_ATTR_TRANS，errhp）; / *以全局事务id = [1000,124,1] * / gxid.formatID = 1000开始事务; / * format id = 1000 * / gxid.gtrid_length = 3; / * gtrid = 124 * / gxid.data [0] = 1; gxid.data [1] = 2; gxid.data [2] = 4; gxid.bqual_length = 1; / * bqual = 1 * / gxid.data [3] = 1; OCIAttrSet（（void *）txnhp2，OCI_HTYPE_TRANS，（void *）＆gxid，sizeof（XID），OCI_ATTR_XID，errhp）; / *以分离的* / OCITransStart（svchp，errhp，90，OCI_TRANS_NEW）生成90秒的时间启动全局事务2; / * update hr.employees employee_id = 7934，增加工资* / sprintf（（char *）sqlstmt，“UPDATE EMPLOYEES SET SALARY = SALARY + 1 \ WHERE EMPLOYEE_ID = 7934”）; OCIStmtPrepare（stmthp2，errhp，sqlstmt，strlen（（char *）sqlstmt），OCI_NTV_SYNTAX，0）; OCIStmtExecute（svchp，stmthp2，errhp，1,0,0,0,0）; / *分离事务* / OCITransDetach（svchp，errhp，0）; / *恢复事务1，增加工资并提交它* / / *将事务句柄1设置到服务句柄* / OCIAttrSet（（void *）svchp，OCI_HTYPE_SVCCTX，（void *）txnhp1,0，OCI_ATTR_TRANS，errhp）; / *附加到事务1，如果事务忙，则等待10秒* / / *在此示例中显然不需要等待，因为没有其他* / / *进程/线程正在使用该事务。它仅用于说明* / OCITransStart（svchp，errhp，10，OCI_TRANS_RESUME）; OCIStmtExecute（svchp，stmthp1，errhp，1,0,0,0,0）; OCITransCommit（svchp，errhp，（ub4）0）; / *附加到事务2并将其提交* / / *将事务句柄2设置到服务句柄* / OCIAttrSet（（void *）svchp，OCI_HTYPE_SVCCTX，（void *）txnhp2,0，OCI_ATTR_TRANS，errhp）; OCITransCommit（svchp，errhp，（ub4）0）; }</pre><p>在多个分支上运行的单个会话中使用OCITransStart（）共享相同的事务</p><pre class="oac_no_warn" dir="ltr">int main（）{OCIEnv * envhp; OCIServer * srvhp; OCIError * errhp; OCISvcCtx * svchp; OCISession * usrhp; OCIStmt * stmthp; OCITrans * txnhp1，* txnhp2; void * tmp; XID gxid; text sqlstmt [128]; OCIEnvCreate（＆envhp，OCI_DEFAULT，（void *）0,0,0,0，（size_t）0，（void *）0）; OCIHandleAlloc（（void *）envhp，（void **）＆errhp，（ub4）OCI_HTYPE_ERROR，52，（void **）＆tmp）; OCIHandleAlloc（（void *）envhp，（void **）＆srvhp，（ub4）OCI_HTYPE_SERVER，52，（void **）＆tmp）; OCIServerAttach（srvhp，errhp，（text *）0，（sb4）0，（ub4）OCI_DEFAULT）; OCIHandleAlloc（（void *）envhp，（void **）＆svchp，（ub4）OCI_HTYPE_SVCCTX，52，（void **）＆tmp）; OCIHandleAlloc（（void *）envhp，（void **）＆stmthp，OCI_HTYPE_STMT，0,0）; OCIAttrSet（（void *）svchp，OCI_HTYPE_SVCCTX，（void *）srvhp，0，OCI_ATTR_SERVER，errhp）; / *在服务器句柄中设置外部名称和内部名称* / OCIAttrSet（（void *）srvhp，OCI_HTYPE_SERVER，（void *）“demo”，0，OCI_ATTR_EXTERNAL_NAME，errhp）; OCIAttrSet（（void *）srvhp，OCI_HTYPE_SERVER，（void *）“txn demo2”，0，OCI_ATTR_INTERNAL_NAME，errhp）; / *分配用户上下文句柄* / OCIHandleAlloc（（void *）envhp，（void **）＆usrhp，（ub4）OCI_HTYPE_SESSION，（size_t）0，（void **）0）; OCIAttrSet（（void *）usrhp，（ub4）OCI_HTYPE_SESSION，（void *）“HR”，（ub4）strlen（“HR”），OCI_ATTR_USERNAME，errhp）; OCIAttrSet（（void *）usrhp，（ub4）OCI_HTYPE_SESSION，（void *）“HR”，（ub4）strlen（“HR”），OCI_ATTR_PASSWORD，errhp）; OCISessionBegin（svchp，errhp，usrhp，OCI_CRED_RDBMS，0）; OCIAttrSet（（void *）svchp，（ub4）OCI_HTYPE_SVCCTX，（void *）usrhp，（ub4）0，OCI_ATTR_SESSION，errhp）; / *分配事务句柄1并将其设置在服务句柄* / OCIHandleAlloc（（void *）envhp，（void **）＆txnhp1，OCI_HTYPE_TRANS，0,0）; OCIAttrSet（（void *）svchp，OCI_HTYPE_SVCCTX，（void *）txnhp1,0，OCI_ATTR_TRANS，errhp）; / *以全局事务id = [1000,123,1] * / gxid.formatID = 1000开始事务; / * format id = 1000 * / gxid.gtrid_length = 3; / * gtrid = 123 * / gxid.data [0] = 1; gxid.data [1] = 2; gxid.data [2] = 3; gxid.bqual_length = 1; / * bqual = 1 * / gxid.data [3] = 1; OCIAttrSet（（void *）txnhp1，OCI_HTYPE_TRANS，（void *）＆gxid，sizeof（XID），OCI_ATTR_XID，errhp）; / *以分离的* / OCITransStart（svchp，errhp，60，OCI_TRANS_NEW）生成60秒的时间启动全局事务1; / * update hr.employees employee_id = 7902，增加工资* / sprintf（（char *）sqlstmt，“UPDATE EMPLOYEES SET SALARY = SALARY + 1 \ WHERE EMPLOYEE_ID = 7902”）; OCIStmtPrepare（stmthp，errhp，sqlstmt，strlen（（char *）sqlstmt），OCI_NTV_SYNTAX，0）; OCIStmtExecute（svchp，stmthp，errhp，1,0,0,0,0）; / *分离事务* / OCITransDetach（svchp，errhp，0）; / *分配事务句柄2并将其设置在服务句柄* / OCIHandleAlloc（（void *）envhp，（void **）＆txnhp2，OCI_HTYPE_TRANS，0,0）; OCIAttrSet（（void *）svchp，OCI_HTYPE_SVCCTX，（void *）txnhp2,0，OCI_ATTR_TRANS，errhp）; / *用全局事务id = [1000,123,2]开始一个事务* / / *全局事务与先前的事务紧密结合* / / *这样做没有多少实际价值但是示例* / / *说明了紧密耦合的事务分支的使用。* / / *在实际情况中，第一个与* / / *紧密耦合的第二个事务可以从不同的进程/线程执行。* / gxid.formatID = 1000; / * format id = 1000 * / gxid.gtrid_length = 3; / * gtrid = 123 * / gxid.data [0] = 1; gxid.data [1] = 2; gxid.data [2] = 3; gxid.bqual_length = 1; / * bqual = 2 * / gxid.data [3] = 2; OCIAttrSet（（void *）txnhp2，OCI_HTYPE_TRANS，（void *）＆gxid，sizeof（XID），OCI_ATTR_XID，errhp）; / *以分离的* / OCITransStart（svchp，errhp，90，OCI_TRANS_NEW）生成90秒的时间启动全局事务2; / * update hr.employees employee_id = 7902，增加工资* / / *即使先前的事务已锁定此行* / / *，这是可能的，因为两个全局事务紧密耦合* / OCIStmtExecute（svchp，stmthp，errhp， 1,0,0,0,0）; / *分离事务* / OCITransDetach（svchp，errhp，0）; / *恢复事务1并准备它。这将返回* / / * OCI_SUCCESS_WITH_INFO，因为除了最后一个分支* / / *之外的所有分支都被视为紧密耦合事务的只读事务* / OCIAttrSet（（void *）svchp，OCI_HTYPE_SVCCTX，（void *）txnhp1,0，OCI_ATTR_TRANS ，errhp）; if（OCITransPrepare（svchp，errhp，（ub4）0）== OCI_SUCCESS_WITH_INFO）{text errbuf [512]; ub4 buflen; sb4错误代码; OCIErrorGet（（void *）errhp，（ub4）1，（text *）NULL，＆errcode，errbuf，（ub4）sizeof（errbuf），（ub4）OCI_HTYPE_ERROR）; printf（“OCITransPrepare  - ％s \ n”，errbuf）; } / *附加到事务2并将其提交* / / *将事务句柄2设置到服务句柄* / OCIAttrSet（（void *）svchp，OCI_HTYPE_SVCCTX，（void *）txnhp2,0，OCI_ATTR_TRANS，errhp）; OCITransCommit（svchp，errhp，（ub4）0）; }</pre></div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="transaction-functions.html#GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09" title="分离全局事务。">OCITransDetach（）</a></li>
                        <li><a href="miscellaneous-functions.html#GUID-4B99087C-74F6-498A-8310-D6645172390A" title="返回错误消息和Oracle数据库错误代码。">OCIErrorGet（）</a></li>
                     </ul>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>