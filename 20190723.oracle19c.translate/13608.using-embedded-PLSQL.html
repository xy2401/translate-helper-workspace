<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>使用嵌入式PL / SQL</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Programmer&#39;s Guide to the Oracle Precompilers"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Programmer&#39;s Guide to the Oracle Precompilers"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="programmers-guide-oracle-precompilers.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-11T01:36:30-08:00"></meta>
      <meta name="dcterms.title" content="Programmer&#39;s Guide to the Oracle Precompilers"></meta>
      <meta name="dcterms.dateCopyrighted" content="2008, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96474-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="using-embedded-SQL.html" title="Previous" type="text/html"></link>
      <link rel="next" href="running-Oracle-precompilers.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="ZZPRE"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="using-embedded-SQL.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="running-Oracle-precompilers.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">程序员指南Oracle预编译器</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用嵌入式PL / SQL</li>
            </ol>
            <a id="GUID-F6E58CB5-C25B-47EE-B349-314F28961A56" name="GUID-F6E58CB5-C25B-47EE-B349-314F28961A56"></a><a id="ZZPRE294"></a>
            
            <h2 id="ZZPRE-GUID-F6E58CB5-C25B-47EE-B349-314F28961A56" class="sect2"><span class="enumeration_chapter">5</span>使用嵌入式PL / SQL</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章包含以下部分：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="using-embedded-PLSQL.html#GUID-16CF8764-4464-488F-9DE0-4FB350C0178B">PL / SQL的优点</a></p>
                  </li>
                  <li>
                     <p><a href="using-embedded-PLSQL.html#GUID-EBCAF03F-C7FF-46AC-A944-2C63B3806BE0">关于嵌入PL / SQL块</a></p>
                  </li>
                  <li>
                     <p><a href="using-embedded-PLSQL.html#GUID-250ED489-7062-4A68-B664-BB7B0998FA91">关于使用主机变量</a></p>
                  </li>
                  <li>
                     <p><a href="using-embedded-PLSQL.html#GUID-863B7A7D-D21D-45CA-BF20-5796A1AF1CA4">关于使用指标变量</a></p>
                  </li>
                  <li>
                     <p><a href="using-embedded-PLSQL.html#GUID-78FCA10C-976A-47A5-A15C-20D9F0F3C368">关于使用主机阵列</a></p>
                  </li>
                  <li>
                     <p><a href="using-embedded-PLSQL.html#GUID-91D74CE0-84E8-4A9C-BF6F-7F3F01B14573">关于使用游标</a></p>
                  </li>
                  <li>
                     <p><a href="using-embedded-PLSQL.html#GUID-5840297F-2757-465C-8B1D-8C6DFFBBFA20">存储的子程序</a></p>
                  </li>
                  <li>
                     <p><a href="using-embedded-PLSQL.html#GUID-0DBFAB55-C488-4C26-AEB3-422132DBB805">关于使用动态PL / SQL</a></p>
                  </li>
               </ul>
               <p>本章介绍如何通过在程序中嵌入PL / SQL事务处理块来提高性能。</p>
            </div><a id="ZZPRE295"></a><div class="props_rev_3"><a id="GUID-16CF8764-4464-488F-9DE0-4FB350C0178B" name="GUID-16CF8764-4464-488F-9DE0-4FB350C0178B"></a><h3 id="ZZPRE-GUID-16CF8764-4464-488F-9DE0-4FB350C0178B" class="sect3"><span class="enumeration_section">5.1</span> PL / SQL的优点</h3>
               <div>
                  <p>本节介绍PL / SQL提供的一些功能和优点，例如</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="using-embedded-PLSQL.html#GUID-6A84B9B2-7C62-403B-B861-3BFD013DC8B4">更好的性能</a></p>
                     </li>
                     <li>
                        <p><a href="using-embedded-PLSQL.html#GUID-58EC6D72-D4E5-4FA9-800B-D2E24996354B">与Oracle集成</a></p>
                     </li>
                     <li>
                        <p><a href="using-embedded-PLSQL.html#GUID-DA8EE693-725D-465B-AE86-B0BAD366CB53">光标FOR循环</a></p>
                     </li>
                     <li>
                        <p><a href="using-embedded-PLSQL.html#GUID-F00509BC-FD3A-4909-BBE4-767347B95A72">子程序</a></p>
                     </li>
                     <li>
                        <p><a href="using-embedded-PLSQL.html#GUID-C7C8C7A0-60FE-4225-9859-088FB87CAEA4">参数模式</a></p>
                     </li>
                     <li>
                        <p><a href="using-embedded-PLSQL.html#GUID-2DCFE2E1-BAE5-4785-B9D2-DBB49FFFAE2F">包</a></p>
                     </li>
                     <li>
                        <p><a href="using-embedded-PLSQL.html#GUID-56342726-094C-4997-B03C-BDBA340E3353">PL / SQL表</a></p>
                     </li>
                     <li>
                        <p><a href="using-embedded-PLSQL.html#GUID-969ACBD3-10F3-46EC-BEC4-52CFEAF7D22D">用户定义的记录</a></p>
                     </li>
                  </ul>
               </div><a id="ZZPRE296"></a><div class="props_rev_3"><a id="GUID-6A84B9B2-7C62-403B-B861-3BFD013DC8B4" name="GUID-6A84B9B2-7C62-403B-B861-3BFD013DC8B4"></a><h4 id="ZZPRE-GUID-6A84B9B2-7C62-403B-B861-3BFD013DC8B4" class="sect4"><span class="enumeration_section">5.1.1</span>更好的表现</h4>
                  <div>
                     <p>PL / SQL可以帮助您减少开销，提高性能并提高工作效率。例如，如果没有PL / SQL，Oracle必须一次处理一个SQL语句。每个SQL语句都会导致对服务器的另一次调用，从而导致更高的开销。但是，使用PL / SQL，您可以将整个SQL语句块发送到服务器。这可以最大限度地减少应用程序与Oracle之间的通</p>
                  </div>
               </div><a id="ZZPRE297"></a><div class="props_rev_3"><a id="GUID-58EC6D72-D4E5-4FA9-800B-D2E24996354B" name="GUID-58EC6D72-D4E5-4FA9-800B-D2E24996354B"></a><h4 id="ZZPRE-GUID-58EC6D72-D4E5-4FA9-800B-D2E24996354B" class="sect4"><span class="enumeration_section">5.1.2</span>与Oracle集成</h4>
                  <div>
                     <p>PL / SQL与Oracle Server紧密集成。例如，大多数PL / SQL数据类型是Oracle数据字典的原生数据类型。此外，你可以使用<a id="d28933e182" class="indexterm-anchor"></a> <code class="codeph">%TYPE</code>属性用于存储在数据字典中的列定义的基本变量声明，如以下示例所示：</p><pre class="oac_no_warn" dir="ltr">job_title emp.job％TYPE;</pre><p>这样，您无需知道列的确切数据类型。此外，如果列定义发生更改，则变量声明会相应地自动更改。这提供了数据独立性，降低了维护成本，并允许程序随着数据库的变化而适应。</p>
                  </div>
               </div><a id="ZZPRE298"></a><div class="props_rev_3"><a id="GUID-DA8EE693-725D-465B-AE86-B0BAD366CB53" name="GUID-DA8EE693-725D-465B-AE86-B0BAD366CB53"></a><h4 id="ZZPRE-GUID-DA8EE693-725D-465B-AE86-B0BAD366CB53" class="sect4"><span class="enumeration_section">5.1.3</span>游标FOR循环</h4>
                  <div>
                     <p>使用PL / SQL，您无需使用<code class="codeph">DECLARE</code> ， <code class="codeph">OPEN</code> ， <code class="codeph">FETCH</code>和<code class="codeph">CLOSE</code>语句来定义和操作游标。相反，您可以使用游标<code class="codeph">FOR</code>循环，它隐式声明其循环索引作为记录，打开与给定查询关联的游标，重复从游标中取出数据到记录中，然后关闭游标。一个例子如下：</p><pre class="oac_no_warn" dir="ltr">宣布 ...BEGIN FOR emprec IN（SELECT empno，sal，comm FROM emp）LOOP IF emprec.comm / emprec.sal&gt; 0.25 THEN ......结束循环;结束;</pre><p>请注意，您使用点表示法来引用记录中的字段。</p>
                  </div>
               </div><a id="ZZPRE299"></a><div class="props_rev_3"><a id="GUID-F00509BC-FD3A-4909-BBE4-767347B95A72" name="GUID-F00509BC-FD3A-4909-BBE4-767347B95A72"></a><h4 id="ZZPRE-GUID-F00509BC-FD3A-4909-BBE4-767347B95A72" class="sect4"><span class="enumeration_section">5.1.4</span>子程序</h4>
                  <div>
                     <p>PL / SQL有两种类型的子程序，称为<span class="italic">过程</span>和<span class="italic">函数</span> ，它们通过让您隔离操作来帮助开发应用程序。通常，您使用过程来执行操作，使用函数来计算值。
                     </p>
                     <p>程序和功能提供了<span class="italic">可扩展性</span> 。也就是说，它们可以让您定制PL / SQL语言以满足您的需求。例如，如果您需要一个创建新部门的过程，请按如下方式编写自己的部门：</p><pre class="oac_no_warn" dir="ltr">PROCEDURE create_dept（new_dname IN CHAR（14），new_loc IN CHAR（13），new_deptno OUT NUMBER（2））IS BEGIN SELECT deptno_seq。NEXTVAL INTO new_deptno FROM dual; INSERT INTO dept VALUES（new_deptno，new_dname，new_loc）; END create_dept;</pre><p>调用时，此过程接受新的部门名称和位置，选择部门编号数据库序列中的下一个值，将新编号，名称和位置插入到<span class="italic">dept</span>表中，然后将新编号返回给调用者。
                     </p>
                     <p>您可以在数据库中存储子程序（使用<code class="codeph">CREATE</code> <code class="codeph">FUNCTION</code>和<code class="codeph">CREATE</code> <code class="codeph">PROCEDURE</code> ），这些子程序可以从多个应用程序调用，而无需每次都重新编译。
                     </p>
                  </div>
               </div><a id="ZZPRE300"></a><div class="props_rev_3"><a id="GUID-C7C8C7A0-60FE-4225-9859-088FB87CAEA4" name="GUID-C7C8C7A0-60FE-4225-9859-088FB87CAEA4"></a><h4 id="ZZPRE-GUID-C7C8C7A0-60FE-4225-9859-088FB87CAEA4" class="sect4"><span class="enumeration_section">5.1.5</span>参数模式</h4>
                  <div>
                     <p><a id="d28933e338" class="indexterm-anchor"></a>您可以使用<span class="italic">参数模式</span>来定义形式参数的行为。有三种参数模式： <code class="codeph">IN</code> （默认值）， <code class="codeph">OUT</code>和<code class="codeph">IN OUT</code> 。使用<code class="codeph">7IN</code>参数可以将值传递给被调用的子程序。<code class="codeph">OUT</code>参数允许您将值返回给子程序的调用者。<code class="codeph">IN OUT</code>参数允许您将初始值传递给被调用的子程序，并将更新的值返回给调用者。
                     </p>
                     <p>每个实际参数的数据类型必须可转换为其相应形式参数的数据类型。<a href="meeting-program-requirements.html#GUID-A5477BD8-CCB9-4938-BB6D-0259B7E3F22F__BABDHHCD" title="表">表3-6</a>显示了数据类型之间的合法转换。
                     </p>
                  </div>
               </div><a id="ZZPRE301"></a><div class="props_rev_3"><a id="GUID-2DCFE2E1-BAE5-4785-B9D2-DBB49FFFAE2F" name="GUID-2DCFE2E1-BAE5-4785-B9D2-DBB49FFFAE2F"></a><h4 id="ZZPRE-GUID-2DCFE2E1-BAE5-4785-B9D2-DBB49FFFAE2F" class="sect4"><span class="enumeration_section">5.1.6</span>包</h4>
                  <div>
                     <p><a id="d28933e398" class="indexterm-anchor"></a> PL / SQL允许您将逻辑上相关的类型，程序对象和子程序捆绑到一个<span class="italic">包中</span> 。软件包可以编译并存储在Oracle数据库中，其中的内容可以由多个应用程序共享。
                     </p>
                     <p>包通常包含两部分：规范和正文。<span class="italic">规范</span>是应用程序的接口;它声明了可供使用的类型，常量，变量，异常，游标和子程序。<span class="italic">正文</span>定义了游标和子程序，因此实现了规范。在以下示例中，您“打包”了两个雇佣程序：</p><pre class="oac_no_warn" dir="ltr">PACKAGE emp_actions IS  - 包规范PROCEDURE hire_employee（empno NUMBER，ename CHAR，...）;程序fire_employee（emp_id NUMBER）; END emp_actions; PACKAGE BODY emp_actions IS  - 包体PROCEDURE hire_employee（empno NUMBER，ename CHAR，...）是开始插入emp VALUES（empno，ename，...）; END hire_employee;程序fire_employee（emp_id NUMBER）从emp WHERE empno = emp_id开始删除;结束fire_employee; END emp_actions;</pre><p>只有包规范中的声明可见且可供应用程序访问。包体中的实现细节是隐藏的，无法访问。</p>
                  </div>
               </div><a id="ZZPRE302"></a><div class="props_rev_3"><a id="GUID-56342726-094C-4997-B03C-BDBA340E3353" name="GUID-56342726-094C-4997-B03C-BDBA340E3353"></a><h4 id="ZZPRE-GUID-56342726-094C-4997-B03C-BDBA340E3353" class="sect4"><span class="enumeration_section">5.1.7</span> PL / SQL表</h4>
                  <div>
                     <p>PL / SQL提供名为<code class="codeph">TABLE</code>的复合数据类型。 <code class="codeph">TABLE</code>类型的对象称为<span class="italic">PL / SQL表</span> ，它们被建模为（但不是相同的）数据库表。PL / SQL表只有一列，并使用主键为您提供类似行的行访问。该列可以属于任何标量类型（例如<code class="codeph">CHAR</code> ， <code class="codeph">DATE</code>或<code class="codeph">NUMBER</code> ），但主键必须属于<code class="codeph">BINARY_INTEGER</code>类型。</p>
                     <p>您可以在任何块，过程，函数或包的声明部分中声明PL / SQL表类型。在以下示例中，您声明了一个名为<span class="italic">NumTabTyp</span>的<code class="codeph">TABLE</code>类型：</p><pre class="oac_no_warn" dir="ltr">DECLARE TYPE NumTabTyp是BINARY_INTEGER的数字索引表; ...开始 ...结束;</pre><p>定义类型<span class="italic">NumTabTyp后</span> ，可以声明该类型的PL / SQL表，如下一个示例所示：</p><pre class="oac_no_warn" dir="ltr">num_tab NumTabTyp;</pre><p>标识符<span class="italic">num_tab</span>表示整个PL / SQL表。
                     </p>
                     <p>使用类似数组的语法引用PL / SQL表中的行以指定主键值。例如，您引用名为<span class="italic">num_tab</span>的PL / SQL表中的第九行，如下所示：</p><pre class="oac_no_warn" dir="ltr">num_tab（9）......
</pre></div>
               </div><a id="ZZPRE303"></a><div class="props_rev_3"><a id="GUID-969ACBD3-10F3-46EC-BEC4-52CFEAF7D22D" name="GUID-969ACBD3-10F3-46EC-BEC4-52CFEAF7D22D"></a><h4 id="ZZPRE-GUID-969ACBD3-10F3-46EC-BEC4-52CFEAF7D22D" class="sect4"><span class="enumeration_section">5.1.8</span>用户定义的记录</h4>
                  <div>
                     <p><a id="d28933e530" class="indexterm-anchor"></a>您可以使用<code class="codeph">%ROWTYPE</code>属性声明一条记录，该记录表示数据库表中的行或游标提取的行。但是，您无法在记录中指定字段的数据类型，也无法定义自己的字段数据类型。复合数据类型<code class="codeph">RECORD</code>解除了这些限制。
                     </p>
                     <p><code class="codeph">RECORD</code>类型的对象称为<span class="italic">记录</span> 。与PL / SQL表不同，记录具有唯一命名的字段，这些字段可以属于不同的数据类型。例如，假设您有关于员工的不同类型的数据，例如姓名，工资，雇用日期等。这些数据在类型上不同但在逻辑上相关。包含员工姓名，工资和雇用日期等字段的记录可让您将数据视为逻辑单元。
                     </p>
                     <p>您可以在任何块，过程，函数或包的声明部分中声明记录类型和对象。在以下示例中，您声明了一个名为<span class="italic">DeptRecTyp</span>的<code class="codeph">RECORD</code>类型：</p><pre class="oac_no_warn" dir="ltr">DECLARE TYPE DeptRecTyp是RECORD（deptno NUMBER（4）NOT NULL：= 10， - 必须初始化dname CHAR（9），loc CHAR（14））;</pre><p>请注意，字段声明类似于变量声明。每个领域都有一个独特的<a id="d28933e561" class="indexterm-anchor"></a>名称和特定数据类型。您可以将<code class="codeph">NOT</code> <code class="codeph">NULL</code>选项添加到任何字段声明中，从而防止将空值分配给该字段。但是，您必须初始化<code class="codeph">NOT</code> <code class="codeph">NULL</code>字段。
                     </p>
                     <p>定义类型<span class="italic">DeptRecTyp后</span> ，您可以声明该类型的记录，如下一个示例所示：</p><pre class="oac_no_warn" dir="ltr">dept_rec DeptRecTyp;</pre><p>标识符<span class="italic">dept_rec</span>表示整个记录。
                     </p>
                     <p>您使用点表示法来引用记录中的各个字段。例如，您在<span class="italic">dept_rec</span>记录中引用<span class="italic">dname</span>字段，如下所示：</p><pre class="oac_no_warn" dir="ltr">dept_rec.dname ...
</pre><p></p>
                  </div>
               </div>
            </div><a id="ZZPRE304"></a><div class="props_rev_3"><a id="GUID-EBCAF03F-C7FF-46AC-A944-2C63B3806BE0" name="GUID-EBCAF03F-C7FF-46AC-A944-2C63B3806BE0"></a><h3 id="ZZPRE-GUID-EBCAF03F-C7FF-46AC-A944-2C63B3806BE0" class="sect3"><span class="enumeration_section">5.2</span>关于嵌入PL / SQL块</h3>
               <div>
                  <div class="section">
                     <p>该<a id="d28933e624" class="indexterm-anchor"></a> Oracle预编译器将PL / SQL块视为单个嵌入式SQL语句。因此，您可以将PL / SQL块放在可以放置SQL语句的主机程序中的任何位置。
                     </p>
                     <p><a id="d28933e630" class="indexterm-anchor"></a>要在主机程序中嵌入PL / SQL块，只需将PL / SQL块与关键字<code class="codeph">EXEC</code> <code class="codeph">SQL</code> <code class="codeph">EXECUTE</code>和<code class="codeph">END-EXEC</code> ，如下所示：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL EXECUTE DECLARE ...开始 ...结束; END-EXEC;</pre><p>关键字<code class="codeph">END-EXEC</code>必须后跟您的宿主语言的语句终止符。
                     </p>
                     <p>当程序嵌入PL / SQL块时，必须指定预编译器选项<code class="codeph">SQLCHECK=SEMANTICS</code>因为必须由Oracle解析PL / SQL。连接到<a id="d28933e659" class="indexterm-anchor"></a>在Oracle中，您还必须指定<code class="codeph">USERID</code>选项。有关更多信息，请参阅<span class="q">“ <a href="running-Oracle-precompilers.html#GUID-3B46BD40-209C-4426-B8C3-4ABF97C44507">关于使用预编译器选项</a> ”</span> 。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="ZZPRE305"></a><div class="props_rev_3"><a id="GUID-250ED489-7062-4A68-B664-BB7B0998FA91" name="GUID-250ED489-7062-4A68-B664-BB7B0998FA91"></a><h3 id="ZZPRE-GUID-250ED489-7062-4A68-B664-BB7B0998FA91" class="sect3"><span class="enumeration_section">5.3</span>关于使用主机变量</h3>
               <div>
                  <p>主机变量是主机语言和PL / SQL块之间通信的关键。主机变量可以与PL / SQL共享，这意味着PL / SQL可以设置和引用主机变量。</p>
                  <p>例如，您可以提示用户输入信息并使用主机变量将该信息传递给PL / SQL块。然后，PL / SQL可以访问数据库并使用主机变量将结果传递回主机程序。</p>
                  <p><a id="d28933e698" class="indexterm-anchor"></a>在PL / SQL块中，主变量被视为整个块的全局变量，并且可以在块中的任何位置使用，只要允许PL / SQL变量。但是，字符主机变量的长度不能超过255个字符。与SQL语句中的主变量一样，PL / SQL块中的主机变量必须以冒号为前缀。冒号设置除PL / SQL变量和数据库对象之外的主变量。
                  </p>
               </div><a id="ZZPRE306"></a><div class="props_rev_3"><a id="GUID-258C8FBE-C977-4E9E-92AB-6CC46AD2C087" name="GUID-258C8FBE-C977-4E9E-92AB-6CC46AD2C087"></a><h4 id="ZZPRE-GUID-258C8FBE-C977-4E9E-92AB-6CC46AD2C087" class="sect4"><span class="enumeration_section">5.3.1</span>一个例子</h4>
                  <div>
                     <p>以下示例说明了使用PL / SQL的主机变量。程序会提示用户输入员工编号，然后显示该员工的职位，雇用日期和工资。</p><pre class="oac_no_warn" dir="ltr">EXEC SQL BEGIN DECLARE SECTION;用户名CHARACTER（20）;密码CHARACTER（20）; emp_number INTEGER; job_title CHARACTER（20）; hire_date CHARACTER（9）;工资真实; EXEC SQL END DECLARE SECTION; EXEC SQL包含SQLCA;显示'用户名？“;读取用户名;显示'密码？“;读密码;执行SQL WHENEVER SQLERROR DO sql_error; EXEC SQL CONNECT：用户名IDENTIFIED BY：密码;显示'连接到Oracle'; LOOP显示'员工编号（0到结束）？“;读取emp_number;如果emp_number = 0那么执行SQL COMMIT工作发布;显示'退出程序';退出计划;万一; ----------------开始PL / SQL块----------------- EXEC SQL EXECUTE BEGIN SELECT job，hiredate，sal INTO： job_title，：hire_date，：salary FROM emp WHERE empno =：emp_number;结束; END-EXEC; ----------------结束PL / SQL块-----------------显示'号码职位招聘日期薪水'; display'------------------------------------';显示emp_number，job_title，hire_date，salary; ENDLOOP; ...ROUTINE sql_error BEGIN EXEC SQL WHENEVER SQLERROR CONTINUE; EXEC SQL ROLLBACK工作版;显示'处理错误';退出程序有错误; END sql_error;</pre><p>请注意，在进入PL / SQL块之前主机变量<span class="italic">emp_number</span>被设定，并且主机变量<span class="italic"><span class="italic">JOB_TITLE，HIRE_DATE，</span></span>和<span class="italic">工资</span>所设置的块内。
                     </p>
                  </div>
               </div><a id="ZZPRE307"></a><div class="props_rev_3"><a id="GUID-A731DD33-06D1-4CF0-BD28-8A24D8E10DF8" name="GUID-A731DD33-06D1-4CF0-BD28-8A24D8E10DF8"></a><h4 id="ZZPRE-GUID-A731DD33-06D1-4CF0-BD28-8A24D8E10DF8" class="sect4"><span class="enumeration_section">5.3.2</span>更复杂的例子</h4>
                  <div>
                     <p>在该示例中，您提示用户输入银行帐号，交易类型和交易金额，然后借记或贷记帐户。如果该帐户不存在，则引发异常。交易完成后，您将显示其状态。</p><pre class="oac_no_warn" dir="ltr">EXEC SQL BEGIN DECLARE SECTION;用户名CHARACTER（20）;密码CHARACTER（20）; acct_num INTEGER; trans_type CHARACTER（1）; trans_amt REAL;状态CHARACTER（80）; EXEC SQL END DECLARE SECTION; EXEC SQL包含SQLCA;显示'用户名？“;读取用户名;显示'密码？“;读密码;执行SQL WHENEVER SQLERROR DO sql_error; EXEC SQL CONNECT：用户名IDENTIFIED BY：密码;显示'连接到Oracle'; LOOP显示'账号（0到结束）？“; read acct_num; IF acct_num = 0然后执行SQL COMMIT工作版;显示'退出程序';退出计划;万一;显示'交易类型 -  D）ebit还是C）redit？'读trans_type;显示'交易金额？'读trans_amt; ---------------------开始PL / SQL块------------------- EXEC SQL EXECUTE DECLARE old_bal NUMBER（9,2）; err_msg CHAR（70）;不存在的例外;开始：trans_type：= UPPER（：trans_type）;如果：trans_type ='C'那么 - 记入账户UPDATE accts SET bal = bal +：trans_amt WHERE acctid =：acct_num;如果SQL％ROWCOUNT = 0那么 - 没有影响RAISE的行不存在; ELSE：status：='Credit applied';万一; ELSIF：trans_type ='D'THEN  - 借记帐户SELECT bal INTO old_bal FROM accts WHERE acctid =：acct_num;如果old_bal&gt; =：trans_amt那么 - 足够的资金UPDATE accts SET bal = bal  - ：trans_amt WHERE acctid =：acct_num; ：status：='借记已申请'; ELSE：status：='资金不足';万一; ELSE：status：='无效类型：'|| ：TRANS_TYPE;万一;承诺; NO_DATA_FOUND或不存在时的异常那么：状态：='不存在的帐户';当其他的时候，err_msg：= SUBSTR（SQLERRM，1,70）; ：status：='错误：'|| ERR_MSG;结束; END-EXEC; -------------------结束PL / SQL块-----------------------显示'状态： '， 状态; ENDLOOP; ROUTINE sql_error BEGIN EXEC SQL WHENEVER SQLERROR CONTINUE; EXEC SQL ROLLBACK工作版;显示'处理错误';退出程序有错误; END sql_error;</pre></div>
               </div><a id="ZZPRE308"></a><div class="props_rev_3"><a id="GUID-3CE9DBA9-F29F-41F9-AAAD-31A4029F79A0" name="GUID-3CE9DBA9-F29F-41F9-AAAD-31A4029F79A0"></a><h4 id="ZZPRE-GUID-3CE9DBA9-F29F-41F9-AAAD-31A4029F79A0" class="sect4"><span class="enumeration_section">5.3.3</span> VARCHAR Pseudotype</h4>
                  <div>
                     <p>回想一下<a href="meeting-program-requirements.html#GUID-ED71BADE-AF94-4074-B4B1-140E03903E88">会议程序要求</a> ，您可以使用<code class="codeph">VARCHAR</code>假型来声明可变长度的字符串。如果<code class="codeph">VARCHAR</code>是输入主变量，则必须告诉Oracle预期的长度。因此，将长度字段设置为存储在字符串字段中的值的实际长度。
                     </p>
                     <p>如果<code class="codeph">VARCHAR</code>是输出主机变量，Oracle会自动设置长度字段。但是，要在PL / SQL块中使用<code class="codeph">VARCHAR</code>输出主机变量，必须<span class="italic">在</span>进入块<span class="italic">之前</span>初始化长度字段。因此，将length字段设置为<code class="codeph">VARCHAR</code>的声明（最大）长度，如以下示例所示：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL BEGIN DECLARE SECTION; emp_number INTEGER; emp_name VARCHAR（10）;工资真实; ...EXEC SQL END DECLARE SECTION; ...set emp_name.len = 10; - 初始化长度字段EXEC SQL EXECUTE BEGIN SELECT ename，sal INTO：emp_name ,: salary FROM emp WHERE empno =：emp_number; ...结束; END-EXEC;</pre></div>
               </div>
            </div><a id="ZZPRE309"></a><div class="props_rev_3"><a id="GUID-863B7A7D-D21D-45CA-BF20-5796A1AF1CA4" name="GUID-863B7A7D-D21D-45CA-BF20-5796A1AF1CA4"></a><h3 id="ZZPRE-GUID-863B7A7D-D21D-45CA-BF20-5796A1AF1CA4" class="sect3"><span class="enumeration_section">5.4</span>关于使用指标变量</h3>
               <div>
                  <p><a id="d28933e855" class="indexterm-anchor"></a> PL / SQL不需要指示符变量，因为它可以操作空值。例如，在PL / SQL中，您可以使用<code class="codeph">IS NULL</code>运算符来测试空值，如下所示：</p><pre class="oac_no_warn" dir="ltr">IF变量IS NULL那么......
</pre><p>您可以使用赋值运算符（ <code class="codeph">:=</code> ）来分配空值，如下所示：</p><pre class="oac_no_warn" dir="ltr">变量：= NULL;</pre><p>但是，宿主语言需要指示符变量，因为它们无法操作空值。嵌入式PL / SQL通过让您使用指示符变量来满足此需求</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>接受来自主机程序的空值输入</p>
                     </li>
                     <li>
                        <p>将null或截断值输出到宿主程序</p>
                     </li>
                  </ul>
                  <p>在PL / SQL块中使用时，指示符变量遵循以下规则：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>您不能单独引用指标变量;它必须附加到其关联的主变量。</p>
                     </li>
                     <li>
                        <p>如果您使用其指示符变量引用主变量，则必须始终在同一块中以该方式引用它。</p>
                     </li>
                  </ul>
                  <p>在下面的示例中，指示符变量<span class="italic">ind_comm</span>在<code class="codeph">SELECT</code>语句中显示其主机变量<span class="italic">Commission</span> ，因此它必须以这种方式出现在<code class="codeph">IF</code>语句中：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL EXECUTE BEGIN SELECT ename，comm INTO：emp_name，：commission：ind_comm FROM emp WHERE empno =：emp_number; IF：佣金：ind_comm IS NULL那么.........结束; END-EXEC;</pre><p>请注意，PL / SQL对待<span class="italic">：委托：ind_comm</span>与任何其他简单变量一样。虽然您不能直接引用PL / SQL块中的指示符变量，但PL / SQL在进入块时会检查指示符变量的值，并在退出块时正确设置值。
                  </p>
               </div><a id="ZZPRE310"></a><div class="props_rev_3"><a id="GUID-251E3C21-67E6-4C1E-B5A8-ECA342DAA3DF" name="GUID-251E3C21-67E6-4C1E-B5A8-ECA342DAA3DF"></a><h4 id="ZZPRE-GUID-251E3C21-67E6-4C1E-B5A8-ECA342DAA3DF" class="sect4"><span class="enumeration_section">5.4.1</span>处理空值</h4>
                  <div>
                     <p>输入块时，如果指示符变量的值为<code class="codeph">-1</code> ，则PL / SQL会自动为主变量分配null。退出块时，如果主机变量为空，PL / SQL会自动为指示符变量赋值-1。在下一个示例中，如果在输入PL / SQL块之前<span class="italic">handsel</span>的值为-1，则引发<span class="italic">salary_missing</span>异常。一个<a id="d28933e948" class="indexterm-anchor"></a> <span class="italic">exception</span>是一个命名错误条件。
                     </p><pre class="oac_no_warn" dir="ltr">EXEC SQL EXECUTE BEGIN IF：salary：ind_sal IS NULL THEN RAISE salary_missing;万一; ...结束; END-EXEC;</pre></div>
               </div><a id="ZZPRE311"></a><div class="props_rev_3"><a id="GUID-71C9A8D3-873B-43F3-9C54-06A72BF7D2B9" name="GUID-71C9A8D3-873B-43F3-9C54-06A72BF7D2B9"></a><h4 id="ZZPRE-GUID-71C9A8D3-873B-43F3-9C54-06A72BF7D2B9" class="sect4"><span class="enumeration_section">5.4.2</span>处理截断值</h4>
                  <div>
                     <p>将截断的字符串值分配给主机变量时，PL / SQL不会引发异常。但是，如果使用指示符变量，PL / SQL会将其设置为字符串的原始长度。在以下示例中，主机程序将能够通过检查<span class="italic">ind_name</span>的值来<span class="italic">判断</span>是否为<span class="italic">emp_name</span>分配了截断值：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL EXECUTE DECLARE ...new_name CHAR（10）;开始 ...：\ temp_name：ind_name：= new_name; ...结束; END-EXEC;</pre></div>
               </div>
            </div><a id="ZZPRE313"></a><a id="ZZPRE841"></a><a id="ZZPRE312"></a><div class="props_rev_3"><a id="GUID-78FCA10C-976A-47A5-A15C-20D9F0F3C368" name="GUID-78FCA10C-976A-47A5-A15C-20D9F0F3C368"></a><h3 id="ZZPRE-GUID-78FCA10C-976A-47A5-A15C-20D9F0F3C368" class="sect3"><span class="enumeration_section">5.5</span>关于使用主机阵列</h3>
               <div>
                  <p>您可以将输入主机数组和指示符数组传递给PL / SQL块。它们可以由<code class="codeph">BINARY_INTEGER</code>类型的PL / SQL变量或与该类型兼容的主机变量索引。通常，整个主机数组都会传递给PL / SQL，但您可以使用<code class="codeph">ARRAYLEN</code>语句（稍后讨论）来指定较小的数组维度。
                  </p>
                  <p>此外，您可以使用子程序调用将主机数组中的所有值分配给PL / SQL表中的行。假设数组下标范围是<span class="italic">m</span> .. <span class="italic">n</span> ，则相应的PL / SQL表索引范围始终为1 .. <span class="italic">（n</span> - <span class="italic">m</span> + 1）。例如，如果数组下标范围是5 .. 10，则相应的PL / SQL表索引范围是1 ..（10  -  5 + 1）或1 ..6。
                  </p>
                  <div class="infoboxnote" id="GUID-78FCA10C-976A-47A5-A15C-20D9F0F3C368__GUID-34023F3E-257C-44D2-8E30-8D2DDBF17432">
                     <p class="notep1">注意：</p>
                     <p>Oracle预编译器不检查您对主机阵列的使用情况。例如，不进行索引范围检查。</p>
                  </div>
                  <p>在该示例中，将名为<span class="italic">salary</span>的主机数组传递给PL / SQL块，该块在函数调用中使用主机数组。该函数名为<span class="italic">median，</span>因为它在一系列数字中找到中间值。其形式参数包括名为<span class="italic">num_tab</span>的PL / SQL表。函数调用将实际参数<span class="italic">salary</span>中的所有值分配给formal参数<span class="italic">num_tab</span>中的行。
                  </p><pre class="oac_no_warn" dir="ltr">EXEC SQL BEGIN DECLARE SECTION; ...薪水（100）REAL; median_salary REAL; EXEC SQL END DECLARE SECTION; - 填充主机数组EXEC SQL EXECUTE DECLARE TYPE NumTabTyp IS TABLE OF REAL INDEX BY BINARY_INTEGER; n BINARY_INTEGER; ...功能中位数（num_tab NumTabTyp，n INTEGER）返回实际开始 - 计算中位数END;开始n：= 100; ：median_salary：= median（：salary，n）; ...结束; END-EXEC;</pre><p>您还可以使用子程序调用将PL / SQL表中的所有行值分配给主机数组中的相应元素。</p>
                  <p><a href="using-embedded-PLSQL.html#GUID-78FCA10C-976A-47A5-A15C-20D9F0F3C368__BABEGBGG" title="pl sql">表5-1</a>显示了PL / SQL表中的行值与主机数组中的元素之间的合法转换。例如，类型为<code class="codeph">LONG</code>的主机数组与<code class="codeph">VARCHAR2</code> ， <code class="codeph">LONG</code> ， <code class="codeph">RAW</code>或<code class="codeph">LONG RAW</code>类型的PL / SQL表兼容。值得注意的是，它与<code class="codeph">CHAR</code>类型的PL / SQL表不兼容。</p>
                  <div class="tblformal" id="GUID-78FCA10C-976A-47A5-A15C-20D9F0F3C368__BABEGBGG">
                     <p class="titleintable">表5-1法律转换：PL / SQL表行和主机阵列元素</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="法律转换：PL / SQL表行和主机数组元素" width="100%" border="1" summary="pl sql" frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="16%" id="d28933e1103">PL / SQL表</th>
                              <th align="left" valign="bottom" width="9%" id="d28933e1106">CHAR</th>
                              <th align="left" valign="bottom" width="9%" id="d28933e1110">日期</th>
                              <th align="left" valign="bottom" width="9%" id="d28933e1114">长</th>
                              <th align="left" valign="bottom" width="12%" id="d28933e1118">LONG RAW</th>
                              <th align="left" valign="bottom" width="12%" id="d28933e1125">数</th>
                              <th align="left" valign="bottom" width="10%" id="d28933e1129">生的</th>
                              <th align="left" valign="bottom" width="11%" id="d28933e1133">ROWID</th>
                              <th align="left" valign="bottom" width="12%" id="d28933e1137">VARCHAR2</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="16%" id="d28933e1143" headers="d28933e1103 ">
                                 <p><code class="codeph">CHARF</code></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1143 d28933e1106 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1143 d28933e1110 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1143 d28933e1114 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1143 d28933e1118 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1143 d28933e1125 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d28933e1143 d28933e1129 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d28933e1143 d28933e1133 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1143 d28933e1137 ">
                                 <p></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="16%" id="d28933e1165" headers="d28933e1103 ">
                                 <p><code class="codeph">CHARZ</code></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1165 d28933e1106 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1165 d28933e1110 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1165 d28933e1114 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1165 d28933e1118 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1165 d28933e1125 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d28933e1165 d28933e1129 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d28933e1165 d28933e1133 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1165 d28933e1137 ">
                                 <p></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="16%" id="d28933e1187" headers="d28933e1103 ">
                                 <p><code class="codeph">日期</code></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1187 d28933e1106 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1187 d28933e1110 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1187 d28933e1114 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1187 d28933e1118 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1187 d28933e1125 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d28933e1187 d28933e1129 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d28933e1187 d28933e1133 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1187 d28933e1137 ">
                                 <p></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="16%" id="d28933e1209" headers="d28933e1103 ">
                                 <p><code class="codeph">DECIMAL</code></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1209 d28933e1106 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1209 d28933e1110 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1209 d28933e1114 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1209 d28933e1118 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1209 d28933e1125 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d28933e1209 d28933e1129 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d28933e1209 d28933e1133 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1209 d28933e1137 ">
                                 <p></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="16%" id="d28933e1231" headers="d28933e1103 ">
                                 <p><code class="codeph">显示</code></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1231 d28933e1106 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1231 d28933e1110 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1231 d28933e1114 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1231 d28933e1118 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1231 d28933e1125 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d28933e1231 d28933e1129 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d28933e1231 d28933e1133 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1231 d28933e1137 ">
                                 <p></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="16%" id="d28933e1253" headers="d28933e1103 ">
                                 <p><code class="codeph">浮动</code></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1253 d28933e1106 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1253 d28933e1110 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1253 d28933e1114 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1253 d28933e1118 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1253 d28933e1125 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d28933e1253 d28933e1129 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d28933e1253 d28933e1133 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1253 d28933e1137 ">
                                 <p></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="16%" id="d28933e1275" headers="d28933e1103 ">
                                 <p><code class="codeph">整数</code></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1275 d28933e1106 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1275 d28933e1110 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1275 d28933e1114 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1275 d28933e1118 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1275 d28933e1125 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d28933e1275 d28933e1129 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d28933e1275 d28933e1133 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1275 d28933e1137 ">
                                 <p></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="16%" id="d28933e1297" headers="d28933e1103 ">
                                 <p><code class="codeph">长</code></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1297 d28933e1106 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1297 d28933e1110 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1297 d28933e1114 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1297 d28933e1118 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1297 d28933e1125 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d28933e1297 d28933e1129 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d28933e1297 d28933e1133 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1297 d28933e1137 ">
                                 <p></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="16%" id="d28933e1320" headers="d28933e1103 ">
                                 <p><code class="codeph">LONG</code> <code class="codeph">VARCHAR</code></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1320 d28933e1106 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1320 d28933e1110 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1320 d28933e1114 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1320 d28933e1118 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1320 d28933e1125 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d28933e1320 d28933e1129 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d28933e1320 d28933e1133 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1320 d28933e1137 ">
                                 <p>_ /</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="16%" id="d28933e1348" headers="d28933e1103 ">
                                 <p><code class="codeph">LONG</code> <code class="codeph">VARRAW</code></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1348 d28933e1106 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1348 d28933e1110 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1348 d28933e1114 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1348 d28933e1118 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1348 d28933e1125 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d28933e1348 d28933e1129 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d28933e1348 d28933e1133 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1348 d28933e1137 ">
                                 <p></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="16%" id="d28933e1374" headers="d28933e1103 ">
                                 <p><code class="codeph">数</code></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1374 d28933e1106 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1374 d28933e1110 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1374 d28933e1114 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1374 d28933e1118 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1374 d28933e1125 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d28933e1374 d28933e1129 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d28933e1374 d28933e1133 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1374 d28933e1137 ">
                                 <p></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="16%" id="d28933e1397" headers="d28933e1103 ">
                                 <p><code class="codeph">生的</code></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1397 d28933e1106 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1397 d28933e1110 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1397 d28933e1114 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1397 d28933e1118 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1397 d28933e1125 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d28933e1397 d28933e1129 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d28933e1397 d28933e1133 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1397 d28933e1137 ">
                                 <p></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="16%" id="d28933e1420" headers="d28933e1103 ">
                                 <p><code class="codeph">ROWID</code></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1420 d28933e1106 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1420 d28933e1110 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1420 d28933e1114 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1420 d28933e1118 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1420 d28933e1125 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d28933e1420 d28933e1129 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d28933e1420 d28933e1133 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1420 d28933e1137 ">
                                 <p></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="16%" id="d28933e1442" headers="d28933e1103 ">
                                 <p><code class="codeph">串</code></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1442 d28933e1106 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1442 d28933e1110 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1442 d28933e1114 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1442 d28933e1118 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1442 d28933e1125 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d28933e1442 d28933e1129 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d28933e1442 d28933e1133 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1442 d28933e1137 ">
                                 <p>_ /</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="16%" id="d28933e1467" headers="d28933e1103 ">
                                 <p><code class="codeph">UNSIGNED</code></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1467 d28933e1106 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1467 d28933e1110 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1467 d28933e1114 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1467 d28933e1118 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1467 d28933e1125 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d28933e1467 d28933e1129 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d28933e1467 d28933e1133 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1467 d28933e1137 ">
                                 <p></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="16%" id="d28933e1489" headers="d28933e1103 ">
                                 <p><code class="codeph">VARCHAR</code></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1489 d28933e1106 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1489 d28933e1110 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1489 d28933e1114 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1489 d28933e1118 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1489 d28933e1125 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d28933e1489 d28933e1129 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d28933e1489 d28933e1133 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1489 d28933e1137 ">
                                 <p>_ /</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="16%" id="d28933e1514" headers="d28933e1103 ">
                                 <p><code class="codeph">VARCHAR2</code></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1514 d28933e1106 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1514 d28933e1110 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1514 d28933e1114 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1514 d28933e1118 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1514 d28933e1125 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d28933e1514 d28933e1129 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d28933e1514 d28933e1133 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1514 d28933e1137 ">
                                 <p>_ /</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="16%" id="d28933e1539" headers="d28933e1103 ">
                                 <p><code class="codeph">VARNUM</code></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1539 d28933e1106 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1539 d28933e1110 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1539 d28933e1114 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1539 d28933e1118 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1539 d28933e1125 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d28933e1539 d28933e1129 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d28933e1539 d28933e1133 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1539 d28933e1137 ">
                                 <p></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="16%" id="d28933e1561" headers="d28933e1103 ">
                                 <p><code class="codeph">VARRAW</code></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1561 d28933e1106 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1561 d28933e1110 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="9%" headers="d28933e1561 d28933e1114 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1561 d28933e1118 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1561 d28933e1125 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d28933e1561 d28933e1129 ">
                                 <p>_ /</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d28933e1561 d28933e1133 ">
                                 <p></p>
                              </td>
                              <td align="left" valign="top" width="12%" headers="d28933e1561 d28933e1137 ">
                                 <p></p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
               </div><a id="ZZPRE314"></a><div class="props_rev_3"><a id="GUID-8538DF7D-89BB-41BA-89AD-984BB5196891" name="GUID-8538DF7D-89BB-41BA-89AD-984BB5196891"></a><h4 id="ZZPRE-GUID-8538DF7D-89BB-41BA-89AD-984BB5196891" class="sect4"><span class="enumeration_section">5.5.1</span> ARRAYLEN声明</h4>
                  <div>
                     <div class="section">
                        <p><a id="d28933e1605" class="indexterm-anchor"></a>假设您必须将输入主机数组传递给PL / SQL块进行处理。默认情况下，绑定此类主机阵列时，Oracle预编译器将使用其声明的维度。但是，您可能不想处理整个阵列。在这种情况下，您可以使用<code class="codeph">ARRAYLEN</code>语句指定较小的数组维度。<code class="codeph">ARRAYLEN</code>将主机数组与主变量相关联，主变量存储较小的维度。语句语法是</p><pre class="oac_no_warn" dir="ltr">EXEC SQL ARRAYLEN host_array（dimension）;</pre><p>其中<span class="italic">dimension</span>是一个4字节的整数主变量， <span class="italic">而不是</span>文字或表达式。
                        </p>
                        <p><code class="codeph">ARRAYLEN</code>语句必须与<span class="italic">host_array</span>和<span class="italic">dimension</span>的声明一起出现在Declare部分中，但在其<span class="italic">后面</span> 。您无法在主机阵列中指定偏移量。但是，您可以为此目的使用主机语言功能。
                        </p>
                        <p>在以下示例中，您使用<code class="codeph">ARRAYLEN</code>覆盖名为<span class="italic">bonus</span>的主机数组的默认维度：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL BEGIN DECLARE SECTION; bonus（100）REAL; my_dim INTEGER; EXEC SQL ARRAYLEN奖金（my_dim）; EXEC SQL END DECLARE SECTION; - 填充主机阵列......设置my_dim = 25; - 设置较小的数组维度EXEC SQL EXECUTE DECLARE TYPE NumTabTyp是真实索引表BINARY_INTEGER; median_bonus REAL;功能中位数（num_tab NumTabTyp，n INTEGER）返回实际开始 - 计算中位数END; BEGIN median_bonus：= median（：bonus，：my_dim）; ...结束; END-EXEC;</pre><p>只有25个数组元素传递给PL / SQL块，因为<code class="codeph">ARRAYLEN</code>将主机数组从100个元素缩小到25个元素。因此，当PL / SQL块被发送到Oracle执行时，会发送一个小得多的主机阵列。这节省了时间，并且在网络环境中减少了网络流量。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="ZZPRE316"></a><a id="ZZPRE315"></a><div class="props_rev_3"><a id="GUID-91D74CE0-84E8-4A9C-BF6F-7F3F01B14573" name="GUID-91D74CE0-84E8-4A9C-BF6F-7F3F01B14573"></a><h3 id="ZZPRE-GUID-91D74CE0-84E8-4A9C-BF6F-7F3F01B14573" class="sect3"><span class="enumeration_section">5.6</span>关于使用游标</h3>
               <div>
                  <p>每个嵌入式SQL语句都会为您分配一个游标，您可以在<code class="codeph">DECLARE</code> <code class="codeph">CURSOR</code>语句中显式指定游标，也可以由预编译器隐式指定游标。在内部，Oracle预编译器维护一个称为<span class="italic">游标缓存的缓存</span>来控制嵌入式SQL语句的执行。执行时，会在游标缓存中为每个SQL语句分配一个条目。此条目链接到您的私有SQL区域<a id="d28933e1697" class="indexterm-anchor"></a> Oracle内部的程序全局区域（PGA）。
                  </p>
                  <p>各种预编译器选项（包括<code class="codeph">MAXOPENCURSORS</code> ， <code class="codeph">HOLD_CURSOR</code>和<code class="codeph">RELEASE_CURSOR</code> ）允许您管理游标缓存以提高性能。例如， <code class="codeph">RELEASE_CURSOR</code>控制游标缓存和私有SQL区域之间的链接发生了什么。如果指定<code class="codeph">RELEASE_CURSOR</code> <code class="codeph">=YES</code> ，则在Oracle执行SQL语句后将删除该链接。这将释放分配给私有SQL区域的内存并释放解析锁。
                  </p>
                  <p><a id="d28933e1720" class="indexterm-anchor"></a>出于游标缓存管理的目的，嵌入式PL / SQL块被视为SQL语句。在运行时，称为<span class="italic">父光标的游标</span>与整个PL / SQL块相关联。对光标高速缓存进行相应的输入，并且该条目链接到PGA中的私有SQL区域。</p>
                  <p><a id="d28933e1727" class="indexterm-anchor"></a> PL / SQL块中的每个SQL语句也需要PGA中的私有SQL区域。因此，PL / SQL为这些SQL语句管理一个单独的缓存，称为<span class="italic">子游标缓存</span> 。他们的游标被称为<span class="italic">儿童游标</span> 。因为PL / SQL管理子游标缓存，所以您无法直接控制子游标。
                  </p>
                  <p>程序可以同时使用的最大游标数由Oracle初始化参数<code class="codeph">OPEN_CURSORS</code> 。 <a href="using-embedded-PLSQL.html#GUID-91D74CE0-84E8-4A9C-BF6F-7F3F01B14573__BIHJFJEI">图5-1</a>显示了如何计算正在使用的最大游标数。
                  </p>
                  <div class="figure" id="GUID-91D74CE0-84E8-4A9C-BF6F-7F3F01B14573__BIHJFJEI">
                     <p class="titleinfigure">图5-1使用中的最大光标</p><img src="img/image009.gif" alt="下面是图5-1的描述" title="下面是图5-1的描述" longdesc="img_text/image009.html"><br><a href="img_text/image009.html">“图5-1使用中的最大光标”的说明</a></div>
                  <!-- class="figure" -->
                  <p>如果您的程序超出了<code class="codeph">OPEN_CURSORS</code>强加的限制，则会出现以下Oracle错误：</p><pre class="oac_no_warn" dir="ltr">ORA-01000：超出最大打开游标数</pre><p>您可以通过指定<code class="codeph">RELEASE_CURSOR</code> <code class="codeph">=YES</code>和<code class="codeph">HOLD_CURSOR</code> <code class="codeph">=NO</code>选项来避免此错误。如果您不想在<code class="codeph">RELEASE_CURSOR</code>设置为<code class="codeph">YES</code>预编译整个程序，只需在每个PL / SQL块之后将其重置为<code class="codeph">NO</code> ，如下所示：</p><pre class="oac_no_warn" dir="ltr">EXEC ORACLE选项（RELEASE_CURSOR = YES）; - 第一个嵌入式PL / SQL块EXEC ORACLE OPTION（RELEASE_CURSOR = NO）; - 嵌入式SQL语句EXEC ORACLE OPTION（RELEASE_CURSOR = YES）; - 第二个嵌入式PL / SQL块EXEC ORACLE OPTION（RELEASE_CURSOR = NO）; - 嵌入式SQL语句</pre></div><a id="ZZPRE317"></a><div class="props_rev_3"><a id="GUID-EC8DDC67-03A6-4C7B-93B7-5FAE7B66648A" name="GUID-EC8DDC67-03A6-4C7B-93B7-5FAE7B66648A"></a><h4 id="ZZPRE-GUID-EC8DDC67-03A6-4C7B-93B7-5FAE7B66648A" class="sect4"><span class="enumeration_section">5.6.1</span>替代方案</h4>
                  <div>
                     <div class="section">
                        <p><code class="codeph">MAXOPENCURSORS</code>选项指定游标缓存的初始大小。例如，当<code class="codeph">MAXOPENCURSORS=1</code> 0时，游标缓存最多可容纳10个条目。如果需要新的游标，没有空闲的缓存条目，并且<code class="codeph">HOLD_CURSOR=NO</code> ，则预编译器会尝试重用一个条目。如果为<code class="codeph">MAXOPENCURSORS</code>指定一个非常低的值，则强制预编译器会更频繁地重用父游标。一旦重复使用父光标，就会释放所有子光标。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="ZZPRE318"></a><div class="props_rev_3"><a id="GUID-5840297F-2757-465C-8B1D-8C6DFFBBFA20" name="GUID-5840297F-2757-465C-8B1D-8C6DFFBBFA20"></a><h3 id="ZZPRE-GUID-5840297F-2757-465C-8B1D-8C6DFFBBFA20" class="sect3"><span class="enumeration_section">5.7</span>存储的子程序</h3>
               <div>
                  <p><a id="d28933e1839" class="indexterm-anchor"></a>与匿名块不同，PL / SQL子程序（过程和函数）可以单独编译，存储在Oracle数据库中，然后调用。使用Oracle工具（如SQL * Plus）显式创建的子程序称为<span class="italic">存储</span>子程序。一旦编译并存储在数据字典中，它就是一个数据库对象，可以在不重新编译的情况下重新执行。
                  </p>
                  <p>当PL / SQL块或存储的子程序中的子程序被应用程序发送到Oracle时，它被称为<span class="italic">内联</span>子程序。Oracle编译内联子程序并将其缓存在<a id="d28933e1850" class="indexterm-anchor"></a>系统全局区域（SGA），但不将源代码或目标代码存储在数据字典中。
                  </p>
                  <p><a id="d28933e1854" class="indexterm-anchor"></a>程序包中定义的子程序被视为程序包的一部分，因此称为<span class="italic">打包的</span>子程序。未在包中定义的存储子程序称为<span class="italic">独立</span>子程序。
                  </p>
               </div><a id="ZZPRE319"></a><div class="props_rev_3"><a id="GUID-E017A1D5-DC68-4B18-90D2-62741D825376" name="GUID-E017A1D5-DC68-4B18-90D2-62741D825376"></a><h4 id="ZZPRE-GUID-E017A1D5-DC68-4B18-90D2-62741D825376" class="sect4"><span class="enumeration_section">5.7.1</span>创建存储的子程序</h4>
                  <div>
                     <div class="section">
                        <p><a id="d28933e1893" class="indexterm-anchor"></a>您可以在宿主程序中嵌入SQL语句<code class="codeph">CREATE</code> <code class="codeph">FUNCTION</code> ， <code class="codeph">CREATE</code> <code class="codeph">PROCEDURE</code>和<code class="codeph">CREATE</code> <code class="codeph">PACKAGE</code> ，如以下示例所示：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL CREATE FUNCTION sal_ok（salary REAL，title CHAR）RETURN BOOLEAN as min_sal REAL; max_sal REAL; BEGIN SELECT losal，hisal INTO min_sal，max_sal FROM sals WHERE job = title;返回（工资&gt; = min_sal）AND（工资&lt;= max_sal）;结束sal_ok; END-EXEC;</pre><p>请注意嵌入的<code class="codeph">CREATE</code> <code class="codeph">{FUNCTION | PROCEDURE | PACKAGE}</code>语句是混合语句。与所有其他嵌入式<code class="codeph">CREATE</code>语句一样，它以关键字<code class="codeph">EXEC SQL</code> （不是<code class="codeph">EXEC SQL EXECUTE</code> ）开头。但是，与其他嵌入式<code class="codeph">CREATE</code>语句不同，它以PL / SQL终止符<code class="codeph">END-EXEC</code> 。</p>
                        <p>在该示例中，您将创建一个包含名为<span class="italic">get_employees</span>的过程的包，该过程从<span class="italic">emp</span>表中获取一批行。批量大小由过程的调用者确定，该调用者可能是另一个存储的子程序或客户端应用程序。
                        </p>
                        <p>该过程将三个PL / SQL表声明为<code class="codeph">OUT</code>形式参数，然后将一批员工数据提取到PL / SQL表中。匹配的实际参数是主机阵列。该过程完成后，它会自动将PL / SQL表中的所有行值分配给主机阵列中的相应元素。
                        </p><pre class="oac_no_warn" dir="ltr">EXEC SQL CREATE或REPLACE PACKAGE emp_actions AS TYPE CharArrayTyp IS TABLE OF VARCHAR2（10）INDEX BY BINARY_INTEGER; TYPE NumArrayTyp是BINARY_INTEGER的FLOAT INDEX表;程序get_employees（dept_number IN INTEGER，batch_size IN INTEGER，找到IN OUT INTEGER，done_fetch OUT INTEGER，emp_name OUT CharArrayTyp，job-title OUT CharArrayTyp，salary OUT NumArrayTyp）; END emp_actions; END-EXEC; EXEC SQL CREATE或REPLACE PACKAGE BODY emp_actions AS CURSOR get_emp（dept_number IN INTEGER）是SELECT ename，job，sal FROM emp WHERE deptno = dept_number;程序get_employees（dept_number IN INTEGER，batch_size IN INTEGER，找到IN OUT INTEGER，done_fetch OUT INTEGER，emp_name OUT CharArrayTyp，job_title OUT CharArrayTyp，salary OUT NumArrayTyp）如果不是get_emp％ISOPEN则打开get_emp（dept_number）;万一; done_fetch：= 0;发现：= 0; FOR i IN 1..batch_size LOOP FETCH get_emp INTO emp_name（i），job_title（i），salary（i）;如果get_emp％NOTFOUND那么关闭get_emp; done_fetch：= 1;出口; ELSE发现：=找到+ 1;万一;结束循环; END get_employees; END emp_actions; END-EXEC;</pre><p>您可以在<code class="codeph">CREATE</code>语句中指定<code class="codeph">REPLACE</code>子句以重新定义现有包，而无需删除包，重新创建它以及对其授予regrant特权。有关<code class="codeph">CREATE</code>语句的完整语法，请参阅<a href="../sqlrf/Introduction-to-Oracle-SQL.html#SQLRF-GUID-049B7AE8-11E1-4110-B3E4-D117907D77AC" target="_blank"><span class="italic">Oracle数据库SQL语言参考</span></a> 。
                        </p>
                        <p>如果嵌入的<code class="codeph">CREATE {FUNCTION|PROCEDURE|PACKAGE}</code>语句失败，Oracle会生成警告，而不是错误。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE320"></a><div class="props_rev_3"><a id="GUID-513BABF4-4FD7-4DCD-823A-A4D06945D22C" name="GUID-513BABF4-4FD7-4DCD-823A-A4D06945D22C"></a><h4 id="ZZPRE-GUID-513BABF4-4FD7-4DCD-823A-A4D06945D22C" class="sect4"><span class="enumeration_section">5.7.2</span>调用存储的子程序</h4>
                  <div>
                     <div class="section">
                        <p>要从宿主程序调用（调用）存储的子程序，必须使用匿名PL / SQL块。在以下示例中，您将调用名为<span class="italic">raise_salary</span>的独立过程：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL EXECUTE BEGIN raise_salary（：emp_id，：increase）;结束; END-EXEC;</pre><p>请注意，存储的子程序可以采用参数。在此示例中，实际参数<span class="italic">emp_id</span>和<span class="italic">increase</span>是主变量。
                        </p>
                        <p>在下一个示例中，过程<span class="italic">raise_salary</span>存储在名为<span class="italic">emp_actions</span>的包中，因此必须使用点表示法来完全限定过程调用：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL EXECUTE BEGIN emp_actions.raise_salary（：emp_id，：increase）;结束; END-EXEC;</pre><p>实际的IN参数可以是文字，主机变量，主机数组，PL / SQL常量或变量，PL / SQL表，PL / SQL用户定义记录，子程序调用或表达式。但是，实际的OUT参数不能是文字，子程序调用或表达式。</p>
                        <p>在Pro * C示例中，三个形式参数是PL / SQL表，相应的实际参数是主机数组。程序重复调用存储过程<span class="italic">get_employees</span> ，显示每批员工数据，直到找不到更多数据。
                        </p><pre class="oac_no_warn" dir="ltr">#include &lt;stdio.h&gt; #include &lt;string.h&gt; typedef char asciz; EXEC SQL BEGIN DECLARE SECTION; / *定义以null结尾的字符串的类型* / EXEC SQL TYPE asciz IS STRING（20）; asciz username [20]; asciz密码[20]; int dept_no; / *查询哪个部门* / char emp_name [10] [21]; char job [10] [21];浮动工资[10]; int done_flag; int array_size; int num_ret; / *返回的行数* / int SQLCODE; EXEC SQL END DECLARE SECTION; EXEC SQL INCLUDE sqlca; int print_rows（）; / *产生程序输出* / int sql_error（）; / *处理NOLOGGING错误* / main（）{int i; / *连接到Oracle。* / strcpy（用户名，“SCOTT”）; strcpy（密码，“TIGER”）;执行SQL WHENEVER SQLERROR DO sql_error（）; EXEC SQL CONNECT：用户名IDENTIFIED BY：密码; printf（“\ n以用户身份连接到Oracle：％s \ n”，用户名）; printf（“输入部门号码：”）; scanf（“％d”，＆dept_no）; fflush（标准输入）; / *设置数组大小。* / array_size = 10; done_flag = 0; num_ret = 0; / *数组获取循环 - 当done_flag为真时结束。* / for（;;）{EXEC SQL EXECUTE BEGIN emp_actions.get_employees（：dept_no，：array_size，：num_ret，：done_flag，：emp_name，：job，：salary）;结束; END-EXEC; print_rows（num_ret）;如果（done_flag）中断; } / *断开与数据库的连接。* / EXEC SQL COMMIT WORK RELEASE;出口（0）; } print_rows（n）int n; {int i; if（n == 0）{printf（“没有检索到的行。\ n”）;返回; } printf（“\ n \ nGot％d row％c \ n”，n，n == 1？'\ 0'：'s'）; printf（“％ -  20.20s％-20.20s％s \ n”，“Ename”，“Job”，“Salary”）; for（i = 0; i &lt;n; i ++）printf（“％20.20s％20.20s％6.2f \ n”，emp_name [i]，job [i]，salary [i]）; } sql_error（）{EXEC SQL WHENEVER SQLERROR CONTINUE; printf（“\ n检测到\ nOracle错误：”）; printf（“\ n％.70s \ n”，sqlca.sqlerrm.sqlerrmc）; EXEC SQL ROLLBACK工作版;出口（1）; }</pre><p>请记住，每个实际参数的数据类型必须可以转换为其相应形式参数的数据类型。此外，在存储的子程序退出之前，必须为所有OUT形式参数赋值。否则，相应的实际参数的值是不确定的。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ZZPRE321"></a><div class="props_rev_3"><a id="GUID-AD4526ED-8DAA-4336-B671-5B89C9A13405" name="GUID-AD4526ED-8DAA-4336-B671-5B89C9A13405"></a><h4 id="ZZPRE-GUID-AD4526ED-8DAA-4336-B671-5B89C9A13405" class="sect4"><span class="enumeration_section">5.7.3</span>远程访问</h4>
                  <div>
                     <p>PL / SQL允许您通过<span class="italic">数据库链接</span>访问远程数据库。通常，数据库链接由DBA建立并存储在Oracle数据字典中。数据库链接告诉Oracle远程数据库的位置，路径，以及要使用的Oracle用户名和密码。在以下示例中，您使用数据库链接<span class="italic">dallas</span>来调用<span class="italic">raise_salary</span>过程：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL EXECUTE BEGIN raise_salary @dallas（：emp_id，：increase）;结束; END-EXEC;</pre><p>您可以创建同义词以提供远程子程序的位置透明度，如以下示例所示：</p><pre class="oac_no_warn" dir="ltr">CREATE PUBLIC SYNONYM raise_salary FOR raise_salary @dallas;</pre></div>
               </div><a id="ZZPRE322"></a><div class="props_rev_3"><a id="GUID-EA5AC63F-B2CA-4F4C-B6BB-703C834298A5" name="GUID-EA5AC63F-B2CA-4F4C-B6BB-703C834298A5"></a><h4 id="ZZPRE-GUID-EA5AC63F-B2CA-4F4C-B6BB-703C834298A5" class="sect4"><span class="enumeration_section">5.7.4</span>获取存储子程序的相关信息</h4>
                  <div>
                     <p>在<a href="meeting-program-requirements.html#GUID-ED71BADE-AF94-4074-B4B1-140E03903E88">会议计划要求中</a> ，您学习了如何在主机程序中嵌入OCI调用。在调用库例程<code class="codeph">SQLLDA</code>以设置LDA之后，可以使用OCI调用<code class="codeph">ODESSP</code>来获取有关存储的子程序的有用信息。调用<code class="codeph">ODESSP</code> ，必须<code class="codeph">ODESSP</code>传递有效的LDA和子程序的名称。对于打包的子程序，还必须传递包的名称。<code class="codeph">ODESSP</code>返回有关每个子程序参数的信息，例如其数据类型，大小，位置等。
                     </p>
                     <p>您还可以使用在包装DBMS_DESCRIBE，它与Oracle提供的程序<span class="italic">describe_procedure。</span>
                     </p>
                  </div>
               </div>
            </div><a id="ZZPRE323"></a><div class="props_rev_3"><a id="GUID-0DBFAB55-C488-4C26-AEB3-422132DBB805" name="GUID-0DBFAB55-C488-4C26-AEB3-422132DBB805"></a><h3 id="ZZPRE-GUID-0DBFAB55-C488-4C26-AEB3-422132DBB805" class="sect3"><span class="enumeration_section">5.8</span>关于使用动态PL / SQL</h3>
               <div>
                  <p>回想一下，Oracle预编译器将整个PL / SQL块视为单个SQL语句。因此，您可以将PL / SQL块存储在字符串主变量中。然后，如果块不包含主机变量，则可以使用动态SQL方法1来执行PL / SQL字符串。或者，如果块包含已知数量的主机变量，则可以使用动态SQL方法2来准备和执行PL / SQL字符串。如果块包含未知数量的主机变量，则必须使用动态SQL方法4。有关更多信息，请参阅<a href="using-dynamic-SQL.html#GUID-5C0F172A-6D8C-45FC-8F23-B544995108FE">使用动态SQL</a> 。</p>
               </div><a id="ZZPRE324"></a><div class="props_rev_3"><a id="GUID-FF33A61C-305D-44FD-92F4-5548AEE8FEDE" name="GUID-FF33A61C-305D-44FD-92F4-5548AEE8FEDE"></a><h4 id="ZZPRE-GUID-FF33A61C-305D-44FD-92F4-5548AEE8FEDE" class="sect4"><span class="enumeration_section">5.8.1</span>限制</h4>
                  <div>
                     <p>在动态SQL方法4中，主机数组不能绑定到具有<code class="codeph">TABLE</code>类型参数的PL / SQL过程。</p>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>