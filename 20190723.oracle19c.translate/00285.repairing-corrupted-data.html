<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="You can detect and correct data block corruption."></meta>
      <meta name="description" content="You can detect and correct data block corruption."></meta>
      <title>修复损坏的数据</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Database Administrator’s Guide "></meta>
      <meta property="og:description" content="You can detect and correct data block corruption."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Database Administrator’s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-administrators-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-03-14T11:02:35-07:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96348-04"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="managing-views-sequences-and-synonyms.html" title="Previous" type="text/html"></link>
      <link rel="next" href="database-resource-management-and-task-scheduling.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Administrator&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="ADMIN"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="managing-views-sequences-and-synonyms.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="database-resource-management-and-task-scheduling.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据库管理员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="schema-objects.html" property="item" typeof="WebPage"><span property="name">架构对象</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">修复损坏的数据</li>
            </ol>
            <a id="GUID-21282FF3-1E98-478E-8111-0A7CAFCFCD97" name="GUID-21282FF3-1E98-478E-8111-0A7CAFCFCD97"></a><a id="ADMIN022"></a>
            
            <h2 id="ADMIN-GUID-21282FF3-1E98-478E-8111-0A7CAFCFCD97" class="sect2"><span class="enumeration_chapter">25</span>修复损坏的数据</h2>
         </header>
         <div class="ind">
            <div>
               <p>您可以检测并纠正数据块损坏。</p>
               <div class="infoboxnote" id="GUID-21282FF3-1E98-478E-8111-0A7CAFCFCD97__GUID-6B6B6763-2762-48E6-9519-C947AEAF7A66">
                  <p class="notep1">注意：</p>
                  <p>如果您不熟悉<code class="codeph">DBMS_REPAIR</code>程序包，则建议您在执行此程序包中包含的任何修复过程时与Oracle支持服务分析师合作。
                  </p>
               </div>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-ED44A53C-E1FC-4F29-BD7E-8866E8E864A7">修复数据块损坏的选项</a><br>Oracle数据库提供了用于检测和纠正数据块损坏的不同方法。
                  </li>
                  <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-2D36AA2A-8EF9-411B-84CE-EE30FBDDCE0D">关于DBMS_REPAIR包</a><br><code class="codeph">DBMS_REPAIR</code>程序包包含数据损坏修复过程，使您可以检测和修复表和索引中的损坏块。
                  </li>
                  <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-DF695FE6-E166-48E8-95E9-B8763A322F6F">使用DBMS_REPAIR包</a><br>您可以使用<code class="codeph">DBMS_REPAIR</code>包来解决数据块损坏：</li>
                  <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-EA2EA177-80ED-420B-B16E-2936014AC68C">DBMS_REPAIR示例</a><br>示例说明了如何使用<code class="codeph">DBMS_REPAIR</code>包。
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="schema-objects.html#GUID-2DA8C61C-58B0-4892-8E5D-E7A9120BC120" title="您可以在Oracle数据库中创建和管理架构对象。">模式对象</a></p>
                  </div>
               </div>
            </div>
            <a id="ADMIN11811"></a><div class="props_rev_3"><a id="GUID-ED44A53C-E1FC-4F29-BD7E-8866E8E864A7" name="GUID-ED44A53C-E1FC-4F29-BD7E-8866E8E864A7"></a><h3 id="ADMIN-GUID-ED44A53C-E1FC-4F29-BD7E-8866E8E864A7" class="sect3"><span class="enumeration_section">25.1</span>修复数据块损坏的选项</h3>
               <div>
                  <p>Oracle数据库提供了用于检测和纠正数据块损坏的不同方法。</p>
                  <p>一种更正方法是在检测到损坏后删除并重新创建对象。然而，这并非总是可行或不可取的。如果数据块损坏仅限于行的子集，则另一个选项是通过选择除损坏行之外的所有数据来重建表。</p>
                  <p>管理数据块损坏的另一种方法是使用<code class="codeph">DBMS_REPAIR</code>包。您可以使用<code class="codeph">DBMS_REPAIR</code>来检测和修复表和索引中的损坏块。在尝试重建或修复对象时，可以继续使用对象。
                  </p>
                  <p>您还可以使用Recovery Manager（RMAN）命令<code class="codeph">RECOVER BLOCK</code>来恢复损坏的数据块或数据块集。
                  </p>
                  <div class="infoboxnote" id="GUID-ED44A53C-E1FC-4F29-BD7E-8866E8E864A7__GUID-3576261B-A248-41A5-BD92-558E53FF8D57">
                     <p class="notep1">注意：</p>
                     <p>任何涉及数据丢失的损坏都需要分析和理解数据如何适应整个数据库系统。根据修复的性质，您可能会丢失数据，并且可能会引入逻辑不一致。您必须确定此程序包提供的修复方法是否适用于每个特定的损坏问题。</p>
                  </div>
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-ED44A53C-E1FC-4F29-BD7E-8866E8E864A7__GUID-7697D7D2-C9CD-4865-AC6D-040B1980BE39">
                     <p class="notep1">也可以看看：</p>
                     <p>有关<code class="codeph">RECOVER BLOCK</code> RMAN命令的更多信息，请<a href="../rcmrf/RECOVER.html#RCMRF140" target="_blank"><span class="italic">参见Oracle数据库备份和恢复参考</span></a></p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-21282FF3-1E98-478E-8111-0A7CAFCFCD97" title="您可以检测并纠正数据块损坏。">修复损坏的数据</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADMIN11812"></a><div class="props_rev_3"><a id="GUID-2D36AA2A-8EF9-411B-84CE-EE30FBDDCE0D" name="GUID-2D36AA2A-8EF9-411B-84CE-EE30FBDDCE0D"></a><h3 id="ADMIN-GUID-2D36AA2A-8EF9-411B-84CE-EE30FBDDCE0D" class="sect3"><span class="enumeration_section">25.2</span>关于DBMS_REPAIR包</h3>
               <div>
                  <p><code class="codeph">DBMS_REPAIR</code>程序包包含数据损坏修复过程，使您可以检测和修复表和索引中的损坏块。
                  </p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-93573D41-C68C-4629-B114-6EB339C9958A">DBMS_REPAIR程序</a><br><code class="codeph">DBMS_REPAIR</code>程序包中的过程使您能够检测和修复损坏的块。
                     </li>
                     <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-6A1D3BA4-7D79-4DF4-9F44-9D6776114332">DBMS_REPAIR程序的限制和限制</a><br>某些限制和限制适用于<code class="codeph">DBMS_REPAIR</code>过程。
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-2D36AA2A-8EF9-411B-84CE-EE30FBDDCE0D__GUID-91FADA30-8AF4-4BFA-8C3C-44052BB886E1">
                     <p class="notep1">也可以看看：</p>
                     <p>有关<code class="codeph">DBMS_REPAIR</code>过程的语法，限制和例外的更多信息，请<a href="../arpls/DBMS_REPAIR.html#ARPLS044" target="_blank"><span class="italic">参见Oracle Database PL / SQL包和类型参考</span></a></p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-21282FF3-1E98-478E-8111-0A7CAFCFCD97" title="您可以检测并纠正数据块损坏。">修复损坏的数据</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADMIN11813"></a><div class="props_rev_3"><a id="GUID-93573D41-C68C-4629-B114-6EB339C9958A" name="GUID-93573D41-C68C-4629-B114-6EB339C9958A"></a><h4 id="ADMIN-GUID-93573D41-C68C-4629-B114-6EB339C9958A" class="sect4"><span class="enumeration_section">25.2.1</span> DBMS_REPAIR程序</h4>
                  <div>
                     <p><code class="codeph">DBMS_REPAIR</code>程序包中的过程使您能够检测和修复损坏的块。
                     </p>
                     <div class="section">
                        <p>下表列出了<code class="codeph">DBMS_REPAIR</code>包中包含的过程。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="tblformal" id="GUID-93573D41-C68C-4629-B114-6EB339C9958A__GUID-0BAF6513-A064-4EB5-A229-1F3DBD023D55">
                        <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="Column 1 lists the procedure names for DBMS_REPAIR, column 2 describes each procedure." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="32%" id="d237428e299">程序名称</th>
                                 <th align="left" valign="bottom" width="68%" id="d237428e302">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="32%" id="d237428e307" headers="d237428e299 ">
                                    <p><code class="codeph">ADMIN_TABLES</code></p>
                                 </td>
                                 <td align="left" valign="top" width="68%" headers="d237428e307 d237428e302 ">
                                    <p>为修复或孤立密钥表提供管理功能（创建，删除，清除）。</p>
                                    <p><span class="bold">注意：</span>这些表始终在<code class="codeph">SYS</code>模式中创建。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="32%" id="d237428e322" headers="d237428e299 ">
                                    <p><code class="codeph">CHECK_OBJECT</code></p>
                                 </td>
                                 <td align="left" valign="top" width="68%" headers="d237428e322 d237428e302 ">
                                    <p>检测并报告表或索引中的损坏</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="32%" id="d237428e330" headers="d237428e299 ">
                                    <p><code class="codeph">DUMP_ORPHAN_KEYS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="68%" headers="d237428e330 d237428e302 ">
                                    <p>报告指向损坏数据块中的行的索引条目</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="32%" id="d237428e338" headers="d237428e299 ">
                                    <p><code class="codeph">FIX_CORRUPT_BLOCKS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="68%" headers="d237428e338 d237428e302 ">
                                    <p>将块标记为先前已被<code class="codeph">CHECK_OBJECT</code>过程识别为已损坏的软件损坏</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="32%" id="d237428e349" headers="d237428e299 ">
                                    <p><code class="codeph">REBUILD_FREELISTS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="68%" headers="d237428e349 d237428e302 ">
                                    <p>重建对象的空闲列表</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="32%" id="d237428e357" headers="d237428e299 ">
                                    <p><code class="codeph">SEGMENT_FIX_STATUS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="68%" headers="d237428e357 d237428e302 ">
                                    <p>当段空间管理为<code class="codeph">AUTO</code>时，提供修复位图条目的损坏状态的功能</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="32%" id="d237428e367" headers="d237428e299 ">
                                    <p><code class="codeph">SKIP_CORRUPT_BLOCKS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="68%" headers="d237428e367 d237428e302 ">
                                    <p>使用时，忽略表和索引扫描期间标记为损坏的块。如果未使用，遇到标记为损坏的块时会出现错误<code class="codeph">ORA-01578</code> 。
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="section">
                        <p>在<span class="q">“ <a href="repairing-corrupted-data.html#GUID-EA2EA177-80ED-420B-B16E-2936014AC68C" title="Examples illustrate how to use the DBMS_REPAIR package.">DBMS_REPAIR实施例</a> ”</span>中进一步描述了这些程序及其使用的<span class="q"><a href="repairing-corrupted-data.html#GUID-EA2EA177-80ED-420B-B16E-2936014AC68C" title="示例说明了如何使用DBMS_REPAIR包。">实例</a></span> 。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-2D36AA2A-8EF9-411B-84CE-EE30FBDDCE0D" title="DBMS_REPAIR程序包包含数据损坏修复过程，使您可以检测和修复表和索引中的损坏块。">关于DBMS_REPAIR包</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN11814"></a><div class="props_rev_3"><a id="GUID-6A1D3BA4-7D79-4DF4-9F44-9D6776114332" name="GUID-6A1D3BA4-7D79-4DF4-9F44-9D6776114332"></a><h4 id="ADMIN-GUID-6A1D3BA4-7D79-4DF4-9F44-9D6776114332" class="sect4"><span class="enumeration_section">25.2.2</span> DBMS_REPAIR程序的限制和限制</h4>
                  <div>
                     <p>某些限制和限制适用于<code class="codeph">DBMS_REPAIR</code>过程。
                     </p>
                     <p><code class="codeph">DBMS_REPAIR</code>过程具有以下限制：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>支持具有LOB数据类型，嵌套表和变量的表，但忽略了外部列。</p>
                        </li>
                        <li>
                           <p>集群是在支持<code class="codeph">SKIP_CORRUPT_BLOCKS</code>和<code class="codeph">REBUILD_FREELISTS</code>程序，而不是在<code class="codeph">CHECK_OBJECT</code>程序。
                           </p>
                        </li>
                        <li>
                           <p>不支持索引组织表和LOB索引。</p>
                        </li>
                        <li>
                           <p>不支持全局临时表。</p>
                        </li>
                        <li>
                           <p><code class="codeph">DUMP_ORPHAN_KEYS</code>过程不对位图索引或基于函数的索引进行操作。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">DUMP_ORPHAN_KEYS</code>过程处理长度不超过3,950字节的键。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-2D36AA2A-8EF9-411B-84CE-EE30FBDDCE0D" title="DBMS_REPAIR程序包包含数据损坏修复过程，使您可以检测和修复表和索引中的损坏块。">关于DBMS_REPAIR包</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="ADMIN11815"></a><div class="props_rev_3"><a id="GUID-DF695FE6-E166-48E8-95E9-B8763A322F6F" name="GUID-DF695FE6-E166-48E8-95E9-B8763A322F6F"></a><h3 id="ADMIN-GUID-DF695FE6-E166-48E8-95E9-B8763A322F6F" class="sect3"><span class="enumeration_section">25.3</span>使用DBMS_REPAIR包</h3>
               <p>您可以使用<code class="codeph">DBMS_REPAIR</code>包来解决数据块损坏：</p>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-BC0FA7E8-3854-4836-890B-3129A056B852">任务1：检测并报告损坏</a><br>第一项任务是检测和报告腐败。报告不仅指示块的错误，还标识相关的修复指令。
                     </li>
                     <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-B0FDE4AE-0788-4F47-8A56-B31EE47714AA">任务2：评估使用DBMS_REPAIR的成本和收益</a><br>在使用<code class="codeph">DBMS_REPAIR</code>之前，您必须权衡其使用与负债相关的好处。您还应该检查可用于解决损坏对象的其他选项。
                     </li>
                     <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-39EC82E7-F68C-4473-87C0-28CA7964198C">任务3：使对象可用</a><br><code class="codeph">DBMS_REPAIR</code>通过在表和索引扫描期间忽略损坏<code class="codeph">DBMS_REPAIR</code>使对象可用。
                     </li>
                     <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-FAC917B1-075C-4B37-88AC-98F029AAD31E">任务4：修复损坏并重建丢失的数据</a><br>使对象可用后，执行以下修复活动。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-21282FF3-1E98-478E-8111-0A7CAFCFCD97" title="您可以检测并纠正数据块损坏。">修复损坏的数据</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-BC0FA7E8-3854-4836-890B-3129A056B852" name="GUID-BC0FA7E8-3854-4836-890B-3129A056B852"></a><h4 id="ADMIN-GUID-BC0FA7E8-3854-4836-890B-3129A056B852" class="sect4"><span class="enumeration_section">25.3.1</span>任务1：检测并报告损坏</h4>
                  <p>第一项任务是检测和报告腐败。报告不仅指示块的错误，还标识相关的修复指令。</p>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-8AF3CD34-631E-4381-B504-6907AD2B8025">关于检测和报告损坏</a><br>有几种方法可以检测损坏。
                        </li>
                        <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-0835FF41-E6FC-40BF-AFEE-F0859C67E5F2">DBMS_REPAIR：使用CHECK_OBJECT和ADMIN_TABLES过程</a><br><code class="codeph">CHECK_OBJECT</code>过程检查并报告指定对象的块损坏。<code class="codeph">ADMIN_TABLES</code>过程创建一个有助于纠正损坏的修复表。
                        </li>
                        <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-89B61F97-D01F-4E0C-8230-A5489EDA9EAF">DB_VERIFY：执行脱机数据库检查</a><br>遇到数据损坏时，请使用<code class="codeph">DB_VERIFY</code>作为脱机诊断实用程序。
                        </li>
                        <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-17473BCF-88CF-49A8-866D-F4B3BDDD2961">分析：报告腐败</a><br><code class="codeph">ANALYZE TABLE...VALIDATE STRUCTURE</code>语句验证分析对象的结构。如果数据库遇到对象结构中的损坏，则返回错误消息。在这种情况下，删除并重新创建对象。
                        </li>
                        <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-71280400-C7BB-42B9-9272-4F1242B0BD28">DB_BLOCK_CHECKING初始化参数</a><br>您可以通过将<code class="codeph">DB_BLOCK_CHECKING</code>初始化参数设置为<code class="codeph">TRUE</code>来启用数据库块检查。</li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-DF695FE6-E166-48E8-95E9-B8763A322F6F" title="您可以使用DBMS_REPAIR包来解决数据块损坏：">使用DBMS_REPAIR包</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="ADMIN13070"></a><a id="ADMIN11816"></a><div class="props_rev_3"><a id="GUID-8AF3CD34-631E-4381-B504-6907AD2B8025" name="GUID-8AF3CD34-631E-4381-B504-6907AD2B8025"></a><h5 id="ADMIN-GUID-8AF3CD34-631E-4381-B504-6907AD2B8025" class="sect5"><span class="enumeration_section">25.3.1.1</span>关于检测和报告损坏</h5>
                     <div>
                        <p>有几种方法可以检测损坏。</p>
                        <p><a href="repairing-corrupted-data.html#GUID-8AF3CD34-631E-4381-B504-6907AD2B8025__g1006999" title="第1列列出了检测损坏的方法，第2列描述了该方法。">表25-1</a>描述了不同的检测方法。
                        </p>
                        <div class="tblformal" id="GUID-8AF3CD34-631E-4381-B504-6907AD2B8025__g1006999">
                           <p class="titleintable">表25-1腐败检测方法的比较</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="腐败检测方法的比较" width="100%" border="1" summary="Column 1 lists the method of detecting corruption, column 2 describes the method." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="36%" id="d237428e704">检测方法</th>
                                    <th align="left" valign="bottom" width="64%" id="d237428e707">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="36%" id="d237428e712" headers="d237428e704 ">
                                       <p><code class="codeph">DBMS_REPAIR</code> PL / SQL包</p>
                                    </td>
                                    <td align="left" valign="top" width="64%" headers="d237428e712 d237428e707 ">
                                       <p>对指定的表，分区或索引执行块检查。它使用结果填充修复表。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="36%" id="d237428e721" headers="d237428e704 ">
                                       <p><code class="codeph">DB_VERIFY</code>实用程序</p>
                                    </td>
                                    <td align="left" valign="top" width="64%" headers="d237428e721 d237428e707 ">
                                       <p>对脱机数据库执行块检查</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="36%" id="d237428e730" headers="d237428e704 ">
                                       <p><code class="codeph">ANALYZE TABLE</code> SQL语句</p>
                                    </td>
                                    <td align="left" valign="top" width="64%" headers="d237428e730 d237428e707 ">
                                       <p>与<code class="codeph">VALIDATE STRUCTURE</code>选项一起使用时， <code class="codeph">ANALYZE</code> <code class="codeph">TABLE</code>语句将验证索引，表或集群结构的完整性。检查或验证表和索引是否已同步。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="36%" id="d237428e747" headers="d237428e704 ">
                                       <p><code class="codeph">DB_BLOCK_CHECKING</code>初始化参数</p>
                                    </td>
                                    <td align="left" valign="top" width="64%" headers="d237428e747 d237428e707 ">
                                       <p>当<code class="codeph">DB_BLOCK_CHECKING=TRUE</code> ，在标记为损坏之前识别损坏的块。对块进行更改时执行检查。
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-BC0FA7E8-3854-4836-890B-3129A056B852" title="第一项任务是检测和报告腐败。报告不仅指示块的错误，还标识相关的修复指令。">任务1：检测并报告损坏</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN11817"></a><div class="props_rev_3"><a id="GUID-0835FF41-E6FC-40BF-AFEE-F0859C67E5F2" name="GUID-0835FF41-E6FC-40BF-AFEE-F0859C67E5F2"></a><h5 id="ADMIN-GUID-0835FF41-E6FC-40BF-AFEE-F0859C67E5F2" class="sect5"><span class="enumeration_section">25.3.1.2</span> DBMS_REPAIR：使用CHECK_OBJECT和ADMIN_TABLES过程</h5>
                     <div>
                        <p><code class="codeph">CHECK_OBJECT</code>过程检查并报告指定对象的块损坏。<code class="codeph">ADMIN_TABLES</code>过程创建一个有助于纠正损坏的修复表。
                        </p>
                        <div class="section">
                           <p><code class="codeph">CHECK_OBJECT</code>过程类似于<code class="codeph">ANALYZE...索引和表的VALIDATE STRUCTURE</code>语句，对索引和数据块执行块检查。
                           </p>
                           <p><code class="codeph">CHECK_OBJECT</code>不仅报告了损坏，而且还标识了随后在对象上运行<code class="codeph">FIX_CORRUPT_BLOCKS</code>可能发生的任何修复。填充修复表可以获得此信息，该表必须首先由<code class="codeph">ADMIN_TABLES</code>过程创建。
                           </p>
                           <p>运行<code class="codeph">CHECK_OBJECT</code>过程后，修复表上的简单查询将显示该对象的损坏和修复指令。有了这些信息，您可以评估如何最好地解决报告的问题。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-BC0FA7E8-3854-4836-890B-3129A056B852" title="第一项任务是检测和报告腐败。报告不仅指示块的错误，还标识相关的修复指令。">任务1：检测并报告损坏</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN11818"></a><div class="props_rev_3"><a id="GUID-89B61F97-D01F-4E0C-8230-A5489EDA9EAF" name="GUID-89B61F97-D01F-4E0C-8230-A5489EDA9EAF"></a><h5 id="ADMIN-GUID-89B61F97-D01F-4E0C-8230-A5489EDA9EAF" class="sect5"><span class="enumeration_section">25.3.1.3</span> DB_VERIFY：执行脱机数据库检查</h5>
                     <div>
                        <p>遇到数据损坏时，请使用<code class="codeph">DB_VERIFY</code>作为脱机诊断实用程序。
                        </p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-89B61F97-D01F-4E0C-8230-A5489EDA9EAF__GUID-68DD5E6D-4E6B-43FA-8FC1-BF93639BD1F1">
                           <p class="notep1">也可以看看：</p>
                           <p>有关<code class="codeph">DB_VERIFY</code>详细信息，请<code class="codeph">DB_VERIFY</code> <a href="../sutil/oracle-dbverify-utility.html#SUTIL013" target="_blank"><span class="italic">Oracle数据库实用程序</span></a></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-BC0FA7E8-3854-4836-890B-3129A056B852" title="第一项任务是检测和报告腐败。报告不仅指示块的错误，还标识相关的修复指令。">任务1：检测并报告损坏</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN11819"></a><div class="props_rev_3"><a id="GUID-17473BCF-88CF-49A8-866D-F4B3BDDD2961" name="GUID-17473BCF-88CF-49A8-866D-F4B3BDDD2961"></a><h5 id="ADMIN-GUID-17473BCF-88CF-49A8-866D-F4B3BDDD2961" class="sect5"><span class="enumeration_section">25.3.1.4</span>分析：报告腐败</h5>
                     <div>
                        <p><code class="codeph">ANALYZE TABLE...VALIDATE STRUCTURE</code>语句验证分析对象的结构。如果数据库遇到对象结构中的损坏，则返回错误消息。在这种情况下，删除并重新创建对象。
                        </p>
                        <p>您可以使用<code class="codeph">ANALYZE TABLE</code>语句的<code class="codeph">CASCADE</code>子句在一次操作中检查表及其所有索引的结构。由于此操作可能会消耗大量资源，因此有一个执行轻量级检查的FAST选项。有关详细信息<span class="q"><a href="managing-schema-objects.html#GUID-4D413507-A992-44B0-8366-867B78E0B6FF" title="To verify the integrity of the structure of a table, index, cluster, or materialized view, use the ANALYZE statement with the VALIDATE STRUCTURE option.">，</a></span>请参阅<span class="q">“ <a href="managing-schema-objects.html#GUID-4D413507-A992-44B0-8366-867B78E0B6FF" title="要验证表，索引，集群或物化视图的结构的完整性，请使用带有VALIDATE STRUCTURE选项的ANALYZE语句。">验证表，索引，群集和物化视图</a> ”</span> 。
                        </p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-17473BCF-88CF-49A8-866D-F4B3BDDD2961__GUID-A4788793-40D4-446F-A15A-494C7E32FE7C">
                           <p class="notep1">也可以看看：</p>
                           <p></p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">ANALYZE</code>语句的更多信息，请<a href="../sqlrf/ANALYZE.html#SQLRF01105" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-BC0FA7E8-3854-4836-890B-3129A056B852" title="第一项任务是检测和报告腐败。报告不仅指示块的错误，还标识相关的修复指令。">任务1：检测并报告损坏</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN11820"></a><div class="props_rev_3"><a id="GUID-71280400-C7BB-42B9-9272-4F1242B0BD28" name="GUID-71280400-C7BB-42B9-9272-4F1242B0BD28"></a><h5 id="ADMIN-GUID-71280400-C7BB-42B9-9272-4F1242B0BD28" class="sect5"><span class="enumeration_section">25.3.1.5</span> DB_BLOCK_CHECKING初始化参数</h5>
                     <div>
                        <p>您可以通过将<code class="codeph">DB_BLOCK_CHECKING</code>初始化参数设置为<code class="codeph">TRUE</code>来启用数据库块检查。</p>
                        <p>这会在修改数据和索引块时检查内部一致性。<code class="codeph">DB_BLOCK_CHECKING</code>是一个动态参数，可由<code class="codeph">ALTER SYSTEM SET</code>语句修改。始终为系统表空间启用块检查。
                        </p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-71280400-C7BB-42B9-9272-4F1242B0BD28__GUID-2DF2D40B-3BBB-46A7-B92D-F11E24112283">
                           <p class="notep1">也可以看看：</p>
                           <p>有关<code class="codeph">DB_BLOCK_CHECKING</code>初始化参数的详细信息，请<a href="../refrn/DB_BLOCK_CHECKING.html#REFRN10029" target="_blank"><span class="italic">参见Oracle数据库参考</span></a></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-BC0FA7E8-3854-4836-890B-3129A056B852" title="第一项任务是检测和报告腐败。报告不仅指示块的错误，还标识相关的修复指令。">任务1：检测并报告损坏</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="ADMIN11821"></a><div class="props_rev_3"><a id="GUID-B0FDE4AE-0788-4F47-8A56-B31EE47714AA" name="GUID-B0FDE4AE-0788-4F47-8A56-B31EE47714AA"></a><h4 id="ADMIN-GUID-B0FDE4AE-0788-4F47-8A56-B31EE47714AA" class="sect4"><span class="enumeration_section">25.3.2</span>任务2：评估使用DBMS_REPAIR的成本和收益</h4>
                  <div>
                     <p>在使用<code class="codeph">DBMS_REPAIR</code>之前，您必须权衡其使用与负债相关的好处。您还应该检查可用于解决损坏对象的其他选项。
                     </p>
                     <p>首先回答以下问题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>腐败程度如何？</p>
                           <p>要确定是否存在损坏和修复操作，请执行<code class="codeph">CHECK_OBJECT</code>过程并查询修复表。
                           </p>
                        </li>
                        <li>
                           <p>还有哪些其他选项可用于解决块损坏？考虑以下：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>如果数据可从其他源获得，则删除，重新创建和重新填充对象。</p>
                              </li>
                              <li>
                                 <p>发出<code class="codeph">CREATE TABLE...来自corrupt表的AS SELECT</code>语句创建一个新的。
                                 </p>
                              </li>
                              <li>
                                 <p>通过从<code class="codeph">SELECT</code>语句中排除损坏的行来忽略损坏。
                                 </p>
                              </li>
                              <li>
                                 <p>执行媒体恢复。</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>使用<code class="codeph">DBMS_REPAIR</code>使对象可用时会引入哪些逻辑损坏或副作用？可以解决这些问题吗？这样做需要付出多少努力？
                           </p>
                           <p>您可能无法访问标记为损坏的块中的行。但是，即使存在可以有效访问的行，也可以将块标记为损坏。</p>
                           <p>当块被标记为损坏时，参照完整性约束也可能被破坏。如果发生这种情况，则禁用并重新启用约束;报告任何不一致。解决所有问题后，您应该能够重新启用约束。</p>
                           <p>当表上定义了触发器时，可能会发生逻辑损坏。例如，如果重新插入行，是否应该触发插入触发器？只有了解了触发器及其在安装中的用法，才能解决这些问题。</p>
                           <p>如果索引和表未同步，则执行<code class="codeph">DUMP_ORPHAN_KEYS</code>过程以从密钥中获取可能对重建损坏数据有用的信息。然后发出<code class="codeph">ALTER INDEX...REBUILD ONLINE</code>语句，用于将表与其索引同步。
                           </p>
                        </li>
                        <li>
                           <p>如果修复涉及数据丢失，是否可以检索此数据？</p>
                           <p>当数据块标记为损坏时，您可以从索引中检索数据。<code class="codeph">DUMP_ORPHAN_KEYS</code>过程可以帮助您检索此信息。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-DF695FE6-E166-48E8-95E9-B8763A322F6F" title="您可以使用DBMS_REPAIR包来解决数据块损坏：">使用DBMS_REPAIR包</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN11822"></a><div class="props_rev_3"><a id="GUID-39EC82E7-F68C-4473-87C0-28CA7964198C" name="GUID-39EC82E7-F68C-4473-87C0-28CA7964198C"></a><h4 id="ADMIN-GUID-39EC82E7-F68C-4473-87C0-28CA7964198C" class="sect4"><span class="enumeration_section">25.3.3</span>任务3：使对象可用</h4>
                  <p><code class="codeph">DBMS_REPAIR</code>通过在表和索引扫描期间忽略损坏<code class="codeph">DBMS_REPAIR</code>使对象可用。
                  </p>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-C0C44C70-A1AC-4D85-8AC6-45228B5ABD41">腐败修复：使用FIX_CORRUPT_BLOCKS和SKIP_CORRUPT_BLOCKS程序</a><br>您可以通过建立一个跳过超出<code class="codeph">DBMS_REPAIR</code>功能范围的损坏的环境来使腐败对象可用。
                        </li>
                        <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-6064D37C-78AA-42C7-84F4-7B23FA111A87">跳过损坏的块时的含义</a><br>在跳过损坏的块时，查询可以在某些情况下返回不同的结果。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-DF695FE6-E166-48E8-95E9-B8763A322F6F" title="您可以使用DBMS_REPAIR包来解决数据块损坏：">使用DBMS_REPAIR包</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="ADMIN11823"></a><div class="props_rev_3"><a id="GUID-C0C44C70-A1AC-4D85-8AC6-45228B5ABD41" name="GUID-C0C44C70-A1AC-4D85-8AC6-45228B5ABD41"></a><h5 id="ADMIN-GUID-C0C44C70-A1AC-4D85-8AC6-45228B5ABD41" class="sect5"><span class="enumeration_section">25.3.3.1</span>损坏修复：使用FIX_CORRUPT_BLOCKS和SKIP_CORRUPT_BLOCKS程序</h5>
                     <div>
                        <p>您可以通过建立一个跳过超出<code class="codeph">DBMS_REPAIR</code>功能范围的损坏的环境来使腐败对象可用。
                        </p>
                        <div class="section">
                           <p>如果损坏涉及数据丢失，例如数据块中的错误行，则所有这些块都被<code class="codeph">FIX_CORRUPT_BLOCKS</code>过程标记为损坏。然后，您可以运行<code class="codeph">SKIP_CORRUPT_BLOCKS</code>过程，该过程会跳过标记为已损坏的块。设置过程中的<code class="codeph">SKIP_FLAG</code>参数时，表和索引扫描会跳过标记为已损坏的所有块。这适用于媒体和软件损坏的块。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-39EC82E7-F68C-4473-87C0-28CA7964198C" title="DBMS_REPAIR通过在表和索引扫描期间忽略损坏来使对象可用。">任务3：使对象可用</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN11824"></a><div class="props_rev_3"><a id="GUID-6064D37C-78AA-42C7-84F4-7B23FA111A87" name="GUID-6064D37C-78AA-42C7-84F4-7B23FA111A87"></a><h5 id="ADMIN-GUID-6064D37C-78AA-42C7-84F4-7B23FA111A87" class="sect5"><span class="enumeration_section">25.3.3.2</span>跳过损坏块时的含义</h5>
                     <div>
                        <p>在跳过损坏的块时，查询可以在某些情况下返回不同的结果。</p>
                        <p>如果索引和表未同步，则在一个查询仅探测索引并且后续查询同时探测索引和表的情况下， <code class="codeph">SET TRANSACTION READ ONLY</code>事务可能不一致。如果表块被标记为损坏，则两个查询返回不同的结果，从而破坏了只读事务的规则。解决此问题的一种方法是不要跳过<code class="codeph">SET TRANSACTION READ ONLY</code>事务中的损坏。
                        </p>
                        <p>选择链接的行时会出现类似的问题。对同一行的查询可能会也可能不会访问损坏，从而产生不同的结果。</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-39EC82E7-F68C-4473-87C0-28CA7964198C" title="DBMS_REPAIR通过在表和索引扫描期间忽略损坏来使对象可用。">任务3：使对象可用</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="ADMIN11825"></a><div class="props_rev_3"><a id="GUID-FAC917B1-075C-4B37-88AC-98F029AAD31E" name="GUID-FAC917B1-075C-4B37-88AC-98F029AAD31E"></a><h4 id="ADMIN-GUID-FAC917B1-075C-4B37-88AC-98F029AAD31E" class="sect4"><span class="enumeration_section">25.3.4</span>任务4：修复损坏并重建丢失的数据</h4>
                  <p>使对象可用后，执行以下修复活动。</p>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-7D65AB6B-8B04-47EA-AAF2-19CFD2CB487C">使用DUMP_ORPHAN_KEYS过程恢复数据</a><br><code class="codeph">DUMP_ORPHAN_KEYS</code>过程报告指向损坏数据块中的行的索引条目。所有这些索引条目都插入到孤立密钥表中，该表存储损坏的密钥和rowid。
                        </li>
                        <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-DD4A62AB-0C2B-4B0C-8FD1-7BE4217298AE">使用SEGMENT_FIX_STATUS过程修复段位图</a><br>如果使用位图管理段中的可用空间（ <code class="codeph">SEGMENT SPACE MANAGEMENT AUTO</code> ），请使用<code class="codeph">SEGMENT_FIX_STATUS</code>过程。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-DF695FE6-E166-48E8-95E9-B8763A322F6F" title="您可以使用DBMS_REPAIR包来解决数据块损坏：">使用DBMS_REPAIR包</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="ADMIN11826"></a><div class="props_rev_3"><a id="GUID-7D65AB6B-8B04-47EA-AAF2-19CFD2CB487C" name="GUID-7D65AB6B-8B04-47EA-AAF2-19CFD2CB487C"></a><h5 id="ADMIN-GUID-7D65AB6B-8B04-47EA-AAF2-19CFD2CB487C" class="sect5"><span class="enumeration_section">25.3.4.1</span>使用DUMP_ORPHAN_KEYS过程恢复数据</h5>
                     <div>
                        <p><code class="codeph">DUMP_ORPHAN_KEYS</code>过程报告指向损坏数据块中的行的索引条目。所有这些索引条目都插入到孤立密钥表中，该表存储损坏的密钥和rowid。
                        </p>
                        <div class="section">
                           <p>检索索引条目信息后，您可以使用<code class="codeph">ALTER INDEX...重建<code class="codeph">ALTER INDEX...REBUILD ONLINE</code>声明。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-FAC917B1-075C-4B37-88AC-98F029AAD31E" title="使对象可用后，执行以下修复活动。">任务4：修复损坏并重建丢失的数据</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN11827"></a><div class="props_rev_3"><a id="GUID-DD4A62AB-0C2B-4B0C-8FD1-7BE4217298AE" name="GUID-DD4A62AB-0C2B-4B0C-8FD1-7BE4217298AE"></a><h5 id="ADMIN-GUID-DD4A62AB-0C2B-4B0C-8FD1-7BE4217298AE" class="sect5"><span class="enumeration_section">25.3.4.2</span>使用SEGMENT_FIX_STATUS过程修复<span class="enumeration_section">段位</span>图</h5>
                     <div>
                        <p>如果使用位图管理段中的可用空间（ <code class="codeph">SEGMENT SPACE MANAGEMENT AUTO</code> ），请使用<code class="codeph">SEGMENT_FIX_STATUS</code>过程。
                        </p>
                        <div class="section">
                           <p></p>
                           <p>此过程基于相应块的当前内容重新计算位图条目的状态。或者，您可以指定将位图条目设置为特定值。通常正确地重新计算状态，并且不需要强制设置。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-FAC917B1-075C-4B37-88AC-98F029AAD31E" title="使对象可用后，执行以下修复活动。">任务4：修复损坏并重建丢失的数据</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div><a id="ADMIN11828"></a><div class="props_rev_3"><a id="GUID-EA2EA177-80ED-420B-B16E-2936014AC68C" name="GUID-EA2EA177-80ED-420B-B16E-2936014AC68C"></a><h3 id="ADMIN-GUID-EA2EA177-80ED-420B-B16E-2936014AC68C" class="sect3"><span class="enumeration_section">25.4</span> DBMS_REPAIR示例</h3>
               <p>示例说明了如何使用<code class="codeph">DBMS_REPAIR</code>包。
               </p>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-962BDF34-70E9-4373-B580-9D67CB33360E">示例：构建修复表或孤立密钥表</a><br>修复表提供有关损坏的信息。孤立密钥表提供有关指向损坏行的索引条目的信息。
                     </li>
                     <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-F47ABE72-03FE-4C63-8092-BAAEC47F9C4B">示例：检测腐败</a><br>一个示例说明了使用<code class="codeph">CHECK_OBJECT</code>过程检测损坏。
                     </li>
                     <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-4CD87B1A-BDCD-4EEA-A231-BBCDE99EB33E">示例：修复损坏的块</a><br>一个示例说明使用<code class="codeph">FIX_CORRUPT_BLOCKS</code>过程修复损坏的块。
                     </li>
                     <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-1655A1A1-5A4F-450E-9AFB-6186B59B4A5E">示例：查找指向损坏数据块的索引条目</a><br>示例说明了使用<code class="codeph">DUMP_ORPHAN_KEYS</code>过程查找指向损坏数据块的索引条目。
                     </li>
                     <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-C80FB286-14FE-42D0-B58B-52FB939ED185">示例：跳过损坏的块</a><br>示例说明了使用<code class="codeph">SKIP_CORRUPT_BLOCKS</code>过程跳过损坏的块。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-21282FF3-1E98-478E-8111-0A7CAFCFCD97" title="您可以检测并纠正数据块损坏。">修复损坏的数据</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-962BDF34-70E9-4373-B580-9D67CB33360E" name="GUID-962BDF34-70E9-4373-B580-9D67CB33360E"></a><h4 id="ADMIN-GUID-962BDF34-70E9-4373-B580-9D67CB33360E" class="sect4"><span class="enumeration_section">25.4.1</span>示例：构建修复表或孤立密钥表</h4>
                  <p>修复表提供有关损坏的信息。孤立密钥表提供有关指向损坏行的索引条目的信息。</p>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-11E28B2E-0D3A-448F-A6D2-10F8B4E886DD">关于修复表或孤立密钥表</a><br><code class="codeph">ADMIN_TABLES</code>过程用于创建，清除或删除修复表或孤立密钥表。
                        </li>
                        <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-32A01FD3-5C2A-43E6-B664-C10D2697F726">示例：创建修复表</a><br>示例说明如何使用<code class="codeph">ADMIN_TABLES</code>过程创建修复表。
                        </li>
                        <li class="ulchildlink"><a href="repairing-corrupted-data.html#GUID-3725DEDD-EBF0-4D56-87DF-39FFB494587D">示例：创建孤立密钥表</a><br>示例说明了使用<code class="codeph">ADMIN_TABLES</code>过程创建孤立密钥表。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-EA2EA177-80ED-420B-B16E-2936014AC68C" title="示例说明了如何使用DBMS_REPAIR包。">DBMS_REPAIR示例</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="ADMIN11829"></a><div class="props_rev_3"><a id="GUID-11E28B2E-0D3A-448F-A6D2-10F8B4E886DD" name="GUID-11E28B2E-0D3A-448F-A6D2-10F8B4E886DD"></a><h5 id="ADMIN-GUID-11E28B2E-0D3A-448F-A6D2-10F8B4E886DD" class="sect5"><span class="enumeration_section">25.4.1.1</span>关于修复表或孤立密钥表</h5>
                     <div>
                        <p><code class="codeph">ADMIN_TABLES</code>过程用于创建，清除或删除修复表或孤立密钥表。
                        </p>
                        <p>修复表提供有关<code class="codeph">CHECK_OBJECT</code>过程发现的损坏的信息，以及如果运行<code class="codeph">FIX_CORRUPT_BLOCKS</code>过程将如何处理这些<code class="codeph">FIX_CORRUPT_BLOCKS</code> 。此外，它用于驱动<code class="codeph">FIX_CORRUPT_BLOCKS</code>过程的执行。
                        </p>
                        <p>执行<code class="codeph">DUMP_ORPHAN_KEYS</code>过程时使用孤立密钥表，它会发现指向损坏行的索引条目。<code class="codeph">DUMP_ORPHAN_KEYS</code>过程通过记录其活动并以可用的方式提供索引信息来填充孤立密钥表。
                        </p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-962BDF34-70E9-4373-B580-9D67CB33360E" title="修复表提供有关损坏的信息。孤立密钥表提供有关指向损坏行的索引条目的信息。">示例：构建修复表或孤立密钥表</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN11830"></a><div class="props_rev_3"><a id="GUID-32A01FD3-5C2A-43E6-B664-C10D2697F726" name="GUID-32A01FD3-5C2A-43E6-B664-C10D2697F726"></a><h5 id="ADMIN-GUID-32A01FD3-5C2A-43E6-B664-C10D2697F726" class="sect5"><span class="enumeration_section">25.4.1.2</span>示例：创建修复表</h5>
                     <div>
                        <p>示例说明如何使用<code class="codeph">ADMIN_TABLES</code>过程创建修复表。
                        </p>
                        <div class="section">
                           <p>以下示例为<code class="codeph">users</code>表空间创建修复表。
                           </p><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_REPAIR.ADMIN_TABLES（TABLE_NAME =&gt;'REPAIR_TABLE'，TABLE_TYPE =&gt; dbms_repair.repair_table，ACTION =&gt; dbms_repair.create_action，TABLESPACE =&gt;'USERS'）;结束; /</pre><p>对于每个修复或孤立密钥表，还会创建一个视图，以消除与不再存在的对象相关的任何行。视图的名称对应于修复或孤立密钥表的名称，并以<code class="codeph">DBA_</code>为前缀（例如， <code class="codeph">DBA_REPAIR_TABLE</code>或<code class="codeph">DBA_ORPHAN_KEY_TABLE</code> ）。
                           </p>
                           <p>以下查询描述了为<code class="codeph">users</code>表空间创建的修复表。
                           </p><pre class="oac_no_warn" dir="ltr">DESC REPAIR_TABLE名称是否为空？输入---------------------------- -------- ------------- -  OBJECT_ID NOT NULL NUMBER TABLESPACE_ID NOT NULL NUMBER RELATIVE_FILE_ID NOT NULL NUMBER BLOCK_ID NOT NULL NUMBER CORRUPT_TYPE NOT NULL NUMBER SCHEMA_NAME NOT NULL VARCHAR2（128）OBJECT_NAME NOT NULL VARCHAR2（128）BASEOBJECT_NAME VARCHAR2（128）PARTITION_NAME VARCHAR2（128）CORRUPT_DESCRIPTION VARCHAR2（2000） REPAIR_DESCRIPTION VARCHAR2（200）MARKED_CORRUPT NOT NULL VARCHAR2（10）CHECK_TIMESTAMP NOT NULL DATE FIX_TIMESTAMP DATE REFORMAT_TIMESTAMP DATE</pre></div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-962BDF34-70E9-4373-B580-9D67CB33360E" title="修复表提供有关损坏的信息。孤立密钥表提供有关指向损坏行的索引条目的信息。">示例：构建修复表或孤立密钥表</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN11831"></a><div class="props_rev_3"><a id="GUID-3725DEDD-EBF0-4D56-87DF-39FFB494587D" name="GUID-3725DEDD-EBF0-4D56-87DF-39FFB494587D"></a><h5 id="ADMIN-GUID-3725DEDD-EBF0-4D56-87DF-39FFB494587D" class="sect5"><span class="enumeration_section">25.4.1.3</span>示例：创建孤立密钥表</h5>
                     <div>
                        <p>示例说明了使用<code class="codeph">ADMIN_TABLES</code>过程创建孤立密钥表。
                        </p>
                        <div class="section">
                           <p>此示例说明了为<code class="codeph">users</code>表空间创建孤立密钥表。
                           </p><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_REPAIR.ADMIN_TABLES（TABLE_NAME =&gt;'ORPHAN_KEY_TABLE'，TABLE_TYPE =&gt; dbms_repair.orphan_table，ACTION =&gt; dbms_repair.create_action，TABLESPACE =&gt;'USERS'）;结束; /</pre><p>以下查询中描述了孤立密钥表：</p><pre class="oac_no_warn" dir="ltr">DESC ORPHAN_KEY_TABLE名称是否为空？输入---------------------------- -------- ------------- ---- SCHEMA_NAME NOT NULL VARCHAR2（128）INDEX_NAME NOT NULL VARCHAR2（128）IPART_NAME VARCHAR2（128）INDEX_ID NOT NULL NUMBER TABLE_NAME NOT NULL VARCHAR2（128）PART_NAME VARCHAR2（128）TABLE_ID NOT NULL NUMBER KEYROWID NOT NULL ROWID KEY NOT NULL ROWID DUMP_TIMESTAMP非空日期</pre></div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-962BDF34-70E9-4373-B580-9D67CB33360E" title="修复表提供有关损坏的信息。孤立密钥表提供有关指向损坏行的索引条目的信息。">示例：构建修复表或孤立密钥表</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="ADMIN11832"></a><div class="props_rev_3"><a id="GUID-F47ABE72-03FE-4C63-8092-BAAEC47F9C4B" name="GUID-F47ABE72-03FE-4C63-8092-BAAEC47F9C4B"></a><h4 id="ADMIN-GUID-F47ABE72-03FE-4C63-8092-BAAEC47F9C4B" class="sect4"><span class="enumeration_section">25.4.2</span>示例：检测腐败</h4>
                  <div>
                     <p>一个示例说明了使用<code class="codeph">CHECK_OBJECT</code>过程检测损坏。
                     </p>
                     <div class="section">
                        <p><code class="codeph">CHECK_OBJECT</code>过程检查指定的对象，并使用有关损坏和修复指令的信息填充修复表。如果要检查对象的一部分，可以选择指定范围，分区名称或子分区名称。
                        </p>
                        <p>验证包括检查对象中之前未被标记为已损坏的所有块。对于每个块，检查事务和数据层部分的自身一致性。在<code class="codeph">CHECK_OBJECT</code>期间，如果遇到具有损坏的缓冲区高速缓存标头的块，则跳过该块。
                        </p>
                        <p>以下是为<code class="codeph">scott.dept</code>表执行<code class="codeph">CHECK_OBJECT</code>过程的<code class="codeph">scott.dept</code> 。
                        </p><pre class="oac_no_warn" dir="ltr">SET SERVEROUTPUT ON DECLARE num_corrupt INT; BEGIN num_corrupt：= 0; DBMS_REPAIR.CHECK_OBJECT（SCHEMA_NAME =&gt;'SCOTT'，OBJECT_NAME =&gt;'DEPT'，REPAIR_TABLE_NAME =&gt;'REPAIR_TABLE'，CORRUPT_COUNT =&gt; num_corrupt）; DBMS_OUTPUT.PUT_LINE（'number corrupt：'|| TO_CHAR（num_corrupt））;结束; /</pre><p>SQL * Plus输出以下行，表示一个损坏：</p><pre class="oac_no_warn" dir="ltr">数字腐败：1</pre><p>查询修复表会生成描述损坏的信息并建议修复操作。</p><pre class="oac_no_warn" dir="ltr">SELECT OBJECT_NAME，BLOCK_ID，CORRUPT_TYPE，MARKED_CORRUPT，CORRUPT_DESCRIPTION，REPAIR_DESCRIPTION FROM REPAIR_TABLE; OBJECT_NAME BLOCK_ID CORRUPT_TYPE MARKED_COR ------------------------------ ---------- ------ ------ ---------- CORRUPT_DESCRIPTION --------------------------------- --------------------------------------------- REPAIR_DESCRIPTION ---- -------------------------------------------------- ------------------------ DEPT 3 1 FALSE kdbchk：由不存在的事务表锁定的行= 0 slot = 0 lockid = 32 ktbbhitc = 1 mark阻止软件腐败</pre><p>已损坏的块尚未标记为已损坏，因此这是提取任何有意义数据的时间。块被标记为损坏后，必须跳过整个块。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-EA2EA177-80ED-420B-B16E-2936014AC68C" title="示例说明了如何使用DBMS_REPAIR包。">DBMS_REPAIR示例</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN11833"></a><div class="props_rev_3"><a id="GUID-4CD87B1A-BDCD-4EEA-A231-BBCDE99EB33E" name="GUID-4CD87B1A-BDCD-4EEA-A231-BBCDE99EB33E"></a><h4 id="ADMIN-GUID-4CD87B1A-BDCD-4EEA-A231-BBCDE99EB33E" class="sect4"><span class="enumeration_section">25.4.3</span>示例：修复损坏的块</h4>
                  <div>
                     <p>一个示例说明使用<code class="codeph">FIX_CORRUPT_BLOCKS</code>过程修复损坏的块。
                     </p>
                     <div class="section">
                        <p>使用<code class="codeph">FIX_CORRUPT_BLOCKS</code>过程根据<code class="codeph">CHECK_OBJECT</code>过程生成的修复表中的信息修复指定对象中的损坏块。在更改块之前，将检查块以确保块仍然损坏。通过标记块软件损坏来修复损坏的块。执行修复时，修复表中的关联行将使用时间戳进行更新。
                        </p>
                        <p>此示例修复了<code class="codeph">CHECK_OBJECT</code>过程报告的表<code class="codeph">scott.dept</code>中的损坏块。
                        </p><pre class="oac_no_warn" dir="ltr">SET SERVEROUTPUT ON DECLARE num_fix INT; BEGIN num_fix：= 0; DBMS_REPAIR.FIX_CORRUPT_BLOCKS（SCHEMA_NAME =&gt;'SCOTT'，OBJECT_NAME =&gt;'DEPT'，OBJECT_TYPE =&gt; dbms_repair.table_object，REPAIR_TABLE_NAME =&gt;'REPAIR_TABLE'，FIX_COUNT =&gt; num_fix）; DBMS_OUTPUT.PUT_LINE（'num fix：'|| TO_CHAR（num_fix））;结束; /</pre><p>SQL * Plus输出以下行：</p><pre class="oac_no_warn" dir="ltr">num fix：1</pre><p>以下查询确认修复已完成。</p><pre class="oac_no_warn" dir="ltr">SELECT OBJECT_NAME，BLOCK_ID，MARKED_CORRUPT FROM REPAIR_TABLE; OBJECT_NAME BLOCK_ID MARKED_COR ------------------------------ ---------- ------- --- DEPT 3是的</pre></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-EA2EA177-80ED-420B-B16E-2936014AC68C" title="示例说明了如何使用DBMS_REPAIR包。">DBMS_REPAIR示例</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN11834"></a><div class="props_rev_3"><a id="GUID-1655A1A1-5A4F-450E-9AFB-6186B59B4A5E" name="GUID-1655A1A1-5A4F-450E-9AFB-6186B59B4A5E"></a><h4 id="ADMIN-GUID-1655A1A1-5A4F-450E-9AFB-6186B59B4A5E" class="sect4"><span class="enumeration_section">25.4.4</span>示例：查找指向损坏数据块的索引条目</h4>
                  <div>
                     <p>示例说明了使用<code class="codeph">DUMP_ORPHAN_KEYS</code>过程查找指向损坏数据块的索引条目。
                     </p>
                     <div class="section">
                        <p><code class="codeph">DUMP_ORPHAN_KEYS</code>过程报告指向损坏数据块中的行的索引条目。对于每个索引条目，将在指定的孤立键表中插入一行。必须先前已创建孤立密钥表。
                        </p>
                        <p>此信息可用于重建表中丢失的行以及用于诊断目的。</p>
                        <div class="infoboxnote" id="GUID-1655A1A1-5A4F-450E-9AFB-6186B59B4A5E__GUID-3E9BFD73-4785-4367-ADAB-0550B1D43ECE">
                           <p class="notep1">注意：</p>
                           <p>应该为与修复表中标识的表关联的每个索引运行此操作。</p>
                        </div>
                        <p>在此示例中， <code class="codeph">pk_dept</code>是<code class="codeph">scott.dept</code>表上的索引。扫描它以确定是否有任何索引条目指向损坏的数据块中的行。
                        </p><pre class="oac_no_warn" dir="ltr">SET SERVEROUTPUT ON DECLARE num_orphans INT; BEGIN num_orphans：= 0; DBMS_REPAIR.DUMP_ORPHAN_KEYS（SCHEMA_NAME =&gt;'SCOTT'，OBJECT_NAME =&gt;'PK_DEPT'，OBJECT_TYPE =&gt; dbms_repair.index_object，REPAIR_TABLE_NAME =&gt;'REPAIR_TABLE'，ORPHAN_TABLE_NAME =&gt;'ORPHAN_KEY_TABLE'，KEY_COUNT =&gt; num_orphans）; DBMS_OUTPUT.PUT_LINE（'orphan key count：'|| TO_CHAR（num_orphans））;结束; /</pre><p>以下输出表明有三个孤立键：</p><pre class="oac_no_warn" dir="ltr">孤儿钥匙数：3</pre><p>孤立键表中的索引条目意味着应该重建索引。这可以保证表探测和索引探测返回相同的结果集。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-EA2EA177-80ED-420B-B16E-2936014AC68C" title="示例说明了如何使用DBMS_REPAIR包。">DBMS_REPAIR示例</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN11835"></a><div class="props_rev_3"><a id="GUID-C80FB286-14FE-42D0-B58B-52FB939ED185" name="GUID-C80FB286-14FE-42D0-B58B-52FB939ED185"></a><h4 id="ADMIN-GUID-C80FB286-14FE-42D0-B58B-52FB939ED185" class="sect4"><span class="enumeration_section">25.4.5</span>示例：跳过损坏的块</h4>
                  <div>
                     <p>示例说明了使用<code class="codeph">SKIP_CORRUPT_BLOCKS</code>过程跳过损坏的块。
                     </p>
                     <div class="section">
                        <p><code class="codeph">SKIP_CORRUPT_BLOCKS</code>过程启用或禁用在指定对象的索引和表扫描期间跳过损坏的块。当对象是表时，跳过应用于表及其索引。当对象是群集时，它将应用于群集中的所有表及其各自的索引。
                        </p>
                        <p>以下示例允许跳过<code class="codeph">scott.dept</code>表的软件损坏块：</p><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_REPAIR.SKIP_CORRUPT_BLOCKS（SCHEMA_NAME =&gt;'SCOTT'，OBJECT_NAME =&gt;'DEPT'，OBJECT_TYPE =&gt; dbms_repair.table_object，FLAGS =&gt; dbms_repair.skip_flag）;结束; /</pre><p>查询<code class="codeph">scott</code>的使用表<code class="codeph">DBA_TABLES</code>视图显示<code class="codeph">SKIP_CORRUPT</code>为表启用<code class="codeph">scott.dept</code> 。
                        </p><pre class="oac_no_warn" dir="ltr">SELECT OWNER，TABLE_NAME，SKIP_CORRUPT FROM DBA_TABLES WHERE OWNER ='SCOTT'; OWNER TABLE_NAME SKIP_COR ------------------------------ ----------------- ------------- -------- SCOTT帐户禁用SCOTT BONUS禁用SCOTT DEPE禁用SCOTT DOCINDEX禁用SCOTT EMP禁用SCOT收据禁用SCOT SALGRADE禁用SCOTT SCOTT_EMP禁用SCOTT SYS_IOT_OVER_12255禁用SCOTT WORK_AREA禁用10行选中。</pre><p></p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="repairing-corrupted-data.html#GUID-EA2EA177-80ED-420B-B16E-2936014AC68C" title="示例说明了如何使用DBMS_REPAIR包。">DBMS_REPAIR示例</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>