<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="You can move a PDB to a different CDB or application container."></meta>
      <meta name="description" content="You can move a PDB to a different CDB or application container."></meta>
      <title>重新安置PDB</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Administrator’s Guide "></meta>
      <meta property="og:description" content="You can move a PDB to a different CDB or application container."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Administrator’s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="multitenant-administrators-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-03-20T09:59:22-07:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2017, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96136-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="cloning-a-pdb.html" title="Previous" type="text/html"></link>
      <link rel="next" href="plugging-in-a-pdb.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Multitenant Administrator&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="MULTI"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="cloning-a-pdb.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="plugging-in-a-pdb.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">管理员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="creating-pdbs.html" property="item" typeof="WebPage"><span property="name">创建和删除PDB和应用程序容器</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">重新安置PDB</li>
            </ol>
            <a id="GUID-75519361-3DA2-4558-A7E5-64BC16FAFC7D" name="GUID-75519361-3DA2-4558-A7E5-64BC16FAFC7D"></a>
            
            <h2 id="MULTI-GUID-75519361-3DA2-4558-A7E5-64BC16FAFC7D" class="sect2"><span class="enumeration_chapter">8</span>重新安置PDB</h2>
         </header>
         <div class="ind">
            <div>
               <p>您可以将PDB移动到其他CDB或应用程序容器。</p>
               <p>本章包含以下主题：</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="relocating-a-pdb.html#GUID-0A5C8EFF-51A4-497B-8D5C-A4267A694D4B">关于PDB搬迁</a><br>在重定位期间，源PDB可以在读/写模式下打开并且功能完备。
                  </li>
                  <li class="ulchildlink"><a href="relocating-a-pdb.html#GUID-E908BC15-EDBE-4FD7-B584-1F7FCBC6C814">PDB搬迁的目的</a><br>这种技术是在最短或没有停机时间内移动PDB的最快方法。否则，拔出源PDB需要PDB中断，直到PDB插入目标CDB。</li>
                  <li class="ulchildlink"><a href="relocating-a-pdb.html#GUID-EA37D755-A28E-4E85-BF84-F8FCE3164349">PDB重定位的工作原理</a><br>该操作将与PDB关联的文件移动到新位置，将PDB添加到目标CDB，然后打开PDB。</li>
                  <li class="ulchildlink"><a href="relocating-a-pdb.html#GUID-9460B932-8EF8-4261-87C9-7267213EBD11">PDB重定位的用户界面</a><br>您可以使用SQL，DBCA实用程序或Rapid Home Provisioning实用程序在命令行上重新定位PDB。
                  </li>
                  <li class="ulchildlink"><a href="relocating-a-pdb.html#GUID-F887DBA7-61A6-49FB-8400-40632765F1E1">使用CREATE PLUGGABLE DATABASE重定位PDB</a><br><code class="codeph">CREATE PLUGGABLE DATABASE ...RELOCATE</code>语句将PDB移动到其他容器。
                  </li>
                  <li class="ulchildlink"><a href="relocating-a-pdb.html#GUID-6A85B92C-0AE6-4737-BDBD-EA8256C09E55">重新安置PDB：示例</a><br>本节中的示例演示了使用SQL和DBCA的重定位。</li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="creating-pdbs.html#GUID-9A250D93-5B3B-4643-BE85-F32CC7B0E413" title="您可以使用各种技术创建PDB，应用程序容器和应用程序种子。">创建和删除PDB和应用程序容器</a></p>
                  </div>
               </div>
            </div>
            
            <div class="props_rev_3"><a id="GUID-0A5C8EFF-51A4-497B-8D5C-A4267A694D4B" name="GUID-0A5C8EFF-51A4-497B-8D5C-A4267A694D4B"></a><h3 id="MULTI-GUID-0A5C8EFF-51A4-497B-8D5C-A4267A694D4B" class="sect3"><span class="enumeration_section">8.1</span>关于PDB重定位</h3>
               <div>
                  <p>在重定位期间，源PDB可以在读/写模式下打开并且功能完备。</p>
                  <p>下图显示了将公共PDB（即不是应用程序PDB）重定位到新CDB。源PDB插入CDB根目录，目标PDB插入CDB根目录。请注意， <code class="codeph">CREATE PLUGGABLE DATABASE ...RELOCATE</code>语句将数据块，撤消块和重做块复制到新位置。需要数据库链接。
                  </p>
                  <div class="figure" id="GUID-0A5C8EFF-51A4-497B-8D5C-A4267A694D4B__RELOCATEAPDB-5C4973BF">
                     <p class="titleinfigure">图8-1将PDB重定位到根容器中</p><img src="img/admin109.png" alt="下面是图8-1的描述" title="下面是图8-1的描述" longdesc="img_text/admin109.html"><br><a href="img_text/admin109.html">“图8-1将PDB重定位到根容器”的描述</a></div>
                  <!-- class="figure" -->
                  <p>当目标PDB是应用程序PDB或应用程序根目录时，您有以下选项：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>您可以将PDB作为应用程序PDB重定位到应用程序容器中。目标PDB可以在相同的CDB或不同的CDB中。</p>
                     </li>
                     <li>
                        <p>您可以将应用程序PDB从一个应用程序根目录重定位到另一个应用程序。目标PDB可以在相同的CDB或不同的CDB中。</p>
                     </li>
                     <li>
                        <p>您可以将空应用程序根目录从一个CDB重定位到另一个CDB，但应用程序根目录不能具有任何托管应用程序PDB。</p>
                     </li>
                  </ul>
                  <p>下图说明了此技术如何在应用程序容器中创建新的应用程序PDB。</p>
                  <div class="figure" id="GUID-0A5C8EFF-51A4-497B-8D5C-A4267A694D4B__RELOCATEAPDBINTOANAPPLICATIONCONTAI-7FD49079">
                     <p class="titleinfigure">图8-2将PDB重定位到应用程序容器中</p><img src="img/admin116.png" alt="下面是图8-2的描述" title="下面是图8-2的描述" longdesc="img_text/admin116.html"><br><a href="img_text/admin116.html">“图8-2将PDB重定位到应用程序容器”的描述</a></div>
                  <!-- class="figure" -->
                  <p>当您第一次打开重定位的PDB时，Oracle数据库会在源PDB上消耗活动会话，并将客户端连接重定向到重定位的PDB服务。打开重定位的PDB会启动原始源PDB的关闭。源和重定位的PDB永远不会同时打开。</p>
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-0A5C8EFF-51A4-497B-8D5C-A4267A694D4B__GUID-0D128A0B-3EF1-4B66-A522-1DCAAA9B2408">
                     <p class="notep1">也可以看看：</p>
                     <p><span class="q">“ <a href="overview-of-pdb-creation.html#GUID-59F42929-7237-4371-8934-921B46DB6F31" title="但是，如果选择创建PDB，则必须确定将存储数据的表空间和文件。">PDB存储</a> ”</span></p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：重</strong> <a href="relocating-a-pdb.html#GUID-75519361-3DA2-4558-A7E5-64BC16FAFC7D" title="您可以将PDB移动到其他CDB或应用程序容器。">定位PDB</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-E908BC15-EDBE-4FD7-B584-1F7FCBC6C814" name="GUID-E908BC15-EDBE-4FD7-B584-1F7FCBC6C814"></a><h3 id="MULTI-GUID-E908BC15-EDBE-4FD7-B584-1F7FCBC6C814" class="sect3"><span class="enumeration_section">8.2</span> PDB搬迁的目的</h3>
               <div>
                  <p>这种技术是在最短或没有停机时间内移动PDB的最快方法。否则，拔出源PDB需要PDB中断，直到PDB插入目标CDB。</p>
                  <p>在数据中心之间移动PDB时，或者从内部部署环境移动到云环境时，所有数据都必须物理移动。对于大型PDB，此过程可能需要相当长的时间，可能违反SLA的可用性组件。 PDB重新定位完全消除了中断。您可以重新定位PDB，而无需使应用程序脱机，更改应用程序或更改网络连接字符串。</p>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：重</strong> <a href="relocating-a-pdb.html#GUID-75519361-3DA2-4558-A7E5-64BC16FAFC7D" title="您可以将PDB移动到其他CDB或应用程序容器。">定位PDB</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-EA37D755-A28E-4E85-BF84-F8FCE3164349" name="GUID-EA37D755-A28E-4E85-BF84-F8FCE3164349"></a><h3 id="MULTI-GUID-EA37D755-A28E-4E85-BF84-F8FCE3164349" class="sect3"><span class="enumeration_section">8.3</span> PDB搬迁的工作原理</h3>
               <div>
                  <p>该操作将与PDB关联的文件移动到新位置，将PDB添加到目标CDB，然后打开PDB。</p>
                  <p>PDB重定位执行源PDB数据文件的在线块级副本，重做和撤消，而源PDB使用活动会话打开。当目标PDB由于<code class="codeph">ALTER PLUGGABLE DATABASE OPEN</code>语句而联机时，Oracle数据库终止活动会话并关闭源PDB。</p>
                  <p><span>Oracle Database 18c</span>引入了数据库通用会话耗尽，其中活动会话可以在计时器下正常退出。计时器到期后，Oracle数据库终止所有活动会话并将它们重新连接到重定位的PDB。对于在数据库服务和PDB级别调用的所有维护操作，默认情况下启用此功能：停止服务，重定位服务，重定位PDB和停止PDB。</p>
                  <p>PDB重定位服务在Oracle RAC和单实例环境中可用，其中PDB在同一集群数据库中的CDB实例之间或不同的CDB之间重定位。在Oracle Clusterware中，Rapid Home Provisioning功能可自动执行PDB重定位。在Oracle RAC环境中进行细粒度重定位的一个示例是PDB实例之间的服务重定位。Oracle RAC和Oracle Clusterware提供了丰富的高可用性环境，可进一步减少重定位期间对连接客户端的影响。例如，共享存储可以最小化或消除复制数据文件的必要性。</p>
                  <p>本节包含以下主题：</p>
                  <div class="infoboxnote" id="GUID-EA37D755-A28E-4E85-BF84-F8FCE3164349__GUID-E71D299D-16B4-40B7-B899-1D455114BBD6">
                     <p class="notep1">注意：</p>在Oracle Clusterware环境中，在不同CDB之间重定位PDB时，必须使用SRVCTL创建非默认服务资源。</div>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="relocating-a-pdb.html#GUID-B33BBFB9-824A-4D78-ABFC-351258DD77D4">重定位或停止PDB时服务器会话耗尽</a><br>计划维护的关键要求是耗尽或失败PDB会话，以便不中断应用程序工作。
                     </li>
                     <li class="ulchildlink"><a href="relocating-a-pdb.html#GUID-1CECFDF5-F402-49AB-B88F-5AD532D5BF41">PDB搬迁的阶段</a><br>PDB重定位的细节取决于监听器网络。
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-EA37D755-A28E-4E85-BF84-F8FCE3164349__GUID-8B7D1316-9C5C-4FF0-94DB-F1AF50ABE32E">
                     <p class="notep1">也可以看看：</p>
                     <p><span><cite>“Oracle Clusterware管理和部署指南”</cite></span>了解<a href="../cwadd/server-control-command-reference.html#CWADD-GUID-1DCA9E3F-B929-4555-B673-921FF3588AC3" target="_blank">SRVCTL</a>和<a href="../cwadd/rapid-home-provisioning.html#GUID-CCEC5960-EDA4-4A3F-9643-0CA308EA49AA" target="_blank">Rapid Home Provisioning</a></p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：重</strong> <a href="relocating-a-pdb.html#GUID-75519361-3DA2-4558-A7E5-64BC16FAFC7D" title="您可以将PDB移动到其他CDB或应用程序容器。">定位PDB</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-B33BBFB9-824A-4D78-ABFC-351258DD77D4" name="GUID-B33BBFB9-824A-4D78-ABFC-351258DD77D4"></a><h4 id="MULTI-GUID-B33BBFB9-824A-4D78-ABFC-351258DD77D4" class="sect4"><span class="enumeration_section">8.3.1重</span>定位或停止PDB时的服务器会话耗尽</h4>
                  <div>
                     <p>计划维护的关键要求是耗尽或失败PDB会话，以便不中断应用程序工作。</p>
                     <p>从<span>Oracle Database 18c</span>开始，数据库会在PDB重新定位或停止时自动标记要排空的会话。数据库使用一组可扩展的规则来确定何时耗尽数据库会话，该会话一直持续到规则满足为止。规则包括以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>标准应用程序服务器测试有效性</p>
                        </li>
                        <li>
                           <p>自定义SQL测试的有效性</p>
                        </li>
                        <li>
                           <p>请求边界正在使用中，并且没有活动请求</p>
                        </li>
                        <li>
                           <p>请求边界正在使用中，当前请求已结束</p>
                        </li>
                        <li>
                           <p>会话具有一个或多个可恢复的会话状态，并且可以在故障转移时重新创建</p>
                        </li>
                     </ul>
                     <p>典型的用例是应用程序服务器和池化应用程序，它们在从连接池借用，返回池连接以及批量提交时测试连接。在耗尽会话时，数据库会自动拦截连接测试，关闭连接，然后返回测试的失败状态。接收到失败状态后，应用层可以请求不同的连接。这样，应用程序不会中断。</p>
                     <p>对于最小化对客户端影响的最佳配置，请考虑将Oracle RAC与FAN和应用程序连续性一起使用。</p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-B33BBFB9-824A-4D78-ABFC-351258DD77D4__GUID-86A91662-455C-4CCE-9DD1-EE77F1FF5715">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../racad/ensuring-application-continuity.html#RACAD-GUID-2DD974C8-94C2-446B-B2BD-81B8135A26C3" target="_blank"><span><cite>“Oracle Real Application Clusters管理和部署指南”</cite></span></a> ，了解有关为计划维护排空数据库会话的更多信息</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="relocating-a-pdb.html#GUID-EA37D755-A28E-4E85-BF84-F8FCE3164349" title="该操作将与PDB关联的文件移动到新位置，将PDB添加到目标CDB，然后打开PDB。">PDB重定位的工作原理</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-1CECFDF5-F402-49AB-B88F-5AD532D5BF41" name="GUID-1CECFDF5-F402-49AB-B88F-5AD532D5BF41"></a><h4 id="MULTI-GUID-1CECFDF5-F402-49AB-B88F-5AD532D5BF41" class="sect4"><span class="enumeration_section">8.3.2</span> PDB搬迁的阶段</h4>
                  <div>
                     <p>PDB重定位的细节取决于监听器网络。</p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="relocating-a-pdb.html#GUID-C0A74AC1-86E7-448A-ACA4-F75EF31D8DC7">公共侦听器网络中的PDB重定位</a><br>当源和目标位置共享公共侦听器网络时，不需要转发客户端连接，因为SQL * Net层隐式转发客户端连接。
                        </li>
                        <li class="ulchildlink"><a href="relocating-a-pdb.html#GUID-355DBFEE-4330-4B57-8B81-0DD094EBCDE4">隔离监听网络中的PDB重定位</a><br>当独立侦听器不使用交叉注册时，目标CDB和源CDB中的侦听器不了解彼此或其各自的已发布服务。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="relocating-a-pdb.html#GUID-EA37D755-A28E-4E85-BF84-F8FCE3164349" title="该操作将与PDB关联的文件移动到新位置，将PDB添加到目标CDB，然后打开PDB。">PDB重定位的工作原理</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-C0A74AC1-86E7-448A-ACA4-F75EF31D8DC7" name="GUID-C0A74AC1-86E7-448A-ACA4-F75EF31D8DC7"></a><h5 id="MULTI-GUID-C0A74AC1-86E7-448A-ACA4-F75EF31D8DC7" class="sect5"><span class="enumeration_section">8.3.2.1</span>公共监听器网络中的PDB重定位</h5>
                     <div>
                        <p>当源和目标位置共享公共侦听器网络时，不需要转发客户端连接，因为SQL * Net层隐式转发客户端连接。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-C0A74AC1-86E7-448A-ACA4-F75EF31D8DC7__GUID-57C3244B-7A6A-4858-8963-9D4501B13DB2">可用性正常</p>
                           <p>当侦听器网络很常见时，在<code class="codeph">CREATE PLUGGABLE DATABASE ...指定<code class="codeph">AVAILABILITY NORMAL</code>子句<code class="codeph">CREATE PLUGGABLE DATABASE ...RELOCATE</code> 。此选项是默认选项。以下情况是<code class="codeph">AVAILABILITY NORMAL</code>典型用例：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>共享监听器</p>
                                 <p>如果在旧位置和新位置对PDB使用相同的侦听器，则在重定位完成时，新连接将自动路由到新位置。这种情况通常是同一主机中CDB之间的重定位。在这种情况下，PDB在其新位置与监听器重新注册。不需要额外的连接处理。</p>
                              </li>
                              <li>
                                 <p>交叉注册的听众</p>
                                 <p>如果PDB使用不同的侦听器，并且您通过配置<code class="codeph">local_listener</code>和<code class="codeph">remote_listener</code>参数来使用各自侦听器的交叉注册，则重定位是无缝的。PDB服务的可用性和位置会自动注册到两个听众。这种情况通常是数据中心内主机之间的重定位，可能是为了实现负载平衡。
                                 </p>
                              </li>
                           </ul>
                           <p>在共享和交叉注册的侦听器环境中，来自所有数据库的服务将发布到公共侦听器网络。因此，公共侦听器网络立即知道重定位PDB的服务。为避免服务名称空间冲突，PDB服务定义在公共侦听器网络中必须是唯一的。</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-C0A74AC1-86E7-448A-ACA4-F75EF31D8DC7__GUID-B02759BE-36E6-42BF-9317-90574F338361">公共监听网络中的重定位阶段</p>
                           <ol>
                              <li>
                                 <p>用户发出<code class="codeph">CREATE PLUGGABLE DATABASE ...RELOCATE AVAILABILITY NORMAL</code> 。</p>
                                 <p>此步骤执行源PDB从其原始位置到其目标位置的热克隆。源PDB将数据文件，撤消块和重做块从隐式开始SCN标记复制到目标PDB。</p>
                                 <p>完成此步骤后，将存在此PDB的两个事务一致性副本：一个位于源容器中，另一个位于目标容器中。在操作期间，源PDB上的处理继续不间断。连接到源PDB的应用程序或应用程序的用户不知道正在进行重定位。</p>
                                 <p>所有现有应用程序连接以及在此步骤中创建的新连接将继续连接到源PDB。</p>
                              </li>
                              <li>
                                 <p>用户发出<code class="codeph">ALTER PLUGGABLE DATABASE OPEN</code> 。</p>
                                 <p>以下操作在后台发生：</p>
                                 <ol type="a">
                                    <li>
                                       <p>目标PDB隐式设置结束SCN标记，并应用完成介质恢复所需的任何重做或撤消以满足隐式结束SCN标记。</p>
                                    </li>
                                    <li>
                                       <p>在目标PDB上进行介质恢复时，Oracle数据库会在源PDB上启动活动会话耗尽。</p>
                                    </li>
                                    <li>
                                       <p>PDB服务向监听器注册，并且可在目标CDB上使用。</p>
                                    </li>
                                    <li>
                                       <p>源PDB已关闭。</p>
                                    </li>
                                    <li>
                                       <p>目标PDB以读/写模式打开。</p>
                                       <p>此步骤完成PDB重定位到目标CDB。在操作结束时，连接指向新重定位的PDB。</p>
                                       <p>在读/写模式下打开PDB后，其状态为<code class="codeph">NORMAL</code> 。如果尝试以只读模式打开PDB，数据库将返回错误。
                                       </p>
                                    </li>
                                 </ol>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-C0A74AC1-86E7-448A-ACA4-F75EF31D8DC7__GUID-F55504A4-B071-443B-B3EB-CA525E602884">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关侦听器重定向的详细信息，请参见<a href="../netag/configuring-and-administering-oracle-net-listener.html#NETAG-GUID-63F36312-FDA8-4B20-B8E1-4949AD55707A" target="_blank"><span><cite>“Oracle数据库网络服务管理员指南”</cite></span></a></p>
                              </li>
                              <li>
                                 <p><a href="../racad/ensuring-application-continuity.html#RACAD-GUID-C1EF6BDA-5F90-448F-A1E2-DC15AD5CFE75" target="_blank"><span><cite>“Oracle Real Application Clusters管理和部署指南”</cite></span></a> ，了解有关在计划维护之前使用Application Continuity排空和迁移会话的更多信息</p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="relocating-a-pdb.html#GUID-1CECFDF5-F402-49AB-B88F-5AD532D5BF41" title="PDB重定位的细节取决于监听器网络。">PDB重定位的阶段</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-355DBFEE-4330-4B57-8B81-0DD094EBCDE4" name="GUID-355DBFEE-4330-4B57-8B81-0DD094EBCDE4"></a><h5 id="MULTI-GUID-355DBFEE-4330-4B57-8B81-0DD094EBCDE4" class="sect5"><span class="enumeration_section">8.3.2.2</span>隔离监听器网络中的PDB重定位</h5>
                     <div>
                        <p>当独立侦听器不使用交叉注册时，目标CDB和源CDB中的侦听器不了解彼此或其各自的已发布服务。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-355DBFEE-4330-4B57-8B81-0DD094EBCDE4__GUID-D6B0E831-9C27-4C84-AEE2-0E1A035A6A65">可用性最大</p>
                           <p><code class="codeph">CREATE PLUGGABLE DATABASE ...的<code class="codeph">AVAILABILITY MAX</code>子句<code class="codeph">CREATE PLUGGABLE DATABASE ...RELOCATE</code>隐式指示SQL * Net层重新配置原始侦听器。在数据中心之间重新定位PDB时，这种情况可能很常见。在更新Oracle Internet Directory（OID）或LDAP服务器或修改客户端连接时，此配置是临时的。
                           </p>
                           <p>如果本地侦听器重定向到Oracle RAC配置中的单个客户端访问名称（SCAN）侦听器，则此侦听器可能需要进一步将客户端连接请求重定向到另一个群集节点。默认情况下，Oracle Net侦听器不支持多个重定向。因为任何SCAN听众可路由连接请求到任何节点，设置<code class="codeph">ALLOW_MULTIPLE_REDIRECTS_ <span class="codeinlineitalic">listener_name</span></code>参数到<code class="codeph"><span class="codeinlineitalic">listener_name</span></code>每SCAN收听者，并且将其设置在每一个<code class="codeph">listener.ora</code>集群中的文件。例如，如果SCAN侦听器名为<code class="codeph">listener_scan1</code> ， <code class="codeph">listener_scan2</code>和<code class="codeph">listener_scan3</code> ，则每个目标主机上的<code class="codeph">listener.ora</code>文件应具有以下设置：</p><pre class="pre codeblock"><code>ALLOW_MULTIPLE_REDIRECTS_LISTENER_SCAN1 = YES ALLOW_MULTIPLE_REDIRECTS_LISTENER_SCAN2 = YES ALLOW_MULTIPLE_REDIRECTS_LISTENER_SCAN3 = YES</code></pre><div class="infoboxnote" id="GUID-355DBFEE-4330-4B57-8B81-0DD094EBCDE4__GUID-E5DFD462-7C99-4B2D-A1B1-48749B17A6EE">
                              <p class="notep1">警告：</p>
                              <p>不要为节点侦听器设置<code class="codeph">ALLOW_MULTIPLE_REDIRECTS_ <span class="codeinlineitalic">listener_name</span></code>参数，因为它可能允许在某些网络配置中进行无限重定向循环。
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-355DBFEE-4330-4B57-8B81-0DD094EBCDE4__GUID-A3A41CE9-E9AE-46D6-A025-99175977905A">孤立的侦听器网络中的重定位阶段</p>
                           <ol>
                              <li>
                                 <p>用户发出<code class="codeph">CREATE PLUGGABLE DATABASE ...RELOCATE AVAILABILITY MAX</code> 。</p>
                                 <p>此步骤执行源PDB从其原始位置到其目标位置的热克隆。源PDB将数据文件，撤消块和重做块从隐式开始SCN标记复制到目标PDB。</p>
                              </li>
                              <li>
                                 <p>用户发出<code class="codeph">ALTER PLUGGABLE DATABASE OPEN</code> 。</p>
                                 <p>以下操作在后台发生：</p>
                                 <ol type="a">
                                    <li>
                                       <p>目标PDB隐式设置结束SCN标记，并应用完成介质恢复所需的任何重做或撤消以满足隐式结束SCN标记。</p>
                                    </li>
                                    <li>
                                       <p>在目标PDB上进行介质恢复时，Oracle数据库会在源PDB上启动活动会话耗尽。</p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">LISTENER_NETWORKS</code>初始化参数在源PDB中使用转发地址进行隐式更新，并且源CDB的侦听器PDB服务使用转发地址进行更新。
                                       </p>
                                    </li>
                                    <li>
                                       <p>在介质恢复完成时，目标PDB以只读模式打开。</p>
                                       <p>在此阶段，仅允许对目标PDB进行查询。查询的行为与在源PDB上运行的完全相同。但是，尝试DML的连接无法完成。</p>
                                    </li>
                                    <li>
                                       <p>只读连接立即转发到新的主机侦听器，新的读/写连接被转发到新的主机侦听器，在那里它们旋转直到目标PDB以一致的状态打开。</p>
                                    </li>
                                    <li>
                                       <p>源PDB执行<code class="codeph">SHUTDOWN IMMEDIATE</code> ，终止持久连接。
                                       </p>
                                    </li>
                                    <li>
                                       <p>目标PDB以读/写模式打开。</p>
                                       <p>此步骤完成PDB重定位到目标CDB。在操作结束时，连接指向新重定位的PDB。</p>
                                       <p>在读/写模式下打开PDB后，其状态为<code class="codeph">NORMAL</code> 。如果尝试以只读模式打开PDB，数据库将返回错误。
                                       </p>
                                    </li>
                                 </ol>
                              </li>
                           </ol>
                           <div class="infoboxnote" id="GUID-355DBFEE-4330-4B57-8B81-0DD094EBCDE4__GUID-EE867FD7-3C5A-402D-BE1B-D7EF07927251">
                              <p class="notep1">注意：</p>
                              <p>称为<span class="italic">逻辑删除PDB</span>的工件保留在源CDB中以保护PDB的命名空间并保留侦听器转发配置，直到更新完成。在源CDB的根目录中，逻辑删除PDB在<code class="codeph">V$CONTAINERS</code>可见，状态为<code class="codeph">RELOCATED</code> 。更改应用程序连接字符串以提供与目标PDB的直接连接时，可以从源CDB中删除逻辑删除PDB。</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-355DBFEE-4330-4B57-8B81-0DD094EBCDE4__GUID-A352C9F1-971A-463D-8177-4C2FC9D6AA1B">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="creating-removing-application-containers-seeds-with-sql-plus.html#GUID-88E61123-F651-47D7-9977-B589268EBD29" title="您可以通过运行CREATE PLUGGABLE DATABASE语句并将应用程序root作为当前容器来创建应用程序PDB。">创建应用程序PDB</a> ”</span></p>
                              </li>
                              <li>
                                 <p>有关侦听器重定向的详细信息，请参见<a href="../netag/configuring-and-administering-oracle-net-listener.html#NETAG-GUID-63F36312-FDA8-4B20-B8E1-4949AD55707A" target="_blank"><span><cite>“Oracle数据库网络服务管理员指南”</cite></span></a></p>
                              </li>
                              <li>
                                 <p><a href="../racad/ensuring-application-continuity.html#RACAD-GUID-C1EF6BDA-5F90-448F-A1E2-DC15AD5CFE75" target="_blank"><span><cite>“Oracle Real Application Clusters管理和部署指南”</cite></span></a> ，了解有关在计划维护之前使用Application Continuity排空和迁移会话的更多信息</p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="relocating-a-pdb.html#GUID-1CECFDF5-F402-49AB-B88F-5AD532D5BF41" title="PDB重定位的细节取决于监听器网络。">PDB重定位的阶段</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-9460B932-8EF8-4261-87C9-7267213EBD11" name="GUID-9460B932-8EF8-4261-87C9-7267213EBD11"></a><h3 id="MULTI-GUID-9460B932-8EF8-4261-87C9-7267213EBD11" class="sect3"><span class="enumeration_section">8.4</span> PDB重定位的用户界面</h3>
               <div>
                  <p>您可以使用SQL，DBCA实用程序或Rapid Home Provisioning实用程序在命令行上重新定位PDB。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-9460B932-8EF8-4261-87C9-7267213EBD11__GUID-A21F1542-2EA9-4E29-8D7B-B361D477A8DC">SQL语句</p>
                     <p>SQL语句的形式如下：</p><pre class="pre codeblock"><code>创建可插入的数据库...FROM <span class="italic">src_pdb_name</span> @ <span class="italic">link2src</span> ...重新定位可用性[MAX |正常]</code></pre><p><code class="codeph">FROM</code>子句标识源PDB的位置。对于<code class="codeph"><span class="codeinlineitalic">src_pdb_name</span></code> ，请指定源PDB的名称。对于<code class="codeph">link2src</code> ，请指定指示源PDB位置的数据库链接。必须在目标CDB中创建数据库链接，目标CDB是PDB将重定位到的CDB。该链接可以连接到远程CDB的根目录或远程PDB。</p>
                     <p><code class="codeph">AVAILABILITY</code>子句确定数据库如何处理客户端连接。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-9460B932-8EF8-4261-87C9-7267213EBD11__GUID-55B2D766-A4B9-4320-97AA-1C071466E7CE">DBCA</p>
                     <p>您可以通过以静默方式运行DBCA来重定位PDB。<code class="codeph">relocatePDB</code>命令执行重定位。
                     </p>
                     <div class="tblformal" id="GUID-9460B932-8EF8-4261-87C9-7267213EBD11__GUID-BA2854A7-C540-4BF0-82B5-7E90D2E627B5">
                        <p class="titleintable">表8-1 relocatePDB参数</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="relocatePDB参数" border="1" summary="This table describe the parameters for the -relocatePDB command in DBCA silent mode." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" id="d44547e1304">参数</th>
                                 <th align="left" valign="bottom" id="d44547e1306">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d44547e1310" headers="d44547e1304 ">
                                    <p><code class="codeph">-remotePDBName <span class="codeinlineitalic">remote_pdb_name</span></code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d44547e1310 d44547e1306 ">
                                    <p>您打算重新定位的PDB的名称。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d44547e1320" headers="d44547e1304 ">
                                    <p><code class="codeph">-remoteDBConnString <span class="codeinlineitalic">remote_db_conn_string</span></code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d44547e1320 d44547e1306 ">
                                    <p>与远程CDB的网络服务连接。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d44547e1330" headers="d44547e1304 ">
                                    <p><code class="codeph">-sysDBAUserName <span class="codeinlineitalic">sysdbusername</span></code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d44547e1330 d44547e1306 ">
                                    <p>本地CDB中<code class="codeph">SYS</code>用户的名称。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d44547e1343" headers="d44547e1304 ">
                                    <p><code class="codeph">-sysDBAPassword <span class="codeinlineitalic">sysdbapassowrd</span></code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d44547e1343 d44547e1306 ">
                                    <p>本地CDB中<code class="codeph">SYS</code>用户的密码。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d44547e1356" headers="d44547e1304 ">
                                    <p><code class="codeph">-remoteDBSYSDBAUserName <span class="codeinlineitalic">sysdbusername</span></code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d44547e1356 d44547e1306 ">
                                    <p>远程CDB中<code class="codeph">SYS</code>用户的名称。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d44547e1369" headers="d44547e1304 ">
                                    <p><code class="codeph">-remoteDBSYSDBAPassword <span class="codeinlineitalic">sysdbapassowrd</span></code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d44547e1369 d44547e1306 ">
                                    <p>远程CDB中<code class="codeph">SYS</code>用户的密码。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d44547e1382" headers="d44547e1304 ">
                                    <p><code class="codeph">-dbLinkUsername <span class="codeinlineitalic">dblink_common_user_name</span></code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d44547e1382 d44547e1306 ">
                                    <p>远程CDB中普通用户的名称。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d44547e1392" headers="d44547e1304 ">
                                    <p><code class="codeph">-dbLinkUserPassword <span class="codeinlineitalic">dblink_common_username_pwd</span></code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d44547e1392 d44547e1306 ">
                                    <p>远程CDB中普通用户的密码。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d44547e1402" headers="d44547e1304 ">
                                    <p><code class="codeph">-sourceDB <span class="codeinlineitalic">dbname_pdb_toberelocated</span></code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d44547e1402 d44547e1306 ">
                                    <p>源PDB的名称。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d44547e1412" headers="d44547e1304 ">
                                    <p><code class="codeph">-pdbName <span class="codeinlineitalic">pdbtoberecreated</span></code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d44547e1412 d44547e1306 ">
                                    <p>重定位后PDB的名称。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-9460B932-8EF8-4261-87C9-7267213EBD11__GUID-0FAAE4EE-7E3B-4A4B-AED5-E9DB2589AE7A">快速家庭供应控制（RHPCTL）</p>
                     <p>在Oracle Grid Infrastructure中，您可以使用Rapid Home Provisioning自动将PDB从一个CDB重定位到另一个CDB。</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-9460B932-8EF8-4261-87C9-7267213EBD11__GUID-EDF43CD9-14B8-4B26-85A4-A2C9598316CB">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>用于<code class="codeph">CREATE PLUGGABLE DATABASE</code>语法和语义的<a href="../sqlrf/CREATE-PLUGGABLE-DATABASE.html#GUID-F2DBA8DD-EEA8-4BB7-A07F-78DC04DB1FFC" target="_blank"><span><cite>Oracle数据库SQL语言参考</cite></span></a></p>
                        </li>
                        <li>
                           <p><a href="../admin/creating-and-configuring-an-oracle-database.html#GUID-5DD346B8-4404-48F1-A811-F39D739E4D05" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a></p>用于静默模式的DBCA命令参考</li>
                        <li>
                           <p><a href="../cwadd/rapid-home-provisioning.html#GUID-CCEC5960-EDA4-4A3F-9643-0CA308EA49AA" target="_blank"><span><cite>“Oracle Clusterware管理和部署指南”</cite></span></a>了解有关Rapid Home Provisioning的更多信息</p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：重</strong> <a href="relocating-a-pdb.html#GUID-75519361-3DA2-4558-A7E5-64BC16FAFC7D" title="您可以将PDB移动到其他CDB或应用程序容器。">定位PDB</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="props_rev_3"><a id="GUID-F887DBA7-61A6-49FB-8400-40632765F1E1" name="GUID-F887DBA7-61A6-49FB-8400-40632765F1E1"></a><h3 id="MULTI-GUID-F887DBA7-61A6-49FB-8400-40632765F1E1" class="sect3"><span class="enumeration_section">8.5</span>使用CREATE PLUGGABLE DATABASE重定位PDB</h3>
               <div>
                  <p><code class="codeph">CREATE PLUGGABLE DATABASE ...RELOCATE</code>语句将PDB移动到其他容器。
                  </p>
                  <div class="section">
                     <p><span class="italic">目标CDB</span>是PDB重定位到的CDB。<span class="italic">目标PDB</span>是重新定位的PDB。在<code class="codeph">CREATE PLUGGABLE DATABASE ...RELOCATE</code>操作完成后，Oracle数据库从源CDB移动PDB，然后将其添加到目标CDB。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-F887DBA7-61A6-49FB-8400-40632765F1E1__GENERALPREREQUISITES-BD079BBC">
                     <p class="subhead2" id="GUID-F887DBA7-61A6-49FB-8400-40632765F1E1__GUID-718B7370-0EF5-4CCA-A5FD-77D24648F0B8">一般先决条件</p>
                     <p>在<span class="q">“ <a href="overview-of-pdb-creation.html#GUID-87F21FDE-7115-4207-954E-B229C1879EF6__GUID-57A2E4B5-E8EB-4294-95C2-A3E04AF93D8C" title="此表描述了每个子句以及何时使用每个子句。">表5-3</a> ”中</span>解决适用于重新定位PDB的问题。该表描述了您必须根据不同因素指定的<code class="codeph">CREATE PLUGGABLE DATABASE</code>子句。此外，完成<span class="q">“ <a href="overview-of-pdb-creation.html#GUID-B26D56E1-B958-444F-864C-8AFDFF1566A6" title="Before creating a PDB, you must meet certain prerequisites.">PDB创建的一般先决</a></span>条件”中描述的先决<span class="q"><a href="overview-of-pdb-creation.html#GUID-B26D56E1-B958-444F-864C-8AFDFF1566A6" title="在创建PDB之前，您必须满足某些先决条件。">条件</a></span> 。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-F887DBA7-61A6-49FB-8400-40632765F1E1__GUID-EAE2739C-FE18-4CF5-AA6D-8278421DA336">具体先决条件</p>
                     <p>在重新定位PDB之前，您必须满足以下先决条件：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>源CDB必须处于本地撤消模式。</p>
                        </li>
                        <li>
                           <p>在源CDB中，您必须在所有数据库实例中保存服务并打开PDB的状态。以管理员身份登录CDB root，并发出以下语句：</p><pre class="pre codeblock"><code>ALTER PLOGGABLE DATABASE ALL SAVE STATE INSTANCES = ALL;</code></pre><p>此步骤确保PDB重定位操作自动启动目标CDB中的PDB服务。</p>
                        </li>
                        <li>
                           <p>在目标CDB中，当前用户必须具有CDB根目录中的<code class="codeph">CREATE PLUGGABLE DATABASE</code>系统特权。
                           </p>
                        </li>
                        <li>
                           <p>如果目标CDB未处于<code class="codeph">ARCHIVELOG</code>模式，则PDB必须在操作期间处于打开的只读模式。如果目标CDB处于<code class="codeph">ARCHIVELOG</code>模式，则此要求不适用。
                           </p>
                        </li>
                        <li>
                           <p>以下先决条件适用于数据库链接：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>数据库链接必须启用从目标CDB到源CDB的连接。数据库链接必须连接到源CDB的根目录。如果PDB是应用程序PDB，则数据库链接必须连接到其应用程序根目录。</p>
                              </li>
                              <li>
                                 <p>数据库链接在PDB的当前CDB中连接的用户必须具有<code class="codeph">CREATE PLUGGABLE DATABASE</code>系统特权或<code class="codeph">SYSOPER</code>管理特权。
                                 </p>
                              </li>
                              <li>
                                 <p>如果数据库链接连接到PDB当前CDB中的CDB根目录，则数据库链接所连接的用户必须是普通用户。</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>PDB当前CDB的平台和重新安置的CDB必须满足以下要求：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>它们必须具有相同的字节顺序。</p>
                              </li>
                              <li>
                                 <p>安装在源平台上的数据库选项必须与目标平台上安装的数据库选项相同或者是其子集。</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>如果PDB要重定位到的CDB的字符集不是AL32UTF8，则PDB的当前CDB和要重定位的CDB必须具有兼容的字符集和国家字符集。</p> 
                           <p>如果PDB要重定位到的CDB的字符集是AL32UTF8，则此要求不适用。</p>
                        </li>
                        <li>
                           <p>如果要创建应用程序PDB，则源PDB和目标应用程序容器必须具有相同的应用程序名称和版本。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-F887DBA7-61A6-49FB-8400-40632765F1E1__GUID-C4A3DE1C-CC50-46D7-9D92-4BFF8D01A49E">重新安置PDB：</p>
                     <ol>
                        <li>
                           <p>在SQL * Plus中，以具有<code class="codeph">CREATE PLUGGABLE DATABASE</code>系统特权的用户身份登录到目标CDB。
                           </p>
                        </li>
                        <li>
                           <p>确保当前容器是目标CDB或目标应用程序容器的根。</p>
                        </li>
                        <li>
                           <p>运行<code class="codeph">CREATE PLUGGABLE DATABASE ...RELOCATE</code>语句与<code class="codeph">FROM</code>子句。
                           </p>
                           <p>在<code class="codeph">FROM</code>子句中指定源PDB，并包含<code class="codeph">RELOCATE</code>子句。要将连接从PDB的旧位置重定向到新位置，请指定<code class="codeph">AVAILABILITY MAX</code>子句。在需要时指定其他子句。
                           </p>
                           <p>重新定位PDB后，它处于挂载模式，其状态为<code class="codeph">RELOCATING</code> 。您可以通过查询<code class="codeph">V$PDBS</code>视图中的<code class="codeph">OPEN_MODE</code>列来查看PDB的打开模式。您可以通过查询<code class="codeph">CDB_PDBS</code>或<code class="codeph">DBA_PDBS</code>视图的<code class="codeph">STATUS</code>列来查看PDB的<code class="codeph">STATUS</code> 。
                           </p>
                           <p>为PDB创建新的默认服务。该服务与PDB具有相同的名称，可用于访问PDB。必须正确配置Oracle Net Services才能使客户端访问此服务。</p>
                        </li>
                        <li>
                           <p>（可选）要确定文件复制操作的状态，请查询<code class="codeph">V$SESSION_LONGOPS</code> 。</p>
                           <p>该<code class="codeph">OPNAMES</code>列显示<code class="codeph">kpdbfCopyTaskCbk</code>的数据文件拷贝和<code class="codeph">kcrfremnoc</code>重做文件副本。
                           </p>
                        </li>
                        <li>
                           <p>以读/写模式打开新PDB。</p>
                           <p>需要此步骤才能完成新PDB与CDB的集成。在读/写模式下打开PDB后，其状态为<code class="codeph">NORMAL</code> 。如果尝试以只读模式打开PDB，则会返回错误。
                           </p>
                        </li>
                        <li>
                           <p>备份PDB。</p>
                           <p>除非备份PDB，否则无法恢复PDB。</p>
                           <div class="infoboxnote" id="GUID-F887DBA7-61A6-49FB-8400-40632765F1E1__GUID-A9FFF8B4-5144-40E0-B701-6D2154BAD23D">
                              <p class="notep1">注意：</p>
                              <p>如果在PDB重定位期间返回错误，则正在创建的PDB可能处于<code class="codeph">UNUSABLE</code>状态。您可以通过查询<code class="codeph">CDB_PDBS</code>或<code class="codeph">DBA_PDBS</code>视图来检查PDB状态，并通过检查警报日志了解有关PDB创建错误的更多信息。只能删除不可用的PDB，并且必须先删除它，然后才能创建与不可用的PDB同名的PDB。
                              </p>
                           </div>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-F887DBA7-61A6-49FB-8400-40632765F1E1__CEGHIBHC"></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-F887DBA7-61A6-49FB-8400-40632765F1E1__GUID-8E71C064-FAE4-4FC6-9043-FB79FA7D0BA4">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="q">“ <a href="administering-a-cdb-with-sql-plus.html#GUID-8F8B2FF8-7FA7-40CD-8AA5-ACABCD3964D8" title="您可以将CDB配置为在每个容器中使用本地撤消，或者对整个CDB使用共享撤消。">关于CDB撤消模式</a> ”</span></p>
                        </li>
                        <li>
                           <p><span class="q">“ <a href="administering-a-cdb-with-sql-plus.html#GUID-322C5C03-4C48-40CD-8230-0BA5F16BF96B" title="您可以使用ALTER PLUGGABLE DATABASE SQL语句或SQL * Plus STARTUP命令修改PDB的打开模式。">修改一个或多个PDB的开放模式</a> ”</span></p>
                        </li>
                        <li>
                           <p><a href="../nlspg/choosing-character-set.html#NLSPG1035" target="_blank"><span><cite>“Oracle数据库全球化支持指南”</cite></span></a> ，了解字符集和国家字符集的兼容性要求</p>
                        </li>
                        <li>
                           <p>有关备份PDB的信息，请参见<a href="../bradv/backing-up-database.html#BRADV428" target="_blank"><span><cite>“Oracle数据库备份和恢复用户指南”</cite></span></a></p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：重</strong> <a href="relocating-a-pdb.html#GUID-75519361-3DA2-4558-A7E5-64BC16FAFC7D" title="您可以将PDB移动到其他CDB或应用程序容器。">定位PDB</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-6A85B92C-0AE6-4737-BDBD-EA8256C09E55" name="GUID-6A85B92C-0AE6-4737-BDBD-EA8256C09E55"></a><h3 id="MULTI-GUID-6A85B92C-0AE6-4737-BDBD-EA8256C09E55" class="sect3"><span class="enumeration_section">8.6</span>重新定位PDB：示例</h3>
               <div>
                  <p>本节中的示例演示了使用SQL和DBCA的重定位。</p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="relocating-a-pdb.html#GUID-DA26CC0C-788C-4F7C-AEA8-ED0C3C32B578">从远程CDB重新定位PDB</a><br>此示例将名为<code class="codeph">pdb1</code>的PDB从远程CDB重定位到当前CDB。</li>
                     <li class="ulchildlink"><a href="relocating-a-pdb.html#GUID-146006B7-42F1-47EB-B1BA-C3F8E6DD89A8">使用DBCA重定位PDB：示例</a><br>此示例使用DBCA将名为<code class="codeph">pdb1</code>的PDB从远程CDB重定位到本地CDB，在该CDB中将其重命名为<code class="codeph">relpdb1</code> 。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：重</strong> <a href="relocating-a-pdb.html#GUID-75519361-3DA2-4558-A7E5-64BC16FAFC7D" title="您可以将PDB移动到其他CDB或应用程序容器。">定位PDB</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-DA26CC0C-788C-4F7C-AEA8-ED0C3C32B578" name="GUID-DA26CC0C-788C-4F7C-AEA8-ED0C3C32B578"></a><h4 id="MULTI-GUID-DA26CC0C-788C-4F7C-AEA8-ED0C3C32B578" class="sect4"><span class="enumeration_section">8.6.1</span>从远程CDB重新定位PDB</h4>
                  <div>
                     <p>此示例将名为<code class="codeph">pdb1</code>的PDB从远程CDB重定位到当前CDB。</p>
                     <div class="section">
                        <p>在此示例中，新PDB所属的根取决于运行<code class="codeph">CREATE PLUGGABLE DATABASE</code>语句时的当前容器：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>当前容器是CDB根时，将在CDB根目录中创建新的PDB。</p>
                           </li>
                           <li>
                              <p>当前容器是应用程序容器中的应用程序根时，新PDB将在应用程序根目录中创建为应用程序PDB。</p>
                           </li>
                        </ul>
                        <p>此示例在给定不同因素的情况下从远程CDB重定位名为<code class="codeph">pdb1</code>的PDB。此示例假定以下因素：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>当前用户在目标CDB的根目录中具有<code class="codeph">CREATE PLUGGABLE DATABASE</code>系统特权。</p>
                           </li>
                           <li>
                              <p>源CDB的数据库链接名称是<code class="codeph">lnk2src</code> 。使用以下SQL语句创建此数据库链接：</p>
                              <p><code class="codeph">创建公共数据库链接lnk2src连接到c ## myadmin IDENTIFIED BY <span class="codeinlineitalic">密码</span>使用'MYCDB';</code></p>
                              <p>公共用户<code class="codeph">c##myadmin</code>在源CDB中具有<code class="codeph">SYSOPER</code>管理权限和<code class="codeph">CREATE PLUGGABLE DATABASE</code>系统特权。</p>
                           </li>
                           <li>
                              <p><code class="codeph">PATH_PREFIX</code>子句不是必需的。
                              </p>
                           </li>
                           <li>
                              <p>不需要<code class="codeph">FILE_NAME_CONVERT</code>子句和<code class="codeph">CREATE_FILE_DEST</code>子句。
                              </p>
                              <p>已启用Oracle Managed Files，或者已设置<code class="codeph">PDB_FILE_NAME_CONVERT</code>初始化参数。这些文件将根据Oracle Managed Files配置或初始化参数设置移动到新位置。
                              </p>
                           </li>
                           <li>
                              <p>PDB不需要存储限制。因此，不需要<code class="codeph">STORAGE</code>子句。
                              </p>
                           </li>
                           <li>
                              <p>没有与将在目标位置创建的新临时文件同名的文件。因此， <code class="codeph">TEMPFILE REUSE</code>子句。
                              </p>
                           </li>
                           <li>
                              <p>应将连接从源PDB自动重定位到重定位的PDB。因此，包括<code class="codeph">AVAILABILITY MAX</code>子句。
                              </p>
                           </li>
                        </ul>
                        <p>以下语句将<code class="codeph">pdb1</code> PDB从源CDB重定位到当前CDB：</p><pre class="pre codeblock"><code>从pdb1创建可插入数据库pdb1 @ lnk2src RELOCATE AVAILABILITY MAX;</code></pre></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：重</strong> <a href="relocating-a-pdb.html#GUID-6A85B92C-0AE6-4737-BDBD-EA8256C09E55" title="本节中的示例演示了使用SQL和DBCA的重定位。">定位PDB：示例</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-146006B7-42F1-47EB-B1BA-C3F8E6DD89A8" name="GUID-146006B7-42F1-47EB-B1BA-C3F8E6DD89A8"></a><h4 id="MULTI-GUID-146006B7-42F1-47EB-B1BA-C3F8E6DD89A8" class="sect4"><span class="enumeration_section">8.6.2</span>使用DBCA重定位PDB：示例</h4>
                  <div>
                     <p>此示例使用DBCA将名为<code class="codeph">pdb1</code>的PDB从远程CDB重定位到本地CDB，在该CDB中将其重命名为<code class="codeph">relpdb1</code> 。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-146006B7-42F1-47EB-B1BA-C3F8E6DD89A8__GUID-0AF9187B-7A89-4A64-9D4E-1E44A7DA82A2">先决条件</p>
                        <p>此方案假定以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>本地数据库中的用户在根容器中具有<code class="codeph">CREATE PLUGGABLE DATABASE</code>权限。
                              </p>
                           </li>
                           <li>
                              <p>远程CDB处于本地撤消模式。</p>
                           </li>
                           <li>
                              <p>远程和本地CDB处于<code class="codeph">ARCHIVELOG</code>模式。
                              </p>
                           </li>
                           <li>
                              <p>数据库链接所连接的远程CDB中的公共用户具有<code class="codeph">CREATE PLUGGABLE DATABASE</code> ， <code class="codeph">SESSION</code>和<code class="codeph">SYSOPER</code>权限。
                              </p>
                           </li>
                           <li>
                              <p>本地和远程CDB安装了相同的选项。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-146006B7-42F1-47EB-B1BA-C3F8E6DD89A8__PREREQUISITES-9DAFF8A2">假设</p>
                        <p>此方案假定以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您正在CDB的主机上运行DBCA，该主机将包含重定位的PDB。本地CDB名为<code class="codeph">loccdb1</code> 。
                              </p>
                           </li>
                           <li>
                              <p>远程（源）CDB名为<code class="codeph">remcdb1</code> ，驻留在主机<code class="codeph">remcdb1host</code> 。远程CDB的实例名称是<code class="codeph">reminst</code> 。
                              </p>
                           </li>
                           <li>
                              <p>远程PDB（即要重定位的PDB）名为<code class="codeph">rempdb1</code> 。
                              </p>
                           </li>
                           <li>
                              <p>普通用户<code class="codeph">c##adminuser_remcdb1</code>驻留在<code class="codeph">remcdb1</code> 。
                              </p>
                           </li>
                           <li>
                              <p>管理用户<code class="codeph">locSYS</code>具有<code class="codeph">SYSDBA</code>的权限<code class="codeph">loccdb1</code> ，这对PDB被重新定位该CDB。
                              </p>
                           </li>
                           <li>
                              <p>管理用户<code class="codeph">remSYS</code>具有<code class="codeph">SYSDBA</code>的权限<code class="codeph">remcdb1</code> ，这是包含要搬迁PDB开行。
                              </p>
                           </li>
                           <li>
                              <p>重定位到<code class="codeph">loccdb1</code> ，PDB将重命名为<code class="codeph">relpdb1</code> 。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-146006B7-42F1-47EB-B1BA-C3F8E6DD89A8__GUID-A5FEF59A-A31C-490F-A28A-E53A68A8B822">
                        <p>以下静默命令将<code class="codeph">rempdb1</code> <code class="codeph">loccdb1</code>定位到<code class="codeph">loccdb1</code> ：</p><pre class="pre codeblock"><code>./dbca -silent -relocatePDB -sourceDB <span class="bold">remcdb1</span> -remotePDBName <span class="bold">rempdb1</span> -remoteDBConnString <span class="bold">remcdb1host：1521 / reminst</span> -remoteDBSYSDBAUserName <span class="bold">remSYS</span> -remoteDBSYSDBAUserPassword <span class="italic">remsyspwd</span> -dbLinkUsername <span class="bold">c ## adminuser_remcdb1</span> -dbLinkUserPassword <span class="italic">pwd4dblinkusr</span> -sysDBAUserName <span class="bold">locSYS</span> -sysDBAPassword <span class="italic">locsyspwd</span> -pdbName <span class="bold">relpdb1</span></code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-146006B7-42F1-47EB-B1BA-C3F8E6DD89A8__GUID-EFC6AA59-AE8E-4D34-9560-14F68CB9C456">
                        <p class="notep1">也可以看看：</p>
                        <p>有关DBCA命令的语法和语义的<a href="../admin/creating-and-configuring-an-oracle-database.html#GUID-5DD346B8-4404-48F1-A811-F39D739E4D05" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：重</strong> <a href="relocating-a-pdb.html#GUID-6A85B92C-0AE6-4737-BDBD-EA8256C09E55" title="本节中的示例演示了使用SQL和DBCA的重定位。">定位PDB：示例</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>