<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>使用C，C ++和Java的盒式磁带服务</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Data Cartridge Developer&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Data Cartridge Developer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="data-cartridge-developers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-10T07:34:53-08:00"></meta>
      <meta name="dcterms.title" content="Data Cartridge Developer&#39;s Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96431-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="reference.html" title="Previous" type="text/html"></link>
      <link rel="next" href="extensibility-constants-types-and-mappings.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="ADDCI"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="reference.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="extensibility-constants-types-and-mappings.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据盒式开发人员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="reference.html" property="item" typeof="WebPage"><span property="name">参考</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用C，C ++和Java的盒式磁带服务</li>
            </ol>
            <a id="GUID-43B4F11B-33E4-4722-93E0-9D8F809CC745" name="GUID-43B4F11B-33E4-4722-93E0-9D8F809CC745"></a><a id="ADDCI4180"></a>
            
            <h2 id="ADDCI-GUID-43B4F11B-33E4-4722-93E0-9D8F809CC745" class="sect2"><span class="enumeration_chapter">18</span>使用C，C ++和Java的盒式磁带服务</h2>
         </header>
         <div class="ind">
            <div>
               <p>使用C / C ++和Java的程序员可以使用盒式磁带服务。</p>
               <div class="infoboxnotealso" id="GUID-43B4F11B-33E4-4722-93E0-9D8F809CC745__GUID-BCFF4297-A6C2-4729-9D2B-E464CDBB0AB0">
                  <p class="notep1">也可以看看：</p>
                  <p><a href="../lnoci/oci-cartridge-functions.html#LNOCI190" target="_blank"><span class="italic">Oracle Call Interface Programmer's Guide</span></a> ，了解有关使用C的盒式磁带服务的更多详细信息</p>
               </div>
            </div><a id="ADDCI4934"></a><div class="props_rev_3"><a id="GUID-EBFF7A7F-2826-4353-8973-238FF1D9F8AA" name="GUID-EBFF7A7F-2826-4353-8973-238FF1D9F8AA"></a><h3 id="ADDCI-GUID-EBFF7A7F-2826-4353-8973-238FF1D9F8AA" class="sect3"><span class="enumeration_section">18.1</span>外部程序的OCI访问功能</h3>
               <div>
                  <p><span class="bold"></span>从外部过程调用时，服务例程可以引发异常，分配内存，并获取OCI句柄以回调服务器。要使用这些函数，必须指定<code class="codeph">WITH</code> <code class="codeph">CONTEXT</code>子句，该子句允许您将上下文结构传递给外部过程。上下文结构在头文件<code class="codeph">ociextp.h</code>声明如下：</p><pre class="oac_no_warn" dir="ltr">typedef struct OCIExtProcContext OCIExtProcContext;</pre><p>考虑服务例程如何使用上下文信息。有关更多信息和使用示例，请参阅“ <a href="../adfns/external-procedures.html#ADFNS1412" target="_blank"><span class="italic">Oracle数据库高级应用程序开发人员指南”。</span></a></p>
               </div><a id="ADDCI4935"></a><div class="props_rev_3"><a id="GUID-F8CAA8B2-2B18-45D0-9D97-5BF545FEBB7D" name="GUID-F8CAA8B2-2B18-45D0-9D97-5BF545FEBB7D"></a><h4 id="ADDCI-GUID-F8CAA8B2-2B18-45D0-9D97-5BF545FEBB7D" class="sect4"><span class="enumeration_section">18.1.1</span> OCIExtProcAllocCallMemory</h4>
                  <div>
                     <div class="section">
                        <p><span class="bold"></span>此服务例程在外部过程调用期间分配<span class="italic">n</span>个字节的内存。一旦控制返回PL / SQL，该函数分配的任何内存都将被释放。</p>
                        <p>不要使用任何其他功能来分配或释放内存。</p>
                        <p>该函数的C原型如下：</p><pre class="oac_no_warn" dir="ltr">void * OCIExtProcAllocCallMemory（OCIExtProcContext * with_context，size_t amount）;</pre><p>参数<span class="italic">with_context</span>和<span class="italic">amount</span>分别是上下文指针和要分配的字节数。该函数返回指向已分配内存的无类型指针。返回值为零表示失败。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADDCI4936"></a><div class="props_rev_3"><a id="GUID-DEFD4DC2-46D7-42B3-BF6E-92483887D2DB" name="GUID-DEFD4DC2-46D7-42B3-BF6E-92483887D2DB"></a><h4 id="ADDCI-GUID-DEFD4DC2-46D7-42B3-BF6E-92483887D2DB" class="sect4"><span class="enumeration_section">18.1.2</span> OCIExtProcRaiseExcp</h4>
                  <div>
                     <div class="section">
                        <p><a id="d58689e282" class="indexterm-anchor"></a><a id="d58689e284" class="indexterm-anchor"></a>此服务例程引发预定义的异常，该异常必须具有<code class="codeph">1</code>到<code class="codeph">32767</code>范围内的有效Oracle错误号。在进行任何必要的清理后，外部程序必须立即返回。（没有为<code class="codeph">OUT</code>或<code class="codeph">IN</code> <code class="codeph">OUT</code>参数赋值。）该函数的C原型如下：</p><pre class="oac_no_warn" dir="ltr">int OCIExtProcRaiseExcp（OCIExtProcContext * with_context，size_t error_number）;</pre><p>参数<span class="italic">with_context</span>和<span class="italic">error_number</span>是上下文指针和Oracle错误号。返回值<code class="codeph">OCIEXTPROC_SUCCESS</code>和<code class="codeph">OCIEXTPROC_ERROR</code>表示成功或失败。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADDCI4937"></a><div class="props_rev_3"><a id="GUID-D9917140-D034-4F5F-99B2-556DB03AC837" name="GUID-D9917140-D034-4F5F-99B2-556DB03AC837"></a><h4 id="ADDCI-GUID-D9917140-D034-4F5F-99B2-556DB03AC837" class="sect4"><span class="enumeration_section">18.1.3</span> OCIExtProcRaiseExcpWithMsg</h4>
                  <div>
                     <div class="section">
                        <p><a id="d58689e377" class="indexterm-anchor"></a><a id="d58689e379" class="indexterm-anchor"></a>此服务例程引发用户定义的异常并返回用户定义的错误消息。该函数的C原型如下：</p><pre class="oac_no_warn" dir="ltr">int OCIExtProcRaiseExcpWithMsg（OCIExtProcContext * with_context，size_t error_number，text * error_message，size_t len）;</pre><p>参数<code class="codeph">with_context</code> ， <code class="codeph">error_number</code>和<code class="codeph">error_message</code>是上下文指针，Oracle错误号和错误消息文本。参数<span class="italic">len</span>存储错误消息的长度。如果消息是以null结尾的字符串，则<span class="italic">len</span>为零。返回值<code class="codeph">OCIEXTPROC_SUCCESS</code>和<code class="codeph">OCIEXTPROC_ERROR</code>表示成功或失败。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADDCI4938"></a><div class="props_rev_3"><a id="GUID-5C3DBB35-F468-4FDE-B482-8616E5966EB9" name="GUID-5C3DBB35-F468-4FDE-B482-8616E5966EB9"></a><h4 id="ADDCI-GUID-5C3DBB35-F468-4FDE-B482-8616E5966EB9" class="sect4"><span class="enumeration_section">18.1.4</span> OCIExtProcGetEnv</h4>
                  <div>
                     <div class="section">
                        <p>此服务例程在外部过程调用期间启用对数据库的OCI回调。使用此功能获得的OCI句柄仅用于回调。如果将它们用于标准OCI调用，则句柄将建立与数据库的新连接，并且不能用于同一事务中的回调。换句话说，在外部过程调用期间，您可以使用OCI句柄进行回调或新连接，但不能同时使用。</p>
                        <p>该函数的C原型如下：</p><pre class="oac_no_warn" dir="ltr">剑OCIExtProcGetEnv（OCIExtProcContext * with_context，OCIEnv ** envh，OCISvcCtx ** svch，OCIError ** errh）;</pre><p>参数<span class="italic">with_context</span>是上下文指针，参数<span class="italic">envh</span> ， <span class="italic">svch</span>和<span class="italic">errh</span>分别是OCI环境，服务和错误句柄。返回值<code class="codeph">OCIEXTPROC_SUCCESS</code>和<code class="codeph">OCIEXTPROC_ERROR</code>表示成功或失败。
                        </p>
                        <p><span class="q">“ <a href="implementing-data-cartridges-in-C-CPP-and-java.html#GUID-FE168081-19E5-4991-87C2-40E68995850D">使用回调</a> ”</span>显示了如何在回调中使用<code class="codeph">OCIExtProcGetEnv</code> 。有关工作示例，请参阅PL / SQL演示目录中的脚本extproc.sql。 <a id="d58689e500" class="indexterm-anchor"></a><a id="d58689e504" class="indexterm-anchor"></a> （有关此目录的位置，请参阅Oracle安装或用户指南。）此脚本演示了调用外部过程。配套文件extproc.c包含外部过程的C源代码。要运行演示，请按照<code class="codeph">extproc</code>的说明进行操作。 <code class="codeph">sql</code> 。您必须使用具有<code class="codeph">CREATE</code> <code class="codeph">LIBRARY</code>权限的帐户。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="ADDCI4940"></a><a id="ADDCI4939"></a><div class="props_rev_3"><a id="GUID-450FE138-7826-4ADD-AD4C-B9056FDA8A9A" name="GUID-450FE138-7826-4ADD-AD4C-B9056FDA8A9A"></a><h3 id="ADDCI-GUID-450FE138-7826-4ADD-AD4C-B9056FDA8A9A" class="sect3"><span class="enumeration_section">18.2</span>安装Java Cartridge服务文件</h3>
               <div>
                  <div class="section">
                     <p>必须将<code class="codeph">ODCI.jar</code>和<code class="codeph">CartridgeServices.jar</code>文件安装到<code class="codeph">SYS</code>模式中才能使用此处描述的Java类。
                     </p>
                     <p>如果安装了Java选项，则必须安装<code class="codeph">ODCI.jar</code>和<code class="codeph">CartridgeServices.jar</code>文件。如果未安装Java选项，则不必执行此任务。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-450FE138-7826-4ADD-AD4C-B9056FDA8A9A__GUID-76347366-B714-486D-9F11-184D257F1C36">安装ODCI.jar和CartridgeServices.jar文件</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>激活SQL * Plus提示。</span><div><pre class="oac_no_warn" dir="ltr">C：\ SQLPLUS</pre></div>
                     </li>
                     <li class="stepexpand"><span>出现提示时，使用<code class="codeph">system</code>帐户登录。</span><div><pre class="oac_no_warn" dir="ltr">输入用户名：system输入密码： <span class="italic">password</span>
</pre></div>
                     </li>
                     <li class="stepexpand"><span>使用server-side loadjava命令安装类并在<code class="codeph">SYSTEM</code>模式中创建同义词。</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; call dbms_java.loadjava（' -  resolve -synonym -grant public -verbose vobs / jilip / Cartridge Services.jar'）; SQL&gt; call dbms_java.loadjava（' -  resolve -synonym -grant public -verbose vobs / jlib / ODCI.jar'）;</pre></div>
                     </li>
                  </ol>
                  <div class="section">
                     <p>有关安装<code class="codeph">jar</code>文件的更多详细信息，请参阅<a href="../upgrd/intro-to-upgrading-oracle-database.html#UPGRD001" target="_blank"><span class="italic">Oracle数据库升级指南</span></a> 。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="ADDCI4941"></a><div class="props_rev_3"><a id="GUID-CF359033-3ED3-4601-8070-5DB01287D38B" name="GUID-CF359033-3ED3-4601-8070-5DB01287D38B"></a><h3 id="ADDCI-GUID-CF359033-3ED3-4601-8070-5DB01287D38B" class="sect3"><span class="enumeration_section">18.3</span>盒式磁带服务 - 维护上下文</h3>
               <div>
                  <p>Java盒式服务用于维护上下文。它类似于OCI上下文管理服务。在服务器和盒式磁带代码之间切换上下文时，此类是必需的。</p>
               </div><a id="ADDCI4943"></a><a id="ADDCI4944"></a><a id="ADDCI4945"></a><a id="ADDCI4946"></a><a id="ADDCI4942"></a><div class="props_rev_3"><a id="GUID-A2345CF6-8A32-48DE-A248-F913111ECADD" name="GUID-A2345CF6-8A32-48DE-A248-F913111ECADD"></a><h4 id="ADDCI-GUID-A2345CF6-8A32-48DE-A248-F913111ECADD" class="sect4"><span class="enumeration_section">18.3.1</span> ContextManager</h4>
                  <div>
                     <div class="section">
                        <p>ContextManager是Oracle类中的一个扩展Object的构造函数。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-A2345CF6-8A32-48DE-A248-F913111ECADD__GUID-80D80BFF-37F4-4CD2-A05C-1634CDAF4A92"><span class="bold">类接口</span></p>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><pre class="oac_no_warn" dir="ltr">public static Hashtable ctx extends Object</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-A2345CF6-8A32-48DE-A248-F913111ECADD__GUID-D2224CC3-1F98-4165-BF46-7C0F3A796F90"><span class="bold">变量</span></p>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><pre class="oac_no_warn" dir="ltr">ctx public static Hashtable ctx</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-A2345CF6-8A32-48DE-A248-F913111ECADD__GUID-56FA58D6-5478-4862-9B4D-1A90EB9D6948"><span class="bold">构造函数</span></p>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><pre class="oac_no_warn" dir="ltr">ContextManager公共ContextManager（）</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-A2345CF6-8A32-48DE-A248-F913111ECADD__GUID-E44D62F7-EC8B-4333-B415-97E99670160E"><span class="bold">方法</span></p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>可以使用以下方法：</p><pre class="oac_no_warn" dir="ltr">setContext（类oracle中的静态方法）getContext（类oracle中的静态方法）clearContext（类oracle中的静态方法）</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADDCI4947"></a><div class="props_rev_3"><a id="GUID-33645707-174E-47E4-AD6D-7D18572DC731" name="GUID-33645707-174E-47E4-AD6D-7D18572DC731"></a><h4 id="ADDCI-GUID-33645707-174E-47E4-AD6D-7D18572DC731" class="sect4"><span class="enumeration_section">18.3.2</span> CountException（）</h4>
                  <div>
                     <div class="section">
                        <p>扩展<code class="codeph">Exception</code>构造方法。
                        </p><pre class="oac_no_warn" dir="ltr">类oracle。CartridgeServices。CountException</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADDCI4948"></a><div class="props_rev_3"><a id="GUID-71AAF380-990D-4739-AF32-ABF668F7575D" name="GUID-71AAF380-990D-4739-AF32-ABF668F7575D"></a><h4 id="ADDCI-GUID-71AAF380-990D-4739-AF32-ABF668F7575D" class="sect4"><span class="enumeration_section">18.3.3</span> CountException（String）</h4>
                  <div>
                     <div class="section">
                        <p>扩展<code class="codeph">Exception</code>构造方法。
                        </p><pre class="oac_no_warn" dir="ltr">public CountException（String s）</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADDCI4949"></a><div class="props_rev_3"><a id="GUID-7DF37B3F-7E33-4473-BA2C-FD7B11C68084" name="GUID-7DF37B3F-7E33-4473-BA2C-FD7B11C68084"></a><h4 id="ADDCI-GUID-7DF37B3F-7E33-4473-BA2C-FD7B11C68084" class="sect4"><span class="enumeration_section">18.3.4</span> InvalidKeyException（）</h4>
                  <div>
                     <div class="section">
                        <p>扩展<code class="codeph">Exception</code>构造方法。
                        </p><pre class="oac_no_warn" dir="ltr">public InvalidKeyException（String s）</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADDCI4950"></a><div class="props_rev_3"><a id="GUID-214828EF-461E-48C6-ABAA-3B3096D6B62F" name="GUID-214828EF-461E-48C6-ABAA-3B3096D6B62F"></a><h4 id="ADDCI-GUID-214828EF-461E-48C6-ABAA-3B3096D6B62F" class="sect4"><span class="enumeration_section">18.3.5</span> InvalidKeyException（String）</h4>
                  <div>
                     <div class="section">
                        <p>扩展<code class="codeph">Exception</code>构造方法。
                        </p><pre class="oac_no_warn" dir="ltr">public InvalidKeyException（String s）</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>