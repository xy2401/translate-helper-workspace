<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>对象的存储</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Object-Relational Developer&#39;s Guide "></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Object-Relational Developer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="object-relational-developers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-11T02:05:10-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96436-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="advanced-topics-for-oracle-objects.html" title="Previous" type="text/html"></link>
      <link rel="next" href="creating-indexes-on-typeids-or-attributes.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Object-Relational Developer&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="ADOBJ"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="advanced-topics-for-oracle-objects.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="creating-indexes-on-typeids-or-attributes.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">对象关系开发人员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="advanced-topics-for-oracle-objects.html" property="item" typeof="WebPage"><span property="name">Oracle Objects的高级主题</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">对象的存储</li>
            </ol>
            <a id="GUID-F4FCDD3D-31A2-413C-9BB9-D7AB01328BA6" name="GUID-F4FCDD3D-31A2-413C-9BB9-D7AB01328BA6"></a><a id="ADOBJ00601"></a>
            
            <h2 id="ADOBJ-GUID-F4FCDD3D-31A2-413C-9BB9-D7AB01328BA6" class="sect2"><span class="enumeration_section">8.1</span>对象的存储</h2>
         </header>
         <div class="ind">
            <div>
               <p>Oracle数据库自动将对象类型的复杂结构映射到简单的表结构中进行存储。</p>
               <p>话题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="storage-of-objects.html#GUID-E0AEDE3D-8853-4B5C-BF98-7E8F46808A21">叶级属性</a></p>
                  </li>
                  <li>
                     <p><a href="storage-of-objects.html#GUID-CD8D8B75-1BAF-49A4-A544-739E2E6513A8">行对象如何跨列拆分</a></p>
                  </li>
                  <li>
                     <p><a href="storage-of-objects.html#GUID-1AA0B39D-A5CC-4373-8448-CC335EF85754">带有列对象的表的隐藏列</a></p>
                  </li>
                  <li>
                     <p><a href="storage-of-objects.html#GUID-349CF29A-7F51-4142-9724-90D5F9CDFD6D">可替换列和对象表的隐藏列</a></p>
                  </li>
                  <li>
                     <p><a href="storage-of-objects.html#GUID-24976157-9ADE-43C6-AE1B-E36F4B89859C">存储REF</a></p>
                  </li>
                  <li>
                     <p><a href="storage-of-objects.html#GUID-8FED2189-0699-4F17-9D55-80A372788490">嵌套表的内部布局</a></p>
                  </li>
                  <li>
                     <p><a href="storage-of-objects.html#GUID-4E234EA1-844C-4AC1-842A-78308DC1298E">VARRAY的内部布局</a></p>
                  </li>
               </ul>
            </div><a id="ADOBJ7388"></a><div class="props_rev_3"><a id="GUID-E0AEDE3D-8853-4B5C-BF98-7E8F46808A21" name="GUID-E0AEDE3D-8853-4B5C-BF98-7E8F46808A21"></a><h3 id="ADOBJ-GUID-E0AEDE3D-8853-4B5C-BF98-7E8F46808A21" class="sect3"><span class="enumeration_section">8.1.1</span>叶级属性</h3>
               <div>
                  <p>对象类型类似于树结构，其中分支表示属性。作为对象的属性使用自己的属性生成子分支。</p>
                  <p>最终，每个分支都以一个内置类型的属性结束;例如<code class="codeph">NUMBER</code> ， <code class="codeph">VARCHAR2</code>或<code class="codeph">REF</code> ，或集合类型，例如<code class="codeph">VARRAY</code>或嵌套表。原始对象类型的每个叶级属性都存储在表列中。
                  </p>
                  <p>不是集合类型的<a href="glossary.html#GUID-2AC9D4C9-267C-4CC0-B7ED-D1F58CCAC94E"><span class="xrefglossterm">叶级属性</span></a>称为对象类型的<a href="glossary.html#GUID-2AC9D4C9-267C-4CC0-B7ED-D1F58CCAC94E"><span class="xrefglossterm">叶级标量属性</span></a> 。
                  </p>
                  <p>以下主题涉及<span class="q">“ <a href="key-features-object-relational-model.html#GUID-762DBDCA-70C3-4F33-AD03-D51E6151ECC8">如何在表中存储对象</a> ”</span>中对象表和关系表的讨论。
                  </p>
               </div>
            </div><a id="ADOBJ7389"></a><div class="props_rev_3"><a id="GUID-CD8D8B75-1BAF-49A4-A544-739E2E6513A8" name="GUID-CD8D8B75-1BAF-49A4-A544-739E2E6513A8"></a><h3 id="ADOBJ-GUID-CD8D8B75-1BAF-49A4-A544-739E2E6513A8" class="sect3"><span class="enumeration_section">8.1.2</span>行对象如何跨列拆分</h3>
               <div>
                  <p>在<a href="glossary.html#GUID-C007CD3D-0B4E-4225-886A-FB5632A06707"><span class="xrefglossterm">对象表中</span></a> ，Oracle数据库将每个叶级标量或<code class="codeph">REF</code>属性的数据存储在单独的列中。
                  </p>
                  <div class="infoboxnote" id="GUID-CD8D8B75-1BAF-49A4-A544-739E2E6513A8__GUID-AC1013DA-BDF4-429A-80AB-2A19D98F8319">
                     <p class="notep1">注意：</p>
                     <p>每个<code class="codeph">VARRAY</code>也存储在一列中，除非它太大。Oracle数据库将嵌套表类型的叶级属性存储在与对象表关联的单独表中。您必须将这些表声明为对象表声明的一部分。
                     </p>
                  </div>
                  <p>在对象表中检索或更改<a href="glossary.html#GUID-5F88FB08-465A-4974-8A06-4548984982FB"><span class="xrefglossterm">行对象</span></a>的属性时，数据库会对表的列执行相应的操作。访问<a href="glossary.html#GUID-5F88FB08-465A-4974-8A06-4548984982FB"><span class="xrefglossterm">行对象</span></a>本身的值会调用该类型的默认构造函数，使用对象表的列作为参数并生成对象的副本。
                  </p>
                  <p>数据库将系统生成的对象标识符存储在隐藏列中。数据库使用对象标识符为对象构造<code class="codeph">REF</code> 。
                  </p>
                  <div class="infoboxnotealso" id="GUID-CD8D8B75-1BAF-49A4-A544-739E2E6513A8__GUID-5170493E-6D80-4092-8596-E6BE7B72BBD0">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="q">“ <a href="storage-of-objects.html#GUID-4E234EA1-844C-4AC1-842A-78308DC1298E">VARRAY的内部布局</a> ”</span></p>
                        </li>
                        <li>
                           <p><span class="q">“ <a href="storage-of-objects.html#GUID-8FED2189-0699-4F17-9D55-80A372788490">嵌套表的内部布局</a> ”</span></p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="ADOBJ7390"></a><div class="props_rev_3"><a id="GUID-1AA0B39D-A5CC-4373-8448-CC335EF85754" name="GUID-1AA0B39D-A5CC-4373-8448-CC335EF85754"></a><h3 id="ADOBJ-GUID-1AA0B39D-A5CC-4373-8448-CC335EF85754" class="sect3"><span class="enumeration_section">8.1.3</span>具有列对象的表的隐藏列</h3>
               <div>
                  <p>当使用对象类型的列定义表（关系表）时，数据库会向表中添加对象类型的叶级属性的隐藏列。</p>
                  <p>每个对象类型列还有一个对应的隐藏列，用于存储列对象的NULL信息（即顶级对象和嵌套对象的原子空值）。</p>
               </div>
            </div><a id="ADOBJ7392"></a><a id="ADOBJ7391"></a><div class="props_rev_3"><a id="GUID-349CF29A-7F51-4142-9724-90D5F9CDFD6D" name="GUID-349CF29A-7F51-4142-9724-90D5F9CDFD6D"></a><h3 id="ADOBJ-GUID-349CF29A-7F51-4142-9724-90D5F9CDFD6D" class="sect3"><span class="enumeration_section">8.1.4</span>可替换列和对象表的隐藏列</h3>
               <div>
                  <p>可替换的列或对象表不仅具有列的对象类型的每个属性的隐藏列，而且还具有对象类型的任何子类型中添加的每个属性的隐藏列。</p>
                  <p>隐藏列存储插入可替换列中的任何子类型实例的这些属性的值。</p>
                  <p>除了类型判别列和空图像列之外，以下内容与<code class="codeph">person_typ</code>的可替换列相关联，由<a href="storage-of-objects.html#GUID-349CF29A-7F51-4142-9724-90D5F9CDFD6D__CJGBCCID">例8-1</a>创建</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><code class="codeph">person_typ</code>每个属性的隐藏列： <code class="codeph">idno</code> ， <code class="codeph">name</code>和<code class="codeph">phone</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">person_typ</code>的子类型的属性的隐藏列</p>
                     </li>
                  </ul>
                  <p>因此，以下内容可能与<code class="codeph">person_typ</code>的可替换列相关联：属性<code class="codeph">dept_id</code>和<code class="codeph">major</code> （对于<code class="codeph">student_typ</code> ）和<code class="codeph">number_hours</code> （对于<code class="codeph">part_time_student_typ</code> ）。
                  </p>
                  <p>创建子类型时，数据库会自动将子类型中新属性的隐藏列添加到包含新子类型的任何祖先类型的可替换列的表中。这些改进了表以存储新类型的数据。如果由于某种原因无法添加列，则回滚创建子类型。</p>
                  <p>使用带有<code class="codeph">VALIDATE</code>选项的<code class="codeph">DROP TYPE</code>删除子<code class="codeph">DROP TYPE</code>时，数据库会自动删除对于不包含数据的子类型唯一的属性的隐藏列。如果这些列包含数据，则会引发错误。
                  </p>
                  <p><a href="storage-of-objects.html#GUID-349CF29A-7F51-4142-9724-90D5F9CDFD6D__CJGBCCID">例8-1</a>创建了相关示例所需的类型。
                  </p>
                  <div class="example" id="GUID-349CF29A-7F51-4142-9724-90D5F9CDFD6D__CJGBCCID">
                     <p class="titleinexample">示例8-1创建类型并在表中插入</p><pre class="oac_no_warn" dir="ltr">- 删除为Ex.7-10创建的任何对象创建类型person_typ AS OBJECT（idno NUMBER，名称VARCHAR2（30），电话VARCHAR2（20），MAP成员函数get_idno返回号码）NOT FINAL; / CREATE TYPE BODY person_typ AS MAP MEMBER FUNCTION get_idno RETURN NUMBER IS BEGIN RETURN idno;结束;结束; / CREATE TYPE student_typ UNDER person_typ（dept_id NUMBER，major VARCHAR2（30））NOT FINAL; / CREATE TYPE part_time_student_typ UNDER student_typ（number_hours NUMBER）; / CREATE TYPE employee_typ UNDER person_typ（emp_id NUMBER，mgr VARCHAR2（30））; / CREATE TABLE person_obj_table OF person_typ; //对象表INSERT INTO person_obj_table VALUES（person_typ（12，'Bob Jones'，'650-555-0130'））; INSERT INTO person_obj_table VALUES（student_typ（51，'Joe Lane'，'1-650-555-0140'，12，'HISTORY'））; INSERT INTO person_obj_table VALUES（part_time_student_typ（52，'Kim Patel'，'1-650-555-0135'，14，'PHYSICS'，20））;</pre></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p>可替换列与隐藏的类型判别列相关联。隐藏列包含一个名为typeid的标识符，用于标识可替换列中每个对象的最具体类型。通常，typeid（ <code class="codeph">RAW</code> ）是一个字节，但对于大型层次结构，它可以大到四个字节。
                     </p>
                     <p>您可以使用<code class="codeph">SYS_TYPEID</code>函数找到指定对象实例的typeid。</p>
                     <p><a href="storage-of-objects.html#GUID-D01B6B39-C64E-4955-B022-D6D8FD6B91B9__CHDICDCE">例8-2</a>检索存储在<a href="storage-of-objects.html#GUID-349CF29A-7F51-4142-9724-90D5F9CDFD6D__CJGBCCID">例8-1</a>中创建的可替换对象表中的对象实例的typeid。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="ADOBJ7654"></a><div class="props_rev_3"><a id="GUID-D01B6B39-C64E-4955-B022-D6D8FD6B91B9" name="GUID-D01B6B39-C64E-4955-B022-D6D8FD6B91B9"></a><h3 id="ADOBJ-GUID-D01B6B39-C64E-4955-B022-D6D8FD6B91B9" class="sect3"><span class="enumeration_section">8.1.5</span>查询表中存储的对象类型</h3>
               <div>
                  <div class="section">
                     <p>您可以检索存储在可替换对象表中的对象实例的typeid。参见<a href="storage-of-objects.html#GUID-D01B6B39-C64E-4955-B022-D6D8FD6B91B9__CHDICDCE">例8-2</a> 。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-D01B6B39-C64E-4955-B022-D6D8FD6B91B9__CHDICDCE">
                     <p class="titleinexample">例8-2查询表中存储的对象的类型</p><pre class="oac_no_warn" dir="ltr">- 需要Ex。8-1 SELECT name， <span class="bold">SYS_TYPEID</span> （VALUE（p））typeid FROM person_obj_table p;</pre></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p>输出：</p><pre class="pre codeblock"><code>NAME TYPEID ------------------------------ ------------------ --------- Bob Jones 01 Joe Lane 02 Kim Patel 03</code></pre><p>目录视图<code class="codeph">USER_TYPES</code> ， <code class="codeph">DBA_TYPES,</code>和<code class="codeph">ALL_TYPES</code>包含<code class="codeph">TYPEID</code>列（未隐藏），该<code class="codeph">TYPEID</code>每种类型提供typeid值。您可以加入此列以获取与类型判别列中的typeids相对应的类型名称。
                     </p>
                     <div class="infoboxnotealso" id="GUID-D01B6B39-C64E-4955-B022-D6D8FD6B91B9__GUID-FA868184-E0EA-4E6F-864A-04AA53CB5459">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="functions-and-operators-useful-with-objects.html#GUID-05C7D6E4-F294-4632-B0B6-F7574DB5CDFE">SYS_TYPEID</a> ”</span>有关<code class="codeph">SYS_TYPEID</code> ，typeids和类型判别列的详细信息。
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="ADOBJ7393"></a><div class="props_rev_3"><a id="GUID-24976157-9ADE-43C6-AE1B-E36F4B89859C" name="GUID-24976157-9ADE-43C6-AE1B-E36F4B89859C"></a><h3 id="ADOBJ-GUID-24976157-9ADE-43C6-AE1B-E36F4B89859C" class="sect3"><span class="enumeration_section">8.1.6</span> REF的存储</h3>
               <div>
                  <p>当数据库将<code class="codeph">REF</code>构造为行对象时，构造的<code class="codeph">REF</code>由对象标识符（OID），对象表的一些元数据以及可选的<code class="codeph">ROWID</code> 。</p>
                  <p>一个的尺寸<code class="codeph">REF</code>中的列<code class="codeph">REF</code>类型取决于与列相关联的存储要求，如下：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>如果该列声明为<code class="codeph">REF</code> <code class="codeph">WITH</code> <code class="codeph">ROWID</code> ，则数据库将<code class="codeph">ROWID</code>存储在<code class="codeph">REF</code>列中。对于受约束的<code class="codeph">REF</code>列中的对象引用，将忽略<code class="codeph">ROWID</code>提示。
                        </p>
                     </li>
                     <li>
                        <p>如果将列声明为带有<code class="codeph">SCOPE</code>子句的<code class="codeph">REF</code> ，则由于省略了对象表元数据和<code class="codeph">ROWID</code> ，该列会减少。范围内的<code class="codeph">REF</code>长度为16个字节。
                        </p>
                     </li>
                  </ul>
               </div>
            </div><a id="ADOBJ7394"></a><div class="props_rev_3"><a id="GUID-8FED2189-0699-4F17-9D55-80A372788490" name="GUID-8FED2189-0699-4F17-9D55-80A372788490"></a><h3 id="ADOBJ-GUID-8FED2189-0699-4F17-9D55-80A372788490" class="sect3"><span class="enumeration_section">8.1.7</span>嵌套表的内部布局</h3>
               <div>
                  <p>嵌套表的行存储在单独的存储表中。每个嵌套表列都有一个关联的存储表。存储表包含该列中所有嵌套表的所有元素。存储表具有隐藏的<code class="codeph">NESTED_TABLE_ID</code>列，该列具有系统生成的值，允许Oracle数据库将嵌套的表元素映射回适当的行。
                  </p>
                  <p>您可以通过使存储表按索引进行组织来加速检索整个集合的查询。在<code class="codeph">STORE AS</code>子句中包含<code class="codeph">ORGANIZATION INDEX</code>子句。
                  </p>
                  <p>嵌套表类型可以包含对象或标量：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>如果元素是对象，则存储表就像一个对象表：对象类型的顶级属性成为存储表的列。但是，您无法将<code class="codeph">REF</code>构造到嵌套表中的对象，因为嵌套表行没有对象标识符列。
                        </p>
                     </li>
                     <li>
                        <p>如果元素是标量，则存储表包含一个名为<code class="codeph">COLUMN_VALUE</code>列，其中包含标量值。
                        </p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-8FED2189-0699-4F17-9D55-80A372788490__GUID-06F7880A-AB19-403E-9851-89DD96F34C4C">
                     <p class="notep1">也可以看看：</p>
                     <p>请参见<span class="q">“ <a href="design-considerations-for-collections.html#GUID-474BD701-F7A2-435B-AE93-00B5B3AD974B">嵌套表存储</a> ”</span> 。
                     </p>
                  </div>
               </div>
            </div><a id="ADOBJ7395"></a><div class="props_rev_3"><a id="GUID-4E234EA1-844C-4AC1-842A-78308DC1298E" name="GUID-4E234EA1-844C-4AC1-842A-78308DC1298E"></a><h3 id="ADOBJ-GUID-4E234EA1-844C-4AC1-842A-78308DC1298E" class="sect3"><span class="enumeration_section">8.1.8 VARRAY的</span>内部布局</h3>
               <div>
                  <p><code class="codeph">VARRAY</code>所有元素都存储在一列中。根据数组的大小，它可以内联存储或存储在<code class="codeph">BLOB</code> 。</p>
                  <div class="infoboxnotealso" id="GUID-4E234EA1-844C-4AC1-842A-78308DC1298E__GUID-624DF323-4AD8-4D01-8963-37CA86E8DAE8">
                     <p class="notep1">也可以看看：</p>
                     <p>有关详细信息，请参阅<a href="design-considerations-for-collections.html#GUID-92C119FE-CB10-485F-B3E9-C6DE56594650">变量的存储注意事项</a> 。
                     </p>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>