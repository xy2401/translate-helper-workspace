<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>Oracle RAC快速应用程序通知</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="JDBC Developer&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="JDBC Developer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="jdbc-developers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-02-13T13:20:37-08:00"></meta>
      <meta name="dcterms.title" content="JDBC Developer&#39;s Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="1999, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96471-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="JDBC-reference-information.html" title="Previous" type="text/html"></link>
      <link rel="next" href="JDBC-coding-tips.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="JJDBC"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="JDBC-reference-information.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="JDBC-coding-tips.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">JDBC开发人员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="appendixes.html" property="item" typeof="WebPage"><span property="name">附录</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Oracle RAC快速应用程序通知</li>
            </ol>
            <a id="GUID-672941ED-9553-4779-B1AD-7FEBC07603D6" name="GUID-672941ED-9553-4779-B1AD-7FEBC07603D6"></a><a id="JJDBC28934"></a>
            
            <h2 id="JJDBC-GUID-672941ED-9553-4779-B1AD-7FEBC07603D6" class="sect2"><span class="enumeration_chapter">B</span> Oracle RAC快速应用程序通知</h2>
         </header>
         <div class="ind">
            <div>
               <div class="section">
                  <p>从Oracle Database 12 <span class="italic">c</span>第1版（12.1）开始，如果您不使用通用连接池或Oracle RAC快速应用程序通知（FAN）API，则可以利用Oracle数据库的高可用性（HA）功能。带有活动网格链接（AGL）的Oracle WebLogic Server。
                  </p>
                  <p>本附录包括以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="Oracle-RAC-FAN-API.html#GUID-564CF905-2682-48DB-B818-94C5F65A29AB">Oracle RAC快速应用程序通知概述</a></p>
                     </li>
                     <li>
                        <p><a href="Oracle-RAC-FAN-API.html#GUID-4F5A94F1-0ED0-45C7-A52F-8E6F68F1D7DF">安装和配置Oracle RAC快速应用程序通知</a></p>
                     </li>
                     <li>
                        <p><a href="Oracle-RAC-FAN-API.html#GUID-FA425A8A-C25F-4CE8-A54E-50C038379AC5">使用Oracle RAC快速应用程序通知</a></p>
                     </li>
                     <li>
                        <p><a href="Oracle-RAC-FAN-API.html#GUID-B057A535-2AAE-4F91-BBFC-2FA596FEC689">实现连接池</a></p>
                     </li>
                  </ul>
                  <p>此功能取决于Oracle Notification System（ONS）消息传输机制。此功能需要将系统，服务器和客户端配置为使用ONS。</p>
                  <p>要使用Oracle RAC快速应用程序通知，必须在<code class="codeph">CLASSPATH</code>存在<code class="codeph">simplefan.jar</code>文件，并且必须在<code class="codeph">CLASSPATH</code>存在<code class="codeph">ons.jar</code>文件，或者必须在客户端中安装并运行Oracle Notification Services（ONS）客户端系统。
                  </p>
               </div>
               <!-- class="section" -->
            </div><a id="JJDBC28935"></a><div class="props_rev_3"><a id="GUID-564CF905-2682-48DB-B818-94C5F65A29AB" name="GUID-564CF905-2682-48DB-B818-94C5F65A29AB"></a><h3 id="JJDBC-GUID-564CF905-2682-48DB-B818-94C5F65A29AB" class="sect3"><span class="enumeration_section">B.1</span> Oracle RAC快速应用程序通知概述</h3>
               <div>
                  <p>Oracle RAC快速应用程序通知（FAN）功能提供了一个简化的API，用于通过回调机制访问FAN事件。此机制使第三方驱动程序，连接池和容器能够订阅，接收和处理FAN事件。这些API在本附录中称为Oracle RAC FAN API。</p>
                  <p>Oracle RAC FAN API提供FAN事件通知，用于开发能够充分利用Oracle Database HA功能的响应更快的应用程序。如果您不想使用通用连接池，但希望使用实现自己的连接池的FAN事件，则应使用Oracle RAC快速应用程序通知。</p>
                  <div class="infoboxnote" id="GUID-564CF905-2682-48DB-B818-94C5F65A29AB__GUID-BF23AFB9-218C-4D9C-923F-851E91FDF257">
                     <p class="notep1">注意：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>如果您不想实现自己的连接池，那么您应该使用Oracle通用连接池来获得Oracle RAC快速应用程序通知的所有优势，以及许多其他好处。</p>
                        </li>
                        <li>
                           <p>从Oracle Database 12 <span class="italic">c</span>第1版（12.1）开始，不支持隐式连接缓存（ICC）。Oracle建议改为使用通用连接池。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <p>您的应用程序可以通过以下方式响应FAN事件：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>侦听Oracle RAC服务关闭和节点关闭事件。</p>
                     </li>
                     <li>
                        <p>侦听表示任何Oracle RAC或全局数据服务（GDS）启动或重新启动的Oracle RAC服务启动事件。对于这些UP事件，FAN参数状态为<code class="codeph">UP</code> ， <code class="codeph">event_type</code>是以下之一： <code class="codeph">database</code> ， <code class="codeph">instance</code> ， <code class="codeph">service</code>或<code class="codeph">servicemember</code> 。
                        </p>
                     </li>
                     <li>
                        <p>支持Oracle Database Release 12 <span class="italic">c</span>和早期版本的FAN ONS事件语法和字段，例如，添加到每个事件的<code class="codeph">event_type</code>和<code class="codeph">timezone</code>字段， <code class="codeph">db_domain</code>字段添加到除节点或公共网络事件之外的每个事件， <code class="codeph">percentf</code>字段添加到运行时负载平衡（RLB）事件，等等。
                        </p>
                     </li>
                     <li>
                        <p>侦听负载平衡咨询事件并对其进行响应。</p>
                     </li>
                  </ul>
                  <p>此功能公开FAN事件，这些事件是运行Oracle RAC的集群发送的通知，用于通知订户有关在服务级别或节点级别发生的事件。支持的FAN事件如下：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>服务起来</p>
                        <p>service up事件通知连接池新实例可供使用，允许在新实例上创建会话。当前版本的Oracle RAC FAN API支持<code class="codeph">ServiceUpEvent</code>客户端API，即<code class="codeph">simplefan.jar</code>文件。
                        </p>
                     </li>
                     <li>
                        <p>服务下来</p>
                        <p>服务停机事件通知受管资源已关闭且当前无法访问。有两种类型的服务停机事件：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>指示服务的特定实例已关闭且实例不再能够接受工作的事件。</p>
                           </li>
                           <li>
                              <p>表示服务的所有情况都已关闭且服务不再能够接受工作的事件。</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>节点向下</p>
                        <p>节点关闭事件通知主机标识符标识的Oracle RAC节点已关闭且无法访问。当节点不再能够接受工作时，群集会发送节点关闭事件。</p>
                     </li>
                     <li>
                        <p>计划下来</p>
                        <p>计划的关闭事件包括除节点关闭事件之外的所有关闭事件。这些事件设置了以下两个字段： <code class="codeph">status=down</code>和<code class="codeph">reason=user</code> 。
                        </p>
                     </li>
                     <li>
                        <p>负载均衡咨询</p>
                        <p>负载平衡咨询事件提供负载平衡算法的度量标准。定期发送负载平衡建议，以通知订户可用节点之间的推荐工作分配。</p>
                     </li>
                  </ul>
                  <div class="infoboxnote" id="GUID-564CF905-2682-48DB-B818-94C5F65A29AB__GUID-3BA34760-5BD3-4C5F-8152-C8E38DD78831">
                     <p class="notep1">注意：</p>
                     <p>如果要实现自己的连接池，则只应使用Oracle RAC快速应用程序通知。否则，您应该使用Oracle通用连接池来获得Oracle RAC快速应用程序通知的所有优势，以及许多其他好处。</p>
                  </div>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="../jjucp/index.html" target="_blank"><span><cite>Oracle通用连接池开发人员指南</cite></span></a></li>
                     </ul>
                  </div>
               </div>
            </div><a id="JJDBC28936"></a><div class="props_rev_3"><a id="GUID-4F5A94F1-0ED0-45C7-A52F-8E6F68F1D7DF" name="GUID-4F5A94F1-0ED0-45C7-A52F-8E6F68F1D7DF"></a><h3 id="JJDBC-GUID-4F5A94F1-0ED0-45C7-A52F-8E6F68F1D7DF" class="sect3"><span class="enumeration_section">B.2</span>安装和配置Oracle RAC快速应用程序通知</h3>
               <div>
                  <div class="section">
                     <p>您可以通过执行以下步骤来安装Oracle RAC FAN API：</p>
                     <ol>
                        <li>
                           <p>从以下链接下载<code class="codeph">simplefan.jar</code>文件</p><pre class="oac_no_warn" dir="ltr">
<a href="http://www.oracle.com/technetwork/database/application-development/jdbc/jdbc-ucp-122-3110062.html" target="_blank">http://www.oracle.com/technetwork/database/application-development/jdbc/jdbc-ucp-122-3110062.html</a></pre></li>
                        <li>
                           <p>将<code class="codeph">simplefan.jar</code>文件添加到类路径中。
                           </p>
                        </li>
                        <li>
                           <p>在Java代码中执行以下操作：</p>
                           <ol type="a">
                              <li>
                                 <p>使用<code class="codeph">getInstance</code>方法获取<code class="codeph">FanManager</code>类的实例。
                                 </p>
                              </li>
                              <li>
                                 <p>使用<code class="codeph">FanManager</code>类的<code class="codeph">configure</code>方法配置事件守护程序。<code class="codeph">configure</code>方法设置以下属性：</p>
                                 <p><code class="codeph">onsNodes</code> ：此Java VM中的ONS运行时应与之通信的ONS守护程序的<code class="codeph">host:port</code>对的逗号分隔列表。该<code class="codeph">host</code>的<code class="codeph">host:port</code>对是运行ONS守护程序的系统的主机名。<code class="codeph">port</code>是该守护程序的本地端口配置参数。
                                 </p>
                                 <p><code class="codeph">onsWalletFile</code> ：ONS钱包文件的路径名。钱包文件是SSL用于存储SSL证书的本地钱包文件的路径。与ONS守护程序的钱包文件配置参数相同。
                                 </p>
                                 <p><code class="codeph">onsWalletPassword</code> ：访问ONS钱包文件的密码。
                                 </p>
                              </li>
                           </ol>
                        </li>
                     </ol>
                     <div class="infoboxnotealso" id="GUID-4F5A94F1-0ED0-45C7-A52F-8E6F68F1D7DF__GUID-1B503FB8-D058-40F7-BC11-605357BE3F1F">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关Oracle RAC FAN API的详细说明，请参阅<a href="../jafan/index.html" target="_blank"><span class="italic">Oracle Database RAC FAN事件Java API参考</span></a> 。
                              </p>
                           </li>
                           <li>
                              <p><a href="../jjucp/fast-connection-failover.html#JJUCP-GUID-0D8CD8C4-734F-49F7-8737-9AC03173C73F" target="_blank"><span><cite>Oracle通用连接池开发人员指南</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28946"></a><a id="JJDBC28945"></a><div class="props_rev_3"><a id="GUID-FA425A8A-C25F-4CE8-A54E-50C038379AC5" name="GUID-FA425A8A-C25F-4CE8-A54E-50C038379AC5"></a><h3 id="JJDBC-GUID-FA425A8A-C25F-4CE8-A54E-50C038379AC5" class="sect3"><span class="enumeration_section">B.3</span>使用Oracle RAC快速应用程序通知</h3>
               <div>
                  <div class="section">
                     <p>以下代码段解释了如何处理FAN down事件。此示例代码将事件数据打印到标准输出设备。</p>
                     <p>此示例代码演示了如何通过重载<code class="codeph">handleFanEvent</code>方法来接受不同的FAN事件通知作为参数来使用Oracle RAC FAN API。示例代码还显示事件数据，例如：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>发送FAN事件通知的系统的名称</p>
                        </li>
                        <li>
                           <p>FAN事件通知的时间戳</p>
                        </li>
                        <li>
                           <p>加载FAN事件通知的状态</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-FA425A8A-C25F-4CE8-A54E-50C038379AC5__CDCDJIAC">
                     <p class="titleinexample">示例B-1使用Oracle RAC FAN API进行FAN Down事件的示例代码示例</p><pre class="oac_no_warn" dir="ltr">......属性props = new Properties（）; props.putProperty（“serviceName”，“gl”）; FanSubscription sub = FanManager.getInstance（）。subscribe（props）; sub.addListener（new FanEventListener（））{public void handleFanEvent（ServiceDownEvent se）{try {System.out.println（event.getTimestamp（））;的System.out.println（event.getServiceName（））;的System.out.println（event.getDatabaseUniqueName（））;的System.out.println（event.getReason（））; ServiceMemberEvent me = se.getServiceMemberEvent（）;如果（我！= null）{System.out.println（me.getInstanceName（））;的System.out.println（me.getNodeName（））;的System.out.println（me.getServiceMemberStatus（））; ServiceCompositeEvent ce = se.getServiceCompositeEvent（）;如果（ce！= null）{System.out.println（ce.getServiceCompositeStatus（））; catch（Throwable t）{//处理所有异常和错误t.printStackTrace（System.err）; public void handleFanEvent（NodeDownEvent ne）{try {System.out.println（event.getTimestamp（））;的System.out.println（ne.getNodeName（））;的System.out.println（ne.getIncarnation（））; } catch（Throwable t）{//处理所有异常和错误t.printStackTrace（System.err）; public void handleFanEvent（LoadAdvisoryEvent le）{try {System.out.println（event.getTimestamp（））;的System.out.println（le.getServiceName（））;的System.out.println（le.getDatabaseUniqueName（））;的System.out.println（le.getInstanceName（））;的System.out.println（le.getPercent（））;的System.out.println（le.getServiceQuality（））;的System.out.println（le.getLoadStatus（））; } catch（Throwable t）{//处理所有异常和错误t.printStackTrace（System.err）; }}};</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-FA425A8A-C25F-4CE8-A54E-50C038379AC5__GUID-EFDF8F37-6AEB-455C-875E-196D1273B9F6">
                     <p class="titleinexample">示例B-2使用Oracle RAC FAN API进行FAN Up事件的示例代码示例</p>
                     <p>以下代码段说明了如何将Oracle RAC快速应用程序通知用于服务提升事件。该代码使用Oracle数据库12介绍了<span class="italic">C</span> 2版（12.2.0.1）新的Oracle RAC FAN的API，即<code class="codeph">FanUpEventListener</code>延伸的界面<code class="codeph">FanEventListener</code>接口和<code class="codeph">ServiceUpEvent</code> 。您必须实现<code class="codeph">FanUpEventListener</code>在你执行的类似的方式，客户端应用程序接口<code class="codeph">FanEventListener</code>接口。
                     </p><pre class="pre codeblock"><code>import oracle.simplefan。*; ...FanEventListener fanListener = new FanUpEventListener（）{public void handleEvent（ServiceUpEvent event）{......} //在这里指定下一个动作，当节点出现时public void handleEvent（NodeUpEvent event）{......} ......FanManager fanMngr = FanManager.getInstance（）;属性onsProps = new Properties（）; onsProps.setProperty（“onsNodes”，......）; fanMngr.configure（onsProps）;属性subscriptionProps = new Properties（）; subscriptionProps.setProperty（“serviceName”，......）; fanSubscription = fanMngr.subscribe（subscriptionProps）; fanSubscription.addListener（fanListener）; ...</code></pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="JJDBC28947"></a><div class="props_rev_3"><a id="GUID-B057A535-2AAE-4F91-BBFC-2FA596FEC689" name="GUID-B057A535-2AAE-4F91-BBFC-2FA596FEC689"></a><h3 id="JJDBC-GUID-B057A535-2AAE-4F91-BBFC-2FA596FEC689" class="sect3"><span class="enumeration_section">B.4</span>实现连接池</h3>
               <div>
                  <div class="section">
                     <p>您必须实现自己的连接池才能使用Oracle RAC FAN API。在使用Oracle RAC FAN API实现连接池之前，请考虑以下几点：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>Oracle RAC FAN API提供FAN事件的子集。</p>
                        </li>
                        <li>
                           <p>Oracle RAC FAN API仅支持ONS事件。如果您希望应用程序支持相应的超级集群事件，则可能需要添加订阅属性。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>