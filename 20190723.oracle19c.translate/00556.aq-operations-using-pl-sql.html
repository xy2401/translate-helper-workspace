<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="These topics describes the Oracle Database Advanced Queuing (AQ) PL/SQL operational interface."></meta>
      <meta name="description" content="These topics describes the Oracle Database Advanced Queuing (AQ) PL/SQL operational interface."></meta>
      <title>使用PL / SQL的Oracle数据库高级排队操作</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Advanced Queuing User&#39;s Guide "></meta>
      <meta property="og:description" content="These topics describes the Oracle Database Advanced Queuing (AQ) PL/SQL operational interface."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Advanced Queuing User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="oracle-database-advanced-queuing.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-02-12T10:53:09-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96511-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="aq-messaging-gateway-views.html" title="Previous" type="text/html"></link>
      <link rel="next" href="jms-introduction.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Oracle® Database Advanced Queuing"></meta>
    <meta name="dcterms.isVersionOf" content="ADQUE"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="aq-messaging-gateway-views.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="jms-introduction.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">高级排队用户指南</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用PL / SQL的Oracle数据库高级排队操作</li>
            </ol>
            <a id="GUID-B302CBDB-0B75-4BF6-B705-5DC3EA26E605" name="GUID-B302CBDB-0B75-4BF6-B705-5DC3EA26E605"></a><a id="ADQUE1000"></a>
            
            <h2 id="ADQUE-GUID-B302CBDB-0B75-4BF6-B705-5DC3EA26E605" class="sect2"><span class="enumeration_chapter">10</span>使用PL / SQL进行Oracle数据库高级排队操作</h2>
         </header>
         <div class="ind">
            <div>
               <p>这些主题描述了Oracle数据库高级队列（AQ）PL / SQL操作界面。</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="aq-operations-using-pl-sql.html#GUID-5A2D60AC-21B1-4F6E-BA1E-78071CA98FD4" title="对于安全队列，您必须在messages_properties参数中指定sender_id。">使用安全队列</a></p>
                  </li>
                  <li>
                     <p><a href="aq-operations-using-pl-sql.html#GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35" title="此过程将消息添加到指定的队列。">排队邮件</a></p>
                  </li>
                  <li>
                     <p><a href="aq-operations-using-pl-sql.html#GUID-92FCE63B-7713-443A-84A3-9F543F0A8819" title="使用ENQUEUE_ARRAY函数使用相应的消息属性数组将有效负载数组排入队列。">排队消息数组</a></p>
                  </li>
                  <li>
                     <p><a href="aq-operations-using-pl-sql.html#GUID-B5606574-8C70-41AE-A362-A753033C3A70" title="此过程指定要监视的队列。">听一个或多个队列</a></p>
                  </li>
                  <li>
                     <p><a href="aq-operations-using-pl-sql.html#GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54" title="此过程使来自指定队列的消息出列。">出列消息</a></p>
                  </li>
                  <li>
                     <p><a href="aq-operations-using-pl-sql.html#GUID-0B018200-824D-458D-98E7-7445AF8B628F" title="使用DEQUEUE_ARRAY函数将有效负载数组和相应的消息属性数组出列。">出列消息数组</a></p>
                  </li>
                  <li>
                     <p><a href="aq-operations-using-pl-sql.html#GUID-DBBE096A-EEA0-4E1E-AC3F-6E1B492D1FB5" title="此过程注册电子邮件地址，用户定义的PL / SQL过程或HTTP URL以进行消息通知。">注册通知</a></p>
                  </li>
                  <li>
                     <p><a href="aq-operations-using-pl-sql.html#GUID-4C80C7E8-DAD2-49CA-9294-895581A64378" title="此过程发布到匿名订阅列表，允许所有注册订阅的客户端获取持久消息的通知。">发布订阅者通知</a></p>
                  </li>
                  <li>
                     <p><a href="aq-operations-using-pl-sql.html#GUID-E4F131CA-964F-4DF7-86EE-FB37078DD157" title="此过程为LDAP服务器中的Oracle Database Advanced Queuing代理创建条目。">将代理添加到LDAP服务器</a></p>
                  </li>
                  <li>
                     <p><a href="aq-operations-using-pl-sql.html#GUID-E6B7E2DC-9FD6-4EA8-8A92-D9929B9EA1B7" title="此过程从LDAP服务器中删除Oracle Database Advanced Queuing代理的条目。">从LDAP服务器中删除代理</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-B302CBDB-0B75-4BF6-B705-5DC3EA26E605__GUID-28DFCBA4-B8D5-4261-91C3-8FA46FFA1784">
                  <p class="notep1">也可以看看：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="aq-program-interfaces.html#GUID-9A4C8FD4-235D-4F90-B757-3E36B2E5CF76" title="这些主题描述了在准备Oracle数据库高级队列（AQ）应用程序环境时必须使用的各种语言选项和元素以及需要考虑的问题。">Oracle数据库高级队列：程序化接口，</a>用于列出每个编程接口中的可用功能</p>
                     </li>
                     <li>
                        <p>有关PL / SQL接口的更多信息，请参阅<a href="../arpls/DBMS_AQ.html#ARPLS004" target="_blank"><span class="italic">Oracle数据库PL / SQL包和类型参考中的</span></a> “DBMS_AQ”</p>
                     </li>
                     <li>
                        <p>有关Java接口的更多信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adque&amp;id=JAJMS" target="_blank"><span class="italic">参见Oracle数据库高级队列Java API参考</span></a></p>
                     </li>
                     <li>
                        <p>“ <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adque&amp;id=LNOCI160" target="_blank"><span class="italic">Oracle调用接口程序员指南</span></a> ”中的“更多OCI关系函数”</p>
                     </li>
                     <li>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adque&amp;id=LNOCI090" target="_blank"><span class="italic">Oracle Call Interface Programmer's Guide中的</span></a> “OCI编程高级主题”，了解有关<a href="glossary.html#GUID-4C11A79C-E65E-4B48-8A30-E628E322B025"><span class="xrefglossterm">Oracle调用接口</span></a> （OCI）的更多信息</p>
                     </li>
                  </ul>
               </div>
            </div><a id="ADQUE2812"></a><div class="props_rev_3"><a id="GUID-5A2D60AC-21B1-4F6E-BA1E-78071CA98FD4" name="GUID-5A2D60AC-21B1-4F6E-BA1E-78071CA98FD4"></a><h3 id="ADQUE-GUID-5A2D60AC-21B1-4F6E-BA1E-78071CA98FD4" class="sect3"><span class="enumeration_section">10.1</span>使用安全队列</h3>
               <div>
                  <p>对于安全队列，您必须在<code class="codeph">messages_properties</code>参数中指定<code class="codeph">sender_id</code> 。
                  </p>
                  <p>有关<code class="codeph">sender_id</code>详细信息，请参阅“ <a href="../arpls/advanced-queuing-AQ-types.html#ARPLS71690" target="_blank"><span class="italic">Oracle数据库PL / SQL包和类型参考</span></a> ”中的“MESSAGE_PROPERTIES_T类型”。
                  </p>
                  <p>使用安全队列时，需要以下内容：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>您必须使用<code class="codeph">DBMS_AQADM.CREATE_AQ_AGENT</code>创建了有效的Oracle数据库高级队列代理。</p>
                     </li>
                     <li>
                        <p>您必须将<code class="codeph">sender_id</code>映射到具有安全队列的入队权限的数据库用户。使用<code class="codeph">DBMS_AQADM.ENABLE_DB_ACCESS</code>执行此操作。
                        </p>
                        <div class="infoboxnotealso" id="GUID-5A2D60AC-21B1-4F6E-BA1E-78071CA98FD4__GUID-D2FAC091-B405-4A6E-AEF0-2B80819A8CF1">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="aq-administrative-interface.html#GUID-ECF60C92-C8D6-4027-BE63-63C3D92872BD" title="DBMS_AQADM.CREATE_AQ_AGENT使用HTTP协议注册Oracle Database Advanced Queuing Internet访问的代理。">创建Oracle数据库高级排队代理</a> ”</span></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="aq-administrative-interface.html#GUID-8CD0B0E9-37F8-4B70-95BD-75DE22F92586" title="DBMS_AQADM.ENABLE_DB_ACCESS授予Oracle数据库高级排队Internet代理特定数据库用户的特权。应该先前使用CREATE_AQ_AGENT过程创建代理。">启用数据库访问</a> ”</span></p>
                              </li>
                           </ul>
                        </div>
                     </li>
                  </ul>
               </div>
            </div><a id="ADQUE2814"></a><a id="ADQUE2815"></a><a id="ADQUE2818"></a><a id="ADQUE2821"></a><a id="ADQUE2823"></a><a id="ADQUE2826"></a><a id="ADQUE2828"></a><a id="ADQUE2816"></a><a id="ADQUE2817"></a><a id="ADQUE2819"></a><a id="ADQUE2820"></a><a id="ADQUE2822"></a><a id="ADQUE2824"></a><a id="ADQUE2825"></a><a id="ADQUE2827"></a><a id="ADQUE2829"></a><a id="ADQUE2830"></a><a id="ADQUE2813"></a><div class="props_rev_3"><a id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35" name="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35"></a><h3 id="ADQUE-GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35" class="sect3"><span class="enumeration_section">10.2</span>排队消息</h3>
               <div>
                  <p>此过程将消息添加到指定的队列。</p>
                  <div class="section"><pre class="oac_no_warn" dir="ltr">DBMS_AQ.ENQUEUE（queue_name IN VARCHAR2，enqueue_options IN enqueue_options_t，message_properties IN message_properties_t，payload IN“ <span class="italic">type_name</span> ”，msgid OUT RAW）;</pre><p>在<a href="glossary.html#GUID-2028AECF-DB3E-40E2-99B6-A35674C08038"><span class="xrefglossterm">邮件</span></a>入队后，无法更新<a href="glossary.html#GUID-2028AECF-DB3E-40E2-99B6-A35674C08038"><span class="xrefglossterm">消息</span></a>有效内容。如果要更改消息有效内容，则必须使消息出列并将新消息排入队列。
                     </p>
                     <p>为了存储<code class="codeph">RAW</code>类型的有效负载，Oracle数据库高级队列创建一个带有<code class="codeph">LOB</code>列的<a href="glossary.html#GUID-45894F1F-4871-4A00-9171-2743821BAD3A"><span class="xrefglossterm">队列表</span></a>作为有效负载存储库。有效负载的最大大小取决于您用于访问Oracle数据库高级队列的编程接口。对于PL / SQL，Java和预编译器，限制为32K;对于OCI，限制是4G。</p>
                     <p>如果消息入队到没有<a href="glossary.html#GUID-F50CE039-717A-4D4C-B4D9-62EB3191885A"><span class="xrefglossterm">收件人</span></a>的多消息队列且<a href="glossary.html#GUID-583DEF67-C9BC-4B83-B8DC-2375A5BE08BB"><span class="xrefglossterm">队列</span></a>没有订户（或者与此消息匹配的基于规则的订户），则会引发Oracle错误ORA 24033。这是一条警告，该邮件将被丢弃，因为没有收件人或订阅者可以将邮件传递给谁。
                     </p>
                     <p>如果多个消息在同一秒中排队，那么它们都具有相同的<code class="codeph">enq_time</code> 。在这种情况下，消息出队的顺序取决于<code class="codeph">step_no</code> ，这是一个变量，对于具有相同<code class="codeph">enq_time</code>每条消息，该变量单调递增。对于在同一会话中排队的两个消息， <code class="codeph">enq_time</code>和<code class="codeph">step_no</code>都不相同。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDGBIHI">
                     <p class="subhead2" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__GUID-76732F12-5ED0-4BFB-8C7C-C41774B30189">入队选项</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p><code class="codeph">enqueue_options</code>参数指定可用于入队操作的选项。它具有以下属性：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a id="d61372e491" class="indexterm-anchor"></a><a id="d61372e495" class="indexterm-anchor"></a><code class="codeph">visibility</code></p>
                           <p><code class="codeph">visibility</code>属性指定了enqueue请求的事务行为。 <code class="codeph">ON_COMMIT</code> （默认值）使enqueue成为当前事务的一部分。<code class="codeph">IMMEDIATE</code>使入队操作成为一个自治事务，它在操作结束时提交。
                           </p>
                           <p>如果要使用<a href="glossary.html#GUID-E0E22C6A-42AE-41CF-A021-5CB63BABB48E"><span class="xrefglossterm">LOB</span></a>定位器，请不要使用<code class="codeph">IMMEDIATE</code>选项。LOB定位器仅在事务期间有效。您的定位器无效，因为<code class="codeph">immediate</code>选项会自动提交事务。
                           </p>
                           <p>您必须将<code class="codeph">visibility</code>属性设置为<code class="codeph">IMMEDIATE</code>才能使用缓冲消息传递。
                           </p>
                        </li>
                        <li>
                           <p><a id="d61372e534" class="indexterm-anchor"></a><code class="codeph">relative_msgid</code></p>
                           <p><code class="codeph">relative_msgid</code>属性指定序列偏差操作中引用的消息的消息标识符。除非使用<code class="codeph">BEFORE</code>属性指定<code class="codeph">sequence_deviation</code>否则将忽略此参数。
                           </p>
                        </li>
                        <li>
                           <p><a id="d61372e553" class="indexterm-anchor"></a><code class="codeph">sequence_deviation</code></p>
                           <p><code class="codeph">sequence_deviation</code>属性指定消息应该何时出列，相对于队列中已有的其他消息。<code class="codeph">BEFORE</code>将消息放在<code class="codeph">relative_msgid</code>指定的消息之前。<code class="codeph">TOP</code>将消息置于任何其他消息之前。
                           </p>
                           <p>为消息指定<code class="codeph">sequence_deviation</code>会对可以为此消息指定的延迟和优先级值引入一些限制。此消息的延迟必须小于或等于此消息入队之前的消息延迟。此消息的优先级必须大于或等于此消息入队之前的消息的优先级。
                           </p>
                           <div class="infoboxnote" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__GUID-392936A6-CAC3-4107-8ADD-DCD2DA03A3E7">
                              <p class="notep1">注意：</p>
                              <p>如果<code class="codeph">message_grouping</code>设置为<code class="codeph">TRANSACTIONAL</code>则在Oracle数据库高级队列<span class="italic">10g</span>第1版（10.1）之前的版本中， <code class="codeph">sequence_deviation</code>属性不起作用。</p>
                              <p>Oracle Database Advanced Queuing <span class="italic">10g</span>第2版（10.2）中不推荐使用序列偏差功能。
                              </p>
                           </div>
                        </li>
                        <li>
                           <p><code class="codeph">转型</code></p>
                           <p><code class="codeph">transformation</code>属性指定在排队消息之前应用的转换。转换函数的返回类型必须与队列的类型匹配。
                           </p>
                        </li>
                        <li>
                           <p><a id="d61372e609" class="indexterm-anchor"></a><code class="codeph">delivery_mode</code></p>
                           <p>如果<code class="codeph">delivery_mode</code>属性是默认的<code class="codeph">PERSISTENT</code> ，则该消息将作为持久消息入队。如果将其设置为<code class="codeph">BUFFERED</code> ，则将消息排入缓冲消息。不允许空值。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDEHJBH">
                     <p class="subhead2" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__GUID-BE7741DD-0DA3-4539-B78A-88875F18922E">消息属性</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p><code class="codeph">message_properties</code>参数包含Oracle数据库高级队列用于管理各个消息的信息。它具有以下属性：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a id="d61372e638" class="indexterm-anchor"></a><code class="codeph">priority</code></p>
                           <p><code class="codeph">priority</code>属性指定消息的优先级。它可以是任何数字，包括负数。数字越小表示优先级越高。
                           </p>
                        </li>
                        <li>
                           <p><a id="d61372e651" class="indexterm-anchor"></a><code class="codeph">delay</code></p>
                           <p><code class="codeph">delay</code>属性指定消息处于<code class="codeph">WAITING</code>状态的秒数。在此秒数之后，消息处于<code class="codeph">READY</code>状态并可用于出列。如果指定<code class="codeph">NO_DELAY</code> ，则该消息可用于立即出列。<code class="codeph">msgid</code>会覆盖<code class="codeph">delay</code>规范。
                           </p>
                           <div class="infoboxnote" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__GUID-CED76F26-467F-41C8-A970-CF3312DE1EF6">
                              <p class="notep1">注意：</p>
                              <p>缓冲消息传递不支持延迟。</p>
                           </div>
                        </li>
                        <li>
                           <p><a id="d61372e683" class="indexterm-anchor"></a><code class="codeph">expiration</code></p>
                           <p><code class="codeph">expiration</code>属性指定消息可用于出列的秒数，从消息达到<code class="codeph">READY</code>状态开始。如果消息在到期之前未出列，则将其移至<code class="codeph">EXPIRED</code>状态的异常队列。如果指定<code class="codeph">NEVER</code> ，则消息不会过期。
                           </p>
                           <div class="infoboxnote" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__GUID-6A23C691-6D72-479E-BA72-D8A16990074D">
                              <p class="notep1">注意：</p>
                              <p>消息延迟和到期由队列监视器（ <code class="codeph">QMN</code> ）后台进程强制执行。如果要使用Oracle Database Advanced Queuing的延迟和过期功能，则必须启动数据库的QMN进程。
                              </p>
                           </div>
                        </li>
                        <li>
                           <p><a id="d61372e711" class="indexterm-anchor"></a><a id="d61372e715" class="indexterm-anchor"></a><code class="codeph">correlation</code></p>
                           <p><code class="codeph">correlation</code>属性是在入队时由消息的制作者提供的标识符。
                           </p>
                        </li>
                        <li>
                           <p><a id="d61372e728" class="indexterm-anchor"></a><code class="codeph">attempts</code></p>
                           <p>所述<code class="codeph">attemps</code>属性指定已经进行出列消息的尝试次数。此参数不能在入队时设置。
                           </p>
                        </li>
                        <li>
                           <p><a id="d61372e741" class="indexterm-anchor"></a><code class="codeph">recipient_list</code></p>
                           <p><code class="codeph">recipient_list</code>参数仅对允许多个使用者的队列有效。默认收件人是队列订户。
                           </p>
                        </li>
                        <li>
                           <p><a id="d61372e754" class="indexterm-anchor"></a><code class="codeph">exception_queue</code></p>
                           <p><code class="codeph">exception_queue</code>属性指定在无法成功处理消息时将消息移动到的队列的名称。如果在移动时指定的异常队列不存在，则将消息移动到与队列表关联的缺省异常队列，并在警报日志中记录警告。
                           </p>
                        </li>
                        <li>
                           <p><a id="d61372e767" class="indexterm-anchor"></a><code class="codeph">delivery_mode</code></p>
                           <p>在入队时在消息属性中指定的<code class="codeph">delivery_mode</code>任何值都将被忽略。enqueue选项中指定的值用于设置消息的传递模式。如果未指定enqueue选项中的传递模式，则默认为持久性。
                           </p>
                        </li>
                        <li>
                           <p><a id="d61372e780" class="indexterm-anchor"></a><code class="codeph">enqueue_time</code></p>
                           <p><code class="codeph">enqueue_time</code>属性指定消息入队的时间。该值由系统确定，用户无法在入队时设置。
                           </p>
                           <div class="infoboxnote" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__GUID-646FD683-98E1-4FE4-9934-674E5317A11A">
                              <p class="notep1">注意：</p>
                              <p>由于系统时钟中的季节性变化信息（例如，在标准时间和夏令时之间切换）与每个队列表一起存储，因此季节性变化会自动反映在<code class="codeph">enqueue_time</code> 。如果由于某些其他原因更改了系统时钟，则必须重新启动Oracle Database Advanced Queuing数据库才能获取更改的时间。
                              </p>
                           </div>
                        </li>
                        <li>
                           <p><a id="d61372e799" class="indexterm-anchor"></a><code class="codeph">state</code></p>
                           <p><code class="codeph">state</code>属性指定出队时的消息状态。此参数不能在入队时设置。
                           </p>
                        </li>
                        <li>
                           <p><a id="d61372e812" class="indexterm-anchor"></a><code class="codeph">sender_id</code></p>
                           <p><code class="codeph">sender_id</code>属性是消息生产者在入队时指定的类型<code class="codeph">aq$_agent</code>的标识符。
                           </p>
                        </li>
                        <li>
                           <p><a id="d61372e829" class="indexterm-anchor"></a><code class="codeph">original_msgid</code></p>
                           <p>Oracle Database AQ使用original_msgid属性来传播消息。</p>
                        </li>
                        <li>
                           <p><a id="d61372e839" class="indexterm-anchor"></a><code class="codeph">transaction_group</code></p>
                           <p><code class="codeph">transaction_group</code>属性指定消息的事务组。此属性仅由<code class="codeph">DBMS_AQ.DEQUEUE_ARRAY</code>设置。此属性不能用于通过<code class="codeph">DBMS_AQ.ENQUEUE</code>或<code class="codeph">DBMS_AQ.ENQUEUE_ARRAY</code>设置消息的事务组。</p>
                        </li>
                        <li>
                           <p><a id="d61372e861" class="indexterm-anchor"></a><code class="codeph">user_property</code></p>
                           <p><code class="codeph">user_property</code>属性是可选的。它用于存储有关负载的其他信息。
                           </p>
                        </li>
                     </ul>
                     <p>以下主题中的示例使用与<a href="aq-administrative-interface.html#GUID-31CF7723-6AB8-455A-8841-8683D936DD3E" title="这些主题描述了Oracle数据库高级队列（AQ）管理界面。">Oracle数据库高级队列管理界面中</a>的示例相同的用户，消息类型，队列表和队列。如果尚未在测试环境中创建这些结构，则必须运行以下示例：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="aq-administrative-interface.html#GUID-7A35067E-0A52-4EC2-B0F8-3540E8554E41__CHDECGGJ">例8-1</a></p>
                        </li>
                        <li>
                           <p><a href="aq-administrative-interface.html#GUID-7A35067E-0A52-4EC2-B0F8-3540E8554E41__CHDJIFCF">例8-2</a></p>
                        </li>
                        <li>
                           <p><a href="aq-administrative-interface.html#GUID-7A35067E-0A52-4EC2-B0F8-3540E8554E41__CHDCBGCF">例8-3</a></p>
                        </li>
                        <li>
                           <p><a href="aq-administrative-interface.html#GUID-7A35067E-0A52-4EC2-B0F8-3540E8554E41__CHDBEADD">例8-5</a></p>
                        </li>
                        <li>
                           <p><a href="aq-administrative-interface.html#GUID-7A35067E-0A52-4EC2-B0F8-3540E8554E41__CHDEAEID">例8-7</a></p>
                        </li>
                        <li>
                           <p><a href="aq-administrative-interface.html#GUID-7A35067E-0A52-4EC2-B0F8-3540E8554E41__CHDFEDEC">例8-8</a></p>
                        </li>
                        <li>
                           <p><a href="aq-administrative-interface.html#GUID-E140B4B5-DB4C-4DFC-8F67-C032516D0324__CHDEFAFG">例8-23</a></p>
                        </li>
                        <li>
                           <p><a href="aq-administrative-interface.html#GUID-E140B4B5-DB4C-4DFC-8F67-C032516D0324__CHDHEAID">例8-25</a></p>
                        </li>
                        <li>
                           <p><a href="aq-administrative-interface.html#GUID-E140B4B5-DB4C-4DFC-8F67-C032516D0324__CHDHEACA">例8-26</a></p>
                        </li>
                        <li>
                           <p><a href="aq-administrative-interface.html#GUID-E140B4B5-DB4C-4DFC-8F67-C032516D0324__CHDGCFHI">例8-27</a></p>
                        </li>
                        <li>
                           <p><a href="aq-administrative-interface.html#GUID-E140B4B5-DB4C-4DFC-8F67-C032516D0324__CHDIAEEH">例8-28</a></p>
                        </li>
                        <li>
                           <p><a href="aq-administrative-interface.html#GUID-264A3C43-93B3-43B5-820F-C25F686E97BD__CHDCIADC">例8-36</a></p>
                        </li>
                     </ul>
                     <p>对于<a href="aq-administrative-interface.html#GUID-7A35067E-0A52-4EC2-B0F8-3540E8554E41__CHDECGGJ">示例8-1</a> ，您必须以具有管理权限的用户身份进行连接。对于上面列表中的其他示例，您可以以用户<code class="codeph">test_adm</code>进行连接。创建队列后，必须按<span class="q">“ <a href="aq-administrative-interface.html#GUID-8370927B-0D5E-4E75-A2A5-7309BC13219C" title="DBMS_AQADM.START_QUEUE启用指定的非分片队列以进行入队或出列。">启动队列</a> ”中的说明</span>启动它们。除非另有说明，否则您可以连接普通队列用户<code class="codeph">'test'</code>来运行所有示例。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__GUID-547D3A7A-CD28-41CF-9ABE-E4C33179EF4A">排队LOB类型消息</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p><a href="aq-operations-using-pl-sql.html#GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDGJCIG">例10-3</a>使用<a href="aq-administrative-interface.html#GUID-7A35067E-0A52-4EC2-B0F8-3540E8554E41__CHDECGGJ">例8-1中</a>创建的<code class="codeph">test.lob_type</code>消息有效负载对象类型创建过程<code class="codeph">blobenqueue()</code> 。在入队时，LOB属性设置为<code class="codeph">EMPTY_BLOB</code> 。在enqueue完成之后，但在提交事务之前，从<code class="codeph">test.lob_qtab</code>队列表的<code class="codeph">user_data</code>列中选择LOB属性。使用<code class="codeph">LOB</code>接口（可通过OCI和PL / SQL获得）将LOB数据写入队列。实际的排队操作如下所示</p>
                     <p>在出列时，消息有效负载将包含LOB定位器。您可以在出列后使用此LOB定位器，但在提交事务之前，可以读取LOB数据。这在<a href="aq-operations-using-pl-sql.html#GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__CHDGIIIC">例10-14中显示</a> 。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__GUID-54A30117-6D9C-4C38-8C05-DB438DF05CD3">将多个消息排入单个使用者队列</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p><a href="aq-operations-using-pl-sql.html#GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDGIJGG">例10-5</a>将六条消息排入<code class="codeph">test.obj_queue</code> 。这些消息在<a href="aq-operations-using-pl-sql.html#GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__CHDIACIJ">例10-17</a>中出列。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__GUID-D341EC8C-B504-4FA3-AAAC-D15A19F1FD81">将多个消息排入多消息队列</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p><a href="aq-operations-using-pl-sql.html#GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDBGAFA">示例10-6</a>要求您以用户<code class="codeph">'test_adm</code> '连接以将订户<code class="codeph">RED</code>和<code class="codeph">GREEN</code>添加到队列<code class="codeph">test.multiconsumer_queue</code> 。<a href="aq-operations-using-pl-sql.html#GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDHGEFG">示例10-7</a>需要订户。
                     </p>
                     <p><a href="aq-operations-using-pl-sql.html#GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDHGEFG">例10-7</a>将来自发送方001的多条消息排入队列。消息1适用于所有队列订户。MESSAGE 2适用于RED和BLUE。这些消息在<a href="aq-operations-using-pl-sql.html#GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__CHDIACIJ">例10-17</a>中出列。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__GUID-55E07B91-FFEE-4148-862C-6D502F4CA3B0">排队分组的消息</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p><a href="aq-operations-using-pl-sql.html#GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDFBDDD">例10-8</a>将三组消息排队，每组中有三条消息。这些消息在<a href="aq-operations-using-pl-sql.html#GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__CHDGAIBA">例10-16</a>中出列。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__GUID-361520D8-6C61-4AF3-8A8A-414E1493335B">将延迟和到期消息排入队列</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>在<a href="aq-operations-using-pl-sql.html#GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDIIGAG">示例10-9中</a> ，应用程序希望消息在不迟于一周之后出现，但不迟于三周后。由于到期时间是从最早的出队时间计算出来的，因此需要将到期时间设置为两周。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__I1005829">
                     <p class="titleinexample">示例10-1排队消息，指定队列名称和有效负载</p><pre class="oac_no_warn" dir="ltr">DECLARE enqueue_options DBMS_AQ.enqueue_options_t; message_properties DBMS_AQ.message_properties_t; message_handle RAW（16）; message test.message_typ; BEGIN消息：= test.message_typ（001，'TEST MESSAGE'，'给obj_queue的第一条消息'）; DBMS_AQ.ENQUEUE（queue_name =&gt;'test.obj_queue'，enqueue_options =&gt; enqueue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）;承诺;结束; /</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__I1005850">
                     <p class="titleinexample">示例10-2将消息排入队列，指定优先级</p><pre class="oac_no_warn" dir="ltr">DECLARE enqueue_options DBMS_AQ.enqueue_options_t; message_properties DBMS_AQ.message_properties_t; message_handle RAW（16）; message test.order_typ; BEGIN消息：= test.order_typ（002，'PRIORITY MESSAGE'，'priority 30'）; message_properties.priority：= 30; DBMS_AQ.ENQUEUE（queue_name =&gt;'test.priority_queue'，enqueue_options =&gt; enqueue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）;承诺;结束; /</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDGJCIG">
                     <p class="titleinexample">示例10-3为LOB类型消息创建入队过程</p><pre class="oac_no_warn" dir="ltr">创建或替换程序blobenqueue（msgno IN NUMBER）AS enq_userdata test.lob_typ; enq_msgid RAW（16）; enqueue_options DBMS_AQ.enqueue_options_t; message_properties DBMS_AQ.message_properties_t; lob_loc BLOB;缓冲RAW（4096）; BEGIN缓冲区：= HEXTORAW（RPAD（'FF'，4096，'FF'））; enq_userdata：= test.lob_typ（msgno，'Large Lob data'，EMPTY_BLOB（），msgno）; DBMS_AQ.ENQUEUE（queue_name =&gt;'test.lob_queue'，enqueue_options =&gt; enqueue_options，message_properties =&gt; message_properties，payload =&gt; enq_userdata，msgid =&gt; enq_msgid）; SELECT t.user_data.data INTO lob_loc FROM lob_qtab t WHERE t.msgid = enq_msgid; DBMS_LOB.WRITE（lob_loc，2000,1，buffer）;承诺;结束; /</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDGECGJ">
                     <p class="titleinexample">例10-4排队LOB类型消息</p><pre class="oac_no_warn" dir="ltr">开始为i IN 1..5 LOOP blobenqueue（i）;结束循环;结束; /</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDGIJGG">
                     <p class="titleinexample">示例10-5排队多个消息</p><pre class="oac_no_warn" dir="ltr">SET SERVEROUTPUT ON DECLARE enqueue_options DBMS_AQ.enqueue_options_t; message_properties DBMS_AQ.message_properties_t; message_handle RAW（16）; message test.message_typ; BEGIN消息：= test.message_typ（001，'ORANGE'，'ORANGE排在第一位。“）; DBMS_AQ.ENQUEUE（queue_name =&gt;'test.obj_queue'，enqueue_options =&gt; enqueue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）; message：= test.message_typ（001，'ORANGE'，'ORANGE也排在第二位。“）; DBMS_AQ.ENQUEUE（queue_name =&gt;'test.obj_queue'，enqueue_options =&gt; enqueue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）;消息：= test.message_typ（001，'黄色'，'黄色排队第三。“）; DBMS_AQ.ENQUEUE（queue_name =&gt;'test.obj_queue'，enqueue_options =&gt; enqueue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）; message：= test.message_typ（001，'VIOLET'，'VIOLET排队第四。“）; DBMS_AQ.ENQUEUE（queue_name =&gt;'test.obj_queue'，enqueue_options =&gt; enqueue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）; message：= test.message_typ（001，'PURPLE'，'PURPLE排队第五。“）; DBMS_AQ.ENQUEUE（queue_name =&gt;'test.obj_queue'，enqueue_options =&gt; enqueue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）; message：= test.message_typ（001，'PINK'，'PINK排队第六。“）; DBMS_AQ.ENQUEUE（queue_name =&gt;'test.obj_queue'，enqueue_options =&gt; enqueue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）;承诺;结束; /</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDBGAFA">
                     <p class="titleinexample">示例10-6添加订户RED和GREEN</p><pre class="oac_no_warn" dir="ltr">DECLARE订户sys.aq $ _agent; BEGIN subscriber：= sys.aq $ _agent（'RED'，NULL，NULL）; DBMS_AQADM.ADD_SUBSCRIBER（queue_name =&gt;'test.multiconsumer_queue'，subscriber =&gt; subscriber）; subscriber：= sys.aq $ _agent（'GREEN'，NULL，NULL）; DBMS_AQADM.ADD_SUBSCRIBER（queue_name =&gt;'test.multiconsumer_queue'，subscriber =&gt; subscriber）;结束; /</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDHGEFG">
                     <p class="titleinexample">示例10-7将多个消息排入多消息队列</p><pre class="oac_no_warn" dir="ltr">DECLARE enqueue_options DBMS_AQ.enqueue_options_t; message_properties DBMS_AQ.message_properties_t;收件人DBMS_AQ.aq $ _recipient_list_t; message_handle RAW（16）; message test.message_typ; BEGIN消息：= test.message_typ（001，'MESSAGE 1'，'For queue subscriber'）; DBMS_AQ.ENQUEUE（queue_name =&gt;'test.multiconsumer_queue'，enqueue_options =&gt; enqueue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）; message：= test.message_typ（001，'MESSAGE 2'，'For two recipients'）; recipients（1）：= sys.aq $ _agent（'RED'，NULL，NULL）; recipients（2）：= sys.aq $ _agent（'BLUE'，NULL，NULL）; message_properties.recipient_list：=收件人; DBMS_AQ.ENQUEUE（queue_name =&gt;'test.multiconsumer_queue'，enqueue_options =&gt; enqueue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）;承诺;结束; /</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDFBDDD">
                     <p class="titleinexample">示例10-8将分组消息排入队列</p><pre class="oac_no_warn" dir="ltr">DECLARE enqueue_options DBMS_AQ.enqueue_options_t; message_properties DBMS_AQ.message_properties_t; message_handle RAW（16）; message test.message_typ; BEGIN FOR groupno in 1..3 LOOP FOR msgno in 1..3 LOOP message：= test.message_typ（001，'GROUP'|| groupno，'Message'|| msgno ||'in group'|| groupno）; DBMS_AQ.ENQUEUE（queue_name =&gt;'test.group_queue'，enqueue_options =&gt; enqueue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）;结束循环;承诺;结束循环;结束; /</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDIIGAG">
                     <p class="titleinexample">示例10-9将消息排入队列，指定延迟和到期时间</p><pre class="oac_no_warn" dir="ltr">DECLARE enqueue_options DBMS_AQ.enqueue_options_t; message_properties DBMS_AQ.message_properties_t; message_handle RAW（16）; message test.message_typ; BEGIN消息：= test.message_typ（001，'DELAYED'，'消息延迟一周。“）; message_properties.delay：= 7 * 24 * 60 * 60; message_properties.expiration：= 2 * 7 * 24 * 60 * 60; DBMS_AQ.ENQUEUE（queue_name =&gt;'test.obj_queue'，enqueue_options =&gt; enqueue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）;承诺;结束; /</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__GUID-8E44D782-7D0F-4A57-82F1-4410AE9A27F1">
                     <p class="titleinexample">示例10-10排队消息，指定转换</p><pre class="oac_no_warn" dir="ltr">DECLARE enqueue_options DBMS_AQ.enqueue_options_t; message_properties DBMS_AQ.message_properties_t; message_handle RAW（16）; message test.message_typ; BEGIN消息：= test.message_typ（001，'NORMAL MESSAGE'，'enqueued to obj_queue'）; enqueue_options.transformation：='message_order_transform'; DBMS_AQ.ENQUEUE（queue_name =&gt;'test.priority_queue'，enqueue_options =&gt; enqueue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）;承诺;结束; /</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="ADQUE2832"></a><a id="ADQUE2831"></a><div class="props_rev_3"><a id="GUID-92FCE63B-7713-443A-84A3-9F543F0A8819" name="GUID-92FCE63B-7713-443A-84A3-9F543F0A8819"></a><h3 id="ADQUE-GUID-92FCE63B-7713-443A-84A3-9F543F0A8819" class="sect3"><span class="enumeration_section">10.3</span>排队消息数组</h3>
               <div>
                  <p>使用<code class="codeph">ENQUEUE_ARRAY</code>函数使用相应的消息属性数组将有效负载数组排入队列。
                  </p>
                  <div class="section"><pre class="oac_no_warn" dir="ltr">DBMS_AQ.ENQUEUE_ARRAY（queue_name IN VARCHAR2，enqueue_options IN enqueue_options_t，array_size IN PLS_INTEGER，message_properties_array IN message_properties_array_t，payload_array IN VARRAY，msid_array OUT msgid_array_t）RETURN PLS_INTEGER;</pre><p>输出是排队消息的消息标识符数组。该函数返回成功入队的消息数。</p>
                     <p>缓冲消息不支持数组入队，但您仍然可以使用<code class="codeph">DBMS_AQ.ENQUEUE_ARRAY()</code>通过将<code class="codeph">array_size</code>设置为<code class="codeph">1</code>来使缓冲的消息入队。
                     </p>
                     <p><a id="d61372e1196" class="indexterm-anchor"></a> <code class="codeph">message_properties_array</code>参数是消息属性的数组。有效负载数组中的每个元素必须在此记录中具有相应的元素。阵列中的所有消息都具有相同的传递模式。
                     </p>
                     <p>有效负载结构可以是VARRAY或嵌套表。消息ID返回到<code class="codeph">DBMS_AQ.msgid_array_t</code>类型的RAW（16）条目数组中。
                     </p>
                     <p>与关系世界中的数组操作一样，不可能提供在所有情况下都是正确的单个最佳阵列大小。应用程序开发人员必须尝试不同的数组大小，以确定其特定应用程序的最佳值。</p>
                     <div class="p">
                        <div class="infoboxnotealso" id="GUID-92FCE63B-7713-443A-84A3-9F543F0A8819__GUID-C7F9D646-5989-437A-90E9-724FA0FD0D0C">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“入队<a href="aq-operations-using-pl-sql.html#GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDGBIHI">选项</a> ”</span></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="aq-operations-using-pl-sql.html#GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDEHJBH">消息属性</a> ”</span></p>
                                 <p></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-92FCE63B-7713-443A-84A3-9F543F0A8819__CHDHAFJA">
                     <p class="titleinexample">示例10-11排队消息数组</p><pre class="oac_no_warn" dir="ltr">DECLARE enqueue_options DBMS_AQ.enqueue_options_t; msg_prop_array DBMS_AQ.message_properties_array_t; msg_prop DBMS_AQ.message_properties_t; payload_array test.msg_table; msgid_array DBMS_AQ.msgid_array_t; retval PLS_INTEGER; BEGIN payload_array：= msg_table（message_typ（001，'MESSAGE 1'，'数组入队到obj_queue'），message_typ（001，'MESSAGE 2'，'数组入队到obj_queue'））; msg_prop_array：= DBMS_AQ.message_properties_array_t（msg_prop，msg_prop）; retval：= DBMS_AQ.ENQUEUE_ARRAY（queue_name =&gt;'test.obj_queue'，enqueue_options =&gt; enqueue_options，array_size =&gt; 2，message_properties_array =&gt; msg_prop_array，payload_array =&gt; payload_array，msgid_array =&gt; msgid_array）;承诺;结束;/</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="ADQUE2834"></a><a id="ADQUE2833"></a><div class="props_rev_3"><a id="GUID-B5606574-8C70-41AE-A362-A753033C3A70" name="GUID-B5606574-8C70-41AE-A362-A753033C3A70"></a><h3 id="ADQUE-GUID-B5606574-8C70-41AE-A362-A753033C3A70" class="sect3"><span class="enumeration_section">10.4</span>收听一个或多个队列</h3>
               <div>
                  <p>此过程指定要监视的队列。</p>
                  <div class="section"><pre class="oac_no_warn" dir="ltr">DBMS_AQ.LISTEN（agent_list IN aq $ _agent_list_t，等待IN BINARY_INTEGER DEFAULT FOREVER，listen_delivery_mode IN PLS_INTEGER DEFAULT PERSISTENT，agent OUT sys.aq $ _agent message_delivery_mode OUT PLS_INTEGER）; TYPE aq $ _agent_list_t是BINARY_INTEGER的aq $ _agent INDEXED的表;</pre><p>此调用将代理列表作为参数。每个代理都由名称，地址和协议的唯一组合标识。</p>
                     <p>您可以在列出的每个代理的地址字段中指定要监视的队列。代理必须具有每个受监视队列的出列权限。监控多个用户队列时，必须指定代理的名称;但是您不能为单个使用者队列指定代理名称。仅支持本地队列作为地址。协议保留供将来使用。</p>
                     <div class="infoboxnote" id="GUID-B5606574-8C70-41AE-A362-A753033C3A70__GUID-C30E8565-C2A5-4CAA-88D8-2CB98D12F85E">
                        <p class="notep1">注意：</p>
                        <p>Java <a href="glossary.html#GUID-2003BA71-5534-477C-990D-5ABE432A5907"><span class="xrefglossterm">API</span></a>不支持侦听多队列队列。</p>
                     </div>
                     <p><a id="d61372e1335" class="indexterm-anchor"></a><a id="d61372e1337" class="indexterm-anchor"></a><a id="d61372e1339" class="indexterm-anchor"></a><a id="d61372e1341" class="indexterm-anchor"></a><a id="d61372e1345" class="indexterm-anchor"></a><a id="d61372e1349" class="indexterm-anchor"></a> <code class="codeph">listen_delivery_mode</code>参数指定代理感兴趣的消息类型。如果它是默认的<code class="codeph">PERSISTENT</code> ，则仅向代理通知持久性消息。如果将其设置为<code class="codeph">BUFFERED</code> ，则仅向代理通知缓冲的消息。如果将其设置为<code class="codeph">PERSISTENT_OR_BUFFERED</code> ，则会向代理通知两种类型。
                     </p>
                     <p>这是一个阻塞调用，当有消息准备好供列表中的代理使用时，它会返回代理和消息类型。如果有多个代理的消息，则仅返回列出的第一个代理。如果在等待时间到期时没有找到消息，则会引发错误。</p>
                     <p>来自<code class="codeph">listen</code>调用的成功返回仅表示在一个指定队列中存在针对所列代理之一的消息。感兴趣的代理人仍然必须将相关消息出列。
                     </p>
                     <div class="infoboxnote" id="GUID-B5606574-8C70-41AE-A362-A753033C3A70__GUID-5B5EB749-0D97-42BD-BA20-88A7A6C8159B">
                        <p class="notep1">注意：</p>
                        <p>您不能在<a href="glossary.html#GUID-A91ACE79-576B-49F6-BE03-D4A792B9B468"><span class="xrefglossterm">非持久</span></a>队列上调用<code class="codeph">LISTEN</code> 。
                        </p>
                     </div>
                     <p>尽管<code class="codeph">test.obj_queue</code>和<code class="codeph">test.priority_queue</code>都包含消息（分别在<a href="aq-operations-using-pl-sql.html#GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__I1005829">例10-1</a>和<a href="aq-operations-using-pl-sql.html#GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__I1005850">例10-2中</a>排队），但<a href="aq-operations-using-pl-sql.html#GUID-B5606574-8C70-41AE-A362-A753033C3A70__I1006167">示例10-12</a>仅返回：</p><pre class="oac_no_warn" dir="ltr">队列中的消息：“TEST”。“OBJ_QUEUE”</pre><p>如果<code class="codeph">test_agent_list</code>的代理顺序颠倒过来，那么<code class="codeph">test.priority_queue</code>出现在<code class="codeph">test.obj_queue</code>之前，那么示例将返回：</p><pre class="oac_no_warn" dir="ltr">队列中的消息：“TEST”。“PRIORITY_QUEUE”</pre><div class="p">
                        <div class="infoboxnotealso" id="GUID-B5606574-8C70-41AE-A362-A753033C3A70__GUID-838E4211-ABD3-4179-AF08-A4210592F6CD">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="aq-basic-components.html#GUID-2C5557D9-E11B-4AB9-94E0-F923C85D6E0A" title="该组件标识消息的生产者或消费者。">AQ代理类型</a> ”</span></p>
                        </div>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-B5606574-8C70-41AE-A362-A753033C3A70__I1006167">
                     <p class="titleinexample">示例10-12使用零超时收听单个使用者队列</p><pre class="oac_no_warn" dir="ltr">SET SERVEROUTPUT ON DECLARE代理sys.aq $ _agent; test_agent_list DBMS_AQ.aq $ _agent_list_t; BEGIN test_agent_list（1）：= sys.aq $ _agent（NULL，'test.obj_queue'，NULL）; test_agent_list（2）：= sys.aq $ _agent（NULL，'test.priority_queue'，NULL）; DBMS_AQ.LISTEN（agent_list =&gt; test_agent_list，wait =&gt; 0，agent =&gt; agent）; DBMS_OUTPUT.PUT_LINE（'队列中的消息：'|| agent.address）;结束; /</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="ADQUE2836"></a><a id="ADQUE2838"></a><a id="ADQUE2841"></a><a id="ADQUE2843"></a><a id="ADQUE2845"></a><a id="ADQUE2837"></a><a id="ADQUE2839"></a><a id="ADQUE2840"></a><a id="ADQUE2842"></a><a id="ADQUE2844"></a><a id="ADQUE2846"></a><a id="ADQUE2847"></a><a id="ADQUE2835"></a><div class="props_rev_3"><a id="GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54" name="GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54"></a><h3 id="ADQUE-GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54" class="sect3"><span class="enumeration_section">10.5出</span>列消息</h3>
               <div>
                  <p>此过程使来自指定队列的消息出列。</p>
                  <div class="section"><pre class="oac_no_warn" dir="ltr">DBMS_AQ.DEQUEUE（queue_name IN VARCHAR2，dequeue_options IN dequeue_options_t，message_properties OUT message_properties_t，payload OUT“ <span class="italic">type_name</span> ”，msgid OUT RAW）;</pre><p>您可以选择仅将持久性消息，仅缓冲消息或两者都出列。请参阅以下dequeue选项列表中的<code class="codeph">delivery_mode</code> 。
                     </p>
                     <div class="infoboxnotealso" id="GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__GUID-1829FDEA-E6AF-4073-92A1-F448F7A7DBA5">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="aq-operations-using-pl-sql.html#GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDEHJBH">消息属性</a> ”</span></p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__CHDBBGGE">
                     <p class="subhead2" id="GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__GUID-C982B34C-340F-4111-A84C-5EB96605498E">出列选项</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p><code class="codeph">dequeue_options</code>参数指定可用于出列操作的选项。它具有以下属性：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a id="d61372e1550" class="indexterm-anchor"></a><code class="codeph">consumer_name</code></p>
                           <p>使用者可以通过提供在<code class="codeph">AQ$_AGENT</code>的<code class="codeph">AQ$_AGENT</code>类型中使用的名称来从队列<code class="codeph">AQ$_AGENT</code>出<code class="codeph">DBMS_AQADM</code> 。 <code class="codeph">ADD_SUBSCRIBER</code>过程或消息属性的收件人列表。如果指定了值，则仅访问与<code class="codeph">consumer_name</code>匹配的那些消息。如果没有为多个使用者设置队列，则必须将此字段设置为NULL（默认值）。
                           </p>
                        </li>
                        <li>
                           <p><a id="d61372e1572" class="indexterm-anchor"></a><code class="codeph">dequeue_mode</code></p>
                           <p><code class="codeph">dequeue_mode</code>属性指定与出列关联的锁定行为。如果指定了<code class="codeph">BROWSE</code> ，则消息将在不获取任何锁定的情况下出列。如果指定了<code class="codeph">LOCKED</code> ，则消息将使用写入锁定出列，该写入锁定持续到事务的持续时间。如果指定了<code class="codeph">REMOVE</code> ，则消息将被出列并删除（默认值）。可以根据保留属性将消息保留在队列表中。如果指定了<code class="codeph">REMOVE_NO_DATA</code> ，则将消息标记为已更新或已删除。
                           </p>
                        </li>
                        <li>
                           <p><a id="d61372e1597" class="indexterm-anchor"></a><code class="codeph">navigation</code></p>
                           <p><code class="codeph">navigation</code>属性指定出列消息的位置。如果指定了<code class="codeph">FIRST_MESSAGE</code> ，则匹配搜索条件的第一个可用消息将出列。如果指定了<code class="codeph">NEXT_MESSAGE</code> ，则下一个与搜索条件匹配的可用消息将出列（默认值）。如果先前的消息属于消息组，则与消息组中的搜索条件匹配的下一个可用消息将出列。
                           </p>
                           <p>如果指定了<code class="codeph">NEXT_TRANSACTION</code> ，则跳过当前事务组中的任何消息，并将下一个事务组的第一条消息出列。仅当为队列启用了邮件分组时，才能使用此设置。
                           </p>
                        </li>
                        <li>
                           <p><a id="d61372e1621" class="indexterm-anchor"></a><a id="d61372e1625" class="indexterm-anchor"></a><code class="codeph">visibility</code></p>
                           <p><code class="codeph">visibility</code>属性指定新消息何时出列。如果指定了<code class="codeph">ON_COMMIT</code> ，则dequeue是当前事务的一部分（默认值）。如果指定了<code class="codeph">IMMEDIATE</code> ，则dequeue操作是在操作结束时提交的自治事务。<code class="codeph">BROWSE</code>出队模式中忽略<code class="codeph">visibility</code>属性。
                           </p>
                           <p>使用交付模式<code class="codeph">DBMS_AQ.BUFFERED</code>或<code class="codeph">DBMS_AQ.PERSISTENT_OR_BUFFERED</code>消息进行出列时，可见性必须始终为<code class="codeph">IMMEDIATE</code> 。</p>
                        </li>
                        <li>
                           <p><a id="d61372e1661" class="indexterm-anchor"></a><code class="codeph">wait</code></p>
                           <p>如果当前没有可用的消息与搜索条件匹配，则<code class="codeph">wait</code>属性指定等待时间。如果指定了数字，则操作将等待该秒数。如果指定了<code class="codeph">FOREVER</code> ，则操作将永远等待（默认值）。如果指定了<code class="codeph">NO_WAIT</code> ，则操作不会等待。
                           </p>
                        </li>
                        <li>
                           <p><a id="d61372e1680" class="indexterm-anchor"></a><code class="codeph">msgid</code></p>
                           <p><code class="codeph">msgid</code>属性指定出列消息的消息标识符。除非指定了<code class="codeph">msgid</code>否则只有处于<code class="codeph">READY</code>状态的消息才会出列。
                           </p>
                        </li>
                        <li>
                           <p><a id="d61372e1699" class="indexterm-anchor"></a><a id="d61372e1703" class="indexterm-anchor"></a><code class="codeph">correlation</code></p>
                           <p>correlation属性指定出队消息的相关标识符。在没有指定<code class="codeph">FIRST_MESSAGE</code>导航选项的情况下，不能在连续的出队呼叫之间更改相关标识符。
                           </p>
                           <p>关联标识符是Oracle Database Advanced Queuing不解释的应用程序定义的标识符。您可以使用特殊模式匹配字符，例如百分号和下划线。如果多个消息满足该模式，则出列的顺序是不确定的，并且不遵守队列的排序顺序。</p>
                           <div class="infoboxnote" id="GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__GUID-375C4287-02E6-4B0D-B46D-1F948E0097A2">
                              <p class="notep1">注意：</p>
                              <p>虽然缓冲消息支持出列选项<code class="codeph">correlation</code>和<code class="codeph">deq_condition</code> ，但是无法创建索引来优化这些查询。
                              </p>
                           </div>
                        </li>
                        <li>
                           <p><a id="d61372e1727" class="indexterm-anchor"></a><code class="codeph">deq_condition</code></p>
                           <p><code class="codeph">deq_condition</code>属性是一个类似于SQL查询的WHERE子句的布尔表达式。此布尔表达式可以包括有关消息属性，用户数据属性（仅限对象有效内容）以及PL / SQL或SQL函数的条件。
                           </p>
                           <p>要在消息有效内容（对象有效内容）上指定出列条件，请在子句中使用对象类型的属性。必须使用<code class="codeph">tab.user_data</code>作为限定符为每个属性添加前缀，以指示存储有效内容的队列表的特定列。
                           </p>
                           <p><code class="codeph">deq_condition</code>属性不能超过4000个字符。如果多个消息满足出列条件，则出列的顺序是不确定的，并且不遵守队列的排序顺序。
                           </p>
                        </li>
                        <li>
                           <p><a id="d61372e1750" class="indexterm-anchor"></a><code class="codeph">transformation</code></p>
                           <p><code class="codeph">transformation</code>属性指定在消息出列之后但在将消息返回给调用者之前应用的转换。
                           </p>
                        </li>
                        <li>
                           <p><a id="d61372e1763" class="indexterm-anchor"></a><code class="codeph">delivery_mode</code></p>
                           <p><code class="codeph">delivery_mode</code>属性指定要出列的消息类型。如果将其设置为<code class="codeph">DBMS_AQ.PERSISTENT</code> ，则只将持久性消息出列。如果它设置为<code class="codeph">DBMS_AQ.BUFFERED</code> ，则只有缓冲的消息出列。
                           </p>
                           <p>如果它是默认的<code class="codeph">DBMS_AQ.PERSISTENT_OR_BUFFERED</code> ，则持久和缓冲的消息都会出列。出列消息的消息属性中的<code class="codeph">delivery_mode</code>属性指示出列消息是缓冲的还是持久的。
                           </p>
                        </li>
                     </ul>
                     <p>出列顺序由创建队列表时指定的值确定，除非被出列选项中的消息标识符和相关标识符覆盖。</p>
                     <p>数据库一致性读取机制适用于队列操作。例如， <code class="codeph">BROWSE</code>调用可能看不到在浏览事务开始后排队的消息。
                     </p>
                     <p>在<a href="glossary.html#GUID-F4FC927D-BBFE-451D-9CCA-96C7387A39B0"><span class="xrefglossterm">提交时队列中</span></a> ，消息对<code class="codeph">BROWSE</code>或<code class="codeph">DEQUEUE</code>调用不可见，直到可以基于<a href="glossary.html#GUID-30A3A407-F784-4083-9041-D548D9E1C6C5"><span class="xrefglossterm">近似CSCN</span></a>在它们之间建立确定性顺序。</p>
                     <p>如果<code class="codeph">dequeue_conditions</code>参数的<code class="codeph">navigation</code>属性是<code class="codeph">NEXT</code> _ <code class="codeph">MESSAGE</code> （默认值），则后续的队列将根据在第一个队列中获取的快照从队列中检索消息。因此，只有在处理队列中的所有剩余消息之后，才会处理在第一个dequeue命令之后排队的消息。如果所有消息都已排队或队列没有基于优先级的排序，则这不是问题。但是，如果应用程序必须处理队列中的最高优先级消息，那么它必须使用<code class="codeph">FIRST_MESSAGE</code>导航选项。
                     </p>
                     <div class="infoboxnote" id="GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__GUID-8E7AAAEC-9DCE-4CCC-905B-8942EFE5EC15">
                        <p class="notep1">注意：</p>
                        <p>当有消息同时入队时，使用<code class="codeph">FIRST_MESSAGE</code>导航选项也会更有效。如果未指定<code class="codeph">FIRST_MESSAGE</code>选项，则Oracle Database Advanced Queuing会在第一个dequeue命令中不断生成快照，从而导致性能下降。如果指定了<code class="codeph">FIRST_MESSAGE</code>选项，则Oracle Database Advanced Queuing会为每个dequeue命令使用新快照。
                        </p>
                     </div>
                     <p>将同一事务中排队的消息放入已启用消息分组的队列中，形成一个组。如果事务中只有一条消息入队，那么这实际上形成了一组消息。可以在单个事务中分组的消息数没有上限。</p>
                     <p>在尚未启用消息分组的队列中， <code class="codeph">LOCKED</code>或<code class="codeph">REMOVE</code>模式下的出队仅锁定单个消息。相反，寻求使作为组的一部分的消息出列的出列操作锁定整个组。当组中的所有消息必须作为一个单元处理时，这非常有用。
                     </p>
                     <p>当组中的所有消息都已出列时，出队返回一个错误，指示已处理该组中的所有消息。然后，应用程序可以使用<code class="codeph">NEXT_TRANSACTION</code>开始从下一个可用组中出列消息。如果没有可用的组，则dequeue会在<code class="codeph">dequeue_options</code>的<code class="codeph">wait</code>属性中指定的时间段后<code class="codeph">dequeue_options</code> 。
                     </p>
                     <p>通常，您希望消息使用者使用出列接口访问消息。您可以通过按消息ID或使用<code class="codeph">SELECT</code>命令进行浏览来查看仍处理的已处理消息或消息。
                     </p>
                     <p><a href="aq-operations-using-pl-sql.html#GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__I1007064">例10-13</a>返回<a href="aq-operations-using-pl-sql.html#GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__I1005829">例10-1中</a>排队的消息。它返回：</p><pre class="oac_no_warn" dir="ltr">来自Sender No.1主题：TEST MESSAGE文本：obj_queue的第一条消息</pre><div class="infoboxnotealso" id="GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__GUID-8152627B-1C44-45C5-9318-9F2CAC878BA8">
                        <p class="notep1">也可以看看：</p>
                        <p></p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="aq-introduction.html#GUID-AA8621D3-88E6-460A-8EC4-8EE6F53DE56A__CHDCEDDG">出局模式</a> ”</span></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__GUID-9176C3FC-41D5-4ECE-AC76-45D87ABB2A95">出列LOB类型消息</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p><a href="aq-operations-using-pl-sql.html#GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__CHDGIIIC">例10-14</a>创建了一个<code class="codeph">blobdequeue()</code>过程，用于使<a href="aq-operations-using-pl-sql.html#GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDGECGJ">示例10-4中</a>排队的LOB类型消息出列。实际的出队率如<a href="aq-operations-using-pl-sql.html#GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__CHDDJJDC">例10-15</a>所示。它返回：</p><pre class="oac_no_warn" dir="ltr">读取的数据量：2000读取的数据量：2000读取的数据量：2000读取的数据量：2000读取的数据量：2000</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__GUID-20130382-02AC-4E0A-81DD-38C8BFDB7315">将分组消息出列</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>您可以通过运行<a href="aq-operations-using-pl-sql.html#GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__CHDGAIBA">示例10-16将</a> <a href="aq-operations-using-pl-sql.html#GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDFBDDD">示例10-8中</a>排队的分组消息出列。它返回：</p><pre class="oac_no_warn" dir="ltr">组1：组1中的消息1组1：组1中的消息2组1：组1中的消息3完成组1组2：组2中的消息1组2：组2中的消息2组2：组中的消息3 2完成的GROUP 2组3：组3中的消息1组3：组3中的消息2组3：组3中的消息3完成组3没有更多消息</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__GUID-383818A3-E888-4864-A6C3-D89FD80DA1CC">从多消息队列中出队</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>您可以通过运行<a href="aq-operations-using-pl-sql.html#GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__CHDIACIJ">示例10-17将</a> <a href="aq-operations-using-pl-sql.html#GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDHGEFG">示例10-7中</a>为<code class="codeph">RED</code>排队的消息出列。如果将<code class="codeph">RED</code>更改为<code class="codeph">GREEN</code>然后更改为<code class="codeph">BLUE</code> ，则可以使用它将其消息出列。在每种情况下，示例的输出都是不同的。
                     </p>
                     <p><code class="codeph">RED</code>是多消费者队列的订阅者，也是MESSAGE 2的指定接收者，因此它获取两个消息：</p><pre class="oac_no_warn" dir="ltr">消息：消息1 ..对于队列订阅者消息：MESSAGE 2 ..对于两个收件人没有更多的RED消息</pre><p><code class="codeph">GREEN</code>只是一个订阅者，因此它只获取队列中没有指定收件人的消息（在本例中为MESSAGE 1）：</p><pre class="oac_no_warn" dir="ltr">消息：消息1 ..对于队列订阅者没有更多绿色消息</pre><p>然而， <code class="codeph">BLUE</code>虽然不是队列的订户，但仍被指定接收MESSAGE 2。
                     </p><pre class="oac_no_warn" dir="ltr">消息：MESSAGE 2 ..对于两个收件人没有更多蓝色消息</pre><p><a href="aq-operations-using-pl-sql.html#GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__CHDBJBDB">例10-18</a>浏览在<a href="aq-operations-using-pl-sql.html#GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDGIJGG">例10-5中</a>排队的消息，直到找到它删除的PINK。该示例返回：</p><pre class="oac_no_warn" dir="ltr">浏览消息文本：ORANGE首先排队。浏览消息文本：ORANGE也排在第二位。浏览消息文本：YELLOW排队第三。浏览消息文本：VIOLET排队第四。浏览消息文本：PURPLE排队第五。浏览消息文本：PINK排队第六。删除了消息文本：PINK排队第六。</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__GUID-5AC58A5D-35D0-4D5C-9650-EDB98872FEBF">出列模式</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p><a href="aq-operations-using-pl-sql.html#GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__CHDDCJFF">示例10-19</a>以锁定模式预览<a href="aq-operations-using-pl-sql.html#GUID-1CEA86B9-4FDF-445F-93C1-67E21C033D35__CHDGIJGG">示例10-5中</a>排队的消息，直到找到PURPLE，并将其删除。该示例返回：</p><pre class="oac_no_warn" dir="ltr">锁定消息文本：ORANGE首先排队。锁定的消息文本：ORANGE也排在第二位。锁定的消息文本：黄色排队第三。锁定的消息文本：VIOLET排队第四。锁定的消息文本：PURPLE排队第五。删除了消息文本：PURPLE排队第五。</pre></div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__I1007064">
                     <p class="titleinexample">示例10-13使对象类型消息出列</p><pre class="oac_no_warn" dir="ltr">SET SERVEROUTPUT ON DECLARE dequeue_options DBMS_AQ.dequeue_options_t; message_properties DBMS_AQ.message_properties_t; message_handle RAW（16）; message test.message_typ; BEGIN dequeue_options.navigation：= DBMS_AQ.FIRST_MESSAGE; DBMS_AQ.DEQUEUE（queue_name =&gt;'test.obj_queue'，dequeue_options =&gt; dequeue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）; DBMS_OUTPUT.PUT_LINE（'From Sender No.'|| message.sender_id）; DBMS_OUTPUT.PUT_LINE（'Subject：'|| message.subject）; DBMS_OUTPUT.PUT_LINE（'Text：'|| message.text）;承诺;结束; /</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__CHDGIIIC">
                     <p class="titleinexample">示例10-14为LOB类型消息创建出列过程</p><pre class="oac_no_warn" dir="ltr">创建或替换过程blobdequeue（msgno IN NUMBER）AS dequeue_options DBMS_AQ.dequeue_options_t; message_properties DBMS_AQ.message_properties_t; msgstr RAW（16）;有效载荷test.lob_typ; lob_loc BLOB;金额BINARY_INTEGER;缓冲RAW（4096）; BEGIN DBMS_AQ.DEQUEUE（queue_name =&gt;'test.lob_queue'，dequeue_options =&gt; dequeue_options，message_properties =&gt; message_properties，payload =&gt; payload，msgid =&gt; msgid）; lob_loc：= payload.data;金额：= 2000; DBMS_LOB.READ（lob_loc，amount，1，buffer）; DBMS_OUTPUT.PUT_LINE（'读取的数据量：'||金额）;承诺;结束; /</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__CHDDJJDC">
                     <p class="titleinexample">例10-15使LOB类型消息出列</p><pre class="oac_no_warn" dir="ltr">开始为我在1..5 LOOP blobdequeue（i）;结束循环;结束; /</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__CHDGAIBA">
                     <p class="titleinexample">示例10-16使分组消息出列</p><pre class="oac_no_warn" dir="ltr">SET SERVEROUTPUT ON DECLARE dequeue_options DBMS_AQ.dequeue_options_t; message_properties DBMS_AQ.message_properties_t; message_handle RAW（16）; message test.message_typ; no_messages例外; end_of_group异常; PRAGMA EXCEPTION_INIT（no_messages，-25228）; PRAGMA EXCEPTION_INIT（end_of_group，-25235）; BEGIN dequeue_options.wait：= DBMS_AQ.NO_WAIT; dequeue_options.navigation：= DBMS_AQ.FIRST_MESSAGE; LOOP BEGIN DBMS_AQ.DEQUEUE（queue_name =&gt;'test.group_queue'，dequeue_options =&gt; dequeue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）; DBMS_OUTPUT.PUT_LINE（message.subject ||'：'|| message.text）; dequeue_options.navigation：= DBMS_AQ.NEXT_MESSAGE; end_of_group THEN DBMS_OUTPUT.PUT_LINE（'Finished'|| message.subject）之外的异常;承诺; dequeue_options.navigation：= DBMS_AQ.NEXT_TRANSACTION;结束;结束循环; no_messages然后DBMS_OUTPUT.PUT_LINE（'没有更多消息'）的例外;结束; /</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__CHDIACIJ">
                     <p class="titleinexample">示例10-17从多消息队列中使RED的消息出列</p><pre class="oac_no_warn" dir="ltr">SET SERVEROUTPUT ON DECLARE dequeue_options DBMS_AQ.dequeue_options_t; message_properties DBMS_AQ.message_properties_t; message_handle RAW（16）; message test.message_typ; no_messages例外; PRAGMA EXCEPTION_INIT（no_messages，-25228）; BEGIN dequeue_options.wait：= DBMS_AQ.NO_WAIT; dequeue_options.consumer_name：='RED'; dequeue_options.navigation：= DBMS_AQ.FIRST_MESSAGE; LOOP BEGIN DBMS_AQ.DEQUEUE（queue_name =&gt;'test.multiconsumer_queue'，dequeue_options =&gt; dequeue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）; DBMS_OUTPUT.PUT_LINE（'Message：'|| message.subject ||'..'|| message.text）; dequeue_options.navigation：= DBMS_AQ.NEXT_MESSAGE;结束;结束循环; no_messages，然后DBMS_OUTPUT.PUT_LINE（'没有更多消息为红色'）;承诺;结束; /</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__CHDBJBDB">
                     <p class="titleinexample">示例10-18在浏览模式下出列并删除指定的消息</p><pre class="oac_no_warn" dir="ltr">SET SERVEROUTPUT ON DECLARE dequeue_options DBMS_AQ.dequeue_options_t; message_properties DBMS_AQ.message_properties_t; message_handle RAW（16）; message test.message_typ; BEGIN dequeue_options.dequeue_mode：= DBMS_AQ.BROWSE; LOOP DBMS_AQ.DEQUEUE（queue_name =&gt;'test.obj_queue'，dequeue_options =&gt; dequeue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）; DBMS_OUTPUT.PUT_LINE（'浏览消息文本：'|| message.text）;当message.subject ='PINK'时退出;结束循环; dequeue_options.dequeue_mode：= DBMS_AQ.REMOVE; dequeue_options.msgid：= message_handle; DBMS_AQ.DEQUEUE（queue_name =&gt;'test.obj_queue'，dequeue_options =&gt; dequeue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）; DBMS_OUTPUT.PUT_LINE（'Removed Message Text：'|| message.text）;承诺;结束; /</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54__CHDDCJFF">
                     <p class="titleinexample">示例10-19在锁定模式下出列并删除指定消息</p><pre class="oac_no_warn" dir="ltr">SET SERVEROUTPUT ON DECLARE dequeue_options DBMS_AQ.dequeue_options_t; message_properties DBMS_AQ.message_properties_t; message_handle RAW（16）; message test.message_typ; BEGIN dequeue_options.dequeue_mode：= DBMS_AQ.LOCKED; LOOP DBMS_AQ.dequeue（queue_name =&gt;'test.obj_queue'，dequeue_options =&gt; dequeue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）; DBMS_OUTPUT.PUT_LINE（'Locked Message Text：'|| message.text）;当message.subject ='PURPLE'时退出;结束循环; dequeue_options.dequeue_mode：= DBMS_AQ.REMOVE; dequeue_options.msgid：= message_handle; DBMS_AQ.DEQUEUE（queue_name =&gt;'test.obj_queue'，dequeue_options =&gt; dequeue_options，message_properties =&gt; message_properties，payload =&gt; message，msgid =&gt; message_handle）; DBMS_OUTPUT.PUT_LINE（'Removed Message Text：'|| message.text）;承诺;结束; /</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="ADQUE2849"></a><a id="ADQUE2848"></a><div class="props_rev_3"><a id="GUID-0B018200-824D-458D-98E7-7445AF8B628F" name="GUID-0B018200-824D-458D-98E7-7445AF8B628F"></a><h3 id="ADQUE-GUID-0B018200-824D-458D-98E7-7445AF8B628F" class="sect3"><span class="enumeration_section">10.6</span>使消息数组出列</h3>
               <div>
                  <p>使用<code class="codeph">DEQUEUE_ARRAY</code>函数将有效负载数组和相应的消息属性数组出列。
                  </p>
                  <div class="section"><pre class="oac_no_warn" dir="ltr">DBMS_AQ.DEQUEUE_ARRAY（queue_name IN VARCHAR2，dequeue_options IN dequeue_options_t，array_size IN PLS_INTEGER，message_properties_array OUT message_properties_array_t，payload_array OUT VARRAY，msgid_array OUT msgid_array_t）RETURN PLS_INTEGER;</pre><p>输出是出列消息的有效负载，消息ID和消息属性的数组。该函数返回成功出列的消息数。</p>
                     <p><a id="d61372e2102" class="indexterm-anchor"></a>缓冲消息不支持数组出列，但您仍然可以使用<code class="codeph">DBMS_AQ.DEQUEUE_ARRAY()</code>通过将<code class="codeph">array_size</code>设置为<code class="codeph">1</code>来使缓冲的消息出<code class="codeph">array_size</code> 。
                     </p>
                     <p>有效负载结构可以是<code class="codeph">VARRAY</code>或嵌套表。消息标识符返回到<code class="codeph">DBMS_AQ.msgid_array_t</code>类型的<code class="codeph">RAW(16)</code>条目数组中。消息属性将返回到<code class="codeph">DBMS_AQ.message_properties_array_t</code>类型的数组中。
                     </p>
                     <p>与关系世界中的数组操作一样，不可能提供在所有情况下都是正确的单个最佳阵列大小。应用程序开发人员必须尝试不同的数组大小，以确定其特定应用程序的最佳值。</p>
                     <p><code class="codeph">DBMS_AQ.DEQUEUE</code>也提供<code class="codeph">DBMS_AQ.DEQUEUE_ARRAY</code>可用的所有出队选项。您可以选择仅将持久性消息，仅缓冲消息或两者都出列。此外， <code class="codeph">dequeue_options</code>的<code class="codeph">navigation</code>属性提供了两个特定于<code class="codeph">DBMS_AQ.DEQUEUE_ARRAY</code>选项。</p>
                     <p>将消息出列时，您可能希望使用单个调用将事务组的所有消息出列。您可能还希望将跨多个事务组的邮件出列。您可以使用以下导航方法之一指定这些方法之一：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">NEXT_MESSAGE_ONE_GROUP</code> 
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">FIRST_MESSAGE_ONE_GROUP</code> 
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">NEXT_MESSAGE_MULTI_GROUP</code> 
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">FIRST_MESSAGE_MULTI_GROUP</code> 
                           </p>
                        </li>
                     </ul>
                     <p>导航方法<code class="codeph">NEXT_MESSAGE_ONE_GROUP</code>将与下一个可用事务组中的搜索条件匹配的消息<code class="codeph">NEXT_MESSAGE_ONE_GROUP</code>到数组中。导航方法<code class="codeph">FIRST_MESSAGE_ONE_GROUP</code>将位置重置为队列的开头，并使单个事务组中可用的所有消息出列并且与搜索条件匹配。
                     </p>
                     <p>出列的消息数由数组大小限制确定。如果事务组中的消息数超过<code class="codeph">array_size</code> ，则必须多次调用<code class="codeph">DEQUEUE_ARRAY</code>才能使事务组的所有消息出列。
                     </p>
                     <p>导航方法<code class="codeph">NEXT_MESSAGE_MULTI_GROUP</code>和<code class="codeph">FIRST_MESSAGE_MULTI_GROUP</code>工作方式与<code class="codeph">FIRST_MESSAGE_MULTI_GROUP</code> <code class="codeph">ONE_GROUP</code> ，但它们不限于单个事务组。每个出列到数组中的消息都有一组关联的消息属性。消息属性<code class="codeph">transaction_group</code>确定哪些消息属于同一事务组。
                     </p>
                     <p><a href="aq-operations-using-pl-sql.html#GUID-0B018200-824D-458D-98E7-7445AF8B628F__BCFEACBF">例10-20</a>使<a href="aq-operations-using-pl-sql.html#GUID-92FCE63B-7713-443A-84A3-9F543F0A8819__CHDHAFJA">例10-11中</a>排队的消息出列。它返回：</p><pre class="oac_no_warn" dir="ltr">出列的消息数：2</pre><div class="infoboxnotealso" id="GUID-0B018200-824D-458D-98E7-7445AF8B628F__GUID-F361158F-D049-488D-AF9F-B24E0E89A854">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“出<a href="aq-operations-using-pl-sql.html#GUID-5F84DA85-7D5B-4EEC-9785-80877F3FCA54" title="此过程使来自指定队列的消息出列。">列消息</a> ”</span></p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-0B018200-824D-458D-98E7-7445AF8B628F__BCFEACBF">
                     <p class="titleinexample">示例10-20使消息数组出列</p><pre class="oac_no_warn" dir="ltr">SET SERVEROUTPUT ON DECLARE dequeue_options DBMS_AQ.dequeue_options_t; msg_prop_array DBMS_AQ.message_properties_array_t：= DBMS_AQ.message_properties_array_t（）; payload_array test.msg_table; msgid_array DBMS_AQ.msgid_array_t; retval PLS_INTEGER; BEGIN retval：= DBMS_AQ.DEQUEUE_ARRAY（queue_name =&gt;'test.obj_queue'，dequeue_options =&gt; dequeue_options，array_size =&gt; 2，message_properties_array =&gt; msg_prop_array，payload_array =&gt; payload_array，msgid_array =&gt; msgid_array）; DBMS_OUTPUT.PUT_LINE（'出列的消息数：'|| retval）;结束;/</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="ADQUE2851"></a><a id="ADQUE2850"></a><div class="props_rev_3"><a id="GUID-DBBE096A-EEA0-4E1E-AC3F-6E1B492D1FB5" name="GUID-DBBE096A-EEA0-4E1E-AC3F-6E1B492D1FB5"></a><h3 id="ADQUE-GUID-DBBE096A-EEA0-4E1E-AC3F-6E1B492D1FB5" class="sect3"><span class="enumeration_section">10.7</span>注册通知</h3>
               <div>
                  <p>此过程注册电子邮件地址，用户定义的PL / SQL过程或HTTP URL以进行消息通知。</p>
                  <div class="section"><pre class="oac_no_warn" dir="ltr">DBMS_AQ.REGISTER（reg_list IN SYS.AQ $ _REG_INFO_LIST，reg_count IN NUMBER）;</pre><div class="infoboxnote" id="GUID-DBBE096A-EEA0-4E1E-AC3F-6E1B492D1FB5__GUID-6B6EAB4C-AB32-4C3C-A4AC-7C396FB3DDED">
                        <p class="notep1">注意：</p>
                        <p>从12 <span class="italic">c</span>版本2（12.2。）开始，用户生成的队列名称的最大长度为122个字节。请参阅<span class="q">“ <a href="aq-administrative-interface.html#GUID-E140B4B5-DB4C-4DFC-8F67-C032516D0324" title="DBMS_AQADM.CREATE_QUEUE创建非分片队列。">创建队列</a> ”</span> 。
                        </p>
                     </div>
                     <p><a id="d61372e2326" class="indexterm-anchor"></a> <code class="codeph">reg_list</code>参数是<code class="codeph">reg_list</code> <code class="codeph">SYS.AQ$_REG_INFO</code>对象的列表。您可以使用<code class="codeph">qosflags</code> <code class="codeph">SYS.AQ$_REG_INFO</code>的<code class="codeph">qosflags</code>属性指定服务通知质量。</p>
                     <p><a id="d61372e2344" class="indexterm-anchor"></a>该<code class="codeph">reg_count</code>参数指定的条目数<code class="codeph">reg_list</code> 。每个订阅都需要自己的<code class="codeph">reg_list</code>条目。可以一次注册对多个订阅的兴趣。
                     </p>
                     <p>当接收PL / SQL通知，Oracle数据库高级队列消息属性描述符回调调用与指定的<code class="codeph">delivery_mode</code>通知作为消息的<code class="codeph">DBMS_AQ.PERSISTENT</code>或<code class="codeph">DBMS_AQ.BUFFERED</code> 。</p>
                     <p>如果注册电子邮件通知，则必须设置数据库将用于发送电子邮件通知的SMTP服务器的主机名和端口名称。如果需要，您应设置send-from电子邮件地址，该地址由数据库设置为<code class="codeph">sent from</code>字段<code class="codeph">sent from</code> 。您需要支持Java的数据库才能使用此功能。
                     </p>
                     <p>如果您注册HTTP通知，则可能需要设置代理服务器的主机名和端口号以及数据库将用于发布HTTP通知的无代理域列表。</p>
                     <p>名为<code class="codeph">SYS.AQ_SRVNTFN_TABLE_Q</code>的内部队列存储要由作业队列进程处理的通知。如果通知失败，则Oracle数据库高级队列会重试失败的通知，最多尝试<code class="codeph">MAX_RETRIES</code> 。
                     </p>
                     <div class="infoboxnote" id="GUID-DBBE096A-EEA0-4E1E-AC3F-6E1B492D1FB5__GUID-AC99BBC6-B0E9-4AAC-882D-D5FBCF031214">
                        <p class="notep1">注意：</p>
                        <p>您可以更改<code class="codeph">MAX_RETRIES</code>和<code class="codeph">RETRY_DELAY</code>的性质<code class="codeph">SYS.AQ_SRVNTFN_TABLE_Q</code> 。新设置适用于所有通知。
                        </p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-DBBE096A-EEA0-4E1E-AC3F-6E1B492D1FB5__GUID-4648DC70-9119-4219-9335-AB242EBBBE0A">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关<code class="codeph">SYS.AQ$_REG_INFO</code>对象的更多信息，请<code class="codeph">SYS.AQ$_REG_INFO</code> <span class="q">“ <a href="aq-basic-components.html#GUID-94CBE09C-EE8C-4874-A30D-CCBE1F8D862E" title="该组件标识消息的生产者或消费者。">AQ注册信息类型</a> ”</span></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="aq-basic-components.html#GUID-5B9C62D6-ED8A-4E35-9889-16F5166D4144" title="此组件指定AQ PL / SQL回调在收到通知时收到的Oracle数据库高级队列描述符。">AQ通知描述符类型</a> ”</span>有关消息属性描述符的更多信息</p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-DBBE096A-EEA0-4E1E-AC3F-6E1B492D1FB5__GUID-67FA4C4E-5B24-46EB-90DC-32E056D08BF1">
                     <p class="titleinexample">示例10-21注册通知</p><pre class="oac_no_warn" dir="ltr">DECLARE reginfo sys.aq $ _reg_info; reg_list sys.aq $ _reg_info_list; BEGIN reginfo：= sys.aq $ _reg_info（'test.obj_queue'，DBMS_AQ.NAMESPACE_ANONYMOUS，'http://www.company.com：8080'，HEXTORAW（'FF'））; reg_list：= sys.aq $ _reg_info_list（reginfo）; DBMS_AQ.REGISTER（reg_list =&gt; reg_list，reg_count =&gt; 1）;承诺;结束; /</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="ADQUE2852"></a><div class="props_rev_3"><a id="GUID-3FD95C26-D2FF-49CF-BBCF-A6E40468D55E" name="GUID-3FD95C26-D2FF-49CF-BBCF-A6E40468D55E"></a><h3 id="ADQUE-GUID-3FD95C26-D2FF-49CF-BBCF-A6E40468D55E" class="sect3"><span class="enumeration_section">10.8</span>取消注册通知</h3>
               <div>
                  <p>此过程取消注册用于消息通知的电子邮件地址，用户定义的PL / SQL过程或HTTP URL。</p>
                  <div class="section"><pre class="oac_no_warn" dir="ltr">DBMS_AQ.UNREGISTER（reg_list IN SYS.AQ $ _REG_INFO_LIST，reg_count IN NUMBER）;</pre></div>
                  <!-- class="section" -->
               </div>
            </div><a id="ADQUE2854"></a><a id="ADQUE2853"></a><div class="props_rev_3"><a id="GUID-4C80C7E8-DAD2-49CA-9294-895581A64378" name="GUID-4C80C7E8-DAD2-49CA-9294-895581A64378"></a><h3 id="ADQUE-GUID-4C80C7E8-DAD2-49CA-9294-895581A64378" class="sect3"><span class="enumeration_section">10.9</span>发布订户通知</h3>
               <div>
                  <p>此过程发布到匿名订阅列表，允许所有注册订阅的客户端获取持久消息的通知。</p>
                  <div class="section"><pre class="oac_no_warn" dir="ltr">DBMS_AQ.POST（post_list IN SYS.AQ $ _POST_INFO_LIST，post_count IN NUMBER）;</pre><p>缓冲消息不支持此功能。</p>
                     <p><code class="codeph">count</code>参数指定<code class="codeph">post_list</code>的条目数。每个发布的订阅必须在<code class="codeph">post_list</code>有自己的条目。可以一次发布多个订阅。
                     </p>
                     <p><code class="codeph">post_list</code>参数指定要发布的匿名订阅的列表。它有三个属性：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a id="d61372e2592" class="indexterm-anchor"></a><code class="codeph">name</code></p>
                           <p><code class="codeph">name</code>属性指定要发布的匿名订阅的名称。
                           </p>
                        </li>
                        <li>
                           <p><a id="d61372e2605" class="indexterm-anchor"></a><code class="codeph">namespace</code></p>
                           <p><code class="codeph">namespace</code>属性指定订阅的命名空间。要通过<code class="codeph">DBMS_AQ.POST</code>从其他应用程序接收通知，名称空间必须是<code class="codeph">DBMS_AQ.NAMESPACE_ANONYMOUS</code> 。</p>
                        </li>
                        <li>
                           <p><a id="d61372e2624" class="indexterm-anchor"></a><code class="codeph">payload</code></p>
                           <p><code class="codeph">payload</code>属性指定要发布到匿名订阅的有效负载。没有有效负载可能与此调用相关联。
                           </p>
                        </li>
                     </ul>
                     <p>此呼叫提供尽力而为的保证。最多只有一次通知注册客户。此调用主要用于轻量级通知。如果应用程序需要更严格的保证，那么它可以排入队列。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-4C80C7E8-DAD2-49CA-9294-895581A64378__GUID-94657F22-8CCB-44FB-9686-716FBFE77755">
                     <p class="titleinexample">示例10-22发布对象类型消息</p><pre class="oac_no_warn" dir="ltr">DECLARE postinfo sys.aq $ _post_info; post_list sys.aq $ _post_info_list; BEGIN postinfo：= sys.aq $ _post_info（'test.obj_queue'，0，HEXTORAW（'FF'））; post_list：= sys.aq $ _post_info_list（postinfo）; DBMS_AQ.POST（post_list =&gt; post_list，post_count =&gt; 1）;承诺;结束; /</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="ADQUE2855"></a><div class="props_rev_3"><a id="GUID-E4F131CA-964F-4DF7-86EE-FB37078DD157" name="GUID-E4F131CA-964F-4DF7-86EE-FB37078DD157"></a><h3 id="ADQUE-GUID-E4F131CA-964F-4DF7-86EE-FB37078DD157" class="sect3"><span class="enumeration_section">10.10</span>将代理添加到LDAP服务器</h3>
               <div>
                  <p>此过程为LDAP服务器中的Oracle Database Advanced Queuing代理创建条目。</p>
                  <div class="section"><pre class="oac_no_warn" dir="ltr">DBMS_AQ.BIND_AGENT（代理IN SYS.AQ $ _AGENT，证书IN VARCHAR2默认为NULL）;</pre><p><code class="codeph">agent</code>参数指定要在<a href="glossary.html#GUID-6BF3485C-E98F-4344-A7DE-64950BCCE160"><span class="xrefglossterm">轻量级目录访问协议</span></a> （LDAP）服务器中注册的Oracle数据库高级队列代理。
                     </p>
                     <p><a id="d61372e2718" class="indexterm-anchor"></a> <code class="codeph">certificate</code>参数指定LDAP中<code class="codeph">OrganizationalPerson</code>条目的位置（LDAP专有名称），其数字证书（属性<code class="codeph">usercertificate</code> ）将用于此代理。例如，“ <code class="codeph">cn=OE, cn=ACME, cn=com</code> ”是<code class="codeph">OrganizationalPerson</code> <code class="codeph">OE</code>的专有名称，其证书将与指定的代理一起使用。如果代理没有数字证书，则此参数默认为null。
                     </p>
                     <div class="infoboxnotealso" id="GUID-E4F131CA-964F-4DF7-86EE-FB37078DD157__GUID-31833F55-0391-4079-9C42-9B56505965F8">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="aq-basic-components.html#GUID-2C5557D9-E11B-4AB9-94E0-F923C85D6E0A" title="该组件标识消息的生产者或消费者。">AQ代理类型</a> ”</span></p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="ADQUE2856"></a><div class="props_rev_3"><a id="GUID-E6B7E2DC-9FD6-4EA8-8A92-D9929B9EA1B7" name="GUID-E6B7E2DC-9FD6-4EA8-8A92-D9929B9EA1B7"></a><h3 id="ADQUE-GUID-E6B7E2DC-9FD6-4EA8-8A92-D9929B9EA1B7" class="sect3"><span class="enumeration_section">10.11</span>从LDAP服务器中删除代理</h3>
               <div>
                  <p>此过程从LDAP服务器中删除Oracle Database Advanced Queuing代理的条目。</p>
                  <div class="section"><pre class="oac_no_warn" dir="ltr">DBMS_AQ.UNBIND_AGENT（代理IN SYS.AQ $ _AGENT）;</pre></div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>