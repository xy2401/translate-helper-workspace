<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="You can use Oracle XML DB Repository to store and access data of any kind, in the form of repository resources. You can access repository data from any application. Sometimes your application needs to perform certain actions whenever a particular repository operation occurs. You can do this using repository events."></meta>
      <meta name="description" content="You can use Oracle XML DB Repository to store and access data of any kind, in the form of repository resources. You can access repository data from any application. Sometimes your application needs to perform certain actions whenever a particular repository operation occurs. You can do this using repository events."></meta>
      <title>Oracle XML DB存储库事件</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Developer&#39;s Guide "></meta>
      <meta property="og:description" content="You can use Oracle XML DB Repository to store and access data of any kind, in the form of repository resources. You can access repository data from any application. Sometimes your application needs to perform certain actions whenever a particular repository operation occurs. You can do this using repository events."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Developer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="xml-db-developers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-03-30T12:32:42-07:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2002, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96222-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="user-defined-repository-metadata.html" title="Previous" type="text/html"></link>
      <link rel="next" href="how-to-write-XML-DB-applications-in-Java.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="XML DB Developer&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="ADXDB"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="user-defined-repository-metadata.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="how-to-write-XML-DB-applications-in-Java.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">开发人员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="XML-DB-repository.html" property="item" typeof="WebPage"><span property="name">Oracle XML DB存储库</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Oracle XML DB存储库事件</li>
            </ol>
            <a id="GUID-1A25D4D1-2353-41FC-9D86-9C35F9F95532" name="GUID-1A25D4D1-2353-41FC-9D86-9C35F9F95532"></a><a id="ADXDB2580"></a>
            
            <h2 id="ADXDB-GUID-1A25D4D1-2353-41FC-9D86-9C35F9F95532" class="sect2"><span class="enumeration_chapter">30个</span> Oracle XML DB存储库事件</h2>
         </header>
         <div class="ind">
            <div>
               <p>您可以使用Oracle XML DB Repository以存储库资源的形式存储和访问任何类型的数据。您可以从任何应用程序访问存储库数据。有时您的应用程序需要在发生特定存储库操作时执行某些操作。您可以使用存储库事件执行此操作。</p>
               <div class="section"></div>
               <!-- class="section" -->
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-33531811-B433-4257-A176-88D7AAAD48EC">存储库事件概述</a><br>当与存储库操作相关联的事件发生时，您的应用程序可以执例如，您可能希望在删除资源时执行move-to-wastebasket或其他备份操作。
                  </li>
                  <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-5F7D0772-848D-49EA-832B-AB1117B9E3F1">可能的存储库事件</a><br>存储库操作与预定义事件相关联。除了渲染操作之外，事件都是前后对。
                  </li>
                  <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-5821696E-5128-4221-9E9F-D36E2ACE5834">存储库操作和事件</a><br>使用不同的Oracle XML DB Repository操作可以发生相同的存储库事件，并且给定的存储库操作可以生成多个存储库事件。
                  </li>
                  <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-C4139224-FF34-4B6D-9B68-481FA41E634C">存储库事件处理程序注意事项</a><br>列出了一些注意事项，用于定义Oracle XML DB Repository事件的处理程序。
                  </li>
                  <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119">存储库事件的配置</a><br>在资源配置文件中，使用元素<code class="codeph">event-listeners</code> （元素<code class="codeph">ResConfig</code>子）来配置Oracle XML DB存储库事件处理。
                  </li>
               </ul>
               <div class="relinfo">
                  <p><strong>相关话题</strong></p>
                  <ul>
                     <li><a href="configuration-of-XML-DB-repository.html#GUID-E44B59D4-7A7E-4303-ACE3-B801797B06AF" title="Oracle XML DB Repository的整体配置适用于所有存储库资源。它不包括配置用于处理事件或管理XLink和XInclude处理的参数。您使用资源配置文件来配置资源。">配置Oracle XML DB存储库</a></li>
                  </ul>
               </div>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="XML-DB-repository.html#GUID-840EBE35-8FC8-4150-9FC8-78442FD1B12B" title="Oracle XML DB Repository允许您对数据进行版本控制，实现和管理安全性，并使用API来访问和操作存储库资源。">Oracle XML DB存储库</a></p>
                  </div>
               </div>
            </div>
            <a id="ADXDB5591"></a><div class="props_rev_3"><a id="GUID-33531811-B433-4257-A176-88D7AAAD48EC" name="GUID-33531811-B433-4257-A176-88D7AAAD48EC"></a><h3 id="ADXDB-GUID-33531811-B433-4257-A176-88D7AAAD48EC" class="sect3"><span class="enumeration_section">30.1</span>存储库事件概述</h3>
               <div>
                  <p>当与存储库操作相关联的事件发生时，您的应用程序可以执例如，您可能希望在删除资源时执行move-to-wastebasket或其他备份操作。</p>
                  <p>存储库资源操作包括创建，删除，锁定，解锁，呈现，链接，取消链接，置于版本控制，签入，签出，取消选中（还原签出版本），打开和更新。</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-8D76D959-A3B7-4401-9024-ADB29A703B36">存储库事件：用例</a><br>可以使用存储库事件的示例包括将资源移动到废纸篓并根据其MIME类型对资源进行分类。
                     </li>
                     <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-9CC45EFA-9CBF-415D-A150-911F0A64A087">存储库事件和数据库触发器</a><br>您无法使用数据库触发器让应用程序对存储库操作做出反应。给定的存储库操作可以包含多个底层内部表的多个数据库操作。由于这些基础表是Oracle XML DB的内部表，因此无法轻松将它们映射到特定的存储库操作。
                     </li>
                     <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-65551F91-CDC8-4053-A2F6-E949027BD604">存储库事件监听器和事件处理程序</a><br>每个存储库操作都与事件相关联。您的应用程序可以为特定资源或整个存储库配置事件侦听器。侦听器可以受节点存在前提条件的限制。侦听器是一组PL / SQL或Java处理程序，每个处理程序处理一个事件。
                     </li>
                     <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-AC610F25-FF1F-418E-8F92-515C219E9523">存储库事件配置</a><br>存储库事件配置涉及定义资源配置文件并定义它们的处理顺序。这些文件定义了事件监听器。此类配置适用于整个存储库的各个资源和事件的事件。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="XML-DB-repository-events.html#GUID-1A25D4D1-2353-41FC-9D86-9C35F9F95532" title="您可以使用Oracle XML DB Repository以存储库资源的形式存储和访问任何类型的数据。您可以从任何应用程序访问存储库数据。有时您的应用程序需要在发生特定存储库操作时执行某些操作。您可以使用存储库事件执行此操作。">Oracle XML DB存储库事件</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADXDB5592"></a><div class="props_rev_3"><a id="GUID-8D76D959-A3B7-4401-9024-ADB29A703B36" name="GUID-8D76D959-A3B7-4401-9024-ADB29A703B36"></a><h4 id="ADXDB-GUID-8D76D959-A3B7-4401-9024-ADB29A703B36" class="sect4"><span class="enumeration_section">30.1.1</span>存储库事件：用例</h4>
                  <div>
                     <p>可以使用存储库事件的示例包括将资源移动到废纸篓并根据其MIME类型对资源进行分类。</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="italic">废纸篓 -</span>您可以使用<code class="codeph">UnLink</code>预事件处理程序将资源有效地移动到废纸篓而不是删除它。在删除原始链接之前，在废纸篓文件夹中创建链接。废纸篓中的链接可确保不删除资源。当您随后从废纸篓取消删除资源时，可以再次创建原始链接并删除废纸篓链接。废纸篓链接名称可以与要删除的链接的名称不同，因为某个路径上的资源可以从该路径多次取消链接。然后废纸篓将具有与该路径相对应的多个链接，具有不同的链接属性并且可能指向不同的资源。
                           </p>
                        </li>
                        <li>
                           <p><span class="italic">分类 -</span>应用程序可能会根据MIME类型或其他属性对其管理的资源进行分类。它可以通过维护来自存储库文件夹<code class="codeph">/my-app/gif</code> ， <code class="codeph">/my-app/txt</code>和<code class="codeph">/my-app/xml</code>链接来跟踪GIF，文本和XML文件。三个事件后的处理程序可以在这里使用： <code class="codeph">LinkIn</code> ， <code class="codeph">UnlinkIn</code>和<code class="codeph">Update</code> 。<code class="codeph">LinkIn</code>事件后处理程序将检查资源并在相应的类别文件夹中创建链接（如果尚未存在）。<code class="codeph">UnlinkIn</code>事件后处理程序将从类别文件夹中删除该链接。如果类别更改， <code class="codeph">Update</code>事件后处理程序将有效地将资源从一个类别文件夹移动到另一个类别文件夹。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="XML-DB-repository-events.html#GUID-33531811-B433-4257-A176-88D7AAAD48EC" title="当与存储库操作相关联的事件发生时，您的应用程序可以执例如，您可能希望在删除资源时执行move-to-wastebasket或其他备份操作。">存储库事件概述</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADXDB5593"></a><div class="props_rev_3"><a id="GUID-9CC45EFA-9CBF-415D-A150-911F0A64A087" name="GUID-9CC45EFA-9CBF-415D-A150-911F0A64A087"></a><h4 id="ADXDB-GUID-9CC45EFA-9CBF-415D-A150-911F0A64A087" class="sect4"><span class="enumeration_section">30.1.2</span>存储库事件和数据库触发器</h4>
                  <div>
                     <p>您无法使用数据库触发器让应用程序对存储库操作做出反应。给定的存储库操作可以包含多个底层内部表的多个数据库操作。由于这些基础表是Oracle XML DB的内部表，因此无法轻松将它们映射到特定的存储库操作。</p>
                     <p>例如，内部表<code class="codeph">XDB$H_INDEX</code>可能由数据库更新操作（如果更改ACL）或链接操作更新。即使在您可能使用数据库触发器完成相同操作的情况下，您也不希望这样做：存储库事件是比基础表上的一组数据库触发器更高级别的抽象。
                     </p>
                     <p>发生存储库事件时，可以将与操作关联的信息（例如，使用的资源路径）传递到相应的事件处理程序。使用数据库触发器无法获得此类信息。</p>
                     <p>存储库事件和数据库触发器都可以应用于XML数据。例如，您可以在<code class="codeph">XMLType</code>表上使用触发器。但是，如果<code class="codeph">XMLType</code>表也是存储库表（启用了层次结构），则不要在事件处理程序中复制应用于表的任何触发器代码。否则，该代码执行两次。
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="XML-DB-repository-events.html#GUID-33531811-B433-4257-A176-88D7AAAD48EC" title="当与存储库操作相关联的事件发生时，您的应用程序可以执例如，您可能希望在删除资源时执行move-to-wastebasket或其他备份操作。">存储库事件概述</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADXDB5594"></a><div class="props_rev_3"><a id="GUID-65551F91-CDC8-4053-A2F6-E949027BD604" name="GUID-65551F91-CDC8-4053-A2F6-E949027BD604"></a><h4 id="ADXDB-GUID-65551F91-CDC8-4053-A2F6-E949027BD604" class="sect4"><span class="enumeration_section">30.1.3</span>存储库事件监听器和事件处理程序</h4>
                  <div>
                     <p>每个存储库操作都与事件相关联。您的应用程序可以为特定资源或整个存储库配置事件侦听器。侦听器可以受节点存在前提条件的限制。侦听器是一组PL / SQL或Java处理程序，每个处理程序处理一个事件。</p>
                     <p></p>
                     <p>存储库<strong class="term">事件侦听器</strong>是Java类或PL / SQL包或对象类型。它包含一组PL / SQL过程或Java方法，每个过程称为<strong class="term">事件处理程序</strong> 。
                     </p>
                     <p>通过将<strong class="term">资源配置文件</strong>映射到<strong class="term">资源，可以</strong>将存储库事件侦听器与资源相关联。您使用PL / SQL包<code class="codeph">DBMS_RESCONFIG</code>来操作资源配置文件，包括将它们与它们配置的资源相关联。特别是，PL / SQL函数<code class="codeph">DBMS_RESCONFIG.getListeners</code>列出给定资源的所有事件侦听器。
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="XML-DB-repository-events.html#GUID-33531811-B433-4257-A176-88D7AAAD48EC" title="当与存储库操作相关联的事件发生时，您的应用程序可以执例如，您可能希望在删除资源时执行move-to-wastebasket或其他备份操作。">存储库事件概述</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADXDB5595"></a><div class="props_rev_3"><a id="GUID-AC610F25-FF1F-418E-8F92-515C219E9523" name="GUID-AC610F25-FF1F-418E-8F92-515C219E9523"></a><h4 id="ADXDB-GUID-AC610F25-FF1F-418E-8F92-515C219E9523" class="sect4"><span class="enumeration_section">30.1.4</span>存储库事件配置</h4>
                  <div>
                     <p>存储库事件配置涉及定义资源配置文件并定义它们的处理顺序。这些文件定义了事件监听器。此类配置适用于整个存储库的各个资源和事件的事件。</p>
                     <p>可以通过多个资源配置文件配置给定资源。它们存储在<strong class="term">资源配置列表中</strong> ，并按列表顺序处理。整个存储库的事件也可以由多个资源配置文件配置。同样，存储库也有一个资源配置列表。为整个存储库配置的事件处理在任何特定于资源的事件处理之前生效。在任何特定于资源的事件之前处理所有适用的存储库范围的事件。
                     </p>
                     <p>给定的资源配置文件可以为其配置的资源定义多个事件侦听器，每个事件侦听器都可以定义多个事件处理程序。</p>
                     <div class="section"></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="XML-DB-repository-events.html#GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119" title="在资源配置文件中，使用元素事件侦听器（元素ResConfig的子）来配置Oracle XML DB存储库事件处理。">存储库事件的配置</a></li>
                        </ul>
                     </div>
                     <div class="infoboxnotealso" id="GUID-AC610F25-FF1F-418E-8F92-515C219E9523__GUID-E13A1B35-9ADA-455A-9100-98BAF411026F">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="configuration-of-XML-DB-repository.html#GUID-5ADEA709-733D-4E05-933A-AB1E7262D8AA" title="您可以通过将资源配置文件与资源配置文件相关联来为任何目的配置Oracle XML DB资源库资源，该资源配置文件定义资源的可配置参数。资源配置文件本身是Oracle XML DB Repository中的资源。">资源配置文件</a> ，了解有关资源配置和资源配置列表的一般信息</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="XML-DB-repository-events.html#GUID-33531811-B433-4257-A176-88D7AAAD48EC" title="当与存储库操作相关联的事件发生时，您的应用程序可以执例如，您可能希望在删除资源时执行move-to-wastebasket或其他备份操作。">存储库事件概述</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="ADXDB5597"></a><a id="ADXDB5596"></a><div class="props_rev_3"><a id="GUID-5F7D0772-848D-49EA-832B-AB1117B9E3F1" name="GUID-5F7D0772-848D-49EA-832B-AB1117B9E3F1"></a><h3 id="ADXDB-GUID-5F7D0772-848D-49EA-832B-AB1117B9E3F1" class="sect3"><span class="enumeration_section">30.2</span>可能的存储库事件</h3>
               <div>
                  <p>存储库操作与预定义事件相关联。除了渲染操作之外，事件都是前后对。</p>
                  <p>呈现操作与单个存储库事件相关联。除了呈现之外，所有存储库操作都与一<span class="italic">对</span>或多<span class="italic">对</span>事件相关联。
                  </p>
                  <p>例如，资源创建与三对事件相关联，事件按以下顺序发生：</p>
                  <ol>
                     <li>
                        <p>预创作活动</p>
                     </li>
                     <li>
                        <p>创作后的活动</p>
                     </li>
                     <li>
                        <p>预链接事件</p>
                     </li>
                     <li>
                        <p>预链接到事件</p>
                     </li>
                     <li>
                        <p>链接后事件</p>
                     </li>
                     <li>
                        <p>后链接事件</p>
                     </li>
                  </ol>
                  <p><a href="XML-DB-repository-events.html#GUID-5F7D0772-848D-49EA-832B-AB1117B9E3F1__BABHJGBH" title="此表列出了与每个存储库操作关联的事件。它们的顺序在处理程序列中指示。">表30-1</a>列出了与每个存储库操作关联的事件。它们的顺序在处理程序列中指示。
                  </p>
                  <div class="tblformalwide" id="GUID-5F7D0772-848D-49EA-832B-AB1117B9E3F1__BABHJGBH">
                     <p class="titleintable">表30-1预定义的存储库事件</p>
                     <table cellpadding="4" cellspacing="0" class="FormalWide" title="预定义的存储库事件" width="100%" border="1" summary="This table lists the events associated with each repository operation. Their order is indicated in the handler columns. " frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="20%" id="d146411e511">存储库事件类型</th>
                              <th align="left" valign="bottom" width="36%" id="d146411e514">描述</th>
                              <th align="left" valign="bottom" width="23%" id="d146411e517">预处理程序执行</th>
                              <th align="left" valign="bottom" width="21%" id="d146411e520">后处理程序执行</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e525" headers="d146411e511 ">
                                 <p><code class="codeph">给予</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e525 d146411e514 ">
                                 <p><code class="codeph">Render</code>事件仅针对<span class="italic">文件</span>资源发生，永远不会针对文件夹资源发生。
                                 </p>
                                 <p>使用以下任一方法访问资源内容时发生：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>协议</p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">XDBURIType</code>方法<code class="codeph">getCLOB()</code> ， <code class="codeph">getBLOB()</code>和<code class="codeph">getXML()</code></p>
                                    </li>
                                 </ul>
                                 <p>使用以下任何一项访问资源内容时<span class="italic">不会</span>发生：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><code class="codeph">选择 ...来自RESOURCE_VIEW</code></p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">XDBURIType</code>方法<code class="codeph">getResource()</code></p>
                                    </li>
                                 </ul>
                                 <p><code class="codeph">Render</code>事件只有一个处理程序可以设置渲染输出。调用<code class="codeph">setRenderStream</code>或<code class="codeph">setRenderPath</code>的第一个处理程序控制渲染。
                                 </p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e525 d146411e517 ">
                                 <p>N / A</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e525 d146411e520 ">
                                 <p>N / A</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e592" headers="d146411e511 ">
                                 <p><code class="codeph">创建</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e592 d146411e514 ">
                                 <p>在创建资源时发生。执行的前处理程序和后处理程序是在新资源的文件夹上定义的处理程序。</p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e592 d146411e517 ">
                                 <p>在预解析之后，在验证父资源ACL并锁定之后，以及在将默认值分配给未定义的属性之前。</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e592 d146411e520 ">
                                 <p>将资源插入系统资源表后。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e606" headers="d146411e511 ">
                                 <p><code class="codeph">删除</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e606 d146411e514 ">
                                 <p>从磁盘中删除资源及其内容时发生，即资源<code class="codeph">REF</code>计数为零（0）时发生。
                                 </p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e606 d146411e517 ">
                                 <p>验证资源ACL和锁之后以及从磁盘中删除资源之前。</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e606 d146411e520 ">
                                 <p>从磁盘中删除资源及其内容后，触摸父文件夹后更新其上一个修改器和修改时间。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e623" headers="d146411e511 ">
                                 <p><code class="codeph">更新</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e623 d146411e514 ">
                                 <p>在磁盘上更新资源时发生。</p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e623 d146411e517 ">
                                 <p>验证资源ACL和锁定之后以及更新上一个修饰符和修改时间之前。</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e623 d146411e520 ">
                                 <p>将资源写入磁盘后。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e637" headers="d146411e511 ">
                                 <p><code class="codeph">锁</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e637 d146411e514 ">
                                 <p>在锁资源操作期间发生。</p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e637 d146411e517 ">
                                 <p>验证资源ACL和锁之后以及在资源上创建新锁之前。</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e637 d146411e520 ">
                                 <p>创建新锁后。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e651" headers="d146411e511 ">
                                 <p><code class="codeph">开锁</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e651 d146411e514 ">
                                 <p>在解锁资源操作期间发生。</p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e651 d146411e517 ">
                                 <p>验证资源ACL并删除令牌后。</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e651 d146411e520 ">
                                 <p>取下锁后。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e665" headers="d146411e511 ">
                                 <p><code class="codeph">林肯</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e665 d146411e514 ">
                                 <p>在链接操作期间在<code class="codeph">LinkTo</code>事件之前发生。事件目标是创建链接的文件夹。始终伴随着<code class="codeph">LinkTo</code>活动。
                                 </p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e665 d146411e517 ">
                                 <p>验证资源ACL和锁定之后以及创建链接之前。</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e665 d146411e520 ">
                                 <p>执行<code class="codeph">LinkTo</code>后处理程序后。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e688" headers="d146411e511 ">
                                 <p><code class="codeph">链接到</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e688 d146411e514 ">
                                 <p>在链接操作期间在<code class="codeph">LinkIn</code>事件之后发生。事件目标是作为链接目标的资源。
                                 </p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e688 d146411e517 ">
                                 <p>执行<code class="codeph">LinkIn</code>预处理程序之后和创建链接之前。
                                 </p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e688 d146411e520 ">
                                 <p>创建链接后以及更新父文件夹的最后修饰符和修改时间之后。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e708" headers="d146411e511 ">
                                 <p><code class="codeph">UnLinkIn</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e708 d146411e514 ">
                                 <p>在取消链接操作期间在<code class="codeph">UnlinkFrom</code>事件之前发生。始终伴随着<code class="codeph">UnlinkFrom</code>活动。
                                 </p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e708 d146411e517 ">
                                 <p>验证资源ACL和锁定之后以及删除链接之前。</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e708 d146411e520 ">
                                 <p>执行<code class="codeph">UnlinkFrom</code>后处理程序后。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e731" headers="d146411e511 ">
                                 <p><code class="codeph">UnlinkFrom</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e731 d146411e514 ">
                                 <p>在取消链接操作期间在<code class="codeph">UnlinkIn</code>事件之后发生。
                                 </p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e731 d146411e517 ">
                                 <p>执行<code class="codeph">UnlinkIn</code>预处理程序后。
                                 </p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e731 d146411e520 ">
                                 <p>删除链接后。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e751" headers="d146411e511 ">
                                 <p><code class="codeph">报到</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e751 d146411e514 ">
                                 <p>在资源签入期间发生。</p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e751 d146411e517 ">
                                 <p>验证资源ACL和锁之后以及验证资源是否受版本控制并已签出之后。</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e751 d146411e520 ">
                                 <p>签入资源后。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e766" headers="d146411e511 ">
                                 <p><code class="codeph">查看</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e766 d146411e514 ">
                                 <p>在签出资源期间发生。</p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e766 d146411e517 ">
                                 <p>验证资源ACL和锁之后以及验证资源是否受版本控制且尚未检出之后。</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e766 d146411e520 ">
                                 <p>签出资源后。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e780" headers="d146411e511 ">
                                 <p><code class="codeph">取消签</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e780 d146411e514 ">
                                 <p>在取消选中资源期间发生。</p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e780 d146411e517 ">
                                 <p>在删除资源签出的记录之前。</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e780 d146411e520 ">
                                 <p>取消选中资源后。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e794" headers="d146411e511 ">
                                 <p><code class="codeph">版本控制</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e794 d146411e514 ">
                                 <p>在为资源创建版本历史记录时发生。</p>
                                 <p>注意：您可以多次调用<code class="codeph">DBMS_XDB_VERSION.MakeVersioned()</code> ，但仅在第一次调用时创建版本历史记录。后续调用无效，因此不会发生<code class="codeph">VersionControl</code>事件。
                                 </p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e794 d146411e517 ">
                                 <p>在创建资源的版本历史记录之前。</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e794 d146411e520 ">
                                 <p>创建资源的第一个版本之后。</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <p>为简单起见，文档通常将存储库事件对的两个成员一起处理，例如，将<code class="codeph">LinkIn</code>事件类型称为预链接和后链接事件类型的简写。出于同样的原因，这里使用的事件类型名称是通过删除前缀<code class="codeph">handlePre</code>和<code class="codeph">handlePost</code>从Java接口<code class="codeph">XDBRepositoryEventListener</code> <code class="codeph">handlePost</code> 。
                  </p>
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-5F7D0772-848D-49EA-832B-AB1117B9E3F1__GUID-B09E0E1F-45BC-4E97-841C-A913C5C661FB">
                     <p class="notep1">也可以看看：</p>
                     <p>适用于PL / SQL存储库事件类型的<a href="../arpls/DBMS_XEVENT.html#ARPLS210" target="_blank"><span><cite>Oracle数据库PL / SQL包和类型参考</cite></span></a></p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="XML-DB-repository-events.html#GUID-1A25D4D1-2353-41FC-9D86-9C35F9F95532" title="您可以使用Oracle XML DB Repository以存储库资源的形式存储和访问任何类型的数据。您可以从任何应用程序访问存储库数据。有时您的应用程序需要在发生特定存储库操作时执行某些操作。您可以使用存储库事件执行此操作。">Oracle XML DB存储库事件</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB5599"></a><a id="ADXDB5598"></a><div class="props_rev_3"><a id="GUID-5821696E-5128-4221-9E9F-D36E2ACE5834" name="GUID-5821696E-5128-4221-9E9F-D36E2ACE5834"></a><h3 id="ADXDB-GUID-5821696E-5128-4221-9E9F-D36E2ACE5834" class="sect3"><span class="enumeration_section">30.3</span>存储库操作和事件</h3>
               <div>
                  <p>使用不同的Oracle XML DB Repository操作可以发生相同的存储库事件，并且给定的存储库操作可以生成多个存储库事件。</p>
                  <p> <a href="XML-DB-repository-events.html#GUID-5821696E-5128-4221-9E9F-D36E2ACE5834__BABCCJGG" title="此表列出了与每个存储库操作关联的事件。">表30-2</a>列出了与每个存储库操作关联的事件。有关相同操作发生多个存储库事件时的事件顺序，请参阅<a href="XML-DB-repository-events.html#GUID-5F7D0772-848D-49EA-832B-AB1117B9E3F1__BABHJGBH" title="此表列出了与每个存储库操作关联的事件。它们的顺序在处理程序列中指示。">表30-1</a> 。
                  </p>
                  <div class="tblformalwide" id="GUID-5821696E-5128-4221-9E9F-D36E2ACE5834__BABCCJGG">
                     <p class="titleintable">表30-2 Oracle XML DB存储库操作和事件</p>
                     <table cellpadding="4" cellspacing="0" class="FormalWide" title="Oracle XML DB存储库操作和事件" width="100%" border="1" summary="This table lists the events that are associated with each repository operation." frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="55%" id="d146411e893">手术</th>
                              <th align="left" valign="bottom" width="45%" id="d146411e896">存储库事件发生</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e901" headers="d146411e893 ">
                                 <p>按路径名获取资源内容的二进制表示</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e901 d146411e896 ">
                                 <p><code class="codeph">给予</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e909" headers="d146411e893 ">
                                 <p>按路径名获取资源内容的XML表示</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e909 d146411e896 ">
                                 <p><code class="codeph">给予</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e917" headers="d146411e893 ">
                                 <p>创建或更新资源</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e917 d146411e896 ">
                                 <p>如果资源已经存在： <code class="codeph">Create</code> ， <code class="codeph">LinkIn</code> ， <code class="codeph">LinkTo</code></p>
                                 <p>如果资源目标尚不存在（仅限HTTP和FTP）： <code class="codeph">Update</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e936" headers="d146411e893 ">
                                 <p>创建一个文件夹</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e936 d146411e896 ">
                                 <p><code class="codeph">Create</code> ， <code class="codeph">LinkIn</code> ， <code class="codeph">LinkTo</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e950" headers="d146411e893 ">
                                 <p>创建指向现有资源的链接</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e950 d146411e896 ">
                                 <p><code class="codeph">LinkIn</code>包含链接目标的文件夹上， <code class="codeph">LinkTo</code>对目标资源被链接</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e962" headers="d146411e893 ">
                                 <p>取消链接文件资源或空文件夹资源。（递减<code class="codeph">RefCount</code> ，如果它变为零，则从磁盘中删除资源。）
                                 </p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e962 d146411e896 ">
                                 <p><code class="codeph">UnlinkIn</code> ， <code class="codeph">UnlinkFrom</code> ，如果<code class="codeph">RefCount</code>为零，则<code class="codeph">Delete</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e982" headers="d146411e893 ">
                                 <p>强行删除文件夹及其内容</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e982 d146411e896 ">
                                 <p>递归地生成用于取消链接资源的事件。递归删除文件夹子资源，然后删除该文件夹。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e989" headers="d146411e893 ">
                                 <p>强制删除资源的所有链接</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e989 d146411e896 ">
                                 <p>为删除的每个链接生成取消链接事件。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e996" headers="d146411e893 ">
                                 <p>按路径名更新资源的内容，属性或ACL</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e996 d146411e896 ">
                                 <p><code class="codeph">更新</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e1004" headers="d146411e893 ">
                                 <p>在资源上放置一个深度为零的WebDAV锁</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e1004 d146411e896 ">
                                 <p><code class="codeph">锁</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e1012" headers="d146411e893 ">
                                 <p>从资源中删除深度为零的WebDAV锁</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e1012 d146411e896 ">
                                 <p><code class="codeph">锁</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e1021" headers="d146411e893 ">
                                 <p>重命名（移动）资源</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e1021 d146411e896 ">
                                 <p><code class="codeph">LinkIn</code>和<code class="codeph">LinkTo</code>上的新位置， <code class="codeph">UnlinkIn</code>和<code class="codeph">UnlinkFrom</code>在老位置</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e1039" headers="d146411e893 ">
                                 <p>复制资源</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e1039 d146411e896 ">
                                 <p><code class="codeph">Create</code> ， <code class="codeph">LinkIn</code>和<code class="codeph">LinkTo</code>上的新位置</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e1054" headers="d146411e893 ">
                                 <p>查看资源</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e1054 d146411e896 ">
                                 <p><code class="codeph">查看</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e1062" headers="d146411e893 ">
                                 <p>签入资源</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e1062 d146411e896 ">
                                 <p><code class="codeph">报到</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e1070" headers="d146411e893 ">
                                 <p>在资源控制下放置资源</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e1070 d146411e896 ">
                                 <p><code class="codeph">版本控制</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e1078" headers="d146411e893 ">
                                 <p>取消选中资源</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e1078 d146411e896 ">
                                 <p><code class="codeph">取消签</code></p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <p><a href="XML-DB-repository-events.html#GUID-5821696E-5128-4221-9E9F-D36E2ACE5834__BABCCJGG" title="此表列出了与每个存储库操作关联的事件。">表30-2</a>中列出的所有操作都是原子操作，但以下情况除外：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>强制删除文件夹及其内容</p>
                     </li>
                     <li>
                        <p>使用HTTP（仅）通过路径名更新资源属性</p>
                     </li>
                     <li>
                        <p>使用HTTP复制文件夹（仅限）</p>
                     </li>
                  </ul>
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-5821696E-5128-4221-9E9F-D36E2ACE5834__GUID-7FF30433-3489-441D-8DA6-439037134710">
                     <p class="notep1">也可以看看：</p>
                     <p>有关使用API和协议访问资源的信息，请<a href="accessing-XML-DB-repository-data.html#GUID-B162A199-F7F8-4E81-B2FD-919B90F7FE83__BABBJJDI" title="此表描述了用于访问Oracle XML DB存储库的API选项。">参见表21-3</a></p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="XML-DB-repository-events.html#GUID-1A25D4D1-2353-41FC-9D86-9C35F9F95532" title="您可以使用Oracle XML DB Repository以存储库资源的形式存储和访问任何类型的数据。您可以从任何应用程序访问存储库数据。有时您的应用程序需要在发生特定存储库操作时执行某些操作。您可以使用存储库事件执行此操作。">Oracle XML DB存储库事件</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB5600"></a><div class="props_rev_3"><a id="GUID-C4139224-FF34-4B6D-9B68-481FA41E634C" name="GUID-C4139224-FF34-4B6D-9B68-481FA41E634C"></a><h3 id="ADXDB-GUID-C4139224-FF34-4B6D-9B68-481FA41E634C" class="sect3"><span class="enumeration_section">30.4</span>存储库事件处理程序注意事项</h3>
               <div>
                  <p>列出了一些注意事项，用于定义Oracle XML DB Repository事件的处理程序。</p>
                  <p></p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>在任何处理程序中：不要在处理程序中使用<code class="codeph">COMMIT</code> ， <code class="codeph">ROLLBACK</code>或数据定义语言（DDL）语句。不要调用行为与DDL语句类似的PL / SQL函数或过程，例如<code class="codeph">DBMS_XMLSCHEMA.registerSchema</code> 。在<code class="codeph">Render</code>处理程序中：不要使用数据操作语言（DML）语句。
                        </p>
                        <p>要解决这些限制，处理程序可以在自治事务中使用此类语句，但必须确保不会出现锁定冲突。</p>
                     </li>
                     <li>
                        <p>在<code class="codeph">Render</code>处理程序中，不要关闭输出流。（您可以附加到流中。）
                        </p>
                     </li>
                     <li>
                        <p><span class="italic">不要</span>使用修改方法从类<code class="codeph">XDBResource</code>的处理，除非它是一个<code class="codeph">Pre-Create</code>或<code class="codeph">Pre-Update</code>处理。<span class="italic">不要</span>使用方法<code class="codeph">XDBResource.save()</code>中的任何处理。
                        </p>
                     </li>
                     <li>
                        <p>Oracle建议您仅开发安全的存储库事件处理程序。特别是：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>仅写入应用程序拥有的名称空间中的资源属性，永远不会在<code class="codeph">xdb</code>名称空间中。
                              </p>
                           </li>
                           <li>
                              <p>在创建资源时不要删除它。</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>存储库事件处理程序传递给<code class="codeph">XDBRepositoryEvent</code>对象，该对象仅在当前SQL语句或协议操作期间存在。您可以在此对象上使用PL / SQL过程和Java方法来获取有关资源，事件和关联事件处理程序的信息。
                        </p>
                     </li>
                     <li>
                        <p>当事件处理程序执行导致其他存储库事件发生的操作时，会立即发生这些级联事件。在当前事件的处理程序完成后，它们不会排队等待。因此，每个事件都在其相应操作的上下文中发生。</p>
                     </li>
                     <li>
                        <p>存储库事件处理程序是同步调用的。它们在相应操作的进程，会话和事务上下文中执行。但是，处理程序可以使用Oracle数据库高级队列（AQ）对存储库事件进行排队，然后由其他进程异步处理。</p>
                     </li>
                     <li>
                        <p>由于存储库事件处理程序在其相应操作的事务上下文中执行，因此该操作或先前在事务中运行的其他操作获取的任何锁定仍处于活动状态。事件处理程序不得启动尝试获取此类锁定的单独会话或事务。否则，处理程序挂起。</p>
                     </li>
                     <li>
                        <p>存储库事件处理程序按它们在资源配置文件中出现的顺序调用。如果为资源配置定义了前提条件，则仅调用满足前提条件的那些处理程序。</p>
                     </li>
                     <li>
                        <p>尽管处理程序是按照它们在配置文件中定义的顺序调用的，但请避免让代码依赖于此。如果在调用处理程序时当前的用户具有特权<code class="codeph">write-config</code> ，则可以在执行处理程序内更改处理程序调用顺序。
                        </p>
                     </li>
                     <li>
                        <p>在调用任何处理程序之前，确定适用于给定存储库事件发生的整个处理程序列表。这尤其意味着在调用任何处理程序之前评估每个处理程序的前提条件。</p>
                     </li>
                     <li>
                        <p>以下注意事项适用于存储库事件的<span class="italic">错误处理</span> ：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>如果操作的访问检查失败，则永远不会调用操作前事件处理程序。</p>
                           </li>
                           <li>
                              <p>在调用任何事件之前，将检查给定事件的所有处理程序。如果它们中的任何一个不可用（例如，不再存在），则<span class="italic">不会</span>调用它们。
                              </p>
                           </li>
                           <li>
                              <p>如果在事件处理期间引发错误，则不会针对相同的SQL语句或协议操作调用其他后续事件处理程序。取消当前语句或操作，并回滚其所有更改。</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>以下注意事项适用于存储库事件的<span class="italic">资源安全性</span> ：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>事件处理程序可以具有调用者权限或定义者权限。您在创建包时指定PL / SQL包的执行权限。使用<code class="codeph">loadjava</code>实用程序将Java类加载到数据库时，可以指定Java类的执行权限。如果指定了调用者的权限，但未为调用者的权限配置给定的处理程序，则会引发权限不足的错误。
                              </p>
                           </li>
                           <li>
                              <p>在事件处理程序中，当前用户权限（无论是通过调用者还是定义者权限获得）由其ACL对给定资源进行详细确定。这些权限决定了处理程序可以对资源执行的操作。例如，如果当前用户具有特定资源的<code class="codeph">read-properties</code>和<code class="codeph">read-contents</code>权限，则事件处理程序可以读取该资源。
                              </p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>以下注意事项适用于<span class="italic">链接</span>和<span class="italic">取消</span> <span class="italic">链接的</span>存储库事件：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>创建资源链接后，如果要将父文件夹的任何资源配置文件也应用于链接资源，请使用过程<code class="codeph">DBMS_RESCONFIG.appendResConfig</code>将配置文件添加到链接资源。您可以从链接资源的<code class="codeph">Post-LinkTo</code>事件处理程序调用此过程。
                              </p>
                           </li>
                           <li>
                              <p>取消链接资源后，如果要删除链接时添加的任何此类资源配置文件，请使用过程<code class="codeph">DBMS_RESCONFIG.deleteResConfig</code>将其从未链接的资源中删除。您可以从<code class="codeph">Post-UnlinkFrom</code>资源的<code class="codeph">Post-UnlinkFrom</code>事件处理程序中调用此过程。
                              </p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>不要为文件夹<code class="codeph">/sys/schemas</code>上的事件或此文件夹下的资源定义处理程序。任何此类资源都不会发生事件，因此会忽略此类事件处理程序。这意味着影响存储库（注册，删除等）的XML模式操作不会产生事件。
                        </p>
                     </li>
                  </ul>
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-C4139224-FF34-4B6D-9B68-481FA41E634C__GUID-9974B3C1-2ED9-4C48-8823-85F0F8415501">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>有关PL / SQL函数和操作存储库事件的过程的信息，请参阅<a href="../arpls/DBMS_XEVENT.html#ARPLS210" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a></p>
                        </li>
                        <li>
                           <p><a href="../jaxml/index.html" target="_blank"><span><cite>Oracle数据库XML Java API参考</cite></span></a> ，类<code class="codeph">XDBRepositoryEvent</code>和<code class="codeph">XDBEvent</code>以获取有关操作存储库事件的Java方法的信息</p>
                        </li>
                        <li>
                           <p><a href="XML-DB-repository-events.html#GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119" title="在资源配置文件中，使用元素事件侦听器（元素ResConfig的子）来配置Oracle XML DB存储库事件处理。">配置存储库事件</a>以获取有关使用调用者权限定义存储库事件处理程序的信息</p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="XML-DB-repository-events.html#GUID-1A25D4D1-2353-41FC-9D86-9C35F9F95532" title="您可以使用Oracle XML DB Repository以存储库资源的形式存储和访问任何类型的数据。您可以从任何应用程序访问存储库数据。有时您的应用程序需要在发生特定存储库操作时执行某些操作。您可以使用存储库事件执行此操作。">Oracle XML DB存储库事件</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB5601"></a><div class="props_rev_3"><a id="GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119" name="GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119"></a><h3 id="ADXDB-GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119" class="sect3"><span class="enumeration_section">30.5</span>存储库事件的配置</h3>
               <div>
                  <p>在资源配置文件中，使用元素<code class="codeph">event-listeners</code> （元素<code class="codeph">ResConfig</code>子）来配置Oracle XML DB存储库事件处理。
                  </p>
                  <p>您可以配置Oracle XML DB存储库资源的事件处理，就像配置存储库资源的任何其他处理一样 - 请参阅<span class="q">“ <a href="configuration-of-XML-DB-repository.html#GUID-AB3B6205-AE7B-4A12-A6B9-C3CC0C1108D3" title="配置Oracle XML DB存储库资源涉及创建配置文件，将该文件作为配置资源添加到存储库，并将配置资源映射到它配置的资源或整个存储库。">配置资源</a> ”</span> 。
                  </p>
                  <p>默认情况下，会启用存储库事件，但您可以通过将参数<code class="codeph">XML_DB_EVENTS</code>设置为<code class="codeph">DISABLE</code>来禁用它们。要在会话级别禁用存储库事件，请使用以下SQL * Plus命令。您必须具有角色<code class="codeph">XDBADMIN</code>才能执行此操作。
                  </p><pre class="oac_no_warn" dir="ltr">ALTER SESSION SET XML_DB_EVENTS = DISABLE;</pre><p>要在系统级别禁用存储库事件，请使用以下SQL * Plus命令，然后重新启动数据库。为后续会话禁用存储库事件。您必须具有<code class="codeph">ALTER SYSTEM</code>权限才能执行此操作。
                  </p><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SET XML_DB_EVENTS = DISABLE;</pre><p>要再次启用存储库事件，请将<code class="codeph">XML_DB_EVENTS</code>的值设置为<code class="codeph">ENABLE</code> 。</p>
                  <p>资源配置文件是符合XML模式<code class="codeph">XDBResConfig.xsd</code>的XML文件，可在Oracle XML DB Repository的路径<code class="codeph">/sys/schemas/PUBLIC/xmlns.oracle.com/xdb/XDBResConfig.xsd</code> 。您可以使用元素<code class="codeph">event-listeners</code> （元素<code class="codeph">ResConfig</code>子元素）来配置存储库事件处理。
                  </p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-FC91D1C8-A5BF-4FEB-B6C9-6953FA9F6279">配置元素事件侦听器</a><br>每个资源配置文件都可以有一个<code class="codeph">event-listeners</code>元素，作为元素<code class="codeph">ResConfig</code>的子元素。这将配置目标资源的所有事件处理。如果资源配置文件适用于整个存储库，而不是特定资源，则它会定义存储库中所有资源的事件处理。
                     </li>
                     <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-BA0619E8-B9F4-4824-BD6A-0C65A3C040C8">配置元素侦听器</a><br>元素<code class="codeph">listener</code>是元素<code class="codeph">event-listeners</code> <code class="codeph">listener</code>器的子元素，它配置单个存储库事件侦听器。
                     </li>
                     <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976">存储库事件配置示例</a><br>提供了配置存储库事件的示例。资源配置文件分别定义了带有和不带前置条件的Java和PL / SQL事件侦听器。示例根据MIME类型对资源进行分类。它包括用于创建资源配置文件的PL / SQL代码。示例使用Java和PL / SQL实现侦听器。</li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119__GUID-1867B84E-ADA5-490B-98EE-4F8E680F4E6E">
                     <p class="notep1">也可以看看：</p>
                     <p>有关配置存储库资源的一般信息，请配置<a href="configuration-of-XML-DB-repository.html#GUID-E44B59D4-7A7E-4303-ACE3-B801797B06AF" title="Oracle XML DB Repository的整体配置适用于所有存储库资源。它不包括配置用于处理事件或管理XLink和XInclude处理的参数。您使用资源配置文件来配置资源。">Oracle XML DB存储</a>库</p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="XML-DB-repository-events.html#GUID-1A25D4D1-2353-41FC-9D86-9C35F9F95532" title="您可以使用Oracle XML DB Repository以存储库资源的形式存储和访问任何类型的数据。您可以从任何应用程序访问存储库数据。有时您的应用程序需要在发生特定存储库操作时执行某些操作。您可以使用存储库事件执行此操作。">Oracle XML DB存储库事件</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADXDB5602"></a><div class="props_rev_3"><a id="GUID-FC91D1C8-A5BF-4FEB-B6C9-6953FA9F6279" name="GUID-FC91D1C8-A5BF-4FEB-B6C9-6953FA9F6279"></a><h4 id="ADXDB-GUID-FC91D1C8-A5BF-4FEB-B6C9-6953FA9F6279" class="sect4"><span class="enumeration_section">30.5.1</span>配置元素事件监听器</h4>
                  <div>
                     <p>每个资源配置文件都可以有一个<code class="codeph">event-listeners</code>元素，作为元素<code class="codeph">ResConfig</code>的子元素。这将配置目标资源的所有事件处理。如果资源配置文件适用于整个存储库，而不是特定资源，则它会定义存储库中所有资源的事件处理。
                     </p>
                     <p>元素<code class="codeph">event-listeners</code>具有以下可选属性：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">set-invoker</code> - 如果资源配置定义了一个或多个存储库事件处理程序以具有调用者权限，则将其设置为<code class="codeph">true</code> 。默认值为<code class="codeph">false</code> ，表示使用定义者权限。
                           </p>
                           <p>要定义调用者权限存储库事件处理程序，您必须具有数据库角色<code class="codeph">XDB_SET_INVOKER</code> 。此角色授予<code class="codeph">DBA</code> ，但不授予<code class="codeph">XDBADMIN</code> 。仅在创建或更新资源配置文件时才检查角色<code class="codeph">XDB_SET_INVOKER</code> 。在运行时仅检查属性<code class="codeph">set-invoker</code>而不是角色<code class="codeph">XDB_SET_INVOKER</code>以确保足够的权限。
                           </p>
                           <div class="infoboxnotealso" id="GUID-FC91D1C8-A5BF-4FEB-B6C9-6953FA9F6279__GUID-72EEDD2E-3937-4C70-8C6D-8D0C78091409">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="XML-DB-repository-events.html#GUID-C4139224-FF34-4B6D-9B68-481FA41E634C" title="Some considerations are listed for defining handlers for Oracle XML DB Repository events.">存储库事件处理程序</a>有关特权不足错误的信息的<a href="XML-DB-repository-events.html#GUID-C4139224-FF34-4B6D-9B68-481FA41E634C" title="列出了一些注意事项，用于定义Oracle XML DB Repository事件的处理程序。">注意事项</a></p>
                           </div>
                        </li>
                        <li>
                           <p><code class="codeph">default-schema</code> - 默认架构值，用于未定义<code class="codeph">schema</code>元素的侦听器。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">default-language</code> - 默认语言值，用于未定义<code class="codeph">language</code>元素的侦听器。
                           </p>
                        </li>
                     </ul>
                     <p>元素<code class="codeph">event-listeners</code>具有一系列<code class="codeph">listener</code>元素作为子元素。这些配置单个存储库事件侦听器。监听器在运行时按<code class="codeph">listener</code>元素的顺序处理。
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="XML-DB-repository-events.html#GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119" title="在资源配置文件中，使用元素事件侦听器（元素ResConfig的子）来配置Oracle XML DB存储库事件处理。">存储库事件的配置</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADXDB5603"></a><div class="props_rev_3"><a id="GUID-BA0619E8-B9F4-4824-BD6A-0C65A3C040C8" name="GUID-BA0619E8-B9F4-4824-BD6A-0C65A3C040C8"></a><h4 id="ADXDB-GUID-BA0619E8-B9F4-4824-BD6A-0C65A3C040C8" class="sect4"><span class="enumeration_section">30.5.2</span>配置元素监听器</h4>
                  <div>
                     <p>元素<code class="codeph">listener</code>是元素<code class="codeph">event-listeners</code> <code class="codeph">listener</code>器的子元素，它配置单个存储库事件侦听器。
                     </p>
                     <div class="section">
                        <p>每个<code class="codeph">listener</code>元素都具有以下子元素。所有这些都是可选的，除了<code class="codeph">source</code> ，它们可以按任何顺序出现（它们的顺序无关紧要）。
                        </p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">description</code> - 侦听器的描述。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">schema</code> - 存储库事件处理程序的Java或PL / SQL实现的数据库模式。如果既未定义此<code class="codeph">default-schema</code>也未定义<code class="codeph">default-schema</code> ，则会引发错误。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">source</code> （必需） - 提供处理程序方法的Java类，PL / SQL包或对象类型的名称。必须使用包名限定Java类名。使用空的<code class="codeph">source</code>元素指示存储库事件处理程序是独立的PL / SQL存储过程。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">language</code> - 侦听器类（Java）或包（PL / SQL）的实现语言。如果既未定义此<code class="codeph">default-language</code>也未定义<code class="codeph">default-language</code> ，则会引发错误。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">pre-condition</code> - 要执行此侦听器中的任何存储库事件处理程序的前提条件。这与常规资源配置元素<code class="codeph">configuration</code>的<code class="codeph">pre-condition</code>子元素相同 - 请参阅<a href="configuration-of-XML-DB-repository.html#GUID-5010D4C5-38CA-4ABE-A559-C1D1001359D3" title="配置元素defaultChildConfig仅适用于文件夹。它包含要应用于文件夹中所有子资源的配置信息。元素defaultChildConfig具有一个或多个配置子元素，每个元素都定义文件夹中资源的可能配置。">配置元素defaultChildConfig和配置</a> 。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">events</code> - 唯一存储库事件类型名称的序列： <code class="codeph">Render</code> ， <code class="codeph">Pre-Create</code>等。仅为侦听器启用了这些类型的存储库事件的处理程序。有关<a href="XML-DB-repository-events.html#GUID-5F7D0772-848D-49EA-832B-AB1117B9E3F1" title="Repository operations are associated with predefined events. Except for a rendering operation, events come in pre and post pairs.">可能的存储</a>库事件类型的列表，请参阅<a href="XML-DB-repository-events.html#GUID-5F7D0772-848D-49EA-832B-AB1117B9E3F1" title="存储库操作与预定义事件相关联。除了渲染操作之外，事件都是前后对。">可能的存储</a>库事件。如果元素<code class="codeph">events</code>不存在，则为侦听器启用所有类型的存储库事件的处理程序，这可能是浪费的。提供元素<code class="codeph">events</code>以消除无效的存储库事件的处理程序调用。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="XML-DB-repository-events.html#GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119" title="在资源配置文件中，使用元素事件侦听器（元素ResConfig的子）来配置Oracle XML DB存储库事件处理。">存储库事件的配置</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADXDB5605"></a><a id="ADXDB5606"></a><a id="ADXDB5607"></a><a id="ADXDB5608"></a><a id="ADXDB5609"></a><a id="ADXDB5604"></a><div class="props_rev_3"><a id="GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976" name="GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976"></a><h4 id="ADXDB-GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976" class="sect4"><span class="enumeration_section">30.5.3</span>存储库事件配置示例</h4>
                  <div>
                     <p>提供了配置存储库事件的示例。资源配置文件分别定义了带有和不带前置条件的Java和PL / SQL事件侦听器。示例根据MIME类型对资源进行分类。它包括用于创建资源配置文件的PL / SQL代码。示例使用Java和PL / SQL实现侦听器。</p>
                     <div class="section">
                        <p><a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABDEGAA">示例30-1</a>显示了定义两个事件侦听器的资源配置文件的内容。每个听者定义的类型库的事件处理程序<code class="codeph">Post-LinkIn</code> ， <code class="codeph">Post-UnlinkIn</code> ，以及<code class="codeph">Post-Update</code> 。它定义了前提条件，默认语言（Java）和默认数据库模式。
                        </p>
                        <p>第一个侦听器的处理程序的实现是在数据库模式<code class="codeph">CM</code>定义的Java类<code class="codeph">oracle.cm.quota</code>中。仅为<code class="codeph">ContentType</code> <code class="codeph">image/gif</code>资源上的事件调用这些处理程序。
                        </p>
                        <p>第二个侦听器的处理程序的实现是在数据库模式<code class="codeph">IFS</code> （此资源配置文件的默认模式）中定义的Java类<code class="codeph">oracle.ifs.quota</code>中。仅对名称空间为<code class="codeph">http://foo.xsd</code> <code class="codeph">ifs-file</code>类型的资源上的事件调用这些处理程序。</p>
                        <div class="infoboxnotealso" id="GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__GUID-81D0675B-D3D5-4DD8-8ABE-0FC83C72E847">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="configuration-of-XML-DB-repository.html#GUID-5010D4C5-38CA-4ABE-A559-C1D1001359D3" title="配置元素defaultChildConfig仅适用于文件夹。它包含要应用于文件夹中所有子资源的配置信息。元素defaultChildConfig具有一个或多个配置子元素，每个元素都定义文件夹中资源的可能配置。">配置元素defaultChildConfig和配置元素</a>的描述<code class="codeph">defaultChildConfig</code>和<code class="codeph">applicationData</code></p>
                        </div>
                        <p>作为一个简单的端到端说明，假设应用程序需要根据MIME类型对文件夹<code class="codeph">/public/res-app</code>的资源进行分类。它创建了文件夹<code class="codeph">/public/app/XML-TXT</code> ， <code class="codeph">/public/app/IMG</code>和<code class="codeph">/public/app/FOLDER</code>中资源的链接，具体取决于资源MIME类型是<code class="codeph">text/xml</code> ， <code class="codeph">image/gif</code>还是<code class="codeph">application/octet-stream</code> ，分别。这在<a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABBJGAC">例30-2</a> ， <a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABCDJEH">例30-3</a>和<a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABIHGGH">例30-5中说明</a> 。
                        </p>
                        <p><a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABBJGAC">示例30-2</a>显示了为此分类说明创建配置文件的PL / SQL代码。它定义了一个处理<code class="codeph">Pre-UnlinkIn</code>和<code class="codeph">Post-LinkIn</code> <code class="codeph">Pre-UnlinkIn</code>类型事件的侦听器。它明确定义了语言（PL / SQL）和数据库模式。没有定义任何先决条件。
                        </p>
                        <p><a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABCDJEH">例30-3</a>显示了实现<a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABBJGAC">示例30-2</a>中配置的事件处理程序的PL / SQL代码。<code class="codeph">Post-LinkIn</code>事件处理程序在其中一个文件夹<code class="codeph">/public/app/XML-TXT</code> ， <code class="codeph">/public/app/IMG</code>和<code class="codeph">/public/app/FOLDER</code>创建指向<code class="codeph">eventObject</code>资源的链接，具体取决于资源MIME类型。<code class="codeph">Pre-UnlinkIn</code>事件处理程序删除<code class="codeph">Post-LinkIn</code> <code class="codeph">Pre-UnlinkIn</code>事件处理程序创建的链接。
                        </p>
                        <div class="infoboxnotealso" id="GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__GUID-34892E6E-8B01-423B-A170-E0504253AF45">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关PL / SQL包<code class="codeph">DBMS_XDBRESOURCE</code>信息，请参阅<a href="../arpls/DBMS_XDBRESOURCE.html#ARPLS230" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a></p>
                              </li>
                              <li>
                                 <p>有关PL / SQL包<code class="codeph">DBMS_XEVENT</code>信息，请参阅<a href="../arpls/DBMS_XEVENT.html#ARPLS210" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a></p>
                              </li>
                              <li>
                                 <p>有关PL / SQL包<code class="codeph">DBMS_XDB_REPOS</code>信息，请参阅<a href="../arpls/DBMS_XDB_REPOS.html#ARPLS74188" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                        <p>Java示例的配置与<a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABBJGAC">示例30-2中</a>的相同，但这两行除外，它们将替换<a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABBJGAC">示例30-2中</a>具有相同名称的元素：</p><pre class="oac_no_warn" dir="ltr">&lt;source&gt; <span class="bold">category</span> &lt;/ source&gt; &lt;language&gt; <span class="bold">Java</span> &lt;/ language&gt;</pre><p><a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABCFCIH">示例30-4</a>显示了实现事件处理程序的Java代码。逻辑与<a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABCDJEH">例30-3中</a>的逻辑相同。
                        </p>
                        <p><a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABIHGGH">例30-5</a>演示了如<a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABCDJEH">例30-3</a>或<a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABCFCIH">例30-4</a>中实现的事件处理程序的调用。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABDEGAA">
                        <p class="titleinexample">示例30-1具有前提条件的Java事件侦听器的资源配置文件</p><pre class="oac_no_warn" dir="ltr">&lt;ResConfig xmlns =“http://xmlns.oracle.com/xdb/XDBResConfig.xsd”xmlns：xsi =“http://www.w3.org/2001/XMLSchema-instance”xsi：schemaLocation =“http：/ /xmlns.oracle.com/xdb/XDBResConfig.xsd http://xmlns.oracle.com/xdb/XDBResConfig.xsd“&gt; &lt;event-listeners <span class="bold">default-language =”Java“default-schema =”IFS“</span> &gt; &lt;listener &gt; &lt;description&gt;类别应用程序&lt;/ description&gt; &lt;schema&gt; CM &lt;/ schema&gt; &lt;source&gt; <span class="bold">oracle.cm.category</span> &lt;/ source&gt; &lt;events <span class="bold">&gt;</span> <span class="bold">&lt;Post-LinkIn /&gt;</span> <span class="bold">&lt;Post-</span> <span class="bold">UnlinkIn /&gt;</span> <span class="bold">&lt;Post-Update / &gt;</span> &lt;/ events&gt; &lt;pre-condition&gt; &lt;existsNode&gt; &lt;XPath&gt; / Resource <span class="bold">[ContentType =“image / gif”]</span> &lt;/ XPath&gt; &lt;/ existsNode&gt; &lt;/ pre-condition&gt; &lt;/ listener&gt; &lt;listener&gt; &lt;description &gt;检查配额&lt;/描述&gt; &lt;源&gt; <span class="bold">oracle.ifs.quota</span> &lt;/源&gt; &lt;事件&gt; <span class="bold">&lt;后林肯/&gt;</span> <span class="bold">&lt;后UnlinkIn /&gt;</span> <span class="bold">&lt;更新后/&gt;</span> &lt;/事件&gt; &lt;先决条件&gt; &lt; existsNode&gt; &lt;XPath&gt; r：/ Resource / <span class="bold">[ns：type =“ifs-file”]</span> &lt;/ XPath&gt; &lt;namespace&gt; xmlns：r =“http://xmlns.oracle.com/xdb/XDBResource.xsd”xmlns ： <span class="bold">ns =“http：//foo.xsd</span> ”&lt;/ namespace&gt; &lt;/ existsNode&gt; &lt;/ pre-condition&gt; &lt;/ listener&gt; &lt;/ event-listeners&gt; &lt;defaultChildConfig&gt; &lt;configuration&gt; &lt;path&gt; /sys/xdb/resconfig/user_rc.xml &lt;/ path&gt; &lt;/ configuration&gt; &lt;/ defaultChildConfig&gt; &lt;applicationData&gt; &lt;foo：data xmlns：foo =“http：//foo.xsd “&gt; &lt;foo：item1&gt; 1234 &lt;/ foo：item1&gt; &lt;/ foo：data&gt; &lt;/ applicationData&gt; &lt;/ ResConfig&gt;</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABBJGAC">
                        <p class="titleinexample">示例30-2没有前提条件的PL / SQL事件监听器的资源配置文件</p><pre class="oac_no_warn" dir="ltr">DECLARE b BOOLEAN：= FALSE; BEGIN b：= DBMS_XDB_REPOS.createFolder（'/ public / resconfig'）; b：= DBMS_XDB_REPOS.createResource（'/ public /resconfig/appcatg-rc1.xml'，'&lt;ResConfig xmlns =“http://xmlns.oracle.com/xdb/XDBResConfig.xsd”xmlns：xsi =“http：/ /www.w3.org/2001/XMLSchema-instance“xsi：schemaLocation =”http://xmlns.oracle.com/xdb/XDBResConfig.xsd http://xmlns.oracle.com/xdb/XDBResConfig.xsd“&gt; &lt;event-listeners&gt; &lt;listener&gt; &lt;description&gt;类别应用程序&lt;/ description&gt; <span class="bold">&lt;schema&gt; APPCATGUSER1 &lt;/ schema&gt;</span> <span class="bold">&lt;source&gt; APPCATG_EVT_PKG1 &lt;/ source&gt;</span> <span class="bold">&lt;language&gt; PL / SQL &lt;/ language&gt;</span> &lt;events&gt; <span class="bold">&lt;Pre-UnlinkIn /&gt;</span> <span class="bold">&lt;Post-LinkIn /&gt;</span> &lt;/ events&gt; &lt;/ listener&gt; &lt;/ event-listeners&gt; &lt;defaultChildConfig&gt; &lt;configuration&gt; &lt;path&gt; /public/resconfig/appcatg-rc1.xml &lt;/ path&gt; &lt;/ configuration&gt; &lt; / defaultChildConfig&gt; &lt;/ ResConfig&gt;'，'http：//xmlns.oracle.com/xdb/XDBResConfig.xsd'，'ResConfig'）;结束; / BEGIN DBMS_RESCONFIG.appendResConfig（'/ public / res-app'，'/ public / resconfig / appcatg-rc.xml'，DBMS_RESCONFIG.APPEND_RECURSIVE）;结束; /</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABCDJEH">
                        <p class="titleinexample">示例30-3实现事件监听器的PL / SQL代码</p><pre class="oac_no_warn" dir="ltr">创建或替换包appcatg_evt_pkg1 AS PROCEDURE handlePreUnlinkIn（eventObject DBMS_XEVENT.XDBRepositoryEvent）; PROCEDURE handlePostLinkIn（eventObject DBMS_XEVENT.XDBRepositoryEvent）;结束; / CREATE OR REPLACE PACKAGE BODY appcatg_evt_pkg1 AS PROCEDURE <span class="bold">handlePreUnlinkIn</span> （eventObject DBMS_XEVENT.XDBRepositoryEvent）AS XDBResourceObj DBMS_XDBRESOURCE.XDBResource; ResDisplayName VARCHAR2（100）; ResPath VARCHAR2（1000）; ResOwner VARCHAR2（1000）; ResDeletedBy VARCHAR2（1000）; XDBPathobj DBMS_XEVENT.XDBPath; XDBEventobj DBMS_XEVENT.XDBEvent; SeqChar VARCHAR2（1000）; LinkName VARCHAR2（10000）; ResType VARCHAR2（100）; LinkFolder VARCHAR2（100）; BEGIN XDBResourceObj：= DBMS_XEVENT.getResource（eventObject）; ResDisplayName：= DBMS_XDBRESOURCE.getDisplayName（XDBResourceObj）; ResOwner：= DBMS_XDBRESOURCE.getOwner（XDBResourceObj）; XDBPathobj：= DBMS_XEVENT.getPath（eventObject）; ResPath：= DBMS_XEVENT.getName（XDBPathObj）; XDBEventobj：= DBMS_XEVENT.getXDBEvent（eventObject）; ResDeletedBy：= DBMS_XEVENT.getCurrentUser（XDBEventobj）; BEGIN SELECT XMLCast（XMLQuery（'declare namespace ns =“http://xmlns.oracle.com/xdb/XDBResource.xsd”; / ns：Resource / ns：ContentType'PASSING r。RES RETURNING CONTENT）AS VARCHAR2（100））INTO ResType FROM PATH_VIEW r WHERE r。PATH = ResPath;除非其他人之外的例外情况;结束;如果ResType =' <span class="bold">text / xml</span> '那么LinkFolder：=' <span class="bold">/ public / app / XML-TXT /</span> ';万一;如果ResType =' <span class="bold">image / gif</span> '那么LinkFolder：=' <span class="bold">/ public / app / IMG /</span> ';万一; IF ResType =' <span class="bold">application / octet-</span> stream'THEN LinkFolder：='/ <span class="bold">public / app / FOLDER /</span> ';万一; DBMS_XDB_REPOS。 <span class="bold">deleteResource</span> （LinkFolder || ResDisplayName）;结束; PROCEDURE <span class="bold">handlePostLinkIn</span> （eventObject DBMS_XEVENT.XDBRepositoryEvent）AS XDBResourceObj DBMS_XDBRESOURCE.XDBResource; ResDisplayName VARCHAR2（100）; ResPath VARCHAR2（1000）; ResOwner VARCHAR2（1000）; ResDeletedBy VARCHAR2（1000）; XDBPathobj DBMS_XEVENT.XDBPath; XDBEventobj DBMS_XEVENT.XDBEvent; SeqChar VARCHAR2（1000）; LinkName VARCHAR2（10000）; ResType VARCHAR2（100）; LinkFolder VARCHAR2（100）; BEGIN XDBResourceObj：= DBMS_XEVENT.getResource（eventObject）; ResDisplayName：= DBMS_XDBRESOURCE.getDisplayName（XDBResourceObj）; ResOwner：= DBMS_XDBRESOURCE.getOwner（XDBResourceObj）; XDBPathobj：= DBMS_XEVENT.getPath（eventObject）; ResPath：= DBMS_XEVENT.getName（XDBPathObj）; XDBEventobj：= DBMS_XEVENT.getXDBEvent（eventObject）; ResDeletedBy：= DBMS_XEVENT.getCurrentUser（XDBEventobj）; SELECT XMLCast（XMLQuery（'declare namespace ns =“http://xmlns.oracle.com/xdb/XDBResource.xsd”; / ns：Resource / ns：ContentType'PASSING r。RES RETURNING CONTENT）AS VARCHAR2（100））INTO ResType FROM PATH_VIEW r WHERE r。PATH = ResPath; IF ResType =' <span class="bold">text / xml</span> '那么LinkFolder：=' <span class="bold">/ public / app / XML-TXT</span> ';万一;如果ResType =' <span class="bold">image / gif</span> '那么LinkFolder：=' <span class="bold">/ public / app / IMG</span> ';万一; IF ResType =' <span class="bold">application / octet-</span> stream'THEN LinkFolder：=' <span class="bold">/ public / app / FOLDER</span> ';万一; DBMS_XDB_REPOS。 <span class="bold">link</span> （ResPath，LinkFolder，ResDisplayName）;结束;结束; /</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABCFCIH">
                        <p class="titleinexample">示例30-4 Java代码实现事件监听器</p><pre class="oac_no_warn" dir="ltr">import oracle.xdb.event。*; import oracle.xdb.spi。*; import java.sql。*; import java.io.*; import java.net。*; import oracle.jdbc。*; import oracle.sql。*; import oracle.xdb。XMLType的; import oracle.xdb.dom。*;公共类<span class="bold">类</span>扩展了oracle.xdb.event。XDBBasicEventListener {public Connection <span class="bold">connectToDB</span> （）抛出java.sql。SQLException {try {String strUrl =“jdbc：oracle：kprb：”; String strUname =“appcatguser1”; String strPwd =“appcatguser1”;连接conn = null; OraclePreparedStatement stmt = null; DriverManager.registerDriver（新的oracle.jdbc。一个OracleDriver（））; conn = DriverManager.getConnection（strUrl，strUname，strPwd）;返回; } catch（Exception e1）{System.out.println（“connectToDB java function中的异常”）; System.out.println（“e1：”+ e1.toString（））; return null; public void <span class="bold">handlePostLinkIn</span> （XDBRepositoryEvent eventObject）{XDBPath objXDBPath = null; String strPathName =“”; objXDBPath = eventObject.getPath（）; strPathName = objXDBPath.getName（）; XDBResource objXDBResource1; objXDBResource1 = eventObject.getResource（）; String textResDisplayName = objXDBResource1.getDisplayName（）; String resType = objXDBResource1.getContentType（）; String linkFolder =“”; System.out.println（“resType”+ resType +“sumit”）; System.out.println（“strPathName：”+ strPathName）; System.out.println（“textResDisplayName：”+ textResDisplayName）; if（resType.equals（“ <span class="bold">text / xml</span> ”））linkFolder =“ <span class="bold">/ public / app / XML-TXT /</span> ”;否则if（resType.equals（“ <span class="bold">image / gif</span> ”））linkFolder =“ <span class="bold">/ public / app / IMG /</span> ”;否则if（resType.equals（“ <span class="bold">application / octet-stream</span> ”））linkFolder =“ <span class="bold">/ public / app / FOLDER /</span> ”; System.out.println（“linkFolder：”+ linkFolder）;尝试{Connection con1 = connectToDB（）; OraclePreparedStatement stmt = null;语句=（OraclePreparedStatement）con1.prepareStatement（“CALL DBMS_XDB_REPOS。 <span class="bold">链路</span> （？，？，？）“）; stmt.setString（1，strPathName）; stmt.setString（2，linkFolder）; stmt.setString（3，textResDisplayName）; stmt.execute（）; stmt.close（）; con1.close（）;} catch （java.sql中。SQLException ej1）{System.out.println（“ej1：”+ ej1.toString（））; } / *确保链接不在类别文件夹中。然后检查目标资源的mime类型，并在相应的类别文件夹中创建一个链接。* /} public void <span class="bold">handlePreUnlinkIn</span> （XDBRepositoryEvent eventObject）{XDBPath objXDBPath = null; String strPathName =“”; objXDBPath = eventObject.getPath（）; strPathName = objXDBPath.getName（）; XDBResource objXDBResource1; objXDBResource1 = eventObject.getResource（）; String textResDisplayName = objXDBResource1.getDisplayName（）; String resType = objXDBResource1.getContentType（）; String linkFolder =“”; if（resType.equals（“ <span class="bold">text / xml</span> ”））linkFolder =“ <span class="bold">/ public / app / XML-TXT /</span> ”;否则if（resType.equals（“ <span class="bold">image / gif</span> ”））linkFolder =“ <span class="bold">/ public / app / IMG /</span> ”;否则if（resType.equals（“ <span class="bold">application / octet-stream</span> ”））linkFolder =“ <span class="bold">/ public / app / FOLDER /</span> ”;尝试{Connection con1 = connectToDB（）; OraclePreparedStatement stmt = null;语句=（OraclePreparedStatement）con1.prepareStatement（“CALL <span class="bold">DBMS_XDB_REPOS。deleteResource（？）</span>“）; stmt.setString（1，linkFolder + textResDisplayName）; stmt.execute（）; stmt.close（）; con1.close（）;} catch（java.sql。SQLException ej1）{System.out.println（“ej1：”+ ej1.toString（））; }}}</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABIHGGH">
                        <p class="titleinexample">示例30-5调用事件处理程序</p><pre class="oac_no_warn" dir="ltr">DECLARE ret BOOLEAN; BEGIN ret：= DBMS_XDB_REPOS.createResource（'/ public / <span class="bold">res-app / res1.xml</span> '，'&lt;name&gt; TestForEventType-1 &lt;/ name&gt;'）;结束; / DECLARE b BOOLEAN：= FALSE; dummy_data CLOB：='AAA'; BEGIN b：= DBMS_XDB_REPOS.createResource（'/ public / <span class="bold">res-app / res2.gif</span> '，dummy_data）;结束; / DECLARE b BOOLEAN：= FALSE; dummy_data CLOB：='AAA'; BEGIN b：= DBMS_XDB_REPOS.createFolder（'/ public / <span class="bold">res-app / res-appfolder1</span> '）;结束; SELECT PATH FROM PATH_VIEW WHERE PATH LIKE'/ public / <span class="bold">app</span> /％'ORDER BY PATH;路径--------------------------------- / public / app / FOLDER / public / <span class="bold">app / FOLDER / res-appfolder1</span> / public / app / IMG / public / <span class="bold">app / IMG / res2.gif</span> / public / app / XML-TXT / public / <span class="bold">app / XML-TXT / res1.xml</span>选择了6行。- 删除/ res-app资源。/ app资源也会被删除。EXEC DBMS_XDB_REPOS.deleteResource（'/ public / res-app / res2.gif'）; EXEC DBMS_XDB_REPOS.deleteResource（'/ public / res-app / res1.xml'）; EXEC DBMS_XDB_REPOS.deleteResource（'/ public / res-app / res-appfolder1'）; SELECT PATH FROM PATH_VIEW WHERE PATH LIKE'/ public / <span class="bold">app</span> /％'ORDER BY PATH; PATH ------------------- / public / app / FOLDER / public / app / IMG / public / app / XML-TXT 3行选中。</pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="XML-DB-repository-events.html#GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119" title="在资源配置文件中，使用元素事件侦听器（元素ResConfig的子）来配置Oracle XML DB存储库事件处理。">存储库事件的配置</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>