<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>使用UCP管理器概述</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Universal Connection Pool Developer&#39;s Guide "></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Universal Connection Pool Developer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="universal-connection-pool-developers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-02-13T06:57:38-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1999, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96473-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="using-ucp-manager.html" title="Previous" type="text/html"></link>
      <link rel="next" href="jmx-based-management.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Universal Connection Pool Developer&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="JJUCP"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="using-ucp-manager.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="jmx-based-management.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">通用连接池开发人员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="using-ucp-manager.html" property="item" typeof="WebPage"><span property="name">使用连接池管理器</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用UCP管理器概述</li>
            </ol>
            <a id="GUID-8932E6BA-EF64-442D-9E43-4FC6B7046E11" name="GUID-8932E6BA-EF64-442D-9E43-4FC6B7046E11"></a><a id="JJUCP8181"></a>
            
            <h2 id="JJUCP-GUID-8932E6BA-EF64-442D-9E43-4FC6B7046E11" class="sect2"><span class="enumeration_section">7.1</span>使用UCP管理器概述</h2>
         </header>
         <div class="ind">
            <div>
               <p>通用连接池（UCP）管理器创建和维护UCP实例。每次创建新池时，都会向池管理器注册池实例。本节包括以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="overview-using-ucp-manager.html#GUID-C34A192A-13AB-4BCA-B84C-FD53FC61885A">关于连接池管理器</a></p>
                  </li>
                  <li>
                     <p><a href="overview-using-ucp-manager.html#GUID-3757F854-3800-49FA-936E-2AC4C91CD5F1">为UCP创建连接池管理器</a></p>
                  </li>
                  <li>
                     <p><a href="overview-using-ucp-manager.html#GUID-2652F7EE-B799-4B5F-9CC0-9C0BC291C8E4">连接的生命周期状态</a></p>
                  </li>
                  <li>
                     <p><a href="overview-using-ucp-manager.html#GUID-366FBBD8-B19D-442C-AD11-979FCB418833">维护通用连接池</a></p>
                  </li>
               </ul>
            </div><a id="JJUCP8182"></a><div class="props_rev_3"><a id="GUID-C34A192A-13AB-4BCA-B84C-FD53FC61885A" name="GUID-C34A192A-13AB-4BCA-B84C-FD53FC61885A"></a><h3 id="JJUCP-GUID-C34A192A-13AB-4BCA-B84C-FD53FC61885A" class="sect3"><span class="enumeration_section">7.1.1</span>关于连接池管理器</h3>
               <div>
                  <p><a id="d6328e90" class="indexterm-anchor"></a><a id="d6328e94" class="indexterm-anchor"></a><a id="d6328e98" class="indexterm-anchor"></a><a id="d6328e100" class="indexterm-anchor"></a>应用程序使用连接池管理器显式创建和管理UCP JDBC连接池。应用程序使用管理器，因为它提供完整的生命周期控制，例如创建，启动，停止和销毁连接池。应用程序还使用管理器对连接池执行例行维护，例如刷新，回收和清除池中的连接。最后，应用程序使用连接池管理器，因为它为管理工具和控制台提供了集中式集成点。
                  </p>
               </div>
            </div><a id="JJUCP8183"></a><div class="props_rev_3"><a id="GUID-3757F854-3800-49FA-936E-2AC4C91CD5F1" name="GUID-3757F854-3800-49FA-936E-2AC4C91CD5F1"></a><h3 id="JJUCP-GUID-3757F854-3800-49FA-936E-2AC4C91CD5F1" class="sect3"><span class="enumeration_section">7.1.2</span>为UCP创建连接池管理器</h3>
               <div>
                  <div class="section">
                     <p><a id="d6328e141" class="indexterm-anchor"></a><a id="d6328e145" class="indexterm-anchor"></a><a id="d6328e147" class="indexterm-anchor"></a><a id="d6328e149" class="indexterm-anchor"></a>连接池管理器是<code class="codeph">UniversalConnectionPoolManager</code>接口的实例，该接口位于<code class="codeph">oracle.ucp.admin</code>包中。管理器是一个Singleton实例，用于管理每个JVM的多个连接池。该接口包括用于与连接池管理器交互的方法。UCP包含用于获取连接池管理器实例的实现。以下示例演示如何使用实现创建连接池管理器实例：</p><pre class="oac_no_warn" dir="ltr">UniversalConnectionPoolManager mgr = UniversalConnectionPoolManagerImpl。getUniversalConnectionPoolManager（）;</pre></div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJUCP8185"></a><a id="JJUCP8184"></a><div class="props_rev_3"><a id="GUID-2652F7EE-B799-4B5F-9CC0-9C0BC291C8E4" name="GUID-2652F7EE-B799-4B5F-9CC0-9C0BC291C8E4"></a><h3 id="JJUCP-GUID-2652F7EE-B799-4B5F-9CC0-9C0BC291C8E4" class="sect3"><span class="enumeration_section">7.1.3</span>连接的生命周期状态</h3>
               <div>
                  <p><a id="d6328e200" class="indexterm-anchor"></a><a id="d6328e204" class="indexterm-anchor"></a>应用程序使用连接池管理器显式控制连接池的生命周期。管理器用于创建，启动，停止和销毁连接池。生命周期方法作为<code class="codeph">UniversalConnectionPoolManager</code>接口的一部分包含在内。
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-2652F7EE-B799-4B5F-9CC0-9C0BC291C8E4__GUID-419E1DB7-5B14-470A-83F2-B83F1440CEBF">了解生命周期国家</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p><a id="d6328e215" class="indexterm-anchor"></a>连接池的生命周期状态会影响可以在连接池上执行的管理器操作。显式控制池生命周期的应用程序必须确保仅在池处于适当状态时才使用管理器的操作。本节将讨论生命周期约束。
                     </p>
                     <p>以下列表描述了池的生命周期状态：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>Starting：表示已调用连接池的start方法，并且它正在启动过程中。</p>
                        </li>
                        <li>
                           <p>正在运行：表示连接池已启动并准备好发出连接。</p>
                        </li>
                        <li>
                           <p>停止：表示连接池正在停止。</p>
                        </li>
                        <li>
                           <p>已停止：表示连接池已停止。</p>
                        </li>
                        <li>
                           <p>失败：表示连接池在启动，停止或执行期间遇到故障。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="JJUCP8186"></a><div class="props_rev_3"><a id="GUID-02E7806B-F72F-43B6-A2BE-9EB0C558FFBA" name="GUID-02E7806B-F72F-43B6-A2BE-9EB0C558FFBA"></a><h4 id="JJUCP-GUID-02E7806B-F72F-43B6-A2BE-9EB0C558FFBA" class="sect4"><span class="enumeration_section">7.1.3.1</span>创建连接池</h4>
                  <div>
                     <div class="section">
                        <p><a id="d6328e272" class="indexterm-anchor"></a><a id="d6328e276" class="indexterm-anchor"></a><a id="d6328e280" class="indexterm-anchor"></a> Connection Manager的<code class="codeph">CreateConnectionPool</code>方法创建并注册连接池。管理器使用连接池适配器来创建池，并依赖启用池的数据源来配置池属性。在使用<code class="codeph">createConnectionPool</code>方法显式创建同一池之前，应用程序不得隐式启动连接池。
                        </p>
                        <p>以下示例演示如何使用管理器创建连接池实例：</p><pre class="oac_no_warn" dir="ltr">UniversalConnectionPoolManager mgr = UniversalConnectionPoolManagerImpl。getUniversalConnectionPoolManager（）; PoolDataSource pds = PoolDataSourceFactory.getPoolDataSource（）; pds.setConnectionPoolName（ “mgr_pool”）; pds.setConnectionFactoryClassName（“oracle.jdbc.pool。OracleDataSource“）; pds.setURL（”jdbc：oracle：thin：@ // localhost：1521 / XE“）; pds.setUser（” <span class="italic">&lt;user&gt;</span> “）; pds.setPassword（” <span class="italic">&lt;password&gt;</span> “）; mgr。 createConnectionPool（（UniversalConnectionPoolAdapter）PDS）;</pre><p>应用程序不必使用管理器来创建池，以便管理池。隐式创建（即，在使用启用池的数据源时自动创建）并使用池名称配置的池由池管理器自动注册和管理。Oracle建议创建隐式池。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-02E7806B-F72F-43B6-A2BE-9EB0C558FFBA__GUID-D0F4A090-1C08-4315-9F6F-2FEEE78782BA">池名称公约</p>
                        <p>必须将连接池名称定义为配置的一部分。池名称提供了一种在与管理器交互时引用特定池的方法。连接池名称必须是唯一的，并且不能由多个连接池使用。如果已存在具有相同名称的连接池，则管理器将抛出<code class="codeph">pool already exists</code>异常。
                        </p>
                        <p><span class="bold">与JBoss的兼容性</span></p>
                        <p>JBoss用户可以通过将<code class="codeph">oracle.ucp.destroyOnReload</code> JVM系统属性设置为<code class="codeph">true</code>来使用JBoss特定的<span class="keyword">静默重新加载</span>功能。当<code class="codeph">oracle.ucp.destroyOnReload</code>属性设置为<code class="codeph">true</code> ，JBoss特定的行为会在创建具有相同名称的新池实例之前自动销毁旧池实例。如果此系统属性未设置或设置为<code class="codeph">false</code> ，则UCP抛出<code class="codeph">pool already exists</code>异常。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-217A044B-F58E-46C9-B72A-EADB44A03816" name="GUID-217A044B-F58E-46C9-B72A-EADB44A03816"></a><h4 id="JJUCP-GUID-217A044B-F58E-46C9-B72A-EADB44A03816" class="sect4"><span class="enumeration_section">7.1.3.2</span>启动连接池</h4>
                  <div>
                     <div class="section">
                        <p><a id="d6328e375" class="indexterm-anchor"></a><a id="d6328e379" class="indexterm-anchor"></a><a id="d6328e381" class="indexterm-anchor"></a><a id="d6328e385" class="indexterm-anchor"></a>管理器的<code class="codeph">startConnectionPool</code>方法使用池名称作为参数来启动连接池，以确定要启动的池。池名称在池启用的数据源上定义为池属性。
                        </p>
                        <p>以下示例演示如何启动连接池：</p><pre class="oac_no_warn" dir="ltr">mgr.startConnectionPool（ “mgr_pool”）;</pre><p>应用程序必须始终在启动池之前使用管理器的<code class="codeph">createConnectionPool</code>方法创建连接池。此外，如果应用程序尝试启动先前已启动的池或池处于停止或失败状态以外的状态，则会发生生命周期状态异常。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-3359C60C-385F-4FCE-B9E8-814C12180DCF" name="GUID-3359C60C-385F-4FCE-B9E8-814C12180DCF"></a><h4 id="JJUCP-GUID-3359C60C-385F-4FCE-B9E8-814C12180DCF" class="sect4"><span class="enumeration_section">7.1.3.3</span>停止连接池</h4>
                  <div>
                     <div class="section">
                        <p><a id="d6328e436" class="indexterm-anchor"></a><a id="d6328e440" class="indexterm-anchor"></a><a id="d6328e442" class="indexterm-anchor"></a><a id="d6328e446" class="indexterm-anchor"></a>管理器的<code class="codeph">stopConnectionPool</code>方法使用池名称作为参数来停止连接池，以确定要停止的池。池名称在池启用的数据源上定义为池属性。停止连接池会关闭所有可用和借用的连接。
                        </p>
                        <p>以下示例演示如何停止连接池：</p><pre class="oac_no_warn" dir="ltr">mgr.stopConnectionPool（ “mgr_pool”）;</pre><p>应用程序可以使用管理器来停止隐式或显式启动的连接池。如果应用程序尝试停止不存在的池或池处于启动或启动以外的状态，则会发生错误。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="JJUCP8189"></a><div class="props_rev_3"><a id="GUID-3C734CAE-3DF8-4AC7-ADAA-925EF9BFF38D" name="GUID-3C734CAE-3DF8-4AC7-ADAA-925EF9BFF38D"></a><h4 id="JJUCP-GUID-3C734CAE-3DF8-4AC7-ADAA-925EF9BFF38D" class="sect4"><span class="enumeration_section">7.1.3.4</span>销毁连接池</h4>
                  <div>
                     <div class="section">
                        <p><a id="d6328e494" class="indexterm-anchor"></a><a id="d6328e498" class="indexterm-anchor"></a><a id="d6328e500" class="indexterm-anchor"></a><a id="d6328e504" class="indexterm-anchor"></a>管理器的<code class="codeph">destroyConnectionPool</code>方法停止连接池并将其从连接池管理器中删除。池名称用作参数以确定要销毁的池。池名称在池启用的数据源上定义为池属性。
                        </p>
                        <p>以下示例演示如何销毁连接池：</p><pre class="oac_no_warn" dir="ltr">mgr.destroyConnectionPool（ “mgr_pool”）;</pre><p>应用程序无法启动已销毁的连接池，必须显式创建并启动新的连接池。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="JJUCP8190"></a><div class="props_rev_3"><a id="GUID-366FBBD8-B19D-442C-AD11-979FCB418833" name="GUID-366FBBD8-B19D-442C-AD11-979FCB418833"></a><h3 id="JJUCP-GUID-366FBBD8-B19D-442C-AD11-979FCB418833" class="sect3"><span class="enumeration_section">7.1.4</span>通用连接池的维护</h3>
               <div>
                  <p><a id="d6328e551" class="indexterm-anchor"></a>应用程序使用连接池管理器对连接池执行维护。维护包括刷新，回收和清除连接池。维护方法包含在<code class="codeph">UniversalConnectionPoolManager</code>界面中。
                  </p>
                  <p>通常执行维护以删除和替换无效连接，并确保有效连接的高可用性。无效连接通常不能用于连接到数据库，但仍由池维护。这些连接会浪费系统资源并直接影响池的最大连接限制。最终，太多的无效连接会对应用程序性能产生负面影响。</p>
                  <div class="infoboxnote" id="GUID-366FBBD8-B19D-442C-AD11-979FCB418833__GUID-7D8745E3-FC92-476D-B7B9-94FDB4838BEA">
                     <p class="notep1">注意：</p>
                     <p>应用程序可以在从池中借用连接时检查连接是否有效。如果应用程序始终存在大量无效连接，则应执行其他测试以确定原因。</p>
                  </div>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="validating-ucp-connections.html#GUID-A7C850D6-4026-4629-BCFA-9181C29EFBF9">验证UCP中的连接概述</a></li>
                     </ul>
                  </div>
               </div>
               <a id="JJUCP8191"></a><div class="props_rev_3"><a id="GUID-FD2FAA44-2C64-43CA-95BB-6A24188048DF" name="GUID-FD2FAA44-2C64-43CA-95BB-6A24188048DF"></a><h4 id="JJUCP-GUID-FD2FAA44-2C64-43CA-95BB-6A24188048DF" class="sect4"><span class="enumeration_section">7.1.4.1</span>刷新连接池</h4>
                  <div>
                     <div class="section">
                        <p><a id="d6328e609" class="indexterm-anchor"></a><a id="d6328e613" class="indexterm-anchor"></a><a id="d6328e615" class="indexterm-anchor"></a><a id="d6328e619" class="indexterm-anchor"></a>刷新连接池会使用新连接替换池中的每个连接。当前借用的所有连接都标记为删除，并在连接返回池后刷新。管理器的<code class="codeph">refreshConnectionPool</code>方法使用池名称作为参数刷新连接池，以确定要刷新的池。池名称在池启用的数据源上定义为池属性。
                        </p>
                        <p>以下示例演示了如何刷新连接池：</p><pre class="oac_no_warn" dir="ltr">mgr.refreshConnectionPool（ “mgr_pool”）;</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-5710C8FA-C0FB-4C1E-B8B2-45FD244342A6" name="GUID-5710C8FA-C0FB-4C1E-B8B2-45FD244342A6"></a><h4 id="JJUCP-GUID-5710C8FA-C0FB-4C1E-B8B2-45FD244342A6" class="sect4"><span class="enumeration_section">7.1.4.2</span>回收连接池</h4>
                  <div>
                     <div class="section">
                        <p><a id="d6328e665" class="indexterm-anchor"></a><a id="d6328e669" class="indexterm-anchor"></a><a id="d6328e671" class="indexterm-anchor"></a><a id="d6328e675" class="indexterm-anchor"></a>回收连接池仅使用新连接替换池中的无效连接，并且不替换借用的连接。管理器的<code class="codeph">recycleConnectionPool</code>方法使用池名称作为参数来回收连接池，以确定要回收的池。池名称在池启用的数据源上定义为池属性。
                        </p>
                        <p>使用非Oracle驱动程序时，必须设置<code class="codeph">setSQLForValidateConnection</code>属性。在重新启动连接之前，UCP使用此属性来确定连接是否有效。
                        </p>
                        <p>以下示例演示了回收连接池：</p><pre class="oac_no_warn" dir="ltr">mgr.recycleConnectionPool（ “mgr_pool”）;</pre></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="validating-ucp-connections.html#GUID-A7C850D6-4026-4629-BCFA-9181C29EFBF9">验证UCP中的连接概述</a></li>
                        </ul>
                     </div>
                  </div>
                  
               </div><a id="JJUCP8193"></a><div class="props_rev_3"><a id="GUID-D557F1BD-95E6-4C57-80B3-4B3A28AC2530" name="GUID-D557F1BD-95E6-4C57-80B3-4B3A28AC2530"></a><h4 id="JJUCP-GUID-D557F1BD-95E6-4C57-80B3-4B3A28AC2530" class="sect4"><span class="enumeration_section">7.1.4.3</span>清除连接池</h4>
                  <div>
                     <div class="section">
                        <p><a id="d6328e735" class="indexterm-anchor"></a><a id="d6328e739" class="indexterm-anchor"></a><a id="d6328e741" class="indexterm-anchor"></a><a id="d6328e745" class="indexterm-anchor"></a>清除连接池将从连接池中删除每个连接（可用和借用），并使连接池保持空白。对连接的后续请求导致创建新连接。管理器的<code class="codeph">purgeConnectionPool</code>方法使用池名称作为参数清除连接池，以确定要清除的池。池名称在池启用的数据源上定义为池属性。
                        </p>
                        <p>以下示例演示如何清除连接池：</p><pre class="oac_no_warn" dir="ltr">mgr.purgeConnectionPool（ “mgr_pool”）;</pre><div class="infoboxnote" id="GUID-D557F1BD-95E6-4C57-80B3-4B3A28AC2530__GUID-C8BD1940-89C4-4497-A5C9-8AB8CDD6AB4B">
                           <p class="notep1">注意：</p>
                           <p>清除连接池后，可能不会强制实施连接池属性，例如<code class="codeph">minPoolSize</code>和<code class="codeph">initialPoolSize</code> 。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>