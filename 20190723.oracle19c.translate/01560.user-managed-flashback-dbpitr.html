<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>执行用户管理的数据库闪回和恢复</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96241-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="user-managed-database-backups.html" title="Previous" type="text/html"></link>
      <link rel="next" href="user-managed-recovery-advanced.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="BRADV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="user-managed-database-backups.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="user-managed-recovery-advanced.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复用户指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-user-managed-backup-recovery.html" property="item" typeof="WebPage"><span property="name">执行用户管理的备份和恢复</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">执行用户管理的数据库闪回和恢复</li>
            </ol>
            <a id="GUID-704F6AB0-04C4-4345-913B-B316DD06D05E" name="GUID-704F6AB0-04C4-4345-913B-B316DD06D05E"></a><a id="BRADV017"></a>
            
            <h2 id="BRADV-GUID-704F6AB0-04C4-4345-913B-B316DD06D05E" class="sect2"><span class="enumeration_chapter">30</span>执行用户管理的数据库闪回和恢复</h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d140508e69" class="indexterm-anchor"></a><a id="d140508e73" class="indexterm-anchor"></a>本章介绍如何在用户管理的备份和恢复策略中还原和恢复数据库以及如何使用Oracle数据库的闪回功能。用户管理的备份和恢复策略意味着不依赖于RMAN的方法。</p>
               <p>本章包含以下主题：<a id="d140508e80" class="indexterm-anchor"></a><a id="d140508e84" class="indexterm-anchor"></a></p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="user-managed-flashback-dbpitr.html#GUID-56FD20D8-0BC2-45F2-BD98-683210ABD413" title="SQL * Plus FLASHBACK DATABASE命令执行与RMAN FLASHBACK DATABASE命令相同的功能：它将数据库返回到先前状态。">使用SQL * Plus执行闪回数据库</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-flashback-dbpitr.html#GUID-4F81CE72-B1B3-4444-B7E9-7DC97C65836B" title="当归档重做日志文件存在于默认位置时，无需执行其他设置即可执行恢复。要在归档重做日志文件存储在非缺省位置时执行介质恢复，必须指定归档重做日志文件的位置。">用户管理的媒体恢复概述</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-flashback-dbpitr.html#GUID-66D07694-533F-4E3A-BA83-DD461B68DB56" title="通常，当介质故障导致一个或多个数据文件不可访问时，您将执行数据库的完全恢复。在完整数据库恢复期间，您使用所有可用的重做将数据库恢复到当前SCN。">执行完整的数据库恢复</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-flashback-dbpitr.html#GUID-2BF2BE5E-3D1B-4F0C-9F10-25D5342F6DB3" title="不完全恢复也称为数据库时间点恢复。">执行不完整的数据库恢复</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-flashback-dbpitr.html#GUID-3A4C59D7-C91D-4A4E-A803-5C02FE58858A">在NOARCHIVELOG模式下恢复数据库</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-flashback-dbpitr.html#GUID-36D3AEB2-CAB5-491D-8AAC-7E08ABC842A6">媒体恢复故障排除</a></p>
                  </li>
               </ul>
            </div>
            <div class="sect2"><a id="GUID-2E5F3F62-17ED-472A-ABBD-FAAF107C6852" name="GUID-2E5F3F62-17ED-472A-ABBD-FAAF107C6852"></a><h3 id="BRADV-GUID-2E5F3F62-17ED-472A-ABBD-FAAF107C6852" class="sect3"><span class="enumeration_section">30.1</span>使用SQL * Plus执行闪回数据库</h3>
               <div>
                  <p>您可以使用SQL * Plus在非CDB，多租户容器数据库（CDB）和可插拔数据库（PDB）上执行闪回数据库操作。Oracle闪回数据库将整个数据库或整个PDB返回到先前的状态，而无需从备份中还原文件。</p>
                  <p>闪回数据库要求您为数据库创建快速恢复区域并启用闪回日志的收集。无论使用RMAN还是SQL * Plus，闪回数据库的要求和准备都是相同的。</p>
                  <div class="infoboxnotealso" id="GUID-2E5F3F62-17ED-472A-ABBD-FAAF107C6852__GUID-0D3F9DCD-F111-407A-817E-494F481DB11B">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="rman-performing-flashback-dbpitr.html#GUID-5463669A-DC89-4FF4-ACCE-136A72DF687B" title="此概述描述了Oracle闪回技术和数据库时间点恢复的目的和基本概念。某些情况适合使用时间点恢复或闪回功能，以便在之前的某个时间点将数据库或数据库对象返回到其状态。数据库时间点恢复（DBPITR）和闪回功能使您可以将数据库恢复到先前的某个时间点。DBPITR在物理级别工作，以在过去的目标时间将数据文件返回到其状态。RMAN为一个或多个PDB的时间点恢复提供支持。要恢复PDB，必须以具有SYSDBA或SYSBACKUP权限的用户身份连接到root。恢复后，PDB的旧备份仍然有效，并且可以在发生介质故障时使用。在大多数可用的情况下，Oracle数据库的闪回功能比介质恢复更有效。您可以使用它们来调查数据库的过去状态。Oracle闪回数据库是DBPITR最有效的替代方法。逻辑闪回功能用于将表及其内容恢复到过去的时间。您可以对整个多租户容器数据库（CDB）或特定可插拔数据库（PDB）执行闪回数据库操作。多租户容器数据库（CDB）可以使用共享撤消或本地撤消。RMAN用于执行闪回数据库操作的技术取决于CDB的撤消配置类型.RMAN提供了管理PDB中数据块的重做损坏的方法。闪回表使用撤消表空间中的信息而不是恢复的备份来检索表。发生闪回表操作时，将删除新行并重新插入旧行。在执行表的闪回时，数据库的其余部分仍然可用。要执行闪回表操作，该表必须有资格闪回，并且执行操作的用户必须具有所需的权限。要在一个或多个表上使用闪回表功能，请使用带有目标时间或SCN的FLASHBACK TABLE SQL语句。默认情况下，数据库在执行FLASHBACK TABLE操作之前禁用受影响表上的触发器。在操作之后，数据库将触发器返回到操作之前的状态（启用或禁用）。您可以使用FLASHBACK TABLE从回收站中检索对象...在DROP声明之前。Flashback Drop可以反转DROP TABLE操作的效果。闪回丢弃比在这种情况下可以使用的其他恢复机制（如时间点恢复）更快，并且不会导致停机或丢失最近的事务。在执行闪回删除操作之前，必须满足先决条件。使用FLASHBACK TABLE ...在DROP语句之前要从回收站中恢复对象。您可以指定回收站中表的名称或原始表名。您可以使用相同的原始名称创建，然后删除多个对象。所有丢弃的对象都存储在回收站中。闪回数据库通过将数据库返回到先前某个时间点的状态来反转不需要的更改。闪回数据库通过撤消对运行命令时存在的数据文件的更改来工作。必须满足先决条件才能执行闪回数据库操作。闪回数据库操作使用FLASHBACK DATABASE命令将数据库回滚到过去的某个时间点。您可以使用FLASHBACK DATABASE命令为整个多租户容器数据库（CDB）执行闪回数据库操作。您可以使用FLASHBACK DATABASE命令对多租户容器数据库（CDB）中的单个可插拔数据库（PDB）执行闪回数据库操作。数据字典视图包含用于监视闪回数据库的信息。RMAN DBPITR在目标恢复时间之前从备份还原数据库，然后使用增量备份和重做将数据库前滚到目标时间。您可以恢复到SCN，时间，日志序列号或还原点。Oracle建议您在重要时间创建还原点，以便在必要时使时间点恢复更易于管理。必须满足某些先决条件才能执行数据库时间点恢复（DBPITR）。使用RESTORE和RECOVER命令执行DBPITR。使用RECOVER命令执行容器数据库（CDB）和可插拔数据库（PDB）的时间点恢复（PITR）。PDB的PITR只能使用RMAN执行。使用RESTORE和RECOVER命令为整个CDB执行时间点恢复。当您将一个或多个PDB恢复到指定的时间点时，剩余的PDB将在国家开发银行不受影响，可以开放和运作。使用RESTORE和RECOVER命令执行应用程序PDB的时间点恢复。执行稀疏数据库的时间点恢复类似于执行正常数据库的时间点恢复。本节介绍基本闪回数据库和DBPITR方案的变体。闪回数据库可用于撤消OPEN RESETLOGS操作。跨OPEN RESETLOGS的闪回数据库可用于在Data Guard环境中执行多个功能。您可以使用闪回数据库将数据库回滚到废弃的数据库化身。要将DPITR执行到非当前数据库化身，必须显式执行RESET DATABASE以将数据库重置为目标SCN上当前的化身。您还必须从包含目标SCN的数据库化身中还原控制文件。">执行闪回和数据库时间点恢复，</a>以获取有关闪回数据库功能如何工作的详细信息，使用闪回数据库的要求以及如何启用闪回数据库所需的闪回日志收集</p>
                        </li>
                        <li>
                           <p><a href="user-managed-flashback-dbpitr.html#GUID-56FD20D8-0BC2-45F2-BD98-683210ABD413" title="SQL * Plus FLASHBACK DATABASE命令执行与RMAN FLASHBACK DATABASE命令相同的功能：它将数据库返回到先前状态。">使用SQL * Plus执行非CDB的闪回数据库</a></p>
                        </li>
                        <li>
                           <p><a href="user-managed-flashback-dbpitr.html#GUID-AFD27980-CCDC-4062-905A-7571DC0C0C4C" title="使用SQL * Plus FLASHBACK DATABASE命令将整个多租户容器数据库（CDB）返回到先前状态。SQL * Plus FLASHBACK DATABASE命令执行与RMAN FLASHBACK DATABASE命令相同的功能。">使用SQL * Plus执行CDB的闪回数据库</a></p>
                        </li>
                        <li>
                           <p><a href="user-managed-flashback-dbpitr.html#GUID-1FF9318A-39BF-4DCE-AF7D-570376608D44" title="使用SQL * Plus FLASHBACK DATABASE命令将特定可插拔数据库（PDB）返回到先前状态。多租户容器数据库（CDB）中的其余PDB不受单个PDB上的闪回操作的影响。">使用SQL * Plus执行PDB的闪回数据库</a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="BRADV99982"></a><div class="props_rev_3"><a id="GUID-56FD20D8-0BC2-45F2-BD98-683210ABD413" name="GUID-56FD20D8-0BC2-45F2-BD98-683210ABD413"></a><h4 id="BRADV-GUID-56FD20D8-0BC2-45F2-BD98-683210ABD413" class="sect4"><span class="enumeration_section">30.1.1</span>使用SQL * Plus执行非CDB的闪回数据库</h4>
                  <div>
                     <p>SQL * Plus <code class="codeph">FLASHBACK DATABASE</code>命令执行与RMAN <code class="codeph">FLASHBACK DATABASE</code>命令相同的功能：它将数据库返回到先前状态。
                     </p>
                     <div class="p">闪<a href="using-flasback-database-restore-points.html#GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D" title="To ensure successful operation of Flashback Database and guaranteed restore points, you must first set some key database options.">回数据库和还原点的先决条件</a>中介绍了执行闪回数据库操作的<a href="using-flasback-database-restore-points.html#GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D" title="要确保闪回数据库的成功运行和有保证的还原点，必须先设置一些关键数据库选项。">先决条件</a> 。
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><span class="bold">使用SQL * Plus执行非CDB的闪回：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>查询目标数据库以确定可能的闪回SCN的范围。以下SQL * Plus查询显示闪回窗口中最新和最早的SCN：</span><div><pre class="oac_no_warn" dir="ltr">从V $ DATABASE中选择CURRENT_SCN; SELECT OLDEST_FLASHBACK_SCN，OLDEST_FLASHBACK_TIME FROM V $ FLASHBACK_DATABASE_LOG;</pre></div>
                        </li>
                        <li class="stepexpand"><span>如有必要，请使用其他闪回功能来识别SCN或数据库中不需要的更改的时间。</span></li>
                        <li class="stepexpand"><span>确保已装入目标数据库。</span><div>
                              <p>以下命令以<code class="codeph">MOUNT</code>模式启动数据库。
                              </p><pre class="oac_no_warn" dir="ltr">立即关闭;启动安装;</pre></div>
                        </li>
                        <li class="stepexpand"><span>使用管理员权限启动SQL * Plus。</span></li>
                        <li class="stepexpand"><span>运行<code class="codeph">FLASHBACK DATABASE</code>语句以将数据库返回到先前的<code class="codeph">TIMESTAMP</code>或<code class="codeph">SCN</code> 。例如：</span><div><pre class="oac_no_warn" dir="ltr">FLASHBACK DATABASE TO SCN 46963; FLASHBACK DATABASE TO TIMESTAMP'2013-11-05 14:00:00'; FLASHBACK DATABASE TO TIMESTAMP to_timestamp（'2013-11-11 16:00:00'，'YYYY-MM-DD HH24：MI：SS'）;</pre></div>
                        </li>
                        <li class="stepexpand"><span>操作完成后，以只读方式打开数据库并执行查询以验证是否已恢复所需的数据。</span><div>
                              <p>如果您选择的目标时间过去不够，则使用另一个<code class="codeph">FLASHBACK DATABASE</code>语句。否则，您可以使用<code class="codeph">RECOVER DATABASE</code>将数据库返回到当前时间，然后尝试另一个<code class="codeph">FLASHBACK DATABASE</code>语句。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>对结果满意后，使用<code class="codeph">RESETLOGS</code>选项打开数据库。</span><div>
                              <p>如果适用，您还可以使用数据泵导出来保存丢失的数据，使用<code class="codeph">RECOVER DATABASE</code>将数据库返回到当前，然后重新导入丢失的对象。
                              </p>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-56FD20D8-0BC2-45F2-BD98-683210ABD413__GUID-831BABF2-87FD-41FD-97FB-D90ABD44AE8E">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../adfns/flashback.html#ADFNS1008" target="_blank"><span class="italic">Oracle数据库开发指南</span></a> ，了解如何使用相关的闪回功能，如Oracle闪回查询和Oracle闪回事务查询</p>
                              </li>
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-5463669A-DC89-4FF4-ACCE-136A72DF687B" title="此概述描述了Oracle闪回技术和数据库时间点恢复的目的和基本概念。某些情况适合使用时间点恢复或闪回功能，以便在之前的某个时间点将数据库或数据库对象返回到其状态。数据库时间点恢复（DBPITR）和闪回功能使您可以将数据库恢复到先前的某个时间点。DBPITR在物理级别工作，以在过去的目标时间将数据文件返回到其状态。RMAN为一个或多个PDB的时间点恢复提供支持。要恢复PDB，必须以具有SYSDBA或SYSBACKUP权限的用户身份连接到root。恢复后，PDB的旧备份仍然有效，并且可以在发生介质故障时使用。在大多数可用的情况下，Oracle数据库的闪回功能比介质恢复更有效。您可以使用它们来调查数据库的过去状态。Oracle闪回数据库是DBPITR最有效的替代方法。逻辑闪回功能用于将表及其内容恢复到过去的时间。您可以对整个多租户容器数据库（CDB）或特定可插拔数据库（PDB）执行闪回数据库操作。多租户容器数据库（CDB）可以使用共享撤消或本地撤消。RMAN用于执行闪回数据库操作的技术取决于CDB的撤消配置类型.RMAN提供了管理PDB中数据块的重做损坏的方法。闪回表使用撤消表空间中的信息而不是恢复的备份来检索表。发生闪回表操作时，将删除新行并重新插入旧行。在执行表的闪回时，数据库的其余部分仍然可用。要执行闪回表操作，该表必须有资格闪回，并且执行操作的用户必须具有所需的权限。要在一个或多个表上使用闪回表功能，请使用带有目标时间或SCN的FLASHBACK TABLE SQL语句。默认情况下，数据库在执行FLASHBACK TABLE操作之前禁用受影响表上的触发器。在操作之后，数据库将触发器返回到操作之前的状态（启用或禁用）。您可以使用FLASHBACK TABLE从回收站中检索对象...在DROP声明之前。Flashback Drop可以反转DROP TABLE操作的效果。闪回丢弃比在这种情况下可以使用的其他恢复机制（如时间点恢复）更快，并且不会导致停机或丢失最近的事务。在执行闪回删除操作之前，必须满足先决条件。使用FLASHBACK TABLE ...在DROP语句之前要从回收站中恢复对象。您可以指定回收站中表的名称或原始表名。您可以使用相同的原始名称创建，然后删除多个对象。所有丢弃的对象都存储在回收站中。闪回数据库通过将数据库返回到先前某个时间点的状态来反转不需要的更改。闪回数据库通过撤消对运行命令时存在的数据文件的更改来工作。必须满足先决条件才能执行闪回数据库操作。闪回数据库操作使用FLASHBACK DATABASE命令将数据库回滚到过去的某个时间点。您可以使用FLASHBACK DATABASE命令为整个多租户容器数据库（CDB）执行闪回数据库操作。您可以使用FLASHBACK DATABASE命令对多租户容器数据库（CDB）中的单个可插拔数据库（PDB）执行闪回数据库操作。数据字典视图包含用于监视闪回数据库的信息。RMAN DBPITR在目标恢复时间之前从备份还原数据库，然后使用增量备份和重做将数据库前滚到目标时间。您可以恢复到SCN，时间，日志序列号或还原点。Oracle建议您在重要时间创建还原点，以便在必要时使时间点恢复更易于管理。必须满足某些先决条件才能执行数据库时间点恢复（DBPITR）。使用RESTORE和RECOVER命令执行DBPITR。使用RECOVER命令执行容器数据库（CDB）和可插拔数据库（PDB）的时间点恢复（PITR）。PDB的PITR只能使用RMAN执行。使用RESTORE和RECOVER命令为整个CDB执行时间点恢复。当您将一个或多个PDB恢复到指定的时间点时，剩余的PDB将在国家开发银行不受影响，可以开放和运作。使用RESTORE和RECOVER命令执行应用程序PDB的时间点恢复。执行稀疏数据库的时间点恢复类似于执行正常数据库的时间点恢复。本节介绍基本闪回数据库和DBPITR方案的变体。闪回数据库可用于撤消OPEN RESETLOGS操作。跨OPEN RESETLOGS的闪回数据库可用于在Data Guard环境中执行多个功能。您可以使用闪回数据库将数据库回滚到废弃的数据库化身。要将DPITR执行到非当前数据库化身，必须显式执行RESET DATABASE以将数据库重置为目标SCN上当前的化身。您还必须从包含目标SCN的数据库化身中还原控制文件。">执行闪回和数据库时间点恢复，</a>以获取有关闪回数据库功能如何工作的详细信息，使用闪回数据库的要求以及如何启用闪回数据库所需的闪回日志收集</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-AFD27980-CCDC-4062-905A-7571DC0C0C4C" name="GUID-AFD27980-CCDC-4062-905A-7571DC0C0C4C"></a><h4 id="BRADV-GUID-AFD27980-CCDC-4062-905A-7571DC0C0C4C" class="sect4"><span class="enumeration_section">30.1.2</span>使用SQL * Plus执行CDB的闪回数据库</h4>
                  <div>
                     <p>使用SQL * Plus <code class="codeph">FLASHBACK</code> <code class="codeph">DATABASE</code>命令将整个多租户容器数据库（CDB）返回到先前状态。SQL * Plus <code class="codeph">FLASHBACK DATABASE</code>命令执行与RMAN <code class="codeph">FLASHBACK DATABASE</code>命令相同的功能。
                     </p>
                     <div class="p">闪<a href="using-flasback-database-restore-points.html#GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D" title="To ensure successful operation of Flashback Database and guaranteed restore points, you must first set some key database options.">回数据库和还原点的先决条件</a>中介绍了执行闪回数据库操作的<a href="using-flasback-database-restore-points.html#GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D" title="要确保闪回数据库的成功运行和有保证的还原点，必须先设置一些关键数据库选项。">先决条件</a> 。
                     </div>
                     <!-- class="section" -->
                     <div class="section"><span class="bold">使用SQL * Plus执行整个CDB的闪回：</span></div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>使用<code class="codeph">SYSDBA</code>权限将SQL * Plus作为普通用户连接到root用户。</span></li>
                        <li class="stepexpand"><span>执行<a href="user-managed-flashback-dbpitr.html#GUID-56FD20D8-0BC2-45F2-BD98-683210ABD413" title="SQL * Plus FLASHBACK DATABASE命令执行与RMAN FLASHBACK DATABASE命令相同的功能：它将数据库返回到先前状态。">使用SQL * Plus执行非CDB的闪回数据库中</a>描述的步骤1到3。</span></li>
                        <li class="stepexpand"><span>运行<code class="codeph">FLASHBACK DATABASE</code>命令以将CDB返回到先前的时间戳，SCN或还原点。</span><div>
                              <p>以下是CDB闪回操作的一些示例：</p><pre class="pre codeblock"><code>FLASHBACK DATABASE恢复点cdb_grp; FLASHBACK DATABASE TO SCN 34468;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>执行<a href="user-managed-flashback-dbpitr.html#GUID-56FD20D8-0BC2-45F2-BD98-683210ABD413" title="SQL * Plus FLASHBACK DATABASE命令执行与RMAN FLASHBACK DATABASE命令相同的功能：它将数据库返回到先前状态。">使用SQL * Plus执行非CDB的闪回数据库中</a>描述的步骤5和6。</span></li>
                        <li class="stepexpand"><span>由于在打开CDB时不会自动打开可插拔数据库（PDB），因此请打开PDB。</span><div>
                              <p>以下命令连接到根时会打开所有PDB：</p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE ALL OPEN;</code></pre></div>
                           <div>
                              <p>如果您只想打开一些PDB，则可以单独打开每个PDB。连接到root时，以下命令将打开PDB <code class="codeph">my_pdb</code> 。
                              </p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE my_pdb OPEN;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-AFD27980-CCDC-4062-905A-7571DC0C0C4C__GUID-3CD2A715-2C08-46F9-9192-D031DB85E85F">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="rman-performing-flashback-dbpitr.html#GUID-5463669A-DC89-4FF4-ACCE-136A72DF687B" title="此概述描述了Oracle闪回技术和数据库时间点恢复的目的和基本概念。某些情况适合使用时间点恢复或闪回功能，以便在之前的某个时间点将数据库或数据库对象返回到其状态。数据库时间点恢复（DBPITR）和闪回功能使您可以将数据库恢复到先前的某个时间点。DBPITR在物理级别工作，以在过去的目标时间将数据文件返回到其状态。RMAN为一个或多个PDB的时间点恢复提供支持。要恢复PDB，必须以具有SYSDBA或SYSBACKUP权限的用户身份连接到root。恢复后，PDB的旧备份仍然有效，并且可以在发生介质故障时使用。在大多数可用的情况下，Oracle数据库的闪回功能比介质恢复更有效。您可以使用它们来调查数据库的过去状态。Oracle闪回数据库是DBPITR最有效的替代方法。逻辑闪回功能用于将表及其内容恢复到过去的时间。您可以对整个多租户容器数据库（CDB）或特定可插拔数据库（PDB）执行闪回数据库操作。多租户容器数据库（CDB）可以使用共享撤消或本地撤消。RMAN用于执行闪回数据库操作的技术取决于CDB的撤消配置类型.RMAN提供了管理PDB中数据块的重做损坏的方法。闪回表使用撤消表空间中的信息而不是恢复的备份来检索表。发生闪回表操作时，将删除新行并重新插入旧行。在执行表的闪回时，数据库的其余部分仍然可用。要执行闪回表操作，该表必须有资格闪回，并且执行操作的用户必须具有所需的权限。要在一个或多个表上使用闪回表功能，请使用带有目标时间或SCN的FLASHBACK TABLE SQL语句。默认情况下，数据库在执行FLASHBACK TABLE操作之前禁用受影响表上的触发器。在操作之后，数据库将触发器返回到操作之前的状态（启用或禁用）。您可以使用FLASHBACK TABLE从回收站中检索对象...在DROP声明之前。Flashback Drop可以反转DROP TABLE操作的效果。闪回丢弃比在这种情况下可以使用的其他恢复机制（如时间点恢复）更快，并且不会导致停机或丢失最近的事务。在执行闪回删除操作之前，必须满足先决条件。使用FLASHBACK TABLE ...在DROP语句之前要从回收站中恢复对象。您可以指定回收站中表的名称或原始表名。您可以使用相同的原始名称创建，然后删除多个对象。所有丢弃的对象都存储在回收站中。闪回数据库通过将数据库返回到先前某个时间点的状态来反转不需要的更改。闪回数据库通过撤消对运行命令时存在的数据文件的更改来工作。必须满足先决条件才能执行闪回数据库操作。闪回数据库操作使用FLASHBACK DATABASE命令将数据库回滚到过去的某个时间点。您可以使用FLASHBACK DATABASE命令为整个多租户容器数据库（CDB）执行闪回数据库操作。您可以使用FLASHBACK DATABASE命令对多租户容器数据库（CDB）中的单个可插拔数据库（PDB）执行闪回数据库操作。数据字典视图包含用于监视闪回数据库的信息。RMAN DBPITR在目标恢复时间之前从备份还原数据库，然后使用增量备份和重做将数据库前滚到目标时间。您可以恢复到SCN，时间，日志序列号或还原点。Oracle建议您在重要时间创建还原点，以便在必要时使时间点恢复更易于管理。必须满足某些先决条件才能执行数据库时间点恢复（DBPITR）。使用RESTORE和RECOVER命令执行DBPITR。使用RECOVER命令执行容器数据库（CDB）和可插拔数据库（PDB）的时间点恢复（PITR）。PDB的PITR只能使用RMAN执行。使用RESTORE和RECOVER命令为整个CDB执行时间点恢复。当您将一个或多个PDB恢复到指定的时间点时，剩余的PDB将在国家开发银行不受影响，可以开放和运作。使用RESTORE和RECOVER命令执行应用程序PDB的时间点恢复。执行稀疏数据库的时间点恢复类似于执行正常数据库的时间点恢复。本节介绍基本闪回数据库和DBPITR方案的变体。闪回数据库可用于撤消OPEN RESETLOGS操作。跨OPEN RESETLOGS的闪回数据库可用于在Data Guard环境中执行多个功能。您可以使用闪回数据库将数据库回滚到废弃的数据库化身。要将DPITR执行到非当前数据库化身，必须显式执行RESET DATABASE以将数据库重置为目标SCN上当前的化身。您还必须从包含目标SCN的数据库化身中还原控制文件。">执行闪回和数据库时间点恢复，</a>以获取有关闪回数据库功能如何工作的详细信息，使用闪回数据库的要求以及如何启用闪回数据库所需的闪回日志收集</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-1FF9318A-39BF-4DCE-AF7D-570376608D44" name="GUID-1FF9318A-39BF-4DCE-AF7D-570376608D44"></a><h4 id="BRADV-GUID-1FF9318A-39BF-4DCE-AF7D-570376608D44" class="sect4"><span class="enumeration_section">30.1.3</span>使用SQL * Plus执行PDB的闪回数据库</h4>
                  <div>
                     <p>使用SQL * Plus <code class="codeph">FLASHBACK</code> <code class="codeph">DATABASE</code>命令将特定可插拔数据库（PDB）返回到先前状态。多租户容器数据库（CDB）中的其余PDB不受单个PDB上的闪回操作的影响。</p>
                     <div class="section">SQL * Plus <code class="codeph">FLASHBACK DATABASE</code>命令执行与RMAN <code class="codeph">FLASHBACK DATABASE</code>命令相同的功能。
                     </div>
                     <!-- class="section" -->
                     <div class="p">闪<a href="using-flasback-database-restore-points.html#GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D" title="To ensure successful operation of Flashback Database and guaranteed restore points, you must first set some key database options.">回数据库和还原点的先决条件</a>中描述了执行闪回数据库操作的<a href="using-flasback-database-restore-points.html#GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D" title="要确保闪回数据库的成功运行和有保证的还原点，必须先设置一些关键数据库选项。">先决条件</a> 。
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><span class="bold">使用SQL * Plus执行PDB的闪回：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>使用<code class="codeph">SYSDBA</code>权限将SQL * PLus作为普通用户连接到root。</span></li>
                        <li class="stepexpand"><span>确保CDB已打开。</span><div>
                              <p>以下命令连接到根时，显示CDB打开的模式。</p><pre class="pre codeblock"><code>从V $ DATABASE中选择open_mode;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>确定<code class="codeph">FLASHBACK DATABASE</code>命令所需的SCN，还原点或时间点。</span><div>查询<code class="codeph">V$RESTORE_POINT</code>视图以获取PDB还原点列表。<code class="codeph">V$FLASHBACK_DATABASE_LOG</code>显示可以执行闪回操作的最旧SCN。
                           </div>
                        </li>
                        <li class="stepexpand"><span>确保关闭必须执行闪回数据库操作的PDB。其他PDB可以是开放的和可操作的。</span><div>
                              <p>连接到根时，以下<code class="codeph">ALTER PLUGGABLE DATABASE</code>命令将关闭PDB <code class="codeph">my_pdb</code> 。
                              </p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE my_pdb CLOSE;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>在指定的PDB上执行闪回数据库操作到所需的时间点。</span><div>
                              <p>以下是PDB上闪回数据库操作的一些示例。</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>对于使用本地撤消的PDB：</p><pre class="pre codeblock"><code>FLASHBACK PLUGGABLE DATABASE my_pdb TO SCN 24368; FLASHBACK PLUGGABLE DATABASE my_pdb TO RESTORE POINT guar_rp;</code></pre></li>
                                 <li>
                                    <p>对于使用共享撤消的PDB，如果要将PDB闪回到干净的PDB还原点，则只能使用SQL * Plus执行闪回操作。例如：</p><pre class="pre codeblock"><code>FLASHBACK PLUGGABLE DATABASE my_pdb to RESTORE POINT before_appl_changes;</code></pre></li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>使用<code class="codeph">RESETLOGS</code>打开PDB。</span><div>
                              <p>以下命令使用<code class="codeph">RESETLOGS</code>打开名为<code class="codeph">my_pdb</code>的PDB：</p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE my_pdb OPEN RESETLOGS;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <p></p>
                        <div class="infoboxnote" id="GUID-1FF9318A-39BF-4DCE-AF7D-570376608D44__GUID-FF365CC5-6DB2-4DD0-A5E7-4591B556C383">
                           <p class="notep1">注意：</p>
                           <p>不支持代理PDB上的闪回操作。</p>
                        </div>
                        <div class="infoboxnotealso" id="GUID-1FF9318A-39BF-4DCE-AF7D-570376608D44__GUID-226E014E-8AF9-4FF4-AC55-57A6AD789758">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="rman-performing-flashback-dbpitr.html#GUID-5463669A-DC89-4FF4-ACCE-136A72DF687B" title="此概述描述了Oracle闪回技术和数据库时间点恢复的目的和基本概念。某些情况适合使用时间点恢复或闪回功能，以便在之前的某个时间点将数据库或数据库对象返回到其状态。数据库时间点恢复（DBPITR）和闪回功能使您可以将数据库恢复到先前的某个时间点。DBPITR在物理级别工作，以在过去的目标时间将数据文件返回到其状态。RMAN为一个或多个PDB的时间点恢复提供支持。要恢复PDB，必须以具有SYSDBA或SYSBACKUP权限的用户身份连接到root。恢复后，PDB的旧备份仍然有效，并且可以在发生介质故障时使用。在大多数可用的情况下，Oracle数据库的闪回功能比介质恢复更有效。您可以使用它们来调查数据库的过去状态。Oracle闪回数据库是DBPITR最有效的替代方法。逻辑闪回功能用于将表及其内容恢复到过去的时间。您可以对整个多租户容器数据库（CDB）或特定可插拔数据库（PDB）执行闪回数据库操作。多租户容器数据库（CDB）可以使用共享撤消或本地撤消。RMAN用于执行闪回数据库操作的技术取决于CDB的撤消配置类型.RMAN提供了管理PDB中数据块的重做损坏的方法。闪回表使用撤消表空间中的信息而不是恢复的备份来检索表。发生闪回表操作时，将删除新行并重新插入旧行。在执行表的闪回时，数据库的其余部分仍然可用。要执行闪回表操作，该表必须有资格闪回，并且执行操作的用户必须具有所需的权限。要在一个或多个表上使用闪回表功能，请使用带有目标时间或SCN的FLASHBACK TABLE SQL语句。默认情况下，数据库在执行FLASHBACK TABLE操作之前禁用受影响表上的触发器。在操作之后，数据库将触发器返回到操作之前的状态（启用或禁用）。您可以使用FLASHBACK TABLE从回收站中检索对象...在DROP声明之前。Flashback Drop可以反转DROP TABLE操作的效果。闪回丢弃比在这种情况下可以使用的其他恢复机制（如时间点恢复）更快，并且不会导致停机或丢失最近的事务。在执行闪回删除操作之前，必须满足先决条件。使用FLASHBACK TABLE ...在DROP语句之前要从回收站中恢复对象。您可以指定回收站中表的名称或原始表名。您可以使用相同的原始名称创建，然后删除多个对象。所有丢弃的对象都存储在回收站中。闪回数据库通过将数据库返回到先前某个时间点的状态来反转不需要的更改。闪回数据库通过撤消对运行命令时存在的数据文件的更改来工作。必须满足先决条件才能执行闪回数据库操作。闪回数据库操作使用FLASHBACK DATABASE命令将数据库回滚到过去的某个时间点。您可以使用FLASHBACK DATABASE命令为整个多租户容器数据库（CDB）执行闪回数据库操作。您可以使用FLASHBACK DATABASE命令对多租户容器数据库（CDB）中的单个可插拔数据库（PDB）执行闪回数据库操作。数据字典视图包含用于监视闪回数据库的信息。RMAN DBPITR在目标恢复时间之前从备份还原数据库，然后使用增量备份和重做将数据库前滚到目标时间。您可以恢复到SCN，时间，日志序列号或还原点。Oracle建议您在重要时间创建还原点，以便在必要时使时间点恢复更易于管理。必须满足某些先决条件才能执行数据库时间点恢复（DBPITR）。使用RESTORE和RECOVER命令执行DBPITR。使用RECOVER命令执行容器数据库（CDB）和可插拔数据库（PDB）的时间点恢复（PITR）。PDB的PITR只能使用RMAN执行。使用RESTORE和RECOVER命令为整个CDB执行时间点恢复。当您将一个或多个PDB恢复到指定的时间点时，剩余的PDB将在国家开发银行不受影响，可以开放和运作。使用RESTORE和RECOVER命令执行应用程序PDB的时间点恢复。执行稀疏数据库的时间点恢复类似于执行正常数据库的时间点恢复。本节介绍基本闪回数据库和DBPITR方案的变体。闪回数据库可用于撤消OPEN RESETLOGS操作。跨OPEN RESETLOGS的闪回数据库可用于在Data Guard环境中执行多个功能。您可以使用闪回数据库将数据库回滚到废弃的数据库化身。要将DPITR执行到非当前数据库化身，必须显式执行RESET DATABASE以将数据库重置为目标SCN上当前的化身。您还必须从包含目标SCN的数据库化身中还原控制文件。">执行闪回和数据库时间点恢复，</a>以获取有关闪回数据库功能如何工作的详细信息，使用闪回数据库的要求以及如何启用闪回数据库所需的闪回日志收集</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV215"></a><div class="props_rev_3"><a id="GUID-4F81CE72-B1B3-4444-B7E9-7DC97C65836B" name="GUID-4F81CE72-B1B3-4444-B7E9-7DC97C65836B"></a><h3 id="BRADV-GUID-4F81CE72-B1B3-4444-B7E9-7DC97C65836B" class="sect3"><span class="enumeration_section">30.2</span>用户管理的介质恢复概述</h3>
               <div>
                  <p>本节概述了使用SQL * Plus进行恢复。本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="user-managed-flashback-dbpitr.html#GUID-D71F3FF3-84E5-4D81-9307-E2AD5CB51833">关于用户管理的还原和恢复</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-flashback-dbpitr.html#GUID-54B59888-8683-4CD9-B144-B0BB68887572">使用RECOVER命令自动恢复</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-flashback-dbpitr.html#GUID-E7F2B57F-3731-4BC1-9E4D-AC4A99A1C2D2" title="当归档重做日志文件存在于默认位置时，无需执行其他设置即可执行恢复。">存档日志位于默认位置时恢复</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-flashback-dbpitr.html#GUID-F66C6B19-0960-4231-92C1-400C625F66D7" title="要在归档重做日志文件存储在非缺省位置时执行介质恢复，必须指定归档重做日志文件的位置。">存档日志位于非默认位置时恢复</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-flashback-dbpitr.html#GUID-5A3BB8EE-291F-41C6-976C-1F304069FF0B">使用存储快照优化进行恢复</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-flashback-dbpitr.html#GUID-8EC901EA-2281-49EF-89ED-D0595E46DFCB">恢复取消</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-flashback-dbpitr.html#GUID-9174945F-96FA-477F-AEC2-046A3FE5ACAA">并行媒体恢复</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV502"></a><a id="BRADV210"></a><div class="props_rev_3"><a id="GUID-D71F3FF3-84E5-4D81-9307-E2AD5CB51833" name="GUID-D71F3FF3-84E5-4D81-9307-E2AD5CB51833"></a><h4 id="BRADV-GUID-D71F3FF3-84E5-4D81-9307-E2AD5CB51833" class="sect4"><span class="enumeration_section">30.2.1</span>关于用户管理的还原和恢复</h4>
                  <div>
                     <p>通常，在介质故障或用户错误已损坏或删除一个或多个数据文件时还原文件。<a id="d140508e1245" class="indexterm-anchor"></a><a id="d140508e1247" class="indexterm-anchor"></a><a id="d140508e1251" class="indexterm-anchor"></a>在用户管理的还原操作中，您使用操作系统实用程序还原文件的备份。
                     </p>
                     <p><a id="d140508e1257" class="indexterm-anchor"></a><a id="d140508e1263" class="indexterm-anchor"></a><a id="d140508e1267" class="indexterm-anchor"></a><a id="d140508e1273" class="indexterm-anchor"></a><a id="d140508e1277" class="indexterm-anchor"></a>如果介质故障影响数据文件，则恢复过程取决于：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>数据库的归档模式： <code class="codeph">ARCHIVELOG</code>或<code class="codeph">NOARCHIVELOG</code></p>
                        </li>
                        <li>
                           <p>媒体失败的类型</p>
                        </li>
                        <li>
                           <p>受介质故障影响的文件（数据文件，控制文件，归档重做日志和服务器参数文件都是还原操作的候选者）</p>
                        </li>
                     </ul>
                     <p>如果永久或临时介质故障影响在<code class="codeph">NOARCHIVELOG</code>模式下运行的数据库的任何数据文件，则数据库将自动关闭。如果介质故障是临时的，则更正基础问题并重新启动数据库。通常，崩溃恢复会从联机重做日志中恢复所有已提交的事务。如果介质故障是永久性的，则按照<span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-3A4C59D7-C91D-4A4E-A803-5C02FE58858A">在NOARCHIVELOG模式下恢复数据库</a> ”中的说明<a href="user-managed-flashback-dbpitr.html#GUID-3A4C59D7-C91D-4A4E-A803-5C02FE58858A">恢复数据库</a></span> 。
                     </p>
                     <p><a href="user-managed-flashback-dbpitr.html#GUID-D71F3FF3-84E5-4D81-9307-E2AD5CB51833__CHDFCFGE" title="用户管理的恢复技术">表30-1</a>说明了在<code class="codeph">ARCHIVELOG</code>模式下运行的数据库中丢失文件时对介质恢复的影响。
                     </p>
                     <div class="tblformalwide" id="GUID-D71F3FF3-84E5-4D81-9307-E2AD5CB51833__CHDFCFGE">
                        <p class="titleintable">表30-1用户管理的还原操作</p>
                        <table cellpadding="4" cellspacing="0" class="FormalWide" title="用户管理的还原操作" width="100%" border="1" summary="user-managed restore techniques" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="29%" id="d140508e1326">如果你输了......</th>
                                 <th align="left" valign="bottom" width="71%" id="d140508e1329">然后...</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d140508e1334" headers="d140508e1326 ">
                                    <p><code class="codeph">SYSTEM</code>表空间中的数据文件或具有活动还原段的数据文件</p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d140508e1334 d140508e1329 ">
                                    <p>数据库自动关闭。如果硬件问题是临时的，则修复它并重新启动数据库。通常，崩溃恢复可以恢复丢失的事务。如果硬件问题是永久性的，则从备份还原数据文件并按<span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8" title="在数据库未打开时执行完全恢复时，您可以在一次操作中恢复所有损坏的数据文件，或者在单独的操作中执行每个损坏的数据文件的单独恢复。">执行已关闭的数据库恢复</a> ”中</span>所述恢复数据库。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d140508e1352" headers="d140508e1326 ">
                                    <p>不在<code class="codeph">SYSTEM</code>表空间中的数据文件或不包含活动回滚或还原段的数据文件</p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d140508e1352 d140508e1329 ">
                                    <p>受影响的数据文件脱机，但数据库保持打开状态。如果数据库的未受影响部分必须保持可用，则不要关闭数据库。使用临时选项使包含问题数据文件的表空间脱机，然后按照<span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-56EBDCEE-0C55-4556-A732-82EF42834D58" title="You can perform complete recovery of non-SYSTEM data files in a database while the database is open.">执行开放式数据库恢复</a> ”中的说明<a href="user-managed-flashback-dbpitr.html#GUID-56EBDCEE-0C55-4556-A732-82EF42834D58" title="在数据库打开时，您可以在数据库中执行非SYSTEM数据文件的完全恢复。">进行恢复</a></span> 。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d140508e1373" headers="d140508e1326 ">
                                    <p>当前控制文件的所有副本</p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d140508e1373 d140508e1329 ">
                                    <p>您必须还原备份控制文件，然后使用<code class="codeph">RESETLOGS</code>选项打开数据库。
                                    </p>
                                    <p>如果您没有备份，则可以尝试重新创建控制文件。如果可能，请使用<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">TO</code> <code class="codeph">TRACE</code>输出中包含的脚本。可能需要额外的工作来使控制文件结构与当前数据库结构相匹配。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d140508e1404" headers="d140508e1326 ">
                                    <p>多路复用控制文件的一个副本</p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d140508e1404 d140508e1329 ">
                                    <p><a id="d140508e1409" class="indexterm-anchor"></a><a id="d140508e1413" class="indexterm-anchor"></a>将完整的多路复用控制文件复制到损坏或丢失的控制文件的位置，然后打开数据库。如果无法将控制文件复制到其原始位置，请编辑初始化参数文件以反映新位置或删除损坏的控制文件。然后，打开数据库。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d140508e1417" headers="d140508e1326 ">
                                    <p>介质恢复所需的一个或多个归档日志</p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d140508e1417 d140508e1329 ">
                                    <p>您必须还原这些存档日志的备份才能继续进行恢复。您可以还原到默认位置或非默认位置。如果您没有备份，则必须在第一个缺少重做日志之前执行不完全恢复到SCN并打开<code class="codeph">RESETLOGS</code> 。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d140508e1427" headers="d140508e1326 ">
                                    <p>服务器参数文件（SPFILE）</p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d140508e1427 d140508e1329 ">
                                    <p>如果您有服务器参数文件的备份，则将其还原。或者，如果您备份了客户端初始化参数文件，则可以还原此文件的备份，启动实例，然后重新创建服务器参数文件。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="infoboxnote" id="GUID-D71F3FF3-84E5-4D81-9307-E2AD5CB51833__GUID-488FC76D-AC7E-4277-8077-565B9EB146D6">
                        <p class="notep1">注意：</p>
                        <p>Oracle Managed Files的恢复和恢复与用户命名文件的恢复和恢复没有什么不同。</p>
                     </div>
                     <p><a id="d140508e1437" class="indexterm-anchor"></a><a id="d140508e1441" class="indexterm-anchor"></a><a id="d140508e1445" class="indexterm-anchor"></a><a id="d140508e1449" class="indexterm-anchor"></a><a id="d140508e1453" class="indexterm-anchor"></a>至<a id="d140508e1458" class="indexterm-anchor"></a>执行介质恢复，Oracle建议您在SQL * Plus中使用<code class="codeph">RECOVER</code>语句。您也可以使用SQL语句<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">RECOVER</code> ，但<code class="codeph">RECOVER</code>语句通常更简单。要启动任何类型的介质恢复，您必须遵守以下限制：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您必须具有管理员权限。</p>
                        </li>
                        <li>
                           <p>所有恢复会话必须兼容。</p>
                        </li>
                        <li>
                           <p>一个会话无法启动完全介质恢复，而另一个会话执行不完整的介质恢</p>
                        </li>
                        <li>
                           <p>如果通过共享服务器进程连接到数据库，则无法启动介质恢复。</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="BRADV90025"></a><div class="props_rev_3"><a id="GUID-54B59888-8683-4CD9-B144-B0BB68887572" name="GUID-54B59888-8683-4CD9-B144-B0BB68887572"></a><h4 id="BRADV-GUID-54B59888-8683-4CD9-B144-B0BB68887572" class="sect4"><span class="enumeration_section">30.2.2</span>使用RECOVER命令自动恢复</h4>
                  <div>
                     <div class="section">
                        <p>使用SQL * Plus执行介质恢复时，最简单的策略是使用SQL * Plus <code class="codeph">RECOVER</code>命令执行自动恢复。自动恢复启动恢复，无需手动提示SQL * Plus应用每个单独的归档重做日志。
                        </p>
                        <p><a id="d140508e1567" class="indexterm-anchor"></a><a id="d140508e1571" class="indexterm-anchor"></a><a id="d140508e1575" class="indexterm-anchor"></a><a id="d140508e1579" class="indexterm-anchor"></a>使用SQL * Plus时，您可以使用以下选项自动应用恢复期间所需的归档重做日志的默认文件名：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>在发出<code class="codeph">RECOVER</code>命令之前发出<code class="codeph">SET</code> <code class="codeph">AUTORECOVERY</code> <code class="codeph">ON</code> 。如果使用<code class="codeph">SET</code> <code class="codeph">AUTORECOVERY</code> <code class="codeph">OFF</code> （默认值）执行恢复，则必须手动输入文件名或按Enter键接受建议的文件名。
                              </p>
                           </li>
                           <li>
                              <p>将<code class="codeph">AUTOMATIC</code>关键字指定为<code class="codeph">RECOVER</code>命令的选项。
                              </p>
                           </li>
                        </ul>
                        <p>在任何一种情况下，如果必要的文件位于具有正确名称的正确位置，则在发出<code class="codeph">RECOVER</code>命令时不需要任何交互。当数据库成功应用重做日志文件时，将返回以下消息：</p><pre class="oac_no_warn" dir="ltr">已应用日志。
</pre><p>然后，系统会提示您输入序列中的下一个重做日志。如果最近应用的日志是上次需要的日志，则终止恢复。</p>
                        <p>用于自动恢复的文件名是从<code class="codeph">LOG_ARCHIVE_FORMAT</code>的连接值派生的<a id="d140508e1634" class="indexterm-anchor"></a>使用<code class="codeph">LOG_ARCHIVE_DEST_</code> <span class="italic"><code class="codeph">n</code></span> ，其中<span class="italic"><code class="codeph">n</code></span>是所有已启用的本地目标中的最高值。例如，假设以下初始化参数设置在数据库实例中有效：</p><pre class="oac_no_warn" dir="ltr">LOG_ARCHIVE_DEST_1 =“LOCATION = / arc_dest / loc1 /”LOG_ARCHIVE_DEST_2 =“LOCATION = / arc_dest / loc2 /”LOG_ARCHIVE_DEST_STATE_1 = DEFER LOG_ARCHIVE_DEST_STATE_2 = ENABLE LOG_ARCHIVE_FORMAT = arch_％t_％s_％r.arc</pre><p>在此示例中，SQL * Plus自动建议文件名<code class="codeph">/arc_dest/loc2/arch_%t_%s_%r.arc</code> （其中<code class="codeph">%t</code>是线程， <code class="codeph">%s</code>是序列， <code class="codeph">%r</code>是resetlogs ID）。
                        </p>
                        <div class="infoboxnotealso" id="GUID-54B59888-8683-4CD9-B144-B0BB68887572__GUID-6CE0F846-E4E6-44D9-B4A2-FEC51EDADA6C">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="user-managed-flashback-dbpitr.html#GUID-D32B0E81-6341-4790-BFAD-E78A63B8E8B9">使用SET AUTORECOVERY自动恢复</a></p>
                              </li>
                              <li>
                                 <p><a href="user-managed-flashback-dbpitr.html#GUID-68DDE32D-C6A7-43EF-A2BC-9F6287474996">使用RECOVER命令的AUTOMATIC选项自动恢复</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div><a id="BRADV90026"></a><div class="props_rev_3"><a id="GUID-D32B0E81-6341-4790-BFAD-E78A63B8E8B9" name="GUID-D32B0E81-6341-4790-BFAD-E78A63B8E8B9"></a><h5 id="BRADV-GUID-D32B0E81-6341-4790-BFAD-E78A63B8E8B9" class="sect5"><span class="enumeration_section">30.2.2.1</span>使用SET AUTORECOVERY自动恢复</h5>
                     <div>
                        <p>还原数据文件备份后，可以运行<code class="codeph">SET</code> <code class="codeph">AUTORECOVERY</code> <code class="codeph">ON</code>命令以启用自动恢复。例如，您可以在SQL * Plus中输入以下命令以执行自动恢复并打开数据库：</p><pre class="oac_no_warn" dir="ltr">在恢复数据库上启动安装设置AUTORECOVERY ALTER DATABASE OPEN;</pre><div class="infoboxnote" id="GUID-D32B0E81-6341-4790-BFAD-E78A63B8E8B9__GUID-294F1C5C-561C-47DA-B43B-BE127A6A629B">
                           <p class="notep1">注意：</p>
                           <p>发出SQL * Plus <code class="codeph">RECOVER</code>命令后，您可以在<code class="codeph">V$RECOVERY_FILE_STATUS</code>视图中查看已考虑进行恢复的所有文件。您可以在<code class="codeph">V$RECOVERY_STATUS</code>视图中访问每个文件的状态信息。终止恢复会话后无法访问这些视图。
                           </p>
                        </div>
                     </div>
                  </div><a id="BRADV90027"></a><div class="props_rev_3"><a id="GUID-68DDE32D-C6A7-43EF-A2BC-9F6287474996" name="GUID-68DDE32D-C6A7-43EF-A2BC-9F6287474996"></a><h5 id="BRADV-GUID-68DDE32D-C6A7-43EF-A2BC-9F6287474996" class="sect5"><span class="enumeration_section">30.2.2.2</span>使用RECOVER命令的AUTOMATIC选项自动恢复</h5>
                     <div>
                        <p>除了使用<code class="codeph">SET</code> <code class="codeph">AUTORECOVERY</code>打开自动恢复功能外，您还可以在<code class="codeph">RECOVER</code>命令中简单地指定<code class="codeph">AUTOMATIC</code>关键字。例如，您可以在SQL * Plus中输入以下命令以执行自动恢复并打开数据库：</p><pre class="oac_no_warn" dir="ltr">STARTUP MOUNT RECOVER AUTOMATIC DATABASE ALTER DATABASE OPEN;</pre><p><a id="d140508e1857" class="indexterm-anchor"></a><a id="d140508e1861" class="indexterm-anchor"></a><a id="d140508e1865" class="indexterm-anchor"></a>如果使用Oracle Real Application Clusters配置，并且执行不完全恢复或使用备份控制文件，则数据库只能从第<span class="italic">一个</span>重做线程计算第一个归档重做日志文件的名称。您可能必须手动应用其他重做线程中的第一个日志文件。在提供给定线程中的第一个日志文件之后，数据库可以建议此线程中后续日志的名称。
                        </p>
                     </div>
                  </div>
               </div><a id="BRADV90028"></a><div class="props_rev_3"><a id="GUID-E7F2B57F-3731-4BC1-9E4D-AC4A99A1C2D2" name="GUID-E7F2B57F-3731-4BC1-9E4D-AC4A99A1C2D2"></a><h4 id="BRADV-GUID-E7F2B57F-3731-4BC1-9E4D-AC4A99A1C2D2" class="sect4"><span class="enumeration_section">30.2.3</span>归档日志在默认位置时的恢复</h4>
                  <div>
                     <p>当归档重做日志文件存在于默认位置时，无需执行其他设置即可执行恢复。</p>
                     <p>在恢复期间，由于需要日志，数据库会建议文件名。如果使用SQL * Plus运行非自动介质恢复，则输出将以此示例显示的格式显示：</p><pre class="oac_no_warn" dir="ltr">ORA-00279：在线程1 ORA-00289需要更改53577（11/26/02 19:20:58）：建议：/oracle/oradata/trgt/arch/arcr_1_802.arc ORA-00280：更改线程1的53577是顺序＃802指定日志：[&lt;RET&gt;表示建议的|自动| FROM logsource |取消]</pre><p>使用<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code>时会返回类似的消息<code class="codeph">...</code> <code class="codeph">RECOVER</code>声明。但是，不会显示任何提示。<span class="bold"></span></p>
                     <p>该数据库的构建通过连接的初始化参数的当前值建议归档日志文件名<code class="codeph">LOG_ARCHIVE_DEST_</code> <span class="italic"><code class="codeph">n</code></span> （其中<span class="italic"><code class="codeph">n</code></span>是所有启用的，本地目的地中的最高值）和<code class="codeph">LOG_ARCHIVE_FORMAT</code>并使用控制文件中的日志历史数据。以下是可能的设置：</p><pre class="oac_no_warn" dir="ltr">LOG_ARCHIVE_DEST_1 ='LOCATION = / oracle / oradata / trgt / arch /'LOG_ARCHIVE_FORMAT = arcr_％t_％s.arc SELECT NAME FROM V $ ARCHIVED_LOG; NAME ---------------------------------------- / oracle / oradata / trgt / arch / arcr_1_467.arc /oracle/oradata/trgt/arch/arcr_1_468.arc /oracle/oradata/trgt/arch/arcr_1_469.arc</pre><p>因此，如果<code class="codeph">LOG_ARCHIVE_DEST_1</code>目标中存在所有必需的归档日志文件，并且从不更改<code class="codeph">LOG_ARCHIVE_FORMAT</code>的值，则数据库可以建议并应用日志文件以自动完成介质恢复。
                     </p>
                  </div>
               </div><a id="BRADV90029"></a><div class="props_rev_3"><a id="GUID-F66C6B19-0960-4231-92C1-400C625F66D7" name="GUID-F66C6B19-0960-4231-92C1-400C625F66D7"></a><h4 id="BRADV-GUID-F66C6B19-0960-4231-92C1-400C625F66D7" class="sect4"><span class="enumeration_section">30.2.4</span>存档日志位于非默认位置时的恢复</h4>
                  <div>
                     <p>要在归档重做日志文件存储在非缺省位置时执行介质恢复，必须指定归档重做日志文件的位置。</p>
                     <p>当归档日志不在其默认位置时，执行介质恢复时，您具有以下互斥选项：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>编辑<code class="codeph">LOG_ARCHIVE_DEST_</code> <span class="italic"><code class="codeph">n</code></span>参数，该参数指定归档重做日志的位置，然后照常恢复。
                           </p>
                           <p><a href="user-managed-flashback-dbpitr.html#GUID-4822CA38-EC09-474B-8F72-AB6599EC17D1">重置存档日志目标中</a>描述了此任务。
                           </p>
                        </li>
                        <li>
                           <p>使用SQL * Plus中的<code class="codeph">SET</code>语句指定恢复前的非默认日志位置，或<code class="codeph">RECOVER</code>命令的<code class="codeph">LOGFILE</code>参数。
                           </p>
                           <p><a href="user-managed-flashback-dbpitr.html#GUID-28E902A1-D069-43BD-8730-8F85FD746FA9">覆盖存档日志目标中</a>描述了此任务。
                           </p>
                        </li>
                     </ul>
                  </div><a id="BRADV90030"></a><div class="props_rev_3"><a id="GUID-4822CA38-EC09-474B-8F72-AB6599EC17D1" name="GUID-4822CA38-EC09-474B-8F72-AB6599EC17D1"></a><h5 id="BRADV-GUID-4822CA38-EC09-474B-8F72-AB6599EC17D1" class="sect5"><span class="enumeration_section">30.2.4.1</span>重置存档日志目标</h5>
                     <div>
                        <div class="section">
                           <p><a id="d140508e2198" class="indexterm-anchor"></a><a id="d140508e2202" class="indexterm-anchor"></a>您可以编辑初始化参数文件或发出<code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code>语句以更改归档重做日志的默认位置。
                           </p>
                           <p><span class="bold">要在恢复之前更改默认的归档日志位置：</span></p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>使用操作系统实用程序将存档日志还原到非默认位置。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">％cp / backup / arch / * / tmp /</pre></div>
                           </li>
                           <li class="stepexpand"><span>将存档日志参数的值更改为非默认位置。您可以在实例启动时发出<code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code>语句，或编辑初始化参数文件，然后启动数据库实例。例如，在关闭实例时，编辑参数文件，如下所示：</span><div><pre class="oac_no_warn" dir="ltr">LOG_ARCHIVE_DEST_1 ='LOCATION = / tmp /'LOG_ARCHIVE_FORMAT = arcr_％t_％s.arc</pre></div>
                           </li>
                           <li class="stepexpand"><span>使用SQL * Plus，通过指定已编辑的初始化参数文件来启动新实例，然后装入数据库。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">启动安装</pre></div>
                           </li>
                           <li class="stepexpand"><span>像往常一样开始媒体恢复。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">恢复数据库</pre></div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="BRADV90031"></a><div class="props_rev_3"><a id="GUID-28E902A1-D069-43BD-8730-8F85FD746FA9" name="GUID-28E902A1-D069-43BD-8730-8F85FD746FA9"></a><h5 id="BRADV-GUID-28E902A1-D069-43BD-8730-8F85FD746FA9" class="sect5"><span class="enumeration_section">30.2.4.2</span>覆盖存档的日志目标</h5>
                     <div>
                        <div class="section">
                           <p>在某些情况下，您可能希望将归档目标参数的当前设置覆盖为归档日志文件的源。</p>
                           <p><span class="bold">要使用SET LOGSOURCE恢复非默认位置中的存档日志，请执行以下操作：</span></p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span><a id="d140508e2327" class="indexterm-anchor"></a><a id="d140508e2331" class="indexterm-anchor"></a>使用操作系统实用程序，将存档的重做日志复制到备用位置。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">％cp $ ORACLE_HOME / oradata / trgt / arch / * / tmp</pre></div>
                           </li>
                           <li class="stepexpand"><span>在SQL * Plus中指定备用位置以进行恢复操作。使用<a id="d140508e2342" class="indexterm-anchor"></a><a id="d140508e2346" class="indexterm-anchor"></a><a id="d140508e2350" class="indexterm-anchor"></a><a id="d140508e2354" class="indexterm-anchor"></a><a id="d140508e2358" class="indexterm-anchor"></a><a id="d140508e2362" class="indexterm-anchor"></a> <code class="codeph">SET</code>语句的<code class="codeph">LOGSOURCE</code>参数。例如，启动SQL * Plus并运行：</span><div><pre class="oac_no_warn" dir="ltr">SET LOGSOURCE“/ tmp”</pre></div>
                           </li>
                           <li class="stepexpand"><span>恢复脱机表空间。例如，要恢复脱机表<code class="codeph">users</code>执行以下操作：</span><div><pre class="oac_no_warn" dir="ltr">RECOVER AUTOMATIC TABLESPACE用户</pre></div>
                           </li>
                           <li class="stepexpand"><span>或者，您可以避免运行<code class="codeph">SET</code> <code class="codeph">LOGSOURCE</code>并简单地运行：</span><div><pre class="oac_no_warn" dir="ltr">从“/ tmp”恢复AUTOMATIC TABLESPACE用户</pre></div>
                           </li>
                        </ol>
                        <div class="section">
                           <div class="infoboxnote" id="GUID-28E902A1-D069-43BD-8730-8F85FD746FA9__GUID-D2F9FB73-7228-45F6-8DFA-FF48D73A9C84">
                              <p class="notep1">注意：</p>
                              <p>覆盖重做日志源不会影响要归档的联机重做日志组的归档重做日志目标。</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="BRADV816"></a><a id="BRADV817"></a><a id="BRADV727"></a><div class="props_rev_3"><a id="GUID-5A3BB8EE-291F-41C6-976C-1F304069FF0B" name="GUID-5A3BB8EE-291F-41C6-976C-1F304069FF0B"></a><h4 id="BRADV-GUID-5A3BB8EE-291F-41C6-976C-1F304069FF0B" class="sect4"><span class="enumeration_section">30.2.5</span>使用存储快照优化进行恢复</h4>
                  <div>
                     <p>通过Storage Snapshot Optimization，您可以在数据库未处于备份模式时使用数据库的第三方快照，将数据库恢复到当前时间或创建快照后的指定时间点。如果在创建存储快照时数据库未处于备份模式，则仅当快照符合Oracle要求时，才能使用此快照执行恢复。请参阅<span class="q">“ <a href="user-managed-database-backups.html#GUID-A1112F2C-D0ED-4C2F-BA24-A614F99F0FCA">使用第三方快照技术进行备份</a> ”</span> 。如果满足这些条件，则可以使用RMAN或SQL * Plus执行与任何其他备份方法相同的基本恢复步骤。
                     </p>
                     <p>如果存储快照不符合使用存储快照优化的要求，则可以通过将数据文件置于备份模式来创建快照。要使用此类快照执行恢复，请使用<a href="user-managed-flashback-dbpitr.html#GUID-66D07694-533F-4E3A-BA83-DD461B68DB56" title="通常，当介质故障导致一个或多个数据文件不可访问时，您将执行数据库的完全恢复。在完整数据库恢复期间，您使用所有可用的重做将数据库恢复到当前SCN。">使用SQL * Plus</a> <a href="user-managed-flashback-dbpitr.html#GUID-2BF2BE5E-3D1B-4F0C-9F10-25D5342F6DB3" title="Incomplete recovery is also known as database point-in-time recovery.">执行完整数据库恢复</a>或<a href="user-managed-flashback-dbpitr.html#GUID-2BF2BE5E-3D1B-4F0C-9F10-25D5342F6DB3" title="不完全恢复也称为数据库时间点恢复。">执行不完整数据库恢复中所述的过程</a> 。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-5A3BB8EE-291F-41C6-976C-1F304069FF0B__GUID-69C30CCB-1A10-4F37-AEEE-E08BC0FFAD25">指定快照恢复的时间</p>
                     </div>
                     <!-- class="section" -->
                     <p>如果在数据库未处于备份模式时创建了存储快照，则必须在使用此快照恢复数据库时指定<code class="codeph">SNAPSHOT TIME</code>选项。<code class="codeph">SNAPSHOT TIME</code>选项可以在RMAN或SQL * Plus <code class="codeph">RECOVER</code>命令中使用。使用<code class="codeph">SNAPSHOT TIME</code>选项指定的<code class="codeph">SNAPSHOT TIME</code>必须是快照完成后的时间。如果指定的时间不正确，则数据库可能以不可修复的方式损坏。
                     </p>
                     <p>由于存储阵列中的时钟（发生快照的位置）以及托管Oracle数据库的计算机可能无法完美同步，因此建议您在<code class="codeph">SNAPSHOT TIME</code>选项中指定的时间添加几秒钟。这有助于您通过恢复到拍摄快照之前的某个点来避免将文件置于不一致状态的任何可能性。
                     </p>
                     <p><code class="codeph">RECOVER</code>命令中指定的所有时间（包括<code class="codeph">SNAPSHOT TIME</code>子句）都假定位于Oracle数据库主机的时区中。但是，存储阵列中的时钟可能与Oracle数据库主机位于不同的时区。如果存储阵列在不同时区报告其快照时间，则必须在<code class="codeph">SNAPSHOT TIME</code>选项中指定时间时考虑该差异。
                     </p>
                     <div class="infoboxnote" id="GUID-5A3BB8EE-291F-41C6-976C-1F304069FF0B__GUID-0A3A9BAE-5721-40FC-A70E-49FE4C358B3B">
                        <p class="notep1">注意：</p>
                        <p>由<code class="codeph">UNTIL</code>选项指定的恢复点不能早于指定的<code class="codeph">SNAPSHOT TIME</code> 。</p>
                     </div>
                     <div class="section">
                        <p class="subhead3" id="GUID-5A3BB8EE-291F-41C6-976C-1F304069FF0B__GUID-061FF938-0246-445E-A5DC-8A614546A9CD">示例：使用存储快照进行恢复</p>
                     </div>
                     <!-- class="section" -->
                     <p>本节中的示例使用<code class="codeph">RECOVER DATABASE</code>命令使用快照执行恢复。您可以使用RMAN或SQL * Plus中的<code class="codeph">RECOVER DATABASE</code>命令。但是， <code class="codeph">UNTIL CANCEL</code>子句仅在SQL * Plus中有效。
                     </p>
                     <p><span class="bold">要完全恢复数据库：</span></p><pre class="oac_no_warn" dir="ltr">恢复数据库;</pre><p><span class="bold">使用特定快照恢复数据库：</span></p>
                     <p>此示例恢复使用8月15日下午2:00拍摄的快照来恢复数据库。<code class="codeph">UNTIL TIME</code>子句可以指定快照之后的任何时间。
                     </p><pre class="oac_no_warn" dir="ltr">RECOVER DATABASE UNTIL TIME '10 / 15/2012 15:00:00'SNAPSHOT TIME '10 / 15/2012 14:00:00';</pre><p><span class="bold">使用归档重做日志文件执行部分恢复：</span></p>
                     <p>此示例使用8月15日下午2:00拍摄的快照中的日志文件</p><pre class="oac_no_warn" dir="ltr">RECOVER DATABASE直到取消快照时间'10 / 15/2012 14:00:00';</pre></div>
               </div><a id="BRADV99983"></a><div class="props_rev_3"><a id="GUID-8EC901EA-2281-49EF-89ED-D0595E46DFCB" name="GUID-8EC901EA-2281-49EF-89ED-D0595E46DFCB"></a><h4 id="BRADV-GUID-8EC901EA-2281-49EF-89ED-D0595E46DFCB" class="sect4"><span class="enumeration_section">30.2.6</span>用户管理恢复期间的恢复取消</h4>
                  <div>
                     <p>如果您启动介质恢复然后必须中断它，则在提示输入重做日志文件时输入<code class="codeph">CANCEL</code> ，或者如果必须在恢复单个数据文件时终止，或者在进行自动恢复时使用操作系统的中断信号。取消恢复后，您可以稍后使用<code class="codeph">RECOVER</code>命令恢复恢复。恢复从其取消时停止的位置恢复。
                     </p>
                  </div>
               </div><a id="BRADV221"></a><div class="props_rev_3"><a id="GUID-9174945F-96FA-477F-AEC2-046A3FE5ACAA" name="GUID-9174945F-96FA-477F-AEC2-046A3FE5ACAA"></a><h4 id="BRADV-GUID-9174945F-96FA-477F-AEC2-046A3FE5ACAA" class="sect4"><span class="enumeration_section">30.2.7</span>并行媒体恢复</h4>
                  <div>
                     <p>默认情况下，Oracle数据库使用<strong class="term">并行介质恢复</strong>来提高<strong class="term">介质恢复</strong>前滚阶段的性能。在并行恢复媒体时，数据库使用“分工”方法在向前滚动时将不同的进程分配给不同的数据块，从而使该过程更有效。使用的进程数源自<code class="codeph">CPU_COUNT</code>初始化参数，该参数默认等于系统上的CPU数。例如，如果在<code class="codeph">CPU_COUNT</code>为<code class="codeph">4</code>且仅恢复一个数据文件的系统上执行并行恢复，则四个生成的进程将从归档日志中读取块并应用重做。
                     </p>
                     <p>通常，介质恢复受数据块读取和写入的限制。并行恢复尝试使用系统的所有可用I / O带宽来提高性能。除非存在系统I / O瓶颈或差的异步I / O支持，否则并行恢复可能会提高恢复性能。</p>
                     <p>要覆盖执行并行恢复的默认行为，请使用带有<code class="codeph">NOPARALLEL</code>选项的SQL * Plus <code class="codeph">RECOVER</code>命令或<code class="codeph">RECOVER</code> <code class="codeph">PARALLEL</code> <code class="codeph">0</code> 。<code class="codeph">RECOVERY_PARALLELISM</code>初始化参数<span class="italic">仅</span>控制实例或崩溃恢复。媒体恢复不受<code class="codeph">RECOVERY_PARALLELISM</code>使用的值的影响。</p>
                     <div class="infoboxnotealso" id="GUID-9174945F-96FA-477F-AEC2-046A3FE5ACAA__GUID-C7FA49CA-87BA-4185-BB69-8CDCB3BCC937">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../sqpug/RECOVER.html#SQPUG053" target="_blank"><span class="italic">SQL * Plus用户指南和参考</span></a>有关SQL * Plus <code class="codeph">RECOVER</code>更多信息<code class="codeph">...</code> <code class="codeph">PARALLEL</code>和<code class="codeph">NOPARALLEL</code>命令</p>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV216"></a><div class="props_rev_3"><a id="GUID-66D07694-533F-4E3A-BA83-DD461B68DB56" name="GUID-66D07694-533F-4E3A-BA83-DD461B68DB56"></a><h3 id="BRADV-GUID-66D07694-533F-4E3A-BA83-DD461B68DB56" class="sect3"><span class="enumeration_section">30.3</span>使用SQL * Plus执行完整数据库恢复</h3>
               <div>
                  <p>通常，当介质故障导致一个或多个数据文件不可访问时，您将执行数据库的完全恢复。在完整数据库恢复期间，您使用所有可用的重做将数据库恢复到当前SCN。</p>
                  <p><code class="codeph">V$RECOVER_FILE</code>视图指示哪些文件需要恢复。根据具体情况，您可以恢复整个数据库或恢复单个表空间或数据文件。因为在完成恢复后不必使用<code class="codeph">RESETLOGS</code>选项打开数据库，所以可以选择一次恢复一些数据文件，之后恢复其余的数据文件。
                  </p>
                  <p>本节中的主题介绍了完成介质恢复操作所需的步骤。</p>
                  <div class="infoboxnotealso" id="GUID-66D07694-533F-4E3A-BA83-DD461B68DB56__GUID-D22FF53C-5B88-4327-A38F-A2CBB2E3D0C4">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="user-managed-flashback-dbpitr.html#GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8" title="在数据库未打开时执行完全恢复时，您可以在一次操作中恢复所有损坏的数据文件，或者在单独的操作中执行每个损坏的数据文件的单独恢复。">执行封闭式数据库恢复</a></p>
                        </li>
                        <li>
                           <p><a href="user-managed-flashback-dbpitr.html#GUID-56EBDCEE-0C55-4556-A732-82EF42834D58" title="在数据库打开时，您可以在数据库中执行非SYSTEM数据文件的完全恢复。">执行开放式数据库恢复</a></p>
                        </li>
                        <li>
                           <p><a href="user-managed-flashback-dbpitr.html#GUID-68CD62A9-F56E-4617-A010-F632708AECC3" title="Oracle数据库为整个多租户容器数据库（CDB）执行崩溃和实例恢复。您无法恢复单个可插拔数据库（PDB）。">执行CDB的崩溃和实例恢复</a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="BRADV90032"></a><div class="props_rev_3"><a id="GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8" name="GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8"></a><h4 id="BRADV-GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8" class="sect4"><span class="enumeration_section">30.3.1</span>执行封闭式数据库恢复</h4>
                  <div>
                     <p>在数据库未打开时执行完全恢复时，您可以在一次操作中恢复所有损坏的数据文件，或者在单独的操作中执行每个损坏的数据文件的单独恢复。</p>
                     <div class="p">
                        <p>此过程假定以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>当前控制文件可用。</p>
                           </li>
                           <li>
                              <p>您可以备份所有需要的数据文件。</p>
                           </li>
                           <li>
                              <p>可以使用所有必需的归档重做日志。</p>
                           </li>
                        </ul>
                        <p><span class="bold">要还原和恢复损坏或丢失的数据文件：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand" id="GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8__CHDJEDGI"><span>如果数据库已打开，请查询<code class="codeph">V$RECOVER_FILE</code>以确定必须恢复哪些数据文件以及必须恢复的原因。</span><div>
                              <p>如果计划执行完全恢复而不是时间点恢复，则只能恢复需要恢复的数据文件，而不是整个数据库。对于时间点恢复，您必须还原和恢复所有数据文件，除非您执行RMAN TSPITR。您也可以使用闪回数据库，但此过程会影响所有数据文件并将整个数据库返回到过去的时间。</p>
                              <p>您可以查询<code class="codeph">V$RECOVER_FILE</code>视图以列出需要按数据文件编号及其状态和错误信息进行恢复的数据文件。
                              </p><pre class="oac_no_warn" dir="ltr">SELECT FILE＃，ERROR，ONLINE_STATUS，CHANGE＃，TIME from V $ RECOVER_FILE;</pre><div class="infoboxnote" id="GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8__GUID-D54004A0-C25F-4F3B-AAB8-50F6A1F0927B">
                                 <p class="notep1">注意：</p>
                                 <p>您无法将<code class="codeph">V$RECOVER_FILE</code>与从备份还原的控制文件或在介质故障影响数据文件之后重新创建的控制文件一起使用。恢复或重新创建的控制文件不包含准确更新<code class="codeph">V$RECOVER_FILE</code>所需的信息。
                                 </p>
                              </div>
                              <p>您还可以使用数据文件编号和<code class="codeph">V$DATAFILE</code>和<code class="codeph">V$TABLESPACE</code>视图来执行有用的连接，以获取数据文件和表空间名称。
                              </p>
                              <p><code class="codeph">ERROR</code>列标识需要恢复的每个文件的问题。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>查询<code class="codeph">V$ARCHIVED_LOG</code>和<code class="codeph">V$RECOVERY_LOG</code>视图以确定需要哪些归档重做日志文件。</span><div>
                              <p><code class="codeph">V$ARCHIVED_LOG</code>列出了所有归档重做日志的文件名，而<code class="codeph">V$RECOVERY_LOG</code>仅列出了数据库执行介质恢复所需的归档重做日志。后一视图还包括基于使用<code class="codeph">LOG_ARCHIVE_FORMAT</code>参数指定的命名约定的文件的可能名称。
                              </p>
                              <div class="infoboxnote" id="GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8__GUID-F41AA6CB-E67A-4DAB-93CF-0E88F00C0F66">
                                 <p class="notep1">注意：</p>
                                 <p>只有在数据文件需要介质恢复时才会填充<code class="codeph">V$RECOVERY_LOG</code> 。因此，此视图对计划的恢复无效，例如从用户错误中恢复。
                                 </p>
                                 <p>如果数据文件需要恢复，但不存在数据文件的备份，则需要从将数据文件添加到数据库时开始生成所有重做。</p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand" id="GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8__CHDGADJF"><span>如果所有存档日志在默认位置都可用，则跳至步骤4。</span><div>
                              <p>如果必须还原某些归档日志，并且有足够的可用空间，则将所需的归档重做日志文件还原到<code class="codeph">LOG_ARCHIVE_DEST_1</code>指定的位置。在介质恢复期间，数据库在需要时自动定位正确的日志。例如，您可以在Linux或UNIX上输入以下命令：</p><pre class="oac_no_warn" dir="ltr">％cp / disk2 / arch / * $ ORACLE_HOME / oradata / trgt / arch</pre><p>如果没有足够的空间，则将部分或全部所需的归档重做日志文件还原到备用位置。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>如果数据库已打开，请将其关闭。例如：</span><div><pre class="oac_no_warn" dir="ltr">立即关闭</pre></div>
                        </li>
                        <li class="stepexpand"><span>检查媒体以确定问题的根源。</span><div>
                              <p>如果导致介质故障的硬件问题是暂时的，并且数据未损坏（例如，发生磁盘或控制器电源故障），则无需进行介质恢复：启动数据库并恢复正常操作。</p>
                              <p>如果无法修复问题，请继续执行步骤6。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>如果文件永久损坏，则识别损坏文件的最新备份。<span class="italic">仅还</span>原因介质故障而损坏的数据文件：不还原未损坏的数据文件或任何联机重做日志文件。</span><div>
                              <p>例如，如果<span class="italic"><code class="codeph">ORACLE_HOME/</code></span> <code class="codeph">oradata/trgt/users01.dbf</code>是唯一损坏的文件，那么你可能会发现<code class="codeph">/backup/users01_10_24_02.dbf</code>是最近此文件的备份。如果您没有特定数据文件的备份，则可以创建可以恢复的空替换文件。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>使用操作系统实用程序将数据文件还原到其默认位置或新位置。例如，将<code class="codeph">users01.dbf</code>还原到其默认位置的Linux或UNIX用户可能会输入：</span><div><pre class="oac_no_warn" dir="ltr">％cp /backup/users01_10_24_06.dbf $ ORACLE_HOME / oradata / trgt / users01.dbf</pre><p>确定还原数据文件备份的位置时，请使用以下准则：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>如果修复了硬件问题并且您可以将数据文件还原到其默认位置，则将数据文件还原到其默认位置并开始介质恢复。</p>
                                 </li>
                                 <li>
                                    <p>如果硬件问题仍然存在且您无法将数据文件还原到其原始位置，请将数据文件还原到备用存储设备。使用<code class="codeph">ALTER DATABASE RENAME FILE</code>语句在控制文件中指示这些文件的新位置。请参见“ <a href="../admin/managing-data-files-and-temp-files.html#ADMIN11430" target="_blank"><span class="italic">Oracle数据库管理员指南”</span></a> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p>如果要将数据文件还原到原始磁盘或分区，则该技术与还原到文件系统上的文件时的技术基本相同。请注意原始设备上文件的命名约定（根据操作系统的不同而不同），并使用支持原始设备的操作系统实用程序。</p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand" id="GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8__CHDGACIB"><span>使用管理员权限连接到数据库。然后启动一个新实例并挂载，但不要打开数据库。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">启动安装</pre></div>
                        </li>
                        <li class="stepexpand"><span>如果将一个或多个损坏的数据文件还原到其他位置，则更新数据库的控制文件以反映新的数据文件名。例如，要更改表空间<code class="codeph">users</code>数据文件的文件名，您可以输入：</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE RENAME FILE'？/oradata/trgt/users01.dbf'TO'/disk2/users01.dbf';</pre></div>
                        </li>
                        <li class="stepexpand"><span>通过检查当前控制文件通常附带的数据文件列表或查询<code class="codeph">V$DATAFILE</code>视图，获取所有数据文件的数据文件名和状态。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">选择名称，来自V $ DATAFILE的状态;</pre></div>
                        </li>
                        <li class="stepexpand"><span>确保所有需要恢复的数据文件都在线。唯一的例外是脱机表空间中的数据文件正常脱机或只读表空间中的数据文件。例如，要保证名为<code class="codeph">/oracle/dbs/tbs_10.f</code>的数据文件处于联机状态，请输入以下内容：</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE DATAFILE'/oracle/dbs/tbs_10.f'ONLINE;</pre><p>如果指定的数据文件已在线，则数据库将忽略该语句。如果您愿意，可以创建一个脚本以同时联机所有数据文件，如下例所示：</p><pre class="oac_no_warn" dir="ltr">SPOOL onlineall.sql SELECT'ALTER DATABASE DATAFILE'''|| name ||'''ONLINE;'来自V $ DATAFILE; SPOOL OFF SQL&gt; @onlineall</pre></div>
                        </li>
                        <li class="stepexpand"><span>如果将已归档的重做日志还原到备用位置，则可以使用SQL * Plus中<code class="codeph">SET</code>命令的<code class="codeph">LOGSOURCE</code>参数指定介质恢复之前的位置。例如，如果日志在<code class="codeph">/tmp</code>中暂存，则可以输入以下命令：</span><div><pre class="oac_no_warn" dir="ltr">SET LOGSOURCE / tmp</pre><p>或者，您可以跳过步骤12并在<code class="codeph">RECOVER</code>命令中使用<code class="codeph">FROM</code>参数，如步骤13所示。例如，如果日志在<code class="codeph">/tmp</code>中暂存，则可以输入以下命令：</p><pre class="oac_no_warn" dir="ltr">从'/ tmp'数据库中自动恢复</pre><div class="infoboxnote" id="GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8__GUID-8FD49360-138F-473B-B3BF-F2FCE5BEA7D1">
                                 <p class="notep1">注意：</p>
                                 <p>覆盖重做日志源不会影响要归档的联机重做日志组的归档重做日志目标。</p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>发出声明以恢复数据库，表空间或数据文件。例如，输入以下<code class="codeph">RECOVER</code>命令之一：</span><div><pre class="oac_no_warn" dir="ltr">RECOVER AUTOMATIC DATABASE＃whole database RECOVER AUTOMATIC TABLESPACE用户＃specific tablespace RECOVER AUTOMATIC DATAFILE'？/oradata/trgt/users01.dbf'; ＃特定数据文件</pre><p>如果您选择不自动化归档重做日志的应用程序，则必须接受或拒绝每个提示的日志。如果自动执行恢复，则数据库会自动应用日志。恢复将继续，直到已将所有必需的归档和联机重做日志应用于已还原的数据文件。媒体恢复完成后，数据库会通知您：</p><pre class="oac_no_warn" dir="ltr">媒体恢复完成。
</pre><p>如果完整介质恢复不需要归档重做日志，则数据库将应用所有必需的联机重做日志文件并终止恢复。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>恢复终止后，打开数据库以供使用：</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN;</pre></div>
                        </li>
                        <li class="stepexpand"><span>应用归档日志后，确保脱机存储中仍存在每个归档日志组的副本后，删除归档重做日志文件的已还原副本以释放磁盘空间。例如：</span><div><pre class="oac_no_warn" dir="ltr">％rm /tmp/*.arc</pre><div class="infoboxnotealso" id="GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8__GUID-063E585B-A45E-4110-9DEB-1784C04A1231">
                                 <p class="notep1">也可以看看：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-3913B513-ECF0-469A-A50A-A5A573C85DC0">在丢失所有当前控制文件后恢复</a> ”</span>和<span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-9152B9A8-308A-4871-B835-53AF7593E65D">重新创建控制文件</a> ”</span>以获取有关恢复或重新创建控制文件的信息</p>
                                    </li>
                                    <li>
                                       <p><span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-E0032019-E245-4EBD-B275-1343AA175239">备份不可用时重新创建数据文件</a> ”，</span>以获取有关在缺少数据文件备份时执行恢复的信息</p>
                                    </li>
                                    <li>
                                       <p><span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-2BF2BE5E-3D1B-4F0C-9F10-25D5342F6DB3" title="不完全恢复也称为数据库时间点恢复。">执行不完整数据库恢复</a> ”</span>以获取有关在缺少完全恢复数据库所需的重做时执行数据库时间点恢复的信息</p>
                                    </li>
                                    <li>
                                       <p><span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-4F81CE72-B1B3-4444-B7E9-7DC97C65836B" title="当归档重做日志文件存在于默认位置时，无需执行其他设置即可执行恢复。要在归档重做日志文件存储在非缺省位置时执行介质恢复，必须指定归档重做日志文件的位置。">用户管理的介质恢复</a></span>概述<span class="q">”</span> ，了解介质恢复期间的日志应用程序概述</p>
                                    </li>
                                 </ul>
                              </div>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV619"></a><a id="BRADV90033"></a><div class="props_rev_3"><a id="GUID-56EBDCEE-0C55-4556-A732-82EF42834D58" name="GUID-56EBDCEE-0C55-4556-A732-82EF42834D58"></a><h4 id="BRADV-GUID-56EBDCEE-0C55-4556-A732-82EF42834D58" class="sect4"><span class="enumeration_section">30.3.2</span>执行开放式数据库恢复</h4>
                  <div>
                     <p>在数据库打开时，您可以在数据库中执行非<code class="codeph">SYSTEM</code>数据文件的完全恢复。
                     </p>
                     <div class="p">
                        <p>此过程假定以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>当前控制文件可用。</p>
                           </li>
                           <li>
                              <p>您可以备份所有需要的数据文件。</p>
                           </li>
                           <li>
                              <p>可以使用所有必需的归档重做日志。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>当数据库保持打开状态时，可能会发生介质故障，使未损坏的数据文件保持在线并可供使用。如果数据库写入程序无法写入损坏的数据文件（但不包含包含它们的表空间）将自动脱机。如果数据库写程序无法打开数据文件，则仍会返回错误。无法读取损坏文件的查询会返回错误，但由于查询失败，数据文件不会脱机。例如，您可以运行SQL查询并查看输出，例如：</p><pre class="oac_no_warn" dir="ltr">第1行的错误：ORA-01116：打开数据库文件时出错3 ORA-01110：数据文件11：'/ oracle /oradata / strgt / cwmlite02.dbf'ORA-27041：无法打开文件SVR4错误：2：没有文件或目录附加信息：3</pre><div class="infoboxnote" id="GUID-56EBDCEE-0C55-4556-A732-82EF42834D58__GUID-D611AACE-C851-43D2-95CC-CB472DD71FC2">
                           <p class="notep1">注意：</p>
                           <p>在数据库打开时，您无法使用本节中的过程在<code class="codeph">SYSTEM</code>表空间上执行完整的介质恢复。如果介质故障损坏<code class="codeph">SYSTEM</code>表空间的数据文件，则数据库会自动关闭。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-56EBDCEE-0C55-4556-A732-82EF42834D58__GUID-987CE271-C1E8-4E26-A472-6AA1FA7CBA5C">要在打开的数据库中还原数据文件：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>按照<span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8" title="When performing complete recovery while the database is not open, you can recover either all damaged data files in one operation or perform individual recovery of each damaged data file in separate operations.">执行封闭数据库恢复</a> ”中的</span>步骤<a href="user-managed-flashback-dbpitr.html#GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8__CHDJEDGI">1</a>到步骤<a href="user-managed-flashback-dbpitr.html#GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8__CHDGADJF">3</a> <span class="q"><a href="user-managed-flashback-dbpitr.html#GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8" title="在数据库未打开时执行完全恢复时，您可以在一次操作中恢复所有损坏的数据文件，或者在单独的操作中执行每个损坏的数据文件的单独恢复。">进行操作</a></span> 。</span></li>
                        <li class="stepexpand"><span>如果数据库已打开，则将包含已损坏数据文件的所有表空间脱机。例如，如果表空间<code class="codeph">USERS</code>和<code class="codeph">TOOLS</code>包含损坏的数据文件，则执行以下SQL语句：</span><div><pre class="oac_no_warn" dir="ltr">ALTER TABLESPACE用户OFFLINE TEMPORARY; ALTER TABLESPACE工具OFFLINE TEMPORARY;</pre><p>如果指定<code class="codeph">TEMPORARY</code> ，则Oracle数据库会为表空间中的所有联机数据文件创建<a href="glossary.html#GUID-5FE755DB-A906-465A-A3E4-D067A77DA15C"><span class="xrefglossterm">检查点</span></a> 。发出此语句时脱机的文件可能需要在将表空间重新联机之前进行介质恢复。如果指定<code class="codeph">IMMEDIATE</code> ，则必须先在表空间上执行介质恢复，然后再将其恢复为联机状态。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>检查媒体以确定问题的根源。</span><div>
                              <p>您可以使用DBVERIFY实用程序对脱机数据文件运行完整性检查。</p>
                              <p>如果导致介质故障的硬件问题是暂时的，并且数据未损坏，则无需进行介质恢复。您可以使脱机表空间联机并恢复正常操作。如果无法修复问题，或者DBVERIFY报告损坏的块，则继续执行步骤4。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>如果文件永久损坏，请使用操作系统命令<span class="italic">仅</span>还原最新的备份文件<span class="italic"><span class="bold"> </span></span>媒体故障损坏的数据文件。例如，要恢复<code class="codeph">users01.dbf</code>您可以在Linux或UNIX上使用<code class="codeph">cp</code>命令，如下所示：</span><div><pre class="oac_no_warn" dir="ltr">％cp /disk2/backup/users01.dbf $ ORACLE_HOME / oradata / trgt / users01.dbf</pre><p>如果修复了硬件问题并且可以将数据文件还原到其原始位置，则执行此操作。否则，将数据文件还原到备用存储设备。不要还原未损坏的数据文件，联机重做日志或控制文件。</p>
                              <div class="infoboxnote" id="GUID-56EBDCEE-0C55-4556-A732-82EF42834D58__GUID-54F2A92B-7E04-4D37-AAA0-268350F6C597">
                                 <p class="notep1">注意：</p>
                                 <p>在某些情况下，如果您没有特定数据文件的备份，则可以使用<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">CREATE</code> <code class="codeph">DATAFILE</code>语句创建可恢复的空替换文件。
                                 </p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>如果将一个或多个损坏的数据文件还原到其他位置，则更新数据库的控制文件以反映新的数据文件名。例如，要更改表空间<code class="codeph">users</code>数据文件的文件名，您可以输入：</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE RENAME FILE'？/oradata/trgt/users01.dbf'TO'/disk2/users01.dbf';</pre></div>
                        </li>
                        <li class="stepexpand"><span>如果将已归档的重做日志还原到备用位置，则可以使用SQL * Plus中<code class="codeph">SET</code>命令的<code class="codeph">LOGSOURCE</code>参数指定介质恢复之前的位置。例如，如果日志在<code class="codeph">/tmp</code>中暂存，则可以输入以下命令：</span><div><pre class="oac_no_warn" dir="ltr">SET LOGSOURCE / tmp</pre><p>或者，您可以跳过步骤6并在<code class="codeph">RECOVER</code>命令中使用<code class="codeph">FROM</code>参数，如步骤7所示。例如，如果日志在<code class="codeph">/tmp</code>中暂存，则可以输入以下命令：</p><pre class="oac_no_warn" dir="ltr">从'/ tmp'TABLESPACE用户，工具中恢复AUTOMATIC;</pre><div class="infoboxnote" id="GUID-56EBDCEE-0C55-4556-A732-82EF42834D58__GUID-14E8DBEA-A529-49CF-84D9-D5C59D46298F">
                                 <p class="notep1">注意：</p>
                                 <p>覆盖重做日志源不会影响要归档的联机重做日志组的归档重做日志目标。</p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>使用管理员权限连接到数据库，并使用一个步骤启动一个或多个脱机表空间中所有已损坏数据文件的脱机表空间恢复。例如，按如下方式恢复<code class="codeph">users</code>和<code class="codeph">tools</code> ：</span><div><pre class="oac_no_warn" dir="ltr">RECOVER AUTOMATIC TABLESPACE用户，工具;</pre><p>数据库通过应用必要的归档和联机重做日志来重建恢复的数据文件，从而开始介质恢复的前滚阶段。除非使用<code class="codeph">RECOVER</code> <code class="codeph">AUTOMATIC</code>或<code class="codeph">SET</code> <code class="codeph">AUTORECOVERY</code> <code class="codeph">ON</code>命令自动应用文件，否则数据库会提示您输入每个所需的重做日志文件。
                              </p>
                              <p>恢复将继续，直到所有必需的存档日志都应用于数据文件。然后，联机重做日志会自动应用于已还原的数据文件，以完成介质恢复。如果完整介质恢复不需要归档重做日志，则数据库不会提示任何归档。相反，将应用所有必需的联机重做日志，并完成介质恢复。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>当损坏的表空间恢复到发生介质故障时，将脱机表空间联机。例如，要使表空间<code class="codeph">USERS</code>和<code class="codeph">TOOLS</code>联机，请发出以下语句：</span><div><pre class="oac_no_warn" dir="ltr">ALTER TABLESPACE用户在线; ALTER TABLESPACE工具在线;</pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-56EBDCEE-0C55-4556-A732-82EF42834D58__GUID-46C12003-8B1A-43A5-AEDA-032EC4C3D979">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../admin/managing-data-files-and-temp-files.html#ADMIN012" target="_blank"><span class="italic">Oracle数据库管理员指南</span></a> ，了解如何创建数据文件和<a href="../sqlrf/ALTER-DATABASE.html#SQLRF00802" target="_blank"><span class="italic">Oracle数据库SQL语言参考</span></a>以了解<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">RENAME</code> <code class="codeph">FILE</code></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="user-managed-database-backups.html#GUID-F8F10F74-107C-4D8F-86A8-18140FE8484D">运行DBVERIFY实用程序</a> ”</span></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-3913B513-ECF0-469A-A50A-A5A573C85DC0">在丢失所有当前控制文件后恢复</a> ”</span>和<span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-9152B9A8-308A-4871-B835-53AF7593E65D">重新创建控制文件</a> ”</span>以获取有关恢复或重新创建控制文件的信息</p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-E0032019-E245-4EBD-B275-1343AA175239">备份不可用时重新创建数据文件</a> ”，</span>以获取有关在缺少数据文件备份时执行恢复的信息</p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-2BF2BE5E-3D1B-4F0C-9F10-25D5342F6DB3" title="不完全恢复也称为数据库时间点恢复。">执行不完整数据库恢复</a> ”</span>以获取有关在缺少完全恢复数据库所需的重做时执行数据库时间点恢复的信息</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV656"></a><a id="BRADV655"></a><div class="props_rev_3"><a id="GUID-68CD62A9-F56E-4617-A010-F632708AECC3" name="GUID-68CD62A9-F56E-4617-A010-F632708AECC3"></a><h4 id="BRADV-GUID-68CD62A9-F56E-4617-A010-F632708AECC3" class="sect4"><span class="enumeration_section">30.3.3</span>执行CDB的崩溃和实例恢复</h4>
                  <div>
                     <p>Oracle数据库为整个多租户容器数据库（CDB）执行崩溃和实例恢复。您无法恢复单个可插拔数据库（PDB）。</p>
                     <div class="p">
                        <p>此过程假定以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>当前控制文件可用。</p>
                           </li>
                           <li>
                              <p>您可以备份所有需要的数据文件。</p>
                           </li>
                           <li>
                              <p>可以使用所有必需的归档重做日志。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-68CD62A9-F56E-4617-A010-F632708AECC3__GUID-227D4D2B-6106-4CE3-8625-C1A37A34484F">要为CDB执行崩溃和实例恢复：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>打开SQL客户端，如SQL * Plus。</span></li>
                        <li class="stepexpand"><span>使用<code class="codeph">ALTER PLUGGABLE DATABASE</code>系统特权以普通用户身份连接到<a href="glossary.html#GUID-EA3DB8F4-F68E-4FC5-A599-32A4886FFF8A"><span class="xrefglossterm">root</span></a> 。</span></li>
                        <li class="stepexpand"><span>按照<span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8" title="When performing complete recovery while the database is not open, you can recover either all damaged data files in one operation or perform individual recovery of each damaged data file in separate operations.">执行已关闭的数据库恢复</a> ”中</span>的过程<span class="q"><a href="user-managed-flashback-dbpitr.html#GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8" title="在数据库未打开时执行完全恢复时，您可以在一次操作中恢复所有损坏的数据文件，或者在单独的操作中执行每个损坏的数据文件的单独恢复。">进行操作</a></span> 。</span><div>
                              <p>如果您不想恢复特定PDB，请使其文件脱机。</p>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-68CD62A9-F56E-4617-A010-F632708AECC3__GUID-F691FCE9-6291-4B8F-AC44-A02F091D089D">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-3913B513-ECF0-469A-A50A-A5A573C85DC0">在丢失所有当前控制文件后恢复</a> ”</span>和<span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-9152B9A8-308A-4871-B835-53AF7593E65D">重新创建控制文件</a> ”</span>以获取有关恢复或重新创建控制文件的信息</p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-E0032019-E245-4EBD-B275-1343AA175239">备份不可用时重新创建数据文件</a> ”，</span>以获取有关在缺少数据文件备份时执行恢复的信息</p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-2BF2BE5E-3D1B-4F0C-9F10-25D5342F6DB3" title="不完全恢复也称为数据库时间点恢复。">执行不完整数据库恢复</a> ”</span>以获取有关在缺少完全恢复数据库所需的重做时执行数据库时间点恢复的信息</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV503"></a><a id="BRADV217"></a><div class="props_rev_3"><a id="GUID-2BF2BE5E-3D1B-4F0C-9F10-25D5342F6DB3" name="GUID-2BF2BE5E-3D1B-4F0C-9F10-25D5342F6DB3"></a><h3 id="BRADV-GUID-2BF2BE5E-3D1B-4F0C-9F10-25D5342F6DB3" class="sect3"><span class="enumeration_section">30.4</span>执行不完整的数据库恢复</h3>
               <div>
                  <p>不完全恢复也称为数据库时间点恢复。</p>
                  <p>通常，您在以下情况下执行<a href="glossary.html#GUID-FCC8BB91-79B6-4AF1-974A-43E75CD161E3"><span class="xrefglossterm">数据库时间点恢复（DBPITR）</span></a> ：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>您希望在用户或管理错误之前将数据库恢复到SCN。</p>
                     </li>
                     <li>
                        <p>数据库包含损坏的块。</p>
                     </li>
                     <li>
                        <p>完全数据库恢复失败，因为所有必需的归档重做日志都不可用。</p>
                     </li>
                     <li>
                        <p>您正在从生产数据库备份创建测试数据库或报告数据库。</p>
                     </li>
                  </ul>
                  <p>如果数据库在<code class="codeph">ARCHIVELOG</code>模式下运行，并且归档重做日志文件的唯一副本已损坏，则受损文件不会影响数据库的当前操作。<a href="user-managed-flashback-dbpitr.html#GUID-2BF2BE5E-3D1B-4F0C-9F10-25D5342F6DB3__CHDEHHEI" title="归档重做日志丢失">表30-2</a>说明了根据写入重做日志的时间和备份数据文件的时间而出现的情况。
                  </p>
                  <div class="tblformal" id="GUID-2BF2BE5E-3D1B-4F0C-9F10-25D5342F6DB3__CHDEHHEI">
                     <p class="titleintable">表30-2存档重做日志丢失</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="归档重做日志丢失" width="100%" border="1" summary="Loss of archived redo logs" frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="31%" id="d140508e4095">如果你支持......</th>
                              <th align="left" valign="bottom" width="69%" id="d140508e4098">然后...</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="31%" id="d140508e4103" headers="d140508e4095 ">
                                 <p>写入填充的联机重做日志组（现在已归档）之后的所有数据文件</p>
                              </td>
                              <td align="left" valign="top" width="69%" headers="d140508e4103 d140508e4098 ">
                                 <p>完整的介质恢复不需要已填充的联机重做日志组的归档版本。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="31%" id="d140508e4110" headers="d140508e4095 ">
                                 <p>写入填充的联机重做日志组之前的特定数据文件</p>
                              </td>
                              <td align="left" valign="top" width="69%" headers="d140508e4110 d140508e4098 ">
                                 <p>如果相应的数据文件因永久性介质故障而损坏，则使用受损数据文件的最新备份，并对损坏的数据文件执行表空间时间点恢复，直至损坏的归档重做日志文件。</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <div class="infoboxnote" id="GUID-2BF2BE5E-3D1B-4F0C-9F10-25D5342F6DB3__GUID-4804C30C-7E21-4CB9-B233-1A000BD7E8C9">
                     <p class="notep1">警告：</p>
                     <p>如果您知道已归档的重做日志组已损坏，则会立即备份所有数据文件，以便您拥有一个不需要损坏的归档重做日志的完整数据库备份。</p>
                  </div>
                  <p>DBPITR的技术与执行封闭式数据库恢复的技术非常相似，只是您通过指定特定时间或SCN或输入<code class="codeph">CANCEL</code>来终止DBPITR。基于取消的恢复会提示您使用建议的归档重做日志文件名。指定<code class="codeph">CANCEL</code>而不是文件名或将所有重做应用于数据文件时，恢复将停止。基于取消的恢复是控制哪个归档日志终止恢复的最佳技术。
                  </p>
                  <div class="infoboxnotealso" id="GUID-2BF2BE5E-3D1B-4F0C-9F10-25D5342F6DB3__GUID-A1E280B7-336C-443A-9CD3-F11643322D1A">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-110AD275-650D-4A87-9790-B785D4618C9B" title="在基于取消的恢复中，通过提示您使用归档重做日志文件的建议文件名来进行恢复。指定CANCEL而不是文件名或将所有重做应用于数据文件时，恢复将停止。">执行基于取消的不完全恢复</a> ”</span></p>
                        </li>
                        <li>
                           <p><span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-CEC8AD66-CB59-4065-A972-DFB77A93C0AD" title="您可以为不完全恢复的终点指定SCN或时间。">执行基于时间或基于变更的不完全恢复</a> ”</span></p>
                        </li>
                        <li>
                           <p><span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8" title="在数据库未打开时执行完全恢复时，您可以在一次操作中恢复所有损坏的数据文件，或者在单独的操作中执行每个损坏的数据文件的单独恢复。">执行封闭式数据库恢复</a> ”</span></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="BRADV620"></a><a id="BRADV504"></a><a id="BRADV90034"></a><div class="props_rev_3"><a id="GUID-110AD275-650D-4A87-9790-B785D4618C9B" name="GUID-110AD275-650D-4A87-9790-B785D4618C9B"></a><h4 id="BRADV-GUID-110AD275-650D-4A87-9790-B785D4618C9B" class="sect4"><span class="enumeration_section">30.4.1</span>执行基于取消的不完全恢复</h4>
                  <div>
                     <p>在基于取消的恢复中，通过提示您使用归档重做日志文件的建议文件名来进行恢复。指定<code class="codeph">CANCEL</code>而不是文件名或将所有重做应用于数据文件时，恢复将停止。
                     </p>
                     <div class="p">
                        <p>此过程假定以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>当前控制文件可用。</p>
                           </li>
                           <li>
                              <p>您可以备份所有需要的数据文件。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-110AD275-650D-4A87-9790-B785D4618C9B__GUID-9A3715AC-4514-466C-B27D-57ED09280A15">要执行基于取消的恢复：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>按照<span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8" title="When performing complete recovery while the database is not open, you can recover either all damaged data files in one operation or perform individual recovery of each damaged data file in separate operations.">执行封闭式数据库恢复</a> ”中的</span>步骤<a href="user-managed-flashback-dbpitr.html#GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8__CHDJEDGI">1</a>到步骤<a href="user-managed-flashback-dbpitr.html#GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8__CHDGACIB">8</a> <span class="q"><a href="user-managed-flashback-dbpitr.html#GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8" title="在数据库未打开时执行完全恢复时，您可以在一次操作中恢复所有损坏的数据文件，或者在单独的操作中执行每个损坏的数据文件的单独恢复。">进行操作</a></span> 。</span></li>
                        <li class="stepexpand"><span>通过在SQL * Plus中发出以下命令来开始基于取消的恢复：</span><div><pre class="oac_no_warn" dir="ltr">恢复数据库直到取消</pre><div class="infoboxnote" id="GUID-110AD275-650D-4A87-9790-B785D4618C9B__GUID-B7D0B118-DBFA-495F-8DD5-09EE2AA7C0E1">
                                 <p class="notep1">注意：</p>
                                 <p>如果未能在<code class="codeph">RECOVER</code>命令上指定<code class="codeph">UNTIL</code>子句，则数据库将假定完全恢复，并且在应用所有重做之前不会打开。
                                 </p>
                              </div>
                              <p>数据库应用必要的重做日志文件来重建已还原的数据文件。数据库提供了它希望从<code class="codeph">LOG_ARCHIVE_DEST_1</code>找到的名称，并请求您停止或继续应用日志文件。如果控制文件是备份，则如果要在这些日志中应用更改，则必须提供联机重做日志的名称。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>继续应用重做日志文件，直到最后一个日志应用于已还原的数据文件，然后通过执行以下命令取消恢复：</span><div><pre class="oac_no_warn" dir="ltr">取消</pre><p>数据库指示恢复是否成功。如果在将所有数据文件恢复到一致的SCN之前取消，然后尝试打开数据库，则在需要更多恢复时会出现<code class="codeph">ORA-1113</code>错误。您可以查询<code class="codeph">V$RECOVER_FILE</code>以确定是否需要更多恢复，或者在开始不完全恢复之前是否未恢复数据文件的备份。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand" id="GUID-110AD275-650D-4A87-9790-B785D4618C9B__CHDGJGGF"><span>使用<code class="codeph">RESETLOGS</code>选项打开数据库。使用备份控制文件进行不完全恢复或恢复后，必须始终重置日志。例如：</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN RESETLOGS;</pre><p>如果您不应该尝试使用<code class="codeph">OPEN</code> <code class="codeph">RESETLOGS</code> ，或者如果您在应该的时候忽略重置日志，那么数据库将返回错误并且不会打开数据库。纠正问题，然后再试一次。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand" id="GUID-110AD275-650D-4A87-9790-B785D4618C9B__CHDDFBBJ"><span>使用<code class="codeph">RESETLOGS</code>选项打开数据库后，请检查警报日志。</span><div>
                              <div class="infoboxnote" id="GUID-110AD275-650D-4A87-9790-B785D4618C9B__GUID-5D2B534E-DDE5-4B0B-85E7-80025C92A590">
                                 <p class="notep1">注意：</p>
                                 <p>查找跟踪文件和警报日志的最简单方法是运行以下SQL查询： <code class="codeph">SELECT NAME, VALUE FROM V$DIAG_INFO</code> 。</p>
                              </div>
                              <p>使用<code class="codeph">RESETLOGS</code>选项打开时，数据库将根据恢复是完整还是不完整返回不同的消息。如果恢复已完成，则警报日志中将显示以下消息：</p><pre class="oac_no_warn" dir="ltr">通过更改<span class="italic">scn</span>完全恢复后的RESETLOGS
</pre><p>如果恢复不完整，则会在警报日志中报告此消息，其中<span class="italic"><code class="codeph">scn</code></span>指的是不完全恢复的终点：</p><pre class="oac_no_warn" dir="ltr">不完全恢复后的RESETLOGS UNTIL CHANGE <span class="italic">scn</span>
</pre><p>还要检查警报日志以确定数据库是否检测到数据字典和控制文件之间的不一致。<a href="user-managed-flashback-dbpitr.html#GUID-110AD275-650D-4A87-9790-B785D4618C9B__CHDIBHDI" title="描述数据文件记录中的不一致">表30-3</a>介绍了两种可能的方案。
                              </p>
                              <div class="tblformal" id="GUID-110AD275-650D-4A87-9790-B785D4618C9B__CHDIBHDI">
                                 <p class="titleintable">表30-3数据字典和控制文件之间的不一致</p>
                                 <table cellpadding="4" cellspacing="0" class="Formal" title="数据字典和控制文件之间的不一致" width="90%" border="1" summary="Describes inconsistencies in datafile records" frame="hsides" rules="rows">
                                    <thead>
                                       <tr align="left" valign="top">
                                          <th align="left" valign="bottom" width="25%" id="d140508e4370">控制文件中列出的数据文件</th>
                                          <th align="left" valign="bottom" width="25%" id="d140508e4373">数据字典中列出的数据文件</th>
                                          <th align="left" valign="bottom" width="50%" id="d140508e4376">结果</th>
                                       </tr>
                                    </thead>
                                    <tbody>
                                       <tr align="left" valign="top">
                                          <td align="left" valign="top" width="25%" id="d140508e4381" headers="d140508e4370 ">
                                             <p>是</p>
                                          </td>
                                          <td align="left" valign="top" width="25%" headers="d140508e4381 d140508e4373 ">
                                             <p>没有</p>
                                          </td>
                                          <td align="left" valign="top" width="50%" headers="d140508e4381 d140508e4376 ">
                                             <p>从控制文件中删除对未列出的数据文件的引用。警报日志中的消息指示找到的内容。</p>
                                          </td>
                                       </tr>
                                       <tr align="left" valign="top">
                                          <td align="left" valign="top" width="25%" id="d140508e4391" headers="d140508e4370 ">
                                             <p>没有</p>
                                          </td>
                                          <td align="left" valign="top" width="25%" headers="d140508e4391 d140508e4373 ">
                                             <p>是</p>
                                          </td>
                                          <td align="left" valign="top" width="50%" headers="d140508e4391 d140508e4376 ">
                                             <p>数据库在<code class="codeph">MISSING</code> <code class="codeph">nnnnn</code>下的控制文件中创建占位符条目（其中<code class="codeph">nnnnn</code>是十进制文件编号）。<code class="codeph">MISSING</code> <code class="codeph">nnnnn</code>在控制文件中标记为脱机并需要介质恢复。您可以使用<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">RENAME</code> <code class="codeph">FILE</code> for <code class="codeph">MISSING</code> <code class="codeph">nnnnn</code>使与<code class="codeph">MISSING</code> <code class="codeph">nnnnn</code>相对应的数据文件可以访问，以便它指向数据文件。如果您没有此数据文件的备份，请删除表空间。
                                             </p>
                                          </td>
                                       </tr>
                                    </tbody>
                                 </table>
                              </div>
                              <!-- class="inftblhruleinformal" -->
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-110AD275-650D-4A87-9790-B785D4618C9B__GUID-FC85452D-F65B-4E4D-BCAE-BA99A2EDEED5">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-739E7EDD-3142-41C0-AC4B-80E7F000D39B">关于用户管理的介质恢复问题</a> ”，</span>用于描述可能导致<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">OPEN</code> <code class="codeph">RESETLOGS</code>失败的情况</p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-3913B513-ECF0-469A-A50A-A5A573C85DC0">在丢失所有当前控制文件后</a></span>恢复<span class="q">”，</span>以获取有关恢复或重新创建控制文件的信息</p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-E0032019-E245-4EBD-B275-1343AA175239">备份不可用时重新创建数据文件</a> ”，</span>以获取有关在缺少数据文件备份时执行恢复的信息</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV621"></a><a id="BRADV90035"></a><div class="props_rev_3"><a id="GUID-CEC8AD66-CB59-4065-A972-DFB77A93C0AD" name="GUID-CEC8AD66-CB59-4065-A972-DFB77A93C0AD"></a><h4 id="BRADV-GUID-CEC8AD66-CB59-4065-A972-DFB77A93C0AD" class="sect4"><span class="enumeration_section">30.4.2</span>执行基于时间或基于变更的不完全恢复</h4>
                  <div>
                     <p>您可以为不完全恢复的终点指定SCN或时间。</p>
                     <div class="p">
                        <p>如果您的数据库受季节性时间更改（例如，夏令时）的影响，则如果时间在重做日志中出现两次并且您希望恢复到第二次或更晚的时间，则可能会遇到问题。要处理时间更改，请执行基于取消或基于更改的恢复。</p>
                        <p>此过程假定以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>当前控制文件可用。</p>
                           </li>
                           <li>
                              <p>您可以备份所有需要的数据文件。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-CEC8AD66-CB59-4065-A972-DFB77A93C0AD__GUID-22A12690-60EB-4700-8071-076AC61384B9">要执行基于更改或基于时间的恢复：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>按照<span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8" title="When performing complete recovery while the database is not open, you can recover either all damaged data files in one operation or perform individual recovery of each damaged data file in separate operations.">执行封闭数据库恢复</a> ”中的</span>步骤<a href="user-managed-flashback-dbpitr.html#GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8__CHDJEDGI">1</a>到步骤<a href="user-managed-flashback-dbpitr.html#GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8__CHDGACIB">8</a> <span class="q"><a href="user-managed-flashback-dbpitr.html#GUID-4F83FD6F-01A3-4680-AD41-EF391EEBB0D8" title="在数据库未打开时执行完全恢复时，您可以在一次操作中恢复所有损坏的数据文件，或者在单独的操作中执行每个损坏的数据文件的单独恢复。">进行操作</a></span> 。</span></li>
                        <li class="stepexpand"><span>发出<code class="codeph">RECOVER</code> <code class="codeph">DATABASE</code> <code class="codeph">UNTIL</code>语句以开始恢复。如果恢复到SCN，则指定为不带引号的十进制数。例如，要通过SCN 10034问题恢复：</span><div><pre class="oac_no_warn" dir="ltr">RECOVER DATABASE UNTIL CHANGE 10034;</pre><p>如果恢复到某个时间，则始终使用以下格式指定时间，用单引号分隔： <code class="codeph">'YYYY-MM-DD:HH24:MI:SS'</code> 。以下语句将数据库恢复到指定时间：</p><pre class="oac_no_warn" dir="ltr">恢复数据库直到'2000-12-31：12：47：30'</pre></div>
                        </li>
                        <li class="stepexpand"><span>应用必要的重做日志文件以恢复还原的数据文件。数据库在到达正确的时间时自动终止恢复，并返回一条消息，指示恢复是否成功。</span><div>
                              <div class="infoboxnote" id="GUID-CEC8AD66-CB59-4065-A972-DFB77A93C0AD__GUID-5F45CA17-E938-4C93-8509-F5D96A81B9DE">
                                 <p class="notep1">注意：</p>
                                 <p>除非自动恢复，否则数据库将提供<code class="codeph">LOG_ARCHIVE_DEST_1</code>的名称，并要求您在每个日志后停止或继续。如果控制文件是备份，则在应用归档日志后，您必须提供联机日志的名称。
                                 </p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>按照<span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-110AD275-650D-4A87-9790-B785D4618C9B" title="In cancel-based recovery, recovery proceeds by prompting you with the suggested file names of archived redo log files. Recovery stops when you specify CANCEL instead of a file name or when all redo has been applied to the data files.">执行基于取消的不完全恢复</a> ”中的</span>步骤<a href="user-managed-flashback-dbpitr.html#GUID-110AD275-650D-4A87-9790-B785D4618C9B__CHDGJGGF">4</a>和<a href="user-managed-flashback-dbpitr.html#GUID-110AD275-650D-4A87-9790-B785D4618C9B__CHDDFBBJ">5</a> <span class="q"><a href="user-managed-flashback-dbpitr.html#GUID-110AD275-650D-4A87-9790-B785D4618C9B" title="在基于取消的恢复中，通过提示您使用归档重做日志文件的建议文件名来进行恢复。指定CANCEL而不是文件名或将所有重做应用于数据文件时，恢复将停止。">进行操作</a></span> 。</span></li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-CEC8AD66-CB59-4065-A972-DFB77A93C0AD__GUID-4664AD39-E435-4AD4-A82F-38CA22DF6CCC">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-3913B513-ECF0-469A-A50A-A5A573C85DC0">在丢失所有当前控制文件后</a></span>恢复<span class="q">”，</span>以获取有关恢复或重新创建控制文件的信息</p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-E0032019-E245-4EBD-B275-1343AA175239">备份不可用时重新创建数据文件</a> ”，</span>以获取有关在缺少数据文件备份时执行恢复的信息</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV622"></a><a id="BRADV219"></a><div class="props_rev_3"><a id="GUID-3A4C59D7-C91D-4A4E-A803-5C02FE58858A" name="GUID-3A4C59D7-C91D-4A4E-A803-5C02FE58858A"></a><h3 id="BRADV-GUID-3A4C59D7-C91D-4A4E-A803-5C02FE58858A" class="sect3"><span class="enumeration_section">30.5</span>在NOARCHIVELOG模式下恢复数据库</h3>
               <div>
                  <div class="section">
                     <p><a id="d140508e4771" class="indexterm-anchor"></a><a id="d140508e4777" class="indexterm-anchor"></a><a id="d140508e4781" class="indexterm-anchor"></a><a id="d140508e4785" class="indexterm-anchor"></a><a id="d140508e4789" class="indexterm-anchor"></a><a id="d140508e4793" class="indexterm-anchor"></a>如果介质故障损坏<code class="codeph">NOARCHIVELOG</code>数据库中的数据文件，则恢复的唯一选择通常是恢复一致的整个数据库备份。如果使用Oracle Data Pump Export创建的逻辑备份来补充常规物理备份，则还可以尝试通过将数据库的导出备份导入重新创建的数据库或从旧备份还原的数据库来还原数据库。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-3A4C59D7-C91D-4A4E-A803-5C02FE58858A__GUID-140ED71E-0DCB-4E87-B998-76AA7E852855">要还原和恢复最新的整个数据库备份：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>我打开数据库，然后关闭数据库。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">立即关闭</pre></div>
                     </li>
                     <li class="stepexpand"><span>如果可能，请更正介质问题，以便可以将备份数据库文件还原到其原始位置。</span></li>
                     <li class="stepexpand"><span>使用操作系统命令还原最新的整个数据库备份。恢复整个数据库备份的所有数据文件和控制文件，而不仅仅是损坏的文件。如果尚未更正硬件问题并且必须将部分或全部数据库文件还原到其他位置，请将整个数据库备份还原到新位置。以下示例将整个数据库备份还原到其默认位置：</span><div><pre class="oac_no_warn" dir="ltr">％cp /backup/*.dbf $ ORACLE_HOME / oradata / trgt /</pre></div>
                     </li>
                     <li class="stepexpand"><span>如有必要，编辑已还原的初始化参数文件以指示控制文件的新位置。例如：</span><div><pre class="oac_no_warn" dir="ltr">CONTROL_FILES =“/ new_disk / oddata / trgt / control01.dbf”</pre></div>
                     </li>
                     <li class="stepexpand"><span>使用已还原和已编辑的参数文件启动实例并装入但不打开数据库。例如：</span><div><pre class="oac_no_warn" dir="ltr">启动安装</pre></div>
                     </li>
                     <li class="stepexpand"><span>如果还原的数据文件名不同（例如，在同一节点或不同节点上还原到其他文件系统或目录时），则更新控制文件以反映新的数据文件位置。例如，要重命名数据文件<code class="codeph">1</code>您可以输入：</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE RENAME FILE'？/oradata/trgt/system01.dbf'TO'/new_disk/oradata/system01.dbf';</pre></div>
                     </li>
                     <li class="stepexpand"><span>如果联机重做日志位于损坏的磁盘上，并且硬件问题未得到纠正，请为每个受影响的联机日志指定新位置。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE RENAME FILE'？/oradata/trgt/redo01.log'TO'/new_disk/oradata/redo_01.log'; ALTER DATABASE RENAME FILE'？/oradata/trgt/redo02.log'TO'/new_disk/oradata/redo_02.log';</pre></div>
                     </li>
                     <li class="stepexpand"><span>由于永远不会备份联机重做日志，因此无法使用数据文件和控制文件对其进行还原。要使数据库能够重置联机重做日志，必须先模仿不完全恢复：</span><div><pre class="oac_no_warn" dir="ltr">恢复数据库直到取消取消</pre></div>
                     </li>
                     <li class="stepexpand"><span><a id="d140508e4864" class="indexterm-anchor"></a><a id="d140508e4868" class="indexterm-anchor"></a>在<code class="codeph">RESETLOGS</code>模式下打开数据库。此命令清除联机重做日志并将日志序列重置为1：</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN RESETLOGS;</pre><p>如果还原<code class="codeph">NOARCHIVELOG</code>数据库备份然后重置日志，则该操作会放弃从执行备份到失败时对数据库所做的所有更改。
                           </p>
                        </div>
                     </li>
                  </ol>
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-3A4C59D7-C91D-4A4E-A803-5C02FE58858A__GUID-31400F96-8322-4DE8-B416-BD6CE14D8CFE">
                        <p class="notep1">也可以看看：</p>
                        <p>有关重命名和重定位数据文件的详细信息，请<a href="../sqlrf/ALTER-DATABASE.html#SQLRF00802" target="_blank"><span class="italic">参见</span></a> <a href="../admin/managing-data-files-and-temp-files.html#ADMIN012" target="_blank"><span class="italic">“Oracle数据库管理员指南”</span></a> ，以及有关<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">RENAME</code> <code class="codeph">FILE</code> <a href="../sqlrf/ALTER-DATABASE.html#SQLRF00802" target="_blank"><span class="italic">Oracle数据库SQL语言参考</span></a></p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="BRADV90036"></a><div class="props_rev_3"><a id="GUID-36D3AEB2-CAB5-491D-8AAC-7E08ABC842A6" name="GUID-36D3AEB2-CAB5-491D-8AAC-7E08ABC842A6"></a><h3 id="BRADV-GUID-36D3AEB2-CAB5-491D-8AAC-7E08ABC842A6" class="sect3"><span class="enumeration_section">30.6</span>故障排除介质恢复</h3>
               <div>
                  <p>本节介绍如何解决用户管理的介质恢复问题，即不使用Recovery Manager（RMAN）执行的介质恢复。本节包括以下主题：<a id="d140508e4981" class="indexterm-anchor"></a><a id="d140508e4985" class="indexterm-anchor"></a></p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="user-managed-flashback-dbpitr.html#GUID-739E7EDD-3142-41C0-AC4B-80E7F000D39B">关于用户管理的媒体恢复问题</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-flashback-dbpitr.html#GUID-5A3274A9-D725-46D6-A0CC-2560D6AA6102">调查媒体恢复问题：第1阶段</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-flashback-dbpitr.html#GUID-54CE55B1-BAC2-4D35-877C-9C07CAAAAF41">尝试在不破坏块的情况下修复恢复问题：阶段2</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-flashback-dbpitr.html#GUID-0017FED3-FCC3-47D3-97A3-A0DF7C8C6F7A">决定是否允许恢复标记为损坏块：阶段3</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-flashback-dbpitr.html#GUID-89B0F402-06E7-4030-A4E8-A9E16E7592EE">允许恢复到损坏的块：阶段4</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-flashback-dbpitr.html#GUID-DB9A54B9-F404-4D8A-894C-D17A1DF8A684">执行试用恢复</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV505"></a><a id="BRADV241"></a><div class="props_rev_3"><a id="GUID-739E7EDD-3142-41C0-AC4B-80E7F000D39B" name="GUID-739E7EDD-3142-41C0-AC4B-80E7F000D39B"></a><h4 id="BRADV-GUID-739E7EDD-3142-41C0-AC4B-80E7F000D39B" class="sect4"><span class="enumeration_section">30.6.1</span>关于用户管理的介质恢复问题</h4>
                  <div>
                     <p><a id="d140508e5092" class="indexterm-anchor"></a><a id="d140508e5096" class="indexterm-anchor"></a><a id="d140508e5100" class="indexterm-anchor"></a><a id="d140508e5104" class="indexterm-anchor"></a> <a href="user-managed-flashback-dbpitr.html#GUID-739E7EDD-3142-41C0-AC4B-80E7F000D39B__CIHBAIGH" title="此表描述了介质恢复中可能遇到的问题。">表30-4</a>说明了介质恢复期间可能出现的潜在问题。
                     </p>
                     <div class="tblformalwide" id="GUID-739E7EDD-3142-41C0-AC4B-80E7F000D39B__CIHBAIGH">
                        <p class="titleintable">表30-4介质恢复问题</p>
                        <table cellpadding="4" cellspacing="0" class="FormalWide" title="媒体恢复问题" width="100%" border="1" summary="This table describes possible problems encountered in media recovery." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="29%" id="d140508e5123">问题</th>
                                 <th align="left" valign="bottom" width="71%" id="d140508e5126">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d140508e5131" headers="d140508e5123 ">
                                    <p>缺少或错误命名的归档日志</p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d140508e5131 d140508e5126 ">
                                    <p>恢复停止，因为数据库无法找到控制文件中记录的存档日志。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d140508e5138" headers="d140508e5123 ">
                                    <p>当您尝试打开数据库时，错误<code class="codeph">ORA-1113</code>表示数据文件需要介质恢复。
                                    </p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d140508e5138 d140508e5126 ">
                                    <p>出现此错误的原因通常是：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p>您正在执行不完整的恢复，但无法恢复所有需要的数据文件备份。</p>
                                       </li>
                                       <li>
                                          <p>在数据文件达到一致的SCN之前，不完整的恢复已停止。</p>
                                       </li>
                                       <li>
                                          <p>您正在从联机备份恢复数据文件，但没有应用足够的重做来使数据文件保持一致。</p>
                                       </li>
                                       <li>
                                          <p>您正在使用备份控制文件执行恢复，并且未指定所需的联机重做日志的位置。</p>
                                       </li>
                                       <li>
                                          <p>尝试打开数据库时，数据文件正在进行介质恢复。</p>
                                       </li>
                                       <li>
                                          <p>在执行<code class="codeph">RECOVER</code> <code class="codeph">DATABASE</code>命令之前，需要恢复的数据文件未联机，因此未恢复。
                                          </p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d140508e5173" headers="d140508e5123 ">
                                    <p><a id="d140508e5175" class="indexterm-anchor"></a>重做记录问题</p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d140508e5173 d140508e5126 ">
                                    <p>两种可能的情况如下：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p>由于一致性检查失败，恢复停止，这是一个问题<a id="d140508e5187" class="indexterm-anchor"></a><a id="d140508e5191" class="indexterm-anchor"></a> <strong class="term">陷入困境</strong> 。当基础操作系统或存储系统在正常操作期间丢失由数据库发出的写入时，可能发生滞留恢复。
                                          </p>
                                       </li>
                                       <li>
                                          <p>应用重做时，数据库发出内部错误信号。此问题可能是由Oracle数据库错误引起的。如果未使用<a href="glossary.html#GUID-36837841-FB21-45C7-A99A-FFC35D04FB0B"><span class="xrefglossterm">校验和</span></a>验证，则错误也可能由重做或数据块的损坏引起。
                                          </p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d140508e5204" headers="d140508e5123 ">
                                    <p><a id="d140508e5206" class="indexterm-anchor"></a>存档日志损坏</p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d140508e5204 d140508e5126 ">
                                    <p>在存储系统上存储或复制日志时，日志可能已损坏。如果启用了<code class="codeph">DB_BLOCK_CHECKSUM</code> ，则数据库通常会发出校验和错误信号。如果禁用了校验和检查，则日志损坏可能会显示为重做问题。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d140508e5218" headers="d140508e5123 ">
                                    <p><a id="d140508e5220" class="indexterm-anchor"></a><a id="d140508e5224" class="indexterm-anchor"></a><a id="d140508e5228" class="indexterm-anchor"></a>具有不兼容的并行重做格式的存档日志</p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d140508e5218 d140508e5126 ">
                                    <p>如果启用并行重做功能，则数据库将以新格式生成重做日志。Oracle的早期版本无法应用并行重做日志。但是，Oracle9 <span class="italic">i</span> Database Release 2（9.2）之前的版本可以检测并行重做格式并指示与以下错误消息不一致： <code class="codeph">External</code> <code class="codeph">error</code> <code class="codeph">00303,</code> <code class="codeph">00000,</code> <code class="codeph">"cannot</code> <code class="codeph">process</code> <code class="codeph">Parallel</code> <code class="codeph">Redo"</code> 。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d140508e5265" headers="d140508e5123 ">
                                    <p><a id="d140508e5267" class="indexterm-anchor"></a><a id="d140508e5269" class="indexterm-anchor"></a>数据块损坏</p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d140508e5265 d140508e5126 ">
                                    <p>数据文件备份可能包含损坏的数据块，或者数据块在恢复期间或复制到备份时可能会损坏。如果启用了<code class="codeph">DB_BLOCK_CHECKSUM</code> ，则数据库会在正常操作期间为每个块计算校验和，并在将其写入磁盘之前将其存储在块中。当数据库稍后从磁盘读取块时，它会重新计算校验和并将其与存储的值进行比较。如果它们不匹配，则数据库发出校验和错误信号。如果禁用校验和检查，则问题也可能显示为重做损坏。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d140508e5279" headers="d140508e5123 ">
                                    <p>随机问题</p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d140508e5279 d140508e5126 ">
                                    <p>恢复期间可能会发生内存损坏和其他瞬态问题。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p><a id="d140508e5286" class="indexterm-anchor"></a><a id="d140508e5290" class="indexterm-anchor"></a><a id="d140508e5294" class="indexterm-anchor"></a>介质恢复问题的症状通常是在恢复期间发出的外部或内部错误。例如，外部错误表示重做块或数据块的校验和验证检查失败。内部错误可能是由数据库中的错误或底层操作系统和硬件引起的错误引起的。
                     </p>
                     <p>如果介质恢复在恢复数据库备份时遇到问题，那么无论是恢复问题还是重做应用程序中的问题，数据库始终会停止并使数据文件在一致状态下进行恢复，即在一致的SCN在失败之前。然后，您可以执行以下操作之一：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>以只读方式打开数据库以调查问题。</p>
                        </li>
                        <li>
                           <p>如果满足打开<code class="codeph">RESETLOGS</code>的要求，请使用<code class="codeph">RESETLOGS</code>选项打开数据库。<code class="codeph">RESETLOGS</code>限制也适用于打开<a href="glossary.html#GUID-009B3F56-8C1E-4CF6-AF0F-A9D2C2E4B9C2"><span class="xrefglossterm">物理备用数据库</span></a> ，因为备用数据库是通过介质恢复的形式更新的。
                           </p>
                        </li>
                     </ul>
                     <p>通常，以只读方式打开数据库或使用<code class="codeph">RESETLOGS</code>选项打开数据库需要将所有在线数据文件恢复到同一SCN。如果不满足此要求，则数据库可能会在您尝试打开<code class="codeph">ORA-1113</code>或其他错误时发出信号。<a href="user-managed-flashback-dbpitr.html#GUID-739E7EDD-3142-41C0-AC4B-80E7F000D39B__CIHBAIGH" title="此表描述了介质恢复中可能遇到的问题。">表30-4</a>中描述了<code class="codeph">ORA-1113</code>一些常见原因。
                     </p>
                     <p><a id="d140508e5338" class="indexterm-anchor"></a>响应媒体恢复问题的基本方法发生在以下阶段：</p>
                     <ol>
                        <li>
                           <p>尝试找出问题的原因。如果需要，请运行试用版恢复。</p>
                        </li>
                        <li>
                           <p>如果问题与丢失的重做日志有关，或者如果您怀疑存在重做日志，内存或数据块损坏，请尝试使用<a href="user-managed-flashback-dbpitr.html#GUID-54CE55B1-BAC2-4D35-877C-9C07CAAAAF41__g1007463" title="此表描述了介质恢复问题的原因，以及每个问题的原因和响应。">表30-5中</a>所述的方法解决问题。
                           </p>
                        </li>
                        <li>
                           <p>如果使用<a href="user-managed-flashback-dbpitr.html#GUID-54CE55B1-BAC2-4D35-877C-9C07CAAAAF41__g1007463" title="此表描述了介质恢复问题的原因，以及每个问题的原因和响应。">表30-5中</a>描述的方法无法解决问题，请执行以下操作之一：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>如果要恢复整个数据库备份，请使用<code class="codeph">RESETLOGS</code>选项打开数据库。如果您已执行串行介质恢复，则数据库包含所有更改，但不包括发生损坏的SCN上的更改。此SCN以后的任何更改都不在数据库的恢复部分中。如果您已恢复在线备份，那么仅当您通过所有<code class="codeph">ALTER</code>恢复时才打开<code class="codeph">RESETLOGS</code>成功<code class="codeph">...</code> 重做流中的<code class="codeph">END</code> <code class="codeph">BACKUP</code>操作。
                                 </p>
                              </li>
                              <li>
                                 <p>通过允许媒体恢复损坏来继续恢复<a id="d140508e5389" class="indexterm-anchor"></a>数据块。介质恢复完成后，尝试使用RMAN执行<a href="glossary.html#GUID-923A509A-1C36-4EA4-91C8-6E4F372722C0"><span class="xrefglossterm">块介质恢复</span></a> 。</p>
                              </li>
                              <li>
                                 <p>将Oracle支持服务称为最后的手段。</p>
                                 <div class="infoboxnotealso" id="GUID-739E7EDD-3142-41C0-AC4B-80E7F000D39B__GUID-55B81938-5EC4-41AE-8894-D09273B5ED10">
                                    <p class="notep1">也可以看看：</p>
                                    <p><span class="q">“ <a href="rman-recovery-advanced.html#GUID-195E30B2-6077-446D-A255-089D3341268A" title="灾难恢复包括在丢失整个目标数据库，恢复目录数据库，所有当前控制文件，所有联机重做日志文件和所有参数文件后恢复和恢复目标数据库。">执行灾难恢复</a> ”</span>到<span class="italic"> </span>了解块媒体恢复</p>
                                 </div>
                              </li>
                           </ul>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV242"></a><div class="props_rev_3"><a id="GUID-5A3274A9-D725-46D6-A0CC-2560D6AA6102" name="GUID-5A3274A9-D725-46D6-A0CC-2560D6AA6102"></a><h4 id="BRADV-GUID-5A3274A9-D725-46D6-A0CC-2560D6AA6102" class="sect4"><span class="enumeration_section">30.6.2</span>调查媒体恢复问题：第1阶段</h4>
                  <div>
                     <div class="section">
                        <p><a id="d140508e5484" class="indexterm-anchor"></a><a id="d140508e5490" class="indexterm-anchor"></a>如果介质恢复遇到问题，则在恢复暂停后获取尽可能多的信息。你不想浪费时间来解决错误的问题，这可能会使事情变得更糟。
                        </p>
                        <p>此初步调查的目的是确定问题是由不正确的设置，损坏的重做日志，损坏的数据块，内存损坏还是其他问题引起的。如果在数据块上看到<a href="glossary.html#GUID-36837841-FB21-45C7-A99A-FFC35D04FB0B"><span class="xrefglossterm">校验和</span></a>错误，则数据块已损坏。如果在重做日志块上看到校验和错误，则重做日志已损坏。
                        </p>
                        <p>有时可能难以确定恢复问题的原因。但是，即使您不完全了解问题的原因，本节中的方法也可以使您快速恢复数据库。</p>
                        <p>要调查媒体恢复问题：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li><span>检查<code class="codeph">alert.log</code>以查看错误消息是否提供有关问题性质的一般信息。例如， <code class="codeph">alert_</code> <span class="italic"><code class="codeph">SID</code></span> <code class="codeph">.log</code>指示任何校验和失败？<code class="codeph">alert_</code> <span class="italic"><code class="codeph">SID</code></span> <code class="codeph">.log</code>是否表明介质恢复可能必须损坏数据块才能继续？</span></li>
                        <li><span>在恢复期间检查Oracle数据库生成的跟踪文件。它可能包含其他错误信息。</span></li>
                     </ol>
                  </div>
               </div><a id="BRADV506"></a><a id="BRADV24383"></a><div class="props_rev_3"><a id="GUID-54CE55B1-BAC2-4D35-877C-9C07CAAAAF41" name="GUID-54CE55B1-BAC2-4D35-877C-9C07CAAAAF41"></a><h4 id="BRADV-GUID-54CE55B1-BAC2-4D35-877C-9C07CAAAAF41" class="sect4"><span class="enumeration_section">30.6.3</span>尝试在不破坏块的情况下修复恢复问题：阶段2</h4>
                  <div>
                     <div class="section">
                        <p><a id="d140508e5605" class="indexterm-anchor"></a><a id="d140508e5611" class="indexterm-anchor"></a>根据您怀疑的介质恢复问题的类型，您可以使用不同的解决方案。您可以尝试<a href="user-managed-flashback-dbpitr.html#GUID-54CE55B1-BAC2-4D35-877C-9C07CAAAAF41__g1007463" title="此表描述了介质恢复问题的原因，以及每个问题的原因和响应。">表30-5中</a>描述的技术中的一种或组合。这些解决方案是常见的修复技术，对解决大多数介质恢复问题非常安全。
                        </p>
                        <div class="tblformalwide" id="GUID-54CE55B1-BAC2-4D35-877C-9C07CAAAAF41__g1007463">
                           <p class="titleintable">表30-5介质恢复解决方案</p>
                           <table cellpadding="4" cellspacing="0" class="FormalWide" title="媒体恢复解决方案" width="100%" border="1" summary="This table describes causes for a media recovery problem, and causes for and responses to each." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="29%" id="d140508e5631">如果你怀疑......</th>
                                    <th align="left" valign="bottom" width="71%" id="d140508e5634">然后...</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d140508e5639" headers="d140508e5631 ">
                                       <p>缺少或错误命名的归档重做日志</p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d140508e5639 d140508e5634 ">
                                       <p>确定您是否输入了正确的文件名。如果您这样做，请检查操作系统中是否缺少日志。如果丢失，并且您有备份，则还原备份并应用日志。如果您没有备份，则尽可能执行不完整的恢复，直到缺少日志为止。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d140508e5646" headers="d140508e5631 ">
                                       <p><code class="codeph">ORA-1113</code>用于<code class="codeph">ALTER DATABASE OPEN</code></p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d140508e5646 d140508e5634 ">
                                       <p>请查看<a href="user-managed-flashback-dbpitr.html#GUID-739E7EDD-3142-41C0-AC4B-80E7F000D39B__CIHBAIGH" title="此表描述了介质恢复中可能遇到的问题。">表30-4</a>中此错误的原因。确保所有需要恢复的读/写数据文件都在线。
                                       </p>
                                       <p>如果使用备份控制文件进行恢复，则控制文件和数据文件必须处于一致的SCN才能打开数据库。如果没有必要的重做，则必须重新创建控制文件。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d140508e5664" headers="d140508e5631 ">
                                       <p>损坏的存档日志</p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d140508e5664 d140508e5634 ">
                                       <p>如果日志重做块上的校验和验证失败，则日志已损坏。如果在恢复会话期间或数据库生成重做时未启用<code class="codeph">DB_BLOCK_CHECKSUM</code> ，则可能由损坏的日志导致恢复问题。如果日志损坏并且损坏日志的备用副本可用，则尝试应用它并查看此策略是否解决了问题。
                                       </p>
                                       <p><code class="codeph">DB_BLOCK_CHECKSUM</code>初始化参数确定是否为重做日志和数据块计算校验和。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d140508e5679" headers="d140508e5631 ">
                                       <p>具有不兼容的并行重做格式的存档日志</p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d140508e5679 d140508e5634 ">
                                       <p>如果在Oracle9 <span class="italic">i</span> Database Release 2之前运行Oracle数据库版本，并且尝试应用使用并行重做格式创建的重做日志，则必须执行以下步骤：</p>
                                       <ol>
                                          <li>
                                             <p>将数据库升级到更高版本。</p>
                                          </li>
                                          <li>
                                             <p>执行媒体恢复。</p>
                                          </li>
                                          <li>
                                             <p>一致地关闭数据库并备份数据库。</p>
                                          </li>
                                          <li>
                                             <p>将数据库降级到原始版本。</p>
                                          </li>
                                       </ol>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d140508e5702" headers="d140508e5631 ">
                                       <p>内存损坏或暂时性问题</p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d140508e5702 d140508e5634 ">
                                       <p>您可以通过关闭数据库并重新启动恢复来解决问题。如果第二次尝试也失败，则数据库应保持一致状态。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d140508e5709" headers="d140508e5631 ">
                                       <p>损坏的数据块</p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d140508e5709 d140508e5634 ">
                                       <p>使用用户管理的方法再次恢复和恢复数据文件，或使用RMAN <code class="codeph">RECOVER ...恢复和恢复单个数据块<code class="codeph">RECOVER ...BLOCK</code>命令。这种技术可以解决问题。
                                       </p>
                                       <p>如果块上的校验和验证失败，则数据块已损坏。如果禁用<code class="codeph">DB_BLOCK_CHECKING</code> ，则损坏的数据块问题可能会显示为重做问题。如果必须继续进行介质恢复，则可能需要允许介质恢复将块标记为已损坏，继续恢复，然后使用RMAN稍后执行块介质恢复。
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>如果您无法使用<a href="user-managed-flashback-dbpitr.html#GUID-54CE55B1-BAC2-4D35-877C-9C07CAAAAF41__g1007463" title="此表描述了介质恢复问题的原因，以及每个问题的原因和响应。">表30-5中</a>描述的方法解决问题，则可能没有简单的方法来解决问题而不会丢失数据。你有这些选择：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>使用<code class="codeph">RESETLOGS</code>选项打开数据库（用于整个数据库恢复）。
                              </p>
                              <p>此解决方案在重做问题发生之后丢弃所有更改，但保证逻辑上一致的数据库。</p>
                           </li>
                           <li>
                              <p>允许介质恢复损坏一个或多个数据块，然后继续。</p>
                              <p>如果警报日志指示如果允许恢复数据块可以继续恢复，则此选项仅成功，这是大多数恢复问题的情况。如果必须快速启动数据库并恢复所有更改，则此选项最佳。如果您正在考虑此选项，请继续执行<span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-0017FED3-FCC3-47D3-97A3-A0DF7C8C6F7A">决定是否允许恢复标记为损坏的块：阶段3</a> ”</span> 。
                              </p>
                              <div class="infoboxnotealso" id="GUID-54CE55B1-BAC2-4D35-877C-9C07CAAAAF41__GUID-DC32CB10-2A48-46F2-9B7D-092DE14D4D6B">
                                 <p class="notep1">也可以看看：</p>
                                 <p><span class="q">“ <a href="rman-block-media-recovery.html#GUID-1E226393-17D0-4AB0-A05D-91210255D8FF" title="阻止介质恢复恢复通过恢复损坏的数据块提供较低的平均恢复时间（MTTR）。使用块介质恢复来恢复数据文件中的一个或多个损坏的数据块。通常，数据库将块标记为介质损坏，然后在首次遇到损坏时将其写入磁盘。在块恢复之前，块的后续读取不会成功。您只能对标记为损坏或未通过损坏检查的块执行块恢复。阻止恢复行为取决于是在主数据库还是物理备用数据库上发现数据块损坏。V $ DATABASE_BLOCK_CORRUPTION视图显示由数据库组件（如RMAN，ANALYZE和SQL查询）标记为已损坏的块。阻止介质恢复仅需要对要恢复的块进行不间断的重做更改。这与数据文件恢复不同，它需要从恢复开始到结束时不间断的一系列重做更改。在使用RECOVER执行块介质恢复之前，必须满足某些先决条件...BLOCK命令。使用RECOVER ......BLOCK命令用于恢复数据文件中的各个损坏块。您确定需要恢复的块，然后使用任何可用的备份来还原和恢复这些块。您可以使用Data Recovery Advisor诊断和修复数据块损坏导致的故障。在此示例中，VALIDATE DATABASE命令时发现了损坏的数据块。RMAN可以自动恢复V $ DATABASE_BLOCK_CORRUPTION视图中列出的所有块。">执行块介质恢复</a> ”</span>以了解如何使用<code class="codeph">RECOVER ...执行块介质恢复<code class="codeph">RECOVER ...BLOCK</code>命令</p>
                              </div>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV507"></a><a id="BRADV99984"></a><div class="props_rev_3"><a id="GUID-0017FED3-FCC3-47D3-97A3-A0DF7C8C6F7A" name="GUID-0017FED3-FCC3-47D3-97A3-A0DF7C8C6F7A"></a><h4 id="BRADV-GUID-0017FED3-FCC3-47D3-97A3-A0DF7C8C6F7A" class="sect4"><span class="enumeration_section">30.6.4</span>决定是否允许恢复标记为损坏块：阶段3</h4>
                  <div>
                     <div class="section">
                        <p><a id="d140508e5855" class="indexterm-anchor"></a><a id="d140508e5861" class="indexterm-anchor"></a>当介质恢复遇到问题时，如果允许标记为损坏导致问题的数据块，则警报日志可能指示恢复可以继续。警报日志包含有关块的信息：块类型，块地址，它所属的表空间等等。对于包含用户数据的块，警报日志还可以报告数据对象编号。
                        </p>
                        <p>在这种情况下，如果允许将问题块标记为已损坏，则数据库可以继续进行恢复。然而，这种反应并不总是可取的。例如，如果块是<code class="codeph">SYSTEM</code>表空间中的重要块，则将块标记为已损坏最终会阻止您打开已恢复的数据库。另一个考虑因素是恢复问题是否孤立。如果重做流中的许多其他问题立即出现此问题，则可能需要使用<code class="codeph">RESETLOGS</code>选项打开数据库。
                        </p>
                        <p>对于包含用户数据的块，通常可以查询数据库以发现哪个对象或表拥有此块。如果数据库未打开，则即使要恢复整个数据库备份，也可以以只读方式打开数据库。以下示例取消恢复并以只读方式打开数据库：</p><pre class="oac_no_warn" dir="ltr">CANCEL ALTER DATABASE OPEN READ ONLY;</pre><p>假设<code class="codeph">alert_</code> <span class="italic"><code class="codeph">SID</code></span> <code class="codeph">.log</code>报告的数据对象编号是<code class="codeph">8031</code> 。您可以通过发出以下查询来确定所有者，对象名称和对象类型：</p><pre class="oac_no_warn" dir="ltr">SELECT OWNER，OBJECT_NAME，SUBOBJECT_NAME，OBJECT_TYPE FROM DBA_OBJECTS WHERE DATA_OBJECT_ID = 8031;</pre><p>要确定是否隔离了恢复问题，可以运行诊断<strong class="term">试用恢复</strong> ，它会扫描重做流以查找问题，但实际上并未对恢复的数据库进行任何更改。如果试用版恢复发现任何恢复问题，则会在<code class="codeph">alert_</code> <span class="italic"><code class="codeph">SID</code></span> <code class="codeph">.log</code>报告它们。你可以使用<code class="codeph">RECOVER</code> <code class="codeph">...</code> 用于调用试用恢复的<code class="codeph">TEST</code>语句，如<span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-6338386C-B03A-4124-8F4E-8949F14A3FFD">执行RECOVER ... ”中<a href="user-managed-flashback-dbpitr.html#GUID-6338386C-B03A-4124-8F4E-8949F14A3FFD">所述测试声明</a> “</span> 。
                        </p>
                        <p>完成这些调查后，您可以按照<a href="user-managed-flashback-dbpitr.html#GUID-0017FED3-FCC3-47D3-97A3-A0DF7C8C6F7A__g1007496" title="此表提供允许介质恢复以允许损坏的准则。">表30-6中</a>的指导决定是否允许恢复以允许损坏的块。
                        </p>
                        <div class="tblformal" id="GUID-0017FED3-FCC3-47D3-97A3-A0DF7C8C6F7A__g1007496">
                           <p class="titleintable">表30-6允许恢复允许损坏块的指导原则</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="允许恢复允许损坏块的指南" width="100%" border="1" summary="This table provides guidelines for allowing media recovery to permit corruption." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="20%" id="d140508e5941">如果问题是......</th>
                                    <th align="left" valign="bottom" width="20%" id="d140508e5944">和块是......</th>
                                    <th align="left" valign="bottom" width="60%" id="d140508e5947">然后...</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d140508e5952" headers="d140508e5941 ">
                                       <p>没有孤立</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d140508e5952 d140508e5944 "> </td>
                                    <td align="left" valign="top" width="60%" headers="d140508e5952 d140508e5947 ">
                                       <p>您可以使用<code class="codeph">RESETLOGS</code>选项打开数据库。此响应对于卡住恢复问题很重要，因为操作系统或存储系统丢失写入可能导致卡住恢复。如果操作系统或存储系统突然发生故障，则可能导致多个块出现卡住恢复问题。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d140508e5963" headers="d140508e5941 ">
                                       <p>隔离的</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d140508e5963 d140508e5944 ">
                                       <p>在<code class="codeph">SYSTEM</code>表空间中</p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d140508e5963 d140508e5947 ">
                                       <p>不要破坏块，因为它可能最终阻止您打开数据库。但是，有时<code class="codeph">SYSTEM</code>表空间中的数据并不重要。如果必须损坏<code class="codeph">SYSTEM</code>块并恢复所有更改，请联系Oracle支持服务。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d140508e5982" headers="d140508e5941 ">
                                       <p>隔离的</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d140508e5982 d140508e5944 ">
                                       <p>索引数据</p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d140508e5982 d140508e5947 ">
                                       <p>考虑破坏索引块，因为索引可以在数据库恢复后重建。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d140508e5992" headers="d140508e5941 ">
                                       <p>隔离的</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d140508e5992 d140508e5944 ">
                                       <p>用户数据</p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d140508e5992 d140508e5947 ">
                                       <p>根据数据的重要性来决定。如果继续数据文件恢复并损坏块，则会丢失块中的数据。但是，您可以在数据文件恢复完成后使用RMAN稍后执行块介质恢复。如果打开<code class="codeph">RESETLOGS</code> ，则数据库是一致的，但在恢复停止点之后会丢失所做的任何更改。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d140508e6005" headers="d140508e5941 ">
                                       <p>隔离的</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d140508e6005 d140508e5944 ">
                                       <p>回滚或撤消数据</p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d140508e6005 d140508e5947 ">
                                       <p>如果提交了所有事务，则考虑破坏回滚或撤消块。如果生成撤消的事务永远不会回滚，则数据库不会受到损害。但是，如果回滚这些事务，则破坏撤消块可能会导致问题。如果您不确定，请联系Oracle支持服务。</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <div class="infoboxnotealso" id="GUID-0017FED3-FCC3-47D3-97A3-A0DF7C8C6F7A__GUID-4414DFB9-5286-4D96-98B1-759F19764112">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-DB9A54B9-F404-4D8A-894C-D17A1DF8A684">执行试用恢复</a> ”</span>以了解如何执行试用恢复，以及<span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-89B0F402-06E7-4030-A4E8-A9E16E7592EE">允许恢复到损坏的块：第4阶段</a> ”，</span>如果您决定允许恢复允许损坏的块</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV244"></a><div class="props_rev_3"><a id="GUID-89B0F402-06E7-4030-A4E8-A9E16E7592EE" name="GUID-89B0F402-06E7-4030-A4E8-A9E16E7592EE"></a><h4 id="BRADV-GUID-89B0F402-06E7-4030-A4E8-A9E16E7592EE" class="sect4"><span class="enumeration_section">30.6.5</span>允许恢复到损坏的块：阶段4</h4>
                  <div>
                     <div class="section">
                        <p><a id="d140508e6098" class="indexterm-anchor"></a>如果您决定允许恢复在块损坏的情况下继续进行，则使用<code class="codeph">ALLOW</code> <span class="italic"><code class="codeph">n</code></span> <code class="codeph">CORRUPTION</code>子句运行<code class="codeph">RECOVER</code>命令，其中<span class="italic"><code class="codeph">n</code></span>是允许的损坏块数。
                        </p>
                        <p><span class="bold">允许恢复到损坏的块：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>确保满足所有正常恢复前提条件。例如，如果数据库已打开，则在尝试恢复之前使表空间脱机。</span></li>
                        <li class="stepexpand"><span>运行<code class="codeph">RECOVER</code>命令，如以下示例所示：</span><div><pre class="oac_no_warn" dir="ltr">恢复数据库允许5次腐败</pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV245"></a><div class="props_rev_3"><a id="GUID-DB9A54B9-F404-4D8A-894C-D17A1DF8A684" name="GUID-DB9A54B9-F404-4D8A-894C-D17A1DF8A684"></a><h4 id="BRADV-GUID-DB9A54B9-F404-4D8A-894C-D17A1DF8A684" class="sect4"><span class="enumeration_section">30.6.6</span>执行试用恢复</h4>
                  <div>
                     <p><a id="d140508e6206" class="indexterm-anchor"></a><a id="d140508e6210" class="indexterm-anchor"></a><a id="d140508e6214" class="indexterm-anchor"></a><a id="d140508e6218" class="indexterm-anchor"></a><a id="d140508e6220" class="indexterm-anchor"></a>当发生卡住恢复等问题时，您将面临困难的选择。如果块相对不重要，并且如果问题被隔离，那么最好破坏块。但是如果问题没有被隔离，那么使用<code class="codeph">RESETLOGS</code>选项打开数据库可能会更好。
                     </p>
                     <p>由于这种情况，Oracle数据库支持<a href="glossary.html#GUID-20FF4FE0-3ABD-4773-A857-6CF062C7D028"><span class="xrefglossterm">试用恢复</span></a> 。试用恢复以类似于正常介质恢复的方式应用重做，但它从不将其更改写入磁盘，并且它始终回滚其更改。试用恢复仅在内存中进行。
                     </p>
                     <div class="p">本节包含以下主题：<ul style="list-style-type:disc">
                           <li>
                              <p><a href="user-managed-flashback-dbpitr.html#GUID-5880EC19-0967-47FD-96BA-CBEAB83CAA69">试用恢复如何工作</a></p>
                           </li>
                        </ul>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="user-managed-flashback-dbpitr.html#GUID-6338386C-B03A-4124-8F4E-8949F14A3FFD">执行RECOVER ...测试声明</a></p>
                           </li>
                        </ul>
                     </div>
                     <div class="infoboxnotealso" id="GUID-DB9A54B9-F404-4D8A-894C-D17A1DF8A684__GUID-223767C7-B14F-4458-8B88-8707171E1B85">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-89B0F402-06E7-4030-A4E8-A9E16E7592EE">允许恢复到损坏的块：第4阶段</a> ”</span></p>
                     </div>
                  </div><a id="BRADV90037"></a><div class="props_rev_3"><a id="GUID-5880EC19-0967-47FD-96BA-CBEAB83CAA69" name="GUID-5880EC19-0967-47FD-96BA-CBEAB83CAA69"></a><h5 id="BRADV-GUID-5880EC19-0967-47FD-96BA-CBEAB83CAA69" class="sect5"><span class="enumeration_section">30.6.6.1</span>试用恢复的工作<span class="enumeration_section">原理</span></h5>
                     <div>
                        <p><a id="d140508e6327" class="indexterm-anchor"></a><a id="d140508e6331" class="indexterm-anchor"></a><a id="d140508e6333" class="indexterm-anchor"></a>默认情况下，如果试用版恢复遇到卡住恢复或类似问题，则当此操作允许恢复继续时，它始终将数据块标记为内存中已损坏。数据库将试用恢复期间生成的错误写入警报文件。这些错误明确标记为测试运行错误。
                        </p>
                        <p>与正常的介质恢复一样，试用恢复可以提示您存档的日志文件名，并要求您应用它们。试用恢复结束时：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>数据库用尽内存中允许试用恢复使用的最大缓冲区数</p>
                           </li>
                           <li>
                              <p>发出不可恢复的错误信号，即通过破坏数据块无法解决的错误</p>
                           </li>
                           <li>
                              <p>您取消或中断恢复会话</p>
                           </li>
                           <li>
                              <p>重做流中的下一个重做记录会更改控制文件</p>
                           </li>
                           <li>
                              <p>所有请求的重做都已应用</p>
                           </li>
                        </ul>
                        <p>当试验恢复结束时，数据库将从系统中删除测试运行的所有影响 - 除了警报文件中的可能错误消息。如果在试用恢复期间实例失败，则数据库会从系统中删除试用恢复的所有影响，因为试用恢复从不将更改写入磁盘。</p>
                        <p>通过试用恢复，您可以预见如果要继续正常恢复，可能会出现哪些问题。对于由持续内存损坏引起的问题，试用恢复和正常恢复可能会遇到不同的错误。</p>
                     </div>
                  </div><a id="BRADV90038"></a><div class="props_rev_3"><a id="GUID-6338386C-B03A-4124-8F4E-8949F14A3FFD" name="GUID-6338386C-B03A-4124-8F4E-8949F14A3FFD"></a><h5 id="BRADV-GUID-6338386C-B03A-4124-8F4E-8949F14A3FFD" class="sect5"><span class="enumeration_section">30.6.6.2</span>执行RECOVER ...测试声明</h5>
                     <div>
                        <div class="section">
                           <p>您可以对任何<code class="codeph">RECOVER</code>命令使用<code class="codeph">TEST</code>选项。例如，您可以启动SQL * Plus，然后发出以下任何命令：</p><pre class="oac_no_warn" dir="ltr">使用备份控制文件恢复数据库测试恢复数据库直到取消测试恢复TABLESPACE用户测试恢复数据库直到取消测试</pre><p>默认情况下，如果此操作允许继续进行试用恢复，则试用恢复始终会尝试破坏内存中的块。默认情况下，试用恢复可能会破坏无限数量的数据块。您可以在<code class="codeph">RECOVER</code>上指定<code class="codeph">ALLOW</code> <span class="italic"><code class="codeph">n</code></span> <code class="codeph">CORRUPTION</code>子句<code class="codeph">...</code> <code class="codeph">TEST</code>语句用于限制试用恢复可能在内存中损坏的数据块数。
                           </p>
                           <p>试用恢复命令可用于可使用正常恢复命令的任何场景。但是，只有在恢复遇到问题时才需要运行试用恢复。</p>
                           <div class="infoboxnotealso" id="GUID-6338386C-B03A-4124-8F4E-8949F14A3FFD__GUID-CC05D2A4-23C5-4790-B6B7-760798152BB9">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="user-managed-flashback-dbpitr.html#GUID-5880EC19-0967-47FD-96BA-CBEAB83CAA69">试用恢复如何工作</a></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>