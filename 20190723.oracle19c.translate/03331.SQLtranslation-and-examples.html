<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>用于DRDA的Oracle数据库提供程序的SQL转换和示例</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="provider-drda-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-11T01:34:46-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2011, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96456-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="install-and-configure-oracle-database-provider-for-DRDA.html" title="Previous" type="text/html"></link>
      <link rel="next" href="admin-and-customization-of-oracle-database-provider-for-DRDA.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Provider for DRDA User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="DRDAS"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="install-and-configure-oracle-database-provider-for-DRDA.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="admin-and-customization-of-oracle-database-provider-for-DRDA.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">用户指导</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">用于DRDA的Oracle数据库提供程序的SQL转换和示例</li>
            </ol>
            <a id="GUID-E858CFF0-58D0-41DE-9448-7248DBB9984B" name="GUID-E858CFF0-58D0-41DE-9448-7248DBB9984B"></a><a id="DRDAS196"></a>
            
            <h2 id="DRDAS-GUID-E858CFF0-58D0-41DE-9448-7248DBB9984B" class="sect2"><span class="enumeration_chapter">4</span>用于DRDA的Oracle数据库提供程序的SQL转换和示例</h2>
         </header>
         <div class="ind">
            <div>
               <p>SQL Translation是Oracle Database 12 <span class="italic">c</span>第2版（12.2）中的一项新功能。在早期版本的Oracle数据库中，可以在没有SQL Translation的情况下使用Oracle Provider for DRDA。
               </p>
               <p>有关SQL Translation的更多信息，请参阅<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/drdas&amp;id=DRDAA-GUID-5AEDF137-6E67-45D9-90CD-4F6E5B439277" target="_blank"><span class="italic">Oracle®数据库迁移指南</span></a> 。
               </p>
               <div class="infoboxnote" id="GUID-E858CFF0-58D0-41DE-9448-7248DBB9984B__GUID-FA9BC9BF-C619-4172-BF07-A0664428CCCE">
                  <p class="notep1">注意：</p>SQL Translation是一个可选功能，建议在应用程序中使用的SQL更多以DB2为中心的语法中。
               </div>
            </div><a id="DRDAS197"></a><div class="props_rev_3"><a id="GUID-D30391A9-4C40-4EBE-8B8A-BC62C1907EBC" name="GUID-D30391A9-4C40-4EBE-8B8A-BC62C1907EBC"></a><h3 id="DRDAS-GUID-D30391A9-4C40-4EBE-8B8A-BC62C1907EBC" class="sect3">SQL转换过程概述</h3>
               <div>
                  <p>Oracle Database Release 12 <span class="italic">c</span>引入了SQL Translation的概念。此功能允许将“外部”SQL语句（例如DB2）转换为Oracle数据库可以正确使用的SQL语法。SQL Translation本身是通过SQL转换器实现的，该转换器通常由翻译的第三方提供。SQL Translator检查输入SQL，有时会将其更改为遵循Oracle SQL语法。通过SQL转换程序接口程序包指定的SQL转换配置文件指定使用的SQL转换程序。
                  </p>
                  <p>SQL Translation Profile是<code class="codeph">SQL TRANSLATION PROFILE</code>类型的模式级对象。它通过<code class="codeph">ATTR_TRANSLATOR</code>属性引用PL / SQL包;这个包称为SQL转换器接口包。该程序包指定在SQL转换配置文件处于活动状态时执行SQL转换的第三方SQL转换程序。一次只能启用一个SQL转换配置文件。
                  </p>
                  <p>SQL翻译配置文件可以在用户之间共享。通常，所有用户共享一组包的相同单个SQL翻译配置文件，但这不是必需的。</p>
                  <p>请注意，每个DB2包可以通过为该包保留的属性与SQL Translation配置文件相关联。在为DB2包准备SQL语句时，将使用与为DB2包指定的SQL转换配置文件关联的SQL转换程序。</p>
               </div>
               <div class="props_rev_3"><a id="GUID-1F818B0F-A8E7-4F97-9858-3C84EAA2260F" name="GUID-1F818B0F-A8E7-4F97-9858-3C84EAA2260F"></a><h4 id="DRDAS-GUID-1F818B0F-A8E7-4F97-9858-3C84EAA2260F" class="sect4">实现SQL转换</h4>
                  <div>
                     <div class="section">
                        <p>要进行翻译，必须执行以下事件序列：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>获得SQL转换器。</span></li>
                        <li class="stepexpand"><span>创建引用该转换程序的SQL接口包。</span></li>
                        <li class="stepexpand"><span>创建引用SQL接口包的SQL转换配置文件。</span><div>
                              <p>该步骤可以在实例的生命周期中仅执行一次。但是，必须至少执行一次才能使用SQL Translation。</p>
                              <p>在具有多个翻译器的情况下，或者需要不同的SQL翻译配置文件的情况下，可以重复该过程。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>DB2包与SQL转换配置文件的关联。</span><div>
                              <p>必须为创建的每个包完成此步骤。</p>
                              <p>请注意，在与转换配置文件关联之前，不必创建包;只需要包的名称。此步骤不会验证特定包是否已存在。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>在执行时，用户通过包将SQL文本传递给Oracle数据库提供程序以获取DRDA。</span></li>
                        <li class="stepexpand"><span>当Oracle数据库提供程序用于DRDA获取SQL文本时，它会检查该程序包是否与SQL转换配置文件关联，然后将该SQL转换配置文件设置为在解析和执行SQL文本期间生效。</span></li>
                        <li class="stepexpand"><span>在Oracle数据库提供程序for DRDA准备SQL文本以供执行之后，Oracle数据库使用当前的SQL转换配置文件来转换SQL语句，然后执行它们。</span></li>
                     </ol>
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-38D99123-4EAD-482F-BEC4-5B90FB01FA0F" name="GUID-38D99123-4EAD-482F-BEC4-5B90FB01FA0F"></a><h4 id="DRDAS-GUID-38D99123-4EAD-482F-BEC4-5B90FB01FA0F" class="sect4">SQL转换的要求</h4>
                  <div>
                     <div class="section">
                        <p>成功的SQL转换只能在以下情况下发生：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>必须通过以下命令为会话启用SQL转换配置文件：</p><pre class="oac_no_warn" dir="ltr">ALTER SESSION SET SQL_TRANSLATION_PROFILE</pre></li>
                           <li>
                              <p>该进程必须指定传入的SQL语句使用外部语法，或者使用非Oracle SQL方言。在这里讨论的所有情况中，这些方言都是DB2 SQL的变体。</p>
                           </li>
                        </ul>
                        <p>对于DRDA产品的Oracle数据库提供程序，前两个条件是耦合的;如果DB2包与SQL转换配置文件相关联，那么SQL语句应该是外部语法，并且调用与SQL转换配置文件关联的SQL转换器来转换该包中的任何SQL。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="DRDAS199"></a><div class="props_rev_3"><a id="GUID-E7419395-B4C1-4844-9630-EC66DB24A2BE" name="GUID-E7419395-B4C1-4844-9630-EC66DB24A2BE"></a><h3 id="DRDAS-GUID-E7419395-B4C1-4844-9630-EC66DB24A2BE" class="sect3">翻译特定于DB2的SQL语法的细节</h3>
               <div>
                  <p>虽然可以直接执行客户端应用程序提交给Oracle数据库提供程序以获取DRDA的大多数SQL构造，但Oracle无法识别某些DB2 SQL构造。考虑在转换由重新配置为使用Oracle数据库实例的应用程序发出的DB2 SQL语句时发生的已知问题。</p>
                  <p>如果存在SQL转换配置文件，则可以将与该配置文件关联的SQL转换程序设计为更改这些SQL语句，以便应用程序在Oracle SQL中执行等效或类似操作，并返回预期结果。</p>
               </div><a id="DRDAS200"></a><div class="props_rev_3"><a id="GUID-BE4C34EC-9EA4-4D46-9A9E-F0A100B732AC" name="GUID-BE4C34EC-9EA4-4D46-9A9E-F0A100B732AC"></a><h4 id="DRDAS-GUID-BE4C34EC-9EA4-4D46-9A9E-F0A100B732AC" class="sect4">DB2特殊注册表</h4>
                  <div>
                     <p>Oracle数据库不支持<code class="codeph">CURRENT TIME</code>特殊寄存器构造，以获取当前时间。调用此构造，如下例所示，会导致<code class="codeph">ORA-00936</code>错误。
                     </p><pre class="oac_no_warn" dir="ltr">从SYSIBM.SYSDUMMY1中选择当前时间</pre></div>
               </div><a id="DRDAS201"></a><div class="props_rev_3"><a id="GUID-6B6F8B15-4CED-421F-A91A-CDC3DA11C2CA" name="GUID-6B6F8B15-4CED-421F-A91A-CDC3DA11C2CA"></a><h4 id="DRDAS-GUID-6B6F8B15-4CED-421F-A91A-CDC3DA11C2CA" class="sect4">DB2 SQL函数和过程</h4>
                  <div>
                     <p>Oracle不支持DB2中定义的某些函数。例如，Oracle中不存在<code class="codeph">CEILING</code>功能;相反，Oracle SQL语法包括兼容的<code class="codeph">CEIL</code>函数。
                     </p>
                  </div>
               </div><a id="DRDAS202"></a><div class="props_rev_3"><a id="GUID-E31E675B-1B47-4D4B-AFCC-854EFF6B8562" name="GUID-E31E675B-1B47-4D4B-AFCC-854EFF6B8562"></a><h4 id="DRDAS-GUID-E31E675B-1B47-4D4B-AFCC-854EFF6B8562" class="sect4">DB2命名数据类型</h4>
                  <div>
                     <p>Oracle中未定义某些基本SQL数据类型，例如<code class="codeph">BIGINT</code> 。当应用程序针对Oracle运行时，将列值或常量转换为<code class="codeph">BIGINT</code>会产生错误。以下示例导致<code class="codeph">ORA-00902</code>错误，因为<code class="codeph">BIGINT</code>未被识别为有效的Oracle数据类型。
                     </p><pre class="oac_no_warn" dir="ltr">从SYSIBM.SYSDUMMY1中选择CAST（12345678912 AS BIGINT）</pre></div>
               </div><a id="DRDAS203"></a><div class="props_rev_3"><a id="GUID-C06946A7-F80C-4977-A74B-0FFFF25F7A15" name="GUID-C06946A7-F80C-4977-A74B-0FFFF25F7A15"></a><h4 id="DRDAS-GUID-C06946A7-F80C-4977-A74B-0FFFF25F7A15" class="sect4">DB2语法语句</h4>
                  <div>
                     <div class="section">
                        <p>DB2中的<code class="codeph">INSERT</code>语句可能包含Oracle不解释的语法子句。这样的示例是<span class="italic">隔离</span>子句，如以下代码示例所示。
                        </p><pre class="oac_no_warn" dir="ltr">用CHG插入SCOTT.DEPT VALUES（50，“FARMING”，“SPRINGFIELD”）</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="DRDAS204"></a><div class="props_rev_3"><a id="GUID-0DAC0955-7716-4C13-9ECC-C797C12EB99E" name="GUID-0DAC0955-7716-4C13-9ECC-C797C12EB99E"></a><h3 id="DRDAS-GUID-0DAC0955-7716-4C13-9ECC-C797C12EB99E" class="sect3">SQL转换器接口包</h3>
               <div>
                  <p>SQL转换配置文件是通过<code class="codeph">DBMS_SQL_TRANSLATOR.CREATE_PROFILE()</code>过程创建的<code class="codeph">SQL TRANSLATION PROFILE</code>类型的模式级对象。SQL转换器接口包是某种格式的PL / SQL包;它引用第三方提供的转换器对象，并且本身由SQL转换配置文件引用。因此，SQL Translator Interface Package连接SQL Translation Profile和第三方提供的SQL转换器对象。
                  </p>
               </div><a id="DRDAS205"></a><div class="props_rev_3"><a id="GUID-1DF1BB66-B646-4787-9764-CEF30117EE6A" name="GUID-1DF1BB66-B646-4787-9764-CEF30117EE6A"></a><h4 id="DRDAS-GUID-1DF1BB66-B646-4787-9764-CEF30117EE6A" class="sect4">关于SQL转换器接口包</h4>
                  <div>
                     <p>SQL转换配置文件引用具有固定格式的PL / SQL包装程序包，即<span class="italic"><span class="bold">SQL转换程序接口程序包</span></span> 。当会话设置<code class="codeph">SQL TRANSLATION PROFILE</code> ，它指定所有SQL都由与SQL转换器接口包关联的第三方SQL转换器进行转换。SQL Translator Interface Package的过程<code class="codeph">translate_sql()</code>执行转换。
                     </p>
                     <p>注意，Oracle <span class="bold"><span class="bold">不</span></span>提供SQL转换。相反，SQL转换器必须从第三方供应商处获得，或在内部开发。Oracle提供了各种管理脚本，用于创建和管理SQL转换配置文件。
                     </p>
                  </div>
               </div><a id="DRDAS206"></a><div class="props_rev_3"><a id="GUID-E519283E-9BD8-4354-B612-72A07D7A5016" name="GUID-E519283E-9BD8-4354-B612-72A07D7A5016"></a><h4 id="DRDAS-GUID-E519283E-9BD8-4354-B612-72A07D7A5016" class="sect4">创建SQL转换器接口包</h4>
                  <div>
                     <div class="section">
                        <p><a href="SQLtranslation-and-examples.html#GUID-E519283E-9BD8-4354-B612-72A07D7A5016__BABEJIDC">例4-1</a>显示了一个与SQL Translation Profile一起使用的简单SQL转换接口包。语言和名称规范与第三方SQL转换器中的language-type和callable-names相关。使用<code class="codeph">SYSDBA</code>权限登录Oracle数据库后，必须进行以下包声明。包名称是SQL Translation Profile的<code class="codeph">TRANSLATOR_ATTR</code>属性的值。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-E519283E-9BD8-4354-B612-72A07D7A5016__BABEJIDC">
                        <p class="titleinexample">示例4-1创建SQL转换器接口包</p><pre class="oac_no_warn" dir="ltr">创建或替换包SYSIBM.DBTooSQLTranslator作为过程translate_sql（CLOB中的sql_text，以及CLOB中的translated_text）; procedure translate_error（BINARY_INTEGER中的error_code，BINARY_INTEGER的translate_code，VARCHAR2的translated_sqlstate）;结束; /创建或替换包体SYSIBM.DBTooSQLTranslator作为过程translate_sql（在CLOB中的sql_text，translated_text out CLOB）作为语言JAVA名称/ *实际上是与translate_sql * /'DBTooSQLApiInterface关联的第三方可调用* / / *过程的“签名” .translateSQL（oracle.sql。CLOB，oracle.sql。CLOB []）';过程translate_error（BINARY_INTEGER中的error_code，translate_code out BINARY_INTEGER，translated_sqlstate out VARCHAR2）作为语言JAVA名称/ *实际上是与translate_error相关联的第三方可调用* / * *过程的“签名”* /'DBTooSQLApiInterface.translateError（oracle.sql） 。CLOB，oracle.sql。CLOB []）';结束; /</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="DRDAS207"></a><div class="props_rev_3"><a id="GUID-6D192CD7-D2CD-4E1F-921E-F4E63817B3BB" name="GUID-6D192CD7-D2CD-4E1F-921E-F4E63817B3BB"></a><h4 id="DRDAS-GUID-6D192CD7-D2CD-4E1F-921E-F4E63817B3BB" class="sect4">授予对SQL转换器接口包的EXECUTE访问权限</h4>
                  <div>
                     <div class="section">
                        <p>由于SQL Translator Interface Package在运行时被调用，因此必须启用<code class="codeph">EXECUTE</code>访问。<a href="SQLtranslation-and-examples.html#GUID-6D192CD7-D2CD-4E1F-921E-F4E63817B3BB__BABJIBDI">示例4-2</a>显示了如何授予此访问权限。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-6D192CD7-D2CD-4E1F-921E-F4E63817B3BB__BABJIBDI">
                        <p class="titleinexample">示例4-2授予对SQL转换器接口包的EXECUTE访问权限</p><pre class="oac_no_warn" dir="ltr">在SYSIBM.DBTooSQLTranslator上执行GRANT EXECUTE到DRDAAS_USER_ROLE</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="DRDAS208"></a><div class="props_rev_3"><a id="GUID-4C01C929-6734-46DF-A6D5-67874411E86C" name="GUID-4C01C929-6734-46DF-A6D5-67874411E86C"></a><h4 id="DRDAS-GUID-4C01C929-6734-46DF-A6D5-67874411E86C" class="sect4">创建SQL翻译配置文件</h4>
                  <div>
                     <div class="section">
                        <p>可以由具有<code class="codeph">CREATE SQL TRANSLATION PROFILE</code>权限和<code class="codeph">TRANSLATE ANY SQL</code>权限的任何用户创建和管理SQL Translation Profile。关于向具有<code class="codeph">DRDAAS_TRANS_ADMIN</code>角色的用户授予所需权限的部分显示了如何将这两个权限授予<code class="codeph">DRDAAS_TRANS_ADMIN</code> 。具有现有<code class="codeph">SYSDBA</code>权限的用户可以授予这些权限。
                        </p>
                        <p>在<code class="codeph">ADMIN OPTION</code>子句使<code class="codeph">DRDAAS_TRANS_ADMIN</code>到<code class="codeph">GRANT</code>的<code class="codeph">TRANSLATE ANY SQL</code>授权其他Oracle用户。通过这种方式， <code class="codeph">DRDAAS_TRANS_ADMIN</code>可以允许许多具有<code class="codeph">DRDAAS_USER_ROLE</code>用户使用翻译工具，如向使用<code class="codeph">DRDAAS_USER_ROLE</code>用户授予翻译权限一节中<code class="codeph">DRDAAS_USER_ROLE</code> 。</p>
                        <p>可以通过创建和管理SQL转换配置文件中提供的脚本来管理实际的SQL转换配置文件。请注意，管理标识必须已具有执行<code class="codeph">CREATE SQL TRANSLATION PROFILE</code>所需的权限。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="SQLtranslation-and-examples.html#GUID-FDFD7434-6BA9-41F7-B855-E91E62A1B249">通过管理员角色授予翻译权限</a></li>
                           <li><a href="SQLtranslation-and-examples.html#GUID-19E03E1E-CFF8-46F1-994F-AD9CFD934069">通过用户角色授予翻译权限</a></li>
                           <li><a href="SQLtranslation-and-examples.html#GUID-C0F8B954-8884-492A-B910-DD5D17AE9B5C">创建和管理SQL翻译配置文件</a></li>
                        </ul>
                     </div>
                  </div>
                  <a id="DRDAS209"></a><div class="props_rev_3"><a id="GUID-FDFD7434-6BA9-41F7-B855-E91E62A1B249" name="GUID-FDFD7434-6BA9-41F7-B855-E91E62A1B249"></a><h5 id="DRDAS-GUID-FDFD7434-6BA9-41F7-B855-E91E62A1B249" class="sect5">通过管理员角色授予翻译权限</h5>
                     <div>
                        <div class="example" id="GUID-FDFD7434-6BA9-41F7-B855-E91E62A1B249__BABHCIDC">
                           <p class="titleinexample">示例4-3向具有DRDAAS_TRANS_ADMIN角色的用户授予必需的权限</p><pre class="oac_no_warn" dir="ltr">GRANT创建SQL TRANSLATION PROFILE到DRDAAS_TRANS_ADMIN; GRANT使用ADMIN OPTION将任何SQL转换为DRDAAS_TRANS_ADMIN;</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="DRDAS210"></a><div class="props_rev_3"><a id="GUID-19E03E1E-CFF8-46F1-994F-AD9CFD934069" name="GUID-19E03E1E-CFF8-46F1-994F-AD9CFD934069"></a><h5 id="DRDAS-GUID-19E03E1E-CFF8-46F1-994F-AD9CFD934069" class="sect5">通过用户角色授予翻译权限</h5>
                     <div>
                        <div class="example" id="GUID-19E03E1E-CFF8-46F1-994F-AD9CFD934069__BABDHGIE">
                           <p class="titleinexample">示例4-4向具有DRDAAS_USER_ROLE的用户授予翻译权限</p><pre class="oac_no_warn" dir="ltr">GRANT TRANSLATE ANY SQL to DRDAAS_USER_ROLE;</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="DRDAS211"></a><div class="props_rev_3"><a id="GUID-C0F8B954-8884-492A-B910-DD5D17AE9B5C" name="GUID-C0F8B954-8884-492A-B910-DD5D17AE9B5C"></a><h5 id="DRDAS-GUID-C0F8B954-8884-492A-B910-DD5D17AE9B5C" class="sect5">创建和管理SQL翻译配置文件</h5>
                     <div>
                        <div class="example" id="GUID-C0F8B954-8884-492A-B910-DD5D17AE9B5C__BABEFDCF">
                           <p class="titleinexample">示例4-5创建和管理SQL转换配置文件</p><pre class="oac_no_warn" dir="ltr">声明PROFILE_DOES_NOT_EXIST异常;编译指示EXCEPTION_INIT（PROFILE_DOES_NOT_EXIST，-24252）; / * profile_name是此处创建的SQL Translation Profile * / / *的nsme。* / profile_name VARCHAR2（32）：='DRDAAS_TRANS_ADMIN.MY_PROFILE'; / * SYSIBM是找到SQL Translator Interface * / / *包（即SYSIBM.DBTooSQLTranslator）的模式。* / sql_trnsltr_intfc_schema VARCHAR2（32）：='SYSIBM'; / * DBTooTranslator是SQL * / / *转换器接口包的非限定包名* / sql_trnsltr_intfc_pkgnm VARCHAR2（32）：='DBTooSQLTranslator'; sql_trnsltr_intfc_pkg VARCHAR2（128）; grant_cmd VARCHAR2（256）; cursor_id NUMBER;开始sql_trnsltr_intfc_pkg：= sql_trnsltr_intfc_schema || ”。'|| sql_trnsltr_intfc_pkgnm;开始DBMS_SQL_TRANSLATOR.DROP_PROFILE（profile_name）;异常WHEN PROFILE_DOES_NOT_EXIST那么空; / *如果不存在则忽略* / end; / *创建SQL翻译配置文件* / DBMS_SQL_TRANSLATOR.CREATE_PROFILE（profile_name）; / *将由* / / * sql_trnsltr_intfc_pkg表示的SQL转换器接口包与此配置文件关联* / DBMS_SQL_TRANSLATOR.SET_ATTRIBUTE（profile_name，DBMS_SQL_TRANSLATOR.ATTR_TRANSLATOR，sql_trnsltr_intfc_pkg）; / *将此SQL翻译配置文件标记为“已注册”* / DBMS_SQL_TRANSLATOR.SET_ATTRIBUTE（profile_name，DBMS_SQL_TRANSLATOR.ATTR_TRANSLATION_REGISTRATION，DBMS_SQL_TRANSLATOR.ATTR_VALUE_TRUE）; / * SQL转换程序接口程序包的所有者必须具有* / / *对SQL TRANSLATION PROFILE * / grant_cmd的完全权限：='GRANT ALL ON SQL TRANSLATION PROFILE'|| profile_name || 'TO'|| sql_trnsltr_intfc_schema; cursor_id：= DBMS_SQL.OPEN_CURSOR（）; DBMS_SQL.PARSE（cursor_id，grant_cmd，DBMS_SQL.NATIVE）; DBMS_SQL.CLOSE_CURSOR（cursor_id）; / *让所有DRDAAS_USER_ROLE都可以访问SQL Translation配置文件。* / grant_cmd：='在SQL翻译配置文件上使用'|| profile_name || 'to DRDAAS_USER_ROLE'; cursor_id：= DBMS_SQL.OPEN_CURSOR（）; DBMS_SQL.PARSE（cursor_id，grant_cmd，DBMS_SQL.NATIVE）; DBMS_SQL.CLOSE_CURSOR（cursor_id）;结束; /</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div>
            </div><a id="DRDAS212"></a><div class="props_rev_3"><a id="GUID-6CF96387-5D22-40E0-8BCE-DDB90CBB49AF" name="GUID-6CF96387-5D22-40E0-8BCE-DDB90CBB49AF"></a><h3 id="DRDAS-GUID-6CF96387-5D22-40E0-8BCE-DDB90CBB49AF" class="sect3">使用第三方SQL转换程序</h3>
               <div>
                  <div class="section">
                     <p>要使用第三方转换程序，必须将其文件和对象安装在<code class="codeph">$ <span class="codeinlineitalic">ORACLE_HOME</span> /rdbms/drdaas/jlib</code> 。
                     </p>
                     <p>如果遇到困难，请使用<code class="codeph">DBMS_JAVA.SET_OUTPUT()</code>过程将服务器端错误消息重定向到<code class="codeph">DBMS_OUTPUT</code> 。</p>有关在Oracle中使用Java的更多信息，请参阅<span class="italic">Oracle®DatabaseJava Developer's Guide</span> 。
                  </div>
                  <!-- class="section" -->
               </div><a id="DRDAS213"></a><div class="props_rev_3"><a id="GUID-564767E6-0D4D-4B3E-A8DD-BA636ADD5750" name="GUID-564767E6-0D4D-4B3E-A8DD-BA636ADD5750"></a><h4 id="DRDAS-GUID-564767E6-0D4D-4B3E-A8DD-BA636ADD5750" class="sect4">使用第三方SQL转换器，作为单个对象加载</h4>
                  <div>
                     <div class="section">
                        <p>如果第三方SQL转换器是Java，则<a href="SQLtranslation-and-examples.html#GUID-564767E6-0D4D-4B3E-A8DD-BA636ADD5750__BABCJICI">示例4-6</a>可以由<code class="codeph">SYSDBA</code>用户在SQL * Plus环境中<code class="codeph">SYSDBA</code> 。<a href="SQLtranslation-and-examples.html#GUID-564767E6-0D4D-4B3E-A8DD-BA636ADD5750__BABCJICI">示例4-6</a>使用<code class="codeph">DBMS_JAVA.LOADJAVA()</code>过程将对象加载到<code class="codeph">SYSIBM</code>模式中;它加载一个第三方对象<code class="codeph">DBTooSQLAPI.jar</code> 。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-564767E6-0D4D-4B3E-A8DD-BA636ADD5750__BABCJICI">
                        <p class="titleinexample">示例4-6加载第三方SQL转换程序;单个对象</p><pre class="oac_no_warn" dir="ltr">开始DBMS_JAVA.LOADJAVA（' -  definer -genmissing -schema SYSIBM'||''rdbms / drdaas / jlib / DBTooSQLAPI.jar'，'（（* SYSIBM）（* PUBLIC）（*  - ））'）;结束; /</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="DRDAS214"></a><div class="props_rev_3"><a id="GUID-A93B5D9B-1F46-4337-ADAE-6BDA0845F336" name="GUID-A93B5D9B-1F46-4337-ADAE-6BDA0845F336"></a><h4 id="DRDAS-GUID-A93B5D9B-1F46-4337-ADAE-6BDA0845F336" class="sect4">使用第三方SQL转换器，作为多个对象加载</h4>
                  <div>
                     <div class="section">
                        <p>如果第三方转换器由多个对象组成，则必须在<code class="codeph">LOADJAVA</code>调用中指定每个组件。<a href="SQLtranslation-and-examples.html#GUID-A93B5D9B-1F46-4337-ADAE-6BDA0845F336__BABEAFDG">例4-7</a>指定了两个转换器对象， <code class="codeph">DBTooSQLAPI.jar</code>和<code class="codeph">DBTooMainClass.class</code> 。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-A93B5D9B-1F46-4337-ADAE-6BDA0845F336__BABEAFDG">
                        <p class="titleinexample">示例4-7加载第三方SQL转换程序;多个对象</p><pre class="oac_no_warn" dir="ltr">开始DBMS_JAVA.LOADJAVA（' -  definer -genmissing -schema SYSIBM'||'rdbms / drdaas / jlib / DBTooMainClass.class'||'rdbms / drdaas / jlib / DBTooSQLAPI.jar'，'（（* SYSIBM）（* PUBLIC ）（*  - ））'）;结束; /</pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div><a id="DRDAS215"></a><div class="props_rev_3"><a id="GUID-A0B8D4FF-34CD-41F9-B8E7-351557E10146" name="GUID-A0B8D4FF-34CD-41F9-B8E7-351557E10146"></a><h3 id="DRDAS-GUID-A0B8D4FF-34CD-41F9-B8E7-351557E10146" class="sect3">使用翻译管理脚本</h3>
               <div>
                  <div class="section">
                     <p>Oracle数据库附带了<code class="codeph">drdasqtt_translator_setup.sql</code>脚本，该脚本管理翻译配置文件。具有<code class="codeph">SYSDBA</code>权限的用户必须在SQL * Plus中调用该脚本。它要求输入以下内容：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>SQL转换器接口包模式，例如<code class="codeph">SYSIBM</code> 。</span></li>
                     <li class="stepexpand"><span>SQL转换器接口包名称，例如<code class="codeph">DBTooTranslator</code> 。</span></li>
                     <li class="stepexpand"><span>SQL Translation Profile Schema，例如<code class="codeph">DRDAAS_TRANS_ADMIN</code> 。</span></li>
                     <li class="stepexpand"><span>SQL翻译配置文件名称，例如<code class="codeph">MY_PROFILE</code> 。</span></li>
                     <li class="stepexpand"><span>第三方翻译器的语言类型，例如Java。</span></li>
                     <li class="stepexpand"><span>第三方供应商提供的文件或对象的名称。如果提供了多个，请将列表用<span class="italic"><span class="bold">四（4）个</span></span>单引号括起来，并用空格分隔项目，如下面的代码所示：</span><div><pre class="oac_no_warn" dir="ltr">''''rdbms / drdaas / jlib / DBTooMainClass.class rdbms / drdaas / jlib / DBTooSQLAPI.jar''''</pre></div>
                     </li>
                     <li class="stepexpand"><span>第三方供应商提供的用于转换SQL的文件或对象中的条目的签名（条目名称加参数描述）。对于基于Java的第三方代码，可以通过<code class="codeph">javap</code>程序获取签名。请注意，包含空格的签名必须用双引号括起来。</span></li>
                     <li class="stepexpand"><span>第三方供应商提供的用于转换错误代码的文件或对象中的条目的签名（条目名称加参数描述）。对于基于Java的第三方代码，可以通过<code class="codeph">javap</code>程序获取签名。请注意，包含空格的签名必须用双引号括起来。</span></li>
                  </ol>
               </div>
            </div><a id="DRDAS217"></a><a id="DRDAS216"></a><div class="props_rev_3"><a id="GUID-78027DD7-7EFB-4F16-8CA3-AD18E733D965" name="GUID-78027DD7-7EFB-4F16-8CA3-AD18E733D965"></a><h3 id="DRDAS-GUID-78027DD7-7EFB-4F16-8CA3-AD18E733D965" class="sect3">验证SQL转换程序配置文件</h3>
               <div>
                  <div class="section">
                     <p>以下步骤验证SQL转换配置文件是否已正确安装并完全启用。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-78027DD7-7EFB-4F16-8CA3-AD18E733D965__GUID-49CA9D75-055A-4D34-A02F-4A71E5AAC8BD">要验证SQL转换程序配置文件：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>使用SYSDBA权限登录Oracle数据库</span></li>
                     <li class="stepexpand"><span>检查转换程序配置文件是否已加载到Oracle数据库中。</span><div><pre class="oac_no_warn" dir="ltr">SELECT * FROM ALL_SQL_TRANSLATION_PROFILES;</pre></div>
                     </li>
                     <li class="stepexpand"><span>使用具有<code class="codeph">DRDAAS_USER_ROLE</code>权限的ID登录。</span></li>
                     <li class="stepexpand"><span>确保设置角色：</span><div><pre class="oac_no_warn" dir="ltr">SET ROLE DRDAAS_USER_ROLE;</pre></div>
                     </li>
                     <li class="stepexpand"><span>将会话的SQL转换配置文件设置为创建SQL转换配置文件时指定的值。</span><div><pre class="oac_no_warn" dir="ltr">ALTER SESSION SET SQL_TRANSLATION_PROFILE = DRDAAS_TRANS_ADMIN.MY_PROFILE;</pre></div>
                     </li>
                     <li class="stepexpand"><span>尝试以下命令：</span><div><pre class="oac_no_warn" dir="ltr">ALTER SESSION SET EVENTS ='10601永远跟踪名称上下文，等级32';来自DUAL的SELECT CAST（1234567 AS BIGINT）; ALTER SESSION SET EVENTS ='10601 trace name context off';来自DUAL的SELECT CAST（1234567 AS BIGINT）;</pre><p>第一个<code class="codeph">SELECT</code>应该成功，而第二个<code class="codeph">SELECT</code>应该失败。<code class="codeph">ALTER SESSION SET EVENTS</code>命令指定以下SQL是以下SQL之一：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>外来语法（永远跟踪名称上下文，级别32）</p>
                              </li>
                              <li>
                                 <p>本机Oracle语法（跟踪名称上下文关闭）</p>
                              </li>
                           </ul>
                           <p>这仅在使用SQL * Plus时有效。</p>
                        </div>
                     </li>
                  </ol>
               </div>
            </div><a id="DRDAS218"></a><div class="props_rev_3"><a id="GUID-D0F69853-D2FE-452C-8914-FF5332BE7356" name="GUID-D0F69853-D2FE-452C-8914-FF5332BE7356"></a><h3 id="DRDAS-GUID-D0F69853-D2FE-452C-8914-FF5332BE7356" class="sect3">更改SQL转换配置文件</h3>
               <div>
                  <div class="section">
                     <p>有时，有必要完全更改SQL转换配置文件，并使DB2包的<code class="codeph">SQL TRANSLATION PROFILE</code>属性引用新的SQL转换配置文件。
                     </p>
                     <p>DB2包通常以集合形式出现，DB2包的名称由客户端确定。但是，如果客户端使用ODBC访问Oracle数据库提供程序以获取DRDA，则ODBC驱动程序将确定程序包的名称。</p>
                     <p>Oracle提供了两个脚本，可用于为一组包设置SQL Translation Profile属性。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>如果DataDirect ODBC驱动程序访问用于DRDA的Oracle数据库提供程序，请使用<code class="codeph">drdaas/admin</code>目录中的<code class="codeph">drdasqt_set_profile_dd.sql</code>脚本。
                           </p>
                        </li>
                        <li>
                           <p>如果IBM ODBC驱动程序访问用于DRDA的Oracle数据库提供程序，请使用<code class="codeph">drdaas/admin</code>目录中的<code class="codeph">drdasqt_set_profile_ibm.sql</code>脚本。本机客户端应用程序也可以使用此脚本，但可能必须进行扩展。
                           </p>
                        </li>
                     </ul>
                     <p>可以复制和更改这些脚本以与其他DB2包集合一起使用。</p>
                     <p>此外，具有<code class="codeph">DRDAAS_ADMIN_ROLE</code>权限的用户必须在SQL * Plus中运行这些脚本中的每一个。该脚本会提示输入各种包引用的配置文件的限定名称（例如<code class="codeph">DRDAAS_TRANS_ADMIN.MY_PROFILE</code> ）。它还会提示输入默认的Package Collection架构，该架构通常为<code class="codeph">NULLID</code> 。</p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>