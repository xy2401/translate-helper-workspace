<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>执行完整的数据库恢复</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96241-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="validating-database-files-backups.html" title="Previous" type="text/html"></link>
      <link rel="next" href="rman-performing-flashback-dbpitr.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="BRADV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="validating-database-files-backups.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="rman-performing-flashback-dbpitr.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复用户指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-diagnosing-responding-failures.html" property="item" typeof="WebPage"><span property="name">诊断和应对失败</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">执行完整的数据库恢复</li>
            </ol>
            <a id="GUID-D908719C-9D46-4084-850C-0F81C25094EB" name="GUID-D908719C-9D46-4084-850C-0F81C25094EB"></a><a id="BRADV8005"></a>
            
            <h2 id="BRADV-GUID-D908719C-9D46-4084-850C-0F81C25094EB" class="sect2"><span class="enumeration_chapter">17</span>执行完整数据库恢复</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍在丢失一个或多个数据文件后如何使用RMAN将数据库恢复正常操作。本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="rman-complete-database-recovery.html#GUID-606C0F71-87D3-46F8-8295-9340D1A15D2D" title="丢失一个或多个数据库文件后，完全恢复会使数据库恢复正常运行。">完整数据库恢复概述</a></p>
                  </li>
                  <li>
                     <p><a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="您必须根据恢复目标以及丢失的数据库文件来规划数据库还原和恢复策略。">准备完整的数据库恢复</a></p>
                  </li>
                  <li>
                     <p><a href="rman-complete-database-recovery.html#GUID-5E09344A-76D0-4188-A39D-CBA07F0B5C25" title="在完全恢复期间，RMAN将还原一个或多个数据文件，然后应用还原备份后生成的所有重做。">执行完整的数据库恢复</a></p>
                  </li>
                  <li>
                     <p><a href="rman-complete-database-recovery.html#GUID-1F744C63-2D4C-4F65-8773-1340A85993ED" title="RMAN和Oracle Enterprise Manager云控制（云控制）为多租户环境中的备份和恢复提供全面支持。">执行CDB的完全恢复</a></p>
                  </li>
                  <li>
                     <p><a href="rman-complete-database-recovery.html#GUID-B852BD56-E872-4173-9EE9-96D1273B2CCF" title="RMAN使您可以使用RESTORE和RECOVER命令执行应用程序容器的完全恢复，而不会影响CDB中的其他容器。">执行应用程序容器的完全恢复</a></p>
                  </li>
                  <li>
                     <p><a href="rman-complete-database-recovery.html#GUID-D5AFD861-FCA5-4BE6-913F-6C4B6C96A063" title="您可以使用RESTORE和RECOVER命令将稀疏数据库恢复到最近的时间点。">使用RMAN执行稀疏数据库的完全恢复</a></p>
                  </li>
               </ul>
            </div><a id="BRADV89759"></a><div class="props_rev_3"><a id="GUID-606C0F71-87D3-46F8-8295-9340D1A15D2D" name="GUID-606C0F71-87D3-46F8-8295-9340D1A15D2D"></a><h3 id="BRADV-GUID-606C0F71-87D3-46F8-8295-9340D1A15D2D" class="sect3"><span class="enumeration_section">17.1</span>完整数据库恢复概述</h3>
               <div>
                  <p>丢失一个或多个数据库文件后，完全恢复会使数据库恢复正常运行。</p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-C944605B-6B9E-4F39-BEC9-5AD58805B208" title="完全恢复正在将数据库恢复到最近的某个时间点，而不会丢失任何已提交的事务。">完整数据库恢复的目的</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" title="本章中描述的完整恢复操作受特定条件的限制。">本章范围</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-C192C448-0D8A-4366-91AB-BE62ED5B12ED" title="零数据丢失恢复设备（恢复设备）大大减少了连续归档重做日志备份之间存在的潜在数据丢失窗口。您可以在数据库故障的几个亚之内恢复目标数据库。">关于恢复设备的实时重做传输</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89760"></a><div class="props_rev_3"><a id="GUID-C944605B-6B9E-4F39-BEC9-5AD58805B208" name="GUID-C944605B-6B9E-4F39-BEC9-5AD58805B208"></a><h4 id="BRADV-GUID-C944605B-6B9E-4F39-BEC9-5AD58805B208" class="sect4"><span class="enumeration_section">17.1.1</span>完整数据库恢复的目的</h4>
                  <div>
                     <p>完全恢复正在将数据库恢复到最近的某个时间点，而不会丢失任何已提交的事务。</p>
                     <p>本章假定您的部分或全部数据文件丢失或损坏。通常，这种情况是由媒体故障或意外删除引起的。您的目标是通过从RMAN备份还原损坏的文件并恢复所有数据库更改，将数据库恢复到正常运行状态。</p>
                  </div>
               </div><a id="BRADV89761"></a><div class="props_rev_3"><a id="GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" name="GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075"></a><h4 id="BRADV-GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" class="sect4"><span class="enumeration_section">17.1.2</span>本章范围</h4>
                  <div>
                     <p>本章中描述的完整恢复操作受特定条件的限制。</p>
                     <p>本章做出以下假设：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您丢失了部分或全部数据文件，目标是恢复所有更改，但您没有丢失所有当前控制文件或整个联机重做日志组。</p>
                        </li>
                        <li>
                           <p>您的数据库正在使用当前服务器参数文件。</p>
                        </li>
                        <li>
                           <p>您拥有恢复数据文件备份所需的完整归档重做日志和增量备份集。每个数据文件都有一个备份，或者一组完整的在线和归档重做日志会返回到创建没有备份的数据文件。</p>
                           <p>RMAN可以在恢复和恢复期间无需用户干预即可处理丢失的数据文件。当数据文件丢失时，可能的情况可分类如下：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>控制文件知道数据文件，即在创建数据文件后备份控制文件，但不备份数据文件本身。如果数据文件记录在控制文件中，则<code class="codeph">RESTORE</code>会在原始位置或用户指定的位置创建数据文件。然后， <code class="codeph">RECOVER</code>命令可以将必要的日志应用于数据文件。
                                 </p>
                              </li>
                              <li>
                                 <p>控制文件没有数据文件记录，也就是说，在创建数据文件后没有备份控制文件。在恢复期间，数据库会检测丢失的数据文件并将其报告给RMAN，RMAN会创建数据文件并通过应用其余日志继续恢复。如果数据文件是在父版本中创建的，则会在恢复或恢复阶段根据需要创建它。</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>您没有恢复和恢复加密的表空间。</p>
                           <p>如果在加密表空间上执行介质恢复，则在执行此表空间的介质恢复时，必须打开Oracle密钥库。</p>
                        </li>
                        <li>
                           <p>您的数据库在单实例配置中运行。</p>
                           <p>尽管RMAN可以在Oracle RAC和Data Guard配置中还原和恢复数据库，但这些方案超出了本手册的范围。</p>
                        </li>
                        <li>
                           <p>您正在使用RMAN客户端而不是Oracle Enterprise Manager。</p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075__GUID-D9BB73C3-1D7F-401F-BA2D-A01C561EB90E">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="rman-performing-flashback-dbpitr.html#GUID-5463669A-DC89-4FF4-ACCE-136A72DF687B" title="此概述描述了Oracle闪回技术和数据库时间点恢复的目的和基本概念。某些情况适合使用时间点恢复或闪回功能，以便在之前的某个时间点将数据库或数据库对象返回到其状态。数据库时间点恢复（DBPITR）和闪回功能使您可以将数据库恢复到先前的某个时间点。DBPITR在物理级别工作，以在过去的目标时间将数据文件返回到其状态。RMAN为一个或多个PDB的时间点恢复提供支持。要恢复PDB，必须以具有SYSDBA或SYSBACKUP权限的用户身份连接到root。恢复后，PDB的旧备份仍然有效，并且可以在发生介质故障时使用。在大多数可用的情况下，Oracle数据库的闪回功能比介质恢复更有效。您可以使用它们来调查数据库的过去状态。Oracle闪回数据库是DBPITR最有效的替代方法。逻辑闪回功能用于将表及其内容恢复到过去的时间。您可以对整个多租户容器数据库（CDB）或特定可插拔数据库（PDB）执行闪回数据库操作。多租户容器数据库（CDB）可以使用共享撤消或本地撤消。RMAN用于执行闪回数据库操作的技术取决于CDB的撤消配置类型.RMAN提供了管理PDB中数据块的重做损坏的方法。闪回表使用撤消表空间中的信息而不是恢复的备份来检索表。发生闪回表操作时，将删除新行并重新插入旧行。在执行表的闪回时，数据库的其余部分仍然可用。要执行闪回表操作，该表必须有资格闪回，并且执行操作的用户必须具有所需的权限。要在一个或多个表上使用闪回表功能，请使用带有目标时间或SCN的FLASHBACK TABLE SQL语句。默认情况下，数据库在执行FLASHBACK TABLE操作之前禁用受影响表上的触发器。在操作之后，数据库将触发器返回到操作之前的状态（启用或禁用）。您可以使用FLASHBACK TABLE从回收站中检索对象...在DROP声明之前。Flashback Drop可以反转DROP TABLE操作的效果。闪回丢弃比在这种情况下可以使用的其他恢复机制（如时间点恢复）更快，并且不会导致停机或丢失最近的事务。在执行闪回删除操作之前，必须满足先决条件。使用FLASHBACK TABLE ...在DROP语句之前要从回收站中恢复对象。您可以指定回收站中表的名称或原始表名。您可以使用相同的原始名称创建，然后删除多个对象。所有丢弃的对象都存储在回收站中。闪回数据库通过将数据库返回到先前某个时间点的状态来反转不需要的更改。闪回数据库通过撤消对运行命令时存在的数据文件的更改来工作。必须满足先决条件才能执行闪回数据库操作。闪回数据库操作使用FLASHBACK DATABASE命令将数据库回滚到过去的某个时间点。您可以使用FLASHBACK DATABASE命令为整个多租户容器数据库（CDB）执行闪回数据库操作。您可以使用FLASHBACK DATABASE命令对多租户容器数据库（CDB）中的单个可插拔数据库（PDB）执行闪回数据库操作。数据字典视图包含用于监视闪回数据库的信息。RMAN DBPITR在目标恢复时间之前从备份还原数据库，然后使用增量备份和重做将数据库前滚到目标时间。您可以恢复到SCN，时间，日志序列号或还原点。Oracle建议您在重要时间创建还原点，以便在必要时使时间点恢复更易于管理。必须满足某些先决条件才能执行数据库时间点恢复（DBPITR）。使用RESTORE和RECOVER命令执行DBPITR。使用RECOVER命令执行容器数据库（CDB）和可插拔数据库（PDB）的时间点恢复（PITR）。PDB的PITR只能使用RMAN执行。使用RESTORE和RECOVER命令为整个CDB执行时间点恢复。当您将一个或多个PDB恢复到指定的时间点时，剩余的PDB将在国家开发银行不受影响，可以开放和运作。使用RESTORE和RECOVER命令执行应用程序PDB的时间点恢复。执行稀疏数据库的时间点恢复类似于执行正常数据库的时间点恢复。本节介绍基本闪回数据库和DBPITR方案的变体。闪回数据库可用于撤消OPEN RESETLOGS操作。跨OPEN RESETLOGS的闪回数据库可用于在Data Guard环境中执行多个功能。您可以使用闪回数据库将数据库回滚到废弃的数据库化身。要将DPITR执行到非当前数据库化身，必须显式执行RESET DATABASE以将数据库重置为目标SCN上当前的化身。您还必须从包含目标SCN的数据库化身中还原控制文件。">执行闪回和数据库时间点恢复</a> ”</span>以获取有关恢复某些但不是所有数据库更改的信息</p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="rman-recovery-advanced.html#GUID-77C2B092-4BEB-4BAC-91F9-7368EA16A2B6" title="当所有当前控制文件都丢失时，您必须还原备份控制文件。">使用备份控制文件执行恢复</a> ”，</span>以获取有关在所有控制文件丢失时恢复数据库的信息</p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="rman-recovery-advanced.html#GUID-2B93E1AF-5ED1-4FAE-91BB-63362CADF7AD" title="RMAN可以将丢失的服务器参数文件还原到其默认位置或您选择的位置。与丢失控制文件不同，丢失服务器参数文件不会导致实例立即停止。实例可能会继续运行，但您必须将其关闭并在还原服务器参数文件后重新启动它。">还原服务器参数文件</a> ”</span>以获取有关还原备份服务器参数文件的信息</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV771"></a><div class="props_rev_3"><a id="GUID-C192C448-0D8A-4366-91AB-BE62ED5B12ED" name="GUID-C192C448-0D8A-4366-91AB-BE62ED5B12ED"></a><h4 id="BRADV-GUID-C192C448-0D8A-4366-91AB-BE62ED5B12ED" class="sect4"><span class="enumeration_section">17.1.3</span>关于恢复设备的实时重做传输</h4>
                  <div>
                     <p>零数据丢失恢复设备（恢复设备）大大减少了连续归档重做日志备份之间存在的潜在数据丢失窗口。您可以在数据库故障的几个亚之内恢复目标数据库。</p>
                     <p>为目标数据库配置实时重做传输时，当前重做日志组中的重做数据会在生成时异步写入恢复设备。收到重做流后，它将存储为完整的RMAN归档重做日志。如果目标数据库崩溃，则在还原和恢复操作期间使用从当前重做日志组接收的重做数据，直到崩溃时为止。</p>
                     <p>您必须执行某些配置步骤才能为目标数据库启用实时重做传输。</p>
                     <div class="infoboxnote" id="GUID-C192C448-0D8A-4366-91AB-BE62ED5B12ED__GUID-C6B2C8EB-B044-47B1-AF6B-CB809D07198C">
                        <p class="notep1">注意：</p>
                        <p>实时重做传输只能与Recovery Appliance一起使用。</p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-C192C448-0D8A-4366-91AB-BE62ED5B12ED__GUID-A15CCA6C-7FAB-4BA9-8EBE-2C616C0A0D91">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=AMPDB732" target="_blank"><span><cite>零数据丢失恢复设备受保护数据库配置指南</cite></span></a> ，了解配置实时重做传输的步骤</p>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV89762"></a><div class="props_rev_3"><a id="GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" name="GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7"></a><h3 id="BRADV-GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" class="sect3"><span class="enumeration_section">17.2</span>准备完整的数据库恢复</h3>
               <div>
                  <p>您必须根据恢复目标以及丢失的数据库文件来规划数据库还原和恢复策略。</p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-76EF94C5-605E-4BC2-B710-08B990180223" title="用于确定哪些文件需要还原或恢复的技术取决于丢失的文件类型。">识别要还原或恢复的数据库文件</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-34BB2E4B-B2FC-4701-BB65-BFED027DB865" title="建议您记录数据库的DBID。">确定数据库的DBID</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-8837082E-3409-4D00-9836-3B9617720349" title="预览备份可帮助您确保还原和恢复操作所需的所有备份都可用。">预览还原操作中使用的备份</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-ED9C3AA0-41DF-437D-82D3-107B4283C8AE" title="验证备份可确定备份是否可用。">在恢复之前验证备份</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-4C90790F-0BA2-45B8-AB01-323FB6E93469" title="RMAN会根据需要自动从备份还原存档的重做日志文件以执行恢复。">恢复恢复所需的存档重做日志</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-0A087440-D046-4995-9A00-BBA9C5D3750C" title="对于使用某些技术加密的备份，您必须提供用于解密这些备份的密码。">提供解密加密备份所需的密码</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89763"></a><div class="props_rev_3"><a id="GUID-76EF94C5-605E-4BC2-B710-08B990180223" name="GUID-76EF94C5-605E-4BC2-B710-08B990180223"></a><h4 id="BRADV-GUID-76EF94C5-605E-4BC2-B710-08B990180223" class="sect4"><span class="enumeration_section">17.2.1</span>识别要还原或恢复的数据库文件</h4>
                  <div>
                     <p>用于确定哪些文件需要还原或恢复的技术取决于丢失的文件类型。</p>
                     <p>本节包含以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-9B1715D6-500B-4D9A-AE1D-22CB0E4E8DAE" title="当任何多路复用控制文件变得不可访问时，数据库立即关闭。">识别丢失的控制文件</a></p>
                        </li>
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-8AE07B2A-CD72-45C6-9478-28CF459407C8" title="关于何时以及如何恢复的决定取决于数据库的状态和数据文件的位置。">识别需要媒体恢复的数据文件</a></p>
                        </li>
                     </ul>
                  </div><a id="BRADV89764"></a><div class="props_rev_3"><a id="GUID-9B1715D6-500B-4D9A-AE1D-22CB0E4E8DAE" name="GUID-9B1715D6-500B-4D9A-AE1D-22CB0E4E8DAE"></a><h5 id="BRADV-GUID-9B1715D6-500B-4D9A-AE1D-22CB0E4E8DAE" class="sect5"><span class="enumeration_section">17.2.1.1</span>识别丢失的控制文件</h5>
                     <div>
                        <p>当任何多路复用控制文件变得不可访问时，数据库立即关闭。</p>
                        <p>如果尝试在<code class="codeph">CONTROL_FILES</code>初始化参数中指定的每个位置启动数据库时没有有效的控制文件，则数据库将报告错误。
                        </p>
                        <p>丢失控制文件的某些但不是所有副本不需要您从备份还原控制文件。如果至少有一个控制文件保持不变，则可以在损坏或丢失的控制文件上复制控制文件的完整副本，或更新初始化参数文件，使其不引用损坏或丢失的控制文件。在<code class="codeph">CONTROL_FILES</code>参数仅引用控制文件的当前完整副本之后，您可以重新启动数据库。
                        </p>
                        <p>如果从备份还原控制文件，则必须执行整个数据库的介质恢复，然后使用<code class="codeph">OPEN RESETLOGS</code>选项打开它，即使不必还原任何数据文件也是如此。<span class="q">“ <a href="rman-recovery-advanced.html#GUID-77C2B092-4BEB-4BAC-91F9-7368EA16A2B6" title="当所有当前控制文件都丢失时，您必须还原备份控制文件。">使用备份控制文件执行恢复</a> ”中</span>描述了此技术。
                        </p>
                     </div>
                  </div><a id="BRADV89765"></a><div class="props_rev_3"><a id="GUID-8AE07B2A-CD72-45C6-9478-28CF459407C8" name="GUID-8AE07B2A-CD72-45C6-9478-28CF459407C8"></a><h5 id="BRADV-GUID-8AE07B2A-CD72-45C6-9478-28CF459407C8" class="sect5"><span class="enumeration_section">17.2.1.2</span>识别需要进行介质恢复的数据文件</h5>
                     <div>
                        <p>关于何时以及如何恢复的决定取决于数据库的状态和数据文件的位置。</p>
                        <p>使用RMAN或SQL * Plus标识需要介质恢复的数据文件。</p>
                        <div class="infoboxnotealso" id="GUID-8AE07B2A-CD72-45C6-9478-28CF459407C8__GUID-ABD6AD9E-6ABA-4704-BAF8-B19452E2DEAD">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="rman-complete-database-recovery.html#GUID-0E285ED7-6C85-4D6E-A8E0-C969DB305F29" title="确定缺少哪些数据文件的简单方法是运行VALIDATE DATABASE命令。">使用RMAN识别数据文件</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-complete-database-recovery.html#GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC" title="尽管VALIDATE DATABASE是确定文件是否不可访问的好方法，但您可能希望使用SQL查询来获取更详细的信息。">使用SQL识别数据文件</a></p>
                              </li>
                           </ul>
                        </div>
                     </div><a id="BRADV350"></a><a id="BRADV89766"></a><div class="props_rev_3"><a id="GUID-0E285ED7-6C85-4D6E-A8E0-C969DB305F29" name="GUID-0E285ED7-6C85-4D6E-A8E0-C969DB305F29"></a><h6 id="BRADV-GUID-0E285ED7-6C85-4D6E-A8E0-C969DB305F29" class="sect6"><span class="enumeration_section">17.2.1.2.1</span>使用RMAN识别数据文件</h6>
                        <div>
                           <p>确定缺少哪些数据文件的简单方法是运行<code class="codeph">VALIDATE DATABASE</code>命令。
                           </p>
                           <div class="section"></div>
                           <!-- class="section" -->
                           <div class="example" id="GUID-0E285ED7-6C85-4D6E-A8E0-C969DB305F29__CHDICCBB">
                              <p class="titleinexample">例17-1验证数据库</p>
                              <p>此示例验证数据库并尝试读取所有指定的数据文件（包括样本输出）。</p><pre class="oac_no_warn" dir="ltr">RMAN&gt;验证数据库;在20-OCT-13分配通道开始验证：ORA_DISK_1通道ORA_DISK_1：SID = 90设备类型= DISK无法读取数据文件的文件头7错误原因4 RMAN-00571：============= ============================================== RMAN-00569： ===============错误信息堆栈跟踪=============== RMAN-00571：============ =============================================== RMAN-03002 ：10/20/2013 13:05:43备份命令失败RMAN-06056：无法访问数据文件7</pre><div class="p"><code class="codeph">VALIDATE DATABASE</code>命令的输出表明数据文件7不可访问。然后，您可以运行<code class="codeph">REPORT SCHEMA</code>命令以获取数据文件7的表空间名称和文件名，如下所示（包括示例输出）：<pre class="oac_no_warn" dir="ltr">RMAN&gt;报告计划;使用db_unique_name报告数据库模式数据库模式RDBMS永久数据文件列表===========================文件大小（MB）表空间RB segs数据文件名---- -------- -------------------- ------- ----------- ------------- 1 450 SYSTEM *** + DATAFILE / tbs_01.f 2 86 SYSAUX *** + DATAFILE / tbs_ax1.f 3 15 UD1 *** + DATAFILE / tbs_undo1.f 4 2 SYSTEM *** + DATAFILE / tbs_02.f 5 2 TBS_1 *** + DATAFILE / tbs_11.f 6 2 TBS_1 *** + DATAFILE / tbs_12.f 7 2 TBS_2 *** + DATAFILE / tbs_21.f临时列表文件=======================文件大小（MB）表空间Maxsize（MB）Tempfile名称---- --------- ------------------ ----------- -------------------- 1 40 TEMP 32767 + DATAFILE / tbs_tmp1.f</pre></div>
                           </div>
                           <!-- class="example" -->
                        </div>
                     </div><a id="BRADV351"></a><a id="BRADV89767"></a><div class="props_rev_3"><a id="GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC" name="GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC"></a><h6 id="BRADV-GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC" class="sect6"><span class="enumeration_section">17.2.1.2.2</span>使用SQL识别数据文件</h6>
                        <div>
                           <p>尽管<code class="codeph">VALIDATE DATABASE</code>是确定文件是否不可访问的好方法，但您可能希望使用SQL查询来获取更详细的信息。
                           </p>
                           <div class="section">
                              <p class="subhead3" id="GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC__GUID-D41A0CB4-98CF-4A02-8D58-24C2B88E0F96">要确定数据文件是否需要介质恢复：</p>
                           </div>
                           <!-- class="section" -->
                           <ol>
                              <li class="stepexpand"><span>启动SQL * Plus并使用管理员权限连接到目标数据库实例。</span></li>
                              <li class="stepexpand"><span>通过执行以下SQL查询来确定数据库的状态：</span><div><pre class="oac_no_warn" dir="ltr">从V $ INSTANCE中选择状态;</pre><p>如果状态为<code class="codeph">OPEN</code> ，则数据库处于打开状态。然而，一些数据文件可能需要媒体恢复。
                                    </p>
                                 </div>
                              </li>
                              <li class="stepexpand"><span>查询<code class="codeph">V$DATAFILE_HEADER</code>以确定数据文件的状态。运行以下SQL语句以检查数据文件头：</span><div><pre class="oac_no_warn" dir="ltr">SELECT FILE＃，STATUS，ERROR，RECOVER，TABLESPACE_NAME，NAME FROM V $ DATAFILE_HEADER WHERE RECOVER ='YES'或（RECOVER为NULL且ERROR不为NULL）;</pre><p>返回的每一行代表一个数据文件，该文件要么需要介质恢复，要么需要还原。检查<code class="codeph">RECOVER</code>和<code class="codeph">ERROR</code>列。<code class="codeph">RECOVER</code>指示文件是否需要介质恢复， <code class="codeph">ERROR</code>指示是否存在读取错误并验证数据文件头。
                                    </p>
                                    <p>如果<code class="codeph">ERROR</code>不为<code class="codeph">NULL</code> ，则无法读取和验证数据文件头。检查导致错误的临时硬件或操作系统问题。如果没有此类问题，则必须还原文件或切换到副本。
                                    </p>
                                    <p>如果<code class="codeph">ERROR</code> <code class="codeph">RECOVER</code> <code class="codeph">NULL</code>且<code class="codeph">RECOVER</code> <code class="codeph">YES</code> ，则该文件需要介质恢复（并且可能还需要从备份还原）。
                                    </p>
                                    <div class="infoboxnote" id="GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC__GUID-76A234C5-4DA5-4CBF-9775-0567B66BF8AA">
                                       <p class="notep1">注意：</p>
                                       <p>由于<code class="codeph">V$DATAFILE_HEADER</code>仅读取每个数据文件的标头块，因此它不会检测需要还原数据文件的所有问题。例如，此视图无法判断数据文件是否包含损坏的数据块。
                                       </p>
                                    </div>
                                 </div>
                              </li>
                              <li class="stepexpand"><span>（可选）查询<code class="codeph">V$RECOVER_FILE</code>以列出需要按数据文件编号及其状态和错误信息进行恢复的数据文件。例如，执行以下查询：</span><div><pre class="oac_no_warn" dir="ltr">SELECT FILE＃，ERROR，ONLINE_STATUS，CHANGE＃，TIME from V $ RECOVER_FILE;</pre><div class="infoboxnote" id="GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC__GUID-E07311E9-881B-4642-839F-22F56276324B">
                                       <p class="notep1">注意：</p>
                                       <p>您无法将<code class="codeph">V$RECOVER_FILE</code>与从备份还原的控制文件或在介质故障影响数据文件之后重新创建的控制文件一起使用。恢复或重新创建的控制文件不包含准确更新<code class="codeph">V$RECOVER_FILE</code>所需的信息。
                                       </p>
                                    </div>
                                    <p>要查找数据文件和表空间名称，还可以使用数据文件编号和<code class="codeph">V$DATAFILE</code>和<code class="codeph">V$TABLESPACE</code>视图执行连接，如以下示例所示。
                                    </p><pre class="oac_no_warn" dir="ltr">选择r。FILE＃AS df＃，d。名称为df_name，t。名称为tbsp_name，d。状态，r。错误，r。改变＃，r。时间来自V $ RECOVER_FILE r，V $ DATAFILE d，V $ TABLESPACE t WHERE t。TS＃= d。TS＃和d。文件＃= r。文件＃;</pre><p><code class="codeph">ERROR</code>列标识需要恢复的每个文件的问题。
                                    </p>
                                 </div>
                              </li>
                           </ol>
                           <div class="section">
                              <div class="infoboxnotealso" id="GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC__GUID-8EBFAF64-9D59-4CA5-BB26-F971BF659B80">
                                 <p class="notep1">也可以看看：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><a href="../refrn/V-DATAFILE_HEADER.html#REFRN30052" target="_blank"><span><cite>Oracle数据库参考中的</cite></span></a> <code class="codeph">V$DATAFILE_HEADER</code></p>
                                    </li>
                                    <li>
                                       <p><a href="../refrn/V-RECOVER_FILE.html#REFRN30196" target="_blank"><span><cite>Oracle数据库参考中的</cite></span></a> <code class="codeph">V$RECOVER_FILE</code></p>
                                    </li>
                                    <li>
                                       <p><a href="../refrn/V-DATAFILE.html#REFRN30050" target="_blank"><span><cite>Oracle数据库参考中的</cite></span></a> <code class="codeph">V$DATAFILE</code></p>
                                    </li>
                                    <li>
                                       <p><a href="../refrn/V-TABLESPACE.html#REFRN30277" target="_blank"><span><cite>Oracle数据库参考中的</cite></span></a> <code class="codeph">V$TABLESPACE</code></p>
                                    </li>
                                 </ul>
                              </div>
                           </div>
                           <!-- class="section" -->
                        </div>
                     </div>
                  </div>
               </div><a id="BRADV80002"></a><div class="props_rev_3"><a id="GUID-34BB2E4B-B2FC-4701-BB65-BFED027DB865" name="GUID-34BB2E4B-B2FC-4701-BB65-BFED027DB865"></a><h4 id="BRADV-GUID-34BB2E4B-B2FC-4701-BB65-BFED027DB865" class="sect4"><span class="enumeration_section">17.2.2</span>确定数据库的DBID</h4>
                  <div>
                     <p>建议您记录数据库的DBID。</p>
                     <div class="section">
                        <p>在需要从自动备份恢复服务器参数文件或控制文件的情况下，您必须知道DBID。请务必记录DBID以及有关数据库的其他基本信息。</p>
                        <p>如果您没有数据库的DBID记录，则无需打开数据库即可在以下位置找到它：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>DBID用于形成控制文件自动备份的文件名。找到此文件，然后参阅<span class="q">“ <a href="configuring-rman-client-basic.html#GUID-C64AE090-0749-43EA-92C4-69DC6201A15F" title="默认情况下，所有已配置设备的自动备份文件的格式是FORMAT子句中的替换变量％F。">配置控制文件自动备份格式</a> ”</span>以确定DBID在文件名中的显示位置。
                              </p>
                           </li>
                           <li>
                              <p>如果您有任何文本文件保留RMAN会话的输出，则RMAN客户端在启动并连接到您的数据库时会显示DBID。典型输出如下：</p><pre class="oac_no_warn" dir="ltr">％rman TARGET / Recovery Manager：版本12.1.0.1.0  - 生产于1月16日星期三17:51:30 2013版权所有（c）1982,2013，Oracle和/或其附属公司。版权所有。连接到目标数据库：PROD（ <span class="bold">DBID = 36508508</span> ）</pre></li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV352"></a><a id="BRADV8140"></a><div class="props_rev_3"><a id="GUID-8837082E-3409-4D00-9836-3B9617720349" name="GUID-8837082E-3409-4D00-9836-3B9617720349"></a><h4 id="BRADV-GUID-8837082E-3409-4D00-9836-3B9617720349" class="sect4"><span class="enumeration_section">17.2.3</span>预览还原操作中使用的备份</h4>
                  <div>
                     <p>预览备份可帮助您确保还原和恢复操作所需的所有备份都可用。</p>
                     <div class="section">
                        <p>你可以申请<code class="codeph">RESTORE</code> <code class="codeph">...</code> <code class="codeph">PREVIEW</code>到任何<code class="codeph">RESTORE</code>操作，以创建要在所请求的<code class="codeph">RESTORE</code>操作中使用的每个备份的详细列表，以及在<code class="codeph">RESTORE</code>操作完成后用于恢复的必要目标SCN。此命令访问RMAN存储库以查询备份元数据，但实际上并未读取备份文件以确保可以还原它们。
                        </p>
                        <p>作为<code class="codeph">RESTORE ...的替代方案<code class="codeph">RESTORE ...PREVIEW</code> ，您可以使用<code class="codeph">RESTORE ...VALIDATE HEADER</code>命令。除列出恢复和恢复所需的文件外， <code class="codeph">RESTORE ...VALIDATE HEADER</code>命令验证备份文件头以确定磁盘上或介质管理目录中的文件是否与RMAN存储库中的元数据相对应。
                        </p>
                        <p>规划还原和恢复操作时，请使用<code class="codeph">RESTORE ...</code><code class="codeph">PREVIEW</code>或<code class="codeph">RESTORE ...VALIDATE HEADER</code>以确保所有必需的备份都可用，或者确定您可能希望指示RMAN使用或避免特定备份的情况。
                        </p>
                        <p><span class="bold">要预览要在还原操作中使用的备份：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>使用<code class="codeph">PREVIEW</code>选项运行<code class="codeph">RESTORE</code>命令。</span><div>
                              <p>例如，运行以下命令之一：</p><pre class="oac_no_warn" dir="ltr">RESTORE DATABASE PREVIEW;从'SYSDATE-7'预览恢复ARCHIVELOG;</pre><p>如果报告由<code class="codeph">RESTORE</code> <code class="codeph">...</code> <code class="codeph">PREVIEW</code>提供了太多信息，然后指定<code class="codeph">SUMMARY</code>选项，如以下示例所示：</p><pre class="oac_no_warn" dir="ltr">RESTORE DATABASE PREVIEW SUMMARY;</pre><p>如果您对输出感到满意，请在此处停止。如果输出指示RMAN将从您知道暂时不可用的磁带请求备份，则继续此过程。如果输出指示备份存储在异地，则跳至<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-34B3312D-B577-4692-8730-1243CB3EC326" title="异地备份存储在远程位置，例如安全存储设施，除非媒体管理器检索媒体，否则无法恢复。">调用异地备份</a> ”</span> 。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>如果需要，请使用<code class="codeph">CHANGE</code>命令将任何暂时不可用的备份的备份状态设置为<code class="codeph">UNAVAILABLE</code> 。</span><div>
                              <p><span class="q">“ <a href="maintaining-rman-backups.html#GUID-B8ADC6B5-A7F4-4045-9BCE-CC9912F8FCFC" title="运行CHANGE ...无法找到备份或已异地迁移时的UNAVAILABLE命令。">将备份更新为可用状态或不可用状态</a> ”</span>说明了如何执行此任务。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>（可选）运行<code class="codeph">RESTORE</code> <code class="codeph">...</code> 再次<code class="codeph">PREVIEW</code>以确认还原操作不会尝试使用不可用的备份。</span></li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-8837082E-3409-4D00-9836-3B9617720349__GUID-FC6F3739-53AC-4BC6-B932-210CF52BEB27">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../rcmrf/LIST.html#RCMRF132" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a>有关解释<code class="codeph">RESTORE</code>详细信息<code class="codeph">...</code> <code class="codeph">PREVIEW</code>输出，其格式与<code class="codeph">LIST</code>命令的输出格式相同</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div><a id="BRADV354"></a><a id="BRADV353"></a><a id="BRADV89768"></a><div class="props_rev_3"><a id="GUID-34B3312D-B577-4692-8730-1243CB3EC326" name="GUID-34B3312D-B577-4692-8730-1243CB3EC326"></a><h5 id="BRADV-GUID-34B3312D-B577-4692-8730-1243CB3EC326" class="sect5"><span class="enumeration_section">17.2.3.1</span>调用异地备份</h5>
                     <div>
                        <p>异地备份存储在远程位置，例如安全存储设施，除非媒体管理器检索媒体，否则无法恢复。</p>
                        <div class="section">
                           <p>某些媒体管理器向RMAN提供有关哪些备份不在现场的状态信息。即使必须从存储中检索介质，然后才能恢复备份，异地备份在RMAN存储库中标记为<code class="codeph">AVAILABLE</code> 。如果RMAN尝试还原异地备份，则还原作业将失败。
                           </p>
                           <p><span class="bold">要调用异地备份：</span></p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>（可选）使用<code class="codeph">RESTORE ...识别异地备份<code class="codeph">RESTORE ...PREVIEW</code>命令。命令输出指示备份是否存储在异地，如以下示例中的示例输出后的文本所示。</span><div><pre class="oac_no_warn" dir="ltr">备份集列表=================== BS密钥大小设备类型经过时间完成时间------- ----------- ---------- ------------ --------------- 9 2.25M SBT_TAPE 00:00:00 21-MAY- 13 BP密钥：9状态：可用压缩：否标签：TAG20130521T144258句柄：0aii9k7i_1_1媒体：0aii9k7i_1_1备份集中的存档日志列表9 Thrd Seq低SCN低时间下一个SCN下一次---- -------  - --------- --------- ---------- --------- 1 1 392314 21-MAY-13 392541 21-MAY- 13 1 2 392541 21-MAY-13 392545 21-MAY-13 1 3 392545 21-MAY-13 392548 21-MAY-13 1 4 392548 21-MAY-13 395066 21-MAY-13 1 5 395066 21-MAY- 13 395095 21-MAY-13 1 6 395095 21-MAY-13 395355 21-MAY-13远程备份文件列表======================== ====句柄：aii9k7i_1_1媒体：0aii9k7i_1_1验证成功备份片完成恢复于21-MAY-13发布频道：dev1</pre><p>你可以使用<code class="codeph">RESTORE</code> <code class="codeph">...</code> <code class="codeph">PREVIEW</code> <code class="codeph">RECALL</code>以指示媒体管理器提供异地备份。
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>如果备份存储在异地，则执行<code class="codeph">RESTORE ...带<code class="codeph">RECALL</code>选项的PREVIEW</code>命令。</span><div>
                                 <p>以下示例启动对上一步中显示的场外归档日志备份的调用（包括示例输出）：</p><pre class="oac_no_warn" dir="ltr">RESTORE ARCHIVELOG ALL预览召回;</pre><p>以下示例输出表明RMAN发起了召回：</p><pre class="oac_no_warn" dir="ltr">备份集列表=================== BS密钥大小设备类型经过时间完成时间------- ----------- ---------- ------------ --------------- 9 2.25M SBT_TAPE 00:00:00 21-MAY- 13 BP密钥：9状态：可用压缩：否标签：TAG20130521T144258句柄：VAULT0aii9k7i_1_1媒体：/ tmp，VAULT0aii9k7i_1_1备份集中的存档日志列表9 Thrd Seq低SCN低时间下一个SCN下一次---- ----- -  ---------- --------- ---------- --------- 1 1 392314 21-MAY-13 392541 21 -MAY-13 1 2 392541 21-MAY-13 392545 21-MAY-13 1 3 392545 21-MAY-13 392548 21-MAY-13 1 4 392548 21-MAY-13 395066 21-MAY-13 1 5 395066 21 -MAY-13 395095 21-MAY-13 1 6 395095 21-MAY-13 395355 21-MAY-13启动召回以下远程备份文件列表================ ==========================================句柄：VAULT0aii9k7i_1_1媒体：/ tmp， VAULT0aii9k7i_1_1验证成功备份件完成恢复于21-MAY-13发布通道：dev1</pre></div>
                           </li>
                           <li class="stepexpand"><span>运行<code class="codeph">RESTORE</code> <code class="codeph">...</code> <code class="codeph">PREVIEW</code>命令。如有必要，请返回上一步，直到将还原操作所需的备份报告为非现场。</span></li>
                        </ol>
                     </div>
                  </div>
               </div><a id="BRADV90066"></a><div class="props_rev_3"><a id="GUID-ED9C3AA0-41DF-437D-82D3-107B4283C8AE" name="GUID-ED9C3AA0-41DF-437D-82D3-107B4283C8AE"></a><h4 id="BRADV-GUID-ED9C3AA0-41DF-437D-82D3-107B4283C8AE" class="sect4"><span class="enumeration_section">17.2.4</span>在恢复之前验证备份</h4>
                  <div>
                     <p>验证备份可确定备份是否可用。</p>
                     <div class="section">
                        <p>虽然还原预览操作的输出指示将还原哪些备份，但实际上未验证备份的可用性。您可以运行RMAN命令来测试任何<code class="codeph">RESTORE</code>操作的可用备份的可用性，或者测试特定备份的内容以用于<code class="codeph">RESTORE</code>操作。实际读取和检查备份的内容是否有损坏。
                        </p>
                        <p>使用以下验证选项之一：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">RESTORE</code> <code class="codeph">...</code> <code class="codeph">VALIDATE</code>以测试RMAN是否可以从备份还原特定对象。RMAN选择要使用的备份。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">VALIDATE BACKUPSET</code>来测试您指定的备份集的有效性。
                              </p>
                              <div class="infoboxnotealso" id="GUID-ED9C3AA0-41DF-437D-82D3-107B4283C8AE__GUID-6EE59D47-26C6-4ECC-9E0A-E39835670C68">
                                 <p class="notep1">也可以看看：</p>
                                 <p><a href="validating-database-files-backups.html#GUID-CC967929-9610-410D-B881-66E71353D84C" title="验证使您可以检查备份的完整性。RMAN验证的主要目的是检查损坏的块和丢失的文件。您还可以使用RMAN确定是否可以还原备份。数据库可防止导致无法使用的备份文件或损坏的已还原数据文件的操作。损坏的块是一个已更改的块，因此它与Oracle数据库期望找到的块不同。在物理损坏（也称为媒体损坏）中，数据库根本无法识别块：校验和无效，块包含全零，或块的页眉和页脚不匹配。您可以使用SET MAXCORRUPT命令设置RMAN备份文件中允许的未标记损坏总数。默认值为零，这意味着RMAN不会容忍任何类型的未标记的损坏块。Oracle数据库支持用于检测，修复和监视块损坏的不同技术。您可以使用VALIDATE命令手动检查数据库文件中的物理和逻辑损坏。您还可以使用BACKUP VALIDATE命令执行验证。你可以运行RESTORE ...VALIDATE以测试RMAN是否可以从备份还原特定文件或文件集。RMAN选择要使用的备份。RMAN使您可以使用VALIDATE命令验证多租户容器数据库（CDB）和可插拔数据库（PDB）。验证CDB的步骤与用于验证非CDB的步骤类似。有多种方法可以验证PDB。">验证数据库文件和备份</a></p>
                              </div>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89778"></a><div class="props_rev_3"><a id="GUID-4C90790F-0BA2-45B8-AB01-323FB6E93469" name="GUID-4C90790F-0BA2-45B8-AB01-323FB6E93469"></a><h4 id="BRADV-GUID-4C90790F-0BA2-45B8-AB01-323FB6E93469" class="sect4"><span class="enumeration_section">17.2.5</span>恢复恢复所需的存档重做日志</h4>
                  <div>
                     <p>RMAN会根据需要自动从备份还原存档的重做日志文件以执行恢复。</p>
                     <p>您还可以手动还原已归档的重做日志，以便在以后的<code class="codeph">RECOVER</code>命令期间保存还原这些文件所需的时间，或者如果要将已还原的归档重做日志文件存储在某个新位置。RMAN还使您可以灵活地还原所有存档重做日志文件，当前存档重做日志文件，或者从指定的先前版本的数据库中存档重做日志文件。
                     </p>
                     <p>如果在灾难恢复期间丢失归档重做日志，RMAN使您可以使用<code class="codeph">UNTIL AVAILABLE REDO</code>选项自动执行数据库恢复，直到最后一个可用的归档重做日志。只有在对整个数据库执行恢复时，才能使用此选项。不支持对数据文件，表空间或可插拔数据库使用此选项。要为可插拔数据库执行时间点恢复，必须提供SCN编号作为恢复点。
                     </p>
                     <p>默认情况下，RMAN使用<code class="codeph">LOG_ARCHIVE_FORMAT</code>和目标数据库的最高<code class="codeph">LOG_ARCHIVE_DEST_</code> <span class="italic"><code class="codeph">n</code></span>参数来恢复存档的重做日志。这些参数以特定于平台的方式组合，以形成已还原的归档日志的名称。
                     </p>
                     <p>本节包含以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="q">“将<a href="rman-complete-database-recovery.html#GUID-FF8DDFE9-71CC-4A7C-9890-799E20EC963D" title="RMAN使您可以覆盖已还原的归档重做日志文件的默认位置。">存档的重做日志还原到新位置</a> ”</span></p>
                        </li>
                        <li>
                           <p><span class="q">“将<a href="rman-complete-database-recovery.html#GUID-83FE5D57-3F48-45EE-B782-564DF00685E7" title="要管理用于包含已还原日志的磁盘空间，可以在一个RUN块中多次指定已归档日志的还原目标，以在多个目标之间分配已还原的日志。">存档的重做日志还原到多个位置</a> ”</span></p>
                        </li>
                     </ul>
                  </div><a id="BRADV89779"></a><div class="props_rev_3"><a id="GUID-FF8DDFE9-71CC-4A7C-9890-799E20EC963D" name="GUID-FF8DDFE9-71CC-4A7C-9890-799E20EC963D"></a><h5 id="BRADV-GUID-FF8DDFE9-71CC-4A7C-9890-799E20EC963D" class="sect5"><span class="enumeration_section">17.2.5.1将</span>存档的重做日志还原到新位置</h5>
                     <div>
                        <p>RMAN使您可以覆盖已还原的归档重做日志文件的默认位置。</p>
                        <div class="section">
                           <p>在执行数据库还原操作时， <code class="codeph">SET ARCHIVELOG DESTINATION</code>命令会手动将归档日志分段到不同位置。在恢复期间，RMAN知道在哪里可以找到新恢复的归档日志;它不要求它们位于初始化参数文件中指定的位置。
                           </p>
                           <p><span class="bold">要将归档重做日志还原到新位置：</span></p>
                           <ol>
                              <li>
                                 <p>启动RMAN并连接到目标数据库，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”中所述</span> 。
                                 </p>
                              </li>
                              <li>
                                 <p>确保已装入或打开数据库。</p>
                              </li>
                              <li>
                                 <p>在<code class="codeph">RUN</code>命令中执行以下操作：</p>
                                 <ol type="a">
                                    <li>
                                       <p>使用<code class="codeph">SET</code> <code class="codeph">ARCHIVELOG</code> <code class="codeph">DESTINATION</code>为恢复的归档重做日志指定新位置。</p>
                                    </li>
                                    <li>
                                       <p>显式还原存档的重做日志或执行自动还原日志的命令。</p>
                                    </li>
                                 </ol>
                                 <p>以下示例<code class="codeph">RUN</code>命令显式将所有备份存档日志还原到新位置：</p><pre class="oac_no_warn" dir="ltr">RUN {SET ARCHIVELOG DESTINATION TO'/ oracle / temp_restore'; RESTORE ARCHIVELOG ALL; ＃根据需要恢复和恢复数据文件。。。}</pre><p>以下示例设置存档日志目标，然后使用<code class="codeph">RECOVER DATABASE</code>自动从此目标还原存档日志：</p><pre class="oac_no_warn" dir="ltr">RUN {SET ARCHIVELOG DESTINATION TO'/ oracle / temp_restore'; RESTORE DATABASE;恢复数据库; ＃自动恢复和恢复日志}</pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV89780"></a><div class="props_rev_3"><a id="GUID-83FE5D57-3F48-45EE-B782-564DF00685E7" name="GUID-83FE5D57-3F48-45EE-B782-564DF00685E7"></a><h5 id="BRADV-GUID-83FE5D57-3F48-45EE-B782-564DF00685E7" class="sect5"><span class="enumeration_section">17.2.5.2将</span>存档的重做日志还原到多个位置</h5>
                     <div>
                        <p>要管理用于包含已还原日志的磁盘空间，可以在一个<code class="codeph">RUN</code>块中多次指定已归档日志的还原目标，以在多个目标之间分配已还原的日志。
                        </p>
                        <div class="section">
                           <p>请注意，在还原操作期间，您无法同时指定多个目标以生成同一日志的多个副本。</p>
                           <p>以下示例从备份中还原300个归档重做日志，并将它们分布在目录<code class="codeph">/fs1/tmp</code> ， <code class="codeph">/fs2/tmp</code>和<code class="codeph">/fs3/tmp</code> ：</p><pre class="oac_no_warn" dir="ltr">RUN {＃为日志1到100设置新位置。将ARCHIVELOG DESTINATION设置为'/ fs1 / tmp';从序列中恢复存档1直到序列100; ＃设置日志101到200的新位置。将ARCHIVELOG DESTINATION设置为'/ fs2 / tmp';从序列中恢复存档101直到序列200; ＃设置日志201到300的新位置。将ARCHIVELOG DESTINATION设置为'/ fs3 / tmp';从SEQUENCE 201恢复存档，直到序列300; ＃根据需要恢复和恢复数据文件。。。}</pre><p>发出<code class="codeph">RECOVER</code>命令时，RMAN会在还原的目标位置之间自动查找所需的已还原存档日志，并将其应用于数据文件。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="BRADV854"></a><div class="props_rev_3"><a id="GUID-0A087440-D046-4995-9A00-BBA9C5D3750C" name="GUID-0A087440-D046-4995-9A00-BBA9C5D3750C"></a><h4 id="BRADV-GUID-0A087440-D046-4995-9A00-BBA9C5D3750C" class="sect4"><span class="enumeration_section">17.2.6</span>提供解密加密备份所需的密码</h4>
                  <div>
                     <p>对于使用某些技术加密的备份，您必须提供用于解密这些备份的密码。</p>
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>如果密钥库可用，则使用带有自动登录密钥库的透明加密进行加密的备份无需干预即可还原。RMAN在还原其内容时解密这些备份。</p>
                           </li>
                           <li>
                              <p>对于使用透明加密和基于密码的软件密钥库加密的备份，密钥库必须可用，并且必须在执行还原操作之前提供密钥库密码。使用带有<code class="codeph">DECRYPTION WALLET OPEN IDENTIFIED BY</code>选项的<code class="codeph">SET</code>命令指定必须用于打开基于密码的软件密钥库的密码。
                              </p>
                              <p>以下命令设置基于密码的软件密钥库的密钥库密码（其中<code class="codeph"><span class="codeinlineitalic">password</span></code>是您输入的实际密码的占位符）：</p><pre class="oac_no_warn" dir="ltr">SET DECRYPTION WALLET OPEN由<span class="italic">密码</span>识别;</pre></li>
                           <li>
                              <p>使用密码模式加密创建的备份需要输入正确的密码才能还原。使用<code class="codeph">SET DECRYPTION</code>命令指定用于解密备份的密码。如果要从使用不同密码创建的一组备份进行还原，请在<code class="codeph">SET DECRYPTION</code>命令上指定所有必需的密码。RMAN会自动为每个备份集使用正确的密码。必须在执行<code class="codeph">RESTORE</code>和<code class="codeph">RECOVER</code>命令之前使用<code class="codeph">SET</code>命令。
                              </p>
                              <p>以下命令设置用于解密备份的密码（其中<code class="codeph"><span class="codeinlineitalic">password</span></code>是您输入的实际密码的占位符）：</p><pre class="oac_no_warn" dir="ltr">通过<span class="italic">密码</span>识别的SET DECRYPTION;</pre></li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-0A087440-D046-4995-9A00-BBA9C5D3750C__GUID-1B317E10-A18E-4037-B63A-7131DCBAEDFA">
                           <p class="notep1">也可以看看：</p>
                           <p>有关使用加密备份执行还原操作的其他信息，请参阅<a href="../rcmrf/RESTORE.html#RCMRF149" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV8152"></a><div class="props_rev_3"><a id="GUID-5E09344A-76D0-4188-A39D-CBA07F0B5C25" name="GUID-5E09344A-76D0-4188-A39D-CBA07F0B5C25"></a><h3 id="BRADV-GUID-5E09344A-76D0-4188-A39D-CBA07F0B5C25" class="sect3"><span class="enumeration_section">17.3</span>执行完整数据库恢复</h3>
               <div>
                  <p>在完全恢复期间，RMAN将还原一个或多个数据文件，然后应用还原备份后生成的所有重做。</p>
                  <p>本节介绍完整数据库恢复的基本概述，旨在涵盖各种不同的方案。</p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-75DB188C-1E20-49B0-BC34-363B3B5291DA" title="您使用RESTORE和RECOVER命令来还原和恢复数据库。">关于完整数据库恢复</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-C605DF51-5348-46BB-AC18-B928F62991C3" title="此方案假定数据库trgt已丢失其大部分或全部数据文件。它还假定数据库使用快速恢复区域。">执行整个数据库的完全恢复</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-4EBD9D56-9700-45A1-B233-1F5506A04532" title="使用带有TABLESPACE选项的RESTORE和RECOVER命令可以执行表空间的完全恢复">执行表空间的完全恢复</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-19A07A76-AE1E-41EE-8B7D-7C4EF1FD3137" title="您可以通过切换到无法访问的数据文件的映像副本来恢复数据库。这种技术比传统的恢复和恢复花费的时间更少，因为不需要恢复备份。">切换到副本后执行完全恢复</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89771"></a><div class="props_rev_3"><a id="GUID-75DB188C-1E20-49B0-BC34-363B3B5291DA" name="GUID-75DB188C-1E20-49B0-BC34-363B3B5291DA"></a><h4 id="BRADV-GUID-75DB188C-1E20-49B0-BC34-363B3B5291DA" class="sect4"><span class="enumeration_section">17.3.1</span>关于完整数据库恢复</h4>
                  <div>
                     <p>您使用<code class="codeph">RESTORE</code>和<code class="codeph">RECOVER</code>命令来还原和恢复数据库。
                     </p>
                     <p>在恢复期间，RMAN会自动恢复任何所需的归档重做日志的备份。如果备份存储在介质管理器上，则必须事先配置通道，或者必须使用带有<code class="codeph">ALLOCATE CHANNEL</code>命令的<code class="codeph">RUN</code>块来访问存储在那里的备份。
                     </p>
                     <p>如果RMAN在恢复期间将归档重做日志还原到快速恢复区域，则会在将恢复日志应用于数据文件后自动删除这些日志。否则，您可以使用<code class="codeph">DELETE ARCHIVELOG</code>命令从磁盘中删除已恢复的归档重做日志，这些日志不再需要进行恢复。例如，您可以输入以下命令：</p><pre class="oac_no_warn" dir="ltr">RECOVER DATABASE DELETE ARCHIVELOG;</pre></div><a id="BRADV89776"></a><div class="props_rev_3"><a id="GUID-A3DE37A6-3983-4834-858E-A2BCC3804681" name="GUID-A3DE37A6-3983-4834-858E-A2BCC3804681"></a><h5 id="BRADV-GUID-A3DE37A6-3983-4834-858E-A2BCC3804681" class="sect5"><span class="enumeration_section">17.3.1.1</span>关于将数据文件还原到非<span class="enumeration_section">缺省</span>位置</h5>
                     <div>
                        <p>如果无法将数据文件还原到其默认位置，则必须更新控制文件以反映数据文件的新位置。</p>
                        <p>在<code class="codeph">RUN</code>命令中使用RMAN <code class="codeph">SET NEWNAME</code>命令指定新文件名。然后，使用<code class="codeph">SWITCH</code>命令（相当于使用SQL语句<code class="codeph">ALTER DATABASE RENAME FILE</code> ）更新控制文件中数据文件的名称。<code class="codeph">SWITCH DATAFILE ALL</code>更新控制文件以反映在<code class="codeph">RUN</code>命令中已为其发出<code class="codeph">SET NEWNAME</code>所有数据文件的新名称。
                        </p>
                        <div class="infoboxnotealso" id="GUID-A3DE37A6-3983-4834-858E-A2BCC3804681__GUID-BFDFFD89-5205-4FE8-A9EA-B5A958E16DFE">
                           <p class="notep1">也可以看看：</p>
                           <p>适用于<code class="codeph">SWITCH</code>语法的<a href="../rcmrf/SWITCH.html#RCMRF159" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                        </div>
                     </div>
                  </div>
               </div><a id="BRADV355"></a><a id="BRADV89772"></a><div class="props_rev_3"><a id="GUID-C605DF51-5348-46BB-AC18-B928F62991C3" name="GUID-C605DF51-5348-46BB-AC18-B928F62991C3"></a><h4 id="BRADV-GUID-C605DF51-5348-46BB-AC18-B928F62991C3" class="sect4"><span class="enumeration_section">17.3.2</span>执行整个数据库的完全恢复</h4>
                  <div>
                     <p>此方案假定数据库<code class="codeph">trgt</code>已丢失其大部分或全部数据文件。它还假定数据库使用快速恢复区域。
                     </p>
                     <div class="section">
                        <p>恢复和恢复整个数据库后，当数据库打开时，将使用先前的创建大小， <code class="codeph">AUTOEXTEND</code>和<code class="codeph">MAXSIZE</code>属性重新创建记录在控制文件中的缺少的临时表空间。仅重新创建缺少的临时表空间。如果临时文件存在于RMAN存储库中记录但位置无效的位置，则RMAN不会重新创建临时文件。
                        </p>
                        <p>如果临时文件是作为Oracle管理的文件创建的，则会在当前的<code class="codeph">DB_CREATE_FILE_DEST</code>位置重新创建它们。否则，它们将在之前的位置重新创建。如果由于I / O错误或某些其他原因导致RMAN无法重新创建文件，则会在警报日志中报告错误，并且数据库打开操作将继续。
                        </p>
                        <div class="infoboxnotealso" id="GUID-C605DF51-5348-46BB-AC18-B928F62991C3__GUID-2E85197D-B951-4FAF-B3A8-A812FD6FE3FD">
                           <p class="notep1">也可以看看：</p>
                           <p>对于恢复程序中使用的一些假设， <span class="q">“ <a href="rman-complete-database-recovery.html#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" title="本章中描述的完整恢复操作受特定条件的限制。">本章的范围</a> ”</span></p>
                        </div>
                        <p><span class="bold">要还原和恢复整个数据库：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>完成方案所需的准备步骤，如<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="您必须根据恢复目标以及丢失的数据库文件来规划数据库还原和恢复策略。">准备完整数据库恢复</a> ”中所述</span> 。</span></li>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用），如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”中所述</span> 。</span><div>
                              <p>RMAN在连接时显示数据库状态： <code class="codeph">not started</code> ， <code class="codeph">not mounted</code> ， <code class="codeph">not open</code> （数据库已装入但未打开）或无（数据库打开时）。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>如果未装入数据库，则装入但不要打开数据库。</span><div>
                              <p>例如，输入以下命令：</p><pre class="oac_no_warn" dir="ltr">启动安装;</pre></div>
                        </li>
                        <li class="stepexpand"><span>使用<code class="codeph">SHOW</code>命令查看预配置的通道。</span><div>
                              <p>例如，输入以下命令（包括示例输出）：</p><pre class="oac_no_warn" dir="ltr">显示所有; db_unique_name PROD1的数据库的RMAN配置参数是：。。。配置默认设备类型磁盘; #default CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET; #default CONFIGURE DEVICE TYPE SBT_TAPE PARALLELISM 1 BACKUP TYPE TO BACKUPSET; #default CONFIGURE CHANNEL DEVICE TYPE'SBT_TAPE'PARMS“SBT_ LIBRARY = / usr / local / oracle / backup / lib / libobk.so”;</pre><p>如果配置了必要的设备和通道，则无需执行任何操作。否则，您可以使用<code class="codeph">CONFIGURE</code>命令配置自动通道，或在<code class="codeph">RUN</code>块中包含<code class="codeph">ALLOCATE CHANNEL</code>命令。
                              </p>
                              <p></p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>还原并恢复数据库。执行以下操作之一：</span><div>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>如果要将所有数据文件还原到其原始位置，请在RMAN提示符下依次执行<code class="codeph">RESTORE DATABASE</code>和<code class="codeph">RECOVER DATABASE</code> 。
                                    </p>
                                    <p>例如，如果配置了自动通道，则输入以下命令（包括样本输出）：</p><pre class="oac_no_warn" dir="ltr">RMAN&gt; <span class="bold">RESTORE DATABASE;</span>在20-JUN-13分配通道开始恢复：ORA_DISK_1通道ORA_DISK_1：SID = 35设备类型= DISK分配通道：ORA_SBT_TAPE_1通道ORA_SBT_TAPE_1：SID = 34设备类型= SBT_TAPE通道ORA_SBT_TAPE_1：Oracle安全备份通道ORA_DISK_1：启动数据文件备份集恢复通道ORA_DISK_1：指定要从备份集通道ORA_DISK_1恢复的数据文件：将数据文件00001还原到/disk1/oracle/dbs/tbs_01.f通道ORA_DISK_1：将数据文件00002还原到/disk1/oracle/dbs/tbs_ax1.f。。。完成恢复在20-JUN-13</pre><pre class="oac_no_warn" dir="ltr">RMAN&gt; <span class="bold">RECOVER DATABASE;</span>使用通道ORA_DISK_1分配的通道在20-JUN-13开始恢复：ORA_SBT_TAPE_1通道ORA_SBT_TAPE_1：SID = 34设备类型= SBT_TAPE通道ORA_SBT_TAPE_1：Oracle Secure Backup启动介质恢复通道ORA_DISK_1：将归档日志恢复启动到默认目标通道ORA_DISK_1：恢复归档日志archived log thread = 1 sequence = 5 channel ORA_DISK_1：恢复归档日志归档日志thread = 1 sequence = 6。。。通道ORA_DISK_1：读取备份件/ disk1 / oracle / work / orcva / TKRM / backupset / 2013_06_20 / o1_mf_annnn_ TAG20130620T113128_29jhr197_.bkp通道ORA_DISK_1：件句柄= / disk1 / oracle / work / orcva / TKRM / backupset / 2013_06_20 / o1_mf_annnn_ TAG20130620T113128_29jhr197_。 bkp tag = TAG20130620T113128频道ORA_DISK_1：恢复备份1频道ORA_DISK_1：恢复完成，已用时间：00：00：02归档日志文件名= / disk1 / oracle / work / orcva / TKRM / archivelog / 2013_06_ 20 / o1_mf_1_5_29jhv47k_.arc线程= 1序列= 5通道默认值：删除存档日志。。。媒体恢复完成，已用时间：00：00：15在20-JUN-13完成恢复</pre><p>如果手动分配通道，则必须在<code class="codeph">RUN</code>块中一起发出<code class="codeph">RESTORE</code>和<code class="codeph">RECOVER</code>命令，如以下示例所示：</p><pre class="oac_no_warn" dir="ltr">RUN {ALLOCATE CHANNEL c1 DEVICE TYPE sbt; RESTORE DATABASE;恢复数据库; }</pre></li>
                                 <li>
                                    <p>如果要将某些数据文件还原到新位置，请在<code class="codeph">RUN</code>命令中依次执行<code class="codeph">RESTORE DATABASE</code>和<code class="codeph">RECOVER DATABASE</code> 。使用<code class="codeph">SET NEWNAME</code>命令重命名数据文件，如<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-A3DE37A6-3983-4834-858E-A2BCC3804681" title="If you cannot restore data files to their default locations, then you must update the control file to reflect the new locations of the data files.">关于</a></span>将数据文件<span class="q"><a href="rman-complete-database-recovery.html#GUID-A3DE37A6-3983-4834-858E-A2BCC3804681" title="如果无法将数据文件还原到其默认位置，则必须更新控制文件以反映数据文件的新位置。">还原到非默认位置</a> ”中所述</span> 。
                                    </p>
                                    <p>以下示例还原数据库，为三个数据文件指定新名称，然后恢复数据库：</p><pre class="oac_no_warn" dir="ltr">运行{为数据文件设置NEWNAME 2'到'/disk2/df2.dbf';将DATAFILE 3的NEWNAME设置为'/disk2/df3.dbf';将DATAFILE 4的NEWNAME设置为'/disk2/df4.dbf'; RESTORE DATABASE; SWITCH DATAFILE ALL;恢复数据库; }</pre></li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>检查输出以查看介质恢复是否成功。如果是，请打开数据库。</span><div>
                              <p>例如，输入以下命令：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN;</pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV356"></a><a id="BRADV89773"></a><div class="props_rev_3"><a id="GUID-4EBD9D56-9700-45A1-B233-1F5506A04532" name="GUID-4EBD9D56-9700-45A1-B233-1F5506A04532"></a><h4 id="BRADV-GUID-4EBD9D56-9700-45A1-B233-1F5506A04532" class="sect4"><span class="enumeration_section">17.3.3</span>执行表空间的完全恢复</h4>
                  <div>
                     <p>使用带有<code class="codeph">TABLESPACE</code>选项的<code class="codeph">RESTORE</code>和<code class="codeph">RECOVER</code>命令可以执行表空间的完全恢复</p>
                     <div class="p">
                        <p><a href="rman-complete-database-recovery.html#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" title="本章中描述的完整恢复操作受特定条件的限制。">本章的范围适用</a>于恢复程序中使用的一些假设</p>
                        <p>在基本方案中，数据库是打开的，有些但不是所有数据文件都已损坏。您希望还原和恢复损坏的表空间，同时保持数据库处于打开状态，以便数据库的其余部分保持可用。此方案假定数据库<code class="codeph">TRGT</code>丢失了表空间<code class="codeph">USERS</code> 。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><span class="bold">要还原和恢复表空间：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>完成<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="您必须根据恢复目标以及丢失的数据库文件来规划数据库还原和恢复策略。">准备完整数据库恢复</a> ”中</span>所述的恢复方案所需的准备步骤。</span></li>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用），如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”中所述</span> 。</span></li>
                        <li class="stepexpand"><span>如果数据库已打开，则需要使表空间需要脱机恢复。</span><div>
                              <p>例如，输入以下命令以使<code class="codeph">USERS</code>脱机：</p><pre class="oac_no_warn" dir="ltr">ALTER TABLESPACE用户立即离线;</pre></div>
                        </li>
                        <li class="stepexpand"><span>使用<code class="codeph">SHOW</code>命令查看预配置的通道。</span><div>
                              <p>例如，输入以下命令（包括示例输出）：</p><pre class="oac_no_warn" dir="ltr">显示所有; db_unique_name PROD1的数据库的RMAN配置参数是：。。。配置默认设备类型磁盘; #default CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET; #default CONFIGURE DEVICE TYPE SBT_TAPE PARALLELISM 1 BACKUP TYPE TO BACKUPSET; #default CONFIGURE CHANNEL DEVICE TYPE'SBT_TAPE'PARMS“SBT_ LIBRARY = / usr / local / oracle / backup / lib / libobk.so”;</pre><p>如果配置了必要的设备和通道，则无需执行任何操作。否则，您可以使用<code class="codeph">CONFIGURE</code>命令配置自动通道，或在<code class="codeph">RUN</code>块中包含<code class="codeph">ALLOCATE CHANNEL</code>命令。
                              </p>
                              <p></p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>还原并恢复表空间。执行以下操作之一：</span><div>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>如果要将数据文件还原到其原始位置，请在RMAN提示符下运行<code class="codeph">RESTORE TABLESPACE</code>和<code class="codeph">RECOVER TABLESPACE</code>命令。
                                    </p>
                                    <p>例如，如果配置了自动通道，则输入以下命令（包括样本输出）：</p><pre class="oac_no_warn" dir="ltr">RMAN&gt; <span class="bold">RESTORE TABLESPACE用户;</span>在20-JUN-13分配通道开始恢复：ORA_DISK_1通道ORA_DISK_1：SID = 37设备类型= DISK分配通道：ORA_SBT_TAPE_1通道ORA_SBT_TAPE_1：SID = 38设备类型= SBT_TAPE通道ORA_SBT_TAPE_1：Oracle安全备份通道ORA_DISK_1：启动数据文件备份集恢复通道ORA_DISK_1：指定要从备份集通道ORA_DISK_1恢复的数据文件：将数据文件00012还原到/disk1/oracle/dbs/users01.f通道ORA_DISK_1：将数据文件00013还原到/disk1/oracle/dbs/users02.f通道ORA_DISK_1：将数据文件00021还原到/disk1/oracle/dbs/users03.f通道ORA_DISK_1：从备份片段读取/ disk1 / oracle / work / orcva / TKRM / backupset / 2013_06_20 / o1_mf_nnndf_ TAG20130620T105435_29jflwor_.bkp通道ORA_DISK_1：piece handle = / disk1 / oracle / work / orcva / TKRM / backupset / 2013_06_20 / o1_mf_nnndf_ TAG20130620T105435_29jflwor_.bkp tag = TAG20130620T105435 channel ORA_DISK_1：恢复备份1通道ORA_DISK_1：恢复完成，已用时间：00：00：01已完成在20-JUN-13恢复</pre><pre class="oac_no_warn" dir="ltr">RMAN&gt; <span class="bold">RECOVER TABLESPACE用户;</span>使用通道ORA_SBT_TAPE_1使用通道ORA_DISK_1在20-JUN-13开始恢复，对于具有序列27的线程1，启动介质恢复存档日志在磁盘上作为文件/disk1/oracle/work/orcva/TKRM/archivelog/2013_06_20/o1_mf_1_27_29jjmtc9_.arc归档日志对于序列28的线程1在磁盘上作为文件/disk1/oracle/work/orcva/TKRM/archivelog/2013_06_20/o1_mf_1_28_29jjnc5x_.arc。。。通道ORA_DISK_1：将归档日志恢复启动到默认目标通道ORA_DISK_1：恢复归档日志归档日志线程= 1序列= 5通道ORA_DISK_1：恢复归档日志归档日志线程= 1序列= 6通道ORA_DISK_1：恢复归档日志归档日志线程= 1序列= 7。。。通道ORA_DISK_1：读取备份件/ disk1 / oracle / work / orcva / TKRM / backupset / 2013_06_20 / o1_mf_annnn_ TAG20130620T113128_29jhr197_.bkp通道ORA_DISK_1：件句柄= / disk1 / oracle / work / orcva / TKRM / backupset / 2013_06_20 / o1_mf_annnn_ TAG20130620T113128_29jhr197_。 bkp tag = TAG20130620T113128 channel ORA_DISK_1：恢复备份1通道ORA_DISK_1：恢复完成，已用时间：00：00：02归档日志文件名= / disk1 / oracle / work / orcva / TKRM / archivelog / 2013_06_ 20 / o1_mf_1_5_29jkdvjq_.arc线程= 1序列= 5通道默认值：删除存档日志存档日志文件名= / disk1 / oracle / work / orcva / TKRM / archivelog / 2013_06_ 20 / o1_mf_1_5_29jkdvjq_.arc RECID = 91 STAMP = 593611179存档日志文件名= / disk1 / oracle / work / orcva / TKRM / archivelog / 2013_06_ 20 / o1_mf_1_6_29jkdvbz_.arc thread = 1 sequence = 6 channel default：删除存档日志。。。媒体恢复完成，已用时间：00：00：01在20-JUN-13完成恢复</pre></li>
                                 <li>
                                    <p>如果要将某些数据文件还原到新位置，请在<code class="codeph">RUN</code>命令中执行<code class="codeph">RESTORE TABLESPACE</code>和<code class="codeph">RECOVER TABLESPACE</code> 。使用<code class="codeph">SET NEWNAME</code>命令重命名数据文件，如<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-A3DE37A6-3983-4834-858E-A2BCC3804681" title="If you cannot restore data files to their default locations, then you must update the control file to reflect the new locations of the data files.">关于</a></span>将数据文件<span class="q"><a href="rman-complete-database-recovery.html#GUID-A3DE37A6-3983-4834-858E-A2BCC3804681" title="如果无法将数据文件还原到其默认位置，则必须更新控制文件以反映数据文件的新位置。">还原到非默认位置</a> ”中所述</span> 。
                                    </p>
                                    <p>以下示例将表空间<code class="codeph">users</code>的数据文件还原到新位置，然后执行恢复。假设旧数据文件存储在<code class="codeph">/disk1</code>路径中，新数据文件将存储在<code class="codeph">/disk2</code>路径中。
                                    </p><pre class="oac_no_warn" dir="ltr">RUN {＃指定每个数据文件的新位置SET NEWNAME FOR DATAFILE'/disk1/oracle/dbs/users01.f'TO'/disk2/users01.f';为数据文件设置NEWNAME'/disk1/oracle/dbs/users02.f'TO'/disk2/users02.f';为数据文件设置NEWNAME'/disk1/oracle/dbs/users03.f'TO'/disk2/users03.f'; RESTORE TABLESPACE用户; SWITCH DATAFILE ALL; ＃更新控制文件，使用新文件名RECOVER TABLESPACE用户; }</pre></li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>检查输出以查看恢复是否成功。如果是这样，请将恢复的表空间重新联机。</span><div>
                              <p>例如，输入以下命令：</p><pre class="oac_no_warn" dir="ltr">ALTER TABLESPACE用户在线;</pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV89774"></a><div class="props_rev_3"><a id="GUID-19A07A76-AE1E-41EE-8B7D-7C4EF1FD3137" name="GUID-19A07A76-AE1E-41EE-8B7D-7C4EF1FD3137"></a><h4 id="BRADV-GUID-19A07A76-AE1E-41EE-8B7D-7C4EF1FD3137" class="sect4"><span class="enumeration_section">17.3.4</span>切换到副本后执行完全恢复</h4>
                  <div>
                     <p>您可以通过切换到无法访问的数据文件的映像副本来恢复数据库。这种技术比传统的恢复和恢复花费的时间更少，因为不需要恢复备份。</p>
                     <p>如果您在快速恢复区域中有无法访问的数据文件的映像副本，则可以使用<code class="codeph">SWITCH DATAFILE ...TO COPY</code>命令将控制文件指向数据文件副本，然后使用<code class="codeph">RECOVER</code>恢复丢失的更改。您还可以使用<code class="codeph">SWITCH DATABASE TO COPY</code>命令将控制文件指向整个数据库的副本。
                     </p>
                     <div class="infoboxnote" id="GUID-19A07A76-AE1E-41EE-8B7D-7C4EF1FD3137__GUID-32D4DB6B-B3DF-46F9-9223-26EA7F7B6CBD">
                        <p class="notep1">注意：</p>
                        <p>一个<code class="codeph">SWITCH TABLESPACE ...如果表空间中的所有数据文件都丢失并且存在所有数据文件的副本，则也支持TO COPY</code>命令。<code class="codeph">SWITCH DATABASE ...存在同样的限制<code class="codeph">SWITCH DATABASE ...TO COPY</code> 。</p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-19A07A76-AE1E-41EE-8B7D-7C4EF1FD3137__GUID-B12BFE88-8ACB-4170-A2FB-B36A5149A5A2">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="rman-complete-database-recovery.html#GUID-27F3EB09-3608-4E0E-A7F0-1F0DF1D5C572" title="当一个或多个数据文件损坏时，您可以通过切换到损坏的数据文件的现有映像副本来执行恢复。">切换到数据文件复制后执行恢复</a></p>
                           </li>
                           <li>
                              <p><a href="rman-complete-database-recovery.html#GUID-4C884005-5636-4B54-98FC-4BBD683B3D7A" title="您可以通过切换到损坏的数据文件的映像副本而不是还原这些数据文件来执行完整的数据库恢复。">切换到数据库副本后执行完全恢复</a></p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="BRADV357"></a><a id="BRADV996"></a><div class="props_rev_3"><a id="GUID-27F3EB09-3608-4E0E-A7F0-1F0DF1D5C572" name="GUID-27F3EB09-3608-4E0E-A7F0-1F0DF1D5C572"></a><h5 id="BRADV-GUID-27F3EB09-3608-4E0E-A7F0-1F0DF1D5C572" class="sect5"><span class="enumeration_section">17.3.4.1</span>切换到数据文件复制后执行恢复</h5>
                     <div>
                        <p>当一个或多个数据文件损坏时，您可以通过切换到损坏的数据文件的现有映像副本来执行恢复。</p>
                        <div class="p">
                           <p>对于恢复程序中使用的一些假设， <span class="q">“ <a href="rman-complete-database-recovery.html#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" title="本章中描述的完整恢复操作受特定条件的限制。">本章的范围</a> ”</span></p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>在基本方案中，数据库是打开的，有些但不是所有数据文件都已损坏。在一天中，由于存储故障，数据文件丢失。您必须修复此文件，但无法承担从备份执行还原和恢复的时间。您决定使用最近的映像副本备份作为新文件，从而消除还原时间。此方案假定数据库<code class="codeph">trgt</code>已丢失数据文件4。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-27F3EB09-3608-4E0E-A7F0-1F0DF1D5C572__GUID-862E8986-CEF8-445E-A998-A68748221196">要切换到数据文件副本并执行恢复：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>完成方案所需的准备步骤，如<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="您必须根据恢复目标以及丢失的数据库文件来规划数据库还原和恢复策略。">准备完整数据库恢复</a> ”中所述</span> 。</span></li>
                           <li class="stepexpand"><span>启动RMAN并连接到目标数据库，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”中所述</span> 。</span></li>
                           <li class="stepexpand"><span>如果数据库已打开，则需要使表空间需要脱机恢复。</span><div>
                                 <p>输入以下命令以使数据文件4脱机：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE DATAFILE 4 OFFLINE;</pre></div>
                           </li>
                           <li class="stepexpand"><span>将脱机数据文件切换到最新副本。</span><div>
                                 <p>输入以下命令将控制文件指向数据文件4的最新映像副本：</p><pre class="oac_no_warn" dir="ltr">切换数据文件4复制;</pre></div>
                           </li>
                           <li class="stepexpand"><span>使用<code class="codeph">RECOVER DATAFILE</code>命令恢复数据文件。</span><div>
                                 <p>输入以下命令：</p><pre class="oac_no_warn" dir="ltr">RECOVER DATAFILE 4;</pre><p>RMAN自动还原存档的重做日志和增量备份。由于数据库使用快速恢复区域，因此RMAN在应用后会自动删除它们。</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>检查输出以查看恢复是否成功。如果是这样，请将恢复的数据文件重新联机。</span><div>
                                 <p>输入以下命令以使数据文件4联机：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE DATAFILE 4 ONLINE;</pre></div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="BRADV358"></a><a id="BRADV999"></a><div class="props_rev_3"><a id="GUID-4C884005-5636-4B54-98FC-4BBD683B3D7A" name="GUID-4C884005-5636-4B54-98FC-4BBD683B3D7A"></a><h5 id="BRADV-GUID-4C884005-5636-4B54-98FC-4BBD683B3D7A" class="sect5"><span class="enumeration_section">17.3.4.2</span>切换到数据库副本后执行完全恢复</h5>
                     <div>
                        <p>您可以通过切换到损坏的数据文件的映像副本而不是还原这些数据文件来执行完整的数据库恢复。</p>
                        <div class="p">
                           <p>对于恢复程序中使用的一些假设， <span class="q">“ <a href="rman-complete-database-recovery.html#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" title="本章中描述的完整恢复操作受特定条件的限制。">本章的范围</a> ”</span></p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>在这种情况下，数据库将关闭，并且所有数据文件都已损坏。您拥有所有已损坏数据文件的映像副本，并决定将现有映像副本用作新数据文件，从而消除了还原时间。</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-4C884005-5636-4B54-98FC-4BBD683B3D7A__GUID-24DCC826-6790-425A-9DEB-56D8A5013D2A">要切换到数据库副本并执行恢复：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>完成方案所需的准备步骤，如<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="您必须根据恢复目标以及丢失的数据库文件来规划数据库还原和恢复策略。">准备完整数据库恢复</a> ”中所述</span> 。</span></li>
                           <li class="stepexpand"><span>启动RMAN并连接到目标数据库，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”中所述</span> 。</span></li>
                           <li class="stepexpand"><span>装入数据库。</span></li>
                           <li class="stepexpand"><span>将数据库切换到最新副本。</span><div>
                                 <p>输入以下命令将控制文件指向数据库的最新映像副本：</p><pre class="oac_no_warn" dir="ltr">切换数据库复制;</pre></div>
                           </li>
                           <li class="stepexpand"><span>使用<code class="codeph">RECOVER DATABASE</code>命令恢复数据库。</span><div>
                                 <p>输入以下命令：</p><pre class="oac_no_warn" dir="ltr">恢复数据库;</pre><p>RMAN自动还原存档的重做日志和增量备份。由于数据库使用快速恢复区域，因此RMAN在应用后会自动删除它们。</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>检查输出以查看恢复是否成功。如果是，请打开数据库。</span><div>
                                 <p>输入以下命令以打开数据库：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN;</pre></div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV636"></a><div class="props_rev_3"><a id="GUID-1F744C63-2D4C-4F65-8773-1340A85993ED" name="GUID-1F744C63-2D4C-4F65-8773-1340A85993ED"></a><h3 id="BRADV-GUID-1F744C63-2D4C-4F65-8773-1340A85993ED" class="sect3"><span class="enumeration_section">17.4</span>执行CDB的完全恢复</h3>
               <div>
                  <p>RMAN和Oracle Enterprise Manager云控制（云控制）为多租户环境中的备份和恢复提供全面支持。</p>
                  <p>您可以备份和恢复整个<a href="glossary.html#GUID-3E156A59-F6CC-4A2A-9749-DB7D1CE25F13"><span class="xrefglossterm">多租户容器数据库（CDB）</span></a> ，仅<a href="glossary.html#GUID-EA3DB8F4-F68E-4FC5-A599-32A4886FFF8A"><span class="xrefglossterm">root用户</span></a>或一个或多个可插拔数据库（ <a href="glossary.html#GUID-993BFB3F-3305-481C-999D-26132095DEC9"><span class="xrefglossterm">PDB</span></a> ）。
                  </p>
                  <p>该部分包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-50186233-ADCE-4566-8D82-B41A566A0E3B" title="恢复整个CDB时，可以在单个操作中恢复根和所有PDB。">执行整个CDB的完全恢复</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-4575B27F-BB73-4EEE-8F80-F077801CA94B" title="如果发生仅影响根的数据损坏或用户错误，您可以考虑仅恢复根。">执行完全恢复根</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44" title="您可以执行一个或多个PDB的完全恢复，而不会影响其他打开的PDB的操作。">使用RMAN执行PDB的完全恢复</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-928729FC-3714-4FAE-9BDE-2DFBF45EE451" title="企业管理器云控制（云控制）提供了恢复PDB的界面。">使用云控制执行PDB的完全恢复</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-591669B1-74A4-461F-A6B3-460F69803E90" title="使用RECOVER命令使用预包装备份执行完全恢复。">使用预刷新备份执行完全恢复</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934" title="由于不同PDB中的表空间可以具有相同的名称，以消除歧义，因此必须直接连接到PDB以恢复其一个或多个表空间。相反，由于数据文件编号和路径在CDB中是唯一的，因此在恢复PDB数据文件时可以连接到根或PDB。">使用RMAN在PDB中执行表空间或数据文件的完全恢复</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-97BD3A51-0AF1-46B0-B7DF-9F069C68F83F" title="Oracle Enterprise Manager云控制（云控制）提供了一个用于恢复PDB中的表空间的界面。">使用云控制在PDB中执行表空间的完全恢复</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-9A824454-8577-4899-BD69-E631B573021F" title="通过切换到副本来恢复CDB比传统的恢复和恢复更快。">切换到副本后执行CDB的完全恢复</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV637"></a><a id="BRADV746"></a><div class="props_rev_3"><a id="GUID-50186233-ADCE-4566-8D82-B41A566A0E3B" name="GUID-50186233-ADCE-4566-8D82-B41A566A0E3B"></a><h4 id="BRADV-GUID-50186233-ADCE-4566-8D82-B41A566A0E3B" class="sect4"><span class="enumeration_section">17.4.1</span>执行整个CDB的完全恢复</h4>
                  <div>
                     <p>恢复整个CDB时，可以在单个操作中恢复根和所有PDB。</p>
                     <div class="section">
                        <p><span class="bold">要恢复整个CDB：</span></p>
                        <ol>
                           <li>
                              <p>完成方案所需的准备步骤，如<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="您必须根据恢复目标以及丢失的数据库文件来规划数据库还原和恢复策略。">准备完整数据库恢复</a> ”中所述</span></p>
                           </li>
                           <li>
                              <p>使用<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限以及恢复目录（如果使用）连接到root用户，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D" title="有几种方法可以将目标连接到根目录。">将目标连接到根目录</a> ”中所述</span> 。
                              </p>
                           </li>
                           <li>
                              <p>如果未装入数据库，则装入但不要打开数据库。使用以下g命令：</p><pre class="oac_no_warn" dir="ltr">启动安装;</pre></li>
                           <li>
                              <p>使用<code class="codeph">SHOW</code>命令查看预配置的通道。
                              </p>
                              <p>如果配置了必要的设备和通道，则无需执行任何操作。否则，您可以使用<code class="codeph">CONFIGURE</code>命令配置自动通道，或在<code class="codeph">RUN</code>块中包含<code class="codeph">ALLOCATE CHANNEL</code>命令。
                              </p>
                           </li>
                           <li>
                              <p>还原并恢复数据库。执行以下操作之一：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>如果要将所有数据文件还原到其原始位置，请在RMAN提示符下依次执行<code class="codeph">RESTORE DATABASE</code>和<code class="codeph">RECOVER DATABASE</code> 。
                                    </p>
                                    <p>例如，如果配置了自动通道，请输入以下命令：</p><pre class="pre codeblock"><code>RESTORE DATABASE;恢复数据库;</code></pre><p>如果手动分配通道，则必须在<code class="codeph">RUN</code>块中一起发出<code class="codeph">RESTORE</code>和<code class="codeph">RECOVER</code>命令，如以下示例所示：</p><pre class="pre codeblock"><code>RUN {ALLOCATE CHANNEL c1 DEVICE TYPE sbt; RESTORE DATABASE;恢复数据库; }</code></pre></li>
                                 <li>
                                    <p>如果要将某些数据文件还原到新位置，请在<code class="codeph">RUN</code>命令中依次执行<code class="codeph">RESTORE DATABASE</code>和<code class="codeph">RECOVER DATABASE</code> 。使用<code class="codeph">SET NEWNAME</code>命令重命名数据文件。
                                    </p>
                                    <p>以下示例还原数据库，为三个数据文件指定新名称，然后恢复数据库：</p><pre class="oac_no_warn" dir="ltr">运行{为数据文件设置NEWNAME 2'到'/disk2/df2.dbf';将DATAFILE 3的NEWNAME设置为'/disk2/df3.dbf';将DATAFILE 4的NEWNAME设置为'/disk2/df4.dbf'; RESTORE DATABASE; SWITCH DATAFILE ALL;恢复数据库; }</pre></li>
                              </ul>
                           </li>
                           <li>
                              <p>检查输出以查看介质恢复是否成功。如果是，请打开数据库。</p>
                              <p>例如，输入以下命令：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN;</pre></li>
                        </ol>
                        <div class="infoboxnotealso" id="GUID-50186233-ADCE-4566-8D82-B41A566A0E3B__GUID-7B5DA9E9-268E-4D7D-92BB-94ACC6412B68">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="rman-complete-database-recovery.html#GUID-A3DE37A6-3983-4834-858E-A2BCC3804681" title="如果无法将数据文件还原到其默认位置，则必须更新控制文件以反映数据文件的新位置。">关于将数据文件还原到非默认位置</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV748"></a><a id="BRADV747"></a><div class="props_rev_3"><a id="GUID-4575B27F-BB73-4EEE-8F80-F077801CA94B" name="GUID-4575B27F-BB73-4EEE-8F80-F077801CA94B"></a><h4 id="BRADV-GUID-4575B27F-BB73-4EEE-8F80-F077801CA94B" class="sect4"><span class="enumeration_section">17.4.2</span>执行根的完全恢复</h4>
                  <div>
                     <p>如果发生仅影响根的数据损坏或用户错误，您可以考虑仅恢复根。</p>
                     <div class="section">
                        <p>但是，Oracle强烈建议您在恢复根之后恢复所有PDB，以防止根和PDB之间的元数据不一致。在这种情况下，可能最好完全恢复整个CDB。</p>
                        <div class="infoboxnotealso" id="GUID-4575B27F-BB73-4EEE-8F80-F077801CA94B__GUID-A55FFDE4-7020-425E-827B-BB400ECD5456">
                           <p class="notep1">也可以看看：</p>
                           <p>对于恢复程序中使用的一些假设， <span class="q">“ <a href="rman-complete-database-recovery.html#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" title="本章中描述的完整恢复操作受特定条件的限制。">本章的范围</a> ”</span></p>
                        </div>
                        <p><span class="bold">要恢复根：</span></p>
                        <ol>
                           <li>
                              <p>完成恢复方案所需的准备步骤，如<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="您必须根据恢复目标以及丢失的数据库文件来规划数据库还原和恢复策略。">准备完整数据库恢复</a> ”中所述</span> 。
                              </p>
                           </li>
                           <li>
                              <p>启动RMAN并以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的公共用户身份连接到根，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D" title="有几种方法可以将目标连接到根目录。">将目标连接到根目录</a> ”中所述</span> 。
                              </p>
                           </li>
                           <li>
                              <p>将CDB置于安装模式。</p><pre class="oac_no_warn" dir="ltr">立即关闭;启动安装;</pre></li>
                           <li>
                              <p>（可选）使用<code class="codeph">CONFIGURE</code>命令配置默认设备类型和自动通道。
                              </p>
                           </li>
                           <li>
                              <p>使用以下命令恢复和恢复根：</p><pre class="oac_no_warn" dir="ltr">RESTORE DATABASE ROOT;恢复数据库根;</pre></li>
                           <li>
                              <p>检查输出以查看介质恢复是否成功。如果是，请继续执行下一步。</p>
                           </li>
                           <li>
                              <p>（强烈推荐）恢复所有PDB，包括CDB种子。</p>
                              <ol type="a">
                                 <li>
                                    <p>发出<code class="codeph">RESTORE PLUGGABLE DATABASE</code>和<code class="codeph">RECOVER PLUGGABLE DATABASE</code>命令。
                                    </p>
                                    <p>以下示例恢复了PDBs <code class="codeph">sales</code>和<code class="codeph">hr</code> ：</p><pre class="oac_no_warn" dir="ltr">RESTORE PLUGGABLE DATABASE'PDB $ SEED'，sales，hr; RECOVER PLUGGABLE DATABASE'PDB $ SEED'，sales，hr;</pre></li>
                                 <li>
                                    <p>检查输出以查看介质恢复是否成功。如果是，请继续执行下一步。</p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>打开CDB和所有PDB。</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN; ALTER PLUGGABLE DATABASE ALL OPEN;</pre></li>
                        </ol>
                        <div class="infoboxnotealso" id="GUID-4575B27F-BB73-4EEE-8F80-F077801CA94B__GUID-71C950E2-FE92-477E-AFB8-BF44B36C045E">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="rman-complete-database-recovery.html#GUID-50186233-ADCE-4566-8D82-B41A566A0E3B" title="恢复整个CDB时，可以在单个操作中恢复根和所有PDB。">执行整个CDB的完全恢复</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV750"></a><a id="BRADV751"></a><a id="BRADV749"></a><div class="props_rev_3"><a id="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44" name="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44"></a><h4 id="BRADV-GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44" class="sect4"><span class="enumeration_section">17.4.3</span>使用RMAN执行PDB的完全恢复</h4>
                  <div>
                     <p>您可以执行一个或多个PDB的完全恢复，而不会影响其他打开的PDB的操作。</p>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44__GUID-C837E782-277A-4976-B971-86FA059546A0">
                           <p class="notep1">也可以看看：</p>
                           <p>对于恢复程序中使用的一些假设， <span class="q">“ <a href="rman-complete-database-recovery.html#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" title="本章中描述的完整恢复操作受特定条件的限制。">本章的范围</a> ”</span></p>
                        </div>
                        <p>使用RMAN恢复PDB有两种方法：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>连接到root，然后使用<code class="codeph">RESTORE PLUGGABLE DATABASE</code>和<code class="codeph">RECOVER PLUGGABLE DATABASE</code>命令。此方法使您可以使用单个命令恢复多个PDB。
                              </p>
                           </li>
                           <li>
                              <p>连接到PDB并使用<code class="codeph">RESTORE DATABASE</code>和<code class="codeph">RECOVER DATABASE</code>命令。此方法仅恢复单个PDB，并使您能够使用用于恢复非CDB数据库的相同命令。
                              </p>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44__GUID-1DA489AB-D3AA-4AE1-8DF4-4E4C8C881277">
                           <p class="notep1">视频：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=vid_dbbackup_recoverpdb" target="_blank">Oracle视频：恢复PDB</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p></p>
                        <p><span class="bold">在连接到根时恢复一个或多个PDB：</span></p>
                        <ol>
                           <li>
                              <p>完成恢复方案所需的准备步骤，如<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="您必须根据恢复目标以及丢失的数据库文件来规划数据库还原和恢复策略。">准备完整数据库恢复</a> ”中所述</span> 。
                              </p>
                           </li>
                           <li>
                              <p>启动RMAN。使用<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限以及恢复目录（如果使用）连接到root用户，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D" title="有几种方法可以将目标连接到根目录。">将目标连接到根目录</a> ”中所述</span> 。
                              </p>
                           </li>
                           <li>
                              <p>关闭要恢复的PDB。</p><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE销售，小时关闭;</pre><p>如果缺少任何数据文件，则会发生错误，您无法关闭PDB。然后，您必须连接到丢失的数据文件所属的PDB，使丢失的数据文件脱机，然后关闭PDB。</p>
                              <p>以下命令使数据文件12脱机：</p><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE DATAFILE 12 OFFLINE;</pre><div class="infoboxnote" id="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44__GUID-BC3A98D5-DE8A-41FC-8558-750A70A8A5F1">
                                 <p class="notep1">注意：</p>
                                 <p>如果缺少存储PDB的<code class="codeph">SYSTEM</code>表空间的数据文件，请按照<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934" title="Because tablespaces in different PDBs can have the same name, to eliminate ambiguity, you must connect directly to a PDB to recover one or more of its tablespaces. In contrast, because data file numbers and paths are unique across the CDB, you can connect either to the root or to a PDB when recovering PDB data files.">使用RMAN在PDB中执行表空间或数据文件的完全恢复</a> ”</span>中所述的恢复步骤<span class="q"><a href="rman-complete-database-recovery.html#GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934" title="由于不同PDB中的表空间可以具有相同的名称，以消除歧义，因此必须直接连接到PDB以恢复其一个或多个表空间。相反，由于数据文件编号和路径在CDB中是唯一的，因此在恢复PDB数据文件时可以连接到根或PDB。">进行操作</a></span> 。
                                 </p>
                              </div>
                           </li>
                           <li>
                              <p>（可选）使用<code class="codeph">CONFIGURE</code>命令配置默认设备类型和自动通道。
                              </p>
                           </li>
                           <li>
                              <p>发出<code class="codeph">RESTORE PLUGGABLE DATABASE</code>和<code class="codeph">RECOVER PLUGGABLE DATABASE</code>命令。
                              </p>
                              <p>以下示例恢复CDB种子， <code class="codeph">PDB$SEED</code>以及PDB <code class="codeph">sales</code>和<code class="codeph">hr</code> ：</p><pre class="oac_no_warn" dir="ltr">RESTORE PLUGGABLE DATABASE'pdb $ seed'，sales，hr; RECOVER PLUGGABLE DATABASE'pdb $ seed'，sales，hr;</pre></li>
                           <li>
                              <p>如果在步骤2中将任何数据文件脱机，请将这些数据文件联机。</p>
                              <p>连接到缺失数据文件所属的PDB，然后使数据文件联机。以下命令使数据文件12在线：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE DATAFILE 12 ONLINE;</pre></li>
                           <li>
                              <p>检查输出以查看介质恢复是否成功。如果是，请打开PDB。</p><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE销售，hr打开;</pre></li>
                        </ol>
                        <p><span class="bold">连接并恢复一个PDB：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>完成恢复方案所需的准备步骤，如<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="您必须根据恢复目标以及丢失的数据库文件来规划数据库还原和恢复策略。">准备完整数据库恢复</a> ”中所述</span> 。</span></li>
                        <li class="stepexpand"><span>启动RMAN。以具有<code class="codeph">SYSDBA</code>系统特权的<a href="glossary.html#GUID-43EA1A4C-E5EB-4926-99EC-1DDA0E74A07C"><span class="xrefglossterm">本地用户</span></a>身份连接到PDB，并连接到恢复目录（如果使用），如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E95C5C27-C036-4773-B77C-E4120526F422" title="您可以从RMAN提示符或操作系统命令行连接到PDB。">将目标连接到PDB</a> ”中所述</span> 。</span></li>
                        <li class="stepexpand"><span>关闭PDB。</span><div><pre class="oac_no_warn" dir="ltr">ALTER PLOGGABLE DATABASE CLOSE;</pre><p>如果缺少任何数据文件，则会发生错误，您无法关闭PDB。您必须使丢失的数据文件脱机，然后关闭PDB。</p>
                              <p>以下命令使数据文件12脱机：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE DATAFILE 12 OFFLINE;</pre><div class="infoboxnote" id="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44__GUID-4AAF369F-0C9E-4319-BD15-A6BB51DDB0EC">
                                 <p class="notep1">注意：</p>
                                 <p>如果缺少存储PDB的<code class="codeph">SYSTEM</code>表空间的数据文件，请按照<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934" title="Because tablespaces in different PDBs can have the same name, to eliminate ambiguity, you must connect directly to a PDB to recover one or more of its tablespaces. In contrast, because data file numbers and paths are unique across the CDB, you can connect either to the root or to a PDB when recovering PDB data files.">使用RMAN在PDB中执行表空间或数据文件的完全恢复</a> ”中</span>所述的恢复步骤<span class="q"><a href="rman-complete-database-recovery.html#GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934" title="由于不同PDB中的表空间可以具有相同的名称，以消除歧义，因此必须直接连接到PDB以恢复其一个或多个表空间。相反，由于数据文件编号和路径在CDB中是唯一的，因此在恢复PDB数据文件时可以连接到根或PDB。">进行操作</a></span> 。
                                 </p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>（可选）使用<code class="codeph">CONFIGURE</code>命令配置默认设备类型和自动通道。</span></li>
                        <li class="stepexpand"><span>发出<code class="codeph">RESTORE DATABASE</code>和<code class="codeph">RECOVER DATABASE</code>命令。</span><div><pre class="oac_no_warn" dir="ltr">RESTORE DATABASE;恢复数据库;</pre></div>
                        </li>
                        <li class="stepexpand"><span>如果在步骤2中将任何数据文件脱机，请将这些数据文件联机。</span><div>
                              <p>以下命令使数据文件12在线：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE DATAFILE 12 ONLINE;</pre></div>
                        </li>
                        <li class="stepexpand"><span>打开PDB。</span><div><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE OPEN;</pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV752"></a><div class="props_rev_3"><a id="GUID-928729FC-3714-4FAE-9BDE-2DFBF45EE451" name="GUID-928729FC-3714-4FAE-9BDE-2DFBF45EE451"></a><h4 id="BRADV-GUID-928729FC-3714-4FAE-9BDE-2DFBF45EE451" class="sect4"><span class="enumeration_section">17.4.4</span>使用云控制执行PDB的完全恢复</h4>
                  <div>
                     <p>企业管理器云控制（云控制）提供了恢复PDB的界面。</p>
                     <div class="section">
                        <p><span class="bold">要使用Cloud Control恢复一个或多个PDB：</span></p>
                        <ol>
                           <li>
                              <p>从Database Home页面，从Availability菜单中选择<span class="bold">Backup＆Recovery</span> ，然后选择<span class="bold">Perform Recovery</span> 。
                              </p>
                           </li>
                           <li>
                              <p>如果以前未登录过数据库，则会显示“数据库登录”页面。使用“命名”或“新凭据” <span class="bold">登录</span>数据库，然后单击“ <span class="bold">登录”</span> 。
                              </p>
                              <p>Cloud Control显示“执行恢复”页面。</p>
                           </li>
                           <li>
                              <p>从“用户定向恢复”部分，从“恢复范围”下拉列表中选择“ <span class="bold">可插拔数据库</span> ”，然后单击“ <span class="bold">恢复”</span> 。
                              </p>
                              <p>将出现Perform Pluggable Database Recovery Wizard并显示Pluggable Databases页面。</p>
                           </li>
                           <li>
                              <p>按照以下步骤选择要恢复的PDB：</p>
                              <ol type="a">
                                 <li>
                                    <p>单击“ <span class="bold">添加”</span>以显示“可用的可插拔数据库”页面。
                                    </p>
                                 </li>
                                 <li>
                                    <p>从显示的PDB列表中，单击“ <span class="bold">选择”</span>列以指定要恢复的PDB。（可选）您可以单击“全<span class="bold">选”</span>以打开所有可用PDB的“选择”选项。单击“ <span class="bold">选择无”</span>以取消选择所有PDB。
                                    </p>
                                 </li>
                                 <li>
                                    <p>单击“ <span class="bold">选择”</span>按钮返回“可插拔数据库”页面。
                                    </p>
                                 </li>
                                 <li>
                                    <p>（可选）通过单击要删除的每个PDB的“ <span class="bold">选择”</span>列，然后单击“ <span class="bold">删除”</span> ，可以从表中删除PDB。
                                    </p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>通过导航其余页面来完成向导以恢复PDB。有关向导的每个页面的更多信息，请单击“ <span class="bold">帮助”</span> 。
                              </p>
                           </li>
                        </ol>
                        <div class="infoboxnotealso" id="GUID-928729FC-3714-4FAE-9BDE-2DFBF45EE451__GUID-600E1F3D-0F41-4C9A-975C-5C9D05163644">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="introduction-backup-recovery.html#GUID-7557D8F6-2DC8-460A-8453-74E73DEF8705" title="数据库主页是Oracle企业管理器云控制（云控制）中的主数据库管理页面。">使用云控制访问数据库主页</a> ”</span></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-591669B1-74A4-461F-A6B3-460F69803E90" name="GUID-591669B1-74A4-461F-A6B3-460F69803E90"></a><h4 id="BRADV-GUID-591669B1-74A4-461F-A6B3-460F69803E90" class="sect4"><span class="enumeration_section">17.4.5</span>使用预刷新备份执行完全恢复</h4>
                  <div>
                     <p>使用<code class="codeph">RECOVER</code>命令使用预包装备份执行完全恢复。
                     </p>
                     <p>本节包含以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-C5D28C51-1265-4EF0-BA08-ED6CA6998F04" title="预打印备份用于在PDB插入当前CDB之前的某个时间将PDB恢复并恢复到其状态。">关于使用PrePlugin备份完全恢复PDB</a></p>
                        </li>
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-1F67ECAB-B8D0-4547-A5F1-F1C3C7AF2C5D" title="RMAN使用预包装备份执行PDB的完全恢复。在将PDB迁移到当前目标CDB之前，在源非CDB或源CDB上创建了这些预制备份备份。">使用预刷新备份执行PDB的完全恢复</a></p>
                        </li>
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-24440AE6-42DA-4392-A871-C7632DD9BEF8" title="此示例使用预刷新备份执行目标CDB prod_cdb中PDB my_pdb的完全恢复。">示例：使用预刷新备份执行PDB的完全恢复</a></p>
                        </li>
                     </ul>
                  </div>
                  <div class="sect4"><a id="GUID-C5D28C51-1265-4EF0-BA08-ED6CA6998F04" name="GUID-C5D28C51-1265-4EF0-BA08-ED6CA6998F04"></a><h5 id="BRADV-GUID-C5D28C51-1265-4EF0-BA08-ED6CA6998F04" class="sect5"><span class="enumeration_section">17.4.5.1</span>关于使用PrePlugin备份完全恢复PDB</h5>
                     <div>
                        <p>预打印备份用于在PDB插入当前CDB之前的某个时间将PDB恢复并恢复到其状态。</p>
                        <p></p>
                        <p>要使用预刷新备份执行完全恢复，请使用<code class="codeph">RESTORE</code>和<code class="codeph">RECOVER</code>命令的<code class="codeph">FROM PREPLUGIN</code>子句。RMAN使用预刷新备份还原数据文件，然后使用预刷新增量备份和归档重做日志将数据文件恢复到PDB插入目标CDB之前的时间点。</p>
                        <p>当您拔出PDB或将<code class="codeph">DBMS_PDB.EXPORTRMANBACKUP()</code>过程与非CDB一起使用时，预刷新备份的元数据将迁移到目标CDB。预打印备份不会自动迁移到目标CDB。您必须确保目标CDB可以访问在源数据库上创建的备份。
                        </p>
                        <p>RMAN还原预制存档归档重做日志的位置取决于是否在目标CDB中配置了快速恢复区域。如果快速恢复区域不是CDB中归档重做日志文件的默认目标，则RMAN会将预先存储的归档重做日志还原到快速恢复区域。如果快速恢复区域是CDB中归档重做日志文件的默认目标，则必须使用<code class="codeph">SET ARCHIVELOG DESTINATION</code>命令指定预填充归档重做日志文件的位置。
                        </p>
                        <div class="infoboxnotealso" id="GUID-C5D28C51-1265-4EF0-BA08-ED6CA6998F04__GUID-27C3BA50-7BDD-4CCC-98E1-16A98BA6F46A">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="rman-backup-concepts.html#GUID-7D69CBCA-123F-49FF-85E9-F5C70E47202D" title="预包装备份是在非CDB或PDB插入其他CDB之前创建的非CDB或PDB的RMAN备份。">关于Preplugin备份</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-complete-database-recovery.html#GUID-1F67ECAB-B8D0-4547-A5F1-F1C3C7AF2C5D" title="RMAN使用预包装备份执行PDB的完全恢复。在将PDB迁移到当前目标CDB之前，在源非CDB或源CDB上创建了这些预制备份备份。">使用预刷新备份执行PDB的完全恢复</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-complete-database-recovery.html#GUID-24440AE6-42DA-4392-A871-C7632DD9BEF8" title="此示例使用预刷新备份执行目标CDB prod_cdb中PDB my_pdb的完全恢复。">示例：使用预刷新备份执行PDB的完全恢复</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-1F67ECAB-B8D0-4547-A5F1-F1C3C7AF2C5D" name="GUID-1F67ECAB-B8D0-4547-A5F1-F1C3C7AF2C5D"></a><h5 id="BRADV-GUID-1F67ECAB-B8D0-4547-A5F1-F1C3C7AF2C5D" class="sect5"><span class="enumeration_section">17.4.5.2</span>使用预刷新备份执行PDB的完全恢复</h5>
                     <div>
                        <p>RMAN使用预包装备份执行PDB的完全恢复。在将PDB迁移到当前目标CDB之前，在源非CDB或源CDB上创建了这些预制备份备份。</p>
                        <div class="section">
                           <p></p>
                        </div>
                        <!-- class="section" -->
                        <div class="p">预打印备份必须包括恢复PDB所需的所有归档重做日志。</div>
                        <!-- class="section" -->
                        <div class="p">要使用非CDB的预备份备份执行完全恢复，必须使用<span class="q">“ <a href="backing-up-database.html#GUID-7F9F8913-2838-4066-A000-048B35A70EA4" title="预打印备份确保在将非CDB作为PDB插入CDB后可以使用RMAN备份。">创建整个数据库的预打印备份</a> ”中</span>描述的过程创建非CDB备份。
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p></p>
                           <div class="infoboxnote" id="GUID-1F67ECAB-B8D0-4547-A5F1-F1C3C7AF2C5D__GUID-19BC4F6F-8776-4BD7-8E02-25AC5A065FA1">
                              <p class="notep1">注意：</p>
                              <p>如果在使用<code class="codeph">RESETLOGS</code>选项打开PDB之前创建了预刷新备份，则无法使用预备份备份恢复PDB。
                              </p>
                           </div>
                           <p><span class="bold">使用预浸料备份执行PDB的完全恢复：</span> 
                           </p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>确保满足使用<a href="../rcmrf/BACKUP.html#RCMRF-GUID-73642FF2-43C5-48B2-9969-99001C52EB50" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a>中描述的预备份备份执行恢复的先决条件。</span></li>
                           <li class="stepexpand"><span>确保目标主机可以访问包含PDB预备份备份的共享位置。</span><div>
                                 <div class="infoboxnote" id="GUID-1F67ECAB-B8D0-4547-A5F1-F1C3C7AF2C5D__GUID-6F4B837F-F27A-47A9-B4E9-DE851BA59C03">
                                    <p class="notep1">注意：</p>
                                    <p>使用共享磁盘是支持与目标主机共享预备份备份的唯一方法。不支持将所需备份手动复制到目标。</p>
                                 </div>
                              </div>
                           </li>
                           <li class="stepexpand"><span>使用以下技术之一连接到目标CDB：</span><div>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>使用<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限以普通用户身份连接到root用户</p>
                                    </li>
                                    <li>
                                       <p>连接到需要以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的用户身份恢复的PDB。
                                       </p>
                                    </li>
                                 </ul>
                                 <p>请参阅<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”</span> 。
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>关闭正在恢复的PDB。例如：</span><div><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE pdb1 CLOSE IMMEDIATE;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>将当前容器设置为正在恢复的PDB。例如：</span><div><pre class="pre codeblock"><code>SET PREPLUGIN CONTAINER = pdb1;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>（可选）要查看预刷新备份，请使用<code class="codeph">LIST</code>命令。</span><div><pre class="pre codeblock"><code>列表预先插入可插入数据库pdb1的备份;列表PREPLUGIN ARCHIVELOG ALL;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>（可选）要在迁移之前编目未存储在源数据库控制文件中的任何备份，请使用<code class="codeph">CATALOG...PREPLUGIN</code>命令。</span><div>
                                 <p>必须以读写模式打开<code class="codeph">ROOT</code>才能对备份进行编目。以下命令编目指定的归档重做日志：</p><pre class="pre codeblock"><code>CATALOG PREPLUGIN ARCHIVELOG'/disk1/o1_mf_annnn_dmy2r45h_.bkp';</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>使用预制备份备份还原PDB。</span><div><pre class="pre codeblock"><code>RESTORE PLUGGABLE DATABASE pdb1来自PREPLUGIN;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>使用预制备份备份恢复PDB。</span><div>
                                 <p><code class="codeph">RECOVER ...FROM PREPLUGIN</code>命令执行preplugin恢复。如果目标CDB使用快速恢复区域作为存档日志目标，则使用<code class="codeph">SET ARCHIVELOG DESTINATION</code>指定必须恢复预存储备份的目标。
                                 </p><pre class="pre codeblock"><code>运行{SET ARCHIVELOG DESTINATION TO'/ disk1 / alog_dest';从PREPLUGIN中恢复可插入的数据库pdb1; }</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>恢复在<code class="codeph">pdb1</code>插入目标CDB后添加的所有新数据文件，然后执行<code class="codeph">pdb1</code>正常恢复。</span><div><pre class="pre codeblock"><code>RESTORE PLUGGABLE DATABASE pdb1 SKIP PREPLUGIN; RECOVER PLUGGABLE DATABASE pdb1;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>打开恢复的PDB。</span><div>
                                 <p>以下命令将打开名为<code class="codeph">pdb1</code>的PDB。
                                 </p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE pdb1 OPEN;</code></pre></div>
                           </li>
                        </ol>
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-1F67ECAB-B8D0-4547-A5F1-F1C3C7AF2C5D__GUID-F842F64F-C92E-491B-88EF-9AE2681C2A29">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="rman-complete-database-recovery.html#GUID-24440AE6-42DA-4392-A871-C7632DD9BEF8" title="此示例使用预刷新备份执行目标CDB prod_cdb中PDB my_pdb的完全恢复。">示例：使用预刷新备份执行PDB的完全恢复</a></p>
                                 </li>
                                 <li>
                                    <p><a href="rman-complete-database-recovery.html#GUID-C5D28C51-1265-4EF0-BA08-ED6CA6998F04" title="预打印备份用于在PDB插入当前CDB之前的某个时间将PDB恢复并恢复到其状态。">关于使用PrePlugin备份完全恢复PDB</a></p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-24440AE6-42DA-4392-A871-C7632DD9BEF8" name="GUID-24440AE6-42DA-4392-A871-C7632DD9BEF8"></a><h5 id="BRADV-GUID-24440AE6-42DA-4392-A871-C7632DD9BEF8" class="sect5"><span class="enumeration_section">17.4.5.3</span>示例：使用预刷新备份执行PDB的完全恢复</h5>
                     <div>
                        <p>此示例使用预刷新备份执行目标CDB <code class="codeph">prod_cdb</code> PDB <code class="codeph">my_pdb</code>完全恢复。
                        </p>
                        <div class="section">
                           <p></p>
                           <p>该PDB <code class="codeph">my_pdb</code>从CDB拔下<code class="codeph">test_cdb</code> ，然后插入到CDB <code class="codeph">prod_cdb</code> 。从<code class="codeph">test_cdb</code>中拔出此PDB时，其元数据存储在<code class="codeph">mypdb.xml</code>文件中。此元数据用于将<code class="codeph">my_pdb</code>插入<code class="codeph">prod_cdb</code> 。在源CDB <code class="codeph">test_cdb</code>中创建的<code class="codeph">my_pdb</code>备份存储在共享位置<code class="codeph">/oracle/database/backups</code> 。CDB <code class="codeph">prod_cdb</code>使用快速恢复区域来存储存档的重做日志文件。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>确保满足使用<a href="../rcmrf/RESTORE.html#RCMRF-GUID-4491C03F-C5F8-43E5-B4C4-FE26C70F2E9B" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a>中描述的预备份备份执行恢复的先决条件。</span></li>
                           <li class="stepexpand"><span>设置共享磁盘以与源目标主机共享在源上创建的预刷新备份。</span></li>
                           <li class="stepexpand"><span>启动RMAN并以具有<code class="codeph">SYSBABKUP</code>权限的普通用户身份连接到<code class="codeph">prod_cdb</code>的根目录。</span><div>
                                 <p>以下命令使用密码文件身份验证以具有<code class="codeph">SYSBACKUP</code>权限的公共用户身份连接到root。
                                 </p><pre class="pre codeblock"><code>CONNECT TARGET sbu @ prod_cdb as SYSBACKUP;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>关闭PDB <code class="codeph">my_pdb</code> 。</span><div><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE my_pdb立即关闭;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>将预包装容器设置为正在恢复的PDB。</span><div><pre class="pre codeblock"><code>SET PREPLUGIN CONTAINER = my_pdb;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>恢复<code class="codeph">my_pdb</code>使用的源CDB创建的preplugin备份<code class="codeph">test_cdb</code>之前<code class="codeph">my_pdb</code>被插在<code class="codeph">prod_cdb</code> 。</span><div><pre class="pre codeblock"><code>RESTORE PLUGGABLE DATABASE my_pdb FROM PREPLUGIN;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>使用预制备份备份恢复<code class="codeph">my_pdb</code> 。由于快速恢复区域配置为存储目标CDB的归档重做日志文件，因此必须为还原的预刷新归档重做日志文件指定备用目标。</span><div><pre class="pre codeblock"><code>RUN {SET ARCHIVELOG DESTINATION TO'/ disk1 / arc_dest /';从PREPLUGIN中恢复可插拔的数据库my_pdb; }</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>如果添加了任何数据文件到<code class="codeph">my_pdb</code>它是在给插上后<code class="codeph">prod_cdb</code> ，然后还原这些数据文件，然后恢复PDB <code class="codeph">my_pdb</code> 。</span><div>
                                 <p></p><pre class="pre codeblock"><code>RESTORE PLUGGABLE DATABASE my_pdb SKIP PREPLUGIN; RECOVER PLUGGABLE DATABASE my_pdb;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>打开PDB <code class="codeph">my_pdb</code> 。</span><div><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE my_pdb OPEN;</code></pre></div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div><a id="BRADV754"></a><a id="BRADV755"></a><a id="BRADV753"></a><div class="props_rev_3"><a id="GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934" name="GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934"></a><h4 id="BRADV-GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934" class="sect4"><span class="enumeration_section">17.4.6</span>使用RMAN在PDB中执行表空间或数据文件的完全恢复</h4>
                  <div>
                     <p>由于不同PDB中的表空间可以具有相同的名称，以消除歧义，因此必须直接连接到PDB以恢复其一个或多个表空间。相反，由于数据文件编号和路径在CDB中是唯一的，因此在恢复PDB数据文件时可以连接到根或PDB。</p>
                     <div class="section">
                        <p>如果连接到根，则可以使用单个命令从多个PDB恢复数据文件。如果连接到PDB，则只能恢复该PDB中的数据文件。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p></p>
                        <p><span class="bold">要在PDB中还原和恢复非SYSTEM表空间，请执行以下操作：</span></p>
                        <ol>
                           <li>
                              <p>完成恢复方案所需的准备步骤，如<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="您必须根据恢复目标以及丢失的数据库文件来规划数据库还原和恢复策略。">准备完整数据库恢复</a> ”中所述</span> 。
                              </p>
                           </li>
                           <li>
                              <p>启动RMAN。连接到目标数据库和恢复目录（如果使用），如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”中</span>所述<span class="q">。</span></p>
                           </li>
                           <li>
                              <p>如果数据库已打开，则需要使表空间需要脱机恢复。</p>
                              <p>例如，输入以下命令以使<code class="codeph">USERS</code>表空间脱机：</p><pre class="pre codeblock"><code>ALTER TABLESPACE用户立即离线;</code></pre></li>
                           <li>
                              <p>使用<code class="codeph">SHOW</code>命令查看预配置的通道。
                              </p>
                              <p>如果配置了必要的设备和通道，则无需执行任何操作。否则，您可以使用<code class="codeph">CONFIGURE</code>命令配置自动通道，或在<code class="codeph">RUN</code>块中包含<code class="codeph">ALLOCATE CHANNEL</code>命令。
                              </p>
                              <p></p>
                           </li>
                           <li>
                              <p>还原并恢复表空间。执行以下操作之一：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>如果要将数据文件还原到其原始位置，请在RMAN提示符下运行<code class="codeph">RESTORE TABLESPACE</code>和<code class="codeph">RECOVER TABLESPACE</code>命令。
                                    </p>
                                    <p>例如，如果配置了自动通道，请输入以下命令：</p><pre class="pre codeblock"><code>RMAN&gt; RESTORE TABLESPACE用户; RMAN&gt; RECOVER TABLESPACE用户;</code></pre></li>
                                 <li>
                                    <p>如果要将某些数据文件还原到新位置，请在<code class="codeph">RUN</code>命令中执行<code class="codeph">RESTORE TABLESPACE</code>和<code class="codeph">RECOVER TABLESPACE</code> 。使用<code class="codeph">SET NEWNAME</code>命令重命名数据文件。
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>检查输出以查看恢复是否成功。如果是这样，请将恢复的表空间重新联机。</p>
                              <p>例如，输入以下命令：</p><pre class="pre codeblock"><code>ALTER TABLESPACE用户在线;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><span class="bold">要在PDB中恢复和恢复SYSTEM表空间：</span></p>
                        <ol>
                           <li>
                              <p>完成恢复方案所需的准备步骤，如<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="您必须根据恢复目标以及丢失的数据库文件来规划数据库还原和恢复策略。">准备完整数据库恢复</a> ”中所述</span> 。
                              </p>
                           </li>
                           <li>
                              <p>启动RMAN。使用<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限以及恢复目录（如果使用）连接到root用户，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D" title="有几种方法可以将目标连接到根目录。">将目标连接到根目录</a> ”中所述</span> 。
                              </p>
                           </li>
                           <li>
                              <p>关闭CDB并以挂载模式重新启动它。</p><pre class="pre codeblock"><code>立即关闭;启动安装;</code></pre></li>
                           <li>
                              <p>还原并恢复存储受影响PDB的<code class="codeph">SYSTEM</code>表空间的数据文件。</p><pre class="pre codeblock"><code>RESTORE DATAFILE 2,3; RECOVER DATAFILE 2,3;</code></pre></li>
                           <li>
                              <p>打开CDB中的所有PDB。</p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE ALL OPEN READ WRITE;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><span class="bold">要恢复PDB中的非SYSTEM数据文件：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>完成恢复方案所需的准备步骤，如<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="您必须根据恢复目标以及丢失的数据库文件来规划数据库还原和恢复策略。">准备完整数据库恢复</a> ”中所述</span> 。</span></li>
                        <li class="stepexpand"><span>执行以下操作之一：</span><div>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>启动RMAN。使用<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限以及恢复目录（如果使用）连接到root <a href="glossary.html#GUID-2B102186-15BD-443C-B375-8CB0D442CF5F"><span class="xrefglossterm">用户</span></a> ，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D" title="有几种方法可以将目标连接到根目录。">将目标连接到根目录</a> ”中所述</span> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p>启动RMAN。以具有<code class="codeph">SYSDBA</code>权限的本地用户身份连接到PDB，并连接到恢复目录（如果使用），如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E95C5C27-C036-4773-B77C-E4120526F422" title="您可以从RMAN提示符或操作系统命令行连接到PDB。">将目标连接到PDB</a> ”中所述</span> 。
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>发出<code class="codeph">RESTORE DATAFILE</code>和<code class="codeph">RECOVER DATAFILE</code>命令。</span><div><pre class="oac_no_warn" dir="ltr">RESTORE DATAFILE 10,13; RECOVER DATAFILE 10,13;</pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934__GUID-DFF0BBD1-2174-4245-A6DB-8A12BE84A62F">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="rman-complete-database-recovery.html#GUID-A3DE37A6-3983-4834-858E-A2BCC3804681" title="如果无法将数据文件还原到其默认位置，则必须更新控制文件以反映数据文件的新位置。">关于将数据文件还原到非默认位置</a> ”</span></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV756"></a><div class="props_rev_3"><a id="GUID-97BD3A51-0AF1-46B0-B7DF-9F069C68F83F" name="GUID-97BD3A51-0AF1-46B0-B7DF-9F069C68F83F"></a><h4 id="BRADV-GUID-97BD3A51-0AF1-46B0-B7DF-9F069C68F83F" class="sect4"><span class="enumeration_section">17.4.7</span>使用云控制在PDB中执行表空间的完全恢复</h4>
                  <div>
                     <p>Oracle Enterprise Manager云控制（云控制）提供了一个用于恢复PDB中的表空间的界面。</p>
                     <div class="section">
                        <p><span class="bold">使用Cloud Control在PDB中执行表空间的完全恢复：</span></p>
                        <ol>
                           <li>
                              <p>从Database Home页面，从Availability菜单中选择<span class="bold">Backup＆Recovery</span> ，然后选择<span class="bold">Perform Recovery</span> 。
                              </p>
                           </li>
                           <li>
                              <p>如果以前未登录过数据库，则会显示“数据库登录”页面。使用“命名”或“新凭据” <span class="bold">登录</span>数据库，然后单击“ <span class="bold">登录”</span> 。
                              </p>
                              <p>Cloud Control显示“执行恢复”页面。</p>
                           </li>
                           <li>
                              <p>从“用户定向恢复”部分，从“恢复范围”下拉列表中选择“ <span class="bold">表空间</span> ”，然后单击“ <span class="bold">恢复”</span> 。
                              </p>
                           </li>
                           <li>
                              <p>在“执行对象级别恢复：时间点”页面上，确保选中“ <span class="bold">恢复到当前时间”</span> ，然后单击“ <span class="bold">下一步”</span> 。
                              </p>
                           </li>
                           <li>
                              <p>在“执行对象级别恢复：表空间”页面上，通过完成以下步骤选择要恢复的表空间：</p>
                              <ol type="a">
                                 <li>
                                    <p>单击“ <span class="bold">添加”</span>以显示“可用表空间”页面。
                                    </p>
                                    <p>“搜索结果”表显示所有可用的表空间，并包含每个表空间所属的PDB的名称。</p>
                                 </li>
                                 <li>
                                    <p>单击“ <span class="bold">选择”</span>以指定要恢复的表空间。（可选）您可以单击“全<span class="bold">选”</span>以打开所有可用表空间的“选择”选项。单击“ <span class="bold">选择无”</span>以取消选择所有表空间。
                                    </p>
                                 </li>
                                 <li>
                                    <p>单击“ <span class="bold">选择”</span>按钮返回“执行对象级别恢复：表空间”页面。
                                    </p>
                                 </li>
                                 <li>
                                    <p>（可选）您可以通过为要删除的每个表空间启用“选择”选项，然后单击“ <span class="bold">删除”</span>来从表中删除表空间。
                                    </p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>单击“ <span class="bold">下一步”</span>以转到向导中的下一步。
                              </p>
                           </li>
                           <li>
                              <p>通过浏览其余页面来完成向导以恢复PDB表空间。有关向导的每个页面的更多信息，请单击“ <span class="bold">帮助”</span> 。
                              </p>
                           </li>
                        </ol>
                        <div class="infoboxnotealso" id="GUID-97BD3A51-0AF1-46B0-B7DF-9F069C68F83F__GUID-1A8A7785-7DCC-4E66-BEFD-982544C71CF6">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="introduction-backup-recovery.html#GUID-7557D8F6-2DC8-460A-8453-74E73DEF8705" title="数据库主页是Oracle企业管理器云控制（云控制）中的主数据库管理页面。">使用云控制访问数据库主页</a> ”</span></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV757"></a><div class="props_rev_3"><a id="GUID-9A824454-8577-4899-BD69-E631B573021F" name="GUID-9A824454-8577-4899-BD69-E631B573021F"></a><h4 id="BRADV-GUID-9A824454-8577-4899-BD69-E631B573021F" class="sect4"><span class="enumeration_section">17.4.8</span>切换到拷贝后执行CDB的完全恢复</h4>
                  <div>
                     <p>通过切换到副本来恢复CDB比传统的恢复和恢复更快。</p>
                     <div class="section">
                        <p>如果CDB或PDB中有无法访问的数据文件的映像副本，则可以使用<code class="codeph">SWITCH</code>命令将控制文件指向数据文件副本，从而恢复丢失的更改。
                        </p>
                        <div class="infoboxnotealso" id="GUID-9A824454-8577-4899-BD69-E631B573021F__GUID-F782D35A-1964-44D6-9D59-666BB05E7A56">
                           <p class="notep1">也可以看看：</p>
                           <p>对于恢复程序中使用的一些假设， <span class="q">“ <a href="rman-complete-database-recovery.html#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" title="本章中描述的完整恢复操作受特定条件的限制。">本章的范围</a> ”</span></p>
                        </div>
                        <p><span class="bold">要在CDB中切换数据文件：</span></p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>连接到根并使用与非CDB相同的步骤，如<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-27F3EB09-3608-4E0E-A7F0-1F0DF1D5C572" title="当一个或多个数据文件损坏时，您可以通过切换到损坏的数据文件的现有映像副本来执行恢复。">切换到数据文件副本后执行恢复</a> ”中所述</span> 。
                              </p>
                           </li>
                        </ul>
                        <p>要在PDB中切换数据文件，请使用以下技术之一：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>连接到root并使用<code class="codeph">SWITCH ...PLUGGABLE DATABASE</code>或<code class="codeph">SWITCH DATAFILE</code>命令。这使您可以切换一个或多个PDB的数据文件。
                              </p>
                           </li>
                           <li>
                              <p>连接到PDB并使用<code class="codeph">SWITCH DATABASE</code>或<code class="codeph">SWITCH DATAFILE</code>命令切换该PDB中的数据文件。</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-9A824454-8577-4899-BD69-E631B573021F__GUID-E0C04B57-7431-4B20-96C6-E2CD46FD7675">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="您可以将RMAN客户端连接到多租户容器数据库（CDB）和可插拔数据库（PDB）。">与CDB建立RMAN连接</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-B852BD56-E872-4173-9EE9-96D1273B2CCF" name="GUID-B852BD56-E872-4173-9EE9-96D1273B2CCF"></a><h3 id="BRADV-GUID-B852BD56-E872-4173-9EE9-96D1273B2CCF" class="sect3"><span class="enumeration_section">17.5</span>执行应用程序容器的完全恢复</h3>
               <div>
                  <p>RMAN使您可以使用<code class="codeph">RESTORE</code>和<code class="codeph">RECOVER</code>命令执行应用程序容器的完全恢复，而不会影响CDB中的其他容器。</p>
                  <p></p>
                  <div class="infoboxnotealso" id="GUID-B852BD56-E872-4173-9EE9-96D1273B2CCF__GUID-A1EEC59F-9742-4E62-A087-0A755C9E5E00">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-EB61F66E-9BC1-4CA5-B92B-9A955871ED68" title="使用RESTORE和RECOVER命令执行应用程序根目录的完全恢复。">执行应用程序根的完全恢复</a></p>
                        </li>
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-85F841AA-89AC-458C-ABEE-3E831D242291" title="您可以执行应用程序容器的完全恢复，其中包括应用程序根目录及其所有应用程序PDB，而不会影响CDB中的其他PDB。">执行应用程序根和应用程序PDB的完全恢复</a></p>
                        </li>
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-535D529F-9F34-4FF6-A8F3-D7A0F893C5F9" title="使用RESTORE和RECOVER命令执行一个或多个应用程序PDB的完全恢复。">执行应用程序PDB的完全恢复</a></p>
                        </li>
                     </ul>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-EB61F66E-9BC1-4CA5-B92B-9A955871ED68" name="GUID-EB61F66E-9BC1-4CA5-B92B-9A955871ED68"></a><h4 id="BRADV-GUID-EB61F66E-9BC1-4CA5-B92B-9A955871ED68" class="sect4"><span class="enumeration_section">17.5.1</span>执行应用程序根的完全恢复</h4>
                  <div>
                     <p>使用<code class="codeph">RESTORE</code>和<code class="codeph">RECOVER</code>命令执行应用程序根目录的完全恢复。
                     </p>
                     <div class="p">CDB的<code class="codeph">COMPATIBLE</code>参数必须设置为19.0或更高。
                     </div>
                     <!-- class="section" -->
                     <div class="p">
                        <p></p>
                        <p><span class="bold">在连接到CDB中的根时恢复应用程序根目录</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>执行以下步骤之一：</span><div>
                              <ul id="GUID-EB61F66E-9BC1-4CA5-B92B-9A955871ED68__UL_LJF_CNJ_CGB" style="list-style-type:disc">
                                 <li>
                                    <p>启动RMAN并以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的应用程序通用用户身份连接到<a href="glossary.html#GUID-CC9EB948-16BC-4AB6-A05E-08EEAFCDD05F"><span class="xrefglossterm">应用程序根目录</span></a> 。
                                    </p>
                                    <p>应用程序根目录有自己的服务名称，您可以使用与连接到PDB相同的方式连接到应用程序根目录。</p>
                                 </li>
                                 <li>
                                    <p>启动RMAN并以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的公共用户身份连接到CDB根目录。
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>关闭需要恢复其应用程序根的应用程序容器。</span><div>
                              <p>连接到应用程序根目录或CDB时，使用以下命令关闭其应用程序根名为<code class="codeph">hr_appcont</code>的应用程序容器：</p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE hr_appcont CLOSE;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>（可选）使用<code class="codeph">CONFIGURE</code>命令配置默认设备类型和自动通道。</span></li>
                        <li class="stepexpand"><span>还原并恢复应用程序根目录。</span><div>
                              <p>以下命令可还原和恢复名为hr_appcont的应用程序根目录：</p><pre class="pre codeblock"><code>RESTORE APPLICATION ROOT DATABASE hr_appcont;恢复应用程序根数据库hr_appcont;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>检查输出以查看介质恢复是否成功。如果是，请继续执行下一步。</span></li>
                        <li class="stepexpand"><span>打开应用程序根目录。</span><div>
                              <p>连接到应用程序根目录时，请使用以下命令：</p><pre class="pre codeblock"><code>ALTER DATABASE OPEN;</code></pre><p>连接到CDB时，请使用以下命令：</p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE hr_appcont OPEN;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-EB61F66E-9BC1-4CA5-B92B-9A955871ED68__GUID-60D8189C-D2E5-4A39-A9D6-EE123C3E5B83">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="您可以将RMAN客户端连接到多租户容器数据库（CDB）和可插拔数据库（PDB）。">与CDB建立RMAN连接</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-85F841AA-89AC-458C-ABEE-3E831D242291" name="GUID-85F841AA-89AC-458C-ABEE-3E831D242291"></a><h4 id="BRADV-GUID-85F841AA-89AC-458C-ABEE-3E831D242291" class="sect4"><span class="enumeration_section">17.5.2</span>执行应用程序根和应用程序PDB的完全恢复</h4>
                  <div>
                     <p>您可以执行应用程序容器的完全恢复，其中包括应用程序根目录及其所有应用程序PDB，而不会影响CDB中的其他PDB。</p>
                     <div class="p">
                        <p></p>
                     </div>
                     <!-- class="section" -->
                     <div class="p">CDB的<code class="codeph">COMPATIBLE</code>参数必须设置为12.2或更高。
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><span class="bold">要执行应用程序根及其所有应用程序PDB的完全恢复，请执行以下操作：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的应用程序通用用户身份连接到<a href="glossary.html#GUID-CC9EB948-16BC-4AB6-A05E-08EEAFCDD05F"><span class="xrefglossterm">应用程序根目录</span></a> 。</span><div>应用程序根目录有自己的服务名称，您可以使用与连接到PDB相同的方式连接到应用程序根目录。</div>
                        </li>
                        <li class="stepexpand"><span>关闭应用程序容器。</span><div>
                              <p>以下命令将关闭其应用程序根名为<code class="codeph">hr_appcont</code>的应用程序容器：</p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE hr_appcont CLOSE;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>（可选）使用<code class="codeph">CONFIGURE</code>命令配置默认设备类型和自动通道。</span></li>
                        <li class="stepexpand"><span>使用以下命令还原和恢复应用程序容器（应用程序根和所有应用程序PDB）。</span><div><pre class="pre codeblock"><code>RESTORE DATABASE;恢复数据库;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>检查输出以查看介质恢复是否成功。如果是，请继续执行下一步。</span></li>
                        <li class="stepexpand"><span>打开应用程序根目录和所有应用程序PDB。</span><div><pre class="pre codeblock"><code>ALTER DATABASE OPEN; ALTER PLUGGABLE DATABASE ALL OPEN;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-85F841AA-89AC-458C-ABEE-3E831D242291__GUID-8ED0F447-B225-4905-872E-6292BAB4C4BB">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="您可以将RMAN客户端连接到多租户容器数据库（CDB）和可插拔数据库（PDB）。">与CDB建立RMAN连接</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-535D529F-9F34-4FF6-A8F3-D7A0F893C5F9" name="GUID-535D529F-9F34-4FF6-A8F3-D7A0F893C5F9"></a><h4 id="BRADV-GUID-535D529F-9F34-4FF6-A8F3-D7A0F893C5F9" class="sect4"><span class="enumeration_section">17.5.3</span>执行应用程序PDB的完全恢复</h4>
                  <div>
                     <p>使用<code class="codeph">RESTORE</code>和<code class="codeph">RECOVER</code>命令执行一个或多个应用程序PDB的完全恢复。
                     </p>
                     <div class="p">
                        <p></p>
                     </div>
                     <!-- class="section" -->
                     <div class="p">CDB的<code class="codeph">COMPATIBLE</code>参数必须设置为12.2或更高。
                     </div>
                     <!-- class="section" -->
                     <div class="section"><span class="bold">要执行应用程序PDB的完全恢复：</span></div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并建立以下类型的连接之一：</span><div>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的应用程序通用用户身份连接到<a href="glossary.html#GUID-CC9EB948-16BC-4AB6-A05E-08EEAFCDD05F"><span class="xrefglossterm">应用程序根目录</span></a> 。
                                    </p>
                                    <p>应用程序根目录有自己的服务名称，您可以使用与连接到PDB相同的方式连接到应用程序根目录。</p>
                                 </li>
                                 <li>
                                    <p>使用<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限以普通用户身份连接到CDB根目录。
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>关闭需要完全恢复的<a href="glossary.html#GUID-6E2F65AE-C36C-446D-84D7-4F709C7DEBCE"><span class="xrefglossterm">应用程序PDB</span></a> 。</span><div>
                              <p>以下命令关闭名为<code class="codeph">hr_appcont_pdb1</code>的应用程序PDB：</p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE hr_appcont_pdb1关闭;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>（可选）使用<code class="codeph">CONFIGURE</code>命令配置默认设备类型和自动通道。</span></li>
                        <li class="stepexpand"><span>恢复并恢复应用程序PDB。</span><div>
                              <p>以下命令执行名为<code class="codeph">hr_appcont_pdb1</code>的应用程序PDB的完全恢复</p><pre class="pre codeblock"><code>RESTORE PLUGGABLE DATABASE hr_appcont_pdb1; RECOVER PLUGGABLE DATABASE hr_appcont_pdb1;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>检查输出以查看介质恢复是否成功。如果是，请继续执行下一步。</span></li>
                        <li class="stepexpand"><span>打开应用程序PDB。</span><div>
                              <p>以下命令将打开名为<code class="codeph">hr_appcont_pdb1</code>的应用程序PDB：</p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE hr_appcont_pdb1 OPEN;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-535D529F-9F34-4FF6-A8F3-D7A0F893C5F9__GUID-1505F605-EFEC-4F60-A3B5-F5670EFB3BF1">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="您可以将RMAN客户端连接到多租户容器数据库（CDB）和可插拔数据库（PDB）。">与CDB建立RMAN连接</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-D5AFD861-FCA5-4BE6-913F-6C4B6C96A063" name="GUID-D5AFD861-FCA5-4BE6-913F-6C4B6C96A063"></a><h3 id="BRADV-GUID-D5AFD861-FCA5-4BE6-913F-6C4B6C96A063" class="sect3"><span class="enumeration_section">17.6</span>使用RMAN执行稀疏数据库的完全恢复</h3>
               <div>
                  <p>您可以使用<code class="codeph">RESTORE</code>和<code class="codeph">RECOVER</code>命令将稀疏数据库恢复到最近的时间点。
                  </p>
                  <div class="p">本节包含以下主题：<ul style="list-style-type:disc">
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-C8453C47-BA71-4272-B0D4-BC7B97EC2584" title="执行包含稀疏数据文件的数据库的恢复与执行整个数据库的恢复非常相似。">执行稀疏数据库的完全恢复</a></p>
                        </li>
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-9E0A0ABF-4DC9-4DF6-9015-004868ACB01C" title="执行稀疏CDB的恢复与执行稀疏数据库的完全恢复非常相似。">执行稀疏CDB的完全恢复</a></p>
                        </li>
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-C7DF025E-B8DF-4686-876D-AAE28E7869CF" title="在根级别或CDB级别连接时，可以恢复稀疏PDB。">使用RMAN执行稀疏PDB的恢复</a></p>
                        </li>
                     </ul>
                  </div>
                  <div class="infoboxnote" id="GUID-D5AFD861-FCA5-4BE6-913F-6C4B6C96A063__GUID-7B4D23C3-30E0-4AB5-89A0-0911690858E6">
                     <p class="notep1">注意：</p>
                     <p>稀疏数据库中的基本（只读）数据文件未加密。确保基础数据文件存储在受保护的存储中，并使用安全通信进行访问。</p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-C8453C47-BA71-4272-B0D4-BC7B97EC2584" name="GUID-C8453C47-BA71-4272-B0D4-BC7B97EC2584"></a><h4 id="BRADV-GUID-C8453C47-BA71-4272-B0D4-BC7B97EC2584" class="sect4"><span class="enumeration_section">17.6.1</span>执行稀疏数据库的完全恢复</h4>
                  <div>
                     <p>执行包含稀疏数据文件的数据库的恢复与执行整个数据库的恢复非常相似。</p>
                     <div class="section">RMAN首先恢复从数据库的增量存储空间备份的逻辑数据，然后通过读取重做日志并应用逻辑数据文件块来恢复数据库。您可以执行稀疏数据库，表空间或数据文件的完全恢复或时间点恢复。</div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><span class="bold">要恢复稀疏数据库：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>完成恢复方案所需的准备步骤，如<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="您必须根据恢复目标以及丢失的数据库文件来规划数据库还原和恢复策略。">准备完整数据库恢复</a> ”中所述</span> 。</span></li>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”中所述</span> 。</span></li>
                        <li class="stepexpand"><span>如果未装入数据库，则装入但不要打开数据库。</span><div>
                              <p>例如，输入以下命令：</p><pre class="oac_no_warn" dir="ltr">启动安装;</pre></div>
                        </li>
                        <li class="stepexpand"><span>使用<code class="codeph">SHOW</code>命令查看预配置的通道。</span><div>
                              <p>如果配置了必要的设备和通道，则无需执行任何操作。否则，您可以使用<code class="codeph">CONFIGURE</code>命令配置自动通道，或在<code class="codeph">RUN</code>块中包含<code class="codeph">ALLOCATE CHANNEL</code>命令。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>还原并恢复稀疏数据库。以下命令执行稀疏数据库的完全恢复：</span><div><pre class="pre codeblock"><code>从SPARSE DATABASE恢复;恢复数据库;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>要恢复包含稀疏数据文件的特定表空间，请对表空间使用<code class="codeph">RESTORE</code>和<code class="codeph">RECOVER</code>命令。</span><div>以下示例恢复并恢复表空间<code class="codeph">MY_TBS</code><pre class="pre codeblock"><code>从SPARSE TABLESPACE MY_TBS恢复; RECOVER TABLESPACE MY_TBS;</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-9E0A0ABF-4DC9-4DF6-9015-004868ACB01C" name="GUID-9E0A0ABF-4DC9-4DF6-9015-004868ACB01C"></a><h4 id="BRADV-GUID-9E0A0ABF-4DC9-4DF6-9015-004868ACB01C" class="sect4"><span class="enumeration_section">17.6.2</span>执行稀疏CDB的完全恢复</h4>
                  <div>
                     <p>执行稀疏CDB的恢复与执行稀疏数据库的完全恢复非常相似。</p>
                     <div class="section">
                        <p><span class="bold">要恢复稀疏的CDB：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>完成方案所需的准备步骤，如<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="您必须根据恢复目标以及丢失的数据库文件来规划数据库还原和恢复策略。">准备完整数据库恢复</a> ”中所述</span> 。</span></li>
                        <li class="stepexpand"><span>启动RMAN并以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的公共用户身份连接到根，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”中所述</span> 。</span></li>
                        <li class="stepexpand"><span>如果未安装CDB，则安装但不要打开CDB。</span><div>
                              <p>例如，输入以下命令：</p><pre class="oac_no_warn" dir="ltr">启动安装;</pre></div>
                        </li>
                        <li class="stepexpand"><span>使用<code class="codeph">SHOW</code>命令查看预配置的通道。</span><div>
                              <p>如果配置了必要的设备和通道，则无需执行任何操作。否则，您可以使用<code class="codeph">CONFIGURE</code>命令配置自动通道，或在<code class="codeph">RUN</code>块中包含<code class="codeph">ALLOCATE CHANNEL</code>命令。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>恢复并恢复稀疏CDB。以下命令执行稀疏CDB的完全恢复：</span><div><pre class="pre codeblock"><code>从SPARSE DATABASE恢复;恢复数据库;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>要恢复包含稀疏数据文件的特定表空间，请对表空间使用<code class="codeph">RESTORE</code>和<code class="codeph">RECOVER</code>命令。</span><div>以下示例恢复并恢复表空间<code class="codeph">MY_TBS</code><pre class="pre codeblock"><code>从SPARSE TABLESPACE MY_TBS恢复; RECOVER TABLESPACE MY_TBS;</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-C7DF025E-B8DF-4686-876D-AAE28E7869CF" name="GUID-C7DF025E-B8DF-4686-876D-AAE28E7869CF"></a><h4 id="BRADV-GUID-C7DF025E-B8DF-4686-876D-AAE28E7869CF" class="sect4"><span class="enumeration_section">17.6.3</span>使用RMAN执行稀疏PDB的恢复</h4>
                  <div>
                     <p>在根级别或CDB级别连接时，可以恢复稀疏PDB。</p>
                     <div class="section"></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><span class="bold">在连接到根时恢复一个或多个稀疏PDB：</span></p>
                        <ol>
                           <li>
                              <p>完成恢复方案所需的准备步骤，如<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="您必须根据恢复目标以及丢失的数据库文件来规划数据库还原和恢复策略。">准备完整数据库恢复</a> ”中所述</span> 。
                              </p>
                           </li>
                           <li>
                              <p>启动RMAN并以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的公共用户身份连接到根，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="您可以将RMAN客户端连接到多租户容器数据库（CDB）和可插拔数据库（PDB）。">将RMAN连接到CDB</a> ”中所述</span> 。
                              </p>
                           </li>
                           <li>
                              <p>关闭要恢复的PDB。</p><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE销售，小时关闭;</pre><p>如果缺少任何数据文件，则会发生错误，您无法关闭PDB。然后，您必须连接到丢失的数据文件所属的PDB，使丢失的数据文件脱机，然后关闭PDB。</p>
                              <p>以下命令使数据文件12脱机：</p><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE DATAFILE 12 OFFLINE;</pre><div class="infoboxnote" id="GUID-C7DF025E-B8DF-4686-876D-AAE28E7869CF__GUID-BC3A98D5-DE8A-41FC-8558-750A70A8A5F1">
                                 <p class="notep1">注意：</p>
                                 <p>如果缺少存储PDB的<code class="codeph">SYSTEM</code>表空间的数据文件，请按照<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934" title="Because tablespaces in different PDBs can have the same name, to eliminate ambiguity, you must connect directly to a PDB to recover one or more of its tablespaces. In contrast, because data file numbers and paths are unique across the CDB, you can connect either to the root or to a PDB when recovering PDB data files.">使用RMAN在PDB中执行表空间或数据文件的完全恢复</a> ”中</span>所述的恢复步骤<span class="q"><a href="rman-complete-database-recovery.html#GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934" title="由于不同PDB中的表空间可以具有相同的名称，以消除歧义，因此必须直接连接到PDB以恢复其一个或多个表空间。相反，由于数据文件编号和路径在CDB中是唯一的，因此在恢复PDB数据文件时可以连接到根或PDB。">进行操作</a></span> 。
                                 </p>
                              </div>
                           </li>
                           <li>
                              <p>（可选）使用<code class="codeph">CONFIGURE</code>命令配置默认设备类型和自动通道。
                              </p>
                           </li>
                           <li>
                              <p>运行可插拔数据库的<code class="codeph">RESTORE</code>和<code class="codeph">RECOVER</code>命令。
                              </p>
                              <div class="p">以下示例在连接到根目录时执行PDB <code class="codeph">HR_PDB</code>完全恢复：<pre class="pre codeblock"><code>从SPARSE PLUGGABLE DATABASE HR_PDB恢复; RECOVER PLUGGABLE DATABASE HR_PDB;</code></pre></div>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C7DF025E-B8DF-4686-876D-AAE28E7869CF__GUID-C59DB10A-2FFE-4EF4-9AC8-D6185AA36E60">连接并恢复一个稀疏PDB：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>完成恢复方案所需的准备步骤，如<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="您必须根据恢复目标以及丢失的数据库文件来规划数据库还原和恢复策略。">准备完整数据库恢复</a> ”中所述</span> 。</span></li>
                        <li class="stepexpand"><span>启动RMAN并以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>系统特权的<a href="glossary.html#GUID-43EA1A4C-E5EB-4926-99EC-1DDA0E74A07C"><span class="xrefglossterm">本地用户</span></a>身份连接到PDB，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="您可以将RMAN客户端连接到多租户容器数据库（CDB）和可插拔数据库（PDB）。">使RMAN连接到CDB</a> ”中所述</span> 。</span></li>
                        <li class="stepexpand"><span>关闭PDB。</span><div><pre class="oac_no_warn" dir="ltr">ALTER PLOGGABLE DATABASE CLOSE;</pre><p>如果缺少任何数据文件，则会发生错误，您无法关闭PDB。您必须使丢失的数据文件脱机，然后关闭PDB。</p>
                              <p>以下命令使数据文件12脱机：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE DATAFILE 12 OFFLINE;</pre><div class="infoboxnote" id="GUID-C7DF025E-B8DF-4686-876D-AAE28E7869CF__GUID-4AAF369F-0C9E-4319-BD15-A6BB51DDB0EC">
                                 <p class="notep1">注意：</p>
                                 <p>如果缺少存储PDB的<code class="codeph">SYSTEM</code>表空间的数据文件，请按照<span class="q">“ <a href="rman-complete-database-recovery.html#GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934" title="Because tablespaces in different PDBs can have the same name, to eliminate ambiguity, you must connect directly to a PDB to recover one or more of its tablespaces. In contrast, because data file numbers and paths are unique across the CDB, you can connect either to the root or to a PDB when recovering PDB data files.">使用RMAN在PDB中执行表空间或数据文件的完全恢复</a> ”中</span>所述的恢复步骤<span class="q"><a href="rman-complete-database-recovery.html#GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934" title="由于不同PDB中的表空间可以具有相同的名称，以消除歧义，因此必须直接连接到PDB以恢复其一个或多个表空间。相反，由于数据文件编号和路径在CDB中是唯一的，因此在恢复PDB数据文件时可以连接到根或PDB。">进行操作</a></span> 。
                                 </p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>（可选）使用<code class="codeph">CONFIGURE</code>命令配置默认设备类型和自动通道。</span></li>
                        <li class="stepexpand"><span>发出<code class="codeph">RESTORE</code>和<code class="codeph">RECOVER</code>命令。</span><div>以下示例恢复并恢复PDB <code class="codeph">USERS_PDB</code><pre class="pre codeblock"><code>从USERS_PDB恢复SPARSE DATABASE; RECOVER DATABASE USERS_PDB;</code></pre>。</div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>