<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>更新员工记录</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="2 Day + Java Developer&#39;s Guide "></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="2 Day + Java Developer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="2-day-java-developers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-02-12T07:23:23-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2007, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96442-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="search-employee-id.html" title="Previous" type="text/html"></link>
      <link rel="next" href="best-practices.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="2 Day + Java Developer&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="TDPJD"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="search-employee-id.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="best-practices.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">2天+ Java开发人员指南</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">更新员工记录</li>
            </ol>
            <a id="GUID-927C853F-5A00-45CD-9F88-F820B39ABD25" name="GUID-927C853F-5A00-45CD-9F88-F820B39ABD25"></a>
            
            <h2 id="TDPJD-GUID-927C853F-5A00-45CD-9F88-F820B39ABD25" class="sect2"><span class="enumeration_chapter">7</span>更新员工记录</h2>
         </header>
         <div class="ind">
            <div>
               <p><span class="bold">hradmin</span>有权更新员工记录。<span class="bold">hrstaff</span>用户没有此权限。
               </p>
               <p>首先，您必须在记录中搜索员工。一旦您检索到与员工相关的信息，您将找到“编辑”和“删除”选项以修改与员工相关的详细信息。</p>
               <p>本章向您展示了需要创建的类以及需要添加的代码，以构建“按员工ID搜索”功能。</p>
               <p>在本章中，您将学习如何：</p>
               <p>1。在<span class="italic">EmployeeBean.java中</span>声明一个新的新方法<span class="italic">getEmployeeByFn（String）</span> 
               </p>
               <p>2。在<span class="italic">EmployeeBean.java中</span>声明一个新方法<span class="italic">updateEmployee（int）</span></p>
               <p>3。在<span class="italic">EmployeeBeanImpl.java中</span>实现一个新方法<span class="italic">getEmployeeByFn（String）</span></p>
               <p>4。在<span class="italic">EmployeeBeanImpl.java中</span>实现一个新方法<span class="italic">updateEmployee（int）</span></p>
               <p>5。将代码添加到<span class="italic">WebController.java</span>以处理请求和响应</p>
               <p>6。创建一个HTML页面（ <span class="italic">listByName.html</span> ）以显示结果</p>
               <p></p>
               <p><span class="bold">班级名称：</span></p>
               <p><code class="codeph">的src /主/ JAVA / COM / ORACLE / JDBC /样品/实体/ Employee.java</code></p>
               <p></p>
               <p>使用您在示例前面创建的<code class="codeph">Employee.java</code>文件。
               </p>
            </div>
            <div class="sect2"><a id="GUID-E8E28FC7-3C53-4CA2-97D2-5D89F164A044" name="GUID-E8E28FC7-3C53-4CA2-97D2-5D89F164A044"></a><h3 id="TDPJD-GUID-E8E28FC7-3C53-4CA2-97D2-5D89F164A044" class="sect3">在EmployeeBean.java中声明一个新方法<span class="italic">getEmployeeByFn（String）</span></h3>
               <div>
                  <p><span class="bold">类名：</span> src / main / java / com / oracle / jdbc / samples / bean / EmployeeBean.java</p>
                  <p><span class="bold">Github位置：</span> <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/java/com/oracle/jdbc/samples/bean/JdbcBean.java" target="_blank">EmployeeBean.java</a></p>
                  <p><span class="bold">描述：</span>方法<code class="codeph">getEmployeeByFn</code> <code class="codeph">(String)</code>可帮助您根据员工的名字搜索员工。
                  </p>
                  <p>要修改员工的详细信息， <span class="bold">hradmin</span>必须首先根据他/她的名字搜索员工。
                  </p>
                  <p>要执行的步骤：</p>
                  <p><span class="bold">第1步：声明方法</span> <code class="codeph">getEmployeeByFn(String)</code><code class="codeph"></code></p>
                  <p>步骤1：声明getEmployeeByFn（String）方法的说明：</p>
                  <p>1。使用您在练习的第1天创建的类EmployeeBean。您可以为每个功能添加新方法。</p>
                  <p>2。声明一个以名字作为参数的<code class="codeph">getEmployeeByFn(String)</code>方法。
                  </p>
                  <p><code class="codeph">public List &lt;Employee&gt; getEmployeeByFn（String fn）抛出SQLException;</code></p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-B90255F8-6234-458B-B6E7-DB70D01570DF" name="GUID-B90255F8-6234-458B-B6E7-DB70D01570DF"></a><h3 id="TDPJD-GUID-B90255F8-6234-458B-B6E7-DB70D01570DF" class="sect3">声明一个新方法<span class="italic">updateEmployee（Employee）</span> 
               </h3>
               <div>
                  <p><span class="bold">类名：</span> <code class="codeph">src/main/java/com/oracle/jdbc/samples/bean/EmployeeBean.java</code> 。
                  </p>
                  <p><span class="bold">Github位置：</span> <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/java/com/oracle/jdbc/samples/bean/JdbcBean.java" target="_blank">EmployeeBean.java</a></p>
                  <p><span class="bold">描述：</span>此方法允许您更新员工的属性，例如名字，姓氏，工资，job_id等</p>
                  <p><span class="bold">要执行的步骤：</span></p>
                  <p><span class="bold">第2步：声明方法<span class="italic">updateEmployee（Employee）</span></span> 
                  </p>
                  <p><span class="bold">声明<code class="codeph">updateEmployee(Employee)</code>方法的说明</span></p>
                  <p>1。使用您在第1天练习中为“ <code class="codeph">ListAll</code> ”功能创建的<code class="codeph">EmployeeBean</code>文件。您可以使用相同的类并为新功能添加新方法。
                  </p>
                  <p>2。声明一个以Employee对象作为参数的方法<code class="codeph">updateEmployee(Employee)</code> 。
                  </p>
                  <p><code class="codeph">public String updateEmployee（Employee employee）抛出SQLException;</code></p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-676ED6A0-E20B-4BD3-87FF-0C5859DEF3CE" name="GUID-676ED6A0-E20B-4BD3-87FF-0C5859DEF3CE"></a><h3 id="TDPJD-GUID-676ED6A0-E20B-4BD3-87FF-0C5859DEF3CE" class="sect3">为Employee名称搜索实现一个新方法<code class="codeph">getEmployeebyFn()</code></h3>
               <div>
                  <p><span class="bold">班级名称：</span></p>
                  <p><code class="codeph">的src /主/ JAVA / COM / ORACLE / JDBC /样品/豆腐/ JdbcBeanImpl.java</code></p>
                  <p><span class="bold">Github位置：</span> <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/java/com/oracle/jdbc/samples/bean/JdbcBeanImpl.java" target="_blank">EmployeeBeanImpl.java</a></p>
                  <p>描述：实现一个新方法<code class="codeph">getEmployeeByFn(String)</code>以按员工ID搜索。此方法使用employee id作为输入参数，并返回Employee类型的对象。
                  </p>
                  <p><span class="bold">要执行的步骤：</span> <span class="bold"></span>实现方法<code class="codeph">getEmployeeByFn(String)</code></p>
                  <p><span class="bold">实现</span> <code class="codeph">getEmployeeByFn(String)</code> <span class="bold">方法的说明</span> ：</p>
                  <p>1。声明返回Employee对象的<code class="codeph">getEmployeeByFn(String)</code> 。
                  </p>
                  <p><code class="codeph">public List &lt;Employee&gt; getEmployeeByFn（String fn）抛出SQLException {</code></p>
                  <p>2。为<code class="codeph">List&lt;Employee&gt;</code>类型的返回值声明一个变量</p>
                  <p><code class="codeph">List &lt;Employee&gt; returnValue = new ArrayList &lt;&gt;（）;</code></p>
                  <p>3。创建一个<code class="codeph">try</code>块。<code class="codeph">try</code>块将通过调用<code class="codeph">getConnection</code>方法帮助您创建数据库连接。
                  </p>
                  <p><code class="codeph">try（Connection connection = getConnection（））{</code></p>
                  <p>4。创建另一个<code class="codeph">try</code>块以创建<code class="codeph">PreparedStatement</code> 。添加将执行的查询以根据员工ID选择员工。
                  </p>
                  <div class="p"><pre class="pre codeblock"><code>try（PreparedStatement preparedStatement = connection.prepareStatement（“SELECT Employee_Id，First_Name，Last_Name，Email，Phone_Number，Job_Id，EFALOYEES WHEAR First_Name LIKE？“））{</code></pre>5。设置输入参数 - 员工的名字。该方法的输入参数设置为<code class="codeph">preparedStatement</code>的IN参数。
                  </div>
                  <p><code class="codeph">preparedStatement.setString（1，fn +'％'）;</code></p>
                  <p>6。为<code class="codeph">ResultSet</code>创建另一个<code class="codeph">try</code>块。包括需要执行的查询。
                  </p>
                  <p><code class="codeph">try（ResultSet resultSet = preparedStatement.executeQuery（））{</code></p>
                  <p>7。包含while语句以循环结果。如果找到任何记录，请将其添加到<code class="codeph">returnValue</code> 。
                  </p>
                  <div class="p"><pre class="pre codeblock"><code>while（resultSet.next（））{returnValue.add（new Employee（resultSet））; }</code></pre>8。确保关闭所有<code class="codeph">try</code>块的括号。
                  </div>
                  <p>9。捕获<code class="codeph">SQLException</code>并在记录器中记录消息。
                  </p>
                  <div class="p"><pre class="pre codeblock"><code>catch（SQLException ex）{logger.log（Level。SEVERE，null，ex）;抛出前}</code></pre>10。从方法<code class="codeph">getEmployee(int)</code>返回员工列表</div>
                  <p><code class="codeph">return returnValue;</code></p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-99AB7C3E-B414-484E-ABF8-09FCD3BFA7A3" name="GUID-99AB7C3E-B414-484E-ABF8-09FCD3BFA7A3"></a><h3 id="TDPJD-GUID-99AB7C3E-B414-484E-ABF8-09FCD3BFA7A3" class="sect3">实现新方法<span class="italic">updateEmployee（Employee）</span></h3>
               <div>
                  <p></p>
                  <p><span class="bold">类名：</span> src / main / java / com / oracle / jdbc / samples / bean / EmployeeBeanImpl.java。
                  </p>
                  <p><span class="bold">Github位置：</span> <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/java/com/oracle/jdbc/samples/bean/JdbcBeanImpl.java" target="_blank">EmployeeBeanImpl.java</a></p>
                  <p><span class="bold">描述：</span> <code class="codeph">updateEmployee(Employee)</code>方法使您可以更新员工记录中的员工详细信息，例如first_name，last_name等。
                  </p>
                  <p><span class="bold">要执行的步骤：</span> <span class="bold">实现方法</span> <code class="codeph">updateEmployee(Employee)</code></p>
                  <p><span class="bold">实现<code class="codeph">UpdateEmployee(Employee)</code>方法的说明：</span><span class="bold"></span></p>
                  <p>1。声明方法<code class="codeph">updateEmployee(Employee)</code> 。
                  </p>
                  <p><code class="codeph">public String updateEmployee（Employee employee）抛出SQLException {</code></p>
                  <p>2。声明并初始化变量以捕获更新的记录数。</p>
                  <p><code class="codeph">int updateCount = 0;</code></p>
                  <p>3。通过调用<code class="codeph">getConnection()</code>方法创建一个<code class="codeph">try</code>块来建立数据库连接。
                  </p>
                  <p><code class="codeph">try（Connection connection = getConnection（））{</code></p>
                  <p>4。创建另一个try块以生成<code class="codeph">PreparedStatement</code> 。包括您需要执行的查询，以根据员工ID选择员工。
                  </p>
                  <div class="p"><pre class="pre codeblock"><code>try（PreparedStatement preparedStatement = connection.prepareStatement（“UPDATE employees SET FIRST_NAME = ?, LAST_NAME =？，EMAIL =？，PHONE_NUMBER =？，SALARY =？EMPLOYEE_ID =？“））{</code></pre>5。设置用户为每个属性输入的新值，然后执行prepapredStatement。</div>
                  <div class="p"><pre class="pre codeblock"><code>preparedStatement.setString（1，employee.getFirst_Name（））; preparedStatement.setString（2，employee.getLast_Name（））; preparedStatement.setString（3，employee.getEmail（））; preparedStatement.setString（4，employee.getPhone_Number（））; preparedStatement.setInt（5，employee.getSalary（））; preparedStatement.setInt（6，employee.getEmployee_Id（））; updateCount = preparedStatement.executeUpdate（）;</code></pre>6。所有<code class="codeph">try</code>块的右括号。
                  </div>
                  <p>7。捕获SQLException并在记录器中记录消息，如下所示：</p>
                  <div class="p"><pre class="pre codeblock"><code>catch（SQLException ex）{logger.log（Level。严重，“无法更新记录”，ex）;抛出新的SQLException（“警告！记录无法更新，“+ ex.getMessage（），ex）;}</code></pre>8。使用更新的记录数记录消息到记录器。</div>
                  <p><code class="codeph">logger.fine（“Update count：”+ updateCount）;</code></p>
                  <p>9。如果没有更新任何记录，请输入以下消息：</p>
                  <div class="p"><pre class="pre codeblock"><code>if（updateCount！= 1）{logger.severe（“无法更新记录”）;抛出新的SQLException（“警告！记录无法更新“）;}</code></pre>10。如果记录已更新，则返回成功消息。<pre class="pre codeblock"><code>返回“成功：记录更新”;</code></pre></div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-CA64A30B-0563-4B8A-ADF3-B9E073F69C4E" name="GUID-CA64A30B-0563-4B8A-ADF3-B9E073F69C4E"></a><h3 id="TDPJD-GUID-CA64A30B-0563-4B8A-ADF3-B9E073F69C4E" class="sect3">将代码添加到Servlet（ <span class="italic">WebController.java</span> ）</h3>
               <div>
                  <p>这是您主题的开始。</p>
                  <p><span class="bold">类名：</span> src / main / java / com / oracle / jdbc / samples / web / WebController.java</p>
                  <p><span class="bold">Github地点：</span> <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/java/com/oracle/jdbc/samples/web/WebController.java" target="_blank">WebController.java</a></p>
                  <p><span class="bold">描述：</span>您已在第1天练习中创建了servlet。在本节中，您将添加相关代码以向所有员工提供加薪。
                  </p>
                  <p><span class="bold">步骤6：</span>在用户输入输入百分比后，添加代码以计算工资预算。这是在<code class="codeph">doPost()</code>方法中处理的。
                  </p>
                  <p><span class="bold">将代码添加到doPost（req，res）的说明：</span> 
                  </p>
                  <p>1。您已在“更新员工”记录部分中创建了此方法。</p>
                  <div class="p">2。创建另一个<code class="codeph">if</code>块以根据输入检查要调用的功能。<pre class="pre codeblock"><code>if（“incrementSalary”.equals（value））{if（（value = request.getParameter（INCREMENT_PCT））！= null）{try {System.out.println（“increment％=”+ value）; response.setContentType（ “应用程序/ JSON”）; List &lt;Employee&gt; employeeList = employeeBean.incrementSalary（Integer.valueOf（value））; System.out.println（“incrementSalary，employeeList：”+ employeeList.toString（））; gson.toJson（employeeList，new TypeToken &lt;ArrayList &lt;Employee &gt;&gt;（）{}。getType（），response.getWriter（））; } catch（Exception ea）{response.setStatus（HttpServletResponse。SC_NOT_MODIFIED）; } else {response.setStatus（HttpServletResponse。SC_NOT_MODIFIED）; }}</code></pre></div>
                  <p>3。确保正确关闭所有括号。</p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-B8D371B4-4DF5-401E-9A85-1BA5DD2EC854" name="GUID-B8D371B4-4DF5-401E-9A85-1BA5DD2EC854"></a><h3 id="TDPJD-GUID-B8D371B4-4DF5-401E-9A85-1BA5DD2EC854" class="sect3">创建一个新的HTML（ <span class="italic">incrementSalary.html</span> ）</h3>
               <div>
                  <p><span class="bold">类名：</span> <code class="codeph">src/main/webapp/incrementSalary.html.</code></p>
                  <p><span class="bold">Github地点：</span> <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/webapp/incrementSalary.html" target="_blank">incrementSalary.html</a></p>
                  <p><span class="bold">说明</span> ：此HTML显示一个输入框，用于输入计算工资预算的百分比。
                  </p>
                  <p>第7步：为HTML页面创建标题，标题和样式表</p>
                  <p>步骤8：创建一个提交输入字段的功能，即员工名字</p>
                  <p>步骤9：创建方法processResponse（） - 处理JSON响应并在HTML页面上显示结果</p>
                  <p></p>
                  <p><span class="bold">第7步：创建HTML页面的标题，样式表和正文的说明：</span></p>
                  <p>1。创建HTML页面的标题，样式表和正文。</p>
                  <div class="p"><pre class="pre codeblock"><code>&lt;！DOCTYPE html&gt; &lt;html lang =“en”&gt; &lt;head&gt; &lt;meta charset =“UTF-8”&gt; &lt;title&gt;增量薪资&lt;/ title&gt; &lt;link rel =“stylesheet”type =“text / css”href =“ css / app.css“&gt; &lt;link rel =”stylesheet“href =”http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css“&gt; &lt;script src =”https：/ /ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"&gt;script src =“https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery。 min.js“&gt; &lt;/ script&gt; &lt;/ head&gt;</code></pre></div>
                  <p><span class="bold">步骤8：处理输入字段的说明</span></p>
                  <p>1。启动&lt;body&gt;标记和&lt;input&gt;标记以捕获加薪百分比。</p>
                  <div class="p"><pre class="pre codeblock"><code>&lt;body&gt; &lt;div&gt;输入工资增长百分比&lt;inputid ='incrementField'type =“number”max =“100”min =“3”&gt;％&lt;/ div&gt; &lt;div id =“UpdateButton”&gt; &lt;按钮类型=“button”class =“btn btn-info btn-lg”onclick ='javascipt：confirmUpdate（）'&gt;递增工资&lt;/ button&gt; &lt;button type =“button”class =“btn btn-default btn-lg”onclick ='javascipt：cancelUpdate（）'&gt;取消&lt;/ button&gt; &lt;/ div&gt; &lt;div id =“status”class =“none”&gt; &lt;/ div&gt; &lt;div id =“id-emp”&gt; &lt;/ div&gt; &lt; script&gt; function showStatus（c，message）{$（'＃status'）。text（message）; $（'＃status'）。attr（'class'，c）; function confirmUpdate（）{var increment = $（'＃incrementField'）。val（）; var res = confirm（“你真的想增加薪水”+增量+“％？“）; if（res == true）{console.log（”Salary record“）; $（'＃UpdateButton'）。hide（）; showStatus（”alert alert-info“，”更新记录，处理请求“） ; var xmlhttp = new XMLHttpRequest（）; var url =“WebController？op = incrementSalary＆incrementPct =“+ increment; xmlhttp.onreadystatechange = function（）{if（xmlhttp.readyState == 4 &amp;&amp; xmlhttp.status == 200）{processResponse（xmlhttp.responseText）; showStatus（”alert alert-success“，”更新记录，成功更新“）;} else {showStatus（”alert alert-danger“，”更新记录，失败，无法更新记录“）;}} xmlhttp.open（”POST“，url，true）; xmlhttp。 send（）; showStatus（“alert alert-info”，“更新记录，请求已发送”）;} else {console.log（“Salary not updated”）; showStatus（“alert alert-warning”，“更新记录，尝试取消了“）;}} &lt;/ script&gt;</code></pre></div>
                  <p><span class="bold">第9步：创建<code class="codeph">processResponse()</code>方法的说明：</span></p>
                  <p>1。创建函数<code class="codeph">processRequest()</code>以在HTML页面上显示JSON结果。
                  </p>
                  <div class="p"><pre class="pre codeblock"><code>unction processResponse（response）{var arr = JSON.parse（response）; var i; var out =“&lt;table&gt;”; keys = Object.keys（arr [0]）; //打印标题输出+ =“&lt;tr&gt;”for（i = 0; i &lt;keys.length; ++ i）{out + =“&lt;th&gt;”+ keys [i] +“&lt;/ th&gt;”} out + =“&lt;/ tr&gt;”; //打印（j = 0; j &lt;arr.length; j ++）{out + =“&lt;tr&gt;”的值（i = 0; i &lt;keys.length; ++ i）{out + =“&lt;td &gt;“+ arr [j] [keys [i]] +”&lt;/ td&gt;“} out + =”&lt;/ tr&gt;“} out + =”&lt;/ table&gt;“; document.getElementById（“id-emp”）。innerHTML = out; }</code></pre></div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2" name="GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2"></a><h3 id="TDPJD-GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2" class="sect3"><span class="bold">在Tomcat中创建登录用户</span></h3>
               <div>
                  <p>HR Web应用程序将有两个用户 - <code class="codeph">hradmin</code>和<code class="codeph">hrstaff</code> 。
                  </p>
                  <p>使用凭据登录主页后，您将能够看到登录页面，其中包含Web应用程序的详细信息。hradmin和hrstaff具有不同的权限和访问不同功能。</p>
                  <p>本章将向您展示您需要创建的必需类以及如何在Tomcat中构建“登录”功能。</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>创建用于登录功能的XML文件（ <span class="italic">tomcat-users.xml）</span></p>
                     </li>
                     <li>
                        <p>创建一个HTML页面（ <span class="italic">login.html</span> ）以登录用户</p>
                     </li>
                     <li>
                        <p>创建一个HTML页面（ <span class="italic">login-failed.html</span> ）以显示错误消息</p>
                     </li>
                     <li>
                        <p>创建<span class="italic">web.xml</span>以在登录期间对用户进行身份验证</p>
                     </li>
                     <li>
                        <p>创建一个HTML页面（about.html）以显示有关该应用程序的更多详细信息</p>
                     </li>
                     <li>
                        <p>创建登录页面（index.html）并定义用于重定向的html页面</p>
                     </li>
                     <li>将代码添加到servlet（ <span class="italic">WebController.java</span> ）以处理注销</li>
                  </ul>
                  <div class="section">
                     <p class="subhead2" id="GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2__GUID-77D6CD12-F0F6-4151-988A-40EA2B34DD5F">创建用于登录功能的XML文件（ <span class="italic">tomcat-users.xml）</span></p>
                     <p><span class="bold">类名：</span> <code class="codeph">/java/HRWebApp/tomcat-users.java</code></p>
                     <p><span class="bold">Github位置：</span> <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/tomcat-users.xml" target="_blank">tomcat-users.xml</a></p>
                     <p><span class="bold">说明：</span>创建XML文件tomcat-users.xml并列出要允许访问的登录用户。为每个用户指定用户名和密码。
                     </p>
                     <p><span class="bold">第1步：创建一个新文件tomcat-user.xml</span></p>
                     <p><span class="bold">创建tomcat-users.xml的说明：</span> 
                     </p>
                     <p>1。创建文件<code class="codeph">tomcat-users.xml</code> 。将此文件放在<code class="codeph">TOMCAT_HOME/conf /tomcat-users.xml</code> 
                     </p>
                     <div class="p"><pre class="pre codeblock"><code>&lt;？xml version ='1.0'coding ='utf-8'？&gt; z &lt;tomcat-users xmlns =“http://tomcat.apache.org/xml”xmlns：xsi =“http://www.w3.org/2001/XMLSchema-instance”xsi：schemaLocation =“http：/ /tomcat.apache.org/xml tomcat-users.xsd“version =”1.0“&gt; &lt;role rolename =”manager“/&gt; &lt;role rolename =”staff“/&gt; &lt;user username =”hradmin“password =”welcome“ roles =“manager，staff”/&gt; &lt;user username =“hrstaff”password =“welcome”roles =“staff”/&gt; &lt;/ tomcat-users&gt;</code></pre></div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2__GUID-4B2A6D9C-2C13-4BAE-B6FC-2E29D29D44C9">创建一个新的HTML（ <span class="italic">login.html</span> ）</p>
                     <p><span class="bold">类名：</span> src / main / webapp / login.html</p>
                     <p><span class="bold">Github地点：</span> <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/webapp/login.html" target="_blank">login.html</a></p>
                     <p><span class="bold">描述：</span>调用Web应用程序的主页时，将显示登录页面。登录页面显示用于捕获用户名和密码的字段。
                     </p>
                     <p>第2步：为<span class="italic">login.html</span>创建标题，头部和样式表</p>
                     <p>第3步：创建&lt;body&gt;以捕获输入字段并提交表单</p>
                     <p></p>
                     <p><span class="bold">第2步：为</span> <code class="codeph">login.html:</code> <span class="bold">创建标题，头部和样式表的说明</span> <code class="codeph">login.html:</code></p>
                     <p>1。创建文件<code class="codeph">tomcat-users.xml</code> 。将此文件<code class="codeph">TOMCAT_HOME/conf/tomcat-users.xml</code> 。
                     </p>
                     <div class="p"><pre class="pre codeblock"><code>&lt;！DOCTYPE html&gt; &lt;html lang =“en”&gt; &lt;head&gt; &lt;meta charset =“UTF-8”&gt; &lt;title&gt;登录Jdbc Web示例应用程序&lt;/ title&gt; &lt;link rel =“stylesheet”href =“http：/ /maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css“&gt; &lt;style&gt; #cent {position：absolute;顶部：50％;左：50％;边距：-50px; / *这是div * / margin-left的高度的一半：-100px; / *这是div的宽度的一半* /} td {height：30px; } &lt;/ style&gt; &lt;/ head&gt;</code></pre></div>
                     <p><span class="bold">第3步：创建&lt;body&gt;的说明并提交表单：</span></p>
                     <p>1。创建&lt;body&gt;和&lt;form&gt;以提交用户输入的登录凭据。</p>
                     <div class="p"><pre class="pre codeblock"><code>&lt;body&gt; &lt;div id =“cent”&gt; &lt;form method =“POST”action =“j_security_check”&gt; &lt;table&gt; &lt;tr&gt; &lt;td colspan =“2”&gt;登录Jdbc Web示例应用程序：&lt;/ td&gt; &lt;/ tr&gt; &lt;td&gt;名称：&lt;/ td&gt; &lt;td&gt; &lt;input type =“text”name =“j_username”/&gt; &lt;/ td&gt; &lt;/ tr&gt; &lt;tr&gt; &lt;td&gt;密码：&lt;/ td&gt; &lt;td&gt; &lt;input type =“password”name =“j_password”/&gt; &lt;/ td&gt; &lt;/ tr&gt; &lt;tr&gt; &lt;td colspan =“2”&gt; &lt;input type =“submit”value =“Go”/&gt; &lt;/ td&gt; &lt;/ tr&gt; &lt;/ table&gt; &lt;/ form&gt; &lt;/ div&gt; &lt;/ body&gt;</code></pre></div>
                     <p></p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2__GUID-095142DF-F5DE-4217-A70A-14105CEFD126">创建一个新的HTML（ <span class="italic">login-failed.html</span> ）</p>
                     <p><span class="bold">类名：</span> src / main / webapp / login-failed.html</p>
                     <p><span class="bold">Github地点：</span> <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/webapp/login-failed.html" target="_blank">login-failed.html</a></p>
                     <p><span class="bold">描述：</span>如果登录失败，将显示的html页面。
                     </p>
                     <p><span class="bold">步骤4：创建新页面<span class="italic">login-failed.html</span>以在登录尝试失败时显示消息</span></p>
                     <p><span class="bold">创建新HTML页面</span> <code class="codeph">login-failed.html</code> 。
                     </p>
                     <p>1。创建<code class="codeph">login-failed.html</code> ，如下所示。
                     </p>
                     <div class="p"><pre class="pre codeblock"><code>&lt;！DOCTYPE html&gt; &lt;html lang =“en”&gt; &lt;head&gt; &lt;meta charset =“UTF-8”&gt; &lt;title&gt;登录失败&lt;/ title&gt; &lt;/ head&gt; &lt;body&gt; &lt;p&gt;抱歉，登录失败！&lt;/ p&gt; &lt;/ body&gt; &lt;/ html&gt;</code></pre></div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2__GUID-47C99078-0C28-4D5F-913F-E481B0EF3FE7">创建<span class="italic">web.xml</span>以在登录期间对用户进行身份验证</p>
                     <p><span class="bold">类名：</span> <code class="codeph">src/main/webapp/WEB-INF/web.xml</code></p>
                     <p><span class="bold">Github地点：</span> <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/webapp/WEB-INF/web.xml" target="_blank">web.xml</a></p>
                     <p><span class="bold">描述：</span> web.xml文件由描述符组成，用于在向用户显示登录页面时对用户进行身份验证。
                     </p>
                     <p><span class="bold">步骤：</span>创建文件web.xml，如下所示。
                     </p>
                     <p><span class="bold">创建</span> <code class="codeph">web.xml</code> <span class="bold">说明</span></p>
                     <p>1。使用以下步骤创建web.xml文件：</p>
                     <div class="p"><pre class="pre codeblock"><code>&lt;！DOCTYPE web-app PUBLIC“ -  // Sun Microsystems，Inc.//DDD Web Application 2.3 // EN”“http://java.sun.com/dtd/web-app_2_3.dtd”&gt; &lt;web-app&gt; &lt; display-name&gt; Jdbc Web Sample &lt;/ display-name&gt; &lt;security-role&gt; &lt;role-name&gt; manager &lt;/ role-name&gt; &lt;/ security-role&gt; &lt;security-role&gt; &lt;role-name&gt; staff &lt;/ role -name&gt; &lt;/ security-role&gt; &lt;security-constraint&gt; &lt;web-resource-collection&gt; &lt;web-resource-name&gt;通配符表示整个应用程序需要身份验证&lt;/ web-resource-name&gt; &lt;url-pattern&gt; / * &lt; / url-pattern&gt; &lt;http-method&gt; GET &lt;/ http-method&gt; &lt;http-method&gt; POST &lt;/ http-method&gt; &lt;/ web-resource-collection&gt; &lt;auth-constraint&gt; &lt;role-name&gt; manager &lt;/ role-name&gt; &lt;/ auth-constraint&gt; &lt;user-data-constraint&gt; &lt;transport-guarantee&gt; NONE &lt;/ transport-guarantee&gt; &lt;/ user-data-constraint&gt; &lt;/ security-constraint&gt; &lt;security-constraint&gt; &lt;web -resource-collection&gt; &lt;web-resource-name&gt;通配符表示整个应用程序需要身份验证&lt;/ web-resource-name&gt; &lt;url-pattern&gt; / * &lt;/ url-pattern&gt; &lt;http-method&gt; GET &lt;/ http-method &gt; &lt;/ web-resource-collection&gt; &lt;auth-constraint&gt; &lt;role-name&gt; taff &lt;/ role-name&gt; &lt;/ auth-constraint&gt; &lt;user-data-constraint&gt; &lt;transport-guarantee&gt; NONE &lt;/ transport-guarantee&gt; &lt;/ user-data-constraint&gt; &lt;/ security-constraint&gt; &lt;login-config &gt; &lt;auth-method&gt; FORM &lt;/ auth-method&gt; &lt;form-login-config&gt; &lt;form-login-page&gt; /login.html &lt;/ form-login-page&gt; &lt;form-error-page&gt; / login-failed .html &lt;/ form-error-page&gt; &lt;/ form-login-config&gt; &lt;/ login-config&gt; &lt;/ web-app&gt;</code></pre></div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2__GUID-02696127-4327-4AC2-9E74-717A941759F0">创建一个HTML页面<span class="italic">（about.html）</span>来描述Web应用程序</p>
                     <p><span class="bold">类名：</span> <code class="codeph">src/main/webapp/about.html</code></p>
                     <p><span class="bold">Github地点：</span> <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/webapp/about.html" target="_blank">about.html</a></p>
                     <p><span class="bold">描述：</span> <code class="codeph">about.html</code>文件显示有关HR应用程序，用户和功能的信息。
                     </p>
                     <p>第6步：下载<a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/webapp/about.html" target="_blank">about.html</a>并在您的应用程序中使用它。
                     </p>
                     <p></p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2__GUID-1F3C523C-3EC1-49E7-8F41-EC9035E3D048">创建登录页面（index.html）并定义重定向页面</p>
                     <p><span class="bold">类名：</span> <code class="codeph">src/main/webapp/index.html</code></p>
                     <p><span class="bold">Github地点：</span> <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/webapp/index.html" target="_blank">index.html</a></p>
                     <p><span class="bold">描述：</span> index.html文件包含有关HR Web应用程序的所有详细信息。它详细描述了其用户和功能。
                     </p>
                     <p>第7步：为<span class="italic">index.html</span>创建标题，头部和样式表</p>
                     <p>步骤8：创建<code class="codeph">&lt;body&gt;</code>以调用html页面以重定向请求</p>
                     <p></p>
                     <p><span class="bold">7。为</span> index.html 创建标题，头部和样式表的说明</span> ：</p>
                     <p>1。创建index.html文件。</p>
                     <div class="p"><pre class="pre codeblock"><code>&lt;！DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset =“utf-8”&gt; &lt;title&gt;员工表列表&lt;/ title&gt; &lt;link rel =“stylesheet”type =“text / css”href =“css / app。 css“&gt; &lt;style&gt; iframe：focus {outline：none; } iframe [seamless] {display：block; } &lt;/ style&gt; &lt;/ head&gt; &lt;body&gt;</code></pre></div>
                     <p><span class="bold">步骤8：创建&lt;body&gt;，重定向和按钮操作的说明：</span></p>
                     <p></p>1。通过导航链接和注销为功能创建<code class="codeph">&lt;body&gt;</code>和操作。<pre class="pre codeblock"><code>&lt;body&gt; &lt;div id =“sideNav”class =“sidenav”&gt; &lt;a href="javascript:void(0)" class="closebtn" onclick="closeNav()" class="staff"&gt;×&lt;/ a &gt; &lt;a href="javascript:switchSrc('listAll.html')" class="staff"&gt;全部列出&lt;/a&gt; &lt;a href =“javascript：switchSrc（'listById.html'）”class =“staff” &gt;按ID搜索&lt;/a&gt; &lt;a href="javascript:switchSrc('listByName.html')" class="manager"&gt;更新员工记录&lt;/a&gt; &lt;a href =“javascript：switchSrc（'incrementSalary.html '）“class =”manager“&gt;增加工资&lt;/a&gt; &lt;a href="javascript:switchSrc('about.html')"&gt;关于&lt;/a&gt; &lt;/ div&gt; &lt;div id =”main“&gt; &lt; div align =“right”&gt; &lt;div id =“myrole”style =“display：inline; color：＃393318; display：block; background-color：＃eff0f1; position：absolute; top：20px; right：8％; “ &gt; myrole &lt;/ div&gt; &lt;a href =“javascript：void（0）”onclick =“logout（）”class =“staff”style =“display：block; position：absolute; top：20px; right：1％” &gt;注销&lt;/a&gt; &lt;/ div&gt; &lt;div&gt; &lt;span style =“font-size：30px; cursor：pointer”onclick =“openNav（）”&gt; Java 2天HR Web应用程序&lt;/ span&gt; &lt;/ div&gt; &lt;div&gt; &lt;iframe id =“content”src =“about.html”frameborder =“0”style =“overflow：hidden; height：100％; width：100％”height =“100％”width =“100％ “&gt; &lt;/ iframe&gt; &lt;/ div&gt; &lt;/ div&gt; &lt;script&gt; function openNav（）{document.getElementById（”sideNav“）。style.width =”256px“; document.getElementById（“main”）。style.marginLeft =“256px”; function closeNav（）{document.getElementById（“sideNav”）。style.width =“0”; document.getElementById（“main”）。style.marginLeft =“0”; function switchSrc（src）{document.getElementById（'content'）。src = src; function logout（）{var xmllogout = new XMLHttpRequest（）; xmllogout.open（“GET”，“WebController？logout = true“，true，”_“，”_“）; xmllogout.withCredentials = true; //用于伪造注销的Invlalid凭据xmllogout.setRequestHeader（”授权“，”基本00001“）; xmllogout.send（）; xmllogout .onreadystatechange = function（）{window.location.replace（“index.html”）;} return true;} var xmlhttp = new XMLHttpRequest（）; var url =“getrole”; xmlhttp.onreadystatechange = function（）{if（ xmlhttp.readyState == 4 &amp;&amp; xmlhttp.status == 200）{role = xmlhttp.responseText; console.log（“role：”+ role）; if（role ==“staff”）{console.log（“禁用管理器” “）; var x = document.getElementsByClassName（'manager'）; for（i = 0; i &lt;x.length; ++ i）{x [i] .style.display ='none';}} document.getElementById （'myrole'）。innerHTML =''+ role +'';}} xmlhttp.open（“GET”，url，true）; xmlhttp.send（）; &lt;/ script&gt; &lt;/ body&gt;</code></pre><p></p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2__GUID-65A885B7-0FAC-4872-B929-E232DA654CF0">将代码添加到servlet（ <span class="italic">WebController.java</span> ）以处理注销</p>
                     <p><span class="bold">类名：</span> <code class="codeph">src/main/java/com/oracle/jdbc/samples/web/WebController.java</code></p>
                     <p><span class="bold">Github地点：</span> <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/java/com/oracle/jdbc/samples/web/WebController.java" target="_blank">WebController.java</a></p>
                     <p><span class="bold">描述：</span>您已在第1天练习中创建了此servlet。在此步骤中，您将添加相关代码以实现注销和登录。
                     </p>
                     <p><span class="bold">第9步</span> <span class="bold">：更新方法</span> <code class="codeph">processRequest(req, res)</code> <span class="bold"><span class="italic"> </span>用于注销功能<span class="italic"> </span></span></p>
                     <p><span class="bold">更新方法</span> <code class="codeph">processRequest (req, res):</code></p>
                     <p>1。您已在前面的步骤中的“ListAll”功能中创建了一个方法。在此步骤中，您将添加<code class="codeph">logout</code>功能的代码。
                     </p>
                     <p>2。创建<code class="codeph">if</code>块以验证将根据输入调用的功能。检查输入值是否为“ <code class="codeph">LOGOUT</code> ”。然后，调用相关方法注销用户。
                     </p>
                     <div class="p"><pre class="pre codeblock"><code>if（（value = request.getParameter（LOGOUT））！= null）{/ *获取会话然后使其无效* / HttpSession session = request.getSession（false）; if（request.isRequestedSessionIdValid（）&amp;&amp; session！= null）{session.invalidate（）; handleLogOutResponse（request，response）; response.setStatus（HttpServletResponse的。SC_UNAUTHORIZED）;返回; private void handleLogOutResponse（HttpServletRequest request，HttpServletResponse response）{Cookie [] cookies = request.getCookies（）; for（Cookie cookie：cookies）{cookie.setMaxAge（0）; cookie.setValue（NULL）; cookie.setPath（ “/”）; response.addCookie（饼干）; }}</code></pre>3。验证是否正确关闭了所有括号。</div> 
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>