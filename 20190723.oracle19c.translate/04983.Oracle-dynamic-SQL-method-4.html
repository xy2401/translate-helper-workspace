<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>Oracle动态SQL：方法4</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Programmer&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Programmer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="c-c-programmers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-11T03:52:01-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96467-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="ANSI-dynamic-SQL.html" title="Previous" type="text/html"></link>
      <link rel="next" href="about-LOBs.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Pro*C/C++ Programmer&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="LNPCC"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="ANSI-dynamic-SQL.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="about-LOBs.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">程序员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="applications.html" property="item" typeof="WebPage"><span property="name">应用</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Oracle动态SQL：方法4</li>
            </ol>
            <a id="GUID-B516B7C8-1859-4A54-B15D-DF0C3D3C474D" name="GUID-B516B7C8-1859-4A54-B15D-DF0C3D3C474D"></a><a id="LNPCC015"></a>
            
            <h2 id="LNPCC-GUID-B516B7C8-1859-4A54-B15D-DF0C3D3C474D" class="sect2"><span class="enumeration_chapter">15</span> Oracle动态SQL：方法4</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍如何实现Oracle动态SQL方法4，它允许程序接受或构建包含不同数量的主机变量的动态SQL语句。使用它来支持现有应用程序。对所有新应用程序使用ANSI动态SQL方法4。</p>
               <p>Oracle Dynamic SQL方法4不支持对象类型，游标变量，结构数组，DML返回子句，Unicode变量和LOB。请改用ANSI Dynamic SQL Method 4。本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="Oracle-dynamic-SQL-method-4.html#GUID-C4A076CB-B912-4304-8FC8-19488999801E">满足方法4的特殊要求</a></p>
                  </li>
                  <li>
                     <p><a href="Oracle-dynamic-SQL-method-4.html#GUID-3BB69A6A-DDFA-4961-8BA6-42ACCAA5A4AC">理解SQLDA</a></p>
                  </li>
                  <li>
                     <p><a href="Oracle-dynamic-SQL-method-4.html#GUID-867E8510-B128-458A-9E0D-32BAAB66F72C">关于使用SQLDA变量</a></p>
                  </li>
                  <li>
                     <p><a href="Oracle-dynamic-SQL-method-4.html#GUID-99CB556C-7D04-4718-9728-12CF93E9C8DF">一些预赛</a></p>
                  </li>
                  <li>
                     <p><a href="Oracle-dynamic-SQL-method-4.html#GUID-3B20F486-A5CF-4938-A21B-F77066416C04">基本步骤</a></p>
                  </li>
                  <li>
                     <p><a href="Oracle-dynamic-SQL-method-4.html#GUID-C9E59D78-26AC-4EA4-AE04-2A7F01296AD9">仔细看看每一步</a></p>
                  </li>
                  <li>
                     <p><a href="Oracle-dynamic-SQL-method-4.html#GUID-159E12E2-C5B7-40EE-A26C-50D872B8DC32">示例程序：动态SQL方法4</a></p>
                  </li>
                  <li>
                     <p><a href="Oracle-dynamic-SQL-method-4.html#GUID-D6A3B49E-C3DC-4055-A848-DD52E7539634">示例程序：使用Scrollable Cursors的动态SQL方法4</a></p>
                     <div class="infoboxnotealso" id="GUID-B516B7C8-1859-4A54-B15D-DF0C3D3C474D__GUID-E7F814AD-5F99-4227-87EB-DF7849345F88">
                        <p class="notep1">也可以看看：</p>
                        <p></p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="Oracle-dynamic-SQL.html#GUID-3B9E253A-F03D-431D-A77E-84C02C43F494">Oracle Dynamic SQL</a>用于讨论动态SQL方法1,2和3，以及方法4的概述</p>
                           </li>
                           <li>
                              <p><a href="ANSI-dynamic-SQL.html#GUID-BF450DA3-B05F-403E-B5DF-C967A20524BF">ANSI动态SQL</a></p>
                           </li>
                        </ul>
                     </div>
                  </li>
               </ul>
            </div><a id="LNPCC4128"></a><div class="props_rev_3"><a id="GUID-C4A076CB-B912-4304-8FC8-19488999801E" name="GUID-C4A076CB-B912-4304-8FC8-19488999801E"></a><h3 id="LNPCC-GUID-C4A076CB-B912-4304-8FC8-19488999801E" class="sect3"><span class="enumeration_section">15.1</span>满足方法4的特殊要求</h3>
               <div>
                  <p>在研究方法4的要求之前，您应该对术语select-list项和占位符感到满意。选择列表项是查询中关键字SELECT后面的列或表达式。例如，以下动态查询包含三个选择列表项：</p><pre class="oac_no_warn" dir="ltr">SELECT ename，job，sal + comm FROM emp WHERE deptno = 20</pre><p>占位符是虚拟绑定变量，它在SQL语句中保存实际绑定变量的位置。您没有声明占位符，可以将它们命名为您喜欢的任何名称。</p>
                  <p>绑定变量的占位符最常用于SET，VALUES和WHERE子句中。例如，以下动态SQL语句每个都包含两个占位符：</p><pre class="oac_no_warn" dir="ltr">INSERT INTO emp（empno，deptno）VALUES（：e，：d）DELETE FROM dept WHERE deptno =：num OR loc =：loc</pre></div><a id="LNPCC4129"></a><div class="props_rev_3"><a id="GUID-7DA9EAC1-C0A3-4996-BD06-0863161D12F2" name="GUID-7DA9EAC1-C0A3-4996-BD06-0863161D12F2"></a><h4 id="LNPCC-GUID-7DA9EAC1-C0A3-4996-BD06-0863161D12F2" class="sect4"><span class="enumeration_section">15.1.1</span>什么使方法4特别？
                  </h4>
                  <div>
                     <p>与方法1,2和3不同，动态SQL方法4允许您的程序</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>接受或构建包含未知数量的选择列表项或占位符的动态SQL语句，以及</p>
                        </li>
                        <li>
                           <p>明确控制Oracle和C类型之间的数据类型转换</p>
                        </li>
                     </ul>
                     <p>要为程序添加此灵活性，必须为Oracle运行时库提供其他信息。 <a id="d80858e144" class="indexterm-anchor"></a> 
                     </p>
                  </div>
               </div><a id="LNPCC4130"></a><div class="props_rev_3"><a id="GUID-A3FB107E-683F-456D-960C-3A49F25EBE3A" name="GUID-A3FB107E-683F-456D-960C-3A49F25EBE3A"></a><h4 id="LNPCC-GUID-A3FB107E-683F-456D-960C-3A49F25EBE3A" class="sect4"><span class="enumeration_section">15.1.2</span> Oracle需要哪些信息？
                  </h4>
                  <div>
                     <p>Pro * C / C ++预编译器为所有可执行的动态SQL语句生成对Oracle的调用。如果动态SQL语句不包含选择列表项或占位符，则Oracle不需要其他信息来执行该语句。以下DELETE语句属于此类别：</p><pre class="oac_no_warn" dir="ltr">DELETE FROM emp WHERE deptno = 30</pre><p>但是，大多数动态SQL语句包含绑定变量的选择列表项或占位符，如下所示</p>
                     <p>更新声明：</p><pre class="oac_no_warn" dir="ltr">UPDATE emp SET comm =：c WHERE empno =：e</pre><p>要执行包含绑定变量或选择列表项的占位符的动态SQL语句，Oracle需要有关保存输入（绑定）值的程序变量的信息，并且在执行查询时将保存FETCHed值。Oracle所需的信息是：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>绑定变量和选择列表项的数量</p>
                        </li>
                        <li>
                           <p>每个绑定变量和选择列表项的长度</p>
                        </li>
                        <li>
                           <p>每个绑定变量和select-list项的数据类型</p>
                        </li>
                        <li>
                           <p>每个绑定变量的地址，以及将接收每个选择列表项的输出变量的地址</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="LNPCC4131"></a><div class="props_rev_3"><a id="GUID-DFC1F730-2355-4A38-B5C8-57C08C04A397" name="GUID-DFC1F730-2355-4A38-B5C8-57C08C04A397"></a><h4 id="LNPCC-GUID-DFC1F730-2355-4A38-B5C8-57C08C04A397" class="sect4"><span class="enumeration_section">15.1.3</span>信息存储在哪里？
                  </h4>
                  <div>
                     <p>Oracle需要的关于绑定变量的选择列表项或占位符的所有信息（除了它们的值）都存储在称为SQL描述符区域（SQLDA）的程序数据结构中。SQLDA结构在<code class="codeph">sqlda.h</code>头文件中定义。<a id="d80858e224" class="indexterm-anchor"></a></p>
                     <p>选择列表项的<span class="italic">描述</span>存储在<span class="italic">选择描述</span>符中，绑定变量的占位符描述存储在<span class="italic">绑定描述符中</span> 。 <a id="d80858e234" class="indexterm-anchor"></a><a id="d80858e238" class="indexterm-anchor"></a> 
                     </p>
                     <p>select-list项的值存储在输出变量中;绑定变量的值存储在输入变量中。将这些变量的地址存储在select或bind SQLDA中，以便Oracle知道在何处写入输出值和读取输入值。</p>
                     <p>值如何存储在这些数据变量中？输出值使用游标进行FETCH，并且输入值通常由程序填充，通常来自用户交互输入的信息。</p>
                  </div>
               </div><a id="LNPCC4132"></a><div class="props_rev_3"><a id="GUID-65F15694-C793-48E7-BD25-B59D8539DC79" name="GUID-65F15694-C793-48E7-BD25-B59D8539DC79"></a><h4 id="LNPCC-GUID-65F15694-C793-48E7-BD25-B59D8539DC79" class="sect4"><span class="enumeration_section">15.1.4</span>如何引用SQLDA？
                  </h4>
                  <div>
                     <p>绑定和选择描述符通常由指针引用。动态SQL程序应按以下方式声明指向至少一个绑定描述符的指针，以及指向至少一个选择描述符的指针：</p><pre class="oac_no_warn" dir="ltr">#include &lt;sqlda.h&gt; ...SQLDA * bind_dp; SQLDA * select_dp;</pre><p>然后，您可以使用<code class="codeph">SQLSQLDAAlloc()</code>函数分配描述符，如下所示：</p><pre class="oac_no_warn" dir="ltr">bind_dp = SQLSQLDAAlloc（runtime_context，size，name_length，ind_name_length）;</pre><p>SQLSQLDAAlloc（）在Oracle8之前称为sqlaldt（）。</p>
                     <p>常量<code class="codeph">SQL_SINGLE_RCTX</code>定义为<code class="codeph">(dvoid*)0</code> 。当您的应用程序是单线程时，将它用于<span class="italic">runtime_context</span> 。
                     </p>
                     <div class="infoboxnotealso" id="GUID-65F15694-C793-48E7-BD25-B59D8539DC79__GUID-B8F5714C-EFDA-4CFC-BEA1-87E214102C3A">
                        <p class="notep1">也可以看看：</p>
                        <p></p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="Oracle-dynamic-SQL-method-4.html#GUID-0A53AE88-FB46-41C0-B582-C2A505BC2079__g34286" title="SQL数据类型的精度和比例值">表15-3</a> ，有关此SQLLIB函数和其他SQLLIB函数的信息</p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="Oracle-dynamic-SQL-method-4.html#GUID-0523C053-0F0C-40B2-A22E-4D2860001A8A">分配SQLDA</a> ”</span>以获取有关<code class="codeph">SQLSQLDAAlloc()</code>及其参数的详细信息</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="LNPCC4133"></a><div class="props_rev_3"><a id="GUID-E5D7496A-4E8B-416A-BB10-E8AA1D17F96F" name="GUID-E5D7496A-4E8B-416A-BB10-E8AA1D17F96F"></a><h4 id="LNPCC-GUID-E5D7496A-4E8B-416A-BB10-E8AA1D17F96F" class="sect4"><span class="enumeration_section">15.1.5</span>如何获得信息？
                  </h4>
                  <div>
                     <p>您可以使用DESCRIBE语句来帮助获取Oracle所需的信息。</p>
                     <p>DESCRIBE SELECT LIST语句检查每个选择列表项以确定其名称和名称长度。然后，它将此信息存储在选定的SQLDA中供您使用。例如，您可以使用选择列表名称作为打印输出中的列标题。选择列表项的总数也由DESCRIBE存储在SQLDA中。</p>
                     <p>DESCRIBE BIND VARIABLES语句检查每个占位符以确定其名称和长度，然后将此信息存储在输入缓冲区中并绑定SQLDA供您使用。例如，您可以使用占位符名称来提示用户输入绑定变量的值。</p>
                  </div>
               </div>
            </div><a id="LNPCC4134"></a><div class="props_rev_3"><a id="GUID-3BB69A6A-DDFA-4961-8BA6-42ACCAA5A4AC" name="GUID-3BB69A6A-DDFA-4961-8BA6-42ACCAA5A4AC"></a><h3 id="LNPCC-GUID-3BB69A6A-DDFA-4961-8BA6-42ACCAA5A4AC" class="sect3"><span class="enumeration_section">15.2</span>了解SQLDA</h3>
               <div>
                  <p>本节详细介绍了SQLDA数据结构。您将学习如何声明它，它包含哪些变量，如何初始化它们以及如何在程序中使用它们。</p>
               </div><a id="LNPCC4135"></a><div class="props_rev_3"><a id="GUID-8E3D0106-C65E-443F-9A4C-724F42D65763" name="GUID-8E3D0106-C65E-443F-9A4C-724F42D65763"></a><h4 id="LNPCC-GUID-8E3D0106-C65E-443F-9A4C-724F42D65763" class="sect4"><span class="enumeration_section">15.2.1</span> SQLDA的用途</h4>
                  <div>
                     <p>对于包含未知数量的选择列表项或绑定变量占位符的动态SQL语句，需要方法4。要处理这种动态SQL语句，程序必须显式声明SQLDAs，也称为<span class="italic">描述符</span> 。每个描述符都是一个<span class="bold">结构</span> ，您必须将其复制或编码到程序中。 <a id="d80858e401" class="indexterm-anchor"></a><a id="d80858e405" class="indexterm-anchor"></a><a id="d80858e409" class="indexterm-anchor"></a> 
                     </p>
                     <p><span class="italic">选择描述符</span>包含选择列表项的描述，以及存储选择列表项的名称和值的输出缓冲区的地址。 <a id="d80858e419" class="indexterm-anchor"></a><a id="d80858e423" class="indexterm-anchor"></a><a id="d80858e427" class="indexterm-anchor"></a><a id="d80858e429" class="indexterm-anchor"></a><a id="d80858e431" class="indexterm-anchor"></a> 
                     </p>
                     <div class="infoboxnote" id="GUID-8E3D0106-C65E-443F-9A4C-724F42D65763__GUID-9FACC7ED-CCA0-4EB1-8CC6-0CE78106107D">
                        <p class="notep1">注意：</p>
                        <p>选择列表项的“名称”可以是列名，列别名或表达式的文本，例如<span class="italic">sal + comm。</span></p>
                     </div>
                     <p><span class="italic">绑定描述符</span>包含绑定变量和指示符变量的描述，以及存储绑定变量和指示符变量的名称和值的输入缓冲区的地址。 <a id="d80858e444" class="indexterm-anchor"></a><a id="d80858e446" class="indexterm-anchor"></a> 
                     </p>
                  </div>
               </div><a id="LNPCC4136"></a><div class="props_rev_3"><a id="GUID-ACE4D0B6-3672-4F74-B405-262733F2F70F" name="GUID-ACE4D0B6-3672-4F74-B405-262733F2F70F"></a><h4 id="LNPCC-GUID-ACE4D0B6-3672-4F74-B405-262733F2F70F" class="sect4"><span class="enumeration_section">15.2.2</span>多个SQLDA</h4>
                  <div>
                     <p>如果您的程序有多个活动的动态SQL语句，则每个语句必须具有自己的SQLDA。您可以声明任意数量的具有不同名称的SQLDA。例如，您可以声明三个名为<span class="italic">sel_desc1</span> ， <span class="italic">sel_desc2</span>和<span class="italic">sel_desc3的</span>选择<span class="italic">SQLDDA</span> ，以便您可以从三个并发OPEN游标进行FETCH。但是，非并发游标可以重用SQLDA。
                     </p>
                  </div>
               </div><a id="LNPCC4137"></a><div class="props_rev_3"><a id="GUID-54CB400D-2D43-48B5-82CB-3CB4BA558ACC" name="GUID-54CB400D-2D43-48B5-82CB-3CB4BA558ACC"></a><h4 id="LNPCC-GUID-54CB400D-2D43-48B5-82CB-3CB4BA558ACC" class="sect4"><span class="enumeration_section">15.2.3</span>声明SQLDA</h4>
                  <div>
                     <div class="section">
                        <p>要声明SQLDA，请包含<code class="codeph">sqlda.h</code>头文件。SQLDA的内容是： <a id="d80858e511" class="indexterm-anchor"></a> 
                        </p><pre class="oac_no_warn" dir="ltr">struct SQLDA {long N; / *条目数量的描述符大小* / char ** V;主变量地址的Ptr到Arr * / int * L; / * Ptr到Arr的缓冲区长度* / short * T; / * Ptr到Arr的缓冲类型* / short ** I; *指标变量地址* /长F的Ptr到Arr; / * DESCRIBE * / char ** S找到的变量数量; / *变量名指针的Ptr到Arr * / short * M; / * Ptr到Arr的最大长度为var。名字* /短* C; *当前长度为var的Ptr到Arr。姓名* / char ** X; / * Ptr到ind的Arr。变种。名字指针* /短* Y; / * Ptr到Arr的最大长度为ind。变种。名字* /短* Z; / * Ptr到arr的长度为ind。变种。名字* /};</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="LNPCC4139"></a><a id="LNPCC4138"></a><div class="props_rev_3"><a id="GUID-0523C053-0F0C-40B2-A22E-4D2860001A8A" name="GUID-0523C053-0F0C-40B2-A22E-4D2860001A8A"></a><h4 id="LNPCC-GUID-0523C053-0F0C-40B2-A22E-4D2860001A8A" class="sect4"><span class="enumeration_section">15.2.4</span>分配SQLDA</h4>
                  <div>
                     <p>声明SQLDA后，分配存储空间，它与<code class="codeph">SQLSQLDAAlloc()</code>库函数（被称为<code class="codeph">sqlaldt()</code> Oracle8的前），使用语法<a id="d80858e549" class="indexterm-anchor"></a><a id="d80858e553" class="indexterm-anchor"></a><a id="d80858e557" class="indexterm-anchor"></a> ：</p><pre class="oac_no_warn" dir="ltr">descriptor_name = SQLSQLDAAlloc（runtime_context，max_vars，max_name，max_ind_name）;</pre><p>哪里：</p>
                     <div class="tblformal" id="GUID-0523C053-0F0C-40B2-A22E-4D2860001A8A__GUID-772417FA-2BF3-429C-A213-52BC5FE0C0A6">
                        <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="descriptions of runtime_context, max_vars, max_name, and                 max_ind_name" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="29%" id="d80858e574">句法</th>
                                 <th align="left" valign="bottom" width="71%" id="d80858e577">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d80858e582" headers="d80858e574 ">
                                    <p><span class="italic">runtime_context</span></p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d80858e582 d80858e577 ">
                                    <p>指向运行时上下文</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d80858e590" headers="d80858e574 ">
                                    <p><span class="italic">max_vars</span></p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d80858e590 d80858e577 ">
                                    <p>是描述符可以描述的选择列表项或占位符的最大数量。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d80858e598" headers="d80858e574 ">
                                    <p><span class="italic">max_name</span>                             
                                    </p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d80858e598 d80858e577 ">
                                    <p>是select-list或占位符名称的最大长度。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d80858e607" headers="d80858e574 ">
                                    <p><span class="italic">max_ind_name</span></p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d80858e607 d80858e577 ">
                                    <p>是指示符变量名称的最大长度，可选择附加到占位符名称。此参数仅适用于绑定描述符，因此在分配选择描述符时将其设置为零。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>除了描述符之外， <code class="codeph">SQLSQLDAAlloc()</code>分配描述符变量所指向的数据缓冲区。
                     </p>
                     <p><a href="Oracle-dynamic-SQL-method-4.html#GUID-0523C053-0F0C-40B2-A22E-4D2860001A8A__I7504">图15-1</a>显示了变量是由<code class="codeph">SQLSQLDAAlloc()</code>调用，DESCRIBE命令，FETCH命令还是程序分配设置的。
                     </p>
                     <div class="figure" id="GUID-0523C053-0F0C-40B2-A22E-4D2860001A8A__I7504">
                        <p class="titleinfigure">图15-1如何设置变量</p><img src="img/lnpcc010.gif" alt="下面是图15-1的描述" title="下面是图15-1的描述" longdesc="img_text/lnpcc010.html"><br><a href="img_text/lnpcc010.html">“图15-1如何设置变量”的描述</a></div>
                     <!-- class="figure" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="Oracle-dynamic-SQL-method-4.html#GUID-867E8510-B128-458A-9E0D-32BAAB66F72C">关于使用SQLDA变量</a></li>
                           <li><a href="Oracle-dynamic-SQL-method-4.html#GUID-C523D609-AD73-4AFB-BB84-EA0510984522">为描述符分配存储空间</a></li>
                        </ul>
                     </div>
                  </div>
                  
               </div>
            </div><a id="LNPCC4140"></a><div class="props_rev_3"><a id="GUID-867E8510-B128-458A-9E0D-32BAAB66F72C" name="GUID-867E8510-B128-458A-9E0D-32BAAB66F72C"></a><h3 id="LNPCC-GUID-867E8510-B128-458A-9E0D-32BAAB66F72C" class="sect3"><span class="enumeration_section">15.3</span>关于使用SQLDA变量</h3>
               <div>
                  <p>本节介绍SQLDA中每个变量的用途和用法。 <a id="d80858e670" class="indexterm-anchor"></a> 
                  </p>
               </div><a id="LNPCC4141"></a><div class="props_rev_3"><a id="GUID-6FCEEDE5-F59A-428A-A214-E738CDFFA0E8" name="GUID-6FCEEDE5-F59A-428A-A214-E738CDFFA0E8"></a><h4 id="LNPCC-GUID-6FCEEDE5-F59A-428A-A214-E738CDFFA0E8" class="sect4"><span class="enumeration_section">15.3.1</span> <span class="italic">N</span>变量</h4>
                  <div>
                     <div class="section">
                        <p><span class="italic"><span class="bold">N</span></span>指定可以DESCRIBEd的选择列表项或占位符的最大数量。因此， <span class="italic">N</span>确定描述符数组中的元素数量。 <a id="d80858e709" class="indexterm-anchor"></a><a id="d80858e713" class="indexterm-anchor"></a><a id="d80858e717" class="indexterm-anchor"></a> 
                        </p>
                        <p>在发出可选的DESCRIBE命令之前，必须使用<code class="codeph">SQLSQLDAAlloc()</code>库函数将<span class="italic">N</span>设置为描述符数组的维度。在DESCRIBE之后，必须将<span class="italic">N</span>重置为变量DESCRIBEd的实际数量，该变量存储在<span class="italic">F</span>变量中。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="LNPCC4142"></a><div class="props_rev_3"><a id="GUID-DA4818D9-C19A-4D58-81D9-59913D9ACD1B" name="GUID-DA4818D9-C19A-4D58-81D9-59913D9ACD1B"></a><h4 id="LNPCC-GUID-DA4818D9-C19A-4D58-81D9-59913D9ACD1B" class="sect4"><span class="enumeration_section">15.3.2</span> <span class="italic">V</span>变量</h4>
                  <div>
                     <div class="section">
                        <p><span class="italic">V</span>是指向存储select-list或bind-variable值的数据缓冲区地址数组的指针。 <a id="d80858e766" class="indexterm-anchor"></a><a id="d80858e770" class="indexterm-anchor"></a><a id="d80858e774" class="indexterm-anchor"></a> 
                        </p>
                        <p>分配描述符时， <code class="codeph">SQLSQLDAAlloc()</code>将地址数组中的元素<code class="codeph">V[0]</code>到<code class="codeph">V[N - 1]</code>归零。
                        </p>
                        <p><span class="bold">对于选择描述符</span> ，必须在发出FETCH命令之前分配数据缓冲区并设置此数组。该声明</p><pre class="oac_no_warn" dir="ltr">EXEC SQL FETCH ...使用描述符...
</pre><p>指示Oracle将FETCHed选择列表值存储在<code class="codeph">V[0]</code>到<code class="codeph">V[N - 1]</code>指向的数据缓冲区中。Oracle将第<span class="italic">i</span>个选择列表值存储在<code class="codeph">V[i]</code>指向的数据缓冲区中。
                        </p>
                        <p><span class="bold">对于绑定描述符</span> ，必须在发出OPEN命令之前设置此数组。该声明</p><pre class="oac_no_warn" dir="ltr">EXEC SQL OPEN ...使用描述符...
 </pre><p>指示Oracle使用<code class="codeph">V[0]</code>到<code class="codeph">V[N - 1]</code>指向的绑定变量值执行动态SQL语句。Oracle在<code class="codeph">V[</code> <span class="italic">i</span> <code class="codeph">]</code>指向的数据缓冲区中找到第<span class="italic">i</span>个绑定变量值。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="LNPCC4143"></a><div class="props_rev_3"><a id="GUID-DF9C91EF-2F5D-4A21-97A9-46BE791CA3F9" name="GUID-DF9C91EF-2F5D-4A21-97A9-46BE791CA3F9"></a><h4 id="LNPCC-GUID-DF9C91EF-2F5D-4A21-97A9-46BE791CA3F9" class="sect4"><span class="enumeration_section">15.3.3</span> <span class="italic">L</span>变量</h4>
                  <div>
                     <div class="section">
                        <p><span class="italic">L</span>是指向存储在数据缓冲区中的select-list或bind-variable值的长度数组的指针。 <a id="d80858e865" class="indexterm-anchor"></a><a id="d80858e869" class="indexterm-anchor"></a><a id="d80858e873" class="indexterm-anchor"></a> 
                        </p>
                        <p><span class="bold">对于选择描述符</span> ，DESCRIBE SELECT LIST将长度数组设置为每个选择列表项的预期最大值。但是，您可能希望在发出FETCH命令之前重置某些长度。FETCH最多返回<span class="italic">n个</span>字符，其中<span class="italic">n</span>是FETCH之前的<code class="codeph">L[</code> <span class="italic">i</span> <code class="codeph">]</code>的值。</p>
                        <p>长度的格式因Oracle数据类型而异。对于CHAR或VARCHAR2选择列表项，DESCRIBE SELECT LIST将<code class="codeph">L[</code> <span class="italic">i</span> <code class="codeph">]</code>设置为选择列表项的最大长度。对于NUMBER个选择列表项，分别在变量的低字节和下一个字节中返回缩放和精度。您可以使用库函数<code class="codeph">SQLNumberPrecV6()</code>从<code class="codeph">L[</code> <span class="italic">i</span> <code class="codeph">]</code>提取精度和比例值。
                        </p>
                        <p>必须在FETCH之前将<code class="codeph">L[</code> <span class="italic">i</span> <code class="codeph">]</code>复位到数据缓冲区所需的长度。例如，在将NUMBER强制转换为C <span class="bold">char</span>字符串时，将<code class="codeph">L[</code> <span class="italic">i</span> <code class="codeph">]</code>设置为数字的精度加上符号和小数点的2。将NUMBER强制转换为C <span class="bold">浮点数时</span> ，将<code class="codeph">L[</code> <span class="italic">i</span> <code class="codeph">]</code>设置为系统上<span class="bold">浮点数</span>的长度。
                        </p>
                        <p><span class="bold">对于绑定描述符</span> ，必须在发出OPEN命令之前设置长度数组。例如，您可以使用<code class="codeph">strlen()</code>来获取用户输入的绑定变量字符串的长度，然后设置适当的数组元素。
                        </p>
                        <p>因为Oracle使用存储在<code class="codeph">V[</code> <span class="italic">i</span> <code class="codeph">]</code>的地址间接访问数据缓冲区，所以它不知道该缓冲区中值的长度。如果要更改Oracle用于第<span class="italic">i</span>个选择列表或绑定变量值的长度，请将<code class="codeph">L[</code> <span class="italic">i</span> <code class="codeph">]</code>重置为所需的长度。每个输入或输出缓冲区可以具有不同的长度。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="Oracle-dynamic-SQL-method-4.html#GUID-0A53AE88-FB46-41C0-B582-C2A505BC2079">提取精度和规模</a></li>
                        </ul>
                     </div>
                  </div>
                  
               </div><a id="LNPCC4144"></a><div class="props_rev_3"><a id="GUID-E70CEE9D-D9BA-42FA-B54A-2204561DF7DF" name="GUID-E70CEE9D-D9BA-42FA-B54A-2204561DF7DF"></a><h4 id="LNPCC-GUID-E70CEE9D-D9BA-42FA-B54A-2204561DF7DF" class="sect4"><span class="enumeration_section">15.3.4</span> <span class="italic">T</span>变量</h4>
                  <div>
                     <div class="section">
                        <p><span class="italic">T</span>是指向select-list或bind-variable值的数据类型代码数组的指针。这些代码确定Oracle数据在存储在<span class="italic">V</span>数组元素寻址的数据缓冲区时的转换方式。
                        </p>
                        <p><span class="bold">对于选择描述符</span> ，DESCRIBE SELECT LIST将数据类型代码数组设置为选择列表中项目的<span class="italic">内部</span>数据类型（例如CHAR，NUMBER或DATE）。
                        </p>
                        <p>在FETCHing之前，您可能希望重置某些数据类型，因为Oracle数据类型的内部格式可能难以处理。出于显示目的，通常将选择列表值的数据类型强制转换为VARCHAR2或STRING是一个好主意。对于计算，您可能希望强制从Oracle到C格式的数字。</p>
                        <p>设置<code class="codeph">T[</code> <span class="italic">i</span> <code class="codeph">]</code>的高位以指示第<span class="italic">i</span>个选择列表项的NULL /非NULL状态。在发出OPEN或FETCH命令之前，必须始终清除该位。您使用库函数<code class="codeph">SQLColumnNullCheck()</code>来检索数据类型代码并清除NULL / not NULL位。
                        </p>
                        <p>您应该将Oracle NUMBER内部数据类型更改为与<code class="codeph">V[</code> <span class="italic">i</span> <code class="codeph">]</code>指向的C数据缓冲区的外部数据类型兼容的外部数据类型。
                        </p>
                        <p><span class="bold">对于绑定描述符</span> ，DESCRIBE BIND VARIABLES将数据类型代码数组设置为零。在发出OPEN命令之前，必须设置存储在每个元素中的数据类型代码。代码表示<code class="codeph">V[</code> <span class="italic">i</span> <code class="codeph">]</code>指向的数据缓冲区的外部（C）数据类型。通常，绑定变量值存储在字符串中，因此数据类型数组元素设置为1（VARCHAR2数据类型代码）。您还可以使用数据类型代码5（STRING）。
                        </p>
                        <p>要更改第<span class="italic">i</span>个选择列表或绑定变量值的数据类型，请将<code class="codeph">T[</code> <span class="italic">i</span> <code class="codeph">]</code>重置为所需的数据类型。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="Oracle-dynamic-SQL-method-4.html#GUID-ED3A5BFA-7848-4F1D-9C46-1FF97DDCE5B0">转换数据</a></li>
                           <li><a href="Oracle-dynamic-SQL-method-4.html#GUID-F713062E-314B-41E4-93C7-406999367618">强制数据类型</a></li>
                           <li><a href="Oracle-dynamic-SQL-method-4.html#GUID-E8EB0987-EA56-40C4-94D6-0CDC4BF51188">处理NULL /非NULL数据类型</a></li>
                        </ul>
                     </div>
                  </div>
                  
               </div><a id="LNPCC4145"></a><div class="props_rev_3"><a id="GUID-45F9832A-9074-4F3C-96C1-1B6ACB1A3819" name="GUID-45F9832A-9074-4F3C-96C1-1B6ACB1A3819"></a><h4 id="LNPCC-GUID-45F9832A-9074-4F3C-96C1-1B6ACB1A3819" class="sect4"><span class="enumeration_section">15.3.5</span> <span class="italic">I</span>变量</h4>
                  <div>
                     <div class="section">
                        <p><span class="italic">我</span>是一个指向存储指标变量值的数据缓冲区地址数组的指针。 <a id="d80858e1122" class="indexterm-anchor"></a><a id="d80858e1126" class="indexterm-anchor"></a><a id="d80858e1130" class="indexterm-anchor"></a> 
                        </p>
                        <p>您必须在地址数组中设置元素<code class="codeph">I[0]</code>到<code class="codeph">I[N - 1]</code> 。
                        </p>
                        <p><span class="bold">对于选择描述符</span> ，必须在发出FETCH命令之前设置地址数组。当Oracle执行语句时</p><pre class="oac_no_warn" dir="ltr">EXEC SQL FETCH ...使用描述符...
</pre><p>如果第<span class="italic">i</span>个返回的select-list值为NULL，则<code class="codeph">I[</code> <span class="italic">i</span> <code class="codeph">]</code>指向的指示符变量值设置为-1。否则，将其设置为零（值不为NULL）或正整数（该值被截断）。
                        </p>
                        <p><span class="bold">对于绑定描述符</span> ，必须在发出OPEN命令之前设置地址数组和关联的指示符变量。当Oracle执行语句时</p><pre class="oac_no_warn" dir="ltr">EXEC SQL OPEN ...使用描述符...
</pre><p><code class="codeph">I[</code> <span class="italic">i</span> <code class="codeph">]</code>指向的数据缓冲区确定第<span class="italic">i</span>个绑定变量是否具有NULL值。如果指示符变量的值为-1，则其关联的绑定变量的值为NULL。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="LNPCC4146"></a><div class="props_rev_3"><a id="GUID-BFA6CBD5-5F56-4CF3-8D3C-FA61288EFFD7" name="GUID-BFA6CBD5-5F56-4CF3-8D3C-FA61288EFFD7"></a><h4 id="LNPCC-GUID-BFA6CBD5-5F56-4CF3-8D3C-FA61288EFFD7" class="sect4"><span class="enumeration_section">15.3.6</span> <span class="italic">F</span>变量</h4>
                  <div>
                     <div class="section">
                        <p><span class="italic">F</span>是DESCRIBE找到的选择列表项或占位符的实际数量。 <a id="d80858e1210" class="indexterm-anchor"></a><a id="d80858e1214" class="indexterm-anchor"></a><a id="d80858e1218" class="indexterm-anchor"></a> 
                        </p>
                        <p><span class="italic">F</span>由DESCRIBE设定。如果<span class="italic">F</span>小于零，则DESCRIBE发现过多的选择列表项或占位符用于分配的描述符大小。例如，如果将<span class="italic">N</span>设置为10但DESCRIBE找到11个选择列表项或占位符，则<span class="italic">F</span>设置为-11。此功能允许您根据需要动态地为选择列表项或占位符重新分配更大的存储区域。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="LNPCC4147"></a><div class="props_rev_3"><a id="GUID-E16BF8CD-0E9A-4A48-9A04-DF8A2ECEA082" name="GUID-E16BF8CD-0E9A-4A48-9A04-DF8A2ECEA082"></a><h4 id="LNPCC-GUID-E16BF8CD-0E9A-4A48-9A04-DF8A2ECEA082" class="sect4"><span class="enumeration_section">15.3.7</span> <span class="italic">S</span>变量</h4>
                  <div>
                     <div class="section">
                        <p><span class="italic">S</span>是指向数据缓冲区地址数组的指针，这些数据缓冲区存储动态SQL语句中出现的选择列表或占位符名称。 <a id="d80858e1266" class="indexterm-anchor"></a><a id="d80858e1270" class="indexterm-anchor"></a><a id="d80858e1274" class="indexterm-anchor"></a> 
                        </p>
                        <p>您使用<code class="codeph">SQLSQLDAAlloc()</code>分配数据缓冲区并将其地址存储在<span class="italic">S</span>数组中。
                        </p>
                        <p>DESCRIBE指示Oracle将第<span class="italic">i</span>个选择列表项或占位符的名称存储在<code class="codeph">S[</code> <span class="italic">i</span> <code class="codeph">]</code>指向的数据缓冲区中。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="LNPCC4148"></a><div class="props_rev_3"><a id="GUID-17121BE7-611E-4589-9D48-31A66BCB0E0E" name="GUID-17121BE7-611E-4589-9D48-31A66BCB0E0E"></a><h4 id="LNPCC-GUID-17121BE7-611E-4589-9D48-31A66BCB0E0E" class="sect4"><span class="enumeration_section">15.3.8</span> <span class="italic">M</span>变量</h4>
                  <div>
                     <div class="section">
                        <p><span class="italic">M</span>是指向存储选择列表或占位符名称的最大数据缓冲区长度数组的指针。缓冲区由<span class="italic">S</span>数组的元素寻址。 <a id="d80858e1332" class="indexterm-anchor"></a><a id="d80858e1336" class="indexterm-anchor"></a><a id="d80858e1340" class="indexterm-anchor"></a> 
                        </p>
                        <p>分配描述符时， <code class="codeph">SQLSQLDAAlloc()</code>在最大长度数组中设置元素<code class="codeph">M[0]</code>到<code class="codeph">M[N - 1]</code> 。当存储在<code class="codeph">S[</code> <span class="italic">i</span> <code class="codeph">]</code>指向的数据缓冲区中时，如果需要，将第<span class="italic">i</span>个名称截断为<code class="codeph">M[</code> <span class="italic">i</span> <code class="codeph">]</code>的长度。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="LNPCC4149"></a><div class="props_rev_3"><a id="GUID-619EE765-8947-4542-B6C7-9B084A0453D5" name="GUID-619EE765-8947-4542-B6C7-9B084A0453D5"></a><h4 id="LNPCC-GUID-619EE765-8947-4542-B6C7-9B084A0453D5" class="sect4"><span class="enumeration_section">15.3.9</span> <span class="italic">C</span>变量</h4>
                  <div>
                     <div class="section">
                        <p><span class="italic">C</span>是指向当前长度的选择列表或占位符名称数组的指针。 <a id="d80858e1405" class="indexterm-anchor"></a><a id="d80858e1409" class="indexterm-anchor"></a><a id="d80858e1413" class="indexterm-anchor"></a> 
                        </p>
                        <p>DESCRIBE在当前长度数组中设置元素<code class="codeph">C[0]</code>到<code class="codeph">C[N - 1]</code> 。在DESCRIBE之后，该数组包含每个选择列表或占位符名称中的字符数。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="LNPCC4150"></a><div class="props_rev_3"><a id="GUID-78A981CD-DF37-4977-9475-E728F61B7E67" name="GUID-78A981CD-DF37-4977-9475-E728F61B7E67"></a><h4 id="LNPCC-GUID-78A981CD-DF37-4977-9475-E728F61B7E67" class="sect4"><span class="enumeration_section">15.3.10</span> <span class="italic">X</span>变量</h4>
                  <div>
                     <div class="section">
                        <p><span class="italic">X</span>是指向存储指示符变量名称的数据缓冲区地址数组的指针。您可以将指标变量<span class="italic">值</span>与选择列表项和绑定变量相关联。但是，您只能将指示符变量<span class="italic">名称</span>与绑定变量相关联。因此， <span class="italic">X</span>仅适用于绑定描述符。 <a id="d80858e1465" class="indexterm-anchor"></a><a id="d80858e1469" class="indexterm-anchor"></a><a id="d80858e1473" class="indexterm-anchor"></a> 
                        </p>
                        <p>使用<code class="codeph">SQLSQLDAAlloc()</code>分配数据缓冲区并将其地址存储在<span class="italic">X</span>阵列中。
                        </p>
                        <p>DESCRIBE BIND VARIABLES指示Oracle将第<span class="italic">i</span>个指示符变量的名称存储在<code class="codeph">X[</code> <span class="italic">i</span> <code class="codeph">]</code>指向的数据缓冲区中。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="LNPCC4151"></a><div class="props_rev_3"><a id="GUID-C0EB6ECC-C68E-4424-8622-6A7226C1040A" name="GUID-C0EB6ECC-C68E-4424-8622-6A7226C1040A"></a><h4 id="LNPCC-GUID-C0EB6ECC-C68E-4424-8622-6A7226C1040A" class="sect4"><span class="enumeration_section">15.3.11</span> <span class="italic">Y</span>变量</h4>
                  <div>
                     <div class="section">
                        <p><span class="italic">Y</span>是指向存储指示符变量名称的最大数据缓冲区长度数组的指针。与<span class="italic">X</span>一样， <span class="italic">Y</span>仅适用于绑定描述符。 <a id="d80858e1534" class="indexterm-anchor"></a><a id="d80858e1538" class="indexterm-anchor"></a><a id="d80858e1542" class="indexterm-anchor"></a> 
                        </p>
                        <p>使用<code class="codeph">SQLSQLDAAlloc()</code>在最大长度数组中设置元素<code class="codeph">Y[0]</code>到<code class="codeph">Y[N - 1]</code> 。当存储在<code class="codeph">X[</code> <span class="italic">i</span> <code class="codeph">]</code>指向的数据缓冲区中时，如果需要，将第<span class="italic">i</span>个名称截断为<code class="codeph">Y[</code> <span class="italic">i</span> <code class="codeph">]</code>的长度。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="LNPCC4152"></a><div class="props_rev_3"><a id="GUID-AADC2916-24ED-4738-823C-CD39760707CE" name="GUID-AADC2916-24ED-4738-823C-CD39760707CE"></a><h4 id="LNPCC-GUID-AADC2916-24ED-4738-823C-CD39760707CE" class="sect4"><span class="enumeration_section">15.3.12</span> <span class="italic">Z</span>变量</h4>
                  <div>
                     <div class="section">
                        <p><span class="italic">Z</span>是指向当前长度的指示符变量名称数组的指针。与<span class="italic">X</span>和<span class="italic">Y一样</span> ， <span class="italic">Z</span>仅适用于绑定描述符。 <a id="d80858e1616" class="indexterm-anchor"></a><a id="d80858e1620" class="indexterm-anchor"></a><a id="d80858e1624" class="indexterm-anchor"></a> 
                        </p>
                        <p>DESCRIBE BIND VARIABLES在当前长度数组中设置元素<code class="codeph">Z[0]</code>到<code class="codeph">Z[N - 1]</code> 。在DESCRIBE之后，数组包含每个指示符变量名称中的字符数。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="LNPCC4153"></a><div class="props_rev_3"><a id="GUID-99CB556C-7D04-4718-9728-12CF93E9C8DF" name="GUID-99CB556C-7D04-4718-9728-12CF93E9C8DF"></a><h3 id="LNPCC-GUID-99CB556C-7D04-4718-9728-12CF93E9C8DF" class="sect3"><span class="enumeration_section">15.4</span>一些预赛</h3>
               <div>
                  <p>您需要具备以下主题的工作知识才能实现动态SQL方法4： <a id="d80858e1661" class="indexterm-anchor"></a> 
                  </p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="Oracle-dynamic-SQL-method-4.html#GUID-ED3A5BFA-7848-4F1D-9C46-1FF97DDCE5B0">转换数据</a></p>
                     </li>
                     <li>
                        <p><a href="Oracle-dynamic-SQL-method-4.html#GUID-F713062E-314B-41E4-93C7-406999367618">强制数据类型</a></p>
                     </li>
                     <li>
                        <p><a href="Oracle-dynamic-SQL-method-4.html#GUID-E8EB0987-EA56-40C4-94D6-0CDC4BF51188">处理NULL /非NULL数据类型</a></p>
                     </li>
                  </ul>
               </div><a id="LNPCC4154"></a><div class="props_rev_3"><a id="GUID-ED3A5BFA-7848-4F1D-9C46-1FF97DDCE5B0" name="GUID-ED3A5BFA-7848-4F1D-9C46-1FF97DDCE5B0"></a><h4 id="LNPCC-GUID-ED3A5BFA-7848-4F1D-9C46-1FF97DDCE5B0" class="sect4"><span class="enumeration_section">15.4.1</span>转换数据</h4>
                  <div>
                     <p>本节提供有关<span class="italic">T</span> （数据类型）描述符数组的更多详细信息。在既不使用数据类型等效也不使用动态SQL方法4的主机程序中，Oracle内部数据类型和外部数据类型之间的转换是在预编译时确定的。默认情况下，预编译器会为Declare Section中的每个主机变量分配特定的外部数据类型。例如，预编译器将INTEGER外部数据类型分配给类型为<span class="italic">int的</span>主机变量。
                     </p>
                     <p>但是，方法4允许您控制数据转换和格式。您可以通过在<span class="italic">T</span>描述符数组中设置数据类型代码来指定转换。
                     </p>
                  </div><a id="LNPCC4156"></a><a id="LNPCC4155"></a><div class="props_rev_3"><a id="GUID-B0A401B7-A4D8-41B7-BA04-33991E2517E3" name="GUID-B0A401B7-A4D8-41B7-BA04-33991E2517E3"></a><h5 id="LNPCC-GUID-B0A401B7-A4D8-41B7-BA04-33991E2517E3" class="sect5"><span class="enumeration_section">15.4.1.1</span>内部数据类型</h5>
                     <div>
                        <div class="section">
                           <p>内部数据类型指定Oracle用于在数据库表中存储列值的格式，以及用于表示伪列值的格式。</p>
                           <p>当您发出DESCRIBE SELECT LIST命令时，Oracle会将每个选择列表项的内部数据类型代码返回到<span class="italic">T</span>描述符数组。例如，第<span class="italic">i</span>个选择列表项的数据类型代码返回到<code class="codeph">T[</code> <span class="italic">i</span> <code class="codeph">]</code> 。
                           </p>
                           <p><a href="Oracle-dynamic-SQL-method-4.html#GUID-B0A401B7-A4D8-41B7-BA04-33991E2517E3__BABEBHAF" title="Oracle内部数据类型">表15-1</a>显示了Oracle内部数据类型及其代码：<a id="d80858e1764" class="indexterm-anchor"></a></p>
                        </div>
                        <!-- class="section" -->
                        <div class="tblformal" id="GUID-B0A401B7-A4D8-41B7-BA04-33991E2517E3__BABEBHAF">
                           <p class="titleintable">表15-1 Oracle Internal数据类型</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="Oracle内部数据类型" width="100%" border="1" summary="Oracle Internal Datatypes" frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="79%" id="d80858e1778">Oracle内部数据类型</th>
                                    <th align="left" valign="bottom" width="21%" id="d80858e1781">码</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="79%" id="d80858e1786" headers="d80858e1778 ">
                                       <p>VARCHAR2</p>
                                    </td>
                                    <td align="left" valign="top" width="21%" headers="d80858e1786 d80858e1781 ">
                                       <p>1</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="79%" id="d80858e1793" headers="d80858e1778 ">
                                       <p>数</p>
                                    </td>
                                    <td align="left" valign="top" width="21%" headers="d80858e1793 d80858e1781 ">
                                       <p>2</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="79%" id="d80858e1800" headers="d80858e1778 ">
                                       <p>长</p>
                                    </td>
                                    <td align="left" valign="top" width="21%" headers="d80858e1800 d80858e1781 ">
                                       <p>8</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="79%" id="d80858e1807" headers="d80858e1778 ">
                                       <p>BINARY_FLOAT</p>
                                    </td>
                                    <td align="left" valign="top" width="21%" headers="d80858e1807 d80858e1781 ">
                                       <p>100</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="79%" id="d80858e1814" headers="d80858e1778 ">
                                       <p>BINARY_DOUBLE</p>
                                    </td>
                                    <td align="left" valign="top" width="21%" headers="d80858e1814 d80858e1781 ">
                                       <p>101</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="79%" id="d80858e1821" headers="d80858e1778 ">
                                       <p>ROWID</p>
                                    </td>
                                    <td align="left" valign="top" width="21%" headers="d80858e1821 d80858e1781 ">
                                       <p>11</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="79%" id="d80858e1828" headers="d80858e1778 ">
                                       <p>日期</p>
                                    </td>
                                    <td align="left" valign="top" width="21%" headers="d80858e1828 d80858e1781 ">
                                       <p>12</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="79%" id="d80858e1835" headers="d80858e1778 ">
                                       <p>生的</p>
                                    </td>
                                    <td align="left" valign="top" width="21%" headers="d80858e1835 d80858e1781 ">
                                       <p>23</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="79%" id="d80858e1842" headers="d80858e1778 ">
                                       <p>LONG RAW</p>
                                    </td>
                                    <td align="left" valign="top" width="21%" headers="d80858e1842 d80858e1781 ">
                                       <p>24</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="79%" id="d80858e1849" headers="d80858e1778 ">
                                       <p>字符（或CHAR）</p>
                                    </td>
                                    <td align="left" valign="top" width="21%" headers="d80858e1849 d80858e1781 ">
                                       <p>96</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="79%" id="d80858e1856" headers="d80858e1778 ">
                                       <p>通用ROWID</p>
                                    </td>
                                    <td align="left" valign="top" width="21%" headers="d80858e1856 d80858e1781 ">
                                       <p>104</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                  </div><a id="LNPCC4158"></a><a id="LNPCC4157"></a><div class="props_rev_3"><a id="GUID-72068D5F-21E9-4C42-92FC-536437D246FB" name="GUID-72068D5F-21E9-4C42-92FC-536437D246FB"></a><h5 id="LNPCC-GUID-72068D5F-21E9-4C42-92FC-536437D246FB" class="sect5"><span class="enumeration_section">15.4.1.2</span>外部数据类型</h5>
                     <div>
                        <div class="section">
                           <p>外部数据类型指定用于在输入和输出主机变量中存储值的格式。</p>
                           <p>DESCRIBE BIND VARIABLES命令将数据类型代码的<span class="italic">T</span>数组设置为零。因此，您必须<span class="italic">在</span>发出OPEN命令<span class="italic">之前</span>重置代码。这些代码告诉Oracle各种绑定变量需要哪些外部数据类型。对于第<span class="italic">i</span>个绑定变量，将<code class="codeph">T[</code> <span class="italic">i</span> <code class="codeph">]</code>重置为所需的外部数据类型。
                           </p>
                           <p><a href="Oracle-dynamic-SQL-method-4.html#GUID-72068D5F-21E9-4C42-92FC-536437D246FB__G34096" title="Oracle外部数据类型和数据类型代码">表15-2</a>显示了Oracle外部数据类型及其代码，以及通常与每种外部数据类型一起使用的C数据类型。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="tblformal" id="GUID-72068D5F-21E9-4C42-92FC-536437D246FB__G34096">
                           <p class="titleintable">表15-2 Oracle外部数据类型和数据类型代码</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="Oracle外部数据类型和数据类型代码" width="100%" border="1" summary="Oracle External Datatypes and Datatype Codes" frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="51%" id="d80858e1923">外部数据类型</th>
                                    <th align="left" valign="bottom" width="15%" id="d80858e1926">码</th>
                                    <th align="left" valign="bottom" width="33%" id="d80858e1929">C数据类型</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e1934" headers="d80858e1923 ">
                                       <p>VARCHAR2</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e1934 d80858e1926 ">
                                       <p>1</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e1934 d80858e1929 ">
                                       <p>炭[n]的</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e1944" headers="d80858e1923 ">
                                       <p>数</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e1944 d80858e1926 ">
                                       <p>2</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e1944 d80858e1929 ">
                                       <p>char [n]（n &lt;= 22）</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e1954" headers="d80858e1923 ">
                                       <p>整数</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e1954 d80858e1926 ">
                                       <p>3</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e1954 d80858e1929 ">
                                       <p>INT</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e1964" headers="d80858e1923 ">
                                       <p>浮动</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e1964 d80858e1926 ">
                                       <p>4</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e1964 d80858e1929 ">
                                       <p>浮动</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e1974" headers="d80858e1923 ">
                                       <p>串</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e1974 d80858e1926 ">
                                       <p>五</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e1974 d80858e1929 ">
                                       <p>炭[N + 1]</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e1984" headers="d80858e1923 ">
                                       <p>VARNUM</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e1984 d80858e1926 ">
                                       <p>6</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e1984 d80858e1929 ">
                                       <p>char [n]（n &lt;= 22）</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e1994" headers="d80858e1923 ">
                                       <p>DECIMAL</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e1994 d80858e1926 ">
                                       <p>7</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e1994 d80858e1929 ">
                                       <p>浮动</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e2004" headers="d80858e1923 ">
                                       <p>长</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e2004 d80858e1926 ">
                                       <p>8</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e2004 d80858e1929 ">
                                       <p>炭[n]的</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e2014" headers="d80858e1923 ">
                                       <p>SQLT_BFLOAT</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e2014 d80858e1926 ">
                                       <p>21</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e2014 d80858e1929 ">
                                       <p>浮动</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e2024" headers="d80858e1923 ">
                                       <p>SQLT_BDOUBLE</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e2024 d80858e1926 ">
                                       <p>22</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e2024 d80858e1929 ">
                                       <p>双</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e2034" headers="d80858e1923 ">
                                       <p>VARCHAR</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e2034 d80858e1926 ">
                                       <p>9</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e2034 d80858e1929 ">
                                       <p>炭[N + 2]</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e2045" headers="d80858e1923 ">
                                       <p>ROWID</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e2045 d80858e1926 ">
                                       <p>11</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e2045 d80858e1929 ">
                                       <p>炭[n]的</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e2055" headers="d80858e1923 ">
                                       <p>日期</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e2055 d80858e1926 ">
                                       <p>12</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e2055 d80858e1929 ">
                                       <p>炭[n]的</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e2065" headers="d80858e1923 ">
                                       <p>VARRAW</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e2065 d80858e1926 ">
                                       <p>15</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e2065 d80858e1929 ">
                                       <p>炭[n]的</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e2075" headers="d80858e1923 ">
                                       <p>生的</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e2075 d80858e1926 ">
                                       <p>23</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e2075 d80858e1929 ">
                                       <p>unsigned char [n]</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e2085" headers="d80858e1923 ">
                                       <p>LONG RAW</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e2085 d80858e1926 ">
                                       <p>24</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e2085 d80858e1929 ">
                                       <p>unsigned char [n]</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e2095" headers="d80858e1923 ">
                                       <p>UNSIGNED</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e2095 d80858e1926 ">
                                       <p>68</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e2095 d80858e1929 ">
                                       <p>unsigned int</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e2105" headers="d80858e1923 ">
                                       <p>显示</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e2105 d80858e1926 ">
                                       <p>91</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e2105 d80858e1929 ">
                                       <p>炭[n]的</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e2115" headers="d80858e1923 ">
                                       <p>LONG VARCHAR</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e2115 d80858e1926 ">
                                       <p>94</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e2115 d80858e1929 ">
                                       <p>炭[N + 4]</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e2125" headers="d80858e1923 ">
                                       <p>LONG VARRAW</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e2125 d80858e1926 ">
                                       <p>95</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e2125 d80858e1929 ">
                                       <p>unsigned char [n + 4]</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e2135" headers="d80858e1923 ">
                                       <p>CHAR</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e2135 d80858e1926 ">
                                       <p>96</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e2135 d80858e1929 ">
                                       <p>炭[n]的</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e2145" headers="d80858e1923 ">
                                       <p>CHARF</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e2145 d80858e1926 ">
                                       <p>96</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e2145 d80858e1929 ">
                                       <p>炭[n]的</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="51%" id="d80858e2156" headers="d80858e1923 ">
                                       <p>CHARZ</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d80858e2156 d80858e1926 ">
                                       <p>97</p>
                                    </td>
                                    <td align="left" valign="top" width="33%" headers="d80858e2156 d80858e1929 ">
                                       <p>炭[N + 1]</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="datatypes-and-host-variables.html#GUID-D3262C5B-4A7F-44C7-A171-DC16441A31ED">Oracle数据类型</a></li>
                              <li><a href="../sqlrf/index.html" target="_blank"><span><cite>Oracle数据库SQL语言参考</cite></span></a></li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div><a id="LNPCC4159"></a><div class="props_rev_3"><a id="GUID-F713062E-314B-41E4-93C7-406999367618" name="GUID-F713062E-314B-41E4-93C7-406999367618"></a><h4 id="LNPCC-GUID-F713062E-314B-41E4-93C7-406999367618" class="sect4"><span class="enumeration_section">15.4.2</span>强制数据类型</h4>
                  <div>
                     <p>对于选择描述符，DESCRIBE SELECT LIST可以返回任何Oracle内部数据类型。通常，与字符数据一样，内部数据类型与您要使用的外部数据类型完全对应。但是，一些内部数据类型映射到可能难以处理的外部数据类型。因此，您可能希望重置<span class="italic">T</span>描述符数组中的一些元素。例如，您可能希望将NUMBER值重置为FLOAT值，这些值对应于C中的<span class="bold">浮点</span>值.Oracle在FETCH时间执行内部和外部数据类型之间的任何必要转换。所以，一定要重新设置数据类型的DESCRIBE SELECT LIST <span class="italic">之后</span> ，但<span class="italic">之前</span>的FETCH。 <a id="d80858e2212" class="indexterm-anchor"></a><a id="d80858e2216" class="indexterm-anchor"></a><a id="d80858e2221" class="indexterm-anchor"></a> 
                     </p>
                     <p>对于绑定描述符，DESCRIBE BIND VARIABLES <span class="italic">并不</span>返回绑定变量的数据类型，只是它们的数量和名称。因此，必须显式设置数据类型代码的<span class="italic">T</span>数组，以告知Oracle每个绑定变量的外部数据类型。Oracle在OPEN时执行外部和内部数据类型之间的任何必要转换。
                     </p>
                     <p>在<span class="italic">T</span>描述符数组中重置数据类型代码时，您将“强制数据类型”。例如，要将第<span class="italic">i</span>个选择列表值强制转换为STRING，请使用以下语句：</p><pre class="oac_no_warn" dir="ltr">/ *将选择列表值强制转换为STRING。 * / select_des-&gt; T [i] = 5;</pre><p>将NUMBER选择列表值强制转换为STRING以进行显示时，还必须提取值的精度和比例字节，并使用它们计算最大显示长度。然后，在FETCH之前，必须重置<span class="italic">L</span> （长度）描述符数组的相应元素，以告知Oracle要使用的缓冲区长度。
                     </p>
                     <p>例如，如果DESCRIBE SELECT LIST发现第<span class="italic">i</span>个选择列表项的类型为NUMBER，并且您希望将返回的值存储在声明为<span class="bold">float</span>的C变量中，只需将<code class="codeph">T[</code> <span class="italic">i</span> <code class="codeph">]</code>设置为4并且<code class="codeph">L[</code> <span class="italic">i</span> <code class="codeph">]</code>到您系统上的<span class="bold">浮点数</span>的长度。 <a id="d80858e2275" class="indexterm-anchor"></a> 
                     </p>
                     <div class="infoboxnotewarn" id="GUID-F713062E-314B-41E4-93C7-406999367618__GUID-CE128DF9-FC72-43C6-B279-8138B7601AE0">
                        <p class="notep1">警告：</p>
                        <p>在某些情况下，DESCRIBE SELECT LIST返回的内部数据类型可能不适合您的目的。两个例子是DATE和NUMBER。当您描述DATE选择列表项时，Oracle将数据类型代码12返回到<span class="italic">T</span>描述符数组。除非您在FETCH之前重置代码，否则日期值将以其7字节内部格式返回。要以字符格式（DD-MON-YY）获取日期，可以将数据类型代码从12更改为1（VARCHAR2）或5（STRING），并将<span class="italic">L</span>值从7增加到9或10。
                        </p>
                        <p>同样，当您描述一个NUMBER选择列表项时，Oracle会将数据类型代码2返回给<span class="italic">T</span>数组。除非您在FETCH之前重置代码，否则数值将以其内部格式返回，这可能不是您想要的。因此，将代码从2更改为1（VARCHAR2），3（INTEGER），4（FLOAT），5（STRING）或其他一些适当的数据类型。
                        </p>
                     </div>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="Oracle-dynamic-SQL-method-4.html#GUID-0A53AE88-FB46-41C0-B582-C2A505BC2079">提取精度和规模</a></li>
                        </ul>
                     </div>
                  </div>
                  <a id="LNPCC4161"></a><a id="LNPCC4160"></a><div class="props_rev_3"><a id="GUID-0A53AE88-FB46-41C0-B582-C2A505BC2079" name="GUID-0A53AE88-FB46-41C0-B582-C2A505BC2079"></a><h5 id="LNPCC-GUID-0A53AE88-FB46-41C0-B582-C2A505BC2079" class="sect5"><span class="enumeration_section">15.4.2.1</span>提取精度和比例</h5>
                     <div>
                        <div class="section">
                           <p>库函数<code class="codeph">SQLNumberPrecV6()</code> （以前称为<code class="codeph">sqlprc()</code> ） <code class="codeph"> </code>提取精度和规模。通常，它在DESCRIBE SELECT LIST之后使用，其第一个参数是<code class="codeph">L[</code> <span class="italic">i</span> <code class="codeph">]</code> 。您使用以下语法调用<code class="codeph">SQLNumberPrecV6()</code> ： <a id="d80858e2349" class="indexterm-anchor"></a><a id="d80858e2353" class="indexterm-anchor"></a> 
                           </p>
                           <div class="infoboxnote" id="GUID-0A53AE88-FB46-41C0-B582-C2A505BC2079__GUID-31C736DC-2086-4A3E-82B8-5E79D8689967">
                              <p class="notep1">注意：</p>
                              <p>请参阅特定<span class="italic"><code class="codeph">SQLNumberPrecV6</code></span>平台的<span class="italic"><code class="codeph">SQLNumberPrecV6</code></span>头文件，以获取适用于您的平台的正确原型。
                              </p>
                           </div><pre class="oac_no_warn" dir="ltr">SQLNumberPrecV6（dvoid * runtime_context，int * length，int * precision，int * scale）;</pre><p>哪里：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="tblformal" id="GUID-0A53AE88-FB46-41C0-B582-C2A505BC2079__GUID-7995B74C-0703-4D9E-915A-B0FCAD54F46A">
                           <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="description of runtime_context, length, precision, and scale" frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="29%" id="d80858e2375">句法</th>
                                    <th align="left" valign="bottom" width="71%" id="d80858e2378">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d80858e2383" headers="d80858e2375 ">
                                       <p><span class="italic">runtime_context</span></p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d80858e2383 d80858e2378 ">
                                       <p>是指向运行时上下文的指针</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d80858e2391" headers="d80858e2375 ">
                                       <p><span class="italic">长度</span></p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d80858e2391 d80858e2378 ">
                                       <p>是指向存储Oracle NUMBER值长度的长整型变量的指针;长度存储在L [i]中。值的比例和精度分别存储在低位和高位字节中。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d80858e2399" headers="d80858e2375 ">
                                       <p><span class="italic">精确</span></p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d80858e2399 d80858e2378 ">
                                       <p>是指向整数变量的指针，该变量返回NUMBER值的精度。Precision是有效数字的位数。如果select-list项指的是未指定大小的NUMBER，则设置为零。在这种情况下，由于未指定大小，您可能需要假设最大精度（38）。 <a id="d80858e2406" class="indexterm-anchor"></a><a id="d80858e2410" class="indexterm-anchor"></a><a id="d80858e2414" class="indexterm-anchor"></a> 
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="29%" id="d80858e2420" headers="d80858e2375 ">
                                       <p><span class="italic">规模</span></p>
                                    </td>
                                    <td align="left" valign="top" width="71%" headers="d80858e2420 d80858e2378 ">
                                       <p>是指向返回NUMBER值的比例的整数变量的指针。Scale指定舍入将发生的位置。例如，2的刻度表示该值四舍五入到最接近的百分位数（3.456变为3.46）;比例为-3表示数字四舍五入到最接近的千位（3456变为3000）。 <a id="d80858e2427" class="indexterm-anchor"></a><a id="d80858e2431" class="indexterm-anchor"></a> 
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <div class="section">
                           <p>当比例为负时，将其绝对值添加到长度。例如，精度为3且比例为-2允许数字大至99900。 <a id="d80858e2439" class="indexterm-anchor"></a> 
                           </p>
                           <p>以下示例显示如何使用<code class="codeph">SQLNumberPrecV6()</code>计算将被强制转换为STRING的NUMBER值的最大显示长度： <a id="d80858e2449" class="indexterm-anchor"></a> 
                           </p><pre class="oac_no_warn" dir="ltr">/ *声明函数调用的变量。* / sqlda * select_des; / *指针选择描述符* / int prec; / * precision * / int scal; / * scale * / extern void SQLNumberPrecV6（）; / *声明库函数。* / / *提取精度和比例。* / SQLNumberPrecV6（SQL_SINGLE_RCTX，＆（select_des-&gt; L [i]），＆prec，＆scal）; / *允许NUMBER的最大大小。 * / if（prec == 0）prec = 38; / *允许可能的小数点和符号。* / select_des-&gt; L [i] = prec + 2; / *允许负比例。* / if（scal &lt;0）select_des-&gt; L [i] + = -scal;</pre><p>请注意，此函数调用中的第一个参数指向长度数组中的第<span class="italic">i</span>个元素，并且所有三个参数都是地址。
                           </p>
                           <p><code class="codeph">SQLNumberPrecV6()</code>函数返回零作为某些SQL数据类型的精度和小数位数值。<code class="codeph">SQLNumberPrecV7()</code>函数类似，具有相同的参数列表，并返回相同的值，除了这些SQL数据类型的情况：<a id="d80858e2467" class="indexterm-anchor"></a></p>
                        </div>
                        <!-- class="section" -->
                        <div class="tblformal" id="GUID-0A53AE88-FB46-41C0-B582-C2A505BC2079__g34286">
                           <p class="titleintable">表15-3 SQL数据类型的精度和小数值</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="SQL数据类型的精度和比例值" width="100%" border="1" summary="Precision and Scale Values for SQL Datatypes" frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="39%" id="d80858e2480">SQL数据类型</th>
                                    <th align="left" valign="bottom" width="31%" id="d80858e2483">二进制精度</th>
                                    <th align="left" valign="bottom" width="31%" id="d80858e2486">规模</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="39%" id="d80858e2491" headers="d80858e2480 ">
                                       <p>浮动</p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d80858e2491 d80858e2483 ">
                                       <p>126</p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d80858e2491 d80858e2486 ">
                                       <p>-127</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="39%" id="d80858e2501" headers="d80858e2480 ">
                                       <p>FLOAT（N）</p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d80858e2501 d80858e2483 ">
                                       <p>N（范围是1到126）</p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d80858e2501 d80858e2486 ">
                                       <p>-127</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="39%" id="d80858e2511" headers="d80858e2480 ">
                                       <p>真实</p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d80858e2511 d80858e2483 ">
                                       <p>63</p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d80858e2511 d80858e2486 ">
                                       <p>-127</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="39%" id="d80858e2521" headers="d80858e2480 ">
                                       <p>双精度</p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d80858e2521 d80858e2483 ">
                                       <p>126</p>
                                    </td>
                                    <td align="left" valign="top" width="31%" headers="d80858e2521 d80858e2486 ">
                                       <p>-127</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                  </div>
               </div><a id="LNPCC4162"></a><div class="props_rev_3"><a id="GUID-E8EB0987-EA56-40C4-94D6-0CDC4BF51188" name="GUID-E8EB0987-EA56-40C4-94D6-0CDC4BF51188"></a><h4 id="LNPCC-GUID-E8EB0987-EA56-40C4-94D6-0CDC4BF51188" class="sect4"><span class="enumeration_section">15.4.3</span>处理NULL /非NULL数据类型</h4>
                  <div>
                     <p>对于每个select-list列（非表达式），DESCRIBE SELECT LIST在select描述符的数据类型数组<span class="italic">T</span>中返回NULL / not NULL指示。如果第<span class="italic">i</span>个选择列表列被约束为非空，则<code class="codeph">T[</code> <span class="italic">i</span> <code class="codeph">]</code>的高位被清除;否则，它被设定。 <a id="d80858e2568" class="indexterm-anchor"></a> 
                     </p>
                     <p>在OPEN或FETCH语句中使用数据类型之前，如果设置了NULL / not NULL位，则必须清除它。（切勿设置位。）</p>
                     <p>您可以使用库函数<code class="codeph">SQLColumnNullCheck()</code> （以前称为<code class="codeph">sqlnul()</code> ）来查明列是否允许NULL，并清除数据类型的NULL / not NULL位。您可以使用语法调用<code class="codeph">SQLColumnNullCheck()</code> <a id="d80858e2586" class="indexterm-anchor"></a><a id="d80858e2590" class="indexterm-anchor"></a><a id="d80858e2594" class="indexterm-anchor"></a> ：</p><pre class="oac_no_warn" dir="ltr">SQLColumnNullCheck（dvoid * context，unsigned short * value_type，unsigned short * type_code，int * null_status）;</pre><p>哪里：</p>
                     <div class="tblformal" id="GUID-E8EB0987-EA56-40C4-94D6-0CDC4BF51188__GUID-F54A8256-064F-4A75-ABBB-42E0DCFE6323">
                        <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="descriptions of context, value_type, type_code, and null_status" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="29%" id="d80858e2611">句法</th>
                                 <th align="left" valign="bottom" width="71%" id="d80858e2614">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d80858e2619" headers="d80858e2611 ">
                                    <p><span class="italic">上下文</span></p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d80858e2619 d80858e2614 ">
                                    <p>是指向运行时上下文的指针</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d80858e2627" headers="d80858e2611 ">
                                    <p><span class="italic">值类型</span></p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d80858e2627 d80858e2614 ">
                                    <p>是指向无符号短整数变量的指针，该变量存储select-list列的数据类型代码;数据类型存储在T [i]中。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d80858e2635" headers="d80858e2611 ">
                                    <p><span class="italic">类型代码</span></p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d80858e2635 d80858e2614 ">
                                    <p>是指向无符号短整型变量的指针，该变量返回清除高位的select-list列的数据类型代码。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="29%" id="d80858e2643" headers="d80858e2611 ">
                                    <p><span class="italic">null_status</span></p>
                                 </td>
                                 <td align="left" valign="top" width="71%" headers="d80858e2643 d80858e2614 ">
                                    <p>是指向返回select-list列的null状态的整数变量的指针。 1表示该列允许空值; 0意味着它没有。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>以下示例显示如何使用<code class="codeph">SQLColumnNullCheck()</code> ： <a id="d80858e2655" class="indexterm-anchor"></a> 
                     </p><pre class="oac_no_warn" dir="ltr">/ *声明函数调用的变量。* / sqlda * select_des; / *指针选择描述符* / unsigned short dtype; / *数据类型没有空位* / int nullok; / * 1 = null，0 = not null * / extern void SQLColumnNullCheck（）; / *声明库函数。* / / *确定列是否为空。* / SQLColumnNUllCheck（SQL_SINGLE_RCTX，（unsigned short *）＆（select_des-&gt; T [i]），＆dtype，＆nullok）; if（nullok）{/ * Nulls是允许的。* / .../ *清除null / not null位。* / SQLColumnNullCheck（SQL_SINGLE_RCTX，＆（select_des-&gt; T [i]），＆（select_des-&gt; T [i]），＆nullok）; }</pre><p>请注意，第二次调用<code class="codeph">SQLColumnNullCheck()</code>函数的第一个和第二个参数指向数据类型数组中的第<span class="italic">i</span>个元素，并且所有三个参数都是地址。
                     </p>
                  </div>
               </div>
            </div><a id="LNPCC4163"></a><div class="props_rev_3"><a id="GUID-3B20F486-A5CF-4938-A21B-F77066416C04" name="GUID-3B20F486-A5CF-4938-A21B-F77066416C04"></a><h3 id="LNPCC-GUID-3B20F486-A5CF-4938-A21B-F77066416C04" class="sect3"><span class="enumeration_section">15.5</span>基本步骤</h3>
               <div>
                  <div class="section">
                     <p>方法4可用于处理<span class="italic">任何</span>动态SQL语句。在下面的示例中，将处理查询，以便您可以查看如何处理输入和输出主机变量。 <a id="d80858e2698" class="indexterm-anchor"></a> 
                     </p>
                     <p>要处理动态查询，我们的示例程序采取以下步骤：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li><span>在Declare Section中声明一个主机字符串以保存查询文本。</span></li>
                     <li><span>声明select和绑定SQLDAs。</span></li>
                     <li><span>为选择和绑定描述符分配存储空间。</span></li>
                     <li><span>设置可以DESCRIBEd的选择列表项和占位符的最大数量。</span></li>
                     <li><span>将查询文本放在主机字符串中。</span></li>
                     <li><span>从主机字符串中预处理查询。</span></li>
                     <li><span>为查询DECLARE游标。</span></li>
                     <li><span>将绑定变量描述为绑定描述符。</span></li>
                     <li><span>将占位符数重置为DESCRIBE实际找到的数字。</span></li>
                     <li><span>获取值并为DESCRIBE找到的绑定变量分配存储空间。</span></li>
                     <li><span>使用绑定描述符打开游标。</span></li>
                     <li><span>将选择列表描述为选择描述符。</span></li>
                     <li><span>将选择列表项的数量重置为DESCRIBE实际找到的数字。</span></li>
                     <li><span>重置每个选择列表项的长度和数据类型以用于显示目的。</span></li>
                     <li><span>FETCH从数据库INTO到选择描述符指向的已分配数据缓冲区的一行。</span></li>
                     <li><span>处理FETCH返回的select-list值。</span></li>
                     <li><span>释放用于选择列表项，占位符，指示符变量和描述符的存储空间。</span></li>
                     <li><span>关闭光标。</span></li>
                  </ol>
                  <div class="section">
                     <div class="infoboxnote" id="GUID-3B20F486-A5CF-4938-A21B-F77066416C04__GUID-E1EDA7E1-AECD-4755-8E3E-39E4DDA46039">
                        <p class="notep1">注意：</p>
                        <p>如果动态SQL语句包含已知数量的选择列表项或占位符，则其中一些步骤是不必要的。</p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="LNPCC4164"></a><div class="props_rev_3"><a id="GUID-C9E59D78-26AC-4EA4-AE04-2A7F01296AD9" name="GUID-C9E59D78-26AC-4EA4-AE04-2A7F01296AD9"></a><h3 id="LNPCC-GUID-C9E59D78-26AC-4EA4-AE04-2A7F01296AD9" class="sect3"><span class="enumeration_section">15.6</span>仔细研究每一步</h3>
               <div>
                  <p>本节将详细讨论每个步骤。在本章的最后是一个注释，完整的程序，说明方法4。</p>
                  <p>使用方法4，您可以使用以下嵌入式SQL语句序列： <a id="d80858e2792" class="indexterm-anchor"></a> 
                  </p><pre class="oac_no_warn" dir="ltr">EXEC SQL PREPARE statement_name FROM {：host_string |字符串字面量 }; EXEC SQL DECLARE cursor_name CURSOR FOR statement_name;对于statement_name INTO bind_descriptor_name，EXEC SQL DESCRIBE BIND VARIABLES; EXEC SQL OPEN cursor_name [USING DESCRIPTOR bind_descriptor_name]; EXEC SQL DESCRIBE [SELECT LIST FOR] statement_name INTO select_descriptor_name; EXEC SQL FETCH cursor_name使用DESCRIPTOR select_descriptor_name; EXEC SQL CLOSE cursor_name;</pre><p>可滚动游标也可以与方法4一起使用。必须将以下嵌入式SQL语句序列用于可滚动游标。</p><pre class="oac_no_warn" dir="ltr">EXEC SQL PREPARE statement_name FROM {：host_string |字符串字面量 }; EXEC SQL DECLARE cursor_name SCROLL CURSOR FOR statement_name;对于statement_name INTO bind_descriptor_name，EXEC SQL DESCRIBE BIND VARIABLES; EXEC SQL OPEN cusor_name [USING DESCRIPTOR bind_descriptor_name]; EXEC SQL DESCRIBE [SELECT LIST FOR] statement_name INTO select_descriptor_name; EXEC SQL FETCH [FIRST | PRIOR | NEXT | LAST | CURRENT | RELATIVE fetch_offset | ABSOLUTE fetch_offset] cursor_name使用DESCRIPTOR select_descriptor_name; EXEC SQL CLOSE cursor_name;</pre><p>如果已知动态查询中的选择列表项的数量，则可以省略DESCRIBE SELECT LIST并使用以下方法3 FETCH语句：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL FETCH cursor_name INTO host_variable_list;</pre><p>或者，如果已知动态SQL语句中绑定变量的占位符数，则可以省略DESCRIBE BIND VARIABLES并使用以下方法3 OPEN语句：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL OPEN cursor_name [USING host_variable_list];</pre><p>接下来，您将看到这些语句如何允许宿主程序使用描述符接受和处理动态SQL语句。</p>
                  <div class="infoboxnote" id="GUID-C9E59D78-26AC-4EA4-AE04-2A7F01296AD9__GUID-9ED849EA-6078-4147-AB8A-98AD8FD65D54">
                     <p class="notep1">注意：</p>
                     <p>以下讨论伴随着几个数字。为避免混淆数字，有必要执行以下操作：</p>
                  </div>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>将描述符数组限制为3个元素</p>
                     </li>
                     <li>
                        <p>将名称的最大长度限制为5个字符</p>
                     </li>
                     <li>
                        <p>将值的最大长度限制为10个字符</p>
                     </li>
                  </ul>
               </div><a id="LNPCC4165"></a><div class="props_rev_3"><a id="GUID-70BD8971-A44C-46B9-B482-260812984806" name="GUID-70BD8971-A44C-46B9-B482-260812984806"></a><h4 id="LNPCC-GUID-70BD8971-A44C-46B9-B482-260812984806" class="sect4"><span class="enumeration_section">15.6.1</span>声明主机字符串</h4>
                  <div>
                     <p>您的程序需要一个宿主变量来存储动态SQL语句的文本。必须将主变量（在我们的示例中为<span class="italic">select_stmt</span> ）声明为字符串。
                     </p><pre class="oac_no_warn" dir="ltr">...int emp_number; VARCHAR emp_name [10]; VARCHAR select_stmt [120];浮动奖金;</pre></div>
               </div><a id="LNPCC4166"></a><div class="props_rev_3"><a id="GUID-3F0A471A-2484-4566-93BD-90655B5E2F70" name="GUID-3F0A471A-2484-4566-93BD-90655B5E2F70"></a><h4 id="LNPCC-GUID-3F0A471A-2484-4566-93BD-90655B5E2F70" class="sect4"><span class="enumeration_section">15.6.2</span>声明SQLDA</h4>
                  <div>
                     <p>在我们的示例中，您使用INCLUDE将其复制到程序中，而不是对SQLDA数据结构进行硬编码，如下所示：</p><pre class="oac_no_warn" dir="ltr">#include &lt;sqlda.h&gt;</pre><p>然后，因为查询可能包含未知数量的选择列表项或绑定变量的占位符，所以您声明指针以选择和绑定描述符，如下所示：</p><pre class="oac_no_warn" dir="ltr">sqlda * select_des; sqlda * bind_des;</pre></div>
               </div><a id="LNPCC4167"></a><div class="props_rev_3"><a id="GUID-C523D609-AD73-4AFB-BB84-EA0510984522" name="GUID-C523D609-AD73-4AFB-BB84-EA0510984522"></a><h4 id="LNPCC-GUID-C523D609-AD73-4AFB-BB84-EA0510984522" class="sect4"><span class="enumeration_section">15.6.3</span>为描述符分配存储空间</h4>
                  <div>
                     <p>回想一下，您使用<code class="codeph">SQLSQLDAAlloc()</code>库函数为描述符分配存储空间。使用ANSI C表示法的语法是：</p><pre class="oac_no_warn" dir="ltr">SQLDA * SQLSQLDAAlloc（dvoid * context，unsigned int max_vars，unsigned int max_name，unsigned int max_ind_name）;</pre><p><code class="codeph">SQLSQLDAAlloc()</code>函数分配描述符结构和由指针变量<span class="italic">V</span> ， <span class="italic">L</span> ， <span class="italic">T</span>和<span class="italic">I</span>寻址的数组。</p>
                     <p>如果<span class="italic">max_name</span>非零，则分配由指针变量<span class="italic">S</span> ， <span class="italic">M</span>和<span class="italic">C</span>寻址的数组。如果<span class="italic">max_ind_name</span>非零，则分配由指针变量<span class="italic">X</span> ， <span class="italic">Y</span>和<span class="italic">Z</span>寻址的数组。如果<span class="italic">max_name</span>和<span class="italic">max_ind_name</span>为零， <span class="italic">则不</span>分配空间。
                     </p>
                     <p>如果<code class="codeph">SQLSQLDAAlloc()</code>成功，则返回指向结构的指针。如果<code class="codeph">SQLSQLDAAlloc()</code>失败，则返回零。
                     </p>
                     <p>在我们的示例中，您分配了select和bind描述符，如下所示： <a id="d80858e2976" class="indexterm-anchor"></a> 
                     </p><pre class="oac_no_warn" dir="ltr">select_des = SQLSQLDAAlloc（SQL_SINGLE_RCTX，3，（size_t）5，（size_t）0）; bind_des = SQLSQLDAAlloc（SQL_SINGLE_RCTX，3，（size_t）5，（size_t）4）;</pre><p>对于选择描述符，始终将<span class="italic">max_ind_name</span>设置为零，以便不为<span class="italic">X</span>寻址的数组分配空间。</p>
                  </div>
               </div><a id="LNPCC4169"></a><a id="LNPCC4170"></a><a id="LNPCC4168"></a><div class="props_rev_3"><a id="GUID-3FB0EF90-71B3-43F6-B0C9-89F9E95EE815" name="GUID-3FB0EF90-71B3-43F6-B0C9-89F9E95EE815"></a><h4 id="LNPCC-GUID-3FB0EF90-71B3-43F6-B0C9-89F9E95EE815" class="sect4"><span class="enumeration_section">15.6.4</span>设置最大编号为DESCRIBE</h4>
                  <div>
                     <p>接下来，设置可以DESCRIBEd的选择列表项或占位符的最大数量，如下所示：</p><pre class="oac_no_warn" dir="ltr">select_des-&gt; N = 3; bind_des-&gt; N = 3;</pre><p><a href="Oracle-dynamic-SQL-method-4.html#GUID-3FB0EF90-71B3-43F6-B0C9-89F9E95EE815__I12575">图15-2</a>和<a href="Oracle-dynamic-SQL-method-4.html#GUID-3FB0EF90-71B3-43F6-B0C9-89F9E95EE815__I12577">图15-3</a>表示结果描述符。
                     </p>
                     <div class="infoboxnote" id="GUID-3FB0EF90-71B3-43F6-B0C9-89F9E95EE815__GUID-DE756BF1-8D55-430A-BFBC-A7E2A96404BC">
                        <p class="notep1">注意：</p>
                        <p>在选择描述符（ <a href="Oracle-dynamic-SQL-method-4.html#GUID-3FB0EF90-71B3-43F6-B0C9-89F9E95EE815__I12575">图15-2</a> ）中，指示符变量名称的部分被划掉以表明它未被使用。
                        </p>
                     </div>
                     <div class="figure" id="GUID-3FB0EF90-71B3-43F6-B0C9-89F9E95EE815__I12575">
                        <p class="titleinfigure">图15-2初始化的选择描述符</p><img src="img/lnpcc011.gif" width="499" alt="下面是图15-2的描述" title="下面是图15-2的描述" longdesc="img_text/lnpcc011.html"><br><a href="img_text/lnpcc011.html">“图15-2初始化选择描述符”的描述</a></div>
                     <!-- class="figure" -->
                     <div class="figure" id="GUID-3FB0EF90-71B3-43F6-B0C9-89F9E95EE815__I12577">
                        <p class="titleinfigure">图15-3初始化的绑定描述符</p><img src="img/lnpcc012.gif" width="499" alt="下面是图15-3的描述" title="下面是图15-3的描述" longdesc="img_text/lnpcc012.html"><br><a href="img_text/lnpcc012.html">“图15-3初始化绑定描述符”的描述</a></div>
                     <!-- class="figure" -->
                  </div>
               </div><a id="LNPCC4171"></a><div class="props_rev_3"><a id="GUID-BCFDBC06-C2C6-42A3-9F2E-1DA02A616D37" name="GUID-BCFDBC06-C2C6-42A3-9F2E-1DA02A616D37"></a><h4 id="LNPCC-GUID-BCFDBC06-C2C6-42A3-9F2E-1DA02A616D37" class="sect4"><span class="enumeration_section">15.6.5</span>将查询文本放在主机字符串中</h4>
                  <div>
                     <p>继续我们的示例，您提示用户输入SQL语句，然后将输入字符串存储在<span class="italic">select_stmt中</span> ，如下所示：</p><pre class="oac_no_warn" dir="ltr">printf（“\ n \ n输入SQL语句：”）;得到（select_stmt.arr）; select_stmt.len = strlen（select_stmt.arr）;</pre><p>我们假设用户输入以下字符串：</p><pre class="oac_no_warn" dir="ltr">“SELECT ename，empno，comm FROM emp WHERE comm &lt;：bonus”</pre></div>
               </div><a id="LNPCC4172"></a><div class="props_rev_3"><a id="GUID-EF58F58A-FDC7-480E-A422-44792F1E3D8B" name="GUID-EF58F58A-FDC7-480E-A422-44792F1E3D8B"></a><h4 id="LNPCC-GUID-EF58F58A-FDC7-480E-A422-44792F1E3D8B" class="sect4"><span class="enumeration_section">15.6.6</span>从主机字符串中<span class="enumeration_section">预处理</span>查询</h4>
                  <div>
                     <p>PREPARE解析SQL语句并为其命名。在我们的示例中，PREPARE解析主机字符串<span class="italic">select_stmt</span>并为其指定名称<span class="italic">sql_stmt</span> ，如下所示： <a id="d80858e3103" class="indexterm-anchor"></a><a id="d80858e3107" class="indexterm-anchor"></a> 
                     </p><pre class="oac_no_warn" dir="ltr">EXEC SQL PREPARE sql_stmt FROM：select_stmt;</pre></div>
               </div><a id="LNPCC4173"></a><div class="props_rev_3"><a id="GUID-FFA207E9-419A-4BCC-A36C-4F838AF8D9B6" name="GUID-FFA207E9-419A-4BCC-A36C-4F838AF8D9B6"></a><h4 id="LNPCC-GUID-FFA207E9-419A-4BCC-A36C-4F838AF8D9B6" class="sect4"><span class="enumeration_section">15.6.7</span> DECLARE一个游标</h4>
                  <div>
                     <p>DECLARE CURSOR通过为游标指定名称并将其与特定的SELECT语句相关联来定义游标。</p>
                     <p>要为<span class="italic">静态</span>查询声明游标，请使用以下语法： <a id="d80858e3143" class="indexterm-anchor"></a><a id="d80858e3147" class="indexterm-anchor"></a> 
                     </p><pre class="oac_no_warn" dir="ltr">EXEC SQL DECLARE cursor_name CURSOR FOR SELECT ...
</pre><p>要为<span class="italic">动态</span>查询声明游标，PREPARE为动态查询赋予的语句名称将替换静态查询。在我们的示例中，DECLARE CURSOR定义了一个名为<span class="italic">emp_cursor</span>的游标，并将其与<span class="italic">sql_stmt</span>相关联，如下所示：</p><pre class="oac_no_warn" dir="ltr">执行SQL DECLARE emp_cursor CURSOR FOR sql_stmt;</pre><div class="infoboxnote" id="GUID-FFA207E9-419A-4BCC-A36C-4F838AF8D9B6__GUID-86897EFD-2F6F-490B-BA7E-BEDF9A03927F">
                        <p class="notep1">注意：</p>
                        <p>您可以为所有动态SQL语句声明游标，而不仅仅是查询。对于非查询，OPENing游标执行动态SQL语句。</p>
                     </div>
                  </div>
               </div><a id="LNPCC4175"></a><a id="LNPCC4174"></a><div class="props_rev_3"><a id="GUID-41CA08E9-C2A1-49F4-B0BF-23CBEE4CF3BB" name="GUID-41CA08E9-C2A1-49F4-B0BF-23CBEE4CF3BB"></a><h4 id="LNPCC-GUID-41CA08E9-C2A1-49F4-B0BF-23CBEE4CF3BB" class="sect4"><span class="enumeration_section">15.6.8</span>描述绑定变量</h4>
                  <div>
                     <p>DESCRIBE BIND VARIABLES将占位符的描述放入绑定描述符中。在我们的示例中，DESCRIBE准备<span class="italic">bind_des</span> ，如下所示： <a id="d80858e3198" class="indexterm-anchor"></a><a id="d80858e3202" class="indexterm-anchor"></a> 
                     </p><pre class="oac_no_warn" dir="ltr">用于sql_stmt INTO bind_des的EXEC SQL DESCRIBE BIND VARIABLES;</pre><p>请注意， <span class="italic">bind_des</span> <span class="italic">不能</span>以冒号为前缀。
                     </p>
                     <p>DESCRIBE BIND VARIABLES语句必须遵循PREPARE语句，但必须在OPEN语句之前。</p>
                     <p><a href="Oracle-dynamic-SQL-method-4.html#GUID-41CA08E9-C2A1-49F4-B0BF-23CBEE4CF3BB__I12580">图15-4</a>显示了DESCRIBE之后的示例中的绑定描述符。请注意，DESCRIBE已将<span class="italic">F</span>设置为在已处理的SQL语句中找到的实际占位符数。
                     </p>
                     <div class="figure" id="GUID-41CA08E9-C2A1-49F4-B0BF-23CBEE4CF3BB__I12580">
                        <p class="titleinfigure">图15-4 DESCRIBE后的绑定描述符</p><img src="img/lnpcc013.gif" width="499" alt="下面是图15-4的描述" title="下面是图15-4的描述" longdesc="img_text/lnpcc013.html"><br><a href="img_text/lnpcc013.html">“图15-4 DESCRIBE后的绑定描述符”的描述</a></div>
                     <!-- class="figure" -->
                  </div>
               </div><a id="LNPCC4176"></a><div class="props_rev_3"><a id="GUID-56D6AF7A-808E-44CA-BBB4-5F96D455EFF9" name="GUID-56D6AF7A-808E-44CA-BBB4-5F96D455EFF9"></a><h4 id="LNPCC-GUID-56D6AF7A-808E-44CA-BBB4-5F96D455EFF9" class="sect4"><span class="enumeration_section">15.6.9</span>重置占位符数</h4>
                  <div>
                     <p>接下来，您必须将最大占位符数重置为DESCRIBE实际找到的数字，如下所示：</p><pre class="oac_no_warn" dir="ltr">bind_des-&gt; N = bind_des-&gt; F;</pre></div>
               </div><a id="LNPCC4178"></a><a id="LNPCC4177"></a><div class="props_rev_3"><a id="GUID-A963DCA1-A997-438C-B443-28C2F3BA8EC3" name="GUID-A963DCA1-A997-438C-B443-28C2F3BA8EC3"></a><h4 id="LNPCC-GUID-A963DCA1-A997-438C-B443-28C2F3BA8EC3" class="sect4"><span class="enumeration_section">15.6.10</span>为绑定变量获取值并分配存储空间</h4>
                  <div>
                     <p>您的程序必须获取SQL语句中找到的绑定变量的值，并为它们分配内存。程序如何获取值取决于您。例如，它们可以是硬编码的，从文件中读取或以交互方式输入。</p>
                     <p>在我们的示例中，必须为绑定变量分配一个值，该变量替换查询WHERE子句中的占位符<span class="italic">加值</span> 。因此，您选择提示用户输入值，然后按如下方式处理：</p><pre class="oac_no_warn" dir="ltr">for（i = 0; i &lt;bind_des-&gt; F; i ++）{printf（“\ n输入变量％的值。* s：\ n？“，（int）bind_des-&gt; C [i]，bind_des-&gt; S [i]）; gets（hostval）; / *设置值的长度。* / bind_des-&gt; L [i] = strlen（hostval）; / *为value和null终止符分配存储空间。* / bind_des-&gt; V [i] = malloc（bind_des-&gt; L [i] + 1）; / *为指标值分配存储空间。* / bind_des-&gt; I [i] =（unsigned short *）malloc（sizeof（short））; / *将值存储在绑定描述符中。* / strcpy（bind_des-&gt; V [i]，hostval）; / *设置指标变量的值。* / *（bind_des-&gt; I [i]）= 0; / *或-1如果“null”是值* / / *将数据类型设置为STRING。 * / bind_des-&gt; T [i] = 5; }</pre><p>假设用户为<span class="italic">奖金</span>提供了625的值， <a href="Oracle-dynamic-SQL-method-4.html#GUID-A963DCA1-A997-438C-B443-28C2F3BA8EC3__I12569">图15-5</a>显示了生成的绑定描述符。请注意，该值以null结尾。
                     </p>
                     <div class="figure" id="GUID-A963DCA1-A997-438C-B443-28C2F3BA8EC3__I12569">
                        <p class="titleinfigure">图15-5分配值后的绑定描述符</p><img src="img/lnpcc014.gif" width="499" alt="下面是图15-5的描述" title="下面是图15-5的描述" longdesc="img_text/lnpcc014.html"><br><a href="img_text/lnpcc014.html">“图15-5分配值后的绑定描述符”的描述</a></div>
                     <!-- class="figure" -->
                  </div>
               </div><a id="LNPCC4179"></a><div class="props_rev_3"><a id="GUID-B55EBCF4-C6A6-44E7-9A9A-33264790003C" name="GUID-B55EBCF4-C6A6-44E7-9A9A-33264790003C"></a><h4 id="LNPCC-GUID-B55EBCF4-C6A6-44E7-9A9A-33264790003C" class="sect4"><span class="enumeration_section">15.6.11</span>打开光标</h4>
                  <div>
                     <p>用于动态查询的OPEN语句类似于用于静态查询的语句，除了游标与绑定描述符相关联。在运行时确定并存储在由绑定描述符数组的元素寻址的缓冲区中的值用于评估SQL语句。通过查询，这些值还用于标识活动集。 <a id="d80858e3325" class="indexterm-anchor"></a><a id="d80858e3329" class="indexterm-anchor"></a> 
                     </p>
                     <p>在我们的示例中，OPEN将<span class="italic">emp_cursor</span>与<span class="italic">bind_des</span>关联，如下所示：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL OPEN emp_cursor使用DESCRIPTOR bind_des;</pre><p>请记住， <span class="italic">bind_des</span> <span class="italic">不能</span>以冒号为前缀。
                     </p>
                     <p>然后，OPEN执行SQL语句。通过查询，OPEN还可以识别活动集并将光标定位在第一行。</p>
                  </div>
               </div><a id="LNPCC4181"></a><a id="LNPCC4180"></a><div class="props_rev_3"><a id="GUID-0F88FCE1-F2A7-4C0E-9495-33AB61419D20" name="GUID-0F88FCE1-F2A7-4C0E-9495-33AB61419D20"></a><h4 id="LNPCC-GUID-0F88FCE1-F2A7-4C0E-9495-33AB61419D20" class="sect4"><span class="enumeration_section">15.6.12</span>描述选择列表</h4>
                  <div>
                     <p>如果动态SQL语句是查询，则DESCRIBE SELECT LIST语句必须遵循OPEN语句，但必须在FETCH语句之前。 <a id="d80858e3380" class="indexterm-anchor"></a><a id="d80858e3384" class="indexterm-anchor"></a> 
                     </p>
                     <p>DESCRIBE SELECT LIST将选择列表项的描述放在选择描述符中。在我们的示例中，DESCRIBE准备了<span class="italic">select_des</span> ，如下所示：</p><pre class="oac_no_warn" dir="ltr">对于sql_stmt INTO select_des，EXEC SQL DESCRIBE SELECT LIST;</pre><p>访问Oracle数据字典时，DESCRIBE设置每个选择列表值的长度和数据类型。</p>
                     <p><a href="Oracle-dynamic-SQL-method-4.html#GUID-0F88FCE1-F2A7-4C0E-9495-33AB61419D20__I7565">图15-6</a>显示了DESCRIBE之后的示例中的select描述符。请注意，DESCRIBE已将<span class="italic">F</span>设置为查询选择列表中找到的实际项目数。如果SQL语句不是查询，则<span class="italic">F</span>设置为零。
                     </p>
                     <p>另请注意，NUMBER长度尚不可用。对于定义为NUMBER的列，必须使用库函数<code class="codeph">SQLNumberPrecV6()</code>来提取精度和小数<code class="codeph">SQLNumberPrecV6()</code> 。
                     </p>
                     <div class="figure" id="GUID-0F88FCE1-F2A7-4C0E-9495-33AB61419D20__I7565">
                        <p class="titleinfigure">图15-6 DESCRIBE后选择描述符</p><img src="img/lnpcc015.gif" width="499" alt="下面是图15-6的描述" title="下面是图15-6的描述" longdesc="img_text/lnpcc015.html"><br><a href="img_text/lnpcc015.html">“图15-6 DESCRIBE后选择描述符”的描述</a></div>
                     <!-- class="figure" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="Oracle-dynamic-SQL-method-4.html#GUID-F713062E-314B-41E4-93C7-406999367618">强制数据类型</a></li>
                        </ul>
                     </div>
                  </div>
                  
               </div><a id="LNPCC4182"></a><div class="props_rev_3"><a id="GUID-EE0A2A15-5C59-4B62-9AB1-472422F90DEF" name="GUID-EE0A2A15-5C59-4B62-9AB1-472422F90DEF"></a><h4 id="LNPCC-GUID-EE0A2A15-5C59-4B62-9AB1-472422F90DEF" class="sect4"><span class="enumeration_section">15.6.13</span>重置选择列表项的数量</h4>
                  <div>
                     <p>接下来，您必须将选择列表项的最大数量重置为DESCRIBE实际找到的数字，如下所示：</p><pre class="oac_no_warn" dir="ltr">select_des-&gt; N = select_des-&gt; F;</pre></div>
               </div><a id="LNPCC4184"></a><a id="LNPCC4183"></a><div class="props_rev_3"><a id="GUID-BEB1EBE5-E67F-4D8E-AEF3-C759A721B5CE" name="GUID-BEB1EBE5-E67F-4D8E-AEF3-C759A721B5CE"></a><h4 id="LNPCC-GUID-BEB1EBE5-E67F-4D8E-AEF3-C759A721B5CE" class="sect4"><span class="enumeration_section">15.6.14</span>重置每个选择列表项的长度/数据类型</h4>
                  <div>
                     <p>在我们的示例中，在FETCHing选择列表值之前，使用库函数<code class="codeph">malloc()</code>为它们分配存储空间。您还重置了长度和数据类型数组中的一些元素以用于显示目的。 <a id="d80858e3480" class="indexterm-anchor"></a><a id="d80858e3484" class="indexterm-anchor"></a><a id="d80858e3488" class="indexterm-anchor"></a> 
                     </p><pre class="oac_no_warn" dir="ltr">for（i = 0; i &lt;select_des-&gt; F; i ++）{/ *清除空位。* / SQLColumnNullCheck（SQL_SINGLE_RCTX，（unsigned short *）＆（select_des-&gt; T [i]），（unsigned short *）＆（select_des-&gt; T [i]），＆nullok）; / *如有必要，重置长度。* / switch（select_des-&gt; T [i]）{case 1：break; case 2：SQLNumberPrecV6（SQL_SINGLE_RCTX，（unsigned long *）＆（select_des-&gt; L [i]），＆prec，＆scal）; if（prec == 0）prec = 40; select_des-&gt; L [i] = prec + 2; if（scal &lt;0）select_des-&gt; L [i] + = -scal;打破; case 8：select_des-&gt; L [i] = 240;打破;情况11：select_des-&gt; L [i] = 18;打破;情况12：select_des-&gt; L [i] = 9;打破;案例23：休息;情况24：select_des-&gt; L [i] = 240;打破; } / *为select-list值分配存储空间。* / select_des-&gt; V [i] = malloc（select_des-&gt; L [i] +1）; / *为指标值分配存储空间。* / select_des-&gt; I [i] =（short *）malloc（sizeof（short *））; / *将除LONG RAW之外的所有数据类型强制转换为STRING。 * / if（select_des-&gt; T [i]！= 24）select_des-&gt; T [i] = 5; }</pre><p><a href="Oracle-dynamic-SQL-method-4.html#GUID-BEB1EBE5-E67F-4D8E-AEF3-C759A721B5CE__I12571">图15-7</a>显示了结果选择描述符。请注意，NUMBER长度现在可用，并且所有数据类型都是STRING。 <code class="codeph">L[1]</code>和<code class="codeph">L[2]</code>中的长度是6和9，因为我们将DESCRIBEd长度4和7增加2以允许可能的符号和小数点。
                     </p>
                     <div class="figure" id="GUID-BEB1EBE5-E67F-4D8E-AEF3-C759A721B5CE__I12571">
                        <p class="titleinfigure">图15-7 FETCH之前的选择描述符</p><img src="img/lnpcc016.gif" width="499" alt="下面是图15-7的描述" title="下面是图15-7的描述" longdesc="img_text/lnpcc016.html"><br><a href="img_text/lnpcc016.html">“图15-7在FETCH之前选择描述符”的描述</a></div>
                     <!-- class="figure" -->
                  </div>
               </div><a id="LNPCC4185"></a><div class="props_rev_3"><a id="GUID-7B690746-DAB5-44C5-8D7E-CCC027430E47" name="GUID-7B690746-DAB5-44C5-8D7E-CCC027430E47"></a><h4 id="LNPCC-GUID-7B690746-DAB5-44C5-8D7E-CCC027430E47" class="sect4"><span class="enumeration_section">15.6.15</span>来自激活集的FETCH行</h4>
                  <div>
                     <p>FETCH从活动集返回一行，将select-list值存储在数据缓冲区中，并将光标前进到活动集中的下一行。如果没有更多行，FETCH将<span class="italic">sqlca.sqlcode</span>设置为“找不到数据”Oracle错误代码。在我们的示例中，FETCH将列ENAME，EMPNO和COMM的值返回给<span class="italic">select_des</span> ，如下所示： <a id="d80858e3540" class="indexterm-anchor"></a><a id="d80858e3544" class="indexterm-anchor"></a> 
                     </p><pre class="oac_no_warn" dir="ltr">EXEC SQL FETCH emp_cursor使用DESCRIPTOR select_des;</pre><p><a href="Oracle-dynamic-SQL-method-4.html#GUID-D66C3439-7AD2-4B84-BE87-26D92D0C5665__I12573">图15-8</a>显示了FETCH之后的示例中的选择描述符。请注意，Oracle已将选择列表和指示符值存储在由<span class="italic">V</span>和<span class="italic">I</span>的元素寻址的数据缓冲区中。</p>
                     <p>对于数据类型1的输出缓冲区，Oracle使用存储在<span class="italic">L</span>数组中的长度，左对齐CHAR或VARCHAR2数据并右对齐NUMBER数据。对于类型为5的输出缓冲区（STRING），Oracle左对齐且null终止CHAR，VARCHAR2和NUMBER数据。
                     </p>
                     <p>从“EMP表”中的VARCHAR2（10）列检索值“MARTIN”。使用<code class="codeph">L[0]</code>的长度，Oracle左对齐10字节字段中的值，填充缓冲区。
                     </p>
                     <p>从NUMBER（4）列检索值7654并强制为'7654'。但是， <code class="codeph">L[1]</code>的长度增加了2，以允许可能的符号和小数点。因此，Oracle左对齐并且null终止6字节字段中的值。
                     </p>
                     <p>从NUMBER（7,2）列中检索值482.50并强制为'482.50'。同样， <code class="codeph">L[2]</code>的长度增加了2。因此，Oracle左对齐并且null终止9字节字段中的值。
                     </p>
                  </div>
               </div><a id="LNPCC4187"></a><a id="LNPCC4186"></a><div class="props_rev_3"><a id="GUID-D66C3439-7AD2-4B84-BE87-26D92D0C5665" name="GUID-D66C3439-7AD2-4B84-BE87-26D92D0C5665"></a><h4 id="LNPCC-GUID-D66C3439-7AD2-4B84-BE87-26D92D0C5665" class="sect4"><span class="enumeration_section">15.6.16</span>获取和处理选择列表值</h4>
                  <div>
                     <p>在FETCH之后，您的程序可以处理返回的值。在我们的示例中，处理了ENAME，EMPNO和COMM列的值。</p>
                     <div class="figure" id="GUID-D66C3439-7AD2-4B84-BE87-26D92D0C5665__I12573">
                        <p class="titleinfigure">图15-8 FETCH后的选定描述符</p><img src="img/lnpcc017.gif" width="496" alt="下面是图15-8的描述" title="下面是图15-8的描述" longdesc="img_text/lnpcc017.html"><br><a href="img_text/lnpcc017.html">“图15-8 FETCH后选择的描述符”的描述</a></div>
                     <!-- class="figure" -->
                  </div>
               </div><a id="LNPCC4188"></a><div class="props_rev_3"><a id="GUID-25AAA0D6-7513-431C-A035-99A5D973E775" name="GUID-25AAA0D6-7513-431C-A035-99A5D973E775"></a><h4 id="LNPCC-GUID-25AAA0D6-7513-431C-A035-99A5D973E775" class="sect4"><span class="enumeration_section">15.6.17</span>解除<span class="enumeration_section">分配</span>存储</h4>
                  <div>
                     <p>您使用<code class="codeph">free()</code>库函数来释放<code class="codeph">malloc()</code>分配的存储空间。语法如下： <a id="d80858e3640" class="indexterm-anchor"></a><a id="d80858e3642" class="indexterm-anchor"></a> 
                     </p><pre class="oac_no_warn" dir="ltr">free（char * pointer）;</pre><p>在我们的示例中，您为select-list项，绑定变量和指示符变量的值释放存储空间，如下所示： <a id="d80858e3651" class="indexterm-anchor"></a> 
                     </p><pre class="oac_no_warn" dir="ltr">for（i = 0; i &lt;select_des-&gt; F; i ++）/ * for select descriptor * / {free（select_des-&gt; V [i]）;自由（select_des-&gt; I [I]）; } for（i = 0; i &lt;bind_des-&gt; F; i ++）/ * for bind descriptor * / {free（bind_des-&gt; V [i]）;自由（bind_des-&gt; I [I]）; }</pre><p>使用<code class="codeph">SQLSQLDAFree()</code>库函数，使用以下语法为描述符本身释放存储空间：<a id="d80858e3663" class="indexterm-anchor"></a><a id="d80858e3667" class="indexterm-anchor"></a><a id="d80858e3671" class="indexterm-anchor"></a></p><pre class="oac_no_warn" dir="ltr">SQLSQLDAFree（context，descriptor_name）;</pre><p>必须使用<code class="codeph">SQLSQLDAAlloc()</code>分配描述符。否则，结果是不可预测的。
                     </p>
                     <p>在我们的示例中，您为select和bind描述符释放存储空间，如下所示： <a id="d80858e3684" class="indexterm-anchor"></a> 
                     </p><pre class="oac_no_warn" dir="ltr">SQLSQLDAFree（SQL_SINGLE_RCTX，select_des）; SQLSQLDAFree（SQL_SINGLE_RCTX，bind_des）;</pre></div>
               </div><a id="LNPCC4189"></a><div class="props_rev_3"><a id="GUID-9D465610-787E-4070-BE8F-0EFEE16D28D5" name="GUID-9D465610-787E-4070-BE8F-0EFEE16D28D5"></a><h4 id="LNPCC-GUID-9D465610-787E-4070-BE8F-0EFEE16D28D5" class="sect4"><span class="enumeration_section">15.6.18</span>关闭光标</h4>
                  <div>
                     <p>CLOSE禁用光标。在我们的示例中，CLOSE禁用<span class="italic">emp_cursor</span> ，如下所示： <a id="d80858e3719" class="indexterm-anchor"></a><a id="d80858e3723" class="indexterm-anchor"></a> 
                     </p><pre class="oac_no_warn" dir="ltr">EXEC SQL CLOSE emp_cursor;</pre></div>
               </div><a id="LNPCC4190"></a><div class="props_rev_3"><a id="GUID-94EB52EA-BCFA-4974-91AE-6B4F96229E2E" name="GUID-94EB52EA-BCFA-4974-91AE-6B4F96229E2E"></a><h4 id="LNPCC-GUID-94EB52EA-BCFA-4974-91AE-6B4F96229E2E" class="sect4"><span class="enumeration_section">15.6.19</span>关于使用主机阵列</h4>
                  <div>
                     <p>要使用方法4使用输入或输出主机阵列，必须使用可选的FOR子句告诉Oracle主机阵列的大小。</p>
                     <p>必须使用语法为第<span class="italic">i</span>个选择列表项或绑定变量设置描述符条目</p><pre class="oac_no_warn" dir="ltr">V [i] = array_address; L [i] = element_size;</pre><p>其中<span class="italic">array_address</span>是主机数组的地址， <span class="italic">element_size</span>是一个数组元素的大小。
                     </p>
                     <p>然后，必须在EXECUTE或FETCH语句中使用FOR子句（以适用者为准）告诉Oracle要处理的数组元素的数量。此过程是必要的，因为Oracle无法了解主机阵列的大小。</p>
                     <p>在稍后的完整程序示例中，使用三个输入主机阵列将行插入到EMP表中。除了使用方法4的查询之外，EXECUTE可用于数据操作语言语句。</p><pre class="oac_no_warn" dir="ltr">#include &lt;stdio.h&gt; #include &lt;sqlcpr.h&gt; #include &lt;sqlda.h&gt; #include &lt;sqlca.h&gt; #define NAME_SIZE 10 #define INAME_SIZE 10 #define ARRAY_SIZE 5 / * connect string * / char * username = “斯科特/老虎”; char * sql_stmt =“INSERT INTO emp（empno，ename，deptno）VALUES（：e，：n，：d）”; int array_size = ARRAY_SIZE; / *也必须有一个主变量* / SQLDA * binda;字符名称[ARRAY_SIZE] [NAME_SIZE]; int numbers [ARRAY_SIZE]，depts [ARRAY_SIZE]; / *声明并初始化指标变量。 for empno和deptno columns * / short ind_empno [ARRAY_SIZE] = {0,0,0,0,0}; short ind_dept [ARRAY_SIZE] = {0,0,0,0,0}; main（）{EXEC SQL WHENEVER SQLERROR GOTO sql_error; / * Connect * / EXEC SQL CONNECT：username;的printf（ “连接\ n”）; / *分配描述符并设置N分量。这必须在DESCRIBE之前完成。 * / binda = SQLSQLDAAlloc（SQL_SINGLE_RCTX，3，NAME_SIZE，INAME_SIZE）; binda-&gt; N = 3; / *准备并描述SQL语句。* / EXEC SQL PREPARE stmt FROM：sql_stmt; EXEC SQL DESCRIBE BIND VARIABLES for stmt INTO binda; / *初始化描述符。* / binda-&gt; V [0] =（char *）数字; binda-&gt; L [0] =（long）sizeof（int）; binda-&gt; T [0] = 3; binda-&gt; I [0] = ind_empno; binda-&gt; V [1] =（char *）名称; binda-&gt; L [1] =（长）NAME_SIZE; binda-&gt; T [1] = 1; binda-&gt; I [1] =（short *）0; binda-&gt; V [2] =（char *）depts; binda-&gt; L [2] =（long）sizeof（int）; binda-&gt; T [2] = 3; binda-&gt; I [2] = ind_dept; / *初始化数据缓冲区。* / strcpy（＆names [0] [0]，“ALLISON”）;数字[0] = 1014; depts [0] = 30; strcpy（＆names [1] [0]，“TRUSDALE”）;数字[1] = 1015; depts [1] = 30; strcpy（＆names [2] [0]，“FRAZIER”）;数字[2] = 1016; depts [2] = 30; strcpy（＆names [3] [0]，“CARUSO”）;数字[3] = 1017; ind_dept [3] = -1; / *将指标设置为-1以插入NULL * / depts [3] = 30; depts [3]中的/ *值被忽略* / strcpy（＆names [4] [0]，“WESTON”）;数字[4] = 1018; depts [4] = 30; / *执行INSERT。 * / printf（“添加到销售人员...... \ n”）; EXEC SQL FOR：array_size EXECUTE stmt使用DESCRIPTOR binda; / *打印行处理计数。* / printf（“％d行插入。\ n \ n”，sqlca.sqlerrd [2]）; EXEC SQL COMMIT RELEASE;出口（0）; sql_error：/ *打印Oracle错误消息。* / printf（“\ n％.70s”，sqlca.sqlerrm.sqlerrmc）; EXEC SQL WHENEVER SQLERROR CONTINUE; EXEC SQL ROLLBACK RELEASE;出口（1）; }</pre></div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="embedded-PL-SQL.html#GUID-4C56DC0E-B857-405D-B88E-93B19DD9FCF2">主机阵列</a></li>
                        </ul>
                     </div>
                  </div>
                  
               </div><a id="LNPCC4191"></a><div class="props_rev_3"><a id="GUID-61A1DF13-7954-4CAB-B853-FEFDB2E3C4D6" name="GUID-61A1DF13-7954-4CAB-B853-FEFDB2E3C4D6"></a><h4 id="LNPCC-GUID-61A1DF13-7954-4CAB-B853-FEFDB2E3C4D6" class="sect4"><span class="enumeration_section">15.6.20 sample12.pc</span></h4>
                  <div>
                     <div class="section">
                        <p>使用数组提取的简单动态SQL示例显示在demo目录中的文件<code class="codeph">sample12.pc</code>中。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="LNPCC4192"></a><div class="props_rev_3"><a id="GUID-159E12E2-C5B7-40EE-A26C-50D872B8DC32" name="GUID-159E12E2-C5B7-40EE-A26C-50D872B8DC32"></a><h3 id="LNPCC-GUID-159E12E2-C5B7-40EE-A26C-50D872B8DC32" class="sect3"><span class="enumeration_section">15.7</span>示例程序：动态SQL方法4</h3>
               <div>
                  <div class="section">
                     <p>此程序显示了使用方法4的动态SQL所需的基本步骤。连接到Oracle后，该程序：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>使用SQLSQLDAAlloc（）为描述符分配内存</p>
                        </li>
                        <li>
                           <p>提示用户输入SQL语句</p>
                        </li>
                        <li>
                           <p>准备声明</p>
                        </li>
                        <li>
                           <p>DECLAREs游标</p>
                        </li>
                        <li>
                           <p>使用DESCRIBE BIND检查任何绑定变量</p>
                        </li>
                        <li>
                           <p>打开光标</p>
                        </li>
                        <li>
                           <p>描述任何选择列表项。</p>
                        </li>
                     </ul>
                     <p>如果输入的SQL语句是查询，程序会对每行数据进行FETCH，然后关闭光标。该程序可在<code class="codeph">demo</code>目录中的<code class="codeph">sample10.pc</code>文件中在线获得。
                     </p><pre class="oac_no_warn" dir="ltr">/ ******************* ******************示例程序10：动态SQL方法4此程序使用您的用户名和密码将您连接到ORACLE，然后提示您输入SQL语句。您可以输入任何合法的SQL语句。使用常规SQL语法，而不是嵌入式SQL。您的陈述将被处理。如果是查询，则显示提取的行。您可以输入多行语句。限制为1023个字符。此示例程序仅处理MAX_ITEMS绑定变量和MAX_ITEMS选择列表项。MAX_ITEMS #defined为40。************************************************** ***************** / #include &lt;stdio.h&gt; #include &lt;string.h&gt; #include &lt;setjmp.h&gt; #include &lt;sqlda.h&gt; #include &lt;stdlib .h&gt; #include &lt;sqlcpr.h&gt; / *选择列表项或绑定变量的最大数量。* / #define MAX_ITEMS 40 / *选择列表项或指示符变量的_names_的最大长度。* / #define MAX_VNAME_LEN 30 #define MAX_INAME_LEN 30 #ifndef NULL #define NULL 0 #endif / * Prototypes * / #if defined（__ STDC__）void sql_error（void）; int oracle_connect（void）; int alloc_descriptors（int，int，int）; int get_dyn_statement（void）; void set_bind_variables（void）; void process_select_list（void）; void help（void）; #else void sql_error（/ * _ void _ * /）; int oracle_connect（/ * _ void _ * /）; int alloc_descriptors（/ * _ int，int，int _ * /）; int get_dyn_statement（/ * void _ * /）; void set_bind_variables（/ * _ void  -  * /）; void process_select_list（/ * _ void _ * /）; void help（/ * _ void _ * /）; #endif char * dml_commands [] = {“SELECT”，“select”，“INSERT”，“insert”，“UPDATE”，“update”，“DELETE”，“delete”}; EXEC SQL INCLUDE sqlda; EXEC SQL INCLUDE sqlca; EXEC SQL BEGIN DECLARE SECTION; char dyn_statement [1024]; EXEC SQL VAR dyn_statement IS STRING（1024）; EXEC SQL END DECLARE SECTION; SQLDA * bind_dp; SQLDA * select_dp; / *定义一个缓冲区来保存longjmp状态信息。* / jmp_buf jmp_continue; / *错误例程的全局标志。* / int parse_flag = 0; void main（）{int i; / *连接到数据库。* / if（oracle_connect（）！= 0）退出（1）; / *为select和bind描述符分配内存。* / if（alloc_descriptors（MAX_ITEMS，MAX_VNAME_LEN，MAX_INAME_LEN）！= 0）退出（1）; / *处理SQL语句。* / for（;;）{（void）setjmp（jmp_continue）; / *获取声明。打破“退出”。* / if（get_dyn_statement（）！= 0）休息; / *准备语句并声明游标。* / EXEC SQL WHENEVER SQLERROR DO sql_error（）; parse_flag = 1; / *为sql_error（）设置一个标志。* / EXEC SQL PREPARE S FROM：dyn_statement; parse_flag = 0; / *取消设置标志。* / EXEC SQL DECLARE C CURSOR FOR S; / *为SQL语句中的任何占位符设置绑定变量。* / set_bind_variables（）; / *打开游标并执行语句。*如果语句不是查询（SELECT），*语句处理在* OPEN之后完成。 * / EXEC SQL OPEN C使用DESCRIPTOR bind_dp; / *调用处理选择列表的函数。*如果语句不是查询，则此函数*只返回，什么都不做。* / process_select_list（）; / *告诉用户处理了多少行。* / for（i = 0; i &lt;8; i ++）{if（strncmp（dyn_statement，dml_commands [i]，6）== 0）{printf（“\ n \ n％d行％c已处理。\ n” ，sqlca.sqlerrd [2]，sqlca.sqlerrd [2] == 1？'\ 0'：'s'）;打破; for（;;）语句处理循环* / / *结束时，释放为绑定中的指针分配的内存并选择描述符。* / for（i = 0; i &lt;MAX_ITEMS; i ++）{if（bind_dp-&gt; V [i]！=（char *）0）free（bind_dp-&gt; V [i]）;自由（bind_dp-&gt; I [I]）; / * MAX_ITEMS已分配。* / if（select_dp-&gt; V [i]！=（char *）0）free（select_dp-&gt; V [i]）;自由（select_dp-&gt; I [I]）; / * MAX_ITEMS已分配。* /} / *描述符本身使用的空闲空间。* / SQLSQLDAFree（SQL_SINGLE_RCTX，bind_dp）; SQLSQLDAFree（SQL_SINGLE_RCTX，select_dp）; EXEC SQL WHENEVER SQLERROR CONTINUE; / *关闭光标。* / EXEC SQL CLOSE C; EXEC SQL COMMIT WORK RELEASE;放（“\ n祝你有个美好的一天！\ n“）; EXEC SQL WHENEVER SQLERROR DO sql_error（）; return;} int oracle_connect（）{EXEC SQL BEGIN DECLARE SECTION; VARCHAR username [128]; VARCHAR password [32]; EXEC SQL END DECLARE SECTION; printf（”\ nusername：“）; fgets（（char *）username.arr，sizeof username.arr，stdin）; username.arr [strlen（（char *）username.arr）-1] ='\ 0'; username.len = （unsigned short）strlen（（char *）username.arr）; printf（“password：”）; fgets（（char *）password.arr，sizeof password.arr，stdin）; password.arr [strlen（（char *） ）password.arr） -  1] ='\ 0'; password.len =（unsigned short）strlen（（char *）password.arr）; EXEC SQL WHENEVER SQLERROR GOTO connect_error; EXEC SQL CONNECT：username IDENTIFIED BY：password; printf（“\ n连接到ORACLE作为用户％s。\ n”，用户名.arr）;返回0; connect_error：fprintf（stderr，“无法连接到ORACLE作为用户％s \ n”，username.arr）;返回 - 1;} / * *使用SQLSQLDAAlloc（）分配BIND和SELECT描述符。*还在每个描述符中分配指针变量*的指针。指向实际绑定*变量和select-list项的指针在set_bind_variables（）或process_select_list（）*例程中重新分配。此例程为select_dp-&gt; V [i] *和bind_dp-&gt; V [i]分配1个字节，因此realloc将正常工作。* / alloc_descriptors（size，max_vname_len，max_iname_len）int size; int max_vname_len; int max_iname_len; {int i; / * *第一个SQLSQLDAAlloc参数是运行时上下文。*第二个参数确定描述符中每个变量的*数组元素的最大数量。换句话说，它确定SQL语句中绑定*变量或选择列表项的最大数量。* *第三个参数确定用于保存选择列表项*或占位符名称的*字符串的最大长度。ORACLE中列*名称的最大长度为30，但您可以根据需要分配更多或更少的*。* *第四个参数确定用于保存任何指标*变量名称的*字符串的最大长度。遵循ORACLE标准，这些标准的最大*长度应为30。但是，您可以根据需要更多或更少地分配*。* / if（（bind_dp = SQLSQLDAAlloc（SQL_SINGLE_RCTX，size，max_vname_len，max_iname_len））==（SQLDA *）0）{fprintf（stderr，“无法为绑定描述符分配内存。”）;返回-1; / *在这种情况下必须退出。* /} if（（select_dp = SQLSQLDAAlloc（SQL_SINGLE_RCTX，size，max_vname_len，max_iname_len））==（SQLDA *）0）{fprintf（stderr，“无法为选择描述符分配内存。”）;返回-1; } select_dp-&gt; N = MAX_ITEMS; / *分配指针变量和实际数据的指针。* / for（i = 0; i &lt;MAX_ITEMS; i ++）{bind_dp-&gt; I [i] =（short *）malloc（sizeof（short））; select_dp-&gt; I [i] =（short *）malloc（sizeof（short））; bind_dp-&gt; V [i] =（char *）malloc（1）; select_dp-&gt; V [i] =（char *）malloc（1）; } return 0; } int get_dyn_statement（）{char * cp，linebuf [256]; int iter，plsql; for（plsql = 0，iter = 1 ;;）{if（iter == 1）{printf（“\ nSQL&gt;”）; dyn_statement [0] ='\ 0'; } fgets（linebuf，sizeof linebuf，stdin）; cp = strrchr（linebuf，'\ n'）; if（cp &amp;&amp; cp！= linebuf）* cp ='';否则如果（cp == linebuf）继续; if（（strncmp（linebuf，“EXIT”，4）== 0）||（strncmp（linebuf，“exit”，4）== 0））{return -1; } else if（linebuf [0] =='？'|| （strncmp（linebuf，“HELP”，4）== 0）|| （strncmp（linebuf，“help”，4）== 0））{help（）; iter = 1;继续; if（strstr（linebuf，“BEGIN”）||（strstr（linebuf，“begin”）））{plsql = 1; } strcat（dyn_statement，linebuf）; if（（plsql &amp;&amp;（cp = strrchr（dyn_statement，'/'）））||（！plsql &amp;&amp;（cp = strrchr（dyn_statement，';'））））{* cp ='\ 0';打破; } else {iter ++; printf（“％3d”，iter）;返回0; void set_bind_variables（）{int i，n; char bind_var [64]; / *描述任何绑定变量（输入主机变量）* / EXEC SQL WHENEVER SQLERROR DO sql_error（）; bind_dp-&gt; N = MAX_ITEMS; / *初始化数组元素的数量。* / EXEC SQL DESCRIBE BIND VARIABLES FOR S INTO bind_dp; / *如果F为负数，则绑定变量多于SQLSQLDAAlloc（）最初分配的绑定变量。* / if（bind_dp-&gt; F &lt;0）{printf（“\ n很多绑定变量（％d），最大值为％d \ n。”， -  bind_dp-&gt; F，MAX_ITEMS）;返回; / *将描述符中的最大数组元素数设置为找到的数字。* / bind_dp-&gt; N = bind_dp-&gt; F; / *将每个绑定变量的值作为*字符串获取。* * C [i]包含SQL语句中使用的绑定变量*名称的长度。* S [i]包含SQL语句中使用的绑定变量*的实际名称。* * L [i]将包含输入的数据值*的长度。* * V [i]将包含输入的数据值*的地址。* * T [i]始终设置为1，因为在此示例程序中*所有绑定变量的数据值都作为字符串输入*。* ORACLE从CHAR转换为表值。 * * I [i]将指向指标值，当绑定变量值为“null”时，*设置为-1。* / for（i = 0; i &lt;bind_dp-&gt; F; i ++）{printf（“\ n绑定变量％的值。* s：”，（int）bind_dp-&gt; C [i]，bind_dp-&gt; S [一世]）; fgets（bind_var，sizeof bind_var，stdin）; / *获取长度并删除新行字符。* / n = strlen（bind_var） -  1; / *在描述符中设置它。* / bind_dp-&gt; L [i] = n; / *（重新）为该值分配缓冲区。SQLSQLDAAlloc（）保留V [i]的指针位置，但不为指针分配完整空间。* / bind_dp-&gt; V [i] =（char *）realloc（bind_dp-&gt; V [i]，（bind_dp-&gt; L [i] + 1））; / *并复制它。* / strncpy（bind_dp-&gt; V [i]，bind_var，n）; / *设置指标变量的值。* / if（（strncmp（bind_dp-&gt; V [i]，“NULL”，4）== 0）||（strncmp（bind_dp-&gt; V [i]，“null”，4）== 0））* bind_dp-&gt; I [i] = -1; else * bind_dp-&gt; I [i] = 0; / *为CHAR设置绑定数据类型为1。 * / bind_dp-&gt; T [i] = 1; } return; void process_select_list（）{int i，null_ok，precision，scale; if（（strncmp（dyn_statement，“SELECT”，6）！= 0）&amp;&amp;（strncmp（dyn_statement，“select”，6）！= 0））{select_dp-&gt; F = 0;返回; } / *如果SQL语句是SELECT，请描述select-list项。DESCRIBE函数返回其名称，数据类型，长度（包括精度和小数位数）以及NULL / NOT NULL状态。* / select_dp-&gt; N = MAX_ITEMS; EXEC SQL DESCRIBE S INTO select_dp的选择列表; / *如果F为负数，则选择列表项比SQLSQLDAAlloc（）最初分配的项数多。* / if（select_dp-&gt; F &lt;0）{printf（“\ n很多选择列表项（％d），最大值为％d \ n”， - （select_dp-&gt; F），MAX_ITEMS）;返回; / *将描述符中的最大数组元素数设置为找到的数字。* / select_dp-&gt; N = select_dp-&gt; F; / *为每个选择列表项分配存储空间。SQLNumberPrecV6（）用于从长度（select_dp-&gt; L [i]）中提取精度和小数位数。sqlcolumnNullCheck（）用于重置数据类型的高位，并检查列是否为NULL。 CHAR数据类型具有长度，但精度和比例为零。长度在CREATE时定义。只有在CREATE时定义，NUMBER数据类型才具有精度和比例。如果列定义仅为NUMBER，则精度和小数位数为零，您必须分配所需的最大长度。如果使用默认格式，则DATE数据类型返回长度7。这应该增加到9以存储实际日期字符串。如果使用TO_CHAR函数，最大长度可能是75，但可能会更小（您可以在SQL * Plus中看到它的效果）。如果强制转换为CHAR，则ROWID数据类型始终返回固定长度18。 LONG和LONG RAW数据类型的返回长度为0（零），因此您需要设置最大值。在此示例中，它是240个字符。* / printf（“\ n”）; for（i = 0; i &lt;select_dp-&gt; F; i ++）{char title [MAX_VNAME_LEN]; / *关闭数据类型的高位（在此示例中，如果列为非NULL，则无关紧要）。* / SQLColumnNullCheck（（unsigned short *）＆（select_dp-&gt; T [i]），（unsigned short *）＆（select_dp-&gt; T [i]），＆null_ok）; switch（select_dp-&gt; T [i]）{case 1：/ * CHAR数据类型：所需长度不变，除了可能的TO_CHAR转换（此处未处理）。* /休息; case 2：/ * NUMBER数据类型：使用SQLNumberPrecV6（）来提取精度和比例。* / SQLNumberPrecV6（SQL_SINGLE_RCTX，（unsigned long *）＆（select_dp-&gt; L [i]），＆precision＆scale）; / *允许NUMBER的最大大小。 * / if（precision == 0）precision = 40; / *还允许小数点和可能的符号。* / / *如果scale&gt; 0，则将NUMBER数据类型转换为FLOAT，否则转换为INT。* / if（scale&gt; 0）select_dp-&gt; L [i] = sizeof（float）;否则select_dp-&gt; L [i] = sizeof（int）;打破; case 8：/ * LONG数据类型* / select_dp-&gt; L [i] = 240;打破; case 11：/ * ROWID datatype * / select_dp-&gt; L [i] = 18;打破;情况12：/ * DATE数据类型* / select_dp-&gt; L [i] = 9;打破; case 23：/ * RAW datatype * / break;情况24：/ * LONG RAW数据类型* / select_dp-&gt; L [i] = 240;打破; } / *为选择列表数据值分配空间。SQLSQLDAAlloc（）保留V [i]的指针位置，但不为指针分配完整空间。* / if（select_dp-&gt; T [i]！= 2）select_dp-&gt; V [i] =（char *）realloc（select_dp-&gt; V [i]，select_dp-&gt; L [i] + 1）;否则select_dp-&gt; V [i] =（char *）realloc（select_dp-&gt; V [i]，select_dp-&gt; L [i]）; / *打印列标题，右对齐数列标题。* / / *复制到临时缓冲区，以防名称以空值终止* / memset（title，''，MAX_VNAME_LEN）; strncpy（title，select_dp-&gt; S [i]，select_dp-&gt; C [i]）; if（select_dp-&gt; T [i] == 2）if（scale&gt; 0）printf（“％。* s”，select_dp-&gt; L [i] +3，title）; else printf（“％。* s”，select_dp-&gt; L [i]，title）; else printf（“％ - 。* s”，select_dp-&gt; L [i]，title）; / *强制所有数据类型除了LONG RAW和NUMBER到字符。* / if（select_dp-&gt; T [i]！= 24 &amp;&amp; select_dp-&gt; T [i]！= 2）select_dp-&gt; T [i] = 1; / *根据比例，将NUMBER的数据类型强制为float或int。* / if（select_dp-&gt; T [i] == 2）if（scale&gt; 0）select_dp-&gt; T [i] = 4; / * float * / else select_dp-&gt; T [i] = 3; / * int * /} printf（“\ n \ n”）; / * FETCH选择每一行并打印列值。* / EXEC SQL WHENEVER NOT FOUND GOTO end_select_loop; for（;;）{EXEC SQL FETCH C使用DESCRIPTOR select_dp; / *由于返回的每个变量都被强制转换为字符串，int或float，因此这里需要很少的处理。此例程只打印出终端上的值。* / for（i = 0; i &lt;select_dp-&gt; F; i ++）{if（* select_dp-&gt; I [i] &lt;0）if（select_dp-&gt; T [i] == 4）printf（“％ -  * c“，（int）select_dp-&gt; L [i] + 3，''）; else printf（“％ -  * c”，（int）select_dp-&gt; L [i]，''）; else if（select_dp-&gt; T [i] == 3）/ * int datatype * / printf（“％* d”，（int）select_dp-&gt; L [i]，*（int *）select_dp-&gt; V [i ]）;否则if（select_dp-&gt; T [i] == 4）/ * float datatype * / printf（“％*。2f”，（int）select_dp-&gt; L [i]，*（float *）select_dp-&gt; V [一世]）; else / * character string * / printf（“％ -  *。* s”，（int）select_dp-&gt; L [i]，（int）select_dp-&gt; L [i]，select_dp-&gt; V [i]）; } printf（“\ n”）; } end_select_loop：return; } void help（）{puts（“\ n \ n在SQL&gt;提示符处输入SQL语句或PL / SQL块。”）; puts（“语句可以继续多行，除了”）; puts（“在字符串文字中。”）; puts（“用分号终止SQL语句。”）; puts（“终止PL / SQL块（可以包含嵌入的分号）”）; puts（“用斜杠（/）。”）; puts（“Typing \”exit \“（不需要分号）退出程序。”）; puts（“你打字”？\“或\”帮助\“获取此消息。\ n \ n”）; } void sql_error（）{/ * ORACLE错误处理程序* / printf（“\ n \ n％.70s \ n”，sqlca.sqlerrm.sqlerrmc）; if（parse_flag）printf（“SQL语句中字符偏移％d处的解析错误。\ n”，sqlca.sqlerrd [4]）; EXEC SQL WHENEVER SQLERROR CONTINUE; EXEC SQL ROLLBACK WORK; longjmp（jmp_continue，1）; }</pre></div>
                  <!-- class="section" -->
               </div>
            </div><a id="LNPCC4194"></a><a id="LNPCC4193"></a><div class="props_rev_3"><a id="GUID-D6A3B49E-C3DC-4055-A848-DD52E7539634" name="GUID-D6A3B49E-C3DC-4055-A848-DD52E7539634"></a><h3 id="LNPCC-GUID-D6A3B49E-C3DC-4055-A848-DD52E7539634" class="sect3"><span class="enumeration_section">15.8</span>示例程序：使用Scrollable Cursors的动态SQL方法4</h3>
               <div>
                  <div class="section">
                     <p>该演示程序描述了与oracle动态方法4一起使用的可滚动游标功能。该程序可在您的演示目录中的<code class="codeph">scdemo1.pc</code>文件中<code class="codeph">scdemo1.pc</code>获得。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-D6A3B49E-C3DC-4055-A848-DD52E7539634__GUID-9AC60AB7-40D3-42EF-8DF2-A97E776D031B">scdemo1.pc</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section"><pre class="oac_no_warn" dir="ltr">/ * *此演示程序展示了与oracle动态方法4一起使用的可滚动光标功能*。可滚动游标*功能也可以与ANSI动态方法4一起使用。* *此程序将username / passwd作为参数。登录后，会提示选择查询。然后它会提示*以查找方向并打印查询结果。* *在执行此示例之前，请确保HR *架构存在。* / #include &lt;oci.h&gt; #include &lt;stdio.h&gt; #include &lt;sqlca.h&gt; #include &lt;sqlda.h&gt; #include &lt;string.h&gt; #include &lt;ctype.h&gt; #include &lt;sqlcpr.h &gt; #include &lt;stdlib.h&gt; #include &lt;setjmp.h&gt; #define MAX_SELECT_ITEMS 200 #define MAX_CHARS 20 / *选择列表项目名称的最大大小* / #define MAX_NAME_SIZE 50 SQLDA * selda; SQLDA * bind_des; jmp_buf beginEnv; jmp_buf loopEnv; / *数据缓冲区* / char c_data [MAX_SELECT_ITEMS] [MAX_CHARS]; char username [60]; char stmt [500]; char stmt2 [500]; / *打印通用错误消息＆exit * / void sql_error（）{char msgbuf [512]; size_t msgbuf_len，msg_len; msgbuf_len = sizeof（msgbuf）; sqlglm（msgbuf，＆msgbuf_len，＆msg_len）; printf（“\ n \ n％。* s \ n”，msg_len，msgbuf）; EXEC SQL WHENEVER SQLERROR CONTINUE; EXEC SQL ROLLBACK工作版;出口（EXIT_FAILURE）; } / *打印错误消息并继续查询用户* / void sql_loop_error（）{char msgbuf [512]; size_t msgbuf_len，msg_len; int code = sqlca.sqlcode; msgbuf_len = sizeof（msgbuf）; sqlglm（msgbuf，＆msgbuf_len，＆msg_len）; printf（“\ n％。* s \ n”，msg_len，msgbuf）; printf（“错误代码是％d \ n”，sqlca.sqlcode）;如果（代码！= 0）longjmp（beginEnv，1）; longjmp（loopEnv，1）; } / * FETCH返回“找不到数据”错误代码。这意味着我们要么到达活动集的末尾，要么偏移指的是超出活动集的行* / void no_data_found（）{printf（“\ nNo指定偏移量处的数据\ n”）; longjmp（loopEnv，1）; void main（int argc，char * argv []）{int i，n; int sli; / * select-list item * / int offset; int contFlag; char bindVar [20]; char * u，temp [3]; char选择; / *错误处理程序* / EXEC SQL WHENEVER SQLERROR DO sql_error（）; if（argc == 1）{printf（“以默认用户hr \ n登录”）; strcpy（用户名，“hr / hr”）; } else strcpy（username，argv [1]）; / *建立与数据库的连接* / EXEC SQL CONNECT：username;你=用户名;而（* ++你！='/'）; * u ='\ 0'; / *错误处理程序* / EXEC SQL WHENEVER SQLERROR DO sql_loop_error（）; for（;;）{setjmp（beginEnv）; printf（“[％s] SQL&gt;”，用户名）;得到（语句）;如果（！strlen（stmt））继续; for（i = 0; i &lt;strlen（stmt）; i ++）stmt2 [i] = tolower（stmt [i]）; stmt2 [i] = 0;如果（！strcmp（stmt2，“exit”））break; selda = SQLSQLDAAlloc（SQL_SINGLE_RCTX，MAX_SELECT_ITEMS，MAX_NAME_SIZE，0）; bind_des = SQLSQLDAAlloc（SQL_SINGLE_RCTX，MAX_SELECT_ITEMS，MAX_NAME_SIZE，30）; / *为查询准备一个sql语句* / EXEC SQL PREPARE S FROM：stmt; / *将游标声明为可滚动的* / EXEC SQL DECLARE C SCROLL CURSOR FOR S; for（i = 0; i &lt;MAX_SELECT_ITEMS; i ++）{bind_des-&gt; I [i] =（short *）malloc（sizeof（short））; bind_des-&gt; V [i] =（char *）malloc（1）; } bind_des-&gt; N = MAX_SELECT_ITEMS;用于S INTO bind_des的EXEC SQL DESCRIBE BIND VARIABLES; / *设置绑定变量* / if（bind_des-&gt; F &lt;0）{printf（“绑定描述符，值超出限制\ n”）;出口（-1）; } bind_des-&gt; N = bind_des-&gt; F; for（i = 0; i &lt;bind_des-&gt; F; i ++）{printf（“输入绑定变量的值％。* s：”，（int）bind_des-&gt; C [i]，bind_des-&gt; S [i] ）; fgets（bindVar，sizeof（bindVar），stdin）; n = strlen（bindVar） -  1; bind_des-&gt; L [i] = n; bind_des-&gt; V [i] =（char *）realloc（bind_des-&gt; V [i]，（bind_des-&gt; L [i] +1））; strncpy（bind_des-&gt; V [i]，bindVar，n）; if（（strncmp（bind_des-&gt; V [i]，“NULL”，4）== 0）||（strncmp（bind_des-&gt; V [i]，“null”，4）== 0））* bind_des  - &gt;我[i] = -1; else * bind_des  - &gt; I [i] = 0; bind_des-&gt; T [i] = 1; } / *打开游标* / EXEC SQL OPEN C使用DESCRIPTOR bind_des; EXEC SQL DESCRIBE S INTO selda的选择列表; if（selda-&gt; F &lt;0）{printf（“选择描述符，值超过限制\ n”）;出口（-1）; } selda-&gt; N = selda-&gt; F; for（sli = 0; sli &lt;selda-&gt; N; sli ++）{/ *设置V元素中数组头部的地址。* / selda-&gt; V [sli] = c_data [sli]; / *在输出时将所有内容转换为varchar。* / selda-&gt; T [sli] = 1; / *设置最大长度。* / selda-&gt; L [sli] = MAX_CHARS; } contFlag ='Y';的setjmp（loopEnv）;而（1）{while（contFlag！='Y'&amp;&amp; contFlag！='N'）{printf（“\ n继续使用当前的提取？[y / n]：“）; contFlag = toupper（getchar（））; / *要刷新输入缓冲区* / getchar（）;} if（contFlag！='Y'）休息; contFlag ='x'; printf（“\ n \ n输入要提取的行号\ n”）;的printf（“1。ABSOLUTE \ n“）; printf（”2。RELATIVE \ n“）; printf（”3。FIRST \ n“）; printf（”4。NEXT \ n“）; printf（”5。上一页\ n“）; printf（”6。最后\ n“）; printf（”7。CURRENT \ n“）; printf（”输入你的选择 - &gt;“）; scanf（”％c“，＆choice）; / *刷新输入缓冲区* / getchar（）; EXEC SQL WHENEVER NOT FOUND DO no_data_found（） ; switch（choice）{case'1'：printf（“\ nEnterInterset：”）; scanf（“％d”，＆offset）; getchar（）; EXEC SQL FETCH ABSOLUTE：offset C使用DESCRIPTOR selda; break; case' 2'：printf（“\ n输入偏移量：”）; scanf（“％d”，＆offset）; getchar（）; EXEC SQL FETCH RELATIVE：offset C使用DESCRIPTOR selda; break; case'3'：EXEC SQL FETCH FIRST C使用DESCRIPTOR selda; break; case'4'：EXEC SQL FETCH NEXT C使用DESCRIPTOR selda; break; case'5'：EXEC SQL FETCH PRIOR C使用DESCRIPTOR selda; break; case'6'：EXEC SQL FETCH LAST C使用DESCRIPTOR selda; break; case'7'：EXEC SQL FETCH CURRENT C使用DESCRIPTOR selda; break;默认：printf（“无效选择\ n”）; contFlag ='Y'; continue;} / *打印行* / for（ sli = 0; sli &lt;selda-&gt; N; sli ++）printf（“％。20s”，c_data [sli]）; puts（“”）;} EXEC SQL CLOSE C;} EXEC SQL ROLLBACK RELEASE; exit（EXIT_SUCCESS）; }</pre></div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>