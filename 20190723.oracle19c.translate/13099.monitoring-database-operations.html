<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="This chapter describes how to monitor SQL and PL/SQL."></meta>
      <meta name="description" content="This chapter describes how to monitor SQL and PL/SQL."></meta>
      <title>监控数据库操作</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="SQL Tuning Guide"></meta>
      <meta property="og:description" content="This chapter describes how to monitor SQL and PL/SQL."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="SQL Tuning Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="sql-tuning-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-31T14:57:08-08:00"></meta>
      <meta name="dcterms.title" content="SQL Tuning Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="2013, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96095-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="monitoring-and-tracing-sql.html" title="Previous" type="text/html"></link>
      <link rel="next" href="performing-application-tracing.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGSQL"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="monitoring-and-tracing-sql.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="performing-application-tracing.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL调优指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="monitoring-and-tracing-sql.html" property="item" typeof="WebPage"><span property="name">监视和跟踪SQL</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">监控数据库操作</li>
            </ol>
            <a id="GUID-C941CE9D-97E1-42F8-91ED-4949B2B710BF" name="GUID-C941CE9D-97E1-42F8-91ED-4949B2B710BF"></a>
            
            <h2 id="TGSQL-GUID-C941CE9D-97E1-42F8-91ED-4949B2B710BF" class="sect2"><span class="enumeration_chapter">21</span>监控数据库操作</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍如何监视SQL和PL / SQL。</p>
               <p>本章包含以下主题：</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-007E5BAE-B07D-4BD1-9485-DE8D260BF862">关于监控数据库操作</a><br>当<code class="codeph">STATISTICS_LEVEL</code>初始化参数设置为<code class="codeph">TYPICAL</code> （默认值）或<code class="codeph">ALL</code>时，默认情况下启用SQL监视功能。</li>
                  <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-61D052D2-1F06-4A8C-A9D8-26504AD8A720">启用和禁用数据库操作监视</a><br>使用初始化参数启用或禁用监视。
                  </li>
                  <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-DC573FB7-40C5-4D6D-BE81-EF356900B444">定义复合数据库操作</a><br>定义数据库操作涉及提供名称并指定其开始和结束时间。
                  </li>
                  <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-4048D00E-2635-42C8-A37D-71EFAC619062">生成和访问SQL监视器报告</a><br>默认情况下，AWR会自动以XML格式捕获SQL监视报告。
                  </li>
                  <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-75DE088E-4CFA-47D9-8078-F3BE97A255F7">监控数据库操作：方案</a><br>在这些方案中，您将报告简单和复合数据库操作。
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="monitoring-and-tracing-sql.html#GUID-CA494EFF-53D7-4345-9576-8FED65F35AAE" title="使用DBMS_MONITOR跟踪数据库操作，使用SQL Test Case Builder打包与性能问题相关的信息，使用SQL Trace生成问题SQL语句的诊断数据。">监视和跟踪SQL</a></p>
                  </div>
               </div>
            </div>
            <a id="TGSQL789"></a><a id="TGSQL790"></a><div class="props_rev_3"><a id="GUID-007E5BAE-B07D-4BD1-9485-DE8D260BF862" name="GUID-007E5BAE-B07D-4BD1-9485-DE8D260BF862"></a><h3 id="TGSQL-GUID-007E5BAE-B07D-4BD1-9485-DE8D260BF862" class="sect3"><span class="enumeration_section">21.1</span>关于监视数据库操作</h3>
               <div>
                  <p>当<code class="codeph">STATISTICS_LEVEL</code>初始化参数设置为<code class="codeph">TYPICAL</code> （默认值）或<code class="codeph">ALL</code>时，默认情况下启用SQL监视功能。</p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-573B83E0-15D4-4132-9ABE-91FB5D398B9C">关于数据库操作</a><br>数据库操作是一组数据库任务。典型任务可能是批处理作业或提取，转换和加载（ETL）处理作业。
                     </li>
                     <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-7E2A0A25-6EF1-4180-B16E-65B47039CEC7">监视数据库操作的目的</a><br>对于简单操作，实时SQL监视有助于确定语句花费时间的位置。
                     </li>
                     <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-CEED2A89-51DE-42AC-B2BD-CAD3D6E25807">数据库监控的工作原理</a><br>实时SQL监控是一种内置的数据库基础结构，可帮助您识别长时间运行的并行SQL语句的性能问题。
                     </li>
                     <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-13D71625-2548-4F7B-B2B2-FEEAD24F7690">用于数据库操作监视的用户界面</a><br>实时SQL监控是Oracle数据库调优包的一项功能。当<code class="codeph">CONTROL_MANAGEMENT_PACK_ACCESS</code>初始化参数设置为<code class="codeph">DIAGNOSTIC+TUNING</code> （默认值）时，将启用数据库操作。
                     </li>
                     <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-A11CCA38-7DD8-4B08-9311-29CC7ED92EE6">数据库操作监控中的基本任务</a><br>本节介绍数据库操作监视的基本任务。
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-007E5BAE-B07D-4BD1-9485-DE8D260BF862__GUID-6DE945D9-2E81-4945-B526-D400CDB87B57">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="../cncpt/process-architecture.html#CNCPT89228" target="_blank"><span><cite>Oracle数据库概念，</cite></span></a>用于简要概述数据库操作</p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-C941CE9D-97E1-42F8-91ED-4949B2B710BF" title="本章介绍如何监视SQL和PL / SQL。">监视数据库操作</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-573B83E0-15D4-4132-9ABE-91FB5D398B9C" name="GUID-573B83E0-15D4-4132-9ABE-91FB5D398B9C"></a><h4 id="TGSQL-GUID-573B83E0-15D4-4132-9ABE-91FB5D398B9C" class="sect4"><span class="enumeration_section">21.1.1</span>关于数据库操作</h4>
                  <div>
                     <p>数据库操作是一组数据库任务。典型任务可能是批处理作业或提取，转换和加载（ETL）处理作业。</p>
                     <p>数据库操作要么简单，要么是复合操</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-573B83E0-15D4-4132-9ABE-91FB5D398B9C__GUID-4F5BE2BC-B1E4-4B17-8482-830BF4B1E7DB">简单数据库操作</p>
                        <p><strong class="term">简单的数据库操作</strong>是单个SQL语句或PL / SQL子程序。启用SQL监视器功能时，如果满足以下任一条件，数据库将自动监视简单的数据库操作：</p>
                        <ul id="GUID-573B83E0-15D4-4132-9ABE-91FB5D398B9C__UL_J1J_GM5_DGB" style="list-style-type:disc">
                           <li>
                              <p>SQL语句或PL / SQL子程序在单次执行中消耗了至少5秒的CPU或I / O时间。</p>
                           </li>
                           <li>
                              <p>SQL语句并行执行。</p>
                           </li>
                           <li>
                              <p>SQL语句指定<code class="codeph">/*+ MONITOR */</code>提示。
                              </p>
                           </li>
                           <li>
                              <div class="p">事件<code class="codeph">sql_monitor</code>指定要监视的语句的SQL ID列表。例如，以下语句强制实例级监视SQL ID <code class="codeph">5hc07qvt8v737</code>和<code class="codeph">9ht3ba3arrzt3</code> ：<pre class="pre codeblock"><code>ALTER SYSTEM SET EVENTS的sql_monitor [sql：5hc07qvt8v737 | sql：9ht3ba3arrzt3] force = true'</code></pre></div>
                           </li>
                        </ul>
                        <p>在SQL执行计划的每个步骤中，数据库按性能指标跟踪统计信息，例如已用时间，CPU时间，读写次数和I / O等待时间。这些度量标准位于称为SQL监视器活动报告的图形和交互式报告中。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-573B83E0-15D4-4132-9ABE-91FB5D398B9C__GUID-7025C4C3-5775-4263-AE41-46C74E8E6EB9">复合数据库操作</p>
                        <p><strong class="term">复合数据库操作</strong>由用户定义。它包括在数据库会话中执行的所有SQL语句或PL / SQL子程序，使用过程<code class="codeph">DBMS_SQL_MONITOR.BEGIN_OPERATION</code>和<code class="codeph">DBMS_SQL_MONITOR.END_OPERATION</code>定义起点和终点。复合数据库操作由其名称和执行ID唯一标识，并且可以多次执行。
                        </p>
                        <div class="infoboxnote" id="GUID-573B83E0-15D4-4132-9ABE-91FB5D398B9C__GUID-723837FE-1EC6-47E3-B3E5-0694A874EBF7">
                           <p class="notep1">注意：</p>
                           <p>数据库会话一次最多可以参与一个数据库操作。</p>
                        </div>
                        <p>当满足以下任一条件时，Oracle数据库会自动监视复合操作：</p>
                        <ul id="GUID-573B83E0-15D4-4132-9ABE-91FB5D398B9C__UL_K1J_GM5_DGB" style="list-style-type:disc">
                           <li>
                              <p>该操作消耗了至少5秒的CPU或I / O时间。</p>
                           </li>
                           <li>
                              <p>通过在<code class="codeph">DBMS_SQL_MONITOR.BEGIN_OPERATION</code> <code class="codeph">FORCED_TRACKING</code>设置为<code class="codeph">Y</code>来强制跟踪操作。</p>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-573B83E0-15D4-4132-9ABE-91FB5D398B9C__GUID-32245893-1F1E-4445-A0F6-692482056340">
                           <p class="notep1">注意：</p>
                           <p><span class="q">“ <a href="https://sqlmaria.com/2017/08/01/getting-the-most-out-of-oracle-sql-monitor/" target="_blank">充分利用SQL监视器</a> ”</span>以<span class="q"><a href="https://sqlmaria.com/2017/08/01/getting-the-most-out-of-oracle-sql-monitor/" target="_blank">获取SQL监视器</a></span>的简要概述</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-007E5BAE-B07D-4BD1-9485-DE8D260BF862" title="当STATISTICS_LEVEL初始化参数设置为TYPICAL（默认值）或ALL时，默认情况下启用SQL监视功能。">关于监视数据库操作</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94583"></a><div class="props_rev_3"><a id="GUID-7E2A0A25-6EF1-4180-B16E-65B47039CEC7" name="GUID-7E2A0A25-6EF1-4180-B16E-65B47039CEC7"></a><h4 id="TGSQL-GUID-7E2A0A25-6EF1-4180-B16E-65B47039CEC7" class="sect4"><span class="enumeration_section">21.1.2</span>监视数据库操作的目的</h4>
                  <div>
                     <p>对于简单操作，实时SQL监视有助于确定语句花费时间的位置。</p>
                     <p>您还可以查看最近完成的语句的时间和资源使用情况。通过这种方式，您可以更好地确定特定操作为何昂贵。用于实时SQL监视的用例包括以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>经常执行的SQL语句执行速度比正常情况慢。您必须确定此问题的根本原因。</p>
                        </li>
                        <li>
                           <p>数据库会话正在经历性能下降。</p>
                        </li>
                        <li>
                           <p>并行SQL语句需要很长时间。您想确定服务器进程如何划分工作。</p>
                        </li>
                     </ul>
                     <p>在OLTP和数据仓库环境中，作业通常在逻辑上对相关的SQL语句进行分组。该作业可以跨多个并发会话。数据库操作通过使您能够将一组语句或过程视为已命名，唯一标识和可重新执行的单元来扩展实时SQL监视。用于监视操作的用例包括以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>包含许多SQL语句的定期批处理作业必须在特定的小时数内完成，但需要的时间比预期的要长。</p>
                        </li>
                        <li>
                           <p>数据库升级后，重要批处理作业的执行时间增加。要解决此问题，必须在升级之前和之后从批处理作业中收集足够的相关统计数据，比较两组数据，然后确定更改。</p>
                        </li>
                        <li>
                           <p>打包<a href="glossary.html#GUID-52FB0AE5-7346-44E5-BE92-3C09385B1DDC"><span class="xrefglossterm">SQL调优集（STS）的</span></a>时间远远超过预期。要诊断问题，您需要知道一段时间内正在执行的操作。由于此问题无法轻松复制，因此您需要在运行过程中监控该过程。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="monitoring-database-operations.html#GUID-4048D00E-2635-42C8-A37D-71EFAC619062" title="默认情况下，AWR会自动以XML格式捕获SQL监视报告。">生成和访问SQL监视器报告</a></li>
                           <li><a href="../admin/managing-resources-with-oracle-database-resource-manager.html#ADMIN-GUID-2BEF5482-CF97-4A85-BD90-9195E41E74EF" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a></li>
                        </ul>
                     </div>
                     <div class="infoboxnotealso" id="GUID-7E2A0A25-6EF1-4180-B16E-65B47039CEC7__GUID-B2196ADA-F11F-44D2-AD1F-E747AE7C69C1">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="https://www.youtube.com/watch?v=pEC5GdtzpRs" target="_blank">为什么使用SQL Monitor</a>来演示SQL Monitor的一些用途的视频</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-007E5BAE-B07D-4BD1-9485-DE8D260BF862" title="当STATISTICS_LEVEL初始化参数设置为TYPICAL（默认值）或ALL时，默认情况下启用SQL监视功能。">关于监视数据库操作</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94588"></a><a id="TGSQL94587"></a><div class="props_rev_3"><a id="GUID-CEED2A89-51DE-42AC-B2BD-CAD3D6E25807" name="GUID-CEED2A89-51DE-42AC-B2BD-CAD3D6E25807"></a><h4 id="TGSQL-GUID-CEED2A89-51DE-42AC-B2BD-CAD3D6E25807" class="sect4"><span class="enumeration_section">21.1.3</span>数据库监控的工作<span class="enumeration_section">原理</span></h4>
                  <div>
                     <p>实时SQL监控是一种内置的数据库基础结构，可帮助您识别长时间运行的并行SQL语句的性能问题。</p>
                     <p>下图概述了实时SQL监控的体系结构。</p>
                     <div class="figure" id="GUID-CEED2A89-51DE-42AC-B2BD-CAD3D6E25807__CHDIEDBG">
                        <p class="titleinfigure">图21-1数据库操作监视的体系结构</p><img src="img/tgsql_vm_033.png" alt="下面是图21-1的描述" title="下面是图21-1的描述" longdesc="img_text/tgsql_vm_033.html"><br><a href="img_text/tgsql_vm_033.html">“图21-1数据库操作监视的体系结构”的描述</a></div>
                     <!-- class="figure" -->
                     <p>如上图所示， <code class="codeph">DBMS_SQL_MONITOR</code>包定义了数据库操作。启动监视后，数据库将存储有关AWR中数据库操作的元数据以及AWR和ASH中的数据。当每个受监视的语句执行时，数据库会近乎实时地刷新监视统计信息，通常每秒一次。数据库将操作数据（语句和元数据）存储在SGA中。操作完成后，数据库会将SQL Monitor报告写入磁盘，可以使用<code class="codeph">DBA_HIST_REPORTS</code>视图查询该报告。
                     </p>
                     <p>每个受监视的数据库操作在<code class="codeph">V$SQL_MONITOR</code>视图中都有一个条目。此条目跟踪为执行收集的关键性能指标，包括已用时间，CPU时间，读写次数，I / O等待时间以及各种其他等待时间。<code class="codeph">V$SQL_PLAN_MONITOR</code>视图包括监视正在监视的SQL语句的执行计划中的每个操作的统计信息。您可以使用<code class="codeph">DBMS_SQL_MONITOR.REPORT_SQL_MONITOR</code> ，Oracle企业管理器云控制（云控制）或EM Express访问报告。
                     </p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-CEED2A89-51DE-42AC-B2BD-CAD3D6E25807__GUID-9866759A-4792-41B7-ACAE-61886EEAA495">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="monitoring-database-operations.html#GUID-4048D00E-2635-42C8-A37D-71EFAC619062" title="默认情况下，AWR会自动以XML格式捕获SQL监视报告。">生成和访问SQL监视器报告</a> ”</span></p>
                           </li>
                           <li>
                              <p><span><cite>Oracle数据库参考</cite></span> ，了解<a href="../refrn/V-SQL_MONITOR.html#GUID-79E97A84-9C27-4A5E-AC0D-C12CB3E748E6" target="_blank"><code class="codeph">V$SQL_MONITOR</code></a> ， <a href="../refrn/V-SQL_PLAN_MONITOR.html#GUID-85354ECB-7E2E-4D4B-AE78-243A4BB6E523" target="_blank"><code class="codeph">V$SQL_PLAN_MONITOR</code></a>和<a href="../refrn/CONTROL_MANAGEMENT_PACK_ACCESS.html#GUID-A5CA11BA-AE1F-4A2E-9C59-A98BA1F4E5C2" target="_blank"><code class="codeph">CONTROL_MANAGEMENT_PACK_ACCESS</code></a></p>
                           </li>
                           <li>
                              <p><a href="../arpls/DBMS_SQL_MONITOR.html#ARPLS-GUID-13874A73-369E-42CD-9C43-A12F1B3BDEC6" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_SQL_MONITOR</code>包</p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-007E5BAE-B07D-4BD1-9485-DE8D260BF862" title="当STATISTICS_LEVEL初始化参数设置为TYPICAL（默认值）或ALL时，默认情况下启用SQL监视功能。">关于监视数据库操作</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94592"></a><div class="props_rev_3"><a id="GUID-13D71625-2548-4F7B-B2B2-FEEAD24F7690" name="GUID-13D71625-2548-4F7B-B2B2-FEEAD24F7690"></a><h4 id="TGSQL-GUID-13D71625-2548-4F7B-B2B2-FEEAD24F7690" class="sect4"><span class="enumeration_section">21.1.4</span>数据库操作监视的用户界面</h4>
                  <div>
                     <p>实时SQL监控是Oracle数据库调优包的一项功能。当<code class="codeph">CONTROL_MANAGEMENT_PACK_ACCESS</code>初始化参数设置为<code class="codeph">DIAGNOSTIC+TUNING</code> （默认值）时，将启用数据库操作。
                     </p>
                     <div class="section">
                        <p>本节包含以下主题：</p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-061502D7-5546-4AB6-B6D3-62FBF71E8CB7">云控制中受监控的SQL执行页面</a><br>Cloud Control中的“受监视的SQL执行”页面（也称为SQL Monitor）显示SQL执行的详细信息。SQL Monitor是报告数据库操作的推荐接口。
                        </li>
                        <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-4ABD504A-EDAD-4DA6-BEBD-772BF9214218">DBMS_SQL_MONITOR包</a><br><code class="codeph">DBMS_SQL_MONITOR</code>包定义复合数据库操作的开始和结束，并生成数据库操作的报告。
                        </li>
                        <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-EC276737-148A-4ED7-AA7D-F125AD1B8859">复合数据库操作的属性</a><br><code class="codeph">DBMS_SQL_MONITOR.BEGIN_OPERATION</code>函数定义数据库操作。
                        </li>
                        <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-19E0F73C-A959-41E4-A168-91E436DEE1F1">MONITOR和NO_MONITOR提示</a><br>您可以使用MONITOR和NO_MONITOR提示来控制各个语句的跟踪。
                        </li>
                        <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-E471C229-5713-40E2-A95C-593EACB56AE7">监视和报告数据库操作的视图</a><br>您可以使用<code class="codeph">V$</code>和数据字典视图获取数据库操作的统计信息。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-007E5BAE-B07D-4BD1-9485-DE8D260BF862" title="当STATISTICS_LEVEL初始化参数设置为TYPICAL（默认值）或ALL时，默认情况下启用SQL监视功能。">关于监视数据库操作</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL94593"></a><div class="props_rev_3"><a id="GUID-061502D7-5546-4AB6-B6D3-62FBF71E8CB7" name="GUID-061502D7-5546-4AB6-B6D3-62FBF71E8CB7"></a><h5 id="TGSQL-GUID-061502D7-5546-4AB6-B6D3-62FBF71E8CB7" class="sect5"><span class="enumeration_section">21.1.4.1</span> Cloud Control中的受监控SQL执行页面</h5>
                     <div>
                        <p>Cloud Control中的“受监视的SQL执行”页面（也称为SQL Monitor）显示SQL执行的详细信息。SQL Monitor是报告数据库操作的推荐接口。</p>
                        <div class="section">
                           <p>执行计划的每个步骤的统计信息由关键性能指标跟踪，包括已用时间，CPU时间，读写次数，I / O等待时间以及各种其他等待时间。这些指标使DBA能够深入分析SQL执行，并为受监控的SQL语句决定最合适的调优策略。</p>
                           <p>SQL Monitor Active Reports提供基于Flash的交互式报告，使您可以将数据保存在HTML文件中。您可以保存此文件并离线查看。</p>
                           <p>本节包含以下主题：</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-4D6B463D-0CFB-4A2F-9507-B64122AAC530">访问受监视的SQL执行页面</a><br>“受监视的SQL执行”显示诸如SQL ID，数据库时间和I / O请求之类的信息。
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-13D71625-2548-4F7B-B2B2-FEEAD24F7690" title="实时SQL监控是Oracle数据库调优包的一项功能。当CONTROL_MANAGEMENT_PACK_ACCESS初始化参数设置为DIAGNOSTIC + TUNING（默认值）时，将启用数据库操作。">数据库操作监视的用户界面</a></p>
                           </div>
                        </div>
                     </div>
                     <a id="TGSQL94594"></a><div class="props_rev_3"><a id="GUID-4D6B463D-0CFB-4A2F-9507-B64122AAC530" name="GUID-4D6B463D-0CFB-4A2F-9507-B64122AAC530"></a><h6 id="TGSQL-GUID-4D6B463D-0CFB-4A2F-9507-B64122AAC530" class="sect6"><span class="enumeration_section">21.1.4.1.1</span>访问受监控的SQL执行页面</h6>
                        <div>
                           <p>“受监视的SQL执行”显示诸如SQL ID，数据库时间和I / O请求之类的信息。</p>
                           <div class="section">
                              <p class="subhead3" id="GUID-4D6B463D-0CFB-4A2F-9507-B64122AAC530__GUID-D4218241-3368-4D61-A433-9FD7E7ACB1F2">要访问“受监视的SQL执行”页面：</p>
                              <ol>
                                 <li>
                                    <p>使用适当的凭据登录Cloud Control。</p>
                                 </li>
                                 <li>
                                    <p>在“ <span class="bold">目标”</span>菜单下，选择“ <span class="bold">数据库”</span> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p>在数据库目标列表中，选择要管理的Oracle数据库实例的目标。</p>
                                 </li>
                                 <li>
                                    <p>如果系统提示您输入数据库凭据，请输入您要执行的任务所需的最低凭据。</p>
                                 </li>
                                 <li>
                                    <p>从“ <span class="bold">性能”</span>菜单中，选择“ <span class="bold">SQL监视”</span> 。
                                    </p>
                                    <p>将显示“监视的SQL执行”页面。</p>
                                    <div class="figure" id="GUID-4D6B463D-0CFB-4A2F-9507-B64122AAC530__GUID-055D4E03-F49D-4192-8FFF-37E44818608E">
                                       <p class="titleinfigure">图21-2受监控的SQL执行</p><img src="img/mon_sql_exec.jpg" alt="下面是图21-2的描述" title="下面是图21-2的描述" longdesc="img_text/mon_sql_exec.html"><br><a href="img_text/mon_sql_exec.html">“图21-2受监控的SQL执行”的说明</a></div>
                                    <!-- class="figure" -->
                                 </li>
                              </ol>
                           </div>
                           <!-- class="section" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-061502D7-5546-4AB6-B6D3-62FBF71E8CB7" title="Cloud Control中的“受监视的SQL执行”页面（也称为SQL Monitor）显示SQL执行的详细信息。SQL Monitor是报告数据库操作的推荐接口。">Cloud Control中的受监控SQL执行页面</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div><a id="TGSQL94596"></a><a id="TGSQL94595"></a><div class="props_rev_3"><a id="GUID-4ABD504A-EDAD-4DA6-BEBD-772BF9214218" name="GUID-4ABD504A-EDAD-4DA6-BEBD-772BF9214218"></a><h5 id="TGSQL-GUID-4ABD504A-EDAD-4DA6-BEBD-772BF9214218" class="sect5"><span class="enumeration_section">21.1.4.2</span> DBMS_SQL_MONITOR包</h5>
                     <div>
                        <p><code class="codeph">DBMS_SQL_MONITOR</code>包定义复合数据库操作的开始和结束，并生成数据库操作的报告。
                        </p>
                        <div class="tblformalwide" id="GUID-4ABD504A-EDAD-4DA6-BEBD-772BF9214218__GUID-B2677E02-96F7-4C9E-BFDB-7B2AE810BBA6">
                           <p class="titleintable">表21-1 DBMS_SQL_MONITOR</p>
                           <table cellpadding="4" cellspacing="0" class="FormalWide" title="DBMS_SQL_MONITOR" width="100%" border="1" summary="This 2 column table describes DBMS_SQL_MONITOR. Column 1 is the program unit. Column 2 describes that unit. " frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" id="d105713e1520">子程序</th>
                                    <th align="left" valign="bottom" id="d105713e1523">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d105713e1528" headers="d105713e1520 ">
                                       <p><code class="codeph">BEGIN_OPERATION</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d105713e1528 d105713e1523 ">
                                       <p><span>此函数在当前会话中启动数据库操作。</span></p>
                                       <p>此函数将会话与数据库操作相关联。从<span>Oracle Database 12c</span>第2版（12.2）开始，您可以使用<code class="codeph">session_id</code>和<code class="codeph">session_num</code>来指示开始监视的会话。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d105713e1548" headers="d105713e1520 ">
                                       <p><code class="codeph">END_OPERATION</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d105713e1548 d105713e1523 ">
                                       <p><span>此函数结束当前会话中的数据库操作。如果指定的数据库操作不存在，则此函数无效。</span></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d105713e1557" headers="d105713e1520 ">
                                       <p><code class="codeph">REPORT_SQL_MONITOR</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d105713e1557 d105713e1523 ">
                                       <p><span>此函数构建详细报告，其中包含SQL语句，PL / SQL块或数据库操作的监视信息。</span></p>
                                       <p>对于每个操作，它提供关键信息和相关的全局统计信息。使用此函数可获取数据库操作的详细监视信息。</p>
                                       <p>此报告的目标数据库操作可以是：</p>
                                       <ul style="list-style-type:disc">
                                          <li>
                                             <p>Oracle数据库监控的最后一个数据库操作（默认情况下，无参数）。</p>
                                          </li>
                                          <li>
                                             <p>最后一个数据库操作在指定的会话中执行并由Oracle数据库监视。会话由其会话ID和可选的序列号（ <code class="codeph">-1</code>是当前会话）标识。
                                             </p>
                                          </li>
                                          <li>
                                             <p>最后一次执行由其<code class="codeph">sql_id</code>标识的特定数据库操作。
                                             </p>
                                          </li>
                                          <li>
                                             <p>由<code class="codeph">sql_id</code> ， <code class="codeph">sql_exec_start</code>和<code class="codeph">sql_exec_id</code>组合标识的数据库操作的特定执行。
                                             </p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">dbop_name</code>标识的特定数据库操作的最后一次执行。
                                             </p>
                                          </li>
                                          <li>
                                             <p>由<code class="codeph">dbop_name</code> ， <code class="codeph">dbop_exec_id</code>组合标识的数据库操作的特定执行。
                                             </p>
                                          </li>
                                       </ul>
                                       <p>使用<code class="codeph">type</code>参数指定输出类型： <code class="codeph">TEXT</code> （默认值）， <code class="codeph">HTML</code> ， <code class="codeph">ACTIVE</code>或<code class="codeph">XML</code> 。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d105713e1630" headers="d105713e1520 ">
                                       <p><code class="codeph">REPORT_SQL_MONITOR_XML</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d105713e1630 d105713e1523 ">
                                       <p><span>此函数与<code class="codeph">REPORT_SQL_MONITOR</code>函数相同，只是返回类型是<code class="codeph">XMLType</code> 。</span></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d105713e1645" headers="d105713e1520 ">
                                       <p><code class="codeph">REPORT_SQL_MONITOR_LIST</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d105713e1645 d105713e1523 ">
                                       <p><span>此函数为Oracle数据库监视的所有或部分数据库操作构建报告。</span></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d105713e1654" headers="d105713e1520 ">
                                       <p><code class="codeph">REPORT_SQL_MONITOR_LIST_XML</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d105713e1654 d105713e1523 ">
                                       <p><span>此函数与<code class="codeph">REPORT_SQL_MONITOR_LIST</code>函数相同，只是它返回<code class="codeph">XMLType</code> 。</span></p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <div class="section"></div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-4ABD504A-EDAD-4DA6-BEBD-772BF9214218__GUID-F4C2D356-6227-407F-96AA-A552D6AC39BB">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS74779" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_SQL_MONITOR</code>包</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-13D71625-2548-4F7B-B2B2-FEEAD24F7690" title="实时SQL监控是Oracle数据库调优包的一项功能。当CONTROL_MANAGEMENT_PACK_ACCESS初始化参数设置为DIAGNOSTIC + TUNING（默认值）时，将启用数据库操作。">数据库操作监视的用户界面</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL94590"></a><div class="props_rev_3"><a id="GUID-EC276737-148A-4ED7-AA7D-F125AD1B8859" name="GUID-EC276737-148A-4ED7-AA7D-F125AD1B8859"></a><h5 id="TGSQL-GUID-EC276737-148A-4ED7-AA7D-F125AD1B8859" class="sect5"><span class="enumeration_section">21.1.4.3</span>复合数据库操作的属性</h5>
                     <div>
                        <p><code class="codeph">DBMS_SQL_MONITOR.BEGIN_OPERATION</code>函数定义数据库操作。
                        </p>
                        <p>通过以下信息唯一标识复合数据库操作：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>数据库操作名称</p>
                              <p>这是用户创建的名称，例如<code class="codeph">daily_sales_report</code> 。即使作业由不同的会话或不同的数据库同时执行，作业的操作名称也是相同的。数据库操作名称不驻留在不同的名称空间中。
                              </p>
                           </li>
                           <li>
                              <p>数据库操作执行ID</p>
                              <p>同一数据库操作的两次或多次出现可以同时运行，名称相同但执行ID不同。此数字ID唯一标识<span class="italic">同一</span>数据库操作的不同执行。
                              </p>
                              <p>开始数据库操作时，数据库会自动创建执行ID。您还可以指定用户创建的执行ID。</p>
                           </li>
                        </ul>
                        <p>（可选）您可以指定启动数据库操作的会话ID和会话序列号。因此，一个数据库会话可以启动在不同数据库会话中定义的数据库操作。</p>
                        <p>数据库使用以下三元组值来标识<code class="codeph">V$SQL_MONITOR</code>视图中监视的每个SQL和PL / SQL语句，无论该语句是否包含在数据库操作中：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>用于标识SQL语句的SQL标识符（ <code class="codeph">SQL_ID</code> ）</p>
                           </li>
                           <li>
                              <p>开始执行时间戳（ <code class="codeph">SQL_EXEC_START</code> ）</p>
                           </li>
                           <li>
                              <p>内部生成的标识符，用于确保此主键真正唯一（ <code class="codeph">SQL_EXEC_ID</code> ）</p>
                           </li>
                        </ul>
                        <p>您可以使用零个或多个其他属性来描述和标识复合数据库操作的特征。每个属性都有名称和值。例如，对于数据库操作<code class="codeph">daily_sales_report</code> ，您可以定义属性<code class="codeph">db_name</code>并为其指定值<code class="codeph">prod</code> 。
                        </p>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="../refrn/V-SQL_MONITOR.html#REFRN-GUID-79E97A84-9C27-4A5E-AC0D-C12CB3E748E6" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></li>
                              <li><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-25BE0E79-3A19-4303-9F66-2CFDB87C7F82" target="_blank"><span><cite>Oracle数据库PL / SQL包和类型参考</cite></span></a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-13D71625-2548-4F7B-B2B2-FEEAD24F7690" title="实时SQL监控是Oracle数据库调优包的一项功能。当CONTROL_MANAGEMENT_PACK_ACCESS初始化参数设置为DIAGNOSTIC + TUNING（默认值）时，将启用数据库操作。">数据库操作监视的用户界面</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-19E0F73C-A959-41E4-A168-91E436DEE1F1" name="GUID-19E0F73C-A959-41E4-A168-91E436DEE1F1"></a><h5 id="TGSQL-GUID-19E0F73C-A959-41E4-A168-91E436DEE1F1" class="sect5"><span class="enumeration_section">21.1.4.4</span> MONITOR和NO_MONITOR提示</h5>
                     <div>
                        <p>您可以使用MONITOR和NO_MONITOR提示来控制各个语句的跟踪。</p>
                        <div class="section">
                           <p>即使语句没有长时间运行， <code class="codeph">MONITOR</code>提示也会强制对查询进行实时SQL监视。仅当参数<code class="codeph">CONTROL_MANAGEMENT_PACK_ACCESS</code>设置为<code class="codeph">DIAGNOSTIC+TUNING</code>时，此提示才有效。以下查询强制SQL Monitor启用跟踪：</p><pre class="pre codeblock"><code>SELECT / * + MONITOR * / prod_id，AVG（amount_sold），AVG（quantity_sold）FROM sales GROUP BY prod_id ORDER BY prod_id;</code></pre><p>即使查询长时间运行， <code class="codeph">NO_MONITOR</code>提示<code class="codeph">NO_MONITOR</code>禁用查询的实时SQL监视。以下查询强制SQL Monitor禁用跟踪：</p><pre class="pre codeblock"><code>SELECT / * + NO_MONITOR * / prod_id，AVG（amount_sold），AVG（quantity_sold）FROM sales GROUP BY prod_id ORDER BY prod_id;</code></pre><div class="infoboxnote" id="GUID-19E0F73C-A959-41E4-A168-91E436DEE1F1__GUID-ABF01735-9EAA-4307-8BDA-088A51F31655">
                              <p class="notep1">注意：</p>
                              <p><a href="../sqlrf/Comments.html#GUID-CD628749-C7E0-4EBB-A989-E9C10325EDF7" target="_blank"><span><cite>Oracle数据库SQL语言参考，</cite></span></a>以了解<code class="codeph">MONITOR</code>和<code class="codeph">NO_MONITOR</code>提示</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-13D71625-2548-4F7B-B2B2-FEEAD24F7690" title="实时SQL监控是Oracle数据库调优包的一项功能。当CONTROL_MANAGEMENT_PACK_ACCESS初始化参数设置为DIAGNOSTIC + TUNING（默认值）时，将启用数据库操作。">数据库操作监视的用户界面</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL94598"></a><a id="TGSQL94597"></a><div class="props_rev_3"><a id="GUID-E471C229-5713-40E2-A95C-593EACB56AE7" name="GUID-E471C229-5713-40E2-A95C-593EACB56AE7"></a><h5 id="TGSQL-GUID-E471C229-5713-40E2-A95C-593EACB56AE7" class="sect5"><span class="enumeration_section">21.1.4.5</span>监视和报告数据库操作的视图</h5>
                     <div>
                        <p>您可以使用<code class="codeph">V$</code>和数据字典视图获取数据库操作的统计信息。
                        </p>
                        <div class="section">
                           <p>下表总结了这些视图。</p>
                           <div class="tblformal" id="GUID-E471C229-5713-40E2-A95C-593EACB56AE7__CHDFEHFI">
                              <p class="titleintable">表21-2数据库操作监视视图</p>
                              <table cellpadding="4" cellspacing="0" class="Formal" title="数据库操作监视的视图" width="100%" border="1" summary="This table describes views that you can use to monitor database operations." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" id="d105713e2178">视图</th>
                                       <th align="left" valign="bottom" id="d105713e2181">描述</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" id="d105713e2186" headers="d105713e2178 ">
                                          <p><a href="../refrn/DBA_HIST_REPORTS.html#REFRN23881" target="_blank"><code class="codeph">DBA_HIST_REPORTS</code></a></p>
                                       </td>
                                       <td align="left" valign="top" headers="d105713e2186 d105713e2181 ">
                                          <p>此视图显示有关在自动工作负载存储库（AWR）中捕获的XML报告的元数据。每个XML报告都包含有关组件某些活动的详细信息。例如，SQL Monitor报告包含有关特定数据库操作的详细报告。</p>
                                          <p>重要的专栏包括：</p>
                                          <ul style="list-style-type:disc">
                                             <li>
                                                <p><code class="codeph">REPORT_SUMMARY</code>列包含报告摘要。
                                                </p>
                                             </li>
                                             <li>
                                                <p><code class="codeph">COMPONENT_NAME</code>列接受值<code class="codeph">sqlmonitor</code> 。
                                                </p>
                                             </li>
                                             <li>
                                                <p><code class="codeph">REPORT_ID</code>列提供报告的ID，您可以在生成报告时在<code class="codeph">DBMS_AUTO_REPORT.REPORT_REPOSITORY_DETAIL</code>的<code class="codeph">RID</code>参数中指定该ID。
                                                </p>
                                             </li>
                                             <li>
                                                <p><code class="codeph">KEY1</code>列是语句的SQL ID。
                                                </p>
                                             </li>
                                             <li>
                                                <p><code class="codeph">KEY2</code>列是语句的SQL执行ID</p>
                                             </li>
                                          </ul>
                                          <p>AWR控制SQL Monitor报告的保留期。<code class="codeph">DBA_HIST_REPORTS</code>每个SQL监视器报告都与AWR <code class="codeph">SNAP_ID</code>相关联。请注意，导出或导入相应的AWR数据时，不会导出或导入SQL监视器报告。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" id="d105713e2246" headers="d105713e2178 ">
                                          <p><a href="../refrn/DBA_HIST_REPORTS_DETAILS.html#REFRN23882" target="_blank"><code class="codeph">DBA_HIST_REPORTS_DETAILS</code></a></p>
                                       </td>
                                       <td align="left" valign="top" headers="d105713e2246 d105713e2181 ">
                                          <p>此视图显示有关AWR中捕获的每个报告的详细信息。每个报告的元数据显示在<code class="codeph">DBA_HIST_REPORTS</code>视图中，而实际报告在<code class="codeph">DBA_HIST_REPORTS_DETAILS</code>视图中可用。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" id="d105713e2262" headers="d105713e2178 ">
                                          <p><a href="../refrn/V-SQL_MONITOR.html#GUID-79E97A84-9C27-4A5E-AC0D-C12CB3E748E6" target="_blank"><code class="codeph">V $ SQL_MONITOR</code></a></p>
                                       </td>
                                       <td align="left" valign="top" headers="d105713e2262 d105713e2181 ">
                                          <p>此视图包含有关简单和复合数据库操作的全局高级信息。</p>
                                          <p>对于简单的数据库操作，监视统计信息不会累积在多次执行中。在这种情况下， <code class="codeph">V$SQL_MONITOR</code>一个条目专用于单个执行SQL语句。如果数据库监视同一SQL语句的两次执行，则每次执行在<code class="codeph">V$SQL_MONITOR</code>都有一个单独的条目。</p>
                                          <p>对于简单的数据库操作， <code class="codeph">V$SQL_MONITOR</code>有一个用于并行执行协调器进程的条目和一个用于每个并行执行服务器进程的条目。每个条目在<code class="codeph">V$SQL_PLAN_MONITOR</code>都有对应的条目。由于为并行执行SQL语句分配的进程正在协作执行相同的操作，因此这些条目共享相同的执行键（ <code class="codeph">SQL_ID</code> ， <code class="codeph">SQL_EXEC_START</code>和<code class="codeph">SQL_EXEC_ID</code>的组合）。
                                          </p>
                                          <p>对于复合数据库操作，每一行都包含一个操作，该操作的统计信息是在SQL语句和PL / SQL子程序中累积的，这些子程序在操作的同一会话中运行。主键是<code class="codeph">DBOP_NAME</code>和<code class="codeph">DBOP_EXEC_ID</code>列的组合。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" id="d105713e2305" headers="d105713e2178 ">
                                          <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-F1C68683-4048-44FD-8B7A-F30FDCB751CA" target="_blank"><code class="codeph">V $ SQL_MONITOR_SESSTAT</code></a></p>
                                       </td>
                                       <td align="left" valign="top" headers="d105713e2305 d105713e2181 ">
                                          <p>此视图包含数据库操作中涉及的所有会话的统计信息。</p>
                                          <p>大多数统计数据是累积的。数据库以XML格式存储统计信息，而不是为每个统计信息使用每列。此视图主要用于报告生成器。Oracle建议您使用<code class="codeph">V$SESSTAT</code>而不是<code class="codeph">V$SQL_MONITOR_SESSTAT</code> 。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" id="d105713e2323" headers="d105713e2178 ">
                                          <p><a href="../refrn/V-SQL_PLAN_MONITOR.html#GUID-85354ECB-7E2E-4D4B-AE78-243A4BB6E523" target="_blank"><code class="codeph">V $ SQL_PLAN_MONITOR</code></a></p>
                                       </td>
                                       <td align="left" valign="top" headers="d105713e2323 d105713e2181 ">
                                          <p>此视图包含受监视SQL语句的执行计划中每个步骤的监视统计信息。</p>
                                          <p>在SQL语句执行时，数据库每秒更新<code class="codeph">V$SQL_PLAN_MONITOR</code>统计信息。对于每个受监视的SQL语句， <code class="codeph">V$SQL_PLAN_MONITOR</code>存在多个条目。每个条目对应于语句执行计划中的一个步骤。
                                          </p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p>您可以将以前的<code class="codeph">V$</code>视图与以下视图一起使用，以获取有关受监视执行的其他信息：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">V $ ACTIVE_SESSION_HISTORY</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">V $ SESSION</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">V $ SESSION_LONGOPS</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">V $ SQL</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">V $ SQL_PLAN</code></p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-E471C229-5713-40E2-A95C-593EACB56AE7__GUID-496AF598-73E7-4D1A-A61C-F6358276E7D7">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../refrn/dynamic-performance-views.html#GUID-8C5690B0-DE10-4460-86DF-80111869CF4C" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解数据库操作监视的<code class="codeph">V$</code>视图</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-13D71625-2548-4F7B-B2B2-FEEAD24F7690" title="实时SQL监控是Oracle数据库调优包的一项功能。当CONTROL_MANAGEMENT_PACK_ACCESS初始化参数设置为DIAGNOSTIC + TUNING（默认值）时，将启用数据库操作。">数据库操作监视的用户界面</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL94599"></a><div class="props_rev_3"><a id="GUID-A11CCA38-7DD8-4B08-9311-29CC7ED92EE6" name="GUID-A11CCA38-7DD8-4B08-9311-29CC7ED92EE6"></a><h4 id="TGSQL-GUID-A11CCA38-7DD8-4B08-9311-29CC7ED92EE6" class="sect4"><span class="enumeration_section">21.1.5</span>数据库操作监控中的基本任务</h4>
                  <div>
                     <p>本节介绍数据库操作监视的基本任务。</p>
                     <p>基本任务如下：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="q">“ <a href="monitoring-database-operations.html#GUID-61D052D2-1F06-4A8C-A9D8-26504AD8A720" title="使用初始化参数启用或禁用监视。">启用和禁用数据库操作监视</a> ”</span></p>
                           <p>此任务说明如何在系统和语句级别启用数据库操作的自动监视。</p>
                        </li>
                        <li>
                           <p><span class="q">“ <a href="monitoring-database-operations.html#GUID-DC573FB7-40C5-4D6D-BE81-EF356900B444" title="定义数据库操作涉及提供名称并指定其开始和结束时间。">定义复合数据库操作</a> ”</span></p>
                           <p>本节介绍如何使用PL / SQL定义数据库操作的开始和结束。</p>
                        </li>
                        <li>
                           <p><span class="q">“ <a href="monitoring-database-operations.html#GUID-4048D00E-2635-42C8-A37D-71EFAC619062" title="默认情况下，AWR会自动以XML格式捕获SQL监视报告。">生成和访问SQL监视器报告</a> ”</span></p>
                           <p>本节介绍如何生成和解释有关数据库操作的报告。</p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-007E5BAE-B07D-4BD1-9485-DE8D260BF862" title="当STATISTICS_LEVEL初始化参数设置为TYPICAL（默认值）或ALL时，默认情况下启用SQL监视功能。">关于监视数据库操作</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL94600"></a><div class="props_rev_3"><a id="GUID-61D052D2-1F06-4A8C-A9D8-26504AD8A720" name="GUID-61D052D2-1F06-4A8C-A9D8-26504AD8A720"></a><h3 id="TGSQL-GUID-61D052D2-1F06-4A8C-A9D8-26504AD8A720" class="sect3"><span class="enumeration_section">21.2</span>启用和禁用数据库操作监视</h3>
               <div>
                  <p>使用初始化参数启用或禁用监视。</p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-9BFBE13A-EAD4-435F-8A8B-F95FB11F3AC7">在系统级启用数据库操作监视</a><br>当<code class="codeph">STATISTICS_LEVEL</code>初始化参数设置为<code class="codeph">TYPICAL</code> （默认值）或<code class="codeph">ALL</code>时，默认情况下启用SQL监视功能。对所有长时间运行的查询自动启动SQL监视。
                     </li>
                     <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-BBE58891-7BEF-4371-ADAE-6B0A88156B8A">在语句级别启用和禁用数据库操作的监视</a><br>当<code class="codeph">CONTROL_MANAGEMENT_PACK_ACCESS</code>初始化参数设置为<code class="codeph">DIAGNOSTIC+TUNING</code> ，您可以使用提示来启用或禁用特定SQL语句的监视。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-C941CE9D-97E1-42F8-91ED-4949B2B710BF" title="本章介绍如何监视SQL和PL / SQL。">监视数据库操作</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL94954"></a><a id="TGSQL94602"></a><a id="TGSQL94601"></a><div class="props_rev_3"><a id="GUID-9BFBE13A-EAD4-435F-8A8B-F95FB11F3AC7" name="GUID-9BFBE13A-EAD4-435F-8A8B-F95FB11F3AC7"></a><h4 id="TGSQL-GUID-9BFBE13A-EAD4-435F-8A8B-F95FB11F3AC7" class="sect4"><span class="enumeration_section">21.2.1</span>在系统级启用数据库操作监视</h4>
                  <div>
                     <p>当<code class="codeph">STATISTICS_LEVEL</code>初始化参数设置为<code class="codeph">TYPICAL</code> （默认值）或<code class="codeph">ALL</code>时，默认情况下启用SQL监视功能。对所有长时间运行的查询自动启动SQL监视。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-9BFBE13A-EAD4-435F-8A8B-F95FB11F3AC7__GUID-B6373CCB-58A2-4CD5-9C70-4FFB95DD88E7">先决条件</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>由于SQL监视是Oracle Database Tuning Pack的一项功能，因此<code class="codeph">CONTROL_MANAGEMENT_PACK_ACCESS</code>初始化参数必须设置为<code class="codeph">DIAGNOSTIC+TUNING</code> （默认值）。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-9BFBE13A-EAD4-435F-8A8B-F95FB11F3AC7__GUID-21932EF1-CD10-4A39-B5E8-E09950506505">假设</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>本教程假设以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">STATISTICS_LEVEL</code>初始化参数设置为<code class="codeph">BASIC</code> 。</p>
                           </li>
                           <li>
                              <p>您希望启用数据库操作的自动监视。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-9BFBE13A-EAD4-435F-8A8B-F95FB11F3AC7__GUID-26D3AFA7-1D1A-4E3C-A2A1-B27983FF039C">要启用对数据库操作的监视：</p>
                        <ol>
                           <li>
                              <p>使用适当的权限将SQL * Plus连接到数据库，然后查询当前的数据库操作设置。</p>
                              <p>例如，运行以下SQL * Plus命令：</p><pre class="pre codeblock"><code>SQL&gt; SHOW PARAMETER statistics_level名称类型值----------------------------------- ------- ---- ----- statistics_level字符串BASIC</code></pre></li>
                           <li>
                              <p>将统计级别设置为<code class="codeph">TYPICAL</code> 。</p>
                              <p>例如，运行以下SQL语句：</p><pre class="pre codeblock"><code>SQL&gt; ALTER SYSTEM SET STATISTICS_LEVEL ='TYPICAL';</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-9BFBE13A-EAD4-435F-8A8B-F95FB11F3AC7__GUID-7C076BE7-16E9-431B-932E-5E146D8896C7">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../refrn/OPTIMIZER_FEATURES_ENABLE.html#REFRN10141" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">STATISTICS_LEVEL</code>和<code class="codeph">CONTROL_MANAGEMENT_PACK_ACCESS</code>初始化参数</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-61D052D2-1F06-4A8C-A9D8-26504AD8A720" title="使用初始化参数启用或禁用监视。">启用和禁用数据库操作监视</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94604"></a><a id="TGSQL94603"></a><div class="props_rev_3"><a id="GUID-BBE58891-7BEF-4371-ADAE-6B0A88156B8A" name="GUID-BBE58891-7BEF-4371-ADAE-6B0A88156B8A"></a><h4 id="TGSQL-GUID-BBE58891-7BEF-4371-ADAE-6B0A88156B8A" class="sect4"><span class="enumeration_section">21.2.2</span>在语句级别启用和禁用数据库操作监视</h4>
                  <div>
                     <p>当<code class="codeph">CONTROL_MANAGEMENT_PACK_ACCESS</code>初始化参数设置为<code class="codeph">DIAGNOSTIC+TUNING</code> ，您可以使用提示来启用或禁用特定SQL语句的监视。
                     </p>
                     <div class="section">
                        <p>当数据库在单次执行中消耗至少5秒的CPU或I / O时间时，它会自动监视SQL语句或PL / SQL子程序。<code class="codeph">MONITOR</code>提示对于强制监视不符合时间标准的语句或子程序很有用。
                        </p>
                        <p>有两个语句级提示可用于强制或阻止数据库监视SQL语句。要强制SQL监视，请使用<code class="codeph">MONITOR</code>提示：</p><pre class="pre codeblock"><code>SELECT / * + MONITOR * / SYSDATE FROM DUAL;</code></pre><p>仅当<code class="codeph">CONTROL_MANAGEMENT_PACK_ACCESS</code>参数设置为<code class="codeph">DIAGNOSTIC+TUNING</code>时，此提示才有效。要防止监视提示的SQL语句，请使用<code class="codeph">NO_MONITOR</code>反向提示。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BBE58891-7BEF-4371-ADAE-6B0A88156B8A__GUID-7F6D5DCC-9AAC-4AF9-840D-ECF17BAD87F3">假设</p>
                        <p>本教程假设以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>数据库监控目前在系统级别启用。</p>
                           </li>
                           <li>
                              <p>您希望禁用语句<code class="codeph">SELECT * FROM sales ORDER BY time_id</code>自动监视。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BBE58891-7BEF-4371-ADAE-6B0A88156B8A__GUID-39B3B05F-69A9-41D9-BD11-B829D351873F">要禁用对SQL语句的数据库操作的监视：</p>
                        <ol>
                           <li>
                              <p>使用<code class="codeph">NO_MONITOR</code>提示执行查询。
                              </p>
                              <p>例如，运行以下语句：</p><pre class="pre codeblock"><code>SQL&gt; SELECT * / * + NO_MONITOR * / FROM sales ORDER BY time_id;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-BBE58891-7BEF-4371-ADAE-6B0A88156B8A__GUID-C701BEE2-D952-4C8F-B133-B98D80CD0A74">
                        <p class="notep1">也可以看看：</p>
                        <p>有关使用<code class="codeph">MONITOR</code>和<code class="codeph">NO_MONITOR</code>提示的信息，请<a href="../sqlrf/Comments.html#SQLRF00219" target="_blank"><span><cite>参见Oracle数据库SQL语言参考</cite></span></a></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-61D052D2-1F06-4A8C-A9D8-26504AD8A720" title="使用初始化参数启用或禁用监视。">启用和禁用数据库操作监视</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL94606"></a><a id="TGSQL94605"></a><div class="props_rev_3"><a id="GUID-DC573FB7-40C5-4D6D-BE81-EF356900B444" name="GUID-DC573FB7-40C5-4D6D-BE81-EF356900B444"></a><h3 id="TGSQL-GUID-DC573FB7-40C5-4D6D-BE81-EF356900B444" class="sect3"><span class="enumeration_section">21.3</span>定义复合数据库操作</h3>
               <div>
                  <p>定义数据库操作涉及提供名称并指定其开始和结束时间。</p>
                  <div class="section">
                     <p>使用<code class="codeph">DBMS_SQL_MONITOR.BEGIN_OPERATION</code>函数启动数据库操作，并使用<code class="codeph">DBMS_SQL_MONITOR.END_OPERATION</code>过程结束它。
                     </p>
                     <p>要在其他会话中开始操作，请指定<code class="codeph">session_id</code>和<code class="codeph">serial_num</code>的组合。<code class="codeph">BEGIN_OPERATION</code>函数返回数据库操作执行ID。如果<code class="codeph">dbop_exec_id</code>为null，则数据库将生成唯一值。
                     </p>
                     <p>数据库操作存在单个命名空间，这意味着名称冲突是可能的。Oracle建议使用以下命名约定： <code class="codeph"><span class="codeinlineitalic">component_name.subcomponent_name.operation name</span></code> 。对于数据库内的操作，Oracle建议使用<code class="codeph">ORA</code>作为组件名称。例如，物化视图刷新可以命名为<code class="codeph">ORA.MV.refresh</code> 。电子商务套件工资单功能可以命名为<code class="codeph">EBIZ.payroll</code> 。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-DC573FB7-40C5-4D6D-BE81-EF356900B444__GUID-038872A5-239F-4666-888C-13C032EF30D3">要在当前会话中创建数据库操作：</p>
                     <ol>
                        <li>
                           <p>在SQL * Plus或SQL Developer中，以具有必要权限的用户身份登录数据库。</p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">DBMS_SQL_MONITOR.BEGIN_OPERATION</code>启动操作。</p>
                           <p>此函数返回数据库操作执行ID。以下示例创建名为<code class="codeph">ORA.sales.agg</code>的操作，并将执行ID存储在SQL * Plus变量中：</p><pre class="pre codeblock"><code>VARIABLE exec_id NUMBER; BEGIN：exec_id：= DBMS_SQL_MONITOR.BEGIN_OPERATION（dbop_name =&gt;'ORA.sales.agg'）;结束; /</code></pre></li>
                        <li>
                           <p>执行要监视的SQL语句或PL / SQL程序。</p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">DBMS_SQL_MONITOR.END_OPERATION</code>结束操作。</p>
                           <p>以下示例结束操作<code class="codeph">ORA.sales.agg</code> ：</p><pre class="pre codeblock"><code>BEGIN DBMS_SQL_MONITOR.END_OPERATION（dbop_name =&gt;'ORA.sales.agg'，dbop_eid =&gt;：exec_id）;结束; /</code></pre></li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-DC573FB7-40C5-4D6D-BE81-EF356900B444__GUID-C76CA02B-67F5-4226-8F98-6A099F8BB010">
                     <p class="titleinexample">例21-1创建数据库操作</p>
                     <p>以下示例说明如何使用<code class="codeph">DBMS_SQL_MONITOR</code>程序包在不同的会话中开始和结束数据库操作。此示例假定以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您是管理员，希望监视用户<code class="codeph">sh</code>启动的会话中的语句。
                           </p>
                        </li>
                        <li>
                           <p>您想要监视<code class="codeph">sh.sales</code>表和<code class="codeph">sh.customers</code>表的查询。
                           </p>
                        </li>
                        <li>
                           <p>您希望将这两个查询作为名为<code class="codeph">sh_count</code>的数据库操作进行监视。
                           </p>
                        </li>
                     </ul>
                     <div class="tblformalwide" id="GUID-DC573FB7-40C5-4D6D-BE81-EF356900B444__GUID-0A87E83A-AE66-49F4-B0B1-193FCA0010DD">
                        <p class="titleintable">表21-3创建数据库操作</p>
                        <table cellpadding="4" cellspacing="0" class="FormalWide" title="创建数据库操作" width="100%" border="1" summary="This 2 column table illustrates how to begin and end a database operation. Column 1 is the SYSTEM session. Column 2 is the SH session. Column 3 describes each session. " frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="20%" id="d105713e3307">系统会话</th>
                                 <th align="left" valign="bottom" width="20%" id="d105713e3309">SH会议</th>
                                 <th align="left" valign="bottom" width="20%" id="d105713e3311">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d105713e3315" headers="d105713e3307 "><pre class="pre codeblock"><code>SQL&gt; CONNECT SYSTEM输入密码：*********已连接。
</code></pre></td>
                                 <td align="left" valign="top" width="20%" headers="d105713e3315 d105713e3309 ">
                                    <p>N / A</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d105713e3315 d105713e3311 ">
                                    <p>启动SQL * Plus并以具有管理员权限的用户身份进行连接。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d105713e3325" headers="d105713e3307 ">
                                    <p>N / A</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d105713e3325 d105713e3309 "><pre class="pre codeblock"><code>SQL&gt; CONNECT sh输入密码：******已连接。
</code></pre></td>
                                 <td align="left" valign="top" width="20%" headers="d105713e3325 d105713e3311 ">
                                    <p>在另一个终端中，启动SQL * Plus并以用户<code class="codeph">sh</code>身份以用户身份进行连接。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d105713e3338" headers="d105713e3307 "><pre class="pre codeblock"><code>SELECT SID，SERIAL＃FROM V $ SESSION WHERE USERNAME ='SH'; SID SERIAL＃---------- ---------- 121 13397</code></pre></td>
                                 <td align="left" valign="top" width="20%" headers="d105713e3338 d105713e3309 ">
                                    <p>N / A</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d105713e3338 d105713e3311 ">
                                    <p>在<code class="codeph">SYSTEM</code>会话中，查询<code class="codeph">sh</code>会话的会话ID和序列号。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d105713e3354" headers="d105713e3307 "><pre class="pre codeblock"><code>VARIABLE eid NUMBER BEGIN：eid：= DBMS_SQL_MONITOR.BEGIN_OPERATION（'sh_count'，null，null，null，'121'，'13397'）;结束; / PRINT eid EID ---------- 2</code></pre></td>
                                 <td align="left" valign="top" width="20%" headers="d105713e3354 d105713e3309 ">
                                    <p>N / A</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d105713e3354 d105713e3311 ">
                                    <p>在<code class="codeph">SYSTEM</code>会话中，开始数据库操作，指定<code class="codeph">sh</code>会话的会话ID和序列号。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d105713e3370" headers="d105713e3307 ">
                                    <p>N / A</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d105713e3370 d105713e3309 "><pre class="pre codeblock"><code>SELECT count（*）FROM sh.sales; COUNT（*）---------- 918843 SELECT COUNT（*）FROM sh.customers; COUNT（*）---------- 55500</code></pre></td>
                                 <td align="left" valign="top" width="20%" headers="d105713e3370 d105713e3311 ">
                                    <p>在<code class="codeph">sh</code>会话中，查询<code class="codeph">sales</code>和<code class="codeph">customers</code>表。这些SQL查询是<code class="codeph">sh_count</code>操作的一部分。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d105713e3392" headers="d105713e3307 "><pre class="pre codeblock"><code>BEGIN DBMS_SQL_MONITOR.END_OPERATION（'sh_count'，：eid）;结束; /</code></pre></td>
                                 <td align="left" valign="top" width="20%" headers="d105713e3392 d105713e3309 ">
                                    <p>N / A</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d105713e3392 d105713e3311 ">
                                    <p>通过指定操作名称和执行ID来结束数据库操作。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d105713e3402" headers="d105713e3307 "><pre class="pre codeblock"><code>COL DBOP_NAME FORMAT a10 COL STATUS FORMAT a10 COL ID FORMAT 999 SELECT DBOP_NAME，DBOP_EXEC_ID AS ID，STATUS，CPU_TIME，BUFFER_GETS FROM V $ SQL_MONITOR WHOP DBOP_NAME NOT NOT NULL ORDER BY DBOP_EXEC_ID; DBOP_NAME ID状态CPU_TIME GETS ----------  -  ---------- -------- ---- sh_count 1 EXECUTING 24997 65</code></pre></td>
                                 <td align="left" valign="top" width="20%" headers="d105713e3402 d105713e3309 ">
                                    <p>N / A</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d105713e3402 d105713e3311 ">
                                    <p>查询<code class="codeph">sh_count</code>数据库操作的元数据。操作的状态为<code class="codeph">EXECUTING</code>因为会话尚未获取新的会话状态。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d105713e3418" headers="d105713e3307 ">
                                    <p>N / A</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d105713e3418 d105713e3309 "><pre class="pre codeblock"><code>SELECT SYSDATE FROM DUAL;</code></pre></td>
                                 <td align="left" valign="top" width="20%" headers="d105713e3418 d105713e3311 ">
                                    <p>要收集更改的会话信息，请执行执行数据库往返的查询。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d105713e3428" headers="d105713e3307 "><pre class="pre codeblock"><code>COL DBOP_NAME FORMAT a10 COL STATUS FORMAT a10 COL ID FORMAT 999 SELECT DBOP_NAME，DBOP_EXEC_ID AS ID，STATUS，CPU_TIME，BUFFER_GETS FROM V $ SQL_MONITOR WHOP DBOP_NAME NOT NOT NULL ORDER BY DBOP_EXEC_ID; DBOP_NAME ID状态CPU_TIME GETS ----------  -  ---------- -------- ---- sh_count 1 DONE 24997 65</code></pre></td>
                                 <td align="left" valign="top" width="20%" headers="d105713e3428 d105713e3309 ">
                                    <p>N / A</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d105713e3428 d105713e3311 ">
                                    <p>现在，操作状态已更新为<code class="codeph">DONE</code> 。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="../arpls/DBMS_SQL_MONITOR.html#ARPLS-GUID-13874A73-369E-42CD-9C43-A12F1B3BDEC6" target="_blank"><span><cite>Oracle数据库PL / SQL包和类型参考</cite></span></a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-C941CE9D-97E1-42F8-91ED-4949B2B710BF" title="本章介绍如何监视SQL和PL / SQL。">监视数据库操作</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="TGSQL94608"></a><a id="TGSQL94607"></a><div class="props_rev_3"><a id="GUID-4048D00E-2635-42C8-A37D-71EFAC619062" name="GUID-4048D00E-2635-42C8-A37D-71EFAC619062"></a><h3 id="TGSQL-GUID-4048D00E-2635-42C8-A37D-71EFAC619062" class="sect3"><span class="enumeration_section">21.4</span>生成和访问SQL监视器报告</h3>
               <div>
                  <p>默认情况下，AWR会自动以XML格式捕获SQL监视报告。</p>
                  <div class="section">
                     <p>报告仅捕获未执行或排队的SQL语句，并且自上次捕获周期以来已完成执行。AWR仅根据已执行的执行时间捕获最昂贵语句的报告。SQL Monitor保留策略由AWR策略控制。您可以使用<code class="codeph">DBMS_WORKLOAD_REPOSITORY.MODIFY_SNAPSHOT_SETTINGS</code>过程更改保留策略。
                     </p>
                     <p>Enterprise Manager云控制（云控制）中的“受监控的SQL执行”页面汇总了受监控语句的活动。您可以使用此页面深入了解并获取有关特定语句的其他详细信息。“受监视的SQL执行详细信息”页面使用来自多个视图的数据，包括以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">GV $ SQL_MONITOR</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">GV $ SQL_PLAN_MONITOR</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">GV $ SQL_MONITOR_SESSTAT</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">GV $ SQL</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">GV $ SQL_PLAN</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">GV $ ACTIVE_SESSION_HISTORY</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">GV $ SESSION_LONGOPS</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">DBA_HIST_REPORTS</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">DBA_HIST_REPORTS_DETAILS</code></p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-4048D00E-2635-42C8-A37D-71EFAC619062__GUID-FB49D556-06E8-4366-B846-6D4078342523">
                        <p class="notep1">注意：</p>
                        <p>从<span>Oracle Database 19c开始</span> ，Oracle数据库包括未记录的<code class="codeph">V$</code>视图，这些视图使<span class="italic">没有</span> <code class="codeph">SELECT_CATALOG_ROLE</code>的数据库用户能够查看会话中执行的简单数据库操作（单个SQL和PL / SQL语句）的计划和统计信息。没有<code class="codeph">SELECT_CATALOG_ROLE</code>用户无法查看其他用户的SQL执行统计信息和详细信息。
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-4048D00E-2635-42C8-A37D-71EFAC619062__GUID-DB68FCBA-FB2B-4C42-BF3E-E7157AA7E83C">假设</p>
                     <p>本教程假设以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>用户<code class="codeph">sh</code>正在执行以下对每个客户进行的销售的长期并行查询：</p><pre class="pre codeblock"><code>SELECT c.cust_id，c.cust_last_name，c.cust_first_name，s.prod_id，p.prod_name，s.time_id FROM sales s，customers c，products p WHERE s.cust_id = c.cust_id AND s.prod_id = p.prod_id ORDER BY c.cust_id，s.time_id;</code></pre></li>
                        <li>
                           <p>您希望确保前面的查询不会消耗过多的资源。在执行语句时，您需要确定有关数据库操作的基本统计信息，例如并行度，数据库总时间和I / O请求数。</p>
                        </li>
                        <li>
                           <p>您使用Cloud Control来监视语句执行。</p>
                           <div class="infoboxnote" id="GUID-4048D00E-2635-42C8-A37D-71EFAC619062__GUID-4FC66F79-AC74-48FD-8C97-79FD7C410096">
                              <p class="notep1">注意：</p>
                              <p>要从命令行生成SQL监视器报告，请在<code class="codeph">DBMS_SQLTUNE</code>包中运行<code class="codeph">REPORT_SQL_MONITOR</code>函数，如以下示例SQL * Plus脚本中所示：</p><pre class="pre codeblock"><code>VARIABLE my_rept CLOB BEGIN：my_rept：= DBMS_SQLTUNE.REPORT_SQL_MONITOR（）;结束; / PRINT：my_rept</code></pre></div>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-4048D00E-2635-42C8-A37D-71EFAC619062__GUID-23017E08-D734-4B8D-929C-C3EAC06AE90E">要监视SQL执行：</p>
                     <ol>
                        <li>
                           <p>访问“受监视的SQL执行”页面，如<span class="q">“ <a href="monitoring-database-operations.html#GUID-061502D7-5546-4AB6-B6D3-62FBF71E8CB7" title="Cloud Control中的“受监视的SQL执行”页面（也称为SQL Monitor）显示SQL执行的详细信息。SQL Monitor是报告数据库操作的推荐接口。">云控制中的受监视的SQL执行页面</a> ”中所述</span> 。
                           </p>
                           <p>在下图中，顶行显示并行查询。</p>
                           <div class="figure" id="GUID-4048D00E-2635-42C8-A37D-71EFAC619062__GUID-118F05FF-1AEA-4492-8212-FF8747B861EB"><img src="img/mon_sql_exec_main.jpg" alt="下面是mon_sql_exec_main.jpg的描述" title="下面是mon_sql_exec_main.jpg的描述" longdesc="img_text/mon_sql_exec_main.html"><br><a href="img_text/mon_sql_exec_main.html">mon_sql_exec_main.jpg插图的描述</a></div>
                           <!-- class="figure" -->
                           <p>在此示例中，查询已执行1.4分钟。</p>
                        </li>
                        <li>
                           <p>单击“SQL ID”列中的值以查看有关该语句的详细信息。</p>
                           <p>将显示“已监视的SQL详细信息”页</p>
                           <div class="figure" id="GUID-4048D00E-2635-42C8-A37D-71EFAC619062__GUID-046EFC89-FAC0-44C0-B07A-CAFF7B5EC0C0"><img src="img/mon_sql_exec_details.gif" alt="mon_sql_exec_details.gif的描述如下" title="mon_sql_exec_details.gif的描述如下" longdesc="img_text/mon_sql_exec_details.html"><br><a href="img_text/mon_sql_exec_details.html">mon_sql_exec_details.gif插图的描述</a></div>
                           <!-- class="figure" -->
                           <p>上述报告显示了与语句执行相关的执行计划和统计信息。例如，“时间轴”列显示执行计划的每个步骤何时处于活动状态。显示相对于语句执行开始和结束的时间。Executions列显示操作执行的次数。</p>
                        </li>
                        <li>
                           <p>在“概述”部分中，单击SQL文本旁边的链接。</p>
                           <p>一条消息显示SQL语句的完整文本。</p>
                           <div class="figure" id="GUID-4048D00E-2635-42C8-A37D-71EFAC619062__GUID-19D6EE8B-B387-49E7-9FF7-7BE8EEE8E517"><img src="img/sql_id_tooltip.gif" alt="下面是sql_id_tooltip.gif的描述" title="下面是sql_id_tooltip.gif的描述" longdesc="img_text/sql_id_tooltip.html"><br><a href="img_text/sql_id_tooltip.html">插图描述sql_id_tooltip.gif</a></div>
                           <!-- class="figure" -->
                        </li>
                        <li>
                           <p>在“时间和等待统计”部分中，在“数据库时间”旁边，将光标移动到条形图上的最大部分。</p>
                           <p>一条消息显示用户I / O占用了超过一半的数据库时间。</p>
                           <div class="figure" id="GUID-4048D00E-2635-42C8-A37D-71EFAC619062__GUID-655F455D-5542-4CE7-9257-9AE2E98D56B7"><img src="img/time_stats.gif" alt="time_stats.gif的描述如下" title="time_stats.gif的描述如下" longdesc="img_text/time_stats.html"><br><a href="img_text/time_stats.html">插图描述time_stats.gif</a></div>
                           <!-- class="figure" -->
                           <p>“数据库时间”测量数据库处理此SQL语句所花费的时间。该值包括CPU和等待时间，例如I / O时间。条形图分为几个颜色编码部分，以突出显示CPU资源，用户I / O资源和其他资源。您可以将光标移动到任何部分以查看总计的百分比值。</p>
                        </li>
                        <li>
                           <p>在“详细信息”部分的“IO请求”列中，将光标移到“I / O请求”栏上以查看总计的百分比值。</p>
                           <p>出现一条消息。</p>
                           <div class="figure" id="GUID-4048D00E-2635-42C8-A37D-71EFAC619062__GUID-81041CAC-A1AC-4A5A-A999-12173E8D95B4"><img src="img/io_requests.gif" alt="io_requests.gif的描述如下" title="io_requests.gif的描述如下" longdesc="img_text/io_requests.html"><br><a href="img_text/io_requests.html">插图说明io_requests.gif</a></div>
                           <!-- class="figure" -->
                           <p>在上图中，IO Requests消息显示受监控SQL发出的读取请求总数。该消息显示读取请求占总I / O请求的80％。</p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-4048D00E-2635-42C8-A37D-71EFAC619062__GUID-9DC5EB17-AA69-419D-A78D-D50B69A7755F">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>Cloud Control联机帮助，用于描述“受监视的SQL执行详细信息”页面上的元素，以及有关报告中所有统计信息的完整说明。</p>
                        </li>
                        <li>
                           <p><a href="../refrn/V-SQL_MONITOR.html#GUID-79E97A84-9C27-4A5E-AC0D-C12CB3E748E6" target="_blank"><span><cite>Oracle数据库参考</cite></span></a> ，了解<code class="codeph">V$SQL_MONITOR</code>以及数据库操作监视的相关视图</p>
                        </li>
                        <li>
                           <p><a href="https://www.youtube.com/watch?v=pEC5GdtzpRs" target="_blank">为什么使用SQL Monitor</a>来显示“受监控的SQL详细信息”报告的有用功能的视频</p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-C941CE9D-97E1-42F8-91ED-4949B2B710BF" title="本章介绍如何监视SQL和PL / SQL。">监视数据库操作</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-75DE088E-4CFA-47D9-8078-F3BE97A255F7" name="GUID-75DE088E-4CFA-47D9-8078-F3BE97A255F7"></a><h3 id="TGSQL-GUID-75DE088E-4CFA-47D9-8078-F3BE97A255F7" class="sect3"><span class="enumeration_section">21.5</span>监控数据库操作：场景</h3>
               <div>
                  <p>在这些方案中，您将报告简单和复合数据库操作。</p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-11748F62-BE24-4511-B77B-F28D5E443A0A">报告简单数据库操作：场景</a><br>在这种情况下，预计查询将在几秒钟内完成，但仍在继续执行。
                     </li>
                     <li class="ulchildlink"><a href="monitoring-database-operations.html#GUID-47840D0F-55E2-433B-8B43-7C9942B91FFD">报告复合数据库操作：场景</a><br>此方案使用<code class="codeph">DBMS_SQL_MONITOR</code>定义数据库操作并生成活动报告。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-C941CE9D-97E1-42F8-91ED-4949B2B710BF" title="本章介绍如何监视SQL和PL / SQL。">监视数据库操作</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-11748F62-BE24-4511-B77B-F28D5E443A0A" name="GUID-11748F62-BE24-4511-B77B-F28D5E443A0A"></a><h4 id="TGSQL-GUID-11748F62-BE24-4511-B77B-F28D5E443A0A" class="sect4"><span class="enumeration_section">21.5.1</span>报告简单数据库操作：场景</h4>
                  <div>
                     <p>在这种情况下，预计查询将在几秒钟内完成，但仍在继续执行。</p>
                     <div class="section">
                        <p>在此示例中，假设您以用户<code class="codeph">sh</code>身份登录到数据库，然后运行以下查询：</p><pre class="pre codeblock"><code>SELECT / * + MONITOR * / s.prod_id，c.cust_last_name FROM sales s，customers c ORDER BY prod_id</code></pre><p>查询未完成。从<span>Oracle Database 19c</span>开始， <code class="codeph">sh</code>等低权限用户可以在其会话中为简单数据库操作（单个SQL和PL / SQL语句）生成SQL Monitor报告。要确定问题的根源，请使用SQL Monitor进行诊断，如下所示：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-11748F62-BE24-4511-B77B-F28D5E443A0A__GUID-6DDCB57F-8103-49E8-A79D-8E72018CA995">
                        <ol>
                           <li>
                              <p>取消查询。</p>
                           </li>
                           <li>
                              <p>通过调用<code class="codeph">DBMS_SQL_MONITOR.REPORT_SQL_MONITOR</code>获取文本报告：</p><pre class="pre codeblock"><code>SET LONG 1000000 VARIABLE my_rept CLOB; BEGIN：my_rept：= DBMS_SQL_MONITOR.REPORT_SQL_MONITOR（report_level =&gt;'ALL'，TYPE =&gt;'text'）;结束; / PRINT：my_rept</code></pre><p>部分样本输出如下所示：</p><pre class="pre codeblock"><code>SQL Text ------------------------------ SELECT / * + MONITOR * / s.prod_id，c.cust_last_name FROM sales s，客户c ORDER BY prod_id全球信息------------------------------状态：DONE（ERROR）实例ID：1会话：SH （42：3617）SQL ID：d9w9dw5v007xp SQL执行ID：16777217执行开始日期：09/18/2018 14:08:13首次刷新时间：09/18/2018 14:08:13上次刷新时间：09/18/2018 14:08:34 MY_REPT -------------------------------------------- ------------------------------------持续时间：21s模块/动作：SQL * Plus /  - 服务： SYS $ USERS计划：sqlplus @ slc16iva（TNS V1-V3）取电话：1全球统计MY_REPT ----------------------------- -------------------------------------------------- -  |时间|时间|等待|电话|获取|要求|字节|要求|字节| ================================================== ============================== | 21 | 11 | 10 | 1 | 204 | 233 | 3MB | 4568 | 909MB | ================================================== ============================== SQL计划监控详细信息（计划哈希值= 2036849021）========= ================================================== ===================== MY_REPT ---------------------------- -------------------------------------------------- -  ================================================ ================================ ================== =============== | Id |操作|名称|行|成本|时间|开始|执行者|行|阅读|阅读|写|写| Mem | Tem p |活动|活动详情| | | | | （Estim）| |活动|有效| | （实际）|要求|字节|要求|字节| （最大）| （马x）| （％）| （#samples）| ================================================== ============================== ==================== ================================================== ========== ================================= MY_REPT ------ -------------------------------------------------- ------------------------ | 0 |选择声明| | | | 19 | +2 | 1 | 0 | | | | | 。| 。| | | | 1 |排序顺序| | 51G | 316M | 20 | +1 | 1 | 0 | | | 4496 | 908MB | 99MB | 909 MB | | | | 2 | MERGE加入笛卡尔| | 51G | 2M | 19 | +2 | 1 | 50M | | | | | 。| 。| | | | 3 |表访问完全|客户| 55500 | 414 | 20 | +2 | 1 | 54 | 3 | 120KB | | | 。| MY_REPT ------------------------------------------------- -------------------------------。| | | | 4 | BUFFER SORT | | 919K | 316M | 19 | +2 | 54 | 50M | | | | | 28MB | 。| | | | 5 | PARTITION RANGE ALL | | 919K | 29 | 1 | +2 | 1 | 919K | | | | | 。| 。| | | | 6 | BITMAP转换为ROWIDS | | 919K | 29 | 1 | +2 | 28 | 919K | | | | | 。| 。| | | | 7 | BITMAP INDEX FAST FULL SCAN | SALES_PROD_BIX | | | MY_REPT ------------------------------------------------- ------------------------------- 1 | +2 | 28 | 1074 | 32 | 512KB | | | 。| 。| | | ================================================== ============================== ==================== ================================================== ========== =================================</code></pre><p>由于格式化，前面的输出很难阅读。您决定创建一个活动的SQL监视器报告，该报告是图形化的。</p>
                           </li>
                           <li>
                              <p>创建包含以下命令的SQL脚本：</p><pre class="pre codeblock"><code>SET FEEDBACK OFF SET TERMOUT OFF SET TRIMSPOOL ON SET TRIM ON SET PAGES 0 SET LINESIZE 1000 SET LONG 1000000 SET LONGCHUNKSIZE 1000000 SPOOL /tmp/long_sql.htm SELECT DBMS_SQL_MONITOR.REPORT_SQL_MONITOR（report_level =&gt;'ALL'，TYPE =&gt;'active'）来自双重; SPOOL OFF</code></pre></li>
                           <li>
                              <p>在SQL * Plus中，运行您在上一步中创建的SQL脚本。</p>
                           </li>
                           <li>
                              <p>在浏览器中打开输出HTML文件，然后查看报告：</p>
                              <div class="figure" id="GUID-11748F62-BE24-4511-B77B-F28D5E443A0A__GUID-B66CDC1B-32A8-49BE-8081-112A4E8A5D63"><img src="img/cartesian.png" alt="下面是cartesian.png的描述" title="下面是cartesian.png的描述" longdesc="img_text/cartesian.html"><br><a href="img_text/cartesian.html">插图说明cartesian.png</a></div>
                              <!-- class="figure" -->
                              <p>性能问题的原因如第2行所示：笛卡尔连接。查询的作者无意中遗漏了<code class="codeph">WHERE</code>子句。该查询在取消之前返回了5000万行，而不是像<code class="codeph">sales</code>和<code class="codeph">customers</code>的内部联接那样返回大约100万行。对两个表中的联接数据进行排序占用了大部分数据库时间（第1行）。
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-75DE088E-4CFA-47D9-8078-F3BE97A255F7" title="在这些方案中，您将报告简单和复合数据库操作。">监控数据库操作：方案</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-47840D0F-55E2-433B-8B43-7C9942B91FFD" name="GUID-47840D0F-55E2-433B-8B43-7C9942B91FFD"></a><h4 id="TGSQL-GUID-47840D0F-55E2-433B-8B43-7C9942B91FFD" class="sect4"><span class="enumeration_section">21.5.2</span>报告复合数据库操作：场景</h4>
                  <div>
                     <p>此方案使用<code class="codeph">DBMS_SQL_MONITOR</code>定义数据库操作并生成活动报告。
                     </p>
                     <div class="section">您的目标是将<code class="codeph">sh</code>模式中的表的四个查询分组到一个操作中，然后生成一个报告。
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-47840D0F-55E2-433B-8B43-7C9942B91FFD__GUID-C8FDF5A9-8194-4B32-8777-5DF0B53237DB">
                        <ol>
                           <li>
                              <p>在SQL * Plus中，以管理用户<code class="codeph">SAM</code>身份登录。开始一个名为<code class="codeph">SHOP</code>的操作（指定<code class="codeph">forced_tracking</code>以确保SQL Monitor跟踪SQL），运行四个查询，然后按如下方式结束操作：</p><pre class="pre codeblock"><code>VARIABLE exec_id NUMBER; BEGIN：exec_id：= DBMS_SQL_MONITOR.BEGIN_OPERATION（dbop_name =&gt;'SHOP'，forced_tracking =&gt;'Y'）;结束; / SELECT COUNT（*）FROM sh.sales; SELECT COUNT（*）FROM sh.customers; SELECT prod_id，cust_id FROM sh.sales WHERE prod_id &lt;26 ORDER BY prod_id; SELECT cust_id，cust_first_name，cust_last_name，cust_city FROM sh.customers WHERE cust_id &lt;30000 ORDER BY cust_id; BEGIN DBMS_SQL_MONITOR.END_OPERATION（dbop_name =&gt;'SHOP'，dbop_eid =&gt;：exec_id）;结束; /</code></pre></li>
                           <li>
                              <p>要获取有关操作的元数据（包括其状态和元数据），请查询<code class="codeph">V$SQL_MONITOR</code> （包括示例输出）：</p><pre class="pre codeblock"><code>COL STATUS FORMAT a10 COL DBOP_NAME FORMAT a10 COL CON_NAME FORMAT a5 SELECT STATUS，SQL_ID，DBOP_NAME，DBOP_EXEC_ID，TO_CHAR（ELAPSED_TIME / 1000000，'000.00'）AS ELA_SEC FROM V $ SQL_MONITOR WHERE DBOP_NAME ='SHOP'; STATUS SQL_ID DBOP_NAME DBOP_EXEC_ID ELA_SEC ---------- ------------- ---------- ------------ ------- DONE SHOP 3 001.34</code></pre></li>
                           <li>
                              <p>要获取有关SQL Monitor报告的元数据，请调用<code class="codeph">DBMS_SQL_MONITOR.REPORT_SQL_MONITOR</code> （包括样本输出）：</p><pre class="pre codeblock"><code>SET LONG 10000000 SET LONGCHUNKSIZE 10000000 SET PAGES 0 SELECT DBMS_SQL_MONITOR.REPORT_SQL_MONITOR（dbop_name =&gt;'SHOP'，type =&gt;'TEXT'，report_level =&gt;'ALL'）AS rpt FROM DUAL; SQL监控报告全局信息------------------------------状态：DONE实例ID：1会话：SAM（87：6406） DBOP名称：SHOP DBOP执行ID：3首次刷新时间：10/03/2017 07:33:32最后刷新时间：10/03/2017 07:34:24持续时间：52s模块/动作：sqlplus @ myhost（TNS V1 -V3）/  - 服务：MYSERVICE程序：sqlplus @ myhost（TNS V1-V3）全球统计数据============================= =========================== |经过了| Cpu | IO |缓冲区|阅读|阅读| |时间|时间|等待|获取|要求|字节| ================================================== ====== | 1.36 | 1.34 | 0.02 | 202 | 583 | 27MB | ================================================== ======</code></pre></li>
                           <li>
                              <p>要生成活动的HTML报告，请将操作的名称传递给<code class="codeph">DBMS_SQL_MONITOR.REPORT_SQL_MONITOR</code> ：</p><pre class="pre codeblock"><code>SET TRIMSPOOL ON SET TRIM ON SET PAGES 0 SET LINESIZE 1000 SET LONG 1000000 SET LONGCHUNKSIZE 1000000 SPOOL /tmp/shop.htm SELECT DBMS_SQL_MONITOR.REPORT_SQL_MONITOR（dbop_name =&gt;'SHOP'，report_level =&gt;'ALL'，TYPE =&gt;'active' ）FROM DUAL; SPOOL OFF</code></pre><p>下图显示了活动报告：</p>
                              <div class="figure" id="GUID-47840D0F-55E2-433B-8B43-7C9942B91FFD__GUID-A5290C34-90AE-40B0-A1E9-EDE266D75896">
                                 <p class="titleinfigure">图21-3 SQL监视器报告</p><img src="img/dbopactive.png" alt="下面是图21-3的描述" title="下面是图21-3的描述" longdesc="img_text/dbopactive.html"><br><a href="img_text/dbopactive.html">“图21-3 SQL监视器报告”的说明</a></div>
                              <!-- class="figure" -->
                           </li>
                        </ol>
                     </div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-47840D0F-55E2-433B-8B43-7C9942B91FFD__GUID-C1F68F29-E6DC-42A8-B933-8D6E48313E5E">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../arpls/DBMS_SQL_MONITOR.html#ARPLS74779" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解有关<code class="codeph">DBMS_SQL_MONITOR</code>更多信息</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="monitoring-database-operations.html#GUID-75DE088E-4CFA-47D9-8078-F3BE97A255F7" title="在这些方案中，您将报告简单和复合数据库操作。">监控数据库操作：方案</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>