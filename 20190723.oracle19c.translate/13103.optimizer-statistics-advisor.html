<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="Optimizer Statistics Advisor analyzes how optimizer statistics are gathered, and then makes recommendations."></meta>
      <meta name="description" content="Optimizer Statistics Advisor analyzes how optimizer statistics are gathered, and then makes recommendations."></meta>
      <title>使用Optimizer Statistics Advisor分析统计信息</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="SQL Tuning Guide"></meta>
      <meta property="og:description" content="Optimizer Statistics Advisor analyzes how optimizer statistics are gathered, and then makes recommendations."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="SQL Tuning Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="sql-tuning-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-31T14:57:08-08:00"></meta>
      <meta name="dcterms.title" content="SQL Tuning Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="2013, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96095-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="transporting-optimizer-statistics.html" title="Previous" type="text/html"></link>
      <link rel="next" href="optimizer-controls.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGSQL"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="transporting-optimizer-statistics.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="optimizer-controls.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL调优指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="optimizer-statistics.html" property="item" typeof="WebPage"><span property="name">优化器统计</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用Optimizer Statistics Advisor分析统计信息</li>
            </ol>
            <a id="GUID-054F4B76-DD57-46EE-98EA-0FF04F49D1B3" name="GUID-054F4B76-DD57-46EE-98EA-0FF04F49D1B3"></a>
            
            <h2 id="TGSQL-GUID-054F4B76-DD57-46EE-98EA-0FF04F49D1B3" class="sect2"><span class="enumeration_chapter">18</span>使用Optimizer Statistics Advisor分析统计信息</h2>
         </header>
         <div class="ind">
            <div>
               <p>Optimizer Statistics Advisor分析如何收集优化程序统计信息，然后提出建议。</p>
               <p>本章包含以下主题：</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-11B3764D-CCA1-415F-88DD-0F6884DF8D89">关于Optimizer Statistics Advisor</a><br>Optimizer Statistics Advisor是内置的诊断软件，可分析统计数据和统计相关任务的质量。
                  </li>
                  <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75">Optimizer Statistics Advisor的基本任务</a><br>本节介绍使用Optimizer Statistics Advisor的基本工作流程。所有过程和函数都在<code class="codeph">DBMS_STATS</code>包中。
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="optimizer-statistics.html#GUID-0A2F3D52-A135-43E1-9CAB-55BFE068A297" title="执行计划的准确性取决于优化程序统计信息的质量。">优化程序统计信息</a></p>
                  </div>
               </div>
            </div>
            
            <div class="sect2"><a id="GUID-11B3764D-CCA1-415F-88DD-0F6884DF8D89" name="GUID-11B3764D-CCA1-415F-88DD-0F6884DF8D89"></a><h3 id="TGSQL-GUID-11B3764D-CCA1-415F-88DD-0F6884DF8D89" class="sect3"><span class="enumeration_section">18.1</span>关于Optimizer Statistics Advisor</h3>
               <div>
                  <p>Optimizer Statistics Advisor是内置的诊断软件，可分析统计数据和统计相关任务的质量。</p>
                  <p>顾问程序任务在维护窗口中自动运行，但您也可以按需运行它。然后，您可以查看顾问报告。如果顾问程序提出建议，那么在某些情况下，您可以运行系统生成的脚本来实现它们。</p>
                  <p>下图提供了Optimizer Statistics Advisor的概念性概述。</p>
                  <div class="figure" id="GUID-11B3764D-CCA1-415F-88DD-0F6884DF8D89__GUID-3307A35E-0220-42B0-8493-93F08A0A408C">
                     <p class="titleinfigure">图18-1 Optimizer Statistics Advisor</p><img src="img/tgsql_vm_093.png" alt="下面是图18-1的描述" title="下面是图18-1的描述" longdesc="img_text/tgsql_vm_093.html"><br><a href="img_text/tgsql_vm_093.html">“图18-1优化程序统计顾问”的说明</a></div>
                  <!-- class="figure" -->
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-B934DB62-F4AE-420C-B7C7-EE7FC3747C09">优化程序统计顾问的目的</a><br>Optimizer Statistics Advisor检查如何收集优化程序统计信息。
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-2802EC39-07D0-4BBE-8E3B-07068A44C5B7">优化程序统计顾问概念</a><br>Optimizer Statistics Advisor使用与自动数据库诊断监视器（ADDM），SQL性能分析器和其他顾问相同的顾问程序框架。
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7">优化程序统计顾问的命令行界面</a><br>使用<code class="codeph">DBMS_STATS</code> PL / SQL包执行Optimizer Statistics Advisor任务。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-054F4B76-DD57-46EE-98EA-0FF04F49D1B3" title="Optimizer Statistics Advisor分析如何收集优化程序统计信息，然后提出建议。">使用Optimizer Statistics Advisor分析统计信息</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-B934DB62-F4AE-420C-B7C7-EE7FC3747C09" name="GUID-B934DB62-F4AE-420C-B7C7-EE7FC3747C09"></a><h4 id="TGSQL-GUID-B934DB62-F4AE-420C-B7C7-EE7FC3747C09" class="sect4"><span class="enumeration_section">18.1.1</span>优化器统计顾问的目的</h4>
                  <div>
                     <p>Optimizer Statistics Advisor检查如何收集优化程序统计信息。</p>
                     <p>顾问程序会自动诊断现有收集统计信息的实践中的问题。该顾问<span class="italic">不</span>收取新的或者另一套优化的统计数据。顾问的输出是结果和建议的报告，它可以帮助您遵循收集统计数据的最佳实践。
                     </p>
                     <p>优化程序统计信息在确定查询的执行计划中起着重要作用。因此，优化程序收集和维护准确和最新的统计信息至关重要。为此，优化器提供了<code class="codeph">DBMS_STATS</code>包，该包从发行版发布到发行版。通常，用户根据特定工作负载开发自己的策略来收集统计信息，然后使用自行开发的脚本来实现这些策略。
                     </p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-F5B8540A-CF7E-464D-8288-25BC5966ACFA">传统的基于脚本的方法存在的问题</a><br>脚本方法的优点是通常会测试和审查脚本。但是，次优遗留脚本的所有者可能不会更改它们，以免导致计划更改。
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-D81A7708-FDA0-45BB-A6E2-103858B047AE">Optimizer Statistics Advisor的优点</a><br>与传统方法相比，基于顾问的方法提供了更好的可扩展性和可维护性。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-11B3764D-CCA1-415F-88DD-0F6884DF8D89" title="Optimizer Statistics Advisor是内置的诊断软件，可分析统计数据和统计相关任务的质量。">关于Optimizer Statistics Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-F5B8540A-CF7E-464D-8288-25BC5966ACFA" name="GUID-F5B8540A-CF7E-464D-8288-25BC5966ACFA"></a><h5 id="TGSQL-GUID-F5B8540A-CF7E-464D-8288-25BC5966ACFA" class="sect5"><span class="enumeration_section">18.1.1.1</span>传统的基于脚本的方法的问题</h5>
                     <div>
                        <p>脚本方法的优点是通常会测试和审查脚本。但是，次优遗留脚本的所有者可能不会更改它们，以免导致计划更改。</p>
                        <p>传统方法存在以下问题：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>旧版脚本可能无法跟上新的最佳实践，这些实践可能会随发行版的不同而变化。</p>
                              <p>通常，后续版本会增加直方图，采样，工作负载监控，并发性以及其他与优化器相关的功能。例如，从<span>Oracle Database 12c开始</span> ，Oracle建议设置<code class="codeph">AUTO_SAMPLE_SIZE</code>而不是百分比。但是，旧脚本通常会指定采样百分比，这可能会导致执行计划不理想。
                              </p>
                           </li>
                           <li>
                              <p>资源浪费在不必要的统计数据收集上。</p>
                              <p>脚本可以在同一个表上每天多次收集统计信息。</p>
                           </li>
                           <li>
                              <p>自动统计信息收集作业无法保证准确和最新的统计信息。</p>
                              <p>例如，有时自动统计信息收集作业未运行，因为初始化参数组合会禁用它，或者作业终止。此外，由于资源限制，或者因为太多对象需要统计信息收集，有时自动作业维护窗口不足。在收集所有统计信息之前停止运行的作业会导致某些对象无统计信息或过时统计信息，从而导致计划不理想。</p>
                           </li>
                           <li>
                              <p>统计信息有时可能会丢失，陈旧或不正确。</p>
                              <p>例如，表与其索引之间或具有主键 - 外键关系的表之间的统计信息可能不一致。或者，统计信息收集作业可能已被意外禁用，或者您可能不知道脚本已失败。</p>
                           </li>
                           <li>
                              <p>缺乏对问题的了解可能是耗时且资源密集的。</p>
                              <p>例如，服务请求可能会寻求解决问题，而不会意识到问题是由次优统计引起的。诊断可能需要花费大量时间通过电子邮件发送有问题的查询脚本，启用跟踪和调查跟踪。</p>
                           </li>
                           <li>
                              <p>推荐的修复可能不可行。</p>
                              <p>性能工程师可能会建议更改维护统计信息的应用程序代在一些组织中，这一要求可能难以或不可能满足。</p>
                           </li>
                        </ul>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-B934DB62-F4AE-420C-B7C7-EE7FC3747C09" title="Optimizer Statistics Advisor检查如何收集优化程序统计信息。">Optimizer Statistics Advisor的用途</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-D81A7708-FDA0-45BB-A6E2-103858B047AE" name="GUID-D81A7708-FDA0-45BB-A6E2-103858B047AE"></a><h5 id="TGSQL-GUID-D81A7708-FDA0-45BB-A6E2-103858B047AE" class="sect5"><span class="enumeration_section">18.1.1.2</span>优化器统计顾问的优点</h5>
                     <div>
                        <p>与传统方法相比，基于顾问的方法提供了更好的可扩展性和可维护性。</p>
                        <p>如果最新实践在新版本中发生更改，则Optimizer Statistics Advisor会在其规则中对这些实践进行编码。通过这种方式，顾问始终提供最新的建议。</p>
                        <p>顾问程序分析您当前如何收集统计信息（使用手动脚本，显式设置参数等），现有统计信息收集作业的有效性以及收集的统计信息的质量。优化程序统计顾问<span class="italic">不</span>收集新的或另一套优化的统计，所以不影响工作量。相反，Optimizer Statistics Advisor会分析存储在数据字典中的信息，然后将结果和建议存储在数据库中。
                        </p>
                        <p>Optimizer Statistics Advisor与传统方法相比具有以下优势：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>提供易于理解的报告</p>
                              <p>顾问应用规则来生成结果，建议和操作。</p>
                           </li>
                           <li>
                              <p>提供脚本以实现必要的修复， <span class="italic">而</span>无需更改应用程序代码</p>
                              <p>实施建议的操作时，每次执行改进的语句都会产生收益。例如，如果您设置全局首选项以使样本大小为<code class="codeph">AUTO_SAMPLE_SIZE</code>而不是次优百分比，那么基于改进统计信息的每个计划都可以从此更改中受益。
                              </p>
                           </li>
                           <li>
                              <p>在维护窗口中每天<code class="codeph">AUTO_STATS_ADVISOR_TASK</code>一次名为<code class="codeph">AUTO_STATS_ADVISOR_TASK</code>的预定义任务</p>
                              <p>要运行自动作业， <code class="codeph">STATISTICS_LEVEL</code>初始化参数必须设置为<code class="codeph">TYPICAL</code>或<code class="codeph">ALL</code> 。</p>
                           </li>
                           <li>
                              <p>在<code class="codeph">DBMS_STATS</code>包中提供API，使您可以手动创建和运行任务，将结果和建议存储在数据字典视图中，生成任务报告，并在必要时实施更正</p>
                           </li>
                           <li>
                              <p>与现有工具集成</p>
                              <p>顾问程序与SQL Tuning Advisor和AWR集成，后者汇总了Optimizer Statistics Advisor结果。</p>
                           </li>
                        </ul>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-B934DB62-F4AE-420C-B7C7-EE7FC3747C09" title="Optimizer Statistics Advisor检查如何收集优化程序统计信息。">Optimizer Statistics Advisor的用途</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
               <div class="sect3"><a id="GUID-2802EC39-07D0-4BBE-8E3B-07068A44C5B7" name="GUID-2802EC39-07D0-4BBE-8E3B-07068A44C5B7"></a><h4 id="TGSQL-GUID-2802EC39-07D0-4BBE-8E3B-07068A44C5B7" class="sect4"><span class="enumeration_section">18.1.2</span>优化器统计顾问概念</h4>
                  <div>
                     <p>Optimizer Statistics Advisor使用与自动数据库诊断监视器（ADDM），SQL性能分析器和其他顾问相同的顾问程序框架。</p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-C1B53649-68FA-42F7-A06F-03D36A3F2B82">Optimizer Statistics Advisor的组件</a><br>Optimizer Statistics Optimizer框架将其元数据存储在数据字典和动态性能视图中。
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-E842A1E1-3F81-4867-A808-F9CD27E066DB">Optimizer Statistics Advisor的操作模式</a><br>Optimizer Statistics Advisor支持自动和手动模式。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-11B3764D-CCA1-415F-88DD-0F6884DF8D89" title="Optimizer Statistics Advisor是内置的诊断软件，可分析统计数据和统计相关任务的质量。">关于Optimizer Statistics Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-C1B53649-68FA-42F7-A06F-03D36A3F2B82" name="GUID-C1B53649-68FA-42F7-A06F-03D36A3F2B82"></a><h5 id="TGSQL-GUID-C1B53649-68FA-42F7-A06F-03D36A3F2B82" class="sect5"><span class="enumeration_section">18.1.2.1</span> Optimizer Statistics Advisor的组件</h5>
                     <div>
                        <p>Optimizer Statistics Optimizer框架将其元数据存储在数据字典和动态性能视图中。</p>
                        <p>以下维恩图显示了Optimizer Statistics Advisor的规则，发现，建议和操作之间的关系。例如，所有发现都来自规则，但并非所有规则都能产生结果。</p>
                        <div class="figure" id="GUID-C1B53649-68FA-42F7-A06F-03D36A3F2B82__GUID-73DED707-37AB-4B4E-B978-A853E625DC89">
                           <p class="titleinfigure">图18-2优化程序统计顾问组件</p><img src="img/tgsql_vm_091.png" alt="下面是图18-2的描述" title="下面是图18-2的描述" longdesc="img_text/tgsql_vm_091.html"><br><a href="img_text/tgsql_vm_091.html">“图18-2优化程序统计顾问组件”的说明</a></div>
                        <!-- class="figure" -->
                        <p>本节包含以下主题：</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-6D8831EA-B478-4641-B84B-C341BB4D0799">优化器统计顾问规则</a><br><span class="bold">Optimizer Statistics Advisor规则</span>是Oracle提供的标准，Optimizer Statistics Advisor通过该标准执行检查。
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-DA78E598-E6C9-4CB4-98CE-756C568AAEFC">Optimizer Statistics Advisor的调查结果</a><br>优化程序统计顾问检查存储在数据库中的证据并得出未遵循规则的结论时的结果。
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-2A7A6CC8-D5FC-428B-B7F6-BE9483EE9212">Optimizer Statistics Advisor的建议</a><br>根据每个发现，Optimizer Statistics Advisor会就如何获得更好的统计数据提出建议。
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-5AD86797-429E-45C5-B075-E4682AC2E41A">优化程序统计顾问的操作</a><br>Optimizer Statistics Advisor操作是实现建议的SQL或PL / SQL脚本。如果可行，建议有相应的行动。顾问程序将操作存储在<code class="codeph">DBA_ADVISOR_ACTIONS</code> 。</li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-2802EC39-07D0-4BBE-8E3B-07068A44C5B7" title="Optimizer Statistics Advisor使用与自动数据库诊断监视器（ADDM），SQL性能分析器和其他顾问相同的顾问程序框架。">Optimizer Statistics Advisor概念</a></p>
                           </div>
                        </div>
                     </div>
                     
                     <div class="sect5"><a id="GUID-6D8831EA-B478-4641-B84B-C341BB4D0799" name="GUID-6D8831EA-B478-4641-B84B-C341BB4D0799"></a><h6 id="TGSQL-GUID-6D8831EA-B478-4641-B84B-C341BB4D0799" class="sect6"><span class="enumeration_section">18.1.2.1.1</span>优化器统计顾问的规则</h6>
                        <div>
                           <p><span class="bold">Optimizer Statistics Advisor规则</span>是Oracle提供的标准，Optimizer Statistics Advisor通过该标准执行检查。
                           </p>
                           <p>这些规则体现了基于当前功能集的Oracle最佳实践。如果最佳实践在发行版之间发生变化，那么Optimizer Statistics Advisor规则也会发生变化。</p>
                           <p>顾问将规则组织到以下类中：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>系统</p>
                                 <p>此类检查统计信息收集的首选项，自动统计信息收集作业的状态，SQL计划指令的使用等。此类中的规则在<code class="codeph">V$STATS_ADVISOR_RULES.RULE_TYPE</code>具有值<code class="codeph">SYSTEM</code> 。</p>
                              </li>
                              <li>
                                 <p>手术</p>
                                 <p>此类检查统计信息收集是否使用默认值，使用<code class="codeph">SET_ <span class="codeinlineitalic">*</span> _STATS</code>过程创建测试统计信息，等等。此类中的规则在<code class="codeph">V$STATS_ADVISOR_RULES.RULE_TYPE</code>的值为<code class="codeph">OPERATION</code> 。</p>
                              </li>
                              <li>
                                 <p>宾语</p>
                                 <p>此类检查统计信息的质量，统计信息的陈旧性，不必要的统计信息收集等。此类中的规则在<code class="codeph">V$STATS_ADVISOR_RULES.RULE_TYPE</code>具有值<code class="codeph">OBJECT</code> 。</p>
                              </li>
                           </ul>
                           <p>规则检查以下问题：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>如何收集统计数据</p>
                                 <p>例如，一个规则可能指定初始化参数的建议设置。另一条规则可能指定应在架构级别收集统计信息。</p>
                              </li>
                              <li>
                                 <p>何时收集统计数据</p>
                                 <p>例如，顾问程序可能会建议应启用自动统计信息收集作业的维护窗口，或者应该扩展窗口。</p>
                              </li>
                              <li>
                                 <p>如何提高统计数据收集的效率</p>
                                 <p>例如，规则可能指定应在<code class="codeph">DBMS_STATS</code>使用默认参数，或者不应手动设置统计信息。
                                 </p>
                              </li>
                           </ul>
                           <p>在<code class="codeph">V$STATS_ADVISOR_RULES</code> ，每个规则都有一个唯一的字符串ID，可在<code class="codeph">DBMS_STATS</code>过程和报告中使用。您可以使用<a href="glossary.html#GUID-AB17E858-B95F-4C39-85D7-1A17241A2204"><span class="xrefglossterm">规则过滤器</span></a>指定Optimizer Statistics Advisor应检查的规则。但是，您无法编写新规则。
                           </p>
                           <div class="example" id="GUID-6D8831EA-B478-4641-B84B-C341BB4D0799__GUID-795C627B-3387-4BD5-A190-2B1BA8DF5E7B">
                              <p class="titleinexample">示例18-1 V $ STATS_ADVISOR_RULES中的列出规则</p>
                              <p>以下带有示例输出的查询列出了<code class="codeph">V$STATS_ADVISOR_RULES</code>规则的子集。规则可能会在不同版本之间发生变化。
                              </p><pre class="pre codeblock"><code>SET LINESIZE 208 SET PAGESIZE 100 COL ID FORMAT 99 COL NAME FORMAT a33 COL DESCRIPTION FORMAT a62 SELECT RULE_ID AS ID，NAME，RULE_TYPE，DESCRIPTION from V $ STATS_ADVISOR_RULES RULE_ID在1和12之间按RULE_ID排序; ID NAME RULE_TYPE DESCRIPTION  -  ------------------------------- --------- ---- -------------------------------------------------- -  1 UseAutoJob SYSTEM使用自动作业进行统计收集2 CompleteAutoJob系统自动统计收集作业应该成功完成3 MaintainStatsHistory SYSTEM维护统计历史4 UseConcurrent SYSTEM使用Concurrent首选项进行统计收集5 UseDefaultPreference SYSTEM使用默认首选项进行统计收集6 TurnOnSQLPlanDirective SYSTEM SQL计划指令不应禁用7 AvoidSetProcedures操作避免设置统计过程8 UseDefaultParams操作使用统计信息收集过程中的默认参数。 9 UseGatherSchemaStats操作使用gather_schema_stats过程10 AvoidInefficientStatsOprSeq操作避免低效的统计操作序列11 AvoidUnnecessaryStatsCollection OBJECT避免不必要的统计信息收集12 AvoidStaleStats OBJECT避免使用陈旧或无统计信息的对象选择12行。
</code></pre></div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-6D8831EA-B478-4641-B84B-C341BB4D0799__GUID-96037AE8-F724-4819-9772-E9C433D14026">
                              <p class="notep1">也可以看看：</p>
                              <p>有关<code class="codeph">V$STATS_ADVISOR_RULES</code>更多信息，请<code class="codeph">V$STATS_ADVISOR_RULES</code> <a href="../refrn/V-STATS_ADVISOR_RULES.html#REFRN-GUID-C19D0FE4-3D40-45E3-B695-F5862CBF42C4" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-C1B53649-68FA-42F7-A06F-03D36A3F2B82" title="Optimizer Statistics Optimizer框架将其元数据存储在数据字典和动态性能视图中。">Optimizer Statistics Advisor的组件</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-DA78E598-E6C9-4CB4-98CE-756C568AAEFC" name="GUID-DA78E598-E6C9-4CB4-98CE-756C568AAEFC"></a><h6 id="TGSQL-GUID-DA78E598-E6C9-4CB4-98CE-756C568AAEFC" class="sect6"><span class="enumeration_section">18.1.2.1.2</span>优化器统计顾问的结果</h6>
                        <div>
                           <p>优化程序统计顾问检查存储在数据库中的证据并得出未遵循规则的结论时的结果。</p>
                           <p>要生成结果，Optimizer Statistics Advisor会执行一项任务，该任务会自动或手动调用。此任务分析存储在数据字典中的统计信息历史记录，统计信息操作日志以及<code class="codeph">SYSAUX</code>中存在的当前统计信息足迹。例如，顾问程序查询<code class="codeph">DBA_TAB_STATISTICS</code>和<code class="codeph">DBA_IND_STATISTICS</code>以确定统计信息是否过时，或者行数之间是否存在差异。
                           </p>
                           <p>通常，优化程序统计顾问会在未遵循或违反特定规则时生成查找结果，但某些结果（如对象陈旧性）仅提供信息。例如，一个发现可能显示<code class="codeph">DBMS_STATS.GATHER_TABLE_STATS</code>使用了<code class="codeph">ESTIMATE_PERCENT=&gt;0.01</code> ，这违反了<code class="codeph">ESTIMATE_PERCENT=&gt;AUTO_SAMPLE_SIZE</code>规则。
                           </p>
                           <p>一个发现恰好对应一条规则。但是，规则可以产生许多发现。</p>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-DA78E598-E6C9-4CB4-98CE-756C568AAEFC__GUID-B2F54798-6AF1-4D2D-B090-2B944214AE71">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-01FAB8ED-E4A3-4C3E-8FE2-88717DCDDA06" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以了解有关<code class="codeph">DBMS_STATS</code>更多信息</p>
                                 </li>
                                 <li>
                                    <p><a href="../refrn/ALL_TAB_STATISTICS.html#REFRN-GUID-C567F729-3748-4DFE-A22C-115CB7575D63" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解有关<code class="codeph">ALL_TAB_STATISTICS</code>更多信息</p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-C1B53649-68FA-42F7-A06F-03D36A3F2B82" title="Optimizer Statistics Optimizer框架将其元数据存储在数据字典和动态性能视图中。">Optimizer Statistics Advisor的组件</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-2A7A6CC8-D5FC-428B-B7F6-BE9483EE9212" name="GUID-2A7A6CC8-D5FC-428B-B7F6-BE9483EE9212"></a><h6 id="TGSQL-GUID-2A7A6CC8-D5FC-428B-B7F6-BE9483EE9212" class="sect6"><span class="enumeration_section">18.1.2.1.3</span>优化器统计顾问的建议</h6>
                        <div>
                           <p>根据每个发现，Optimizer Statistics Advisor会就如何获得更好的统计数据提出建议。</p>
                           <p>例如，顾问程序可能会在收集统计信息时发现违反不使用抽样的规则，并建议改为指定<code class="codeph">AUTO_SAMPLE_SIZE</code> 。顾问将建议存储在<code class="codeph">DBA_ADVISOR_RECOMMENDATIONS</code> 。</p>
                           <p>单个发现可能存在多个建议。在这种情况下，您必须进行调查以确定要遵循的建议。每个建议都包含一个或多个基本原理，用于解释Optimizer Statistics Advisor为何提出建议。在某些情况下，调查结果可能不会产生建议。</p>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-2A7A6CC8-D5FC-428B-B7F6-BE9483EE9212__GUID-EDE77F14-6A65-4222-B9EA-25E7256C441C">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-88E321BF-445E-40BD-83A2-9EA107689B2F" title="在优化器统计的上下文中，抽样是从表行的随机子集中收集统计信息。通过使数据库能够避免全表扫描和整个表的排序，抽样可以最大限度地减少收集统计信息所需的资源。">设置</a></span>样本量的指南<span class="q">”</span>以了解样本量的指南</p>
                                 </li>
                                 <li>
                                    <p><a href="../refrn/DBA_ADVISOR_RECOMMENDATIONS.html#REFRN-GUID-A6E04D5A-5F3E-4DB7-AD7C-AB109439A80A" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">DBA_ADVISOR_RECOMMENDATIONS</code></p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-C1B53649-68FA-42F7-A06F-03D36A3F2B82" title="Optimizer Statistics Optimizer框架将其元数据存储在数据字典和动态性能视图中。">Optimizer Statistics Advisor的组件</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-5AD86797-429E-45C5-B075-E4682AC2E41A" name="GUID-5AD86797-429E-45C5-B075-E4682AC2E41A"></a><h6 id="TGSQL-GUID-5AD86797-429E-45C5-B075-E4682AC2E41A" class="sect6"><span class="enumeration_section">18.1.2.1.4</span>优化器统计顾问的操作</h6>
                        <div>
                           <p>Optimizer Statistics Advisor操作是实现建议的SQL或PL / SQL脚本。如果可行，建议有相应的行动。顾问程序将操作存储在<code class="codeph">DBA_ADVISOR_ACTIONS</code> 。</p>
                           <p>例如，Optimizer Statistics Advisor执行执行以下步骤的任务：</p>
                           <ol>
                              <li>
                                 <p>检查规则</p>
                                 <p>顾问程序检查是否符合应避免过时统计的规则。</p>
                              </li>
                              <li>
                                 <p>产生发现</p>
                                 <p>顾问发现许多对象没有统计信息。</p>
                              </li>
                              <li>
                                 <p>生成推荐</p>
                                 <p>顾问建议收集没有统计信息的对象的统计信息。</p>
                              </li>
                              <li>
                                 <p>产生行动</p>
                                 <p>顾问程序生成执行<code class="codeph">DBMS_STATS.GATHER_DATABASE_STATS</code>的PL / SQL脚本，提供需要收集统计信息的对象列表。
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-5AD86797-429E-45C5-B075-E4682AC2E41A__GUID-EDE77F14-6A65-4222-B9EA-25E7256C441C">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><span class="q">“ <a href="options-for-optimizer-statistics-gathering.html#GUID-E616363F-0A7B-4D4D-9384-63934DB69F7D" title="preference_overrides_parameter统计信息首选项确定在收集优化程序统计信息时是否使用统计信息首选项覆盖参数的输入值。通过这种方式，您可以控制数据库何时遵循传递给统计信息收集过程的参数值。">统计首选项覆盖</a> ”</span>以了解如何覆盖统计信息收集首选项</p>
                                 </li>
                                 <li>
                                    <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-88E321BF-445E-40BD-83A2-9EA107689B2F" title="在优化器统计的上下文中，抽样是从表行的随机子集中收集统计信息。通过使数据库能够避免全表扫描和整个表的排序，抽样可以最大限度地减少收集统计信息所需的资源。">设置样本大小的指南</a> ”</span>以了解有关<code class="codeph">AUTO_SAMPLE_SIZE</code>更多信息</p>
                                 </li>
                                 <li>
                                    <p><a href="../refrn/DBA_ADVISOR_ACTIONS.html#REFRN-GUID-1D63E30C-4B9B-44A6-B03A-8D983906CB3F" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">DBA_ADVISOR_ACTIONS</code></p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-C1B53649-68FA-42F7-A06F-03D36A3F2B82" title="Optimizer Statistics Optimizer框架将其元数据存储在数据字典和动态性能视图中。">Optimizer Statistics Advisor的组件</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-E842A1E1-3F81-4867-A808-F9CD27E066DB" name="GUID-E842A1E1-3F81-4867-A808-F9CD27E066DB"></a><h5 id="TGSQL-GUID-E842A1E1-3F81-4867-A808-F9CD27E066DB" class="sect5"><span class="enumeration_section">18.1.2.2</span>优化器统计顾问的操作模式</h5>
                     <div>
                        <p>Optimizer Statistics Advisor支持自动和手动模式。</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>自动化</p>
                              <p>预定义任务<code class="codeph">AUTO_STATS_ADVISOR_TASK</code>每天在维护窗口中自动运行一次。该任务作为自动优化器统计信息收集客户端的一部分运行。自动化任务会生成结果和建议，但不会自动实施操作。
                              </p>
                              <p>对于任何其他任务，您可以配置自动化任务，并生成报告。如果报告建议操作，则可以手动实施操作。</p>
                           </li>
                           <li>
                              <p>手册</p>
                              <p>您可以使用<code class="codeph">DBMS_STATS.CREATE_ADVISOR_TASK</code>函数创建自己的任务，然后使用<code class="codeph">EXECUTE_ADVISOR_TASK</code>过程随时运行它。
                              </p>
                              <p>与自动化任务不同，手动任务可以自动执行操作。或者，您可以将任务配置为生成PL / SQL脚本，然后可以手动运行该脚本。</p>
                           </li>
                        </ul>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-E842A1E1-3F81-4867-A808-F9CD27E066DB__GUID-862BCFA7-307E-49CE-9544-D8E6EC866E61">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="Oracle数据库可以自动收集优化器统计信息。">配置自动优化程序统计信息收集</a> ”</span></p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_STATS.html#GUID-FD355A10-E6FA-47A3-9228-A269905A156D" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以了解有关<code class="codeph">DBMS_STATS.CREATE_ADVISOR_TASK</code>更多信息</p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-2802EC39-07D0-4BBE-8E3B-07068A44C5B7" title="Optimizer Statistics Advisor使用与自动数据库诊断监视器（ADDM），SQL性能分析器和其他顾问相同的顾问程序框架。">Optimizer Statistics Advisor概念</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
               <div class="sect3"><a id="GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7" name="GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7"></a><h4 id="TGSQL-GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7" class="sect4"><span class="enumeration_section">18.1.3</span>优化器统计顾问的命令行界面</h4>
                  <div>
                     <p>使用<code class="codeph">DBMS_STATS</code> PL / SQL包执行Optimizer Statistics Advisor任务。
                     </p>
                     <div class="tblformal" id="GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7__SQLTUNINGADVISORPACKAGES-B5EBD3F6">
                        <p class="titleintable">表18-1用于创建和删除任务的DBMS_STATS API</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="用于创建和删除任务的DBMS_STATS API" width="100%" border="1" summary="This 2 column table shows procedures that create and delete tasks. Column 1 is the procedure. Column 2 describes that procedure. " frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="34%" id="d91513e2070">PL / SQL过程或函数</th>
                                 <th align="left" valign="bottom" width="66%" id="d91513e2073">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="34%" id="d91513e2078" headers="d91513e2070 ">
                                    <p><code class="codeph">CREATE_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="66%" headers="d91513e2078 d91513e2073 ">
                                    <p>为Optimizer Statistics Advisor创建顾问程序任务。如果已指定任务名称，则顾问程序使用指定的任务名称;否则，顾问程序会自动生成新的任务名称。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="34%" id="d91513e2086" headers="d91513e2070 ">
                                    <p><code class="codeph">DROP_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="66%" headers="d91513e2086 d91513e2073 ">
                                    <p>删除Optimizer Statistics Advisor任务及其所有结果数据。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="tblformal" id="GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7__TASKEXECUTION-B5F7FCF5">
                        <p class="titleintable">表18-2用于任务执行的DBMS_STATS API</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="用于任务执行的DBMS_STATS API" width="100%" border="1" summary="This 2 column table shows procedures that execute, interrupt, cancel, reset, and resume tasks. Column 1 is the procedure. Column 2 describes that procedure. " frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="34%" id="d91513e2103">PL / SQL过程或函数</th>
                                 <th align="left" valign="bottom" width="66%" id="d91513e2106">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="34%" id="d91513e2111" headers="d91513e2103 ">
                                    <p><code class="codeph">EXECUTE_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="66%" headers="d91513e2111 d91513e2106 ">
                                    <p>执行以前创建的Optimizer Statistics Advisor任务。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="34%" id="d91513e2119" headers="d91513e2103 ">
                                    <p><code class="codeph">INTERRUPT_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="66%" headers="d91513e2119 d91513e2106 ">
                                    <p>中断当前正在执行的Optimizer Statistics Advisor任务。该任务在正常退出时结束其操作，使您能够访问中间结果。您可以稍后恢复该任务。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="34%" id="d91513e2127" headers="d91513e2103 ">
                                    <p><code class="codeph">CANCEL_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="66%" headers="d91513e2127 d91513e2106 ">
                                    <p>取消Optimizer Statistics Advisor任务执行，并删除当前执行的所有中间结果。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="34%" id="d91513e2135" headers="d91513e2103 ">
                                    <p><code class="codeph">RESET_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="66%" headers="d91513e2135 d91513e2106 ">
                                    <p>将Optimizer Statistics Advisor任务执行重置为其初始状态。在当前未执行的任务上调用此过程。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="34%" id="d91513e2143" headers="d91513e2103 ">
                                    <p><code class="codeph">RESUME_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="66%" headers="d91513e2143 d91513e2106 ">
                                    <p>恢复最近中断的Optimizer Statistics Advisor任务执行。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="tblformal" id="GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7__GUID-0A877762-99C0-4115-B918-F04B2C2D13E6">
                        <p class="titleintable">表18-3 Advisor报告的DBMS_STATS API</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="Advisor报告的DBMS_STATS API" width="100%" border="1" summary="This 2 column table shows procedures that report the results of a task, and get advisor recommendations. Column 1 is the procedure. Column 2 describes that procedure. " frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="40%" id="d91513e2160">PL / SQL过程或函数</th>
                                 <th align="left" valign="bottom" width="60%" id="d91513e2163">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="40%" id="d91513e2168" headers="d91513e2160 ">
                                    <p><code class="codeph">REPORT_STATS_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d91513e2168 d91513e2163 ">
                                    <p>报告Optimizer Statistics Advisor任务的结果。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="40%" id="d91513e2176" headers="d91513e2160 ">
                                    <p><code class="codeph">GET_ADVISOR_RECS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d91513e2176 d91513e2163 ">
                                    <p>生成关于给定项目的推荐报告。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="tblformal" id="GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7__GUID-E3167CD3-10BB-4152-A20E-DCFB33498234">
                        <p class="titleintable">表18-4任务和筛选器配置的DBMS_STATS API</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="用于任务和过滤器配置的DBMS_STATS API" width="100%" border="1" summary="This 2 column table shows procedures that configure tasks and filters. Column 1 is the procedure. Column 2 describes that procedure. " frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="45%" id="d91513e2193">PL / SQL过程或函数</th>
                                 <th align="left" valign="bottom" width="55%" id="d91513e2196">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="45%" id="d91513e2201" headers="d91513e2193 ">
                                    <p><code class="codeph">CONFIGURE_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="55%" headers="d91513e2201 d91513e2196 ">
                                    <p>配置Optimizer Statistics Advisor列表，以执行顾问任务的执行，报告，脚本生成和实施。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="45%" id="d91513e2209" headers="d91513e2193 ">
                                    <p><code class="codeph">GET_ADVISOR_OPR_FILTER</code></p>
                                 </td>
                                 <td align="left" valign="top" width="55%" headers="d91513e2209 d91513e2196 ">
                                    <p>为统计操作创建操作筛选器。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="45%" id="d91513e2217" headers="d91513e2193 ">
                                    <p><code class="codeph">CONFIGURE_ADVISOR_RULE_FILTER</code></p>
                                 </td>
                                 <td align="left" valign="top" width="55%" headers="d91513e2217 d91513e2196 ">
                                    <p>配置Optimizer Statistics Advisor任务的规则过滤器。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="45%" id="d91513e2225" headers="d91513e2193 ">
                                    <p><code class="codeph">CONFIGURE_ADVISOR_OPR_FILTER</code></p>
                                 </td>
                                 <td align="left" valign="top" width="55%" headers="d91513e2225 d91513e2196 ">
                                    <p>配置Optimizer Statistics Advisor任务的操作筛选器。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="45%" id="d91513e2233" headers="d91513e2193 ">
                                    <p><code class="codeph">CONFIGURE_ADVISOR_OBJ_FILTER</code></p>
                                 </td>
                                 <td align="left" valign="top" width="55%" headers="d91513e2233 d91513e2196 ">
                                    <p>为Optimizer Statistics Advisor任务配置对象过滤器。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="45%" id="d91513e2241" headers="d91513e2193 ">
                                    <p><code class="codeph">SET_ADVISOR_TASK_PARAMETER</code></p>
                                 </td>
                                 <td align="left" valign="top" width="55%" headers="d91513e2241 d91513e2196 ">
                                    <p>更新Optimizer Statistics Advisor任务参数的值。有效参数是<code class="codeph">TIME_LIMIT</code>和<code class="codeph">OP_START_TIME</code> 。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="tblformal" id="GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7__GUID-047AD569-7B0A-4299-8213-CC0742FA540A">
                        <p class="titleintable">表18-5用于实施建议操作的DBMS_STATS API</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="用于实施建议操作的DBMS_STATS API" width="100%" border="1" summary="This 2 column table shows procedures that obtain scripts that implement actions, or implement the actions directly. Column 1 is the procedure. Column 2 describes that procedure. " frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="34%" id="d91513e2264">PL / SQL过程或函数</th>
                                 <th align="left" valign="bottom" width="66%" id="d91513e2267">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="34%" id="d91513e2272" headers="d91513e2264 ">
                                    <p><code class="codeph">SCRIPT_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="66%" headers="d91513e2272 d91513e2267 ">
                                    <p>获取实现顾问程序发现的问题的建议操作的脚本。您可以检查此脚本，然后选择要执行的操作。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="34%" id="d91513e2280" headers="d91513e2264 ">
                                    <p><code class="codeph">IMPLEMENT_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="66%" headers="d91513e2280 d91513e2267 ">
                                    <p>根据指定Optimizer Statistics Advisor执行的结果实现顾问程序建议的操作。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="section"></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7__GUID-ECE7DB02-0C9F-4837-8022-F848CD8DD4DD">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../arpls/DBMS_SPM.html#ARPLS150" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_STATS</code>包</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-11B3764D-CCA1-415F-88DD-0F6884DF8D89" title="Optimizer Statistics Advisor是内置的诊断软件，可分析统计数据和统计相关任务的质量。">关于Optimizer Statistics Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="sect2"><a id="GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75" name="GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75"></a><h3 id="TGSQL-GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75" class="sect3"><span class="enumeration_section">18.2</span> Optimizer Statistics Advisor的基本任务</h3>
               <div>
                  <p>本节介绍使用Optimizer Statistics Advisor的基本工作流程。所有过程和函数都在<code class="codeph">DBMS_STATS</code>包中。
                  </p>
                  <p>下图显示了工作流程中的自动和手动路径。如果<code class="codeph">AUTO_STATS_ADVISOR_TASK</code>在维护窗口中自动运行，则您的工作流程将首先查询报告。在手动工作流程中，您必须使用PL / SQL来创建和执行任务。
                  </p>
                  <div class="figure" id="GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75__GUID-929C9F11-33BE-4BAB-B90A-52C91DA3B729">
                     <p class="titleinfigure">图18-3 Optimizer Statistics Advisor的基本任务</p><img src="img/tgsql_vm_092.png" alt="下面是图18-3的描述" title="下面是图18-3的描述" longdesc="img_text/tgsql_vm_092.html"><br><a href="img_text/tgsql_vm_092.html">“图18-3 Optimizer Statistics Advisor的基本任务”的说明</a></div>
                  <!-- class="figure" -->
                  <p>通常，您按照下表中显示的顺序执行Optimizer Statistics Advisor步骤。</p>
                  <div class="tblformal" id="GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75__GUID-E20F0255-F1D4-4AB5-A1EF-82847F6BDDDF">
                     <p class="titleintable">表18-6 Optimizer Statistics Advisor工作流程</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="优化程序统计顾问工作流程" border="1" summary="This table describes the workflow for Optimizer Statistics Advisor" frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="20%" id="d91513e2441">步</th>
                              <th align="left" valign="bottom" width="20%" id="d91513e2443">描述</th>
                              <th align="left" valign="bottom" width="20%" id="d91513e2445">了解更多</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d91513e2449" headers="d91513e2441 ">1</td>
                              <td align="left" valign="top" width="20%" headers="d91513e2449 d91513e2443 ">
                                 <p>使用<code class="codeph">DBMS_STATS.CREATE_ADVISOR_TASK</code>创建Optimizer Advisor任务（仅限手动工作流）。
                                 </p>
                              </td>
                              <td align="left" valign="top" width="20%" headers="d91513e2449 d91513e2445 ">
                                 <p><span class="q">“ <a href="optimizer-statistics-advisor.html#GUID-BEA60A82-C473-493C-A033-05145DBF10CA" title="DBMS_STATS.CREATE_ADVISOR_TASK函数为Optimizer Statistics Advisor创建任务。如果未指定任务名称，则Optimizer Statistics Advisor会自动生成一个任务名称。">创建优化程序统计顾问任务</a> ”</span></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d91513e2469" headers="d91513e2441 ">2</td>
                              <td align="left" valign="top" width="20%" headers="d91513e2469 d91513e2443 ">
                                 <p>（可选）通过查询<code class="codeph">DBA_ADVISOR_EXECUTIONS</code>列出顾问任务的执行。</p>
                              </td>
                              <td align="left" valign="top" width="20%" headers="d91513e2469 d91513e2445 ">
                                 <p><span class="q">“ <a href="optimizer-statistics-advisor.html#GUID-B6BC40C4-66CB-4E33-A2EB-5F40C2A48509" title="DBA_ADVISOR_EXECUTIONS视图列出了Optimizer Statistics Advisor任务的执行情况。">列出优化程序统计顾问任务</a> ”</span></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d91513e2489" headers="d91513e2441 ">3</td>
                              <td align="left" valign="top" width="20%" headers="d91513e2489 d91513e2443 ">
                                 <p>（可选）使用<code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_ <span class="codeinlineitalic">*</span> _FILTER</code>过程为任务配置过滤器。
                                 </p>
                              </td>
                              <td align="left" valign="top" width="20%" headers="d91513e2489 d91513e2445 ">
                                 <p><span class="q">“ <a href="optimizer-statistics-advisor.html#GUID-A709D991-5550-404C-AC05-57308047388D" title="过滤器使您可以在Optimizer Statistics Advisor任务中包含或排除对象，规则和操作。">为优化工具顾问任务创建过滤器</a> ”</span></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d91513e2509" headers="d91513e2441 ">4</td>
                              <td align="left" valign="top" width="20%" headers="d91513e2509 d91513e2443 ">
                                 <p>使用<code class="codeph">DBMS_STATS.EXECUTE_ADVISOR_TASK</code>执行顾问程序任务（仅限手动工作流程）。
                                 </p>
                              </td>
                              <td align="left" valign="top" width="20%" headers="d91513e2509 d91513e2445 ">
                                 <p><span class="q">“ <a href="optimizer-statistics-advisor.html#GUID-2E00F47C-B108-4345-9225-0F0CC9902249" title="DBMS_STATS.EXECUTE_ADVISOR_TASK函数为Optimizer Statistics Advisor执行任务。如果未指定执行名称，则Optimizer Statistics Advisor会自动生成一个名称。">执行优化程序统计顾问任务</a> ”</span></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d91513e2529" headers="d91513e2441 ">五</td>
                              <td align="left" valign="top" width="20%" headers="d91513e2529 d91513e2443 ">
                                 <p>生成顾问报告。</p>
                              </td>
                              <td align="left" valign="top" width="20%" headers="d91513e2529 d91513e2445 ">
                                 <p><span class="q">“ <a href="optimizer-statistics-advisor.html#GUID-A391E0BA-4159-4311-B05F-9E4F409CF3ED" title="DBMS_STATS.REPORT_ADVISOR_TASK函数为Optimizer Statistics Advisor任务生成报告。">为优化程序统计顾问任务生成报告</a> ”</span></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d91513e2546" headers="d91513e2441 ">6</td>
                              <td align="left" valign="top" width="20%" headers="d91513e2546 d91513e2443 ">
                                 <p>以下列方式之一实施建议：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>使用<code class="codeph">DBMS_STATS.IMPLEMENT_ADVISOR_TASK</code>自动实施所有建议。</p>
                                    </li>
                                    <li>
                                       <p>生成使用<code class="codeph">DBMS_STATS.SCRIPT_ADVISOR_TASK</code>实现建议的PL / SQL脚本，编辑此脚本，然后手动运行它。
                                       </p>
                                    </li>
                                 </ul>
                              </td>
                              <td align="left" valign="top" width="20%" headers="d91513e2546 d91513e2445 ">
                                 <p><span class="q">“ <a href="optimizer-statistics-advisor.html#GUID-9C219CD5-A781-4AC0-AEC8-974EE8F5DEA9" title="DBMS_STATS.IMPLEMENT_ADVISOR_TASK函数实现指定Optimizer Statistics Advisor任务的建议。如果未指定执行名称，则Optimizer Statistics Advisor将使用最新的执行。">实施Optimizer Statistics Advisor推荐的操作</a> ”</span>和<span class="q">“ <a href="optimizer-statistics-advisor.html#GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65" title="DBMS_STATS.SCRIPT_ADVISOR_TASK函数生成可编辑脚本，其中包含针对指定Optimizer Statistics Advisor任务的建议。">使用Optimizer Statistics Advisor生成脚本</a> ”</span></p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <div class="example" id="GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75__GUID-BCF21734-8BA1-4936-93F7-51FBF2A55215">
                     <p class="titleinexample">示例18-2手动工作流程中Optimizer Statistics Advisor的基本脚本</p>
                     <p>此脚本说明了基本的Optimizer Statistics Advisor会话。它创建任务，执行任务，生成报告，然后实施建议。</p><pre class="pre codeblock"><code>DECLARE v_tname VARCHAR2（128）：='my_task'; v_ename VARCHAR2（128）：= NULL; v_report CLOB：= null; v_script CLOB：= null; v_implementation_result CLOB; BEGIN  - 创建任务v_tname：= DBMS_STATS.CREATE_ADVISOR_TASK（v_tname）; - 执行任务v_ename：= DBMS_STATS.EXECUTE_ADVISOR_TASK（v_tname）; - 查看任务报告v_report：= DBMS_STATS.REPORT_ADVISOR_TASK（v_tname）; DBMS_OUTPUT.PUT_LINE（v_report）; - 实现所有建议v_implementation_result：= DBMS_STATS.IMPLEMENT_ADVISOR_TASK（v_tname）;结束;</code></pre><p>本节包含以下主题：</p>
                  </div>
                  <!-- class="example" -->
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-BEA60A82-C473-493C-A033-05145DBF10CA">创建优化程序统计顾问任务</a><br><code class="codeph">DBMS_STATS.CREATE_ADVISOR_TASK</code>函数为Optimizer Statistics Advisor创建任务。如果未指定任务名称，则Optimizer Statistics Advisor会自动生成一个任务名称。
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-B6BC40C4-66CB-4E33-A2EB-5F40C2A48509">列出优化程序统计顾问任务</a><br><code class="codeph">DBA_ADVISOR_EXECUTIONS</code>视图列出了Optimizer Statistics Advisor任务的执行情况。
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-A709D991-5550-404C-AC05-57308047388D">为Optimizer Advisor创建过滤器任务</a><br>过滤器使您可以在Optimizer Statistics Advisor任务中包含或排除对象，规则和操作。
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-2E00F47C-B108-4345-9225-0F0CC9902249">执行优化程序统计顾问任务</a><br><code class="codeph">DBMS_STATS.EXECUTE_ADVISOR_TASK</code>函数为Optimizer Statistics Advisor执行任务。如果未指定执行名称，则Optimizer Statistics Advisor会自动生成一个名称。
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-A391E0BA-4159-4311-B05F-9E4F409CF3ED">为优化程序统计顾问任务生成报告</a><br><code class="codeph">DBMS_STATS.REPORT_ADVISOR_TASK</code>函数为Optimizer Statistics Advisor任务生成报告。
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-10D99B9A-9FDB-4265-A2D1-043D7165D216">实施优化程序统计顾问建议</a><br>您可以实现自动使用的所有建议<code class="codeph">DBMS_STATS.IMPLEMENT_ADVISOR_TASK</code> ，或使用生成可编辑的脚本<code class="codeph">DBMS_STATS.SCRIPT_ADVISOR_TASK</code> 。</li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75__GUID-5FF22C31-8359-4DA4-B2D0-5BE5BD63C8FE">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="../arpls/DBMS_SPM.html#ARPLS150" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_STATS</code>包</p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-054F4B76-DD57-46EE-98EA-0FF04F49D1B3" title="Optimizer Statistics Advisor分析如何收集优化程序统计信息，然后提出建议。">使用Optimizer Statistics Advisor分析统计信息</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-BEA60A82-C473-493C-A033-05145DBF10CA" name="GUID-BEA60A82-C473-493C-A033-05145DBF10CA"></a><h4 id="TGSQL-GUID-BEA60A82-C473-493C-A033-05145DBF10CA" class="sect4"><span class="enumeration_section">18.2.1</span>创建优化程序统计顾问任务</h4>
                  <div>
                     <p><code class="codeph">DBMS_STATS.CREATE_ADVISOR_TASK</code>函数为Optimizer Statistics Advisor创建任务。如果未指定任务名称，则Optimizer Statistics Advisor会自动生成一个任务名称。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-BEA60A82-C473-493C-A033-05145DBF10CA__GUID-9ED127C6-BBE2-419A-8F6D-AC780322C07E">先决条件</p>
                        <p>要执行此子程序，您必须具有<code class="codeph">ADVISOR</code>权限。
                        </p>
                        <div class="infoboxnote" id="GUID-BEA60A82-C473-493C-A033-05145DBF10CA__GUID-7188C95F-00F0-4B43-AC4B-456BA7023728">
                           <p class="notep1">注意：</p>
                           <p>该子程序使用调用者的权限执行。</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BEA60A82-C473-493C-A033-05145DBF10CA__GUID-EC694F36-69D2-4619-AA21-F1D596EA9F2F">要创建Optimizer Statistics Advisor任务：</p>
                        <ol>
                           <li>
                              <p>在SQL * Plus中，以具有必要权限的用户身份登录数据库。</p>
                           </li>
                           <li>
                              <p>以下面的形式执行<code class="codeph">DBMS_STATS.CREATE_ADVISOR_TASK</code>函数，其中<code class="codeph"><span class="codeinlineitalic">tname</span></code>是任务的名称， <span class="italic"><code class="codeph">ret</code></span>是包含返回输出的变量：</p><pre class="pre codeblock"><code>EXECUTE <span class="italic">ret</span> ：= DBMS_STATS.CREATE_ADVISOR_TASK（' <span class="italic">tname</span> '）;</code></pre><p>例如，要创建任务<code class="codeph">opt_adv_task1</code> ，请使用以下代码：</p><pre class="pre codeblock"><code>DECLARE v_tname VARCHAR2（32767）; v_ret VARCHAR2（32767）; BEGIN v_tname：='opt_adv_task1'; v_ret：= DBMS_STATS.CREATE_ADVISOR_TASK（v_tname）;结束; /</code></pre></li>
                           <li>
                              <p>（可选）查询<code class="codeph">USER_ADVISOR_TASKS</code> ：</p><pre class="pre codeblock"><code>SELECT TASK_NAME，ADVISOR_NAME，已创建，状态来自USER_ADVISOR_TASKS;</code></pre><p>示例输出显示如下：</p><pre class="pre codeblock"><code>TASK_NAME ADVISOR_NAME创建状态--------------- -------------------- ---------  - --------- OPT_ADV_TASK1统计顾问05-SEP-16 INITIAL</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-BEA60A82-C473-493C-A033-05145DBF10CA__ORACLEDATABASEPLSQLPACKAGESANDTYPES-41F8FA6B">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-B930CE9B-7461-4691-8AA9-7E424C3C2C8C" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以了解有关<code class="codeph">CREATE_ADVISOR_TASK</code>更多信息</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75" title="本节介绍使用Optimizer Statistics Advisor的基本工作流程。所有过程和函数都在DBMS_STATS包中。">Optimizer Statistics Advisor的基本任务</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-B6BC40C4-66CB-4E33-A2EB-5F40C2A48509" name="GUID-B6BC40C4-66CB-4E33-A2EB-5F40C2A48509"></a><h4 id="TGSQL-GUID-B6BC40C4-66CB-4E33-A2EB-5F40C2A48509" class="sect4"><span class="enumeration_section">18.2.2</span>列出优化程序统计顾问任务</h4>
                  <div>
                     <p><code class="codeph">DBA_ADVISOR_EXECUTIONS</code>视图列出了Optimizer Statistics Advisor任务的执行情况。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-B6BC40C4-66CB-4E33-A2EB-5F40C2A48509__GUID-196DDBDB-A467-4B68-8E9C-DD0A1B49CE27">列出Optimizer Statistics Advisor任务：</p>
                        <ol>
                           <li>
                              <p>在SQL * Plus中，以具有管理员权限的用户身份登录数据库。</p>
                           </li>
                           <li>
                              <p>查询<code class="codeph">DBA_ADVISOR_EXECUTIONS</code>如下：</p><pre class="pre codeblock"><code>COL EXECUTION_NAME FORMAT a14 SELECT EXECUTION_NAME，EXECUTION_END，状态来自DBA_ADVISOR_EXECUTIONS，其中TASK_NAME ='AUTO_STATS_ADVISOR_TASK'ORDER BY 2;</code></pre><p>以下示例输出显示了8个执行：</p><pre class="pre codeblock"><code>EXECUTION_NAME执行状态-------------- --------- ----------- EXEC_1 27-AUG-16已完成EXEC_17 28-AUG-16已完成EXEC_42 29-AUG-16已完成EXEC_67 30-AUG-16已完成EXEC_92 01-SEP-16已完成EXEC_117 02-SEP-16已完成EXEC_142 03-SEP-16已完成EXEC_167 04-SEP-16已完成选择8行。
</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-B6BC40C4-66CB-4E33-A2EB-5F40C2A48509__ORACLEDATABASEREFERENCETOLEARNMOREA-4209B6D8">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<code class="codeph">DBA_ADVISOR_EXECUTIONS</code>更多信息，请<code class="codeph">DBA_ADVISOR_EXECUTIONS</code> <a href="../refrn/DBA_ADVISOR_EXECUTIONS.html#GUID-7DFD27C0-C995-4C6F-A56E-706C90DE74D7" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75" title="本节介绍使用Optimizer Statistics Advisor的基本工作流程。所有过程和函数都在DBMS_STATS包中。">Optimizer Statistics Advisor的基本任务</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-A709D991-5550-404C-AC05-57308047388D" name="GUID-A709D991-5550-404C-AC05-57308047388D"></a><h4 id="TGSQL-GUID-A709D991-5550-404C-AC05-57308047388D" class="sect4"><span class="enumeration_section">18.2.3</span>为Optimizer Advisor创建过滤器任务</h4>
                  <div>
                     <p>过滤器使您可以在Optimizer Statistics Advisor任务中包含或排除对象，规则和操作。</p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-21F2295B-5DDE-42B6-9F5A-996C19EDF45B">关于Optimizer Statistics Advisor的过滤器</a><br>过滤器是使用<code class="codeph">DBMS_STATS</code>将Optimizer Statistics Advisor任务限制为用户指定的规则，模式或操作集。
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-9A1E79AC-2AF3-4BCD-A623-E86A3E1F0FFF">为Optimizer Advisor任务创建对象过滤器</a><br><code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_OBJ_FILTER</code>函数为指定的Optimizer Statistics Advisor任务创建规则筛选器。该函数返回一个CLOB，其中包含过滤器的更新值。
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E">为Optimizer Advisor任务创建规则筛选器</a><br><code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_RULE_FILTER</code>函数为指定的Optimizer Statistics Advisor任务创建规则过滤器。该函数返回一个CLOB，其中包含过滤器的更新值。
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-429AE714-6FBF-4D93-A77E-A89C84F08923">为Optimizer Advisor任务创建操作筛选器</a><br><code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_OPR_FILTER</code>函数为指定的Optimizer Statistics Advisor任务创建操作筛选器。该函数返回一个CLOB，其中包含过滤器的更新值。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75" title="本节介绍使用Optimizer Statistics Advisor的基本工作流程。所有过程和函数都在DBMS_STATS包中。">Optimizer Statistics Advisor的基本任务</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-21F2295B-5DDE-42B6-9F5A-996C19EDF45B" name="GUID-21F2295B-5DDE-42B6-9F5A-996C19EDF45B"></a><h5 id="TGSQL-GUID-21F2295B-5DDE-42B6-9F5A-996C19EDF45B" class="sect5"><span class="enumeration_section">18.2.3.1</span>关于Optimizer Statistics Advisor的过滤器</h5>
                     <div>
                        <p>过滤器是使用<code class="codeph">DBMS_STATS</code>将Optimizer Statistics Advisor任务限制为用户指定的规则，模式或操作集。
                        </p>
                        <p>过滤器可用于包含或排除特定结果集。例如，您可以将顾问程序任务配置为仅包含对<code class="codeph">sh</code>架构的建议。此外，您可以排除所有违反规则的过时统计信息。过滤器的主要优点是能够忽略您不感兴趣的建议，并减少顾问任务的开销。
                        </p>
                        <p>创建过滤器的最简单方法是单独或组合使用以下<code class="codeph">DBMS_STATS</code>过程：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">CONFIGURE_ADVISOR_OBJ_FILTER</code></p>
                              <p>使用此过程包括或排除指定的数据库模式或对象。对象过滤器接受所有者名称和对象名称，并支持通配符（ <code class="codeph">%</code> ）。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">CONFIGURE_ADVISOR_RULE_FILTER</code></p>
                              <p>使用此过程包括或排除指定的规则。通过查询<code class="codeph">V$STATS_ADVISOR_RULES</code>获取规则名称。</p>
                           </li>
                           <li>
                              <p><code class="codeph">CONFIGURE_ADVISOR_OPR_FILTER</code></p>
                              <p>使用此过程包括或排除指定的<code class="codeph">DBMS_STATS</code>操作。通过查询<code class="codeph">DBA_OPTSTAT_OPERATIONS</code>获取操作的ID和名称。</p>
                           </li>
                        </ul>
                        <p>对于前面的函数，您可以指定过滤器应用的操作类型： <code class="codeph">EXECUTE</code> ， <code class="codeph">REPORT</code> ， <code class="codeph">SCRIPT</code>和<code class="codeph">IMPLEMENT</code> 。您还可以组合类型，如<code class="codeph">EXECUTE + REPORT</code> 。 Null表示过滤器适用于所有类型的顾问程序操作。
                        </p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-21F2295B-5DDE-42B6-9F5A-996C19EDF45B__GUID-FDBB458D-4B2C-467F-89B8-39D7BC64BA87">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">V$STATS_ADVISOR_RULES</code>更多信息，请<code class="codeph">V$STATS_ADVISOR_RULES</code> <a href="../refrn/V-STATS_ADVISOR_RULES.html#REFRN-GUID-C19D0FE4-3D40-45E3-B695-F5862CBF42C4" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-01FAB8ED-E4A3-4C3E-8FE2-88717DCDDA06" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以了解有关<code class="codeph">DBMS_STATS</code>更多信息</p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-A709D991-5550-404C-AC05-57308047388D" title="过滤器使您可以在Optimizer Statistics Advisor任务中包含或排除对象，规则和操作。">为Optimizer Advisor任务创建过滤器</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-9A1E79AC-2AF3-4BCD-A623-E86A3E1F0FFF" name="GUID-9A1E79AC-2AF3-4BCD-A623-E86A3E1F0FFF"></a><h5 id="TGSQL-GUID-9A1E79AC-2AF3-4BCD-A623-E86A3E1F0FFF" class="sect5"><span class="enumeration_section">18.2.3.2</span>为Optimizer Advisor创建对象过滤器任务</h5>
                     <div>
                        <p><code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_OBJ_FILTER</code>函数为指定的Optimizer Statistics Advisor任务创建规则筛选器。该函数返回一个CLOB，其中包含过滤器的更新值。
                        </p>
                        <div class="section">
                           <p>您可以使用以下任一基本策略：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>包括所有对象的发现（默认情况下，考虑所有对象），然后排除指定对象的发现。</p>
                              </li>
                              <li>
                                 <p>排除所有对象的发现，然后仅包括指定对象的发现。</p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-9A1E79AC-2AF3-4BCD-A623-E86A3E1F0FFF__GUID-6FB2D0EE-03BB-4B05-8009-35401B438DA2">先决条件</p>
                           <p>要使用<code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_OBJ_FILTER</code>函数，您必须满足以下先决条件：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>要执行此子程序，您必须具有<code class="codeph">ADVISOR</code>权限。
                                 </p>
                              </li>
                              <li>
                                 <p>您必须是该任务的所有者。</p>
                              </li>
                           </ul>
                           <div class="infoboxnote" id="GUID-9A1E79AC-2AF3-4BCD-A623-E86A3E1F0FFF__GUID-4BAA7789-E60D-4F80-9CE8-8CEB3E202095">
                              <p class="notep1">注意：</p>
                              <p>该子程序使用调用者的权限执行。</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-9A1E79AC-2AF3-4BCD-A623-E86A3E1F0FFF__GUID-4CEDEF04-43AA-424D-A73C-9150F3E1DE7A">要创建对象过滤器：</p>
                           <ol>
                              <li>
                                 <p>在SQL * Plus或SQL Developer中，以具有必要权限的用户身份登录数据库。</p>
                              </li>
                              <li>
                                 <p>使用<code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_OBJ_FILTER</code>函数排除或包含指定任务的对象。
                                 </p>
                                 <p>以下面的形式调用函数，其中占位符定义如下：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><span class="italic"><code class="codeph">report</code></span>是包含返回的XML的CLOB变量。</p>
                                    </li>
                                    <li>
                                       <p><code class="codeph"><span class="codeinlineitalic">tname</span></code>是任务的名称。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">opr_type</code></span>是要执行的操作类型。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">rule</code></span>是<span class="italic"><code class="codeph">rule</code></span>的名称。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">owner</code></span>是对象的架构。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">table</code></span>是<span class="italic"><code class="codeph">table</code></span>的名称。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">action</code></span>是<span class="italic"><code class="codeph">action</code></span>的名称： <code class="codeph">ENABLE</code> ， <code class="codeph">DISABLE</code> ， <code class="codeph">DELETE</code>或<code class="codeph">SHOW</code> 。</p>
                                    </li>
                                 </ul><pre class="pre codeblock"><code>BEGIN <span class="italic">报告</span> ：= DBMS_STATS.CONFIGURE_ADVISOR_OBJ_FILTER（task_name =&gt;' <span class="italic">tname</span> '，stats_adv_opr_type =&gt;' <span class="italic">opr_type</span> '，rule_name =&gt;' <span class="italic">rule</span> '，ownname =&gt;' <span class="italic">owner</span> '，tabname =&gt;' <span class="italic">table</span> '，action =&gt;' <span class="italic">action</span> '） ;结束;</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-9A1E79AC-2AF3-4BCD-A623-E86A3E1F0FFF__GUID-20C50C09-6049-4DCE-9E4E-3309C792A7C2">
                           <p class="titleinexample">示例18-3仅包含单个模式中的对象</p>
                           <p>在此示例中，对于名为<code class="codeph">opt_adv_task1</code>的任务，您的目标是禁用除<code class="codeph">sh</code>架构中的所有对象的建议。用户帐户<code class="codeph">sh</code>已被授予<code class="codeph">ADVISOR</code>和<code class="codeph">READ ANY TABLE</code>权限。您执行以下步骤：</p>
                           <ol>
                              <li>
                                 <p>以<code class="codeph">sh</code>登录数据库。
                                 </p>
                              </li>
                              <li>
                                 <p>删除任何名为<code class="codeph">opt_adv_task1</code>现有任务。
                                 </p><pre class="pre codeblock"><code>DECLARE v_tname VARCHAR2（32767）; BEGIN v_tname：='opt_adv_task1'; DBMS_STATS.DROP_ADVISOR_TASK（v_tname）;结束; /</code></pre></li>
                              <li>
                                 <p>创建一个名为<code class="codeph">sh_obj_filter</code>的过程，该过程将指定的任务限制为<code class="codeph">sh</code>模式中的对象。
                                 </p><pre class="pre codeblock"><code>创建或替换过程sh_obj_filter（p_tname IN VARCHAR2）是v_retc CLOB; BEGIN  - 过滤掉不在sh模式中的所有对象v_retc：= DBMS_STATS.CONFIGURE_ADVISOR_OBJ_FILTER（task_name =&gt; p_tname，stats_adv_opr_type =&gt;'EXECUTE'，rule_name =&gt; NULL，ownname =&gt; NULL，tabname =&gt; NULL，action = &gt;'禁用'）; v_retc：= DBMS_STATS.CONFIGURE_ADVISOR_OBJ_FILTER（task_name =&gt; p_tname，stats_adv_opr_type =&gt;'EXECUTE'，rule_name =&gt; NULL，ownname =&gt;'SH'，tabname =&gt; NULL，action =&gt;'ENABLE'）;结束; /显示错误</code></pre></li>
                              <li>
                                 <p>创建名为<code class="codeph">opt_adv_task1</code>的任务，然后为此任务执行<code class="codeph">sh_obj_filter</code>过程。
                                 </p><pre class="pre codeblock"><code>DECLARE v_tname VARCHAR2（32767）; v_ret VARCHAR2（32767）; BEGIN v_tname：='opt_adv_task1'; v_ret：= DBMS_STATS.CREATE_ADVISOR_TASK（v_tname）; sh_obj_filter（v_tname）;结束; /</code></pre></li>
                              <li>
                                 <p>执行任务<code class="codeph">opt_adv_task1</code> 。
                                 </p><pre class="pre codeblock"><code>DECLARE v_tname VARCHAR2（32767）; v_ret VARCHAR2（32767）; begin v_tname：='opt_adv_task1'; v_ret：= DBMS_STATS.EXECUTE_ADVISOR_TASK（v_tname）;结束; /</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-9A1E79AC-2AF3-4BCD-A623-E86A3E1F0FFF__GUID-FDBB458D-4B2C-467F-89B8-39D7BC64BA87">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-01FAB8ED-E4A3-4C3E-8FE2-88717DCDDA06" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以了解有关<code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_OBJ_FILTER</code>更多信息</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-A709D991-5550-404C-AC05-57308047388D" title="过滤器使您可以在Optimizer Statistics Advisor任务中包含或排除对象，规则和操作。">为Optimizer Advisor任务创建过滤器</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E" name="GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E"></a><h5 id="TGSQL-GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E" class="sect5"><span class="enumeration_section">18.2.3.3</span>为Optimizer Advisor任务创建规则过滤器</h5>
                     <div>
                        <p><code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_RULE_FILTER</code>函数为指定的Optimizer Statistics Advisor任务创建规则过滤器。该函数返回一个CLOB，其中包含过滤器的更新值。
                        </p>
                        <div class="section">
                           <p>您可以使用以下任一基本策略：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>启用所有规则（默认情况下，启用所有规则），然后禁用指定的规则。</p>
                              </li>
                              <li>
                                 <p>禁用所有规则，然后仅启用指定的规则。</p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E__GUID-2792788F-AF64-4276-94B2-62F4887ECDAE">先决条件</p>
                           <p>要使用<code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_RULE_FILTER</code>函数，您必须满足以下先决条件：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>要执行此子程序，您必须具有<code class="codeph">ADVISOR</code>权限。
                                 </p>
                              </li>
                              <li>
                                 <p>您必须是该任务的所有者。</p>
                              </li>
                           </ul>
                           <div class="infoboxnote" id="GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E__GUID-CB7F2B99-FC03-4932-ABD9-DAB171495B97">
                              <p class="notep1">注意：</p>
                              <p>该子程序使用调用者的权限执行。</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E__GUID-DB7DECAB-6935-48CD-A10F-6607C1AF6F5A">要创建规则过滤器：</p>
                           <ol>
                              <li>
                                 <p>在SQL * Plus或SQL Developer中，以具有必要权限的用户身份登录数据库。</p>
                              </li>
                              <li>
                                 <p>通过查询<code class="codeph">V$STATS_ADVISOR_RULES</code>获取顾问程序规则的名称。</p>
                                 <p>例如，查询视图如下（包括部分示例输出）：</p><pre class="pre codeblock"><code>SET LINESIZE 200 SET PAGESIZE 100 COL ID FORMAT 99 COL NAME FORMAT a27 COL DESCRIPTION FORMAT a54选择RULE_ID作为ID，NAME，RULE_TYPE，描述来自V $ STATS_ADVISOR_RULES ORDER BY RULE_ID; ID NAME RULE_TYPE说明 -  --------------------------- --------- -------- ----------------------------------------------- 1 UseAutoJob SYSTEM使用自动作业进行统计收集2 CompleteAutoJob系统自动统计收集作业应该成功完成3 MaintainStatsHistory SYSTEM维护统计历史4 UseConcurrent SYSTEM使用Concurrent首选项进行统计收集...</code></pre></li>
                              <li>
                                 <p>使用<code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_RULE_FILTER</code>函数排除或包含指定任务的规则。
                                 </p>
                                 <p>以下面的形式调用函数，其中占位符定义如下：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><code class="codeph"><span class="codeinlineitalic">tname</span></code>是任务的名称。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">report</code></span>是包含返回的XML的CLOB变量。</p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">opr_type</code></span>是要执行的操作类型。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">rule</code></span>是<span class="italic"><code class="codeph">rule</code></span>的名称。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">action</code></span>是<span class="italic"><code class="codeph">action</code></span>的名称： <code class="codeph">ENABLE</code> ， <code class="codeph">DISABLE</code> ， <code class="codeph">DELETE</code>或<code class="codeph">SHOW</code> 。</p>
                                    </li>
                                 </ul><pre class="pre codeblock"><code>BEGIN <span class="italic">报告</span> ：= DBMS_STATS.DBMS_STATS.CONFIGURE_ADVISOR_RULE_FILTER（task_name =&gt;' <span class="italic">tname</span> '，stats_adv_opr_type =&gt;' <span class="italic">opr_type</span> '，rule_name =&gt;' <span class="italic">rule</span> '，action =&gt;' <span class="italic">action</span> '）;结束;</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E__GUID-32078B98-C6BE-4931-8A6C-6B1FC3F4BF87">
                           <p class="titleinexample">示例18-4排除过时统计规则</p>
                           <p>在此示例中，您知道统计信息已过时，因为自动统计信息作业未运行。您希望为名为<code class="codeph">opt_adv_task1</code>的任务生成报告，但不希望使用有关陈旧统计信息的建议来<code class="codeph">opt_adv_task1</code>报告。
                           </p>
                           <ol>
                              <li>
                                 <p>您查询<code class="codeph">V$STATS_ADVISOR_RULES</code>以获取处理过时统计信息的规则（包括样本输出）：</p><pre class="pre codeblock"><code>COL NAME FORMAT a15 SELECT RULE_ID AS ID，NAME，RULE_TYPE，DESCRIPTION from V $ STATS_ADVISOR_RULES WHERE DESCRIPTION LIKE'％tale％'ORDER BY RULE_ID; ID NAME RULE_TYPE DESCRIPTION --- --------------- --------- ------------------- ---------------------- 12 AvoidStaleStats OBJECT避免使用过时或无统计信息的对象</code></pre></li>
                              <li>
                                 <p>您使用<code class="codeph">CONFIGURE_ADVISOR_RULE_FILTER</code>配置过滤器，指定任务执行应排除规则<code class="codeph">AvoidStaleStats</code> ，但遵守所有其他规则：</p><pre class="pre codeblock"><code>VARIABLE b_ret CLOB BEGIN：b_ret：= DBMS_STATS.CONFIGURE_ADVISOR_RULE_FILTER（task_name =&gt;'opt_adv_task1'，stats_adv_opr_type =&gt;'EXECUTE'，rule_name =&gt;'AvoidStaleStats'，action =&gt;'DISABLE'）;结束; /</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E__GUID-53C27C18-4F80-4FA9-A362-9CC5A3AA3AC9">
                           <p class="titleinexample">示例18-5仅包括避免过时统计的规则</p>
                           <p>此示例与前面示例相反。您希望为名为<code class="codeph">opt_adv_task1</code>的任务生成报告，但希望<span class="italic">仅</span>查看有关陈旧统计信息的建议。
                           </p>
                           <ol>
                              <li>
                                 <p>查询<code class="codeph">V$STATS_ADVISOR_RULES</code>以了解处理陈旧统计数据的规则（包括样本输出）：</p><pre class="pre codeblock"><code>COL NAME FORMAT a15 SELECT RULE_ID AS ID，NAME，RULE_TYPE，DESCRIPTION from V $ STATS_ADVISOR_RULES WHERE DESCRIPTION LIKE'％tale％'ORDER BY RULE_ID; ID NAME RULE_TYPE DESCRIPTION --- --------------- --------- ------------------- ---------------------- 12 AvoidStaleStats OBJECT避免使用过时或无统计信息的对象</code></pre></li>
                              <li>
                                 <p>使用<code class="codeph">CONFIGURE_ADVISOR_RULE_FILTER</code>配置过滤器，指定任务执行应<span class="italic">排除</span>所有规则：</p><pre class="pre codeblock"><code>VARIABLE b_ret CLOB BEGIN：b_ret：= DBMS_STATS.CONFIGURE_ADVISOR_RULE_FILTER（task_name =&gt;'opt_adv_task1'，stats_adv_opr_type =&gt;'EXECUTE'，rule_name =&gt; null，action =&gt;'DISABLE'）;结束; /</code></pre></li>
                              <li>
                                 <p>配置仅启用<code class="codeph">AvoidStaleStats</code>规则的过滤器：</p><pre class="pre codeblock"><code>BEGIN：b_ret：= DBMS_STATS.CONFIGURE_ADVISOR_RULE_FILTER（task_name =&gt;'opt_adv_task1'，stats_adv_opr_type =&gt;'EXECUTE'，rule_name =&gt;'AvoidStaleStats'，action =&gt;'ENABLE'）;结束; /</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E__GUID-7EDC44AF-9062-4A15-AA22-5E47D12E878B">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">V$STATS_ADVISOR_RULES</code>更多信息，请<code class="codeph">V$STATS_ADVISOR_RULES</code> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN-GUID-C19D0FE4-3D40-45E3-B695-F5862CBF42C4" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-B930CE9B-7461-4691-8AA9-7E424C3C2C8C" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解有关<code class="codeph">CONFIGURE_ADVISOR_RULE_FILTER</code>更多信息</p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-A709D991-5550-404C-AC05-57308047388D" title="过滤器使您可以在Optimizer Statistics Advisor任务中包含或排除对象，规则和操作。">为Optimizer Advisor任务创建过滤器</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-429AE714-6FBF-4D93-A77E-A89C84F08923" name="GUID-429AE714-6FBF-4D93-A77E-A89C84F08923"></a><h5 id="TGSQL-GUID-429AE714-6FBF-4D93-A77E-A89C84F08923" class="sect5"><span class="enumeration_section">18.2.3.4</span>为Optimizer Advisor创建操作过滤器任务</h5>
                     <div>
                        <p><code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_OPR_FILTER</code>函数为指定的Optimizer Statistics Advisor任务创建操作筛选器。该函数返回一个CLOB，其中包含过滤器的更新值。
                        </p>
                        <div class="section">
                           <p>您可以使用以下任一基本策略：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>禁用所有操作，然后仅启用指定的操作。</p>
                              </li>
                              <li>
                                 <p>启用所有操作（默认情况下，启用所有操作），然后禁用指定的操作。</p>
                              </li>
                           </ul>
                           <p><code class="codeph">DBA_OPTSTAT_OPERATIONS</code>视图包含统计信息相关操作的ID。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-429AE714-6FBF-4D93-A77E-A89C84F08923__GUID-88848D61-4454-4A25-9E69-2B62C3B32357">先决条件</p>
                           <p>要使用<code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_OPR_FILTER</code>函数，您必须满足以下先决条件：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>要执行此子程序，您必须具有<code class="codeph">ADVISOR</code>权限。
                                 </p>
                                 <div class="infoboxnote" id="GUID-429AE714-6FBF-4D93-A77E-A89C84F08923__GUID-5DF5B3A6-3097-4C4D-B9B1-B2107B6A6920">
                                    <p class="notep1">注意：</p>
                                    <p>该子程序使用调用者的权限执行。</p>
                                 </div>
                              </li>
                              <li>
                                 <p>您必须是该任务的所有者。</p>
                              </li>
                              <li>
                                 <p>要查询<code class="codeph">DBA_OPTSTAT_OPERATIONS</code>视图，您必须具有<code class="codeph">SELECT ANY TABLE</code>特权。
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-429AE714-6FBF-4D93-A77E-A89C84F08923__GUID-9FA52FC9-B9A8-4F73-A16D-9068C9F1E4FB">要创建操作过滤器：</p>
                           <ol>
                              <li>
                                 <p>在SQL * Plus或SQL Developer中，以具有必要权限的用户身份登录数据库。</p>
                              </li>
                              <li>
                                 <p>查询操作类型。</p>
                                 <p>例如，列出<code class="codeph">DBA_OPTSTAT_OPERATIONS</code>中的所有不同操作（包括样本输出）：</p><pre class="pre codeblock"><code>SQL&gt; SELECT DISTINCT（OPERATION）FROM DBA_OPTSTAT_OPERATIONS按操作排序; OPERATION ----------------------- gather_dictionary_stats gather_index_stats gather_schema_stats gather_table_stats purge_stats set_system_stats</code></pre></li>
                              <li>
                                 <p>通过查询<code class="codeph">DBA_OPTSTAT_OPERATIONS</code>获取要过滤的操作的ID。</p>
                                 <p>例如，要获取<code class="codeph">SYS</code>和<code class="codeph">sh</code>模式中表和索引的所有统计信息收集操作的ID，请使用以下查询：</p><pre class="pre codeblock"><code>SELECT DB FROM DBA_OPTSTAT_OPERATIONS WHERE（OPERATION ='gather_table_stats'或OPERATION ='gather_index_stats'）AND（目标类似'SH。％'或目标类似'SYS。％'）;</code></pre></li>
                              <li>
                                 <p>使用<code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_OPR_FILTER</code>函数排除或包含指定任务的规则，指定在上一步中获取的ID。
                                 </p>
                                 <p>以下面的形式调用函数，其中占位符定义如下：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><span class="italic"><code class="codeph">report</code></span>是包含返回的XML的CLOB变量。</p>
                                    </li>
                                    <li>
                                       <p><code class="codeph"><span class="codeinlineitalic">tname</span></code>是任务的名称。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">opr_type</code></span>是要执行的操作类型。该值不能为空。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">rule</code></span>是<span class="italic"><code class="codeph">rule</code></span>的名称。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">opr_id</code></span>是要执行的操作的ID（来自<code class="codeph">DBA_OPTSTAT_OPERATIONS.ID</code> ）。该值不能为空。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">action</code></span>是<span class="italic"><code class="codeph">action</code></span>的名称： <code class="codeph">ENABLE</code> ， <code class="codeph">DISABLE</code> ， <code class="codeph">DELETE</code>或<code class="codeph">SHOW</code> 。</p>
                                    </li>
                                 </ul><pre class="pre codeblock"><code>BEGIN <span class="italic">报告</span> ：= DBMS_STATS.CONFIGURE_ADVISOR_OPR_FILTER（task_name =&gt;' <span class="italic">tname</span> '，stats_adv_opr_type =&gt;' <span class="italic">opr_type</span> '，rule_name =&gt;' <span class="italic">rule</span> '，operation_id =&gt;' <span class="italic">op_id</span> '，action =&gt;' <span class="italic">action</span> '）;结束;</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-429AE714-6FBF-4D93-A77E-A89C84F08923__GUID-0964F1CB-4578-4EF3-B510-BE39CF29344B">
                           <p class="titleinexample">例18-6排除收集表统计信息的操作</p>
                           <p>在此示例中，您的目标是排除在<code class="codeph">hr</code>模式中收集表统计信息的操作。用户帐户<code class="codeph">stats</code>已被授予<code class="codeph">DBA</code>角色， <code class="codeph">ADVISOR</code>权限和<code class="codeph">SELECT ON DBA_OPTSTAT_OPERATIONS</code>权限。您执行以下步骤：</p>
                           <ol>
                              <li>
                                 <p>以<code class="codeph">stats</code>登录数据库。
                                 </p>
                              </li>
                              <li>
                                 <p>删除任何名为<code class="codeph">opt_adv_task1</code>现有任务。
                                 </p><pre class="pre codeblock"><code>DECLARE v_tname VARCHAR2（32767）; BEGIN v_tname：='opt_adv_task1'; DBMS_STATS.DROP_ADVISOR_TASK（v_tname）;结束; /</code></pre></li>
                              <li>
                                 <p>创建一个名为<code class="codeph">opr_filter</code>的过程，该过程将任务配置为建议<span class="italic">除了</span>收集<code class="codeph">hr</code>模式中表的统计信息<span class="italic">之外的</span>所有操作。
                                 </p><pre class="pre codeblock"><code>创建或替换过程opr_filter（p_tname IN VARCHAR2）是v_retc CLOB; BEGIN  - 对于所有规则，阻止顾问操作 - 在以下查询中选择的操作FOR rec IN（SELECT ID FROM DBA_OPTSTAT_OPERATIONS WHERE OPERATION ='gather_table_stats'和TARGET LIKE'HR。％'）LOOP v_retc：= DBMS_STATS .CONFIGURE_ADVISOR_OPR_FILTER（task_name =&gt; p_tname，stats_adv_opr_type =&gt; NULL，rule_name =&gt; NULL，operation_id =&gt; rec.id，action =&gt;'DISABLE'）;结束循环;结束; /显示错误</code></pre></li>
                              <li>
                                 <p>创建名为<code class="codeph">opt_adv_task1</code>的任务，然后为此任务执行<code class="codeph">opr_filter</code>过程。
                                 </p><pre class="pre codeblock"><code>DECLARE v_tname VARCHAR2（32767）; v_ret VARCHAR2（32767）; BEGIN v_tname：='opt_adv_task1'; v_ret：= DBMS_STATS.CREATE_ADVISOR_TASK（v_tname）; opr_filter（v_tname）;结束; /</code></pre></li>
                              <li>
                                 <p>执行任务<code class="codeph">opt_adv_task1</code> 。
                                 </p><pre class="pre codeblock"><code>DECLARE v_tname VARCHAR2（32767）; v_ret VARCHAR2（32767）; begin v_tname：='opt_adv_task1'; v_ret：= DBMS_STATS.EXECUTE_ADVISOR_TASK（v_tname）;结束; /</code></pre></li>
                              <li>
                                 <p>打印报告。</p><pre class="pre codeblock"><code>SPOOL /tmp/rep.txt SET LONG 1000000 COLUMN报告格式A200 SET LINESIZE 250 SET PAGESIZE 1000 SELECT DBMS_STATS.REPORT_ADVISOR_TASK（task_name =&gt;'opt_adv_task1'，execution_name =&gt; NULL，type =&gt;'TEXT'，section =&gt;'ALL' ）AS DUAL报告; SPOOL OFF</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="example" -->
                        <div class="section"></div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-429AE714-6FBF-4D93-A77E-A89C84F08923__GUID-E700E3DA-D9E4-4C97-BF78-F076A294270E">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../refrn/DBA_OPTSTAT_OPERATIONS.html#REFRN-GUID-3D13B3C5-C1D1-47E7-B852-CD1563719402" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解有关<code class="codeph">DBA_OPTSTAT_OPERATIONS</code>更多信息</p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_STATS.html#GUID-0BD07210-825E-4971-87B5-EE453B354EC7" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解有关<code class="codeph">CONFIGURE_ADVISOR_OPR_FILTER</code>更多信息</p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-A709D991-5550-404C-AC05-57308047388D" title="过滤器使您可以在Optimizer Statistics Advisor任务中包含或排除对象，规则和操作。">为Optimizer Advisor任务创建过滤器</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
               <div class="sect3"><a id="GUID-2E00F47C-B108-4345-9225-0F0CC9902249" name="GUID-2E00F47C-B108-4345-9225-0F0CC9902249"></a><h4 id="TGSQL-GUID-2E00F47C-B108-4345-9225-0F0CC9902249" class="sect4"><span class="enumeration_section">18.2.4</span>执行优化程序统计顾问任务</h4>
                  <div>
                     <p><code class="codeph">DBMS_STATS.EXECUTE_ADVISOR_TASK</code>函数为Optimizer Statistics Advisor执行任务。如果未指定执行名称，则Optimizer Statistics Advisor会自动生成一个名称。
                     </p>
                     <div class="section">
                        <p>执行此任务的结果取决于正在执行的用户的权限：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">SYSTEM</code>级别</p>
                              <p>只有具有<code class="codeph">ANALYZE ANY</code>和<code class="codeph">ANALYZE ANY DICTIONARY</code>权限的用户才能在系统级规则上执行此任务。
                              </p>
                           </li>
                           <li>
                              <p>操作级别</p>
                              <p>结果取决于以下特权：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>具有<code class="codeph">ANALYZE ANY</code>和<code class="codeph">ANALYZE ANY DICTIONARY</code>权限的用户可以为所有统计操作执行此任务。
                                    </p>
                                 </li>
                                 <li>
                                    <p>具有<code class="codeph">ANALYZE ANY</code>权限但<span class="italic">不</span>具有<code class="codeph">ANALYZE ANY DICTIONARY</code>权限的用户可以执行与除<code class="codeph">SYS</code>之外的任何模式相关的统计操作的此任务。</p>
                                 </li>
                                 <li>
                                    <p>具有<code class="codeph">ANALYZE ANY DICTIONARY</code>权限但<span class="italic">不</span>具有<code class="codeph">ANALYZE ANY</code>权限的用户可以执行与其自己的架构和<code class="codeph">SYS</code>架构相关的统计操作的此任务。
                                    </p>
                                 </li>
                                 <li>
                                    <p>既没有<code class="codeph">ANALYZE ANY</code>也没有<code class="codeph">ANALYZE ANY DICTIONARY</code>权限的用户只能对与其自己的架构相关的统计操作执行此操作。
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>对象级别</p>
                              <p>用户可以为具有统计信息收集权限的任何对象执行此任务。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-2E00F47C-B108-4345-9225-0F0CC9902249__GUID-DD87FC79-BEA2-41FC-ACD2-2881F3EE6DFF">先决条件</p>
                        <p>此任务具有以下先决条件：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>要执行此子程序，您必须具有<code class="codeph">ADVISOR</code>权限。
                              </p>
                           </li>
                           <li>
                              <p>您必须是该任务的所有者。</p>
                           </li>
                           <li>
                              <p>如果指定执行名称，则此名称不得与现有执行冲突。</p>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-2E00F47C-B108-4345-9225-0F0CC9902249__GUID-96084FA8-D531-45D8-A7DD-3DE624DF00EC">
                           <p class="notep1">注意：</p>
                           <p>该子程序使用调用者的权限执行。</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-2E00F47C-B108-4345-9225-0F0CC9902249__GUID-8779A8D6-76A9-4323-864A-47BF83C8EC08">要执行Optimizer Statistics Advisor任务：</p>
                        <ol>
                           <li>
                              <p>在SQL * Plus或SQL Developer中，以具有必要权限的用户身份登录数据库。</p>
                           </li>
                           <li>
                              <p>以下面的形式执行<code class="codeph">DBMS_STATS.EXECUTE_ADVISOR_TASK</code>函数，其中<code class="codeph"><span class="codeinlineitalic">tname</span></code>是任务的名称， <code class="codeph"><span class="codeinlineitalic">execname</span></code>是执行的可选名称， <span class="italic"><code class="codeph">ret</code></span>是包含返回输出的变量：</p><pre class="pre codeblock"><code>EXECUTE <span class="italic">ret</span> ：= DBMS_STATS.EXECUTE_ADVISOR_TASK（' <span class="italic">tname</span> '，' <span class="italic">execname</span> '）;</code></pre><p>例如，要执行任务<code class="codeph">opt_adv_task1</code> ，请使用以下代码：</p><pre class="pre codeblock"><code>DECLARE v_tname VARCHAR2（32767）; v_ret VARCHAR2（32767）; BEGIN v_tname：='opt_adv_task1'; v_ret：= DBMS_STATS.EXECUTE_ADVISOR_TASK（v_tname）;结束; /</code></pre></li>
                           <li>
                              <p>（可选）通过查询<code class="codeph">USER_ADVISOR_EXECUTIONS</code>获取有关执行的详细信息：</p><pre class="pre codeblock"><code>SELECT TASK_NAME，EXECUTION_NAME，EXECUTION_END，EXECUTION_TYPE AS TYPE，STATUS FROM USER_ADVISOR_EXECUTIONS;</code></pre><p>示例输出显示如下：</p><pre class="pre codeblock"><code>TASK_NAME EXECUTION_NAME执行类型状态--------------- -------------------- ---------  - --------- ----------- OPT_ADV_TASK1 EXEC_136 23-NOV-15统计结果已完成</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-2E00F47C-B108-4345-9225-0F0CC9902249__ORACLEDATABASEPLSQLPACKAGESANDTYPES-41FDABD7">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-B930CE9B-7461-4691-8AA9-7E424C3C2C8C" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以了解有关<code class="codeph">EXECUTE_ADVISOR_TASK</code>更多信息</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75" title="本节介绍使用Optimizer Statistics Advisor的基本工作流程。所有过程和函数都在DBMS_STATS包中。">Optimizer Statistics Advisor的基本任务</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-A391E0BA-4159-4311-B05F-9E4F409CF3ED" name="GUID-A391E0BA-4159-4311-B05F-9E4F409CF3ED"></a><h4 id="TGSQL-GUID-A391E0BA-4159-4311-B05F-9E4F409CF3ED" class="sect4"><span class="enumeration_section">18.2.5</span>为优化程序统计顾问任务生成报告</h4>
                  <div>
                     <p><code class="codeph">DBMS_STATS.REPORT_ADVISOR_TASK</code>函数为Optimizer Statistics Advisor任务生成报告。
                     </p>
                     <div class="section">该报告包含以下部分：<ul style="list-style-type:disc">
                           <li>
                              <p>一般信息</p>
                              <p>本节介绍任务名称，执行名称，创建日期和修改日期。</p>
                           </li>
                           <li>
                              <p>摘要</p>
                              <p>本节总结了调查结果违反的结果和规则。</p>
                           </li>
                           <li>
                              <p>发现</p>
                              <p>每个发现部分列出了相关规则和发现。如果顾问有推荐，则描述推荐。在某些情况下，建议也有一个基本原理。</p>
                           </li>
                        </ul>
                        <p>自动Optimizer Statistics Advisor任务的名称为<code class="codeph">AUTO_STATS_ADVISOR_TASK</code> 。如果您遵循自动化工作流程，则只需查询自动生成的报告。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-A391E0BA-4159-4311-B05F-9E4F409CF3ED__GUID-00F0670B-0379-43D5-8EDC-D1AEE3F4941B">先决条件</p>
                     </div>
                     <!-- class="section" -->
                     <div class="p">
                        <p>要使用<code class="codeph">DBMS_STATS.REPORT_ADVISOR_TASK</code>函数生成报告，您必须满足以下先决条件：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>要执行此子程序，您必须具有<code class="codeph">ADVISOR</code>权限。
                              </p>
                           </li>
                           <li>
                              <p>您必须是该任务的所有者。</p>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-A391E0BA-4159-4311-B05F-9E4F409CF3ED__GUID-31C3008E-B2CE-40FA-9B34-98517298EDB7">
                           <p class="notep1">注意：</p>
                           <p>该子程序使用调用者的权限执行。</p>
                        </div>
                        <p>执行此任务的结果取决于正在执行的用户的权限：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">SYSTEM</code>级别</p>
                              <p>只有具有<code class="codeph">ANALYZE ANY</code>和<code class="codeph">ANALYZE ANY DICTIONARY</code>权限的用户才能在系统级规则上执行此任务。
                              </p>
                           </li>
                           <li>
                              <p>操作级别</p>
                              <p>结果取决于以下特权：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>具有<code class="codeph">ANALYZE ANY</code>和<code class="codeph">ANALYZE ANY DICTIONARY</code>权限的用户可以为所有统计操作执行此任务。
                                    </p>
                                 </li>
                                 <li>
                                    <p>具有<code class="codeph">ANALYZE ANY</code>权限但<span class="italic">不</span>具有<code class="codeph">ANALYZE ANY DICTIONARY</code>权限的用户可以执行与除<code class="codeph">SYS</code>之外的任何模式相关的统计操作的此任务。</p>
                                 </li>
                                 <li>
                                    <p>具有<code class="codeph">ANALYZE ANY DICTIONARY</code>权限但<span class="italic">不</span>具有<code class="codeph">ANALYZE ANY</code>权限的用户可以执行与其自己的架构和<code class="codeph">SYS</code>架构相关的统计操作的此任务。
                                    </p>
                                 </li>
                                 <li>
                                    <p>既没有<code class="codeph">ANALYZE ANY</code>也没有<code class="codeph">ANALYZE ANY DICTIONARY</code>权限的用户只能对与其自己的架构相关的统计操作执行此操作。
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>对象级别</p>
                              <p>用户可以为具有统计信息收集权限的任何对象执行此任务。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-A391E0BA-4159-4311-B05F-9E4F409CF3ED__GUID-29A5E694-5B2B-41F5-A9C0-227C3BFA7354">要生成Optimizer Statistics Advisor报告，请执行以下操作：</p>
                        <ol>
                           <li>
                              <p>在SQL * Plus中，以具有<code class="codeph">ADVISOR</code>权限的用户身份登录数据库。
                              </p>
                           </li>
                           <li>
                              <p>查询<code class="codeph">DBMS_STATS.REPORT_ADVISOR_TASK</code>函数输出。
                              </p>
                              <p>使用以下查询，其中占位符具有以下定义：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">tname</span></code>是任务的名称。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">exec</span></code>是执行的名称。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">type</span></code>是输出的类型： <code class="codeph">TEXT</code> ， <code class="codeph">HTML</code>或<code class="codeph">XML</code> 。</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">sect</span></code>是报告的一部分： <code class="codeph">SUMMARY</code> ， <code class="codeph">FINDINGS</code> ， <code class="codeph">ERRORS</code>和<code class="codeph">ALL</code> 。</p>
                                 </li>
                                 <li>
                                    <p><span class="italic"><code class="codeph">lvl</code></span>是报告的格式： <code class="codeph">BASIC</code> ， <code class="codeph">TYPICAL</code> ， <code class="codeph">ALL</code>或<code class="codeph">SHOW_HIDDEN</code> 。</p>
                                 </li>
                              </ul><pre class="pre codeblock"><code>SET LINESIZE 3000 SET LONG 500000 SET PAGESIZE 0 SET LONGCHUNKSIZE 100000 SELECT DBMS_STATS.REPORT_ADVISOR_TASK（' <span class="italic">tname</span> '，' <span class="italic">exec</span> '，' <code class="codeph"><span class="codeinlineitalic">type</span></code> '，' <code class="codeph"><span class="codeinlineitalic">sect</span></code> '，' <code class="codeph"><span class="codeinlineitalic">lvl</span></code> '）AS REPORT FROM DUAL;</code></pre><p>例如，要打印<code class="codeph">AUTO_STATS_ADVISOR_TASK</code>的报告，请使用以下查询：</p><pre class="pre codeblock"><code>SELECT DBMS_STATS.REPORT_ADVISOR_TASK（'AUTO_STATS_ADVISOR_TASK'，NULL，'TEXT'，'ALL'，'ALL'）作为DUAL的报告;</code></pre><p>以下示例报告显示了四个发现：</p><pre class="pre codeblock"><code>一般信息  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  - -------------------------------任务名称：AUTO_STATS_ADVISOR_TASK执行名称：EXEC_136创建时间：09-05-16 02:52： 34最后修改日期：09-05-16 12:31:24 ------------------------------------ -------------------------------------------汇总------ -------------------------------------------------- -----------------------对于任务AUTO_STATS_ADVISOR_TASK的执行EXEC_136，Statistics Advisor有4个发现。调查结果与以下规则有关：AVOIDSETPROCEDURES，USEDEFAULTPARAMS，USEGATHERSCHEMASTATS，NOTUSEINCREMENTAL。有关详细信息，请参阅查找部分。-------------------------------------------------- -  -  -  -  -  -  -  -  -  -  -  -  -  - - 发现  -  -  -  -  -  -  -  -  -  - -------------------------------------------------- ---------规则名称：AvoidSetProcedures规则描述：避免设置统计程序查找：有5个SET_ [COLUMN | INDEX | TABLE | SYSTEM] _STATS程序用于统计信息收集。建议：不要使用SET_ [COLUMN | INDEX | TABLE | SYSTEM] _STATS程序。收集统计信息而不是设置它们。基本原理：SET_ [COLUMN | INDEX | TABLE | SYSTEM] _STATS会因错误或不一致的统计信息而导致错误的计划。-------------------------------------------------- - 规则名称：UseDefaultParams规则描述：在统计信息收集过程中使用默认参数查找：使用非默认参数有367个统计操作。建议：使用默认参数进行统计操作。示例： - 使用所有默认参数值收集“SH”模式的统计信息：BEGIN dbms_stats.gather_schema_stats（'SH'）;结束;基本原理：使用默认参数值进行统计信息收集操作更有效。-------------------------------------------------- - 规则名称：UseGatherSchemaStats规则描述：使用gather_schema_stats过程查找：GATHER_TABLE_STATS有318种用法。建议：使用GATHER_SCHEMA_STATS而不是GATHER_TABLE_STATS。示例： - 收集'SH'模式的统计信息：BEGIN dbms_stats.gather_schema_stats（'SH'）;结束;基本原理：GATHER_SCHEMA_STATS有更多可用选项，包括检查陈旧性和同时收集统计信息。此外，对于添加到架构的新表，它更易于维护。如果您只想收集模式中某些表的统计信息，请在GATHER_SCHEMA_STATS的obj_filter_list参数中指定它们。-------------------------------------------------- - 规则名称：NotUseIncremental规则描述：当不是查找时，不应以递增方式维护统计信息：已为10个表启用了增量选项，这将不会从使用增量选项中受益。架构：SH对象：CAL_MONTH_SALES_MV CAL_MONTH_SALES_MV通道国家/地区客户DIMENSION_EXCEPTIONS FWEEK_PSCAT_SALES_MV FWEEK_PSCAT_SALES_MV产品促销补充_DEMOGRAPHICS时间建议：不要使用增量选项来收集这些对象的统计信息。示例： - 关闭'SH.SALES'的增量选项：dbms_stats.set_table_prefs（'SH'，'SALES'，'INCREMENTAL'，'FALSE'）;基本原理：在这些表上使用增量选项的开销超过了使用增量选项的好处。
</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-A391E0BA-4159-4311-B05F-9E4F409CF3ED__ORACLEDATABASEPLSQLPACKAGESANDTYPES-41FF0C16">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-B930CE9B-7461-4691-8AA9-7E424C3C2C8C" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以了解有关<code class="codeph">REPORT_ADVISOR_TASK</code>更多信息</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75" title="本节介绍使用Optimizer Statistics Advisor的基本工作流程。所有过程和函数都在DBMS_STATS包中。">Optimizer Statistics Advisor的基本任务</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-10D99B9A-9FDB-4265-A2D1-043D7165D216" name="GUID-10D99B9A-9FDB-4265-A2D1-043D7165D216"></a><h4 id="TGSQL-GUID-10D99B9A-9FDB-4265-A2D1-043D7165D216" class="sect4"><span class="enumeration_section">18.2.6</span>实施Optimizer Statistics Advisor建议</h4>
                  <div>
                     <p>您可以实现自动使用的所有建议<code class="codeph">DBMS_STATS.IMPLEMENT_ADVISOR_TASK</code> ，或使用生成可编辑的脚本<code class="codeph">DBMS_STATS.SCRIPT_ADVISOR_TASK</code> 。</p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-9C219CD5-A781-4AC0-AEC8-974EE8F5DEA9">实施Optimizer Statistics Advisor推荐的操作</a><br><code class="codeph">DBMS_STATS.IMPLEMENT_ADVISOR_TASK</code>函数实现指定Optimizer Statistics Advisor任务的建议。如果未指定执行名称，则Optimizer Statistics Advisor将使用最新的执行。
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65">使用Optimizer Statistics Advisor生成脚本</a><br><code class="codeph">DBMS_STATS.SCRIPT_ADVISOR_TASK</code>函数生成可编辑脚本，其中包含针对指定Optimizer Statistics Advisor任务的建议。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75" title="本节介绍使用Optimizer Statistics Advisor的基本工作流程。所有过程和函数都在DBMS_STATS包中。">Optimizer Statistics Advisor的基本任务</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-9C219CD5-A781-4AC0-AEC8-974EE8F5DEA9" name="GUID-9C219CD5-A781-4AC0-AEC8-974EE8F5DEA9"></a><h5 id="TGSQL-GUID-9C219CD5-A781-4AC0-AEC8-974EE8F5DEA9" class="sect5"><span class="enumeration_section">18.2.6.1</span>实施Optimizer Statistics Advisor推荐的操作</h5>
                     <div>
                        <p><code class="codeph">DBMS_STATS.IMPLEMENT_ADVISOR_TASK</code>函数实现指定Optimizer Statistics Advisor任务的建议。如果未指定执行名称，则Optimizer Statistics Advisor将使用最新的执行。
                        </p>
                        <div class="section">实现建议的最简单方法是使用<code class="codeph">DBMS_STATS.IMPLEMENT_ADVISOR_TASK</code> 。在这种情况下，不需要生成脚本。您可以指定顾问程序忽略现有过滤器<code class="codeph">(level=&gt;'ALL')</code>或使用默认值，它默认现有过滤器<code class="codeph">(level=&gt;'TYPICAL')</code> 。
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-9C219CD5-A781-4AC0-AEC8-974EE8F5DEA9__GUID-7F9BAFC7-F177-4F86-85D7-3C82182A3A6E">先决条件</p>
                           <p>要使用<code class="codeph">DBMS_STATS.IMPLEMENT_ADVISOR_TASK</code> ，您必须满足以下先决条件：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>要执行此子程序，您必须具有<code class="codeph">ADVISOR</code>权限。
                                 </p>
                              </li>
                              <li>
                                 <p>您必须是该任务的所有者。</p>
                              </li>
                           </ul>
                           <div class="infoboxnote" id="GUID-9C219CD5-A781-4AC0-AEC8-974EE8F5DEA9__GUID-0C31112B-6466-4BAB-A73C-AD4D1253F696">
                              <p class="notep1">注意：</p>
                              <p>该子程序使用调用者的权限执行。</p>
                           </div>
                           <p>执行此任务的结果取决于正在执行的用户的权限：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">SYSTEM</code>级别</p>
                                 <p>只有具有<code class="codeph">ANALYZE ANY</code>和<code class="codeph">ANALYZE ANY DICTIONARY</code>权限的用户才能在系统级规则上执行此任务。
                                 </p>
                              </li>
                              <li>
                                 <p>操作级别</p>
                                 <p>结果取决于以下特权：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>具有<code class="codeph">ANALYZE ANY</code>和<code class="codeph">ANALYZE ANY DICTIONARY</code>权限的用户可以为所有统计操作执行此任务。
                                       </p>
                                    </li>
                                    <li>
                                       <p>具有<code class="codeph">ANALYZE ANY</code>权限但<span class="italic">不</span>具有<code class="codeph">ANALYZE ANY DICTIONARY</code>权限的用户可以执行与除<code class="codeph">SYS</code>之外的任何模式相关的统计操作的此任务。</p>
                                    </li>
                                    <li>
                                       <p>具有<code class="codeph">ANALYZE ANY DICTIONARY</code>权限但<span class="italic">不</span>具有<code class="codeph">ANALYZE ANY</code>权限的用户可以执行与其自己的架构和<code class="codeph">SYS</code>架构相关的统计操作的此任务。
                                       </p>
                                    </li>
                                    <li>
                                       <p>既没有<code class="codeph">ANALYZE ANY</code>也没有<code class="codeph">ANALYZE ANY DICTIONARY</code>权限的用户只能对与其自己的架构相关的统计操作执行此操作。
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>对象级别</p>
                                 <p>用户可以为具有统计信息收集权限的任何对象执行此任务。</p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-9C219CD5-A781-4AC0-AEC8-974EE8F5DEA9__GUID-1A3517EB-7145-4679-885F-565EFFC91DB4">实施顾问行动：</p>
                           <ol>
                              <li>
                                 <p>在SQL * Plus中，以具有必要权限的用户身份登录数据库。</p>
                              </li>
                              <li>
                                 <p>以下面的形式执行<code class="codeph">DBMS_STATS.IMPLEMENT_ADVISOR_TASK</code>函数，其中占位符具有以下定义：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><code class="codeph"><span class="codeinlineitalic">tname</span></code>是任务的名称。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">result</code></span>是CLOB变量，其中包含已成功实现的建议列表。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">filter_lvl</code></span>是实现级别： <code class="codeph">TYPICAL</code> （尊重现有过滤器）或<code class="codeph">ALL</code> （忽略过滤器）。
                                       </p>
                                    </li>
                                 </ul><pre class="pre codeblock"><code>EXECUTE <span class="italic">结果</span> ：= DBMS_STATS.IMPLEMENT_ADVISOR_TASK（' <span class="italic">tname</span> '，level =&gt; <code class="codeph"><span class="codeinlineitalic">filter_lvl</span></code> ）;</code></pre><p>例如，要实现任务<code class="codeph">opt_adv_task1</code>所有建议，请使用以下代码：</p><pre class="pre codeblock"><code>VARIABLE b_ret CLOB DECLARE v_tname VARCHAR2（32767）; BEGIN v_tname：='opt_adv_task1'; ：b_ret：= DBMS_STATS.IMPLEMENT_ADVISOR_TASK（v_tname）;结束; /</code></pre></li>
                              <li>
                                 <p>（可选）打印XML输出以确认已实施的操作。</p>
                                 <p>例如，要打印上一步中返回的XML，请使用以下代码（包括示例输出）：</p><pre class="pre codeblock"><code>SET LONG 10000 SELECT XMLType（：b_ret）AS imp_results FROM DUAL;</code></pre><pre class="pre codeblock"><code>IMP_RESULTS ------------------------------------ &lt;implementation_results&gt; &lt;rule NAME =“AVOIDSETPROCEDURES”&gt; &lt;已实施&gt;是&lt;/ implemented&gt; &lt;/ rule&gt; &lt;rule NAME =“USEGATHERSCHEMASTATS”&gt; &lt;implemented&gt; yes &lt;/ implemented&gt; &lt;/ rule&gt; &lt;rule NAME =“AVOIDSETPROCEDURES”&gt; &lt;achie&gt; yes &lt;/ implemented&gt; &lt;/ rule&gt; &lt;rule NAME =“USEGATHERSCHEMASTATS”&gt; &lt;implemented&gt; yes &lt;/ implemented&gt; &lt;/ rule&gt; &lt;rule NAME =“USEDEFAULTPARAMS”&gt; &lt;implemented&gt; no &lt;/ implemented&gt; &lt;/ rule&gt; &lt;rule NAME =“USEDEFAULTPARAMS”&gt; &lt;已实施&gt;是&lt;/ implemented&gt; &lt;/ rule&gt; &lt;rule NAME =“NOTUSEINCREMENTAL”&gt; &lt;implemented&gt; yes &lt;/ implemented&gt; &lt;/ rule&gt; &lt;/ implementation_results&gt;</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-9C219CD5-A781-4AC0-AEC8-974EE8F5DEA9__ORACLEDATABASEPLSQLPACKAGESANDTYPES-42008A13">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-B930CE9B-7461-4691-8AA9-7E424C3C2C8C" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以了解有关<code class="codeph">DBMS_STATS.IMPLEMENT_ADVISOR_TASK</code>更多信息</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-10D99B9A-9FDB-4265-A2D1-043D7165D216" title="您可以使用DBMS_STATS.IMPLEMENT_ADVISOR_TASK自动实现所有建议，也可以使用DBMS_STATS.SCRIPT_ADVISOR_TASK生成可编辑脚本。">实施Optimizer Statistics Advisor建议</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65" name="GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65"></a><h5 id="TGSQL-GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65" class="sect5"><span class="enumeration_section">18.2.6.2</span>使用Optimizer Statistics Advisor生成脚本</h5>
                     <div>
                        <p><code class="codeph">DBMS_STATS.SCRIPT_ADVISOR_TASK</code>函数生成可编辑脚本，其中包含针对指定Optimizer Statistics Advisor任务的建议。
                        </p>
                        <div class="section">
                           <p>与<code class="codeph">IMPLEMENT_ADVISOR_TASK</code>不同， <code class="codeph">SCRIPT_ADVISOR_TASK</code>生成一个脚本，您可以在执行前编辑该脚本。输出脚本包含注释和可执行代码。与<code class="codeph">IMPLEMENT_ADVISOR_TASK</code> ，您可以指定顾问程序忽略现有过滤器<code class="codeph">(level=&gt;'ALL')</code>或使用默认值，它默认现有过滤器<code class="codeph">(level=&gt;'TYPICAL')</code> 。您可以指定该函数将脚本作为CLOB和文件返回，或仅返回CLOB。</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65__GUID-75DE0489-F46F-4D4B-B93B-947E4339C661">先决条件</p>
                           <p>要使用<code class="codeph">DBMS_STATS.SCRIPT_ADVISOR_TASK</code>函数，您必须满足以下先决条件：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>要执行此子程序，您必须具有<code class="codeph">ADVISOR</code>权限。
                                 </p>
                              </li>
                              <li>
                                 <p>您必须是该任务的所有者。</p>
                              </li>
                           </ul>
                           <div class="infoboxnote" id="GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65__GUID-1B1DD810-107F-4A7D-BCA1-E414709FD9BD">
                              <p class="notep1">注意：</p>
                              <p>该子程序使用调用者的权限执行。</p>
                           </div>
                           <p>执行此任务的结果取决于正在执行的用户的权限：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">SYSTEM</code>级别</p>
                                 <p>只有具有<code class="codeph">ANALYZE ANY</code>和<code class="codeph">ANALYZE ANY DICTIONARY</code>权限的用户才能在系统级规则上执行此任务。
                                 </p>
                              </li>
                              <li>
                                 <p>操作级别</p>
                                 <p>结果取决于以下特权：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>具有<code class="codeph">ANALYZE ANY</code>和<code class="codeph">ANALYZE ANY DICTIONARY</code>权限的用户可以为所有统计操作执行此任务。
                                       </p>
                                    </li>
                                    <li>
                                       <p>具有<code class="codeph">ANALYZE ANY</code>权限但<span class="italic">不</span>具有<code class="codeph">ANALYZE ANY DICTIONARY</code>权限的用户可以执行与除<code class="codeph">SYS</code>之外的任何模式相关的统计操作的此任务。</p>
                                    </li>
                                    <li>
                                       <p>具有<code class="codeph">ANALYZE ANY DICTIONARY</code>权限但<span class="italic">不</span>具有<code class="codeph">ANALYZE ANY</code>权限的用户可以执行与其自己的架构和<code class="codeph">SYS</code>架构相关的统计操作的此任务。
                                       </p>
                                    </li>
                                    <li>
                                       <p>既没有<code class="codeph">ANALYZE ANY</code>也没有<code class="codeph">ANALYZE ANY DICTIONARY</code>权限的用户只能对与其自己的架构相关的统计操作执行此操作。
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>对象级别</p>
                                 <p>用户可以为具有统计信息收集权限的任何对象执行此任务。</p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65__GUID-D99CE6B8-81B2-4940-8534-3E6D3D1928B9">要生成顾问程序脚本：</p>
                           <ol>
                              <li>
                                 <p>在SQL * Plus中，以具有<code class="codeph">ADVISOR</code>权限的用户身份登录数据库。
                                 </p>
                              </li>
                              <li>
                                 <p>以下面的形式执行<code class="codeph">DBMS_STATS.SCRIPT_ADVISOR_TASK</code>函数，其中占位符具有以下定义：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><code class="codeph"><span class="codeinlineitalic">tname</span></code>是任务的名称。
                                       </p>
                                    </li>
                                    <li>
                                       <p><code class="codeph"><span class="codeinlineitalic">exec</span></code>是执行的名称（默认为null）。
                                       </p>
                                    </li>
                                    <li>
                                       <p><code class="codeph"><span class="codeinlineitalic">dir</span></code>是<code class="codeph"><span class="codeinlineitalic">dir</span></code>的名称（默认为null）。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">result</code></span>是CLOB变量，其中包含已成功实现的建议列表。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">filter_lvl</code></span>是实现级别： <code class="codeph">TYPICAL</code> （尊重现有过滤器）或<code class="codeph">ALL</code> （忽略过滤器）。
                                       </p>
                                    </li>
                                 </ul><pre class="pre codeblock"><code>EXEC <span class="italic">结果</span> ：= DBMS_STATS.SCRIPT_ADVISOR_TASK（' <span class="italic">tname</span> '，execution_name =&gt;' <span class="italic">exec</span> '，dir_name =&gt;' <span class="italic">dir</span> '，level =&gt;' <code class="codeph"><span class="codeinlineitalic">filter_lvl</span></code> '）;</code></pre><p>例如，要生成包含任务<code class="codeph">opt_adv_task1</code>建议的脚本，请使用以下代码：</p><pre class="pre codeblock"><code>VARIABLE b_script CLOB DECLARE v_tname VARCHAR2（32767）; BEGIN v_tname：='opt_adv_task1'; ：b_script：= DBMS_STATS.SCRIPT_ADVISOR_TASK（v_tname）;结束; /</code></pre><div class="infoboxnote" id="GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65__GUID-CD4D9BDD-8DD5-4136-9F04-B39DED906F84">
                                    <p class="notep1">注意：</p>
                                    <p>如果未指定执行名称，则Optimizer Statistics Advisor将使用最新的执行。</p>
                                 </div>
                              </li>
                              <li>
                                 <p>打印脚本。</p>
                                 <p>例如，要打印上一步中返回的脚本，请使用以下代码（包括示例输出）：</p><pre class="pre codeblock"><code>DECLARE v_len NUMBER（10）; v_offset NUMBER（10）：= 1; v_amount NUMBER（10）：= 10000; BEGIN v_len：= DBMS_LOB.getlength（：b_script）; WHILE（v_offset &lt;v_len）LOOP DBMS_OUTPUT.PUT_LINE（DBMS_LOB.SUBSTR（：b_script，v_amount，v_offset））; v_offset：= v_offset + v_amount;结束循环;结束; /</code></pre><p>以下示例显示了一个示例脚本：</p><pre class="pre codeblock"><code>- 为执行EXEC_23的建议生成的脚本 - 在统计顾问任务OPT_ADV_TASK1中 - 脚本版本12.2  - 不会为规则AVOIDSETPROCEDURES提供脚本。请查看报告 - 了解更多详情。- 不会为规则USEGATHERSCHEMASTATS提供脚本。请查看报告 - 了解更多详情。- 不会为规则AVOIDINEFFICIENTSTATSOPRSEQ提供脚本。请查看 - 报告了解更多详情。- 不会为规则AVOIDUNNECESSARYSTATSCOLLECTION提供脚本。请查看 - 报告了解更多详情。- 不会为规则GATHERSTATSAFTERBULKDML提供脚本。请查看 - 报告了解更多详情。- 不会为规则AVOIDDROPRECREATE提供脚本。请查看报告 - 了解更多详情。- 不会为规则AVOIDOUTOFRANGE提供脚本。请查看报告 - 了解更多详情。- 不会为规则AVOIDANALYZETABLE提供脚本。请查看报告 - 了解更多详情。- 不会为规则AVOIDSETPROCEDURES提供脚本。请查看报告 - 了解更多详情。- 不会为规则USEGATHERSCHEMASTATS提供脚本。请查看报告 - 了解更多详情。- 不会为规则AVOIDINEFFICIENTSTATSOPRSEQ提供脚本。请查看 - 报告了解更多详情。- 不会为规则AVOIDUNNECESSARYSTATSCOLLECTION提供脚本。请查看 - 报告了解更多详情。- 不会为规则GATHERSTATSAFTERBULKDML提供脚本。请查看 - 报告了解更多详情。- 不会为规则AVOIDDROPRECREATE提供脚本。请查看报告 - 了解更多详情。- 不会为规则AVOIDOUTOFRANGE提供脚本。请查看报告 - 了解更多详情。- 不会为规则AVOIDANALYZETABLE提供脚本。请查看报告 - 了解更多详情。- 规则USEDEFAULTPARAMS的脚本 - 规则描述：在统计信息收集过程中使用默认参数 - 使用参数的默认首选项开始dbms_stats.set_global_prefs（'PREFERENCE_OVERRIDES_PARAMETER'，'TRUE'）;结束; /  - 规则USEDEFAULTOBJECTPREFERENCE的脚本 - 规则描述：使用默认对象首选项进行统计信息收集 - 将对象级首选项设置为默认值 - 将CASCADE设置为对象级别首选项的默认值 - 将ESTIMATE_PERCENT设置为对象级别的默认值首选项 - 将METHOD_OPT设置为对象级别首选项的默认值 - 将GRANULARITY设置为对象级别首选项的默认值 - 将NO_INVALIDATE设置为对象级别首选项的默认值 - 规则的脚本USEINCREMENTAL  - 规则描述：当应用时，统计信息应逐步维护这是有益的。- 为使用增量有用的对象启用增量选项。- 规则的脚本UNLOCKNONVOLATILETABLE  - 规则描述：不应锁定具有非易失性的对象的统计信息 - 解锁非易失性对象的统计信息。- 规则LOCKVOLATILETABLE的脚本 - 规则描述：应锁定具有易失性数据的对象的统计信息 - 锁定易失性对象的统计信息。- 规则NOTUSEINCREMENTAL的脚本 - 规则描述：当不利于统计时，不应以递增方式维护统计数据 - 关闭使用增量无用的对象的增量选项。开始dbms_stats.set_table_prefs（'SH'，'CAL_MONTH_SALES_MV'，'INCREMENTAL'，'FALSE'）;结束; / begin dbms_stats.set_table_prefs（'SH'，'CHANNELS'，'INCREMENTAL'，'FALSE'）;结束; / begin dbms_stats.set_table_prefs（'SH'，'COUNTRIES'，'INCREMENTAL'，'FALSE'）;结束; / begin dbms_stats.set_table_prefs（'SH'，'CUSTOMERS'，'INCREMENTAL'，'FALSE'）;结束; / begin dbms_stats.set_table_prefs（'SH'，'DIMENSION_EXCEPTIONS'，'INCREMENTAL'，'FALSE'）;结束; / begin dbms_stats.set_table_prefs（'SH'，'FWEEK_PSCAT_SALES_MV'，'INCREMENTAL'，'FALSE'）;结束; / begin dbms_stats.set_table_prefs（'SH'，'PRODUCTS'，'INCREMENTAL'，'FALSE'）;结束; / begin dbms_stats.set_table_prefs（'SH'，'PROMOTIONS'，'INCREMENTAL'，'FALSE'）;结束; / begin dbms_stats.set_table_prefs（'SH'，'SUPPLEMENTARY_DEMOGRAPHICS'，'INCREMENTAL'，'FALSE'）;结束; / begin dbms_stats.set_table_prefs（'SH'，'TIMES'，'INCREMENTAL'，'FALSE'）;结束; /  - 规则的脚本USEAUTODEGREE  - 规则描述：使用自动度数进行统计数据收集 - 为使用自动度数的对象启用自动度数。- 规则的脚本AVOIDSTALESTATS  - 规则描述：避免具有过期或无统计信息的对象 - 收集缺少或没有统计信息的对象的统计信息。- 规则MAINTAINSTATSCONSISTENCY的脚本 - 规则描述：依赖对象的统计信息应该是一致的 - 收集那些缺失或没有统计信息的对象的统计信息。
</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65__ORACLEDATABASEPLSQLPACKAGESANDTYPES-420550B7">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-B930CE9B-7461-4691-8AA9-7E424C3C2C8C" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以了解有关<code class="codeph">DBMS_STATS.SCRIPT_ADVISOR_TASK</code>更多信息</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-advisor.html#GUID-10D99B9A-9FDB-4265-A2D1-043D7165D216" title="您可以使用DBMS_STATS.IMPLEMENT_ADVISOR_TASK自动实现所有建议，也可以使用DBMS_STATS.SCRIPT_ADVISOR_TASK生成可编辑脚本。">实施Optimizer Statistics Advisor建议</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>