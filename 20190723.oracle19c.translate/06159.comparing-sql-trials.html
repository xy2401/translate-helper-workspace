<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="After the post-change SQL performance data is built, you can compare the performance data collected in the pre-change SQL trial to the post-change SQL trial by running a comparison analysis using SQL Performance Analyzer."></meta>
      <meta name="description" content="After the post-change SQL performance data is built, you can compare the performance data collected in the pre-change SQL trial to the post-change SQL trial by running a comparison analysis using SQL Performance Analyzer."></meta>
      <title>比较SQL试验</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Testing Guide "></meta>
      <meta property="og:description" content="After the post-change SQL performance data is built, you can compare the performance data collected in the pre-change SQL trial to the post-change SQL trial by running a comparison analysis using SQL Performance Analyzer."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Testing Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="testing-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-07T01:43:11-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2008, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96279-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="creating-a-post-change-sql-trial.html" title="Previous" type="text/html"></link>
      <link rel="next" href="using-spa-quick-check.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Testing Guide"></meta>
    <meta name="dcterms.isVersionOf" content="RATUG"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="creating-a-post-change-sql-trial.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="using-spa-quick-check.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">测试指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="sql-performance-analyzer.html" property="item" typeof="WebPage"><span property="name">SQL性能分析器</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">比较SQL试验</li>
            </ol>
            <a id="GUID-848B84A7-CB08-4728-9E3A-CBDD70E89E63" name="GUID-848B84A7-CB08-4728-9E3A-CBDD70E89E63"></a><a id="RATUG186"></a>
            
            <h2 id="RATUG-GUID-848B84A7-CB08-4728-9E3A-CBDD70E89E63" class="sect2"><span class="enumeration_chapter">6</span>比较SQL试验</h2>
         </header>
         <div class="ind">
            <div>
               <div><span>在构建更改后的SQL性能数据之后，您可以通过使用SQL Performance Analyzer运行比较分析，将在更改前的SQL试验中收集的性能数据与更改后的SQL试验进行比较。</span> 比较分析完成后，您可以生成一个报告，以识别由于系统更改而改进，保持不变或退化的SQL语句。SQL Performance Analyzer报告计算了每个SQL语句性能变化的两个主要影响度量：</div>
               <ul style="list-style-type:disc">
                  <li>
                     <p>对工作量的影响</p>
                     <p>这表示在考虑执行频率之后，此更改对SQL语句的影响百分比对工作负载的累积执行时间的影响。例如，导致SQL语句的累积执行时间从101秒提高到1秒的更改（其中其余工作负载在更改之前的总执行时间为99秒）将具有50％（2x）的值这个测量。</p>
                  </li>
                  <li>
                     <p>对SQL的影响</p>
                     <p>这表示此更改对SQL语句的响应对SQL语句的响应时间的影响百分比。例如，导致SQL语句的响应时间从10秒提高到1秒的更改将具有此测量的90％（10x）值。</p>
                  </li>
               </ul>
               <p>本章介绍如何比较和分析来自更改前和更改后SQL测试的性能数据，并包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="comparing-sql-trials.html#GUID-B9A39A45-935B-47B6-A34C-6D0D47BC91F3" title="使用Oracle Enterprise Manager比较SQL试验涉及以下步骤：">使用Oracle Enterprise Manager比较SQL试验</a></p>
                  </li>
                  <li>
                     <p><a href="comparing-sql-trials.html#GUID-36FDBD56-32CD-4A47-B7FB-5A20CDD1EF82" title="使用API比较SQL试验涉及以下步骤：">使用API比较SQL试验</a></p>
                  </li>
               </ul>
               <div class="infoboxnote" id="GUID-848B84A7-CB08-4728-9E3A-CBDD70E89E63__GUID-746B19F1-3619-4A17-BD70-9BE65F83664C">
                  <p class="notep1">注意：</p>
                  <p>用于比较SQL试验的主要接口是Oracle Enterprise Manager。如果由于某种原因Oracle Enterprise Manager不可用，您可以使用<code class="codeph">DBMS_SQLPA</code> PL / SQL包比较SQL试验。
                  </p>
               </div>
               <div class="infoboxnotealso" id="GUID-848B84A7-CB08-4728-9E3A-CBDD70E89E63__GUID-1448C581-222B-449D-A81A-9BF88DF0AA02">
                  <p class="notep1">也可以看看：</p>
                  <p><span class="q">“ <a href="introduction-to-sql-performance-analyzer.html#GUID-F07105CA-0DFA-4102-A8FE-1C11AD201528" title="SQL Performance Analyzer会比较更改前后SQL语句的性能，并生成一个报告，标识执行计划中的任何更改或SQL语句的性能。">比较性能测量</a> ”</span></p>
               </div>
            </div><a id="RATUG187"></a><div class="props_rev_3"><a id="GUID-B9A39A45-935B-47B6-A34C-6D0D47BC91F3" name="GUID-B9A39A45-935B-47B6-A34C-6D0D47BC91F3"></a><h3 id="RATUG-GUID-B9A39A45-935B-47B6-A34C-6D0D47BC91F3" class="sect3"><span class="enumeration_section">6.1</span>使用Oracle Enterprise Manager比较SQL试验</h3>
               <div>
                  <p>使用Oracle Enterprise Manager比较SQL试验涉及以下步骤：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="comparing-sql-trials.html#GUID-9EA13E7E-89AE-414B-8297-542F3D1755E7" title="本节介绍如何使用Oracle Enterprise Manager分析系统更改之前和之后的SQL性能。">使用Oracle Enterprise Manager分析SQL性能</a></p>
                     </li>
                     <li>
                        <p><a href="comparing-sql-trials.html#GUID-98608C0D-8BA8-4F10-94D8-3AE987087CBF" title="完成SQL性能分析器任务后，生成的数据将生成到SQL性能分析器报告中，该报告将比较更改前和更改后的SQL性能。">使用Oracle Enterprise Manager查看SQL Performance Analyzer报告</a></p>
                     </li>
                     <li>
                        <p><a href="comparing-sql-trials.html#GUID-A86879DB-BB8B-4F97-91BF-12CB045932C0" title="在查看SQL Performance Analyzer报告之后，您应该在比较SQL性能之后调整所识别的任何回归SQL语句。">使用Oracle Enterprise Manager调整回归的SQL语句</a></p>
                     </li>
                  </ul>
               </div><a id="RATUG279"></a><a id="RATUG188"></a><div class="props_rev_3"><a id="GUID-9EA13E7E-89AE-414B-8297-542F3D1755E7" name="GUID-9EA13E7E-89AE-414B-8297-542F3D1755E7"></a><h4 id="RATUG-GUID-9EA13E7E-89AE-414B-8297-542F3D1755E7" class="sect4"><span class="enumeration_section">6.1.1</span>使用Oracle Enterprise Manager分析SQL性能</h4>
                  <div>
                     <p>本节介绍如何使用Oracle Enterprise Manager分析系统更改之前和之后的SQL性能。</p>
                     <div class="p">在比较SQL试验之前，您需要创建一个更改后的SQL试用版，如<a href="creating-a-post-change-sql-trial.html#GUID-CE3A1060-2BD8-4EA9-81F8-E101CD9AD9D5" title="计算更改前的SQL性能数据后，可以在测试系统上执行系统更改。">创建更改后的SQL试用版中所述</a> 。
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-9EA13E7E-89AE-414B-8297-542F3D1755E7__GUID-FDC1CEF9-028B-4123-8D8C-C3F657EF6179">使用Enterprise Manager分析SQL性能：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ol>
                           <li>
                              <p>在“引导式工作流”页面上，单击“比较步骤2”和“步骤3”的“ <span class="bold">执行”</span>图标。
                              </p>
                              <p>将显示“运行SQL试用版比较”页面。</p>
                              <div class="figure" id="GUID-9EA13E7E-89AE-414B-8297-542F3D1755E7__GUID-181151DB-6CDF-4AC1-B9E0-882B811C4D12"><img src="img/spa_run_trial_compare.gif" width="486" alt="spa_run_trial_compare.gif的描述如下" title="spa_run_trial_compare.gif的描述如下" longdesc="img_text/spa_run_trial_compare.html"><br><a href="img_text/spa_run_trial_compare.html">插图描述spa_run_trial_compare.gif</a></div>
                              <!-- class="figure" -->
                              <p>在此示例中，选择<code class="codeph">SQL_TRIAL_1241213421833</code>和<code class="codeph">SQL_TRIAL_1241213881923</code>试验进行比较。
                              </p>
                           </li>
                           <li>
                              <p>要比较默认列出的试验以外的试验，请在<span class="bold">试验1名称</span>和<span class="bold">试验2名称</span>列表中选择所需的试验。
                              </p>
                              <p>请注意，您无法将统计试验与仅测试解释计划的试验进行比较。</p>
                           </li>
                           <li>
                              <p>在“比较度量标准”列表中，选择要用于比较分析的比较度量标准：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><span class="bold">经过的时间</span></p>
                                 </li>
                                 <li>
                                    <p><span class="bold">CPU时间</span></p>
                                 </li>
                                 <li>
                                    <p><span class="bold">用户I / O时间</span></p>
                                 </li>
                                 <li>
                                    <p><span class="bold">缓冲区获取</span></p>
                                 </li>
                                 <li>
                                    <p><span class="bold">物理I / O.</span></p>
                                 </li>
                                 <li>
                                    <p><span class="bold">优化成本</span></p>
                                 </li>
                                 <li>
                                    <p><span class="bold">I / O互连字节</span></p>
                                 </li>
                              </ul>
                              <p>如果仅在SQL试验中生成执行计划，则优化程序成本是唯一可用的比较指标。</p>
                              <p>要使用多个比较指标执行比较分析，请通过使用不同的指标重复此过程来执行单独的比较分析。</p>
                           </li>
                           <li>
                              <p>在Schedule部分中：</p>
                              <ol type="a">
                                 <li>
                                    <p>在时区列表中，选择您的时区代码。</p>
                                 </li>
                                 <li>
                                    <p>选择<span class="bold">立即立即</span>启动任务，或<span class="bold">稍后</span>选择安排任务在使用日期和时间字段指定的时间启动。
                                    </p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>单击“ <span class="bold">提交”</span>
                              </p>
                              <p>比较分析开始时，将显示“引导工作流程”页面。</p>
                              <p>比较分析正在进行时，此步骤的状态图标将变为箭头图标。要刷新状态图标，请单击“ <span class="bold">刷新”</span> 。根据从更改前和更改后执行中收集的性能数据量，比较分析可能需要很长时间才能完成。比较分析完成后，“状态”图标将变为复选标记，并启用下一步的“执行”图标。
                              </p>
                           </li>
                           <li>
                              <p>SQL Performance Analyzer分析了更改前和更改后的性能数据后，生成可用于进一步分析的SQL Performance Analyzer报告。</p>
                              <p>在“引导式工作流程”页面上，单击“查看试用版比较报告”的“ <span class="bold">执行”</span>图标。
                              </p>
                              <p>将出现“SQL性能分析器任务报告”页面。查看报告，如<span class="q">“ <a href="comparing-sql-trials.html#GUID-98608C0D-8BA8-4F10-94D8-3AE987087CBF" title="完成SQL性能分析器任务后，生成的数据将生成到SQL性能分析器报告中，该报告将比较更改前和更改后的SQL性能。">使用Oracle Enterprise Manager查看SQL Performance Analyzer报告</a> ”中所述</span> 。
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="RATUG241"></a><a id="RATUG280"></a><a id="RATUG189"></a><div class="props_rev_3"><a id="GUID-98608C0D-8BA8-4F10-94D8-3AE987087CBF" name="GUID-98608C0D-8BA8-4F10-94D8-3AE987087CBF"></a><h4 id="RATUG-GUID-98608C0D-8BA8-4F10-94D8-3AE987087CBF" class="sect4"><span class="enumeration_section">6.1.2</span>使用Oracle Enterprise Manager查看SQL Performance Analyzer报告</h4>
                  <div>
                     <p>完成SQL性能分析器任务后，生成的数据将生成到SQL性能分析器报告中，该报告将比较更改前和更改后的SQL性能。</p>
                     <p><a href="comparing-sql-trials.html#GUID-98608C0D-8BA8-4F10-94D8-3AE987087CBF__CACCEHEA">图6-1</a>显示了一个示例<a id="d9478e522" class="indexterm-anchor"></a> SQL性能分析器报告。此示例报告使用经过时间比较度量标准来比较SQL工作负载的更改前和执行后更改。
                     </p>
                     <div class="figure" id="GUID-98608C0D-8BA8-4F10-94D8-3AE987087CBF__CACCEHEA">
                        <p class="titleinfigure">图6-1 SQL性能分析器报告</p><img src="img/spa_report.gif" width="506" alt="下面是图6-1的描述" title="下面是图6-1的描述" longdesc="img_text/spa_report.html"><br><a href="img_text/spa_report.html">“图6-1 SQL性能分析器报告”的说明</a></div>
                     <!-- class="figure" -->
                     <p>在查看SQL Performance Analyzer报告之前，请将性能数据的更改前版本与更改后的版本<span class="q"><a href="comparing-sql-trials.html#GUID-B9A39A45-935B-47B6-A34C-6D0D47BC91F3" title="Comparing SQL trials using Oracle Enterprise Manager involves the following steps:">进行比较</a></span> ，如<span class="q">“ <a href="comparing-sql-trials.html#GUID-B9A39A45-935B-47B6-A34C-6D0D47BC91F3" title="使用Oracle Enterprise Manager比较SQL试验涉及以下步骤：">使用Oracle Enterprise Manager比较SQL试验</a> ”中所述</span></p>
                     <div class="section">
                        <p class="subhead3" id="GUID-98608C0D-8BA8-4F10-94D8-3AE987087CBF__GUID-A199B1A0-B62F-4639-94F1-809359635E0F">要生成并查看SQL Performance Analyzer报告：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ol>
                           <li>
                              <p>从<span class="bold">Performance</span>菜单中，选择<span class="bold">SQL</span> ，然后选择<span class="bold">SQL Performance Analyzer</span> 。
                              </p>
                              <p>如果出现“数据库登录”页面，则以具有管理员权限的用户身份登录。</p>
                              <p>将出现SQL Performance Analyzer主页。将显示现有SQL Performance Analyzer任务的列表。</p>
                           </li>
                           <li>
                              <p>在“SQL性能分析器任务”下，选择要查看SQL Performance Analyzer报告的任务，然后单击“ <span class="bold">查看最新报告”</span> 。
                              </p>
                              <p>将出现“SQL性能分析器任务报告”页面。</p>
                           </li>
                           <li>
                              <p>查看有关性能分析的一般信息，如<span class="q">“ <a href="comparing-sql-trials.html#GUID-0266EC0E-CEE1-4EF7-96F2-FFA729E6D97C" title="“常规信息”部分包含有关SQL Performance Analyzer执行的工作负载比较的基本信息和元数据。">查看SQL Performance Analyzer报告：常规信息</a> ”中所述</span> 。
                              </p>
                           </li>
                           <li>
                              <p>查看常规统计信息，如<span class="q">“ <a href="comparing-sql-trials.html#GUID-A35579C8-3065-49C7-926D-7349817B9D3B" title="“全局统计信息”部分报告描述整个SQL工作负载的整体性能的统计信息。">查看SQL Performance Analyzer报告：全局统计信息</a> ”中所述</span> 。
                              </p>
                           </li>
                           <li>
                              <p>（可选）查看详细统计信息，如<span class="q">“ <a href="comparing-sql-trials.html#GUID-50D7F38B-05D2-42C9-9C80-D5A0AC026695" title="您可以使用SQL性能分析器报告获取SQL工作负载比较的详细统计信息。">查看SQL Performance Analyzer报告：全局统计信息详细信息</a> ”中所述</span> 。
                              </p>
                           </li>
                           <li>
                              <p>要生成活动报告，请单击“ <span class="bold">保存”</span>以生成并保存报告，或单击“ <span class="bold">邮件”</span>以生成报告并将其作为HTML附件邮寄。
                              </p>
                              <p>活动报告包括有关每个类别的顶级SQL语句的信息（例如改进，回归和更改的计划），其中包含更改前和更改后的统计信息，解释计划和任务摘要。</p>
                              <p>有关详细信息，请参阅<span class="q">“ <a href="comparing-sql-trials.html#GUID-9C252273-EF17-4342-A7B4-D44C03F9D697" title="SQL Performance Analyzer活动报告是HTML文件，使用Web托管的交互式用户界面显示所有报告数据。">关于SQL Performance Analyzer活动报告</a> ”</span> 。
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div><a id="RATUG281"></a><a id="RATUG190"></a><div class="props_rev_3"><a id="GUID-0266EC0E-CEE1-4EF7-96F2-FFA729E6D97C" name="GUID-0266EC0E-CEE1-4EF7-96F2-FFA729E6D97C"></a><h5 id="RATUG-GUID-0266EC0E-CEE1-4EF7-96F2-FFA729E6D97C" class="sect5"><span class="enumeration_section">6.1.2.1</span>查看SQL Performance Analyzer报告：一般信息</h5>
                     <div>
                        <p>“常规信息”部分包含有关SQL Performance Analyzer执行的工作负载比较的基本信息和元数据。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-0266EC0E-CEE1-4EF7-96F2-FFA729E6D97C__GUID-A374FB0C-F502-4224-B849-A9CA1ABB9113">要查看一般信息：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>在“SQL性能分析器任务报告”页面上，查看页面顶部的摘要。</span><div>
                                 <div class="figure" id="GUID-0266EC0E-CEE1-4EF7-96F2-FFA729E6D97C__GUID-8ACC7FB7-AE23-4D4F-B2D7-2BC4417F3591"><img src="img/spa_report_info.gif" width="296" alt="spa_report_info.gif的描述如下" title="spa_report_info.gif的描述如下" longdesc="img_text/spa_report_info.html"><br><a href="img_text/spa_report_info.html">插图描述spa_report_info.gif</a></div>
                                 <!-- class="figure" -->
                                 <p>此摘要包括以下信息：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>SQL调优集的名称和所有者</p>
                                    </li>
                                    <li>
                                       <p>调优集中的SQL语句总数和有错误的SQL语句数不受支持或超时</p>
                                    </li>
                                    <li>
                                       <p>SQL试验的名称和使用的比较指标</p>
                                    </li>
                                 </ul>
                              </div>
                           </li>
                           <li class="stepexpand"><span>（可选）单击“SQL调整集名称”旁边的链接。</span><div>
                                 <p>将出现“SQL调整集”页面。</p>
                                 <p>此页面包含有关SQL调优集中每个SQL语句的信息（如SQL ID和SQL文本）。</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>如果发现错误，请单击“带错误的SQL语句”旁边的链接。</span><div>
                                 <p>Errors表报告执行给定SQL工作负载时发生的所有错误。如果SQL调优集中的所有SQL执行都是通用的，则可以在SQL调优集级别报告错误，如果特定于SQL语句或执行计划，则可以在执行级别报告错误。</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>查看全局统计信息，如<span class="q">“ <a href="comparing-sql-trials.html#GUID-A35579C8-3065-49C7-926D-7349817B9D3B" title="“全局统计信息”部分报告描述整个SQL工作负载的整体性能的统计信息。">查看SQL Performance Analyzer报告：全局统计信息</a> ”中所述</span> 。</span></li>
                        </ol>
                     </div>
                  </div><a id="RATUG282"></a><a id="RATUG191"></a><div class="props_rev_3"><a id="GUID-A35579C8-3065-49C7-926D-7349817B9D3B" name="GUID-A35579C8-3065-49C7-926D-7349817B9D3B"></a><h5 id="RATUG-GUID-A35579C8-3065-49C7-926D-7349817B9D3B" class="sect5"><span class="enumeration_section">6.1.2.2</span>查看SQL Performance Analyzer报告：全局统计信息</h5>
                     <div>
                        <div><span>“全局统计信息”部分报告描述整个SQL工作负载的整体性能的统计信息。</span> 本节是SQL Performance Analyzer分析的一个非常重要的部分，因为它报告了系统更改对SQL工作负载整体性能的影响。使用本节中的信息可以了解工作负载性能的趋势，并确定系统更改将如何影响它。
                        </div>
                        <div class="section">
                           <p class="subhead3" id="GUID-A35579C8-3065-49C7-926D-7349817B9D3B__GUID-7F6B0144-2760-4B28-B787-5AA3F913DC2B">要查看全球统计数据：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>查看Projected Workload Elapsed Time子部分中的图表。</span><div>
                                 <div class="infoboxnote" id="GUID-A35579C8-3065-49C7-926D-7349817B9D3B__GUID-D8B424EE-ECA7-4402-A4CD-F2648111FF27">
                                    <p class="notep1">注意：</p>
                                    <p>子部分的名称可能会根据所选的比较指标而有所不同。</p>
                                 </div>
                                 <p>该图表显示了x轴上的两个试验和y轴上的经过时间（以秒为单位）。</p>
                                 <div class="figure" id="GUID-A35579C8-3065-49C7-926D-7349817B9D3B__GUID-1EFFAC21-D810-40FC-AD23-9D976F0C76DF"><img src="img/spa_report_elapsed_time.gif" width="198" alt="spa_report_elapsed_time.gif的描述如下" title="spa_report_elapsed_time.gif的描述如下" longdesc="img_text/spa_report_elapsed_time.html"><br><a href="img_text/spa_report_elapsed_time.html">插图描述spa_report_elapsed_time.gif</a></div>
                                 <!-- class="figure" -->
                                 <p>最重要的统计数据是总体影响，以百分比形式给出。总体影响是改善影响与回归影响之间的差异。您可以单击任何影响统计信息的链接以获取更多详细信息，如<span class="q">“ <a href="comparing-sql-trials.html#GUID-50D7F38B-05D2-42C9-9C80-D5A0AC026695" title="您可以使用SQL性能分析器报告获取SQL工作负载比较的详细统计信息。">查看SQL性能分析器报告：全局统计信息详细信息</a> ”中所述</span> 。
                                 </p>
                                 <p>在这个例子中，改进影响是20％，而回归影响是-2％，因此系统变化的总体影响是大约18％的改善。这意味着如果在此示例中修复了所有回归，则更改的总体影响将提高20％。</p>
                                 <div class="infoboxnote" id="GUID-A35579C8-3065-49C7-926D-7349817B9D3B__GUID-B3D3246D-9720-4517-AAF7-28DD32BDA613">
                                    <p class="notep1">注意：</p>
                                    <p>与改善影响和回归影响的总和相比，整体影响百分比有时可能会下降1％。这种差异可能是由舍入或SQL和工作负载时间限制设置为1％（建议值）引起的。这使得分析能够过滤掉影响最小的SQL语句，从而将重点放在具有更高影响力的SQL语句上。</p>
                                 </div>
                              </div>
                           </li>
                           <li class="stepexpand"><span>查看SQL语句计数子部分中的图表。</span><div>
                                 <p>图表的x轴显示系统更改后性能提高，退化或保持不变的SQL语句数。y轴显示SQL语句的数量。该图表还指示是否针对SQL语句更改了解释计划。</p>
                                 <div class="figure" id="GUID-A35579C8-3065-49C7-926D-7349817B9D3B__GUID-42B3C540-CCA1-4697-8402-B7F9AC4FF7F9"><img src="img/spa_report_sql_count.gif" width="258" alt="spa_report_sql_count.gif的描述如下" title="spa_report_sql_count.gif的描述如下" longdesc="img_text/spa_report_sql_count.html"><br><a href="img_text/spa_report_sql_count.html">插图描述spa_report_sql_count.gif</a></div>
                                 <!-- class="figure" -->
                                 <p>此图表使您可以快速权衡SQL语句的相对性能。您可以单击图表中的任何栏以获取有关SQL语句的更多详细信息，如<span class="q">“ <a href="comparing-sql-trials.html#GUID-50D7F38B-05D2-42C9-9C80-D5A0AC026695" title="您可以使用SQL性能分析器报告获取SQL工作负载比较的详细统计信息。">查看SQL性能分析器报告：全局统计信息详细信息</a> ”中所述</span> 。即使实际的SQL语句数超过100，也只会显示前100个SQL语句。
                                 </p>
                                 <p>在此示例中，系统更改后所有SQL语句都保持不变。</p>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="RATUG283"></a><a id="RATUG192"></a><div class="props_rev_3"><a id="GUID-50D7F38B-05D2-42C9-9C80-D5A0AC026695" name="GUID-50D7F38B-05D2-42C9-9C80-D5A0AC026695"></a><h5 id="RATUG-GUID-50D7F38B-05D2-42C9-9C80-D5A0AC026695" class="sect5"><span class="enumeration_section">6.1.2.3</span>查看SQL Performance Analyzer报告：全局统计详细信息</h5>
                     <div>
                        <div><span>您可以使用SQL性能分析器报告获取SQL工作负载比较的详细统计信息。</span> 通过详细信息图表，您可以深入了解报表中显示的SQL语句的性能。使用本节中的信息来调查特定SQL语句的性能退化的原因。
                        </div>
                        <div class="section">
                           <div class="infoboxnote" id="GUID-50D7F38B-05D2-42C9-9C80-D5A0AC026695__GUID-99C03DEF-5FC1-438F-BF44-4FAFB4590331">
                              <p class="notep1">注意：</p>
                              <p>即使实际的SQL语句数超过100，报告也只显示前100个SQL语句。</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-50D7F38B-05D2-42C9-9C80-D5A0AC026695__GUID-D0402052-4E87-4CF0-9684-9D65875F6D55">要查看全局统计详细信息：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>在“预计工作负载已用时间”子部分中，单击要查看其详细信息的SQL语句的影响百分比。要查看其性能的SQL语句：</span><div>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>改进后，单击“改进影响”的百分比</p>
                                    </li>
                                    <li>
                                       <p>退回，单击“回归影响”的百分比</p>
                                    </li>
                                    <li>
                                       <p>改进或退回，单击“总体影响”的百分比</p>
                                    </li>
                                 </ul>
                                 <p>将出现包含详细统计信息的表格。根据所选SQL语句的类型，包括以下列：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>SQL ID</p>
                                       <p>此列指示SQL语句的ID。</p>
                                    </li>
                                    <li>
                                       <p>对工作量的净影响（％）</p>
                                       <p>此列指示系统更改相对于SQL工作负载性能的影响。</p>
                                    </li>
                                    <li>
                                       <p>经过的时间</p>
                                       <p>此列指示SQL语句执行的总时间（以秒为单位）。</p>
                                    </li>
                                    <li>
                                       <p>对SQL的净影响（％）</p>
                                       <p>此列指示更改对特定SQL语句性能的本地影响。</p>
                                    </li>
                                    <li>
                                       <p>新计划</p>
                                       <p>此列指示SQL执行计划是否已更改。</p>
                                    </li>
                                 </ul>
                              </div>
                           </li>
                           <li class="stepexpand"><span>要查看有关特定SQL语句的详细信息，请单击您感兴趣的SQL语句的SQL ID链接。</span><div>
                                 <p>将出现“SQL详细信息”页面</p>
                                 <p>您可以使用此页面访问SQL文本并获取有关SQL语句的低级详细信息，例如其执行统计信息和执行计划。</p>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="RATUG321"></a><div class="props_rev_3"><a id="GUID-9C252273-EF17-4342-A7B4-D44C03F9D697" name="GUID-9C252273-EF17-4342-A7B4-D44C03F9D697"></a><h5 id="RATUG-GUID-9C252273-EF17-4342-A7B4-D44C03F9D697" class="sect5"><span class="enumeration_section">6.1.2.4</span>关于SQL Performance Analyzer活动报告</h5>
                     <div>
                        <div><span>SQL Performance Analyzer活动报告是HTML文件，使用Web托管的交互式用户界面显示所有报告数据。</span> 与Oracle Enterprise Manager中提供的SQL Performance Analyzer报告类似，活动报告包含有关每个类别的顶级SQL语句的信息（例如改进，回归和更改的计划），其中包含更改前和更改后的统计信息，解释计划和任务摘要。
                        </div>
                        <p>SQL Performance Analyzer活动报告比传统的HTML或文本报告更有用，因为它们提供与Oracle Enterprise Manager类似的用户界面，但即使在数据库不可用时，甚至在删除数据库之后，也可以查看它们。因此，活动报告提供了传统报告和动态Oracle Enterprise Manager分析的优势，但消除了两者的缺点。此外，活动报告包含有关比较分析的更多信息，并提供更多用户交互选项。强烈建议您使用活动报告而不是HTML或文本报告。</p>
                        <p>活动报告用户界面组件与Oracle Enterprise Manager中显示的组件非常相似。有关用户界面组件的说明，请参阅<span class="q"><a href="comparing-sql-trials.html#GUID-98608C0D-8BA8-4F10-94D8-3AE987087CBF" title="完成SQL性能分析器任务后，生成的数据将生成到SQL性能分析器报告中，该报告将比较更改前和更改后的SQL性能。">“使用Oracle Enterprise Manager查看SQL Performance Analyzer报告</a> ”中</span>描述的相关章节。
                        </p>
                     </div>
                  </div>
               </div><a id="RATUG193"></a><div class="props_rev_3"><a id="GUID-A86879DB-BB8B-4F97-91BF-12CB045932C0" name="GUID-A86879DB-BB8B-4F97-91BF-12CB045932C0"></a><h4 id="RATUG-GUID-A86879DB-BB8B-4F97-91BF-12CB045932C0" class="sect4"><span class="enumeration_section">6.1.3</span>使用Oracle Enterprise Manager调整回归的SQL语句</h4>
                  <div>
                     <div><span>在查看SQL Performance Analyzer报告之后，您应该在比较SQL性能之后调整所识别的任何回归SQL语句。</span> 如果有大量SQL语句似乎已退化，则应尝试确定根本原因并进行系统级更改以纠正问题。如果只有少数SQL语句退化，请考虑使用以下调整方法之一为它们实现点解决方案：</div>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="comparing-sql-trials.html#GUID-BE751C8C-0278-4553-AA65-1CE3DE3F56D3" title="通过创建SQL计划基准，优化程序可以通过使用具有已知性能特征的执行计划来避免性能回归。如果由于计划更改而发生性能回归，则可以创建SQL计划基准并用于阻止优化程序选择新的，已回归的执行计划。">创建SQL计划基准</a></p>
                        </li>
                        <li>
                           <p><a href="comparing-sql-trials.html#GUID-E1F23EFE-458B-4CA0-8EA1-42C77C7B7C2B" title="SQL Tuning Advisor对退回的SQL语句执行深入分析，并尝试解决问题的根本原因。">运行SQL Tuning Advisor</a></p>
                        </li>
                     </ul>
                     <p>在调优回归的SQL语句之后，您应该使用SQL Performance Analyzer测试这些更改。在测试系统上运行新的SQL试用版，然后进行第二次比较（在此新SQL试用版和第一个SQL试用版之间）以验证结果。一旦SQL Performance Analyzer显示性能稳定，测试就完成了。从此步骤实施修复程序到生产系统。</p>
                     <p>从Oracle Database <span class="italic">11g</span>第1版开始，SQL Tuning Advisor在调优SQL语句时执行备用计划分析。SQL Tuning Advisor在当前系统中搜索以前的执行计划，包括第一次SQL试验的计划。如果第一个SQL试用版的执行计划与第二个SQL试用版的执行计划不同，则SQL Tuning Advisor将推荐第一个SQL试用版的计划。如果这些执行计划产生更好的性能，您可以使用第一个SQL试验中的计划创建计划基准。
                     </p>
                     <div class="infoboxnote" id="GUID-A86879DB-BB8B-4F97-91BF-12CB045932C0__GUID-D5543397-EEA4-48E4-BFEC-38E4252733BB">
                        <p class="notep1">注意：</p>
                        <p>SQL Performance Analyzer在完成远程SQL试用后，不提供创建SQL计划基准或直接运行SQL Tuning Advisor的选项。在这种情况下，您需要使用API手动传输SQL调优集并在远程数据库上完成相应的过程。</p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-A86879DB-BB8B-4F97-91BF-12CB045932C0__GUID-962A1FC2-6694-4270-89C0-DA0BFFAF8C28">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关备用计划分析的信息，请<a href="../tgsql/sql-tuning-advisor.html#TGSQL558" target="_blank"><span><cite>参见“Oracle数据库SQL调整指南”</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="RATUG284"></a><a id="RATUG194"></a><div class="props_rev_3"><a id="GUID-BE751C8C-0278-4553-AA65-1CE3DE3F56D3" name="GUID-BE751C8C-0278-4553-AA65-1CE3DE3F56D3"></a><h5 id="RATUG-GUID-BE751C8C-0278-4553-AA65-1CE3DE3F56D3" class="sect5"><span class="enumeration_section">6.1.3.1</span>创建SQL计划基准</h5>
                     <div>
                        <p>通过创建SQL计划基准，优化程序可以通过使用具有已知性能特征的执行计划来避免性能回归。如果由于计划更改而发生性能回归，则可以创建SQL计划基准并用于阻止优化程序选择新的，已回归的执行计划。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-BE751C8C-0278-4553-AA65-1CE3DE3F56D3__GUID-7A7A06F5-BC37-4905-A6D4-54CF986383F7">要创建SQL计划基准：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ol>
                              <li>
                                 <p>在“SQL性能分析器任务结果”页上的“建议”下，单击“ <span class="bold">创建SQL计划基准”</span> 。
                                 </p>
                                 <p>将出现“创建SQL计划基准”页面。“已回归的SQL语句”部分列出了将与新SQL计划基准关联的已回归SQL语句。</p>
                              </li>
                              <li>
                                 <p>在“作业参数”下，指定作业的参数：</p>
                                 <ol type="a">
                                    <li>
                                       <p>在“作业名称”字段中，输入作业的名称。</p>
                                    </li>
                                    <li>
                                       <p>在“描述”字段中，可以选择输入作业的描述。</p>
                                    </li>
                                 </ol>
                              </li>
                              <li>
                                 <p>在计划下，选择：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><span class="bold">马上</span>开始工作吧。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="bold">稍后</span> ，安排作业在使用“时区”，“日期”和“时间”字段指定的时间开始。
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>单击<span class="bold">确定</span> 。</p>
                                 <p>将出现“SQL性能分析器任务结果”页面。将显示一条消息，通知您作业已成功提交。</p>
                              </li>
                           </ol>
                           <div class="infoboxnotealso" id="GUID-BE751C8C-0278-4553-AA65-1CE3DE3F56D3__GUID-FDF414BF-B6FA-46D8-B5CF-57BC04AA9F9D">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>有关创建和管理SQL计划基准的信息，请<a href="../tdppt/tuning-sql-statements.html#TDPPT335" target="_blank"><span><cite>参见“Oracle数据库2天+性能调整指南”</cite></span></a></p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="RATUG285"></a><a id="RATUG195"></a><div class="props_rev_3"><a id="GUID-E1F23EFE-458B-4CA0-8EA1-42C77C7B7C2B" name="GUID-E1F23EFE-458B-4CA0-8EA1-42C77C7B7C2B"></a><h5 id="RATUG-GUID-E1F23EFE-458B-4CA0-8EA1-42C77C7B7C2B" class="sect5"><span class="enumeration_section">6.1.3.2</span>运行SQL Tuning Advisor</h5>
                     <div>
                        <p>SQL Tuning Advisor对退回的SQL语句执行深入分析，并尝试解决问题的根本原因。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-E1F23EFE-458B-4CA0-8EA1-42C77C7B7C2B__GUID-70812BEA-1D8E-4808-8BFE-197154CB6E55">要运行SQL Tuning Advisor：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>在“SQL性能分析器任务结果”页上的“建议<span class="bold">”</span>下，单击<span class="bold">“运行SQL调优顾问”</span> 。</span><div>
                                 <p>将出现“计划SQL调整任务”页面。</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>在“调整任务名称”字段中，输入SQL调整任务的名称。</span></li>
                           <li class="stepexpand"><span>在“调整任务描述”字段中，可以选择输入SQL调整任务的名称。</span></li>
                           <li class="stepexpand"><span>在计划下，选择：</span><div>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><span class="bold">马上</span>开始工作吧。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="bold">稍后</span> ，安排作业在使用“时区”，“日期”和“时间”字段指定的时间开始。
                                       </p>
                                    </li>
                                 </ul>
                              </div>
                           </li>
                           <li class="stepexpand"><span>单击<span class="bold">确定</span> 。</span><div>
                                 <p>将出现“SQL性能分析器任务结果”页面。“建议”下将显示指向SQL调整报告的链接。</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>要查看SQL调整报告，请单击“SQL调整报告”链接。</span><div>
                                 <p>将出现“SQL调整结果”页面。</p>
                              </div>
                           </li>
                        </ol>
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-E1F23EFE-458B-4CA0-8EA1-42C77C7B7C2B__GUID-DBC5115E-D981-4C52-86AD-A322BFF2595F">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>有关运行SQL Tuning Advisor的信息，请<a href="../tdppt/tuning-sql-statements.html#TDPPT161" target="_blank"><span><cite>参见“Oracle数据库2天+性能调整指南”</cite></span></a></p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="RATUG196"></a><div class="props_rev_3"><a id="GUID-36FDBD56-32CD-4A47-B7FB-5A20CDD1EF82" name="GUID-36FDBD56-32CD-4A47-B7FB-5A20CDD1EF82"></a><h3 id="RATUG-GUID-36FDBD56-32CD-4A47-B7FB-5A20CDD1EF82" class="sect3"><span class="enumeration_section">6.2</span>使用API比较SQL试验</h3>
               <div>
                  <p>使用API比较SQL试验涉及以下步骤：</p>
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="comparing-sql-trials.html#GUID-BA40A195-CB93-459E-B365-BFB2BA40BD30" title="在构建更改后的SQL性能数据之后，您可以将性能数据的更改前版本与更改后的版本进行比较。">使用API分析SQL性能</a></p>
                        </li>
                        <li>
                           <p><a href="comparing-sql-trials.html#GUID-1B56ACA0-7C76-4963-B645-E90FB1968840" title="SQL Performance Analyzer报告分为以下几个部分：">在命令行中查看SQL Performance Analyzer报告</a></p>
                        </li>
                        <li>
                           <p><a href="comparing-sql-trials.html#GUID-F3DC6B55-4070-4F2F-AB63-DFEE8AFEDA47">使用API比较SQL调优集</a></p>
                        </li>
                        <li>
                           <p><a href="comparing-sql-trials.html#GUID-B85471DE-CC06-4E02-AFA6-AD207D94C8C8">使用API调整回归的SQL语句</a></p>
                        </li>
                        <li>
                           <p><a href="comparing-sql-trials.html#GUID-0B629FA1-FF45-44D0-BB2D-28FF762BC102">使用API调整远程SQL试验中的回归SQL语句</a></p>
                        </li>
                        <li>
                           <p><a href="comparing-sql-trials.html#GUID-48F67DD6-70B6-49CC-B4B3-72F2D80E6DDD">使用API创建SQL计划基准</a></p>
                        </li>
                        <li>
                           <p><a href="comparing-sql-trials.html#GUID-88737A1B-A21D-437A-AA8B-8D86B2048A77">使用SQL性能分析器视图</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="p">在比较SQL试验之前，您需要创建一个更改后的SQL试用版，如<a href="creating-a-post-change-sql-trial.html#GUID-CE3A1060-2BD8-4EA9-81F8-E101CD9AD9D5" title="计算更改前的SQL性能数据后，可以在测试系统上执行系统更改。">创建更改后的SQL试用版中所述</a> 。
                  </div>
                  <!-- class="section" -->
               </div><a id="RATUG197"></a><div class="props_rev_3"><a id="GUID-BA40A195-CB93-459E-B365-BFB2BA40BD30" name="GUID-BA40A195-CB93-459E-B365-BFB2BA40BD30"></a><h4 id="RATUG-GUID-BA40A195-CB93-459E-B365-BFB2BA40BD30" class="sect4"><span class="enumeration_section">6.2.1</span>使用API分析SQL性能</h4>
                  <div>
                     <div><span>在构建更改后的SQL性能数据之后，您可以将性能数据的更改前版本与更改后的版本进行比较。</span> 使用<code class="codeph">DBMS_SQLPA.EXECUTE_ANALYSIS_TASK</code>过程或函数运行比较分析。
                     </div>
                     <div class="section">
                        <p class="subhead3" id="GUID-BA40A195-CB93-459E-B365-BFB2BA40BD30__GUID-F75DB3A9-E866-4E12-9CB1-365A4C7E272F">要比较更改前和更改后的SQL性能数据：</p>
                        <ol>
                           <li>
                              <p>打电话给<a id="d9478e1755" class="indexterm-anchor"></a> <code class="codeph">EXECUTE_ANALYSIS_TASK</code>过程或函数使用以下参数：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>将<code class="codeph">task_name</code>参数设置为SQL Performance Analyzer任务的名称。
                                    </p>
                                 </li>
                                 <li>
                                    <p>将<code class="codeph">execution_type</code>参数设置为<code class="codeph">COMPARE PERFORMANCE</code> 。此设置将分析和比较两个版本的SQL性能数据。
                                    </p>
                                 </li>
                                 <li>
                                    <p>使用<code class="codeph">execution_name</code>参数指定名称以标识<code class="codeph">execution_name</code> 。如果未指定，它将由SQL Performance Analyzer生成并由函数返回。
                                    </p>
                                 </li>
                                 <li>
                                    <p>使用<code class="codeph">execution_params</code>参数指定两个版本的SQL性能数据。<code class="codeph">execution_params</code>参数被指定为指定执行的（ <span class="italic">名称</span> ， <span class="italic">值</span> ）对。设置与比较和分析SQL性能数据相关的执行参数，如下所示：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p>将<code class="codeph">execution_name1</code>参数设置为第一次执行的名称（在进行系统更改之前）。此值应对应于<span class="q">“ <a href="creating-a-pre-change-sql-trial.html#GUID-93D5C8A9-7E85-4467-B3E4-323B1732BA5D" title="本节介绍如何使用DBMS_SQLPA包构建更改前的性能数据。">使用API创建预更改SQL试验</a> ”中</span>指定的<code class="codeph">execution_name</code>参数的值。
                                          </p>
                                       </li>
                                       <li>
                                          <p>将<code class="codeph">execution_name2</code>参数设置为第二次执行的名称（在进行系统更改后）。此值应对应于在系统更改后执行SQL工作负载时<span class="q">“ <a href="creating-a-post-change-sql-trial.html#GUID-0C96536D-8129-4794-8527-1AA9FD240E2C" title="本节介绍如何使用DBMS_SQLPA包收集更改后的SQL性能数据。">使用API创建更改后SQL试验</a> ”中</span>指定的<code class="codeph">execution_name</code>参数的值。如果调用者未指定执行，则默认情况下SQL Performance Analyzer将始终比较最后两个任务执行。
                                          </p>
                                       </li>
                                       <li>
                                          <p>设置<code class="codeph">comparison_metric</code>参数以指定要在性能影响分析中使用的执行统计信息的表达式。可能的值包括以下度量标准或它们的任意组合： <code class="codeph">elapsed_time</code> （默认值）， <code class="codeph">cpu_time</code> ， <code class="codeph">buffer_gets</code> ， <code class="codeph">disk_reads</code> ， <code class="codeph">direct_writes</code> ， <code class="codeph">optimizer_cost</code>和<code class="codeph">io_interconnect_bytes</code> 。
                                          </p>
                                       </li>
                                    </ul>
                                    <p>有关可以设置用于比较的其他可能参数，请参阅<a href="../arpls/DBMS_SQLPA.html#ARPLS229" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>中的<code class="codeph">DBMS_SQLPA</code>包的说明。
                                    </p>
                                 </li>
                              </ul>
                              <p>以下示例说明了函数调用：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_SQLPA.EXECUTE_ANALYSIS_TASK（task_name =&gt;'my_spa_task'， -  execution_type =&gt;'COMPARE PERFORMANCE'， -  execution_name =&gt;'my_exec_compare'， -  execution_params =&gt; dbms_advisor.arglist（ - 'comparison_metric'，'buffer_gets'））;</pre></li>
                           <li>
                              <p>打电话给<a id="d9478e1884" class="indexterm-anchor"></a> <code class="codeph">REPORT_ANALYSIS_TASK</code>函数使用以下参数：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>将<code class="codeph">task_name</code>参数设置为SQL Performance Analyzer任务的名称。
                                    </p>
                                 </li>
                                 <li>
                                    <p>将<code class="codeph">execution_name</code>参数设置为要使用的执行名称。此值应与要为其生成报告的执行的<code class="codeph">execution_name</code>参数匹配。
                                    </p>
                                    <p>生成报告以显示以下结果：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p>为SQL工作负载生成的执行计划，将此值设置为与所需<code class="codeph">EXPLAIN PLAN</code>执行的<code class="codeph">execution_name</code>参数匹配。
                                          </p>
                                       </li>
                                       <li>
                                          <p>为SQL工作负载生成的执行计划和执行统计信息，将此参数设置为与所需<code class="codeph">TEST EXECUTE</code>执行中使用的<code class="codeph">execution_name</code>参数的值相匹配。
                                          </p>
                                       </li>
                                       <li>
                                          <p>比较分析，将此值设置为与所需<code class="codeph">ANALYZE PERFORMANCE</code>执行的<code class="codeph">execution_name</code>参数匹配。
                                          </p>
                                       </li>
                                    </ul>
                                    <p>如果未指定，SQL Performance Analyzer将为上次执行生成报告。</p>
                                 </li>
                                 <li>
                                    <p>设置<code class="codeph">type</code>参数以指定要生成的报告类型。可能的值包括<code class="codeph">TEXT</code> （默认）， <code class="codeph">HTML</code> ， <code class="codeph">XML</code>和<code class="codeph">ACTIVE</code> 。</p>
                                    <p>活动报告使用交互式用户界面提供深入报告，即使在与数据库或Oracle Enterprise Manager断开连接时也可以执行详细分析。建议您尽可能使用活动报告而不是HTML或文本报告。</p>
                                    <p>有关活动报告的信息，请参阅<span class="q">“ <a href="comparing-sql-trials.html#GUID-9C252273-EF17-4342-A7B4-D44C03F9D697" title="SQL Performance Analyzer活动报告是HTML文件，使用Web托管的交互式用户界面显示所有报告数据。">关于SQL Performance Analyzer活动报告</a> ”</span> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p>设置<code class="codeph">level</code>参数以指定建议的格式。可能的值包括<code class="codeph">TYPICAL</code> （默认值）， <code class="codeph">ALL</code> ， <code class="codeph">BASIC</code> ， <code class="codeph">CHANGED</code> ， <code class="codeph">CHANGED_PLANS</code> ， <code class="codeph">ERRORS</code> ， <code class="codeph">IMPROVED</code> ， <code class="codeph">REGRESSED</code> ， <code class="codeph">TIMEOUT</code> ， <code class="codeph">UNCHANGED</code> ， <code class="codeph">UNCHANGED_PLANS</code>和<code class="codeph">UNSUPPORTED</code> 。</p>
                                 </li>
                                 <li>
                                    <p>设置<code class="codeph">section</code>参数以指定要在报告中生成的特定部分。可能的值包括<code class="codeph">SUMMARY</code> （默认）和<code class="codeph">ALL</code> 。</p>
                                 </li>
                                 <li>
                                    <p>设置<code class="codeph">top_sql</code>参数以指定要在报告中生成的SQL调整集中的SQL语句数。默认情况下，报告显示受系统更改影响的前100个SQL语句。
                                    </p>
                                 </li>
                              </ul>
                              <p>要生成活动报告，请运行以下脚本：</p><pre class="oac_no_warn" dir="ltr">在设置页面上设置trimTool上设置trimspool 0 set linesize 1000 set long 1000000 set longchunksize 1000000 spool spa_active.html SELECT DBMS_SQLPA.REPORT_ANALYSIS_TASK（task_name =&gt;'my_spa_task'，type =&gt;'active'，section =&gt;'all'）FROM dual ;假脱机</pre><p>以下示例说明了可用于以文本格式创建和显示比较摘要报告的SQL脚本的一部分：</p><pre class="oac_no_warn" dir="ltr">VAR rep CLOB; EXEC：rep：= DBMS_SQLPA.REPORT_ANALYSIS_TASK（'my_spa_task'， - 'text'，'typical'，'summary'）; SET LONG 100000 LONGCHUNKSIZE 100000 LINESIZE 130 PRINT：rep</pre></li>
                           <li>
                              <p>查看SQL Performance Analyzer报告，如<span class="q">“ <a href="comparing-sql-trials.html#GUID-1B56ACA0-7C76-4963-B645-E90FB1968840" title="SQL Performance Analyzer报告分为以下几个部分：">在命令行中查看SQL Performance Analyzer报告</a> ”中所述</span> 。
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-BA40A195-CB93-459E-B365-BFB2BA40BD30__GUID-C9D67AB8-0174-47F0-96BD-DFC898FF697C">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../arpls/DBMS_SQLPA.html#ARPLS229" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>有关<code class="codeph">DBMS_SQLPA.EXECUTE_ANALYSIS_TASK</code>和<code class="codeph">DBMS_SQLPA.REPORT_ANALYSIS_TASK</code>函数的信息</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="RATUG198"></a><div class="props_rev_3"><a id="GUID-1B56ACA0-7C76-4963-B645-E90FB1968840" name="GUID-1B56ACA0-7C76-4963-B645-E90FB1968840"></a><h4 id="RATUG-GUID-1B56ACA0-7C76-4963-B645-E90FB1968840" class="sect4"><span class="enumeration_section">6.2.2</span>在命令行中查看SQL Performance Analyzer报告</h4>
                  <div>
                     <p>SQL Performance Analyzer报告分为以下几个部分：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="comparing-sql-trials.html#GUID-3216D236-0ACD-4A6E-AE67-9990F29FCA0E" title="“常规信息”部分包含有关SQL性能分析器任务，使用的SQL调整集以及更改前和更改后执行的基本信息和元数据。">一般信息</a></p>
                        </li>
                        <li>
                           <p><a href="comparing-sql-trials.html#GUID-31322F60-DF07-423F-B439-1B79F84DE73B" title="“结果摘要”部分总结了SQL性能分析器任务的结果。">结果摘要</a></p>
                        </li>
                        <li>
                           <p><a href="comparing-sql-trials.html#GUID-42B29CF3-8A16-4025-9E27-085C5FFDF88D" title="“结果详细信息”部分表示深入了解报表的“结果摘要”部分中显示的SQL语句的性能">结果详情</a></p>
                        </li>
                     </ul>
                     <p>本节使用示例报告来说明如何查看<a id="d9478e2168" class="indexterm-anchor"></a> SQL性能分析器报告。示例报告使用<code class="codeph">buffer_gets</code>作为比较指标，以比较SQL工作负载的更改前和执行后更改。
                     </p>
                  </div><a id="RATUG242"></a><a id="RATUG199"></a><div class="props_rev_3"><a id="GUID-3216D236-0ACD-4A6E-AE67-9990F29FCA0E" name="GUID-3216D236-0ACD-4A6E-AE67-9990F29FCA0E"></a><h5 id="RATUG-GUID-3216D236-0ACD-4A6E-AE67-9990F29FCA0E" class="sect5"><span class="enumeration_section">6.2.2.1</span>一般信息</h5>
                     <div>
                        <div><span>“常规信息”部分包含有关SQL性能分析器任务，使用的SQL调整集以及更改前和更改后执行的基本信息和元数据。</span> <a href="comparing-sql-trials.html#GUID-3216D236-0ACD-4A6E-AE67-9990F29FCA0E__CDEDEJHC">示例6-1</a>显示了示例报告的“常规信息”部分。
                        </div>
                        <p>在<a href="comparing-sql-trials.html#GUID-3216D236-0ACD-4A6E-AE67-9990F29FCA0E__CDEDEJHC">示例6-1中</a> ，“任务信息”部分指示任务名称为<code class="codeph">my_spa_task</code> 。“工作负载信息”部分指示该任务会比较<code class="codeph">my_sts</code> SQL调优集的执行情况，该调优集包含101个SQL语句。如“执行信息”部分所示，比较执行名为<code class="codeph">my_exec_compare</code> 。
                        </p>
                        <p>“分析信息”部分显示SQL Performance Analyzer使用<code class="codeph">buffer_gets</code>作为比较指标，比较<code class="codeph">my_sts</code> SQL调优集<code class="codeph">my_exec_BEFORE_change</code>和<code class="codeph">my_exec_AFTER_change</code>两次执行。
                        </p>
                        <div class="example" id="GUID-3216D236-0ACD-4A6E-AE67-9990F29FCA0E__CDEDEJHC">
                           <p class="titleinexample">例6-1一般信息</p><pre class="oac_no_warn" dir="ltr">-------------------------------------------------- -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  - - 一般信息  -  - - -------------------------------------------------- --------------------------------------任务信息：工作量信息：------ --------------------------------------- ----------- ----------------------------------任务名称：my_spa_task SQL调优集名称：my_sts任务所有者：APPS SQL调优设置所有者：APPS描述：总SQL语句数：101执行信息：----------------------------------- -------------------------------------------------- --------执行名称：my_exec_compare已启动：05/21/2007 11:30:09执行类型：ANALYZE PERFORMANCE最后更新：05/21/2007 11:30:10描述：全球时间限制：无限范围：全面的每SQL时间限制：未处理状态：已完成错误数：0分析信息：------------------------------ -------------------------------------------------- -------------比较我tric：BUFFER_GETS ------------------工作负载影响阈值：1％----------------------- --- SQL影响阈值：1％----------------------变更执行前：变更执行后：----------- ---------------------------------- ---------------- -----------------------------执行名称：my_exec_BEFORE_change执行名称：my_exec_AFTER_change执行类型：TEST EXECUTE执行类型：TEST EXECUTE描述：描述：并行度：4度并行度：4范围：COMPREHENSIVE范围：COMPREHENSIVE状态：COMPLETED状态：已完成状态：05/21/2007 11:22:06已启动：05/21/2007 11:25:56最近更新： 2007年5月21日11:24:01最后更新：05/21/2007 11:28:30全局时间限制：1800全球时间限制：1800每SQL限时：未使用的每SQL时间限制：未使用的错误数：0错误数：0 ------------------------------------------- --------------------------------------------------</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="RATUG200"></a><div class="props_rev_3"><a id="GUID-31322F60-DF07-423F-B439-1B79F84DE73B" name="GUID-31322F60-DF07-423F-B439-1B79F84DE73B"></a><h5 id="RATUG-GUID-31322F60-DF07-423F-B439-1B79F84DE73B" class="sect5"><span class="enumeration_section">6.2.2.2</span>结果摘要</h5>
                     <div>
                        <div><span>“结果摘要”部分总结了SQL性能分析器任务的结果。</span> “结果摘要”部分分为以下小节：</div>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="comparing-sql-trials.html#GUID-3C4C77D7-ABB4-4E90-B293-D626A8AB0375" title="“整体性能统计信息”子部分显示有关整个SQL工作负载的整体性能的统计信息。">整体表现统计</a></p>
                           </li>
                           <li>
                              <p><a href="comparing-sql-trials.html#GUID-A1351A5A-E558-490A-ADF6-F0330BE28614" title="“性能统计信息”子部分突出显示受系统更改影响最严重的SQL语句。">SQL语句的性能统计信息</a></p>
                           </li>
                           <li>
                              <p><a href="comparing-sql-trials.html#GUID-65075150-82B0-4DEE-94AC-1B54CF49F7C9" title="“错误”子部分报告执行期间发生的所有错误。">错误</a></p>
                           </li>
                        </ul>
                     </div><a id="RATUG243"></a><a id="RATUG201"></a><div class="props_rev_3"><a id="GUID-3C4C77D7-ABB4-4E90-B293-D626A8AB0375" name="GUID-3C4C77D7-ABB4-4E90-B293-D626A8AB0375"></a><h6 id="RATUG-GUID-3C4C77D7-ABB4-4E90-B293-D626A8AB0375" class="sect6"><span class="enumeration_section">6.2.2.2.1</span>总体绩效统计</h6>
                        <div>
                           <div><span>“整体性能统计信息”子部分显示有关整个SQL工作负载的整体性能的统计信息。</span> 本节是SQL Performance Analyzer分析的一个非常重要的部分，因为它显示了系统更改对SQL工作负载整体性能的影响。使用本节中的信息可以了解工作负载性能的变化，并确定在进行系统更改后工作负载性能是否会提高或降低。
                           </div>
                           <p><a href="comparing-sql-trials.html#GUID-3C4C77D7-ABB4-4E90-B293-D626A8AB0375__CDEIIHEA">示例6-2</a>显示了示例报表的“整体性能统计”子部分。
                           </p>
                           <p>此示例表明，尽管回归具有-10.08％的负面影响，但SQL工作负载的整体性能提高了47.94％。这意味着如果在此示例中修复了所有回归，则整体变更影响将为58.02％。系统更改后，101个SQL语句中的2个运行得更快，而1个运行速度更慢。98项陈述的表现保持不变。</p>
                           <div class="example" id="GUID-3C4C77D7-ABB4-4E90-B293-D626A8AB0375__CDEIIHEA">
                              <p class="titleinexample">例6-2总体绩效统计</p><pre class="oac_no_warn" dir="ltr">报告摘要------------------------------------------------ ---------------------------------------------预计的工作量变更影响： -------------------------------------------总体影响：47.94％的改善影响：58.02％回归影响：-10.08％SQL语句计数-------------------------------------- ----- SQL类别SQL计数计划更改计数总计101 6改进2 2回归1 1未更改98 3。。。-------------------------------------------------- -------------------------------------------</pre></div>
                           <!-- class="example" -->
                        </div>
                     </div><a id="RATUG244"></a><a id="RATUG202"></a><div class="props_rev_3"><a id="GUID-A1351A5A-E558-490A-ADF6-F0330BE28614" name="GUID-A1351A5A-E558-490A-ADF6-F0330BE28614"></a><h6 id="RATUG-GUID-A1351A5A-E558-490A-ADF6-F0330BE28614" class="sect6"><span class="enumeration_section">6.2.2.2.2</span> SQL语句的性能统计信息</h6>
                        <div>
                           <div><span>“性能统计信息”子部分突出显示受系统更改影响最严重的SQL语句。</span> 根据以下标准比较工作负载中每个SQL语句的更改前和更改后性能数据：</div>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>每个SQL语句的执行频率或重要性</p>
                              </li>
                              <li>
                                 <p>系统更改对每个SQL语句相对于整个SQL工作负载的影响</p>
                              </li>
                              <li>
                                 <p>系统更改对每个SQL语句的影响</p>
                              </li>
                              <li>
                                 <p>每个SQL语句的执行计划的结构是否已更改</p>
                              </li>
                           </ul>
                           <p><a href="comparing-sql-trials.html#GUID-A1351A5A-E558-490A-ADF6-F0330BE28614__CDEJGFFB">示例6-3</a>显示了示例报表的SQL语句的“性能统计信息”子部分。该报告已略微更改以适合页面。
                           </p>
                           <p>SQL语句按SQL工作负载的净影响的绝对值按降序排序，也就是说，排序顺序不取决于影响是正还是负。</p>
                           <div class="example" id="GUID-A1351A5A-E558-490A-ADF6-F0330BE28614__CDEJGFFB">
                              <p class="titleinexample">示例6-3 SQL语句的性能统计信息</p><pre class="oac_no_warn" dir="ltr">SQL语句按其更改的绝对值对工作负载的影响排序------------------------------------- -------------------------------------------------- ------ -------------------------------------------- ------------------------------------------------- | | |对|的影响执行|公制|公制|影响|计划| | object_id | sql_id |工作量|频率|之前|之后|在SQL上改变| -------------------------------------------------- ------------------------------------------- | 205 | 73s2sgy2svfrw | 29.01％| 100000 | 1681683 | 220590 | 86.88％| y | | 206 | gq2a407mv2hsy | 29.01％| 949141 | 1681683 | 220590 | 86.88％| y | | 204 | 2wtgxbjz6u2by | -10.08％| 478254 | 1653012 | 2160529 | -30.7％| y | -------------------------------------------------- -------------------------------------------</pre></div>
                           <!-- class="example" -->
                        </div>
                     </div><a id="RATUG245"></a><a id="RATUG203"></a><div class="props_rev_3"><a id="GUID-65075150-82B0-4DEE-94AC-1B54CF49F7C9" name="GUID-65075150-82B0-4DEE-94AC-1B54CF49F7C9"></a><h6 id="RATUG-GUID-65075150-82B0-4DEE-94AC-1B54CF49F7C9" class="sect6"><span class="enumeration_section">6.2.2.2.3</span>错误</h6>
                        <div>
                           <div><span>“错误”子部分报告执行期间发生的所有错误。</span> 如果SQL调优集中的所有执行都是通用的，则可以在SQL调优集级别报告错误，如果特定于SQL语句或执行计划，则可以在执行级别报告错误。
                           </div>
                           <p><a href="comparing-sql-trials.html#GUID-65075150-82B0-4DEE-94AC-1B54CF49F7C9__CDEGIAAE">例6-4</a>显示了SQL Performance Analyzer报告的Errors子部分的示例。
                           </p>
                           <div class="example" id="GUID-65075150-82B0-4DEE-94AC-1B54CF49F7C9__CDEGIAAE">
                              <p class="titleinexample">例6-4错误</p><pre class="oac_no_warn" dir="ltr">-------------------------------------------------- -------------------------------- SQL语句错误-------------- -------------------------------------------------- ------------------ SQL ID错误------------- ---------------- -------------------------------------------------- -  47bjmcdtw6htn ORA-00942：表或视图不存在br61bjp4tnf7y ORA-00920：无效的关系运算符----------------------------- -------------------------------------------------- ---</pre></div>
                           <!-- class="example" -->
                        </div>
                     </div>
                  </div><a id="RATUG204"></a><div class="props_rev_3"><a id="GUID-42B29CF3-8A16-4025-9E27-085C5FFDF88D" name="GUID-42B29CF3-8A16-4025-9E27-085C5FFDF88D"></a><h5 id="RATUG-GUID-42B29CF3-8A16-4025-9E27-085C5FFDF88D" class="sect5"><span class="enumeration_section">6.2.2.3</span>结果详细信息</h5>
                     <div>
                        <div><span>“结果详细信息”部分表示深入了解报表的“结果摘要”部分中显示的SQL语句的性能</span>使用本节中的信息来调查特定SQL语句的性能退回的原因。
                        </div>
                        <p>本节将包含SQL性能影响分析中处理的每个SQL语句的条目。每个条目分为以下小节：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="comparing-sql-trials.html#GUID-568299F0-4BD6-4561-B56A-65072E596991" title="报告的这一部分总结了SQL语句，列出了其信息和执行细节。">SQL详细信息</a></p>
                           </li>
                           <li>
                              <p><a href="comparing-sql-trials.html#GUID-43E04E4F-D704-4904-B48B-5A2A645606C8" title="执行统计信息子部分比较来自更改前和执行后更改的SQL语句的执行统计信息，然后汇总结果。">执行统计</a></p>
                           </li>
                           <li>
                              <p><a href="comparing-sql-trials.html#GUID-493319EB-2CE9-4D98-A304-6DC4B3F715B6" title="“执行计划”子部分显示SQL语句的更改前和执行后更改执行计划。在性能下降的情况下，本节还包含有关根本原因和症状的发现。">执行计划</a></p>
                           </li>
                        </ul>
                     </div><a id="RATUG246"></a><a id="RATUG205"></a><div class="props_rev_3"><a id="GUID-568299F0-4BD6-4561-B56A-65072E596991" name="GUID-568299F0-4BD6-4561-B56A-65072E596991"></a><h6 id="RATUG-GUID-568299F0-4BD6-4561-B56A-65072E596991" class="sect6"><span class="enumeration_section">6.2.2.3.1</span> SQL详细信息</h6>
                        <div>
                           <p>报告的这一部分总结了SQL语句，列出了其信息和执行细节。</p>
                           <p><a href="comparing-sql-trials.html#GUID-568299F0-4BD6-4561-B56A-65072E596991__CDEIICCB">示例6-5</a>显示了示例报表的SQL Details子部分。
                           </p>
                           <p>在<a href="comparing-sql-trials.html#GUID-568299F0-4BD6-4561-B56A-65072E596991__CDEIICCB">例6-5中</a> ，报告汇总了其ID为<code class="codeph">2wtgxbjz6u2by</code>且对应的对象ID为<code class="codeph">204</code>的回归SQL语句。
                           </p>
                           <div class="example" id="GUID-568299F0-4BD6-4561-B56A-65072E596991__CDEIICCB">
                              <p class="titleinexample">示例6-5 SQL详细信息</p><pre class="oac_no_warn" dir="ltr">SQL详细信息：-----------------------------对象ID：204架构名称：APPS SQL ID：2wtgxbjz6u2by执行频率：1 SQL文本：SELECT / * my_query_14_scott * / / * + ORDERED INDEX（t1）USE_HASH（t1）* /'B'|| t2.pg_featurevalue_05_id pg_featurevalue_05_id，'r'|| t4.elementrange_id pg_featurevalue_15_id，'G'|| t5.elementgroup_id pg_featurevalue_01_id，'r'|| t6.elementrange_id。 。 。。。。-------------------------------------------------- -------------------------------------------</pre></div>
                           <!-- class="example" -->
                        </div>
                     </div><a id="RATUG247"></a><a id="RATUG206"></a><div class="props_rev_3"><a id="GUID-43E04E4F-D704-4904-B48B-5A2A645606C8" name="GUID-43E04E4F-D704-4904-B48B-5A2A645606C8"></a><h6 id="RATUG-GUID-43E04E4F-D704-4904-B48B-5A2A645606C8" class="sect6"><span class="enumeration_section">6.2.2.3.2</span>执行统计</h6>
                        <div>
                           <p>执行统计信息子部分比较来自更改前和执行后更改的SQL语句的执行统计信息，然后汇总结果。</p>
                           <p><a href="comparing-sql-trials.html#GUID-43E04E4F-D704-4904-B48B-5A2A645606C8__CDEHCDHE">例6-6</a>显示了示例报告的“执行统计”子部分。
                           </p>
                           <div class="example" id="GUID-43E04E4F-D704-4904-B48B-5A2A645606C8__CDEHCDHE">
                              <p class="titleinexample">例6-6执行统计</p><pre class="oac_no_warn" dir="ltr">执行统计：----------------------------- ------------------ -------------------------------------------------- ------------------- | |对|的影响价值|价值|影响| ％工作量| ％工作量| |统计名称|工作量|之前|之后|在SQL上之前|之后| -------------------------------------------------- ------------------------------------- | elapsed_time | -95.54％| 36.484 | 143.161 | -292.39％| 32.68％| 94.73％| | parse_time | -12.37％| .004 | .062 | -1450％| .85％| 11.79％| | exec_elapsed | -95.89％| 36.48 | 143.099 | -292.27％| 32.81％| 95.02％| | exec_cpu | -19.73％| 36.467 | 58.345 | -59.99％| 32.89％| 88.58％| | buffer_gets | -10.08％| 1653012 | 2160529 | -30.7％| 32.82％| 82.48％| |费用| 12.17％| 11224 | 2771 | 75.31％| 16.16％| 4.66％| |读取| -1825.72％| 4091 | 455280 | -11028.82％| 16.55％| 96.66％| |写道| -1500％| 0 | 15 | -1500％| 0％| 100％| |行| | 135 | 135 | | | | -------------------------------------------------- -------------------------------------注意：----------- ------------------改变之前：1。该语句首先被执行以加热缓冲区缓存。2。显示的统计数据是接下来9次执行的平均值。变更后：1。该语句首先被执行以加热缓冲区缓存。2。显示的统计数据是接下来9次执行的平均值。调查结果（2）：----------------------------- 1。这个SQL的性能已经退步了。2。SQL执行计划的结构已更改。-------------------------------------------------- -------------------------------------------</pre></div>
                           <!-- class="example" -->
                        </div>
                     </div><a id="RATUG248"></a><a id="RATUG207"></a><div class="props_rev_3"><a id="GUID-493319EB-2CE9-4D98-A304-6DC4B3F715B6" name="GUID-493319EB-2CE9-4D98-A304-6DC4B3F715B6"></a><h6 id="RATUG-GUID-493319EB-2CE9-4D98-A304-6DC4B3F715B6" class="sect6"><span class="enumeration_section">6.2.2.3.3</span>执行计划</h6>
                        <div>
                           <p>“执行计划”子部分显示SQL语句的更改前和执行后更改执行计划。在性能下降的情况下，本节还包含有关根本原因和症状的发现。</p>
                           <p><a href="comparing-sql-trials.html#GUID-493319EB-2CE9-4D98-A304-6DC4B3F715B6__CDEIGJAE">例6-7</a>显示了示例报告的“执行计划”子部分。
                           </p>
                           <div class="example" id="GUID-493319EB-2CE9-4D98-A304-6DC4B3F715B6__CDEIGJAE">
                              <p class="titleinexample">例6-7执行计划</p><pre class="oac_no_warn" dir="ltr">Execution Plan Before Change:
-----------------------------
 Plan Id          : 1
 Plan Hash Value  : 3412943215
 
----------------------------------------------------------------------------------------------------------
| Id   | Operation                           | Name                | Rows   | Bytes   | Cost  | Time     |
----------------------------------------------------------------------------------------------------------
|    0 | SELECT STATEMENT                    |                     |      1 |     126 | 11224 | 00:02:15 |
|    1 |   HASH GROUP BY                     |                     |      1 |     126 | 11224 | 00:02:15 |
|    2 |    NESTED LOOPS                     |                     |      1 |     126 | 11223 | 00:02:15 |
|  * 3 |     HASH JOIN                       |                     |      1 |     111 | 11175 | 00:02:15 |
|  * 4 |      TABLE ACCESS FULL              | LU_ELEMENTGROUP_REL |      1 |      11 |   162 | 00:00:02 |
|  * 5 |      HASH JOIN                      |                     |    487 |   48700 | 11012 | 00:02:13 |
|    6 |       MERGE JOIN                    |                     |     14 |     924 |  1068 | 00:00:13 |
|    7 |        SORT JOIN                    |                     |   5391 |  274941 |  1033 | 00:00:13 |
|  * 8 |         HASH JOIN                   |                     |   5391 |  274941 |   904 | 00:00:11 |
|  * 9 |          TABLE ACCESS FULL          | LU_ELEMENTGROUP_REL |    123 |    1353 |   175 | 00:00:03 |
| * 10 |          HASH JOIN                  |                     |   5352 |  214080 |   729 | 00:00:09 |
| * 11 |           TABLE ACCESS FULL         | LU_ITEM_293         |   5355 |  128520 |    56 | 00:00:01 |
| * 12 |           TABLE ACCESS FULL         | ADM_PG_FEATUREVALUE |   1629 |   26064 |   649 | 00:00:08 |
| * 13 |        FILTER                       |                     |        |         |       |          |
| * 14 |         SORT JOIN                   |                     |      1 |      15 |    36 | 00:00:01 |
| * 15 |          TABLE ACCESS FULL          | LU_ELEMENTRANGE_REL |      1 |      15 |    35 | 00:00:01 |
|   16 |       INLIST ITERATOR               |                     |        |         |       |          |
| * 17 |        TABLE ACCESS BY INDEX ROWID  | FACT_PD_OUT_ITM_293 | 191837 | 6522458 |  9927 | 00:02:00 |
|   18 |         BITMAP CONVERSION TO ROWIDS |                     |        |         |       |          |
| * 19 |          BITMAP INDEX SINGLE VALUE  | FACT_274_PER_IDX    |        |         |       |          |
| * 20 |     TABLE ACCESS FULL               | LU_ELEMENTRANGE_REL |      1 |      15 |    49 | 00:00:01 |
----------------------------------------------------------------------------------------------------------
.
.
.变更后的执行计划：-----------------------------计划ID：102计划哈希价值：1923145679 ------- -------------------------------------------------- --------------------------------------------- | Id |操作|名称|行|字节|成本|时间| -------------------------------------------------- -------------------------------------------------- -  | 0 |选择声明| | 1 | 126 | 2771 | 00:00:34 | | 1 | HASH GROUP BY | | 1 | 126 | 2771 | 00:00:34 | | 2 | NESTED LOOPS | | 1 | 126 | 2770 | 00:00:34 | | * 3 | HASH JOIN | | 1 | 111 | 2722 | 00:00:33 | | * 4 | HASH JOIN | | 1 | 100 | 2547 | 00:00:31 | | * 5 |表访问完全| LU_ELEMENTGROUP_REL | 1 | 11 | 162 | 00:00:02 | | 6 | NESTED LOOPS | | | | | | | 7 | NESTED LOOPS | | 484 | 43076 | 2384 | 00:00:29 | | * 8 | HASH JOIN | | 14 | 770 | 741 | 00:00:09 | | 9 | NESTED LOOPS | | 4 | 124 | 683 | 00:00:09 | | * 10 |表访问完全| LU_ELEMENTRANGE_REL | 1 | 15 | 35 | 00:00:01 | | * 11 |表访问完全| ADM_PG_FEATUREVALUE | 4 | 64 | 649 | 00:00:08 | | * 12 |表访问完全| LU_ITEM_293 | 5355 | 128520 | 56 | 00:00:01 | | 13 | BITMAP转换为ROWIDS | | | | | | | * 14 | BITMAP INDEX单一价值| FACT_274_ITEM_IDX | | | | | | * 15 |按INDEX ROWID表的访问权限| FACT_PD_OUT_ITM_293 | 36 | 1224 | 2384 | 00:00:29 | | * 16 |表访问完全| LU_ELEMENTGROUP_REL | 123 | 1353 | 175 | 00:00:03 | | * 17 |表访问完全| LU_ELEMENTRANGE_REL | 1 | 15 | 49 | 00:00:01 | -------------------------------------------------- -------------------------------------------------- -</pre></div>
                           <!-- class="example" -->
                        </div>
                     </div>
                  </div>
               </div><a id="RATUG306"></a><a id="RATUG307"></a><a id="RATUG308"></a><a id="RATUG305"></a><div class="sect3"><a id="GUID-F3DC6B55-4070-4F2F-AB63-DFEE8AFEDA47" name="GUID-F3DC6B55-4070-4F2F-AB63-DFEE8AFEDA47"></a><h4 id="RATUG-GUID-F3DC6B55-4070-4F2F-AB63-DFEE8AFEDA47" class="sect4"><span class="enumeration_section">6.2.3</span>使用API比较SQL调优集</h4>
                  <div>
                     <p>你可以比较两个<a id="d9478e3163" class="indexterm-anchor"></a> SQL调优使用<code class="codeph">DBMS_SQLPA</code>包进行设置。例如，在使用数据库重放时，您可能在工作负载捕获期间捕获了生产系统上的SQL调优集，并在工作负载重放期间在测试系统上捕获了另一个SQL调整集。然后，您可以使用SQL Performance Analyzer来比较这些SQL调优集，而无需重新执行SQL语句。在您进行系统更改之前和之后已经有另一个实用程序来运行工作负载（例如自定义脚本）的情况下，这非常有用。
                     </p>
                     <p>比较SQL调优集时，SQL Performance Analyzer使用SQL调优集中捕获的运行时统计信息来执行其比较分析，并报告在一个SQL调优集中找到但在另一个SQL调优集中找不到的任何新的或缺少的SQL语句。还会报告两个SQL调优集之间的执行计划的任何更改。对于两个SQL调优集中的每个SQL语句，报告每个SQL语句的改进和回归结果 - 基于每次执行的平均统计值计算 - 以及基于累积统计值计算的整个工作负载。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-F3DC6B55-4070-4F2F-AB63-DFEE8AFEDA47__GUID-3BFFAC66-864C-492F-8D45-2A612C459026">要使用API比较SQL调优集：</p>
                        <ol>
                           <li>
                              <p>创建SQL Performance Analyzer任务：</p><pre class="oac_no_warn" dir="ltr">VAR aname varchar2（30）; EXEC：aname：='compare_s2s'; EXEC：aname：= DBMS_SQLPA.CREATE_ANALYSIS_TASK（task_name =&gt;：aname）;</pre><p>在创建期间不必将SQL调整集关联到任务。</p>
                           </li>
                           <li>
                              <p>创建第一个SQL试用版并转换第一个SQL调优集：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_SQLPA.EXECUTE_ANALYSIS_TASK（task_name =&gt;：aname， -  execution_type =&gt;'convert sqlset'， -  execution_name =&gt;'first trial'， -  execution_params =&gt; DBMS_ADVISOR.ARGLIST（'sqlset_name'，'my_first_sts'， - 'sqlset_owner'， '应用'））;</pre><p>使用<code class="codeph">SQLSET_NAME</code>和<code class="codeph">SQLSET_OWNER</code>任务参数指定SQL调优集的名称和所有者。SQL性能分析器任务不会复制SQL调优集的内容。相反，对SQL调优集的引用与新SQL试验相关联，在此示例中为“第一次试用”。
                              </p>
                           </li>
                           <li>
                              <p>创建第二个SQL试用版并将其与要比较的第二个SQL调优关联：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_SQLPA.EXECUTE_ANALYSIS_TASK（task_name =&gt;：aname， -  execution_type =&gt;'convert sqlset'， -  execution_name =&gt;'second trial'， -  execution_params =&gt; DBMS_ADVISOR.ARGLIST（'sqlset_name'，'my_second_sts'， - 'sqlset_owner'， '应用'））;</pre></li>
                           <li>
                              <p>通过运行比较分析来比较两个SQL试验（或SQL调优集）的性能数据：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_SQLPA.EXECUTE_ANALYSIS_TASK（task_name =&gt;：aname， -  execution_type =&gt;'compare'， -  execution_name =&gt;'comparison'， -  execution_params =&gt; DBMS_ADVISOR.ARGLIST（'workload_impact_threshold'，0， - 'sql_impact_threshold'，0））;</pre><p>在此示例中，工作负载和每SQL影响阈值设置为0％以进行比较（默认值为1％）。</p>
                           </li>
                           <li>
                              <p>比较分析完成后，使用<code class="codeph">DBMS_SQLPA.REPORT_ANALYSIS_TASK</code>函数生成SQL Performance Analyzer报告。
                              </p>
                              <p>有关使用API生成SQL Performance Analyzer报告的信息，请参阅<span class="q">“ <a href="comparing-sql-trials.html#GUID-BA40A195-CB93-459E-B365-BFB2BA40BD30" title="在构建更改后的SQL性能数据之后，您可以将性能数据的更改前版本与更改后的版本进行比较。">使用API分析SQL性能</a> ”</span> 。
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <p>生成报告后，请检查它以确定两个SQL调优集的内容之间的任何差异。<a href="comparing-sql-trials.html#GUID-F3DC6B55-4070-4F2F-AB63-DFEE8AFEDA47__CHDIIHJC">示例6-8</a>显示了通过比较两个SQL调优集生成的示例报表的Analysis Information和Report Summary部分：</p>
                     <div class="example" id="GUID-F3DC6B55-4070-4F2F-AB63-DFEE8AFEDA47__CHDIIHJC">
                        <p class="titleinexample">示例6-8分析信息和报告摘要</p><pre class="oac_no_warn" dir="ltr">分析信息：----------------------------------------------- -------------------------------------------------之前变更执行：变更执行后：------------------------------------------- -  ---------------------------------------------执行名称：第一次试用执行名称：第二次试用执行类型：CONVERT SQLSET执行类型：CONVERT SQLSET状态：已完成状态：已完成启动：...上次更新：...更改工作负载之前：更改工作负载之后：------------ --------------------------------- ----------------- ---------------------------- SQL调优集名称：my_first_sts SQL调优集名称：my_second_sts SQL调优集所有者：APPS SQL调优集所有者：APPS总SQL语句数：5总SQL语句数：6 ------------------------------------ -------------------------------------------------- ----------报告摘要-------------------------------------- -------------------------------------------------- --------预计W orkload更改影响：-------------------------------------------整体影响： 72.32％改进影响：47.72％回归影响：-.02％缺少SQL影响：33.1％New-SQL影响：-8.48％SQL语句计数------------------ ------------------------- SQL类别SQL计数计划更改计数总计7 1通用4 1改进3 1退回1 0不同3 0缺少SQL 1 0新SQL 2 0</pre></div>
                     <!-- class="example" -->
                     <p>如<a href="comparing-sql-trials.html#GUID-F3DC6B55-4070-4F2F-AB63-DFEE8AFEDA47__CHDIIHJC">例6-8</a>所示，此报告包含标准SQL Performance Analyzer报告中未找到的另外两个类别。两个类别分组在不同的标题下：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>缺少SQL</p>
                           <p>此类别表示第一个SQL调优集中存在的所有SQL语句，但在第二个SQL调优集中找不到。在此示例中，仅缺少一个SQL语句。如<a href="comparing-sql-trials.html#GUID-F3DC6B55-4070-4F2F-AB63-DFEE8AFEDA47__CHDDEHJA">例6-9</a>所示，此SQL语句具有：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">sql_id</code>值为gv7xb8tyd1v91</p>
                              </li>
                              <li>
                                 <p>根据变化对工作负载的性能影响为33.1％</p>
                              </li>
                              <li>
                                 <p>由于缺少“Total Metric After”更改值，因此对基于更改的SQL语句没有性能影响</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>新的SQL</p>
                           <p>此类别表示第二个SQL调优集中存在的所有SQL语句，但在第一个SQL调优集中找不到。在此示例中，第二个SQL调优集中只有两个SQL语句是新的。如<a href="comparing-sql-trials.html#GUID-F3DC6B55-4070-4F2F-AB63-DFEE8AFEDA47__CHDDEHJA">例6-9</a>所示，这些SQL语句具有：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">sql_id</code>值为4c8nrqxhtb2sf和9utadgu5udmh4</p>
                              </li>
                              <li>
                                 <p>对工作量的总体性能影响为-8.48％</p>
                              </li>
                              <li>
                                 <p>缺少“Total Metric Before”更改值</p>
                              </li>
                           </ul>
                        </li>
                     </ul>
                     <p><a href="comparing-sql-trials.html#GUID-F3DC6B55-4070-4F2F-AB63-DFEE8AFEDA47__CHDDEHJA">示例6-9</a>显示了示例报表中的一个表，其中列出了缺少的和新的SQL语句，以及其对工作负载的影响所确定的其他顶级SQL语句：</p>
                     <div class="example" id="GUID-F3DC6B55-4070-4F2F-AB63-DFEE8AFEDA47__CHDDEHJA">
                        <p class="titleinexample">示例6-9按变量绝对值排序的前7个SQL对工作负载的影响</p><pre class="oac_no_warn" dir="ltr">前7个SQL按绝对值变化排序对工作量的影响------------------------------------- -------------------------------------------------- --- ----------------------------------------------- ------------------------------------------- | | |对|的影响总指标|总指标|影响|计划| | object_id | sql_id |工作量|之前|之后|在SQL上改变| -------------------------------------------------- ---------------------------------------- | 4 | 7gj3w9ya4d9sj | 41.04％| 812791 | 36974 | 95％| y | | 7 | gv7xb8tyd1v91 | 33.1％| 625582 | | | n | | 2 | 4c8nrqxhtb2sf | -8.35％| | 157782 | | n | | 1 | 22u3tvrt0yr6g | 4.58％| 302190 | 215681 | 28.63％| n | | 6 | fgdd0fd56qmt0 | 2.1％| 146128 | 106369 | 27.21％| n | | 5 | 9utadgu5udmh4 | -.13％| | 2452 | | n | | 3 | 4dtv43awxnmv3 | -.02％| 3520 | 3890 | -47.35％| n | -------------------------------------------------- ----------------------------------------</pre></div>
                     <!-- class="example" -->
                     <p>一旦确定了感兴趣的SQL语句，就可以为SQL语句生成报告以执行更详细的调查。例如，您可能希望调查<code class="codeph">sql_id</code>值为7gj3w9ya4d9sj且<code class="codeph">object_id</code>值为4的SQL语句，因为它对工作负载的影响最大：</p><pre class="oac_no_warn" dir="ltr">SELECT DBMS_SQLPA.REPORT_ANALYSIS_TASK（task_name =&gt;：aname，object_id =&gt; 4）rep FROM dual;</pre><p><a href="comparing-sql-trials.html#GUID-F3DC6B55-4070-4F2F-AB63-DFEE8AFEDA47__CHDFGHJE">示例6-10</a>显示了为此SQL语句生成的示例报告：</p>
                     <div class="example" id="GUID-F3DC6B55-4070-4F2F-AB63-DFEE8AFEDA47__CHDFGHJE">
                        <p class="titleinexample">示例6-10 SQL语句的示例报告</p><pre class="oac_no_warn" dir="ltr">SQL详细信息：-----------------------------对象ID：4 SQL ID：7gj3w9ya4d9sj SQL文本：/ * my_csts_query1 * / select * FROM emp其中empno = 2 SQL执行统计信息（平均值）：------------------------------------- -  ------------------------------------------------ --------- | |对|的影响价值|价值|影响| |统计名称|工作量|之前|之后|在SQL上-------------------------------------------------- ------- | elapsed_time | 41.04％| .036945 | .001849 | 95％| | cpu_time | 13.74％| .004772 | .00185 | 61.24％| | buffer_gets | 9.59％| 8 | 2 | 69.01％| |费用| 11.76％| 1 | 1 | 10％| |读取| 4.08％| 0 | 0 | 63.33％| |写道| 0％| 0 | 0 | 0％| |行| | 0 | 0 | | |执行| | 22 | 20 | | | plan_count | | 3 | 2 | | -------------------------------------------------- -------调查结果（2）：----------------------------- 1。这个SQL的性能有所提高。2。SQL执行计划的结构已更改。计划执行统计（平均）：--------------------------------------- ---- -------------------------------------------------- ---------------------------- |统计名称|变更前的计划|变更后的计划| -------------------------------------------------- -------------------------------- |计划哈希值| 440231712 571903972 3634526668 | 571903972 3634526668 | | --------------- | --------- --------- ---------- | --------- ---------- | |模式名称| APPS1 APPS2 APPS2 | APPS2 APPS2 | |执行| 7 5 10 | 10 10 | |费用| 2 1 2 | 1 2 | | elapsed_time | .108429 .000937 .00491 | .000503 .003195 | | cpu_time | .00957 .0012 .0032 | .0005 .0032 | | buffer_gets | 18 0 5 | 0 5 | |读取| 0 0 0 | 0 0 | |写道| 0 0 0 | 0 0 | |行| 0 0 0 | 0 0 | -------------------------------------------------- --------------------------------变更前的执行计划：------------- ---------------- Plan Hash Value：440231712 ----------------------------- ---------------------------------------------- | Id |操作|名称|行|字节|成本|时间| -------------------------------------------------- ------------------------- | 0 |选择声明| | | | 2 | | | 1 | PX COORDINATOR | | | | | | | 2 | PX SEND QC（RANDOM）| ：TQ10000 | 1 | 87 | 2 | 00:00:01 | | 3 | PX BLOCK ITERATOR | | 1 | 87 | 2 | 00:00:01 | | 4 |表访问完全| EMP | 1 | 87 | 2 | 00:00:01 | -------------------------------------------------- -------------------------注意-----  - 用于本声明的动态采样计划哈希值：571903972 ------- -------------------------------------------------- ------------------------- | Id |操作|名称|行|字节|成本|时间| -------------------------------------------------- -------------------------------- | 0 |选择声明| | | | 1 | | | 1 |按INDEX ROWID表的访问权限| EMP | 1 | 87 | 1 | 00:00：01 | | 2 | INDEX UNIQUE SCAN | MY_EMP_IDX | 1 | | 0 | | -------------------------------------------------- --------------------------------计划哈希价值：3634526668 ------------- -------------------------------------------------- ----- | Id |操作|名称|行|字节|成本|时间| -------------------------------------------------- ------------------ | 0 |选择声明| | | | 2 | | | 1 |表访问完全| EMP | 1 | 87 | 2 | 00:00:01 | -------------------------------------------------- ------------------注意-----  - 用于此语句的动态采样执行后更改计划：-------------- ---------------计划哈希价值：571903972 ----赞------ -------------------------------------------------- -  | Id |操作|名称|行|字节|成本|时间| -------------------------------------------------- -------------------------------- | 0 |选择声明| | | | 1 | | | 1 |按INDEX ROWID表的访问权限| EMP | 1 | 87 | 1 | 00:00：01 | | 2 | INDEX UNIQUE SCAN | MY_EMP_IDX | 1 | | 0 | | -------------------------------------------------- --------------------------------计划哈希价值：3634526668 ------------- -------------------------------------------------- ----- | Id |操作|名称|行|字节|成本|时间| -------------------------------------------------- ------------------ | 0 |选择声明| | | | 2 | | | 1 |表访问完全| EMP | 1 | 87 | 2 | 00:00:01 | -------------------------------------------------- ------------------注意-----  - 用于此声明的动态采样------------------- -------------------------------------------------- -------------</pre></div>
                     <!-- class="example" -->
                     <p>“SQL执行统计信息”部分显示SQL语句的平均运行时统计信息（每次执行）。此表中的数据显示此SQL语句存在于两个SQL调优集中，但它在第一个SQL调优集中只有三个执行计划，在第二个SQL调优集中只有两个执行计划。此外，SQL语句在第一个SQL调优集中执行了22次，但在第二个SQL调优集中只执行了20次。</p>
                     <p>计划执行统计信息部分显示每个执行计划的运行时统计信息（或计划哈希值）。“更改前计划”列列出了第一个SQL调优集的计划及其关联的执行统计信息;更改后的计划列列出了第二个SQL调优集的这些值。两个SQL调优集的执行计划结构显示在报告的末尾。</p>
                     <p>您可以在报告中使用这些部分来标识两个SQL调优集之间的执行计划中的更改。这很重要，因为执行计划的更改可能是测试更改的结果，这些更改可能会对性能产生直接影响。比较两个SQL调优集时，SQL Performance Analyzer会在SQL语句具有以下情况时报告执行计划更改：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>两个SQL调优集中都有一个计划，但计划结构不同</p>
                        </li>
                        <li>
                           <p>不止一个计划，以及两个SQL调优集中的计划数量是：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>同样，但第二个SQL调优集中的至少一个计划与第一个SQL调优集中的所有计划不同</p>
                              </li>
                              <li>
                                 <p>不同</p>
                              </li>
                           </ul>
                        </li>
                     </ul>
                     <p>在评估SQL语句和计划更改后，确定是否需要进一步操作。如果SQL语句已退化，请执行以下操作之一：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>调整回归的SQL语句，如<span class="q">“ <a href="comparing-sql-trials.html#GUID-B85471DE-CC06-4E02-AFA6-AD207D94C8C8">使用API调整</a></span>回归的SQL语句<span class="q">”中所述</span></p>
                        </li>
                        <li>
                           <p>创建SQL计划基准，如<span class="q">“ <a href="comparing-sql-trials.html#GUID-48F67DD6-70B6-49CC-B4B3-72F2D80E6DDD">使用API创建SQL计划基准</a> ”中所述</span></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="RATUG295"></a><a id="RATUG208"></a><div class="sect3"><a id="GUID-B85471DE-CC06-4E02-AFA6-AD207D94C8C8" name="GUID-B85471DE-CC06-4E02-AFA6-AD207D94C8C8"></a><h4 id="RATUG-GUID-B85471DE-CC06-4E02-AFA6-AD207D94C8C8" class="sect4"><span class="enumeration_section">6.2.4</span>使用API调整回归的SQL语句</h4>
                  <div>
                     <p>在查看SQL Performance Analyzer报告之后，您应该调整任何一个<a id="d9478e3418" class="indexterm-anchor"></a>在比较SQL性能后识别的SQL语句。如果有大量SQL语句似乎已退化，则应尝试确定根本原因并进行系统级更改以纠正问题。如果只有少数SQL语句退化，请考虑使用SQL Tuning Advisor为它们实现点解决方案，或创建SQL计划基准以指示优化程序在将来选择原始执行计划。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-B85471DE-CC06-4E02-AFA6-AD207D94C8C8__GUID-1FC48CDA-B13B-442E-8A9F-C3FD084855D1">使用API调整回归的SQL语句：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>使用以下命令为SQL Performance Analyzer执行创建SQL调优任务<a id="d9478e3430" class="indexterm-anchor"></a> <code class="codeph">DBMS_SQLTUNE</code>包中的<code class="codeph">CREATE_TUNING_TASK</code>函数：</p><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_SQLTUNE.CREATE_TUNING_TASK（spa_task_name =&gt;'my_spa_task'，spa_task_owner =&gt;'immchan'，spa_compare_exec =&gt;'my_exec_compare'）; DBMS_SQLTUNE.EXECUTE_TUNING_TASK（spa_task_name =&gt;'my_spa_task'）;结束; /</pre><p>此示例创建并执行SQL调优任务，以调整在名为<code class="codeph">my_exec_compare</code>的SQL Performance Analyzer任务名为<code class="codeph">my_spa_task</code>的比较性能执行中退化的SQL语句。在这种情况下，使用此版本的<code class="codeph">CREATE_TUNING_TASK</code>函数调用很重要。否则，可以从捕获它们的生产系统在环境中调整SQL语句，这不会反映系统更改。
                              </p>
                              <div class="infoboxnote" id="GUID-B85471DE-CC06-4E02-AFA6-AD207D94C8C8__GUID-3AB8946D-6A28-45A4-9452-2F93DDBA7B56">
                                 <p class="notep1">注意：</p>
                                 <p>如果选择在单独的数据库上远程执行SQL工作负载，则不应使用此版本的<code class="codeph">CREATE_TUNING_TASK</code>函数调用来调优回归的SQL语句。相反，您应该调整远程数据库上SQL试验所标识的任何回归，因为应用程序模式不在运行SQL Performance Analyzer的数据库上。因此，您需要在架构所在的数据库和进行更改的位置运行SQL Tuning Advisor。
                                 </p>
                              </div>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <p><a href="comparing-sql-trials.html#GUID-B85471DE-CC06-4E02-AFA6-AD207D94C8C8__CHDCFJAH" title="此表列出了DBMS_SQLTUNE.CREATE_TUNING_TASK函数的SQL Performance Analyzer参数及其说明">表6-1</a>列出了可与<code class="codeph">DBMS_SQLTUNE</code>一起使用的SQL Performance Analyzer参数。 <code class="codeph">CREATE_TUNING_TASK</code>功能。
                     </p>
                     <div class="tblformal" id="GUID-B85471DE-CC06-4E02-AFA6-AD207D94C8C8__CHDCFJAH">
                        <p class="titleintable">表6-1 CREATE_TUNING_TASK函数SQL性能分析器参数</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="CREATE_TUNING_TASK函数SQL性能分析器参数" width="100%" border="1" summary="This table lists the SQL Performance Analyzer parameters  for the DBMS_SQLTUNE.CREATE_TUNING_TASK function and their descriptions" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="24%" id="d9478e3481">参数</th>
                                 <th align="left" valign="bottom" width="76%" id="d9478e3484">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d9478e3489" headers="d9478e3481 ">
                                    <p><code class="codeph">SPA_TASK_NAME</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d9478e3489 d9478e3484 ">
                                    <p>SQL Performance Analyzer任务的名称。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d9478e3497" headers="d9478e3481 ">
                                    <p><code class="codeph">SPA_TASK_OWNER</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d9478e3497 d9478e3484 ">
                                    <p>指定SQL Performance Analyzer任务的所有者。如果未指定，则此参数将默认为当前用户。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d9478e3505" headers="d9478e3481 ">
                                    <p><code class="codeph">SPA_COMPARE_EXEC</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d9478e3505 d9478e3484 ">
                                    <p>指定的SQL Performance Analyzer任务的比较性能试用版的执行名称。如果未指定，则此参数默认为给定SQL Performance Analyzer任务的<code class="codeph">COMPARE PERFORMANCE</code>类型的最新执行。
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>在调优回归的SQL语句之后，您应该使用SQL Performance Analyzer测试这些更改。在测试系统上运行新的SQL试用版，然后进行第二次比较（在此新SQL试用版和第一个SQL试用版之间）以验证结果。一旦SQL Performance Analyzer显示性能已稳定，请将此步骤中的修复程序实施到生产系统。</p>
                     <p>从Oracle Database <span class="italic">11g</span>第2版开始，SQL Tuning Advisor在调优SQL语句时执行备用计划分析。SQL Tuning Advisor检查SQL语句的执行历史记录，包括存储在自动工作负载存储库中的任何历史计划。如果SQL Tuning Advisor找到备用计划，则允许您选择特定计划并创建计划基准，以确保为该SQL语句使用所需的执行计划。
                     </p>
                     <div class="infoboxnotealso" id="GUID-B85471DE-CC06-4E02-AFA6-AD207D94C8C8__GUID-A1262CFF-9F34-4E86-84FB-DDBE6926085F">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="comparing-sql-trials.html#GUID-0B629FA1-FF45-44D0-BB2D-28FF762BC102">使用API调整远程SQL试验中的回归SQL语句</a> ”</span></p>
                           </li>
                           <li>
                              <p>有关使用SQL Tuning Advisor的信息，请<a href="../tgsql/introduction-to-sql-tuning.html#TGSQL540" target="_blank"><span><cite>参见“Oracle数据库SQL调优指南”</cite></span></a></p>
                           </li>
                           <li>
                              <p>有关备用计划分析的信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/ratug&amp;id=TGSQL558" target="_blank"><span><cite>参见“Oracle数据库SQL调整指南”</cite></span></a></p>
                           </li>
                           <li>
                              <p>有关<code class="codeph">DBMS_SQLTUNE</code>包的信息<a href="../arpls/DBMS_SQLTUNE.html#ARPLS220" target="_blank"><span><cite>，请参见Oracle Database PL / SQL包和类型参考</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RATUG309"></a><div class="props_rev_3"><a id="GUID-0B629FA1-FF45-44D0-BB2D-28FF762BC102" name="GUID-0B629FA1-FF45-44D0-BB2D-28FF762BC102"></a><h4 id="RATUG-GUID-0B629FA1-FF45-44D0-BB2D-28FF762BC102" class="sect4"><span class="enumeration_section">6.2.5</span>使用API调整远程SQL试验中的回归SQL语句</h4>
                  <div>
                     <div class="section">
                        <p>如果选择在单独的数据库上远程执行SQL工作负载，则应调整远程数据库上SQL试验标识的任何回归，而不是SQL性能分析器任务所在的系统。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-0B629FA1-FF45-44D0-BB2D-28FF762BC102__GUID-5491E26E-D3FD-4141-BE1C-059C7B5766AA">使用API调整远程SQL试用版中的回归SQL语句：</p>
                        <ol>
                           <li>
                              <p>在运行SQL Performance Analyzer的系统上，将已回归的SQL语句的子集创建为SQL调优集：</p><pre class="oac_no_warn" dir="ltr">DECLARE sqlset_cur DBMS_SQLTUNE.SQLSET_CURSOR; BEGIN DBMS_SQLTUNE.CREATE_SQLSET（'SUB_STS1'，'测试目的'）; OPEN sqlset_cur FOR SELECT value（p）FROM table（DBMS_SQLTUNE.SELECT_SQLPA_TASK（task_name =&gt;'SPA_TASK1'，execution_name =&gt;'COMP'，level_filter =&gt;'REGRESSED'））p; DBMS_SQLTUNE.LOAD_SQLSET（'SUB_STS1'，sqlset_cur）;关闭sqlset_cur;结束; /</pre><p>除了<code class="codeph">'REGRESSED'</code> ，您可以使用其他过滤器为SQL调整集选择SQL语句，例如<code class="codeph">'CHANGED'</code> ， <code class="codeph">'ERRORS'</code>或<code class="codeph">'CHANGED_PLANS'</code> 。有关更多信息，请参阅<a href="../arpls/DBMS_SQLTUNE.html#ARPLS73150" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a> 。
                              </p>
                           </li>
                           <li>
                              <p>创建一个临时表到将导出SQL调优集的位置：</p><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_SQLTUNE.CREATE_STGTAB_SQLSET（table_name =&gt;'STG_TAB1'，schema_name =&gt;'JOHNDOE'，tablespace_name =&gt;'TBS_1'，db_version =&gt; DBMS_SQLTUNE.STS_STGTAB_11_1_VERSION）;结束; /</pre><p>使用<code class="codeph">db_version</code>参数指定将导出和调整SQL调优集的相应数据库版本。在此示例中，将使用格式创建临时表，以便可以将其导出到运行Oracle Database <span class="italic">11g</span>第1版的系统，稍后将使用SQL Tuning Advisor进行调整。对于其他数据库版本，请参阅该版本的<a href="../arpls/index.html" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a> 。
                              </p>
                           </li>
                           <li>
                              <p>将SQL调优集导出到临时表：</p><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_SQLTUNE.PACK_STGTAB_SQLSET（sqlset_name =&gt;'SUB_STS1'，sqlset_owner =&gt;'JOHNDOE'，staging_table_name =&gt;'STG_TAB1'，staging_schema_owner =&gt;'JOHNDOE'，db_version =&gt; DBMS_SQLTUNE.STS_STGTAB_11_1_VERSION）;结束; /</pre></li>
                           <li>
                              <p>使用选择的机制（例如Oracle Data Pump或数据库链接）将登台表移动到远程数据库（执行SQL工作负载的位置）。</p>
                           </li>
                           <li>
                              <p>在远程数据库上，从登台表导入SQL调优集：</p><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_SQLTUNE.UNPACK_STGTAB_SQLSET（sqlset_name =&gt;'SUB_STS1'，staging_table_name =&gt;'STG_TAB1'，replace =&gt; TRUE）;结束; /</pre></li>
                           <li>
                              <p>通过运行SQL Tuning Advisor调整SQL调优集中的回归SQL语句：</p><pre class="oac_no_warn" dir="ltr">BEGIN sts_name：='SUB_STS1'; sts_owner：='JOHNDOE'; tune_task_name：='TUNE_TASK1'; tname：= DBMS_SQLTUNE.CREATE_TUNING_TASK（sqlset_name =&gt; sts_name，sqlset_owner =&gt; sts_owner，task_name =&gt; tune_task_name）; EXEC DBMS_SQLTUNE.SET_TUNING_TASK_PARAMETER（：tname，'APPLY_CAPTURED_COMPILENV'，'FALSE'）; exec_name：= DBMS_SQLTUNE.EXECUTE_TUNING_TASK（tname）;结束; /</pre><div class="infoboxnote" id="GUID-0B629FA1-FF45-44D0-BB2D-28FF762BC102__GUID-3FFD539E-79F0-449B-8D8C-F9B357A29DD4">
                                 <p class="notep1">注意：</p>
                                 <p>本<code class="codeph">APPLY_CAPTURED_COMPILENV</code>使用的<code class="codeph">APPLY_CAPTURED_COMPILENV</code>参数仅受Oracle Database <span class="italic">11g</span>第1版及更新版本的支持。如果要从早期版本的Oracle数据库测试数据库升级，则SQL Tuning Advisor将使用存储在SQL调优集中的环境变量。
                                 </p>
                              </div>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>在调优回归的SQL语句之后，您应该使用SQL Performance Analyzer测试这些更改。在测试系统上运行新的SQL试用版，然后进行第二次比较（在此新SQL试用版和第一个SQL试用版之间）以验证结果。一旦SQL Performance Analyzer显示性能已稳定，请将此步骤中的修复程序实施到生产系统。</p>
                        <div class="infoboxnotealso" id="GUID-0B629FA1-FF45-44D0-BB2D-28FF762BC102__GUID-7AD96124-4263-4634-95E7-AD45264567AD">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关使用SQL Tuning Advisor和传输SQL调优集的信息，请参阅<a href="../tgsql/introduction-to-sql-tuning.html#TGSQL540" target="_blank"><span><cite>“Oracle数据库SQL调优指南”</cite></span></a></p>
                              </li>
                              <li>
                                 <p>有关<code class="codeph">DBMS_SQLTUNE</code>包的信息<a href="../arpls/DBMS_SQLTUNE.html#ARPLS220" target="_blank"><span><cite>，请参见Oracle Database PL / SQL包和类型参考</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="RATUG310"></a><div class="props_rev_3"><a id="GUID-48F67DD6-70B6-49CC-B4B3-72F2D80E6DDD" name="GUID-48F67DD6-70B6-49CC-B4B3-72F2D80E6DDD"></a><h4 id="RATUG-GUID-48F67DD6-70B6-49CC-B4B3-72F2D80E6DDD" class="sect4"><span class="enumeration_section">6.2.6</span>使用API创建SQL计划基准</h4>
                  <div>
                     <div class="section">
                        <p>创建<a id="d9478e3820" class="indexterm-anchor"></a>具有计划更改的回归SQL语句的SQL计划基准是运行SQL Tuning Advisor的另一种选择。这样做会指示优化器将来使用这些SQL语句的原始执行计划。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-48F67DD6-70B6-49CC-B4B3-72F2D80E6DDD__GUID-A42EB19E-337F-4B70-802F-614794511B08">要为原始计划创建SQL计划基准：</p>
                        <ol>
                           <li>
                              <p>创建仅包含回归SQL语句的SQL调优集的子集。</p>
                           </li>
                           <li>
                              <p>通过使用以下方法加载其计划，为此SQL语句子集创建SQL计划基准<a id="d9478e3835" class="indexterm-anchor"></a> <code class="codeph">LOAD_PLANS_FROM_SQLSET</code>所述的功能<code class="codeph">DBMS_SPM</code>包，显示在下面的例子：</p><pre class="oac_no_warn" dir="ltr">DECLARE my_plans PLS_INTEGER; BEGIN my_plans：= DBMS_SPM.LOAD_PLANS_FROM_SQLSET（sqlset_name =&gt;'regressed_sql'）;结束; /</pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-48F67DD6-70B6-49CC-B4B3-72F2D80E6DDD__GUID-0F1C2A13-9DC8-4CEA-9F3D-B0C08055E261">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关使用SQL计划基准的信息，请<a href="../tgsql/overview-of-sql-plan-management.html#TGSQL615" target="_blank"><span><cite>参见“Oracle数据库SQL调整指南”</cite></span></a></p>
                              </li>
                              <li>
                                 <p>有关<code class="codeph">DBMS_SPM</code>程序包的信息，请<code class="codeph">DBMS_SPM</code> <a href="../arpls/DBMS_SPM.html#ARPLS150" target="_blank"><span><cite>Oracle Database PL / SQL程序包和类型参考</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="RATUG209"></a><div class="props_rev_3"><a id="GUID-88737A1B-A21D-437A-AA8B-8D86B2048A77" name="GUID-88737A1B-A21D-437A-AA8B-8D86B2048A77"></a><h4 id="RATUG-GUID-88737A1B-A21D-437A-AA8B-8D86B2048A77" class="sect4"><span class="enumeration_section">6.2.7</span>使用SQL性能分析器视图</h4>
                  <div>
                     <div class="section">
                        <p>您可以查询以下视图以进行监视<a id="d9478e3948" class="indexterm-anchor"></a> SQL Performance Analyzer并查看其分析结果：</p>
                        <div class="infoboxnote" id="GUID-88737A1B-A21D-437A-AA8B-8D86B2048A77__GUID-A513FB42-5120-4F21-85F9-EAD99B1628D2">
                           <p class="notep1">注意：</p>
                           <p>这些视图中可用的信息也包含在SQL Performance Analyzer报告中。建议您使用SQL Performance Analyzer报告来查看分析结果。请考虑仅将这些视图用于对结果执行更高级的分析。</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">DBA_ADVISOR_TASKS</code>和<code class="codeph">USER_ADVISOR_TASKS</code>视图显示有关已创建的SQL Performance Analyzer任务的描述性信息。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">DBA_ADVISOR_EXECUTIONS</code>和<code class="codeph">USER_ADVISOR_EXECUTIONS</code>视图显示有关任务执行的信息。SQL Performance Analyzer至少创建三次执行，以分析数据库更改对SQL工作负载造成的SQL性能影响。第一次执行收集性能数据的更改前版本。第二次执行收集性能数据的更改后版本。第三次执行执行比较分析。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">DBA_ADVISOR_FINDINGS</code>和<code class="codeph">USER_ADVISOR_FINDINGS</code>视图显示SQL Performance Analyzer的结果。SQL Performance Analyzer生成以下类型的发现：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>问题，如性能回归</p>
                                 </li>
                                 <li>
                                    <p>症状，例如执行计划的结构发生变化时</p>
                                 </li>
                                 <li>
                                    <p>错误，例如对象或视图不存在</p>
                                 </li>
                                 <li>
                                    <p>信息性消息，例如更改前版本中执行计划的结构与存储在SQL调优集中的结构不同</p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p><code class="codeph">DBA_ADVISOR_SQLPLANS</code>和<code class="codeph">USER_ADVISOR_SQLPLANS</code>视图显示所有执行计划的列表。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">DBA_ADVISOR_SQLSTATS</code>和<code class="codeph">USER_ADVISOR_SQLSTATS</code>视图显示所有SQL编译和执行统计信息的列表。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">V$ADVISOR_PROGRESS</code>视图显示SQL Performance Analyzer的操作进度。使用此视图可以监视SQL语句中已完成或正在等待执行的SQL语句数。<code class="codeph">SOFAR</code>列指示到目前为止处理的SQL语句数， <code class="codeph">TOTAL WORK</code>列显示任务执行要处理的SQL语句总数。
                              </p>
                           </li>
                        </ul>
                        <p>您必须具有<code class="codeph">SELECT_CATALOG_ROLE</code>角色才能访问DBA视图。
                        </p>
                        <div class="infoboxnotealso" id="GUID-88737A1B-A21D-437A-AA8B-8D86B2048A77__GUID-F41D5668-40C6-4638-A93B-60BB29D2A98B">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">DBA_ADVISOR_TASKS</code> ， <code class="codeph">DBA_ADVISOR_EXECUTIONS</code>和<code class="codeph">DBA_ADVISOR_SQLPLANS</code>视图的信息，请<code class="codeph">DBA_ADVISOR_EXECUTIONS</code> <a href="../refrn/index.html" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>