<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>JDBC中的可诊断性</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="JDBC Developer&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="JDBC Developer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="jdbc-developers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-02-13T13:20:37-08:00"></meta>
      <meta name="dcterms.title" content="JDBC Developer&#39;s Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="1999, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96471-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="database-administration.html" title="Previous" type="text/html"></link>
      <link rel="next" href="JDBC-DMS-Metrics.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="JJDBC"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="database-administration.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="JDBC-DMS-Metrics.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">JDBC开发人员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="manageability.html" property="item" typeof="WebPage"><span property="name">可管理性</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">JDBC中的可诊断性</li>
            </ol>
            <a id="GUID-4925EAAE-580E-4E29-9B9A-84143C01A6DC" name="GUID-4925EAAE-580E-4E29-9B9A-84143C01A6DC"></a><a id="JJDBC28885"></a>
            
            <h2 id="JJDBC-GUID-4925EAAE-580E-4E29-9B9A-84143C01A6DC" class="sect2"><span class="enumeration_chapter">35</span> JDBC中的可诊断性</h2>
         </header>
         <div class="ind">
            <div>
               <p>Oracle Database 12 <span class="italic">c</span>第1版（12.1）的诊断功能使您能够诊断使用Oracle JDBC驱动程序的应用程序中的问题以及驱动程序本身的问题。它们还减少了开发和维护使用Oracle JDBC驱动程序访问Oracle数据库实例的Java应用程序所需的工作量。
               </p>
               <p>Oracle JDBC驱动程序提供以下诊断功能，使用户能够识别和修复其JDBC应用程序中的问题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="JDBC-diagnosability.html#GUID-5392F07D-DE8D-4410-B0A9-02C42BD2600E">Oracle JDBC驱动程序的日志记录功能</a></p>
                  </li>
                  <li>
                     <p><a href="JDBC-diagnosability.html#GUID-A6A33BF7-D1E3-4631-96B6-6F85C8891BDA">可诊断性管理</a></p>
                  </li>
               </ul>
               <div class="infoboxnote" id="GUID-4925EAAE-580E-4E29-9B9A-84143C01A6DC__GUID-C37A2E71-ECAB-4ED0-B13C-E57DD8CEDC2D">
                  <p class="notep1">注意：</p>
                  <p>JDBC驱动程序的可诊断性功能基于标准的<code class="codeph">java.util.logging</code>框架和<code class="codeph">javax.management</code> MBean框架。有关这些标准框架的信息未在本文档中介绍。
                  </p>
               </div>
            </div><a id="JJDBC28886"></a><div class="props_rev_3"><a id="GUID-5392F07D-DE8D-4410-B0A9-02C42BD2600E" name="GUID-5392F07D-DE8D-4410-B0A9-02C42BD2600E"></a><h3 id="JJDBC-GUID-5392F07D-DE8D-4410-B0A9-02C42BD2600E" class="sect3"><span class="enumeration_section">35.1</span>关于Oracle JDBC驱动程序的日志记录功能</h3>
               <div>
                  <p>本节介绍以下概念：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="JDBC-diagnosability.html#GUID-FAD85E27-A287-4A24-93C7-9360DD47A65E">Oracle JDBC驱动程序的日志记录功能概述</a></p>
                     </li>
                     <li>
                        <p><a href="JDBC-diagnosability.html#GUID-DF070D0F-2D70-4A0F-A542-C4A02BF8F3FD">启用和使用JDBC日志记录</a></p>
                     </li>
                     <li>
                        <p><a href="JDBC-diagnosability.html#GUID-193E4D19-40D4-40D8-89C5-1A792E15F538">在运行时启用或禁用特定于功能的日志记录</a></p>
                     </li>
                     <li>
                        <p><a href="JDBC-diagnosability.html#GUID-9424BE5F-75BC-4901-90F1-2C4AD617E612">使用日志记录配置文件进行特定于功能的日志记录</a></p>
                     </li>
                     <li>
                        <p><a href="JDBC-diagnosability.html#GUID-8AF42CEB-423A-4796-B223-6429EC0954EB">性能，可伸缩性和安全性问题</a></p>
                     </li>
                  </ul>
               </div>
               <div class="props_rev_3"><a id="GUID-FAD85E27-A287-4A24-93C7-9360DD47A65E" name="GUID-FAD85E27-A287-4A24-93C7-9360DD47A65E"></a><h4 id="JJDBC-GUID-FAD85E27-A287-4A24-93C7-9360DD47A65E" class="sect4"><span class="enumeration_section">35.1.1</span> Oracle JDBC驱动程序的日志记录功能概述</h4>
                  <div>
                     <p>此功能记录有关JDBC驱动程序代码运行时发生的事件的信息。事件可以包括用户可见事件，例如SQL异常，SQL语句的运行以及详细的JDBC内部事件，例如进入和退出内部JDBC方法。用户可以启用此功能来记录特定事件或所有事件。</p>
                     <p>之前Oracle数据库11 <span class="italic">克</span> ，JDBC驱动程序支持的J2SE 2.0和3.0。这些版本的J2SE不包含<code class="codeph">java.util.logging</code> 。因此，通过JDBC驱动程序版本Oracle数据库<span class="italic">11克</span>之前提供日志记录功能，从不同<code class="codeph">java.util.logging</code>框架。
                     </p>
                     <p>从Oracle Database <span class="italic">11g开始</span> ，JDBC驱动程序不再支持J2SE 2.0和3.0。因此，JDBC驱动程序的日志记录功能充分利用了标准的<code class="codeph">java.util.logging</code>包。增强的日志记录系统可有效利用日志级别，使用户能够将日志输出限制为感兴趣的内容。它更一致地记录特定类别的信息，使用户更容易理解日志文件。
                     </p>
                     <p>此功能不会引入新的API或配置文件。只有新参数才会添加到现有标准<code class="codeph">java.util.logging</code>配置文件中。这些参数与现有参数的使用相同，并且是使用<code class="codeph">java.util.logging</code>所固有的。
                     </p>
                     <div class="infoboxnote" id="GUID-FAD85E27-A287-4A24-93C7-9360DD47A65E__GUID-BF3E09AB-3B4E-4E34-B202-ACECE0524AD1">
                        <p class="notep1">注意：</p>
                        <p>Oracle不保证生成的日志的确切内容。在很大程度上，日志内容取决于实现的细节。每个版本的实现细节都会发生变化，因此，日志的确切内容可能会随着版本的不同而发生变化。</p>
                     </div>
                  </div>
               </div><a id="JJDBC28887"></a><div class="props_rev_3"><a id="GUID-DF070D0F-2D70-4A0F-A542-C4A02BF8F3FD" name="GUID-DF070D0F-2D70-4A0F-A542-C4A02BF8F3FD"></a><h4 id="JJDBC-GUID-DF070D0F-2D70-4A0F-A542-C4A02BF8F3FD" class="sect4"><span class="enumeration_section">35.1.2</span>启用和使用JDBC日志记录</h4>
                  <div>
                     <div class="section">
                        <p>在开始调试Java应用程序之前，必须启用并配置JDBC日志记录。本节介绍了启用和使用JDBC日志记录必须执行的步骤。它描述了以下内容：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="JDBC-diagnosability.html#GUID-2FEB42BE-18C6-4B35-A7D5-5E0F3EA44488">关于配置CLASSPATH</a></p>
                           </li>
                           <li>
                              <p><a href="JDBC-diagnosability.html#GUID-37D49DEF-5A0C-4045-85EA-77DF3B6E4642">启用日志记录</a></p>
                           </li>
                           <li>
                              <p><a href="JDBC-diagnosability.html#GUID-CC80EBFC-1A78-4CAA-90A3-7CD3905E74E0">配置日志记录</a></p>
                           </li>
                           <li>
                              <p><a href="JDBC-diagnosability.html#GUID-FC389434-C69D-47FC-9A55-416A9131F970">使用记录器</a></p>
                           </li>
                           <li>
                              <p><a href="JDBC-diagnosability.html#GUID-08840EEF-03B0-48BC-BAC7-F864FCAA2078">记录示例</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div><a id="JJDBC28888"></a><div class="props_rev_3"><a id="GUID-2FEB42BE-18C6-4B35-A7D5-5E0F3EA44488" name="GUID-2FEB42BE-18C6-4B35-A7D5-5E0F3EA44488"></a><h5 id="JJDBC-GUID-2FEB42BE-18C6-4B35-A7D5-5E0F3EA44488" class="sect5"><span class="enumeration_section">35.1.2.1</span>关于配置CLASSPATH</h5>
                     <div>
                        <div class="section">
                           <p>Oracle为每个版本的JDBC驱动程序提供了几个JAR文件。优化的JAR文件不包含任何日志记录代码，因此在使用时不会生成任何日志输出。要获取日志输出，必须使用调试JAR文件，这些文件在文件名中用“_g”表示，如<code class="codeph">ojdbc6_g.jar</code>或<code class="codeph">ojdbc7_g.jar</code> 。调试JAR文件必须包含在<code class="codeph">CLASSPATH</code> 。</p>
                           <div class="infoboxnote" id="GUID-2FEB42BE-18C6-4B35-A7D5-5E0F3EA44488__GUID-BF1345ED-F3C4-4671-BF11-EE8915A84C50">
                              <p class="notep1">注意：</p>
                              <p>确保调试JAR文件（例如<code class="codeph">ojdbc6_g.jar</code>或<code class="codeph">ojdbc7_g.jar</code> ）是<code class="codeph">CLASSPATH</code>唯一的Oracle JDBC JAR文件。</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="JJDBC28889"></a><div class="props_rev_3"><a id="GUID-37D49DEF-5A0C-4045-85EA-77DF3B6E4642" name="GUID-37D49DEF-5A0C-4045-85EA-77DF3B6E4642"></a><h5 id="JJDBC-GUID-37D49DEF-5A0C-4045-85EA-77DF3B6E4642" class="sect5"><span class="enumeration_section">35.1.2.2</span>启用日志记录</h5>
                     <div>
                        <div class="section">
                           <p>您可以通过以下方式启用日志记录：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>设置Java系统属性</p>
                                 <p>您可以通过设置<code class="codeph">oracle.jdbc.来启用日志记录<code class="codeph">oracle.jdbc.Trace</code>系统属性。
                                 </p><pre class="oac_no_warn" dir="ltr">java -Doracle.jdbc。Trace = true ......
</pre><p>设置系统属性可启用全局日志记录，这意味着将为整个应用程序启用日志记录。如果要调试整个应用程序，或者如果您不想或不想更改应用程序的源代码，则可以使用全局日志记录。</p>
                              </li>
                              <li>
                                 <p>编程</p>
                                 <p>您可以通过以下方式以编程方式启用或禁用日志记录：</p>
                                 <p>首先，获取Diagnosability MBean的<code class="codeph">ObjectName</code> 。<code class="codeph">ObjectName</code>是</p><pre class="oac_no_warn" dir="ltr">com.oracle.jdbc：类型=诊断性，名称= &lt;装载机&gt;</pre><p>这里， <code class="codeph">loader</code>是一个基于加载Oracle JDBC驱动程序的类加载器实例的唯一名称。
                                 </p>
                                 <div class="infoboxnote" id="GUID-37D49DEF-5A0C-4045-85EA-77DF3B6E4642__GUID-DF2AACA9-0FB8-4961-BE7D-8844BA444CB4">
                                    <p class="notep1">注意：</p>
                                    <p>可以在单个VM中多次加载驱动程序。因此，可以有多个MBean，每个MBean都有一个唯一的名称。</p>
                                 </div>
                                 <p>现在，编写以下代码行：</p><pre class="oac_no_warn" dir="ltr">ClassLoader l = oracle.jdbc。OracleDriver.getClassLoader（）; String loader = l.getName（）+“@”+ l.hashCode（）; //计算ObjectName</pre><pre class="oac_no_warn" dir="ltr">javax.management。ObjectName name = new javax.management。ObjectName（“com.oracle.jdbc：type = diagnosability，name =”+ loader）; //获取MBean服务器javax.management。MBeanServer mbs = java.lang.management。ManagementFactory.getPlatformMBeanServer（）; //找出是否启用了日志记录System.out.println（“LoggingEnabled =”+ mbs.getAttribute（name，“LoggingEnabled”））; //启用日志记录mbs.setAttribute（name，new javax.management。属性（“LoggingEnabled”，true））; //禁用日志记录mbs.setAttribute（name，new javax.management。属性（“LoggingEnabled”，false））;</pre><div class="infoboxnote" id="GUID-37D49DEF-5A0C-4045-85EA-77DF3B6E4642__GUID-DF38CF13-BFD5-4506-BA43-7B3687F35924">
                                    <p class="notep1">注意：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p>如果同一个类加载器多次加载JDBC驱动程序，则每个后续MBean都会增加<code class="codeph">l.hashCode()</code>方法的值，以便创建唯一的名称。识别哪个MBean与哪个JDBC驱动程序实例相关联可能会有问题。
                                          </p>
                                       </li>
                                       <li>
                                          <p>如果只加载了一个JDBC驱动程序实例，则将名称设置为“*”。</p>
                                       </li>
                                    </ul>
                                 </div>
                              </li>
                           </ul>
                           <p>编程启用和禁用日志记录可帮助您控制应用程序的哪些部分需要生成日志输出。</p>
                           <div class="infoboxnote" id="GUID-37D49DEF-5A0C-4045-85EA-77DF3B6E4642__GUID-3AF4C865-FF5D-4998-A38D-81BC3C6CC223">
                              <p class="notep1">注意：</p>
                              <p>使用任一方法启用日志记录只会生成严重错误的最小日志。通常这没什么用。要生成更有用和详细的日志，必须配置<code class="codeph">java.util.logging</code> 。
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="JJDBC28890"></a><div class="props_rev_3"><a id="GUID-CC80EBFC-1A78-4CAA-90A3-7CD3905E74E0" name="GUID-CC80EBFC-1A78-4CAA-90A3-7CD3905E74E0"></a><h5 id="JJDBC-GUID-CC80EBFC-1A78-4CAA-90A3-7CD3905E74E0" class="sect5"><span class="enumeration_section">35.1.2.3</span>配置日志记录</h5>
                     <div>
                        <div class="section">
                           <p>要生成有用且详细的日志，必须配置<code class="codeph">java.util.logging</code> 。这可以通过配置文件或以编程方式完成。
                           </p>
                           <p>示例配置文件<code class="codeph">OracleLog.properties</code>是作为<code class="codeph">demo</code>目录中JDBC安装的一部分提供的。它包含有关如何配置<code class="codeph">java.util.logging</code>基本信息，并提供了一些可以开始的初始设置。您可以按原样使用此示例文件，编辑文件并使用它，重命名文件并对其进行编辑，或创建任何名称的全新文件。
                           </p>
                           <p>要使用配置文件，必须将其标识为Java运行时。这可以通过设置系统属性来完成。例如：</p><pre class="oac_no_warn" dir="ltr">java -Djava.util.logging.config.file = / jdbc / demo / OracleLog.properties。
</pre><p>它由<code class="codeph">java.util.logging</code>系统读取。该文件可驻留在任何地方。
                           </p>
                           <p>您可以使用<code class="codeph">java.util.logging.config.file</code>和<code class="codeph">oracle.jdbc.Trace</code>同时。
                           </p><pre class="oac_no_warn" dir="ltr">java -Djava.util.logging.config.file = / jdbc / demo / OracleLog.properties -Doracle.jdbc。跟踪=真</pre><p>您可以使用默认的<code class="codeph">OracleLog.properties</code>文件。它可能会或可能不会得到您想要的输出。您还可以按照以下步骤创建和使用自己的配置文件：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>创建名为<code class="codeph">myConfig.properties</code>的文件。您可以使用您选择的任何名称。</span></li>
                           <li class="stepexpand"><span>在文件中插入以下文本行：</span><div><pre class="oac_no_warn" dir="ltr">.level = SEVERE oracle.jdbc.level = INFO oracle.jdbc.handlers = java.util.logging。ConsoleHandler java.util.logging。ConsoleHandler.level = INFO java.util.logging。ConsoleHandler.formatter = java.util.logging的。SimpleFormatter</pre></div>
                           </li>
                           <li class="stepexpand"><span>保存文件。</span></li>
                           <li class="stepexpand"><span>设置系统属性以使用此配置文件。</span><div><pre class="oac_no_warn" dir="ltr">java -Djava.util.logging.config.file = &lt; <span class="italic">filepath</span> &gt; /myConfig.properties ...
</pre><p><span class="italic"><code class="codeph">filepath</code></span>是保存<code class="codeph">myConfig.properties</code>文件的文件夹的路径。
                                 </p>
                              </div>
                           </li>
                        </ol>
                        <div class="section">
                           <div class="infoboxnote" id="GUID-CC80EBFC-1A78-4CAA-90A3-7CD3905E74E0__GUID-406EF47F-8D8E-4393-A7B1-242599DE6815">
                              <p class="notep1">注意：</p>
                              <p>如果使用步骤2中指定的设置，则将生成大量日志输出。此外，日志输出将显示在控制台上。</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-5E8CB599-C7D8-48E7-87E7-53559D22D318" name="GUID-5E8CB599-C7D8-48E7-87E7-53559D22D318"></a><h5 id="JJDBC-GUID-5E8CB599-C7D8-48E7-87E7-53559D22D318" class="sect5"><span class="enumeration_section">35.1.2.4</span>将日志输出重定向到文件</h5>
                     <div>
                        <div class="section">
                           <p>您还可以配置<code class="codeph">java.util.logging</code>以将日志输出重定向到文件中。为此，请按如下所示修改配置文件：</p><pre class="oac_no_warn" dir="ltr">.level = SEVERE oracle.jdbc.level = INFO oracle.jdbc.handlers = java.util.logging。FileHandler java.util.logging。FileHandler.level = INFO java.util.logging。FileHandler.pattern = jdbc.log java.util.logging。FileHandler.count = 1 java.util.logging。FileHandler.formatter = java.util.logging的。SimpleFormatter</pre><p>这将生成完全相同的日志输出，并将其保存在当前目录中名为<code class="codeph">jdbc.log</code>的文件中。
                           </p>
                           <p>您可以通过更改级别设置来控制详细信息量。从最不详细到最详细的定义级别如下：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">关闭</code></p>
                                 <p>关闭日志记录。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">严重</code></p>
                                 <p>记录SQLExceptions和内部错误。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">警告</code></p>
                                 <p>记录SQLWarnings和坏但不致命的内部条件。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">信息</code></p>
                                 <p>记录不常见但重要的事件和错误。它产生相对较少量的日志消息。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">CONFIG</code></p>
                                 <p>记录执行的SQL字符串。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">精细</code></p>
                                 <p>将进入和退出记录到每个提供JDBC操作详细跟踪的公共方法。它产生相当大量的日志消息。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">FINER</code></p>
                                 <p>记录对内部方法的调用。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">FINEST</code></p>
                                 <p>记录对高容量内部方法的调用。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">所有</code></p>
                                 <p>记录所有细节。这是最详细的日志记录级别。</p>
                              </li>
                           </ul>
                           <div class="infoboxnote" id="GUID-5E8CB599-C7D8-48E7-87E7-53559D22D318__GUID-0DB8270F-AB62-4483-8AE1-25B44D06B254">
                              <p class="notep1">注意：</p>
                              <p>比<code class="codeph">FINE</code>更详细的级别会产生巨大的日志量。
                              </p>
                           </div>
                           <p>在前面提供的示例中，要减少详细信息量，请更改<code class="codeph">java.util.logging.从<code class="codeph">ALL</code>到<code class="codeph">INFO</code> FileHandler.level</code>设置：</p><pre class="oac_no_warn" dir="ltr">java.util.logging的。FileHandler.level = INFO</pre><div class="infoboxnote" id="GUID-5E8CB599-C7D8-48E7-87E7-53559D22D318__GUID-64C652B8-090D-459B-B647-6218E4610C9B">
                              <p class="notep1">注意：</p>
                              <p><code class="codeph">INFO</code>记录执行的SQL字符串。
                              </p>
                           </div>
                           <p>虽然可以，但没有必要更改<code class="codeph">oracle.jdbc</code>记录器的级别。设置<code class="codeph">FileHandler</code>级别将控制将哪些日志消息转储到日志文件中。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="JJDBC28891"></a><div class="props_rev_3"><a id="GUID-FC389434-C69D-47FC-9A55-416A9131F970" name="GUID-FC389434-C69D-47FC-9A55-416A9131F970"></a><h5 id="JJDBC-GUID-FC389434-C69D-47FC-9A55-416A9131F970" class="sect5"><span class="enumeration_section">35.1.2.5</span>使用记录器</h5>
                     <div>
                        <div class="section">
                           <p>设置级别会减少JDBC的所有日志记录输出。但是，有时您需要从代码的一部分输出大量输出，而从其他部分输出很少。为此，您必须了解有关记录器的更多信息。</p>
                           <p>记录器存在于由其名称定义的树结构中。根记录器名为“”，空字符串。如果查看配置文件的第一行，您会看到<code class="codeph">.level=SEVERE</code> 。这是设置根记录器的级别。下一行是<code class="codeph">oracle.jdbc.level=INFO</code> 。这将设置名为<code class="codeph">oracle.jdbc</code>的记录器的级别。<code class="codeph">oracle.jdbc</code>记录器是记录器树的成员。它的父母名为<code class="codeph">oracle</code> 。<code class="codeph">oracle</code> logger的父级是根记录器（空字符串）。
                           </p>
                           <p>记录消息将发送到特定的记录器，例如<code class="codeph">oracle.jdbc</code> 。如果消息通过该级别的级别检查，则消息将传递给该级别的处理程序（如果有），并传递给父级记录器。因此，发送到<code class="codeph">oracle.log</code>的日志消息将与该记录器的级别进行比较，如果您正在跟踪，则将<code class="codeph">INFO</code>进行比较。如果级别相同或更少（不太详细），则将其发送到FileHandler和父级记录器“oracle”。再次根据级别进行检查。如果在这种情况下，未设置级别，则它使用父级别<code class="codeph">SEVERE</code> 。如果消息级别相同或更小，则将其传递给处理程序，而处理程序没有一个，并发送给父级。在这种情况下，根记录器中的父级。所有这些树结构都没有帮助您减少输出量。有用的是JDBC驱动程序使用多个子记录程序。如果将日志消息限制为其中一个子记录器，则输出将大大减少。Oracle JDBC驱动程序使用的记录器包括以下内容：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">oracle.jdbc</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">oracle.jdbc.pool</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">oracle.jdbc.rowset</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">oracle.jdbc.xa</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">oracle.sql</code></p>
                              </li>
                           </ul>
                           <div class="infoboxnote" id="GUID-FC389434-C69D-47FC-9A55-416A9131F970__GUID-4859D0D5-BB16-4B44-A911-A368081DE9D3">
                              <p class="notep1">注意：</p>
                              <p>驱动程序使用的记录器可能因发行版而异。</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="JJDBC28892"></a><div class="props_rev_3"><a id="GUID-08840EEF-03B0-48BC-BAC7-F864FCAA2078" name="GUID-08840EEF-03B0-48BC-BAC7-F864FCAA2078"></a><h5 id="JJDBC-GUID-08840EEF-03B0-48BC-BAC7-F864FCAA2078" class="sect5"><span class="enumeration_section">35.1.2.6</span>记录示例</h5>
                     <div>
                        <div class="section">
                           <p>假设您要跟踪<code class="codeph">oracle.sql</code>组件中发生的事情，并且还想捕获有关驱动程序其余部分的一些基本信息。这是一种更复杂的日志记录。以下是<code class="codeph">config</code>文件中的条目：</p><pre class="oac_no_warn" dir="ltr">## set levels＃.level = SEVERE oracle.level = INFO oracle.jdbc.driver.level = INFO oracle.jdbc.pool.level = OFF oracle.jdbc.util.level = OFF oracle.sql.level = INFO ##配置处理程序#oracle.handlers = java.util.logging。ConsoleHandler java.util.logging。ConsoleHandler.level = INFO java.util.logging。ConsoleHandler.formatter = java.util.logging的。SimpleFormatter</pre><p>让我们考虑一下配置文件中的每一行是做什么的。</p><pre class="oac_no_warn" dir="ltr">.LEVEL =严重</pre><p>将根记录器的日志记录级别设置为<code class="codeph">SEVERE</code> 。除非出现严重错误，否则我们不希望看到来自其他非Oracle组件的任何日志记录。因此，我们将所有记录器的默认级别设置为<code class="codeph">SEVERE</code> 。除非明确设置，否则每个记录器都从其父级继承其级别。通过将根记录器的级别设置为<code class="codeph">SEVERE</code>我们确保所有其他记录器继承该级别，否则我们设置的级别除外。
                           </p><pre class="oac_no_warn" dir="ltr">oracle.level = INFO</pre><p>我们希望从<code class="codeph">oracle.sql</code>和<code class="codeph">oracle.jdbc.driver</code>记录器输出日志。他们的共同祖先是<code class="codeph">oracle</code> 。因此，我们将<code class="codeph">oracle</code>记录器的级别设置为<code class="codeph">INFO</code> 。我们将在较低级别更明确地控制细节。
                           </p><pre class="oac_no_warn" dir="ltr">oracle.jdbc.driver.level = INFO</pre><p>我们只想从<code class="codeph">oracle.jdbc.driver</code>看到SQL执行。因此，我们将级别设置为<code class="codeph">INFO</code> 。这是一个相当低的音量水平，但将帮助我们跟踪我们的测试正在做什么。
                           </p><pre class="oac_no_warn" dir="ltr">oracle.jdbc.pool.level = OFF</pre><p>我们在测试中使用了<code class="codeph">DataSource</code> ，并且不希望看到所有这些日志记录。因此，我们将其<code class="codeph">OFF</code> 。</p><pre class="oac_no_warn" dir="ltr">oracle.jdbc.util.level = OFF</pre><p>我们不希望从<code class="codeph">oracle.jdbc.util</code>包中看到日志记录。如果我们使用XA或行集，我们也会关闭它们。
                           </p><pre class="oac_no_warn" dir="ltr">oracle.sql.level = INFO</pre><p>我们想看看<code class="codeph">oracle.sql</code>发生了什么。因此，我们将级别设置为<code class="codeph">INFO</code> 。这提供了很多关于公共方法调用的信息，而没有详细说明。
                           </p><pre class="oac_no_warn" dir="ltr">oracle.handlers = java.util.logging的。ConsoleHandler</pre><p>我们要把所有东西都<code class="codeph">stderr</code> 。当我们运行测试时，我们将<code class="codeph">stderr</code>重定向到一个文件。
                           </p><pre class="oac_no_warn" dir="ltr">java.util.logging的。ConsoleHandler.level = INFO</pre><p>我们想将所有内容转储到<code class="codeph">System.err</code>的控制台。在这种情况下，我们使用记录器而不是处理程序进行过滤。
                           </p><pre class="oac_no_warn" dir="ltr">java.util.logging的。ConsoleHandler.formatter = java.util.logging的。SimpleFormatter</pre><p>我们将使用简单的，或多或少的人类可读格式。</p>
                           <p>当您使用此配置文件运行测试时，您将从<code class="codeph">oracle.sql</code>包中获得中等详细信息，从核心驱动程序代码获取一些信息， <code class="codeph">oracle.sql</code>从任何其他代码获取任何信息。
                           </p>
                           <p>您还可以使用<code class="codeph">XMLFormatter</code>将日志发送到Oracle Support。
                           </p>
                           <p>您可以实现和使用自定义<code class="codeph">java.util.logging.Filter</code>以更好地控制日志中捕获的数据。这是标准的<code class="codeph">java.util.logging</code>功能，在JSE JavaDoc中有记录。自定义过滤器使您能够：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>在多线程应用程序中仅捕获一个线程</p>
                              </li>
                              <li>
                                 <p>捕获长时间运行的应用程序中的间歇性错</p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-193E4D19-40D4-40D8-89C5-1A792E15F538" name="GUID-193E4D19-40D4-40D8-89C5-1A792E15F538"></a><h4 id="JJDBC-GUID-193E4D19-40D4-40D8-89C5-1A792E15F538" class="sect4"><span class="enumeration_section">35.1.3</span>在运行时启用或禁用特定于功能的日志记录</h4>
                  <div>
                     <p></p>
                     <div class="section">
                        <p>从Oracle Database 12 <span class="italic">c</span>第2版（12.2.0.1）开始，JDBC支持在运行时为所选功能启用和禁用特定于功能的日志记录。例如，您可以仅为Load Balancing功能启用日志记录，同时禁用JDBC的其他功能的日志记录。同样，在同一运行期间，您可以启用快速连接故障转移功能的日志记录，并禁用负载平衡功能的日志记录。
                        </p>
                        <p>默认情况下，启用所有功能的日志记录。</p>
                        <p>JDBC的日志切换旋钮是<code class="codeph">OracleDiagnosabilityMBean</code>的一部分。要使用此bean，请启动JConsole并连接到该应用程序。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-193E4D19-40D4-40D8-89C5-1A792E15F538__GUID-A5C350B5-9739-458D-937A-8E57C0C98109"><span class="bold">显示支持的功能</span><p>有关支持的功能的列表，请使用以下方法：</p><pre class="pre codeblock"><code>getTraceController（）。getSupportedFeatures（）</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-193E4D19-40D4-40D8-89C5-1A792E15F538__GUID-B1D3D7AC-30E8-416D-9FDC-91673BC8B2C9"><span class="bold">显示启用的功能</span><p>有关当前启用的功能的列表，请使用以下方法：</p><pre class="pre codeblock"><code>getTraceController（）。getEnabledFeatures（）</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-193E4D19-40D4-40D8-89C5-1A792E15F538__GUID-894E30E9-7234-4462-BB13-D1104692B9F7"><span class="bold">启用功能的日志记录</span><p>要为特定功能或所有功能启用日志记录，请通过以下方式使用<code class="codeph">trace</code>方法：</p><pre class="pre codeblock"><code>trace（布尔启用，String feature_name）跟踪（布尔启用，ALL）</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-193E4D19-40D4-40D8-89C5-1A792E15F538__GUID-D4DD90D1-1A4E-468B-A848-79CC2BCB777C"><span class="bold">禁用功能的日志记录</span><p>要禁用特定功能或所有功能的日志记录，请通过以下方式使用<code class="codeph">trace</code>方法：</p><pre class="pre codeblock"><code>trace（布尔禁用，String feature_name）跟踪（布尔禁用，ALL）</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-193E4D19-40D4-40D8-89C5-1A792E15F538__GUID-CDD338A8-C5F4-4B0A-A34A-3146AB70A8C6"><span class="bold">暂停和恢复记录</span><p>分别使用以下方法暂停和恢复日志记录：</p><pre class="pre codeblock"><code>suspend（）resume（）</code></pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-9424BE5F-75BC-4901-90F1-2C4AD617E612" name="GUID-9424BE5F-75BC-4901-90F1-2C4AD617E612"></a><h4 id="JJDBC-GUID-9424BE5F-75BC-4901-90F1-2C4AD617E612" class="sect4"><span class="enumeration_section">35.1.4</span>使用日志记录配置文件进行特定于功能的日志记录</h4>
                  <div>
                     <p></p>
                     <div class="example" id="GUID-9424BE5F-75BC-4901-90F1-2C4AD617E612__GUID-17EAB112-9565-4AFA-A490-496B26656BDA">
                        <p>从Oracle Database 12 <span class="italic">c</span>第2版（12.2.0.1）开始，您可以通过在日志记录配置文件中添加属性来启用或禁用特定功能的日志记录。默认情况下，为所有功能启用日志记录。否则，您可以使用以下语法为所有功能启用日志记录：</p><pre class="pre codeblock"><code>clio.feature.all = on</code></pre><p>对于特定于功能的日志记录启用，您可以使用以下属性：</p><pre class="pre codeblock"><code>clio.feature.pool_statistics = on clio.feature.check_in = on clio.feature.check_out = on clio.feature.labeling = on clio.feature.conn_construction = on clio.feature.conn_destruction = on clio.feature.high_availability = on clio .feature.load_balancing = on clio.feature.transaction_affinity = on clio.feature.web_affinity = on clio.feature.data_affinity = on clio.feature.conn_harvesting = on clio.feature.ttl_conn_timeout = on clio.feature.abandoned_conn_timeout = on clio。 feature.admin = on clio.feature.sharding = on</code></pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="JJDBC28894"></a><a id="JJDBC28895"></a><a id="JJDBC28893"></a><div class="props_rev_3"><a id="GUID-8AF42CEB-423A-4796-B223-6429EC0954EB" name="GUID-8AF42CEB-423A-4796-B223-6429EC0954EB"></a><h4 id="JJDBC-GUID-8AF42CEB-423A-4796-B223-6429EC0954EB" class="sect4"><span class="enumeration_section">35.1.5</span>性能，可伸缩性和安全性问题</h4>
                  <div>
                     <div class="section">
                        <p>虽然日志记录功能使您能够跟踪或调试应用程序并生成详细日志输出，但它具有一定的性能，可伸缩性和安全性问题。</p>
                        <div class="infoboxnote" id="GUID-8AF42CEB-423A-4796-B223-6429EC0954EB__GUID-A72F28B1-E854-42C8-A244-985ECF8E3A42">
                           <p class="notep1">警告：</p>
                           <p>跟踪文件可能包含敏感信息，包括用户名，密码和用户数据。Oracle建议用户<span class="italic">不要将</span> JDBC调试JAR文件与生产数据或凭据一起使用，以便保护该敏感信息。此外，Oracle建议用户必须遵循良好的安全实践来创建跟踪文件。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-8AF42CEB-423A-4796-B223-6429EC0954EB__GUID-84C94C16-FBD1-4015-9553-CB30FB345912">安全问题</p>
                        <p>启用完整日志记录会产生敏感信息将在跟踪文件中公开的风险。这是日志记录功能所固有的。但是，只有某些JDBC JAR文件包含JDBC日志记录功能。以下JAR文件包括完整日志记录，不应在生产环境中使用：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">ojdbc8_g.jar</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">ojdbc8dms_g.jar</code></p>
                           </li>
                        </ul>
                        <p><code class="codeph">ojdbc8dms.jar</code> JAR文件包含有限的日志记录功能。
                        </p>
                        <div class="infoboxnote" id="GUID-8AF42CEB-423A-4796-B223-6429EC0954EB__GUID-3A5EA317-4218-4CA6-A963-F97D2274A122">
                           <p class="notep1">注意：</p>
                           <p>数据库用户名和密码不会出现在由<code class="codeph">ojdbc8_g.jar</code>和<code class="codeph">ojdbc8dms_g.jar</code> JAR文件创建的日志文件中。但是，作为SQL语句，定义值或绑定值的一部分的敏感用户数据可以出现在使用这些JAR文件之一创建的日志中。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-8AF42CEB-423A-4796-B223-6429EC0954EB__GUID-312A07F5-D7A2-47E9-8DFE-BB38F5F0971D">关于跟踪文件的安全处理</p>
                        <p>要安全处理跟踪文件，您必须：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>仅跟踪尽可能多的执行，以最小化跟踪文件中的敏感信息量。</p>
                           </li>
                           <li>
                              <p>在您拥有的目录中创建跟踪文件。不要在公共目录中创建文件，例如<code>/tmp</code>目录。
                              </p>
                           </li>
                           <li>
                              <p>为创建跟踪文件的目录设置<code class="codeph">UMASK</code> 。这将限制用户对跟踪文件的访问。
                              </p>
                           </li>
                           <li>
                              <p>不在<code class="codeph">java.util.logging.启用<code class="codeph">append</code>选项<code class="codeph">java.util.logging.FileHandler</code> 。这将更好地控制跟踪文件的所有者和权限。
                              </p>
                           </li>
                           <li>
                              <p>使用<code class="codeph">ojdbc8.jar</code>文件时，不要将<code class="codeph">LoggingPermission</code>授予JDBC代码库。<code class="codeph">ojdbc8dms.jar</code>文件提供有限的日志输出并需要<code class="codeph">LoggingPermission</code> 。调试JAR文件<code class="codeph">ojdbc8_g.jar</code>和<code class="codeph">ojdbc8dms_g.jar</code>具有广泛的跟踪并需要<code class="codeph">LoggingPermission</code> 。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-8AF42CEB-423A-4796-B223-6429EC0954EB__GUID-1C45AB36-82A9-4648-B45F-1354F4D10F69">性能和可伸缩性问题</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>记录对性能有重大影响。您必须确保在生产系统中未启用日志记录。此外，您<span class="italic">不得</span>在生产环境中使用调试JAR文件。禁用日志记录时，它对性能没有影响。
                        </p>
                        <p>日志记录涉及对大量共享资源的受保护访问，导致可伸缩性严重降低。这是<code class="codeph">java.util.logging</code>框架的内在特征。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="JJDBC28898"></a><a id="JJDBC28897"></a><div class="props_rev_3"><a id="GUID-A6A33BF7-D1E3-4631-96B6-6F85C8891BDA" name="GUID-A6A33BF7-D1E3-4631-96B6-6F85C8891BDA"></a><h3 id="JJDBC-GUID-A6A33BF7-D1E3-4631-96B6-6F85C8891BDA" class="sect3"><span class="enumeration_section">35.2可</span>诊断性管理</h3>
               <div>
                  <div class="section">
                     <p>JDBC可诊断性管理功能引入了MBean， <code class="codeph">oracle.jdbc.driver.OracleDiagnosabilityMBean</code> 。此MBean提供了启用和禁用JDBC日志记录的方法。
                     </p>
                     <div class="infoboxnotealso" id="GUID-A6A33BF7-D1E3-4631-96B6-6F85C8891BDA__GUID-EAC4DA86-98F3-4BC2-953F-B6FC12B27901">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<code class="codeph">OracleDiagnosabilityMBean</code> API的信息，请参阅JDBC Javadoc。
                        </p>
                     </div>
                     <p>在将来的版本中，MBean将得到增强，以提供有关JDBC内部的其他统计信息。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-A6A33BF7-D1E3-4631-96B6-6F85C8891BDA__GUID-50934A7C-AB02-4A58-AB42-487169799F25">安全问题</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>此功能可以启用JDBC日志记录。启用JDBC日志记录不需要任何特殊权限。但是，一旦启用了日志记录，生成任何日志输出都需要标准Java权限<code class="codeph">LoggingPermission</code> 。如果没有此权限，任何生成日志输出的JDBC操作都将引发安全性异常。这是一种标准的Java机制。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>