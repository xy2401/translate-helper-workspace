<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="This chapter describes how to capture a database workload on the production system."></meta>
      <meta name="description" content="This chapter describes how to capture a database workload on the production system."></meta>
      <title>捕获数据库工作负载</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Testing Guide "></meta>
      <meta property="og:description" content="This chapter describes how to capture a database workload on the production system."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Testing Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="testing-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-07T01:43:11-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2008, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96279-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="introduction-to-database-replay.html" title="Previous" type="text/html"></link>
      <link rel="next" href="preprocessing-a-database-workload.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Testing Guide"></meta>
    <meta name="dcterms.isVersionOf" content="RATUG"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="introduction-to-database-replay.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="preprocessing-a-database-workload.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">测试指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="database-replay.html" property="item" typeof="WebPage"><span property="name">数据库重播</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">捕获数据库工作负载</li>
            </ol>
            <a id="GUID-E774C161-98C0-43EF-8B78-DD74E2A2A219" name="GUID-E774C161-98C0-43EF-8B78-DD74E2A2A219"></a><a id="RATUG109"></a>
            
            <h2 id="RATUG-GUID-E774C161-98C0-43EF-8B78-DD74E2A2A219" class="sect2"><span class="enumeration_chapter">10</span>捕获数据库工作负载</h2>
         </header>
         <div class="ind">
            <div>
               <div><span>本章介绍如何在生产系统上捕获数据库工作负载。</span> 使用数据库重放的第一步是捕获生产工作负载。
               </div>
               <p>本章包含以下部分：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-372BA03D-7A24-4300-A0AE-30E0D9D9C724" title="在开始工作负载捕获之前，您应该有一个策略来恢复测试系统上的数据库。">捕获数据库工作负载的先决条件</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-00E1BF0A-489C-4141-A21C-44E3D80EC320" title="确定位置并设置将存储捕获的工作负载的目录。">设置捕获目录</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-79F20163-CE64-4C9C-9F71-C41A95460C05" title="在工作负载捕获之前需要进行适当的规划，以确保在另一个环境中重放时捕获将是准确和有用的。">工作负载捕获选项</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-4A1995F1-78F9-4080-8DFC-1E3EBCB3F4B8" title="某些类型的用户会话和客户端请求有时可能会在工作负载中捕获，但数据库重放不支持它们。在工作负载中捕获这些会话和请求类型可能会在工作负载重放期间导致错误。">工作负载捕获限制</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-46D117CD-67F5-41AD-B85C-41DC6BEE3E23" title="数据库重放支持在运行Oracle数据库10g第2版的系统上捕获数据库工作负载，该系统可用于测试数据库升级到Oracle Database 11g及后续版本。">启用和禁用Workload Capture功能</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-61E843E8-393A-49CE-8AF7-DCFA3E31982A" title="数据库重放资源类型权限使您可以查看或操作任何数据库重放实体。此外，您需要捕获工作负载的目标的目标操作员权限才能访问与工作负载关联的实体。">企业管理器权限和角色</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-1679DB12-B633-4021-A3B9-9CC6216D6681" title="本节介绍如何使用Enterprise Manager捕获数据库工作负载。捕获数据库工作负载的主要工具是Oracle Enterprise Manager。">使用Enterprise Manager捕获数据库工作负载</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67" title="并发捕获是指同时捕获多个数据库上的工作负载。">同时从多个数据库捕获工作负载</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-509ABE02-E9DB-420B-80AA-5FF2B8CDD9A5" title="本节介绍如何使用Enterprise Manager监视工作负载捕获。监视工作负载捕获的主要工具是Oracle Enterprise Manager。">使用Enterprise Manager监视工作负载捕获</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-6F2BBECA-4259-493F-AEFE-4E4183476220" title="您可以将通过PL / SQL界面或通过其他企业管理器实例捕获的工作负载导入企业管理器，以便像在Enterprise Manager中最初创建的工作负载一样对其进行管理。">将工作负载导入企业管理器</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-2DD9B05E-9BD9-4F4D-92F6-E399093CB876" title="对于长时间捕获大量工作负载的情况，您可能只想重播其中的一部分以加速测试。数据库重放工作负载子集功能使您可以通过提取现有捕获工作负载的部分来创建新工作负载。">从现有工作负载创建子集</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-F89B9D09-2394-4C3F-AA11-EF1A73C23A85" title="您可以将复制功能用于两个目的。">将工作负载复制或移动到新位置</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-7AB9889A-6F05-41D3-8EA1-F4BEEC507BDE" title="本节介绍如何使用API捕获数据库工作负载。">使用API捕获数据库工作负载</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-19A5094A-185D-4F1C-B441-FB72AC9EA2ED" title="本节介绍如何使用API加密和解密现有工作负载捕获。">使用API加密和解密现有的工作负载捕获</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-B9D817BE-43F0-4813-B161-14FFD7F51D40" title="本节概述了可以显示以监视工作负载捕获的视图。">使用视图监视工作负载捕获</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-E774C161-98C0-43EF-8B78-DD74E2A2A219__GUID-90AFDA30-98ED-4ECF-9625-4830520D166C">
                  <p class="notep1">也可以看看：</p>
                  <p>有关捕获数据库工作负载如何适应数据库重放体系结构的更多信息，请参阅<span class="q">“ <a href="introduction-to-database-replay.html#GUID-36DE5567-5A64-493B-A154-6581C678FC8A" title="使用数据库重放的第一步是捕获生产工作负载。捕获工作负载涉及将外部客户端发出的所有请求记录到Oracle数据库。">Workload Capture</a> ”</span></p>
               </div>
            </div><a id="RATUG110"></a><div class="props_rev_3"><a id="GUID-372BA03D-7A24-4300-A0AE-30E0D9D9C724" name="GUID-372BA03D-7A24-4300-A0AE-30E0D9D9C724"></a><h3 id="RATUG-GUID-372BA03D-7A24-4300-A0AE-30E0D9D9C724" class="sect3"><span class="enumeration_section">10.1</span>捕获数据库工作负载的先决条件</h3>
               <div>
                  <div><span>在开始工作负载捕获之前，您应该有一个策略来恢复测试系统上的数据库。</span> 在重放工作负载之前，重放系统上的应用程序数据的逻辑状态应与重放开始时的捕获系统的逻辑状态类似。要完成此操作，请考虑使用以下方法之一：</div>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>Recovery Manager（RMAN） <code class="codeph">DUPLICATE</code>命令</p>
                     </li>
                     <li>
                        <p>快照待机</p>
                     </li>
                     <li>
                        <p>数据泵导入和导出</p>
                     </li>
                  </ul>
                  <p>这将允许您将重放系统上的数据库还原到工作负载捕获开始时的应用程序状态。</p>
                  <p>如果数据库受Database Vault保护，则需要获得授权才能在Database Vault环境中使用<code class="codeph">DBMS_WORKLOAD_CAPTURE</code>和<code class="codeph">DBMS_WORKLOAD_REPLAY</code>包，然后才能使用Database Replay。
                  </p>
                  <div class="infoboxnotealso" id="GUID-372BA03D-7A24-4300-A0AE-30E0D9D9C724__GUID-DBC1E0E3-9262-43DC-8FEC-CC6C1873B125">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>有关在Database Vault环境中使用数据库重放的信息，请参见<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/ratug&amp;id=DVADM-GUID-1CEE7F8F-5C83-4322-862E-8DA7A9EC8034" target="_blank"><span><cite>“Oracle Database Vault管理员指南”</cite></span></a></p>
                        </li>
                        <li>
                           <p>有关使用RMAN复制数据库的信息，请参见<a href="../bradv/rman-duplicating-databases.html#BRADV-GUID-F31F9FCE-B610-49EB-B9DB-44B9AA4E838F" target="_blank"><span><cite>“Oracle数据库备份和恢复用户指南”</cite></span></a></p>
                        </li>
                        <li>
                           <p>有关管理快照备用数据库的信息，请参阅<a href="../sbydb/managing-oracle-data-guard-physical-standby-databases.html#SBYDB00700" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a></p>
                        </li>
                        <li>
                           <p>有关使用Data Pump的信息，请<a href="../sutil/oracle-data-pump-overview.html#SUTIL100" target="_blank"><span><cite>参见Oracle数据库实用程序</cite></span></a></p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="RATUG114"></a><div class="props_rev_3"><a id="GUID-00E1BF0A-489C-4141-A21C-44E3D80EC320" name="GUID-00E1BF0A-489C-4141-A21C-44E3D80EC320"></a><h3 id="RATUG-GUID-00E1BF0A-489C-4141-A21C-44E3D80EC320" class="sect3"><span class="enumeration_section">10.2</span>设置捕获目录</h3>
               <div>
                  <div><span>确定位置并设置将存储捕获的工作负载的目录。</span> 在开始工作负载捕获之前，请确保该目录为空并且具有足够的磁盘空间来存储工作负载。如果在工作负载捕获期间目录的磁盘空间不足，则捕获将停止。要估计所需的磁盘空间量，您可以在工作负载上运行测试捕获一小段时间（例如几分钟），以推断完全捕获所需的空间。为避免潜在的性能问题，还应确保将目标重播目录安装在单独的文件系统上。
                  </div>
                  <p>对于Oracle RAC，请考虑使用共享文件系统。或者，您可以设置一个捕获目录路径，该路径解析为每个实例上的单独物理目录，但您需要将在每个目录中创建的文件合并到一个目录中。对于Oracle RAC数据库上的捕获，Enterprise Manager仅支持使用共享文件系统配置的Oracle RAC。必须先将每个实例上的本地捕获目录的全部内容（不仅是捕获文件）复制到共享目录，然后才能将其用于预处理。例如，假设您是：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>在Linux中运行Oracle RAC环境，其中包含两个名为<code class="codeph">host1</code>和<code class="codeph">host2</code>数据库实例</p>
                     </li>
                     <li>
                        <p>使用名为<code class="codeph">CAPDIR</code>的捕获目录对象解析为两个实例上的<code class="codeph">/$ORACLE_HOME/rdbms/capture</code></p>
                     </li>
                     <li>
                        <p>使用驻留在<code class="codeph">/nfs/rac_capture</code>的共享目录</p>
                     </li>
                  </ul>
                  <p>您需要登录每个主机并运行以下命令：</p><pre class="oac_no_warn" dir="ltr">cp -r / $ ORACLE_HOME / rdbms / capture / * / nfs / rac_capture</pre><p>对两个实例完成此操作后， <code class="codeph">/nfs/rac_capture</code>共享目录已准备好进行预处理或屏蔽。
                  </p>
               </div>
            </div><a id="RATUG111"></a><div class="props_rev_3"><a id="GUID-79F20163-CE64-4C9C-9F71-C41A95460C05" name="GUID-79F20163-CE64-4C9C-9F71-C41A95460C05"></a><h3 id="RATUG-GUID-79F20163-CE64-4C9C-9F71-C41A95460C05" class="sect3"><span class="enumeration_section">10.3</span>工作负载捕获选项</h3>
               <div>
                  <p>在工作负载捕获之前需要进行适当的规划，以确保在另一个环境中重放时捕获将是准确和有用的。</p>
                  <p>在捕获数据库工作负载之前，请仔细考虑以下事项<a id="d17564e558" class="indexterm-anchor"></a>选项：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-77DFEBE7-4FF9-4CB4-97B2-8501ECB8E7E4" title="虽然不需要此步骤，但Oracle建议在捕获工作负载之前重新启动数据库，以确保在捕获开始之前允许完成或回滚正在进行的事务和从属事务。">重新启动数据库</a></p>
                     </li>
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-45889420-6496-4E7C-B698-A62E2580B962" title="默认情况下，在工作负载捕获期间记录所有用户会话。您可以使用工作负载筛选器指定在工作负载捕获期间要包含在工作负载中或从工作负载中排除哪些用">使用带有Workload Capture的过滤器</a></p>
                     </li>
                  </ul>
               </div><a id="RATUG255"></a><a id="RATUG112"></a><div class="props_rev_3"><a id="GUID-77DFEBE7-4FF9-4CB4-97B2-8501ECB8E7E4" name="GUID-77DFEBE7-4FF9-4CB4-97B2-8501ECB8E7E4"></a><h4 id="RATUG-GUID-77DFEBE7-4FF9-4CB4-97B2-8501ECB8E7E4" class="sect4"><span class="enumeration_section">10.3.1</span>重新启动数据库</h4>
                  <div>
                     <div><span>虽然不需要此步骤，但Oracle建议在捕获工作负载之前重新启动数据库，以确保在捕获开始之前允许完成或回滚正在进行的事务和从属事务。</span> 如果在捕获开始之前未重新启动数据库，则将无法在工作负载中完全捕获正在进行或尚未提交的事务。因此，正在进行的交易不会被正确地重放，因为只有被捕获的电话的交易部分才会被重播。当重放工作负载时，这可能导致不希望的重放分歧。具有依赖于未完成事务的任何后续事务也可能在重放期间生成错误。在繁忙的系统上，看到一些重放差异是正常的，但是如果分散的呼叫在DB时间和其他方面不构成重放的重要部分，则重放仍然可以用于对系统变化进行有意义的分析。这样的关键属性。
                     </div>
                     <div class="section">
                        <p>在重新启动数据库之前，确定在工作负载捕获之前关闭生产数据库的适当时间，这是最不具破坏性的。例如，您可能希望捕获从上午8:00开始的工作负载。但是，为避免在正常工作时间内中断服务，您可能不希望在此期间重新启动数据库。在这种情况下，您应该考虑在较早的时间启动工作负载捕获，以便可以在破坏性较小的时间重新启动数据库。</p>
                        <p>重新启动数据库后，在任何用户会话重新连接并开始发出任何工作负载之前启动工作负载捕获非常重要。否则，这些用户会话执行的事务将不会在后续数据库重放中正确重放，因为只有在启动工作负载捕获后执行调用的事务部分才会被重放。要避免此问题，请考虑使用<code class="codeph">STARTUP RESTRICT</code>以<code class="codeph">RESTRICTED</code>模式重新启动数据库，这将只允许<code class="codeph">SYS</code>用户登录并启动工作负载捕获。默认情况下，一旦工作负载捕获开始，处于<code class="codeph">RESTRICTED</code>模式的任何数据库实例将自动切换到<code class="codeph">UNRESTRICTED</code>模式，并且在捕获工作负载时可以继续正常操作。
                        </p>
                        <p>在任何给定时间只能执行一次工作负载捕获。如果您具有Oracle Real Application Clusters（Oracle RAC）配置，则会对整个数据库执行工作负载捕获。为其中一个Oracle RAC节点启用捕获后，将在所有数据库实例上启动工作负载捕获（工作负载捕获过程可识别Oracle RAC）。虽然不是必需的，但建议在工作负载捕获之前重新启动Oracle RAC配置中的所有实例，以避免捕获正在进行的事务。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-77DFEBE7-4FF9-4CB4-97B2-8501ECB8E7E4__GUID-D1E0D1BB-7B0A-4C64-9070-F52F36292EEA">在工作负载捕获之前重新启动Oracle RAC配置中的所有实例：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li><span>关闭所有实例。</span></li>
                        <li><span>重新启动所有实例。</span></li>
                        <li><span>开始工作负载捕获</span></li>
                        <li><span>连接应用程序并启动用户工作负载。</span></li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-77DFEBE7-4FF9-4CB4-97B2-8501ECB8E7E4__GUID-2AF9D86A-9301-40FA-BCD9-972F88D66812">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../admin/starting-up-and-shutting-down.html#ADMIN11146" target="_blank"><span><cite>“Oracle数据库管理员指南”</cite></span></a> ，了解有关在启动时限制对实例的访问的信息</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="RATUG113"></a><div class="props_rev_3"><a id="GUID-45889420-6496-4E7C-B698-A62E2580B962" name="GUID-45889420-6496-4E7C-B698-A62E2580B962"></a><h4 id="RATUG-GUID-45889420-6496-4E7C-B698-A62E2580B962" class="sect4"><span class="enumeration_section">10.3.2</span>使用带有工作负载捕获的过滤器</h4>
                  <div>
                     <div><span>默认情况下，在工作负载捕获期间记录所有用户会话。您可以使用工作负载筛选器指定在工作负载捕获期间要包含在工作负载中或从工作负载中排除哪些用</span> 工作负载过滤器有两种类型：包含过滤器和排除过滤器。您可以在工作负载捕获中使用包含过滤器或排除过滤器，但不能同时使用两者。
                     </div>
                     <p><a id="d17564e808" class="indexterm-anchor"></a>通过包含筛选器，您可以指定将在工作负载中捕获的用户会话。如果您只想捕获数据库工作负载的一个子集，这将非常有用。
                     </p>
                     <p><a id="d17564e816" class="indexterm-anchor"></a>通过排除筛选器，您可以指定不会在工作负载中捕获的用户会话。如果要过滤掉不需要在工作负载中捕获的会话类型（例如监视基础结构的Oracle Enterprise Manager（EM）或Statspack或其他已在测试中运行的此类进程），这非常有用。系统。例如，如果将重放工作负载的系统正在运行EM，则在系统上重放捕获的EM会话将导致工作负载重复。在这种情况下，您可能希望使用排除过滤器来过滤掉EM会话。
                     </p>
                  </div>
               </div>
            </div><a id="RATUG115"></a><div class="props_rev_3"><a id="GUID-4A1995F1-78F9-4080-8DFC-1E3EBCB3F4B8" name="GUID-4A1995F1-78F9-4080-8DFC-1E3EBCB3F4B8"></a><h3 id="RATUG-GUID-4A1995F1-78F9-4080-8DFC-1E3EBCB3F4B8" class="sect3"><span class="enumeration_section">10.4</span>工作负载捕获限制</h3>
               <div>
                  <p>某些类型的用户会话和客户端请求有时可能会在工作负载中捕获，但数据库重放不支持它们。在工作负载中捕获这些会话和请求类型可能会在工作负载重放期间导致错误。</p>
                  <p>数据库重放不支持以下类型的用户会话和客户端请求：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>使用SQL * Loader等实用程序直接从外部文件加载数据</p>
                     </li>
                     <li>
                        <p>基于非PL / SQL的高级排队（AQ）</p>
                     </li>
                     <li>
                        <p>闪回查询</p>
                     </li>
                     <li>
                        <p>基于Oracle Call Interface（OCI）的对象导航</p>
                     </li>
                     <li>
                        <p>非基于SQL的对象访问</p>
                     </li>
                     <li>
                        <p>分布式事务</p>
                        <p>捕获的任何分布式事务都将作为本地事务重放。</p>
                     </li>
                     <li>
                        <p>XA交易</p>
                        <p>不捕获或重放XA事务。捕获所有本地事务。</p>
                     </li>
                     <li>
                        <p><code class="codeph">JAVA_XA</code>交易</p>
                        <p>如果工作负载使用<code class="codeph">JAVA_XA</code>包，则<code class="codeph">JAVA_XA</code>函数和过程调用将被捕获为正常的PL / SQL工作负载。为避免工作负载重放期间出现问题，请考虑在重放系统上删除<code class="codeph">JAVA_XA</code>程序包以使重播成功完成。
                        </p>
                     </li>
                     <li>
                        <p>数据库驻留连接池（DRCP）</p>
                     </li>
                     <li>
                        <p>使用OUT的工作负载绑定</p>
                     </li>
                     <li>
                        <p>多线程服务器（MTS）和共享服务器会话，同步模式设置为<code class="codeph">OBJECT_ID</code></p>
                     </li>
                     <li>
                        <p>迁移的会话</p>
                        <p>为迁移的会话捕获工作负载。但是，不会捕获用户登录或会话迁移操作。如果没有有效的用户登录或会话迁移，重放可能会导致错误，因为错误的用户可能会重放工作负载。</p>
                     </li>
                  </ul>
                  <p>通常，数据库重放不会捕获这些类型的不受支持的用户会话和客户端请求。即使它们被捕获，数据库重放也不会重放它们。因此，通常不必手动过滤掉不受支持的用户会话和客户端请求。如果捕获它们并发现在重放期间导致错误，请考虑使用工作负载捕获筛选器将它们从工作负载中排除。</p>
                  <div class="infoboxnotealso" id="GUID-4A1995F1-78F9-4080-8DFC-1E3EBCB3F4B8__GUID-36569EBC-CA5E-4257-A0A7-00E4DF175F6C">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="q">“ <a href="capturing-a-database-workload.html#GUID-45889420-6496-4E7C-B698-A62E2580B962" title="默认情况下，在工作负载捕获期间记录所有用户会话。您可以使用工作负载筛选器指定在工作负载捕获期间要包含在工作负载中或从工作负载中排除哪些用">使用带有Workload Capture的过滤器</a> ”</span>获取有关使用工作负载捕获过滤器的信息</p>
                        </li>
                        <li>
                           <p><span class="q">“ <a href="replaying-a-database-workload.html#GUID-22C2E8D1-48E7-492E-B116-CDE79686E1BE" title="默认情况下，在工作负载重放期间重播所有捕获的数据库调用。您可以使用工作负载筛选器指定在工作负载重放期间要包含在工作负载中或从工作负载中排除的数据库调">使用带工作</a></span>负载重放的过滤器<span class="q">”</span>获取有关使用工作负载重放过滤器的信息</p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="RATUG116"></a><div class="props_rev_3"><a id="GUID-46D117CD-67F5-41AD-B85C-41DC6BEE3E23" name="GUID-46D117CD-67F5-41AD-B85C-41DC6BEE3E23"></a><h3 id="RATUG-GUID-46D117CD-67F5-41AD-B85C-41DC6BEE3E23" class="sect3"><span class="enumeration_section">10.5</span>启用和禁用工作负载捕获功能</h3>
               <div>
                  <div><span>数据库重放支持在运行Oracle数据库<span class="italic">10g</span>第2版的系统上捕获数据库工作负载，该系统可用于测试数据库升级到Oracle Database <span class="italic">11g</span>及后续版本。</span> 默认情况下，Oracle Database <span class="italic">10g</span>第2版（10.2）中未启用工作负载捕获功能。您可以通过指定<code class="codeph">PRE_11G_ENABLE_CAPTURE</code>初始化参数来启用或禁用此功能。
                  </div>
                  <div class="section">
                     <div class="infoboxnote" id="GUID-46D117CD-67F5-41AD-B85C-41DC6BEE3E23__GUID-335D43CD-6C22-4388-BBE8-FC340371267C">
                        <p class="notep1">注意：</p>
                        <p>如果要在运行Oracle Database <span class="italic">10g</span>第2版的系统上捕获数据库工作负载，则只需启用工作负载捕获功能。
                        </p>
                        <p>如果要在运行Oracle Database <span class="italic">11g</span>第1版或更高版本的系统上捕获数据库工作负载，则无需启用工作负载捕获功能，因为它默认情况下已启用。此外， <code class="codeph">PRE_11G_ENABLE_CAPTURE</code>初始化参数仅对Oracle Database <span class="italic">10g</span>第2版（10.2）有效，不能与后续版本一起使用。
                        </p>
                     </div>
                     <p>要在运行Oracle数据库<span class="italic">10g</span>第2版的系统上启用工作负载捕获功能，请在SQL提示符下运行<code class="codeph">wrrenbl.sql</code>脚本：</p><pre class="oac_no_warn" dir="ltr">@ $ ORACLE_HOME / RDBMS /管理/ wrrenbl.sql</pre><p><code class="codeph">wrrenbl.sql</code>脚本调用<code class="codeph">ALTER SYSTEM</code> SQL语句将<code class="codeph">PRE_11G_ENABLE_CAPTURE</code>初始化参数设置为<code class="codeph">TRUE</code> 。如果正在使用服务器参数文件（spfile），则将为当前运行的实例修改<code class="codeph">PRE_11G_ENABLE_CAPTURE</code>初始化参数并将其记录在spfile中，以便在重新启动数据库时新设置将保持<code class="codeph">PRE_11G_ENABLE_CAPTURE</code> 。如果未使用spfile，则仅为当前运行的实例修改<code class="codeph">PRE_11G_ENABLE_CAPTURE</code>初始化参数，并且在重新启动数据库时新设置将不会保留。要在不使用spfile的情况下使设置保持不变，您需要在初始化参数文件（ <code class="codeph">init.ora</code> ）中手动指定参数。
                     </p>
                     <p>要禁用工作负载捕获，请在SQL提示符下运行<code class="codeph">wrrdsbl.sql</code>脚本：</p><pre class="oac_no_warn" dir="ltr">@ $ ORACLE_HOME / RDBMS /管理/ wrrdsbl.sql</pre><p><code class="codeph">wrrdsbl.sql</code>脚本调用<code class="codeph">ALTER SYSTEM</code> SQL语句将<code class="codeph">PRE_11G_ENABLE_CAPTURE</code>初始化参数设置为<code class="codeph">FALSE</code> 。如果正在使用服务器参数文件（spfile），则将为当前运行的实例修改<code class="codeph">PRE_11G_ENABLE_CAPTURE</code>初始化参数，并将其记录在spfile中，以便在重新启动数据库时新设置将保持<code class="codeph">PRE_11G_ENABLE_CAPTURE</code> 。如果未使用spfile，则仅为当前运行的实例修改<code class="codeph">PRE_11G_ENABLE_CAPTURE</code>初始化参数，并且在重新启动数据库时新设置将不会保留。要在不使用spfile的情况下使设置保持不变，您需要在初始化参数文件（ <code class="codeph">init.ora</code> ）中手动指定参数。
                     </p>
                     <div class="infoboxnote" id="GUID-46D117CD-67F5-41AD-B85C-41DC6BEE3E23__GUID-D26A3F33-489F-4DE0-8A1A-1D7E0302A335">
                        <p class="notep1">注意：</p>
                        <p><code class="codeph">PRE_11G_ENABLE_CAPTURE</code>初始化参数只能与Oracle数据库<span class="italic">10g</span>第2版（10.2）一起使用。此参数在后续版本中无效。升级数据库后，需要从服务器参数文件（spfile）或初始化参数文件（ <code class="codeph">init.ora</code> ）中删除该参数;否则，数据库将无法启动。
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="RATUG4206"></a><div class="props_rev_3"><a id="GUID-61E843E8-393A-49CE-8AF7-DCFA3E31982A" name="GUID-61E843E8-393A-49CE-8AF7-DCFA3E31982A"></a><h3 id="RATUG-GUID-61E843E8-393A-49CE-8AF7-DCFA3E31982A" class="sect3"><span class="enumeration_section">10.6</span>企业管理器权限和角色</h3>
               <div>
                  <div><span>数据库重放资源类型权限使您可以查看或操作任何数据库重放实体。此外，您需要捕获工作负载的目标的目标操作员权限才能访问与工作负载关联的实体。</span> 对于不再存在的目标，拥有实体的企业管理器用户或企业管理器超级用户仍可以访问实体。
                  </div>
                  <p>以下各节中讨论的两个安全角色可以更轻松地授予或撤消与数据库重放实体相关的权限。</p>
               </div><a id="RATUG4207"></a><div class="props_rev_3"><a id="GUID-BE70B41D-C1B1-4E0F-8254-A85DEDE820AE" name="GUID-BE70B41D-C1B1-4E0F-8254-A85DEDE820AE"></a><h4 id="RATUG-GUID-BE70B41D-C1B1-4E0F-8254-A85DEDE820AE" class="sect4"><span class="enumeration_section">10.6.1</span>数据库重放查看器角色</h4>
                  <div>
                     <div><span>具有数据库重放查看器角色的用户可以查看任何数据库重放实体。默认情况下，不会授予企业管理器用户此角色。</span> 但是，EM_ALL_VIEWER角色默认包含此角色。
                     </div>
                     <p>数据库重放查看器角色由数据库重放查看器（资源类型）权限组成。</p>
                  </div>
               </div><a id="RATUG4208"></a><div class="props_rev_3"><a id="GUID-FEA9EDAC-5F4E-42E0-9FA2-8E3C91C19BAD" name="GUID-FEA9EDAC-5F4E-42E0-9FA2-8E3C91C19BAD"></a><h4 id="RATUG-GUID-FEA9EDAC-5F4E-42E0-9FA2-8E3C91C19BAD" class="sect4"><span class="enumeration_section">10.6.2</span>数据库重放操作员角色</h4>
                  <div>
                     <div><span>数据库重放操作员角色包括数据库重放查看器角色及其权限。具有数据库重放操作员角色的用户还可以编辑和删除任何数据库重放实体。默认情况下，不会授予企业管理器用户此角色。</span> 但是，EM_ALL_OPERATOR角色默认包含此角色。
                     </div>
                     <p>数据库重放操作员角色包含以下权限：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>数据库重放运算符（资源类型权限）</p>
                        </li>
                        <li>
                           <p>创建新的命名凭据（资源类型权限）</p>
                        </li>
                        <li>
                           <p>创建新作业（资源类型权限）</p>
                        </li>
                        <li>
                           <p>连接到任何可查看的目标（目标类型权限）</p>
                        </li>
                        <li>
                           <p>执行Command Anywhere（目标类型权限）</p>
                        </li>
                     </ul>
                     <p>要捕获或重放数据库目标上的工作负载，企业管理器用户需要数据库重放操作员角色授予的所有权限以及数据库目标的目标操作员权限。</p>
                  </div>
               </div>
            </div><a id="RATUG256"></a><a id="RATUG117"></a><div class="props_rev_3"><a id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681" name="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681"></a><h3 id="RATUG-GUID-1679DB12-B633-4021-A3B9-9CC6216D6681" class="sect3"><span class="enumeration_section">10.7</span>使用Enterprise Manager捕获数据库工作负载</h3>
               <div>
                  <p>本节介绍如何使用Enterprise Manager捕获数据库工作负载。捕获数据库工作负载的主要工具是Oracle Enterprise Manager。</p>
                  <div class="p">有关先决条件的信息，请参阅<span class="q">“ <a href="capturing-a-database-workload.html#GUID-372BA03D-7A24-4300-A0AE-30E0D9D9C724" title="在开始工作负载捕获之前，您应该有一个策略来恢复测试系统上的数据库。">捕获数据库工作负载的先决条件</a> ”</span> 。
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <div class="infobox-tip" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-58335361-4144-45BA-BB5E-DCCE958A7880">
                        <p class="notep1">小费：</p>
                        <p>如果Oracle Enterprise Manager不可用，则可以使用API捕获数据库工作负载，如<span class="q">“ <a href="capturing-a-database-workload.html#GUID-7AB9889A-6F05-41D3-8EA1-F4BEEC507BDE" title="本节介绍如何使用API捕获数据库工作负载。">使用API捕获数据库工作负载</a> ”中所述</span> 。
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-65826CD4-F6E5-49F6-8454-68D980B1F0D9">使用Enterprise Manager捕获数据库工作负载：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>从Enterprise Manager Cloud Control控制台的Enterprise菜单中，选择<span class="bold">Quality Management</span> ，然后选择<span class="bold">Database Replay</span> 。</span><div>
                           <p>如果出现“数据库登录”页面，请以具有管理员权限的用户身份登录。</p>
                           <p>将显示“数据库重播”页面。</p>
                           <div class="figure" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-636CB4DE-022E-4A2A-A249-ECE711E9B6B5"><img src="img/dbr.gif" width="505" alt="dbr.gif的描述如下" title="dbr.gif的描述如下" longdesc="img_text/dbr.html"><br><a href="img_text/dbr.html">插图描述dbr.gif</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                     <li class="stepexpand"><span>在Database Replay页面中，单击<span class="bold">Captured Workloads</span>选项卡，然后单击工具栏中的<span class="bold">Create</span> 。</span><div>
                           <p>将出现“创建捕获：计划环境”页面。</p>
                           <div class="figure" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-2B8D9A99-7E97-42B7-A98D-DFD7AD81890F"><img src="img/dbr_capture_plan_env.gif" width="518" alt="下面是dbr_capture_plan_env.gif的描述" title="下面是dbr_capture_plan_env.gif的描述" longdesc="img_text/dbr_capture_plan_env.html"><br><a href="img_text/dbr_capture_plan_env.html">说明说明dbr_capture_plan_env.gif</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                     <li class="stepexpand"><span>确认您已满足此页面上描述的两个先决条件，然后启用两个复选框并单击<span class="bold">下一步</span> 。</span><div>
                           <p>将出现“创建捕获：数据库”页面。</p>
                           <div class="figure" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-3ADA7CB0-1B46-403B-AB6C-BF9F1A87FF87"><img src="img/dbr_capture_databases.gif" width="511" alt="下面是dbr_capture_databases.gif的描述" title="下面是dbr_capture_databases.gif的描述" longdesc="img_text/dbr_capture_databases.html"><br><a href="img_text/dbr_capture_databases.html">说明描述dbr_capture_databases.gif</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                     <li class="stepexpand"><span>单击<span class="bold">添加</span> 。</span><div>
                           <p>出现“添加”弹出窗口。</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>提供捕获名称，提供可选描述，然后单击“目标数据库”搜索图标。</span><div>
                           <p>将出现“搜索和选择：目标”弹出窗口。</p>
                           <div class="figure" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-F2949E59-359F-4A2E-9451-4F42B9D4B936"><img src="img/dbr_capture_select_db.gif" width="355" alt="下面是dbr_capture_select_db.gif的描述" title="下面是dbr_capture_select_db.gif的描述" longdesc="img_text/dbr_capture_select_db.html"><br><a href="img_text/dbr_capture_select_db.html">插图描述dbr_capture_select_db.gif</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                     <li class="stepexpand"><span>选择目标类型，可选择提供配置搜索，从列表中选择目标数据库，然后单击<span class="bold">选择</span> 。</span><div>
                           <p>“添加”弹出窗口重新显示，其中添加了“数据库凭据”和“数据库主机凭据”部分。</p>
                           <div class="figure" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-8C559666-AF20-40F2-9365-D6B5C2235CFC"><img src="img/dbr_capture_add_db.gif" width="497" alt="下面是dbr_capture_add_db.gif的描述" title="下面是dbr_capture_add_db.gif的描述" longdesc="img_text/dbr_capture_add_db.html"><br><a href="img_text/dbr_capture_add_db.html">插图描述dbr_capture_add_db.gif</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                     <li class="stepexpand"><span>提供数据库凭据，数据库主机凭据，数据库捕获中间存储位置，然后单击“ <span class="bold">确定”</span> 。</span><div>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>捕获后，文件将复制到存储位置，除非您使用中间存储位置作为最终存储位置。</p>
                                 <div class="infoboxnote" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-E54D2C50-806A-4327-AA05-DF5A7B9284E0">
                                    <p class="notep1">注意：</p>
                                    <p>对于Oracle RAC数据库上的捕获，Enterprise Manager仅支持使用共享文件系统配置的Oracle RAC。</p>
                                 </div>
                              </li>
                           </ul>
                           <p>现在，所选目标数据库将显示在“选择生产数据库”表中的数据库列表中。</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>单击<span class="bold">下一步</span> 。</span><div>
                           <p>将出现“ <span class="bold">创建捕获：</span>选项”页面。
                           </p>
                           <div class="figure" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-6A36A705-C33C-4D40-9B65-7742C5F89A36"><img src="img/dbr_capture_options.gif" width="509" alt="下面是dbr_capture_options.gif的描述" title="下面是dbr_capture_options.gif的描述" longdesc="img_text/dbr_capture_options.html"><br><a href="img_text/dbr_capture_options.html">插图描述dbr_capture_options.gif</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                     <li class="stepexpand"><span>选择工作负载捕获选项：</span><div>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>在“SQL性能分析器”部分下，选择是否在工作负载捕获期间将SQL语句捕获到SQL调优集中。</p>
                                 <p>虽然数据库重放提供了对更改如何影响整个系统的分析，但您可以将SQL调优集与SQL性能分析器结合使用，以获得更多以SQL为中心的分析，了解更改如何影响SQL语句和执行计划。</p>
                                 <p>通过在工作负载捕获期间捕获SQL调优集以及在工作负载重放期间捕获另一个SQL调优集，您可以使用SQL性能分析器将这些SQL调优集相互比较，而无需重新执行SQL语句。这使您可以在运行数据库重放时获取SQL性能分析器报告并比较更改之前和之后的SQL性能。</p>
                                 <div class="infoboxnote" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-D29286FD-75C8-408E-A434-5D1B2F19A9AC">
                                    <p class="notep1">注意：</p>
                                    <p>将SQL语句捕获到SQL调优集是默认值，并且是推荐的工作负载捕获选项。将SQL语句捕获到SQL调优集中不适用于Oracle RAC。</p>
                                 </div>
                                 <div class="infobox-tip" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-EED23F14-8E8D-4297-88F7-51A7A8EB8D97">
                                    <p class="notep1">小费：</p>
                                    <p>有关使用SQL Performance Analyzer报告比较SQL调优集的信息，请参阅<span class="q">“ <a href="analyzing-captured-and-replayed-workloads.html#GUID-F711BF47-3898-4A8A-A210-FD87866659F4" title="本节介绍如何使用DBMS_WORKLOAD_REPLAY包生成SQL Performance Analyzer报告。">使用API生成SQL Performance Analyzer报告</a> ”</span> 。
                                    </p>
                                 </div>
                              </li>
                              <li>
                                 <p>在“工作负载过滤器”部分下，通过在“过滤模式”列表中选择“ <span class="bold">排除”</span>来选择是否使用排除过滤器，或通过在“过滤模式”列表中选择“ <span class="bold">包含”</span>来选择<span class="bold">包含</span>过滤器。
                                 </p>
                                 <p>要添加过滤器，请单击“ <span class="bold">添加”</span> ，然后在相应字段中输入过滤器名称，会话属性和值。
                                 </p>
                                 <div class="infobox-tip" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-1938A21D-769A-4DFD-99BF-4E84E6BFD77E">
                                    <p class="notep1">小费：</p>
                                    <p>有关更多信息，请参阅<span class="q">“ <a href="capturing-a-database-workload.html#GUID-45889420-6496-4E7C-B698-A62E2580B962" title="默认情况下，在工作负载捕获期间记录所有用户会话。您可以使用工作负载筛选器指定在工作负载捕获期间要包含在工作负载中或从工作负载中排除哪些用">使用带有Workload Capture的过滤器</a> ”</span> 。
                                    </p>
                                 </div>
                              </li>
                           </ul>
                           <p>选择所需的工作负载捕获选项后，单击“ <span class="bold">下一步”</span>
                           </p>
                           <p>将出现“创建捕获：存储”页面。</p>
                           <div class="figure" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-47E5CC7A-AB06-4155-A330-0D922EEC6A4D"><img src="img/dbr_capture_storage.gif" width="511" alt="下面是dbr_capture_storage.gif的描述" title="下面是dbr_capture_storage.gif的描述" longdesc="img_text/dbr_capture_storage.html"><br><a href="img_text/dbr_capture_storage.html">插图描述dbr_capture_storage.gif</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                     <li class="stepexpand"><span>单击“存储主机”图标，从列表中选择目标，然后单击“ <span class="bold">选择”</span> 。</span><div>
                           <p>“存储”页面现在请求“主机凭据”和“存储位置”。</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>提供“主机凭据”，单击“ <span class="bold">浏览”</span>以选择“存储位置”，选择位置并单击“ <span class="bold">确定”</span> ，然后单击“ <span class="bold">下一步”</span> 。</span><div>
                           <p>将出现“创建捕获：计划”页面。</p>
                           <div class="figure" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-6F80F30B-21E0-4D47-95F3-EF33EA00B8D8"><img src="img/dbr_capture_schedule.gif" width="505" alt="下面是dbr_capture_schedule.gif的描述" title="下面是dbr_capture_schedule.gif的描述" longdesc="img_text/dbr_capture_schedule.html"><br><a href="img_text/dbr_capture_schedule.html">插图描述dbr_capture_schedule.gif</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                     <li class="stepexpand"><span>计划捕获的开始时间和持续时间，计划导出AWR数据，然后单击“ <span class="bold">下一步”</span> 。</span><div>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>默认捕获持续时间为5分钟。更改捕获持续时间以捕获需要测试的感兴趣时间段内的代表性活动。</p>
                              </li>
                           </ul>
                           <p>将出现“创建捕获：审阅”页面。</p>
                           <div class="figure" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-68494305-2D63-424B-BA7A-C44B1FE8D6A9"><img src="img/dbr_capture_review.gif" width="515" alt="下面是dbr_capture_review.gif的描述" title="下面是dbr_capture_review.gif的描述" longdesc="img_text/dbr_capture_review.html"><br><a href="img_text/dbr_capture_review.html">插图描述dbr_capture_review.gif</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                     <li class="stepexpand"><span>如果所有参数都按预期显示，请单击“ <span class="bold">提交”</span>以启动捕获作业。</span><div>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>默认情况下，“在工作负载捕获期间将SQL语句捕获到SQL调整集”选项处于启用状态。如果您不想在重播结束时比较SQL调优集，请取消选中此选项。</p>
                              </li>
                           </ul>
                           <p>将重新显示“数据库重放”页面，显示捕获已成功创建的消息，并在“捕获”列表中显示捕获的状态，例如“已安排”。</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>有关捕获的详细信息，请双击捕获的名称。</span><div>
                           <p>此时将显示“捕获摘要”页面，并显示多个属性，包括平均活动会话，工作负载比较以及相关的并发捕获（如果有）。</p>
                        </div>
                     </li>
                  </ol>
                  <div class="section">
                     <div class="infobox-tip" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-9320AFEB-03F9-46E4-9C6F-9EA371DA966F">
                        <p class="notep1">小费：</p>
                        <p>捕获生产系统上的工作负载后，您需要预处理捕获的工作负载，如<a href="preprocessing-a-database-workload.html#GUID-4CEE2F79-F5A7-4EBA-9018-0CB99AB51C0A" title="捕获工作负载并完成测试系统的设置后，必须预处理捕获的数据。">预处理数据库工作负载中所述</a> 。
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="RATUG4124"></a><div class="sect2"><a id="GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67" name="GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67"></a><h3 id="RATUG-GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67" class="sect3"><span class="enumeration_section">10.8</span>同时从多个数据库中捕获工作负载</h3>
               <div>
                  <p>并发捕获是指同时捕获多个数据库上的工作负载。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67__GUID-61D3DE46-416F-4C53-9DF3-94B13AB092D4">捕获并发数据库重放工作负载：</p>
                     <ol>
                        <li>
                           <p>从Enterprise Manager Cloud Control控制台的Enterprise菜单中，选择<span class="bold">Quality Management</span> ，然后选择<span class="bold">Database Replay</span> 。
                           </p>
                           <p>如果出现“数据库登录”页面，请以具有管理员权限的用户身份登录。</p>
                           <p>将显示“数据库重播”页面。</p>
                        </li>
                        <li>
                           <p>在Database Replay页面中，单击<span class="bold">Captured</span> <span class="bold">Workloads</span>选项卡，然后单击工具栏中的<span class="bold">Create</span> 。
                           </p>
                           <p>将出现“创建捕获：计划环境”页面。</p>
                        </li>
                        <li>
                           <p>确保您已满足此页面上描述的两个先决条件，然后启用两个复选框并单击<span class="bold">下一步</span> 。
                           </p>
                           <p>将出现“创建捕获：数据库”页面。</p>
                           <div class="infobox-tip" id="GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67__GUID-FE712472-3383-4898-9E86-AC65BD0505E1">
                              <p class="notep1">小费：</p>
                              <p>有关先决条件的信息，请参阅<span class="q">“ <a href="capturing-a-database-workload.html#GUID-372BA03D-7A24-4300-A0AE-30E0D9D9C724" title="在开始工作负载捕获之前，您应该有一个策略来恢复测试系统上的数据库。">捕获数据库工作负载的先决条件</a> ”</span> 。
                              </p>
                           </div>
                        </li>
                        <li id="GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67__BABGGAGG">
                           <p>单击<span class="bold">添加</span> 。
                           </p>
                           <p>出现“添加”弹出窗口。</p>
                        </li>
                        <li>
                           <p>提供Capture名称，提供可选描述，然后单击Target Database搜索图标。</p>
                           <p>将出现“搜索和选择：目标”弹出窗口。</p>
                        </li>
                        <li>
                           <p>从列表中选择目标数据库，然后单击“ <span class="bold">选择”</span> 。
                           </p>
                           <p>“添加”弹出窗口重新显示，其中添加了“数据库凭据”和“数据库主机凭据”部分。</p>
                        </li>
                        <li id="GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67__BABIDAGC">
                           <p>提供数据库凭据，数据库主机凭据，数据库捕获中间存储位置，然后单击“ <span class="bold">确定”</span> 。</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>捕获后，文件将复制到存储位置，除非您使用中间存储位置作为最终存储位置。</p>
                              </li>
                           </ul>
                           <p>现在，所选目标数据库将显示在“选择生产数据库”表中的数据库列表中。</p>
                        </li>
                        <li>
                           <p>为并发捕获添加另一个数据库：</p>
                           <ol type="a">
                              <li>
                                 <p>按照步骤<a href="capturing-a-database-workload.html#GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67__BABGGAGG">4</a>到<a href="capturing-a-database-workload.html#GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67__BABIDAGC">7中</a>的说明进行操作。
                                 </p>
                                 <p>将再次出现“创建捕获：数据库”页面，并显示要捕获的其他数据库以及您在步骤<a href="capturing-a-database-workload.html#GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67__BABGGAGG">4</a>到<a href="capturing-a-database-workload.html#GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67__BABIDAGC">7中</a>指定的第一个数据库。
                                 </p>
                              </li>
                              <li>
                                 <p>提供并发捕获的名称和可选描述，然后单击“ <span class="bold">下一步”</span> 。
                                 </p>
                                 <p>将出现“创建捕获：选项”页面。</p>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p>选择工作负载捕获选项：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>在“SQL性能分析器”部分下，选择是否在工作负载捕获期间将SQL语句捕获到SQL调优集中。</p>
                                 <p>虽然数据库重放提供了对更改如何影响整个系统的分析，但您可以将SQL调优集与SQL性能分析器结合使用，以获得更多以SQL为中心的分析，了解更改如何影响SQL语句和执行计划。</p>
                                 <p>通过在工作负载捕获期间捕获SQL调优集以及在工作负载重放期间捕获另一个SQL调优集，您可以使用SQL性能分析器将这些SQL调优集相互比较，而无需重新执行SQL语句。这使您可以在运行数据库重放时获取SQL性能分析器报告并比较更改之前和之后的SQL性能。</p>
                                 <div class="infoboxnote" id="GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67__GUID-5D549E24-474C-4B66-8146-90158D7C6C33">
                                    <p class="notep1">注意：</p>
                                    <p>将SQL语句捕获到SQL调优集中是默认和建议的工作负载捕获选项。</p>
                                 </div>
                              </li>
                              <li>
                                 <p>在“工作负载过滤器”部分下，通过在“过滤模式”列表中选择“ <span class="bold">排除”</span>来选择是否使用排除过滤器，或通过在“过滤模式”列表中选择“ <span class="bold">包含”</span>来选择<span class="bold">包含</span>过滤器。
                                 </p>
                                 <p>要添加过滤器，请单击“ <span class="bold">添加”</span> ，然后在相应字段中输入过滤器名称，会话属性和值。
                                 </p>
                              </li>
                           </ul>
                           <p>选择所需的工作负载捕获选项后，单击“ <span class="bold">下一步”</span>
                           </p>
                           <p>将出现“创建捕获：存储”页面。</p>
                        </li>
                        <li>
                           <p>单击“存储主机”图标，从列表中选择目标，然后单击“ <span class="bold">选择”</span> 。
                           </p>
                           <p>“存储”页面现在请求“主机凭据”和“存储位置”。</p>
                        </li>
                        <li>
                           <p>提供“主机凭据”，单击“ <span class="bold">浏览”</span>以选择“存储位置”，然后单击“ <span class="bold">下一步”</span> 。
                           </p>
                           <p>将出现“创建捕获：计划”页面。</p>
                        </li>
                        <li>
                           <p>计划捕获的开始时间和持续时间，计划导出AWR数据，然后单击“ <span class="bold">下一步”</span> 。
                           </p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>默认捕获持续时间为5分钟。更改捕获持续时间以捕获需要测试的感兴趣时间段内的代表性活动。</p>
                              </li>
                           </ul>
                           <p>将出现“创建捕获：审阅”页面。</p>
                        </li>
                        <li>
                           <p>如果所有参数都按预期显示，请单击“ <span class="bold">提交”</span>以启动“捕获”作业。
                           </p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>默认情况下，“在工作负载捕获期间将SQL语句捕获到SQL调整集”选项处于启用状态。如果您不想在重播结束时比较SQL调优集，请取消选中此选项。</p>
                              </li>
                           </ul>
                           <p>将重新显示“数据库重放”页面，显示捕获已成功创建的消息，并在“捕获”列表中显示捕获的状态，例如“已安排”。</p>
                        </li>
                        <li>
                           <p>有关捕获的详细信息，请双击捕获的名称。</p>
                           <p>此时将显示“捕获摘要”页面，并显示多个属性，包括平均活动会话，工作负载比较和相关的并发捕获。</p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="RATUG118"></a><div class="props_rev_3"><a id="GUID-509ABE02-E9DB-420B-80AA-5FF2B8CDD9A5" name="GUID-509ABE02-E9DB-420B-80AA-5FF2B8CDD9A5"></a><h3 id="RATUG-GUID-509ABE02-E9DB-420B-80AA-5FF2B8CDD9A5" class="sect3"><span class="enumeration_section">10.9</span>使用Enterprise Manager监视工作负载捕获</h3>
               <div>
                  <div><span>本节介绍如何使用Enterprise Manager监视工作负载捕获。监视工作负载捕获的主要工具是Oracle Enterprise Manager。</span> 使用Enterprise Manager，您可以：</div>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>监视或停止活动工作负载捕获</p>
                     </li>
                     <li>
                        <p>查看已完成的工作负载捕获</p>
                     </li>
                  </ul>
                  <div class="infobox-tip" id="GUID-509ABE02-E9DB-420B-80AA-5FF2B8CDD9A5__GUID-42B2A28D-C786-4D2B-B886-B2CC31929994">
                     <p class="notep1">小费：</p>
                     <p>如果Oracle Enterprise Manager不可用，则可以使用视图监视工作负载捕获，如<span class="q">“ <a href="capturing-a-database-workload.html#GUID-B9D817BE-43F0-4813-B161-14FFD7F51D40" title="本节概述了可以显示以监视工作负载捕获的视图。">使用视图监视工作负载捕获</a> ”中所述</span> 。
                     </p>
                  </div>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-7C587389-1A13-45DB-ADBB-C3C5A4BB2751" title="本节介绍如何使用Enterprise Manager监视活动工作负载捕获。">监视活动工作负载捕获</a></p>
                     </li>
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-FA80B526-BD52-44CE-9E25-165FA4D9265E" title="本节介绍如何使用Enterprise Manager停止活动工作负载捕获。">停止活动工作负载捕获</a></p>
                     </li>
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-5657880C-4520-4089-A842-BC97A40461A6" title="本节介绍如何使用Enterprise Manager管理已完成的工作负载捕获。">查看已完成的工作负载捕获</a></p>
                     </li>
                  </ul>
               </div><a id="RATUG257"></a><a id="RATUG119"></a><div class="props_rev_3"><a id="GUID-7C587389-1A13-45DB-ADBB-C3C5A4BB2751" name="GUID-7C587389-1A13-45DB-ADBB-C3C5A4BB2751"></a><h4 id="RATUG-GUID-7C587389-1A13-45DB-ADBB-C3C5A4BB2751" class="sect4"><span class="enumeration_section">10.9.1</span>监视活动工作负载捕获</h4>
                  <div>
                     <p>本节介绍如何使用Enterprise Manager监视活动工作负载捕获。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-7C587389-1A13-45DB-ADBB-C3C5A4BB2751__GUID-4CB57B49-857C-4A91-BF7E-52690E1C7453">要监视活动工作负载捕获：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>从Enterprise Manager Cloud Control控制台的Enterprise菜单中，选择<span class="bold">Quality Management</span> ，然后选择<span class="bold">Database Replay</span> 。</span><div>
                              <p>如果出现“数据库登录”页面，请以具有管理员权限的用户身份登录。</p>
                              <p>将显示“数据库重播”页面。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>从“数据库重放”页面的“捕获的工作负载”选项卡中获取状态不是“已完成”的捕获，从“捕获”表中单击所需捕获的名称。</span><div>
                              <p>将显示“数据库重放”页面的“摘要”选项卡，其中显示详细统计信息，在捕获过程中动态更新的平均活动会话的图表，捕获的元素与未捕获的相同元素的数据比较以及相关的并发捕获（如果任何。</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>Active Average Sessions图表中显示的Not Captured数据显示未捕获的数据库活动（数据库会话）。</p>
                                 </li>
                                 <li>
                                    <p>“比较”部分中“总计”列的值显示数据库中的所有已捕获和未捕获的活动。根据您在“创建捕获”向导的“选项”步骤中提供的工作负载过滤器确定的过滤主要是捕获或不捕获某些活动的原因。此外，不会捕获后台活动，数据库计划程序作业和无法播放的调用。</p>
                                 </li>
                                 <li>
                                    <p>您可以单击右上角的刷新图标以在运行时更新捕获。</p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>要返回“数据库重放”页面，请单击“数据库重放”面包屑。</span></li>
                     </ol>
                  </div>
               </div><a id="RATUG258"></a><a id="RATUG120"></a><div class="props_rev_3"><a id="GUID-FA80B526-BD52-44CE-9E25-165FA4D9265E" name="GUID-FA80B526-BD52-44CE-9E25-165FA4D9265E"></a><h4 id="RATUG-GUID-FA80B526-BD52-44CE-9E25-165FA4D9265E" class="sect4"><span class="enumeration_section">10.9.2</span>停止活动工作负载捕获</h4>
                  <div>
                     <p>本节介绍如何使用Enterprise Manager停止活动工作负载捕获。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-FA80B526-BD52-44CE-9E25-165FA4D9265E__GUID-12B1BCAD-1FC7-4C5D-9F26-867C75DE1AD2">要停止活动工作负载捕获：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>从Enterprise Manager Cloud Control控制台的Enterprise菜单中，选择<span class="bold">Quality Management</span> ，然后选择<span class="bold">Database Replay</span> 。</span><div>
                              <p>如果出现“数据库登录”页面，请以具有管理员权限的用户身份登录。</p>
                              <p>将显示“数据库重播”页面。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>在“数据库重放”页面的“捕获的工作负荷”选项卡中，对于具有状态草稿的捕获，单击要停止的捕获的捕获表中的名称。</span><div>
                              <p>将出现“捕获摘要”页面。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>单击“ <span class="bold">停止捕获”</span>按钮。</span><div>
                              <p>按钮标签更改为“停止捕获”。该过程完成后，状态将更改为已停止。</p>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div><a id="RATUG259"></a><a id="RATUG121"></a><div class="props_rev_3"><a id="GUID-5657880C-4520-4089-A842-BC97A40461A6" name="GUID-5657880C-4520-4089-A842-BC97A40461A6"></a><h4 id="RATUG-GUID-5657880C-4520-4089-A842-BC97A40461A6" class="sect4"><span class="enumeration_section">10.9.3</span>查看已完成的工作负载捕获</h4>
                  <div>
                     <p>本节介绍如何使用Enterprise Manager管理已完成的工作负载捕获。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-5657880C-4520-4089-A842-BC97A40461A6__GUID-80C8A55B-4E5C-430A-9727-F67FB0198178">要查看已完成的工作负载捕获：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>从Enterprise Manager Cloud Control控制台的Enterprise菜单中，选择<span class="bold">Quality Management</span> ，然后选择<span class="bold">Database Replay</span> 。</span><div>
                              <p>如果出现“数据库登录”页面，请以具有管理员权限的用户身份登录。</p>
                              <p>将显示“数据库重播”页面。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>从“数据库重放”页面的“捕获工作负荷”选项卡中，单击状态为“已完成”的捕获的名称。</span><div>
                              <p>“数据库重播”页面的“摘要”选项卡的内容显示为正在进行的捕获，但“平均活动会话”图表显示捕获时间段的聚合数据，而不是捕获期间记录的动态数据。</p>
                              <div class="figure" id="GUID-5657880C-4520-4089-A842-BC97A40461A6__GUID-F4969042-F21C-49D3-892C-2DC8878C2984"><img src="img/dbr_capture_view.gif" width="505" alt="下面是dbr_capture_view.gif的描述" title="下面是dbr_capture_view.gif的描述" longdesc="img_text/dbr_capture_view.html"><br><a href="img_text/dbr_capture_view.html">插图描述dbr_capture_view.gif</a></div>
                              <!-- class="figure" -->
                              <p>“平均活动会话数”图表提供了捕获的会话活动与未捕获的会话活动（例如后台活动或过滤的会话）相比的图形显示。仅当捕获期间的活动会话历史记录（ASH）数据可用时，才会显示此图表。</p>
                              <p>在比较下，显示工作负载捕获的各种统计信息：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>捕获列</p>
                                    <p>显示捕获的会话活动的统计信息。</p>
                                 </li>
                                 <li>
                                    <p>总栏目</p>
                                    <p>显示总会话活动的统计信息。</p>
                                 </li>
                                 <li>
                                    <p>总列的百分比</p>
                                    <p>显示工作负载中捕获的总会话活动的百分比。</p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>要返回“数据库重放”页面，请单击“数据库重放”面包屑。</span></li>
                     </ol>
                     <div class="section">
                        <div class="infobox-tip" id="GUID-5657880C-4520-4089-A842-BC97A40461A6__GUID-437E637D-7A9E-476A-995A-1FF2487EFC3C">
                           <p class="notep1">小费：</p>
                           <p>有关访问工作负载捕获报告的信息，请参阅<a href="analyzing-captured-and-replayed-workloads.html#GUID-3E9AA9F2-B37B-4E03-9E00-FEB0A141631E" title="本章介绍如何使用各种数据库重放报告分析捕获和重放的工作负载。">分析捕获的和重新显示的工作</a>负载。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="RATUG4238"></a><div class="sect2"><a id="GUID-6F2BBECA-4259-493F-AEFE-4E4183476220" name="GUID-6F2BBECA-4259-493F-AEFE-4E4183476220"></a><h3 id="RATUG-GUID-6F2BBECA-4259-493F-AEFE-4E4183476220" class="sect3"><span class="enumeration_section">10.10</span>将工作负载导入企业管理器外部</h3>
               <div>
                  <div><span>您可以将通过PL / SQL界面或通过其他企业管理器实例捕获的工作负载导入企业管理器，以便像在Enterprise Manager中最初创建的工作负载一样对其进行管理。</span> 工作负载可以处于捕获过程中，也可以完成Capture，并将工作负载存储在文件系统中。您也可以像在企业管理器中创建的工作负载一样预处理和重放工作负载。
                  </div>
                  <p>此功能适用于Cloud Control Database插件12.1.0.5及更高版本。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-6F2BBECA-4259-493F-AEFE-4E4183476220__GUID-A6C3F23E-48C6-4185-9C81-2128152E2D37">要导入企业管理器外部的数据库工作负载：</p>
                     <ol>
                        <li>
                           <p>在Database Replay页面中，单击<span class="bold">Captured Workloads</span>选项卡，然后单击工具栏中的<span class="bold">Import</span> 。
                           </p>
                           <p>将显示“导入工作负载：源”页面。</p>
                        </li>
                        <li id="GUID-6F2BBECA-4259-493F-AEFE-4E4183476220__BEIDEJGD">
                           <p>选择可用于导入捕获的工作负载的三个选项之一，然后单击“ <span class="bold">下一步”</span> ：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="bold">从文件系统中的目录导入已完成的捕获工作负载</span></p>
                                 <p>此选项通常适用于使用API创建的工作负载，您现在希望将其导入Enterprise Manager以进行后续处理。在这种情况下，企业管理器甚至可能不管理Capture数据库。</p>
                              </li>
                              <li>
                                 <p><span class="bold">从数据库目标导入已完成的捕获工作负载</span></p>
                                 <p>在这种情况下，企业管理器可能已经在管理Capture数据库。Capture可能已在此数据库上完成，或者可能已加载，就像上面的选项一样。</p>
                              </li>
                              <li>
                                 <p><span class="bold">附加到在数据库目标中运行的Capture</span></p>
                                 <p>此选项与上面的选项类似，但此选项仍在进行中，而不是已完成的选项。</p>
                              </li>
                           </ul>
                           <p>将显示“导入工作负载：数据库”页面。</p>
                        </li>
                        <li>
                           <p>单击<span class="bold">“数据库目标”字段旁边的搜索图标，然后从显示的弹出窗口中选择一个数据库。</span></p>
                           <div class="infoboxnote" id="GUID-6F2BBECA-4259-493F-AEFE-4E4183476220__GUID-43AA989E-0490-42F4-92D2-1B73C67409CC">
                              <p class="notep1">注意：</p>
                              <p>加载工作负载的数据库的目标版本必须至少与用于捕获工作负载的目标版本一样高。例如，如果使用Oracle Database 12x捕获，则选择读取Capture的数据库必须至少为12x版本。</p>
                           </div>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>系统现在请求数据库和主机凭据。</p>
                              </li>
                              <li>
                                 <p>在上一步中，如果您选择从文件系统中的目录导入已完成的捕获工作负载，则系统还需要工作负载位置。</p>
                              </li>
                              <li>
                                 <p>统一的Replay具有不同的目录结构，其中至少有两个捕获目录。因此，如果工作负载目录包含整合的重播，则需要启用该复选框，以便Enterprise Manager可以在导入操作期间了解整合的重播。</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>为上面的步骤提供必要的输入，然后单击“ <span class="bold">下一步”</span> 。
                           </p>
                           <p>将显示“导入工作负载：工作负载”页面。</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>如果在步骤<a href="capturing-a-database-workload.html#GUID-6F2BBECA-4259-493F-AEFE-4E4183476220__BEIDEJGD">2中</a>选择“从文件系统中的目录导入已完成的捕获工作负载”，则此页面将提供“加载工作负载”按钮。
                                 </p>
                              </li>
                              <li>
                                 <p>如果在步骤<a href="capturing-a-database-workload.html#GUID-6F2BBECA-4259-493F-AEFE-4E4183476220__BEIDEJGD">2中</a>选择“从数据库目标导入已完成捕获的工作负载”或“附加到在数据库目标中运行的捕获”，则此页面将提供“发现工作负载”按钮。
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>单击“ <span class="bold">加载工作负载”</span>或“ <span class="bold">发现工作负载”</span> ，具体取决于您在步骤<a href="capturing-a-database-workload.html#GUID-6F2BBECA-4259-493F-AEFE-4E4183476220__BEIDEJGD">2中</a>的选择可用的按钮。
                           </p>
                           <p>系统会在Discovered Workloads表中显示工作负载（如果找到）。</p>
                        </li>
                        <li>
                           <p>单击“ <span class="bold">下一步”</span>以加载工作负载，或选择其中一个工作负载，然后单击“ <span class="bold">下一步”</span>继续导入工作负载。
                           </p>
                           <p>“导入工作负载：重播”页面仅在以下条件下显示：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>您在步骤<a href="capturing-a-database-workload.html#GUID-6F2BBECA-4259-493F-AEFE-4E4183476220__BEIDEJGD">2中</a>选择“从文件系统中的目录导入已完成的捕获工作负载”。
                                 </p>
                              </li>
                              <li>
                                 <p>工作负载包含一个或多个重播。</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p><span class="italic">可选：</span>选择一个或多个重播，如果需要，提供<span class="bold">重播任务名称</span> ，然后单击<span class="bold">下一步</span> 。
                           </p>
                           <p>将显示“导入工作负荷：审核”页面。</p>
                        </li>
                        <li>
                           <p>如果一切按预期显示，请单击“ <span class="bold">提交”</span> 。
                           </p>
                           <p>数据库重播页面重新出现并显示一条消息，指出作业已成功提交。Captured Workload表中已加载或导入的工作负载的“状态”列将显示“正在进行”。</p>
                           <div class="infobox-tip" id="GUID-6F2BBECA-4259-493F-AEFE-4E4183476220__GUID-0283728E-CE2D-4258-9D26-97621DDF59CC">
                              <p class="notep1">小费：</p>
                              <p>您可以通过单击“审阅”步骤中刚刚提交的捕获的工作负载名称来检查作业的进度。将出现“捕获摘要”页面，您可以单击“数据库重放导入作业”链接以查看作业执行步骤的进度。</p>
                           </div>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="RATUG4239"></a><div class="props_rev_3"><a id="GUID-2DD9B05E-9BD9-4F4D-92F6-E399093CB876" name="GUID-2DD9B05E-9BD9-4F4D-92F6-E399093CB876"></a><h3 id="RATUG-GUID-2DD9B05E-9BD9-4F4D-92F6-E399093CB876" class="sect3"><span class="enumeration_section">10.11</span>从现有工作负载创建子集</h3>
               <div>
                  <p>对于长时间捕获大量工作负载的情况，您可能只想重播其中的一部分以加速测试。数据库重放工作负载子集功能使您可以通过提取现有捕获工作负载的部分来创建新工作负载。</p>
                  <div class="section">
                     <p>Enterprise Manager提供了一个向导，用于从现有工作负载中提取可用于测试系统上的Replay的数据子集。每个提取的子集都是合法的工作负载，可以单独重放，也可以与统一重播中的其他工作负载重放。</p>
                     <p>要执行重播，您需要预处理工作负载。</p>
                     <p>此功能适用于Cloud Control Database插件12.1.0.5及更高版本。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-2DD9B05E-9BD9-4F4D-92F6-E399093CB876__GUID-A79CE21E-7CD8-4EC3-99E3-12762FF9DA36">从工作负载中提取子集：</p>
                     <ol>
                        <li>
                           <p>从“数据库重放”页面的“捕获的工作负载”选项卡中，选择要为其提取子集的工作负载，然后单击“ <span class="bold">子集”</span> 。
                           </p>
                           <p>将显示“子集工作负载：定义”页面，其中显示工作负载的“活动会话历史记录”图表。</p>
                        </li>
                        <li>
                           <p>选择要从工作负载中提取的子集的开始和结束时间：</p>
                           <ol type="a">
                              <li>
                                 <p>单击页面底部“子集”表上方的“ <span class="bold">添加”</span> 。
                                 </p>
                                 <p>将出现“创建子集”弹出窗口。</p>
                              </li>
                              <li>
                                 <p>选择快照或日历时间，提供开始和结束时间，然后单击“ <span class="bold">确定”</span> 。</p>
                                 <div class="infoboxnote" id="GUID-2DD9B05E-9BD9-4F4D-92F6-E399093CB876__GUID-6AB21BD6-4C2C-4D0B-BF27-856041157143">
                                    <p class="notep1">注意：</p>
                                    <p>快照时间是首选，因为并非所有性能数据都可用于您选择的日历时间。</p>
                                 </div>
                                 <p>您选择的时间段现在显示为活动会话图表中的灰色部分。</p>
                              </li>
                              <li>
                                 <p><span class="italic">可选：</span>定义一个或多个其他子集，其时间段与您在上一步中选择的时间段不同。
                                 </p>
                              </li>
                              <li>
                                 <p><span class="italic">可选：</span>在“高级参数”部分中，指示在子集工作负载结束后是否要包括未完成的调用。默认情况下，在子集工作负载开始时包括未完成的调用。
                                 </p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>通过这些参数，您可以在定义的边界之外包含调用。例如，当您指定开始和结束时间作为交易的边界时，交易可能已在您指定的开始时间之前开始，并且可能在您指定的结束时间之后继续。</p>
                                    </li>
                                 </ul>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p>单击<span class="bold">下一步</span> 。
                           </p>
                           <p>将出现“子集工作负载：数据库”页面。</p>
                        </li>
                        <li>
                           <p>单击<span class="bold">“数据库目标”字段旁边的搜索图标，然后从显示的“搜索和选择：目标”弹出窗口中选择要进行子集化的数据库。</span></p>
                           <p>系统现在请求数据库和主机凭据。</p>
                        </li>
                        <li>
                           <p>为上面的步骤提供必要的输入，然后单击“ <span class="bold">下一步”</span> 。
                           </p>
                           <p>将显示“子集工作负载：位置”页面。</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>如果源主机和分阶段数据库主机相同，则会预先填充该位置，因此您无需提供源工作负载文件的位置。</p>
                              </li>
                              <li>
                                 <p>如果源主机和分阶段数据库主机不相同，请执行以下操作：</p>
                                 <ol type="a">
                                    <li>
                                       <p>选择是否要从“主机”字段中显示的主机名访问工作负载文件，或者是否要将文件从源主机复制到显示的目标主机。</p>
                                       <p><span class="bold">直接访问</span>意味着用于对工作负载进行分组的数据库可以使用指定的文件系统位置直接访问原始工作负载。当原始工作负载存储在网络共享位置时，通常就是这种情况。
                                       </p>
                                       <p><span class="bold">访问复制</span>意味着这两台主机不在共享网络路径中。您需要提供源主机凭据，以便Enterprise Manager可以将原始工作负载从其当前位置复制到子集数据库主机上的指定位置。
                                       </p>
                                    </li>
                                    <li>
                                       <p>根据您的选择，提供包含工作负载文件的目录位置，或提供目标主机的位置。</p>
                                    </li>
                                 </ol>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>在“子集”字段中，指定每个子集的存储位置，然后单击“ <span class="bold">下一步”</span> 。
                           </p>
                           <p>将出现“子集工作负载：计划”页面。</p>
                        </li>
                        <li>
                           <p>指示要启动子集作业的时间，然后单击“ <span class="bold">下一步”</span> 。
                           </p>
                           <p>将显示“子集工作负载：审阅”页面。</p>
                        </li>
                        <li>
                           <p>如果一切按预期显示，请单击“ <span class="bold">提交”</span> 。
                           </p>
                           <p>数据库重播页面重新出现并显示一条消息，指出作业已成功提交。“重播任务”表中子集的“状态”列将显示“正在进行”。</p>
                           <div class="infobox-tip" id="GUID-2DD9B05E-9BD9-4F4D-92F6-E399093CB876__GUID-4C686A78-419E-4D52-B0F8-1F13356E6FBB">
                              <p class="notep1">小费：</p>
                              <p>您可以通过单击“审阅”步骤中刚刚提交的子集名称来检查作业的进度。将出现“捕获摘要”页面，您可以单击“数据库重放子集作业”链接以查看作业执行步骤的进度。</p>
                           </div>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="RATUG4240"></a><div class="props_rev_3"><a id="GUID-F89B9D09-2394-4C3F-AA11-EF1A73C23A85" name="GUID-F89B9D09-2394-4C3F-AA11-EF1A73C23A85"></a><h3 id="RATUG-GUID-F89B9D09-2394-4C3F-AA11-EF1A73C23A85" class="sect3"><span class="enumeration_section">10.12</span>将工作负载复制或移动到新位置</h3>
               <div>
                  <div><span>您可以将复制功能用于两个目的。</span> 目的是：</div>
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>将Capture文件从源复制到另一个主机和位置。</p>
                        </li>
                        <li>
                           <p>将Capture文件移动到新的主机和位置，并从原始位置删除源文件。</p>
                        </li>
                     </ul>
                     <p>此功能适用于Cloud Control Database插件12.1.0.5及更高版本。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-F89B9D09-2394-4C3F-AA11-EF1A73C23A85__GUID-F414CFB1-F3A9-453B-B73F-0E678036C2C2">要将工作负载复制到新位置：</p>
                     <ol>
                        <li>
                           <p>从“数据库重放”页面的“捕获的工作负载”选项卡中，选择要复制到新位置的工作负载，然后单击“ <span class="bold">复制”</span> 。
                           </p>
                           <p>将显示“复制工作负载”页面，并显示所选工作负载目录的当前源位置。</p>
                        </li>
                        <li>
                           <p>如有必要，提供或更改存储主机的凭据。系统会自动获取当前存储主机的先前定义的凭据。</p>
                        </li>
                        <li>
                           <p>保持启用After Copy单选按钮，即“将原始工作负载保留在源位置”。</p>
                        </li>
                        <li>
                           <p>为工作负载目录的新位置选择<span class="bold">存储主机</span> 。
                           </p>
                        </li>
                        <li>
                           <p>提供新存储主机的凭据。</p>
                        </li>
                        <li>
                           <p>选择工作负载的新<span class="bold">目标位置</span>的目录。
                           </p>
                        </li>
                        <li>
                           <p>安排作业，然后单击“ <span class="bold">提交”</span> 。
                           </p>
                           <p>数据库重播页面重新出现并显示一条消息，指出作业已提交且存储位置已成功更新。</p>
                           <div class="infobox-tip" id="GUID-F89B9D09-2394-4C3F-AA11-EF1A73C23A85__GUID-3658FA9A-06A8-43C9-A541-09E74A476E8B">
                              <p class="notep1">小费：</p>
                              <p>您可以通过转到“作业活动”页面，搜索提交消息中显示的作业名称，然后单击其链接以访问“作业运行”页面来检查作业的进度。</p>
                           </div>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="RATUG122"></a><div class="props_rev_3"><a id="GUID-7AB9889A-6F05-41D3-8EA1-F4BEEC507BDE" name="GUID-7AB9889A-6F05-41D3-8EA1-F4BEEC507BDE"></a><h3 id="RATUG-GUID-7AB9889A-6F05-41D3-8EA1-F4BEEC507BDE" class="sect3"><span class="enumeration_section">10.13</span>使用API捕获数据库工作负载</h3>
               <div>
                  <div><span>本节介绍如何使用API捕获数据库工作负载。</span>您还可以使用Oracle Enterprise Manager捕获数据库工作负载，如<span class="q">“ <a href="capturing-a-database-workload.html#GUID-1679DB12-B633-4021-A3B9-9CC6216D6681" title="本节介绍如何使用Enterprise Manager捕获数据库工作负载。捕获数据库工作负载的主要工具是Oracle Enterprise Manager。">使用Enterprise Manager捕获数据库工作负载</a> ”中所述</span> 。
                  </div>
                  <p>使用<code class="codeph">DBMS_WORKLOAD_CAPTURE</code>包捕获数据库工作负载涉及：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-4F96F1D0-475F-49ED-A3FD-C29C773EECBE" title="本节介绍如何添加和删除工作负载捕获筛选器。">定义工作负载捕获筛选器</a></p>
                     </li>
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-C85885FA-715D-48AB-80F1-9C546988E667" title="本节介绍如何启动工作负载捕获。">启动Workload Capture</a></p>
                     </li>
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-B6EE18AF-453C-4B67-975A-67D2F8773086" title="本节介绍如何停止工作负载捕获。">停止工作负载捕获</a></p>
                     </li>
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-9607209D-210B-4371-80F7-5536509F4FFB" title="导出AWR数据可以对工作负载进行详细分析。如果您计划在一对工作负载捕获或重放上运行重播比较期间报告或AWR比较期间报告，则还需要此数据。">导出工作负载捕获的AWR数据</a></p>
                     </li>
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-87A99A24-F4CD-4342-9817-012322038E07" title="从捕获系统导出AWR数据后，您可以将AWR数据导入另一个系统，例如将重放捕获的工作负载的测试系统。">导入工作负载捕获的AWR数据</a></p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-7AB9889A-6F05-41D3-8EA1-F4BEEC507BDE__GUID-D0BDC231-E9E6-4DC1-9F64-F50289E64893">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>有关<code class="codeph">DBMS_WORKLOAD_CAPTURE</code>包的信息，请<code class="codeph">DBMS_WORKLOAD_CAPTURE</code> <a href="../arpls/DBMS_WORKLOAD_CAPTURE.html#ARPLS207" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="RATUG123"></a><div class="props_rev_3"><a id="GUID-4F96F1D0-475F-49ED-A3FD-C29C773EECBE" name="GUID-4F96F1D0-475F-49ED-A3FD-C29C773EECBE"></a><h4 id="RATUG-GUID-4F96F1D0-475F-49ED-A3FD-C29C773EECBE" class="sect4"><span class="enumeration_section">10.13.1</span>定义工作负载捕获过滤器</h4>
                  <div>
                     <div><span>本节介绍如何添加和删除工作负载捕获筛选器。</span> 有关将工作负载过滤器与工作负载捕获一起使用的信息，请参阅<span class="q">“ <a href="capturing-a-database-workload.html#GUID-45889420-6496-4E7C-B698-A62E2580B962" title="默认情况下，在工作负载捕获期间记录所有用户会话。您可以使用工作负载筛选器指定在工作负载捕获期间要包含在工作负载中或从工作负载中排除哪些用">使用过滤器和Workload Capture</a> ”</span> 。
                     </div>
                     <div class="section">
                        <p class="subhead3" id="GUID-4F96F1D0-475F-49ED-A3FD-C29C773EECBE__GUID-89596064-009D-4D3E-A648-F406426BC433">要向工作负载捕获添加过滤器：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>使用<a id="d17564e3397" class="indexterm-anchor"></a> <code class="codeph">ADD_FILTER</code>程序：</p><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_WORKLOAD_CAPTURE.ADD_FILTER（fname =&gt;'user_ichan'，fattribute =&gt;'USER'，fvalue =&gt;'ICHAN'）;结束; /</pre><p>在此示例中， <code class="codeph">ADD_FILTER</code>过程添加名为user_ichan的过滤器，该过滤器可用于过滤掉属于用户名ICHAN的所有会话。</p>
                              <p>此示例中的<code class="codeph">ADD_FILTER</code>过程使用以下参数：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">fname</code> required参数指定要添加的过滤器的名称。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">fattribute</code> required参数指定将应用过滤器的属性。有效值包括PROGRAM，MODULE，ACTION，SERVICE，INSTANCE_NUMBER和USER。</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">fvalue</code> required参数指定将应用过滤器的相应属性的值。可以使用％等通配符和某些属性，例如模块和操作。
                                    </p>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-4F96F1D0-475F-49ED-A3FD-C29C773EECBE__GUID-B83F221F-EFB5-494B-9DE7-4B4E99BDACCF">要从工作负载捕获中删除过滤器：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>使用<a id="d17564e3442" class="indexterm-anchor"></a> <code class="codeph">DELETE_FILTER</code>程序：</p><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_WORKLOAD_CAPTURE.DELETE_FILTER（fname =&gt;'user_ichan'）;结束; /</pre><p>在此示例中， <code class="codeph">DELETE_FILTER</code>过程从工作负载捕获中删除名为user_ichan的过滤器。
                              </p>
                              <p>此示例中的<code class="codeph">DELETE_FILTER</code>过程使用<code class="codeph">fname</code> required参数，该参数指定要删除的过滤器的名称。<code class="codeph">DELETE_FILTER</code>过程不会删除属于已完成捕获的过滤器;它仅适用于尚未启动的捕获过滤器。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="RATUG124"></a><div class="props_rev_3"><a id="GUID-C85885FA-715D-48AB-80F1-9C546988E667" name="GUID-C85885FA-715D-48AB-80F1-9C546988E667"></a><h4 id="RATUG-GUID-C85885FA-715D-48AB-80F1-9C546988E667" class="sect4"><span class="enumeration_section">10.13.2</span>启动工作负载捕获</h4>
                  <div>
                     <div><span>本节介绍如何启动工作负载捕获。</span> 
                     </div>
                     <div class="p">在开始工作负载捕获之前，必须首先完成捕获数据库工作负载的先决条件。先决条件在<span class="q">“ <a href="capturing-a-database-workload.html#GUID-372BA03D-7A24-4300-A0AE-30E0D9D9C724" title="在开始工作负载捕获之前，您应该有一个策略来恢复测试系统上的数据库。">捕获数据库工作负载</a></span>的先决条件”中描述。您还应该查看工作负载捕获选项，如<span class="q">“ <a href="capturing-a-database-workload.html#GUID-79F20163-CE64-4C9C-9F71-C41A95460C05" title="在工作负载捕获之前需要进行适当的规划，以确保在另一个环境中重放时捕获将是准确和有用的。">工作负载捕获选项</a> ”中所述</span> 。
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>为工作负载定义明确的起点非常重要，这样在重新启动捕获的工作负载之前，可以将重放系统恢复到该点。要为工作负载捕获定义明确的起点，最好在启动工作负载捕获时不要有任何活动的用户会话。如果活动会话执行正在进行的事务，那么这些事务将不会在后续数据库重放中正确重放，因为只有在启动工作负载捕获后执行调用的事务部分才会被重播。要避免此问题，请考虑在开始工作负载捕获之前使用<code class="codeph">STARTUP RESTRICT</code>以受限模式重新启动数据库。工作负载捕获开始后，数据库将自动切换到不受限制的模式，并且在捕获工作负载时可以继续正常操作。有关在捕获工作负载之前重新启动数据库的详细信息，请参阅<span class="q">“ <a href="capturing-a-database-workload.html#GUID-77DFEBE7-4FF9-4CB4-97B2-8501ECB8E7E4" title="虽然不需要此步骤，但Oracle建议在捕获工作负载之前重新启动数据库，以确保在捕获开始之前允许完成或回滚正在进行的事务和从属事务。">重新启动数据库</a> ”</span> 。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C85885FA-715D-48AB-80F1-9C546988E667__GUID-B0019AEB-00C0-49CE-803C-4F3FDD9FCFAE">要开始工作负载捕获：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>使用<a id="d17564e3592" class="indexterm-anchor"></a> <code class="codeph">START_CAPTURE</code>程序：</p><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_WORKLOAD_CAPTURE.START_CAPTURE（名称=&gt;'dec10_peak'，dir =&gt;'dec10'，持续时间=&gt; 600，capture_sts =&gt; TRUE，sts_cap_interval =&gt; 300，plsql_mode =&gt;'extended'加密=&gt;'AES256'）;结束; /</pre><p>在此示例中，名为<code class="codeph">dec10_peak</code>的工作负载将被捕获600秒并存储在由名为<code class="codeph">dec10</code>的数据库目录对象定义的文件系统中。还将与工作负载捕获并行捕获SQL调优集。
                              </p>
                              <p>此示例中的<code class="codeph">START_CAPTURE</code>过程使用以下参数：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">name</code> required参数指定将捕获的工作负载的名称。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">dir</code> required参数指定一个目录对象，该目录对象指向将存储捕获的工作负载的目录。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">duration</code>参数指定工作负载捕获结束前的秒数。如果未指定值，则工作负载捕获将继续，直到调用<code class="codeph">FINISH_CAPTURE</code>过程。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">capture_sts</code>参数指定是否与工作负载捕获并行捕获SQL调优集。如果此参数设置为<code class="codeph">TRUE</code> ，则可以在工作负载捕获期间捕获SQL调优集，然后在工作负载重放期间捕获另一个SQL调优集，并使用SQL Performance Analyzer来比较SQL调优集，而无需重新执行SQL语句。这使您可以在运行数据库重放时获取SQL性能分析器报告并比较更改之前和之后的SQL性能。您还可以使用<code class="codeph">EXPORT_AWR</code>过程导出生成的SQL调优集及其AWR数据，如<span class="q">“ <a href="capturing-a-database-workload.html#GUID-9607209D-210B-4371-80F7-5536509F4FFB" title="导出AWR数据可以对工作负载进行详细分析。如果您计划在一对工作负载捕获或重放上运行重播比较期间报告或AWR比较期间报告，则还需要此数据。">导出工作负载捕获的AWR数据</a> ”中所述</span> 。
                                    </p>
                                    <p>Oracle RAC不支持此功能。使用<code class="codeph">DBMS_WORKLOAD_CAPTURE</code>定义的工作负载捕获筛选器不适用于SQL调优集捕获。此参数的默认值为<code class="codeph">FALSE</code> 。</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">sts_cap_interval</code>参数指定从光标高速缓存捕获SQL调整集的持续时间（以秒为单位）。默认值为300。将此参数的值设置为低于默认值可能会导致某些工作负载产生额外开销，因此不建议这样做。
                                    </p>
                                 </li>
                                 <li>
                                    <p>可选的<code class="codeph">plsql_mode</code>参数确定捕获和重放期间DB Replay如何处理PL / SQL。
                                    </p>
                                    <p>可以为<code class="codeph">plsql_mode</code>参数设置这两个值：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><code class="codeph">top_level</code> ：只捕获和重放顶级PL / SQL调用，这是DB Replay在Oracle Database 12 <span class="italic">c</span> Release 2（12.2.0.1）之前处理PL / SQL的方式。这是默认值。
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">extended</code> ：捕获顶级PL / SQL调用和从PL / SQL调用的SQL。重放工作负载时，重放可以在顶级或扩展级别完成，但不能同时完成。
                                          </p>
                                       </li>
                                    </ul>
                                 </li>
                              </ul>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">encryption</code>参数指定用于加密捕获文件的算法。
                                    </p>
                                    <p>以下加密标准可用于<code class="codeph">encryption</code>参数：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p>NULL  - 捕获文件未加密（默认值）</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">AES128</code> - 使用AES128加密捕获文件</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">AES192</code> - 使用AES192加密捕获文件</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">AES256</code> - 使用AES256加密捕获文件</p>
                                       </li>
                                    </ul>
                                    <div class="infoboxnote" id="GUID-C85885FA-715D-48AB-80F1-9C546988E667__GUID-D7F637AD-C232-427A-83CB-8EF17E1E6D26">
                                       <p class="notep1">注意：</p>
                                       <p>要使用加密运行<code class="codeph">START_CAPTURE</code> ，必须使用<code class="codeph">oracle.rat.database_replay.encryption</code> （区分大小写）标识符设置密码。密码存储在软件密钥库中。有关创建软件密钥库的更多信息，请参见“ <a href="../asoag/configuring-transparent-data-encryption.html#ASOAG-GUID-1FA85E9E-5666-4CF3-A3C7-1F8A9230B0C9" target="_blank"><span><cite>Oracle数据库高级安全性指南”</cite></span></a> 。
                                       </p>
                                    </div>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C85885FA-715D-48AB-80F1-9C546988E667__GUID-A1B49722-C27E-47CE-A2B3-6B9B16E72B01">示例：设置基于密码的软件密钥库：</p>
                        <p>以下语句创建基于密码的软件密钥库：</p><pre class="oac_no_warn" dir="ltr">管理员密钥管理通过<span class="italic">密码</span>创建KEYSTORE'MYKEYSTORE' <span class="italic">;</span></pre><p>以下语句打开基于密码的软件密钥库，并创建基于密码的软件密钥库的备份：</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN由<span class="italic">密码</span>识别<span class="italic">;</span>管理员密钥管理设置密钥由<span class="italic">密码</span> WITH BACKUP标识;</pre><p>以下语句将客户端<code class="codeph">'oracle.rat.database_replay.encryption'</code> <code class="codeph">DBREPLAY,</code>秘密<code class="codeph"><span class="codeinlineitalic">secret_key,</span></code>与标记<code class="codeph">DBREPLAY,</code>一起添加到基于密码的软件密钥库。在添加密码之前，它还会创建基于密码的软件密钥库的备份：</p><pre class="oac_no_warn" dir="ltr">管理员密钥管理添加秘密<span class="italic">secret_key</span>用于客户端' <span class="italic">oracle.rat.database_replay.encryption</span> '使用标记'DBREPLAY'通过<span class="italic">密码</span> WITH BACKUP识别;</pre><p>以下语句将关闭基于密码的软件密钥库：</p><pre class="oac_no_warn" dir="ltr">管理员密钥管理设置KEYSTORE CLOSE通过<span class="italic">密码</span>识别<span class="italic">;</span></pre><div class="infoboxnote" id="GUID-C85885FA-715D-48AB-80F1-9C546988E667__GUID-122C54F7-FBB1-4120-8709-1761A7B7FB84">
                           <p class="notep1">注意：</p>
                           <p>在运行数据库捕获和数据库重放之前，必须保持软件密钥库处于打开状态。</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="RATUG125"></a><div class="props_rev_3"><a id="GUID-B6EE18AF-453C-4B67-975A-67D2F8773086" name="GUID-B6EE18AF-453C-4B67-975A-67D2F8773086"></a><h4 id="RATUG-GUID-B6EE18AF-453C-4B67-975A-67D2F8773086" class="sect4"><span class="enumeration_section">10.13.3</span>停止工作负载捕获</h4>
                  <div>
                     <p>本节介绍如何停止工作负载捕获。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-B6EE18AF-453C-4B67-975A-67D2F8773086__GUID-B37D10BC-49AB-42DB-99EA-FE768A7CFCFB">要停止工作负载捕获：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>使用<a id="d17564e3881" class="indexterm-anchor"></a> <code class="codeph">FINISH_CAPTURE</code>程序：</p><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_WORKLOAD_CAPTURE.FINISH_CAPTURE（）;结束; /</pre><p>在此示例中， <code class="codeph">FINISH_CAPTURE</code>过程完成工作负载捕获并将数据库返回到正常状态。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <div class="infobox-tip" id="GUID-B6EE18AF-453C-4B67-975A-67D2F8773086__GUID-92B35556-4889-4EC6-971E-354C24264FAC">
                           <p class="notep1">小费：</p>
                           <p>捕获生产系统上的工作负载后，您需要预处理捕获的工作负载，如<a href="preprocessing-a-database-workload.html#GUID-4CEE2F79-F5A7-4EBA-9018-0CB99AB51C0A" title="捕获工作负载并完成测试系统的设置后，必须预处理捕获的数据。">预处理数据库工作负载中所述</a> 。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="RATUG126"></a><div class="props_rev_3"><a id="GUID-9607209D-210B-4371-80F7-5536509F4FFB" name="GUID-9607209D-210B-4371-80F7-5536509F4FFB"></a><h4 id="RATUG-GUID-9607209D-210B-4371-80F7-5536509F4FFB" class="sect4"><span class="enumeration_section">10.13.4</span>导出Workload Capture的AWR数据</h4>
                  <div>
                     <p>导出AWR数据可以对工作负载进行详细分析。如果您计划在一对工作负载捕获或重放上运行重播比较期间报告或AWR比较期间报告，则还需要此数据。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-9607209D-210B-4371-80F7-5536509F4FFB__GUID-B427ED7C-95E5-481B-9078-72145B02EBF8">要导出AWR数据：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>使用<a id="d17564e3998" class="indexterm-anchor"></a> <code class="codeph">EXPORT_AWR</code>程序：</p><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_WORKLOAD_CAPTURE.EXPORT_AWR（capture_id =&gt; 2）;结束; /</pre><p>在此示例中，将导出与捕获ID为2的工作负载捕获相对应的AWR快照，以及在工作负载捕获期间可能已捕获的任何SQL调整集。</p>
                              <p><code class="codeph">EXPORT_AWR</code>过程使用<code class="codeph">capture_id</code>必需参数，该参数指定将导出其AWR快照的捕获的ID。<code class="codeph">capture_id</code>参数的值显示在<code class="codeph">DBA_WORKLOAD_CAPTURES</code>视图的<code class="codeph">ID</code>列中。
                              </p>
                              <div class="infoboxnote" id="GUID-9607209D-210B-4371-80F7-5536509F4FFB__GUID-683BE151-3C01-4FA7-BF57-C71BFBCE4B50">
                                 <p class="notep1">注意：</p>
                                 <p>仅当在当前数据库中执行相应的工作负载捕获并且仍然可以使用与原始捕获时间段对应的AWR快照时，此过程才有效。</p>
                              </div>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-9607209D-210B-4371-80F7-5536509F4FFB__GUID-57DFEFB3-43EA-4552-BDAB-BF746BA90B85">
                           <p class="notep1">也可以看看：</p>
                           <p>有关<code class="codeph">DBA_WORKLOAD_CAPTURES</code>视图的信息，请<code class="codeph">DBA_WORKLOAD_CAPTURES</code> <a href="../refrn/DBA_WORKLOAD_CAPTURES.html#REFRN23628" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="RATUG4194"></a><div class="props_rev_3"><a id="GUID-87A99A24-F4CD-4342-9817-012322038E07" name="GUID-87A99A24-F4CD-4342-9817-012322038E07"></a><h4 id="RATUG-GUID-87A99A24-F4CD-4342-9817-012322038E07" class="sect4"><span class="enumeration_section">10.13.5</span>导入Workload Capture的AWR数据</h4>
                  <div>
                     <div><span>从捕获系统导出AWR数据后，您可以将AWR数据导入另一个系统，例如将重放捕获的工作负载的测试系统。</span> 导入AWR数据可以对工作负载进行详细分析。如果您计划在一对工作负载捕获或重放上运行重播比较期间报告或AWR比较期间报告，则还需要此数据。
                     </div>
                     <div class="section">
                        <p class="subhead3" id="GUID-87A99A24-F4CD-4342-9817-012322038E07__GUID-A39B4264-4AF3-487C-9CB0-6BB37E88722E">要导入AWR数据：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>使用<a id="d17564e4137" class="indexterm-anchor"></a> <code class="codeph">IMPORT_AWR</code>函数，如以下示例所示：</p><pre class="oac_no_warn" dir="ltr">CREATE USER capture_awr SELECT DBMS_WORKLOAD_CAPTURE.IMPORT_AWR（capture_id =&gt; 2，staging_schema =&gt;'capture_awr'）FROM DUAL;</pre><p>在此示例中，使用名为<code class="codeph">capture_awr</code>的临时模式导入与捕获ID为2的工作负载捕获相对应的AWR快照。
                              </p>
                              <p>此示例中的<code class="codeph">IMPORT_AWR</code>过程使用以下参数：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">capture_id</code>必需参数指定将导入AWR快照的捕获的ID。<code class="codeph">capture_id</code>参数的值显示在<code class="codeph">DBA_WORKLOAD_CAPTURES</code>视图的<code class="codeph">ID</code>列中。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">staging_schema</code> required参数指定当前数据库中有效模式的名称，该模式可以在将AWR快照从捕获目录导入<code class="codeph">SYS</code> <code class="codeph">AWR</code>模式时用作临时区域。
                                    </p>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <div class="infoboxnote" id="GUID-87A99A24-F4CD-4342-9817-012322038E07__GUID-11EDA585-1BA7-43CE-AB21-8D3357A61723">
                           <p class="notep1">注意：</p>
                           <p>如果<code class="codeph">staging_schema</code>参数指定的模式包含与任何AWR表同名的任何表，则此函数将失败。
                           </p>
                        </div>
                        <div class="infoboxnotealso" id="GUID-87A99A24-F4CD-4342-9817-012322038E07__GUID-02B63215-231C-4BEF-B046-52E5F27BB15B">
                           <p class="notep1">也可以看看：</p>
                           <p>有关<code class="codeph">DBA_WORKLOAD_CAPTURES</code>视图的信息，请<code class="codeph">DBA_WORKLOAD_CAPTURES</code> <a href="../refrn/DBA_WORKLOAD_CAPTURES.html#REFRN23628" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-19A5094A-185D-4F1C-B441-FB72AC9EA2ED" name="GUID-19A5094A-185D-4F1C-B441-FB72AC9EA2ED"></a><h3 id="RATUG-GUID-19A5094A-185D-4F1C-B441-FB72AC9EA2ED" class="sect3"><span class="enumeration_section">10.14</span>使用API加密和解密现有的工作负载捕获</h3>
               <div>
                  <p>本节介绍如何使用API加密和解密现有工作负载捕获。</p>
                  <p>在工作负载捕获期间，会保存各种信息，如连接字符串，SQL文本和绑定值。如果此信息包含敏感数据，则可以对其进行加密。您可以在工作负载捕获期间启用加密，如<a href="capturing-a-database-workload.html#GUID-C85885FA-715D-48AB-80F1-9C546988E667" title="本节介绍如何启动工作负载捕获。">启动</a>工作负载捕获中所述。
                  </p>
               </div>
               <div class="sect3"><a id="GUID-F5B503CD-6E39-4EE4-9869-060731304EED" name="GUID-F5B503CD-6E39-4EE4-9869-060731304EED"></a><h4 id="RATUG-GUID-F5B503CD-6E39-4EE4-9869-060731304EED" class="sect4"><span class="enumeration_section">10.14.1</span>加密现有的工作负载捕获</h4>
                  <div>
                     <p>本节介绍如何加密现有工作负载捕获。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-F5B503CD-6E39-4EE4-9869-060731304EED__GUID-B12D05B8-83E3-457D-BAC8-40E22140AC45">要加密现有工作负载捕获：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>使用<a id="d17564e4382" class="indexterm-anchor"></a> <code class="codeph">ENCRYPT_CAPTURE</code>程序：</p><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_WORKLOAD_CAPTURE.ENCRYPT_CAPTURE（src_dir =&gt;'dec10'，dst_dir =&gt;'dec10_enc'，encryption =&gt;'AES128'）;结束; /</pre><p>此示例中的<code class="codeph">ENCRYPT_CAPTURE</code>过程使用以下参数：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">src_dir</code>参数指向包含要加密的工作负载捕获的目录。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">dst_dir</code>参数指向加密后保存加密捕获的目录。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">encryption</code>参数指定用于加密工作负载捕获的算法。
                                    </p>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-F5B503CD-6E39-4EE4-9869-060731304EED__GUID-929FE974-FA5A-4DDE-8699-575477431791">
                           <p class="notep1">注意：</p>
                           <p>在运行之前<code class="codeph">DBMS_WORKLOAD_CAPTURE.ENCRYPT_CAPTURE</code> ，你必须存储<code class="codeph">oracle.rat.database_replay.encryption</code>的软件密钥库（区分大小写）的标识符。
                           </p>
                        </div>
                        <div class="infoboxnotealso" id="GUID-F5B503CD-6E39-4EE4-9869-060731304EED__GUID-59F0A1AE-7AB6-4160-8CCB-823D8ABB20E6">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../arpls/DBMS_WORKLOAD_CAPTURE.html#ARPLS-GUID-14CC7E0D-BAD1-4FBE-B018-9C3341563E21" target="_blank"><span><cite>Oracle数据库PL / SQL包和类型参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-67E3C3B9-F074-4A4B-80C0-43DD515D5DB9" name="GUID-67E3C3B9-F074-4A4B-80C0-43DD515D5DB9"></a><h4 id="RATUG-GUID-67E3C3B9-F074-4A4B-80C0-43DD515D5DB9" class="sect4"><span class="enumeration_section">10.14.2</span>解密加密的工作负载捕获</h4>
                  <div>
                     <p>本节介绍如何解密加密的工作负载捕获。</p>
                     <div class="section">
                        <p>可以使用<code class="codeph">DBMS_WORKLOAD_CAPTURE.DECRYPT_CAPTURE</code>过程解密加密的工作负载捕获。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-67E3C3B9-F074-4A4B-80C0-43DD515D5DB9__GUID-373E2B2B-5755-4E1E-AEA3-467CCC86CA88">要解密加密的工作负载捕获：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>使用<a id="d17564e4530" class="indexterm-anchor"></a> <code class="codeph">DECRYPT_CAPTURE</code>程序：</p><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_WORKLOAD_CAPTURE.DECRYPT_CAPTURE（src_dir =&gt;'dec10_enc'，dst_dir =&gt;'dec10'）;结束; /</pre><p>此示例中的<code class="codeph">DECRYPT_CAPTURE</code>过程使用以下参数：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">src_dir</code>参数指向包含加密捕获的目录。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">dst_dir</code>参数指向解密后保存解密捕获的目录。
                                    </p>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-67E3C3B9-F074-4A4B-80C0-43DD515D5DB9__GUID-9B5361FF-4F9D-4DC3-ABDE-AD8D8DF2CEC4">
                           <p class="notep1">注意：</p>
                           <p>在运行之前<code class="codeph">DBMS_WORKLOAD_CAPTURE.DECRYPT_CAPTURE</code> ，你必须存储<code class="codeph">oracle.rat.database_replay.encryption</code>的软件密钥库（区分大小写）的标识符。
                           </p>
                        </div>
                        <div class="infoboxnotealso" id="GUID-67E3C3B9-F074-4A4B-80C0-43DD515D5DB9__GUID-2A4E46BF-E6E2-4152-A467-E80FE858E63B">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../arpls/DBMS_WORKLOAD_CAPTURE.html#ARPLS-GUID-FF5E0954-DD22-4BE5-85F2-A720858C5A06" target="_blank"><span><cite>Oracle数据库PL / SQL包和类型参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="RATUG127"></a><div class="sect2"><a id="GUID-B9D817BE-43F0-4813-B161-14FFD7F51D40" name="GUID-B9D817BE-43F0-4813-B161-14FFD7F51D40"></a><h3 id="RATUG-GUID-B9D817BE-43F0-4813-B161-14FFD7F51D40" class="sect3"><span class="enumeration_section">10.15</span>使用视图监控工作负载捕获</h3>
               <div>
                  <div><span>本节概述了可以显示以监视工作负载捕获的视图。</span> 您还可以使用Oracle Enterprise Manager监视工作负载捕获，如<span class="q">“ <a href="capturing-a-database-workload.html#GUID-509ABE02-E9DB-420B-80AA-5FF2B8CDD9A5" title="本节介绍如何使用Enterprise Manager监视工作负载捕获。监视工作负载捕获的主要工具是Oracle Enterprise Manager。">使用Enterprise Manager监视工作负载捕获</a> ”中所述</span> 。
                  </div>
                  <p>要访问这些视图，您需要DBA权限：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><code class="codeph">DBA_WORKLOAD_CAPTURES</code>视图列出了当前数据库中捕获的所有工作负载捕获。
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">DBA_WORKLOAD_FILTERS</code>视图列出了用于当前数据库中定义的工作负载捕获的所有工作负载过滤器。
                        </p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-B9D817BE-43F0-4813-B161-14FFD7F51D40__GUID-45594D61-FC4E-4C4E-83C1-F33CBB866A12">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>有关<code class="codeph">DBA_WORKLOAD_CAPTURES</code>视图的信息，请<code class="codeph">DBA_WORKLOAD_CAPTURES</code> <a href="../refrn/DBA_WORKLOAD_CAPTURES.html#REFRN23628" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                        </li>
                        <li>
                           <p>有关<code class="codeph">DBA_WORKLOAD_FILTERS</code>视图的信息，请<code class="codeph">DBA_WORKLOAD_FILTERS</code> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/ratug&amp;id=REFRN23630" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>