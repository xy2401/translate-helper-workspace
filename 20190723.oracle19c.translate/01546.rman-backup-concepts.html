<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>RMAN备份概念</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96241-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="part-backing-up-archiving.html" title="Previous" type="text/html"></link>
      <link rel="next" href="backing-up-database.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="BRADV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="part-backing-up-archiving.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="backing-up-database.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复用户指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-backing-up-archiving.html" property="item" typeof="WebPage"><span property="name">备份和存档数据</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">RMAN备份概念</li>
            </ol>
            <a id="GUID-B3380142-ABCD-437F-9E06-B219D74E6738" name="GUID-B3380142-ABCD-437F-9E06-B219D74E6738"></a><a id="BRADV002"></a>
            
            <h2 id="BRADV-GUID-B3380142-ABCD-437F-9E06-B219D74E6738" class="sect2"><span class="enumeration_chapter">8</span> RMAN备份概念</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍了进行任何类型的RMAN备份时必须了解的一般概念。本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="rman-backup-concepts.html#GUID-3FD1F547-74C0-434A-98D0-5D85A851FCC0" title="使用RMAN BACKUP命令创建一致和不一致的备份。">关于一致且不一致的RMAN备份</a></p>
                  </li>
                  <li>
                     <p><a href="rman-backup-concepts.html#GUID-2CF40BDC-A193-4450-8B10-DEA0E416388C" title="您可以创建RMAN备份或用户管理的备份。">关于在线备份和备份模式</a></p>
                  </li>
                  <li>
                     <p><a href="rman-backup-concepts.html#GUID-74FF41AF-D1EE-4DB1-AC0D-56FC83CAA91D" title="在RMAN中执行BACKUP命令时，您将创建一个或多个备份集或映像副本。默认情况下，无论目标是磁盘还是媒体管理器，RMAN都会创建备份集。">关于备份集</a></p>
                  </li>
                  <li>
                     <p><a href="rman-backup-concepts.html#GUID-3580BA12-463A-4A61-939D-58C51E81FF12" title="映像副本是单个数据文件，归档重做日志文件或控制文件的精确副本。">关于RMAN图像副本</a></p>
                  </li>
                  <li>
                     <p><a href="rman-backup-concepts.html#GUID-763A9C75-90A5-48FD-9CB6-707D030A00F5" title="RMAN使您可以创建多个相同的备份副本。">关于RMAN备份的多个副本</a></p>
                  </li>
                  <li>
                     <p><a href="rman-backup-concepts.html#GUID-95840C84-1595-49AC-923D-310DA750676B" title="在许多恢复情况下，最近备份控制文件和服务器参数文件非常有用。为确保您备份这些文件，数据库支持控制文件和服务器参数文件自动备份。">关于RMAN控制文件和服务器参数文件自动备份</a></p>
                  </li>
                  <li>
                     <p><a href="rman-backup-concepts.html#GUID-C93F3588-BBA9-4AE2-9E47-74C7A9468023" title="增量备份仅复制自上次备份以来已更改的数据块。您可以使用RMAN创建数据文件，表空间或整个数据库的增量备份。">关于RMAN增量备份</a></p>
                  </li>
                  <li>
                     <p><a href="rman-backup-concepts.html#GUID-3F68F554-FBC9-4375-85DE-7F844C48C8FF" title="您可以使用CONFIGURE RETENTION POLICY命令创建持久性和自动备份保留策略。">关于备份保留策略</a></p>
                  </li>
               </ul>
            </div><a id="BRADV89477"></a><div class="props_rev_3"><a id="GUID-3FD1F547-74C0-434A-98D0-5D85A851FCC0" name="GUID-3FD1F547-74C0-434A-98D0-5D85A851FCC0"></a><h3 id="BRADV-GUID-3FD1F547-74C0-434A-98D0-5D85A851FCC0" class="sect3"><span class="enumeration_section">8.1</span>关于一致且不一致的RMAN备份</h3>
               <div>
                  <p>使用RMAN <code class="codeph">BACKUP</code>命令创建一致和不一致的备份。
                  </p>
                  <p>RMAN <code class="codeph">BACKUP</code>命令支持备份以下类型的文件：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>数据文件和控制文件</p>
                     </li>
                     <li>
                        <p>服务器参数文件</p>
                     </li>
                     <li>
                        <p>存档的重做日志</p>
                     </li>
                     <li>
                        <p>RMAN备份</p>
                     </li>
                  </ul>
                  <p>虽然数据库依赖于其他类型的文件，例如网络配置文件，密码文件和Oracle主目录的内容，但您无法使用RMAN备份这些文件。同样，Oracle数据库的某些功能（如外部表）可能依赖于数据文件，控制文件和重做日志以外的文件。RMAN无法备份这些文件。使用Oracle Secure Backup等通用备份软件来保护RMAN不支持的文件。</p>
                  <p>在RMAN中执行<code class="codeph">BACKUP</code>命令时，输出始终是一个或多个备份集或一个或多个映像副本。<a href="glossary.html#GUID-6AA43E7D-9946-4C41-A62F-01E5BACEB8A7"><span class="xrefglossterm">备份集</span></a>是RMAN特定的专有格式，而<a href="glossary.html#GUID-397CB99E-3F07-4980-96B3-9D0D0ABBABEA"><span class="xrefglossterm">映像副本</span></a>是文件的逐位副本。默认情况下，RMAN会创建备份集。
                  </p>
                  <div class="infoboxnotealso" id="GUID-3FD1F547-74C0-434A-98D0-5D85A851FCC0__GUID-5A6CD23D-6A3C-4E15-B343-E5F8861DDC3A">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="rman-backup-concepts.html#GUID-10871A83-DD0B-49FB-9601-A598D367ECD3" title="当数据库处于一致状态时，将发生一致的备份。您可以使用BACKUP命令对数据库进行一致的备份。">关于一致的RMAN备份</a></p>
                        </li>
                        <li>
                           <p><a href="rman-backup-concepts.html#GUID-23606AAD-40E3-4198-BC70-B3D0FE698C9C" title="任何不一致的数据库备份都是不一致的备份。数据库打开时进行的备份不一致，实例失败或SHUTDOWN ABORT命令后进行备份也是如此。">关于不一致的RMAN备份</a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="BRADV99964"></a><div class="props_rev_3"><a id="GUID-10871A83-DD0B-49FB-9601-A598D367ECD3" name="GUID-10871A83-DD0B-49FB-9601-A598D367ECD3"></a><h4 id="BRADV-GUID-10871A83-DD0B-49FB-9601-A598D367ECD3" class="sect4"><span class="enumeration_section">8.1.1</span>关于一致的RMAN备份</h4>
                  <div>
                     <p>当数据库处于一致状态时，将发生一致的备份。您可以使用<code class="codeph">BACKUP</code>命令对数据库进行一致的备份。
                     </p>
                     <p>使用<a href="../rcmrf/SHUTDOWN.html#RCMRF155" target="_blank"><code class="codeph">SHUTDOWN</code></a> <code class="codeph">NORMAL</code> ， <code class="codeph">SHUTDOWN IMMEDIATE</code>或<code class="codeph">SHUTDOWN TRANSACTIONAL</code>命令关闭数据库后，数据库处于一致状态。一致的关闭可确保所有重做都已应用于数据文件。如果您在此时装入数据库并进行备份，则可以稍后还原数据库备份并在不执行介质恢复的情况下将其打开。但是，当然，您将丢失创建备份后发生的所有事务。
                     </p>
                  </div>
               </div><a id="BRADV99965"></a><div class="props_rev_3"><a id="GUID-23606AAD-40E3-4198-BC70-B3D0FE698C9C" name="GUID-23606AAD-40E3-4198-BC70-B3D0FE698C9C"></a><h4 id="BRADV-GUID-23606AAD-40E3-4198-BC70-B3D0FE698C9C" class="sect4"><span class="enumeration_section">8.1.2</span>关于不一致的RMAN备份</h4>
                  <div>
                     <p>任何不一致的数据库备份都是不一致的备份。数据库打开时进行的备份不一致，实例失败或<code class="codeph">SHUTDOWN ABORT</code>命令后进行备份也是如此。
                     </p>
                     <p>从不一致的备份还原数据库时，Oracle数据库必须先执行介质恢复，然后才能打开数据库，并应用创建备份后发生的重做日志中的更改。</p>
                     <div class="infoboxnote" id="GUID-23606AAD-40E3-4198-BC70-B3D0FE698C9C__GUID-4EFE7E16-3939-4EAD-A8D4-579546927B87">
                        <p class="notep1">注意：</p>
                        <p>当数据库处于<code class="codeph">NOARCHIVELOG</code>模式时，RMAN不允许您进行不一致的备份。如果对<code class="codeph">NOARCHIVELOG</code>数据库使用用户管理的备份技术，则不得对此数据库进行不一致的备份。
                        </p>
                     </div>
                     <p>如果数据库以<code class="codeph">ARCHIVELOG</code>模式运行，并且备份存档的重做日志和数据文件，则不一致的备份可以作为完善的备份和恢复策略的基础。不一致的备份提供了卓越的可用性，因为您不必关闭数据库来进行完全保护数据库的备份。
                     </p>
                  </div>
               </div>
            </div><a id="BRADV89479"></a><div class="props_rev_3"><a id="GUID-2CF40BDC-A193-4450-8B10-DEA0E416388C" name="GUID-2CF40BDC-A193-4450-8B10-DEA0E416388C"></a><h3 id="BRADV-GUID-2CF40BDC-A193-4450-8B10-DEA0E416388C" class="sect3"><span class="enumeration_section">8.2</span>关于在线备份和备份模式</h3>
               <div>
                  <p>您可以创建RMAN备份或用户管理的备份。</p>
                  <p>在执行联机表空间或数据库的<a href="glossary.html#GUID-F4A66D43-CA48-412E-98E8-B25CE1C7B065"><span class="xrefglossterm">用户管理备份</span></a>时，操作系统实用程序可以在数据库写程序（DBWR）更新文件的同时备份数据文件。该实用程序可以读取处于半更新状态的块，以便复制到备份介质的块在其前半部分更新，而后半部分包含较旧的数据。这种类型的<a href="glossary.html#GUID-E55A74E5-8AD7-478F-A458-E4CB2E389009"><span class="xrefglossterm">逻辑损坏</span></a>称为<a href="glossary.html#GUID-9999D934-31A1-44D5-995F-EC5B92583B17"><span class="xrefglossterm">断裂块</span></a> ，即与SCN不一致的块。如果必须还原此备份并且块需要恢复，则恢复将失败，因为该块不可用。
                  </p>
                  <p>对于第三方快照技术，您必须使用以下技术之一来消除创建破裂块的风险：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>确保快照技术符合Oracle对联机备份的要求</p>
                     </li>
                     <li>
                        <p>脱机获取数据库或数据文件</p>
                     </li>
                     <li>
                        <p>在使用第三方快照备份之前，请将数据库置于备份模式</p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-2CF40BDC-A193-4450-8B10-DEA0E416388C__GUID-EAD87694-A55A-4E23-AAE6-341EF6AC2416">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p> <a href="user-managed-database-backups.html#GUID-A1112F2C-D0ED-4C2F-BA24-A614F99F0FCA">使用第三方快照技术进行备份</a> 。
                           </p>
                        </li>
                        <li>
                           <p><a href="user-managed-flashback-dbpitr.html#GUID-5A3BB8EE-291F-41C6-976C-1F304069FF0B">使用存储快照优化进行恢复</a></p>
                        </li>
                     </ul>
                  </div>
                  <p>与用户管理的工具不同，RMAN不需要额外的日志记录或备份模式，因为它知道数据块的格式。RMAN保证不备份破碎的块。在RMAN备份期间，数据库服务器会话将读取每个数据块，并通过比较块头和页脚来检查它是否已断开。如果块被破坏，则会话重新读取块。如果发现相同的裂缝，那么该块被认为是永久性的腐败。此外，RMAN不需要冻结数据文件头检查点，因为它知道块的读取顺序，这使它能够捕获文件的已知良好检查点。</p>
                  <div class="infoboxnotealso" id="GUID-2CF40BDC-A193-4450-8B10-DEA0E416388C__GUID-D0B338C8-E6E6-4F4A-8D20-D5C8161A6A1B">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="user-managed-database-backups.html#GUID-57387AB6-1204-44F0-826A-F9B638453935">制作用户管理的联机表空间和数据文件备份，</a>以了解如何在不使用RMAN时备份联机表空间</p>
                  </div>
               </div>
            </div><a id="BRADV106"></a><div class="props_rev_3"><a id="GUID-74FF41AF-D1EE-4DB1-AC0D-56FC83CAA91D" name="GUID-74FF41AF-D1EE-4DB1-AC0D-56FC83CAA91D"></a><h3 id="BRADV-GUID-74FF41AF-D1EE-4DB1-AC0D-56FC83CAA91D" class="sect3"><span class="enumeration_section">8.3</span>关于备份集</h3>
               <div>
                  <p>在RMAN中执行<code class="codeph">BACKUP</code>命令时，您将创建一个或多个备份集或映像副本。默认情况下，无论目标是磁盘还是媒体管理器，RMAN都会创建备份集。
                  </p>
                  <div class="infoboxnote" id="GUID-74FF41AF-D1EE-4DB1-AC0D-56FC83CAA91D__GUID-A2E6EAE1-8A44-4967-9E06-8BC9BC74B382">
                     <p class="notep1">注意：</p>
                     <p>数据文件备份集通常小于数据文件映像副本，并且写入时间较短。</p>
                  </div>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="rman-backup-concepts.html#GUID-1C871377-D8A7-4414-B0F0-884403666E8C" title="RMAN可以将备份数据存储在称为备份集的逻辑结构中，该备份集是RMAN备份的最小单元。">关于备份集和备份片</a></p>
                     </li>
                     <li>
                        <p><a href="rman-backup-concepts.html#GUID-073C85A4-E28C-4FE2-A089-1EABF3D00070" title="创建备份集时，RMAN可以使用块压缩。">关于备份集的RMAN块压缩</a></p>
                     </li>
                     <li>
                        <p><a href="rman-backup-concepts.html#GUID-2AFCD551-95CB-4F9F-946E-550E89613974" title="RMAN支持备份集的二进制压缩。二进制压缩仅在BACKUP命令中指定AS COMPRESSED BACKUPSET时启用，或者一次使用配置设备类型[DISK | SBT] BACKUP TYPE TO COMPRESSED BACKUPSET命令。">关于RMAN备份集的二进制压缩</a></p>
                     </li>
                     <li>
                        <p><a href="rman-backup-concepts.html#GUID-1AD870B1-4D49-4056-A7C0-9B10BC3EE005" title="在备份撤消优化中，RMAN排除了恢复备份时不需要的撤销，即已经提交的事务。">关于RMAN备份撤消优化</a></p>
                     </li>
                     <li>
                        <p><a href="rman-backup-concepts.html#GUID-BE9E3C3F-F4A5-439F-8E80-D8CB4C8CC8DF" title="RMAN支持备份集的备份加密。您可以使用基于密钥库的透明加密，基于密码的加密或两者。">关于RMAN备份集的加密</a></p>
                     </li>
                     <li>
                        <p><a href="rman-backup-concepts.html#GUID-B68A34FB-FF89-4C27-AC7C-FDED81C75FD9" title="您可以让RMAN确定备份片段的唯一名称，也可以使用FORMAT子句指定名称。">关于RMAN备份片的文件名</a></p>
                     </li>
                     <li>
                        <p><a href="rman-backup-concepts.html#GUID-DD7E7E32-B0F7-4FA0-91C3-0811610A13D9" title="默认情况下，备份集包含一个备份片。要限制每个备份片的大小，请指定CONFIGURE CHANNEL或ALLOCATE CHANNEL命令的MAXPIECESIZE选项。">关于RMAN备份片的数量和大小</a></p>
                     </li>
                     <li>
                        <p><a href="rman-backup-concepts.html#GUID-5A5E1735-A8D6-4481-BED9-105144E9B39A" title="您可以使用BACKUP命令的backupSpec子句指定要备份的对象。每个backupSpec子句至少生成一个备份集。">关于RMAN备份集的数量和大小</a></p>
                     </li>
                     <li>
                        <p><a href="rman-backup-concepts.html#GUID-6E6613A6-545A-4E65-8D5E-849CB6B91E97" title="创建备份集时，RMAN可以同时从磁盘读取多个文件，然后将其块写入同一备份集。例如，RMAN可以同时读取两个数据文件，然后将这些数据文件中的块组合成一个备份片。来自多个文件的块组合称为备份多路复用。">关于Multiplexed RMAN备份集</a></p>
                     </li>
                     <li>
                        <p><a href="rman-backup-concepts.html#GUID-2F6EBF71-E699-4C9C-832B-9AA8566E3F47" title="在代理副本期间，RMAN将数据传输的控制权转交给支持此功能的媒体管理器。代理副本只能与支持它的媒体管理器一起使用，不能与DISK类型的通道一起使用。 BACKUP命令的PROXY选项指定备份是代理副本。">关于RMAN代理副本</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89480"></a><div class="props_rev_3"><a id="GUID-1C871377-D8A7-4414-B0F0-884403666E8C" name="GUID-1C871377-D8A7-4414-B0F0-884403666E8C"></a><h4 id="BRADV-GUID-1C871377-D8A7-4414-B0F0-884403666E8C" class="sect4"><span class="enumeration_section">8.3.1</span>关于备份集和备份片</h4>
                  <div>
                     <p>RMAN可以将备份数据存储在称为备份集的逻辑结构中，该备份集是RMAN备份的最小单元。</p>
                     <p>备份集包含来自一个或多个数据文件，归档重做日志，控制文件或服务器参数文件的数据。仅通过RMAN创建和访问的备份集是RMAN可以将备份写入磁带驱动器和磁带库等介质管理器的唯一形式。</p>
                     <p>备份集包含一个或多个RMAN特定格式的二进制文件。这些文件中的每一个都称为<a href="glossary.html#GUID-AED62318-D45A-49FA-B4B4-DAD98647FCF6"><span class="xrefglossterm">备份</span></a>文件。备份集可以包含多个数据文件。例如，您可以将10个数据文件备份到由单个备份片组成的单个备份集中。在这种情况下，RMAN会创建一个备份片作为输出。备份集仅包含此备份片。
                     </p>
                     <p>如果在<code class="codeph">BACKUP</code>命令上指定<code class="codeph">SECTION SIZE</code>参数，则RMAN会生成<a href="glossary.html#GUID-6D6DDA5E-F1EF-4273-8649-137F1FC89EB6"><span class="xrefglossterm">多节备份</span></a> 。这是单个大文件的备份，由多个并行通道生成，每个通道生成一个备份片。每个备份片段包含要备份的文件的一个<a href="glossary.html#GUID-FDECFF77-1833-4BD3-A23C-AA4806E28241"><span class="xrefglossterm">文件部分</span></a> 。
                     </p>
                     <p>对于非多节备份，RMAN仅在存储库中记录成功完成的备份集。没有部分备份集这样的东西。这不同于不成功的多节备份，其中RMAN元数据可能包含部分备份集的记录。在后一种情况下，必须使用<code class="codeph">DELETE</code>命令删除部分备份集。
                     </p>
                     <div class="infoboxnote" id="GUID-1C871377-D8A7-4414-B0F0-884403666E8C__GUID-E6714636-A1C2-428D-ACDD-36AA384045F2">
                        <p class="notep1">注意：</p>
                        <p>RMAN从未将部分备份视为还原和恢复的候选者。</p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-1C871377-D8A7-4414-B0F0-884403666E8C__GUID-0AB0FE3D-9617-44F7-ABE0-A21A2180368F">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="backing-up-database.html#GUID-93BAB347-063F-439E-BDF3-109AB8D1F8E7" title="使用BACKUP命令创建RMAN备份。RMAN备份的主要目的是保护您的数据。如果发生介质故障或灾难，则可以还原备份并恢复丢失的更改。您可以使用RMAN客户端中的BACKUP命令备份全部或部分数据库。您可以为BACKUP命令提供参数以覆盖默认备份选项。BACKUP命令采用DEVICE TYPE子句，指定是备份到磁盘还是磁带设备。RMAN可以在磁盘上创建备份作为映像副本或备份集。RMAN提供了一系列选项来命名BACKUP命令生成的文件。备份到磁盘时，您可以指定一种格式以将备份分布在多个驱动器上以提高性能。RMAN将一个称为标记的字符串附加到它创建的每个备份上，作为识别备份的一种方式。您可以接受默认标记，也可以使用BACKUP命令的TAG参数指定自己的标记。用户指定的标记是指示不同类别的备份或副本的用途或用法的有用方法。将TAG参数与BACKUP命令一起使用可指定备份集和映像副本的标记。创建备份集时，可以通过在BACKUP命令中包含AS COMPRESSED BACKUPSET选项，使用RMAN支持对备份集进行二进制压缩。通过多节备份，可以将大型数据文件划分为多个部分，这些部分可以跨多个通道并行备份。这提供了更快的备份性能和更好的恢复时间。在创建映像副本时，RMAN使用多个通道写入文件节。但是，此操作的输出是每个数据文件的一个副本。您可以在装入或打开数据库的情况下执行整个数据库备份。您可以使用BACKUP TABLESPACE命令备份一个或多个表空间，或使用BACKUP DATAFILE命令备份一个或多个数据文件。您可以在装入或打开数据库时备份控制文件。RMAN使用快照控制文件来确保读取一致的版本。控制文件的手动备份与控制文件自动备份不同。在备份BACKUP命令中指定的文件后，RMAN会进行控制文件自动备份。要进行手动备份，可以在备份其他文件时指定INCLUDE CURRENT CONTROLFILE或指定BACKUP CURRENT CONTROLFILE。在某些情况下，RMAN会自动备份当前服务器参数文件。BACKUP SPFILE命令显式备份参数文件。备份的服务器参数文件是实例当前使用的文件。只有在数据库关闭且处于一致状态时，才能以NOARCHIVELOG模式备份数据库。预打印备份确保在将非CDB作为PDB插入CDB后可以使用RMAN备份。使用BACKUP命令备份多租户容器数据库（CDB）和可插拔数据库（PDB）。RMAN和Oracle Enterprise Manager Cloud Control为多租户环境中的备份和恢复提供全面支持。备份整个多租户容器数据库（CDB）类似于备份非CDB。备份整个CDB时，RMAN会备份根，所有可插拔数据库（PDB）和归档重做日志。您可以使用RMAN仅备份根。由于根包含整个CDB的关键元数据，因此Oracle建议您定期备份根或备份整个CDB。Oracle Enterprise Manager云控制（云控制）可用于备份根。RMAN允许您使用BACKUP命令备份CDB中的一个或多个PDB。迁移PDB并将其插入到不同的目标CDB后，PDB的预打印备份可用于执行还原和恢复操作.Oracle Enterprise Manager云控制（云控制）可用于执行可插拔数据库（PDB）的备份。由于不同PDB中的表空间可以具有相同的名称，因此为了消除歧义，您必须直接连接到PDB以备份其一个或多个表空间。此示例创建CDB cdb_prod中包含的PDB my_pdb的预包装备份。CDB使用共享撤消，并在读写模式下打开。RMAN使您可以使用BACKUP命令在应用程序根，一个或多个应用程序PDB和应用程序容器上执行备份操作。RMAN可以备份应用程序容器，应用程序PDB和应用程序根目录。使用RMAN BACKUP命令备份应用程序根目录。使用BACKUP命令备份应用程序容器，该容器由应用程序根目录和属于应用程序根目录的所有应用程序PDB组成。BACKUP命令用于备份一个或多个应用程序PDB。使用BACKUP命令备份稀疏数据库。RMAN使您可以使用备份集或映像副本格式中的备份整个数据库的步骤来备份稀疏数据库。您可以使用BACKUP命令备份包含稀疏数据文件或单个稀疏数据文件的一个或多个表空间。RMAN使您可以备份CDB中的一个或多个稀疏PDB。归档重做日志是成功恢复媒体的关键。你应该定期备份它们。RMAN备份的若干功能特定于归档重做日志。例如，您可以使用BACKUP ...删除以将备份到备份集后从磁盘中删除一个或所有归档重做日志副本。即使您的重做日志存档到多个目标并且您使用RMAN备份存档的重做日志，RMAN也只选择一个存档的重做日志文件副本以包含在备份集中。由于具有相同日志序列号的日志相同，因此RMAN不需要包含多个日志副本。自动在线重做日志切换是一项重要的RMAN功能。在CDB中，只有当您以具有SYSDBA或SYSBACKUP权限的普通用户身份连接到根时，才能备份存档的重做日志。要备份存档日志，请使用BACKUP ARCHIVELOG命令。您可以指示RMAN应自动跳过归档重做日志的备份。您可以使用BACKUP ARCHIVELOG命令备份多租户容器数据库（CDB）中的归档重做日志。BACKUP ARCHIVELOG ......DELETE INPUT命令在备份后删除存档的日志文件。此命令消除了手动删除存档重做日志的单独步骤。在CDB中，您可以使用BACKUP ARCHIVELOG备份后删除存档的重做日志...DELETE INPUT命令。增量备份仅复制自指定的先前备份以来已更改的数据文件块。使用BACKUP命令创建增量备份。RMAN增量备份提供多种好处。根据可接受的MTTR（平均恢复时间）选择备份策略。您可以将卷影复制服务（VSS）与Oracle VSS编写器一起使用，以在数据库中制作卷影副本或文件快照。通过逐步更新备份，可以避免对数据文件进行完整映像副本备份的开销，同时还可以最大限度地减少介质恢复数据库所需的时间。例如，如果您运行每日备份脚本，那么您永远不会有超过1天的重做时间来申请媒体恢复。要创建增量备份以用于增量更新的备份策略，请使用BACKUP ...使用TAG形式的BACKUP命令恢复COPY。在实现策略的示例脚本中最好地理解该命令。增量备份的块更改跟踪功能通过记录每个数据文件的更改块来提高备份性能。如果在主数据库或备用数据库上启用了块更改跟踪，则RMAN使用块更改跟踪文件来标识已更改的块以进行增量备份。通过读取这个小位图文件来确定哪些块发生了变化，RMAN避免了必须扫描它备份的数据文件中的每个块。Oracle数据库自动管理更改跟踪文件中的空间，以保留涵盖最近八个备份的块更改数据。达到最多八个位图后，最旧的位图将被跟踪当前更改的位图覆盖。默认情况下，块更改跟踪文件在DB_CREATE_FILE_DEST初始化参数指定的目标中创建为Oracle托管文件。您还可以通过在启用块更改跟踪时指定其名称，将块更改跟踪文件放在您选择的任何位置。块更改跟踪文件的大小与数据库的大小和重做的已启用线程数成比例。您可以在打开或装入数据库时启用块更改跟踪。禁用块更改跟踪时，数据库将从操作系统中删除块更改跟踪文件。您可以查询V $ BLOCK_CHANGE_TRACKING视图以确定是否启用了更改跟踪，如果是，则确定块更改跟踪文件的文件名。要移动更改跟踪文件，请使用ALTER DATABASE RENAME FILE语句。你可以使用BACKUP ......保持创建既包含所有权又不受备份保留策略限制的备份。通过使用带有BACKUP命令的KEEP选项，可以从保留策略中免除备份。通常，您将归档备份到磁带。由于您的数据保护备份最有可能位于一组仍可访问且可回收的磁带上，因此建议为归档备份保留一组磁带。使用带有KEEP选项的BACKUP命令进行归档备份。归档备份的一个目的是创建测试数据库。您可以使用BACKUP BACKUPSET命令备份其他备份作业生成的备份集。您还可以使用BACKUP RECOVERY AREA备份在当前和所有先前快速恢复区域目标中创建的恢复文件。BACKUP BACKUPSET命令在备份集中创建备份片的其他副本，但不创建新的备份集。对于基于冗余的备份保留策略，备份集将计为备份的一个实例。即使存在构成备份集的备份片的多个副本（例如，备份集已从磁盘备份到磁带），此语句也是如此。使用BACKUP BACKUPSET命令将备份集从磁盘复制到磁带。使用BACKUP命令将映像副本备份到磁带。">备份数据库</a></p>
                     </div>
                  </div>
               </div><a id="BRADV89481"></a><div class="props_rev_3"><a id="GUID-073C85A4-E28C-4FE2-A089-1EABF3D00070" name="GUID-073C85A4-E28C-4FE2-A089-1EABF3D00070"></a><h4 id="BRADV-GUID-073C85A4-E28C-4FE2-A089-1EABF3D00070" class="sect4"><span class="enumeration_section">8.3.2</span>关于备份集的RMAN块压缩</h4>
                  <div>
                     <p>创建备份集时，RMAN可以使用块压缩。</p>
                     <p>可以使用以下类型的块压缩：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>未使用的块压缩（支持磁盘备份和Oracle Secure Backup磁带备份）</p>
                        </li>
                        <li>
                           <p>空块压缩（支持所有备份）</p>
                        </li>
                     </ul>
                     <p>RMAN块压缩不是传统的二进制压缩。相反，它是RMAN用来完全避免备份此备份中不需要的某些块的一组技术。</p>
                  </div><a id="BRADV193"></a><div class="props_rev_3"><a id="GUID-50F8DBCD-C285-491F-B8E7-E1B2140E1B51" name="GUID-50F8DBCD-C285-491F-B8E7-E1B2140E1B51"></a><h5 id="BRADV-GUID-50F8DBCD-C285-491F-B8E7-E1B2140E1B51" class="sect5"><span class="enumeration_section">8.3.2.1</span>关于未使用的块压缩</h5>
                     <div>
                        <p>使用未使用的块压缩时，RMAN会跳过读取和备份当前未分配给某个数据库对象的任何数据库块。这与先前是否已分配这些块无关。</p>
                        <p>因此，如果删除数据库表，RMAN将不会备份该表占用的空间，直到在该空间中创建新对象为止。</p>
                        <p>满足以下条件时，将自动使用未使用的块压缩：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">COMPATIBLE</code>初始化参数设置为10.2或更高。
                              </p>
                           </li>
                           <li>
                              <p>目前没有为数据库定义的保证还原点。</p>
                           </li>
                           <li>
                              <p>数据文件是本地管理的。</p>
                           </li>
                           <li>
                              <p>数据文件作为完整备份或0级增量备份的一部分备份到备份集。</p>
                           </li>
                           <li>
                              <p>备份集在磁盘上创建，或Oracle Secure Backup是媒体管理器。</p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="BRADV192"></a><div class="props_rev_3"><a id="GUID-89D85BBF-C0F2-4393-A1BF-7D6C8D9A6C87" name="GUID-89D85BBF-C0F2-4393-A1BF-7D6C8D9A6C87"></a><h5 id="BRADV-GUID-89D85BBF-C0F2-4393-A1BF-7D6C8D9A6C87" class="sect5"><span class="enumeration_section">8.3.2.2</span>关于空块压缩</h5>
                     <div>
                        <p>当使用空块压缩时，RMAN从其输出中省略任何从未包含数据的块。</p>
                        <p>空块压缩始终与以备份集格式创建的级别0或完全备份一起使用。</p>
                     </div>
                  </div>
               </div><a id="BRADV194"></a><div class="props_rev_3"><a id="GUID-2AFCD551-95CB-4F9F-946E-550E89613974" name="GUID-2AFCD551-95CB-4F9F-946E-550E89613974"></a><h4 id="BRADV-GUID-2AFCD551-95CB-4F9F-946E-550E89613974" class="sect4"><span class="enumeration_section">8.3.3</span>关于RMAN备份集的二进制压缩</h4>
                  <div>
                     <p>RMAN支持备份集的二进制压缩。二进制压缩仅在<code class="codeph">BACKUP</code>命令中指定<code class="codeph">AS COMPRESSED BACKUPSET</code>时启用，或者一次使用<code class="codeph">CONFIGURE DEVICE TYPE [DISK | SBT] BACKUP TYPE TO COMPRESSED BACKUPSET</code>命令。
                     </p>
                     <p>您有两个二进制压缩选项：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您可以使用<code class="codeph">BASIC</code>压缩算法，该算法不需要Oracle Advanced Compression选项。此设置提供与<code class="codeph">MEDIUM</code>相当的压缩比，但会增加CPU消耗。
                           </p>
                        </li>
                        <li>
                           <p>如果已启用Oracle Advanced Compression选项，则可以从<span class="q">“ <a href="configuring-rman-client-advanced.html#GUID-0AA6DB13-ABA9-4BFB-9E42-38DADB9A0B45">关于Oracle Advanced Compression选项</a> ”中</span>概述的压缩级别中进行<span class="q"><a href="configuring-rman-client-advanced.html#GUID-0AA6DB13-ABA9-4BFB-9E42-38DADB9A0B45">选择</a></span> 。
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-2AFCD551-95CB-4F9F-946E-550E89613974__GUID-E9A27EB7-A169-4973-8402-BEBAB927D5AB">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="configuring-rman-client-advanced.html#GUID-3117DA93-EC34-488D-A4FB-29E6CD4D168A" title="RMAN支持预压缩处理和备份集的二进制压缩。CONFIGURE COMPRESSION ALGORITHM命令可以配置压缩选项。">配置压缩选项</a></p>
                           </li>
                           <li>
                              <p><a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a> ，了解<code class="codeph">BACKUP AS BACKUPSET</code>和<code class="codeph">CONFIGURE COMPRESSION ALGORITHM</code></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV417"></a><div class="props_rev_3"><a id="GUID-1AD870B1-4D49-4056-A7C0-9B10BC3EE005" name="GUID-1AD870B1-4D49-4056-A7C0-9B10BC3EE005"></a><h4 id="BRADV-GUID-1AD870B1-4D49-4056-A7C0-9B10BC3EE005" class="sect4"><span class="enumeration_section">8.3.4</span>关于RMAN备份撤消优化</h4>
                  <div>
                     <p>在备份撤消优化中，RMAN排除了恢复备份时不需要的撤销，即已经提交的事务。</p>
                     <p>备份撤消优化适用于磁盘备份和Oracle Secure Backup磁带备份。与<a href="glossary.html#GUID-C75B395F-CA6E-4286-826B-67AABE99606A"><span class="xrefglossterm">备份优化</span></a>不同，备份撤消优化不可配置。
                     </p>
                  </div>
               </div><a id="BRADV89482"></a><div class="props_rev_3"><a id="GUID-BE9E3C3F-F4A5-439F-8E80-D8CB4C8CC8DF" name="GUID-BE9E3C3F-F4A5-439F-8E80-D8CB4C8CC8DF"></a><h4 id="BRADV-GUID-BE9E3C3F-F4A5-439F-8E80-D8CB4C8CC8DF" class="sect4"><span class="enumeration_section">8.3.5</span>关于RMAN备份集的加密</h4>
                  <div>
                     <p>RMAN支持备份集的备份加密。您可以使用基于密钥库的透明加密，基于密码的加密或两者。</p>
                     <p>您可以使用<a href="../rcmrf/CONFIGURE.html#RCMRF113" target="_blank"><code class="codeph">CONFIGURE ENCRYPTION</code></a>命令配置持久透明加密。使用<a href="glossary.html#GUID-01D29658-41E1-4D45-9C7F-A761D56885B9"><span class="xrefglossterm">RMAN会话</span></a>级别的<a href="../rcmrf/SET.html#RCMRF153" target="_blank"><code class="codeph">SET ENCRYPTION</code></a>命令指定基于密码的加密。
                     </p>
                     <div class="infoboxnote" id="GUID-BE9E3C3F-F4A5-439F-8E80-D8CB4C8CC8DF__GUID-C34AC04A-0343-460B-9496-444AC6E04E9A">
                        <p class="notep1">注意：</p>
                        <p>基于密钥库的加密比基于密码的加密更安全，因为不涉及密码。仅在绝对必要时才使用基于密码的加密，因为备份必须是可传输的。</p>
                     </div>
                     <p>要使用RMAN在磁盘上创建加密备份，数据库必须使用高级安全性选项。对于直接加密到磁带的RMAN备份， <a href="glossary.html#GUID-8879C26C-4DF5-4040-BC7A-37CF7C482C56"><span class="xrefglossterm">Oracle Secure Backup</span></a> <a href="glossary.html#GUID-2E48CE71-9547-4196-B715-5CE59033262E"><span class="xrefglossterm">SBT</span></a>是唯一受支持的接口。
                     </p>
                     <div class="infoboxnotealso" id="GUID-BE9E3C3F-F4A5-439F-8E80-D8CB4C8CC8DF__GUID-0F6E14DB-917F-44C9-8075-294A3027AACA">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="configuring-rman-client-advanced.html#GUID-21D5FCCE-7AF1-4CF8-BC53-2496ECE3C56E" title="为了提高安全性，您可以为RMAN备份集配置备份加密。如果未经授权的用户获取加密备份，则无法读取这些备份。">配置备份加密</a></p>
                           </li>
                           <li>
                              <p><a href="backing-up-database-advanced.html#GUID-ECBE4965-57F7-49F0-BECD-734196F417F5" title="您可以使用备份加密保护RMAN备份集。如果未经授权的用户获取加密备份，则无法读取这些备份。">加密RMAN备份</a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV89483"></a><div class="props_rev_3"><a id="GUID-B68A34FB-FF89-4C27-AC7C-FDED81C75FD9" name="GUID-B68A34FB-FF89-4C27-AC7C-FDED81C75FD9"></a><h4 id="BRADV-GUID-B68A34FB-FF89-4C27-AC7C-FDED81C75FD9" class="sect4"><span class="enumeration_section">8.3.6</span>关于RMAN备份片的文件名</h4>
                  <div>
                     <p>您可以让RMAN确定备份片段的唯一名称，也可以使用<code class="codeph">FORMAT</code>子句指定名称。
                     </p>
                     <p>如果未指定<code class="codeph">FORMAT</code>参数，则RMAN会在默认备份位置自动生成具有<code class="codeph">%U</code>替换变量的唯一文件名。
                     </p>
                     <p>RMAN通过<code class="codeph">%U</code>生成SBT备份片名的示例是：</p><pre class="pre codeblock"><code>2i1nk47_1_1</code></pre><p>磁盘上的非Oracle托管文件（OMF）备份片的示例是：</p><pre class="pre codeblock"><code>/备份/ TEST / 2i1nk47_1_1</code></pre><p><code class="codeph">FORMAT</code>子句支持<code class="codeph">%U</code>以外的替换变量来生成唯一文件名。例如，您可以使用<code class="codeph">%d</code>生成数据库的名称，使用<code class="codeph">%I</code>表示DBID，使用<code class="codeph">%t</code>表示时间戳，依此类推。
                     </p>
                     <p>您最多可以指定四个<code class="codeph">FORMAT</code>参数。如果指定多个<code class="codeph">FORMAT</code>参数，则只有在指定多个副本时，RMAN才会使用多个<code class="codeph">FORMAT</code>参数。您可以使用<code class="codeph">BACKUP ...</code>创建多个副本<code class="codeph">BACKUP ...</code><code class="codeph">COPIES</code> ， <a href="../rcmrf/SET.html#RCMRF153" target="_blank"><code class="codeph">SET BACKUP COPIES</code></a>或<a href="../rcmrf/CONFIGURE.html#RCMRF113" target="_blank"><code class="codeph">CONFIGURE ...BACKUP COPIES</code></a>命令。
                     </p>
                     <div class="infoboxnote" id="GUID-B68A34FB-FF89-4C27-AC7C-FDED81C75FD9__GUID-19CC7970-0D5B-4B70-977A-092FC189D732">
                        <p class="notep1">注意：</p>
                        <p>如果使用媒体管理器，请检查供应商文档以了解<code class="codeph">FORMAT</code>限制，例如名称大小，命名约定等。
                        </p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-B68A34FB-FF89-4C27-AC7C-FDED81C75FD9__GUID-68F4AC4E-0297-419C-9E6F-0769116E7081">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="backing-up-database.html#GUID-A733BDFC-8239-4610-8D26-40B6F2D07091" title="RMAN提供了一系列选项来命名BACKUP命令生成的文件。">指定RMAN备份的格式</a></p>
                           </li>
                           <li>
                              <p><a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><span><cite>Oracle数据库备份和恢复参考，</cite></span></a>用于描述<code class="codeph">FORMAT</code>子句和替换变量</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV89484"></a><div class="props_rev_3"><a id="GUID-DD7E7E32-B0F7-4FA0-91C3-0811610A13D9" name="GUID-DD7E7E32-B0F7-4FA0-91C3-0811610A13D9"></a><h4 id="BRADV-GUID-DD7E7E32-B0F7-4FA0-91C3-0811610A13D9" class="sect4"><span class="enumeration_section">8.3.7</span>关于RMAN备份片的数量和大小</h4>
                  <div>
                     <p>默认情况下，备份集包含一个备份片。要限制每个备份片的大小，请指定<code class="codeph">CONFIGURE CHANNEL</code>或<code class="codeph">ALLOCATE CHANNEL</code>命令的<code class="codeph">MAXPIECESIZE</code>选项。
                     </p>
                     <p><code class="codeph">MAXPIECESIZE</code>选项将备份片段大小限制为指定的字节数。如果备份集的总大小大于指定的备份片大小，则RMAN会创建多个物理片段来保存备份集内容。
                     </p>
                     <p>您可以将此选项用于无法管理跨多个磁带的备份片段的媒体管理器。例如，如果磁带可容纳10 GB，但正在创建的备份集必须包含80 GB的数据，则必须指示RMAN创建10 GB的备份片段，小到足以适合与媒体管理器一起使用的磁带。在这种情况下，备份集媒体由八个磁带组成。支持SBT 2.0的媒体管理器可以向RMAN返回一个值，表示RMAN在规划备份活动时使用的最大支持备份片段大小。</p>
                     <p>如果在<code class="codeph">BACKUP</code>命令上指定<code class="codeph">SECTION SIZE</code>参数，则RMAN可以创建<a href="glossary.html#GUID-6D6DDA5E-F1EF-4273-8649-137F1FC89EB6"><span class="xrefglossterm">多节备份</span></a> 。在这种情况下，单个备份集可以包含多个备份片，每个备份片包含一个<a href="glossary.html#GUID-FDECFF77-1833-4BD3-A23C-AA4806E28241"><span class="xrefglossterm">文件节</span></a> 。多节备份的目的是使多个通道能够并行备份大型文件。
                     </p>
                     <div class="infoboxnotealso" id="GUID-DD7E7E32-B0F7-4FA0-91C3-0811610A13D9__GUID-1B03D6AC-4A72-4BC0-AFFB-6B9B9FA1B862">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="configuring-rman-client-advanced.html#GUID-B5C38414-33DD-4A0F-B0FD-B63F1AC74B33" title="当备份片大小超过文件系统或媒体管理软件允许的最大文件大小时，它是一个问题。您可以使用CONFIGURE CHANNEL或ALLOCATE CHANNEL命令的MAXPIECESIZE参数来限制备份片的大小。">配置备份片的最大大小</a></p>
                           </li>
                           <li>
                              <p>适用于<code class="codeph">ALLOCATE</code> <code class="codeph">CHANNEL</code>语法的<a href="../rcmrf/ALLOCATE-CHANNEL.html#RCMRF102" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                           </li>
                           <li>
                              <p><code class="codeph">CONFIGURE</code>语法的<a href="../rcmrf/CONFIGURE.html#RCMRF113" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV89485"></a><div class="props_rev_3"><a id="GUID-5A5E1735-A8D6-4481-BED9-105144E9B39A" name="GUID-5A5E1735-A8D6-4481-BED9-105144E9B39A"></a><h4 id="BRADV-GUID-5A5E1735-A8D6-4481-BED9-105144E9B39A" class="sect4"><span class="enumeration_section">8.3.8</span>关于RMAN备份集的数量和大小</h4>
                  <div>
                     <p>您可以使用<code class="codeph">BACKUP</code>命令的<span class="italic"><code class="codeph">backupSpec</code></span>子句指定要备份的对象。每个<span class="italic"><code class="codeph">backupSpec</code></span>子句至少生成一个备份集。
                     </p>
                     <p>备份集的总数和大小主要取决于内部RMAN算法。但是，您可以使用<code class="codeph">CONFIGURE</code>或<code class="codeph">BACKUP</code>命令中的<code class="codeph">MAXSETSIZE</code>参数来影响RMAN行为。通过限制备份集的大小，该参数间接限制了集中的文件数，并可能强制RMAN创建其他备份集。此外，您可以指定<code class="codeph">BACKUP ...FILESPERSET</code>指定每个备份集中的最大文件数。
                     </p>
                     <div class="infoboxnotealso" id="GUID-5A5E1735-A8D6-4481-BED9-105144E9B39A__GUID-757856C9-A548-4205-9623-BBF1EAE042C5">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="backing-up-database-advanced.html#GUID-04C958FE-A0D3-41A2-B777-73868CDAD4B7" title="BACKUP命令的MAXSETSIZE参数指定备份集的最大大小，以字节（默认），千字节，兆字节或千兆字节为单位。">关于备份集大小</a></p>
                           </li>
                           <li>
                              <p><a href="tuning-rman-performance.html#GUID-33D81037-2310-4021-8039-1A2C579AAA5A" title="RMAN调整的目的是识别给定作业的瓶颈，并使用RMAN命令，初始化参数或对物理介质的调整来提高性能。当RMAN通道从磁盘读取数据时，多个因素会影响性能。在备份期间，RMAN通道将输入文件中的块读入I / O磁盘缓冲区。磁盘子系统上的数据库文件可以由自动存储管理（ASM）或备用卷管理器或文件系统管理。备份调整的注意事项会根据您是否使用ASM管理数据库文件而更改。当通道读取或写入磁盘时，I / O可以是同步I / O或异步I / O.在不支持本机异步I / O的操作系统上，数据库可以使用特殊的I / O从属进程对其进行仿真。这些过程专门用于代表另一个进程执行I / O.您可以使用RATE参数设置读取的字节数的上限，以便RMAN不会消耗过多的磁盘带宽并降低在线性能。从本质上讲，RATE充当备用节流阀。在复制阶段，通道将块从输入缓冲区复制到输出缓冲区并执行其他处理。备份到SBT时，RMAN为媒体管理软件提供字节流，并将唯一名称与此流关联。存储流的方式和位置的所有细节完全由媒体管理器处理。因此，备份到磁带涉及RMAN和媒体管理器的交互。影响SBT写入阶段的RMAN特定因素类似于影响磁盘读取的因素。在这两种情况下，缓冲区分配，从属进程以及同步或异步I / O都会影响性能。多种因素会影响备份到磁带的速度。如果磁带设备是远程的，则介质管理器必须通过网络传输数据。磁带本机传输速率是在没有压缩的情况下写入磁带的速度。此速度表示备份速率的上限。磁带压缩级别对备份性能非常重要。如果磁带具有良好的压缩性，则持续备份速率更快。写入操作期间的磁带流对磁带备份性能有重大影响。物理磁带块大小会影响备份性能。影响磁盘写入阶段的主要因素是缓冲区大小。通常，您可以使用V $视图开始调整过程，以确定RMAN备份和还原操作遇到问题的位置。您可以通过查询视图V $ SESSION_LONGOPS来监视备份和还原作业的进度。 RMAN在V $ SESSION_LONGOPS中使用两种类型的行：详细信息行和聚合行。您可以使用V $ BACKUP_SYNC_IO和V $ BACKUP_ASYNC_IO视图来确定备份或还原瓶颈的来源，并查看备份作业的详细进度。查询V $ BACKUP_SYNC_IO视图以识别具有同步I / O的瓶颈。查询V $ BACKUP_ASYNC_IO以识别异步I / O的瓶颈。许多因素都会影响备份性能。通常，找到缓慢备份的解决方案是一个反复试验的过程。通道上的RATE参数旨在减少而不是增加备份吞吐量，以便为其他数据库操作提供更多磁盘带宽。如果备份未流式传输到磁带，则确认未设置RATE参数。某些操作系统支持本机异步I / O.当且仅当您的磁盘不支持异步I / O时，请设置DBWR_IO_SLAVES。 DBWR_IO_SLAVES的任何非零值都会导致使用固定数量的磁盘I / O从站进行备份和还原，从而模拟异步I / O.如果数据库在警报日志中报告错误，则说明它不是，那么请设置LARGE_POOL_SIZE初始化参数。有足够的内存，无法启动I / O从属。您可以执行多项任务来识别和修复影响备份性能的瓶颈。确定输出设备或输入磁盘I / O是否是给定备份作业的瓶颈的一种可靠方法是将运行备份任务所需的时间与运行相同任务的BACKUP VALIDATE所需的时间进行比较。备份的BACKUP VALIDATE执行与真实备份相同的磁盘读取，但不对输出设备执行I / O.调整读取阶段有助于提高RMAN性能。如果读取阶段表现良好，那么复制或写入阶段可能是瓶颈。特别是，如果RMAN正在以足够快的速度向磁带驱动器发送数据块以支持流式传输，但磁带不是流式传输，那么SBT写入阶段就是瓶颈。">调整RMAN性能</a>以了解RMAN缓冲区管理</p>
                           </li>
                           <li>
                              <p><a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><span><cite>Oracle数据库备份和恢复参考，</cite></span></a>以了解<span class="italic"><code class="codeph">backupSpec</code></span>子句的语法</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV196"></a><a id="BRADV89486"></a><div class="props_rev_3"><a id="GUID-6E6613A6-545A-4E65-8D5E-849CB6B91E97" name="GUID-6E6613A6-545A-4E65-8D5E-849CB6B91E97"></a><h4 id="BRADV-GUID-6E6613A6-545A-4E65-8D5E-849CB6B91E97" class="sect4"><span class="enumeration_section">8.3.9</span>关于多路复用RMAN备份集</h4>
                  <div>
                     <p>创建备份集时，RMAN可以同时从磁盘读取多个文件，然后将其块写入同一备份集。例如，RMAN可以同时读取两个数据文件，然后将这些数据文件中的块组合成一个备份片。来自多个文件的块组合称为备份多路复用。</p>
                     <p>相反，图像副本从不复用。</p>
                     <div class="infoboxnote" id="GUID-6E6613A6-545A-4E65-8D5E-849CB6B91E97__GUID-10CE3FAB-D691-4ECD-9857-11AB637004E5">
                        <p class="notep1">注意：</p>
                        <p>如果RMAN创建数据文件的<a href="glossary.html#GUID-6D6DDA5E-F1EF-4273-8649-137F1FC89EB6"><span class="xrefglossterm">多节备份</span></a> ，则数据文件不会与任何其他数据文件或<a href="glossary.html#GUID-FDECFF77-1833-4BD3-A23C-AA4806E28241"><span class="xrefglossterm">文件节</span></a>复用。
                        </p>
                     </div>
                     <p><a href="rman-backup-concepts.html#GUID-6E6613A6-545A-4E65-8D5E-849CB6B91E97__I1018026">如图8-1</a>所示，RMAN可以将三个数据文件备份到仅包含一个备份片的备份集中。该备份片包含三个输入数据文件的混合数据块。
                     </p>
                     <div class="figure" id="GUID-6E6613A6-545A-4E65-8D5E-849CB6B91E97__I1018026">
                        <p class="titleinfigure">图8-1数据文件复用</p><img src="img/bradv022.gif" alt="下面是图8-1的描述" title="下面是图8-1的描述" longdesc="img_text/bradv022.html"><br><a href="img_text/bradv022.html">“图8-1数据文件复用”的描述</a></div>
                     <!-- class="figure" -->
                     <p>RMAN复用由几个因素决定。例如， <code class="codeph">BACKUP</code>命令的<code class="codeph">FILESPERSET</code>参数确定要在每个备份集中放入多少数据文件。<code class="codeph">ALLOCATE CHANNEL</code>或<code class="codeph">CONFIGURE CHANNEL</code>的<code class="codeph">MAXOPENFILES</code>参数定义了RMAN可以同时读取的数据文件数量。基本的复用算法如下：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>每个备份集中的文件数</p>
                           <p>此数字是<code class="codeph">FILESPERSET</code>设置的最小值和每个通道读取的文件数。<code class="codeph">FILESPERSET</code>默认值为64。
                           </p>
                        </li>
                        <li>
                           <p><a href="glossary.html#GUID-648D7B2D-7AB2-40C0-AFFD-0A6FE569F3D7"><span class="xrefglossterm">多路复用的程度</span></a></p>
                           <p>这是同时读取然后写入同一备份片段的输入文件数。多路复用级别是<code class="codeph">MAXOPENFILES</code>的最小值和每个备份集中的文件数。<code class="codeph">MAXOPENFILES</code>默认值为8。
                           </p>
                        </li>
                     </ul>
                     <p>假设当<code class="codeph">FILEPERSET</code>设置为4时，您使用一个通道备份12个数据文件。多路复用级别是这个数字中较小的一个，8。因此，通道同时将来自4个数据文件的块写入每个备份片。
                     </p>
                     <p>现在假设您使用一个通道备份50个数据文件。每个备份集中的文件数为50。多路复用级别是这个数字中较小的一个，8。因此，通道同时将来自8个数据文件的块写入每个备份片。</p>
                     <p>备份集的RMAN复用与<a href="glossary.html#GUID-C40B78A9-99C9-4B49-85D0-8174FD1E271B"><span class="xrefglossterm">媒体管理器复用</span></a>不同。当媒体管理器将来自多个RMAN信道的并发输出写入单个顺序设备时，发生一种类型的媒体管理器复用。当备份在同一磁带上混合数据库文件和非数据库文件时，会出现另一种类型。
                     </p>
                     <div class="infoboxnote" id="GUID-6E6613A6-545A-4E65-8D5E-849CB6B91E97__GUID-E4DAF1D6-C569-4440-A486-DEBA713A4C37">
                        <p class="notep1">注意：</p>
                        <p>Oracle建议您永远不要将介质管理器多路复用用于RMAN备份。</p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-6E6613A6-545A-4E65-8D5E-849CB6B91E97__GUID-23DF9C1B-2AA3-460D-834F-D14D63550319">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="tuning-rman-performance.html#GUID-59FBFBBE-78F0-4035-8FAC-818DB539576B" title="在备份期间，RMAN通道将输入文件中的块读入I / O磁盘缓冲区。磁盘子系统上的数据库文件可以由自动存储管理（ASM）或备用卷管理器或文件系统管理。备份调整的注意事项会根据您是否使用ASM管理数据库文件而更改。">分配输入磁盘缓冲区</a>以了解多路复用如何影响备份期间磁盘缓冲区的分配</p>
                           </li>
                           <li>
                              <p>用于<code class="codeph">BACKUP</code>语法的<a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV89487"></a><div class="props_rev_3"><a id="GUID-2F6EBF71-E699-4C9C-832B-9AA8566E3F47" name="GUID-2F6EBF71-E699-4C9C-832B-9AA8566E3F47"></a><h4 id="BRADV-GUID-2F6EBF71-E699-4C9C-832B-9AA8566E3F47" class="sect4"><span class="enumeration_section">8.3.10</span>关于RMAN代理副本</h4>
                  <div>
                     <p>在代理副本期间，RMAN将数据传输的控制权转交给支持此功能的媒体管理器。代理副本只能与支持它的媒体管理器一起使用，不能与<code class="codeph">DISK</code>类型的通道一起使用。 <code class="codeph">BACKUP</code>命令的<code class="codeph">PROXY</code>选项指定备份是代理副本。
                     </p>
                     <p>对于您尝试使用<code class="codeph">BACKUP</code> <code class="codeph">PROXY</code>命令进行<code class="codeph">BACKUP</code>每个文件，RMAN会查询媒体管理器以确定它是否可以执行代理副本。如果媒体管理器无法代理复制文件，则RMAN将备份该文件，就像未使用<code class="codeph">PROXY</code>选项一样。（如果无法执行代理副本，请使用<code class="codeph">PROXY</code> <code class="codeph">ONLY</code>选项强制RMAN失败。）
                     </p>
                     <p>永远不会使用代理副本备份控制文件。如果在备份控制文件的操作上指定了<code class="codeph">PROXY</code>选项，则会以静默方式忽略该选项以备份控制文件。
                     </p>
                     <div class="infoboxnotealso" id="GUID-2F6EBF71-E699-4C9C-832B-9AA8566E3F47__GUID-53D434D4-1052-40A7-9D65-D21EC89FFF83">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关<code class="codeph">V$PROXY_DATAFILE</code>视图的更多信息，请<a href="../refrn/V-PROXY_DATAFILE.html#REFRN30188" target="_blank"><span><cite>参见Oracle数据库参考</cite></span></a></p>
                           </li>
                           <li>
                              <p>有关<code class="codeph">V$PROXY_ARCHIVEDLOG</code>视图的更多信息，请<a href="../refrn/V-PROXY_ARCHIVEDLOG.html#REFRN30187" target="_blank"><span><cite>参见Oracle数据库参考</cite></span></a></p>
                           </li>
                           <li>
                              <p>用于<code class="codeph">BACKUP</code>命令和<code class="codeph">PROXY</code>选项的<a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV89488"></a><div class="props_rev_3"><a id="GUID-3580BA12-463A-4A61-939D-58C51E81FF12" name="GUID-3580BA12-463A-4A61-939D-58C51E81FF12"></a><h3 id="BRADV-GUID-3580BA12-463A-4A61-939D-58C51E81FF12" class="sect3"><span class="enumeration_section">8.4</span>关于RMAN映像副本</h3>
               <div>
                  <p>映像副本是单个数据文件，归档重做日志文件或控制文件的精确副本。</p>
                  <p>图像副本不以RMAN特定格式存储。它们与使用操作系统命令复制文件的结果相同。RMAN可以在RMAN还原和恢复操作期间使用映像副本，还可以使用具有非RMAN还原和恢复技术的映像副本。</p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="rman-backup-concepts.html#GUID-D73BDDC7-A4AC-40A2-B279-1A764A51EBC4" title="要创建映像副本并将其记录在RMAN存储库中，请运行RMAN BACKUP AS COPY命令。">关于RMAN创建的映像副本</a></p>
                     </li>
                     <li>
                        <p><a href="rman-backup-concepts.html#GUID-C0BD0706-29EF-44C6-AF53-401522B4BDD0" title="RMAN可以使用由RMAN外部的机制创建的映像副本，例如本机操作系统文件复制命令或将文件的映像副本保留在磁盘上的第三方实用程序。此类副本称为用户管理的备份或操作系统备份。">关于用户管理的映像副本</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV197"></a><a id="BRADV89489"></a><div class="props_rev_3"><a id="GUID-D73BDDC7-A4AC-40A2-B279-1A764A51EBC4" name="GUID-D73BDDC7-A4AC-40A2-B279-1A764A51EBC4"></a><h4 id="BRADV-GUID-D73BDDC7-A4AC-40A2-B279-1A764A51EBC4" class="sect4"><span class="enumeration_section">8.4.1</span>关于RMAN创建的映像副本</h4>
                  <div>
                     <p>要创建映像副本并将其记录在RMAN存储库中，请运行RMAN <code class="codeph">BACKUP</code> <code class="codeph">AS</code> <code class="codeph">COPY</code>命令。
                     </p>
                     <p>或者，您可以将磁盘的默认备份类型配置为映像副本。数据库服务器会话用于创建副本。服务器会话还执行诸如验证文件中的块并将映像副本记录在RMAN存储库中的操作。</p>
                     <p>与备份片段一样， <a href="../rcmrf/formatSpec.html#RCMRF195" target="_blank"><code class="codeph">FORMAT</code></a>变量用于指定图像副本的名称。默认格式<code class="codeph">%U</code> （在<span class="q">“ <a href="rman-backup-concepts.html#GUID-B68A34FB-FF89-4C27-AC7C-FDED81C75FD9" title="您可以让RMAN确定备份片段的唯一名称，也可以使用FORMAT子句指定名称。">关于RMAN备份片段的文件名</a> ”</span>中进行了说明）对图像副本的定义不同。以下示例显示<code class="codeph">%U</code>生成的数据文件<code class="codeph">2</code>的名称：</p><pre class="pre codeblock"><code>/d1/oracle/work/orcva/RDBMS/datafile/o1_mf_sysaux_2qylngm3_.dbf</code></pre><p>创建映像副本时，还可以使用<code class="codeph">BACKUP</code>命令的<code class="codeph">DB_FILE_NAME_CONVERT</code>参数命名输出副本。此参数与<a href="../refrn/DB_FILE_NAME_CONVERT.html#REFRN10038" target="_blank"><code class="codeph">DB_FILE_NAME_CONVERT</code></a>初始化参数的工作方式相同。提供成对的文件名前缀以更改输出文件的名称。如果文件未被任何对转换，则RMAN使用<code class="codeph">FORMAT</code>规范：如果未指定<code class="codeph">FORMAT</code> ，则RMAN使用默认格式<code class="codeph">%U</code> 。</p>
                     <div class="example" id="GUID-D73BDDC7-A4AC-40A2-B279-1A764A51EBC4__CHDFBHHA">
                        <p class="titleinexample">示例8-1使用DB_FILE_NAME_CONVERT指定文件名</p>
                        <p>此示例复制其文件名以<code class="codeph">/maindisk/oradata/users</code>为前缀的数据文件，以便它们以<code class="codeph">/backups/users_ts</code>为前缀。
                        </p><pre class="pre codeblock"><code>BACKUP AS COPY DB_FILE_NAME_CONVERT（'/ maindisk / oradata / users'，'/ backups / users_ts'）TABLESPACE用户;</code></pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <p>如果运行<code class="codeph">RESTORE</code>命令，则默认情况下，RMAN会将映像副本备份复制到该位置，从而将数据文件或控制文件还原到其原始位置。由于在搜索要恢复的文件时读取整个备份集的额外开销，因此在备份集上选择映像副本。
                        </p>
                        <p>如果必须还原和恢复当前数据文件，并且磁盘上有可用的映像副本，则无需将映像副本RMAN复制回其旧位置。相反，您可以使用映像副本作为要还原的数据文件的替代。 <span class="q">“ <a href="rman-complete-database-recovery.html#GUID-19A07A76-AE1E-41EE-8B7D-7C4EF1FD3137" title="您可以通过切换到无法访问的数据文件的映像副本来恢复数据库。这种技术比传统的恢复和恢复花费的时间更少，因为不需要恢复备份。">切换到副本后执行完全恢复</a> ”</span>说明了如何执行此任务。
                        </p>
                        <div class="infoboxnotealso" id="GUID-D73BDDC7-A4AC-40A2-B279-1A764A51EBC4__GUID-4B1FF3CA-8C95-42D6-9849-ED5D8E2A449C">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="configuring-rman-client-basic.html#GUID-BC37B3E4-3338-4452-A363-DB882F2E9415" title="BACKUP命令可以创建备份集或映像副本。对于磁盘，您可以使用CONFIGURE DEVICE TYPE DISK BACKUP TYPE TO命令将RMAN配置为创建备份集或映像副本作为其默认备份类型。">配置备份的默认类型：备份集或副本</a>以了解如何使备份集或映像副本成为默认类型的RMAN备份</p>
                              </li>
                              <li>
                                 <p><a href="backing-up-database.html#GUID-030BA0C5-832E-42A1-A63A-5E2D768BABB9" title="RMAN可以在磁盘上创建备份作为映像副本或备份集。">为RMAN备份指定备份集或复制到磁盘</a></p>
                              </li>
                              <li>
                                 <p><a href="../rcmrf/formatSpec.html#RCMRF195" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a> ，了解图像副本的<code class="codeph">%U</code>含义</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89490"></a><div class="props_rev_3"><a id="GUID-C0BD0706-29EF-44C6-AF53-401522B4BDD0" name="GUID-C0BD0706-29EF-44C6-AF53-401522B4BDD0"></a><h4 id="BRADV-GUID-C0BD0706-29EF-44C6-AF53-401522B4BDD0" class="sect4"><span class="enumeration_section">8.4.2</span>关于用户管理的映像副本</h4>
                  <div>
                     <p>RMAN可以使用由RMAN外部的机制创建的映像副本，例如本机操作系统文件复制命令或将文件的映像副本保留在磁盘上的第三方实用程序。此类副本称为用户管理的备份或操作系统备份。</p>
                     <p>您可以使用<a href="../rcmrf/CATALOG.html#RCMRF109" target="_blank"><code class="codeph">CATALOG</code></a>命令检查现有映像副本，并将其元数据输入RMAN存储库。但是， <code class="codeph">CATALOG</code>命令不执行以下操作：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>读取数据文件副本中的所有块以确保没有损坏</p>
                        </li>
                        <li>
                           <p>保证在<a href="glossary.html#GUID-BD2A12D3-A995-49B8-AE99-B8DDDF4FE7E7"><span class="xrefglossterm">备份模式下</span></a>正确进行映像复制</p>
                        </li>
                     </ul>
                     <p>对这些文件进行编目后，可以像使用RMAN生成的映像副本一样将它们与<a href="../rcmrf/RESTORE.html#RCMRF149" target="_blank"><code class="codeph">RESTORE</code></a>或<a href="../rcmrf/SWITCH.html#RCMRF159" target="_blank"><code class="codeph">SWITCH</code></a>命令一起使用。
                     </p>
                     <p>某些站点将其数据文件存储在镜像磁盘卷上，这允许通过<a href="glossary.html#GUID-4810DFC7-CC25-4CD9-8D04-79EE7DAF061D"><span class="xrefglossterm">断开镜像来</span></a>创建映像副本。在破坏镜像后，您可以通知RMAN存在新的用户管理副本，从而使其有资格进行备份。使用<a href="../rcmrf/CHANGE.html#RCMRF110" target="_blank"><code class="codeph">CHANGE</code></a>时，您必须在副本不再可用时通知RMAN <code class="codeph">...</code> <code class="codeph">UNCATALOG</code>命令。
                     </p>
                     <div class="infoboxnotealso" id="GUID-C0BD0706-29EF-44C6-AF53-401522B4BDD0__GUID-CAA82815-C2C1-43AC-800B-90579187BAA2">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="user-managed-database-backups.html#GUID-2193FAD0-F62C-4671-9272-55E8BD7367DC">进行用户管理的数据库备份</a></p>
                           </li>
                           <li>
                              <p><a href="maintaining-rman-backups.html#GUID-3FC88C14-C9CC-445D-8922-C92659004FA4" title="您可以使用CATALOG命令使RMAN知道存储库中未记录的存档日志的存在，或者通过RMAN以外的方式创建的数据库文件的副本。">将备份记录添加到RMAN存储库</a>以了解如何编目数据文件和存档日志映像副本</p>
                           </li>
                           <li>
                              <p><a href="backing-up-database-advanced.html#GUID-EEA8D192-E7CD-4457-A0E3-5062EA2E8D0C" title="许多站点保留存储在磁盘上的数据库的备份，以防主数据库发生介质故障或不正确的用户操作需要时间点恢复。磁盘上的数据文件备份简化了恢复的恢复步骤，使恢复更加快速和可靠。">使用RMAN进行分割镜像备份</a></p>
                           </li>
                           <li>
                              <p>适用于<code class="codeph">CHANGE</code>语法的<a href="../rcmrf/CHANGE.html#RCMRF110" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-D0AEBAF2-FDEA-4977-9B4D-97759A1CA865" name="GUID-D0AEBAF2-FDEA-4977-9B4D-97759A1CA865"></a><h3 id="BRADV-GUID-D0AEBAF2-FDEA-4977-9B4D-97759A1CA865" class="sect3"><span class="enumeration_section">8.5</span>关于稀疏备份</h3>
               <div>
                  <p>您可以使用RMAN <code class="codeph">BACKUP</code>命令从稀疏数据文件，包含稀疏数据文件的表空间，稀疏可插拔数据库（PDB）和包含稀疏PDB的多租户容器数据库（CDB）备份数据块。
                  </p>
                  <p>稀疏数据文件是一个逻辑Oracle对象，它创建为基础数据文件对象的阴影，并存储在称为增量空间的物理存储空间中。例如，考虑从基础数据库<code class="codeph">DB</code>创建的稀疏数据库<code class="codeph">DB0</code> 。在稀疏环境中，基础对象必须是只读的。与基础数据库不同，稀疏数据库是读写数据库。在这种情况下， <code class="codeph">DB</code>是一个只读数据库，由5个数据文件组成。<code class="codeph">DB0</code>重新创建这5个基本数据文件中每个文件的逻辑版本，并为每个单独的文件分配单独的增量存储空间。当稀疏数据库<code class="codeph">DB0</code>更新稀疏数据文件之一中的数据块时，仅将更新的块逻辑地存储在该修改的数据文件的增量空间中。当您选择在<code class="codeph">DB0</code>上执行稀疏备份时，操作将仅从数据库的增量存储空间和稀疏数据文件的增量空间复制数据。稀疏备份可以是备份集格式（默认）或映像副本格式。RMAN从稀疏备份还原稀疏数据文件，然后从归档和重做日志中恢复它们。您可以对稀疏数据文件执行完整或时间点恢复。
                  </p>
                  <p>要执行稀疏备份和恢复操作，数据库必须将<code class="codeph">COMPATIBLE</code>初始化参数设置为12.2或更高。
                  </p>
                  <p>如果数据库的<code class="codeph">COMPATIBLE</code>初始化参数为12.2，并且您对非稀疏（正常）数据文件执行完全或0级增量备份，则RMAN会对指定的数据文件执行传统的完全备份或0级增量备份。另一方面，如果在稀疏数据文件上执行完全或0级增量备份，则RMAN仅对该特定数据文件的增量存储空间中的所有最新更改执行备份。
                  </p>
                  <p>对于<code class="codeph">COMPATIBLE</code>初始化参数小于12.2的数据库，RMAN继续像以前一样执行备份和恢复操作，不受数据文件稀疏性的影响。
                  </p>
                  <p>稀疏备份有助于有效管理存储空间，并有助于加快备份和恢复速度。</p>
                  <div class="infoboxnote" id="GUID-D0AEBAF2-FDEA-4977-9B4D-97759A1CA865__GUID-32B516C4-6C90-49D5-8C04-E9AAC0D767DB">
                     <p class="notep1">注意：</p>
                     <p>稀疏数据库中的基本（只读）数据文件未加密。确保基础数据文件存储在受保护的存储中，并使用安全通信进行访问。</p>
                  </div>
                  <div class="infoboxnotealso" id="GUID-D0AEBAF2-FDEA-4977-9B4D-97759A1CA865__GUID-5B10FB60-6A45-45BE-B3AF-33B7B34F112C">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="backing-up-database.html#GUID-17F2020E-9C9B-4D1C-BC60-A09C3A87CF55" title="使用BACKUP命令备份稀疏数据库。">使用RMAN备份稀疏数据库</a></p>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-7D69CBCA-123F-49FF-85E9-F5C70E47202D" name="GUID-7D69CBCA-123F-49FF-85E9-F5C70E47202D"></a><h3 id="BRADV-GUID-7D69CBCA-123F-49FF-85E9-F5C70E47202D" class="sect3"><span class="enumeration_section">8.6</span>关于预备份备份</h3>
               <div>
                  <p>预包装备份是在非CDB或PDB插入其他CDB之前创建的非CDB或PDB的RMAN备份。</p>
                  <p></p>
                  <p>插入非CDB或PDB的CDB称为目标CDB。预刷新备份可用于目标CDB中的PDB还原和恢复操作。要执行介质恢复，所有必需的归档重做日志都必须包含在预刷新备份中。</p>
                  <p>要使预涂层备份在目标CDB中可用，必须将有关预涂层备份的元数据导出到目标CDB的RMAN存储库。从源CDB拔出PDB时，所需的元数据存储在拔出操作期间创建的XML文件中。对于非CDB，使用<code class="codeph">DBMS_PDB.EXPORTRMANBACKUP()</code>过程将在目标CDB中可用的预备份备份所需的元数据添加到非CDB的数据字典中。
                  </p>
                  <p>预填充备份仅可用于插入源非CDB或PDB的目标CDB。例如，假设您将PDB从CDB <code class="codeph">src_cdb</code>迁移到CDB <code class="codeph">stage_cdb</code> 。随后，将源PDB从CDB <code class="codeph">stage_cdb</code>到CDB <code class="codeph">prod_cdb</code> 。CDB <code class="codeph">src_pdb</code>可以访问在CDB <code class="codeph">stage_pdb</code>上创建的PDB备份。然而，CDB <code class="codeph">prod_cdb</code>只能访问在CDB创建的PDB备份<code class="codeph">stage_cdb</code> ，而不是在CDB创建的PDB备份<code class="codeph">src_cdb</code> 。
                  </p>
                  <div class="infoboxnotealso" id="GUID-7D69CBCA-123F-49FF-85E9-F5C70E47202D__GUID-24EF611B-FF85-458E-ABCF-237CF477990E">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="backing-up-database.html#GUID-E5A3E523-C55C-4666-8334-81E7A224371B" title="在PDB迁移并插入到其他目标CDB之后，PDB的预刷新备份可用于执行还原和恢复操作。">使用RMAN创建PDB的预刷新备份</a></p>
                        </li>
                        <li>
                           <p><a href="backing-up-database.html#GUID-7F9F8913-2838-4066-A000-048B35A70EA4" title="预打印备份确保在将非CDB作为PDB插入CDB后可以使用RMAN备份。">创建整个数据库的预刷新备份</a></p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="BRADV107"></a><div class="props_rev_3"><a id="GUID-763A9C75-90A5-48FD-9CB6-707D030A00F5" name="GUID-763A9C75-90A5-48FD-9CB6-707D030A00F5"></a><h3 id="BRADV-GUID-763A9C75-90A5-48FD-9CB6-707D030A00F5" class="sect3"><span class="enumeration_section">8.7</span>关于RMAN备份的多个副本</h3>
               <div>
                  <p>RMAN使您可以创建多个相同的备份副本。</p>
                  <p>使用以下方法之一：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>使用<code class="codeph">BACKUP</code>双工备份<code class="codeph">...COPIES</code>命令，在这种情况下，RMAN会为每个备份集创建多个副本</p>
                        <p>请参见<a href="rman-backup-concepts.html#GUID-7BDEDD51-33B0-4B95-8D62-B11C225C490A">关于双工备份集</a> 。
                        </p>
                     </li>
                     <li>
                        <p>将文件备份为备份集或映像副本，然后使用RMAN <code class="codeph">BACKUP</code> <code class="codeph">BACKUPSET</code>或<code class="codeph">BACKUP</code> <code class="codeph">COPY OF</code>命令备份备份集或映像副本</p>
                        <p>请参阅<a href="rman-backup-concepts.html#GUID-3F8EDAFC-8A29-4E7B-BFEC-087AE10EDC91" title="RMAN BACKUP BACKUPSET命令备份在磁盘上创建的备份集。该命令是在多个媒体之间传播备份的有用方法。">关于RMAN备份的备份</a> 。
                        </p>
                     </li>
                  </ul>
               </div><a id="BRADV89491"></a><div class="props_rev_3"><a id="GUID-7BDEDD51-33B0-4B95-8D62-B11C225C490A" name="GUID-7BDEDD51-33B0-4B95-8D62-B11C225C490A"></a><h4 id="BRADV-GUID-7BDEDD51-33B0-4B95-8D62-B11C225C490A" class="sect4"><span class="enumeration_section">8.7.1</span>关于双工备份集</h4>
                  <div>
                     <p><a id="d36784e3646" class="indexterm-anchor"></a><a id="d36784e3648" class="indexterm-anchor"></a>将数据文件，归档重做日志文件，服务器参数文件和控制文件备份到备份片段时，RMAN可以创建<a href="glossary.html#GUID-614D6594-1A1A-46EE-A041-312ADAB7E151"><span class="xrefglossterm">双工备份集</span></a> ，在不同备份目标的备份集中为每个备份片创建最多四个相同的副本，其中一个<code class="codeph">BACKUP</code>命令。生成映像副本的备份操作不支持双工。
                     </p>
                     <p>您可以在<code class="codeph">CONFIGURE</code> ， <code class="codeph">SET</code>或中使用<code class="codeph">COPIES</code>参数<a id="d36784e3673" class="indexterm-anchor"></a><a id="d36784e3677" class="indexterm-anchor"></a> <code class="codeph">BACKUP</code>命令用于在使用<code class="codeph">BACKUP</code>命令时指定备份集的双工。RMAN可以将备份双工复制到磁盘或磁带，但不能同时将备份复制到磁带和磁盘。备份到磁带时，请确保副本数量不超过可用磁带设备的数量。
                     </p>
                     <p><a id="d36784e3690" class="indexterm-anchor"></a><a id="d36784e3694" class="indexterm-anchor"></a> <code class="codeph">BACKUP</code>命令的<code class="codeph">FORMAT</code>参数指定双工备份的目标。以下示例创建数据文件7备份的三个副本：</p><pre class="oac_no_warn" dir="ltr">备份设备类型磁盘副本3数据文件7格式'/ disk1 /％U'，'？/ ORADATA /％U ''？/％U';</pre><p>RMAN将每个备份片的第一个副本放在<code class="codeph">/disk1</code> ，第二个放在<code class="codeph">?/oradata</code> ，以及Oracle主页中的第三个。RMAN不会生成三个备份集，每个备份集具有不同的唯一备份集密钥。相反，RMAN生成一个具有唯一键的备份集，并为该集中的每个备份片生成三个相同的副本。
                     </p>
                     <div class="infoboxnotealso" id="GUID-7BDEDD51-33B0-4B95-8D62-B11C225C490A__GUID-E86A1E9C-6391-414B-B664-6785ED7B1BDB">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="configuring-rman-client-advanced.html#GUID-2A285F87-552A-4F36-A5B9-F25A69611B4B" title="使用配置...BACKUP COPIES命令指定在指定类型的文件的指定设备类型上创建每个备份片的副本数。此类备份称为双工备份集。">配置备份双工</a> ”</span></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="backing-up-database-advanced.html#GUID-4CFE9BA0-E298-42B8-9FB6-D36751C09D54" title="RMAN最多可以同时备份四个备份集，每个副本与其他备份集完全相同。">双工备份集</a> ”</span></p>
                           </li>
                           <li>
                              <p><code class="codeph">CONFIGURE</code>语法的<a href="../rcmrf/CONFIGURE.html#RCMRF113" target="_blank"><span class="italic">Oracle数据库备份和恢复参考</span></a></p>
                           </li>
                           <li>
                              <p>用于<code class="codeph">SET</code>语法的<a href="../rcmrf/SET.html#RCMRF153" target="_blank"><span class="italic">Oracle数据库备份和恢复参考</span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV89492"></a><div class="props_rev_3"><a id="GUID-3F8EDAFC-8A29-4E7B-BFEC-087AE10EDC91" name="GUID-3F8EDAFC-8A29-4E7B-BFEC-087AE10EDC91"></a><h4 id="BRADV-GUID-3F8EDAFC-8A29-4E7B-BFEC-087AE10EDC91" class="sect4"><span class="enumeration_section">8.7.2</span>关于RMAN备份的备份</h4>
                  <div>
                     <p>您可以使用<code class="codeph">BACKUP</code>命令备份现有备份集和映像副本。备份现有备份使您可以创建多个相同的RMAN备份副本。
                     </p>
                     <p>以下部分提供有关创建备份备份方法的详细信息：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="rman-backup-concepts.html#GUID-27161367-1F36-403A-9862-F7C69DA24642" title="RMAN BACKUP BACKUPSET命令备份在磁盘上创建的备份集。该命令是在多个媒体之间传播备份的有用方法。">备份集的备份</a></p>
                        </li>
                        <li>
                           <p><a href="rman-backup-concepts.html#GUID-FEBF71D7-0FD8-4BB4-8B71-6485165C8C01">备份图像副本</a></p>
                        </li>
                     </ul>
                  </div><a id="BRADV607"></a><a id="BRADV203"></a><a id="BRADV89493"></a><div class="props_rev_3"><a id="GUID-27161367-1F36-403A-9862-F7C69DA24642" name="GUID-27161367-1F36-403A-9862-F7C69DA24642"></a><h5 id="BRADV-GUID-27161367-1F36-403A-9862-F7C69DA24642" class="sect5"><span class="enumeration_section">8.7.2.1</span>备份集的备份</h5>
                     <div>
                        <p>RMAN <code class="codeph">BACKUP BACKUPSET</code>命令备份在磁盘上创建的备份集。该命令是在多个媒体之间传播备份的有用方法。
                        </p>
                        <p>如果RMAN发现备份集的一个副本已损坏或丢失，则它会搜索同一备份集的其他副本。此行为类似于备份存在于多个归档目标中的归档重做日志时RMAN的行为。</p>
                        <p>从Oracle Database Release 18c开始，在备份备份集时，您可以使用<code class="codeph">BACKUP AS COMPRESSED BACKUPSET</code>命令压缩先前未压缩的备份集。
                        </p>
                        <p>RMAN使您可以创建未加密备份集的加密备份。在备份未加密的备份集之前，请使用<code class="codeph">SET ENCRYPTION FOR DATABASE ON</code>命令启用加密。请注意， <code class="codeph">SET</code>命令启用当前RMAN会话的加密。如果后续操作不需要加密，则关闭数据库的加密。
                        </p>
                        <div class="example" id="GUID-27161367-1F36-403A-9862-F7C69DA24642__CHDHGCFI">
                           <p class="titleinexample">示例8-2将备份集备份到磁带</p>
                           <p>此示例显示了如何每周运行<code class="codeph">BACKUP</code>命令作为生产备份计划的一部分。这样，您可以确保磁盘和磁带上都存在所有备份。
                           </p><pre class="oac_no_warn" dir="ltr">备份设备类型磁盘作为BACKUPSET DATABASE PLUS ARCHIVELOG;备份设备类型sbt BACKUPSET ALL; ＃将磁盘上的备份集复制到磁带上</pre><div class="infoboxnote" id="GUID-27161367-1F36-403A-9862-F7C69DA24642__GUID-4A312AF8-5FB7-44B5-A2C4-63CD32486337">
                              <p class="notep1">注意：</p>
                              <p>备份到使用自动通道的<code class="codeph">sbt</code>要求您首先运行<code class="codeph">CONFIGURE</code> <code class="codeph">DEVICE</code> <code class="codeph">TYPE</code> <code class="codeph">sbt</code>命令。
                              </p>
                           </div>
                        </div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-27161367-1F36-403A-9862-F7C69DA24642__CHDFIGIE">
                           <p class="titleinexample">示例8-3管理空间分配</p>
                           <p>您还可以使用<code class="codeph">BACKUP</code> <code class="codeph">BACKUPSET</code>来管理备份空间分配。此示例备份一周以前从磁盘到磁带创建的备份集，然后从磁盘中删除它们。
                           </p><pre class="oac_no_warn" dir="ltr">备份设备类型sbt BACKUPSET在'SYSDATE-7'之前完成删除输入;</pre><p>此处的<code class="codeph">DELETE</code> <code class="codeph">INPUT</code>等效于<code class="codeph">DELETE</code> <code class="codeph">ALL</code> <code class="codeph">INPUT</code> ：RMAN删除备份集的所有现有副本。如果将备份双工复制到四个位置，则RMAN将删除备份集中所有四个副本。
                           </p>
                           <div class="infoboxnotealso" id="GUID-27161367-1F36-403A-9862-F7C69DA24642__GUID-A8948460-5FB1-41A4-9C8D-57660ACBF89F">
                              <p class="notep1">也可以看看：</p>
                              <p><span class="q">“ <a href="backing-up-database.html#GUID-731ADA67-235E-481D-AC17-9F9067AD55BF" title="您可以使用BACKUP BACKUPSET命令备份其他备份作业生成的备份集。您还可以使用BACKUP RECOVERY AREA备份在当前和所有先前快速恢复区域目标中创建的恢复文件。BACKUP BACKUPSET命令在备份集中创建备份片的其他副本，但不创建新的备份集。对于基于冗余的备份保留策略，备份集将计为备份的一个实例。即使存在构成备份集的备份片的多个副本（例如，备份集已从磁盘备份到磁带），此语句也是如此。使用BACKUP BACKUPSET命令将备份集从磁盘复制到磁带。使用BACKUP命令将映像副本备份到磁带。">备份RMAN备份</a> ”</span></p>
                           </div>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="BRADV89494"></a><div class="props_rev_3"><a id="GUID-FEBF71D7-0FD8-4BB4-8B71-6485165C8C01" name="GUID-FEBF71D7-0FD8-4BB4-8B71-6485165C8C01"></a><h5 id="BRADV-GUID-FEBF71D7-0FD8-4BB4-8B71-6485165C8C01" class="sect5"><span class="enumeration_section">8.7.2.2</span>映像副本的备份</h5>
                     <div>
                        <p><a id="d36784e4125" class="indexterm-anchor"></a><a id="d36784e4129" class="indexterm-anchor"></a>您可以使用<code class="codeph">BACKUP COPY OF</code>命令将数据库文件的现有映像副本备份为备份集或映像副本。使用此命令时，必须存在命令中指定的每个数据文件的映像副本。如果有多个数据文件副本，则使用最新的副本。如果指定表空间或整个数据库，则如果数据库或表空间中没有映像副本备份的数据文件，则RMAN会发出错误。
                        </p>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV111"></a><div class="props_rev_3"><a id="GUID-95840C84-1595-49AC-923D-310DA750676B" name="GUID-95840C84-1595-49AC-923D-310DA750676B"></a><h3 id="BRADV-GUID-95840C84-1595-49AC-923D-310DA750676B" class="sect3"><span class="enumeration_section">8.8</span>关于RMAN控制文件和服务器参数文件自动备份</h3>
               <div>
                  <p>在许多恢复情况下，最近备份控制文件和服务器参数文件非常有用。为确保您备份这些文件，数据库支持控制文件和服务器参数文件自动备份。</p>
                  <p>自动备份独立于作为<code class="codeph">BACKUP</code>命令的一部分显式请求的当前控制文件的任何备份。使用<a href="glossary.html#GUID-7CDA6567-DFB0-450D-8771-B033E9872AF7"><span class="xrefglossterm">控制文件自动备份</span></a> ，即使当前控制文件，恢复目录和服务器参数文件不可访问，RMAN也可以恢复数据库。由于用于存储自动备份的路径遵循众所周知的格式，因此RMAN可以从该自动备份中搜索并还原服务器参数文件。使用还原的服务器参数文件启动实例后，RMAN可以从自动备份还原控制文件。装入控制文件后，使用装入的控制文件中的RMAN存储库还原数据文件。
                  </p>
                  <p>建议您打开控制文件自动备份。否则，RMAN数据库点即时恢复（DBPITR）和点即时恢复（PITR）为<a href="glossary.html#GUID-993BFB3F-3305-481C-999D-26132095DEC9"><span class="xrefglossterm">PDB</span></a> S可不能有效PITR时需要还原数据文件增删工作。
                  </p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="rman-backup-concepts.html#GUID-05C3D461-EF32-4605-959A-DAF03C7C4CC2" title="根据目标数据库的配置，RMAN可以执行控制文件和服务器参数文件的自动备份。">当RMAN执行控制文件自动备份时</a></p>
                     </li>
                     <li>
                        <p><a href="rman-backup-concepts.html#GUID-CC0CBD56-E3A5-4EAC-A542-29D21F36D67F" title="在备份作业期间分配的第一个通道创建自动备份并将其放入其自己的备份集中。对于数据库结构更改后的自动备份，与结构更改关联的服务器进程进行备份。">RMAN如何执行控制文件自动备份</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89495"></a><div class="props_rev_3"><a id="GUID-05C3D461-EF32-4605-959A-DAF03C7C4CC2" name="GUID-05C3D461-EF32-4605-959A-DAF03C7C4CC2"></a><h4 id="BRADV-GUID-05C3D461-EF32-4605-959A-DAF03C7C4CC2" class="sect4"><span class="enumeration_section">8.8.1</span>当RMAN执行控制文件自动备份时</h4>
                  <div>
                     <p>根据目标数据库的配置，RMAN可以执行控制文件和服务器参数文件的自动备份。</p>
                     <p>对于非CDB，如果<code class="codeph">CONFIGURE CONTROLFILE AUTOBACKUP</code>为<code class="codeph">ON</code> ，则在成功执行<code class="codeph">BACKUP</code>命令后，RMAN会自动备份控制文件和当前服务器参数文件（如果用于启动数据库）。对于<code class="codeph">COMPATIBLE</code>初始化参数设置为12.0或更高的CDB和独立数据库，默认情况下，控制文件自动备份已打开。
                     </p>
                     <p>如果数据库以<code class="codeph">ARCHIVELOG</code>模式运行，则当对数据库的结构更改影响控制文件的内容时，RMAN会进行控制文件自动备份。
                     </p>
                     <div class="infoboxnote" id="GUID-05C3D461-EF32-4605-959A-DAF03C7C4CC2__GUID-FD13ECCC-B9EF-4E08-96F4-FCB5A89CCDBF">
                        <p class="notep1">注意：</p>
                        <p>从Oracle Database Release <span class="italic">11g</span>第2版开始，当脚本中包含多个结构更改时，RMAN只接受一个控制文件自动备份（例如，添加表空间，更改表空间或数据文件的状态，添加新的联机重做日志，重命名）已应用文件等。
                        </p>
                     </div>
                  </div>
               </div><a id="BRADV89496"></a><div class="props_rev_3"><a id="GUID-CC0CBD56-E3A5-4EAC-A542-29D21F36D67F" name="GUID-CC0CBD56-E3A5-4EAC-A542-29D21F36D67F"></a><h4 id="BRADV-GUID-CC0CBD56-E3A5-4EAC-A542-29D21F36D67F" class="sect4"><span class="enumeration_section">8.8.2</span> RMAN如何执行控制文件自动备份</h4>
                  <div>
                     <p>在备份作业期间分配的第一个通道创建自动备份并将其放入其自己的备份集中。对于数据库结构更改后的自动备份，与结构更改关联的服务器进程进行备份。</p>
                     <p>如果数据库正在使用服务器参数文件，则RMAN将其备份到与控制文件自动备份相同的备份集中。自动备份完成后，数据库会将包含备份片段的完整路径和设备类型的消息写入位于<a href="glossary.html#GUID-BDCE90D1-13B7-4D2C-A761-1583A238A247"><span class="xrefglossterm">自动诊断信息库（ADR）中</span></a>的警报日志。
                     </p>
                     <div class="infoboxnote" id="GUID-CC0CBD56-E3A5-4EAC-A542-29D21F36D67F__GUID-D20BCECC-CFD2-472C-87D3-EF83B039D85D">
                        <p class="notep1">注意：</p>
                        <p>控制文件自动备份从不双工。</p>
                     </div>
                     <p>控制文件自动备份文件名对于所有设备类型都具有默认格式<code class="codeph">%F</code> ，以便RMAN可以确定文件位置并在没有存储库的情况下还原它。您可以使用<code class="codeph">CONFIGURE CONTROLFILE AUTOBACKUP FORMAT</code>命令指定其他格式，但所有自动备份格式都必须包含<code class="codeph">%F</code>变量。如果不使用默认格式，则在灾难恢复期间必须指定用于生成自动备份的格式。否则，RMAN无法还原自动备份。
                     </p>
                     <div class="infoboxnotealso" id="GUID-CC0CBD56-E3A5-4EAC-A542-29D21F36D67F__GUID-FAB4770C-BD14-4909-A759-94D224954DC0">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="configuring-rman-client-basic.html#GUID-98BA7492-7108-4DF9-B5A2-21957072E308" title="您可以配置RMAN以自动备份控制文件和服务器参数文件。每当添加备份记录时都会发生自动备份。">配置控制文件和服务器参数文件自动备份</a></p>
                           </li>
                           <li>
                              <p><code class="codeph">CONFIGURE</code>语法的<a href="../rcmrf/CONFIGURE.html#RCMRF113" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                           </li>
                           <li>
                              <p>用于<code class="codeph">BACKUP</code>语法的<a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                           </li>
                           <li>
                              <p><a href="../rcmrf/formatSpec.html#RCMRF195" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a>以了解替换变量<code class="codeph">%F</code></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV109"></a><div class="props_rev_3"><a id="GUID-C93F3588-BBA9-4AE2-9E47-74C7A9468023" name="GUID-C93F3588-BBA9-4AE2-9E47-74C7A9468023"></a><h3 id="BRADV-GUID-C93F3588-BBA9-4AE2-9E47-74C7A9468023" class="sect3"><span class="enumeration_section">8.9</span>关于RMAN增量备份</h3>
               <div>
                  <p>增量备份仅复制自上次备份以来已更改的数据块。您可以使用RMAN创建数据文件，表空间或整个数据库的增量备份。</p>
                  <p>默认情况下，RMAN进行完全备份。数据文件的<a href="glossary.html#GUID-D47BE9B3-BAE1-4415-B4B4-4D577B6CB493"><span class="xrefglossterm">完整备份</span></a>包括正在备份的文件中的每个已分配块。数据文件的完整备份可以是映像副本，在这种情况下，每个数据块都会被备份。它也可以存储在备份集中，在这种情况下可以跳过未使用的数据文件块。
                  </p>
                  <p>完整备份对后续增量备份没有影响。映像副本始终是完全备份，因为它们包含数据文件中的每个数据块。默认情况下，备份集是完整备份，因为它可能包含数据文件中的每个数据块，尽管<a href="glossary.html#GUID-0AA7EB43-FEA6-405F-9443-A4A2B43FFF96"><span class="xrefglossterm">未使用的块压缩</span></a>意味着排除从未使用过的块，在某些情况下，排除当前未使用的块（请参阅<span class="q">“ <a href="rman-backup-concepts.html#GUID-073C85A4-E28C-4FE2-A089-1EABF3D00070" title="创建备份集时，RMAN可以使用块压缩。">关于RMAN块”）压缩备份集</a> “</span> ）。
                  </p>
                  <p>完整备份不能成为增量备份策略的一部分;也就是说，它不能是后续增量备份的父级。</p>
                  <div class="infoboxnotealso" id="GUID-C93F3588-BBA9-4AE2-9E47-74C7A9468023__GUID-9396A789-0FFE-4DE0-9FC2-DC28188F90E7">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="rman-backup-concepts.html#GUID-0E273817-1EE0-40FD-BD92-51C4A0CAAF79" title="RMAN可以创建多级增量备份。每个增量级别由值0或1表示。">关于多级增量备份</a></p>
                        </li>
                        <li>
                           <p><a href="rman-backup-concepts.html#GUID-4F871762-2D64-4709-910A-1880D39A4B99">关于增量备份算法</a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="BRADV89499"></a><div class="props_rev_3"><a id="GUID-0E273817-1EE0-40FD-BD92-51C4A0CAAF79" name="GUID-0E273817-1EE0-40FD-BD92-51C4A0CAAF79"></a><h4 id="BRADV-GUID-0E273817-1EE0-40FD-BD92-51C4A0CAAF79" class="sect4"><span class="enumeration_section">8.9.1</span>关于多级增量备份</h4>
                  <div>
                     <p>RMAN可以创建多级增量备份。每个增量级别由值0或1表示。</p>
                     <p><a href="glossary.html#GUID-DF84C185-E97D-4D3C-BF4E-41A9090C5F4C"><span class="xrefglossterm">级别0增量备份</span></a> （后续增量备份的基础）会复制包含数据的所有块。0级增量备份和完全备份之间的唯一区别是增量策略中永远不会包含完整备份。因此，增量级别0备份是完全备份，恰好是级别大于0的增量备份的父级。
                     </p>
                     <p>1级增量备份可以是以下类型之一：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="glossary.html#GUID-353B6668-6BA5-4815-8F08-1CD5B446FBD6"><span class="xrefglossterm">差异增量备份</span></a> ，用于备份在级别1或0的最新增量备份后更改的所有块</p>
                           <p>请参见<a href="rman-backup-concepts.html#GUID-E9ABBACB-8259-4677-A8D4-81ED3194E7E2" title="在差异级别1备份中，RMAN备份自级别1（累积或差异）或级别0的最新增量备份以来已更改的所有块。">关于差异增量备份</a> 。
                           </p>
                        </li>
                        <li>
                           <p><a href="glossary.html#GUID-8BABFB51-EA47-4204-9A44-E1695A9F9FBF"><span class="xrefglossterm">累积增量备份</span></a> ，用于备份在级别0的最新增量备份后更改的所有块</p>
                           <p>请参阅<a href="rman-backup-concepts.html#GUID-F0FC9AEE-4227-42E2-9EC0-8DBB717A0859" title="在累积级别1备份中，RMAN备份自当前或父级化身中最近的0级增量备份以来使用的所有块。">关于累积增量备份</a> 。
                           </p>
                        </li>
                     </ul>
                     <p>默认情况下，增量备份是差异的。</p>
                     <p>级别0的增量备份可以是备份集或映像副本，但级别1的增量备份只能是备份集。</p>
                     <div class="infoboxnote" id="GUID-0E273817-1EE0-40FD-BD92-51C4A0CAAF79__GUID-2C755C08-D6E9-4822-AD53-A29EB3762F30">
                        <p class="notep1">注意：</p>
                        <p>当恢复时间比磁盘空间更重要时，累积备份优于差异备份，因为在恢复期间必须应用更少的增量备份。</p>
                     </div>
                     <p>备份文件的大小仅取决于修改的块数，增量备份级别和增量备份的类型（差异或累积）。</p>
                  </div><a id="BRADV207"></a><a id="BRADV89500"></a><div class="props_rev_3"><a id="GUID-E9ABBACB-8259-4677-A8D4-81ED3194E7E2" name="GUID-E9ABBACB-8259-4677-A8D4-81ED3194E7E2"></a><h5 id="BRADV-GUID-E9ABBACB-8259-4677-A8D4-81ED3194E7E2" class="sect5"><span class="enumeration_section">8.9.1.1</span>关于差异增量备份</h5>
                     <div>
                        <p>在差异级别1备份中，RMAN备份自级别1（累积或差异）或级别0的最新增量备份以来已更改的所有块。</p>
                        <p>例如，在差异级别1备份中，RMAN确定最近发生的哪个级别1备份，并备份在该备份之后修改的所有块。如果没有级别1可用，则RMAN会复制自基础级别0备份以来更改的所有块。</p>
                        <p>如果当前或父级<a href="glossary.html#GUID-4CCAB7DD-FEA7-4237-AF2C-304BA3BD52B1"><span class="xrefglossterm">化身中</span></a>没有可用的0级备份，则行为会因兼容性模式设置而异。如果兼容性&gt; = 10.0.0，则RMAN会复制自创建文件以来已更改的所有块。否则，RMAN会生成0级备份。
                        </p>
                        <div class="figure" id="GUID-E9ABBACB-8259-4677-A8D4-81ED3194E7E2__BABFJCBH">
                           <p class="titleinfigure">图8-2差异增量备份</p><img src="img/bradv017.gif" alt="下面是图8-2的描述" title="下面是图8-2的描述" longdesc="img_text/bradv017.html"><br><a href="img_text/bradv017.html">“图8-2差分增量备份”的说明</a></div>
                        <!-- class="figure" -->
                        <p>在<a href="rman-backup-concepts.html#GUID-E9ABBACB-8259-4677-A8D4-81ED3194E7E2__BABFJCBH">图8-2</a>所示的示例中，每周发生以下活动：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>星期日</p>
                              <p>增量级别0备份将备份此数据库中曾使用过的<span class="italic">所有</span>块。
                              </p>
                           </li>
                           <li>
                              <p>周一至周六</p>
                              <p>在星期一到星期六的每一天，差异增量级别1备份将备份自级别1或0的最新增量备份以来已更改的所有块。星期一备份复制自星期日0级备份以来更改的块，星期二备份复制自星期一1级备份以来更改的块，依此类推。</p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="BRADV208"></a><a id="BRADV89501"></a><div class="props_rev_3"><a id="GUID-F0FC9AEE-4227-42E2-9EC0-8DBB717A0859" name="GUID-F0FC9AEE-4227-42E2-9EC0-8DBB717A0859"></a><h5 id="BRADV-GUID-F0FC9AEE-4227-42E2-9EC0-8DBB717A0859" class="sect5"><span class="enumeration_section">8.9.1.2</span>关于累积增量备份</h5>
                     <div>
                        <p>在累积级别1备份中，RMAN备份自当前或父级化身中最近的0级增量备份以来使用的所有块。</p>
                        <p>累积增量备份通过确保您只需要来自任何特定级别的一个增量备份来减少还原操作所需的工作。累积备份比差异备份需要更多的空间和时间，因为它们会复制先前备份在同一级别完成的工作。</p>
                        <p>在<a href="rman-backup-concepts.html#GUID-F0FC9AEE-4227-42E2-9EC0-8DBB717A0859__BABHEJFE">图8-3</a>所示的示例中，每周发生以下情况：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>星期日</p>
                              <p>增量级别0备份将备份此数据库中曾使用过的<span class="italic">所有</span>块。
                              </p>
                           </li>
                           <li>
                              <p>周一周六</p>
                              <p>累积增量级别1备份会复制自最近的0级备份以来更改的所有块。由于最新的0级备份是在星期日创建的，因此星期一到星期六每天的1级备份会备份自星期日备份以来更改的所有块。</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-F0FC9AEE-4227-42E2-9EC0-8DBB717A0859__GUID-059641F8-F35E-4CD7-A2BA-7731466DCE33">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="backing-up-database.html#GUID-2AF8EE74-CEB2-468D-A3B2-DD6AD8E41304" title="增量备份仅复制自指定的先前备份以来已更改的数据文件块。使用BACKUP命令创建增量备份。">制作和更新RMAN增量备份</a></p>
                        </div>
                        <div class="figure" id="GUID-F0FC9AEE-4227-42E2-9EC0-8DBB717A0859__BABHEJFE">
                           <p class="titleinfigure">图8-3累积增量备份</p><img src="img/bradv018.gif" alt="下面是图8-3的描述" title="下面是图8-3的描述" longdesc="img_text/bradv018.html"><br><a href="img_text/bradv018.html">“图8-3累积增量备份”的说明</a></div>
                        <!-- class="figure" -->
                     </div>
                  </div>
               </div><a id="BRADV90078"></a><div class="props_rev_3"><a id="GUID-16069217-F44A-45BF-BAE6-774B99155E3A" name="GUID-16069217-F44A-45BF-BAE6-774B99155E3A"></a><h4 id="BRADV-GUID-16069217-F44A-45BF-BAE6-774B99155E3A" class="sect4"><span class="enumeration_section">8.9.2</span>关于块更改跟踪</h4>
                  <div>
                     <p>增量备份的块更改跟踪功能通过在块更改跟踪文件中记录每个数据文件中的更改块来提高增量备份性能。</p>
                     <p>块更改跟踪文件是存储在<a href="glossary.html#GUID-B2954743-3455-4045-9200-891927E38048"><span class="xrefglossterm">数据库区域中</span></a>的小型二进制文件。当生成重做时，RMAN跟踪已更改的块。
                     </p>
                     <p>如果启用了块更改跟踪，则RMAN使用更改跟踪文件来标识增量备份的已更改块，从而无需扫描数据文件中的每个块。当增量级别大于0时，RMAN仅使用块更改跟踪，因为<a href="glossary.html#GUID-DF84C185-E97D-4D3C-BF4E-41A9090C5F4C"><span class="xrefglossterm">级别0增量备份</span></a>包括所有块。
                     </p>
                     <div class="infoboxnotealso" id="GUID-16069217-F44A-45BF-BAE6-774B99155E3A__GUID-5C91A0AD-884F-4CDF-9A9D-982EEE49E19A">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="backing-up-database.html#GUID-4E1F605A-76A7-48D0-9D9B-7343B4327E2A" title="增量备份的块更改跟踪功能通过记录每个数据文件的更改块来提高备份性能。">使用块更改跟踪来提高增量备份性能</a></p>
                     </div>
                  </div>
               </div><a id="BRADV89498"></a><div class="props_rev_3"><a id="GUID-4F871762-2D64-4709-910A-1880D39A4B99" name="GUID-4F871762-2D64-4709-910A-1880D39A4B99"></a><h4 id="BRADV-GUID-4F871762-2D64-4709-910A-1880D39A4B99" class="sect4"><span class="enumeration_section">8.9.3</span>关于增量备份算法</h4>
                  <div>
                     <p>以下概念对于理解RMAN用于进行增量备份的算法至关重要：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>检查点SCN</p>
                           <p>每个数据文件都有一个<a href="glossary.html#GUID-22212AAE-6F3C-4E84-B940-5AB2261A7EDA"><span class="xrefglossterm">数据文件检查点</span></a> SCN，您可以在<code class="codeph">V$DATAFILE.CHECKPOINT_CHANGE#</code>查看。SCN <span class="italic">低于</span>此SCN的所有更改都保证在文件中。还原级别0增量备份时，还原的数据文件包含创建级别0时的检查点SCN。将1级增量备份应用于文件时，文件的检查点SCN将前进到创建增量级别1备份时文件所具有的检查点SCN。
                           </p>
                        </li>
                        <li>
                           <p>增量启动SCN</p>
                           <p>此SCN仅适用于1级增量备份。SCN大于或等于增量启动SCN的所有块都包含在备份中。SCN低于增量启动SCN的块不包含在备份中。增量启动SCN通常是1级备份父级的检查点SCN。</p>
                        </li>
                        <li>
                           <p>阻止SCN</p>
                           <p>数据文件中的每个数据块都记录最近对块进行更改的SCN。</p>
                        </li>
                     </ul>
                     <p>当RMAN对文件进行1级增量备份时，RMAN将读取该文件，检查每个块的SCN，并备份其SCN大于或等于此备份的增量启动SCN的块。如果备份是差异的，则增量启动SCN是最新的1级备份的检查点SCN。如果备份是累积的，则增量启动SCN是最新的0级备份的检查点SCN。</p>
                     <p>启用块更改跟踪时，RMAN使用位图来避免读取在从增量启动SCN到检查点SCN的范围内未更改的块。 RMAN仍会检查每个读取的块，并使用块中的SCN来确定要包含在备份中的块。</p>
                     <p>增量备份算法的一个结果是RMAN在恢复期间应用包含已更改数据的所有块，即使更改是使用<code class="codeph">NOLOGGING</code>选项创建的对象。因此，如果在还原<code class="codeph">NOLOGGING</code>之前还原备份，则增量备份是恢复这些更改的唯一方法。
                     </p>
                  </div>
               </div><a id="BRADV89497"></a><div class="props_rev_3"><a id="GUID-D3BD53B8-91F3-474C-BD10-00AE9B30E610" name="GUID-D3BD53B8-91F3-474C-BD10-00AE9B30E610"></a><h4 id="BRADV-GUID-D3BD53B8-91F3-474C-BD10-00AE9B30E610" class="sect4"><span class="enumeration_section">8.9.4</span>关于使用增量备份进行恢复</h4>
                  <div>
                     <p>在介质恢复期间，RMAN会检查还原的文件，以确定是否可以使用增量备份来恢复它们。如果可以选择，则RMAN始终在归档重做日志上选择增量备份，因为在块级别应用更改比应用重做更快。</p>
                     <p>RMAN无需还原数据文件的基本增量备份，以在恢复期间将增量备份应用于数据文件。例如，您可以还原数据文件映像副本并使用增量备份进行恢复。</p>
                     <div class="infoboxnotealso" id="GUID-D3BD53B8-91F3-474C-BD10-00AE9B30E610__GUID-FB2DD143-9EA7-41E5-A74D-1357F41DFC72">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="rman-data-repair-concepts.html#GUID-EC33413A-79B8-4ECF-A77B-DF91957D76FF" title="RMAN自动化媒体恢复。RMAN自动恢复并应用增量备份和归档重做日志，无论哪种组合最有效。">关于增量备份和归档重做日志的选择</a></p>
                     </div>
                  </div>
               </div><a id="BRADV567"></a><div class="props_rev_3"><a id="GUID-819CED6A-55E4-4606-BCA4-3B395FCD30C6" name="GUID-819CED6A-55E4-4606-BCA4-3B395FCD30C6"></a><h4 id="BRADV-GUID-819CED6A-55E4-4606-BCA4-3B395FCD30C6" class="sect4"><span class="enumeration_section">8.9.5</span>关于恢复设备的增量备份策略</h4>
                  <div>
                     <p>备份永久备份策略消除了在备份到零数据丢失恢复设备（恢复设备）时创建重复完整备份的需要。虽然Recovery Appliance支持其他RMAN备份策略，但是持续备份的推荐方法是永久增量备份策略。</p>
                     <p>使用增量永久备份策略，您只需创建一个初始级别0完全备份和后续级别1增量备份。初始备份和后续增量必须是RMAN备份集，而不是映像副本。</p>
                     <p>请注意，恢复设备永久永久备份策略与传统RMAN设置中的增量更新备份策略不同。对于RMAN，增量更新的备份使用初始映像副本，然后是增量备份，最终合并到完整备份中。因此，始终至少有一个完整映像副本，一些增量备份和一些归档重做日志。</p>
                     <div class="infoboxnotealso" id="GUID-819CED6A-55E4-4606-BCA4-3B395FCD30C6__GUID-ED558961-9446-4E59-B910-E094E321A212">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="rman-complete-database-recovery.html#GUID-C192C448-0D8A-4366-91AB-BE62ED5B12ED" title="零数据丢失恢复设备（恢复设备）大大减少了连续归档重做日志备份之间存在的潜在数据丢失窗口。您可以在数据库故障的几个亚之内恢复目标数据库。">关于恢复设备的实时重做传输</a></p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=AMPDB768" target="_blank"><span class="italic">“零数据丢失恢复设备受保护数据库配置指南”</span></a> ，了解有关永久增量备份策略的信息</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV99966"></a><div class="props_rev_3"><a id="GUID-3F68F554-FBC9-4375-85DE-7F844C48C8FF" name="GUID-3F68F554-FBC9-4375-85DE-7F844C48C8FF"></a><h3 id="BRADV-GUID-3F68F554-FBC9-4375-85DE-7F844C48C8FF" class="sect3"><span class="enumeration_section">8.10</span>关于备份保留策略</h3>
               <div>
                  <p>您可以使用<code class="codeph">CONFIGURE RETENTION POLICY</code>命令创建持久性和自动备份保留策略。
                  </p>
                  <p>当备份保留策略生效时，RMAN会根据<code class="codeph">CONFIGURE</code>命令中指定的条件将数据文件或控制文件的<a href="glossary.html#GUID-A4D8B0BE-D3B9-4DD9-A7B3-BC0D88D25DC0"><span class="xrefglossterm">备份</span></a>视为<a href="glossary.html#GUID-A4D8B0BE-D3B9-4DD9-A7B3-BC0D88D25DC0"><span class="xrefglossterm">过时备份</span></a> ，即不再需要进行恢复。您可以使用<a href="../rcmrf/REPORT.html#RCMRF147" target="_blank"><code class="codeph">REPORT OBSOLETE</code></a>命令查看过时文件，使用<a href="../rcmrf/DELETE.html#RCMRF121" target="_blank"><code class="codeph">DELETE OBSOLETE</code></a>命令删除它们。
                  </p>
                  <p>随着时间的推移生成备份，旧备份将变得过时，因为不再需要它们来满足保留策略。RMAN可以为您识别过时的文件，但它不会自动删除它们。必须使用<code class="codeph">DELETE</code> <code class="codeph">OBSOLETE</code>命令删除不再需要的文件才能满足保留策略。
                  </p>
                  <p>如果配置了快速恢复区域，则当新文件需要更多恢复区空间时，数据库会自动删除过时或备份到磁带的文件。磁盘配额规则与保留策略规则不同，但数据库从不删除违反保留策略的文件以满足磁盘配额。请参阅<span class="q">“ <a href="maintaining-rman-backups.html#GUID-3F11ECB5-1321-45F5-A557-BB1A5BAF011F" title="如果RMAN保留策略要求保留一组大于快速恢复区磁盘配额的备份，或者保留策略设置为NONE，则快速恢复区域可以完全填充，没有可回收空间。">响应完全快速恢复区</a> ”</span> 。
                  </p>
                  <p>当<code class="codeph">REPORT</code> <code class="codeph">OBSOLETE</code>或<code class="codeph">DELETE</code> <code class="codeph">OBSOLETE</code>根据用户定义的保留策略确定不需要进行恢复时，备份已过时。仅当RMAN执行交叉检查且无法找到该文件时， <a href="glossary.html#GUID-A8547B27-5415-4AAA-B2B4-C0998EB62E47"><span class="xrefglossterm">备份</span></a>才会被视为<a href="glossary.html#GUID-A8547B27-5415-4AAA-B2B4-C0998EB62E47"><span class="xrefglossterm">过期备份</span></a> 。简而言之， <span class="italic">过时</span>意味着不需要文件，而<span class="italic">过期则</span>意味着找不到文件。
                  </p>
                  <p>备份保留策略仅适用于完整或0级数据文件和控制文件备份。对于数据文件副本和代理副本，如果RMAN确定不需要副本或代理副本，则可以删除副本或代理副本。对于数据文件备份集，在备份集中的所有数据文件备份都已过时之前，RMAN无法删除备份集。</p>
                  <p>保留策略不负责删除或呈现过时的归档重做日志和增量级别1备份。相反，当没有需要它们的完整备份时，这些文件就会过时。除了影响完整或0级数据文件和控制文件备份外，保留策略还会影响归档重做日志和1级增量备份。首先，RMAN决定哪些数据文件和控制文件备份已过时。然后，RMAN认为所有归档日志和增量级别1备份都是过时的，这些备份不需要恢复必须保留的最旧的数据文件或控制文件备份。</p>
                  <div class="infoboxnote" id="GUID-3F68F554-FBC9-4375-85DE-7F844C48C8FF__GUID-4F6CC500-7BC2-43B6-86E1-603D8F983494">
                     <p class="notep1">注意：</p>
                     <p>如果通过非RMAN技术删除备份（例如，通过介质管理器的磁带保留策略），则RMAN无法实施自动保留策略。在从该介质管理器的目录中删除该磁带上的所有RMAN备份之前，介质管理器必须永不过期。</p>
                  </div>
                  <p>实施保留策略有两个互斥的选项： <a href="glossary.html#GUID-57A71B9A-2353-4669-A152-EFAD9AFF3ED3"><span class="xrefglossterm">冗余</span></a>和<a href="glossary.html#GUID-1C595EF7-B8A1-4AA3-8C45-44E9FC8BAB9E"><span class="xrefglossterm">恢复窗口</span></a> 。
                  </p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="rman-backup-concepts.html#GUID-A2C982AA-5385-4A45-B0D4-20C1CEFE3DED" title="恢复窗口是一个以当前时间开始并向后延伸到可恢复点的时间段。可恢复性是假设时间点恢复的最早时间，也就是说，在媒体故障后您可以恢复的最早时间点。">关于恢复窗口</a></p>
                     </li>
                     <li>
                        <p><a href="rman-backup-concepts.html#GUID-5AA05D2C-79E0-4BE7-8834-F0DB40186EB9" title="在某些情况下，使用恢复窗口会使磁盘空间规划复杂化，因为必须保留的备份数量不是恒定的，并且取决于备份计划。相反，基于冗余的保留策略指定必须保留每个数据文件的备份数。">关于备份冗余</a></p>
                     </li>
                     <li>
                        <p><a href="rman-backup-concepts.html#GUID-52F6659C-BA57-400F-8E61-4FD5E18AFB4A" title="您可以运行REPORT OBSOLETE命令，以根据保留策略确定当前哪些备份已过时。">关于批量删除过时备份</a></p>
                     </li>
                     <li>
                        <p><a href="rman-backup-concepts.html#GUID-C55C7DC1-57DB-4E6B-B56E-006C8472054A" title="如果配置快速恢复区域，则数据库使用内部算法选择快速恢复区域中不再需要的文件以满足配置的保留策略。">关于备份保留策略和快速恢复区删除规则</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV209"></a><a id="BRADV608"></a><a id="BRADV89502"></a><div class="props_rev_3"><a id="GUID-A2C982AA-5385-4A45-B0D4-20C1CEFE3DED" name="GUID-A2C982AA-5385-4A45-B0D4-20C1CEFE3DED"></a><h4 id="BRADV-GUID-A2C982AA-5385-4A45-B0D4-20C1CEFE3DED" class="sect4"><span class="enumeration_section">8.10.1</span>关于恢复窗口</h4>
                  <div>
                     <p>恢复窗口是一个以当前时间开始并向后延伸到可恢复点的时间段。可恢复性是假设时间点恢复的最早时间，也就是说，在媒体故障后您可以恢复的最早时间点。</p>
                     <p>例如，如果您实施1周的恢复窗口，则RMAN将保留完整备份和所需的增量备份和归档日志，以便数据库可以在过去最多7天内恢复。您实施此保留策略如下：</p><pre class="pre codeblock"><code>配置保留政策，以恢复7天的窗口;</code></pre><p>此命令可确保为每个数据文件保留一个早于可恢复点的备份。例如，如果恢复窗口为<code class="codeph">7</code> ，则必须始终存在满足以下条件的每个数据文件的一个备份：</p><pre class="pre codeblock"><code>SYSDATE  -  BACKUP CHECKPOINT TIME&gt; = 7</code></pre><p>所有早于满足此条件的最新备份的备份都已过时。</p>
                     <p>假设保留策略<a href="rman-backup-concepts.html#GUID-A2C982AA-5385-4A45-B0D4-20C1CEFE3DED__I1018027">如图8-4所示</a> 。保留政策包括以下几个方面：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>恢复窗口为7天。</p>
                        </li>
                        <li>
                           <p>这些天，数据库备份每两周安排一次：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>1月1日</p>
                              </li>
                              <li>
                                 <p>1月15日</p>
                              </li>
                              <li>
                                 <p>1月29日</p>
                              </li>
                              <li>
                                 <p>2月12日</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>数据库以<code class="codeph">ARCHIVELOG</code>模式运行，只有在保留策略需要时，存档日志才会保存在磁盘上。
                           </p>
                        </li>
                     </ul>
                     <div class="figure" id="GUID-A2C982AA-5385-4A45-B0D4-20C1CEFE3DED__I1018027">
                        <p class="titleinfigure">图8-4恢复窗口，第1部分</p><img src="img/bradv004.png" alt="下面是图8-4的描述" title="下面是图8-4的描述" longdesc="img_text/bradv004.html"><br><a href="img_text/bradv004.html">“图8-4恢复窗口，第1部分”的描述</a></div>
                     <!-- class="figure" -->
                     <p><a href="rman-backup-concepts.html#GUID-A2C982AA-5385-4A45-B0D4-20C1CEFE3DED__I1018027">如图8-4所示</a> ，当前时间是1月23日，可恢复点是1月16日。因此，恢复需要1月15日备份，日志序列500到850的归档日志也是如此。500之前的日志和1月1日的备份已过时，因为恢复到窗口内的某个点不需要它们。
                     </p>
                     <p>一周后假设相同的场景， <a href="rman-backup-concepts.html#GUID-A2C982AA-5385-4A45-B0D4-20C1CEFE3DED__I1018028">如图8-5所示</a> 。
                     </p>
                     <div class="figure" id="GUID-A2C982AA-5385-4A45-B0D4-20C1CEFE3DED__I1018028">
                        <p class="titleinfigure">图8-5恢复窗口，第2部分</p><img src="img/bradv002.png" alt="下面是图8-5的描述" title="下面是图8-5的描述" longdesc="img_text/bradv002.html"><br><a href="img_text/bradv002.html">“图8-5恢复窗口，第2部分”的描述</a></div>
                     <!-- class="figure" -->
                     <p>在这种情况下，当前时间是1月30日，可恢复点是1月23日。请注意，即使恢复窗口中存在更新的备份（1月29日），1月15日备份也<span class="italic">不会</span>过时。出现这种情况是因为恢复1月29日备份无法使您恢复到1月23日窗口中的最早时间。要确保窗口中任何一点的可恢复性，必须将1月15日备份和所有已归档日志从序列500保存到1150。
                     </p>
                     <div class="infoboxnotealso" id="GUID-A2C982AA-5385-4A45-B0D4-20C1CEFE3DED__GUID-E17A29E0-6A1B-45B3-9C68-A3F61AEF6AF6">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="configuring-rman-client-basic.html#GUID-95ABBB30-713E-4781-B5C3-6ADBEB658DE3" title="CONFIGURE命令的RECOVERY WINDOW参数指定当前时间与最早可恢复点之间的天数。">配置基于恢复窗口的保留策略</a></p>
                     </div>
                  </div>
               </div><a id="BRADV89503"></a><div class="props_rev_3"><a id="GUID-5AA05D2C-79E0-4BE7-8834-F0DB40186EB9" name="GUID-5AA05D2C-79E0-4BE7-8834-F0DB40186EB9"></a><h4 id="BRADV-GUID-5AA05D2C-79E0-4BE7-8834-F0DB40186EB9" class="sect4"><span class="enumeration_section">8.10.2</span>关于备份冗余</h4>
                  <div>
                     <p>在某些情况下，使用恢复窗口会使磁盘空间规划复杂化，因为必须保留的备份数量不是恒定的，并且取决于备份计划。相反，基于冗余的保留策略指定必须保留每个数据文件的备份数。</p>
                     <p>例如，您可以按如下方式配置冗余2：</p><pre class="pre codeblock"><code>配置保留政策以减少冗余2;</code></pre><p>默认保留策略配置为<code class="codeph">REDUNDANCY</code> <code class="codeph">1</code> 。
                     </p>
                     <div class="infoboxnotealso" id="GUID-5AA05D2C-79E0-4BE7-8834-F0DB40186EB9__GUID-D1B32A62-734C-48E6-B67C-6B2E43D02001">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="configuring-rman-client-basic.html#GUID-E9AEAC34-6C40-40A1-BAF5-3EAE20417715" title="CONFIGURE RETENTION POLICY命令的REDUNDANCY参数指定RMAN保留的每个数据文件和控制文件的完整备份数或0级备份数。默认保留策略为REDUNDANCY 1。">配置基于冗余的保留策略</a></p>
                     </div>
                  </div>
               </div><a id="BRADV89504"></a><div class="props_rev_3"><a id="GUID-52F6659C-BA57-400F-8E61-4FD5E18AFB4A" name="GUID-52F6659C-BA57-400F-8E61-4FD5E18AFB4A"></a><h4 id="BRADV-GUID-52F6659C-BA57-400F-8E61-4FD5E18AFB4A" class="sect4"><span class="enumeration_section">8.10.3</span>关于批量删除过时备份</h4>
                  <div>
                     <p>您可以运行<code class="codeph">REPORT OBSOLETE</code>命令，以根据保留策略确定当前哪些备份已过时。
                     </p>
                     <p>配对命令<code class="codeph">DELETE OBSOLETE</code>根据保留策略删除所有过时的文件。您可以定期运行<code class="codeph">DELETE OBSOLETE</code>以最大限度地减少存储过时备份所浪费的空间。例如，您可以在每周脚本中运行<code class="codeph">DELETE OBSOLETE</code> 。
                     </p>
                     <p>您还可以通过在<code class="codeph">REPORT</code>或<code class="codeph">DELETE</code>命令上指定<code class="codeph">REDUNDANCY</code>或<code class="codeph">RECOVERY</code> <code class="codeph">WINDOW</code>选项来覆盖已配置的保留策略。使用<code class="codeph">DELETE OBSOLETE</code>的恢复窗口短于配置的恢复窗口，可以有效地减少可恢复性窗口。例如，如果配置的窗口是14天，但您执行<code class="codeph">DELETE OBSOLETE RECOVERY WINDOW OF 7 DAYS</code> ，那么您将无法再恢复到7到14天之前的时间。
                     </p>
                     <div class="infoboxnotealso" id="GUID-52F6659C-BA57-400F-8E61-4FD5E18AFB4A__GUID-EA814556-9A91-4E69-91ED-457FA7107112">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="reporting-rman-operations.html#GUID-550638CC-0D16-4B1A-83C7-5D10181DC7C1" title="作为备份和恢复策略的一部分，您应定期运行指示已备份内容的报告。您可以确定哪些数据文件需要备份或哪些文件最近未备份。此外，您还可以预览出现问题时RMAN必须还原的备份。RMAN存储执行操作的每个数据库的元数据。在Data Guard环境中，您可以在不使用Data Guard时使用LIST，REPORT和SHOW命令。您可以使用FOR DB_UNIQUE_NAME子句运行这些命令，以显示与指定数据库关联的备份。LIST命令使用RMAN存储库中的信息来提供备份列表以及与备份和恢复相关的其他对象。LIST命令的主要用途是列出备份和副本。使用listObjList或recordSpec子句指定所需的对象。如果未指定对象，则RMAN将显示所有数据库文件和归档重做日志文件的副本。您可以指定几个不同的条件来缩小LIST输出。使用LIST命令列出预包装备份和预刷新存档的重做日志文件。每次在数据库上执行OPEN RESETLOGS操作时，此操作都会创建数据库的新版本。RMAN REPORT命令分析可用备份和数据库。REPORT命令提供各种RMAN备份报告。使用REPORT NEED BACKUP命令确定在特定保留策略下需要备份的数据库文件。您可以使用REPORT NEED BACKUP命令的选项指定不同的保留策略。REPORT NEED BACKUP命令可以检查整个数据库，跳过指定的表空间，或仅根据不同的保留策略检查特定的表空间或数据文件。您可以将REPORT NEED BACKUP命令测试的备份限制为仅基于磁盘或基于磁带的备份。当通过不可恢复的操作（例如直接加载插入）更改数据文件时，不能使用正常的介质恢复来恢复文件，因为不可恢复的操作不会生成重做。在执行此类操作后，您必须对受影响的数据文件执行完全备份或增量备份，以确保可以使用RMAN恢复受不可恢复操作影响的数据块。您可以报告已过时的备份集，备份片和数据文件副本是，不需要通过指定OBSOLETE关键字来满足指定的保留策略。REPORT SCHEMA命令列出并显示有关数据库文件，表空间等的信息。您可以查看与多租户容器数据库（CDB），仅root用户或一个或多个可插拔数据库（PDB）相关的元数据的报告。使用带有GUID选项的LIST命令列出已从多租户容器数据库（CDB）中删除的可插拔数据库（PDB）的备份。在某些情况下，V $视图通过使用LIST和REPORT命令提供不可用的信息。RMAN作业是在RMAN会话中执行的一组命令。因此，一个RMAN作业可以包含多个命令。V $ BACKUP_PIECE和V $ RMAN_BACKUP_PIECE视图的ENCRYPTED列指示备份片段是加密（YES）还是未加密（NO）。LIST，REPORT和SHOW命令提供了访问控制文件和恢复目录中数据的最简单方法。RMAN从目标数据库控制文件中获取备份和恢复元数据，并将其存储在恢复目录的表中。恢复目录视图是从这些表派生的。恢复目录视图未针对用户查询进行规范化或优化。大多数恢复目录视图包含DB_KEY和DBINC_KEY列。可以通过主键（DB_KEY列值）或DBID（32位唯一数据库标识符）唯一标识在恢复目录中注册的每个数据库。数据库的每个版本都由DBINC_KEY列唯一标识。在Data Guard环境中查询恢复目录时，需要考虑特殊注意事项。DB_KEY值是注册数据库的主键，仅在恢复目录中使用。最简单的方法是获取DB_KEY是使用目标数据库的DBID，每当您将RMAN作为TARGET连接到数据库时，都会显示该DBID。您可以查询视图RC_BACKUP_FILES，以获取有关在恢复目录中注册的任何数据库的所有备份的信息。但是，在查询RC_BACKUP_FILES之前，必须调用DBMS_RCVMAN.SETDATABASE过程。">报告RMAN操作</a>以了解如何生成报告和删除备份</p>
                           </li>
                           <li>
                              <p>用于<code class="codeph">DELETE</code>语法的<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF121" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                           </li>
                           <li>
                              <p><code class="codeph">REPORT</code>语法的<a href="../rcmrf/REPORT.html#RCMRF147" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV89505"></a><div class="props_rev_3"><a id="GUID-C55C7DC1-57DB-4E6B-B56E-006C8472054A" name="GUID-C55C7DC1-57DB-4E6B-B56E-006C8472054A"></a><h4 id="BRADV-GUID-C55C7DC1-57DB-4E6B-B56E-006C8472054A" class="sect4"><span class="enumeration_section">8.10.4</span>关于备份保留策略和快速恢复区删除规则</h4>
                  <div>
                     <p>如果配置快速恢复区域，则数据库使用内部算法选择快速恢复区域中不再需要的文件以满足配置的保留策略。</p>
                     <p>在确定要从快速恢复区域中删除哪些文件以满足磁盘配额规则时，永远不会违反保留策略。这些备份的状态为<code class="codeph">OBSOLETE</code> ，可以删除以满足<a href="glossary.html#GUID-925AC655-2953-4F1F-9E5A-F8EA6D9DA552"><span class="xrefglossterm">磁盘配额</span></a>规则。
                     </p>
                     <p>始终根据保留策略确定RMAN状态<code class="codeph">OBSOLETE</code> 。例如，如果数据库备份在RMAN存储库中被视为<code class="codeph">OBSOLETE</code> ，那么这是因为它不需要恢复到恢复窗口中的某个点，或者它是多余的。
                     </p>
                     <p><code class="codeph">OBSOLETE</code>状态的快速恢复区域规则与删除资格的磁盘配额规则之间存在一个重要区别。假设当前恢复窗口需要磁盘上存档的日志1000到2000，因此不会过时。如果将这些日志备份到磁带，则保留策略会根据需要考虑磁盘日志，即不会过时。尽管如此，快速恢复区磁盘配额算法认为磁盘上的日志符合删除条件，因为它们已备份到磁带上。磁盘上的日志在存储库中没有<code class="codeph">OBSOLETE</code>状态，但它们有资格被快速恢复区域删除。
                     </p>
                     <div class="infoboxnotealso" id="GUID-C55C7DC1-57DB-4E6B-B56E-006C8472054A__GUID-445086E2-9643-4162-AA09-F83404107818">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="maintaining-rman-backups.html#GUID-2D7B9EF4-C306-4377-82F2-DDE3549FB63C" title="RMAN使用某些规则来确定何时可以从快速恢复区域删除文件。">快速恢复区的删除规则</a></p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>