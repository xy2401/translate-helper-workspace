<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="Use these options to rerun upgrades."></meta>
      <meta name="description" content="Use these options to rerun upgrades."></meta>
      <title>重新启动Oracle数据库升级</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Database Upgrade Guide"></meta>
      <meta property="og:description" content="Use these options to rerun upgrades."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Database Upgrade Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-upgrade-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-04-25T08:26:31-07:00"></meta>
      <meta name="dcterms.title" content="Database Upgrade Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96252-05"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="troubleshooting-oracle-database-upgrade.html" title="Previous" type="text/html"></link>
      <link rel="next" href="restarting-upgrade-specific-phase-that-failed-using-p.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="UPGRD"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="troubleshooting-oracle-database-upgrade.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="restarting-upgrade-specific-phase-that-failed-using-p.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据库升级指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="upgrading-oracle-database.html" property="item" typeof="WebPage"><span property="name">升级Oracle数据库</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">重新启动Oracle数据库升级</li>
            </ol>
            <a id="GUID-190D00A4-BE9A-4139-B3FC-A29C2BFBE91B" name="GUID-190D00A4-BE9A-4139-B3FC-A29C2BFBE91B"></a><a id="UPGRD12412"></a>
            
            <h2 id="UPGRD-GUID-190D00A4-BE9A-4139-B3FC-A29C2BFBE91B" class="sect2">重新启动Oracle数据库升级</h2>
         </header>
         <div class="ind">
            <div>
               <p>使用这些选项重新运行升级。</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="rerunning-upgrades-oracle-database.html#GUID-6E157C6B-879D-49B2-82A3-E5A4C375D48F">关于重新启动Oracle数据库的升级</a><br>Oracle提供此处列出的功能以重新运行或重新启动Oracle数据库升级，包括失败阶段之后。
                  </li>
                  <li class="ulchildlink"><a href="rerunning-upgrades-oracle-database.html#GUID-E281A34F-DCC4-4F4C-B7EF-03E694BB0CFF">使用升级（catctl.pl）脚本重新运行升级</a><br>您可以修复升级问题，然后使用<code>catctl.pl</code>脚本或<code>dbupgrade</code> shell命令重新运行升级。
                  </li>
                  <li class="ulchildlink"><a href="rerunning-upgrades-oracle-database.html#GUID-CF18A968-0C0E-4223-AA9F-37B39F31ACBA">重新启动多租户数据库（CDB）升级的选项</a><br>您可以使用四个选项来重新运行Oracle Database 12c第2版（12.2）的多租户数据库体系结构（CDB）上的升级。
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="upgrading-oracle-database.html#GUID-CC88F262-3370-4FFA-8604-EDA9F20F56D9" title="Oracle提供了一套全面的工具，用于以最短的停机时间升级Oracle数据库，以及将应用程序迁移到新版本。">升级Oracle数据库</a></p>
                  </div>
               </div>
            </div>
            
            <div class="sect2"><a id="GUID-6E157C6B-879D-49B2-82A3-E5A4C375D48F" name="GUID-6E157C6B-879D-49B2-82A3-E5A4C375D48F"></a><h3 id="UPGRD-GUID-6E157C6B-879D-49B2-82A3-E5A4C375D48F" class="sect3">关于重新启动Oracle数据库的升级</h3>
               <div>
                  <p>Oracle提供此处列出的功能以重新运行或重新启动Oracle数据库升级，包括失败阶段之后。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-6E157C6B-879D-49B2-82A3-E5A4C375D48F__GUID-D1FCBADB-1DCA-472A-A912-F18427F91D36">并行升级实用程序和重新启动或重新运行</p>
                     <p>您可以使用数据库升级助手（DBUA）或使用并行升级实用程序（ <code class="codeph">catctl.pl</code> ）脚本重新运行或重新启动Oracle数据库升级阶段。您还可以在初始尝试中未能升级的PDB上运行命令，以便您可以完成升级。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-6E157C6B-879D-49B2-82A3-E5A4C375D48F__GUID-D4199F17-E082-433F-9FD1-45CA83123592">并行升级实用程序恢复选项</p>
                     <p>Oracle Database 12 <span class="italic">c第</span> 2版（12.2）包含一个用于Parallel Upgrade Utility的新Resume选项。此选项适用于CDB和非CDB。重新运行或重新启动升级时，不需要识别失败或不完整的阶段。使用恢复选项（ <code class="codeph">-R</code> ）使用并行升级实用程序时，该实用程序会自动检测先前升级中未成功完成的阶段。然后，并行升级实用程序重新运行或重新启动未成功完成的这些阶段，以便完成升级。绕过已成功完成的步骤可减少重新运行升级所需的时间。
                     </p>
                     <p>要使用“恢复”选项，请使用-R参数运行并行升级实用程序。例如：</p><pre class="pre codeblock"><code>$ ORACLE_HOME / perl / bin / perl catctl.pl -L plist.txt -n 4 -N 2 -R -l $ ORACLE_HOME / cfgtoollogs catupgrd.sql</code></pre><p>无论您在升级过程中遇到哪个阶段，都可以随时重新运行整个升级。如果您计划重新运行整个升级，而不是仅重新运行失败的阶段，则不使用Resume（ <code class="codeph">-R</code> ）选项运行Parallel Upgrade Utility。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="rerunning-upgrades-oracle-database.html#GUID-190D00A4-BE9A-4139-B3FC-A29C2BFBE91B" title="使用这些选项重新运行升级。">重新运行Oracle数据库升级</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="UPGRD52809"></a><div class="props_rev_3"><a id="GUID-E281A34F-DCC4-4F4C-B7EF-03E694BB0CFF" name="GUID-E281A34F-DCC4-4F4C-B7EF-03E694BB0CFF"></a><h3 id="UPGRD-GUID-E281A34F-DCC4-4F4C-B7EF-03E694BB0CFF" class="sect3">使用升级（catctl.pl）脚本重新运行升级</h3>
               <div>
                  <p>您可以修复升级问题，然后使用<code>catctl.pl</code>脚本或<code>dbupgrade</code> shell命令重新运行升级。
                  </p>
                  <div class="infoboxnote" id="GUID-E281A34F-DCC4-4F4C-B7EF-03E694BB0CFF__GUID-C3876793-A7D6-4D98-8C4E-6B79DA4403FF">
                     <p class="notep1">注意：</p>
                     <p>从Oracle Database 12c第1版（12.1）开始，不推荐使用非CDB体系结构。它可以在将来的版本中得到支持。</p>
                  </div>
                  <ol>
                     <li>
                        <p>关闭数据库。对于非CDB和CDB，语法是相同的。</p><pre class="pre codeblock"><code>SQL&gt; SHUTDOWN IMMEDIATE</code></pre></li>
                     <li>
                        <p>以<code>UPGRADE</code>模式重新启动数据库。
                        </p>
                        <p>对于非CDB：</p><pre class="pre codeblock"><code>SQL&gt; STARTUP UPGRADE</code></pre><p>对于CDB：</p><pre class="pre codeblock"><code>SQL&gt; STARTUP UPGRADE SQL&gt; alter pluggable database all open upgrade;</code></pre></li>
                     <li>
                        <p>重新运行并行升级实用程序（ <code>catctl.pl</code>或<code>dbupgrade</code> shell命令）。
                        </p>
                        <p>您可以根据需要多次重新运行并行升级实用程序。</p>
                        <p>使用CDB，您可以使用Resume选项（ <code class="codeph">-R</code> ）重新运行Parallel Upgrade Utility。该脚本从失败的阶段恢复升级。
                        </p>
                        <p>例如：</p><pre class="pre codeblock"><code>$ ORACLE_HOME / perl / bin / perl catctl.pl -n 4 -R -l $ ORACLE_HOME / cfgtoollogs catupgrd.sql</code></pre><p>您还可以提供要重新运行升级的一个或多个特定PDB的名称。</p>
                        <p>例如，此命令重新运行名为<code class="codeph">cdb1_pdb1</code>的PDB上的升级：</p><pre class="pre codeblock"><code>$ ORACLE_HOME / perl / bin / perl catctl.pl -n 4 -R -l $ ORACLE_HOME / cfgtoollogs -c'cdb1_pdb1'catupgrd.sql</code></pre><p>您可以使用<code>dbupgrade</code> shell命令运行相同的命令：</p><pre class="pre codeblock"><code>dbupgrade -n 4 -R -l $ ORACLE_HOME / diagnostics dbupgrade -n 4 -R -l $ ORACLE_HOME / diagnostics -c'cdb1_pdb1'</code></pre></li>
                     <li>
                        <p>运行<code>utlusts.sql</code> ，即升级后状态工具，它提供假脱机日志中升级状态的摘要。您可以在完成升级之前或之后的任何时间运行<code>utlusts.sql</code> ，但不能在升级期间运行。
                        </p>
                        <p>在非CDB中：</p><pre class="pre codeblock"><code>SQL&gt; @ $ ORACLE_HOME / rdbms / admin / utlusts.sql</code></pre><p>在国家开发银行：</p><pre class="pre codeblock"><code>$ ORACLE_HOME / perl / bin / perl catcon.pl -n 1 -e -b utlu122s -d'''。''''utlusts.sql</code></pre><p>如果<code class="codeph">utlusts.sql</code>脚本返回错误或显示非<code class="codeph">VALID</code>或不是最新版本的组件，请按照故障排除过程获取更多信息。
                        </p>
                     </li>
                     <li>
                        <p>运行<code>utlrp.sql</code>以重新编译任何剩余的存储的PL / SQL和Java代码。
                        </p><pre class="pre codeblock"><code>$ ORACLE_HOME / perl / bin / perl catcon.pl -n 1 -e -b utlrp -d'''。'''utlrp.sql</code></pre><p>该脚本生成日志文件<code class="codeph">utlrp0.log</code> ，该文件显示重新编译的结果。
                        </p>
                        <p>使用以下SQL命令验证所有预期的包和类是否有效，</p>
                        <p>在单个PDB（本例中为<code class="codeph">cdb1_pdb1</code> ）中，按正常模式打开PDB，如下所示：</p><pre class="pre codeblock"><code>alter pluggable database cdb1_pdb1 open;</code></pre><p>运行<code class="codeph">catcon.pl</code>以在PDB中启动<code class="codeph">utlrp.sql</code>以重新编译任何剩余的存储的PL / SQL和Java代码。使用以下语法：</p><pre class="pre codeblock"><code>$ ORACLE_HOME / perl / bin / perl catcon.pl -n 1 -e -b utlrp -d'''。''' -  c'cdb1_pdb1'utlrp.sql</code></pre><p>在非CDB中：</p><pre class="pre codeblock"><code>SQL&gt; SELECT count（*）FROM dba_invalid_objects; SQL&gt; SELECT distinct object_name FROM dba_invalid_objects;</code></pre><p>在整个CDB中：</p><pre class="pre codeblock"><code>SQL&gt; ALTER SESSION SET CONTAINER =“CDB $ ROOT”SQL&gt; SELECT count（*）FROM dba_invalid_objects; SQL&gt; SELECT distinct object_name FROM dba_invalid_objects; SQL&gt; ALTER SESSION SET CONTAINER =“PDB $ SEED”SQL&gt; SELECT count（*）FROM dba_invalid_objects; SQL&gt; SELECT distinct object_name FROM dba_invalid_objects; SQL&gt; ALTER SESSION SET CONTAINER =“cdb1_pdb1”SQL&gt; SELECT count（*）FROM dba_invalid_objects; SQL&gt; SELECT distinct object_name FROM dba_invalid_objects;</code></pre></li>
                     <li>
                        <p>再次运行<code>utlusts.sql</code>以验证是否已修复所有问题。
                        </p>
                        <p>在非CDB中：</p><pre class="pre codeblock"><code>SQL&gt; @ $ ORACLE_HOME / rdbms / admin / utlusts.sql</code></pre><p>在国家开发银行：</p><pre class="pre codeblock"><code>$ ORACLE_HOME / perl / bin / perl catcon.pl -n 1 -e -b utlu122s -d'''。''''utlusts.sql</code></pre></li>
                     <li>
                        <p>退出SQL * Plus。</p>
                     </li>
                     <li>
                        <p>如果要从版本11.2升级群集数据库，请使用以下命令语法升级Oracle Clusterware中的数据库配置，其中<code class="codeph"><span class="variable" translate="no">db-unique-name</span></code>是分配给它的数据库名称（不是实例名称）， <code class="codeph"><span class="variable" translate="no">Oracle_home</span></code>是Oracle数据库升级的主位置。
                        </p><pre class="pre codeblock"><code>$ srvctl upgrade database -d <span class="variable" translate="no">db-unique-name</span> -o <span class="variable" translate="no">Oracle_home</span>
</code></pre></li>
                  </ol>
                  <div class="section">
                     <p>您的数据库现已升级。您已准备好完成Oracle数据库的升级后任务。</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="rerunning-upgrades-oracle-database.html#GUID-CF18A968-0C0E-4223-AA9F-37B39F31ACBA">重新启动多租户数据库（CDB）升级的选项</a></li>
                        <li><a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2">Oracle数据库升级故障排除</a></li>
                        <li><a href="post-upgrade-tasks-oracle-database.html#GUID-637ADBD0-866B-4B64-9513-4C7CDE84895C">Oracle数据库的升级后任务</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="rerunning-upgrades-oracle-database.html#GUID-190D00A4-BE9A-4139-B3FC-A29C2BFBE91B" title="使用这些选项重新运行升级。">重新运行Oracle数据库升级</a></p>
                     </div>
                  </div>
               </div>
            </div>
            <div class="props_rev_3"><a id="GUID-CF18A968-0C0E-4223-AA9F-37B39F31ACBA" name="GUID-CF18A968-0C0E-4223-AA9F-37B39F31ACBA"></a><h3 id="UPGRD-GUID-CF18A968-0C0E-4223-AA9F-37B39F31ACBA" class="sect3">重新启动多租户数据库（CDB）升级的选项</h3>
               <div>
                  <p>您可以使用四个选项来重新运行Oracle Database 12c第2版（12.2）的多租户数据库体系结构（CDB）上的升级。</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="rerunning-upgrades-oracle-database.html#GUID-AA02C085-6155-467E-AFF3-FB409C69E3B1">重新运行CDB的整个升级</a><br>如果在第一次升级尝试期间发生了几个不同的问题，请使用此过程重新运行整个升级。
                     </li>
                     <li class="ulchildlink"><a href="rerunning-upgrades-oracle-database.html#GUID-226F1EBA-3272-4BD2-A5FA-D08ED1BA5808">仅在指定的CDB上重新运行升级</a><br>您可以通过使用“恢复”选项（ <code class="codeph">-R</code> ）或“排除列表”选项（ <code class="codeph">-C</code> ）运行“并行升级实用程序”来重新运行指定多租户容器上的升级。
                     </li>
                     <li class="ulchildlink"><a href="rerunning-upgrades-oracle-database.html#GUID-BC8D35BA-2FDE-434C-936B-E7432B2F00AA">其他PDB在线时重新运行升级</a><br>您可以使用“并行升级实用程序恢复”选项重新运行PDB升级，也可以使用包含或排除列表明确包含或排除在线PDB。
                     </li>
                     <li class="ulchildlink"><a href="rerunning-upgrades-oracle-database.html#GUID-B8C68634-CB6B-415D-BB31-E8E11EBAF742">使用包含列表重新运行升级以指定CDB或PDB</a><br>使用此示例作为通过使用包含列表重新运行PDB上的升级的模型。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="rerunning-upgrades-oracle-database.html#GUID-190D00A4-BE9A-4139-B3FC-A29C2BFBE91B" title="使用这些选项重新运行升级。">重新运行Oracle数据库升级</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="props_rev_3"><a id="GUID-AA02C085-6155-467E-AFF3-FB409C69E3B1" name="GUID-AA02C085-6155-467E-AFF3-FB409C69E3B1"></a><h4 id="UPGRD-GUID-AA02C085-6155-467E-AFF3-FB409C69E3B1" class="sect4">重新运行CDB的整个升级</h4>
                  <div>
                     <p>如果在第一次升级尝试期间发生了几个不同的问题，请使用此过程重新运行整个升级。</p>
                     <p>此示例演示了在初始升级尝试期间发生问题（例如用完共享池）后，再次在<code class="codeph">CDB$ROOT</code> ， <code class="codeph">PDB$SEED</code>和所有PDB上运行升级。
                     </p>
                     <ol>
                        <li>
                           <p>再次开始升级。例如：</p><pre class="pre codeblock"><code>SQL&gt;启动升级; alter pluggable database全部开放升级;</code></pre></li>
                        <li>
                           <p>运行并行升级实用程序（ <code>catctl.pl</code>或<code>dbupgrade</code> shell脚本）。例如：</p> <pre class="pre codeblock"><code>cd $ ORACLE_HOME / bin / ./dbupgrade -d $ ORACLE_HOME / rdbms / admin -l $ ORACLE_HOME / rdbms / log</code></pre><p>升级在所有容器上再次运行，包括<code class="codeph">CDB$ROOT</code> ， <code class="codeph">PDB$SEED</code>和CDB中的所有PDB。</p>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="rerunning-upgrades-oracle-database.html#GUID-CF18A968-0C0E-4223-AA9F-37B39F31ACBA" title="您可以使用四个选项来重新运行Oracle Database 12c第2版（12.2）的多租户数据库体系结构（CDB）上的升级。">重新运行多租户数据库（CDB）升级的选项</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="props_rev_3"><a id="GUID-226F1EBA-3272-4BD2-A5FA-D08ED1BA5808" name="GUID-226F1EBA-3272-4BD2-A5FA-D08ED1BA5808"></a><h4 id="UPGRD-GUID-226F1EBA-3272-4BD2-A5FA-D08ED1BA5808" class="sect4">仅在指定的CDB上重新运行升级</h4>
                  <div>
                     <p>您可以通过使用“恢复”选项（ <code class="codeph">-R</code> ）或“排除列表”选项（ <code class="codeph">-C</code> ）运行“并行升级实用程序”来重新运行指定多租户容器上的升级。
                     </p>
                     <p>在以下两个示例中，多租户容器数据库包含五个PDB。所有升级都成功运行，但<code class="codeph">CDB1_PDB1</code>和<code class="codeph">CDB1_PDB2</code> ，它因升级错误而失败。要在这两个容器上运行升级，请关闭整个多租户数据库，并仅重新启动要升级的PDB。
                     </p>
                     <div class="infoboxnote" id="GUID-226F1EBA-3272-4BD2-A5FA-D08ED1BA5808__GUID-55112014-622E-47E2-8E6C-C59D19B603FF">
                        <p class="notep1">注意：</p>
                        <p>并行升级实用程序参数区分大小写。</p>
                     </div>
                     <div class="example" id="GUID-226F1EBA-3272-4BD2-A5FA-D08ED1BA5808__GUID-B75DB6FC-5DE9-4982-B5DA-FDF139B8A4C0">
                        <p class="titleinexample">示例4-40使用恢复选项重新运行升级</p>
                        <p>您可以使用并行升级实用程序恢复参数选项<code>-R</code>仅在一个或多个多租户容器（CDB）上重新运行升级。
                        </p>
                        <p>在以下示例中，升级脚本检测到它应仅在<code class="codeph">CDB1_PDB1</code>和<code class="codeph">CDB1_PDB2</code>容器上运行。
                        </p>
                        <ol>
                           <li>
                              <p>关闭多租户数据库，以升级模式启动数据库，然后启动升级未完成的PDB。例如：</p><pre class="pre codeblock"><code>SQL&gt; shutdown immediate;启动升级; alter pluggable database CDB1_PDB1 open upgrade; alter pluggable database CDB1_PDB2 open upgrade;</code></pre></li>
                           <li>
                              <p>显示CDB和PDB状态：</p><pre class="pre codeblock"><code>SQL&gt; show pdbs CON_ID CON_NAME OPEN MODE RESTRICTED ---------- ------------------------------  - --------- ---------- 2 PDB $ SEED MIGRATE YES 3 CDB1_PDB1 MIGRATE YES 4 CDB1_PDB2 MIGRATE YES 5 CDB1_PDB3安装6 CDB1_PDB4安装7 CDB1_PDB5安装</code></pre></li>
                           <li>
                              <p>重新运行升级。升级会自动从先前的升级日志中检测到CDB $ ROOT和PDB $ SEED已成功升级。升级绕过CDB $ ROOT和PDB $ SEED，并且仅在CDB1_PDB1和CDB_PDB2上运行。这里的命令示例适用于Linux / UNIX系统：</p><pre class="pre codeblock"><code>cd $ ORACLE_HOME / bin ./dbupgrade -d $ ORACLE_HOME / rdbms / admin -l $ ORACLE_HOME / cfgtoollogs -R</code></pre></li>
                        </ol>
                        <p>并行升级实用程序完成<code class="codeph">CDB1_PDB1</code>和<code class="codeph">CDB1_PDB2</code>的升级。
                        </p>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-226F1EBA-3272-4BD2-A5FA-D08ED1BA5808__GUID-128F4B45-EE79-40B5-A847-E7084AB33384">
                        <p class="titleinexample">示例4-41使用排除列表重新运行升级</p>
                        <p>排除列表包含您不想升级的容器。排除列表使用Parallel Upgrade Utility <code>-C</code>参数选项。通过将目录更改为<code><span class="variable" translate="no">Oracle_home</span> /rdbms/admin/</code>并使用<code>catctl.pl</code>在Perl中运行该实用程序，或者将目录更改为<code><span class="variable" translate="no">Oracle_home</span> /bin</code>并运行命令行脚本<code>dbupgrade -C</code>来运行并行升级实用程序。当您有许多要重新运行升级的PDB时，此方法很有用。
                        </p>
                        <p>在以下示例中，您提供了一个排除列表，以排除升级脚本在您不需要运行的容器上运行。</p>
                        <ol>
                           <li>
                              <p>关闭多租户数据库，以升级模式启动数据库，然后启动升级未完成的PDB。例如：</p><pre class="pre codeblock"><code>SQL&gt; shutdown immediate;启动升级; alter pluggable database CDB1_PDB1 open upgrade; alter pluggable database CDB1_PDB2 open upgrade;</code></pre></li>
                           <li>
                              <p>显示CDB和PDB状态：</p><pre class="pre codeblock"><code>SQL&gt; show pdbs CON_ID CON_NAME OPEN MODE RESTRICTED ---------- ------------------------------  - --------- ---------- 2 PDB $ SEED MIGRATE YES 3 CDB1_PDB1 MIGRATE YES 4 CDB1_PDB2 MIGRATE YES 5 CDB1_PDB3安装6 CDB1_PDB4安装7 CDB1_PDB5安装</code></pre></li>
                           <li>
                              <p>在您使用单引号指定的以空格分隔的排除列表中，重新运行升级，不包括升级中的<code class="codeph">CDB$ROOT</code>和<code class="codeph">PDB$SEED</code> 。这里的命令示例适用于Linux / UNIX系统：</p><pre class="pre codeblock"><code>$ ORACLE_HOME / bin / dbupgrade -d $ ORACLE_HOME / rdbms / admin -l $ ORACLE_HOME / rdbms / log -C'CDB $ ROOT PDB $ SEED'</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="example" -->
                     <p>升级重新运行，并在<code class="codeph">CDB1_PDB1</code>和<code class="codeph">CDB1_PDB2</code>上完成。
                     </p>
                     <div class="infoboxnote" id="GUID-226F1EBA-3272-4BD2-A5FA-D08ED1BA5808__GUID-5C0750DB-9D77-4EC5-A370-B15FC92E9ED8">
                        <p class="notep1">注意：</p>
                        <p>对于Windows，必须使用双引号指定排除列表来指定<code class="codeph">-C</code>选项排除列表。例如：</p><pre class="pre codeblock"><code>... -C“CDB $ ROOT PDB $ SEED”</code></pre></div>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="rerunning-upgrades-oracle-database.html#GUID-CF18A968-0C0E-4223-AA9F-37B39F31ACBA" title="您可以使用四个选项来重新运行Oracle Database 12c第2版（12.2）的多租户数据库体系结构（CDB）上的升级。">重新运行多租户数据库（CDB）升级的选项</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="props_rev_3"><a id="GUID-BC8D35BA-2FDE-434C-936B-E7432B2F00AA" name="GUID-BC8D35BA-2FDE-434C-936B-E7432B2F00AA"></a><h4 id="UPGRD-GUID-BC8D35BA-2FDE-434C-936B-E7432B2F00AA" class="sect4">其他PDB在线时重新运行升级</h4>
                  <div>
                     <p>您可以使用“并行升级实用程序恢复”选项重新运行PDB升级，也可以使用包含或排除列表明确包含或排除在线PDB。</p>
                     <p>使用这些示例作为在PDB上运行升级的模型，您希望在其他PDB打开时重新运行某些PDB上的升级。</p>
                     <p>在示例中，容器<code class="codeph">CDB1_PDB1</code>和<code class="codeph">CDB1_PDB2</code>的升级失败，但在容器<code class="codeph">CDB1_PDB3</code> ， <code class="codeph">CDB1_PDB4</code>和<code class="codeph">CDB1_PDB5</code>成功<code class="codeph">CDB1_PDB5</code> 。
                     </p>
                     <p>您在正常模式下启动<code class="codeph">CDB$ROOT</code> 。您发现以下容器在线： <code class="codeph">CDB1_PDB3</code> ， <code class="codeph">CDB1_PDB4</code>和<code class="codeph">CDB1_PDB5</code> 。您查看<code class="codeph">CDB1_PDB3</code> ， <code class="codeph">CDB1_PDB4</code>和<code class="codeph">CDB1_PDB5</code>的升级日志，并将这些容器联机。
                     </p>
                     <p></p>
                     <div class="example" id="GUID-BC8D35BA-2FDE-434C-936B-E7432B2F00AA__GUID-E28BE9B3-BE6B-45AA-8C58-1B34A27275FB">
                        <p class="titleinexample">示例4-42使用恢复选项重新启动PDB上的升级</p>
                        <p>以下示例说明如何使用“Parallel Upgrade Utility Resume”选项完成<code class="codeph">CDB1_PDB1</code>和<code class="codeph">CDB1_PDB2</code>的升级。“恢复”选项排除已升级的PDB：</p>
                        <ol>
                           <li>
                              <p>在正常模式下启动<code class="codeph">CDB$ROOT</code> ，并在升级模式下打开<code class="codeph">CDB1_PDB1</code>和<code class="codeph">CDB1_PDB2</code> 。<code class="codeph">CDB1_PDB3</code> ， <code class="codeph">CDB1_PDB4</code> ， <code class="codeph">CDB1_PDB5</code>处于正常模式。例如：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; startup; alter pluggable database CDB1_PDB1 open upgrade; alter pluggable database CDB1_PDB2 open upgrade; alter pluggable database cdb1_pdb3 open; alter pluggable database cdb1_pdb4 open; alter pluggable database cdb1_pdb5 open;</pre></li>
                           <li>
                              <p>使用SQL命令<code>show pdbs</code>显示PDB的状态。例如：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; show pdbs CON_ID CON_NAME OPEN MODE RESTRICTED ---------- ------------------------------  - --------- ---------- 2 PDB $ SEED READ ONLY NO 3 CDB1_PDB1 MIGRATE YES 4 CDB1_PDB2 MIGRATE YES 5 CDB1_PDB3 READ WRITE NO 6 CDB1_PDB4 READ WRITE NO 7 CDB1_PDB5 READ WRITE NO</pre></li>
                           <li>
                              <p>使用Parallel Upgrade Utility命令行脚本<code>dbupgrade</code>重新运行升级，不包括升级中的<code class="codeph">CDB$ROOT</code> 。
                              </p><pre class="pre codeblock"><code>cd $ ORACLE_HOME / bin ./dbupgrade -d $ ORACLE_HOME / rdbms / admin / -l $ ORACLE_HOME / cfgtoollogs -R</code></pre><p>因为你运行使用Resume选项升级，并行升级实用程序检查日志，并确定了<code class="codeph">CDB1_PDB1</code>和<code class="codeph">CDB1_PDB2</code>是仅有的两个集装箱<code class="codeph">CDB1</code>没有升级。升级脚本仅在这两个PDB上运行。升级不会在<code class="codeph">PDB$SEED</code> ， <code class="codeph">CDB$ROOT</code> ， <code class="codeph">CDB_PDB3</code> ， <code class="codeph">CDB_PDB4</code>和<code class="codeph">CDB_PDB5</code>上重新运行。
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-BC8D35BA-2FDE-434C-936B-E7432B2F00AA__GUID-07447E6C-9536-4DD9-9BF2-A52327B34F76">
                        <p class="titleinexample">示例4-43使用排除列表重新启动PDB上的升级</p>
                        <p>以下示例显示如何使用排除列表排除<code class="codeph">CDB1_PDB1</code>和<code class="codeph">CDB1_PDB2</code>的升级，以排除不希望运行升级脚本的PDB：</p>
                        <ol>
                           <li>
                              <p>在正常模式下启动<code class="codeph">CDB$ROOT</code> ，并在升级模式下打开<code class="codeph">CDB1_PDB1</code>和<code class="codeph">CDB1_PDB2</code> 。<code class="codeph">CDB1_PDB3</code> ， <code class="codeph">CDB1_PDB4</code> ， <code class="codeph">CDB1_PDB5</code>处于正常模式。例如：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; startup; alter pluggable database CDB1_PDB1 open upgrade; alter pluggable database CDB1_PDB2 open upgrade; alter pluggable database cdb1_pdb3 open; alter pluggable database cdb1_pdb4 open; alter pluggable database cdb1_pdb5 open;</pre></li>
                           <li>
                              <p>使用SQL命令<code>show pdbs</code>显示PDB的状态。例如：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; show pdbs CON_ID CON_NAME OPEN MODE RESTRICTED ---------- ------------------------------  - --------- ---------- 2 PDB $ SEED READ ONLY NO 3 CDB1_PDB1 MIGRATE YES 4 CDB1_PDB2 MIGRATE YES 5 CDB1_PDB3 READ WRITE NO 6 CDB1_PDB4 READ WRITE NO 7 CDB1_PDB5 READ WRITE NO</pre></li>
                           <li>
                              <p>使用Parallel Upgrade Utility命令行脚本<code>dbupgrade</code>重新运行升级，不包括升级中的<code class="codeph">CDB$ROOT</code> ：</p><pre class="pre codeblock"><code>cd $ ORACLE_HOME / bin ./dbupgrade -d $ ORACLE_HOME / rdbms / admin -l $ ORACLE_HOME / cfgtoollogs -R -C'CDB $ ROOT'</code></pre><p>并行升级实用程序使用Resume选项（ <code class="codeph">-R</code> ）运行，并从日志中识别CDB1_PDB1和</p>
                              <p>CDB1_PDB2尚未完成升级。由于并行升级实用程序使用“排除”选项（-C）运行，并且您指定排除了<code class="codeph">CDB$ROOT</code> ，因此还明确排除了在<code class="codeph">CDB$ROOT</code>上运行的升级脚本。</p>
                              <p>对于Windows，当您使用“排除”选项（ <code class="codeph">-C</code> ）运行并行升级实用程序时，必须使用CDB根名称和PDB种子名称周围的双引号指定目标<code>-C</code>选项。例如：</p><pre class="pre codeblock"><code>。 。 。 -C“CDB $ ROOT PDB $ SEED”</code></pre></li>
                           <li>
                              <p>升级在<code class="codeph">CDB1_PDB1</code>和<code class="codeph">CDB1_PDB2</code>上重新运行并完成。
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="rerunning-upgrades-oracle-database.html#GUID-CF18A968-0C0E-4223-AA9F-37B39F31ACBA" title="您可以使用四个选项来重新运行Oracle Database 12c第2版（12.2）的多租户数据库体系结构（CDB）上的升级。">重新运行多租户数据库（CDB）升级的选项</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="props_rev_3"><a id="GUID-B8C68634-CB6B-415D-BB31-E8E11EBAF742" name="GUID-B8C68634-CB6B-415D-BB31-E8E11EBAF742"></a><h4 id="UPGRD-GUID-B8C68634-CB6B-415D-BB31-E8E11EBAF742" class="sect4">使用包含列表重新运行升级以指定CDB或PDB</h4>
                  <div>
                     <p>使用此示例作为通过使用包含列表重新运行PDB上的升级的模型。</p>
                     <p>您可以使用包含列表指定要重新运行升级的CDB和PDB列表，并排除不在包含列表中的节点。通过使用包含选项（ <code class="codeph">-c</code> ）运行并行升级实用程序，然后使用要升级的容器的单引号指定的空格分隔列表来指定包含列表。
                     </p>
                     <p>在示例中，容器CDB1_PDB1和CDB1_PDB2中的升级失败，但在容器CDB1_PDB3，CDB1_PDB4和CDB1_PDB5中成功完成。您在正常模式下启动CDB $ ROOT。您发现以下容器在线：CDB1_PDB3，CDB1_PDB4和CDB1_PDB5。您查看CDB1_PDB3，CDB1_PDB4和CDB1_PDB5的升级日志，并将这些容器联机。</p>
                     <div class="example" id="GUID-B8C68634-CB6B-415D-BB31-E8E11EBAF742__GUID-DCE99A6B-AEAA-41E9-AD83-5B4643B2A229">
                        <p class="titleinexample">示例4-44使用包含列表重新启动PDB上的升级</p>
                     </div>
                     <!-- class="example" -->
                     <p>例如：</p>
                     <ol>
                        <li>
                           <p>在正常模式下启动<code class="codeph">CDB$ROOT</code> ，并在升级模式下打开<code class="codeph">CDB1_PDB1</code>和<code class="codeph">CDB1_PDB2</code> 。<code class="codeph">CDB1_PDB3</code> ， <code class="codeph">CDB1_PDB4</code> ， <code class="codeph">CDB1_PDB5</code>处于正常模式。例如：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; startup; alter pluggable database CDB1_PDB1 open upgrade; alter pluggable database CDB1_PDB2 open upgrade; alter pluggable database cdb1_pdb3 open; alter pluggable database cdb1_pdb4 open; alter pluggable database cdb1_pdb5 open;</pre></li>
                        <li>
                           <p>使用SQL命令<code>show pdbs</code>显示PDB的状态。例如：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; show pdbs CON_ID CON_NAME OPEN MODE RESTRICTED ---------- ------------------------------  - --------- ---------- 2 PDB $ SEED READ ONLY NO 3 CDB1_PDB1 MIGRATE YES 4 CDB1_PDB2 MIGRATE YES 5 CDB1_PDB3 READ WRITE NO 6 CDB1_PDB4 READ WRITE NO 7 CDB1_PDB5 READ WRITE NO</pre></li>
                        <li>
                           <p>使用包含（-c）选项重新运行并行升级实用程序，然后使用单引号指定空格分隔的包含列表。此选项仅在您在包含列表中列出的PDB上运行升级。</p>
                           <p>例如：</p><pre class="pre codeblock"><code>cd $ ORACLE_HOME / bin ./dbupgrade -d $ ORACLE_HOME / rdbms / admin -l ORACLE_HOME / cfgtoollogs -R -c'CDB1_PDB1 CDB1_PDB2'</code></pre><p>对于Windows，当您使用包含选项运行并行升级实用程序时，必须通过在包含列表周围使用双引号来指定<code class="codeph">-c</code>选项目标。例如：</p><pre class="pre codeblock"><code>。 。 。 -C“CDB1_PDB1 CDB1_PDB2”</code></pre></li>
                        <li>
                           <p>升级在<code class="codeph">CDB1_PDB1</code>和<code class="codeph">CDB1_PDB2</code>上重新运行并完成。
                           </p>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="rerunning-upgrades-oracle-database.html#GUID-CF18A968-0C0E-4223-AA9F-37B39F31ACBA" title="您可以使用四个选项来重新运行Oracle Database 12c第2版（12.2）的多租户数据库体系结构（CDB）上的升级。">重新运行多租户数据库（CDB）升级的选项</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>