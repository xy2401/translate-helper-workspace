<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>LISTAGG</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="SQL Language Reference ">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="SQL Language Reference">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="sql-language-reference.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-12T15:36:36-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96310-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="LENGTH.html" title="Previous" type="text/html">
      <link rel="next" href="LN.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="SQL Language Reference">
    <meta name="dcterms.isVersionOf" content="SQLRF">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="LENGTH.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="LN.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL Language Reference </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="Functions.html" property="item" typeof="WebPage"><span property="name">Functions</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">LISTAGG </li>
            </ol>
            <a id="GUID-B6E50D8E-F467-425B-9436-F7F8BF38D466" name="GUID-B6E50D8E-F467-425B-9436-F7F8BF38D466"></a><a id="SQLRF51485"></a><a id="SQLRF51486"></a><a id="SQLRF51487"></a><a id="SQLRF55594"></a><a id="SQLRF30030"></a>
            
            <h2 id="SQLRF-GUID-B6E50D8E-F467-425B-9436-F7F8BF38D466" class="sect2">LISTAGG </h2>
         </header>
         <div class="ind">
            <div>
               <div class="section">
                  <p class="subhead1" id="GUID-B6E50D8E-F467-425B-9436-F7F8BF38D466__GUID-8D066B73-3954-4630-B304-9E5FAEA84E05">Syntax</p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <div class="figure" id="GUID-B6E50D8E-F467-425B-9436-F7F8BF38D466__GUID-95966F30-F852-4146-879D-0B7531840B0F"><img src="img/listagg.gif" alt="Description of listagg.eps follows" title="Description of listagg.eps follows" longdesc="img_text/listagg.html"><br><a href="img_text/listagg.html">Description of the illustration listagg.eps</a></div>
                  <!-- class="figure" -->
                  <p>(<span class="italic"><a href="LISTAGG.html#GUID-B6E50D8E-F467-425B-9436-F7F8BF38D466__LISTAGG_OVERFLOW_CLAUSE-1E9397E4">listagg_overflow_clause::=</a></span>, <span class="italic"><a href="Analytic-Functions.html#GUID-527832F7-63C0-4445-8C16-307FA5084056__ORDER_BY_CLAUSE-1E92A06C">order_by_clause::=</a></span>, <span class="italic"><a href="Analytic-Functions.html#GUID-527832F7-63C0-4445-8C16-307FA5084056__QUERY_PARTITION_CLAUSE-1E92A25F">query_partition_clause::=</a></span>)
                  </p>
               </div>
               <!-- class="section" -->
               <div class="section" id="GUID-B6E50D8E-F467-425B-9436-F7F8BF38D466__LISTAGG_OVERFLOW_CLAUSE-1E9397E4">
                  <p class="subhead1" id="GUID-B6E50D8E-F467-425B-9436-F7F8BF38D466__GUID-D5170A93-38FE-4C84-83AA-5D3D057908FA"><span class="italic">listagg_overflow_clause</span>::=
                  </p>
                  <div class="figure" id="GUID-B6E50D8E-F467-425B-9436-F7F8BF38D466__GUID-21131D19-1DC6-465E-8C16-F039FBCD35B6"><img src="img/listagg_overflow_clause.gif" alt="Description of listagg_overflow_clause.eps follows" title="Description of listagg_overflow_clause.eps follows" longdesc="img_text/listagg_overflow_clause.html"><br><a href="img_text/listagg_overflow_clause.html">Description of the illustration listagg_overflow_clause.eps</a></div>
                  <!-- class="figure" -->
                  <div class="infoboxnotealso" id="GUID-B6E50D8E-F467-425B-9436-F7F8BF38D466__GUID-142DEBFE-9944-4EF6-BE3E-4B99DA59BACF">
                     <p class="notep1">See Also:</p>
                     <p><span class="q">"<a href="Analytic-Functions.html#GUID-527832F7-63C0-4445-8C16-307FA5084056">Analytic Functions</a>"</span> for information on syntax, semantics, and restrictions of the <code class="codeph">ORDER</code> <code class="codeph">BY</code> clause and <code class="codeph">OVER</code> clause
                     </p>
                  </div>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-B6E50D8E-F467-425B-9436-F7F8BF38D466__GUID-E662AA32-79AF-4707-B088-8D2D449D527F">Purpose</p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p>For a specified measure, <code class="codeph">LISTAGG</code> orders data within each group specified in the <code class="codeph">ORDER</code> <code class="codeph">BY</code> clause and then concatenates the values of the measure column. 
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>As a single-set aggregate function, <code class="codeph">LISTAGG</code> operates on all rows and returns a single output row. 
                        </p>
                     </li>
                     <li>
                        <p>As a group-set aggregate, the function operates on and returns an output row for each group defined by the <code class="codeph">GROUP</code> <code class="codeph">BY</code> clause.
                        </p>
                     </li>
                     <li>
                        <p>As an analytic function, <code class="codeph">LISTAGG</code> partitions the query result set into groups based on one or more expression in the <span class="italic"><code class="codeph">query_partition_clause</code></span>.
                        </p>
                     </li>
                  </ul>
                  <p>The arguments to the function are subject to the following rules:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>The <code class="codeph">ALL</code> keyword is optional and is provided for semantic clarity.
                        </p>
                     </li>
                     <li>
                        <p>The <span class="italic"><code class="codeph">measure_expr</code></span> is the measure column and can be any expression. Null values in the measure column are ignored.
                        </p>
                     </li>
                     <li>
                        <p>The <span class="italic"><code class="codeph">delimiter</code></span> designates the string that is to separate the measure column values. This clause is optional and defaults to <code class="codeph">NULL</code>.
                        </p>
                        <p>If <code class="codeph">measure_expr</code> is of type <code class="codeph">RAW</code>, then the delimiter must be of type <code class="codeph">RAW</code>. You can achieve this by specifying the delimiter as a character string that can be implicitly converted to <code class="codeph">RAW</code>, or by explicitly converting the delimiter to <code class="codeph">RAW</code>, for example, using the <code class="codeph">UTL_RAW.CAST_TO_RAW</code> function.
                        </p>
                     </li>
                     <li>
                        <p>The <span class="italic"><code class="codeph">order_by_clause</code></span> determines the order in which the concatenated values are returned. The function is deterministic only if the <code class="codeph">ORDER</code> <code class="codeph">BY</code> column list achieved unique ordering.
                        </p>
                     </li>
                  </ul>
                  <p>The <code class="codeph">DISTINCT</code> keyword removes duplicate values from the list.
                  </p>
                  <p>If the measure column is of type <code class="codeph">RAW</code>, then the return data type is <code class="codeph">RAW</code>. Otherwise, the return data type is <code class="codeph">VARCHAR2</code>.
                  </p>
                  <p>The maximum length of the return data type depends on the value of the <code class="codeph">MAX_STRING_SIZE</code> initialization parameter. If <code class="codeph">MAX_STRING_SIZE</code> <code class="codeph">=</code> <code class="codeph">EXTENDED</code>, then the maximum length is 32767 bytes for the <code class="codeph">VARCHAR2</code> and <code class="codeph">RAW</code> data types. If <code class="codeph">MAX_STRING_SIZE</code> <code class="codeph">=</code> <code class="codeph">STANDARD</code>, then the maximum length is 4000 bytes for the <code class="codeph">VARCHAR2</code> data type and 2000 bytes for the <code class="codeph">RAW</code> data type. A final delimiter is not included when determining if the return value fits in the return data type.
                  </p>
                  <div class="infoboxnotealso" id="GUID-B6E50D8E-F467-425B-9436-F7F8BF38D466__GUID-25DADA0A-030D-44EA-BBD1-5E30A618044E">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="Data-Types.html#GUID-8EFA29E9-E8D8-40A6-A43E-954908C954A4">Extended Data Types</a> for more information on the <code class="codeph">MAX_STRING_SIZE</code> initialization parameter
                           </p>
                        </li>
                        <li>
                           <p>Appendix C in <a href="../nlspg/appendix-C-collation-derivation-and-determination-rules-for-SQL-operations.html#NLSPG-GUID-AFCE41ED-775B-4A00-AF38-C436776AE0C5" target="_blank"><span class="italic">Oracle Database Globalization Support Guide</span></a> for the collation derivation rules, which define the collation assigned to the character return value of <code class="codeph">LISTAGG</code></p>
                        </li>
                        <li>
                           <p><a href="../dwhsg/sql-analysis-reporting-data-warehouses.html#DWHSG-GUID-EDBADEC3-4DC5-4A3A-85EF-B64C45910B1D" target="_blank"><span class="italic">Database Data Warehousing Guide</span></a> for details.
                           </p>
                        </li>
                     </ul>
                  </div>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-B6E50D8E-F467-425B-9436-F7F8BF38D466__GUID-2A28C965-F976-4CFC-9DFD-1659CBEF0880"><span class="italic">listagg_overflow_clause</span></p>
                  <p>This clause controls how the function behaves when the return value exceeds the maximum length of the return data type.</p>
                  <p><span class="bold">ON OVERFLOW ERROR</span>&nbsp;If you specify this clause, then the function returns an ORA-01489 error. This is the default.
                  </p>
                  <p><span class="bold">ON OVERFLOW TRUNCATE</span>&nbsp;If you specify this clause, then the function returns a truncated list of measure values.
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>The <span class="italic"><code class="codeph">truncation_indicator</code></span> designates the string that is to be appended to the truncated list of measure values. If you omit this clause, then the truncation indicator is an ellipsis (<code class="codeph">...</code>).
                        </p>
                        <p>If <span class="italic"><code class="codeph">measure_expr</code></span> is of type <code class="codeph">RAW</code>, then the truncation indicator must be of type <code class="codeph">RAW</code>. You can achieve this by specifying the truncation indicator as a character string that can be implicitly converted to <code class="codeph">RAW</code>, or by explicitly converting the truncation indicator to <code class="codeph">RAW</code>, for example, using the <code class="codeph">UTL_RAW.CAST_TO_RAW</code> function.
                        </p>
                     </li>
                     <li>
                        <p>If you specify <code class="codeph">WITH</code> <code class="codeph">COUNT</code>, then after the truncation indicator, the database appends the number of truncated values, enclosed in parentheses. In this case, the database truncates enough measure values to allow space in the return value for a final delimiter, the truncation indicator, and 24 characters for the number value enclosed in parentheses.
                        </p>
                     </li>
                     <li>
                        <p>If you specify <code class="codeph">WITHOUT</code> <code class="codeph">COUNT</code>, then the database omits the number of truncated values from the return value. In this case, the database truncates enough measure values to allow space in the return value for a final delimiter and the truncation indicator.
                        </p>
                     </li>
                  </ul>
                  <p>If you do not specify <code class="codeph">WITH</code> <code class="codeph">COUNT</code> or <code class="codeph">WITHOUT</code> <code class="codeph">COUNT</code>, then the default is <code class="codeph">WITH</code> <code class="codeph">COUNT</code>.
                  </p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-B6E50D8E-F467-425B-9436-F7F8BF38D466__GUID-05A6D392-77B2-4387-BBDF-BBB2839CFDF0">Aggregate Examples</p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p>The following single-set aggregate example lists all of the employees in Department 30 in the <code class="codeph">hr.employees</code> table, ordered by hire date and last name:
                  </p><pre class="oac_no_warn" dir="ltr">SELECT LISTAGG(last_name, '; ')
         WITHIN GROUP (ORDER BY hire_date, last_name) "Emp_list",
       MIN(hire_date) "Earliest"
  FROM employees
  WHERE department_id = 30;

Emp_list                                                     Earliest
------------------------------------------------------------ ---------
Raphaely; Khoo; Tobias; Baida; Himuro; Colmenares            07-DEC-02
</pre><p>The following group-set aggregate example lists, for each department ID in the <code class="codeph">hr.employees</code> table, the employees in that department in order of their hire date:
                  </p><pre class="oac_no_warn" dir="ltr">SELECT department_id "Dept.",
       LISTAGG(last_name, '; ') WITHIN GROUP (ORDER BY hire_date) "Employees"
  FROM employees
  GROUP BY department_id
  ORDER BY department_id;

Dept. Employees
------ ------------------------------------------------------------
    10 Whalen
    20 Hartstein; Fay
    30 Raphaely; Khoo; Tobias; Baida; Himuro; Colmenares
    40 Mavris
    50 Kaufling; Ladwig; Rajs; Sarchand; Bell; Mallin; Weiss; Davie
       s; Marlow; Bull; Everett; Fripp; Chung; Nayer; Dilly; Bissot
       ; Vollman; Stiles; Atkinson; Taylor; Seo; Fleaur; Matos; Pat
       el; Walsh; Feeney; Dellinger; McCain; Vargas; Gates; Rogers;
        Mikkilineni; Landry; Cabrio; Jones; Olson; OConnell; Sulliv
       an; Mourgos; Gee; Perkins; Grant; Geoni; Philtanker; Markle
    60 Austin; Hunold; Pataballa; Lorentz; Ernst
    70 Baer
. . .</pre><p>The following example is identical to the previous example, except it contains the <code class="codeph">ON</code> <code class="codeph">OVERFLOW</code> <code class="codeph">TRUNCATE</code> clause. For the purpose of this example, assume that the maximum length of the return value is an artificially small number of 200 bytes. Because the list of employees for department 50 exceeds 200 bytes, the list is truncated and appended with a final delimiter '<code class="codeph">;</code> ', the specified truncation indicator '<code class="codeph">...</code>', and the number of truncated values '<code class="codeph">(23)</code>'.
                  </p><pre class="oac_no_warn" dir="ltr">SELECT department_id "Dept.",
       LISTAGG(last_name, '; ' ON OVERFLOW TRUNCATE '...')
               WITHIN GROUP (ORDER BY hire_date) "Employees"
  FROM employees
  GROUP BY department_id
  ORDER BY department_id;

Dept. Employees
------ ------------------------------------------------------------
    10 Whalen
    20 Hartstein; Fay
    30 Raphaely; Khoo; Tobias; Baida; Himuro; Colmenares
    40 Mavris
    50 Kaufling; Ladwig; Rajs; Sarchand; Bell; Mallin; Weiss; Davie
       s; Marlow; Bull; Everett; Fripp; Chung; Nayer; Dilly; Bissot
       ; Vollman; Stiles; Atkinson; Taylor; Seo; Fleaur; ... (23)
    70 Baer
. . .</pre></div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-B6E50D8E-F467-425B-9436-F7F8BF38D466__GUID-9E152E77-ADC9-4CA6-AF0D-2119B7E24314">Analytic Example</p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p>The following analytic example shows, for each employee hired earlier than September 1, 2003, the employee's department, hire date, and all other employees in that department also hired before September 1, 2003:</p><pre class="oac_no_warn" dir="ltr">SELECT department_id "Dept", hire_date "Date", last_name "Name",
       LISTAGG(last_name, '; ') WITHIN GROUP (ORDER BY hire_date, last_name)
         OVER (PARTITION BY department_id) as "Emp_list"
  FROM employees
  WHERE hire_date &lt; '01-SEP-2003'
  ORDER BY "Dept", "Date", "Name";

 Dept Date      Name            Emp_list
----- --------- --------------- ---------------------------------------------
   30 07-DEC-02 Raphaely        Raphaely; Khoo
   30 18-MAY-03 Khoo            Raphaely; Khoo
   40 07-JUN-02 Mavris          Mavris
   50 01-MAY-03 Kaufling        Kaufling; Ladwig
   50 14-JUL-03 Ladwig          Kaufling; Ladwig
   70 07-JUN-02 Baer            Baer
   90 13-JAN-01 De Haan         De Haan; King
   90 17-JUN-03 King            De Haan; King
  100 16-AUG-02 Faviet          Faviet; Greenberg
  100 17-AUG-02 Greenberg       Faviet; Greenberg
  110 07-JUN-02 Gietz           Gietz; Higgins
  110 07-JUN-02 Higgins         Gietz; Higgins</pre></div>
               <!-- class="section" -->
            </div>
         </div>
      </article>
   </body>
</html>