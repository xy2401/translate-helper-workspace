<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>实施Commit-Confirm（仅限SNA）</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="User&#39;s Guide "></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-gateway-appc-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-04-16T18:35:49-07:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2002, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="F18239-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="developing-appc-client-app-sna-only.html" title="Previous" type="text/html"></link>
      <link rel="next" href="pg4tcpmap-commands-tcpip.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Gateway for APPC User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="APPUG"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="developing-appc-client-app-sna-only.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="pg4tcpmap-commands-tcpip.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">用户指导</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">实施Commit-Confirm（仅限SNA）</li>
            </ol>
            <a id="GUID-4129EE1E-A3C3-4285-B490-3DA1EA138DAA" name="GUID-4129EE1E-A3C3-4285-B490-3DA1EA138DAA"></a><a id="APPUG500"></a>
            
            <h2 id="APPUG-GUID-4129EE1E-A3C3-4285-B490-3DA1EA138DAA" class="sect2"><span class="enumeration_chapter">5</span>实施Commit-Confirm（仅限SNA）</h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d21932e29" class="indexterm-anchor"></a><a id="d21932e33" class="indexterm-anchor"></a> Commit-confirm允许更新本地Oracle资源，以便在更新通过Oracle Database Gateway for APPC访问的非Oracle资源的同一Oracle事务中进行。</p>
               <p>阅读以下主题以熟悉commit-confirm的元素和功能。</p>
               <p>您将在安装指南中找到有关在SNA环境中为commit-confirm配置网关组件的说明。有关具体信息，请参阅安装和配置指南中的第5章“配置网络”和第6章“使用SNA通信协议进行网关配置”。</p>
               <p>话题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="implement-appc-commit-confirm-sna-only.html#GUID-F621CC73-55CB-47D0-B18D-C99CBA46FF86">提交确认概述</a></p>
                  </li>
                  <li>
                     <p><a href="implement-appc-commit-confirm-sna-only.html#GUID-79F3DF5C-EAFC-427C-9747-9D5372040930">支持的OLTP</a></p>
                  </li>
                  <li>
                     <p><a href="implement-appc-commit-confirm-sna-only.html#GUID-8DE34F19-E50A-494E-BFD2-C5E1FD87A0E0">支持Commit-Confirm所需的组件</a></p>
                  </li>
                  <li>
                     <p><a href="implement-appc-commit-confirm-sna-only.html#GUID-F7D4F73A-5F4A-4BB0-AE84-47793A4D0380">应用设计要求</a></p>
                  </li>
                  <li>
                     <p><a href="implement-appc-commit-confirm-sna-only.html#GUID-DCF5A2B9-808F-4D4E-905F-2E612F516C55">提交确认架构</a></p>
                  </li>
                  <li>
                     <p><a href="implement-appc-commit-confirm-sna-only.html#GUID-2BB5FA7F-CC80-4716-9704-AA15CB535C17">提交确认流程</a></p>
                  </li>
               </ul>
            </div><a id="APPUG1007"></a><div class="props_rev_3"><a id="GUID-F621CC73-55CB-47D0-B18D-C99CBA46FF86" name="GUID-F621CC73-55CB-47D0-B18D-C99CBA46FF86"></a><h3 id="APPUG-GUID-F621CC73-55CB-47D0-B18D-C99CBA46FF86" class="sect3">提交确认概述</h3>
               <div>
                  <div class="infoboxnote" id="GUID-F621CC73-55CB-47D0-B18D-C99CBA46FF86__GUID-5812A6D4-6A09-4A5D-8C2A-C557EFAAA255">
                     <p class="notep1">注意：</p>
                     <p>如果您计划实施commit-confirm，那么您应该已经配置了组件。根据您的平台，请参阅<a href="../appci/configuring-appc-gateway-sna.html#APPCI216" target="_blank"><span class="italic">适用于POWER系统（64位）上的IBM AIX</span></a>的<a href="../appci/configuring-appc-gateway-sna.html#APPCI216" target="_blank"><span class="italic">Oracle数据库网关APPC安装和配置指南的</span></a>第12章<a href="../appci/configuring-appc-gateway-sna.html#APPCI216" target="_blank"><span class="italic">，Linux x86-64，SPARC上的Oracle Solaris（64位）和HP- UX Itanium</span></a>或<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/appug&amp;id=APPCW192" target="_blank"><span class="italic">适用于Microsoft Windows的APPC安装和配置指南</span></a>的<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/appug&amp;id=APPCW192" target="_blank"><span class="italic">Oracle数据库网关的</span></a>第9章，了解其配置。
                     </p>
                  </div>
                  <p><a id="d21932e119" class="indexterm-anchor"></a> Commit-confirm是两阶段提交的特殊实现，它允许不支持完全两阶段提交的数据库或网关与支持完全两阶段提交的其他数据库或网关一起参与分布式更新事务。在此实现中，在准备好所有其他站点之后，commit-confirm站点始终是第一个提交的站点。这允许所有站点保持同步，因为如果提交确认站点无法成功提交，则可以回滚所有其他站点。<a id="d21932e124" class="indexterm-anchor"></a></p>
                  <p>在Oracle分布式事务中，与该事务关联的所有工作都分配了一个公共标识符，称为<a id="d21932e128" class="indexterm-anchor"></a> Oracle全球交易ID。该标识符保证是唯一的，因此它可以用于专门标识特定的分布式事务。提交确认支持的关键要求是提交确认站点（在本例中为APPC的Oracle数据库网关）能够将Oracle全局事务ID作为其工作单元的一部分进行记录，以便如果发生故障，网关的恢复处理可以通过该事务的日志条目的存在与否来确定特定Oracle全局事务ID的状态。每次提交或回滚操作后都会生成一个新的Oracle全局事务ID。 <a id="d21932e131" class="indexterm-anchor"></a> <a id="d21932e136" class="indexterm-anchor"></a></p>
                  <p>APPC的Oracle数据库网关使用LU6.2 <code class="codeph">SYNCLEVEL 1</code>实现commit-confirm。这类似于单站点更新的实现，具有Oracle站点和上的资源的附加优势<a id="d21932e143" class="indexterm-anchor"></a>网关访问的OLTP可以更新并保持同步。主要区别在于提交确认实现需要在OLTP事务中进行一些额外的编程，以执行恢复支持所需的事务日志记录。
                  </p>
               </div>
            </div><a id="APPUG1008"></a><div class="props_rev_3"><a id="GUID-79F3DF5C-EAFC-427C-9747-9D5372040930" name="GUID-79F3DF5C-EAFC-427C-9747-9D5372040930"></a><h3 id="APPUG-GUID-79F3DF5C-EAFC-427C-9747-9D5372040930" class="sect3">支持的OLTP</h3>
               <div>
                  <p>由于commit-confirm使用LU6.2 <code class="codeph">SYNCLEVEL 1</code> ，因此任何支持APPC的OLTP都可以支持它，包括用于z / OS和IMS / TM的CICS Transaction Server。适用于APPC的Oracle数据库网关为z / OS和IMS / TM的CICS Transaction Server提供了示例提交确认应用程序。<a id="d21932e183" class="indexterm-anchor"></a></p>
                  <p>使用CICS Transaction Server for z / OS，标准命令级EXEC CICS接口可用于所有APPC通信。此外，如果首选，可以使用CPI-C接口。使用EXEC CICS接口在COBOL中编写的示例DB2更新事务随网关一起提供。CICS Transaction Server for z / OS支持的任何语言都可用于编写提交确认事务。</p>
                  <p>使用IMS / TM时，必须使用CPI-C接口，使IMS事务成为“显式APPC事务”，如IBM IMSCICS Transaction Server for z / OS手册中所述。这是必要的，因为它是IMS事务可以访问LU6.2 <code class="codeph">SYNCLEVEL 1</code>控制流的唯一方法。当使用“隐含的APPC”，其中来自IOPCB的“GU”和IOPCB的“ISRT”用于接收和发送数据时，IMS事务无法访问LU6.2 <code class="codeph">SYNCLEVEL 1</code>控制流，使其无法实现使用此方法进行commit-confirm。使用CPI-C APPC接口在COBOL中编写的示例DLI数据库更新事务随网关一起提供。IMS和CPI-C支持的任何语言都可用于编写提交确认事务。
                  </p>
               </div>
            </div><a id="APPUG1009"></a><div class="props_rev_3"><a id="GUID-8DE34F19-E50A-494E-BFD2-C5E1FD87A0E0" name="GUID-8DE34F19-E50A-494E-BFD2-C5E1FD87A0E0"></a><h3 id="APPUG-GUID-8DE34F19-E50A-494E-BFD2-C5E1FD87A0E0" class="sect3">支持Commit-Confirm所需的组件</h3>
               <div>
                  <p>需要以下组件来支持commit-confirm：<a id="d21932e230" class="indexterm-anchor"></a></p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>适用于APPC服务器的Oracle数据库网关</p>
                        <p>当在网关初始化文件中指定<code class="codeph">PGA_CAPABILITY=COMMIT_CONFIRM</code>时，网关服务器支持commit-confirm。当网关服务器在启用了commit-confirm的情况下运行时，它将连接到本地Oracle数据库，在该数据库中维护提交确认事务日志，类似于存储在<code class="codeph">DBA_2PC_PENDING</code>表中的Oracle两阶段提交日志。网关的事务日志存储在<code class="codeph">PGA_CC_PENDING</code>表中。对于每个正在进行的事务，该表存储在该表中，并且在该事务完成之前保持该行。<code class="codeph">PGA_CC_PENDING</code>中行的生命周期通常很短，仅从网关收到提交的时间开始，直到Oracle数据库完成所有提交处理并告知网关忘记事务为止。
                        </p>
                        <p>应保留提交确认网关SID，仅用于调用实现commit-confirm的更新事务。当<code class="codeph">PGA_CAPABILITY</code>设置为<code class="codeph">COMMIT_CONFIRM</code>时，记录设置中涉及一些额外的开销。应该通过单独的网关SID调用只读事务， <code class="codeph">PGA_CAPABILITY</code>设置为<code class="codeph">READ_ONLY</code>这样它们就不会产生额外的开销。
                        </p>
                     </li>
                     <li>
                        <p>记录服务器<a id="d21932e269" class="indexterm-anchor"></a><a id="d21932e275" class="indexterm-anchor"></a></p>
                        <p>必须有一个Oracle数据库可供网关服务器用于存储<code class="codeph">PGA_CC_PENDING</code>表。为了获得最佳性能和可靠性，Oracle建议此Oracle数据库与网关服务器位于同一系统上。
                        </p>
                     </li>
                     <li>
                        <p>OLTP提交 - 确认事务日志<a id="d21932e285" class="indexterm-anchor"></a><a id="d21932e291" class="indexterm-anchor"></a></p>
                        <p>必须为正在访问的OLTP系统定义提交确认事务日志数据库。此数据库必须是可恢复的，并且必须可由OLTP作为与OLTP应用程序的数据库相同的工作单元的一部分访问，以便事务日志数据库的更新将与应用程序的数据库的更新保持同步。工作。</p>
                        <p>commit-confirm事务日志数据库只需要包含<a id="d21932e299" class="indexterm-anchor"></a> Oracle全局事务ID和日期/时间戳。Oracle全局事务ID长度为169个字节，必须是关键字段。日期/时间戳用于清除在某些故障情况后可留在日志中的旧条目。
                        </p>
                        <p>为简单起见，特定OLTP下的所有提交确认应用程序应共享相同的提交确认事务日志。</p>
                     </li>
                     <li>
                        <p>OLTP事务日志代码<a id="d21932e307" class="indexterm-anchor"></a><a id="d21932e313" class="indexterm-anchor"></a></p>
                        <p>必须将代码添加到由commit-confirm网关调用的每个OLTP事务中，以执行网关的commit-confirm实现所需的事务日志记录。此代码必须从网关接收Oracle全局事务ID，并将该信息写入OLTP提交确认事务日志数据库。为了获得最大的灵活性和易用性，可以将此代码编写为可从OLTP系统上的任何提交确认事务调用的子例程。</p>
                        <p>此代码必须在第一个APPC接收之前的每个commit-confirm事务开始时执行，然后在事务中的每个<code class="codeph">COMMIT</code>或<code class="codeph">ROLLBACK</code>之后立即执行。这可确保在每个工作单元开始时完成日志记录。
                        </p>
                     </li>
                     <li>
                        <p>OLTP忘记/恢复事务<a id="d21932e330" class="indexterm-anchor"></a><a id="d21932e336" class="indexterm-anchor"></a></p>
                        <p>必须在OLTP系统上创建单独的APPC事务，该事务可以由网关启动，以便在成功提交事务后忘记事务并在恢复处理期间查询事务的状态。此事务在忘记处理期间从OLTP提交确认事务日志数据库中删除特定Oracle全局事务ID的条目，并在恢复处理期间从OLTP提交确认事务日志数据库查询特定Oracle全局事务ID的条目。</p>
                        <div class="infoboxnote" id="GUID-8DE34F19-E50A-494E-BFD2-C5E1FD87A0E0__GUID-EBC5A4AD-FC1E-45F5-A3E6-5A52B0136BB2">
                           <p class="notep1">注意：</p>
                           <p>确保正确配置网关初始化参数和OLTP参数，如<a href="../appci/appc-gateway-config-oltp.html#APPCI210" target="_blank"><span class="italic">适用于POWER系统上的IBM AIX的APPC安装和配置指南</span></a>的<a href="../appci/appc-gateway-config-oltp.html#APPCI210" target="_blank"><span class="italic">Oracle数据库网关（64位），Linux x86-64，Oracle Solaris的</span></a>第11章中所述。 <a href="../appci/appc-gateway-config-oltp.html#APPCI210" target="_blank"><span class="italic">在SPARC（64位）和HP-UX Itanium</span></a>或<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/appug&amp;id=APPCW189" target="_blank"><span class="italic">适用于Microsoft Windows的APPC安装和配置指南</span></a>的<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/appug&amp;id=APPCW189" target="_blank"><span class="italic">Oracle数据库网关的</span></a>第8章中，具体取决于您的平台。
                           </p>
                        </div>
                     </li>
                  </ul>
               </div>
            </div><a id="APPUG1010"></a><div class="props_rev_3"><a id="GUID-F7D4F73A-5F4A-4BB0-AE84-47793A4D0380" name="GUID-F7D4F73A-5F4A-4BB0-AE84-47793A4D0380"></a><h3 id="APPUG-GUID-F7D4F73A-5F4A-4BB0-AE84-47793A4D0380" class="sect3">应用设计要求</h3>
               <div>
                  <p><a id="d21932e396" class="indexterm-anchor"></a>在设计用于APPC的Oracle数据库网关的提交确认应用程序时，必须满足一些要求，以便网关在发生故障时确定事务的状态。如果不满足这些要求，则尝试将应用程序与commit-confirm网关一起使用将产生不可预测的结果。
                  </p>
                  <p>由提交确认网关调用的OLTP事务必须完成的第一件事是从网关接收O racle全局事务ID并将其记录到OLTP commit-confirm事务日志数据库中。这必须在OLTP事务和Oracle应用程序之间的正常数据流开始之前完成。网关始终将Oracle全局事务ID作为第一个数据项发送。
                  </p>
                  <p>如果OLTP事务是<a id="d21932e410" class="indexterm-anchor"></a>一次性交易，这是唯一需要的改变。如果交易是一个<a id="d21932e413" class="indexterm-anchor"></a>持久性事务执行多个工作单元（发出多个提交或回滚），然后必须在每次<code class="codeph">COMMIT</code>或<code class="codeph">ROLLBACK</code>之后接收并记录新的Oracle全局事务ID。</p>
                  <p>Oracle全局事务ID由网关在可变长度记录中发送，最大长度为202字节。前32个字节包含一个特殊的二进制字符串，用于验证数据是来自网关而不是来自其他应用程序。下一个1字节是保留字段。接下来是Oracle全局事务ID，最大长度为169个字节。您必须记录保留字段和Oracle全局事务ID，以及日期/时间戳和您要记录的任何其他信息。请注意，Oracle全局事务ID必须是日志数据库的关键字段，以便忘记/恢复事务可以使用Oracle全局事务ID直接访问日志条目。</p>
                  <div class="infoboxnote" id="GUID-F7D4F73A-5F4A-4BB0-AE84-47793A4D0380__GUID-F5FD8B79-FFD7-44D9-B465-1F125E3DB154">
                     <p class="notep1">注意：</p>
                     <p>如果您的OLTP是IMS / TM，则必须将提交确认事务日志数据库的PCB添加到PSB，以用于将与提交确认网关一起使用的每个事务。该PCB必须是PSB中的第一块PCB。</p>
                  </div>
               </div>
            </div><a id="APPUG1011"></a><div class="props_rev_3"><a id="GUID-DCF5A2B9-808F-4D4E-905F-2E612F516C55" name="GUID-DCF5A2B9-808F-4D4E-905F-2E612F516C55"></a><h3 id="APPUG-GUID-DCF5A2B9-808F-4D4E-905F-2E612F516C55" class="sect3">提交确认架构</h3>
               <div>
                  <p>Oracle Database Gateway for APPC中的commit-confirm实现的体系结构包含三个主要组件：<a id="d21932e459" class="indexterm-anchor"></a><a id="d21932e463" class="indexterm-anchor"></a></p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>Oracle数据库</p>
                     </li>
                     <li>
                        <p>适用于APPC服务器的Oracle数据库网关（网关服务器）</p>
                     </li>
                     <li>
                        <p>记录服务器（包含表<code class="codeph">PGA_CC_PENDING</code>和<code class="codeph">PGA_CC_LOG</code>的Oracle数据库）</p>
                     </li>
                  </ul>
                  <p>本节描述每个组件在commit-confirm操作中的作用以及这些组件如何交互。</p>
               </div><a id="APPUG1012"></a><div class="props_rev_3"><a id="GUID-C34AF304-5F6C-43CD-91DD-3E17BDAC801F" name="GUID-C34AF304-5F6C-43CD-91DD-3E17BDAC801F"></a><h4 id="APPUG-GUID-C34AF304-5F6C-43CD-91DD-3E17BDAC801F" class="sect4">组件</h4>
                  <div>
                     <p>该<a id="d21932e517" class="indexterm-anchor"></a> Oracle数据库是commit-confirm体系结构中的控制组件。它告诉网关服务器何时提交事务以及何时回滚事务。它对参与分布式事务的所有其他服务器也是如此。发生故障时，Oracle数据库充当集成服务器，驱动每个参与服务器（包括网关服务器）中的恢复过程。<a id="d21932e522" class="indexterm-anchor"></a></p>
                     <p>该<a id="d21932e530" class="indexterm-anchor"></a>网关服务器执行将指令从Oracle数据库转换为LU6.2操作的任务，然后将事务记录到日志记录服务器中。网关服务器将日志信息存储在日志记录服务器上的名为<code class="codeph">PGA_CC_PENDING</code>的表中。如果在事务处理期间发生故障，则网关服务器确定应将哪个错误返回到Oracle数据库。
                     </p>
                     <p>该<a id="d21932e540" class="indexterm-anchor"></a>日志服务器是可用的Oracle数据库<a id="d21932e545" class="indexterm-anchor"></a>网关<a id="d21932e548" class="indexterm-anchor"></a>服务器，用于存储和访问其提交确认日志信息。日志服务器不必是作为集成服务器的Oracle数据库。由于日志记录服务器是网关提交确认操作的组成部分，因此它驻留的最佳位置与网关服务器位于同一系统上。这允许网关服务器和日志记录服务器之间的通信使用进程间通信，从而在组件之间提供高速，低开销的本地连接。
                     </p>
                  </div>
               </div><a id="APPUG1013"></a><div class="props_rev_3"><a id="GUID-78DA07DF-8C91-4927-825E-145FC4E319B3" name="GUID-78DA07DF-8C91-4927-825E-145FC4E319B3"></a><h4 id="APPUG-GUID-78DA07DF-8C91-4927-825E-145FC4E319B3" class="sect4">互动</h4>
                  <div>
                     <p>组件之间存在一组特定的交互。他们是：<a id="d21932e585" class="indexterm-anchor"></a></p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a id="d21932e594" class="indexterm-anchor"></a> Oracle数据库&lt; - &gt;网关服务器</p>
                           <p>Oracle数据库驱动网关服务器的所有操作。根据Oracle应用程序的请求，集成服务器可以指示网关服务器开始新的Oracle事务，启动提交序列，启动回滚序列或启动遗忘序列。它还可以调用网关远程过程调用（RPC）函数（ <a id="d21932e601" class="indexterm-anchor"></a> <code class="codeph">PGAINIT</code> ， <code class="codeph">PGAXFER</code> ， <code class="codeph">PGATERM</code> ）代表Oracle应用程序。
                           </p>
                        </li>
                        <li>
                           <p><a id="d21932e616" class="indexterm-anchor"></a>网关服务器&lt; - &gt;日志服务器</p>
                           <p>网关服务器调用<a id="d21932e623" class="indexterm-anchor"></a>日志服务器以从其<code class="codeph">PGA_CC_PENDING</code>表中插入和删除行。这实际上是通过调用a来完成的<a id="d21932e629" class="indexterm-anchor"></a>日志服务器中的PL / SQL存储过程<code class="codeph">PGA_CC_LOG</code> ，用于减少网关服务器执行其日志记录所需的打开游标数。网关服务器只需要一个光标进行日志记录。
                           </p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="APPUG1014"></a><div class="props_rev_3"><a id="GUID-2BB5FA7F-CC80-4716-9704-AA15CB535C17" name="GUID-2BB5FA7F-CC80-4716-9704-AA15CB535C17"></a><h3 id="APPUG-GUID-2BB5FA7F-CC80-4716-9704-AA15CB535C17" class="sect3">提交确认流程</h3>
               <div>
                  <p>Oracle应用程序和Oracle应用程序之间成功提交的控制流程<a id="d21932e668" class="indexterm-anchor"></a> OLTP事务在下一节中描述， <a href="implement-appc-commit-confirm-sna-only.html#GUID-FC0E0D55-78E5-4D1E-9953-6AAA590CDFAB__I1007167">如图5-1所示</a> 。该图假设Oracle和OLTP资源都已更新。 <a id="d21932e675" class="indexterm-anchor"></a> <a href="implement-appc-commit-confirm-sna-only.html#GUID-FC0E0D55-78E5-4D1E-9953-6AAA590CDFAB">Commit-Confirm Logic Flow中</a>的以下步骤<a href="implement-appc-commit-confirm-sna-only.html#GUID-FC0E0D55-78E5-4D1E-9953-6AAA590CDFAB">逐步</a>概述了提交确认逻辑流程。
                  </p>
               </div><a id="APPUG1310"></a><a id="APPUG1015"></a><div class="props_rev_3"><a id="GUID-FC0E0D55-78E5-4D1E-9953-6AAA590CDFAB" name="GUID-FC0E0D55-78E5-4D1E-9953-6AAA590CDFAB"></a><h4 id="APPUG-GUID-FC0E0D55-78E5-4D1E-9953-6AAA590CDFAB" class="sect4">提交 - 确认逻辑流程，一步一步</h4>
                  <div>
                     <ol>
                        <li><span>应用程序向Oracle数据库发出<code class="codeph">COMMIT</code> 。</span></li>
                        <li><span>Oracle数据库将<code class="codeph">PREPARE</code>发送给除网关之外的分布式事务中的每个参与者。</span></li>
                        <li><span>每个参与者准备其数据库更新并响应<code class="codeph">PREPARE OK</code>到Oracle数据库。</span></li>
                        <li><span>Oracle数据库将<code class="codeph">COMMIT</code>发送到网关。网关从Oracle数据库接收<code class="codeph">COMMIT</code> ，并将新的挂起事务行插入<code class="codeph">PGA_CC_PENDING</code>表。</span></li>
                        <li><span>网关将APPC <code class="codeph">CONFIRM</code>发送到OLTP应用程序。OLTP应用程序以最后一个APPC <code class="codeph">RECEIVE</code>的状态的形式接收<code class="codeph">CONFIRM</code>请求。</span></li>
                        <li><span>OLTP应用程序使用适当的OLTP函数发出<code class="codeph">COMMIT</code> 。OLTP提交自上次<code class="codeph">COMMIT</code>以来应用程序所做的所有数据库更新，包括commit-confirm事务日志更新。</span></li>
                        <li><span>提交数据库更新后，OLTP将控制权返回给应用程序，并返回指示<code class="codeph">COMMIT</code>状态的返回码。</span></li>
                        <li><span>OLTP应用程序将APPC <code class="codeph">CONFIRMED</code>发送到网关。</span></li>
                        <li><span>网关接收<code class="codeph">CONFIRMED</code>并将<code class="codeph">COMMIT OK</code>返回给Oracle数据库。</span></li>
                        <li><span>Oracle数据库将<code class="codeph">COMMIT</code>发送给除网关之外的分布式事务中的每个参与者。</span></li>
                        <li><span>每个参与者提交其数据库更新并响应<code class="codeph">COMMIT OK</code>到Oracle数据库。</span></li>
                        <li><span>Oracle数据库将<code class="codeph">FORGET</code>发送到网关。</span></li>
                        <li><span>网关接收<code class="codeph">FORGET</code>并在OLTP上与<code class="codeph">FORGET/RECOVERY</code>事务启动新的APPC对话，向其发送<code class="codeph">FORGET</code>请求和APPC <code class="codeph">CONFIRM</code> 。 <code class="codeph">FORGET/RECOVERY</code>事务接收<code class="codeph">FORGET</code>请求，并从当前Oracle事务的commit-confirm事务日志中删除该条目，并提交删除。</span></li>
                        <li><span><code class="codeph">FORGET/RECOVERY</code>事务向网关发送APPC <code class="codeph">CONFIRMED</code>以指示<code class="codeph">FORGET</code>已处理，然后终止。网关接收<code class="codeph">CONFIRMED</code>或删除从挂起的事务行<code class="codeph">PGA_CC_PENDING</code>表。</span></li>
                        <li><span>网关将<code class="codeph">FORGET OK</code>返回给Oracle数据库。</span></li>
                        <li><span>Oracle数据库将控制权返回给Oracle应用程序。</span></li>
                     </ol>
                     <div class="section">
                        <p><a href="implement-appc-commit-confirm-sna-only.html#GUID-FC0E0D55-78E5-4D1E-9953-6AAA590CDFAB__I1007167">图5-1</a>说明了上一节中描述的Commit-Confirm逻辑流程。
                        </p>
                        <div class="figure" id="GUID-FC0E0D55-78E5-4D1E-9953-6AAA590CDFAB__I1007167">
                           <p class="titleinfigure">图5-1使用Synclevel 1的Commit-Confirm流程</p><img src="img/comm5_1.gif" alt="下面是图5-1的描述" title="下面是图5-1的描述" longdesc="img_text/comm5_1.html"><br><a href="img_text/comm5_1.html">“图5-1使用Synclevel 1提交确认流程”的说明</a></div>
                        <!-- class="figure" -->
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="APPUG1016"></a><div class="props_rev_3"><a id="GUID-110EFC3B-EC8C-4D02-A982-09AF6B94C029" name="GUID-110EFC3B-EC8C-4D02-A982-09AF6B94C029"></a><h4 id="APPUG-GUID-110EFC3B-EC8C-4D02-A982-09AF6B94C029" class="sect4">网关服务器提交 - 确认事务日志</h4>
                  <div>
                     <p>提交确认事务日志由单个表组成， <a id="d21932e911" class="indexterm-anchor"></a> <code class="codeph">PGA_CC_PENDING</code> 。此表包含每个正在进行的Oracle事务的行，其中包括commit-confirm网关。该表由。维护<a id="d21932e918" class="indexterm-anchor"></a>网关服务器，功能类似于Oracle数据库的<code class="codeph">DBA_2PC_PENDING</code>表。请注意，在网关收到<code class="codeph">COMMIT</code>之前，不会在该表中插入行，并且在网关收到<code class="codeph">FORGET</code>时删除该行。在<code class="codeph">PREPARE</code>阶段，网关没有参与。
                     </p>
                     <p><code class="codeph">PGA_CC_PENDING</code>表包含以下列：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a id="d21932e944" class="indexterm-anchor"></a><code class="codeph">GLOBAL_TRAN_ID</code></p>
                           <p>这是<a id="d21932e950" class="indexterm-anchor"></a>事务的Oracle全局事务ID。它与<code class="codeph">DBA_2PC_PENDING</code>表中的相应列相同。
                           </p>
                        </li>
                        <li>
                           <p><a id="d21932e958" class="indexterm-anchor"></a><code class="codeph">SIDE_NAME</code></p>
                           <p>这是网关用于与目标LU分配APPC对话的辅助信息配置文件名称。它对应于传递给<code class="codeph">PGAINIT</code>网关函数的<code class="codeph">SIDENAME</code>参数。
                           </p>
                        </li>
                        <li>
                           <p><a id="d21932e972" class="indexterm-anchor"></a><code class="codeph">LU_NAME</code></p>
                           <p>这是目标LU的完全限定合作伙伴LU名称。此值可以是Side Information Profile中的LU名称，也可以是传递给<code class="codeph">PGAINIT</code>网关函数的<code class="codeph">LUNAME</code>参数。此名称完全标识执行事务的OLTP系统。
                           </p>
                        </li>
                        <li>
                           <p><a id="d21932e986" class="indexterm-anchor"></a><code class="codeph">MODE_NAME</code></p>
                           <p>这是网关用于与目标LU分配APPC对话的模式名称。该值可以是Side Information Profile中的Mode名称，也可以是传递给<code class="codeph">PGAINIT</code>网关功能的<code class="codeph">MODENAME</code>参数。
                           </p>
                        </li>
                        <li>
                           <p><a id="d21932e1000" class="indexterm-anchor"></a><code class="codeph">TP_NAME</code></p>
                           <p>这是在目标LU上执行的事务程序名称。该值是Side Information Profile中的TP名称或传递给<code class="codeph">PGAINIT</code>网关函数的<code class="codeph">TPNAME</code>参数。此名称完全标识已执行的OLTP事务程序。
                           </p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>