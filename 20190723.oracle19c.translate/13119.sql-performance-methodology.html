<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="This chapter describes the recommended methodology for SQL tuning."></meta>
      <meta name="description" content="This chapter describes the recommended methodology for SQL tuning."></meta>
      <title>SQL性能方法论</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="SQL Tuning Guide"></meta>
      <meta property="og:description" content="This chapter describes the recommended methodology for SQL tuning."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="SQL Tuning Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="sql-tuning-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-31T14:57:08-08:00"></meta>
      <meta name="dcterms.title" content="SQL Tuning Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="2013, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96095-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="introduction-to-sql-tuning.html" title="Previous" type="text/html"></link>
      <link rel="next" href="query-optimizer-fundamentals.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGSQL"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="introduction-to-sql-tuning.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="query-optimizer-fundamentals.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL调优指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="sql-performance-fundamentals.html" property="item" typeof="WebPage"><span property="name">SQL性能基础</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">SQL性能方法论</li>
            </ol>
            <a id="GUID-C8B23C09-35B5-4F0E-90B2-272805EC4062" name="GUID-C8B23C09-35B5-4F0E-90B2-272805EC4062"></a><a id="TGSQL133"></a>
            
            <h2 id="TGSQL-GUID-C8B23C09-35B5-4F0E-90B2-272805EC4062" class="sect2"><span class="enumeration_chapter">2</span> SQL性能方法</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍了SQL调优的推荐方法。</p>
               <div class="infoboxnote" id="GUID-C8B23C09-35B5-4F0E-90B2-272805EC4062__GUID-EE324800-3A3E-4363-ADF3-AFDB13038C7C">
                  <p class="notep1">注意：</p>
                  <p>本书假定您已经学习了<a href="../tdppt/oracle-database-performance-method.html#GUID-6203E485-FA06-4EE3-9003-4449FBDE214B" target="_blank"><span><cite>Oracle Database 2 Day + Performance Tuning Guide中</cite></span></a>描述的Oracle数据库性能方法。
                  </p>
               </div>
               <p>本章包含以下主题：</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="sql-performance-methodology.html#GUID-A72B875B-0FAF-40A0-A9A2-7E62DEA36F50">设计应用程序的指南</a><br>获得良好SQL性能的关键是在设计应用程序时考虑性能。
                  </li>
                  <li class="ulchildlink"><a href="sql-performance-methodology.html#GUID-C382C528-CDD3-4DC8-92EA-19140C3FFB25">部署应用程序的准则</a><br>要获得最佳性能，请按照设计应用程序的相同精心部署应用程序。
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="sql-performance-fundamentals.html#GUID-DD9CAA74-3E0B-48C9-8770-AADB614BC992" title="SQL调优正在改进SQL语句性能，以满足特定的，可衡量的和可实现的目标。">SQL Performance Fundamentals</a></p>
                  </div>
               </div>
            </div>
            <a id="TGSQL138"></a><div class="props_rev_3"><a id="GUID-A72B875B-0FAF-40A0-A9A2-7E62DEA36F50" name="GUID-A72B875B-0FAF-40A0-A9A2-7E62DEA36F50"></a><h3 id="TGSQL-GUID-A72B875B-0FAF-40A0-A9A2-7E62DEA36F50" class="sect3"><span class="enumeration_section">2.1</span>设计应用程序的指南</h3>
               <div>
                  <p>获得良好SQL性能的关键是在设计应用程序时考虑性能。</p>
                  <div class="section">
                     <p>本节包含以下主题：</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="sql-performance-methodology.html#GUID-EB210ACB-4A2D-4AEA-AACE-CFD44E61CBEE">数据建模指南</a><br>数据建模对于成功的应用程序设计很重要
                     </li>
                     <li class="ulchildlink"><a href="sql-performance-methodology.html#GUID-2B424C80-25B4-4B16-BE9D-92B74428F083">编写有效应用程序的指南</a><br>在系统开发的设计和体系结构阶段，确保应用程序开发人员了解SQL执行效率。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="sql-performance-methodology.html#GUID-C8B23C09-35B5-4F0E-90B2-272805EC4062" title="本章介绍了SQL调优的推荐方法。">SQL性能方法</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL139"></a><div class="props_rev_3"><a id="GUID-EB210ACB-4A2D-4AEA-AACE-CFD44E61CBEE" name="GUID-EB210ACB-4A2D-4AEA-AACE-CFD44E61CBEE"></a><h4 id="TGSQL-GUID-EB210ACB-4A2D-4AEA-AACE-CFD44E61CBEE" class="sect4"><span class="enumeration_section">2.1.1</span>数据建模指南</h4>
                  <div>
                     <p>数据建模对于成功的应用程序设计很重要</p>
                     <div class="section">
                        <p>您必须以表示业务实践的方式执行数据建模。关于正确的数据模型可能会出现激烈的争论。重要的是将最大的建模工作应用于受最频繁的业务事务影响的实体。</p>
                        <p>在建模阶段，很有可能花费太多时间来建模非核心数据元素，这会导致开发前置时间的增加。然后，使用建模工具可以快速生成模式定义，并且在需要快速原型时非常有用。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-performance-methodology.html#GUID-A72B875B-0FAF-40A0-A9A2-7E62DEA36F50" title="获得良好SQL性能的关键是在设计应用程序时考虑性能。">设计应用程序的准则</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL145"></a><div class="props_rev_3"><a id="GUID-2B424C80-25B4-4B16-BE9D-92B74428F083" name="GUID-2B424C80-25B4-4B16-BE9D-92B74428F083"></a><h4 id="TGSQL-GUID-2B424C80-25B4-4B16-BE9D-92B74428F083" class="sect4"><span class="enumeration_section">2.1.2</span>编写有效应用的指南</h4>
                  <div>
                     <p>在系统开发的设计和体系结构阶段，确保应用程序开发人员了解SQL执行效率。</p>
                     <div class="section">
                        <p>为实现此目标，开发环境必须支持以下特征：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>良好的数据库连接管理</p>
                              <p>连接到数据库是一项昂贵的操作，无法扩展。因此，最佳做法是最小化与数据库的并发连接数。用户在应用程序初始化时连接的简单系统是理想的。但是，在基于Web或多层应用程序中，应用程序服务器将数据库连接多路复用到用户，这种方法可能很困难。使用这些类型的应用程序，将它们设计为池数据库连接，而不是为每个用户请求重新建立连接。</p>
                           </li>
                           <li>
                              <p>良好的游标使用和管理</p>
                              <p>维护用户连接对于最小化系统上的解析活动同样重要。解析是解释SQL语句并为其创建执行计划的过程。此过程有许多阶段，包括语法检查，安全检查，执行计划生成以及将共享结构加载到共享池中。有两种类型的解析操作：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>难以解析</p>
                                    <p>首次提交SQL语句，并且在共享池中找不到匹配项。硬解析是资源最密集且不可扩展的，因为它们执行解析中涉及的所有操作。</p>
                                 </li>
                                 <li>
                                    <p>软解析</p>
                                    <p>首次提交SQL语句，并在共享池中找到匹配项。匹配可以是其他用户先前执行的结果。共享SQL语句，这对性能来说是最佳的。但是，软解析并不理想，因为它们仍然需要语法和安全检查，这会消耗系统资源。</p>
                                 </li>
                              </ul>
                              <p>因为解析应该尽可能地最小化，所以应用程序开发人员应该设计他们的应用程序来解析一次SQL语句并多次执行它们。这是通过游标完成的。经验丰富的SQL程序员应该熟悉打开和重新执行游标的概念。</p>
                           </li>
                           <li>
                              <p>有效使用绑定变量</p>
                              <p>应用程序开发人员还必须确保在共享池中共享SQL语句。要实现此目标，请使用绑定变量来表示从执行更改为执行的查询部分。如果不这样做，则SQL语句可能会被解析一次，并且永远不会被其他用户重用。要确保共享SQL，请使用绑定变量，不要将字符串文字与SQL语句一起使用。例如：</p>
                              <p>字符串文字的声明：</p><pre class="pre codeblock"><code>SELECT * FROM employees WHERE last_name LIKE'KING';</code></pre><p>绑定变量的语句：</p><pre class="pre codeblock"><code>SELECT * FROM employees WHERE last_name LIKE：1;</code></pre><p>以下示例显示了对简单OLTP应用程序的某些测试的结果：</p><pre class="pre codeblock"><code>测试#Users支持否解析所有语句270软解析所有语句150硬解析所有语句60重新连接每个事务30</code></pre><p>这些测试是在四CPU计算机上进行的。随着系统上CPU数量的增加，差异会增加。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-performance-methodology.html#GUID-A72B875B-0FAF-40A0-A9A2-7E62DEA36F50" title="获得良好SQL性能的关键是在设计应用程序时考虑性能。">设计应用程序的准则</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL151"></a><div class="props_rev_3"><a id="GUID-C382C528-CDD3-4DC8-92EA-19140C3FFB25" name="GUID-C382C528-CDD3-4DC8-92EA-19140C3FFB25"></a><h3 id="TGSQL-GUID-C382C528-CDD3-4DC8-92EA-19140C3FFB25" class="sect3"><span class="enumeration_section">2.2</span>部署应用程序的指南</h3>
               <div>
                  <p>要获得最佳性能，请按照设计应用程序的相同精心部署应用程序。</p>
                  <div class="section">
                     <p>本节包含以下主题：</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="sql-performance-methodology.html#GUID-F9275845-56B1-422D-9196-65715AEC0CF3">在测试环境中部署的指南</a><br>测试过程主要包括功能和稳定性测试。在此过程中的某个时刻，您必须执行性能测试。
                     </li>
                     <li class="ulchildlink"><a href="sql-performance-methodology.html#GUID-DBAC094F-DFB1-4324-9A03-3C3482417120">申请推广指南</a><br>当新应用程序推出时，通常采用两种策略：Big Bang方法，其中所有用户一次迁移到新系统，以及涓流方法，用户从现有系统缓慢迁移到新系统。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="sql-performance-methodology.html#GUID-C8B23C09-35B5-4F0E-90B2-272805EC4062" title="本章介绍了SQL调优的推荐方法。">SQL性能方法</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL152"></a><div class="props_rev_3"><a id="GUID-F9275845-56B1-422D-9196-65715AEC0CF3" name="GUID-F9275845-56B1-422D-9196-65715AEC0CF3"></a><h4 id="TGSQL-GUID-F9275845-56B1-422D-9196-65715AEC0CF3" class="sect4"><span class="enumeration_section">2.2.1</span>在测试环境中部署的指南</h4>
                  <div>
                     <p>测试过程主要包括功能和稳定性测试。在此过程中的某个时刻，您必须执行性能测试。</p>
                     <div class="section">
                        <p>以下列表描述了对应用程序进行性能测试的简单规则。如果记录正确，则此列表在应用程序上线后为生产应用程序和容量规划过程提供重要信息。</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>使用自动数据库诊断监视器（ADDM）和SQL Tuning Advisor进行设计验证。</p>
                           </li>
                           <li>
                              <p>使用实际数据量和分布进行测试。</p>
                              <p>所有测试必须使用完全填充的表格完成。测试数据库应包含代表生产系统的数据，包括表格之间的数据量和基数。应构建所有生产索引，并正确填充模式统计信息。</p>
                           </li>
                           <li>
                              <p>使用正确的优化程序模式。</p>
                              <p>使用您计划在生产中使用的优化程序模式执行所有测试。</p>
                           </li>
                           <li>
                              <p>测试单个用户性能。</p>
                              <p>在空闲或轻度使用的数据库上测试单个用户以获得可接受的性能。如果单个用户在理想条件下无法达到可接受的性能，则多个用户在实际条件下无法实现可接受的性能。</p>
                           </li>
                           <li>
                              <p>获取并记录所有SQL语句的计划。</p>
                              <p>获取每个SQL语句的执行计划。使用此过程验证优化程序是否正在获取最佳执行计划，并且可以根据CPU时间和物理I / O来理解SQL语句的相对成本。此过程有助于识别将来需要进行最多调整和性能工作的大量使用事务。</p>
                           </li>
                           <li>
                              <p>尝试多用户测试。</p>
                              <p>此过程难以准确执行，因为用户工作负载和配置文件可能无法完全量化。但是，应测试执行DML语句的事务以确保不存在锁定冲突或序列化问题。</p>
                           </li>
                           <li>
                              <p>使用正确的硬件配置进行测试。</p>
                              <p>使用尽可能靠近生产系统的配置进行测试。使用真实的系统对于网络延迟，I / O子系统带宽以及处理器类型和速度尤为重要。如果不使用此方法，可能会导致对潜在性能问题的错误分析。</p>
                           </li>
                           <li>
                              <p>测量稳态性能。</p>
                              <p>在进行基准测试时，在稳态条件下测量性能非常重要。每个基准测试运行应该有一个提升阶段，用户连接到应用程序并逐渐开始执行应用程序的工作。此过程允许将频繁缓存的数据初始化到缓存中，并且单个执行操作（例如解析）在稳态条件之前完成。同样，在基准测试运行之后，减速期很有用，这样系统可以释放资源，用户可以停止工作并断开连接。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-performance-methodology.html#GUID-C382C528-CDD3-4DC8-92EA-19140C3FFB25" title="要获得最佳性能，请按照设计应用程序的相同精心部署应用程序。">部署应用程序的准则</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL155"></a><div class="props_rev_3"><a id="GUID-DBAC094F-DFB1-4324-9A03-3C3482417120" name="GUID-DBAC094F-DFB1-4324-9A03-3C3482417120"></a><h4 id="TGSQL-GUID-DBAC094F-DFB1-4324-9A03-3C3482417120" class="sect4"><span class="enumeration_section">2.2.2</span>应用程序部署指南</h4>
                  <div>
                     <p>当新应用程序推出时，通常采用两种策略：Big Bang方法，其中所有用户一次迁移到新系统，以及涓流方法，用户从现有系统缓慢迁移到新系统。</p>
                     <div class="section">
                        <p>这两种方法都有优点和缺点。Big Bang方法依赖于以所需规模对应用程序进行可靠测试，但具有最小化数据转换和与旧系统同步的优势，因为它只是关闭。Trickle方法允许在工作负载增加时调试可伸缩性问题，但可能意味着必须在迁移发生时将数据迁移到遗留系统和从遗留系统迁移。</p>
                        <p>很难推荐一种方法而不是另一种方法，因为每种技术都存在相关风险，可能会在转换发生时导致系统中断。当然，Trickle方法允许在引入新应用程序时对真实用户进行概要分析，并允许重新配置系统，同时仅影响迁移的用户。这种方法会影响早期采用者的工作，但会限制支持服务的负担。因此，计划外中断仅影响一小部分用户群。</p>
                        <p>关于如何推出新应用程序的决定是针对每个业务的。任何采用的方法都有其独特的压力和压力。您从测试过程中获得的测试和知识越多，您就越了解什么是最适合推出的产品。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-performance-methodology.html#GUID-C382C528-CDD3-4DC8-92EA-19140C3FFB25" title="要获得最佳性能，请按照设计应用程序的相同精心部署应用程序。">部署应用程序的准则</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>