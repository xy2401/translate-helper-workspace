<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>PL / SQL错误处理</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Database PL/SQL Language Reference "></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Database PL/SQL Language Reference"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-pl-sql-language-reference.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-13T20:26:20-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96448-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="plsql-packages.html" title="Previous" type="text/html"></link>
      <link rel="next" href="plsql-optimization-and-tuning.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database PL/SQL Language Reference"></meta>
    <meta name="dcterms.isVersionOf" content="LNPLS"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="plsql-packages.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="plsql-optimization-and-tuning.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据库PL / SQL语言参考</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">PL / SQL错误处理</li>
            </ol>
            <a id="GUID-0502DC1A-F0A5-4180-A912-6A5CDC855F56" name="GUID-0502DC1A-F0A5-4180-A912-6A5CDC855F56"></a><a id="LNPLS725"></a><a id="LNPLS007"></a>
            
            <h2 id="LNPLS-GUID-0502DC1A-F0A5-4180-A912-6A5CDC855F56" class="sect2"><span class="enumeration_chapter">11</span> PL / SQL错误处理</h2>
         </header>
         <div class="ind"><script type="text/javascript">window.name='plsql-error-handling'</script><script type="text/javascript">
    function footdisplay(footnum,footnote) {
    var msg = window.open('about:blank', 'NewWindow' + footnum,
        'directories=no,height=100,location=no,menubar=no,resizable=yes,' +
        'scrollbars=yes,status=no,toolbar=no,width=598');
    msg.document.open('text/html');
    msg.document.write('<!DOCTYPE html ');
    msg.document.write('PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" ');
    msg.document.write('"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">'); 
    msg.document.write('<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us" dir="ltr"><head><title>');
   
    msg.document.write('Footnote&nbsp; ' + footnum);
    msg.document.write('<\/title><meta http-equiv="Content-Type" ');
    msg.document.write('content="text/html; charset=utf-8" />');
    msg.document.write('<meta http-equiv="Content-Script-Type" ');
    msg.document.write('content="text/javascript" />');
    msg.document.write('<style type="text/css"> <![CDATA[ ');
    msg.document.write('h1 {text-align: center; font-size: 14pt;}');
    msg.document.write('fieldset {border: none;}');
    msg.document.write('form {text-align: center;}');
    msg.document.write(' ]]u003e </style>');
    msg.document.write('<\/head><body><div id="footnote"><h1>Footnote&nbsp; ' + footnum + '<\/h1><p>');
    msg.document.write(footnote);
    msg.document.write('<\/p><form action="" method="post"><fieldset>');
    msg.document.write('<input type="button" value="OK" ');
    msg.document.write('onclick="window.close();" />');
    msg.document.write('<\/fieldset><\/form><\/div><\/body><\/html>');
    msg.document.close();
    setTimeout(function() {
        var height = msg.document.getElementById('footnote').offsetHeight;
        msg.resizeTo(598, height + 100);
    }
    , 100);
    msg.focus();
}
            </script><noscript>
               <p>此页面上的脚本内容仅用于导航目的，不会以任何方式更改内容。</p>
            </noscript>
            <div>
               <p>本章介绍如何处理PL / SQL编译时警告和PL / SQL运行时错误。后者称为<span class="bold">例外</span> 。
               </p>
               <div class="infoboxnote" id="GUID-0502DC1A-F0A5-4180-A912-6A5CDC855F56__GUID-A79E7544-F6B5-4F4F-B927-27B07732E32D">
                  <p class="notep1">注意：</p>
                  <p>警告和错误消息的语言取决于<code class="codeph">NLS_LANGUAGE</code>参数。有关此参数的信息，请参阅“ <a href="../nlspg/setting-up-globalization-support-environment.html#NLSPG199" target="_blank"><span class="italic">Oracle数据库全球化支持指南”</span></a> 。
                  </p>
               </div>
               <div class="section">
                  <p class="subhead1" id="GUID-0502DC1A-F0A5-4180-A912-6A5CDC855F56__GUID-FE21EFFC-F9F3-4484-A458-3498EDA2D0F4">话题</p>
               </div>
               <!-- class="section" -->
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="plsql-error-handling.html#GUID-3311B813-3185-4751-A3A6-309B93973366" title="在编译存储的PL / SQL单元时，PL / SQL编译器会为不足以导致错误并阻止编译的条件生成警告 - 例如，使用不推荐的PL / SQL功能。">编译时警告</a></p>
                  </li>
                  <li>
                     <p><a href="plsql-error-handling.html#GUID-343E0653-9BCE-48F5-A00A-795D77B96B44">异常处理概述</a></p>
                  </li>
                  <li>
                     <p><a href="plsql-error-handling.html#GUID-4F0787E6-ABCA-4860-A28E-435C7FE15154">内部定义的例外</a></p>
                  </li>
                  <li>
                     <p><a href="plsql-error-handling.html#GUID-8C327B4A-71FA-4CFB-8BC9-4550A23734D6">预定义的例外</a></p>
                  </li>
                  <li>
                     <p><a href="plsql-error-handling.html#GUID-8844A6D8-FE6F-4DFF-B449-59AB076316C1">用户定义的例外</a></p>
                  </li>
                  <li>
                     <p><a href="plsql-error-handling.html#GUID-C98B60A9-3931-4F8D-BE13-205A1779596D">重新声明预定义的例外情况</a></p>
                  </li>
                  <li>
                     <p><a href="plsql-error-handling.html#GUID-66346B68-7A18-438C-951B-A60F970D98B8">明确提高例外情况</a></p>
                  </li>
                  <li>
                     <p><a href="plsql-error-handling.html#GUID-A99B76C3-44DF-40E1-AB7A-454C6805B9BB">例外传播</a></p>
                  </li>
                  <li>
                     <p><a href="plsql-error-handling.html#GUID-494984A3-37E6-41BF-9BB9-05A693CD9577">未处理的例外情况</a></p>
                  </li>
                  <li>
                     <p><a href="plsql-error-handling.html#GUID-7E0CDD98-D31C-4745-B819-B5C5E1DF90A8">检索错误代码和错误消息</a></p>
                  </li>
                  <li>
                     <p><a href="plsql-error-handling.html#GUID-E63131E7-4AE6-4C47-8D21-5EC1F6D3AA68">处理异常后继续执行</a></p>
                  </li>
                  <li>
                     <p><a href="plsql-error-handling.html#GUID-CF7B91D7-215F-48D7-AE83-240012CE8ED6">处理异常后重试事务</a></p>
                  </li>
                  <li>
                     <p><a href="plsql-error-handling.html#GUID-6B966875-B27C-4FDF-8334-8FB3B22ABF4A">处理分布式查询中的错误</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-0502DC1A-F0A5-4180-A912-6A5CDC855F56__GUID-259299D7-DFBB-4A11-B67B-227D5CE7D490">
                  <p class="notep1">也可以看看：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><span class="q">“ <a href="plsql-triggers.html#GUID-FA7A16B6-F94D-4E4C-A326-F602FE9FE3E8">触发器中的异常处理</a> ”</span></p>
                     </li>
                     <li>
                        <p><span class="q">“ <a href="plsql-optimization-and-tuning.html#GUID-DAF46F06-EF3F-4B1A-A518-5238B80C69FA" title="要允许FORALL语句继续，即使它的某些DML语句失败，也包括SAVE EXCEPTIONS子句。当DML语句失败时，PL / SQL不会引发异常;相反，它保存了有关失败的信息。FORALL语句完成后，PL / SQL为FORALL语句（ORA-24381）引发一个异常。">处理FORALL语句完成后的FORALL异常</a> ”</span></p>
                     </li>
                  </ul>
               </div>
               <div class="infobox-tip" id="GUID-0502DC1A-F0A5-4180-A912-6A5CDC855F56__GUID-4C263734-9F93-4DBB-804A-ECCF5F973199">
                  <p class="notep1">小费：</p>
                  <p>如果您在创建或运行PL / SQL代码时遇到问题，请检查Oracle数据库跟踪文件。<code class="codeph">DIAGNOSTIC_DEST</code>初始化参数指定跟踪文件的当前位置。您可以通过发出<code class="codeph">SHOW</code> <code class="codeph">PARAMETER</code> <code class="codeph">DIAGNOSTIC_DEST</code>或查询<code class="codeph">V$DIAG_INFO</code>视图来查找此参数的值。有关诊断数据的更多信息，请参见“ <a href="../admin/diagnosing-and-resolving-problems.html#ADMIN11007" target="_blank"><span class="italic">Oracle数据库管理员指南”</span></a> 。
                  </p>
               </div>
            </div><a id="LNPLS858"></a><a id="LNPLS860"></a><a id="LNPLS00711"></a><div class="props_rev_3"><a id="GUID-3311B813-3185-4751-A3A6-309B93973366" name="GUID-3311B813-3185-4751-A3A6-309B93973366"></a><h3 id="LNPLS-GUID-3311B813-3185-4751-A3A6-309B93973366" class="sect3"><span class="enumeration_section">11.1</span>编译时警告</h3>
               <div>
                  <p>在编译存储的PL / SQL单元时，PL / SQL编译器会为不足以导致错误并阻止编译的条件生成警告 - 例如，使用不推荐的PL / SQL功能。</p>
                  <p>要查看编译期间生成的警告（和错误），请查询静态数据字典视图<code class="codeph">*_ERRORS</code>或者在SQL * Plus环境中使用命令<code class="codeph">SHOW</code> <code class="codeph">ERRORS</code> 。</p>
                  <p>PL / SQL警告的消息代码格式为PLW- <span class="italic">nnnnn</span> 。
                  </p>
                  <div class="tblformal" id="GUID-3311B813-3185-4751-A3A6-309B93973366__BCFFJBII">
                     <p class="titleintable">表11-1编译时警告类别</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="编译时警告类别" width="100%" border="1" summary="This table summarizes the categories of PL/SQL warnings." frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="21%" id="d82955e359">类别</th>
                              <th align="left" valign="bottom" width="42%" id="d82955e362">描述</th>
                              <th align="left" valign="bottom" width="37%" id="d82955e365">例</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="21%" id="d82955e370" headers="d82955e359 ">
                                 <p><code class="codeph">严重</code></p>
                              </td>
                              <td align="left" valign="top" width="42%" headers="d82955e370 d82955e362 ">
                                 <p>条件可能会导致意外操作或错误结果。</p>
                              </td>
                              <td align="left" valign="top" width="37%" headers="d82955e370 d82955e365 ">
                                 <p>参数别名问题</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="21%" id="d82955e381" headers="d82955e359 ">
                                 <p><code class="codeph">性能</code></p>
                              </td>
                              <td align="left" valign="top" width="42%" headers="d82955e381 d82955e362 ">
                                 <p>条件可能会导致性能问题。</p>
                              </td>
                              <td align="left" valign="top" width="37%" headers="d82955e381 d82955e365 ">
                                 <p>将<code class="codeph">VARCHAR2</code>值传递给<code class="codeph">INSERT</code>语句中的<code class="codeph">NUMBER</code>列</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="21%" id="d82955e401" headers="d82955e359 ">
                                 <p><code class="codeph">信息化</code></p>
                              </td>
                              <td align="left" valign="top" width="42%" headers="d82955e401 d82955e362 ">
                                 <p>条件不会影响性能或正确性，但您可能希望更改它以使代码更易于维护。</p>
                              </td>
                              <td align="left" valign="top" width="37%" headers="d82955e401 d82955e365 ">
                                 <p>永远不会运行的代码</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <p>通过设置编译参数<code class="codeph">PLSQL_WARNINGS</code> ，您可以：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>启用和禁用所有警告，一个或多个警告类别或特定警告</p>
                     </li>
                     <li>
                        <p>将特定警告视为错误（以便在编译PL / SQL单元之前必须更正这些条件）</p>
                     </li>
                  </ul>
                  <p>您可以为以下项设置<code class="codeph">PLSQL_WARNINGS</code>的值：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>您的Oracle数据库实例</p>
                        <p>使用<a href="../sqlrf/ALTER-SYSTEM.html#SQLRF00902" target="_blank"><span class="italic">Oracle数据库SQL语言参考中</span></a>描述的<code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code>语句。
                        </p>
                     </li>
                     <li>
                        <p>你的会议</p>
                        <p>使用<a href="../sqlrf/ALTER-SESSION.html#SQLRF00901" target="_blank"><span class="italic">Oracle数据库SQL语言参考中</span></a>描述的<code class="codeph">ALTER</code> <code class="codeph">SESSION</code>语句。
                        </p>
                     </li>
                     <li>
                        <p>存储的PL / SQL单元</p>
                        <p>使用<code class="codeph">ALTER</code>从<span class="q">“</span>语句<span class="q"><a href="sql-statements-for-stored-plsql-units.html#GUID-C918310F-F1BB-41D7-9466-B558B70DDFFE__BABEFIJF">ALTER声明</a> ”，</span>其<span class="italic"><code class="codeph">compiler_parameters_clause</code></span> 。
                        </p>
                     </li>
                  </ul>
                  <p>在任何前面的<code class="codeph">ALTER</code>语句中，您使用以下语法设置<code class="codeph">PLSQL_WARNINGS</code>的值：</p><pre class="oac_no_warn" dir="ltr">PLSQL_WARNINGS =' <span class="italic">value_clause</span> '[，' <span class="italic">value_clause</span> '] ......
</pre><p>有关<span class="italic"><code class="codeph">value_clause</code></span>的语法，请参见<a href="../refrn/PLSQL_WARNINGS.html#REFRN10249" target="_blank"><span class="italic">Oracle数据库参考</span></a> 。
                  </p>
                  <p>要显示<code class="codeph">PLSQL_WARNINGS</code>的当前值，请查询静态数据字典视图<code class="codeph">ALL_PLSQL_OBJECT_SETTINGS</code> 。</p>
                  <div class="infoboxnotealso" id="GUID-3311B813-3185-4751-A3A6-309B93973366__GUID-28A20727-19D4-48A3-9D5E-2F9B4E3B3540">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>有关静态数据字典视图<code class="codeph">ALL_PLSQL_OBJECT_SETTINGS</code>更多信息，请<a href="../refrn/ALL_PLSQL_OBJECT_SETTINGS.html#REFRN20385" target="_blank"><span class="italic">参见Oracle数据库参考</span></a></p>
                        </li>
                        <li>
                           <p>所有PL / SQL警告的消息代码的<a href="../errmg/using-messages.html#ERRMG-GUID-CA5A766D-6CBF-4235-982F-86A6F34266CC" target="_blank"><span class="italic">Oracle数据库错误消息参考</span></a></p>
                        </li>
                        <li>
                           <p>有关静态数据字典视图<code class="codeph">*_ERRORS</code>更多信息，请<a href="../refrn/ALL_ERRORS.html#REFRN20065" target="_blank"><span class="italic">参见Oracle数据库参考</span></a></p>
                        </li>
                        <li>
                           <p><span class="q">“ <a href="overview.html#GUID-DF63BC59-22C2-4BA8-9240-F74D505D5102" title="PL / SQL单元受PL / SQL编译参数（一类数据库初始化参数）的影响。不同的PL / SQL单元（例如，包规范及其主体）可以具有不同的编译参数设置。">PL / SQL单位和编译参数</a> ”</span>关于PL / SQL单元和编译器参数的详细信息</p>
                        </li>
                     </ul>
                  </div>
                  <div class="example" id="GUID-3311B813-3185-4751-A3A6-309B93973366__CHDIDDFJ">
                     <p class="titleinexample">例11-1设置PLSQL_WARNINGS编译参数的值</p>
                     <p>此示例显示了几个设置<code class="codeph">PLSQL_WARNINGS</code>值的<code class="codeph">ALTER</code>语句。</p>
                     <p>对于会话，启用在开发期间强烈建议的所有警告：</p><pre class="oac_no_warn" dir="ltr">ALTER SESSION SET PLSQL_WARNINGS ='ENABLE：ALL';</pre><p>对于会话，启用<code class="codeph">PERFORMANCE</code>警告：</p><pre class="oac_no_warn" dir="ltr">ALTER SESSION SET PLSQL_WARNINGS ='ENABLE：PERFORMANCE';</pre><p>对于过程<code class="codeph">loc_var</code> ，启用<code class="codeph">PERFORMANCE</code>警告， <code class="codeph">loc_var</code>用设置：</p><pre class="oac_no_warn" dir="ltr">ALTER PROCEDURE loc_var COMPILE PLSQL_WARNINGS ='ENABLE：PERFORMANCE'REUSE SETTINGS;</pre><p>对于会话，启用<code class="codeph">SEVERE</code>警告，禁用<code class="codeph">PERFORMANCE</code>警告，并将PLW-06002警告视为错误：</p><pre class="oac_no_warn" dir="ltr">ALTER SESSION SET PLSQL_WARNINGS ='ENABLE：SEVERE'，'DISABLE：PERFORMANCE'，'ERROR：06002';</pre><p>对于会话，禁用所有警告：</p><pre class="oac_no_warn" dir="ltr">ALTER SESSION SET PLSQL_WARNINGS ='DISABLE：ALL';</pre></div>
                  <!-- class="example" -->
               </div><a id="LNPLS862"></a><a id="LNPLS861"></a><div class="props_rev_3"><a id="GUID-1E14A3FD-C1FB-466D-9700-1333293BBF7E" name="GUID-1E14A3FD-C1FB-466D-9700-1333293BBF7E"></a><h4 id="LNPLS-GUID-1E14A3FD-C1FB-466D-9700-1333293BBF7E" class="sect4"><span class="enumeration_section">11.1.1</span> DBMS_WARNING包</h4>
                  <div>
                     <p>如果要在编译它们的开发环境中编写PL / SQL单元（例如SQL * Plus），则可以通过在<code class="codeph">DBMS_WARNING</code>包中调用子程序来显示和设置<code class="codeph">PLSQL_WARNINGS</code>的值。
                     </p>
                     <p><a href="plsql-error-handling.html#GUID-1E14A3FD-C1FB-466D-9700-1333293BBF7E__BABDGEJA">示例11-2</a>使用<code class="codeph">ALTER</code> <code class="codeph">SESSION</code>语句禁用会话的所有警告消息，然后编译具有无法访问代码的过程。该过程在没有警告的情况下编译。接下来，示例能够用于该会话的所有警告通过调用<code class="codeph">DBMS_WARNING.set_warning_setting_string</code>和显示的值<code class="codeph">PLSQL_WARNINGS</code>通过调用<code class="codeph">DBMS_WARNING.get_warning_setting_string</code> 。最后，该示例重新编译该过程，编译器生成有关无法访问的代码的警告。
                     </p>
                     <div class="infoboxnote" id="GUID-1E14A3FD-C1FB-466D-9700-1333293BBF7E__GUID-3E20B002-70EC-4B9A-B59A-4CE055DB588A">
                        <p class="notep1">注意：</p>
                        <p>无法访问的代码可能表示错误或被调试标志故意隐藏。</p>
                     </div>
                     <p>当您编译由多个嵌套SQL * Plus脚本组成的复杂应用程序时， <code class="codeph">DBMS_WARNING</code>子程序非常有用，其中不同的子程序需要不同的<code class="codeph">PLSQL_WARNINGS</code>设置。使用<code class="codeph">DBMS_WARNING</code>子程序，可以保存当前的<code class="codeph">PLSQL_WARNINGS</code>设置，更改设置以编译特定的子程序集，然后将设置恢复为其原始值。
                     </p>
                     <div class="infoboxnotealso" id="GUID-1E14A3FD-C1FB-466D-9700-1333293BBF7E__GUID-17B616F9-755C-4540-A939-D87B0E6F9EE1">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<code class="codeph">DBMS_WARNING</code>包的更多信息，请<code class="codeph">DBMS_WARNING</code> <a href="../arpls/DBMS_WARNING.html#ARPLS370" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a></p>
                     </div>
                     <div class="example" id="GUID-1E14A3FD-C1FB-466D-9700-1333293BBF7E__BABDGEJA">
                        <p class="titleinexample">示例11-2使用DBMS_WARNING子程序显示和设置PLSQL_WARNINGS</p>
                        <p>禁用此会话的所有警告消息：</p><pre class="oac_no_warn" dir="ltr">ALTER SESSION SET PLSQL_WARNINGS ='DISABLE：ALL';</pre><p>禁用警告后，此过程将编译，不会发出警告：</p><pre class="oac_no_warn" dir="ltr">创建或替换过程unreachable_code AUTHID DEFINER as x CONSTANT BOOLEAN：= TRUE; BEGIN IF x THEN DBMS_OUTPUT.PUT_LINE（'TRUE'）; ELSE DBMS_OUTPUT.PUT_LINE（'FALSE'）;万一; END unreachable_code; /</pre><p>启用此会话的所有警告消息：</p><pre class="oac_no_warn" dir="ltr"><span class="bold">CALL DBMS_WARNING.set_warning_setting_string（'ENABLE：ALL'，'SESSION'）;</span>
</pre><p>检查警告设置：</p><pre class="oac_no_warn" dir="ltr"><span class="bold">SELECT DBMS_WARNING.get_warning_setting_string（）FROM DUAL;</span>
</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">DBMS_WARNING.GET_WARNING_SETTING_STRING（）----------------------------------------- ENABLE：ALL 1行选中。
</pre><p>重新编译程序：</p><pre class="oac_no_warn" dir="ltr">ALTER PROCEDURE unreachable_code COMPILE;</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">SP2-0805：程序随编译警告而改变</pre><p>显示错误：</p><pre class="oac_no_warn" dir="ltr">显示错误</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">PROCEDURE的错误UNREACHABLE_CODE：LINE / COL ERROR -------- --------------------------------- -------------------------------- 7/5 PLW-06002：无法访问的代码</pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div><a id="LNPLS726"></a><a id="LNPLS00701"></a><div class="props_rev_3"><a id="GUID-343E0653-9BCE-48F5-A00A-795D77B96B44" name="GUID-343E0653-9BCE-48F5-A00A-795D77B96B44"></a><h3 id="LNPLS-GUID-343E0653-9BCE-48F5-A00A-795D77B96B44" class="sect3"><span class="enumeration_section">11.2</span>异常处理概述</h3>
               <div>
                  <p>异常（PL / SQL运行时错误）可能由设计错误，编码错误，硬件故障和许多其他来源引起。您无法预测所有可能的异常，但您可以编写异常处理程序，让您的程序继续在其存在的情况下运行。</p>
                  <p>任何PL / SQL块都可以有一个异常处理部分，它可以有一个或多个异常处理程序。例如，异常处理部分可以具有以下语法：</p><pre class="oac_no_warn" dir="ltr"><span class="italic">ex_name_1</span> THEN <span class="italic">statements_1之外的</span>异常 - 异常处理程序WHEN <span class="italic">ex_name_2</span> OR <span class="italic">ex_name_3</span> THEN <span class="italic">statements_2</span> - 异常处理程序WHEN OTHERS THEN <span class="italic">statements_3</span> - 异常处理程序END;</pre><p>在前面的语法示例中， <span class="italic"><code class="codeph">ex_name_</code></span> <code class="codeph">n</code>是异常的名称，而<span class="italic"><code class="codeph">statements_</code></span> <code class="codeph">n</code>是一个或多个语句。（有关完整的语法和语义，请参阅<span class="q">“ <a href="exception-handler.html#GUID-3FECF29B-A240-4191-A635-92C612D00C4D" title="异常处理程序处理引发的异常。">异常处理程序</a> ”</span> 。）
                  </p>
                  <p>当在块的可执行部分中引发异常时，可执行部分停止并控制对异常处理部分的转移。如果<span class="italic"><code class="codeph">ex_name_1</code></span> ，那么<span class="italic"><code class="codeph">statements_1</code></span>运行。如果<span class="italic"><code class="codeph">ex_name_2</code></span>或<span class="italic"><code class="codeph">ex_name_3</code></span> ，则<span class="italic"><code class="codeph">statements_2</code></span>运行。如果引发任何其他异常，则<span class="italic"><code class="codeph">statements_3</code></span>运行。
                  </p>
                  <p>在异常处理程序运行后，控制转移到封闭块的下一个语句。如果没有封闭块，那么：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>如果异常处理程序在子程序中，则控制将在调用之后的语句处返回到调用者。</p>
                     </li>
                     <li>
                        <p>如果异常处理程序位于匿名块中，则控件将传输到主机环境（例如，SQL * Plus）</p>
                     </li>
                  </ul>
                  <p>如果在没有异常处理程序的块中引发异常，则异常传播。也就是说，异常在连续的封闭块中再现它，直到一个块有一个处理程序或者没有封闭块（有关更多信息，请参阅<span class="q">“ <a href="plsql-error-handling.html#GUID-A99B76C3-44DF-40E1-AB7A-454C6805B9BB">异常传播</a> ”</span> ）。如果没有异常处理程序，则PL / SQL会向调用者或主机环境返回未处理的异常错误，这将确定结果（有关更多信息，请参阅<span class="q">“ <a href="plsql-error-handling.html#GUID-494984A3-37E6-41BF-9BB9-05A693CD9577">未处理的异常</a> ”</span> ）。
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-343E0653-9BCE-48F5-A00A-795D77B96B44__GUID-80F067F8-7CA5-40F5-ABED-5B3CCD8DD425">话题</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="plsql-error-handling.html#GUID-380AD917-BC6A-4444-9CDF-C9E232CDFBB8">例外类别</a></p>
                        </li>
                        <li>
                           <p><a href="plsql-error-handling.html#GUID-E91802C5-02CB-477F-8A58-89982BBBA5FF">异常处理程序的优点</a></p>
                        </li>
                        <li>
                           <p><a href="plsql-error-handling.html#GUID-F3811176-28A0-4987-A363-C0E6F660185B">避免和处理例外的准则</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="LNPLS728"></a><a id="LNPLS99872"></a><div class="props_rev_3"><a id="GUID-380AD917-BC6A-4444-9CDF-C9E232CDFBB8" name="GUID-380AD917-BC6A-4444-9CDF-C9E232CDFBB8"></a><h4 id="LNPLS-GUID-380AD917-BC6A-4444-9CDF-C9E232CDFBB8" class="sect4"><span class="enumeration_section">11.2.1</span>例外类别</h4>
                  <div>
                     <p>例外类别是：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="bold">内部定义</span></p>
                           <p>运行时系统隐式（自动）引发内部定义的异常。内部定义的异常的示例是ORA-00060（在等待资源时检测到死锁）和ORA-27102（内存不足）。</p>
                           <p>内部定义的异常总是有一个错误代码，但没有名称，除非PL / SQL给它一个或你给它一个。</p>
                           <p>有关更多信息，请参阅<span class="q">“ <a href="plsql-error-handling.html#GUID-4F0787E6-ABCA-4860-A28E-435C7FE15154">内部定义的异常</a> ”</span> 。
                           </p>
                        </li>
                        <li>
                           <p><span class="bold">预定义</span></p>
                           <p>预定义的异常是PL / SQL给出名称的内部定义的异常。例如，ORA-06500（PL / SQL：存储错误）具有预定义名称<code class="codeph">STORAGE_ERROR</code> 。</p>
                           <p>有关更多信息，请参阅<span class="q">“ <a href="plsql-error-handling.html#GUID-8C327B4A-71FA-4CFB-8BC9-4550A23734D6">预定义的例外</a> ”</span> 。
                           </p>
                        </li>
                        <li>
                           <p><span class="bold">用户自定义</span></p>
                           <p>您可以在任何PL / SQL匿名块，子程序或包的声明部分声明自己的异常。例如，您可以声明名为<code class="codeph">insufficient_funds</code>的异常来标记透支银行帐户。
                           </p>
                           <p>您必须明确提出用户定义的异常。</p>
                           <p>有关更多信息，请参阅<span class="q">“ <a href="plsql-error-handling.html#GUID-8844A6D8-FE6F-4DFF-B449-59AB076316C1">用户定义的异常</a> ”</span> 。
                           </p>
                        </li>
                     </ul>
                     <p><a href="plsql-error-handling.html#GUID-380AD917-BC6A-4444-9CDF-C9E232CDFBB8__BABEDCFJ" title="此表总结了前一文本中的信息。它有三行，每个异常类别一行，六列。">表11-2</a>总结了异常类别。
                     </p>
                     <div class="tblformal" id="GUID-380AD917-BC6A-4444-9CDF-C9E232CDFBB8__BABEDCFJ">
                        <p class="titleintable">表11-2例外类别</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="例外类别" width="100%" border="1" summary="This table summarizes the information in the preceding text. It has three rows, one for each exception category, and six columns." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="12%" id="d82955e1133">类别</th>
                                 <th align="left" valign="bottom" width="7%" id="d82955e1136">定义者</th>
                                 <th align="left" valign="bottom" width="8%" id="d82955e1139">有错误代码</th>
                                 <th align="left" valign="bottom" width="8%" id="d82955e1142">有名字</th>
                                 <th align="left" valign="bottom" width="8%" id="d82955e1145">隐晦地提高</th>
                                 <th align="left" valign="bottom" width="57%" id="d82955e1148">明确提出</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="12%" id="d82955e1153" headers="d82955e1133 ">
                                    <p>内部定义</p>
                                 </td>
                                 <td align="left" valign="top" width="7%" headers="d82955e1153 d82955e1136 ">
                                    <p>运行时系统</p>
                                 </td>
                                 <td align="left" valign="top" width="8%" headers="d82955e1153 d82955e1139 ">
                                    <p>总是</p>
                                 </td>
                                 <td align="left" valign="top" width="8%" headers="d82955e1153 d82955e1142 ">
                                    <p>只有你指定一个</p>
                                 </td>
                                 <td align="left" valign="top" width="8%" headers="d82955e1153 d82955e1145 ">
                                    <p>是</p>
                                 </td>
                                 <td align="left" valign="top" width="57%" headers="d82955e1153 d82955e1148 ">
                                    <p>可选<a id="GUID-380AD917-BC6A-4444-9CDF-C9E232CDFBB8__BABDABEJ" name="GUID-380AD917-BC6A-4444-9CDF-C9E232CDFBB8__BABDABEJ" href="#GUID-380AD917-BC6A-4444-9CDF-C9E232CDFBB8__BABDABEJ" for="" details,="" see="" ="raising=" =")" ="" onclick="footdisplay(1, "><sup>脚1</sup></a></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="12%" id="d82955e1180" headers="d82955e1133 ">
                                    <p>预定义</p>
                                 </td>
                                 <td align="left" valign="top" width="7%" headers="d82955e1180 d82955e1136 ">
                                    <p>运行时系统</p>
                                 </td>
                                 <td align="left" valign="top" width="8%" headers="d82955e1180 d82955e1139 ">
                                    <p>总是</p>
                                 </td>
                                 <td align="left" valign="top" width="8%" headers="d82955e1180 d82955e1142 ">
                                    <p>总是</p>
                                 </td>
                                 <td align="left" valign="top" width="8%" headers="d82955e1180 d82955e1145 ">
                                    <p>是</p>
                                 </td>
                                 <td align="left" valign="top" width="57%" headers="d82955e1180 d82955e1148 ">
                                    <p><a id="fnsrc_d82955e1198" name="fnsrc_d82955e1198" href="#fnsrc_d82955e1198" for="" details,="" see="" ="raising=" =")" ="" onclick="footdisplay(1, "><sup>Footref 1</sup></a></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="12%" id="d82955e1201" headers="d82955e1133 ">
                                    <p>用户自定义</p>
                                 </td>
                                 <td align="left" valign="top" width="7%" headers="d82955e1201 d82955e1136 ">
                                    <p>用户</p>
                                 </td>
                                 <td align="left" valign="top" width="8%" headers="d82955e1201 d82955e1139 ">
                                    <p>只有你指定一个</p>
                                 </td>
                                 <td align="left" valign="top" width="8%" headers="d82955e1201 d82955e1142 ">
                                    <p>总是</p>
                                 </td>
                                 <td align="left" valign="top" width="8%" headers="d82955e1201 d82955e1145 ">
                                    <p>没有</p>
                                 </td>
                                 <td align="left" valign="top" width="57%" headers="d82955e1201 d82955e1148 ">
                                    <p>总是</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p class="tablefootnote"><sup class="tablefootnote">脚注1</sup></p><p>有关详细信息，请参阅<span class="q">“ <a href="plsql-error-handling.html#GUID-4A73BF41-AA57-4F64-8E4C-265029BEEF39">使用RAISE语句提升内部定义的异常</a> ”</span> 。
                        </p>
                     <p></p>
                     <p>对于命名异常，您可以编写特定的异常处理程序，而不是使用<code class="codeph">OTHERS</code>异常处理程序处理它。特定的异常处理程序比<code class="codeph">OTHERS</code>异常处理程序更有效，因为后者必须调用一个函数来确定它正在处理哪个异常。有关详细信息，请参阅<span class="q">“ <a href="plsql-error-handling.html#GUID-7E0CDD98-D31C-4745-B819-B5C5E1DF90A8">检索错误代码和错误消息</a> ”</span> 。
                     </p>
                  </div>
               </div><a id="LNPLS828"></a><a id="LNPLS856"></a><a id="LNPLS00702"></a><div class="props_rev_3"><a id="GUID-E91802C5-02CB-477F-8A58-89982BBBA5FF" name="GUID-E91802C5-02CB-477F-8A58-89982BBBA5FF"></a><h4 id="LNPLS-GUID-E91802C5-02CB-477F-8A58-89982BBBA5FF" class="sect4"><span class="enumeration_section">11.2.2</span>异常处理程序的优点</h4>
                  <div>
                     <p>使用异常处理程序进行错误处理使程序更易于编写和理解，并降低了未处理异常的可能性。</p>
                     <p>如果没有异常处理程序，您必须检查可能发生的每个可能的错误，然后处理它。很容易忽略可能出现的错误或可能发生错误的地方，特别是如果错误无法立即检测到（例如，在计算中使用错误数据之前可能无法检测到错误数据）。错误处理代码分散在整个程序中。</p>
                     <p>使用异常处理程序，您无需知道每个可能的错误或任何可能发生的错误。您只需在每个可能发生错误的块中包含异常处理部分。在异常处理部分中，您可以包含特定和未知错误的异常处理程序。如果块中的任何地方（包括子块内）发生错误，则异常处理程序会处理它。错误处理代码在块的异常处理部分中被隔离。</p>
                     <p>在<a href="plsql-error-handling.html#GUID-E91802C5-02CB-477F-8A58-89982BBBA5FF__BABFBHGA">例11-3中</a> ，过程使用单个异常处理程序来处理预定义的异常<code class="codeph">NO_DATA_FOUND</code> ，该异常可以出现在两个<code class="codeph">SELECT</code> <code class="codeph">INTO</code>语句中。
                     </p>
                     <p>如果多个语句使用相同的异常处理程序，并且您想知道哪个语句失败，则可以使用定位符变量，如<a href="plsql-error-handling.html#GUID-E91802C5-02CB-477F-8A58-89982BBBA5FF__BCFCFBDD">例11-4所示</a> 。
                     </p>
                     <p>您可以确定错误处理代码的精度。对于所有除零错误，错误的数组索引等，您可以拥有一个异常处理程序。您还可以通过将该语句放在具有自己的异常处理程序的块中来检查单个语句中的错误。</p>
                     <div class="example" id="GUID-E91802C5-02CB-477F-8A58-89982BBBA5FF__BABFBHGA">
                        <p class="titleinexample">示例11-3多个异常的单个异常处理程序</p><pre class="oac_no_warn" dir="ltr">创建或替换过程select_item（t_column VARCHAR2，t_name VARCHAR2）AUTHID DEFINER是temp VARCHAR2（30）; BEGIN temp：= t_column; - 如果下一个SELECT失败，则显示错误消息 - 如果表t_name没有列t_column，则失败：SELECT COLUMN_NAME INTO temp FROM USER_TAB_COLS WHERE TABLE_NAME = UPPER（t_name）AND COLUMN_NAME = UPPER（t_column）; temp：= t_name; - 如果下一个SELECT失败，则显示错误消息 - 如果没有名为t_name的表，则失败：SELECT OBJECT_NAME INTO temp FROM USER_OBJECTS WHERE OBJECT_NAME = UPPER（t_name）AND OBJECT_TYPE ='TABLE'; <span class="bold">NO_DATA_FOUND，然后是</span> <span class="bold">DBMS_OUTPUT.PUT_LINE（'找不到'|| temp上的SELECT数据）的</span>异常<span class="bold">;</span>等等DBMS_OUTPUT.PUT_LINE（'意外错误'）;提高;结束; /</pre><p>调用过程（有一个<code class="codeph">DEPARTMENTS</code>表，但它没有<code class="codeph">LAST_NAME</code>列）：</p><pre class="oac_no_warn" dir="ltr">BEGIN select_item（'departments'，'last_name'）;结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr"><span class="bold">没有在部门上找到SELECT的数据</span>
</pre><p>调用过程（没有<code class="codeph">EMP</code>表）：</p><pre class="oac_no_warn" dir="ltr">BEGIN select_item（'emp'，'last_name'）;结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr"><span class="bold">在emp上找不到SELECT的数据</span>
</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-E91802C5-02CB-477F-8A58-89982BBBA5FF__BCFCFBDD">
                        <p class="titleinexample">示例11-4共享异常处理程序的语句的定位符变量</p><pre class="oac_no_warn" dir="ltr">创建或替换过程loc_var AUTHID DEFINER是stmt_no POSITIVE; name_ VARCHAR2（100）; BEGIN <span class="bold">stmt_no：= 1;</span> SELECT table_name INTO name_ FROM user_tables WHERE table_name LIKE'ABC％'; <span class="bold">stmt_no：= 2;</span> SELECT table_name INTO name_ FROM user_tables WHERE table_name LIKE'XYZ％'; NO_DATA_FOUND之后的异常DBMS_OUTPUT.PUT_LINE（'查询中找不到表名'|| <span class="bold">stmt_no</span> ）;结束; / CALL loc_var（）;</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr"><span class="bold">在查询1中找不到表名</span>
</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="LNPLS00712"></a><div class="props_rev_3"><a id="GUID-F3811176-28A0-4987-A363-C0E6F660185B" name="GUID-F3811176-28A0-4987-A363-C0E6F660185B"></a><h4 id="LNPLS-GUID-F3811176-28A0-4987-A363-C0E6F660185B" class="sect4"><span class="enumeration_section">11.2.3</span>避免和处理例外的指南</h4>
                  <div>
                     <p>为了使您的程序尽可能可靠和安全：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>使用错误检查代码和异常处理程序。</p>
                           <p>在错误的输入数据可能导致错误的地方使用错误检查代码。错误输入数据的示例是不正确的或空的实际参数以及不返回行或超出预期的行的查询。使用不同输入数据的不同组合测试代码，以查看可能出现的错误。</p>
                           <p>有时您可以使用错误检查代码来避免引发异常，如<a href="plsql-error-handling.html#GUID-8C327B4A-71FA-4CFB-8BC9-4550A23734D6__CHDIFEDH">例11-7所示</a> 。
                           </p>
                        </li>
                        <li>
                           <p>在可能发生错误的地方添加异常处理程序。</p>
                           <p>在算术计算，字符串操作和数据库操作期间尤其可能出现错误。错误也可能源于与您的代码无关的问题 - 例如，磁盘存储或内存硬件故障 - 但您的代码仍然必须采取纠正措施。</p>
                        </li>
                        <li>
                           <p>设计您的程序，以便在数据库未处于您期望的状态时工作。</p>
                           <p>例如，您查询的表可能添加或删除了列，或者它们的类型可能已更改。通过使用<code class="codeph">%TYPE</code>限定符声明标量变量并使用<code class="codeph">%ROWTYPE</code>限定符记录变量来保存查询结果，可以避免出现问题。
                           </p>
                        </li>
                        <li>
                           <p>尽可能为命名异常编写异常处理程序，而不是使用<code class="codeph">OTHERS</code>异常处理程序。
                           </p>
                           <p>了解预定义异常的名称和原因。如果您知道数据库操作可能会引发没有名称的特定内部定义的异常，那么请为它们指定名称，以便您可以专门为它们编写异常处理程序。</p>
                        </li>
                        <li>
                           <p>让异常处理程序输出调试信息。</p>
                           <p>如果将调试信息存储在单独的表中，请使用自治例程，以便即使您回滚主子程序所执行的工作也可以提交调试信息。有关自治例程的信息，请参阅<span class="q">“ <a href="AUTONOMOUS_TRANSACTION-pragma.html#GUID-AD33D949-081B-4CD3-A240-C29773E908C3" title="AUTONOMOUS_TRANSACTION编译指示将例程标记为自治;也就是说，独立于主要交易。">AUTONOMOUS_TRANSACTION Pragma</a> ”</span> 。
                           </p>
                        </li>
                        <li>
                           <p>对于每个异常处理程序，请仔细决定是将其提交事务，将其回滚还是让它继续。</p>
                           <p>无论错误的严重程度如何，您都希望使数据库保持一致状态并避免存储错误数据。</p>
                        </li>
                        <li>
                           <p>通过在每个PL / SQL程序的顶层包含<code class="codeph">OTHERS</code>异常处理程序来避免未处理的异常。
                           </p>
                           <p>使<code class="codeph">OTHERS</code>异常处理程序中的最后一个语句成为<code class="codeph">RAISE</code>或调用<code class="codeph">RAISE_APPLICATION_ERROR</code>过程。（如果您不遵循此惯例，并且启用了PL / SQL警告，那么您将获得PLW-06009。）有关<code class="codeph">RAISE</code>或调用<code class="codeph">RAISE_APPLICATION_ERROR</code> ，请参阅<span class="q">“ <a href="plsql-error-handling.html#GUID-66346B68-7A18-438C-951B-A60F970D98B8">明确提高异常</a> ”</span> 。
                           </p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="LNPLS729"></a><a id="LNPLS99871"></a><div class="props_rev_3"><a id="GUID-4F0787E6-ABCA-4860-A28E-435C7FE15154" name="GUID-4F0787E6-ABCA-4860-A28E-435C7FE15154"></a><h3 id="LNPLS-GUID-4F0787E6-ABCA-4860-A28E-435C7FE15154" class="sect3"><span class="enumeration_section">11.3</span>内部定义的例外</h3>
               <div>
                  <p><a href="../errmg/ORA-00000.html#ERRMG-GUID-27437B7F-F0C3-4F1F-9C6E-6780706FB0F6" target="_blank"><span class="italic">Oracle数据库错误消息参考</span></a>中描述了<span class="bold">内部定义的异常</span> （ORA- <span class="italic">n</span>错误）。运行时系统隐式（自动）引发它们。
                  </p>
                  <p>内部定义的异常没有名称，除非PL / SQL给它一个（参见<span class="q">“ <a href="plsql-error-handling.html#GUID-8C327B4A-71FA-4CFB-8BC9-4550A23734D6">预定义的异常</a> ”</span> ）或者给它一个。
                  </p>
                  <p>如果您知道数据库操作可能会引发没有名称的特定内部定义的异常，那么请为它们指定名称，以便您可以专门为它们编写异常处理程序。否则，您只能使用<code class="codeph">OTHERS</code>异常处理程序处理它们。
                  </p>
                  <p>要为内部定义的异常指定名称，请在相应的匿名块，子程序或包的声明部分中执行以下操作。（要确定适当的块，请参阅<span class="q">“ <a href="plsql-error-handling.html#GUID-A99B76C3-44DF-40E1-AB7A-454C6805B9BB">异常传播</a> ”</span> 。）
                  </p>
                  <ol>
                     <li>
                        <p>声明名称。</p>
                        <p>异常名称声明具有以下语法：</p><pre class="oac_no_warn" dir="ltr"><span class="italic">exception_name</span> EXCEPTION;</pre><p>有关语义信息，请参阅<span class="q">“ <a href="exception-declaration.html#GUID-AAC8C54F-775C-4E65-B531-0350CFF5B1BD" title="异常声明声明用户定义的异常的名称。">异常声明</a> ”</span> 。
                        </p>
                     </li>
                     <li>
                        <p>将名称与内部定义的异常的错误代码相关联。</p>
                        <p>语法是：</p><pre class="oac_no_warn" dir="ltr">PRAGMA EXCEPTION_INIT（ <span class="italic">exception_name</span> ， <span class="italic">error_code</span> ）</pre><p>有关语义信息，请参阅<span class="q">“ <a href="EXCEPTION_INIT-pragma.html#GUID-873A087E-A470-4798-9152-16BC673B4940" title="EXCEPTION_INIT pragma将用户定义的异常名称与错误代码相关联。">EXCEPTION_INIT Pragma</a> ”</span> 。
                        </p>
                     </li>
                  </ol>
                  <div class="infoboxnote" id="GUID-4F0787E6-ABCA-4860-A28E-435C7FE15154__GUID-19CD3551-D4F4-4795-80DF-C3D23905C1A8">
                     <p class="notep1">注意：</p>
                     <p>具有用户声明的名称的内部定义的异常仍然是内部定义的异常，而不是用户定义的异常。</p>
                  </div>
                  <p><a href="plsql-error-handling.html#GUID-4F0787E6-ABCA-4860-A28E-435C7FE15154__BABBDJAB">例11-5</a>给出了名称<code class="codeph">deadlock_detected</code>到内部定义的异常ORA-00060（在等待资源时检测到死锁）并在异常处理程序中使用该名称。
                  </p>
                  <div class="infoboxnotealso" id="GUID-4F0787E6-ABCA-4860-A28E-435C7FE15154__GUID-611ECC9F-6771-4E27-8D3C-72A6DC394792">
                     <p class="notep1">也可以看看：</p>
                     <p><span class="q">“ <a href="plsql-error-handling.html#GUID-4A73BF41-AA57-4F64-8E4C-265029BEEF39">通过RAISE声明提升内部定义的异常</a> ”</span></p>
                  </div>
                  <div class="example" id="GUID-4F0787E6-ABCA-4860-A28E-435C7FE15154__BABBDJAB">
                     <p class="titleinexample">例11-5命名内部定义的异常</p><pre class="oac_no_warn" dir="ltr">DECLARE <span class="bold">deadlock_detected EXCEPTION;</span> <span class="bold">PRAGMA EXCEPTION_INIT（deadlock_detected，-60）;</span>开始 ...<span class="bold">deadlock_detected那么</span>异常<span class="bold">那么</span> ......结束; /</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="LNPLS730"></a><a id="LNPLS827"></a><a id="LNPLS732"></a><a id="LNPLS1906"></a><a id="LNPLS00703"></a><div class="props_rev_3"><a id="GUID-8C327B4A-71FA-4CFB-8BC9-4550A23734D6" name="GUID-8C327B4A-71FA-4CFB-8BC9-4550A23734D6"></a><h3 id="LNPLS-GUID-8C327B4A-71FA-4CFB-8BC9-4550A23734D6" class="sect3"><span class="enumeration_section">11.4</span>预定义的例外</h3>
               <div>
                  <p><span class="bold">预定义的异常</span>是具有预定义名称的内部定义的异常，PL / SQL在程序包<code class="codeph">STANDARD</code>全局声明。运行时系统隐式（自动）引发预定义的异常。由于预定义的异常具有名称，因此您可以专门为它们编写异常处理程序。
                  </p>
                  <p><a href="plsql-error-handling.html#GUID-8C327B4A-71FA-4CFB-8BC9-4550A23734D6__CIHHGGDI" title="此表给出了PL / SQL预定义异常的名称和错误号。">表11-3</a>列出了预定义异常的名称和错误代码。
                  </p>
                  <div class="tblformal" id="GUID-8C327B4A-71FA-4CFB-8BC9-4550A23734D6__CIHHGGDI">
                     <p class="titleintable">表11-3 PL / SQL预定义的异常</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="PL / SQL预定义的异常" width="100%" border="1" summary="This table gives the names and error numbers of the PL/SQL predefined exceptions." frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="38%" id="d82955e1948">例外名称</th>
                              <th align="left" valign="bottom" width="62%" id="d82955e1952">错误代码</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e1957" headers="d82955e1948 ">
                                 <p><code class="codeph">ACCESS_INTO_NULL</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e1957 d82955e1952 ">
                                 <p><code class="codeph">-6530</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e1966" headers="d82955e1948 ">
                                 <p><code class="codeph">CASE_NOT_FOUND</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e1966 d82955e1952 ">
                                 <p><code class="codeph">-6592</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e1975" headers="d82955e1948 ">
                                 <p><code class="codeph">COLLECTION_IS_NULL</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e1975 d82955e1952 ">
                                 <p><code class="codeph">-6531</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e1984" headers="d82955e1948 ">
                                 <p><code class="codeph">CURSOR_ALREADY_OPEN</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e1984 d82955e1952 ">
                                 <p><code class="codeph">-6511</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e1993" headers="d82955e1948 ">
                                 <p><code class="codeph">DUP_VAL_ON_INDEX</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e1993 d82955e1952 ">
                                 <p><code class="codeph">-1</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e2002" headers="d82955e1948 ">
                                 <p><code class="codeph">INVALID_CURSOR</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e2002 d82955e1952 ">
                                 <p><code class="codeph">-1001</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e2011" headers="d82955e1948 ">
                                 <p><code class="codeph">无效号码</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e2011 d82955e1952 ">
                                 <p><code class="codeph">-1722</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e2020" headers="d82955e1948 ">
                                 <p><code class="codeph">LOGIN_DENIED</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e2020 d82955e1952 ">
                                 <p><code class="codeph">-1017</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e2029" headers="d82955e1948 ">
                                 <p><code class="codeph">没有找到数据</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e2029 d82955e1952 ">
                                 <p><code class="codeph">+100</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e2038" headers="d82955e1948 ">
                                 <p><code class="codeph">NO_DATA_NEEDED</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e2038 d82955e1952 ">
                                 <p><code class="codeph">-6548</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e2047" headers="d82955e1948 ">
                                 <p><code class="codeph">NOT_LOGGED_ON</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e2047 d82955e1952 ">
                                 <p><code class="codeph">-1012</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e2057" headers="d82955e1948 ">
                                 <p><code class="codeph">产生Program_Error</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e2057 d82955e1952 ">
                                 <p><code class="codeph">-6501</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e2066" headers="d82955e1948 ">
                                 <p><code class="codeph">ROWTYPE_MISMATCH</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e2066 d82955e1952 ">
                                 <p><code class="codeph">-6504</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e2075" headers="d82955e1948 ">
                                 <p><code class="codeph">SELF_IS_NULL</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e2075 d82955e1952 ">
                                 <p><code class="codeph">-30625</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e2084" headers="d82955e1948 ">
                                 <p><code class="codeph">是Storage_Error</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e2084 d82955e1952 ">
                                 <p><code class="codeph">-6500</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e2093" headers="d82955e1948 ">
                                 <p><code class="codeph">SUBSCRIPT_BEYOND_COUNT</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e2093 d82955e1952 ">
                                 <p><code class="codeph">-6533</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e2102" headers="d82955e1948 ">
                                 <p><code class="codeph">SUBSCRIPT_OUTSIDE_LIMIT</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e2102 d82955e1952 ">
                                 <p><code class="codeph">-6532</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e2111" headers="d82955e1948 ">
                                 <p><code class="codeph">SYS_INVALID_ROWID</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e2111 d82955e1952 ">
                                 <p><code class="codeph">-1410</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e2120" headers="d82955e1948 ">
                                 <p><code class="codeph">TIMEOUT_ON_RESOURCE</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e2120 d82955e1952 ">
                                 <p><code class="codeph">-51</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e2129" headers="d82955e1948 ">
                                 <p><code class="codeph">TOO_MANY_ROWS</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e2129 d82955e1952 ">
                                 <p><code class="codeph">-1422</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e2138" headers="d82955e1948 ">
                                 <p><code class="codeph">VALUE_ERROR</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e2138 d82955e1952 ">
                                 <p><code class="codeph">-6502</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="38%" id="d82955e2147" headers="d82955e1948 ">
                                 <p><code class="codeph">ZERO_DIVIDE</code></p>
                              </td>
                              <td align="left" valign="top" width="62%" headers="d82955e2147 d82955e1952 ">
                                 <p><code class="codeph">-1476</code></p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <p><a href="plsql-error-handling.html#GUID-8C327B4A-71FA-4CFB-8BC9-4550A23734D6__BABCBAEE">例11-6</a>计算公司的市盈率。如果公司的收益为零，则除法操作会引发预定义的异常<code class="codeph">ZERO_DIVIDE</code>并且块的可执行部分将控制转移到异常处理部分。
                  </p>
                  <p><a href="plsql-error-handling.html#GUID-8C327B4A-71FA-4CFB-8BC9-4550A23734D6__CHDIFEDH">例11-7</a>使用错误检查代码来避免<a href="plsql-error-handling.html#GUID-8C327B4A-71FA-4CFB-8BC9-4550A23734D6__BABCBAEE">例11-6</a>处理的异常。
                  </p>
                  <p>在<a href="plsql-error-handling.html#GUID-8C327B4A-71FA-4CFB-8BC9-4550A23734D6__CIHEFIIC">例11-8中</a> ，该过程打开<code class="codeph">EMPLOYEES</code>表或<code class="codeph">DEPARTMENTS</code>表的游标变量，具体取决于参数<code class="codeph">discrim</code>的值。匿名块调用过程来打开<code class="codeph">EMPLOYEES</code>表的游标变量，但是从<code class="codeph">DEPARTMENTS</code>表中获取，这会引发预定义的异常<code class="codeph">ROWTYPE_MISMATCH</code> 。</p>
                  <div class="infoboxnotealso" id="GUID-8C327B4A-71FA-4CFB-8BC9-4550A23734D6__GUID-8B63A092-49BD-4A3D-BCF7-A7101357E078">
                     <p class="notep1">也可以看看：</p>
                     <p><span class="q">“ <a href="plsql-error-handling.html#GUID-4A73BF41-AA57-4F64-8E4C-265029BEEF39">通过RAISE声明提升内部定义的异常</a> ”</span></p>
                  </div>
                  <div class="example" id="GUID-8C327B4A-71FA-4CFB-8BC9-4550A23734D6__BABCBAEE">
                     <p class="titleinexample">例11-6匿名块处理ZERO_DIVIDE</p><pre class="oac_no_warn" dir="ltr">DECLARE stock_price NUMBER：= 9.73; <span class="bold">net_earnings NUMBER：= 0</span> ; pe_ratio NUMBER; BEGIN pe_ratio：= <span class="bold">stock_price / net_earnings</span> ; - 引发ZERO_DIVIDE异常DBMS_OUTPUT.PUT_LINE（'Price / earnings ratio ='|| pe_ratio）; <span class="bold">除了</span> DBMS_OUTPUT.PUT_LINE（'公司的收益为零）之外的<span class="bold">例外情况</span> 。“）; pe_ratio：= NULL;结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">公司收益为零。
</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-8C327B4A-71FA-4CFB-8BC9-4550A23734D6__CHDIFEDH">
                     <p class="titleinexample">例11-7匿名块避免了ZERO_DIVIDE</p><pre class="oac_no_warn" dir="ltr">DECLARE stock_price NUMBER：= 9.73; net_earnings NUMBER：= 0; pe_ratio NUMBER; BEGIN pe_ratio：= CASE net_earnings <span class="bold">WHEN 0 THEN NULL</span> <span class="bold">ELSE stock_price / net_earnings</span> END;结束; /</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-8C327B4A-71FA-4CFB-8BC9-4550A23734D6__CIHEFIIC">
                     <p class="titleinexample">例11-8匿名块处理ROWTYPE_MISMATCH</p><pre class="oac_no_warn" dir="ltr">创建或替换包装emp_dept_data AUTHID DEFINER作为类型cv_type是REF CURSOR;程序open_cv（cv IN OUT cv_type，discriminim in POSITIVE）; END emp_dept_data; / CREATE或REPLACE PACKAGE BODY emp_dept_data AS程序open_cv（cv IN OUT cv_type， <span class="bold">discriminim</span> in POSITIVE） <span class="bold">如果discriminim = 1则开始，然后</span> <span class="bold">打开cv FOR</span> <span class="bold">SELECT * FROM EMPLOYEES ORDER</span> <span class="bold">by</span> <span class="bold">employee_id;</span> <span class="bold">ELSIF discriminim = 2然后</span> <span class="bold">打开cv FOR</span> <span class="bold">SELECT * FROM DEPARTMENTS ORDER</span> <span class="bold">by</span> <span class="bold">department_id;</span> <span class="bold">万一;</span> END open_cv; END emp_dept_data; /</pre><p>从匿名块调用过程<code class="codeph">open_cv</code> ：</p><pre class="oac_no_warn" dir="ltr">DECLARE emp_rec EMPLOYEES％ROWTYPE; dept_rec DEPARTMENTS％ROWTYPE; cv Emp_dept_data。CV_TYPE; BEGIN <span class="bold">emp_dept_data.open_cv（cv，1）; - 打开cv以获取EMPLOYEES。</span>
  <span class="bold">FETCH cv INTO dept_rec; - 从DEPARTMENTS获取。</span> DBMS_OUTPUT.PUT（dept_rec。DEPARTMENT_ID）; DBMS_OUTPUT.PUT_LINE（''|| dept_rec。LOCATION_ID）; <span class="bold">异常，</span> <span class="bold">当ROWTYPE_MISMATCH然后</span>开始DBMS_OUTPUT.PUT_LINE（'行类型不匹配，获取雇员的数据...“）; FETCH cv INTO emp_rec; DBMS_OUTPUT.PUT（EMP_REC。DEPARTMENT_ID）; DBMS_OUTPUT.PUT_LINE（''|| emp_rec。姓）;结束;结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr"><span class="bold">行类型不匹配，获取EMPLOYEES数据...</span>90王</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="LNPLS00704"></a><div class="props_rev_3"><a id="GUID-8844A6D8-FE6F-4DFF-B449-59AB076316C1" name="GUID-8844A6D8-FE6F-4DFF-B449-59AB076316C1"></a><h3 id="LNPLS-GUID-8844A6D8-FE6F-4DFF-B449-59AB076316C1" class="sect3"><span class="enumeration_section">11.5</span>用户定义的异常</h3>
               <div>
                  <p>您可以在任何PL / SQL匿名块，子程序或包的声明部分声明自己的异常。</p>
                  <p>异常名称声明具有以下语法：</p><pre class="oac_no_warn" dir="ltr"><span class="italic">exception_name</span> EXCEPTION;</pre><p>有关语义信息，请参阅<span class="q">“ <a href="exception-declaration.html#GUID-AAC8C54F-775C-4E65-B531-0350CFF5B1BD" title="异常声明声明用户定义的异常的名称。">异常声明</a> ”</span> 。
                  </p>
                  <p>您必须显式引发用户定义的异常。有关详细信息，请参阅<span class="q">“ <a href="plsql-error-handling.html#GUID-66346B68-7A18-438C-951B-A60F970D98B8">明确提高异常</a> ”</span> 。
                  </p>
               </div>
            </div><a id="LNPLS733"></a><a id="LNPLS99870"></a><div class="props_rev_3"><a id="GUID-C98B60A9-3931-4F8D-BE13-205A1779596D" name="GUID-C98B60A9-3931-4F8D-BE13-205A1779596D"></a><h3 id="LNPLS-GUID-C98B60A9-3931-4F8D-BE13-205A1779596D" class="sect3"><span class="enumeration_section">11.6</span>重新声明的预定义例外</h3>
               <div>
                  <p>Oracle建议不要重新声明预定义的异常 - 即声明用户定义的异常名称，该异常名称是预定义的异常名称。（有关预定义的异常名称列表，请参阅<a href="plsql-error-handling.html#GUID-8C327B4A-71FA-4CFB-8BC9-4550A23734D6__CIHHGGDI" title="此表给出了PL / SQL预定义异常的名称和错误号。">表11-3</a> 。）
                  </p>
                  <p>如果重新声明预定义的异常，则本地声明将覆盖程序包<code class="codeph">STANDARD</code>的全局声明。为全局声明的异常编写的异常处理程序无法处理它 - 除非您使用程序包名称<code class="codeph">STANDARD</code>限定其名称。</p>
                  <p><a href="plsql-error-handling.html#GUID-C98B60A9-3931-4F8D-BE13-205A1779596D__BABCGABI">例11-9</a>显示了这一点。
                  </p>
                  <div class="example" id="GUID-C98B60A9-3931-4F8D-BE13-205A1779596D__BABCGABI">
                     <p class="titleinexample">例11-9 Redeclared预定义标识符</p><pre class="oac_no_warn" dir="ltr">DROP TABLE t; CREATE TABLE t（c NUMBER）;</pre><p>在下面的块中， <code class="codeph">INSERT</code>语句隐式地引发异常处理程序处理的预定义异常<code class="codeph">INVALID_NUMBER</code> 。
                     </p><pre class="oac_no_warn" dir="ltr">DECLARE default_number NUMBER：= 0;开始<span class="bold">插入值（TO_NUMBER（'100.00'，'9G999'））;</span> <span class="bold">INVALID_NUMBER，然后</span> <span class="bold">DBMS_OUTPUT.PUT_LINE（'替换无效数字的默认值）时的异常<span class="bold">。“）;</span> <span class="bold">INSERT INTO VALUES（default_number）;</span>结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr"><span class="bold">用默认值代替无效数字。</span>
 </pre><p>以下块重新声明预定义的异常<code class="codeph">INVALID_NUMBER</code> 。当<code class="codeph">INSERT</code>语句隐式引发预定义的异常<code class="codeph">INVALID_NUMBER</code> ，异常处理程序不处理它。
                     </p><pre class="oac_no_warn" dir="ltr">DECLARE default_number NUMBER：= 0;我号码：= 5; <span class="bold">invalid_number EXCEPTION; - 重新声明预定义的异常</span> BEGIN <span class="bold">INSERT INTO VALUES（TO_NUMBER（'100.00'，'9G999'））;</span> INVALID_NUMBER，然后DBMS_OUTPUT.PUT_LINE（'替换无效数字的默认值）时的异常。“）; INSERT INTO VALUES（default_number）;结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">第1行的DECLARE * ERROR： <span class="bold">ORA-01722：无效数字</span> ORA-06512：第6行</pre><p>如果您在异常处理程序中限定异常名称，则前面的块中的异常处理程序处理预定义的异常<code class="codeph">INVALID_NUMBER</code> ：</p><pre class="oac_no_warn" dir="ltr">DECLARE default_number NUMBER：= 0;我号码：= 5; <span class="bold">invalid_number EXCEPTION; - 重新声明预定义的异常</span> BEGIN <span class="bold">INSERT INTO VALUES（TO_NUMBER（'100.00'，'9G999'））;</span> <span class="bold">STANDARD.INVALID_NUMBER，</span>然后是DBMS_OUTPUT.PUT_LINE（'替换无效数字的默认值时的例外情况。“）; INSERT INTO VALUES（default_number）;结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr"><span class="bold">用默认值代替无效数字。</span></pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="LNPLS734"></a><a id="LNPLS00705"></a><div class="props_rev_3"><a id="GUID-66346B68-7A18-438C-951B-A60F970D98B8" name="GUID-66346B68-7A18-438C-951B-A60F970D98B8"></a><h3 id="LNPLS-GUID-66346B68-7A18-438C-951B-A60F970D98B8" class="sect3"><span class="enumeration_section">11.7</span>明确提高例外情况</h3>
               <div>
                  <div class="section">
                     <p>要显式引发异常，请使用<code class="codeph">RAISE</code>语句或<code class="codeph">RAISE_APPLICATION_ERROR</code>过程。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-66346B68-7A18-438C-951B-A60F970D98B8__GUID-0F48BC66-2103-4DF5-9AF5-F63C8684026D">话题</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="plsql-error-handling.html#GUID-5C7ADCC4-17D4-4B82-A767-3C7408BD1DF4">提升声明</a></p>
                        </li>
                        <li>
                           <p><a href="plsql-error-handling.html#GUID-48F88C61-8CE9-4821-91CB-48A8F1BC09E1">RAISE_APPLICATION_ERROR程序</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="LNPLS735"></a><a id="LNPLS99869"></a><div class="props_rev_3"><a id="GUID-5C7ADCC4-17D4-4B82-A767-3C7408BD1DF4" name="GUID-5C7ADCC4-17D4-4B82-A767-3C7408BD1DF4"></a><h4 id="LNPLS-GUID-5C7ADCC4-17D4-4B82-A767-3C7408BD1DF4" class="sect4"><span class="enumeration_section">11.7.1</span>提升声明</h4>
                  <div>
                     <p><code class="codeph">RAISE</code>语句明确引发异常。在异常处理程序之外，您必须指定异常名称。在异常处理程序中，如果省略异常名称，则<code class="codeph">RAISE</code>语句将重新引发当前异常。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-5C7ADCC4-17D4-4B82-A767-3C7408BD1DF4__GUID-91CFE08A-FA30-487E-B93F-AECEEF98BFFF">话题</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="plsql-error-handling.html#GUID-D51E46A5-AEFD-4346-8236-06E4F15D86DB">使用RAISE语句提高用户定义的异常</a></p>
                           </li>
                           <li>
                              <p><a href="plsql-error-handling.html#GUID-4A73BF41-AA57-4F64-8E4C-265029BEEF39">使用RAISE语句提高内部定义的异常</a></p>
                           </li>
                           <li>
                              <p><a href="plsql-error-handling.html#GUID-59C4325C-9D2A-4D24-8381-79B676A508A8">用RAISE语句重新引用当前异常</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div><a id="LNPLS736"></a><a id="LNPLS99866"></a><div class="props_rev_3"><a id="GUID-D51E46A5-AEFD-4346-8236-06E4F15D86DB" name="GUID-D51E46A5-AEFD-4346-8236-06E4F15D86DB"></a><h5 id="LNPLS-GUID-D51E46A5-AEFD-4346-8236-06E4F15D86DB" class="sect5"><span class="enumeration_section">11.7.1.1</span>使用RAISE语句<span class="enumeration_section">引发</span>用户定义的异常</h5>
                     <div>
                        <div class="section">
                           <p>在<a href="plsql-error-handling.html#GUID-D51E46A5-AEFD-4346-8236-06E4F15D86DB__BABBCBII">例11-10中</a> ，该过程声明了一个名为<code class="codeph">past_due</code>的异常，使用<code class="codeph">RAISE</code>语句显式引发它，并使用异常处理程序处理它。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-D51E46A5-AEFD-4346-8236-06E4F15D86DB__BABBCBII">
                           <p class="titleinexample">示例11-10声明，引发和处理用户定义的异常</p><pre class="oac_no_warn" dir="ltr">CREATE PROCEDURE account_status（due_date DATE，今天DATE）AUTHID DEFINER是<span class="bold">past_due EXCEPTION; - 声明异常</span> BEGIN IF due_date &lt;今天THEN <span class="bold">RAISE past_due; - 明确提出异常</span> END IF; <span class="bold">past_due THEN时的异常 - 处理异常</span> DBMS_OUTPUT.PUT_LINE（'帐号过期。“）;结束; / BEGIN account_status（TO_DATE（'01 -JUL-2010'，'DD-MON-YYYY'），TO_DATE（'09 -JUL-2010'，'DD-MON-YYYY'））;结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">帐户过期。</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="LNPLS838"></a><a id="LNPLS99863"></a><div class="props_rev_3"><a id="GUID-4A73BF41-AA57-4F64-8E4C-265029BEEF39" name="GUID-4A73BF41-AA57-4F64-8E4C-265029BEEF39"></a><h5 id="LNPLS-GUID-4A73BF41-AA57-4F64-8E4C-265029BEEF39" class="sect5"><span class="enumeration_section">11.7.1.2</span>使用RAISE语句提高内部定义的异常</h5>
                     <div>
                        <div class="section">
                           <p>尽管运行时系统隐式地引发内部定义的异常，但如果它们具有名称，则可以使用<code class="codeph">RAISE</code>语句显式地引发它们。<a href="plsql-error-handling.html#GUID-8C327B4A-71FA-4CFB-8BC9-4550A23734D6__CIHHGGDI" title="此表给出了PL / SQL预定义异常的名称和错误号。">表11-3</a>列出了具有预定义名称的内部定义的异常。 <span class="q">“ <a href="plsql-error-handling.html#GUID-4F0787E6-ABCA-4860-A28E-435C7FE15154">内部定义的异常</a> ”</span>解释了如何将用户声明的名称赋予内部定义的异常。
                           </p>
                           <p>命名内部定义的异常的异常处理程序处理该异常，无论是隐式还是显式引发。</p>
                           <p>在<a href="plsql-error-handling.html#GUID-4A73BF41-AA57-4F64-8E4C-265029BEEF39__BABHAIAI">示例11-11中</a> ，该过程显式或隐式地引发预定义异常<code class="codeph">INVALID_NUMBER</code> ，并且<code class="codeph">INVALID_NUMBER</code>异常处理程序始终处理它。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-4A73BF41-AA57-4F64-8E4C-265029BEEF39__BABHAIAI">
                           <p class="titleinexample">例11-11明确提出预定义的异常</p><pre class="oac_no_warn" dir="ltr">DROP TABLE t; CREATE TABLE t（c NUMBER）; CREATE PROCEDURE p（n NUMBER）AUTHID DEFINER是default_number NUMBER：= 0;如果n &lt;0则<span class="bold">上升INVALID_NUMBER; - 明确提出</span> ELSE <span class="bold">INSERT INTO VALUES（TO_NUMBER（'100.00'，'9G999'））; - 隐含地提高</span> END IF; <span class="bold">INVALID_NUMBER，然后</span> DBMS_OUTPUT.PUT_LINE（'替换无效数字的默认值）时的异常。“）; INSERT INTO VALUES（default_number）;结束; / BEGIN p（-1）;结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">用默认值代替无效数字。开始p（1）;结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">用默认值代替无效数字。</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="LNPLS843"></a><a id="LNPLS00707"></a><div class="props_rev_3"><a id="GUID-59C4325C-9D2A-4D24-8381-79B676A508A8" name="GUID-59C4325C-9D2A-4D24-8381-79B676A508A8"></a><h5 id="LNPLS-GUID-59C4325C-9D2A-4D24-8381-79B676A508A8" class="sect5"><span class="enumeration_section">11.7.1.3</span>用RAISE语句重新加电当前异常</h5>
                     <div>
                        <div class="section">
                           <p>在异常处理程序中，您可以使用<code class="codeph">RAISE</code>语句来“重新”处理正在处理的异常。重新加载异常会将其传递给封闭块，封闭块可以进一步处理它。（如果封闭块无法处理重新引发的异常，则异常传播 - 请参阅<span class="q">“ <a href="plsql-error-handling.html#GUID-A99B76C3-44DF-40E1-AB7A-454C6805B9BB">Exception Propagation</a> ”</span> 。）在重新引用当前异常时，无需指定异常名称。
                           </p>
                           <p>在<a href="plsql-error-handling.html#GUID-59C4325C-9D2A-4D24-8381-79B676A508A8__BABJBBHG">例11-12中</a> ，异常的处理在内部块中开始，在外部块中完成。外部块声明了异常，因此异常名称存在于两个块中，并且每个块都有一个专门用于该异常的异常处理程序。内部块引发异常，其异常处理程序执行初始处理，然后重新引发异常，将其传递给外部块以进行进一步处理。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-59C4325C-9D2A-4D24-8381-79B676A508A8__BABJBBHG">
                           <p class="titleinexample">例11-12重新加速异常</p><pre class="oac_no_warn" dir="ltr">DECLARE <span class="bold">salary_too_high EXCEPTION;</span> current_salary NUMBER：= 20000; max_salary NUMBER：= 10000; misroneous_salary NUMBER; BEGIN BEGIN IF current_salary&gt; max_salary THEN <span class="bold">RAISE salary_too_high; - 提出异常</span> END IF; <span class="bold">salary_too_high那么例外 - 开始处理异常</span> erroneous_salary：= current_salary; DBMS_OUTPUT.PUT_LINE（'薪水'|| erroneous_salary ||'超出范围。“）; DBMS_OUTPUT.PUT_LINE（'最高薪水是'|| max_salary ||'。“）; <span class="bold">提高; - 重新加载当前异常（异常名称是可选的）</span> END; <span class="bold">salary_too_high THEN时的例外 - 完成处理异常</span> current_salary：= max_salary; DBMS_OUTPUT.PUT_LINE（'修改工资从'|| erroneous_salary ||'到'|| current_salary ||'。'）;结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">薪资20000超出范围。最高工资是10000。修改工资从20000到10000。</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div><a id="LNPLS738"></a><a id="LNPLS99960"></a><div class="props_rev_3"><a id="GUID-48F88C61-8CE9-4821-91CB-48A8F1BC09E1" name="GUID-48F88C61-8CE9-4821-91CB-48A8F1BC09E1"></a><h4 id="LNPLS-GUID-48F88C61-8CE9-4821-91CB-48A8F1BC09E1" class="sect4"><span class="enumeration_section">11.7.2</span> RAISE_APPLICATION_ERROR过程</h4>
                  <div>
                     <p>您只能从存储的子程序或方法调用<code class="codeph">RAISE_APPLICATION_ERROR</code>过程（在<code class="codeph">DBMS_STANDARD</code>程序包中定义）。通常，您调用此过程来引发用户定义的异常并将其错误代码和错误消息返回给调用者。
                     </p>
                     <p>要调用<code class="codeph">RAISE_APPLICATION_ERROR</code> ，请使用以下语法：</p><pre class="oac_no_warn" dir="ltr">RAISE_APPLICATION_ERROR（ <span class="italic">error_code</span> ， <span class="italic">message</span> [，{TRUE | FALSE}]）;</pre><p>您必须使用<code class="codeph">EXCEPTION_INIT</code> pragma将<span class="italic"><code class="codeph">error_code</code></span>分配给用户定义的异常。语法是：</p><pre class="oac_no_warn" dir="ltr">PRAGMA EXCEPTION_INIT（ <span class="italic">exception_name</span> ， <span class="italic">error_code</span> ）</pre><p><span class="italic"><code class="codeph">error_code</code></span>是-20000 ..- 20999范围内的整数， <span class="italic"><code class="codeph">message</code></span>是最多2048字节的字符串。
                     </p>
                     <p>有关语义信息，请参阅<span class="q">“ <a href="EXCEPTION_INIT-pragma.html#GUID-873A087E-A470-4798-9152-16BC673B4940" title="EXCEPTION_INIT pragma将用户定义的异常名称与错误代码相关联。">EXCEPTION_INIT Pragma</a> ”</span> 。
                     </p>
                     <p><span class="italic"><code class="codeph">message</code></span>是最多2048字节的字符串。
                     </p>
                     <p>如果指定<code class="codeph">TRUE</code> ，PL / SQL会将<span class="italic"><code class="codeph">error_code</code></span>置于错误堆栈之上。否则，PL / SQL用<span class="italic"><code class="codeph">error_code</code></span>替换错误堆栈。
                     </p>
                     <p>在<a href="plsql-error-handling.html#GUID-48F88C61-8CE9-4821-91CB-48A8F1BC09E1__BABIHIBC">例11-13中</a> ，匿名块声明了一个名为<code class="codeph">past_due</code>的异常，为其分配了错误代码-20000，并调用了一个存储过程。存储过程使用错误代码-20000和消息调用<code class="codeph">RAISE_APPLICATION_ERROR</code>过程，然后控制返回到处理异常的匿名块。要检索与异常关联的消息，匿名块中的异常处理程序将调用<code class="codeph">SQLERRM</code>函数，如<span class="q">“ <a href="plsql-error-handling.html#GUID-7E0CDD98-D31C-4745-B819-B5C5E1DF90A8">检索错误代码和错误消息</a> ”中所述</span> 。
                     </p>
                     <div class="example" id="GUID-48F88C61-8CE9-4821-91CB-48A8F1BC09E1__BABIHIBC">
                        <p class="titleinexample">例11-13使用RAISE_APPLICATION_ERROR引发用户定义的异常</p><pre class="oac_no_warn" dir="ltr">CREATE PROCEDURE account_status（due_date DATE，今天DATE）AUTHID DEFINER开始如果due_date &lt;今天那么<span class="bold">- 明确提出异常</span> <span class="bold">RAISE_APPLICATION_ERROR（-20000，'帐户逾期到期。“）;</span>万一;结束; / DECLARE <span class="bold">past_due EXCEPTION; - 声明异常</span> <span class="bold">PRAGMA EXCEPTION_INIT（past_due，-20000）; - 将错误代码分配给例外</span> BEGIN <span class="bold">account_status（TO_DATE（'01 -JUL-2010'，'DD-MON-YYYY'），</span> <span class="bold">TO_DATE（'09 -JUL-2010'，'DD-MON-YYYY'））; - 在</span> <span class="bold">event_due THEN时</span> <span class="bold">调用过程</span> EXCEPTION <span class="bold">- 处理异常</span> DBMS_OUTPUT.PUT_LINE（TO_CHAR（ <span class="bold">SQLERRM（-20000）</span> ））;结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">ORA-20000：账户逾期。</pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div><a id="LNPLS839"></a><a id="LNPLS840"></a><a id="LNPLS841"></a><a id="LNPLS748"></a><a id="LNPLS842"></a><a id="LNPLS747"></a><a id="LNPLS00706"></a><div class="props_rev_3"><a id="GUID-A99B76C3-44DF-40E1-AB7A-454C6805B9BB" name="GUID-A99B76C3-44DF-40E1-AB7A-454C6805B9BB"></a><h3 id="LNPLS-GUID-A99B76C3-44DF-40E1-AB7A-454C6805B9BB" class="sect3"><span class="enumeration_section">11.8</span>例外传播</h3>
               <div>
                  <p>如果在没有异常处理程序的块中引发异常，则异常<span class="bold">传播</span> 。也就是说，异常在连续的封闭块中再现它，直到块具有处理器或者没有封闭块。如果没有异常处理程序，则PL / SQL会向调用者或主机环境返回未处理的异常错误，这将确定结果（有关更多信息，请参阅<span class="q">“ <a href="plsql-error-handling.html#GUID-494984A3-37E6-41BF-9BB9-05A693CD9577">未处理的异常</a> ”</span> ）。
                  </p>
                  <p>在<a href="plsql-error-handling.html#GUID-A99B76C3-44DF-40E1-AB7A-454C6805B9BB__i5473">图11-1中</a> ，一个块嵌套在另一个块中。内部块引发异常A.内部块具有A的异常处理程序，因此A不会传播。异常处理程序运行后，控制转移到外部块的下一个语句。
                  </p>
                  <div class="figure" id="GUID-A99B76C3-44DF-40E1-AB7A-454C6805B9BB__i5473">
                     <p class="titleinfigure">图11-1异常不传播</p><img src="img/lnpls009.gif" width="393" alt="下面是图11-1的描述" title="下面是图11-1的描述" longdesc="img_text/lnpls009.html"><br><a href="img_text/lnpls009.html">“图11-1异常不传播”的描述</a></div>
                  <!-- class="figure" -->
                  <p>在<a href="plsql-error-handling.html#GUID-A99B76C3-44DF-40E1-AB7A-454C6805B9BB__i5479">图11-2中</a> ，内部块引发异常B.内部块没有异常B的异常处理程序，因此B传播到外部块，外部块具有异常处理程序。异常处理程序运行后，控制权转移到主机环境。
                  </p>
                  <div class="figure" id="GUID-A99B76C3-44DF-40E1-AB7A-454C6805B9BB__i5479">
                     <p class="titleinfigure">图11-2从内部块到外部块的异常传播</p><img src="img/lnpls010.gif" width="381" alt="下面是图11-2的描述" title="下面是图11-2的描述" longdesc="img_text/lnpls010.html"><br><a href="img_text/lnpls010.html">“图11-2异常从内部块传播到外部块”的描述</a></div>
                  <!-- class="figure" -->
                  <p>在<a href="plsql-error-handling.html#GUID-A99B76C3-44DF-40E1-AB7A-454C6805B9BB__i2641">图11-3中</a> ，内部块引发异常C.内部块没有C的异常处理程序，因此异常C传播到外部块。外部块没有C的异常处理程序，因此PL / SQL向主机环境返回未处理的异常错误。
                  </p>
                  <div class="figure" id="GUID-A99B76C3-44DF-40E1-AB7A-454C6805B9BB__i2641">
                     <p class="titleinfigure">图11-3 PL / SQL返回主机环境的未处理异常错误</p><img src="img/lnpls011.gif" width="392" alt="下面是图11-3的描述" title="下面是图11-3的描述" longdesc="img_text/lnpls011.html"><br><a href="img_text/lnpls011.html">“图11-3 PL / SQL返回主机环境未处理的异常错误”的描述</a></div>
                  <!-- class="figure" -->
                  <p>用户定义的异常可以超出其范围（即超出声明它的块）传播，但其名称不在其范围之外。因此，超出其范围，只能使用<code class="codeph">OTHERS</code>异常处理程序处理用户定义的异常。
                  </p>
                  <p>在<a href="plsql-error-handling.html#GUID-A99B76C3-44DF-40E1-AB7A-454C6805B9BB__BABIIGCJ">例11-14中</a> ，内部块声明了一个名为<code class="codeph">past_due</code>的异常，它没有异常处理程序。当内部块引发<code class="codeph">past_due</code> ，异常传播到外部块，其中名称<code class="codeph">past_due</code>不存在。外部块使用<code class="codeph">OTHERS</code>异常处理程序处理异常。
                  </p>
                  <p>如果外部块未处理用户定义的异常，则会发生错误，如<a href="plsql-error-handling.html#GUID-A99B76C3-44DF-40E1-AB7A-454C6805B9BB__BABDJCDH">例11-15所示</a> 。
                  </p>
                  <div class="infoboxnote" id="GUID-A99B76C3-44DF-40E1-AB7A-454C6805B9BB__GUID-760DEEA6-1FA2-4CFD-B757-5C968CF7FDDD">
                     <p class="notep1">注意：</p>
                     <p>异常无法通过远程子程序调用传播。因此，PL / SQL块无法处理远程子程序引发的异常。</p>
                  </div>
                  <div class="section">
                     <p class="subhead2" id="GUID-A99B76C3-44DF-40E1-AB7A-454C6805B9BB__GUID-905BECE5-B7A0-4172-8E13-607F08768EE5">话题</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="plsql-error-handling.html#GUID-32A135A2-6C8B-4D2B-8946-001D66429FA3">宣言中提出的例外情况的传播</a></p>
                        </li>
                        <li>
                           <p><a href="plsql-error-handling.html#GUID-1E7585F0-74BA-4D39-B168-2BE979CB8314">异常处理程序中引发的异常的传播</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-A99B76C3-44DF-40E1-AB7A-454C6805B9BB__BABIIGCJ">
                     <p class="titleinexample">示例11-14处理超出范围传播的异常</p><pre class="oac_no_warn" dir="ltr">创建或替换程序p AUTHID DEFINER <span class="bold">as</span> BEGIN DECLARE <span class="bold">past_due EXCEPTION;</span> PRAGMA EXCEPTION_INIT（past_due，-4910）; due_date DATE：= trunc（SYSDATE） -  1; todays_date DATE：= trunc（SYSDATE）; BEGIN IF due_date &lt;todays_date THEN RAISE past_due;万一;结束;除了<span class="bold">其他人之外的</span>例外情况;提高;结束; /</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-A99B76C3-44DF-40E1-AB7A-454C6805B9BB__BABDJCDH">
                     <p class="titleinexample">示例11-15未处理超出范围传播的异常</p><pre class="oac_no_warn" dir="ltr">BEGIN DECLARE <span class="bold">past_due EXCEPTION;</span> due_date DATE：= trunc（SYSDATE） -  1; todays_date DATE：= trunc（SYSDATE）; BEGIN IF due_date &lt;todays_date THEN RAISE past_due;万一;结束;结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">第1行的BEGIN * ERROR： <span class="bold">ORA-06510：PL / SQL：未处理的用户定义的异常</span> ORA-06512：第9行</pre></div>
                  <!-- class="example" -->
               </div><a id="LNPLS845"></a><a id="LNPLS749"></a><a id="LNPLS844"></a><div class="props_rev_3"><a id="GUID-32A135A2-6C8B-4D2B-8946-001D66429FA3" name="GUID-32A135A2-6C8B-4D2B-8946-001D66429FA3"></a><h4 id="LNPLS-GUID-32A135A2-6C8B-4D2B-8946-001D66429FA3" class="sect4"><span class="enumeration_section">11.8.1</span>宣言中提出的例外情况的传播</h4>
                  <div>
                     <p>声明中引发的异常会立即传播到封闭块（如果没有封闭块，则传播到调用者或主机环境）。因此，异常处理程序必须位于封闭或调用块中，而不是与声明位于同一块中。</p>
                     <p>在<a href="plsql-error-handling.html#GUID-32A135A2-6C8B-4D2B-8946-001D66429FA3__BABBIACC">例11-16中</a> ， <code class="codeph">VALUE_ERROR</code>异常处理程序与引发<code class="codeph">VALUE_ERROR</code>的声明位于同一个块中。由于异常会立即传播到主机环境，因此异常处理程序不会处理它。
                     </p>
                     <p><a href="plsql-error-handling.html#GUID-32A135A2-6C8B-4D2B-8946-001D66429FA3__BABFDAJH">例11-17</a>与<a href="plsql-error-handling.html#GUID-32A135A2-6C8B-4D2B-8946-001D66429FA3__BABBIACC">例11-16</a>类似，只是封闭块处理内部块中的声明引发的<code class="codeph">VALUE_ERROR</code>异常。
                     </p>
                     <div class="example" id="GUID-32A135A2-6C8B-4D2B-8946-001D66429FA3__BABBIACC">
                        <p class="titleinexample">示例11-16未处理声明中引发的异常</p><pre class="oac_no_warn" dir="ltr"><span class="bold">DECLARE</span> <span class="bold">credit_limit CONSTANT NUMBER（3）：= 5000; - 最大值为999</span> <span class="bold">BEGIN</span> NULL; <span class="bold">异常，</span> <span class="bold">当VALUE_ERROR THEN</span> DBMS_OUTPUT.PUT_LINE（'异常在声明中提出的。“）; <span class="bold">结束;</span> /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">第1行的DECLARE * ERROR：ORA-06502：PL / SQL：数字或值错误：数字精度太大ORA-06512：第2行</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-32A135A2-6C8B-4D2B-8946-001D66429FA3__BABFDAJH">
                        <p class="titleinexample">例11-17声明中引发的异常由封闭块处理</p><pre class="oac_no_warn" dir="ltr"><span class="bold">BEGIN</span> DECLARE <span class="bold">credit_limit CONSTANT NUMBER（3）：= 5000;</span> BEGIN NULL;结束; <span class="bold">异常，</span> <span class="bold">当VALUE_ERROR THEN</span> DBMS_OUTPUT.PUT_LINE（'异常在声明中提出的。“）; <span class="bold">结束;</span> /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">声明中提出的例外情况。</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="LNPLS757"></a><a id="LNPLS761"></a><a id="LNPLS762"></a><a id="LNPLS763"></a><a id="LNPLS764"></a><a id="LNPLS846"></a><div class="props_rev_3"><a id="GUID-1E7585F0-74BA-4D39-B168-2BE979CB8314" name="GUID-1E7585F0-74BA-4D39-B168-2BE979CB8314"></a><h4 id="LNPLS-GUID-1E7585F0-74BA-4D39-B168-2BE979CB8314" class="sect4"><span class="enumeration_section">11.8.2</span>异常处理程序中<span class="enumeration_section">引发</span>的异常的传播</h4>
                  <div>
                     <p>一个<a id="d82955e3818" class="indexterm-anchor"></a><a id="d82955e3822" class="indexterm-anchor"></a>异常处理程序中引发的异常会立即传播到封闭块（如果没有封闭块，则传播到调用者或主机环境）。因此，异常处理程序必须位于封闭或调用块中。
                     </p>
                     <p>在<a href="plsql-error-handling.html#GUID-1E7585F0-74BA-4D39-B168-2BE979CB8314__BABHJJAF">例11-18中</a> ，当<code class="codeph">n</code>为零时，计算<code class="codeph">1/n</code>引发预定义的异常<code class="codeph">ZERO_DIVIDE</code> ，并且控制转移到同一块中的<code class="codeph">ZERO_DIVIDE</code>异常处理程序。当异常处理程序引发<code class="codeph">ZERO_DIVIDE</code> ，异常会立即传播给调用者。调用者不处理异常，因此PL / SQL向主机环境返回未处理的异常错误。
                     </p>
                     <p><a href="plsql-error-handling.html#GUID-1E7585F0-74BA-4D39-B168-2BE979CB8314__BABDJDGH">例11-19</a>与<a href="plsql-error-handling.html#GUID-1E7585F0-74BA-4D39-B168-2BE979CB8314__BABHJJAF">例11-18</a>类似，只是当过程向调用者返回未处理的异常错误时，调用者处理它。
                     </p>
                     <p><a href="plsql-error-handling.html#GUID-1E7585F0-74BA-4D39-B168-2BE979CB8314__BABHBEGA">示例11-20</a>与<a href="plsql-error-handling.html#GUID-1E7585F0-74BA-4D39-B168-2BE979CB8314__BABHJJAF">示例11-18</a>类似，不同之处在于封闭块处理内部块中的异常处理程序引发的异常。
                     </p>
                     <p>在<a href="plsql-error-handling.html#GUID-1E7585F0-74BA-4D39-B168-2BE979CB8314__BABEGCDH">例11-21中</a> ，过程的异常处理部分具有用户定义的异常<code class="codeph">i_is_one</code>和预定义异常<code class="codeph">ZERO_DIVIDE</code>异常处理程序。当<code class="codeph">i_is_one</code>异常处理程序引发<code class="codeph">ZERO_DIVIDE</code> ，异常会立即传播给调用者（因此， <code class="codeph">ZERO_DIVIDE</code>异常处理程序不会处理它）。调用者不处理异常，因此PL / SQL向主机环境返回未处理的异常错误。
                     </p>
                     <p><a href="plsql-error-handling.html#GUID-1E7585F0-74BA-4D39-B168-2BE979CB8314__BABDIHFC">实施例11-22</a>类似于<a href="plsql-error-handling.html#GUID-1E7585F0-74BA-4D39-B168-2BE979CB8314__BABEGCDH">实施例11-21</a>除了使用封闭块处理<code class="codeph">ZERO_DIVIDE</code>除了将<code class="codeph">i_is_one</code>异常处理程序引发。
                     </p>
                     <div class="example" id="GUID-1E7585F0-74BA-4D39-B168-2BE979CB8314__BABHJJAF">
                        <p class="titleinexample">示例11-18未处理异常处理程序中引发的异常</p><pre class="oac_no_warn" dir="ltr">CREATE PROCEDURE print_reciprocal（n NUMBER）AUTHID DEFINER BEGIN DBMS_OUTPUT.PUT_LINE（ <span class="bold">1 / n</span> ）; <span class="bold">- 在</span> ZERO_DIVIDE那时<span class="bold">处理</span> EXCEPTION DBMS_OUTPUT.PUT_LINE（' <span class="bold">错误：</span> '）; DBMS_OUTPUT.PUT_LINE（ <span class="bold">1 / n</span> ||'未定义'）; <span class="bold">- 未处理</span> END; / BEGIN <span class="bold">- 调用块</span> print_reciprocal（0）;结束;</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr"><span class="bold">错误：</span>第1行的BEGIN * ERROR： <span class="bold">ORA-01476：除数等于零</span> ORA-06512：在“HR.PRINT_RECIPROCAL”，第7行ORA-01476：除数等于零ORA-06512：在第2行</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-1E7585F0-74BA-4D39-B168-2BE979CB8314__BABDJDGH">
                        <p class="titleinexample">例11-19异常处理程序中引发的异常由Invoker处理</p><pre class="oac_no_warn" dir="ltr">CREATE PROCEDURE print_reciprocal（n NUMBER）AUTHID DEFINER BEGIN DBMS_OUTPUT.PUT_LINE（1 / n）; ZERO_DIVIDE，然后是DBMS_OUTPUT.PUT_LINE（'错误：'）; DBMS_OUTPUT.PUT_LINE（1 / n ||'未定义'）;结束; / BEGIN <span class="bold">- 调用块</span> print_reciprocal（0）; <span class="bold">ZERO_DIVIDE THEN时的异常 - 处理异常处理程序</span> DBMS_OUTPUT.PUT_LINE中<span class="bold">引发的异常</span> （'1/0未定义。“）;结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">错误：1/0未定义。
</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-1E7585F0-74BA-4D39-B168-2BE979CB8314__BABHBEGA">
                        <p class="titleinexample">例11-20异常处理程序中引发的异常由封闭块处理</p><pre class="oac_no_warn" dir="ltr">CREATE PROCEDURE print_reciprocal（N个）验证ID定义IS <span class="bold">BEGIN</span> <span class="bold">BEGIN</span> DBMS_OUTPUT.PUT_LINE（1 / N）; ZERO_DIVIDE，然后DBMS_OUTPUT.PUT_LINE（'内部块错误：'）的<span class="bold">例外情况</span> ; DBMS_OUTPUT.PUT_LINE（1 / n ||'未定义。“）; <span class="bold">结束;</span> <span class="bold">异常，</span> <span class="bold">当ZERO_DIVIDE THEN -处理中的异常处理程序</span> DBMS_OUTPUT.PUT（“错误在外部块：”） <span class="bold">引发的异常</span> ; DBMS_OUTPUT.PUT_LINE（'1/0未定义。“）; <span class="bold">结束;</span> / BEGIN print_reciprocal（0）;结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">内部块中的错误：外部块中的错误：1/0未定义。
</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-1E7585F0-74BA-4D39-B168-2BE979CB8314__BABEGCDH">
                        <p class="titleinexample">示例11-21未处理异常处理程序中引发的异常</p><pre class="oac_no_warn" dir="ltr">CREATE PROCEDURE descending_reciprocals（n INTEGER）AUTHID DEFINER IS i INTEGER; <span class="bold">i_is_one EXCEPTION;</span>开始我：= n;循环如果i = 1那么<span class="bold">升高i_is_one;</span> ELSE DBMS_OUTPUT.PUT_LINE（''|| ||'的倒数是'|| <span class="bold">1 / i</span> ）;万一;我：=我 -  1;结束循环; <span class="bold">当i_is_one然后</span> DBMS_OUTPUT.PUT_LINE（' <span class="bold">1是它自己的倒数时的</span>异常<span class="bold">。</span>“）; DBMS_OUTPUT.PUT_LINE（'|| TO_CHAR（i-1）||'的倒数是'|| TO_CHAR（ <span class="bold">1 /（i-1）</span> ））; <span class="bold">当ZERO_DIVIDE那么</span> DBMS_OUTPUT.PUT_LINE（'错误：'）; DBMS_OUTPUT.PUT_LINE（1 / n ||'未定义'）;结束; / BEGIN descending_reciprocals（3）;结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">3的倒数是.3333333333333333333333333333333333333333 2的倒数是.5 <span class="bold">1是它自己的倒数。</span>第1行的BEGIN * ERROR： <span class="bold">ORA-01476：除数等于零</span> ORA-06512：at“HR.DESCENDING_RECIPROCALS”，第19行ORA-06510：PL / SQL：未处理的用户定义的异常ORA-06512：第2行</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-1E7585F0-74BA-4D39-B168-2BE979CB8314__BABDIHFC">
                        <p class="titleinexample">示例11-22异常处理程序中引发的异常由封闭块处理</p><pre class="oac_no_warn" dir="ltr">CREATE PROCEDURE descending_reciprocals（n INTEGER）AUTHID DEFINER IS i INTEGER; i_is_one EXCEPTION; <span class="bold">BEGIN</span> <span class="bold">BEGIN</span> I：= N;循环如果i = 1那么升高i_is_one; ELSE DBMS_OUTPUT.PUT_LINE（''|| ||'的倒数是'|| 1 / i）;万一;我：=我 -  1;结束循环;当i_is_one然后DBMS_OUTPUT.PUT_LINE（'1是它自己的倒数时的<span class="bold">异常</span> 。“）; DBMS_OUTPUT.PUT_LINE（'|| TO_CHAR（i-1）||'的倒数是'|| TO_CHAR（1 /（i-1）））;当ZERO_DIVIDE那么DBMS_OUTPUT.PUT_LINE（'错误：'）; DBMS_OUTPUT.PUT_LINE（1 / n ||'未定义'）; <span class="bold">结束;</span> <span class="bold">异常，</span> <span class="bold">当ZERO_DIVIDE THEN -处理异常处理函数中</span> DBMS_OUTPUT.PUT_LINE <span class="bold">引发的异常</span> （错误：'）; DBMS_OUTPUT.PUT_LINE（'1/0未定义'）; <span class="bold">结束;</span> / BEGIN descending_reciprocals（3）;结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">3的倒数是.3333333333333333333333333333333333333333 2的倒数是.5 1是它自己的倒数。错误：1/0未定义</pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div><a id="LNPLS850"></a><div class="props_rev_3"><a id="GUID-494984A3-37E6-41BF-9BB9-05A693CD9577" name="GUID-494984A3-37E6-41BF-9BB9-05A693CD9577"></a><h3 id="LNPLS-GUID-494984A3-37E6-41BF-9BB9-05A693CD9577" class="sect3"><span class="enumeration_section">11.9</span>未处理的例外情况</h3>
               <div>
                  <p>如果没有引发异常的处理程序，PL / SQL会向调用者或宿主环境返回未处理的异常错误，从而确定结果。</p>
                  <p>如果存储的子程序以未处理的异常退出，则PL / SQL不会回滚子程序所做的数据库更改。</p>
                  <p><code class="codeph">FORALL</code>语句多次运行一个DML语句，在<code class="codeph">VALUES</code>和<code class="codeph">WHERE</code>子句中使用不同的值。如果一组值引发未处理的异常，则PL / SQL将回滚先前在<code class="codeph">FORALL</code>语句中进行的所有数据库更改。有关更多信息，请参阅<span class="q">“ <a href="plsql-optimization-and-tuning.html#GUID-42AF6F5C-B06D-4EB6-9C7A-630FF65DBD5D" title="要立即处理FORALL语句中引发的异常，请省略SAVE EXCEPTIONS子句并编写相应的异常处理程序。">立即处理FORALL异常</a> ”</span>和<span class="q">“ <a href="plsql-optimization-and-tuning.html#GUID-DAF46F06-EF3F-4B1A-A518-5238B80C69FA" title="要允许FORALL语句继续，即使它的某些DML语句失败，也包括SAVE EXCEPTIONS子句。当DML语句失败时，PL / SQL不会引发异常;相反，它保存了有关失败的信息。FORALL语句完成后，PL / SQL为FORALL语句（ORA-24381）引发一个异常。">FORALL语句完成后处理FORALL异常</a> ”</span> 。
                  </p>
                  <div class="infobox-tip" id="GUID-494984A3-37E6-41BF-9BB9-05A693CD9577__GUID-5DA4F3CF-C3A5-48C8-98B3-FD405459BA24">
                     <p class="notep1">小费：</p>
                     <p>通过在每个PL / SQL程序的顶层包含<code class="codeph">OTHERS</code>异常处理程序来避免未处理的异常。
                     </p>
                  </div>
               </div>
            </div><a id="LNPLS849"></a><a id="LNPLS848"></a><div class="props_rev_3"><a id="GUID-7E0CDD98-D31C-4745-B819-B5C5E1DF90A8" name="GUID-7E0CDD98-D31C-4745-B819-B5C5E1DF90A8"></a><h3 id="LNPLS-GUID-7E0CDD98-D31C-4745-B819-B5C5E1DF90A8" class="sect3"><span class="enumeration_section">11.10</span>检索错误代码和错误消息</h3>
               <div>
                  <div class="section">
                     <p>在异常处理程序中，对于正在处理的异常：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您可以使用<span class="q">“ <a href="SQLCODE-function.html#GUID-1FFD7902-D22D-4505-815A-C97DDBEFB4B5" title="在异常处理程序中，SQLCODE函数返回正在处理的异常的数字代码。（在异常处理程序之外，SQLCODE返回0.）">SQLCODE函数</a> ”中</span>描述的PL / SQL函数<code class="codeph">SQLCODE</code>检索错误代码。
                           </p>
                        </li>
                        <li>
                           <p>您可以使用以下任一方法检索错误消息：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>PL / SQL函数<code class="codeph">SQLERRM</code> ，在<span class="q">“ <a href="SQLERRM-function.html#GUID-D4468C8F-62D9-42A5-AF72-C1098C866DC5" title="SQLERRM函数返回与错误代码关联的错误消息。">SQLERRM函数</a> ”中</span>描述</p>
                                 <p>此函数最多返回512个字节，这是Oracle数据库错误消息的最大长度（包括错误代码，嵌套消息和消息插入，如表和列名称）。</p>
                              </li>
                              <li>
                                 <p>包函数<code class="codeph">DBMS_UTILITY</code> 。 <code class="codeph">FORMAT_ERROR_STACK</code> ，在<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/lnpls&amp;id=ARPLS73242" target="_blank"><span class="italic">Oracle数据库PL / SQL包和类型参考中描述</span></a></p>
                                 <p>此函数返回完整的错误堆栈，最多2000个字节。</p>
                              </li>
                           </ul>
                           <p>Oracle建议使用<code class="codeph">DBMS_UTILITY</code> 。 <code class="codeph">FORMAT_ERROR_STACK</code> ，除非使用带有<code class="codeph">SAVE</code> <code class="codeph">EXCEPTIONS</code>子句的<code class="codeph">FORALL</code>语句，如<a href="plsql-optimization-and-tuning.html#GUID-DAF46F06-EF3F-4B1A-A518-5238B80C69FA__BABGBABA">例12-13所示</a> 。
                           </p>
                        </li>
                     </ul>
                     <p>SQL语句无法调用<code class="codeph">SQLCODE</code>或<code class="codeph">SQLERRM</code> 。要在SQL语句中使用它们的值，首先将它们分配给局部变量，如<a href="plsql-error-handling.html#GUID-7E0CDD98-D31C-4745-B819-B5C5E1DF90A8__CJAJBAJG">例11-23所示</a> 。
                     </p>
                     <div class="infoboxnotealso" id="GUID-7E0CDD98-D31C-4745-B819-B5C5E1DF90A8__GUID-324437FD-504B-4422-87E0-C2B1869C5402">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关<code class="codeph">DBMS_UTILITY</code>信息<a href="../arpls/DBMS_UTILITY.html#ARPLS73241" target="_blank"><span class="italic">，请参见Oracle Database PL / SQL包和类型参考</span></a> 。 <code class="codeph">FORMAT_ERROR_BACKTRACE</code>函数，它在引发异常的位置显示调用堆栈，即使从外部作用域中的异常处理程序调用子程序也是如此</p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/lnpls&amp;id=ARPLS74078" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a>有关<code class="codeph">UTL_CALL_STACK</code>包的信息，其子程序提供有关当前正在执行的子程序的信息，包括子程序名称</p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-7E0CDD98-D31C-4745-B819-B5C5E1DF90A8__CJAJBAJG">
                     <p class="titleinexample">示例11-23显示SQLCODE和SQLERRM值</p><pre class="oac_no_warn" dir="ltr">DROP TABLE错误; CREATE TABLE错误（代码NUMBER，消息VARCHAR2（64））;创建或替换程序p AUTHID DEFINER作为名称EMPLOYEES.LAST_NAME％TYPE; v_code NUMBER; v_errm VARCHAR2（64）; BEGIN SELECT last_name INTO name FROM EMPLOYEES WHERE EMPLOYEE_ID = -1; <span class="bold">除此之外的</span>异常<span class="bold">v_code：= SQLCODE;</span> <span class="bold">v_errm：= SUBSTR（SQLERRM，1,64）;</span> DBMS_OUTPUT.PUT_LINE（'错误代码'|| v_code ||'：'|| v_errm）; / *调用另一个使用PRAGMA AUTONOMOUS_TRANSACTION声明的过程来插入有关错误的信息。* / <span class="bold">INSERT INTO错误（代码，消息）</span> <span class="bold">VALUES（v_code，v_errm）;</span>提高;结束; /</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="LNPLS765"></a><a id="LNPLS852"></a><a id="LNPLS851"></a><div class="props_rev_3"><a id="GUID-E63131E7-4AE6-4C47-8D21-5EC1F6D3AA68" name="GUID-E63131E7-4AE6-4C47-8D21-5EC1F6D3AA68"></a><h3 id="LNPLS-GUID-E63131E7-4AE6-4C47-8D21-5EC1F6D3AA68" class="sect3"><span class="enumeration_section">11.11</span>处理异常后继续执行</h3>
               <div>
                  <div class="section">
                     <p>在异常处理程序运行之后，控制转移到封闭块的下一个语句（如果没有封闭块，则转移到调用者或主机环境）。异常处理程序无法将控制权转移回自己的块。</p>
                     <p>例如，在<a href="plsql-error-handling.html#GUID-E63131E7-4AE6-4C47-8D21-5EC1F6D3AA68__CHDGAJIF">例11-24</a> ，后<code class="codeph">SELECT</code> <code class="codeph">INTO</code>语句引发<code class="codeph">ZERO_DIVIDE</code>和异常处理程序处理它，执行不能从不断<code class="codeph">INSERT</code>下面的语句<code class="codeph">SELECT</code> <code class="codeph">INTO</code>语句。
                     </p>
                     <p>如果希望使用<code class="codeph">SELECT</code> <code class="codeph">INTO</code>语句<code class="codeph">ZERO_DIVIDE</code>的<code class="codeph">INSERT</code>语句继续执行，则将<code class="codeph">SELECT</code> <code class="codeph">INTO</code>语句放在具有自己的<code class="codeph">ZERO_DIVIDE</code>异常处理程序的内部块中，如<a href="plsql-error-handling.html#GUID-E63131E7-4AE6-4C47-8D21-5EC1F6D3AA68__BABJCEEC">例11-25所示</a> 。
                     </p>
                     <div class="infoboxnotealso" id="GUID-E63131E7-4AE6-4C47-8D21-5EC1F6D3AA68__GUID-5F0822F9-18CA-44DE-AAA3-FAFD4F5CC250">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="plsql-optimization-and-tuning.html#GUID-DAF46F06-EF3F-4B1A-A518-5238B80C69FA__BABGBABA">例12-13</a> ，尽管例外，批量SQL操作仍在继续</p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-E63131E7-4AE6-4C47-8D21-5EC1F6D3AA68__CHDGAJIF">
                     <p class="titleinexample">示例11-24异常处理程序运行和执行结束</p><pre class="oac_no_warn" dir="ltr">DROP TABLE employees_temp; CREATE TABLE employees_temp AS SELECT employee_id，salary，commission_pct FROM employees; DECLARE sal_calc NUMBER（8,2）; BEGIN INSERT INTO employees_temp（employee_id，salary，commission_pct）VALUES（301,2500,0）; <span class="bold">SELECT（salary / commission_pct）INTO sal_calc</span> FROM employees_temp WHERE employee_id = 301; <span class="bold">INSERT INTO employees_temp VALUES（302，sal_calc / 100，.1）;</span> DBMS_OUTPUT.PUT_LINE（' <span class="bold">插入行。</span>“）; <span class="bold">ZERO_DIVIDE，然后是</span> DBMS_OUTPUT.PUT_LINE（' <span class="bold">除以零。</span>“）;结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">被零除。
</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-E63131E7-4AE6-4C47-8D21-5EC1F6D3AA68__BABJCEEC">
                     <p class="titleinexample">例11-25异常处理程序运行和执行继续</p><pre class="oac_no_warn" dir="ltr">DECLARE sal_calc NUMBER（8,2）; BEGIN INSERT INTO employees_temp（employee_id，salary，commission_pct）VALUES（301,2500,0）; <span class="bold">BEGIN</span> SELECT（salary / commission_pct）INTO sal_calc FROM employees_temp WHERE employee_id = 301; <span class="bold">异常，</span> <span class="bold">当ZERO_DIVIDE THEN</span> DBMS_OUTPUT.PUT_LINE（” <span class="bold">代2500未定义的数字。</span>“）; sal_calc：= 2500; <span class="bold">结束;</span> INSERT INTO employees_temp VALUES（302，sal_calc / 100，.1）; DBMS_OUTPUT.PUT_LINE（' <span class="bold">封闭块：插入行。</span>“）; ZERO_DIVIDE，然后是DBMS_OUTPUT.PUT_LINE（' <span class="bold">封闭块：除以零之外的</span>异常<span class="bold">。</span>“）;结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">用2500代替未定义的数字。封闭块：插入行。</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="LNPLS854"></a><a id="LNPLS853"></a><div class="props_rev_3"><a id="GUID-CF7B91D7-215F-48D7-AE83-240012CE8ED6" name="GUID-CF7B91D7-215F-48D7-AE83-240012CE8ED6"></a><h3 id="LNPLS-GUID-CF7B91D7-215F-48D7-AE83-240012CE8ED6" class="sect3"><span class="enumeration_section">11.12</span>处理异常后重试事务</h3>
               <div>
                  <div class="section">
                     <p>要在处理它引发的异常后重试事务，请使用以下技术：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>将事务包含在具有异常处理部分的子块中。</span></li>
                     <li class="stepexpand"><span>在子块中，在事务开始之前，标记保存点。</span></li>
                     <li class="stepexpand"><span>在子块的异常处理部分中，放置一个异常处理程序，该处理程序回滚到保存点，然后尝试更正问题。</span></li>
                     <li class="stepexpand"><span>将子块放在<code class="codeph">LOOP</code>语句中。</span></li>
                     <li class="stepexpand"><span>在子块中，在结束事务的<code class="codeph">COMMIT</code>语句之后，放入一个<code class="codeph">EXIT</code>语句。</span><div>
                           <p>如果事务成功，则执行<code class="codeph">COMMIT</code>和<code class="codeph">EXIT</code>语句。
                           </p>
                           <p>如果事务失败，则控制转移到子块的异常处理部分，并且在异常处理程序运行之后，循环重复。</p>
                        </div>
                     </li>
                  </ol>
                  <div class="example" id="GUID-CF7B91D7-215F-48D7-AE83-240012CE8ED6__BABGHCEH">
                     <p class="titleinexample">示例11-26处理异常后重试事务</p><pre class="oac_no_warn" dir="ltr">DROP TABLE结果; CREATE TABLE结果（res_name VARCHAR（20），res_answer VARCHAR2（3））; <span class="bold">CREATE UNIQUE INDEX res_name_ix ON results（res_name）;</span> INSERT INTO结果（res_name，res_answer）VALUES（'SMYTHE'，'YES'）; INSERT INTO结果（res_name，res_answer）VALUES（'JONES'，'NO'）; DECLARE名称VARCHAR2（20）：='SMYTHE';回答VARCHAR2（3）：='否';后缀NUMBER：= 1;开始<span class="bold">为我在1..5循环 - 尝试交易最多5次。</span>DBMS_OUTPUT.PUT（'试试＃'|| i）; <span class="bold">BEGIN  - 子块开始</span> <span class="bold">SAVEPOINT start_transaction;</span> <span class="bold">- 事务开始</span> DELETE FROM结果WHERE res_answer ='NO'; INSERT INTO结果（res_name，res_answer）VALUES（名称，答案）; <span class="bold"> - 非唯一名称引发DUP_VAL_ON_INDEX。</span> <span class="bold">- 如果事务成功：</span> COMMIT; DBMS_OUTPUT.PUT_LINE（'成功。“）;出口; <span class="bold">DUP_VAL_ON_INDEX然后</span> DBMS_OUTPUT.PUT_LINE（'失败;再次尝试）时的<span class="bold">异常</span> 。“）; <span class="bold">ROLLBACK TO start_transaction;</span> -  取消更改。后缀：=后缀+ 1; - 尝试解决问题。name：= name || TO_CHAR（后缀）; <span class="bold">结束; - 子块结束</span> <span class="bold">END LOOP;</span>结束; /</pre><p>结果：</p><pre class="oac_no_warn" dir="ltr">尝试＃1失败;再试一次。尝试＃2成功。</pre></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p><a href="plsql-error-handling.html#GUID-CF7B91D7-215F-48D7-AE83-240012CE8ED6__BABGHCEH">实施例11-26</a>使用前述技术来重试其事务<code class="codeph">INSERT</code>语句产生预定义的异常<code class="codeph">DUP_VAL_ON_INDEX</code>如果值<code class="codeph">res_name</code>不是唯一的。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="LNPLS1963"></a><div class="props_rev_3"><a id="GUID-6B966875-B27C-4FDF-8334-8FB3B22ABF4A" name="GUID-6B966875-B27C-4FDF-8334-8FB3B22ABF4A"></a><h3 id="LNPLS-GUID-6B966875-B27C-4FDF-8334-8FB3B22ABF4A" class="sect3"><span class="enumeration_section">11.13</span>处理分布式查询中的错误</h3>
               <div>
                  <div class="section">
                     <p>您可以使用触发器或存储的子程序来创建分布式查询。该分布式查询由本地Oracle数据库实例分解为相应数量的远程查询，这些远程查询被发送到远程节点以供执行。远程节点运行查询并将结果发送回本地节点。然后，本地节点执行任何必要的后处理，并将结果返回给用户或应用程序。</p>
                     <p>如果分布式语句的一部分失败（可能是违反约束），则Oracle数据库将返回ORA-02055。后续语句或子程序调用将返回ORA-02067，直到输入回滚或回滚到保存点。</p>
                     <p>设计应用程序以检查是否有任何返回的错误消息，指示分布式更新的一部分已失败。如果检测到故障，请在允许应用程序继续之前回滚整个事务（或回滚到保存点）。</p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>