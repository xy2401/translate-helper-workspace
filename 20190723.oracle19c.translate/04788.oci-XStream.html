<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>OCI XStream功能</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Programmer&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Programmer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="oracle-call-interface-programmers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-14T08:46:00-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96204-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="handler-and-descriptor-attributes.html" title="Previous" type="text/html"></link>
      <link rel="next" href="intro-to-XStream-functions.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Oracle Call Interface Programmer&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="LNOCI"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="handler-and-descriptor-attributes.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="intro-to-XStream-functions.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">程序员指南</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">OCI XStream功能</li>
            </ol>
            <a id="GUID-527DB451-F87E-479A-8F35-25FD8D01E2EC" name="GUID-527DB451-F87E-479A-8F35-25FD8D01E2EC"></a><a id="LNOCI72914"></a>
            
            <h2 id="LNOCI-GUID-527DB451-F87E-479A-8F35-25FD8D01E2EC" class="sect2"><span class="enumeration_chapter">35</span> OCI XStream功能</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍OCI的XStream功能。</p>
               <p>行逻辑更改记录（LCR）用于封装每个行更改。它包括模式名称，表名称，DML操作和列值。对于更新操作，包括列值之前和之后。列数据采用<a href="oci-XStream-functions.html#GUID-80F5BEE8-EC26-426F-A114-9F7B7AFD497E__BABHDBAJ" title="该表有4列。第1列是表列数据类型，第2列是LCR列数据类型，第3列是程序变量，第4列是OCI转换函数名。">表35-3中</a> “程序变量”列指定的格式。字符列将转换为客户端的字符集。
               </p>
               <p>DDL LCR用于封装每个DDL更改。它包括对象名称，DDL文本和DDL命令，例如<code class="codeph">ALTER</code> <code class="codeph">TABLE</code>或<code class="codeph">TRUNCATE</code> <code class="codeph">TABLE</code> 。有关DDL命令代码的列表，请<a href="handle-and-descriptor-attributes.html#GUID-A251CF91-EB9F-4DBC-8BB8-FB5EA92C20DE__CACEIFFF" title="此表有2个从左到右的长列，显示为6列。第1列是SQL命令的SQL函数代码，第2列是其对应的SQL语句。第3列是SQL命令的SQL函数代码，第4列是其对应的SQL语句。第5列是SQL命令的SQL函数代码，第6列是其对应的SQL语句。">参见表A-1</a> 。
               </p>
               <div class="infoboxnotealso" id="GUID-527DB451-F87E-479A-8F35-25FD8D01E2EC__GUID-C72AE714-3901-4261-973E-2C19A77700AD">
                  <p class="notep1">也可以看看：</p>
                  <p><a href="../nlspg/OCI-programming-in-global-environment.html#NLSPG451" target="_blank"><span><cite>“Oracle数据库全球化支持指南”</cite></span></a> ，了解有关NLS设置的更多信息。
                  </p>
                  <p>XStream示例程序位于<code class="codeph">$ORACLE_HOME/demo</code>目录下的<code class="codeph">xstream/oci</code> 。
                  </p>
               </div>
               <p>每个LCR还有一个交易ID和头寸。对于在Oracle数据库之外捕获的事务，如果流中每个LCR的位置严格增加，则任何字节可比较的<code class="codeph">RAW</code>阵列都可以用作LCR位置。
               </p>
               <p>本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="oci-XStream.html#GUID-EAC548D6-2769-4138-B90D-CE42D4F29F22" title="XStream Out允许远程客户端连接到出站服务器（Streams应用进程）并以逻辑更改记录（LCR）的形式提取行更改。描述LCR流的特征。如果出站服务器或客户端异常中止，则两者之间的连接会自动中断。客户端需要保持处理后的低位以在重新启动后正确恢复。要将非Oracle数据复制到Oracle数据库，请使用XStream，其中允许远程客户端连接到入站服务器（Streams应用进程）并以LCR的形式发送行和DDL更改。处理后的低位是入站服务器不再需要任何LCR的位置。流位置是指LCR在给定LCR流中的位置。描述XStream的安全特性。">关于使用XStream接口</a></p>
                  </li>
                  <li>
                     <p><a href="intro-to-XStream-functions.html#GUID-9462F061-7482-43E1-809C-66D69A68CD64" title="列出并描述用于描述功能的约定。">XStream函数简介</a></p>
                  </li>
                  <li>
                     <p><a href="oci-XStream-functions.html#GUID-FEF426F1-90C1-49DB-ADCD-C7CF298F66B8" title="列出并描述OCI XStream功能。">OCI XStream功能</a></p>
                  </li>
               </ul>
            </div>
            <div class="props_rev_3"><a id="GUID-EAC548D6-2769-4138-B90D-CE42D4F29F22" name="GUID-EAC548D6-2769-4138-B90D-CE42D4F29F22"></a><h3 id="LNOCI-GUID-EAC548D6-2769-4138-B90D-CE42D4F29F22" class="sect3"><span class="enumeration_section">35.1</span>关于使用XStream接口</h3>
               <div>
                  <p>自Oracle Database 11g第2版以来，Oracle Streams提供增强的API，称为eXtended Streams（XStream）Out和XStream In，以在Oracle数据库和非Oracle数据库之间实现高性能，近实时的信息共享基础架构，非RDBMS Oracle产品，文件系统，第三方软件应用程序等。</p>
                  <p>XStream构建于Streams基础架构之上。</p>
                  <div class="p">本节包括以下主题：<ul style="list-style-type:disc">
                        <li>
                           <p><a href="oci-XStream.html#GUID-9E682886-1812-4E18-B99F-1FCF2F6C0A54" title="XStream Out允许远程客户端连接到出站服务器（Streams应用进程）并以逻辑更改记录（LCR）的形式提取行更改。">XStream Out</a></p>
                        </li>
                        <li>
                           <p><a href="oci-XStream.html#GUID-A8AFCE7F-E475-4C75-AC3B-5A37B6F83B90" title="要将非Oracle数据复制到Oracle数据库，请使用XStream，其中允许远程客户端连接到入站服务器（Streams应用进程）并以LCR的形式发送行和DDL更改。">XStream In</a></p>
                        </li>
                        <li>
                           <p><a href="oci-XStream.html#GUID-CFF27EA8-C0B5-4B49-8966-52AC4AD45F8E" title="描述XStream的安全特性。">XStreams的安全性</a></p>
                        </li>
                     </ul>
                  </div>
                  <div class="infoboxnotealso" id="GUID-EAC548D6-2769-4138-B90D-CE42D4F29F22__GUID-F201BA01-D9AC-44B7-9C9E-D7C3F1C728C2">
                     <p class="notep1">也可以看看：</p>
                     <p> <a href="oci-XStream.html#GUID-527DB451-F87E-479A-8F35-25FD8D01E2EC" title="XStream Out允许远程客户端连接到出站服务器（Streams应用进程）并以逻辑更改记录（LCR）的形式提取行更改。描述LCR流的特征。如果出站服务器或客户端异常中止，则两者之间的连接会自动中断。客户端需要保持处理后的低位以在重新启动后正确恢复。要将非Oracle数据复制到Oracle数据库，请使用XStream，其中允许远程客户端连接到入站服务器（Streams应用进程）并以LCR的形式发送行和DDL更改。处理后的低位是入站服务器不再需要任何LCR的位置。流位置是指LCR在给定LCR流中的位置。描述XStream的安全特性。">OCI XStream功能</a></p>
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-9E682886-1812-4E18-B99F-1FCF2F6C0A54" name="GUID-9E682886-1812-4E18-B99F-1FCF2F6C0A54"></a><h4 id="LNOCI-GUID-9E682886-1812-4E18-B99F-1FCF2F6C0A54" class="sect4"><span class="enumeration_section">35.1.1</span> XStream Out</h4>
                  <div>
                     <p>XStream Out允许远程客户端连接到出站服务器（Streams应用进程）并以逻辑更改记录（LCR）的形式提取行更改。</p>
                     <p>要使用XStream Out，必须创建类似于其他Streams设置的捕获和应用过程。XStreams支持Oracle Streams支持的所有数据类型，包括LOB， <code class="codeph">LONG</code>和<code class="codeph">XMLType</code> 。这种应用过程称为出站服务器。捕获和出站服务器可能位于同一数据库实例上，也可能不位于同一数据库实例上。捕获和出站服务器启动后，将捕获行更改并将其发送到出站服务器。然后，外部客户端可以使用OCI连接到此出站服务器。建立连接后，客户端可以循环等待来自出站服务器的LCR。客户端可以注册每次收到LCR时要调用的客户端回调。在任何时候，客户端都可以根据需要从出站服务器分离。重启后，出站服务器知道重做流中的哪个位置开始将LCR流式传输到客户端。
                     </p>
                     <div class="p">本节包括以下主题：<ul style="list-style-type:disc">
                           <li>
                              <p><a href="oci-XStream.html#GUID-E3CA74B0-6F37-4531-A5BE-1EFCFEFE6837" title="描述LCR流的特征。">LCR Streams</a></p>
                           </li>
                           <li>
                              <p><a href="oci-XStream.html#GUID-3D9E7038-EB91-4E74-95AF-9DDB3328222A" title="如果出站服务器或客户端异常中止，则两者之间的连接会自动中断。客户端需要保持处理后的低位以在重新启动后正确恢复。">处理的低位置和重启注意事项</a></p>
                           </li>
                        </ul>
                     </div>
                     <div class="infoboxnotealso" id="GUID-9E682886-1812-4E18-B99F-1FCF2F6C0A54__GUID-FDEEA92B-B682-494A-954C-2D3739372FC8">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关XStreams概念的更多详细信息，请参阅<a href="../xstrm/introduction-to-xstream.html#XSTRM1086" target="_blank"><span><cite>“Oracle数据库XStream指南”</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-E3CA74B0-6F37-4531-A5BE-1EFCFEFE6837" name="GUID-E3CA74B0-6F37-4531-A5BE-1EFCFEFE6837"></a><h5 id="LNOCI-GUID-E3CA74B0-6F37-4531-A5BE-1EFCFEFE6837" class="sect5"><span class="enumeration_section">35.1.1.1</span> LCR流</h5>
                     <div>
                        <p>描述LCR流的特征。</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>LCR流必须是可重复的。</p>
                           </li>
                           <li>
                              <p>LCR流必须包含已组装和已提交事务的列表。</p>
                           </li>
                           <li>
                              <p>一次交易的LCR是连续的。LCR流中没有交易交错。</p>
                           </li>
                           <li>
                              <p>LCR流中的每个事务必须具有LCR的有序列表和事务ID。</p>
                           </li>
                           <li>
                              <p>每个事务中的最后一个LCR必须是提交LCR。</p>
                           </li>
                           <li>
                              <p>每个LCR必须具有独特的位置。</p>
                           </li>
                           <li>
                              <p>所有LCR在单个交易和交易中的位置必须严格增加。</p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-3D9E7038-EB91-4E74-95AF-9DDB3328222A" name="GUID-3D9E7038-EB91-4E74-95AF-9DDB3328222A"></a><h5 id="LNOCI-GUID-3D9E7038-EB91-4E74-95AF-9DDB3328222A" class="sect5"><span class="enumeration_section">35.1.1.2</span>处理的低位和重启注意事项</h5>
                     <div>
                        <p>如果出站服务器或客户端异常中止，则两者之间的连接会自动中断。客户端需要保持处理后的低位以在重新启动后正确恢复。</p>
                        <p>处理后的低位是一个位置，低于该位置所有LCR都已由客户处理。在应用每笔交易时，客户应维护此职位。在客户端执行XStream Out API时，会定期将此位置发送到服务器。该位置向服务器指示客户端已经处理了低于或等于该位置的所有LCR;因此，服务器可以清除不再需要的重做日志。</p>
                        <p>重新启动后，客户端必须重新连接到出站服务器。在附着呼叫期间，客户端可以向出站服务器通知客户端接收的最后位置。然后，出站服务器发送位置大于此最后位置的LCR。如果客户端未指定最后一个位置（即指定了<code class="codeph">NULL</code> ），则出站服务器将从其系统表中检索已处理的低位置，并派生起始位置以挖掘重做日志。它将向客户端发送位置大于此处理低位置的LCR。
                        </p>
                     </div>
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-A8AFCE7F-E475-4C75-AC3B-5A37B6F83B90" name="GUID-A8AFCE7F-E475-4C75-AC3B-5A37B6F83B90"></a><h4 id="LNOCI-GUID-A8AFCE7F-E475-4C75-AC3B-5A37B6F83B90" class="sect4"><span class="enumeration_section">35.1.2</span> XStream In</h4>
                  <div>
                     <p>要将非Oracle数据复制到Oracle数据库，请使用XStream，其中允许远程客户端连接到入站服务器（Streams应用进程）并以LCR的形式发送行和DDL更改。</p>
                     <p>外部客户端应用程序使用OCI连接到入站服务器。建立连接后，客户端应用程序通过将LCR流式传输到其中，充当入站服务器的捕获代理。客户端应用程序每个数据库连接只能连接到一个入站服务器。每个入站服务器只允许一个客户端连接到它。</p>
                     <p>XStream In使用Oracle Streams的以下功能：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>使用应用过程对DML的高性能处理进行更改，并且可选地应用过程并行性。</p>
                        </li>
                        <li>
                           <p>使用应用处理程序应用流程功能，例如SQL生成，冲突检测和解决，错误处理以及自定义处理。</p>
                        </li>
                        <li>
                           <p>以最少的网络往返流式传输信息的网络。</p>
                        </li>
                     </ul>
                     <p>XStream In支持Oracle Streams支持的所有数据类型，包括LOB， <code class="codeph">LONG</code> ， <code class="codeph">LONG</code> <code class="codeph">RAW</code>和<code class="codeph">XMLType</code> 。客户端应用程序以块的形式将LOB和<code class="codeph">XMLType</code>数据发送到入站服务器。几个块构成LOB或<code class="codeph">XMLType</code>的单个列值。
                     </p>
                     <div class="p">本节包括以下主题：<ul style="list-style-type:disc">
                           <li>
                              <p><a href="oci-XStream.html#GUID-C4406AE9-9D42-49F8-B4B7-C8942A410D52" title="处理后的低位是入站服务器不再需要任何LCR的位置。">处理低位和重启能力</a></p>
                           </li>
                           <li>
                              <p><a href="oci-XStream.html#GUID-B5079754-01CC-4E34-9398-9A062B6F0102" title="流位置是指LCR在给定LCR流中的位置。">流位置</a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-C4406AE9-9D42-49F8-B4B7-C8942A410D52" name="GUID-C4406AE9-9D42-49F8-B4B7-C8942A410D52"></a><h5 id="LNOCI-GUID-C4406AE9-9D42-49F8-B4B7-C8942A410D52" class="sect5"><span class="enumeration_section">35.1.2.1</span>处理低位和重启能力</h5>
                     <div>
                        <p>处理后的低位是入站服务器不再需要任何LCR的位置。</p>
                        <p>此位置对应于应用由捕获进程捕获的更改的Oracle Streams应用进程的最旧SCN。</p>
                        <p>处理后的低位表示入站服务器已处理小于或等于此位置的LCR。如果客户端重新连接到入站服务器，则它只需要发送大于处理的低位置的LCR，因为入站服务器丢弃任何小于或等于处理的低位置的LCR。</p>
                        <p>如果客户端应用程序异常中止，则客户端应用程序与入站服务器之间的连接将自动中断。重新启动后，客户端应用程序从入站服务器检索已处理的低位置，并指示其捕获代理程序从此处理的低位置开始检索更改。</p>
                        <p>要使用XStream In界面限制客户端应用程序的恢复时间，客户端应用程序可以定期向入站服务器发送活动（如空事务）。当没有LCR要发送到服务器时，客户端可以发送带有commit指令的行LCR，以提前入站服务器处理的低位置。此活动充当确认，以便可以提前入站服务器的已处理低位置。发送到入站服务器的LCR流必须遵循上面定义的XStream Out的LCR流属性。</p>
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-B5079754-01CC-4E34-9398-9A062B6F0102" name="GUID-B5079754-01CC-4E34-9398-9A062B6F0102"></a><h5 id="LNOCI-GUID-B5079754-01CC-4E34-9398-9A062B6F0102" class="sect5"><span class="enumeration_section">35.1.2.2</span>流位置</h5>
                     <div>
                        <p>流位置是指LCR在给定LCR流中的位置。</p>
                        <p>对于在Oracle数据库外捕获的事务，流位置必须以支持字节比较的特定格式（例如，base-16编码）进行编码。流位置是客户端使用XStream In接口发送的事务流总顺序的关键。</p>
                     </div>
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-CFF27EA8-C0B5-4B49-8966-52AC4AD45F8E" name="GUID-CFF27EA8-C0B5-4B49-8966-52AC4AD45F8E"></a><h4 id="LNOCI-GUID-CFF27EA8-C0B5-4B49-8966-52AC4AD45F8E" class="sect4"><span class="enumeration_section">35.1.3 XStream的</span>安全性</h4>
                  <div>
                     <p>描述XStream的安全特性。</p>
                     <p>XStream Out允许普通用户接收LCR而无需系统级权限。配置XStream Out需要系统级权限，例如DBA角色。配置XStream Out的用户可以将常规用户指定为可以连接到出站服务器以接收LCR的连接用户。</p>
                     <p>XStream In允许常规用户在其自己的架构中更新表，而无需系统级权限（例如，DBA）来配置XStream In。</p>
                     <p>XStream不能假定入站或出站服务器的连接用户是可信的。</p>
                     <p>OCI客户端必须在连接到在该数据库上创建的XStream出站或入站服务器之前连接到Oracle数据库。连接的用户必须与为连接的出站服务器配置的<code class="codeph">connect_user</code>或为连接的入站服务器配置的<code class="codeph">apply_user</code> ;否则，会引发错误。
                     </p>
                     <div class="infoboxnotealso" id="GUID-CFF27EA8-C0B5-4B49-8966-52AC4AD45F8E__GUID-91D5CCB2-56DD-43D9-B261-3C2CC7F67735">
                        <p class="notep1">也可以看看：</p>
                        <p>有关配置Oracle <a href="../xstrm/configuring-xstream-out.html#XSTRM1496" target="_blank"><span><cite>XStream</cite></span></a>的更多信息，请参阅<a href="../xstrm/configuring-xstream-out.html#XSTRM1496" target="_blank"><span><cite>“Oracle数据库XStream指南”</cite></span></a></p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>