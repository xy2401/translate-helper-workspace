<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="There are a number of steps involved in creating a logical standby database, including prerequisites and post-creation tasks."></meta>
      <meta name="description" content="There are a number of steps involved in creating a logical standby database, including prerequisites and post-creation tasks."></meta>
      <title>创建逻辑备用数据库</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Concepts and Administration "></meta>
      <meta property="og:description" content="There are a number of steps involved in creating a logical standby database, including prerequisites and post-creation tasks."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Concepts and Administration"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="data-guard-concepts-and-administration.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-02-12T10:50:21-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1999, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96244-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="creating-oracle-data-guard-physical-standby.html" title="Previous" type="text/html"></link>
      <link rel="next" href="creating-oracle-data-guard-far-sync-instance.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Data Guard Concepts and Administration"></meta>
    <meta name="dcterms.isVersionOf" content="SBYDB"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="creating-oracle-data-guard-physical-standby.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="creating-oracle-data-guard-far-sync-instance.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">概念和管理</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="oracle-data-guard-concepts.html" property="item" typeof="WebPage"><span property="name">概念和管理</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">创建逻辑备用数据库</li>
            </ol>
            <a id="GUID-3666CA35-D993-44B6-8D70-A2B8B9EC8B2E" name="GUID-3666CA35-D993-44B6-8D70-A2B8B9EC8B2E"></a><a id="SBYDB00300"></a>
            
            <h2 id="SBYDB-GUID-3666CA35-D993-44B6-8D70-A2B8B9EC8B2E" class="sect2"><span class="enumeration_chapter">4</span>创建逻辑备用数据库</h2>
         </header>
         <div class="ind">
            <div>
               <p>创建逻辑备用数据库涉及许多步骤，包括先决条件和创建后任务。</p>
               <p>有关创建逻辑备用数据库的信息，请参阅以下主题。<a id="d10791e72" class="indexterm-anchor"></a><a id="d10791e76" class="indexterm-anchor"></a></p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="creating-oracle-data-guard-logical-standby.html#GUID-ACF65D75-F057-4C09-9D59-DFAE7D647579" title="在创建逻辑备用数据库之前，必须首先确保已正确配置主数据库。">创建逻辑备用数据库的先决条件</a></p>
                  </li>
                  <li>
                     <p><a href="creating-oracle-data-guard-logical-standby.html#GUID-2A3EDE02-DE51-4813-891C-248AA5F1C027" title="这些是您创建逻辑备用数据库时执行的任务。">创建逻辑备用数据库的分步说明</a></p>
                  </li>
                  <li>
                     <p><a href="creating-oracle-data-guard-logical-standby.html#GUID-DC0A53BC-D29E-4878-BF3F-0AC4503AFA3C">创作后的步骤</a></p>
                  </li>
                  <li>
                     <p><a href="creating-oracle-data-guard-logical-standby.html#GUID-E2BB4836-32D1-4D57-9B32-75B1239170E2" title="您可以创建多租户容器数据库（CDB）的逻辑备用数据库，就像创建常规主数据库的逻辑备用数据库一样。">创建CDB的逻辑备用</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-3666CA35-D993-44B6-8D70-A2B8B9EC8B2E__GUID-F13D846B-013D-42F8-B9F4-C658F70C212D">
                  <p class="notep1">也可以看看：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="../admin/creating-and-configuring-an-oracle-database.html#ADMIN11117" target="_blank"><span class="italic">“Oracle数据库管理员指南”</span></a> ，了解有关创建和使用服务器参数文件的信息</p>
                     </li>
                     <li>
                        <p>Oracle Enterprise Manager Cloud Control联机帮助系统，提供有关使用Oracle Data Guard代理图形用户界面（GUI）自动创建逻辑备用数据库的信息。</p>
                     </li>
                  </ul>
               </div>
               <div class="infoboxnote" id="GUID-3666CA35-D993-44B6-8D70-A2B8B9EC8B2E__GUID-311085FA-B5ED-4CA6-9D06-3A7C0249ED76">
                  <p class="notep1">注意：</p>
                  <p>如果您在多租户容器数据库（CDB）环境中工作，请参阅<a href="creating-oracle-data-guard-logical-standby.html#GUID-E2BB4836-32D1-4D57-9B32-75B1239170E2" title="您可以创建多租户容器数据库（CDB）的逻辑备用数据库，就像创建常规主数据库的逻辑备用数据库一样。">创建CDB的逻辑备用，</a>以获取有关非CDB环境的行为差异的信息。例如，在CDB环境中，许多DBA视图都有类似的CDB视图，您应该使用它们。例如，视图<code class="codeph">CDB_LOGSTDBY_NOT_UNIQUE</code>包含与<code class="codeph">DBA_LOGSTDBY_NOT_UNIQUE</code>视图中显示的数据相同的数据，但它有一个指示PDB名称的附加列。
                  </p>
               </div>
            </div><a id="SBYDB5020"></a><a id="SBYDB4730"></a><div class="props_rev_3"><a id="GUID-ACF65D75-F057-4C09-9D59-DFAE7D647579" name="GUID-ACF65D75-F057-4C09-9D59-DFAE7D647579"></a><h3 id="SBYDB-GUID-ACF65D75-F057-4C09-9D59-DFAE7D647579" class="sect3"><span class="enumeration_section">4.1</span>创建逻辑备用数据库的前提条件</h3>
               <div>
                  <p>在创建逻辑备用数据库之前，必须首先确保已正确配置主数据库。</p>
                  <p>在主数据库上执行以下任务以准备创建逻辑备用数据库：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="creating-oracle-data-guard-logical-standby.html#GUID-5F1713AF-8813-4132-A9F7-D91A84231C9C" title="在设置逻辑备用数据库之前，请确保逻辑备用数据库可以维护主数据库中的数据类型和表。">确定对表的数据类型和存储属性的支持</a></p>
                     </li>
                     <li>
                        <p><a href="creating-oracle-data-guard-logical-standby.html#GUID-C238335E-8383-43F1-B5B1-709A2A619C30" title="主数据库生成的重做记录中包含的ROWID不能用于标识逻辑备用数据库中的相应行。">确保可以唯一标识主数据库中的表行</a></p>
                     </li>
                  </ul>
                  <p>逻辑备用数据库使用备用重做日志（SRL）进行从主数据库接收的重做，并在将更改应用于备用数据库时写入联机重做日志（ORL）。因此，逻辑备用数据库通常需要额外的<code class="codeph">ARC</code> <span class="italic">n</span>进程来同时归档SRL和ORL。此外，由于ORL的归档优先于SRL的归档，因此在非常高的工作负载期间，逻辑备用数据库上可能需要更多的SRL。
                  </p>
                  <div class="infoboxnote" id="GUID-ACF65D75-F057-4C09-9D59-DFAE7D647579__GUID-2FB1B496-0F09-4C15-BA29-8E87292802DA">
                     <p class="notep1">注意：</p>逻辑备用数据库必须以<code class="codeph">ARCHIVELOG</code>模式运行才能执行备用重做日志存档。
                     <p>有关存档的信息，请参见“ <a href="../admin/managing-archived-redo-log-files.html#ADMIN008" target="_blank"><span class="italic">Oracle数据库管理员指南”</span></a> 。
                     </p>
                  </div>
               </div><a id="SBYDB4731"></a><div class="props_rev_3"><a id="GUID-5F1713AF-8813-4132-A9F7-D91A84231C9C" name="GUID-5F1713AF-8813-4132-A9F7-D91A84231C9C"></a><h4 id="SBYDB-GUID-5F1713AF-8813-4132-A9F7-D91A84231C9C" class="sect4"><span class="enumeration_section">4.1.1</span>确定对表的数据类型和存储属性的支持</h4>
                  <div>
                     <p>在设置逻辑备用数据库之前，请确保逻辑备用数据库可以维护主数据库中的数据类型和表。</p>
                     <div class="section">
                        <p>有关可用于确定是否存在任何不受支持的数据类型或存储属性的特定SQL查询的信息，请参阅<a href="data-type-ddl-support-on-logical-standby-databases.html#GUID-291FD74A-165A-4E80-9E1F-66996F1FC6CA" title="在创建逻辑备用数据库之前，必须在主数据库上标识不受支持的数据库对象。">不支持的表</a> 。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="SBYDB00308"></a><div class="props_rev_3"><a id="GUID-C238335E-8383-43F1-B5B1-709A2A619C30" name="GUID-C238335E-8383-43F1-B5B1-709A2A619C30"></a><h4 id="SBYDB-GUID-C238335E-8383-43F1-B5B1-709A2A619C30" class="sect4"><span class="enumeration_section">4.1.2</span>确保可以唯一标识主数据库中的表行</h4>
                  <div>
                     <p>主数据库生成的重做记录中包含的ROWID不能用于标识逻辑备用数据库中的相应行。</p>
                     <div class="section">
                        <p>这是因为逻辑备用数据库中的物理组织与主数据库的物理组织不同，即使逻辑备用数据库是从主数据库的备份副本创建的。</p>
                        <p>Oracle使用主键或唯一约束/索引补充日志记录来逻辑标识逻辑备用数据库中的已修改行。启用数据库范围的主键和唯一约束/索引补充日志记录时，每个<code class="codeph">UPDATE</code>语句还会写入重做日志中所需的列值，以唯一标识逻辑备用数据库中的已修改行。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>如果表定义了主键，则将主键与修改后的列一起记录为<code class="codeph">UPDATE</code>语句的一部分，以标识已修改的行。
                              </p>
                           </li>
                           <li>
                              <p>在没有主键的情况下，将最短的非空唯一约束/索引与修改的列一起记录为<code class="codeph">UPDATE</code>语句的一部分，以标识修改的行。
                              </p>
                           </li>
                           <li>
                              <p>如果没有主键且没有非空唯一约束/索引，则将声明最大长度为4000字节的所有列记录为<code class="codeph">UPDATE</code>语句的一部分，以帮助标识已修改的行。对支持的数据类型有一些要求和限制。有关更多信息，请参阅以下部分：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="data-type-ddl-support-on-logical-standby-databases.html#GUID-BD53979B-3120-45CD-803F-2E6675A9DAFD" title="逻辑备用数据库支持多种表存储类型。">支持的表存储类型</a></p>
                                 </li>
                                 <li>
                                    <p><a href="data-type-ddl-support-on-logical-standby-databases.html#GUID-55806A96-6216-41A2-AB52-20704DAAF5C7" title="如果表仅包含这些数据类型，则逻辑备用数据库不支持它。">不支持的表存储类型</a></p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>基于函数的索引即使声明为唯一索引，也不能用于唯一标识已修改的行。但是，逻辑备用数据库支持复制已定义基于函数的索引的表，只要可以唯一标识已修改的行即可。</p>
                           </li>
                        </ul>
                        <p>Oracle建议您尽可能向主数据库中的表添加主键或非空唯一索引，以确保SQL Apply可以有效地将重做数据更新应用于逻辑备用数据库。</p>
                        <p>执行以下步骤以确保SQL Apply可以唯一标识正在逻辑备用数据库中复制的每个表的行。</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>查询<code class="codeph">DBA_LOGSTDBY_NOT_UNIQUE</code>视图以显示SQL Apply可能无法唯一标识的表列表。例如：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT OWNER，TABLE_NAME FROM DBA_LOGSTDBY_NOT_UNIQUE 2&gt; WHERE（OWNER，TABLE_NAME）NOT IN 3&gt;（SELECT DISTINCT OWNER，TABLE_NAME FROM DBA_LOGSTDBY_UNSUPPORTED）4&gt; AND BAD_COLUMN ='Y';</pre><p>此查询可能需要几分钟才能运行。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>如果您的应用程序确保表中的行是唯一的，那么您可以在表上创建禁用的主键<code class="codeph">RELY</code>约束。这避免了在主数据库上维护主键的开销。</span></li>
                     </ol>
                     <div class="section">
                        <p>要在主数据库表上创建禁用的<code class="codeph">RELY</code>约束， <a id="d10791e491" class="indexterm-anchor"></a>使用带有<code class="codeph">RELY DISABLE</code>子句的<code class="codeph">ALTER TABLE</code>语句。以下示例在名为<code class="codeph">mytab</code>的表上创建禁用的<code class="codeph">RELY</code>约束，可以使用<code class="codeph">id</code>和<code class="codeph">name</code>列唯一标识行：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER TABLE mytab ADD PRIMARY KEY（id，name）RELY DISABLE;</pre><p>指定<code class="codeph">RELY</code>约束时，系统假定行是唯一的。因为您告诉系统依赖于信息，但是在对表执行的每个修改中都没有对其进行验证，因此必须小心选择禁用<code class="codeph">RELY</code>约束的列，以便唯一标识表中的每一行。如果不存在此类唯一性，则SQL Apply无法正确维护表。
                        </p>
                        <p>要提高SQL Apply的性能，请在列中添加唯一约束/索引，以标识逻辑备用数据库上的行。如果不这样做，将导致在SQL Apply对表执行的<code class="codeph">UPDATE</code>或<code class="codeph">DELETE</code>语句期间进行全表扫描。
                        </p>
                        <div class="infoboxnotealso" id="GUID-C238335E-8383-43F1-B5B1-709A2A619C30__GUID-713EB1CD-C32C-4D2F-919A-5348816FB65B">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">DBA_LOGSTDBY_NOT_UNIQUE</code>视图的信息，请<a href="../refrn/DBA_LOGSTDBY_NOT_UNIQUE.html#REFRN23123" target="_blank"><span class="italic">参见Oracle数据库参考</span></a></p>
                              </li>
                              <li>
                                 <p>有关<code class="codeph">ALTER TABLE</code>语句语法的信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=SQLRF01001" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                              </li>
                              <li>
                                 <p><a href="managing-oracle-data-guard-logical-standby-databases.html#GUID-10287018-12F8-4727-AB2D-C720571AF4B6" title="在主数据库上，如果表没有主键或唯一索引，并且您确定行是唯一的，则创建主键RELY约束。">创建一个主键RELY约束</a> ，了解有关<code class="codeph">RELY</code>约束和行动，你可以采取增加逻辑备用数据库上的性能</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="SBYDB5021"></a><a id="SBYDB00310"></a><div class="props_rev_3"><a id="GUID-2A3EDE02-DE51-4813-891C-248AA5F1C027" name="GUID-2A3EDE02-DE51-4813-891C-248AA5F1C027"></a><h3 id="SBYDB-GUID-2A3EDE02-DE51-4813-891C-248AA5F1C027" class="sect3"><span class="enumeration_section">4.2</span>创建逻辑备用数据库的逐步说明</h3>
               <div>
                  <p>这些是您创建逻辑备用数据库时执行的任务。</p>
                  <div class="tblformalwide" id="GUID-2A3EDE02-DE51-4813-891C-248AA5F1C027__BEIFEFEE">
                     <p class="titleintable">表4-1创建逻辑备用数据库</p>
                     <table cellpadding="4" cellspacing="0" class="FormalWide" title="创建逻辑备用数据库" width="100%" border="1" summary="This 2 column table describes the steps to create a logical standby database. Column 1 is the task. Column 2 is the database. " frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="49%" id="d10791e670">任务</th>
                              <th align="left" valign="bottom" width="51%" id="d10791e673">数据库</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="49%" id="d10791e678" headers="d10791e670 ">
                                 <p><a href="creating-oracle-data-guard-logical-standby.html#GUID-39D01B49-BA52-488E-B418-4BCFDE7692AF" title="首先创建物理备用数据库，然后将其转换为逻辑备用数据库，从而创建逻辑备用数据库。">创建物理备用数据库</a></p>
                              </td>
                              <td align="left" valign="top" width="51%" headers="d10791e678 d10791e673 ">
                                 <p>主</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="49%" id="d10791e690" headers="d10791e670 ">
                                 <p><a href="creating-oracle-data-guard-logical-standby.html#GUID-CDD78A3A-EB1C-493D-A0EF-ED6EBABDF0B7" title="您可以在新物理备用数据库上运行Redo Apply任意长的时间，然后再将其转换为逻辑备用数据库。">停止物理备用数据库上的重做应用</a></p>
                              </td>
                              <td align="left" valign="top" width="51%" headers="d10791e690 d10791e673 ">
                                 <p>支持</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="49%" id="d10791e702" headers="d10791e670 ">
                                 <p><a href="creating-oracle-data-guard-logical-standby.html#GUID-BA252F0F-B5B9-4AA6-8593-250A7FA7283F" title="作为创建逻辑备用数据库的一部分，您必须准备主数据库以支持逻辑备用数据库。">准备主数据库以支持逻辑备用数据库</a></p>
                              </td>
                              <td align="left" valign="top" width="51%" headers="d10791e702 d10791e673 ">
                                 <p>主</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="49%" id="d10791e714" headers="d10791e670 ">
                                 <p><a href="creating-oracle-data-guard-logical-standby.html#GUID-69BC7C26-F66F-4CB5-BBF6-08350C3E615F" title="必须执行一些必要的任务才能使物理备用数据库转换为逻辑备用数据库。">过渡到逻辑备用数据库</a></p>
                              </td>
                              <td align="left" valign="top" width="51%" headers="d10791e714 d10791e673 ">
                                 <p>支持</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="49%" id="d10791e726" headers="d10791e670 ">
                                 <p><a href="creating-oracle-data-guard-logical-standby.html#GUID-68777C01-83F6-4CCF-9BA2-547ED180138D" title="使用ALTER DATABASE SQL语句打开新创建的逻辑备用数据库。">打开逻辑备用数据库</a></p>
                              </td>
                              <td align="left" valign="top" width="51%" headers="d10791e726 d10791e673 ">
                                 <p>支持</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="49%" id="d10791e741" headers="d10791e670 ">
                                 <p><a href="creating-oracle-data-guard-logical-standby.html#GUID-930CFC64-4EFD-4CF3-A5D0-062FBBD069E1" title="创建逻辑备用数据库后，验证它是否正常运行非常重要。">验证逻辑备用数据库是否正常执行</a></p>
                              </td>
                              <td align="left" valign="top" width="51%" headers="d10791e741 d10791e673 ">
                                 <p>支持</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
               </div><a id="SBYDB4732"></a><div class="props_rev_3"><a id="GUID-39D01B49-BA52-488E-B418-4BCFDE7692AF" name="GUID-39D01B49-BA52-488E-B418-4BCFDE7692AF"></a><h4 id="SBYDB-GUID-39D01B49-BA52-488E-B418-4BCFDE7692AF" class="sect4"><span class="enumeration_section">4.2.1</span>创建逻辑备用任务1：创建物理备用数据库</h4>
                  <div>
                     <p>首先创建物理备用数据库，然后将其转换为逻辑备用数据库，从而创建逻辑备用数据库。</p>
                     <div class="section">
                        <p>按照<a href="creating-oracle-data-guard-physical-standby.html#GUID-B511FB6E-E3E7-436D-94B5-071C37550170" title="您可以使用异步重做传输和实时应用（默认的Oracle Data Guard配置）以最高性能模式手动创建物理备用数据库。">创建物理备用数据库</a>中的说明创建物理备用数据库。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="SBYDB4733"></a><div class="props_rev_3"><a id="GUID-CDD78A3A-EB1C-493D-A0EF-ED6EBABDF0B7" name="GUID-CDD78A3A-EB1C-493D-A0EF-ED6EBABDF0B7"></a><h4 id="SBYDB-GUID-CDD78A3A-EB1C-493D-A0EF-ED6EBABDF0B7" class="sect4"><span class="enumeration_section">4.2.2</span>创建逻辑备用任务2：在物理备用数据库上停止重做应用</h4>
                  <div>
                     <p>您可以在新物理备用数据库上运行Redo Apply任意长的时间，然后再将其转换为逻辑备用数据库。</p>
                     <div class="section">
                        <p>但是，在转换为逻辑备用数据库之前，请在物理备用数据库上停止Redo Apply。停止重做应用是必要的，以避免在包含LogMiner字典的重做之外应用更改（ <a href="creating-oracle-data-guard-logical-standby.html#GUID-E5D227F2-C456-44F3-AEEA-2C8340439EF3" title="A LogMiner dictionary must be built into the redo data so that the LogMiner component of SQL Apply can properly interpret changes it sees in the redo.">在重做数据</a>中<a href="creating-oracle-data-guard-logical-standby.html#GUID-E5D227F2-C456-44F3-AEEA-2C8340439EF3" title="必须在重做数据中内置LogMiner字典，以便SQL Apply的LogMiner组件可以正确解释它在重做中看到的更改。">构建字典中</a>描述）。
                        </p>
                        <p>要停止重做应用，请在物理备用数据库上发出以下语句：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE RECOVER MANAGED STANDBY DATABASE CANCEL;</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="SBYDB4734"></a><div class="props_rev_3"><a id="GUID-BA252F0F-B5B9-4AA6-8593-250A7FA7283F" name="GUID-BA252F0F-B5B9-4AA6-8593-250A7FA7283F"></a><h4 id="SBYDB-GUID-BA252F0F-B5B9-4AA6-8593-250A7FA7283F" class="sect4"><span class="enumeration_section">4.2.3</span>创建逻辑备用任务3：准备主数据库以支持逻辑备用数据库</h4>
                  <div>
                     <p>作为创建逻辑备用数据库的一部分，您必须准备主数据库以支持逻辑备用数据库。</p>
                     <p>请参阅以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="creating-oracle-data-guard-logical-standby.html#GUID-408C8876-F7CC-4112-9C08-58352577ECB4" title="准备切换主数据库的角色时，可能必须修改某些参数。">准备主数据库以进行角色转换</a></p>
                        </li>
                        <li>
                           <p><a href="creating-oracle-data-guard-logical-standby.html#GUID-E5D227F2-C456-44F3-AEEA-2C8340439EF3" title="必须在重做数据中内置LogMiner字典，以便SQL Apply的LogMiner组件可以正确解释它在重做中看到的更改。">在重做数据中构建字典</a></p>
                        </li>
                     </ul>
                  </div><a id="SBYDB5022"></a><a id="SBYDB4735"></a><div class="props_rev_3"><a id="GUID-408C8876-F7CC-4112-9C08-58352577ECB4" name="GUID-408C8876-F7CC-4112-9C08-58352577ECB4"></a><h5 id="SBYDB-GUID-408C8876-F7CC-4112-9C08-58352577ECB4" class="sect5"><span class="enumeration_section">4.2.3.1</span>为角色转换准备主数据库</h5>
                     <div>
                        <p>准备切换主数据库的角色时，可能必须修改某些参数。</p>
                        <div class="section">
                           <p>在“ <a href="creating-oracle-data-guard-physical-standby.html#GUID-0FD317D6-1A49-4DB3-A141-D00CB3089E84" title="在主数据库上，您可以定义在数据库处于主要角色时控制重做传输服务的初始化参数。">设置主数据库初始化参数”中</a> ，设置多个备用角色初始化参数，以便在主数据库转换为<span class="italic">物理</span>备用角色时生效。
                           </p>
                           <div class="infoboxnote" id="GUID-408C8876-F7CC-4112-9C08-58352577ECB4__GUID-D5FB5416-B7D7-48AA-834B-6195A83E89A2">
                              <p class="notep1">注意：</p>
                              <p>仅当您计划执行切换时，才需要执行此步骤。</p>
                           </div>
                           <p>如果您计划将主数据库转换为<span class="italic">逻辑</span>备用角色，则还必须修改<a href="creating-oracle-data-guard-logical-standby.html#GUID-408C8876-F7CC-4112-9C08-58352577ECB4__I91919">示例4-1</a>中以粗体字体显示的参数，以便在角色转换后不需要更改任何参数：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>更改原始<code class="codeph">LOG_ARCHIVE_DEST_1</code>目标中的<code class="codeph">VALID_FOR</code>属性，仅从联机重做日志而不是备用重做日志中归档重做数据。
                                 </p>
                              </li>
                              <li>
                                 <p>在主数据库中包含<code class="codeph">LOG_ARCHIVE_DEST_3</code>目标。此参数仅在主数据库转换为逻辑备用角色时生效。
                                 </p>
                              </li>
                           </ul>
                           <p>下表描述了由<a href="creating-oracle-data-guard-logical-standby.html#GUID-408C8876-F7CC-4112-9C08-58352577ECB4__I91919">示例4-1中</a>显示的已更改的初始化参数定义的归档处理。
                           </p>
                           <div class="tblformalwide" id="GUID-408C8876-F7CC-4112-9C08-58352577ECB4__GUID-DBB3E671-47EA-4401-88EE-691B17BFA568">
                              <table cellpadding="4" cellspacing="0" class="FormalWide" title="" width="100%" border="1" summary="This 3 column table describes how archiving behavior for the Chicago database is controlled by LOG_ARCHIVE_DEST_n parameter when in the primary or the logical standby database role.." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="28%" id="d10791e1138">的LOG_ARCHIVE_DEST_n</th>
                                       <th align="left" valign="bottom" width="33%" id="d10791e1141">当芝加哥数据库以主要角色运行时</th>
                                       <th align="left" valign="bottom" width="38%" id="d10791e1144">当芝加哥数据库以逻辑备用角色运行时</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="28%" id="d10791e1149" headers="d10791e1138 ">
                                          <p><code class="codeph">LOG_ARCHIVE_DEST_1</code></p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d10791e1149 d10791e1141 ">
                                          <p>指示将主数据库生成的重做数据从本地联机重做日志文件归档到<code class="codeph">/arch1/chicago/</code>的本地归档重做日志文件。
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="38%" headers="d10791e1149 d10791e1144 ">
                                          <p>指示将逻辑备用数据库生成的重做数据从本地联机重做日志文件归档到<code class="codeph">/arch1/chicago/</code>的本地归档重做日志文件。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="28%" id="d10791e1166" headers="d10791e1138 ">
                                          <p><code class="codeph">LOG_ARCHIVE_DEST_3</code></p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d10791e1166 d10791e1141 ">
                                          <p>被忽略了;仅当<code class="codeph">chicago</code>以备用角色运行时， <code class="codeph">LOG_ARCHIVE_DEST_3</code>才有效。
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="38%" headers="d10791e1166 d10791e1144 ">
                                          <p>指示将重做数据从备用重做日志文件归档到<code class="codeph">/arch2/chicago/</code>的本地归档重做日志文件。
                                          </p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-408C8876-F7CC-4112-9C08-58352577ECB4__I91919">
                           <p class="titleinexample">示例4-1主数据库：逻辑备用角色初始化参数</p><pre class="oac_no_warn" dir="ltr">LOG_ARCHIVE_DEST_1 ='LOCATION = / arch1 / chicago / VALID_FOR =（ <span class="bold">ONLINE_LOGFILES</span> ，ALL_ROLES）DB_UNIQUE_NAME =芝加哥' <span class="bold">LOG_ARCHIVE_DEST_3 =</span> <span class="bold">'LOCATION = / arch2 / chicago /</span> <span class="bold">VALID_FOR =（STANDBY_LOGFILES，STANDBY_ROLE）</span> <span class="bold">DB_UNIQUE_NAME =芝加哥'</span> <span class="bold">LOG_ARCHIVE_DEST_STATE_3 = ENABLE</span>
</pre><p>要动态设置这些初始化参数，请使用SQL <code class="codeph">ALTER SYSTEM SET</code>语句并包含<code class="codeph">SCOPE=BOTH</code>子句，以便更改立即生效并在数据库关闭并再次启动后保持不变。
                           </p>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="SBYDB4736"></a><div class="props_rev_3"><a id="GUID-E5D227F2-C456-44F3-AEEA-2C8340439EF3" name="GUID-E5D227F2-C456-44F3-AEEA-2C8340439EF3"></a><h5 id="SBYDB-GUID-E5D227F2-C456-44F3-AEEA-2C8340439EF3" class="sect5"><span class="enumeration_section">4.2.3.2</span>在重做数据中构建字典</h5>
                     <div>
                        <p>必须在重做数据中内置LogMiner字典，以便SQL Apply的LogMiner组件可以正确解释它在重做中看到的更改。</p>
                        <div class="section">
                           <p>作为构建LogMiner字典的一部分，将自动设置补充日志记录以记录主键和唯一约束/索引列。补充日志记录信息确保每个更新包含足够的信息，以逻辑方式标识由语句修改的每一行。</p>
                           <p>要构建LogMiner字典，请发出以下语句：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; EXECUTE DBMS_LOGSTDBY.BUILD;</pre><p><code class="codeph">DBMS_LOGSTDBY.BUILD</code>过程等待所有现有事务完成。在主数据库上执行的长时间运行事务会影响此命令的及时性。
                           </p>
                           <div class="infoboxnote" id="GUID-E5D227F2-C456-44F3-AEEA-2C8340439EF3__GUID-5E22C5B2-F247-423F-9A26-C172D71B2BF0">
                              <p class="notep1">注意：</p>
                              <p>在使用Oracle Database <span class="italic">11g</span>第2版（11.2）或更高版本创建的数据库中，补充日志记录信息会自动传播到任何现有的物理备用数据库。但是，对于早期版本中的数据库，或者如果数据库是使用早期版本创建的，然后升级到11.2，则必须检查在物理备用数据库中是否启用了补充日志记录（如果它也在主数据库中启用）。如果未在物理备用数据库上启用，则在执行切换或故障转移之前，必须在所有现有物理备用数据库上启用补充日志记录。为此，请在每个物理备用数据库上发出以下SQL语句：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE添加补充日志数据（PRIMARY KEY，UNIQUE INDEX）列;</pre><p>如果不这样做，那么如果对其中一个物理备用数据库执行切换或故障转移，则同一Oracle Data Guard配置中的任何逻辑备用数据库都将不可用。如果已发生切换或故障转移并且未启用补充日志记录，则必须重新创建所有逻辑备用数据库。</p>
                           </div>
                           <div class="infoboxnotealso" id="GUID-E5D227F2-C456-44F3-AEEA-2C8340439EF3__GUID-3927954B-64E8-437B-BFA0-FB0E76B39EE5">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=ARPLS66834" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考中</span></a>的<code class="codeph">DBMS_LOGSTDBY.BUILD</code> PL / SQL包</p>
                                 </li>
                                 <li>
                                    <p><a href="../refrn/UNDO_RETENTION.html#REFRN10225" target="_blank"><span class="italic">Oracle数据库参考中</span></a>的<code class="codeph">UNDO_RETENTION</code>初始化参数</p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="SBYDB4737"></a><div class="props_rev_3"><a id="GUID-69BC7C26-F66F-4CB5-BBF6-08350C3E615F" name="GUID-69BC7C26-F66F-4CB5-BBF6-08350C3E615F"></a><h4 id="SBYDB-GUID-69BC7C26-F66F-4CB5-BBF6-08350C3E615F" class="sect4"><span class="enumeration_section">4.2.4</span>创建逻辑备用任务4：转换到逻辑备用数据库</h4>
                  <div>
                     <p>必须执行一些必要的任务才能使物理备用数据库转换为逻辑备用数据库。</p>
                     <p>以下主题描述了这些任务：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="creating-oracle-data-guard-logical-standby.html#GUID-715EBEC1-21B9-4DA9-80A5-ED58033F94C8" title="重做日志包含将物理备用数据库转换为逻辑备用数据库所需的信息。">转换为逻辑备用数据库</a></p>
                        </li>
                        <li>
                           <p><a href="creating-oracle-data-guard-logical-standby.html#GUID-31F89C7C-174C-49E4-9A5E-3B9F538BD739">调整逻辑备用数据库的初始化参数</a></p>
                        </li>
                     </ul>
                  </div><a id="SBYDB4738"></a><div class="props_rev_3"><a id="GUID-715EBEC1-21B9-4DA9-80A5-ED58033F94C8" name="GUID-715EBEC1-21B9-4DA9-80A5-ED58033F94C8"></a><h5 id="SBYDB-GUID-715EBEC1-21B9-4DA9-80A5-ED58033F94C8" class="sect5"><span class="enumeration_section">4.2.4.1</span>转换为逻辑备用数据库</h5>
                     <div>
                        <p>重做日志包含将物理备用数据库转换为逻辑备用数据库所需的信息。</p>
                        <div class="section">
                           <div class="infoboxnote" id="GUID-715EBEC1-21B9-4DA9-80A5-ED58033F94C8__GUID-1D8D1ACD-06B1-47AC-8FAD-5AB07FE8F633">
                              <p class="notep1">注意：</p>
                              <p>如果您有Oracle RAC物理备用数据库，则关闭除一个实例以外的所有数据库，将<code class="codeph">CLUSTER_DATABASE</code>设置为<code class="codeph">FALSE</code> ，并在<code class="codeph">MOUNT EXCLUSIVE</code>模式下将备用数据库作为单个实例启动，如下所示：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER SYSTEM SET CLUSTER_DATABASE = FALSE SCOPE = SPFILE; SQL&gt; SHUTDOWN ABORT; SQL&gt; STARTUP MOUNT EXCLUSIVE;</pre></div>
                           <p>要继续将重做数据应用于物理备用数据库，直到它准备好转换为逻辑备用数据库，请发出以下SQL语句：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; <a id="d10791e1559" class="indexterm-anchor"></a> ALTER DATABASE RECOVER TO LOGICAL STANDBY <span class="italic">db_name</span> ;</pre><p>对于<span class="italic">db_name</span> ，请指定与主数据库不同的数据库名称，以标识新的逻辑备用数据库。如果在发出此语句时使用服务器参数文件（spfile），则数据库将使用有关新逻辑备用数据库的相应信息更新该文件。如果您没有使用spfile，则数据库会发出一条消息，提醒您在关闭数据库后设置<code class="codeph">DB_NAME</code>参数的名称。
                           </p>
                           <div class="infoboxnote" id="GUID-715EBEC1-21B9-4DA9-80A5-ED58033F94C8__GUID-EF5F2825-F586-4617-9E53-192099643DDA">
                              <p class="notep1">注意：</p>
                              <p>如果要在执行滚动升级的上下文中创建逻辑备用数据库<a id="d10791e1578" class="indexterm-anchor"></a>使用物理备用数据库的Oracle软件，然后发出以下命令：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE RECOVER TO LOGICAL STANDBY KEEP IDENTITY;</pre><p>使用<code class="codeph">KEEP IDENTITY</code>子句创建的逻辑备用数据库<a id="d10791e1590" class="indexterm-anchor"></a>保留与其主数据库相同的<code class="codeph">DB_NAME</code>和<code class="codeph">DBID</code> 。这样的逻辑备用数据库只能参与一个切换操作，因此只应在具有物理备用数据库的滚动升级的上下文中创建。
                              </p>
                              <p>仅当正在升级的数据库正在运行Oracle Database 11.1或更高版本时， <code class="codeph">KEEP IDENTITY</code>子句才可用。
                              </p>
                           </div>
                           <p>该语句等待，应用重做数据，直到在日志文件中找到LogMine r字典。这可能需要几分钟，具体取决于<a href="creating-oracle-data-guard-logical-standby.html#GUID-E5D227F2-C456-44F3-AEEA-2C8340439EF3" title="A LogMiner dictionary must be built into the redo data so that the LogMiner component of SQL Apply can properly interpret changes it sees in the redo.">重做数据</a>中的<a href="creating-oracle-data-guard-logical-standby.html#GUID-E5D227F2-C456-44F3-AEEA-2C8340439EF3" title="A LogMiner dictionary must be built into the redo data so that the LogMiner component of SQL Apply can properly interpret changes it sees in the redo.">构建字典</a>中<a href="creating-oracle-data-guard-logical-standby.html#GUID-E5D227F2-C456-44F3-AEEA-2C8340439EF3" title="必须在重做数据中内置LogMiner字典，以便SQL Apply的LogMiner组件可以正确解释它在重做中看到的更改。">生成的</a>重做需要多长时间才能传输到备用数据库，以及需要应用多少重做数据。如果未在主数据库上成功执行字典构建，则此命令永远不会完成。您可以通过发出来取消SQL语句<a id="d10791e1622" class="indexterm-anchor"></a><a id="d10791e1626" class="indexterm-anchor"></a>来自另一个SQL会话的<code class="codeph">ALTER DATABASE RECOVER MANAGED STANDBY DATABASE CANCEL</code>语句。
                           </p>
                           <div class="infoboxnote" id="GUID-715EBEC1-21B9-4DA9-80A5-ED58033F94C8__GUID-4B5A4365-5F88-4AAD-8F1E-DF9E45A5219A">
                              <p class="notep1">警告：</p>
                              <p>在之前的Oracle数据库<span class="italic">11克</span>的版本中，你需要你打开逻辑备用数据库之前创建一个新的密码文件。这不再需要。在逻辑备用数据库中创建新密码文件会导致重做传输服务无法正常工作。
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="SBYDB5023"></a><a id="SBYDB4739"></a><div class="props_rev_3"><a id="GUID-31F89C7C-174C-49E4-9A5E-3B9F538BD739" name="GUID-31F89C7C-174C-49E4-9A5E-3B9F538BD739"></a><h5 id="SBYDB-GUID-31F89C7C-174C-49E4-9A5E-3B9F538BD739" class="sect5"><span class="enumeration_section">4.2.4.2</span>调整逻辑备用数据库的初始化参数</h5>
                     <div>
                        <div class="section">
                           <div class="infoboxnote" id="GUID-31F89C7C-174C-49E4-9A5E-3B9F538BD739__GUID-B8EC917A-CE11-414F-8F36-3D612E811DA8">
                              <p class="notep1">注意：</p>
                              <p>如果您从Oracle RAC物理备用数据库开始，则将<code class="codeph">CLUSTER_DATABASE</code>设置回<code class="codeph">TRUE</code> ，如下所示：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER SYSTEM SET CLUSTER_DATABASE = TRUE SCOPE = SPFILE;</pre></div>
                           <p>在逻辑备用数据库上，关闭实例并发出<code class="codeph">STARTUP MOUNT</code>语句以启动并装入数据库。不要打开数据库;它应该对用户访问保持关闭，直到创建过程的后期。例如：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SHUTDOWN; SQL&gt; STARTUP MOUNT;</pre><p>您需要修改<code class="codeph">LOG_ARCHIVE_DEST_</code> <span class="italic"><code class="codeph">n</code></span>参数，因为与物理备用数据库不同，逻辑备用数据库是开放式数据库，可生成重做数据并具有多个日志文件（联机重做日志文件，归档重做日志文件和备用重做日志文件）。最好为以下各项指定单独的本地目的地：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>存档的重做日志文件，用于存储逻辑备用数据库生成的重做数据。在<a href="creating-oracle-data-guard-logical-standby.html#GUID-31F89C7C-174C-49E4-9A5E-3B9F538BD739__I87417">例4-2中</a> ，这被配置为<code class="codeph">LOG_ARCHIVE_DEST_1=LOCATION=/arch1/boston</code>目的地。
                                 </p>
                              </li>
                              <li>
                                 <p>存档的重做日志文件，用于存储从主数据库接收的重做数据。在<a href="creating-oracle-data-guard-logical-standby.html#GUID-31F89C7C-174C-49E4-9A5E-3B9F538BD739__I87417">例4-2中</a> ，这被配置为<code class="codeph">LOG_ARCHIVE_DEST_3=LOCATION=/arch2/boston</code>目的地。
                                 </p>
                              </li>
                           </ul>
                           <p><a href="creating-oracle-data-guard-logical-standby.html#GUID-31F89C7C-174C-49E4-9A5E-3B9F538BD739__I87417">例4-2</a>显示了为逻辑备用数据库修改的初始化参数。显示的参数在Boston逻辑备用数据库以主数据库角色或备用数据库角色运行时有效。
                           </p>
                           <div class="infoboxnote" id="GUID-31F89C7C-174C-49E4-9A5E-3B9F538BD739__GUID-8941C4D9-CA66-4639-8C05-D2E8AF4317AE">
                              <p class="notep1">注意：</p>
                              <p>如果数据库兼容性设置为11.1或更高版本，则可以使用快速恢复区域来存储远程存档日志。为此，您只需设置以下参数（假设您已设置<code class="codeph">DB_RECOVERY_FILE_DEST</code>和<code class="codeph">DB_RECOVERY_FILE_DEST_SIZE</code>参数）：</p><pre class="oac_no_warn" dir="ltr">LOG_ARCHIVE_DEST_1 ='LOCATION = USE_DB_RECOVERY_FILE_DEST DB_UNIQUE_NAME = boston'</pre><p>由于您使用的是快速恢复区域，因此无需指定<code class="codeph">VALID_FOR</code>参数。它的默认值是（ <code class="codeph">ALL_LOGFILES,ALL_ROLES</code> ），在这种情况下，这是所需的行为。<code class="codeph">LOG_ARCHIVE_DEST_1</code>用于所有日志文件，包括联机（主）和备用。
                              </p>
                           </div>
                           <p>下表描述了由<a href="creating-oracle-data-guard-logical-standby.html#GUID-31F89C7C-174C-49E4-9A5E-3B9F538BD739__I87417">示例4-2中</a>显示的初始化参数定义的归档处理。
                           </p>
                           <div class="tblformalwide" id="GUID-31F89C7C-174C-49E4-9A5E-3B9F538BD739__GUID-B07FCDBE-0319-41D0-B92F-2C10A2DF7765">
                              <table cellpadding="4" cellspacing="0" class="FormalWide" title="" width="100%" border="1" summary="This 3 column table describes the archival processing when the Boston database is in the primary and in the logical standby database role." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="30%" id="d10791e1804">的LOG_ARCHIVE_DEST_n</th>
                                       <th align="left" valign="bottom" width="33%" id="d10791e1807">当波士顿数据库以主要角色运行时</th>
                                       <th align="left" valign="bottom" width="37%" id="d10791e1810">当波士顿数据库以逻辑备用角色运行时</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="30%" id="d10791e1815" headers="d10791e1804 ">
                                          <p><code class="codeph">LOG_ARCHIVE_DEST_1</code></p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d10791e1815 d10791e1807 ">
                                          <p>指示将主数据库生成的重做数据从本地联机重做日志文件归档到<code class="codeph">/arch1/boston/</code>的本地归档重做日志文件。
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="37%" headers="d10791e1815 d10791e1810 ">
                                          <p>指示将逻辑备用数据库生成的重做数据从本地联机重做日志文件归档到<code class="codeph">/arch1/boston/</code>的本地归档重做日志文件。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="30%" id="d10791e1832" headers="d10791e1804 ">
                                          <p><code class="codeph">LOG_ARCHIVE_DEST_2</code></p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d10791e1832 d10791e1807 ">
                                          <p>指示将重做数据传输到远程逻辑备用数据库<code class="codeph">chicago</code> 。
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="37%" headers="d10791e1832 d10791e1810 ">
                                          <p>被忽略了;仅当<code class="codeph">boston</code>以主要角色运行时， <code class="codeph">LOG_ARCHIVE_DEST_2</code>才有效。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="30%" id="d10791e1852" headers="d10791e1804 ">
                                          <p><code class="codeph">LOG_ARCHIVE_DEST_3</code></p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d10791e1852 d10791e1807 ">
                                          <p>被忽略了;仅当<code class="codeph">boston</code>以备用角色运行时， <code class="codeph">LOG_ARCHIVE_DEST_3</code>才有效。
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="37%" headers="d10791e1852 d10791e1810 ">
                                          <p>指示将从主数据库接收的重做数据归档到<code class="codeph">/arch2/boston/</code>的本地归档重做日志文件。
                                          </p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <div class="infoboxnote" id="GUID-31F89C7C-174C-49E4-9A5E-3B9F538BD739__GUID-4D1D29EB-4F20-40D8-BDBE-FB85AC68CC9B">
                              <p class="notep1">注意：</p>
                              <p>将物理备用数据库转换为逻辑备用数据库后，不会<code class="codeph">DB_FILE_NAME_CONVERT</code>初始化参数。如有必要，请注册跳过处理程序，并通过将主数据库数据文件的路径名转换为备用数据文件路径名来为SQL Apply提供替换DDL字符串。有关<code class="codeph">SKIP</code>过程的信息，请参阅<a href="../arpls/DBMS_LOGSTDBY.html#ARPLS363" target="_blank"><code class="codeph">DBMS_LOGSTDBY</code></a>包。
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-31F89C7C-174C-49E4-9A5E-3B9F538BD739__I87417">
                           <p class="titleinexample">示例4-2修改逻辑备用数据库的初始化参数</p><pre class="oac_no_warn" dir="ltr">LOG_ARCHIVE_DEST_1 ='LOCATION = / arch1 / boston / VALID_FOR =（ONLINE_LOGFILES，ALL_ROLES）DB_UNIQUE_NAME = boston'LOG_ARCHIVE_DEST_2 ='SERVICE =芝加哥ASYNC VALID_FOR =（ONLINE_LOGFILES，PRIMARY_ROLE）DB_UNIQUE_NAME =芝加哥'LOG_ARCHIVE_DEST_3 ='LOCATION = / arch2 / boston / VALID_FOR =（STANDBY_LOGFILES，STANDBY_ROLE）DB_UNIQUE_NAME = boston'OGOG_ARCHIVE_DEST_STATE_1 = ENABLE LOG_ARCHIVE_DEST_STATE_2 = ENABLE LOG_ARCHIVE_DEST_STATE_3 = ENABLE</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div><a id="SBYDB4740"></a><div class="props_rev_3"><a id="GUID-68777C01-83F6-4CCF-9BA2-547ED180138D" name="GUID-68777C01-83F6-4CCF-9BA2-547ED180138D"></a><h4 id="SBYDB-GUID-68777C01-83F6-4CCF-9BA2-547ED180138D" class="sect4"><span class="enumeration_section">4.2.5</span>创建逻辑备用任务5：打开逻辑备用数据库</h4>
                  <div>
                     <p>使用<code class="codeph">ALTER DATABASE</code> SQL语句打开新创建的逻辑备用数据库。
                     </p>
                     <div class="section">
                        <p>例如，发出以下语句（如果使用<code class="codeph">KEEP</code> <code class="codeph">IDENTITY</code>选项创建逻辑备用数据库，则不提供<code class="codeph">RESETLOGS</code>选项）：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE OPEN RESETLOGS;</pre><div class="infoboxnote" id="GUID-68777C01-83F6-4CCF-9BA2-547ED180138D__GUID-F2C47D1B-C918-419C-9E78-8F5BE945DEBB">
                           <p class="notep1">注意：</p>
                           <p>如果您从Oracle RAC物理备用数据库开始，那么此时您可以启动所有其他备用实例。</p>
                        </div>
                        <div class="infoboxnote" id="GUID-68777C01-83F6-4CCF-9BA2-547ED180138D__GUID-B64C5B78-0AAA-4321-817F-B9460BEDAAF3">
                           <p class="notep1">警告：</p>
                           <p>如果要将逻辑备用数据库与主数据库放在同一计算机系统上，则必须在首次启动SQL Apply之前发出以下SQL语句，以便SQL Apply跳过在主数据库上执行的文件操作。这是必要的原因是SQL Apply可以访问与主数据库相同的目录结构，如果SQL Apply尝试重新执行某些特定于文件的操作，则可能会损坏属于主数据库的数据文件。</p><pre class="oac_no_warn" dir="ltr">SQL&gt; EXECUTE DBMS_LOGSTDBY.SKIP（'ALTER TABLESPACE'）;</pre><p>SQL Apply将忽略在将物理备用数据库与主数据库放在同一系统上时设置的<code class="codeph">DB_FILENAME_CONVERT</code>参数。有关<code class="codeph">DBMS_LOGSTDBY.SKIP</code>以及逻辑备用数据库上下文中的等效行为的信息，请参阅<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=ARPLS363" target="_blank"><span class="italic">Oracle数据库PL / SQL包和类型参考</span></a> 。
                           </p>
                        </div>
                        <p>由于这是第一次打开数据库，因此会自动调整数据库的全局名称以匹配新的<code class="codeph">DB_NAME</code>初始化参数。（如果使用<code class="codeph">KEEP</code> <code class="codeph">IDENTITY</code>选项创建逻辑备用数据库，则不是这样。）
                        </p>
                        <div class="infoboxnote" id="GUID-68777C01-83F6-4CCF-9BA2-547ED180138D__GUID-43C93E0C-DBE7-4812-9330-96376901BC11">
                           <p class="notep1">注意：</p>
                           <p>如果要创建逻辑备用数据库以执行Oracle数据库软件的滚动升级，并且您担心SQL Apply可能不支持的对象更新，那么Oracle建议您使用<code class="codeph">DBMS_LOGSTDBY</code> PL / SQL过程。在逻辑备用数据库中，运行以下过程以捕获信息并将其记录为<code class="codeph">DBA_LOGSTDBY_EVENTS</code>表中的事件：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_LOGSTDBY.APPLY_SET（'MAX_EVENTS_RECORDED'，DBMS_LOGSTDBY.MAX_EVENTS）; EXEC DBMS_LOGSTDBY.APPLY_SET（'RECORD_UNSUPPORTED_OPERATIONS'，'TRUE'）;</pre><p>这将捕获有关逻辑备用数据库不支持的主数据库上运行的任何事务的信息。升级完成后，在将生产切换到新版本之前，请检查此表。如果没有记录任何内容，那么你知道所有内容都被复制了。如果记录了某些内容，则可以选择采取纠正措施或放弃升级。</p>
                           <p><span class="bold">也可以看看：</span></p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="managing-oracle-data-guard-logical-standby-databases.html#GUID-D6EEF87A-211C-476C-9CBC-126858F7026A" title="可以将DBA_LOGSTDBY_EVENTS视图视为包含SQL Apply上下文中发生的最新有趣事件的循环日志。">自定义在DBA_LOGSTDBY_EVENTS查看记录事件</a>有关详细信息， <code class="codeph">DBA_LOGSTDBY_EVENTS</code>视图</p>
                              </li>
                              <li>
                                 <p>有关<code class="codeph">DBMS_LOGSTDBY</code>包的完整信息，请参阅<a href="../arpls/DBMS_LOGSTDBY.html#ARPLS363" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a></p>
                              </li>
                           </ul>
                        </div>
                        <p>发出以下语句以开始将重做数据应用于逻辑备用数据库：<a id="d10791e2062" class="indexterm-anchor"></a><a id="d10791e2068" class="indexterm-anchor"></a></p><pre class="oac_no_warn" dir="ltr">SQL&gt; <a id="d10791e2074" class="indexterm-anchor"></a><a id="d10791e2078" class="indexterm-anchor"></a><a id="d10791e2082" class="indexterm-anchor"></a> ALTER DATABASE START LOGICAL STANDBY立即申请;</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="SBYDB4741"></a><div class="props_rev_3"><a id="GUID-930CFC64-4EFD-4CF3-A5D0-062FBBD069E1" name="GUID-930CFC64-4EFD-4CF3-A5D0-062FBBD069E1"></a><h4 id="SBYDB-GUID-930CFC64-4EFD-4CF3-A5D0-062FBBD069E1" class="sect4"><span class="enumeration_section">4.2.6</span>创建逻辑备用任务6：验证逻辑备用数据库是否正常运行</h4>
                  <div>
                     <p>创建逻辑备用数据库后，验证它是否正常运行非常重要。</p>
                     <div class="section">
                        <p>请参阅以下主题：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p> <a href="oracle-data-guard-redo-transport-services.html#GUID-0EC71C7D-A80B-40AA-93E5-28BB7E24ED31" title="Oracle Data Guard配置要求配置和监视Oracle重做传输服务。">重做运输服务</a></p>
                           </li>
                           <li>
                              <p><a href="managing-oracle-data-guard-logical-standby-databases.html#GUID-4177C717-4244-4E33-ACE7-15D53EAB2443" title="了解这些概念将有助于您成功管理逻辑备用数据库。">管理逻辑备用数据库</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="SBYDB4742"></a><div class="props_rev_3"><a id="GUID-DC0A53BC-D29E-4878-BF3F-0AC4503AFA3C" name="GUID-DC0A53BC-D29E-4878-BF3F-0AC4503AFA3C"></a><h3 id="SBYDB-GUID-DC0A53BC-D29E-4878-BF3F-0AC4503AFA3C" class="sect3"><span class="enumeration_section">4.3</span>创建逻辑备用：创建后步骤</h3>
               <div>
                  <div class="section">
                     <div class="infoboxnote" id="GUID-DC0A53BC-D29E-4878-BF3F-0AC4503AFA3C__GUID-A811AFEC-58F3-443D-996E-AA3FEF5BC345">
                        <p class="notep1">注意：</p>
                        <p>物理备用数据库到逻辑备用数据库的转换分两个阶段进行：</p>
                        <ol>
                           <li>
                              <p>作为<code class="codeph">ALTER DATABASE RECOVER TO LOGICAL STANDBY</code>语句的一部分（除非已指定<code class="codeph">KEEP IDENTITY</code>子句），否则将<code class="codeph">ALTER DATABASE RECOVER TO LOGICAL STANDBY</code>的DBID。
                              </p>
                           </li>
                           <li>
                              <p>作为第一次成功调用<code class="codeph">ALTER DATABASE START LOGICAL STANDBY APPLY</code>语句的一部分，更新控制文件以使其与新创建的逻辑备用数据库的控制文件一致。
                              </p>
                              <p>成功调用<code class="codeph">ALTER DATABASE START LOGICAL STANDBY APPLY</code>语句后，请对逻辑备用数据库进行完整备份，因为从主数据库获取的备份不能用于还原逻辑备用数据库。
                              </p>
                           </li>
                        </ol>
                     </div>
                     <p>此时，逻辑备用数据库正在运行，可以提供最高性能级别的数据保护。以下列表描述了您可以对逻辑备用数据库进行的其他准备工作：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>升级数据保护模式</p>
                           <p>Oracle Data Guard配置最初设置为最高性能模式（默认值）。</p>
                        </li>
                        <li>
                           <p>启用闪回数据库</p>
                           <p>闪回数据库无需在故障转移后重新创建主数据库。闪回数据库使您能够在最近的某个时间将数据库返回到其状态，这比传统的时间点恢复快得多，因为它不需要从备份恢复数据文件，也不需要重做数据的广泛应用。您可以在主数据库，备用数据库或两者上启用闪回数据库。</p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-DC0A53BC-D29E-4878-BF3F-0AC4503AFA3C__GUID-B6358017-F28E-4EF0-AFD4-AC8617E35C79">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="examples-of-using-oracle-data-guard.html#GUID-1163448F-6B18-4A44-AA8D-7CDF0D1360FB" title="After a failover occurs, the original primary database can no longer participate in the Oracle Data Guard configuration until it is repaired and established as a standby database in the new configuration.">使用闪回数据库</a>和<a href="examples-of-using-oracle-data-guard.html#GUID-BAA5ED38-29A0-4E8D-8435-AA083D19C13E" title="If an error occurrs on the primary database in an Oracle Data Guard configuration in which the standby database is using real-time apply, then the same error is applied on the standby database. if Flashback Database is enabled, you can revert the primary and standby databases back to their pre-error condition.">使用闪回数据库</a> <a href="examples-of-using-oracle-data-guard.html#GUID-1163448F-6B18-4A44-AA8D-7CDF0D1360FB" title="发生故障转移后，原始主数据库无法再参与Oracle Data Guard配置，直到在新配置中将其修复并建立为备用数据库。">将失败的主数据库转换为备用数据库</a> <a href="examples-of-using-oracle-data-guard.html#GUID-BAA5ED38-29A0-4E8D-8435-AA083D19C13E" title="如果备用数据库使用实时应用的Oracle Data Guard配置中的主数据库发生错误，则在备用数据库上应用相同的错误。如果启用了闪回数据库，则可以将主数据库和备用数据库还原为其错误前的状态。">之后发布Open Resetlogs语句，</a>以了解如何在Oracle Data Guard环境中使用闪回数据库的方案。
                              </p>
                           </li>
                           <li>
                              <p>有关闪回数据库的详细信息，请参见<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=BRADV71000" target="_blank"><span class="italic">“Oracle数据库备份和恢复用户指南”</span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="SBYDB5139"></a><div class="props_rev_3"><a id="GUID-E2BB4836-32D1-4D57-9B32-75B1239170E2" name="GUID-E2BB4836-32D1-4D57-9B32-75B1239170E2"></a><h3 id="SBYDB-GUID-E2BB4836-32D1-4D57-9B32-75B1239170E2" class="sect3"><span class="enumeration_section">4.4</span>创建CDB的逻辑备用</h3>
               <div>
                  <p>您可以创建多租户容器数据库（CDB）的逻辑备用数据库，就像创建常规主数据库的逻辑备用数据库一样。</p>
                  <p>以下是在创建和使用CDB的逻辑备用数据库时需要注意的一些行为差异：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>数据库角色在CDB级别定义，而不是在可插拔数据库（PDB）容器级别定义。</p>
                     </li>
                     <li>
                        <p>如果执行切换或故障转移操作，则整个CDB将进行角色更改。</p>
                     </li>
                     <li>
                        <p>与角色更改相关的任何DDL必须在连接到CDB的根容器时执行。</p>
                     </li>
                     <li>
                        <p>与常规逻辑备用数据库一样，CDB的逻辑备用数据库操作单个进程池，用于挖掘重做流一次，但共享责任以更新所有PDB和CDB的根容器。</p>
                     </li>
                     <li>
                        <p>您不需要在主服务器和备用服务器上拥有相同的PDB集。但是，仅复制主数据库和备用数据库中同一容器中存在的表。</p>
                     </li>
                     <li>
                        <p>通常，在根容器中执行修改全局配置属性的逻辑备用PL / SQL接口，例如<code class="codeph">DBMS_LOGSTDBY.APPLY_SET</code> 。然而， <code class="codeph">DBMS_LOGSTDBY.INSTANTIATE_TABLE</code>必须调用其中感兴趣的表所在的容器内，并<code class="codeph">DBMS_LOGSTDBY.SKIP</code>程序必须调用感兴趣的容器内。</p>
                     </li>
                     <li>
                        <p>增强了逻辑备用视图以在适当的位置提供容器名称。许多DBA视图都有类似的CDB视图，其名称以CDB开头。例如，视图<code class="codeph">CDB_LOGSTDBY_NOT_UNIQUE</code>包含与<code class="codeph">DBA_LOGSTDBY_NOT_UNIQUE</code>视图中显示的数据相同的数据，但它有一个指示PDB名称的附加列。在根中查询<code class="codeph">CDB_LOGSTDBY_NOT_UNIQUE</code>视图时，它显示CDB中所有数据库的数据。</p>
                     </li>
                     <li>
                        <p>在CDB的逻辑备用数据库中，SQL语句的语法通常与非容器数据库的语法相同。但是，某些声明（包括以下声明）的效果可能会有所不同：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">ALTER DATABASE RECOVER TO LOGICAL STANDBY</code>仅在CDB中起作用;它不允许在PDB中使用。</p>
                           </li>
                           <li>
                              <p>角色与整个CDB相关联;个人PDB没有自己的角色。因此，与逻辑备用数据库关联的以下角色更改DDL会影响整个CDB：</p>
                              <p><code class="codeph">ALTER DATABASE [PREPARE | COMMIT]切换到SWITCHOVER</code> 
                              </p>
                              <p><code class="codeph">ALTER DATABASE激活LOGICAL STANDBY</code> 
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">ALTER DATABASE [START|STOP] LOGICAL STANDBY APPLY</code>仅在根容器中起作用并影响整个CDB。 PDB上不允许使用此声明。</p>
                           </li>
                           <li>
                              <p><code class="codeph">ALTER DATABASE GUARD</code>仅在根容器中起作用并影响整个CDB。例如，如果发出<code class="codeph">ALTER DATABASE GUARD ALL</code>语句，则根目录和所有PDB中的用户活动将受到限制。
                              </p>
                           </li>
                           <li>
                              <p>要管理多租户环境，您必须具有<code class="codeph">CDB_DBA</code>角色。
                              </p>
                           </li>
                        </ul>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-E2BB4836-32D1-4D57-9B32-75B1239170E2__GUID-22CA4301-DC88-4EC8-A090-D7966107018F">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>有关CDB的更多信息，请参见<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=CNCPT89249" target="_blank"><span class="italic">Oracle数据库概念</span></a></p>
                        </li>
                        <li>
                           <p>有关在容器中使用<code class="codeph">DBMS_LOGSTDBY.SKIP</code>过程的详细信息，请参阅<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=ARPLS66850" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a></p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>