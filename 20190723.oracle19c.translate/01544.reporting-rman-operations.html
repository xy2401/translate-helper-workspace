<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>报告RMAN操作</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96241-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="part-managing-rman-backups.html" title="Previous" type="text/html"></link>
      <link rel="next" href="maintaining-rman-backups.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="BRADV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="part-managing-rman-backups.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="maintaining-rman-backups.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复用户指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-managing-rman-backups.html" property="item" typeof="WebPage"><span property="name">管理RMAN备份</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">报告RMAN操作</li>
            </ol>
            <a id="GUID-550638CC-0D16-4B1A-83C7-5D10181DC7C1" name="GUID-550638CC-0D16-4B1A-83C7-5D10181DC7C1"></a><a id="BRADV8004"></a>
            
            <h2 id="BRADV-GUID-550638CC-0D16-4B1A-83C7-5D10181DC7C1" class="sect2"><span class="enumeration_chapter">11</span>报告RMAN运营</h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d53814e69" class="indexterm-anchor"></a><a id="d53814e73" class="indexterm-anchor"></a><a id="d53814e75" class="indexterm-anchor"></a>本章介绍如何报告RMAN操作。本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="reporting-rman-operations.html#GUID-AAAE5ACE-EE63-4AD1-8F63-B0F4F6F1D1B2" title="作为备份和恢复策略的一部分，您应定期运行指示已备份内容的报告。您可以确定哪些数据文件需要备份或哪些文件最近未备份。此外，您还可以预览出现问题时RMAN必须还原的备份。RMAN存储执行操作的每个数据库的元数据。在Data Guard环境中，您可以在不使用Data Guard时使用LIST，REPORT和SHOW命令。您可以使用FOR DB_UNIQUE_NAME子句运行这些命令，以显示与指定数据库关联的备份。">RMAN报告概述</a></p>
                  </li>
                  <li>
                     <p><a href="reporting-rman-operations.html#GUID-1B911001-C106-4267-9265-F649946DBF52" title="LIST命令使用RMAN存储库中的信息来提供备份列表以及与备份和恢复相关的其他对象。">列出备份和恢复相关对象</a></p>
                  </li>
                  <li>
                     <p><a href="reporting-rman-operations.html#GUID-A1FDD9FE-74B8-4146-AFC4-6BD5402C8B5D" title="RMAN REPORT命令分析可用备份和数据库。">报告备份和数据库架构</a></p>
                  </li>
                  <li>
                     <p><a href="reporting-rman-operations.html#GUID-9E60E2AC-6667-49B5-9D31-6480BEF026B9" title="在某些情况下，V $视图通过使用LIST和REPORT命令提供不可用的信息。">使用V $视图查询备份元数据</a></p>
                  </li>
                  <li>
                     <p><a href="reporting-rman-operations.html#GUID-C48F1F48-E11D-4DA4-AB54-6D7EB4CA8957" title="LIST，REPORT和SHOW命令提供了访问控制文件和恢复目录中数据的最简单方法。">查询恢复目录视图</a></p>
                  </li>
               </ul>
            </div><a id="BRADV8135"></a><div class="props_rev_3"><a id="GUID-AAAE5ACE-EE63-4AD1-8F63-B0F4F6F1D1B2" name="GUID-AAAE5ACE-EE63-4AD1-8F63-B0F4F6F1D1B2"></a><h3 id="BRADV-GUID-AAAE5ACE-EE63-4AD1-8F63-B0F4F6F1D1B2" class="sect3"><span class="enumeration_section">11.1</span> RMAN报告概述</h3>
               <div>
                  <p>本节介绍RMAN报告的目的和基本概念。</p>
               </div><a id="BRADV89582"></a><div class="props_rev_3"><a id="GUID-0FC15229-684C-4279-8E60-CC0B4079FB5F" name="GUID-0FC15229-684C-4279-8E60-CC0B4079FB5F"></a><h4 id="BRADV-GUID-0FC15229-684C-4279-8E60-CC0B4079FB5F" class="sect4"><span class="enumeration_section">11.1.1</span> RMAN报告的目的</h4>
                  <div>
                     <p>作为备份和恢复策略的一部分，您应定期运行指示已备份内容的报告。您可以确定哪些数据文件需要备份或哪些文件最近未备份。此外，您还可以预览出现问题时RMAN必须还原的备份。</p>
                     <p>备份和恢复的另一个重要方面是监视空间使用情况。如果备份到磁盘，则磁盘可能会填满，这可能会导致性能问题甚至导致数据库停止。您可以使用RMAN确定备份是否为<a href="glossary.html#GUID-A4D8B0BE-D3B9-4DD9-A7B3-BC0D88D25DC0"><span class="xrefglossterm">过时备份</span></a> ，因此可以删除。
                     </p>
                     <p>您可能还需要获取有关RMAN作业的历史信息。例如，您可能想知道已发出了多少备份作业，每个备份作业的状态（例如，是否失败或已完成），作业何时开始和完成，以及执行了哪种类型的备份。</p>
                  </div>
               </div><a id="BRADV89583"></a><div class="props_rev_3"><a id="GUID-1C655AF1-B3CD-452C-BC3C-A566912311FF" name="GUID-1C655AF1-B3CD-452C-BC3C-A566912311FF"></a><h4 id="BRADV-GUID-1C655AF1-B3CD-452C-BC3C-A566912311FF" class="sect4"><span class="enumeration_section">11.1.2</span> RMAN报告的基本概念</h4>
                  <div>
                     <p>RMAN存储执行操作的每个数据库的元数据。</p>
                     <p>RMAN始终将其RMAN元数据存储库存储在目标数据库的控制文件中。例如，假设您使用RMAN备份<code class="codeph">prod1</code>和<code class="codeph">prod2</code>数据库。RMAN存储元数据的备份<code class="codeph">prod1</code>在控制文件<code class="codeph">prod1</code> ，以及用于备份的元数据<code class="codeph">prod2</code>在控制文件<code class="codeph">prod2</code> 。
                     </p>
                     <p>（可选）您可以将RMAN与<a href="glossary.html#GUID-CBFA8015-2DFF-42B1-A818-D6C5B92C608F"><span class="xrefglossterm">恢复目录一起使用</span></a> 。在这种情况下，RMAN在单独的<a href="glossary.html#GUID-C54D9858-2461-412B-95FF-80FBACD58AB0"><span class="xrefglossterm">恢复目录数据库</span></a>中的一组表中维护另一个元数据存储<a href="glossary.html#GUID-C54D9858-2461-412B-95FF-80FBACD58AB0"><span class="xrefglossterm">库</span></a> 。例如，您可以在<code class="codeph">prod3</code>创建恢复目录。您可以在此恢复目录中注册多个目标数据库。例如，如果您注册<code class="codeph">prod1</code>和<code class="codeph">prod2</code>存储在恢复目录<code class="codeph">prod3</code> ，然后约其备份RMAN将元数据存储<code class="codeph">prod1</code>和<code class="codeph">prod2</code>在<a href="glossary.html#GUID-3EF7A531-FA6D-483B-AE34-F87D31DCE572"><span class="xrefglossterm">恢复目录架构</span></a> 。
                     </p>
                     <p>下表列出了用于从RMAN存储库访问元数据的技术。</p>
                     <div class="tblformal" id="GUID-1C655AF1-B3CD-452C-BC3C-A566912311FF__GUID-A84C150E-9505-45B2-A3A2-F08486E336C2">
                        <p class="titleintable">表11-1从RMAN存储库访问数据的技术</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="从RMAN存储库访问数据的技术" border="1" summary="This table describes the techniques available for accessing data from the RMAN repository." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="20%" id="d53814e476">技术</th>
                                 <th align="left" valign="bottom" width="20%" id="d53814e478">描述</th>
                                 <th align="left" valign="bottom" width="20%" id="d53814e480">附加信息</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d53814e484" headers="d53814e476 ">
                                    <p>RMAN <code class="codeph">LIST</code>和<code class="codeph">REPORT</code>命令</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d53814e484 d53814e478 ">
                                    <p>RMAN <code class="codeph">LIST</code>和<code class="codeph">REPORT</code>命令提供有关可用备份的详细信息，以及如何使用它们来还原和恢复数据库。
                                    </p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d53814e484 d53814e480 ">
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><span class="q">“ <a href="reporting-rman-operations.html#GUID-1B911001-C106-4267-9265-F649946DBF52" title="LIST命令使用RMAN存储库中的信息来提供备份列表以及与备份和恢复相关的其他对象。">列出备份和恢复相关对象</a> ”</span></p>
                                       </li>
                                       <li>
                                          <p><span class="q">“ <a href="reporting-rman-operations.html#GUID-A1FDD9FE-74B8-4146-AFC4-6BD5402C8B5D" title="RMAN REPORT命令分析可用备份和数据库。">报告备份和数据库架构</a> ”</span></p>
                                       </li>
                                       <li>
                                          <p><a href="../rcmrf/LIST.html#RCMRF132" target="_blank"><span><cite>Oracle数据库备份和恢复参考中的</cite></span></a> <code class="codeph">LIST</code> ， <code class="codeph">REPORT</code>和<code class="codeph">RESTORE</code>命令 
                                          </p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d53814e544" headers="d53814e476 ">
                                    <p><code class="codeph">V$</code>观看次数</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d53814e544 d53814e478 ">
                                    <p>数据库打开时，多个<code class="codeph">V$</code>视图可以直接访问每个目标数据库的控制文件中的RMAN存储库记录。
                                    </p>
                                    <p>某些<code class="codeph">V$</code>视图（如<code class="codeph">V$DATAFILE_HEADER</code> ， <code class="codeph">V$PROCESS</code>和<code class="codeph">V$SESSION</code>包含恢复目录视图中未找到的信息。
                                    </p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d53814e544 d53814e480 ">
                                    <p><a href="../refrn/dynamic-performance-v-views-1.html#REFRN-GUID-A634ED26-2334-40F5-A016-22973F54BEDA" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d53814e577" headers="d53814e476 ">
                                    <p><code class="codeph">RC_</code>观点</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d53814e577 d53814e478 ">
                                    <p>如果数据库已在恢复目录中注册，则<code class="codeph">RC_</code>视图可直接访问存储在恢复目录中的RMAN存储库数据。
                                    </p>
                                    <p><code class="codeph">RC_</code>视图主要对应于<code class="codeph">V$</code>视图。
                                    </p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d53814e577 d53814e480 ">
                                    <p><a href="../rcmrf/recovery-catalog-views.html#RCMRF003" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d53814e604" headers="d53814e476 ">
                                    <p><code class="codeph">恢复......PREVIEW</code>和<code class="codeph">RESTORE ...VALIDATE HEADER</code>命令</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d53814e604 d53814e478 ">
                                    <p>这些命令列出了RMAN可以还原到指定时间的备份。</p>
                                    <p><code class="codeph">恢复......PREVIEW</code>查询元数据但不读取备份文件。<code class="codeph">RESTORE ...VALIDATE HEADER</code>命令执行相同的工作，但除了列出还原和恢复操作所需的文件之外，该命令还验证备份文件头以确定磁盘上或介质管理目录中的文件是否与RMAN存储库中的元数据相对应。
                                    </p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d53814e604 d53814e480 ">
                                    <p><span class="q">“ <a href="rman-complete-database-recovery.html#GUID-8837082E-3409-4D00-9836-3B9617720349" title="预览备份可帮助您确保还原和恢复操作所需的所有备份都可用。">预览还原操作中使用的备份</a> ”</span>中介绍了这些命令</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>RMAN存储库有时无法反映磁盘和磁带上的实际情况。例如，用户可以使用操作系统实用程序删除备份，以便RMAN存储库错误地将备份报告为可用。您可以使用<code class="codeph">CHANGE</code> ， <code class="codeph">CROSSCHECK</code>和<code class="codeph">DELETE</code>等命令更新RMAN存储库以反映可用备份的实际状态。否则，命令和视图的输出可能会产生误导，这意味着RMAN可能无法找到要还原和恢复数据库的备份。
                     </p>
                     <div class="infoboxnotealso" id="GUID-1C655AF1-B3CD-452C-BC3C-A566912311FF__GUID-37B22BAE-190E-4F12-8F03-544F873C9DD3">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="maintaining-rman-backups.html#GUID-EFF8F8D1-D67C-4202-9C8E-DE74ADFF1FFB" title="要确保恢复目录或控制文件中的备份数据与磁盘上或介质管理目录中的相应数据同步，请执行交叉检查。CROSSCHECK命令仅对当前记录在RMAN存储库中的文件进行操作。">交叉检查RMAN存储库</a>以了解如何使RMAN存储库保持最新状态</p>
                           </li>
                           <li>
                              <p><a href="maintaining-rman-backups.html#GUID-F5C3D045-279B-4AB3-8A91-3231A716402C" title="建议的维护策略是配置快速恢复区域，备份保留策略和归档重做日志删除策略。在这种情况下，数据库会根据需要自动维护和删除备份和归档重做日志。但是，有时需要手动维护数据库备份和归档重做日志。RMAN提供多个命令来维护RMAN备份和存储库记录。RMAN始终将其元数据存储在其执行操作的每个目标数据库的控制文件中。如果在恢复目录中注册目标数据库，则RMAN会将此目标数据库的元数据存储在恢复目录中。创建备份或副本的Data Guard环境中的数据库与该文件相关联。例如，如果RMAN连接到目标数据库standby1并备份它，则此备份与standby1关联。对于交叉检查，RMAN只能在连接到与文件关联的数据库时将文件状态从AVAILABLE更新为EXPIRED。RMAN可以在连接到任何数据库时删除文件。如果RMAN未作为TARGET连接到与文件关联的数据库，并且RMAN无法成功删除文件，则RMAN会提示您将TARGET连接到与该文件关联的数据库。然后你必须使用DELETE ...FORCE删除文件元数据。如果维护命令仅更改RMAN元数据，则可以将RMAN作为TARGET连接到Data Guard环境中的任何数据库。除非您明确使用CHANGE，否则备份仍与数据库关联...RESET DB_UNIQUE_NAME将备份与其他数据库关联。RMAN旨在在没有恢复目录的情况下工作。但是，如果选择不使用恢复目录，则每个目标数据库的控制文件都是RMAN元数据的独占存储库。控制文件包含两种类型的记录：循环重用记录和非圆形重用记录。当包含有关在快速恢复区域中创建的文件的信息的控制文件记录即将被重用时，数据库尝试在文件有资格删除时从快速恢复区域中删除该文件。否则，数据库会扩展包含此文件记录的控制文件部分的大小。防止因覆盖控制文件记录而丢失RMAN元数据的最佳方法是使用恢复目录。如果您没有使用恢复目录来存储RMAN元数据，那么保护每个目标数据库控制文件是非常重要的。虽然快速恢复区域主要是自我管理，但某些情况可能需要数据库管理干预。RMAN使用某些规则来确定何时可以从快速恢复区域删除文件。您可以使用V $ RECOVERY_FILE_DEST和V $ RECOVERY_AREA_USAGE视图来确定是否为快速恢复区域分配了足够的空间。除了设置闪回保留目标或使用保证还原点之外，您无法直接管理快速恢复区域中的闪回日志。如果RMAN保留策略要求保留一组大于快速恢复区磁盘配额的备份，或者保留策略设置为NONE，则快速恢复区域可以完全填充，没有可回收空间。使用ALTER SYSTEM命令更改快速恢复区域的位置。ALTER SYSTEM命令可用于禁用快速恢复区域。通常，快速恢复区域是自我维护的。但是，当在快速恢复区域中创建文件期间实例崩溃时，数据库可能会将文件保留在快速恢复区域中。某些情况可能会导致存储库与其记录的文件之间出现差异，包括磁带或磁盘故障以及用户管理的副本或RMAN相关文件的删除。要确保恢复目录或控制文件中的备份数据与磁盘上或介质管理目录中的相应数据同步，请执行交叉检查。CROSSCHECK命令仅对当前记录在RMAN存储库中的文件进行操作。交叉检查更新过期的RMAN存储库信息，该信息与存储库记录与其物理状态不匹配的备份有关。例如，如果用户使用操作系统命令从磁盘中删除存档日志，则存储库仍会指示日志位于磁盘上，而实际上并非如此。连接到目标数据库和恢复目录（如果使用）后，根据需要运行CROSSCHECK命令以验证RMAN已知的备份的状态和可用性。您可以使用LIST命令报告备份，然后使用CROSSCHECK命令检查LIST输出中描述的特定备份是否仍然存在。使用CROSSCHECK命令验证RMAN.RMAN已知的预刷新备份和预刷新归档重做日志文件的状态和可用性，提供了多种更改备份和副本的存储库状态的方法。运行CHANGE ...无法找到备份或已异地迁移时的UNAVAILABLE命令。您可以将备份指定为免除保留策略。此技术对于归档备份以满足业务要求非常有用。将CHANGE命令与GUID选项一起使用可更改与从多租户容器数据库（CDB）中删除的可插拔数据库（PDB）对应的备份的状态。使用CHANGE命令可以修改预存储备份和预存储存档重做日志文件的存储库状态。您可以使用CATALOG命令使RMAN知道存储库中未记录的存档日志的存在，或者通过RMAN以外的方式创建的数据库文件的副本。目标数据库控制文件保留目标数据库和所有RMAN备份生成的所有归档重做日志的记录。CATALOG命令的目的是在没有要管理的RMAN文件记录时将元数据添加到存储库。使用CATALOG命令将有关用户管理的副本的信息传播到RMAN存储库。对文件进行编目后，可以运行LIST命令或查询V $ BACKUP_FILES视图以确认信息包含在RMAN存储库中。您可以在磁盘上编目备份片段。如果使用操作系统实用程序将备份片段从一个位置复制到同一主机上的另一个位置，或从一个主机复制到另一个主机，则此技术非常有用。如果使用自动存储管理（ASM），Oracle托管文件框架或快速恢复区域，则可能需要重新编目磁盘管理系统已知但不再列在RMAN存储库中的文件。当用于跟踪文件名的预期机制因介质故障，软件错误或用户错误而失败时，可能会发生这种情况。使用CATALOG命令将preplugin归档重做日志文件添加到RMAN存储库。您可以从RMAN存储库中删除文件的记录。你可以使用CHANGE ...UNCATALOG命令更新缺少文件的RMAN存储库。您可以使用RMAN DELETE命令删除存档的重做日志和RMAN备份。每个RMAN备份在RMAN存储库中生成相应的记录。该记录存储在控制文件中。如果使用了恢复目录，则在从控制文件重新同步恢复目录后，也可以在恢复目录中找到该记录。您可以删除备份的备份和恢复目录记录。建议的维护策略是配置快速恢复区域，备份保留策略和归档重做日志删除策略。使用RMAN DELETE命令删除备份和映像副本。你可以同时使用DELETE和BACKUP ......删除命令以删除特定备份和副本。你可以使用BACKUP ......删除以备份存档的重做日志，数据文件副本或备份集，然后在成功备份后删除输入文件。如果您运行CROSSCHECK，并且RMAN无法找到文件，则它会将RMAN存储库中的记录更新为EXPIRED状态。然后，您可以使用DELETE EXPIRED命令从RMAN存储库中删除过期备份和副本的记录。RMAN DELETE命令支持OBSOLETE选项，该选项删除不再需要的备份以满足指定的可恢复性要求。使用带有GUID选项的DELETE命令可以删除已从多租户容器数据库（CDB）中删除的可插拔数据库（PDB）的备份。使用DELETE命令删除预制备份备份和prelplugin存档重做日志文件。要从操作系统中删除数据库，可以在RMAN中使用DROP DATABASE命令。 RMAN删除服务器参数文件，所有数据文件，联机重做日志和属于目标数据库的控制文件。">维护RMAN备份和存储库记录</a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV89584"></a><div class="props_rev_3"><a id="GUID-06F4023A-3517-4BDB-BEA3-1E7186A5492D" name="GUID-06F4023A-3517-4BDB-BEA3-1E7186A5492D"></a><h4 id="BRADV-GUID-06F4023A-3517-4BDB-BEA3-1E7186A5492D" class="sect4"><span class="enumeration_section">11.1.3</span>在Data Guard环境中报告</h4>
                  <div>
                     <p>在Data Guard环境中，您可以在不使用Data Guard时使用<code class="codeph">LIST</code> ， <code class="codeph">REPORT</code>和<code class="codeph">SHOW</code>命令。您可以使用<code class="codeph">FOR DB_UNIQUE_NAME</code>子句运行这些命令，以显示与指定数据库关联的备份。
                     </p>
                     <div class="section">
                        <p>如<span class="q">“ <a href="rman-architecture.html#GUID-E514F9D2-D96E-4087-B8C5-5A8EB6A44E6B" title="RMAN使用恢复目录来跟踪Data Guard环境中所有数据库文件的文件名。">关于Data Guard环境中的RMAN文件管理”中所述</a></span> ，每个备份都与创建它的主数据库或备用数据库相关联。例如，如果使用<code class="codeph">standby1</code>的<code class="codeph">DB_UNIQUE_NAME</code>备份数据库，则<code class="codeph">standby1</code>数据库与此备份关联。
                        </p>
                        <p>例如，以下命令列出仅与<code class="codeph">sfstandby</code>关联的归档重做日志：</p><pre class="pre codeblock"><code>列出ARCHIVELOG ALL FOR DB_UNIQUE_NAME sfstandby;</code></pre><p>如果在Data Guard环境中使用<code class="codeph">LIST</code> ， <code class="codeph">REPORT</code>和<code class="codeph">SHOW</code>命令<span class="italic">而未</span>指定<code class="codeph">FOR DB_UNIQUE_NAME</code>子句，则RMAN将显示目标数据库可访问的文件。 <span class="q">“ <a href="rman-architecture.html#GUID-3DDC5739-0A55-4F04-BE4C-4705E300C87F" title="恢复目录通过将每个数据库文件或备份文件与DB_UNIQUE_NAME相关联来跟踪Data Guard环境中的文件。创建文件的数据库与该文件相关联。">关于Data Guard环境中的备份关联</a> ”</span>解释了RMAN何时可以访问备份。</p>
                        <p>在Data Guard环境中，必须将RMAN与恢复目录一起使用。RMAN将所有备份和恢复文件的元数据存储在恢复目录中的Data Guard环境中。运行RMAN报告命令时，可以将RMAN作为<code class="codeph">TARGET</code>连接到已装入或已打开的数据库，也可以使用<code class="codeph">SET DBID</code>命令识别数据库。
                        </p>
                        <div class="infoboxnotealso" id="GUID-06F4023A-3517-4BDB-BEA3-1E7186A5492D__GUID-5A2B1EA5-91EA-44DA-B934-1A2D9D01597D">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span><cite>Oracle Data Guard概念和管理，</cite></span></a>用于报告Data Guard环境中的RMAN操作</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV8136"></a><div class="props_rev_3"><a id="GUID-1B911001-C106-4267-9265-F649946DBF52" name="GUID-1B911001-C106-4267-9265-F649946DBF52"></a><h3 id="BRADV-GUID-1B911001-C106-4267-9265-F649946DBF52" class="sect3"><span class="enumeration_section">11.2</span>列出备份和恢复相关对象</h3>
               <div>
                  <p><code class="codeph">LIST</code>命令使用RMAN存储库中的信息来提供备份列表以及与备份和恢复相关的其他对象。
                  </p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="reporting-rman-operations.html#GUID-2CD81DF5-F74C-43E1-A202-23D8811BB098" title="LIST命令的主要用途是列出备份和副本。">关于LIST命令</a></p>
                     </li>
                     <li>
                        <p><a href="reporting-rman-operations.html#GUID-EBE4B021-273E-4208-97FC-AA1F2AE092FF" title="使用listObjList或recordSpec子句指定所需的对象。如果未指定对象，则RMAN将显示所有数据库文件和归档重做日志文件的副本。">列出所有备份和副本</a></p>
                     </li>
                     <li>
                        <p><a href="reporting-rman-operations.html#GUID-27C4AD72-0556-4388-AD65-8224C49E388F" title="您可以指定几个不同的条件来缩小LIST输出。">列出所选备份和副本</a></p>
                     </li>
                     <li>
                        <p><a href="reporting-rman-operations.html#GUID-1019A5BE-C3A0-4036-86E3-017F6E620A7D" title="使用LIST命令列出预包装备份和预刷新存档的重做日志文件。">列出Preplugin备份</a></p>
                     </li>
                     <li>
                        <p><a href="reporting-rman-operations.html#GUID-D46FAC21-3514-4A6D-967A-BDEA5E9CB0EB" title="每次在数据库上执行OPEN RESETLOGS操作时，此操作都会创建数据库的新版本。">列出数据库化身</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV274"></a><a id="BRADV275"></a><a id="BRADV89585"></a><div class="props_rev_3"><a id="GUID-2CD81DF5-F74C-43E1-A202-23D8811BB098" name="GUID-2CD81DF5-F74C-43E1-A202-23D8811BB098"></a><h4 id="BRADV-GUID-2CD81DF5-F74C-43E1-A202-23D8811BB098" class="sect4"><span class="enumeration_section">11.2.1</span>关于LIST命令</h4>
                  <div>
                     <p><code class="codeph">LIST</code>命令的主要用途是列出备份和副本。
                     </p>
                     <p>例如，您可以列出：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>数据库，表空间，数据文件，归档重做日志或控制文件的备份和代理副本</p>
                        </li>
                        <li>
                           <p>备份已过期</p>
                        </li>
                        <li>
                           <p>备份受时间，路径名称，设备类型，标记或可恢复性的限制</p>
                        </li>
                        <li>
                           <p>存档的重做日志文件和磁盘副本</p>
                        </li>
                     </ul>
                     <p>除备份和副本外，RMAN还可以列出其他类型的数据。下表总结了您可以列出的几个有用的对象。</p>
                     <div class="tblformal" id="GUID-2CD81DF5-F74C-43E1-A202-23D8811BB098__CIHCGEIG">
                        <p class="titleintable">表11-2 LIST对象</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="列表对象" width="100%" border="1" summary="This table describes options for the LIST command and list contents. " frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" id="d53814e1238">列表的内容</th>
                                 <th align="left" valign="bottom" id="d53814e1241">命令</th>
                                 <th align="left" valign="bottom" id="d53814e1244">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d53814e1249" headers="d53814e1238 ">
                                    <p>备份集和代理副本</p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1249 d53814e1241 ">
                                    <p><code class="codeph">列表备份</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1249 d53814e1244 ">
                                    <p>您可以列出数据库，表空间，数据文件，归档重做日志，控制文件或服务器参数文件的所有备份集，副本和代理副本。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d53814e1260" headers="d53814e1238 ">
                                    <p>图像副本</p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1260 d53814e1241 ">
                                    <p><code class="codeph">列表复制</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1260 d53814e1244 ">
                                    <p>您可以列出数据文件副本和归档重做日志文件。默认情况下， <code class="codeph">LIST COPY</code>显示所有数据库文件和归档重做日志的副本。可用和不可用的映像副本都包含在输出中，即使是那些无法还原或过期或不可用的映像副本。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d53814e1274" headers="d53814e1238 ">
                                    <p>存档的重做日志文件</p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1274 d53814e1241 ">
                                    <p><code class="codeph">列表ARCHIVELOG</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1274 d53814e1244 ">
                                    <p>您可以列出存档重做日志文件。您可以列出所有存档日志重做日志文件，也可以通过SCN，时间或序列号范围指定各个存档日志文件。如果指定范围，则可以通过指定化身编号进一步限制返回的列表。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d53814e1285" headers="d53814e1238 ">
                                    <p>预备份备份</p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1285 d53814e1241 ">
                                    <p><code class="codeph">列表......PREPLUGIN</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1285 d53814e1244 ">
                                    <p></p>
                                    <p>您可以列出所有预备份备份和预打印归档重做日志文件。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d53814e1297" headers="d53814e1238 ">
                                    <p>数据库化身</p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1297 d53814e1241 ">
                                    <p><code class="codeph">列出INCARNATION</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1297 d53814e1244 ">
                                    <p>您可以列出数据库的所有化身。使用<code class="codeph">RESETLOGS</code>选项打开时，将创建新的数据库<a href="glossary.html#GUID-4CCAB7DD-FEA7-4237-AF2C-304BA3BD52B1"><span class="xrefglossterm">化身</span></a> 。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d53814e1314" headers="d53814e1238 ">
                                    <p>Data Guard环境中的数据库</p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1314 d53814e1241 ">
                                    <p><code class="codeph">列出DB_UNIQUE_NAME</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1314 d53814e1244 ">
                                    <p>Data Guard环境中的数据库通过其<code class="codeph">DB_UNIQUE_NAME</code>初始化参数设置进行区分。您可以列出具有相同DBID的所有数据库。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d53814e1328" headers="d53814e1238 ">
                                    <p>Data Guard环境中主数据库或备用数据库的备份和副本</p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1328 d53814e1241 ">
                                    <p><code class="codeph">列表......FOR DB_UNIQUE_NAME</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1328 d53814e1244 ">
                                    <p>您可以在Data Guard环境中列出指定数据库的所有备份和副本，也可以列出环境中的所有数据库。</p>
                                    <p>RMAN将输出限制为使用指定的<code class="codeph">DB_UNIQUE_NAME</code>专门与数据库关联的文件或对象。例如，您可以将<code class="codeph">LIST</code>与<code class="codeph">FOR DB_UNIQUE_NAME</code>一起使用，以显示与特定备用数据库或主数据库关联的已归档重做日志文件的列表。未列出任何数据库不拥有的对象（恢复目录视图中的<code class="codeph">SITE_KEY</code>列为空）。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d53814e1353" headers="d53814e1238 ">
                                    <p>还原点</p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1353 d53814e1241 ">
                                    <p><code class="codeph">列表恢复点</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1353 d53814e1244 ">
                                    <p>您可以列出RMAN存储库已知的还原点。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d53814e1364" headers="d53814e1238 ">
                                    <p>存储脚本的名称</p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1364 d53814e1241 ">
                                    <p><code class="codeph">列表脚本名称</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1364 d53814e1244 ">
                                    <p>您可以列出使用<code class="codeph">CREATE SCRIPT</code>或<code class="codeph">REPLACE SCRIPT</code>命令创建的恢复目录脚本的名称。需要恢复目录。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d53814e1381" headers="d53814e1238 ">
                                    <p>无法与<a href="glossary.html#GUID-5E618F7B-127F-4BE2-9ED5-E9D1B828434D"><span class="xrefglossterm">Data Recovery Advisor一起使用</span></a></p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1381 d53814e1241 ">
                                    <p><code class="codeph">列表失败</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1381 d53814e1244 ">
                                    <p><a href="glossary.html#GUID-046A9407-B78B-4BBA-BE2F-55D74EF4F2D8"><span class="xrefglossterm">失败</span></a>是映射到<a href="glossary.html#GUID-76EA30CA-A51E-44C9-AB25-E1D89AF711B2"><span class="xrefglossterm">修复选项</span></a>的持久性数据损坏。<a href="diagnosing-repairing-failures-dra.html#GUID-8C219B50-1F7F-4F7A-95EE-5F029AE7EB2A" title="Data Recovery Advisor是一种通过确定数据库故障的最佳自动修复选项来帮助减少数据库恢复时间的工具。Data Recovery Advisor是一个Oracle数据库工具，可自动诊断数据故障，确定并提供适当的修复选项，并根据用户的请求执行修复。在使用Data Recovery Advisor之前，您必须熟悉一些概念。Data Recovery Advisor具有命令行和GUI界面。Oracle企业管理器云控制中提供了GUI界面。检查器是在Health Monitor中注册的诊断操作或过程，用于评估数据库或其组件的运行状况。失败是由数据完整性检查检测到的持久性数据损坏。每个故障都有故障状态：OPEN或CLOSED。每个故障都有一个失败优先级：CRITICAL，HIGH或LOW。 Data Recovery Advisor仅为诊断出的故障分配CRITICAL或HIGH优先级。为清楚起见，Data Recovery Advisor将相关故障组合在一起。ADVISE FAILURE命令可以显示手动和自动修复选项。Data Recovery Advisor将手动操作分类为必需或可选。如果可能，Data Recovery Advisor会整合修复以将多个故障修复为单个修复。合并修复可能包含多个步骤。每当Data Recovery Advisor生成自动修复选项时，它都会创建一个脚本，说明RMAN打算使用哪些命令来修复故障。Data Recovery Advisor打印此脚本的位置，该脚本是驻留在操作系统上的文本文件。仅在某些数据库配置上支持Data Recovery Advisor。Data Recovery Advisor仅支持单实例数据库。不支持Oracle Real Application Clusters（Oracle RAC）数据库。Oracle Data Guard环境中的Data Recovery Advisor存在一些限制。Data Recovery Advisor只能用于诊断和修复非CDB中的数据损坏以及多租户容器数据库（CDB）的根目录。可插拔数据库（PDB）不支持Data Recovery Advisor。当您怀疑或发现故障时，Data Recovery Advisor工作流程就会开始。您可以通过多种方式发现故障，包括错误消息，警报，跟踪文件和失败的数据完整性检查。您可以使用Data Recovery Advisor自动诊断数据故障，确定适当的修复选项以及在CDB中执行修复。如果您怀疑或知道发生了一个或多个数据库故障，请使用LIST FAILURE获取有关它们的信息。确定数据库遇到问题的最简单方法是使用LIST FAILURE命令。除了提供更详细的输出外，LIST FAILURE还可以限制输出。当用户事务试图访问损坏的数据时，数据库会被动地调用数据完整性检查。在某些情况下，潜在的故障可能无法检测到。在RMAN会话中运行LIST FAILURE后，使用ADVISE FAILURE命令显示修复选项。此命令打印故障摘要，并隐式关闭所有已修复的打开故障。如果存在一个或多个故障，则通常使用LIST FAILURE显示有关故障的信息，然后在同一个RMAN会话中显示ADVISE FAILURE以获取修复选项的报告。您还可以请求特定故障的修复选项。您可以按状态（CRITICAL，HIGH或LOW）或故障编号指定故障。您还可以使用EXCLUDE FAILURE从报告中排除一个或多个故障。您可以使用Data Recovery Advisor自动修复故障。如果ADVISE FAILURE建议手动修理，请先尝试这些。如果无法进行手动修复，或者无法修复所有故障，则可以使用REPAIR FAILURE自动修复当前RMAN会话中最新ADVISE FAILURE命令中建议的故障。默认情况下，脚本显示为标准输出。您可以使用SPOOL命令将脚本写入可编辑文件。在某些情况下，您可能希望使用CHANGE FAILURE命令来更改故障的状态或优先级。">使用Data Recovery Advisor诊断和修复故障通过</a> <code class="codeph">ADVISE</code>和<code class="codeph">REPAIR</code>命令解释了如何使用<code class="codeph">LIST FAILURE</code> 。
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p><code class="codeph">LIST</code>命令支持控制输出显示方式的选项。<a href="reporting-rman-operations.html#GUID-2CD81DF5-F74C-43E1-A202-23D8811BB098__CIHJDIAB" title="此表描述了最常见的LIST命令选项。">表11-3</a>总结了最常见的<code class="codeph">LIST</code>选项。
                     </p>
                     <div class="tblformal" id="GUID-2CD81DF5-F74C-43E1-A202-23D8811BB098__CIHJDIAB">
                        <p class="titleintable">表11-3最常见的LIST选项</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="最常见的LIST选项" width="100%" border="1" summary="This table describes the most common LIST command options." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" id="d53814e1514">列表选项</th>
                                 <th align="left" valign="bottom" id="d53814e1517">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d53814e1522" headers="d53814e1514 ">
                                    <p><code class="codeph">列表已过期</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1522 d53814e1517 ">
                                    <p>列出在最近的<a href="glossary.html#GUID-F9B39FFF-D31F-4303-AF01-80A151B19D1F"><span class="xrefglossterm">交叉检查</span></a>期间记录在RMAN存储库中但在磁盘或磁带上的预期位置不存在的备份或副本。此类备份可能已在RMAN之外删除。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d53814e1533" headers="d53814e1514 ">
                                    <p><code class="codeph">列表......按文件</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1533 d53814e1517 ">
                                    <p>列出每个数据文件，归档重做日志文件，控制文件和服务器参数文件的备份。每行描述文件的备份。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d53814e1541" headers="d53814e1514 ">
                                    <p><code class="codeph">列表......摘要</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e1541 d53814e1517 ">
                                    <p>提供每个备份的单行摘要。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p><code class="codeph">LIST</code>对象和选项不会被前面表格的内容耗尽。例如，您可以列出受时间，路径名称，设备类型，标记或可恢复性限制的备份。
                     </p>
                     <div class="infoboxnotealso" id="GUID-2CD81DF5-F74C-43E1-A202-23D8811BB098__GUID-C199A6F5-9D8F-4DAA-A7D2-19A7DD53AE2F">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<code class="codeph">LIST</code>命令的完整说明，请<a href="../rcmrf/LIST.html#RCMRF132" target="_blank"><span><cite>参见Oracle数据库备份和恢复参考</cite></span></a></p>
                     </div>
                  </div>
               </div><a id="BRADV632"></a><a id="BRADV633"></a><a id="BRADV634"></a><a id="BRADV89586"></a><div class="props_rev_3"><a id="GUID-EBE4B021-273E-4208-97FC-AA1F2AE092FF" name="GUID-EBE4B021-273E-4208-97FC-AA1F2AE092FF"></a><h4 id="BRADV-GUID-EBE4B021-273E-4208-97FC-AA1F2AE092FF" class="sect4"><span class="enumeration_section">11.2.2</span>列出所有备份和副本</h4>
                  <div>
                     <p>使用<span class="italic"><code class="codeph">listObjList</code></span>或<span class="italic"><code class="codeph">recordSpec</code></span>子句指定所需的对象。如果未指定对象，则RMAN将显示所有数据库文件和归档重做日志文件的副本。
                     </p>
                     <div class="section">
                        <p>默认情况下，RMAN按顺序列出每个备份或代理副本，然后标识备份中包含的文件。您还可以按文件列出备份。</p>
                        <p>默认情况下，RMAN以详细模式列出，这意味着它提供了广泛的多行信息。如果详细模式生成过多输出，您还可以在摘要模式下列出备份。</p>
                        <p>要查看所有备份和副本的摘要报告，请使用<code class="codeph">SUMMARY</code>选项执行<code class="codeph">LIST</code>命令。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-EBE4B021-273E-4208-97FC-AA1F2AE092FF__CIHECIBA">
                        <p class="titleinexample">示例11-1所有备份的摘要列表</p>
                        <p>此示例显示所有RMAN备份的摘要。</p><pre class="pre codeblock"><code>RMAN&gt; <span class="bold">列表备份摘要;</span>备份列表===============键TY LV S设备类型完成时间#Pieces #Copies压缩标签-------  -   -   -  ------ ----- --------------- ------- ------- ---------- --- 1 BAA SBT_TAPE 21-OCT-13 1 1 NO TAG20131021T094505 2 BFA SBT_TAPE 21-OCT-13 1 1 NO TAG20131021T094513 3 BAA SBT_TAPE 21-OCT-13 1 1 NO TAG20131021T094624 4 BFA SBT_TAPE 21-OCT-13 1 1 NO TAG20131021T094639 5 BFA DISK 04- NOV-13 1 1是TAG20131104T195949</code></pre><p>要查看备份和副本的详细输出，请执行不带<code class="codeph">SUMMARY</code>选项的<code class="codeph">LIST</code>命令。
                        </p>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-EBE4B021-273E-4208-97FC-AA1F2AE092FF__CIHDBBDB">
                        <p class="titleinexample">示例11-2备份和副本的详细列表</p>
                        <p>此示例列出了具有默认详细输出的RMAN备份和副本。</p><pre class="pre codeblock"><code>RMAN&gt; <span class="bold">列表备份;</span>备份集列表=================== BS密钥大小设备类型经过时间完成时间------- ----------- ---------- ------------ --------------- 7 136M DISK 00:00:20 04-NOV-13 BP密钥：7状态：可用压缩：否标签：TAG20071104T200759件名：/d2/RDBMS/backupset/2013_11_04/o1_mf_annnn_TAG20071104T200759_ztjxx3k8_.bkp备份集中的存档日志列表7 Thrd Seq低SCN低时间下一个SCN下一次---- ------- ---------- --------- ---------- --------- 1 1 173832 21- OCT-13 174750 21-OCT-13 1 2 174750 21-OCT-13 174755 21-OCT-13 1 3 174755 21-OCT-13 174758 21-OCT-13 BS键类型LV尺寸设备类型经过时间完成时间 - ----- ------ ---------- ----------- ------------ ------ --------- 8 Full 2M DISK 00:00:01 04-NOV-13 BP Key：8状态：AVAILABLE压缩：无标签：TAG20071104T200829件名：/ disk1 / oracle / dbs / c-774627068- 20131104-01包含控制文件：Ckp SCN：631510 Ckp时间：04-NOV-13 SPFILE包括：修改时间：21-OCT-13</code></pre><pre class="pre codeblock"><code>RMAN&gt; <span class="bold">列表副本;</span>数据文件副本列表=======================密钥文件S完成时间Ckp SCN Ckp时间------- ----  -   - ------------- ---------- --------------- 1 7 A 11-OCT-13 360072 11-OCT -13名称：/work/orcva/RDBMS/datafile/o1_mf_tbs_2_2lv7bf82_.dbf标签：DF7COPY 2 8 A 11-OCT-13 360244 11-OCT-13名称：/work/orcva/RDBMS/datafile/o1_mf_tbs_2_2lv7qmcj_.dbf标签：TAG20131011T184835控制文件副本列表===========================键S完成时间Ckp SCN Ckp时间-------  -   - ------------- ---------- --------------- 3 A 11-OCT-13 360380 11-OCT- 13名称：/d2/RDBMS/controlfile/o1_mf_TAG20131011T185335_2lv80zqd_.ctl标签：TAG20131011T185335带有db_unique_name RDBMS的数据库的存档日志副本列表======================== ============================================= Key Thrd Seq S Low时间------- ---- -------  -  --------- 1 1 1 A 11-OCT-13姓名：/work/arc_dest/arcr_1_1_603561743.arc 2 1 2 A 11-OCT-13名称：/work/arc_dest/arcr_1_2_603561743.arc 3 1 3 A 11-OCT-13名称：/ work / arc_dest / ar cr_1_3_603561743.arc</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-EBE4B021-273E-4208-97FC-AA1F2AE092FF__CIHDFBDE">
                        <p class="titleinexample">例11-3按文件列出备份</p>
                        <p>此示例说明如何使用带有<code class="codeph">BY FILE</code>选项的<code class="codeph">LIST</code>按文件列出备份。
                        </p><pre class="pre codeblock"><code>RMAN&gt; <span class="bold">按文件列出备份;</span>数据文件备份列表========================文件密钥TY LV S Ckp SCN Ckp时间#Pieces #Copies压缩标签---- --- ----  -   -   -  ---------- --------- ------- ------- --------- -  --- 1 5 BFA 631092 04-NOV-13 1 1是TAG20131104T195949 2 BFA 175337 21-OCT-13 1 1否TAG20131021T094513 2 5 BFA 631092 04-NOV-13 1 1是TAG20131104T195949 2 BFA 175337 21-OCT-13 1 1 NO TAG20131021T094513 <span class="italic">...省略了一些行</span>存档日志备份列表============================ Thrd Seq低SCN低时间BS关键S #Pieces #Copies压缩标签---- ------- ---------- --------- ------- ---- --- ------- ---------- --- 1 1 173832 21-OCT-13 7 A 1 1 NO TAG20131104T200759 1 A 1 1 NO TAG20131021T094505 1 2 174750 21-OCT- 13 7 A 1 1 NO TAG20131104T200759 1 A 1 1 NO TAG20131021T094505 <span class="italic">...省略了一些行</span> 1 38 575472 03-NOV-13 7 A 1 1 NO TAG20131104T200759 1 39 617944 04-NOV-13 7 A 1 1 NO TAG20131104T200759控制文件列表备份=========================== CF Ckp SCN Ckp时间BS键S #Pieces #Copies C ompressed Tag ---------- --------- -------  -  ------- ------- ------- --- --- 631510 04-NOV-13 8 A 1 1 NO TAG20131104T200829 631205 04-NOV-13 6 A 1 1 NO TAG20131104T200432 SPFILE备份列表================ ======修改时间BS Key S #Pieces #Copies Compressed Tag ----------------- -------  -  -------  - ------ ---------- --- 21-OCT-13 8 A 1 1 NO TAG20131104T200829 21-OCT-13 6 A 1 1 NO TAG20131104T200432</code></pre><div class="infoboxnotealso" id="GUID-EBE4B021-273E-4208-97FC-AA1F2AE092FF__GUID-FA459717-AF6B-4533-81F0-00B453E8A6F3">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../rcmrf/LIST.html#RCMRF132" target="_blank"><span><cite>Oracle数据库备份和恢复参考，</cite></span></a>用于解释<code class="codeph">LIST</code>输出中的各个列标题</p>
                        </div>
                     </div>
                     <!-- class="example" -->
                  </div>
               </div><a id="BRADV277"></a><a id="BRADV89589"></a><div class="props_rev_3"><a id="GUID-27C4AD72-0556-4388-AD65-8224C49E388F" name="GUID-27C4AD72-0556-4388-AD65-8224C49E388F"></a><h4 id="BRADV-GUID-27C4AD72-0556-4388-AD65-8224C49E388F" class="sect4"><span class="enumeration_section">11.2.3</span>列出所选备份和副本</h4>
                  <div>
                     <p>您可以指定几个不同的条件来缩小<code class="codeph">LIST</code>输出。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-27C4AD72-0556-4388-AD65-8224C49E388F__GUID-746DC500-C71E-481C-9B24-52D55ABB2B34">列出所选备份和副本：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span></li>
                        <li class="stepexpand"><span>使用<span class="italic"><code class="codeph">listObjList</code></span>或<span class="italic"><code class="codeph">recordSpec</code></span>子句运行<code class="codeph">LIST COPY</code>或<code class="codeph">LIST BACKUP</code> 。例如，输入以下任何命令：</span><div><pre class="pre codeblock"><code>＃列出数据库LIST BACKUP OF DATABASE中所有文件的备份; ＃列出指定数据文件的副本LIST COPY OF DATAFILE'ora_home / oradata / trgt / system01.dbf'; #list指定备份集LIST BACKUPSET 213; #list datafile copy LIST DATAFILECOPY'/ tmp / tools01.dbf';</code></pre><p>您还可以通过指定<span class="italic"><code class="codeph">maintQualifier</code></span>或<code class="codeph">RECOVERABLE</code>子句来限制搜索。例如，输入以下任何命令：</p>
                              <p></p><pre class="pre codeblock"><code>＃通过标记LIST BACKUPSET TAG'weekly_full_db_backup'指定备份集; ＃按设备类型指定备份或复制LIST COPY OF DATAFILE'ora_home / oradata / trgt / system01.dbf'DEVICE TYPE sbt; ＃按目录或路径指定备份LIST COPY LIKE'/ tmp /％'; ＃指定一系列完成日期的备份或副本列出'10 -DEC-2012'和'17 -DEC-2012'之间完成的数据文件复制2; ＃指定日志备份至少两次到磁带LIST ARCHIVELOG ALL备份2次到设备类型sbt; ＃指定备份集至少备份一次到磁盘LIST BACKUPSET备份1次磁盘; ＃指定PDB的备份至少备份两次到sbt LIST BACKUP OF PLUGGABLE DATABASE my_pdb备份2次到SBT;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>检查输出。</span></li>
                     </ol>
                     <div class="section">
                        <p>输出取决于传递给<code class="codeph">LIST</code>命令的选项。例如，以下列出了备份集中包含的数据文件<code class="codeph">1</code>副本。
                        </p><pre class="pre codeblock"><code>RMAN&gt; DATAFILE 1的列表备份;备份集列表=================== BS密钥类型LV大小设备类型经过时间完成时间------- ------ --- ------- ----------- ------------ --------------- 2全230M SBT_TAPE 00 ：00：49 21-OCT-13 BP密钥：2状态：可用压缩：否标签：TAG20131021T094513句柄：02f4eatc_1_1媒体：/ smrdir备份集2中的数据文件列表文件LV类型Ckp SCN Ckp时间名称----- ---- ---------- --------- ---- 1 Full 175337 21-OCT-13 /oracle/dbs/tbs_01.f BS Key Type LV Size Device Type经过时间完成时间------- ------ ---------- ----------- ------------ --------------- 5 Full 233M DISK 00:04:30 04-NOV-13 BP Key：5状态：AVAILABLE压缩：无标签：TAG20131104T195949件名：/ disk1 / 2013_11_04 / o1_mf_nnndf_TAG20131104T195949_ztjxfvgz_.bkp备份集5中的数据文件列表文件LV类型Ckp SCN Ckp时间名称----  -  ---- ---------- --------- --- -  1完整631092 04-NOV-13 /oracle/dbs/tbs_01.f</code></pre><div class="infoboxnotealso" id="GUID-27C4AD72-0556-4388-AD65-8224C49E388F__GUID-788AC2C8-5DA8-4FD8-8633-35CADC2DE990">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="italic"><code class="codeph">listObjList</code></span>和<span class="italic"><code class="codeph">recordSpec</code></span>语法的<a href="../rcmrf/listObjList.html#RCMRF133" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                              </li>
                              <li>
                                 <p> <a href="../rcmrf/LIST.html#RCMRF132" target="_blank"><span><cite>Oracle数据库备份和恢复参考，</cite></span></a>用于解释<code class="codeph">LIST</code>输出中的列</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-1019A5BE-C3A0-4036-86E3-017F6E620A7D" name="GUID-1019A5BE-C3A0-4036-86E3-017F6E620A7D"></a><h4 id="BRADV-GUID-1019A5BE-C3A0-4036-86E3-017F6E620A7D" class="sect4"><span class="enumeration_section">11.2.4</span>列出Preplugin备份</h4>
                  <div>
                     <p>使用<code class="codeph">LIST</code>命令列出预包装备份和预刷新存档的重做日志文件。
                     </p>
                     <div class="section">
                        <p></p>
                     </div>
                     <!-- class="section" -->
                     <div class="p">目标CDB的<code class="codeph">COMPATIBLE</code>参数必须设置为18.0.0或更高。
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的公共用户身份连接到目标数据库的根目录。如果使用，请连接到恢复目录。</span></li>
                        <li class="stepexpand"><span>确保目标CDB处于读写或只读模式。</span></li>
                        <li class="stepexpand"><span>使用<code class="codeph">SET</code>命令将当前容器设置为要显示其备份对象的PDB。</span><div>
                              <p>以下命令将当前容器设置为<code class="codeph">my_pdb</code> 。
                              </p><pre class="pre codeblock"><code>SET PREPLUGIN CONTAINER = my_pdb;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>使用<code class="codeph"><span class="codeinlineitalic">listObjList</span></code>或<code class="codeph"><span class="codeinlineitalic">recordSpec</span></code>子句运行<code class="codeph">LIST PREPLUGIN</code>命令以显示预备份备份。</span><div>
                              <p>要列出PDB的预备份备份，请使用以下命令：</p><pre class="pre codeblock"><code>列表预先插入可插入数据库pdb1的备份;</code></pre><p>要列出目标CDB中的所有预存续归档重做日志文件，请使用以下命令：</p><pre class="pre codeblock"><code>列表PREPLUGIN ARCHVELOG ALL;</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV89591"></a><div class="props_rev_3"><a id="GUID-D46FAC21-3514-4A6D-967A-BDEA5E9CB0EB" name="GUID-D46FAC21-3514-4A6D-967A-BDEA5E9CB0EB"></a><h4 id="BRADV-GUID-D46FAC21-3514-4A6D-967A-BDEA5E9CB0EB" class="sect4"><span class="enumeration_section">11.2.5</span>列出数据库化身</h4>
                  <div>
                     <p>每次在数据库上执行<code class="codeph">OPEN</code> <code class="codeph">RESETLOGS</code>操作时，此操作都会创建数据库的新版本。
                     </p>
                     <div class="section">
                        <p>执行增量备份时，RMAN可以使用先前版本的备份或当前版本作为后续增量备份的基础。执行还原和恢复操作时，如果所有存档日志都可用，RMAN可以使用先前版本的备份，就像它可以使用当前版本的备份一样。</p>
                        <p><span class="bold">列出数据库化身：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span></li>
                        <li class="stepexpand"><span>运行<code class="codeph">LIST</code> <code class="codeph">INCARNATION</code>命令，如以下示例所示：</span><div><pre class="pre codeblock"><code>列出否定;</code></pre><p>如果您使用的是恢复目录，并且在同一目录中注册了多个目标数据库，则可以使用<code class="codeph">OF</code> <code class="codeph">DATABASE</code>选项区分它们：</p><pre class="pre codeblock"><code>列出数据库prod3的增加;</code></pre><p>以下是列出特定数据库的化身的示例输出：</p><pre class="pre codeblock"><code>RMAN&gt; DATABASE rdbms的列表;数据库化身列表DB Key Inc密钥DB名称DB ID状态重置SCN重置时间------- ------- -------- ----------- ----- ------ ---------- ---------- 1 1 RDBMS 774627068 PARENT 1 21-OCT-13 2 2 RDBMS 774627068 CURRENT 173832 21- OCT-13</code></pre><p>前面的输出表明在SCN 173832上对数据库<code class="codeph">rdbms</code>执行了<code class="codeph">RESETLOGS</code>操作，从而产生了新的化身。化身通过化身键（在<code class="codeph">Inc Key</code>列中表示）来区分。
                              </p>
                              <div class="infoboxnotealso" id="GUID-D46FAC21-3514-4A6D-967A-BDEA5E9CB0EB__GUID-7818143E-96E6-4384-A231-3336CDD5575A">
                                 <p class="notep1">也可以看看：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><a href="../rcmrf/LIST.html#RCMRF132" target="_blank"><span><cite>Oracle数据库备份和恢复参考，</cite></span></a>用于解释<code class="codeph">LIST</code>输出中的各个列标题</p>
                                    </li>
                                    <li>
                                       <p><a href="rman-data-repair-concepts.html#GUID-9942AC94-A35D-4A06-9A45-A5A43B82B23D" title="只要使用RESETLOGS选项打开数据库，就会创建数据库化身。">关于Database Incarnations</a>数据库化身及其对数据库恢复的影响</p>
                                    </li>
                                 </ul>
                              </div>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div><a id="BRADV8137"></a><div class="props_rev_3"><a id="GUID-A1FDD9FE-74B8-4146-AFC4-6BD5402C8B5D" name="GUID-A1FDD9FE-74B8-4146-AFC4-6BD5402C8B5D"></a><h3 id="BRADV-GUID-A1FDD9FE-74B8-4146-AFC4-6BD5402C8B5D" class="sect3"><span class="enumeration_section">11.3</span>报告备份和数据库架构</h3>
               <div>
                  <p>RMAN <code class="codeph">REPORT</code>命令分析可用备份和数据库。
                  </p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="reporting-rman-operations.html#GUID-84A456A0-3012-4710-B710-155C4F477671" title="REPORT命令提供各种RMAN备份报告。">关于RMAN备份的报告</a></p>
                     </li>
                     <li>
                        <p><a href="reporting-rman-operations.html#GUID-797C90B8-FAD2-4D43-8870-70C2936BD452" title="使用REPORT NEED BACKUP命令确定在特定保留策略下需要备份的数据库文件。">根据保留策略报告需要备份的文件</a></p>
                     </li>
                     <li>
                        <p><a href="reporting-rman-operations.html#GUID-907FD8EB-D3C8-47B1-9076-A8A6109FE989" title="当通过不可恢复的操作（例如直接加载插入）更改数据文件时，不能使用正常的介质恢复来恢复文件，因为不可恢复的操作不会生成重做。在执行此类操作后，您必须对受影响的数据文件执行完全备份或增量备份，以确保可以使用RMAN恢复受不可恢复操作影响的数据块。">报告受不可恢复操作影响的数据文件</a></p>
                     </li>
                     <li>
                        <p><a href="reporting-rman-operations.html#GUID-DFC4A04F-E0AE-42E6-9B96-3815C62EF23F" title="您可以通过指定OBSOLETE关键字来报告过时的备份集，备份片和数据文件副本，这些副本不需要满足指定的保留策略。">报告过时备份</a></p>
                     </li>
                     <li>
                        <p><a href="reporting-rman-operations.html#GUID-732DB3CD-0D09-4A52-A358-2E1E9F5E2C82" title="REPORT SCHEMA命令列出并显示有关数据库文件，表空间等的信息。">报告数据库模式</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV278"></a><a id="BRADV89593"></a><div class="props_rev_3"><a id="GUID-84A456A0-3012-4710-B710-155C4F477671" name="GUID-84A456A0-3012-4710-B710-155C4F477671"></a><h4 id="BRADV-GUID-84A456A0-3012-4710-B710-155C4F477671" class="sect4"><span class="enumeration_section">11.3.1</span>关于RMAN备份的报告</h4>
                  <div>
                     <p><code class="codeph">REPORT</code>命令提供各种RMAN备份报告。
                     </p>
                     <p>您可以使用<code class="codeph">REPORT</code>命令回答重要问题，例如：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>哪些文件需要备份？</p>
                        </li>
                        <li>
                           <p>哪些文件对它们执行了不可恢复的操作？</p>
                        </li>
                        <li>
                           <p>哪些备份已过时且可以删除？</p>
                        </li>
                        <li>
                           <p>以前某个时候Data Guard环境中的目标数据库或数据库的物理模式是什么？</p>
                        </li>
                        <li>
                           <p>最近哪些文件没有备份？</p>
                        </li>
                     </ul>
                     <p>通过报告，您可以确认您的备份和恢复策略实际上是否符合数据库可恢复性的要求。用于确定数据库是否可恢复的两种主要形式的<code class="codeph">REPORT</code>是：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">报告需要备份</code> 
                           </p>
                           <p>报告必须备份哪些数据库文件以满足配置或指定的保留策略</p>
                        </li>
                        <li>
                           <p><code class="codeph">报告无法解决</code></p>
                           <p>报告哪些数据库文件需要备份，因为它们受到某些<code class="codeph">NOLOGGING</code>操作（如直接路径<code class="codeph">INSERT</code></p>
                        </li>
                     </ul>
                     <p>RMAN存储库包含可以使用<code class="codeph">REPORT</code>命令访问的其他信息。下表总结了<code class="codeph">REPORT</code>选项。
                     </p>
                     <div class="tblformal" id="GUID-84A456A0-3012-4710-B710-155C4F477671__CHDBIADB">
                        <p class="titleintable">表11-4报告选项</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="报告选项" width="100%" border="1" summary="This table describes REPORT command options." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" id="d53814e2478">报告内容</th>
                                 <th align="left" valign="bottom" id="d53814e2481">命令</th>
                                 <th align="left" valign="bottom" id="d53814e2484">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d53814e2489" headers="d53814e2478 ">
                                    <p>过时的备份</p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e2489 d53814e2481 ">
                                    <p><code class="codeph">报告已废除</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e2489 d53814e2484 ">
                                    <p>记录在RMAN存储库中的完整备份，数据文件副本和归档重做日志可以删除，因为它们不再需要</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d53814e2500" headers="d53814e2478 ">
                                    <p>数据库架构</p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e2500 d53814e2481 ">
                                    <p><code class="codeph">报告计划</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d53814e2500 d53814e2484 ">
                                    <p>指定时间点的目标数据库的所有数据文件（永久和临时）和表空间的名称。如果在Data Guard环境中使用RMAN，则可以报告指定<code class="codeph">DB_UNIQUE_NAME</code>的架构。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="infoboxnotealso" id="GUID-84A456A0-3012-4710-B710-155C4F477671__GUID-C7A2339B-984E-4C28-BCF9-810944B2E981">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<code class="codeph">REPORT</code>命令的说明，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF147" target="_blank"><span><cite>参见Oracle数据库备份和恢复参考</cite></span></a></p>
                     </div>
                  </div>
               </div><a id="BRADV89594"></a><div class="props_rev_3"><a id="GUID-797C90B8-FAD2-4D43-8870-70C2936BD452" name="GUID-797C90B8-FAD2-4D43-8870-70C2936BD452"></a><h4 id="BRADV-GUID-797C90B8-FAD2-4D43-8870-70C2936BD452" class="sect4"><span class="enumeration_section">11.3.2</span>根据保留策略报告需要备份的文件</h4>
                  <div>
                     <p>使用<code class="codeph">REPORT NEED BACKUP</code>命令确定在特定保留策略下需要备份的数据库文件。
                     </p>
                     <div class="section">
                        <p>如果没有参数， <code class="codeph">REPORT NEED BACKUP</code>根据当前配置的保留策略报告哪些对象需要备份。已配置的<code class="codeph">REDUNDANCY 1</code>保留策略的输出与此示例类似：</p><pre class="pre codeblock"><code>RMAN&gt;报告需要备份; RMAN保留策略将应用于命令RMAN保留策略设置为冗余1报告少于1个冗余备份的文件文件#bkps名称---- ----- ----------- ------------------------------------------ 2 0 / oracle / oradata / trgt /undotbs01.dbf</code></pre><div class="infoboxnote" id="GUID-797C90B8-FAD2-4D43-8870-70C2936BD452__GUID-8C1D7DB6-0733-48A0-A13A-DD796EB1CE71">
                           <p class="notep1">注意：</p>
                           <p>如果使用<code class="codeph">CONFIGURE RETENTION POLICY TO NONE</code>禁用保留策略，则<code class="codeph">REPORT NEED BACKUP</code>将返回错误消息，因为没有保留策略，RMAN无法确定必须备份哪些文件。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div><a id="BRADV89595"></a><div class="props_rev_3"><a id="GUID-39CFF5D1-610D-43E5-838E-368D205B85A4" name="GUID-39CFF5D1-610D-43E5-838E-368D205B85A4"></a><h5 id="BRADV-GUID-39CFF5D1-610D-43E5-838E-368D205B85A4" class="sect5"><span class="enumeration_section">11.3.2.1</span>使用具有不同保留策略的RMAN报告需要备份</h5>
                     <div>
                        <p>您可以使用<code class="codeph">REPORT NEED BACKUP</code>命令的选项指定不同的保留策略。
                        </p>
                        <div class="section">
                           <p>使用以下表格之一为<code class="codeph">REPORT NEED BACKUP</code>指定不同的标准：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">REPORT NEED BACKUP RECOVERY WINDOW OF</code> <span class="italic"><code class="codeph">n</code></span> <code class="codeph">DAYS</code> <code class="codeph">REPORT NEED BACKUP RECOVERY WINDOW OF</code> 
                                 </p>
                                 <p>显示需要备份的对象以满足基于恢复窗口的保留策略</p>
                              </li>
                              <li>
                                 <p><code class="codeph">REPORT NEED BACKUP REDUNDANCY</code> <span class="italic"><code class="codeph">n</code></span></p>
                                 <p>显示需要备份的对象以满足基于冗余的保留策略</p>
                              </li>
                              <li>
                                 <p><code class="codeph">REPORT NEED BACKUP DAYS</code> <span class="italic"><code class="codeph">n</code></span> 
                                 </p>
                                 <p>显示需要超过<span class="italic"><code class="codeph">n</code></span>天的归档重做日志文件以进行恢复的文件</p>
                              </li>
                              <li>
                                 <p><code class="codeph">REPORT NEED BACKUP INCREMENTAL</code> <span class="italic"><code class="codeph">n</code></span> 
                                 </p>
                                 <p>显示需要应用超过<span class="italic"><code class="codeph">n</code></span>增量备份以进行恢复的文件</p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV89596"></a><div class="props_rev_3"><a id="GUID-EF685338-5D24-4CDE-8737-1BDCC1122A5E" name="GUID-EF685338-5D24-4CDE-8737-1BDCC1122A5E"></a><h5 id="BRADV-GUID-EF685338-5D24-4CDE-8737-1BDCC1122A5E" class="sect5"><span class="enumeration_section">11.3.2.2</span>使用表空间和数据文件使用RMAN REPORT NEED BACKUP</h5>
                     <div>
                        <p><code class="codeph">REPORT NEED BACKUP</code>命令可以检查整个数据库，跳过指定的表空间，或仅根据不同的保留策略检查特定的表空间或数据文件。
                        </p>
                        <div class="section">
                           <p>以下是示例：</p><pre class="oac_no_warn" dir="ltr">报告需要备份恢复窗口的2天数据库跳过TAPLESPACE TBS_2;报告需要备份冗余2数据文件1;报告需要备份TABLESPACE TBS_3; ＃使用配置的保留策略REPORT NEED BACKUP INCREMENTAL 2; ＃检查整个数据库</pre><div class="infoboxnotealso" id="GUID-EF685338-5D24-4CDE-8737-1BDCC1122A5E__GUID-54534F55-E894-4B4D-ABE2-FC497CD91E06">
                              <p class="notep1">也可以看看：</p>
                              <p>有关<code class="codeph">REPORT NEED BACKUP</code>所有可能选项的<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF147" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a>以及输出中各种列标题的说明</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV89597"></a><div class="props_rev_3"><a id="GUID-2111DD16-E7E0-40F6-A07B-EC56AE6A163B" name="GUID-2111DD16-E7E0-40F6-A07B-EC56AE6A163B"></a><h5 id="BRADV-GUID-2111DD16-E7E0-40F6-A07B-EC56AE6A163B" class="sect5"><span class="enumeration_section">11.3.2.3</span>仅在磁带或磁盘上使用REPORT NEED BACKUP和备份</h5>
                     <div>
                        <p>您可以将<code class="codeph">REPORT NEED BACKUP</code>命令测试的备份限制为仅基于磁盘或基于磁带的备份。
                        </p>
                        <div class="section">
                           <p>以下是一些例子：</p><pre class="pre codeblock"><code>报告需要2天数据库设备类型的备份恢复窗口sbt;报告需要备份设备类型磁盘;报告需要备份TABLESPACE TBS_3设备类型sbt;</code></pre></div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="BRADV279"></a><a id="BRADV89598"></a><div class="props_rev_3"><a id="GUID-907FD8EB-D3C8-47B1-9076-A8A6109FE989" name="GUID-907FD8EB-D3C8-47B1-9076-A8A6109FE989"></a><h4 id="BRADV-GUID-907FD8EB-D3C8-47B1-9076-A8A6109FE989" class="sect4"><span class="enumeration_section">11.3.3</span>报告受不可恢复操作影响的数据文件</h4>
                  <div>
                     <p>当通过不可恢复的操作（例如直接加载插入）更改数据文件时，不能使用正常的介质恢复来恢复文件，因为不可恢复的操作不会生成重做。在执行此类操作后，您必须对受影响的数据文件执行完全备份或增量备份，以确保可以使用RMAN恢复受不可恢复操作影响的数据块。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-907FD8EB-D3C8-47B1-9076-A8A6109FE989__GUID-DAF77BBD-1C30-4F59-8B00-ECA967EEC592">识别受不可恢复操作影响的数据文件：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span><div>
                              <div class="infoboxnotealso" id="GUID-907FD8EB-D3C8-47B1-9076-A8A6109FE989__GUID-FCDA1745-E123-473B-9C27-53D07D734C87">
                                 <p class="notep1">也可以看看：</p>
                                 <p><a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a></p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>执行<code class="codeph">REPORT UNRECOVERABLE</code>命令。</span><div>
                              <p>以下示例包含示例输出：</p><pre class="pre codeblock"><code>RMAN&gt; REPOR UNRECOVERABLE;由于不可恢复的操作而需要备份的文件的报告文件备份类型名称---- ----------------------- ------- ---------------------------- 1 full /oracle/oradata/trgt/system01.dbf</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV280"></a><a id="BRADV89599"></a><div class="props_rev_3"><a id="GUID-DFC4A04F-E0AE-42E6-9B96-3815C62EF23F" name="GUID-DFC4A04F-E0AE-42E6-9B96-3815C62EF23F"></a><h4 id="BRADV-GUID-DFC4A04F-E0AE-42E6-9B96-3815C62EF23F" class="sect4"><span class="enumeration_section">11.3.4</span>报告过时备份</h4>
                  <div>
                     <p>您可以通过指定<code class="codeph">OBSOLETE</code>关键字来报告过时的备份集，备份片和数据文件副本，这些副本不需要满足指定的保留策略。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-DFC4A04F-E0AE-42E6-9B96-3815C62EF23F__GUID-F492C147-08A7-4B4A-8799-75F6441DD9DC">报告过时的备份：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span><div>
                              <div class="infoboxnotealso" id="GUID-DFC4A04F-E0AE-42E6-9B96-3815C62EF23F__GUID-FEFCC913-7A3B-4657-AE26-A765B124A26B">
                                 <p class="notep1">也可以看看：</p>
                                 <p><a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a></p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>执行<code class="codeph">CROSSCHECK</code>命令以更新存储库中备份的状态与磁盘上的状态进行比较。</span><div>
                              <p>在最简单的情况下，您可以使用以下任一命令交叉检查磁盘，磁带或两者上的所有备份：</p><pre class="pre codeblock"><code>CROSSCHECK BACKUP DEVICE TYPE DISK; CROSSCHECK BACKUP DEVICE TYPE sbt; CROSSCHECK BACKUP; #crosschecks所有设备上的所有备份</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>运行<code class="codeph">REPORT OBSOLETE</code>以确定哪些备份已过时，因为它们不再需要进行恢复。</span><div>
                              <p>如果未指定任何其他选项，则<code class="codeph">REPORT OBSOLETE</code>将根据当前保留策略显示<code class="codeph">REPORT OBSOLETE</code>的备份，如以下示例所示：</p><pre class="pre codeblock"><code>RMAN&gt;报告已废除; RMAN保留策略将应用于命令RMAN保留策略设置为冗余1报告过时备份和副本类型密钥完成时间文件名/句柄-------------------- ------ ------------------ -------------------- Datafile Copy 44 08-FEB -13 / backup / ora_df549738566_s70_s1数据文件复制45 08-FEB-13 / backup / ora_df549738567_s71_s1数据文件复制46 08-FEB-13 / backup / ora_df549738568_s72_s1备份集26 08-FEB-13备份件26 08-FEB-13 / backup / ora_df549738682_s76_s1 。。。
</code></pre><p>您还可以使用带有<code class="codeph">RECOVERY WINDOW</code>和<code class="codeph">REDUNDANCY</code>选项的<code class="codeph">REPORT OBSOLETE</code>来检查在不同的基于恢复窗口或基于冗余的保留策略下哪些备份已过时，如以下示例所示：</p><pre class="pre codeblock"><code>报告3天内未经审查的恢复窗口;报告已废除冗余1;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-DFC4A04F-E0AE-42E6-9B96-3815C62EF23F__GUID-CE1EA233-EFF8-4C10-86BB-0A89EA57376A">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="maintaining-rman-backups.html#GUID-F5C3D045-279B-4AB3-8A91-3231A716402C" title="建议的维护策略是配置快速恢复区域，备份保留策略和归档重做日志删除策略。在这种情况下，数据库会根据需要自动维护和删除备份和归档重做日志。但是，有时需要手动维护数据库备份和归档重做日志。RMAN提供多个命令来维护RMAN备份和存储库记录。RMAN始终将其元数据存储在其执行操作的每个目标数据库的控制文件中。如果在恢复目录中注册目标数据库，则RMAN会将此目标数据库的元数据存储在恢复目录中。创建备份或副本的Data Guard环境中的数据库与该文件相关联。例如，如果RMAN连接到目标数据库standby1并备份它，则此备份与standby1关联。对于交叉检查，RMAN只能在连接到与文件关联的数据库时将文件状态从AVAILABLE更新为EXPIRED。RMAN可以在连接到任何数据库时删除文件。如果RMAN未作为TARGET连接到与文件关联的数据库，并且RMAN无法成功删除文件，则RMAN会提示您将TARGET连接到与该文件关联的数据库。然后你必须使用DELETE ...FORCE删除文件元数据。如果维护命令仅更改RMAN元数据，则可以将RMAN作为TARGET连接到Data Guard环境中的任何数据库。除非您明确使用CHANGE，否则备份仍与数据库关联...RESET DB_UNIQUE_NAME将备份与其他数据库关联。RMAN旨在在没有恢复目录的情况下工作。但是，如果选择不使用恢复目录，则每个目标数据库的控制文件都是RMAN元数据的独占存储库。控制文件包含两种类型的记录：循环重用记录和非圆形重用记录。当包含有关在快速恢复区域中创建的文件的信息的控制文件记录即将被重用时，数据库尝试在文件有资格删除时从快速恢复区域中删除该文件。否则，数据库会扩展包含此文件记录的控制文件部分的大小。防止因覆盖控制文件记录而丢失RMAN元数据的最佳方法是使用恢复目录。如果您没有使用恢复目录来存储RMAN元数据，那么保护每个目标数据库控制文件是非常重要的。虽然快速恢复区域主要是自我管理，但某些情况可能需要数据库管理干预。RMAN使用某些规则来确定何时可以从快速恢复区域删除文件。您可以使用V $ RECOVERY_FILE_DEST和V $ RECOVERY_AREA_USAGE视图来确定是否为快速恢复区域分配了足够的空间。除了设置闪回保留目标或使用保证还原点之外，您无法直接管理快速恢复区域中的闪回日志。如果RMAN保留策略要求保留一组大于快速恢复区磁盘配额的备份，或者保留策略设置为NONE，则快速恢复区域可以完全填充，没有可回收空间。使用ALTER SYSTEM命令更改快速恢复区域的位置。ALTER SYSTEM命令可用于禁用快速恢复区域。通常，快速恢复区域是自我维护的。但是，当在快速恢复区域中创建文件期间实例崩溃时，数据库可能会将文件保留在快速恢复区域中。某些情况可能会导致存储库与其记录的文件之间出现差异，包括磁带或磁盘故障以及用户管理的副本或RMAN相关文件的删除。要确保恢复目录或控制文件中的备份数据与磁盘上或介质管理目录中的相应数据同步，请执行交叉检查。CROSSCHECK命令仅对当前记录在RMAN存储库中的文件进行操作。交叉检查更新过期的RMAN存储库信息，该信息与存储库记录与其物理状态不匹配的备份有关。例如，如果用户使用操作系统命令从磁盘中删除存档日志，则存储库仍会指示日志位于磁盘上，而实际上并非如此。连接到目标数据库和恢复目录（如果使用）后，根据需要运行CROSSCHECK命令以验证RMAN已知的备份的状态和可用性。您可以使用LIST命令报告备份，然后使用CROSSCHECK命令检查LIST输出中描述的特定备份是否仍然存在。使用CROSSCHECK命令验证RMAN.RMAN已知的预刷新备份和预刷新归档重做日志文件的状态和可用性，提供了多种更改备份和副本的存储库状态的方法。运行CHANGE ...无法找到备份或已异地迁移时的UNAVAILABLE命令。您可以将备份指定为免除保留策略。此技术对于归档备份以满足业务要求非常有用。将CHANGE命令与GUID选项一起使用可更改与从多租户容器数据库（CDB）中删除的可插拔数据库（PDB）对应的备份的状态。使用CHANGE命令可以修改预存储备份和预存储存档重做日志文件的存储库状态。您可以使用CATALOG命令使RMAN知道存储库中未记录的存档日志的存在，或者通过RMAN以外的方式创建的数据库文件的副本。目标数据库控制文件保留目标数据库和所有RMAN备份生成的所有归档重做日志的记录。CATALOG命令的目的是在没有要管理的RMAN文件记录时将元数据添加到存储库。使用CATALOG命令将有关用户管理的副本的信息传播到RMAN存储库。对文件进行编目后，可以运行LIST命令或查询V $ BACKUP_FILES视图以确认信息包含在RMAN存储库中。您可以在磁盘上编目备份片段。如果使用操作系统实用程序将备份片段从一个位置复制到同一主机上的另一个位置，或从一个主机复制到另一个主机，则此技术非常有用。如果使用自动存储管理（ASM），Oracle托管文件框架或快速恢复区域，则可能需要重新编目磁盘管理系统已知但不再列在RMAN存储库中的文件。当用于跟踪文件名的预期机制因介质故障，软件错误或用户错误而失败时，可能会发生这种情况。使用CATALOG命令将preplugin归档重做日志文件添加到RMAN存储库。您可以从RMAN存储库中删除文件的记录。你可以使用CHANGE ...UNCATALOG命令更新缺少文件的RMAN存储库。您可以使用RMAN DELETE命令删除存档的重做日志和RMAN备份。每个RMAN备份在RMAN存储库中生成相应的记录。该记录存储在控制文件中。如果使用了恢复目录，则在从控制文件重新同步恢复目录后，也可以在恢复目录中找到该记录。您可以删除备份的备份和恢复目录记录。建议的维护策略是配置快速恢复区域，备份保留策略和归档重做日志删除策略。使用RMAN DELETE命令删除备份和映像副本。你可以同时使用DELETE和BACKUP ......删除命令以删除特定备份和副本。你可以使用BACKUP ......删除以备份存档的重做日志，数据文件副本或备份集，然后在成功备份后删除输入文件。如果您运行CROSSCHECK，并且RMAN无法找到文件，则它会将RMAN存储库中的记录更新为EXPIRED状态。然后，您可以使用DELETE EXPIRED命令从RMAN存储库中删除过期备份和副本的记录。RMAN DELETE命令支持OBSOLETE选项，该选项删除不再需要的备份以满足指定的可恢复性要求。使用带有GUID选项的DELETE命令可以删除已从多租户容器数据库（CDB）中删除的可插拔数据库（PDB）的备份。使用DELETE命令删除预制备份备份和prelplugin存档重做日志文件。要从操作系统中删除数据库，可以在RMAN中使用DROP DATABASE命令。 RMAN删除服务器参数文件，所有数据文件，联机重做日志和属于目标数据库的控制文件。">维护RMAN备份和存储库记录，</a>以获取有关如何更新RMAN存储库记录以包含实际可用备份集的更多详细信息。
                                 </p>
                              </li>
                              <li>
                                 <p><a href="configuring-rman-client-basic.html#GUID-03DE4CF6-9D9F-4806-B5CA-CAA4CF5F2133" title="备份保留策略指定必须保留哪些备份以满足您的数据恢复要求。">配置备份保留策略</a>以获取RMAN备份保留策略的概念性概述</p>
                              </li>
                              <li>
                                 <p><a href="maintaining-rman-backups.html#GUID-ABB66655-6FAC-4375-AFA0-2E40634085A5" title="如果您运行CROSSCHECK，并且RMAN无法找到文件，则它会将RMAN存储库中的记录更新为EXPIRED状态。然后，您可以使用DELETE EXPIRED命令从RMAN存储库中删除过期备份和副本的记录。">删除过期的RMAN备份和副本，</a>以获取有关从RMAN存储库中删除RMAN备份和删除RMAN备份记录的信息</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV281"></a><a id="BRADV89600"></a><div class="props_rev_3"><a id="GUID-732DB3CD-0D09-4A52-A358-2E1E9F5E2C82" name="GUID-732DB3CD-0D09-4A52-A358-2E1E9F5E2C82"></a><h4 id="BRADV-GUID-732DB3CD-0D09-4A52-A358-2E1E9F5E2C82" class="sect4"><span class="enumeration_section">11.3.5</span>报告数据库模式</h4>
                  <div>
                     <p><code class="codeph">REPORT</code> <code class="codeph">SCHEMA</code>命令列出并显示有关数据库文件，表空间等的信息。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-732DB3CD-0D09-4A52-A358-2E1E9F5E2C82__GUID-2E5842D2-7C43-418B-AFDD-B797FA198427">要报告数据库架构：</p>
                        <p>如果未使用<code class="codeph">REPORT SCHEMA</code>指定<code class="codeph">FOR DB_UNIQUE_NAME</code> ，则恢复目录连接是可选的，但是需要目标数据库连接。在Data Guard环境中，您可以指定<code class="codeph">REPORT SCHEMA FOR DB_UNIQUE_NAME</code>以报告环境中数据库的架构。在这种情况下，不需要与目标数据库的RMAN连接。您可以将RMAN连接到恢复目录并改为设置DBID。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到所需的数据库。</span><div>
                              <div class="infoboxnotealso" id="GUID-732DB3CD-0D09-4A52-A358-2E1E9F5E2C82__GUID-FE5BFDF4-9EED-4B4E-A036-CA5349D3AAC5">
                                 <p class="notep1">也可以看看：</p>
                                 <p><a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a></p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>如果在上一步中未将RMAN连接到目标数据库，并且打算在<code class="codeph">REPORT SCHEMA</code>上指定<code class="codeph">FOR DB_UNIQUE_NAME</code>子句，则设置数据库DBID。例如，输入以下命令：</span><div><pre class="pre codeblock"><code>RMAN&gt; SET DBID 28014364;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>运行<code class="codeph">REPORT</code> <code class="codeph">SCHEMA</code>命令，如以下示例所示：</span><div><pre class="pre codeblock"><code>RMAN&gt;报告计划;使用db_unique_name报告数据库模式数据库模式DGRDBMS永久数据文件列表===========================文件大小（MB）表空间RB segs数据文件名---- -------- -------------------- ------- ----------- ------------- 1 450 SYSTEM YES /disk1/oracle/dbs/t_db1.f 2 141 SYSAUX NO /disk1/oracle/dbs/t_ax1.f 3 50 UD1 YES / disk1 / oracle / dbs / t_undo1.f 4 50 TBS_11否/disk1/oracle/dbs/tbs_111.f 5 50 TBS_11否/disk1/oracle/dbs/tbs_112.f临时文件列表============= ==========文件大小（MB）表空间Maxsize（MB）Tempfile名称---- -------- ---------------- ---- ----------- -------------------- 1 40 TEMP 32767 /disk1/oracle/dbs/t_tmp1.f</code></pre><p>如果使用恢复目录，则可以使用<span class="italic"><code class="codeph">atClause</code></span>指定过去时间，SCN或日志序列号，如以下命令示例所示：</p><pre class="pre codeblock"><code>RMAN&gt;报告时间'SYSDATE-14'; ＃schema 14天前RMAN&gt;报告模式在SCN 1000; #mode at scn 1000 RMAN&gt;报告模式序列100线程1; #schema at sequence 100 RMAN&gt; REPORT SCHEMA FOR DB_UNIQUE_NAME standby1;数据库standby1的＃schema</code></pre><div class="infoboxnotealso" id="GUID-732DB3CD-0D09-4A52-A358-2E1E9F5E2C82__GUID-2848E87E-03DE-48D8-A013-6366E597D51F">
                                 <p class="notep1">也可以看看：</p>
                                 <p>有关<code class="codeph">REPORT SCHEMA</code>输出的说明，请<a href="../rcmrf/REPORT.html#RCMRF147" target="_blank"><span><cite>参见Oracle数据库备份和恢复参考</cite></span></a></p>
                              </div>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div><a id="BRADV631"></a><div class="props_rev_3"><a id="GUID-D14C8A12-E9A6-484D-A8AD-7E40BA714740" name="GUID-D14C8A12-E9A6-484D-A8AD-7E40BA714740"></a><h3 id="BRADV-GUID-D14C8A12-E9A6-484D-A8AD-7E40BA714740" class="sect3"><span class="enumeration_section">11.4</span>在CDB和PDB中报告</h3>
               <div>
                  <p>您可以查看与多租户容器数据库（CDB），仅root用户或一个或多个可插拔数据库（PDB）相关的元数据的报告。</p>
                  <p>报告非CDB的概念和做法适用于CDB和PDB，差异在以下各节中描述。</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="reporting-rman-operations.html#GUID-6CA4CD3A-D440-47AD-91A8-8FE5B70DED99">在国家开发银行报道</a></p>
                     </li>
                     <li>
                        <p><a href="reporting-rman-operations.html#GUID-9927031D-93FF-4758-8A2B-30A9874212D9" title="使用带有GUID选项的LIST命令列出已从多租户容器数据库（CDB）中删除的可插拔数据库（PDB）的备份。">在PDB中报告</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV740"></a><div class="props_rev_3"><a id="GUID-6CA4CD3A-D440-47AD-91A8-8FE5B70DED99" name="GUID-6CA4CD3A-D440-47AD-91A8-8FE5B70DED99"></a><h4 id="BRADV-GUID-6CA4CD3A-D440-47AD-91A8-8FE5B70DED99" class="sect4"><span class="enumeration_section">11.4.1</span>在CDB中报告</h4>
                  <div>
                     <div class="section">
                        <p>查看CDB报告信息的步骤与用于<a href="glossary.html#GUID-62A96A52-3B97-455A-A443-75B999DCAC94"><span class="xrefglossterm">非CDB</span></a>的步骤类似。唯一的区别是您必须以具有通用<code class="codeph">SYSBACKUP</code>或通用<code class="codeph">SYSDBA</code>权限的<a href="glossary.html#GUID-2B102186-15BD-443C-B375-8CB0D442CF5F"><span class="xrefglossterm">公共用户</span></a>身份连接到根。
                        </p>
                        <p><code class="codeph">LIST</code>和<code class="codeph">LIST BACKUP OF</code>命令将显示整个CDB的备份。 <code class="codeph">REPORT NEED BACKUP TABLESPACE</code>命令显示有关需要备份的根中的表空间的信息。
                        </p>
                        <div class="infoboxnotealso" id="GUID-6CA4CD3A-D440-47AD-91A8-8FE5B70DED99__GUID-D86418B8-E318-4B1C-982F-B5BD44212D52">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="您可以将RMAN客户端连接到多租户容器数据库（CDB）和可插拔数据库（PDB）。">与CDB建立RMAN连接</a></p>
                        </div>
                        <p>以下命令连接到root时，会显示CDB中需要备份的所有数据文件：</p><pre class="pre codeblock"><code>报告需要备份;</code></pre><p>此命令连接到根目录时，会提供整个CDB的备份摘要列表：</p><pre class="pre codeblock"><code>列表备份摘要;</code></pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV741"></a><div class="props_rev_3"><a id="GUID-9927031D-93FF-4758-8A2B-30A9874212D9" name="GUID-9927031D-93FF-4758-8A2B-30A9874212D9"></a><h4 id="BRADV-GUID-9927031D-93FF-4758-8A2B-30A9874212D9" class="sect4"><span class="enumeration_section">11.4.2</span>在PDB中报告</h4>
                  <div>
                     <div class="section">
                        <p>使用以下技术之一查看PDB的报告信息：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>连接到root并使用<code class="codeph">LIST ...PLUGGABLE DATABASE</code>或<code class="codeph">REPORT PLUGGABLE DATABASE</code>命令。这使您可以显示有关一个或多个PDB的信息。
                              </p>
                              <p>以下命令连接到根时，会在PDB <code class="codeph">hr_pdb</code>和<code class="codeph">sales_pdb</code>提供详细的备份列表。
                              </p><pre class="pre codeblock"><code>可插入数据库的列表备份hr_pdb，sales_pdb;</code></pre></li>
                           <li>
                              <p>连接到PDB并使用<code class="codeph">LIST BACKUP</code>或<code class="codeph">REPORT</code>命令。此方法仅显示一个PDB的信息，并且还使用与非CDB相同的命令。
                              </p>
                              <p>以下命令连接到特定PDB时，将显示PDB中需要备份的所有数据文件：</p><pre class="pre codeblock"><code>报告需要备份;</code></pre><p>连接到PDB时，无法查看有关过时备份的报告信息或删除过时备份。</p>
                              <div class="infoboxnotealso" id="GUID-9927031D-93FF-4758-8A2B-30A9874212D9__GUID-E572A755-D4E3-4E0E-A1CB-FAD7EB1688D1">
                                 <p class="notep1">也可以看看：</p>
                                 <p><a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="您可以将RMAN客户端连接到多租户容器数据库（CDB）和可插拔数据库（PDB）。">与CDB建立RMAN连接</a></p>
                              </div>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div class="sect4"><a id="GUID-41452417-AD51-4EC8-9700-F8E2EF84D954" name="GUID-41452417-AD51-4EC8-9700-F8E2EF84D954"></a><h5 id="BRADV-GUID-41452417-AD51-4EC8-9700-F8E2EF84D954" class="sect5"><span class="enumeration_section">11.4.2.1</span>列出丢弃的PDB的备份</h5>
                     <div>
                        <p>使用带有<code class="codeph">GUID</code>选项的<code class="codeph">LIST</code>命令列出已从多租户容器数据库（CDB）中删除的可插拔数据库（PDB）的备份。
                        </p>
                        <div class="section">
                           <p></p>
                           <p>删除PDB后，无法使用PDB名称执行操作或查询数据字典视图。但是，您可以通过使用PDB的GUID查询来获取有关已删除的PDB的信息。</p>
                           <p><span class="bold">列出已删除PDB的备份：</span></p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>使用<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限以普通用户身份连接到root用户。</span></li>
                           <li class="stepexpand"><span>查询<code class="codeph">DBA_PDB_HISTORY</code>视图以确定已删除的PDB的GUID。</span><div>
                                 <p>以下示例显示从CDB <code class="codeph">test_db</code>中删除的PDB：</p><pre class="pre codeblock"><code>SELECT pdb_name，pdb_guid FROM dba_pdb_history WHERE db_name ='test_db';</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>使用带有<code class="codeph">GUID</code>选项的<code class="codeph">LIST</code>命令可显示已删除PDB的备份。</span><div>
                                 <p>以下命令显示具有指定GUID的已删除PDB的备份集和映像副本：</p><pre class="pre codeblock"><code>LIST BACKUP GUID'CDFFD672330A7527D0147204CD0E08D4';列表复制指南'CDFFD672330A7527D0147204CD0E08D4';</code></pre></div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV90911"></a><div class="props_rev_3"><a id="GUID-9E60E2AC-6667-49B5-9D31-6480BEF026B9" name="GUID-9E60E2AC-6667-49B5-9D31-6480BEF026B9"></a><h3 id="BRADV-GUID-9E60E2AC-6667-49B5-9D31-6480BEF026B9" class="sect3"><span class="enumeration_section">11.5</span>使用V $视图查询备份元数据</h3>
               <div>
                  <p>在某些情况下，V $视图通过使用<code class="codeph">LIST</code>和<code class="codeph">REPORT</code>命令提供不可用的信息。
                  </p>
                  <p>本节介绍V $视图特别有用并包含以下主题的情况。</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="reporting-rman-operations.html#GUID-19ECED3C-ED0A-476F-BC59-38B7A5C5877E" title="RMAN作业是在RMAN会话中执行的一组命令。因此，一个RMAN作业可以包含多个命令。">查询过去和当前RMAN作业的详细信息</a></p>
                     </li>
                     <li>
                        <p><a href="reporting-rman-operations.html#GUID-323B8278-BD20-4278-9770-53E1CF6AC986" title="V $ BACKUP_PIECE和V $ RMAN_BACKUP_PIECE视图的ENCRYPTED列指示备份片段是加密（YES）还是未加密（NO）。">确定备份片的加密状态</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV282"></a><a id="BRADV99967"></a><div class="props_rev_3"><a id="GUID-19ECED3C-ED0A-476F-BC59-38B7A5C5877E" name="GUID-19ECED3C-ED0A-476F-BC59-38B7A5C5877E"></a><h4 id="BRADV-GUID-19ECED3C-ED0A-476F-BC59-38B7A5C5877E" class="sect4"><span class="enumeration_section">11.5.1</span>查询过去和当前RMAN作业的详细信息</h4>
                  <div>
                     <p>RMAN作业是在RMAN会话中执行的一组命令。因此，一个RMAN作业可以包含多个命令。</p>
                     <div class="section">
                        <p>例如，您可以在单个会话中执行两个单独的<code class="codeph">BACKUP</code>命令和一个<code class="codeph">RECOVER COPY</code>命令。<a href="glossary.html#GUID-5CC2A883-9CE5-48B9-A6F7-6443FE0349E5"><span class="xrefglossterm">RMAN备份作业</span></a>是在一个RMAN作业中执行的一组<code class="codeph">BACKUP</code>命令。例如，在同一RMAN作业中执行的<code class="codeph">BACKUP DATABASE</code>和<code class="codeph">BACKUP ARCHIVELOG ALL</code>命令构成单个RMAN备份作业。
                        </p>
                        <p>视图<code class="codeph">V$RMAN_BACKUP_JOB_DETAILS</code>和<code class="codeph">V$RMAN_BACKUP_SUBJOB_DETAILS</code>及其相应的恢复目录版本提供了RMAN备份作业的详细信息。例如，视图显示备份所花费的时间，已发布的备份作业数，每个备份作业的状态（例如，是否失败或已完成），作业何时开始和完成以及备份的类型执行。<code class="codeph">SESSION_KEY</code>列是发生备份作业的RMAN会话的唯一键。
                        </p>
                        <p>RMAN备份的写入次数通常少于读取次数。由于RMAN压缩， <code class="codeph">OUTPUT_BYTES_PER_SEC</code>列不能用作备份速度的度量。测量备份速度的相应列是<code class="codeph">INPUT_BYTES_PER_SEC</code> 。读取和写入数据之间的比率在<code class="codeph">COMPRESSION_RATIO</code>列中描述。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-19ECED3C-ED0A-476F-BC59-38B7A5C5877E__GUID-774785FB-0E7C-48EE-9E05-237140B5B346">要查询有关过去和当前RMAN作业的详细信息：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>将SQL * Plus连接到要查询其备份历史记录的数据库。</span></li>
                        <li class="stepexpand"><span>查询<code class="codeph">V$RMAN_BACKUP_JOB_DETAILS</code>视图，以获取有关备份类型，状态以及开始和结束时间的信息。</span><div>
                              <p>以下查询显示按会话密钥排序的备份作业历史记录，该密钥是RMAN会话的主键：</p><pre class="pre codeblock"><code>COL状态格式a9 COL小时格式化999.99 SELECT SESSION_KEY，INPUT_TYPE，STATUS，TO_CHAR（START_TIME，'mm / dd / yy hh24：mi'）start_time，TO_CHAR（END_TIME，'mm / dd / yy hh24：mi'）end_time，ELAPSED_SECONDS / 3600小时来自V $ RMAN_BACKUP_JOB_DETAILS订购SESSION_KEY;</code></pre><p>以下示例输出显示备份作业历史记录：</p><pre class="pre codeblock"><code>SESSION_KEY INPUT_TYPE状态START_TIME END_TIME HRS ----------- ------------- --------- ----------- --- -------------- ------- 9 DATAFILE FULL COMPLETED 04/18/07 18:14 04/18/07 18:15 .02 16 DB FULL COMPLETED 04/18/07 18:20 04/18/07 18:22 .03 113 ARCHIVELOG COMPLETED 04/23/07 16:04 04/23/07 16:05 .01</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>查询<code class="codeph">V$RMAN_BACKUP_JOB_DETAILS</code>视图，了解RMAN会话中的备份作业的速率。</span><div>
                              <p>以下查询显示按会话密钥排序的备份作业速度，该密钥是RMAN会话的主键。<code class="codeph">in_sec</code>和<code class="codeph">out_sec</code>列显示每秒的数据输入和输出。
                              </p><pre class="pre codeblock"><code>COL in_sec FORMAT a10 COL out_sec FORMAT a10 COL TIME_TAKEN_DISPLAY FORMAT a10 SELECT SESSION_KEY，OPTIMIZED，COMPRESSION_RATIO，INPUT_BYTES_PER_SEC_DISPLAY in_sec，OUTPUT_BYTES_PER_SEC_DISPLAY out_sec，TIME_TAKEN_DISPLAY FROM V $ RMAN_BACKUP_JOB_DETAILS SDER BY SESSION_KEY;</code></pre><p>以下示例输出显示备份作业的速度：</p><pre class="pre codeblock"><code>SESSION_KEY OPT COMPRESSION_RATIO IN_SEC OUT_SEC TIME_TAKEN ----------- --- ----------------- ---------- --- ------- ---------- 9 NO 1 8.24M 8.24M 00:01:14 16 NO 1.32732239 6.77M 5.10M 00:01:45 113 NO 1 2.99M 2.99M 00： 00:44</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>查询<code class="codeph">V$RMAN_BACKUP_JOB_DETAILS</code>视图，了解RMAN会话中备份的大小。</span><div>
                              <p>如果运行<code class="codeph">BACKUP DATABASE</code> ，则<code class="codeph">V$RMAN_BACKUP_JOB_DETAILS.OUTPUT_BYTES</code>显示备份作业为要备份的数据库写入的备份集的总大小。要查看所有已注册数据库的备份集大小，请查询<code class="codeph">V$RMAN_BACKUP_JOB_DETAILS</code> 。</p>
                              <p>以下查询显示按会话密钥排序的备份作业大小和吞吐量，会话密钥是RMAN会话的主键。<code class="codeph">in_size</code>和<code class="codeph">out_size</code>列显示每秒的数据输入和输出。
                              </p><pre class="pre codeblock"><code>COL in_size FORMAT a10 COL out_size FORMAT a10 SELECT SESSION_KEY，INPUT_TYPE，COMPRESSION_RATIO，INPUT_BYTES_DISPLAY in_size，OUTPUT_BYTES_DISPLAY out_size FROM V $ RMAN_BACKUP_JOB_DETAILS ORDER BY SESSION_KEY;</code></pre><p>以下示例输出显示了备份作业的大小：</p><pre class="pre codeblock"><code>SESSION_KEY INPUT_TYPE COMPRESSION_RATIO IN_SIZE OUT_SIZE ----------- ------------- ----------------- ---- ------ ---------- 10 DATAFILE FULL 1 602.50M 602.58M 17 DB FULL 1.13736669 634.80M 558.13M</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-19ECED3C-ED0A-476F-BC59-38B7A5C5877E__GUID-6465A0E4-620B-4D90-9989-E494811AE0E5">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../refrn/V-RMAN_BACKUP_JOB_DETAILS.html#REFRN30391" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">V$RMAN_BACKUP_JOB_DETAILS</code>视图</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV90912"></a><div class="props_rev_3"><a id="GUID-323B8278-BD20-4278-9770-53E1CF6AC986" name="GUID-323B8278-BD20-4278-9770-53E1CF6AC986"></a><h4 id="BRADV-GUID-323B8278-BD20-4278-9770-53E1CF6AC986" class="sect4"><span class="enumeration_section">11.5.2</span>确定备份片的加密状态</h4>
                  <div>
                     <p><code class="codeph">V$BACKUP_PIECE</code>和<code class="codeph">V$RMAN_BACKUP_PIECE</code>视图的<code class="codeph">ENCRYPTED</code>列指示备份片段是加密（ <code class="codeph">YES</code> ）还是未加密（ <code class="codeph">NO</code> ）。
                     </p>
                     <div class="section">
                        <p>例如，您可以在SQL * Plus中运行以下查询以确定哪些备份片段已加密：</p><pre class="pre codeblock"><code>COL BS_REC格式99999 COL BP_REC格式99999 COL MB格式9999999 COL加密格式A7 COL标签格式A25选择S.RECID作为“BS_REC”，P.RECID作为“BP_REC”，P.ENCRYPTED，P.TAG，P.HANDLE AS“ MEDIA_HANDLE“FROM V $ BACKUP_PIECE P，V $ BACKUP_SET S WHERE P.SET_STAMP = S.SET_STAMP AND P.SET_COUNT = S.SET_COUNT;</code></pre><p>以下示例输出显示备份已加密：</p><pre class="pre codeblock"><code>BS_REC BP_REC ENCRYPT TAG ------ ------ ------- ------------------------- MEDIA_HANDLE  - -------------------------------------------------- ----------------------------- 1 1 YES TAG20070711T140124 / disk1 / c-39525561-20070711-00 2 2 YES TAG20070711T140128 / disk1 / c-39525561-20070711-01 3 3是TAG20070711T140130 / disk1 / c-39525561-20070711-02</code></pre><div class="infoboxnotealso" id="GUID-323B8278-BD20-4278-9770-53E1CF6AC986__GUID-97012501-608B-409E-A9D1-8399833B9B75">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=REFRN30023" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">V$BACKUP_PIECE</code>视图</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV89601"></a><div class="props_rev_3"><a id="GUID-C48F1F48-E11D-4DA4-AB54-6D7EB4CA8957" name="GUID-C48F1F48-E11D-4DA4-AB54-6D7EB4CA8957"></a><h3 id="BRADV-GUID-C48F1F48-E11D-4DA4-AB54-6D7EB4CA8957" class="sect3"><span class="enumeration_section">11.6</span>查询恢复目录视图</h3>
               <div>
                  <p><code class="codeph">LIST</code> ， <code class="codeph">REPORT</code>和<code class="codeph">SHOW</code>命令提供了访问控制文件和恢复目录中数据的最简单方法。
                  </p>
                  <p>但是，您有时也可以从恢复目录视图中获取有用信息，这些视图驻留在恢复目录模式中并使用<code class="codeph">RC_</code>前缀。
                  </p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="reporting-rman-operations.html#GUID-09997497-FAAC-4877-8D0E-44333752FF46" title="RMAN从目标数据库控制文件中获取备份和恢复元数据，并将其存储在恢复目录的表中。恢复目录视图是从这些表派生的。恢复目录视图未针对用户查询进行规范化或优化。">关于恢复目录视图</a></p>
                     </li>
                     <li>
                        <p><a href="reporting-rman-operations.html#GUID-93421D43-DFBA-4267-BFEB-C9716B6B0963" title="DB_KEY值是注册数据库的主键，仅在恢复目录中使用。最简单的方法是获取DB_KEY是使用目标数据库的DBID，每当您将RMAN作为TARGET连接到数据库时，都会显示该DBID。">查询目标DB_KEY或DBID值的目录视图</a></p>
                     </li>
                     <li>
                        <p><a href="reporting-rman-operations.html#GUID-57512E48-D371-4B1C-A176-B5812BC265B2" title="您可以查询视图RC_BACKUP_FILES，以获取有关在恢复目录中注册的任何数据库的所有备份的信息。但是，在查询RC_BACKUP_FILES之前，必须调用DBMS_RCVMAN.SETDATABASE过程。">查询RC_BACKUP_FILES</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89602"></a><div class="props_rev_3"><a id="GUID-09997497-FAAC-4877-8D0E-44333752FF46" name="GUID-09997497-FAAC-4877-8D0E-44333752FF46"></a><h4 id="BRADV-GUID-09997497-FAAC-4877-8D0E-44333752FF46" class="sect4"><span class="enumeration_section">11.6.1</span>关于恢复目录视图</h4>
                  <div>
                     <p>RMAN从目标数据库控制文件中获取备份和恢复元数据，并将其存储在恢复目录的表中。恢复目录视图是从这些表派生的。恢复目录视图未针对用户查询进行规范化或优化。</p>
                     <p>通常，恢复目录视图不像RMAN报告命令那样用户友好。例如，当您启动RMAN并连接到目标数据库时，只有在发出<code class="codeph">LIST</code> ， <code class="codeph">REPORT</code>和<code class="codeph">SHOW</code>命令时才能获取此目标数据库的信息。如果在同一恢复目录中注册了10个不同的目标数据库，则目录视图的任何查询都会显示所有10个数据库的所有化身的元数据。您通常必须在视图之间执行复杂的选择和连接，以提取有关数据库<a href="glossary.html#GUID-4CCAB7DD-FEA7-4237-AF2C-304BA3BD52B1"><span class="xrefglossterm">化身的</span></a>有用信息。
                     </p>
                     <p>大多数目录视图在数据库中都有相应的<code class="codeph">V$</code>视图。例如， <code class="codeph">RC_BACKUP_PIECE</code>对应于<code class="codeph">V$BACKUP_PIECE</code> 。恢复目录视图和相应的<code class="codeph">V$</code>视图之间的主要区别是每个恢复目录视图都包含有关在恢复目录中注册的<span class="italic">所有</span>目标数据库的元数据。<code class="codeph">V$</code>视图仅包含有关其自身的信息。
                     </p>
                     <div class="infoboxnotealso" id="GUID-09997497-FAAC-4877-8D0E-44333752FF46__GUID-73FD9B64-35DB-4678-96A4-681700E75ED4">
                        <p class="notep1">也可以看看：</p>
                        <p>有关恢复目录视图的说明，请<a href="../rcmrf/recovery-catalog-views.html#RCMRF003" target="_blank"><span><cite>参见Oracle数据库备份和恢复参考</cite></span></a></p>
                     </div>
                  </div><a id="BRADV89603"></a><div class="props_rev_3"><a id="GUID-C980FFD5-1D65-4AF7-B8EB-9FB29EF0B25D" name="GUID-C980FFD5-1D65-4AF7-B8EB-9FB29EF0B25D"></a><h5 id="BRADV-GUID-C980FFD5-1D65-4AF7-B8EB-9FB29EF0B25D" class="sect5"><span class="enumeration_section">11.6.1.1</span>关于已注册数据库的唯一标识符</h5>
                     <div>
                        <p>大多数恢复目录视图包含<code class="codeph">DB_KEY</code>和<code class="codeph">DBINC_KEY</code>列。可以通过主键（ <code class="codeph">DB_KEY</code>列值）或<code class="codeph">DBID</code> （32位唯一数据库标识符）唯一标识在恢复目录中注册的每个数据库。数据库的每个版本都由<code class="codeph">DBINC_KEY</code>列唯一标识。
                        </p>
                        <p>您可以使用<code class="codeph">DB_KEY</code>和<code class="codeph">DBINC_KEY</code>来检索目标数据库的特定化身的记录。然后，您可以与大多数其他目录视图执行连接，以隔离属于此化身的记录。
                        </p>
                        <p>目录和<code class="codeph">V$</code>视图之间的一个重要区别是，不同的唯一标识符系统用于备份和恢复文件。例如，许多<code class="codeph">V$</code>视图（如<code class="codeph">V$ARCHIVED_LOG</code>使用<code class="codeph">RECID</code>和<code class="codeph">STAMP</code>列来形成连接的主键。相应的恢复目录视图使用派生值作为其主键，并将此值存储在单个列中。例如， <code class="codeph">RC_ARCHIVED_LOG</code>的主键是<code class="codeph">AL_KEY</code>列。<code class="codeph">AL_KEY</code>列值是RMAN在<code class="codeph">LIST</code>命令输出中显示的主键。
                        </p>
                     </div>
                  </div><a id="BRADV89604"></a><div class="props_rev_3"><a id="GUID-7130E16B-67B7-430C-9990-26E5B9A916BD" name="GUID-7130E16B-67B7-430C-9990-26E5B9A916BD"></a><h5 id="BRADV-GUID-7130E16B-67B7-430C-9990-26E5B9A916BD" class="sect5"><span class="enumeration_section">11.6.1.2</span>关于Data Guard环境中的唯一标识符</h5>
                     <div>
                        <p>在Data Guard环境中查询恢复目录时，需要考虑特殊注意事项。</p>
                        <p>在Data Guard环境中，多个数据库共享相同的DBID。多个视图包含<code class="codeph">DB_UNIQUE_NAME</code>列，该列指示记录所属的数据库化身的<code class="codeph">DB_UNIQUE_NAME</code> 。Data Guard环境中的所有数据库共享相同的DBID，但具有不同的<code class="codeph">DB_UNIQUE_NAME</code>值。
                        </p>
                        <p><code class="codeph">DB_UNIQUE_NAME</code>目录不知道数据库名称，则<code class="codeph">DB_UNIQUE_NAME</code>值为<code class="codeph">null</code> ，对于在恢复目录中注册的Oracle9 <span class="italic">i</span>数据库。此外，当数据库升级到Oracle Database <span class="italic">11g</span>或更高版本时，列值为<code class="codeph">null</code> ，但恢复目录架构尚未协调所有文件的数据库名称。
                        </p>
                        <p>在恢复目录视图中，主数据库及其关联的备用数据库共享相同的<code class="codeph">DB_KEY</code> 。但是，Data Guard环境中的每个数据库都具有唯一的<code class="codeph">RC_SITE.SITE_KEY</code>值。例如，主数据库<code class="codeph">prod</code>及其备用数据库<code class="codeph">standby1</code>的<code class="codeph">DB_KEY</code>值均为1，而<code class="codeph">prod</code>的<code class="codeph">SITE_KEY</code>为3， <code class="codeph">standby1</code>的<code class="codeph">SITE_KEY</code>为30。
                        </p>
                        <p>某些恢复目录视图没有<code class="codeph">DB_UNIQUE_NAME</code>列，但包含<code class="codeph">SITE_KEY</code>列。您可以使用<code class="codeph">SITE_KEY</code>列与<code class="codeph">RC_SITE.SITE_KEY</code>连接，以确定与文件关联的数据库的<code class="codeph">DB_UNIQUE_NAME</code> 。如<span class="q">“ <a href="rman-architecture.html#GUID-E514F9D2-D96E-4087-B8C5-5A8EB6A44E6B" title="RMAN使用恢复目录来跟踪Data Guard环境中所有数据库文件的文件名。">关于Data Guard环境中的RMAN文件管理”中所述，Data Guard环境中的</a></span>每个文件都与创建它的主数据库或备用数据库相关联。
                        </p>
                        <div class="infoboxnotealso" id="GUID-7130E16B-67B7-430C-9990-26E5B9A916BD__GUID-462F8DEA-17EA-49BD-B370-6043F0A16056">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=SBYDB04700" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a> ，了解如何在Data Guard环境中报告和管理文件</p>
                        </div>
                     </div>
                  </div>
               </div><a id="BRADV283"></a><a id="BRADV89605"></a><div class="props_rev_3"><a id="GUID-93421D43-DFBA-4267-BFEB-C9716B6B0963" name="GUID-93421D43-DFBA-4267-BFEB-C9716B6B0963"></a><h4 id="BRADV-GUID-93421D43-DFBA-4267-BFEB-C9716B6B0963" class="sect4"><span class="enumeration_section">11.6.2</span>查询目标DB_KEY或DBID值的目录视图</h4>
                  <div>
                     <p><code class="codeph">DB_KEY</code>值是注册数据库的主键，仅在恢复目录中使用。最简单的方法是获取<code class="codeph">DB_KEY</code>是使用目标数据库的DBID，每当您将RMAN作为<code class="codeph">TARGET</code>连接到数据库时，都会显示该DBID。</p>
                     <div class="section">
                        <p>DBID区分RMAN恢复目录中注册的数据库。</p>
                        <p>假设您要获取有关在恢复目录中注册的数据库的信息。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-93421D43-DFBA-4267-BFEB-C9716B6B0963__GUID-6F9FCFD5-25B0-411E-A307-69EA5BFD7D81">要查询目录以获取有关数据库当前版本的信息：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>确定要查看其记录的数据库的DBID。</span><div>
                              <p>您可以通过查看RMAN连接到数据库时显示的输出，查询<code class="codeph">V$RMAN_OUTPUT</code>或查询<code class="codeph">V$DATABASE</code>视图来获取DBID。以下示例将SQL * Plus连接到所需的数据库并查询DBID：</p><pre class="pre codeblock"><code>SQL&gt; CONNECT / AS SYSBACKUP SQL&gt; SELECT DBID 2 FROM V $ DATABASE; DBID --------- 598368217</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>启动SQL * Plus并以恢复目录的所有者身份连接到恢复目录数据库。</span></li>
                        <li class="stepexpand"><span>获取在步骤1中获取其DBID的数据库的数据库密钥。</span><div>
                              <p>要获取数据库的<code class="codeph">DB_KEY</code> ，请运行以下查询，其中<span class="italic"><code class="codeph">dbid_of_target</code></span>是在步骤1中获取的DBID：</p><pre class="pre codeblock"><code>SELECT DB_KEY FROM RC_DATABASE WHERE DBID = <span class="italic">dbid_of_target</span> ;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>查询在步骤1中获取DBID的数据库当前版本的记录。</span><div>
                              <p>要获取有关目标数据库当前化身的信息，请指定目标数据库<code class="codeph">DB_KEY</code>值并使用<code class="codeph">RC_DATABASE_INCARNATION</code>视图执行连接。使用<code class="codeph">WHERE</code>条件指定<code class="codeph">CURRENT_INCARNATION</code>列值设置为<code class="codeph">YES</code> 。例如，要获取有关<code class="codeph">DB_KEY</code>值为<code class="codeph">1</code>的目标数据库的当前版本中的备份集的信息，请按以下方式查询：</p><pre class="pre codeblock"><code>SELECT BS_KEY，BACKUP_TYPE，COMPLETION_TIME FROM RC_DATABASE_INCARNATION i，RC_BACKUP_SET b我在哪里。DB_KEY = 1和我。DB_KEY = b。DB_KEY和我。CURRENT_INCARNATION ='是';</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-93421D43-DFBA-4267-BFEB-C9716B6B0963__GUID-6871BCC1-759E-4FA7-BD1D-E9BF8891F5D2">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">RC_DATABASE_INCARNATION</code>视图的详细信息，请<a href="../rcmrf/RC_DATABASE_INCARNATION.html#RCMRF174" target="_blank"><span><cite>参见Oracle数据库备份和恢复参考</cite></span></a></p>
                              </li>
                              <li>
                                 <p><a href="rman-data-repair-concepts.html#GUID-9942AC94-A35D-4A06-9A45-A5A43B82B23D" title="只要使用RESETLOGS选项打开数据库，就会创建数据库化身。">关于数据库化身</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV53532"></a><div class="props_rev_3"><a id="GUID-57512E48-D371-4B1C-A176-B5812BC265B2" name="GUID-57512E48-D371-4B1C-A176-B5812BC265B2"></a><h4 id="BRADV-GUID-57512E48-D371-4B1C-A176-B5812BC265B2" class="sect4"><span class="enumeration_section">11.6.3</span>查询RC_BACKUP_FILES</h4>
                  <div>
                     <p>您可以查询视图<code class="codeph">RC_BACKUP_FILES</code>以获取有关在恢复目录中注册的任何数据库的所有备份的信息。但是，在查询<code class="codeph">RC_BACKUP_FILES</code>之前，必须调用<code class="codeph">DBMS_RCVMAN.SETDATABASE</code>过程。
                     </p>
                     <div class="section">
                        <p>指定在恢复目录中注册的数据库的DBID，如以下示例所示：</p><pre class="pre codeblock"><code>SQL&gt; CALL DBMS_RCVMAN.SETDATABASE（null，null，null，2283997583）;</code></pre><p>第四个参数必须是在恢复目录中注册的数据库的DBID。其他参数必须全为<code class="codeph">NULL</code> 。</p>
                        <div class="infoboxnotealso" id="GUID-57512E48-D371-4B1C-A176-B5812BC265B2__GUID-E938298D-50D3-4713-9B77-FA6B06E63831">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">RC_BACKUP_FILES</code>视图的详细信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF1670" target="_blank"><span><cite>参见Oracle数据库备份和恢复参考</cite></span></a></p>
                              </li>
                              <li>
                                 <p><a href="rman-complete-database-recovery.html#GUID-34BB2E4B-B2FC-4701-BB65-BFED027DB865" title="It is recommended that you record the DBID of your database.">确定数据库</a>的DBID以确定<a href="rman-complete-database-recovery.html#GUID-34BB2E4B-B2FC-4701-BB65-BFED027DB865" title="建议您记录数据库的DBID。">数据库的DBID的</a>技术</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>