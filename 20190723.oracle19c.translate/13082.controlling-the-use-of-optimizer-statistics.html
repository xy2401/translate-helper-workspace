<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="Using DBMS_STATS, you can specify when and how the optimizer uses statistics."></meta>
      <meta name="description" content="Using DBMS_STATS, you can specify when and how the optimizer uses statistics."></meta>
      <title>控制优化程序统计信息的使用</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="SQL Tuning Guide"></meta>
      <meta property="og:description" content="Using DBMS_STATS, you can specify when and how the optimizer uses statistics."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="SQL Tuning Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="sql-tuning-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-31T14:57:08-08:00"></meta>
      <meta name="dcterms.title" content="SQL Tuning Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="2013, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96095-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="managing-extended-statistics.html" title="Previous" type="text/html"></link>
      <link rel="next" href="managing-historical-optimizer-statistics.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGSQL"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="managing-extended-statistics.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="managing-historical-optimizer-statistics.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL调优指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="optimizer-statistics.html" property="item" typeof="WebPage"><span property="name">优化器统计</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">控制优化程序统计信息的使用</li>
            </ol>
            <a id="GUID-6D85C813-5FBF-4655-ACE5-1E50DB4F8E60" name="GUID-6D85C813-5FBF-4655-ACE5-1E50DB4F8E60"></a>
            
            <h2 id="TGSQL-GUID-6D85C813-5FBF-4655-ACE5-1E50DB4F8E60" class="sect2"><span class="enumeration_chapter">15</span>控制优化程序统计信息的使用</h2>
         </header>
         <div class="ind">
            <div>
               <p>使用<code class="codeph">DBMS_STATS</code> ，您可以指定优化程序何时以及如何使用统计信息。
               </p>
               <p>本节包含以下主题：</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-1147FF89-68F0-4B0F-831A-A7E5D151D02F">锁定和解锁优化程序统计信息</a><br>您可以锁定统计信息以防止更改。
                  </li>
                  <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-8FF503A2-5E50-4054-AC3A-5672343BDFE3">发布待定优化程序统计信息</a><br>默认情况下，数据库会在统计信息收集结束时自动发布统计信息。
                  </li>
                  <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-87A26DD9-E2C1-41E3-9EF0-D141F44F0968">为测试创建人工优化器统计信息</a><br>要为优化程序提供用户创建的统计信息以进行测试，可以使用<code class="codeph">DBMS_STATS.SET_*_STATS</code>过程。这些过程为优化程序提供指定统计信息的人工值。
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="optimizer-statistics.html#GUID-0A2F3D52-A135-43E1-9CAB-55BFE068A297" title="执行计划的准确性取决于优化程序统计信息的质量。">优化程序统计信息</a></p>
                  </div>
               </div>
            </div>
            <a id="TGSQL489"></a><div class="props_rev_3"><a id="GUID-1147FF89-68F0-4B0F-831A-A7E5D151D02F" name="GUID-1147FF89-68F0-4B0F-831A-A7E5D151D02F"></a><h3 id="TGSQL-GUID-1147FF89-68F0-4B0F-831A-A7E5D151D02F" class="sect3"><span class="enumeration_section">15.1</span>锁定和解锁优化器统计信息</h3>
               <div>
                  <p>您可以锁定统计信息以防止更改。</p>
                  <p>锁定统计信息后，在统计信息解锁之前，您无法修改统计信息。当您希望保证统计信息和生成的计划永远不会更改时，锁定过程在静态环境中很有用。例如，您可能希望防止<code class="codeph">DBMS_STATS_JOB</code>进程在表或模式上收集新统计信息，例如高度易变的表。
                  </p>
                  <p>锁定表上的统计信息时，将锁定所有相关统计信息。锁定的统计信息包括表统计信息，列统计信息，直方图和依赖索引统计信息。要在统计信息被锁定时覆盖统计信息，您可以将各种<code class="codeph">DBMS_STATS</code>过程中的<code class="codeph">FORCE</code>参数值（例如， <code class="codeph">DELETE_*_STATS</code>和<code class="codeph">RESTORE_*_STATS</code> ）设置为<code class="codeph">true</code> 。
                  </p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-F9BB2D09-BAED-466A-9953-B93442AD8E4A">锁定统计数据</a><br><code class="codeph">DBMS_STATS</code>包提供了两个锁定统计信息的过程： <code class="codeph">LOCK_SCHEMA_STATS</code>和<code class="codeph">LOCK_TABLE_STATS</code> 。</li>
                     <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-C6ACF2CB-DD6F-4977-863F-0ECE04BEF8B0">解锁统计数据</a><br><code class="codeph">DBMS_STATS</code>包提供了两个解锁统计信息的过程： <code class="codeph">UNLOCK_SCHEMA_STATS</code>和<code class="codeph">UNLOCK_TABLE_STATS</code> 。</li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-6D85C813-5FBF-4655-ACE5-1E50DB4F8E60" title="使用DBMS_STATS，您可以指定优化程序何时以及如何使用统计信息。">控制优化程序统计信息的使用</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL491"></a><a id="TGSQL490"></a><div class="props_rev_3"><a id="GUID-F9BB2D09-BAED-466A-9953-B93442AD8E4A" name="GUID-F9BB2D09-BAED-466A-9953-B93442AD8E4A"></a><h4 id="TGSQL-GUID-F9BB2D09-BAED-466A-9953-B93442AD8E4A" class="sect4"><span class="enumeration_section">15.1.1</span>锁定统计数据</h4>
                  <div>
                     <p><code class="codeph">DBMS_STATS</code>包提供了两个锁定统计信息的过程： <code class="codeph">LOCK_SCHEMA_STATS</code>和<code class="codeph">LOCK_TABLE_STATS</code> 。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-F9BB2D09-BAED-466A-9953-B93442AD8E4A__GUID-140446A6-13CA-4B5C-A213-1EFA83A77E51">假设</p>
                        <p>本教程假设以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您收集了有关<code class="codeph">oe.orders</code>表和<code class="codeph">hr</code>模式的统计信息。
                              </p>
                           </li>
                           <li>
                              <p>您希望阻止<code class="codeph">oe.orders</code>表统计信息和<code class="codeph">hr</code>模式统计信息更改。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-F9BB2D09-BAED-466A-9953-B93442AD8E4A__GUID-AC4C5ABC-2A37-4BE1-8189-224014B99C4A">锁定统计信息：</p>
                        <ol>
                           <li>
                              <p>启动SQL * Plus并以<code class="codeph">oe</code>用户身份连接到数据库。
                              </p>
                           </li>
                           <li>
                              <p>锁定<code class="codeph">oe.orders</code>的统计数据。
                              </p>
                              <p>例如，执行以下PL / SQL程序：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.LOCK_TABLE_STATS（'OE'，'ORDERS'）;结束; /</code></pre></li>
                           <li>
                              <p>以<code class="codeph">hr</code>用户身份连接到数据库。
                              </p>
                           </li>
                           <li>
                              <p>锁定<code class="codeph">hr</code>模式中的统计信息。
                              </p>
                              <p>例如，执行以下PL / SQL程序：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.LOCK_SCHEMA_STATS（'HR'）;结束; /</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-F9BB2D09-BAED-466A-9953-B93442AD8E4A__GUID-74D20336-6542-4E43-AED3-7C159A12F281">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-77225DE6-28D1-4064-9531-87BB1CFB4405" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_STATS.LOCK_TABLE_STATS</code>过程</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-1147FF89-68F0-4B0F-831A-A7E5D151D02F" title="您可以锁定统计信息以防止更改。">锁定和解锁优化程序统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL493"></a><a id="TGSQL492"></a><div class="props_rev_3"><a id="GUID-C6ACF2CB-DD6F-4977-863F-0ECE04BEF8B0" name="GUID-C6ACF2CB-DD6F-4977-863F-0ECE04BEF8B0"></a><h4 id="TGSQL-GUID-C6ACF2CB-DD6F-4977-863F-0ECE04BEF8B0" class="sect4"><span class="enumeration_section">15.1.2</span>解锁统计数据</h4>
                  <div>
                     <p><code class="codeph">DBMS_STATS</code>包提供了两个解锁统计信息的过程： <code class="codeph">UNLOCK_SCHEMA_STATS</code>和<code class="codeph">UNLOCK_TABLE_STATS</code> 。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-C6ACF2CB-DD6F-4977-863F-0ECE04BEF8B0__GUID-64241D18-BBD8-4143-9BF9-593A2DBF2FC8">假设</p>
                        <p>本教程假设以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您锁定了<code class="codeph">oe.orders</code>表和<code class="codeph">hr</code>模式的统计信息。
                              </p>
                           </li>
                           <li>
                              <p>您想解锁这些统计信息。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C6ACF2CB-DD6F-4977-863F-0ECE04BEF8B0__GUID-A8E781A4-A2C3-428A-8CA7-58EBD4F7EE9F">解锁统计信息：</p>
                        <ol>
                           <li>
                              <p>启动SQL * Plus并以<code class="codeph">oe</code>用户身份连接到数据库。
                              </p>
                           </li>
                           <li>
                              <p>解锁<code class="codeph">oe.orders</code>的统计数据。
                              </p>
                              <p>例如，执行以下PL / SQL程序：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.UNLOCK_TABLE_STATS（'OE'，'ORDERS'）;结束; /</code></pre></li>
                           <li>
                              <p>以<code class="codeph">hr</code>用户身份连接到数据库。
                              </p>
                           </li>
                           <li>
                              <p>解锁<code class="codeph">hr</code>模式中的统计信息。
                              </p>
                              <p>例如，执行以下PL / SQL程序：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.UNLOCK_SCHEMA_STATS（'HR'）;结束; /</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-C6ACF2CB-DD6F-4977-863F-0ECE04BEF8B0__GUID-B1E91BD1-0A2C-4099-A72A-8A08E9FADB3E">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-690DF3FA-E225-4959-8836-5458F17217D5" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_STATS.UNLOCK_TABLE_STATS</code>过程</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-1147FF89-68F0-4B0F-831A-A7E5D151D02F" title="您可以锁定统计信息以防止更改。">锁定和解锁优化程序统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL456"></a><div class="props_rev_3"><a id="GUID-8FF503A2-5E50-4054-AC3A-5672343BDFE3" name="GUID-8FF503A2-5E50-4054-AC3A-5672343BDFE3"></a><h3 id="TGSQL-GUID-8FF503A2-5E50-4054-AC3A-5672343BDFE3" class="sect3"><span class="enumeration_section">15.2</span>发布待定优化程序统计信息</h3>
               <div>
                  <p>默认情况下，数据库会在统计信息收集结束时自动发布统计信息。</p>
                  <p>或者，您可以使用<a href="glossary.html#GUID-080D2B1E-AD95-43A4-9361-D9FB9C101D11"><span class="xrefglossterm">挂起的统计信息</span></a>来保存统计信息，而不是在收集后立即发布它们。此技术对于在具有挂起统计信息的会话中测试查询非常有用。当测试结果令人满意时，您可以发布统计信息以使其可用于整个数据库。
                  </p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-8244B238-B835-4121-8FB2-D6213104E21A">关于待定优化程序统计信息</a><br>数据库在数据字典中存储挂起的统计信息，就像发布的统计信息一样
                     </li>
                     <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-A511A414-B777-4CCC-A5B8-AA2F74A3A663">用于发布优化程序统计信息的用户界面</a><br>您可以使用<code class="codeph">DBMS_STATS</code>包执行与发布统计信息相关的操作。
                     </li>
                     <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-28D2C31D-889F-4C21-8618-100BC3A72856">管理已发布和待定统计</a><br>本节介绍如何使用<code class="codeph">DBMS_STATS</code>程序单元更改优化程序统计信息的发布行为，以及导出和删除这些统计信息。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-6D85C813-5FBF-4655-ACE5-1E50DB4F8E60" title="使用DBMS_STATS，您可以指定优化程序何时以及如何使用统计信息。">控制优化程序统计信息的使用</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL457"></a><div class="props_rev_3"><a id="GUID-8244B238-B835-4121-8FB2-D6213104E21A" name="GUID-8244B238-B835-4121-8FB2-D6213104E21A"></a><h4 id="TGSQL-GUID-8244B238-B835-4121-8FB2-D6213104E21A" class="sect4"><span class="enumeration_section">15.2.1</span>关于待定优化程序统计信息</h4>
                  <div>
                     <p>数据库在数据字典中存储挂起的统计信息，就像发布的统计信息一样</p>
                     <p>默认情况下，优化程序使用发布的统计信息。您可以通过将<code class="codeph">OPTIMIZER_USE_PENDING_STATISTICS</code>初始化参数设置为<code class="codeph">true</code>来更改默认行为（默认值为<code class="codeph">false</code> ）。
                     </p>
                     <p>下图的顶部显示了优化器收集<code class="codeph">sh.customers</code>表的统计信息，并将它们存储在具有挂起状态的数据字典中。该图的底部显示了优化器仅使用已发布的统计信息来处理<code class="codeph">sh.customers</code>的查询。
                     </p>
                     <div class="figure" id="GUID-8244B238-B835-4121-8FB2-D6213104E21A__CHDEDCHI">
                        <p class="titleinfigure">图15-1已发布和待定统计</p><img src="img/tgsql_vm_039.png" alt="下面是图15-1的描述" title="下面是图15-1的描述" longdesc="img_text/tgsql_vm_039.html"><br><a href="img_text/tgsql_vm_039.html">“图15-1已发布和待定统计”的说明</a></div>
                     <!-- class="figure" -->
                     <p>在某些情况下，优化程序可以使用已发布和未决统计信息的组合。例如，数据库存储<code class="codeph">customers</code>表的已发布和待处理统计信息。对于<code class="codeph">orders</code>表，数据库仅存储已发布的统计信息。如果<code class="codeph">OPTIMIZER_USE_PENDING_STATS = true</code> ，则优化程序将使用<code class="codeph">customers</code>待处理统计信息和已发布的<code class="codeph">orders</code>统计信息。如果<code class="codeph">OPTIMIZER_USE_PENDING_STATS = false</code> ，则优化程序会使用已发布的<code class="codeph">customers</code>和<code class="codeph">orders</code>统计信息。
                     </p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-8244B238-B835-4121-8FB2-D6213104E21A__GUID-931891E4-EA6B-4C2E-AEF3-C25003C64E38">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../refrn/OPTIMIZER_USE_PENDING_STATISTICS.html#REFRN10288" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">OPTIMIZER_USE_PENDING_STATISTICS</code>初始化参数</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-8FF503A2-5E50-4054-AC3A-5672343BDFE3" title="默认情况下，数据库会在统计信息收集结束时自动发布统计信息。">发布待定优化程序统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL459"></a><a id="TGSQL94929"></a><a id="TGSQL458"></a><div class="props_rev_3"><a id="GUID-A511A414-B777-4CCC-A5B8-AA2F74A3A663" name="GUID-A511A414-B777-4CCC-A5B8-AA2F74A3A663"></a><h4 id="TGSQL-GUID-A511A414-B777-4CCC-A5B8-AA2F74A3A663" class="sect4"><span class="enumeration_section">15.2.2</span>用于发布优化程序统计信息的用户界面</h4>
                  <div>
                     <p>您可以使用<code class="codeph">DBMS_STATS</code>包执行与发布统计信息相关的操作。
                     </p>
                     <div class="section">
                        <p>下表列出了相关的程序单元。</p>
                        <div class="tblformal" id="GUID-A511A414-B777-4CCC-A5B8-AA2F74A3A663__CHDEFDGF">
                           <p class="titleintable">表15-1与发布优化程序统计信息相关的DBMS_STATS程序单位</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_STATS与发布优化程序统计信息相关的程序单位" width="100%" border="1" summary="Parameters for the create_extended_statistics Function" frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="39%" id="d86157e1201">方案股</th>
                                    <th align="left" valign="bottom" width="61%" id="d86157e1204">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="39%" id="d86157e1209" headers="d86157e1201 ">
                                       <p><code class="codeph">GET_PREFS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="61%" headers="d86157e1209 d86157e1204 ">
                                       <p>检查<code class="codeph">DBMS_STATS</code>收集统计信息后是否自动发布。对于参数<code class="codeph">PUBLISH</code> ， <code class="codeph">true</code>表示必须在数据库收集统计信息时发布统计信息，而<code class="codeph">false</code>表示数据库必须保持统计信息挂起。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="39%" id="d86157e1229" headers="d86157e1201 ">
                                       <p><code class="codeph">SET_TABLE_PREFS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="61%" headers="d86157e1229 d86157e1204 ">
                                       <p>在表级别将<code class="codeph">PUBLISH</code>设置设置为<code class="codeph">true</code>或<code class="codeph">false</code> 。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="39%" id="d86157e1246" headers="d86157e1201 ">
                                       <p><code class="codeph">SET_SCHEMA_PREFS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="61%" headers="d86157e1246 d86157e1204 ">
                                       <p>在架构级别将<code class="codeph">PUBLISH</code>设置设置为<code class="codeph">true</code>或<code class="codeph">false</code> 。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="39%" id="d86157e1263" headers="d86157e1201 ">
                                       <p><code class="codeph">PUBLISH_PENDING_STATS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="61%" headers="d86157e1263 d86157e1204 ">
                                       <p>发布所有对象或仅指定对象的有效挂起统计信息。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="39%" id="d86157e1271" headers="d86157e1201 ">
                                       <p><code class="codeph">DELETE_PENDING_STATS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="61%" headers="d86157e1271 d86157e1204 ">
                                       <p>删除待处理的统计</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="39%" id="d86157e1279" headers="d86157e1201 ">
                                       <p><code class="codeph">EXPORT_PENDING_STATS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="61%" headers="d86157e1279 d86157e1204 ">
                                       <p>导出待定统计。</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>初始化参数<code class="codeph">OPTIMIZER_USE_PENDING_STATISTICS</code>确定数据库在可用时是否使用挂起的统计信息。默认值为<code class="codeph">false</code> ，这意味着优化程序仅使用已发布的统计信息。设置为<code class="codeph">true</code>以指定优化程序使用任何现有的挂起统计信息。最佳做法是在会话级别而不是在数据库级别设置此参数。
                        </p>
                        <p>您可以使用数据字典视图中已发布统计信息的访问信息。<a href="controlling-the-use-of-optimizer-statistics.html#GUID-A511A414-B777-4CCC-A5B8-AA2F74A3A663__CHDJFDDD" title="create_extended_statistics函数的参数">表15-2</a>列出了相关视图。
                        </p>
                        <div class="tblformal" id="GUID-A511A414-B777-4CCC-A5B8-AA2F74A3A663__CHDJFDDD">
                           <p class="titleintable">表15-2与发布优化程序统计信息相关的视图</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="与发布优化程序统计信息相关的视图" width="100%" border="1" summary="Parameters for the create_extended_statistics Function" frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="43%" id="d86157e1314">视图</th>
                                    <th align="left" valign="bottom" width="57%" id="d86157e1317">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="43%" id="d86157e1322" headers="d86157e1314 ">
                                       <p><code class="codeph">USER_TAB_STATISTICS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="57%" headers="d86157e1322 d86157e1317 ">
                                       <p>显示当前用户可访问的表的优化程序统计信息。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="43%" id="d86157e1330" headers="d86157e1314 ">
                                       <p><code class="codeph">USER_TAB_COL_STATISTICS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="57%" headers="d86157e1330 d86157e1317 ">
                                       <p>显示从<code class="codeph">ALL_TAB_COLUMNS</code>提取的列统计信息和直方图信息。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="43%" id="d86157e1341" headers="d86157e1314 ">
                                       <p><code class="codeph">USER_PART_COL_STATISTICS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="57%" headers="d86157e1341 d86157e1317 ">
                                       <p>显示当前用户拥有的表分区的列统计信息和直方图信息。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="43%" id="d86157e1349" headers="d86157e1314 ">
                                       <p><code class="codeph">USER_SUBPART_COL_STATISTICS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="57%" headers="d86157e1349 d86157e1317 ">
                                       <p>描述当前用户拥有的分区对象的子分区的列统计信息和直方图信息。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="43%" id="d86157e1357" headers="d86157e1314 ">
                                       <p><code class="codeph">USER_IND_STATISTICS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="57%" headers="d86157e1357 d86157e1317 ">
                                       <p>显示当前用户可访问的索引的优化程序统计信息。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="43%" id="d86157e1365" headers="d86157e1314 ">
                                       <p><code class="codeph">USER_TAB_PENDING_STATS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="57%" headers="d86157e1365 d86157e1317 ">
                                       <p>描述当前用户可访问的表，分区和子分区的挂起统计信息。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="43%" id="d86157e1373" headers="d86157e1314 ">
                                       <p><code class="codeph">USER_COL_PENDING_STATS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="57%" headers="d86157e1373 d86157e1317 ">
                                       <p>描述当前用户可访问的列的挂起统计信息。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="43%" id="d86157e1381" headers="d86157e1314 ">
                                       <p><code class="codeph">USER_IND_PENDING_STATS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="57%" headers="d86157e1381 d86157e1317 ">
                                       <p>描述使用<code class="codeph">DBMS_STATS</code>包收集的当前用户可访问的表，分区和子分区的挂起统计信息。
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-A511A414-B777-4CCC-A5B8-AA2F74A3A663__GUID-A1266D17-5F8E-40E7-B3E0-C238F2B47DD8">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="../arpls/DBMS_STATS.html#ARPLS059" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_STATS</code>包</p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN26639" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">USER_TAB_PENDING_STATS</code>及相关视图</p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-8FF503A2-5E50-4054-AC3A-5672343BDFE3" title="默认情况下，数据库会在统计信息收集结束时自动发布统计信息。">发布待定优化程序统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL461"></a><a id="TGSQL460"></a><div class="props_rev_3"><a id="GUID-28D2C31D-889F-4C21-8618-100BC3A72856" name="GUID-28D2C31D-889F-4C21-8618-100BC3A72856"></a><h4 id="TGSQL-GUID-28D2C31D-889F-4C21-8618-100BC3A72856" class="sect4"><span class="enumeration_section">15.2.3</span>管理已发布和待定统计</h4>
                  <div>
                     <p>本节介绍如何使用<code class="codeph">DBMS_STATS</code>程序单元更改优化程序统计信息的发布行为，以及导出和删除这些统计信息。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-28D2C31D-889F-4C21-8618-100BC3A72856__GUID-EE1F6A4D-F90A-44DF-9FCC-24BCA8704923">假设</p>
                        <p>本教程假设以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您想要更改<code class="codeph">sh.customers</code>和<code class="codeph">sh.sales</code>表的首选项，以便新收集的统计信息具有挂起状态。
                              </p>
                           </li>
                           <li>
                              <p>您希望当前会话使用挂起的统计信息。</p>
                           </li>
                           <li>
                              <p>您希望在<code class="codeph">sh.customers</code>表上收集和发布挂起的统计信息。
                              </p>
                           </li>
                           <li>
                              <p>您在<code class="codeph">sh.sales</code>表上收集挂起的统计信息，但决定删除它们而不发布它们。
                              </p>
                           </li>
                           <li>
                              <p>您想要更改<code class="codeph">sh.customers</code>和<code class="codeph">sh.sales</code>表的首选项，以便发布新收集的统计信息。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-28D2C31D-889F-4C21-8618-100BC3A72856__GUID-BC6A7997-6C25-43B8-ACF6-EEA7F532655F">管理已发布和待处理的统计信息</p>
                        <ol>
                           <li>
                              <p>启动SQL * Plus并以用户<code class="codeph">sh</code>身份连接到数据库。
                              </p>
                           </li>
                           <li>
                              <p>查询全局优化程序统计信息发布设置。</p>
                              <p>运行以下查询（包括示例输出）：</p><pre class="pre codeblock"><code>sh @ PROD&gt; SELECT DBMS_STATS.GET_PREFS（'PUBLISH'）PUBLISH FROM DUAL;发布-------正确</code></pre><p>值<code class="codeph">true</code>表示数据库在收集统计信息时发布统计信息。除非已设置特定的表首选项，否则每个表都使用此值。
                              </p>
                              <p>使用<code class="codeph">GET_PREFS</code> ，还可以指定架构和表名。如果已设置，该函数将返回表首选项。否则，该函数返回全局首选项。
                              </p>
                           </li>
                           <li>
                              <p>查询挂起的统计信息。</p>
                              <p>例如，运行以下查询（包括示例输出）：</p><pre class="pre codeblock"><code>sh @ PROD&gt; SELECT * FROM USER_TAB_PENDING_STATS;没有选择任何行</code></pre><p>此示例显示数据库当前不存储<code class="codeph">sh</code>架构的挂起统计信息。
                              </p>
                           </li>
                           <li>
                              <p>更改<code class="codeph">sh.customers</code>表的发布首选项。
                              </p>
                              <p>例如，执行以下过程以将统计信息标记为挂起：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.SET_TABLE_PREFS（'sh'，'customers'，'publish'，'false'）;结束; /</code></pre><p>随后，当您收集<code class="codeph">customers</code>表的统计信息时，数据库不会在收集作业完成时自动发布统计信息。而是，数据库将新收集的统计信息存储在<code class="codeph">USER_TAB_PENDING_STATS</code>表中。
                              </p>
                           </li>
                           <li>
                              <p>收集<code class="codeph">sh.customers</code>统计数据。
                              </p>
                              <p>例如，运行以下程序：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.GATHER_TABLE_STATS（'sh'，'customers'）;结束; /</code></pre></li>
                           <li>
                              <p>查询挂起的统计信息。</p>
                              <p>例如，运行以下查询（包括示例输出）：</p><pre class="pre codeblock"><code>sh @ PROD&gt; SELECT TABLE_NAME，NUM_ROWS FROM USER_TAB_PENDING_STATS; TABLE_NAME NUM_ROWS ------------------------------ ---------- CUSTOMERS 55500</code></pre><p>此示例显示数据库现在存储<code class="codeph">sh.customers</code>表的挂起统计信息。
                              </p>
                           </li>
                           <li>
                              <p>指示优化程序在此会话中使用挂起的统计信息。</p>
                              <p>将初始化参数<code class="codeph">OPTIMIZER_USE_PENDING_STATISTICS</code>设置为<code class="codeph">true</code> ，如下所示：</p><pre class="pre codeblock"><code>ALTER SESSION SET OPTIMIZER_USE_PENDING_STATISTICS = true;</code></pre></li>
                           <li>
                              <p>运行工作负载。</p>
                              <p>以下示例更改了名为Bruce Chalmers的所有客户的电子邮件地址：</p><pre class="pre codeblock"><code>更新sh.customers SET cust_email='ChalmersB@company.example.icom'WHERE cust_first_name ='Bruce'AND cust_last_name ='Chalmers';承诺;</code></pre><p>在编译此会话中的所有SQL语句时，优化程序使用挂起的统计信息而不是已发布的统计信息。</p>
                           </li>
                           <li>
                              <p>发布<code class="codeph">sh.customers</code>的挂起统计信息。
                              </p>
                              <p>例如，执行以下程序：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.PUBLISH_PENDING_STATS（'SH'，'CUSTOMERS'）;结束; /</code></pre></li>
                           <li>
                              <p>更改<code class="codeph">sh.sales</code>表的发布首选项。
                              </p>
                              <p>例如，执行以下程序：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.SET_TABLE_PREFS（'sh'，'sales'，'publish'，'false'）;结束; /</code></pre><p>随后，当您收集有关<code class="codeph">sh.sales</code>表的统计信息时，数据库不会在收集作业完成时自动发布统计信息。而是，数据库将统计信息存储在<code class="codeph">USER_TAB_PENDING_STATS</code>表中。
                              </p>
                           </li>
                           <li>
                              <p>收集<code class="codeph">sh.sales</code>统计信息。
                              </p>
                              <p>例如，运行以下程序：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.GATHER_TABLE_STATS（'sh'，'sales'）;结束; /</code></pre></li>
                           <li>
                              <p>删除<code class="codeph">sh.sales</code>的挂起统计信息。
                              </p>
                              <p>假设您改变主意，现在想删除<code class="codeph">sh.sales</code>挂起统计信息。运行以下程序：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.DELETE_PENDING_STATS（'sh'，'sales'）;结束; /</code></pre></li>
                           <li>
                              <p>将<code class="codeph">sh.customers</code>和<code class="codeph">sh.sales</code>表的发布首选项更改回其默认设置。
                              </p>
                              <p>例如，执行以下程序：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.SET_TABLE_PREFS（'sh'，'customers'，'publish'，null）; DBMS_STATS.SET_TABLE_PREFS（'sh'，'sales'，'publish'，null）;结束; /</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-8FF503A2-5E50-4054-AC3A-5672343BDFE3" title="默认情况下，数据库会在统计信息收集结束时自动发布统计信息。">发布待定优化程序统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="sect2"><a id="GUID-87A26DD9-E2C1-41E3-9EF0-D141F44F0968" name="GUID-87A26DD9-E2C1-41E3-9EF0-D141F44F0968"></a><h3 id="TGSQL-GUID-87A26DD9-E2C1-41E3-9EF0-D141F44F0968" class="sect3"><span class="enumeration_section">15.3</span>创建用于测试的人工优化器统计</h3>
               <div>
                  <p>要为优化程序提供用户创建的统计信息以进行测试，可以使用<code class="codeph">DBMS_STATS.SET_*_STATS</code>过程。这些过程为优化程序提供指定统计信息的人工值。
                  </p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-634642F2-212C-43F8-AC5F-CE014A5F5C61">关于人工优化统计</a><br>出于测试目的，您可以使用<code class="codeph">DBMS_STATS.SET_*_STATS</code>过程手动为表，索引或系统创建人工统计信息。
                     </li>
                     <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-D73DB2F4-46C1-4C5B-94DD-DE1F1DD5BBCC">设置表的人工优化程序统计信息</a><br>本主题说明如何使用<code class="codeph">DBMS_STATS.SET_TABLE_STATS</code>为表设置人工统计信息。 <code class="codeph">SET_INDEX_STATS</code>和<code class="codeph">SET_SYSTEM_STATS</code>的基本步骤相同。</li>
                     <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-8EE82CF3-461E-441B-B143-86DFC08A318B">设置优化程序统计信息：示例</a><br>此示例显示如何收集表的优化程序统计信息，设置人工统计信息，然后根据不同的统计信息比较优化程序选择的计划。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-6D85C813-5FBF-4655-ACE5-1E50DB4F8E60" title="使用DBMS_STATS，您可以指定优化程序何时以及如何使用统计信息。">控制优化程序统计信息的使用</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-634642F2-212C-43F8-AC5F-CE014A5F5C61" name="GUID-634642F2-212C-43F8-AC5F-CE014A5F5C61"></a><h4 id="TGSQL-GUID-634642F2-212C-43F8-AC5F-CE014A5F5C61" class="sect4"><span class="enumeration_section">15.3.1</span>关于人工优化器统计</h4>
                  <div>
                     <p>出于测试目的，您可以使用<code class="codeph">DBMS_STATS.SET_*_STATS</code>过程手动为表，索引或系统创建人工统计信息。
                     </p>
                     <p>当<code class="codeph">stattab</code>为null时， <code class="codeph">DBMS_STATS.SET_*_STATS</code>过程直接将人工统计信息插入到数据字典中。或者，您可以指定用户创建的表。
                     </p>
                     <div class="infoboxnote" id="GUID-634642F2-212C-43F8-AC5F-CE014A5F5C61__GUID-447F2F1C-09AE-4F19-A30D-C56FCB4E675B">
                        <p class="notep1">警告：</p><code class="codeph">DBMS_STATS.SET_*_STATS</code>过程仅用于开发测试。不要在生产数据库中使用它们。如果在数据字典中设置统计信息，则Oracle数据库会将集统计信息视为“真实”统计信息，这意味着统计信息收集作业在不符合过时条件时可能无法重新收集人工统计信息。
                     </div>
                     <p><code class="codeph">DBMS_STATS.SET_*_STATS</code>过程的典型用例是：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>显示执行计划如何随表中行或块的数量更改而更改</p>
                           <p>例如， <code class="codeph">SET_TABLE_STATS</code>可以将小表或空表中的行数和块数设置为大数。使用更改的统计信息执行查询时，优化程序可能会更改执行计划。例如，增加的行数可能导致优化器选择索引扫描而不是全表扫描。通过试验不同的值，您可以看到优化器将如何随时间更改其执行计划。
                           </p>
                        </li>
                        <li>
                           <p>为临时表创建实际统计信息</p>
                           <p>您可能希望查看在多个SQL语句中引用大型临时表时优化程序执行的操作。您可以创建常规表，加载代表性数据，然后使用<code class="codeph">GET_TABLE_STATS</code>来检索统计信息。创建临时表后，可以通过调用<code class="codeph">SET_TABLE_STATS</code> “欺骗”优化程序以使用这些统计信息。</p>
                        </li>
                     </ul>
                     <p>（可选）您可以在用户创建的表中为统计信息指定唯一ID。<code class="codeph">SET_*_STATS</code>过程具有相应的<code class="codeph">GET_*_STATS</code>过程。
                     </p>
                     <div class="tblformal" id="GUID-634642F2-212C-43F8-AC5F-CE014A5F5C61__GUID-18BE8E4E-2372-4513-8606-0E2E0E665384">
                        <p class="titleintable">表15-3设置优化程序统计信息的DBMS_STATS过程</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_STATS设置优化程序统计信息的过程" border="1" summary="This table describes DBMS_STATS procedures that set artificial optimizer statistics." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="20%" id="d86157e2080">DBMS_STATS程序</th>
                                 <th align="left" valign="bottom" width="20%" id="d86157e2082">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d86157e2086" headers="d86157e2080 "><code class="codeph">SET_TABLE_STATS</code></td>
                                 <td align="left" valign="top" width="20%" headers="d86157e2086 d86157e2082 ">使用<code class="codeph">numrows</code> ， <code class="codeph">numblks</code>和<code class="codeph">avgrlen</code>等参数设置表或分区统计信息。
                                    <p>如果数据库使用的内存中的列存储，您可以设置<code class="codeph">im_imcu_count</code>到IMCUs表中的或分区的数量， <code class="codeph">im_block_count</code>在表或分区块的数量。对于外部表， <code class="codeph">scanrate</code>指定以MB /秒为单位扫描数据的速率。
                                    </p>
                                    <p>优化程序使用缓存的数据来估计索引或统计信息表访问的缓存块数。总成本是从磁盘读取数据块的I / O成本，从缓冲区高速缓存读取高速缓存块的CPU成本以及处理数据的CPU成本。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d86157e2114" headers="d86157e2080 "><code class="codeph">SET_COLUMN_STATS</code></td>
                                 <td align="left" valign="top" width="20%" headers="d86157e2114 d86157e2082 ">使用<code class="codeph">distcnt</code> ， <code class="codeph">density</code> ， <code class="codeph">nullcnt</code>等参数设置列统计信息。
                                    <p>在处理用户定义的统计信息的此过程的版本中，使用<code class="codeph">stattypname</code>指定要存储在数据字典中的统计信息的类型。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d86157e2134" headers="d86157e2080 "><code class="codeph">SET_SYSTEM_STATS</code></td>
                                 <td align="left" valign="top" width="20%" headers="d86157e2134 d86157e2082 ">使用<code class="codeph">iotfrspeed</code> ， <code class="codeph">sreadtim</code>和<code class="codeph">cpuspeed</code>等参数设置系统统计信息。
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d86157e2149" headers="d86157e2080 "><code class="codeph">SET_INDEX_STATS</code></td>
                                 <td align="left" valign="top" width="20%" headers="d86157e2149 d86157e2082 ">使用<code class="codeph">numrows</code> ， <code class="codeph">numlblks</code> ， <code class="codeph">avglblk</code> ， <code class="codeph">clstfct</code>和<code class="codeph">indlevel</code>等参数设置索引统计信息。
                                    <p>在处理用户定义的统计信息的此过程的版本中，使用<code class="codeph">stattypname</code>指定要存储在数据字典中的统计信息的类型。
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-634642F2-212C-43F8-AC5F-CE014A5F5C61__GUID-2A1CFADE-0412-4887-AC18-16AC0D0AEE56">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-F993ADFE-85A9-4939-84D1-CC7A6E5C56D2" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解有关<code class="codeph">DBMS_STATS.SET_TABLE_STATS</code>更多信息以及设置优化程序统计信息的其他过程</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-87A26DD9-E2C1-41E3-9EF0-D141F44F0968" title="要为优化程序提供用户创建的统计信息以进行测试，可以使用DBMS_STATS.SET _ * _ STATS过程。这些过程为优化程序提供指定统计信息的人工值。">为测试创建人工优化器统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-D73DB2F4-46C1-4C5B-94DD-DE1F1DD5BBCC" name="GUID-D73DB2F4-46C1-4C5B-94DD-DE1F1DD5BBCC"></a><h4 id="TGSQL-GUID-D73DB2F4-46C1-4C5B-94DD-DE1F1DD5BBCC" class="sect4"><span class="enumeration_section">15.3.2</span>设置表的人工优化器统计</h4>
                  <div>
                     <p>本主题说明如何使用<code class="codeph">DBMS_STATS.SET_TABLE_STATS</code>为表设置人工统计信息。 <code class="codeph">SET_INDEX_STATS</code>和<code class="codeph">SET_SYSTEM_STATS</code>的基本步骤相同。</p>
                     <div class="p">请注意以下任务先决条件：<ul style="list-style-type:disc">
                           <li>
                              <p>对于不属于<code class="codeph">SYS</code>的对象，您必须是对象的所有者，或者具有<code class="codeph">ANALYZE ANY</code>权限。
                              </p>
                           </li>
                           <li>
                              <p>对于<code class="codeph">SYS</code>拥有的对象，您必须具有<code class="codeph">ANALYZE ANY DICTIONARY</code>特权或<code class="codeph">SYSDBA</code>特权。
                              </p>
                           </li>
                           <li>
                              <p>为表，列或索引调用<code class="codeph">GET_*_STATS</code> ，引用的对象必须存在。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="p">此任务假定以下内容：<ul style="list-style-type:disc">
                           <li>
                              <p>您具有为指定表使用<code class="codeph">DBMS_STATS.SET_TABLE_STATS</code>所需的权限。
                              </p>
                           </li>
                           <li>
                              <p>您打算将统计信息存储在数据字典中。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>在SQL * Plus中，以具有所需权限的用户身份登录数据库。</span></li>
                        <li class="stepexpand"><span>运行<code class="codeph">DBMS_STATS.SET_TABLE_STATS</code>过程，指定统计信息的相应参数。</span><div>典型参数包括以下内容：<ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">ownname</code> （非null）</p>
                                    <p>此参数指定包含表的架构的名称。</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">tabname</code> （非null）</p>
                                    <p>此参数指定要设置其统计信息的表的名称。</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">零件名称</code></p>
                                    <p>此参数指定表的分区的名称。</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">numRows行</code></p>
                                    <p>此参数指定表中的行数。</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">NUMBLKS</code></p>
                                    <p>此参数指定表中的块数。</p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>查询表格。</span></li>
                        <li class="stepexpand"><span>（可选）要确定统计信息如何影响优化程序，请查询执行计划。</span></li>
                        <li class="stepexpand"><span>（可选）要执行进一步测试，请返回步骤2并重置优化程序统计信息。</span></li>
                     </ol>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-87A26DD9-E2C1-41E3-9EF0-D141F44F0968" title="要为优化程序提供用户创建的统计信息以进行测试，可以使用DBMS_STATS.SET _ * _ STATS过程。这些过程为优化程序提供指定统计信息的人工值。">为测试创建人工优化器统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-8EE82CF3-461E-441B-B143-86DFC08A318B" name="GUID-8EE82CF3-461E-441B-B143-86DFC08A318B"></a><h4 id="TGSQL-GUID-8EE82CF3-461E-441B-B143-86DFC08A318B" class="sect4"><span class="enumeration_section">15.3.3</span>设置优化器统计信息：示例</h4>
                  <div>
                     <p>此示例显示如何收集表的优化程序统计信息，设置人工统计信息，然后根据不同的统计信息比较优化程序选择的计划。</p>
                     <div class="section">此示例假定：<ul style="list-style-type:disc">
                           <li>
                              <p>您以具有DBA权限的用户身份登录到数据库。</p>
                           </li>
                           <li>
                              <p>您希望在优化程序选择索引扫描时进行测试。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-8EE82CF3-461E-441B-B143-86DFC08A318B__GUID-158E0C68-A2AD-48A4-8E32-3AA23746A876">
                        <ol>
                           <li>
                              <p>创建一个名为<code class="codeph">contractors</code>的表，并为<code class="codeph">salary</code>列编制索引。
                              </p><pre class="pre codeblock"><code>CREATE TABLE承包商（con_id NUMBER，last_name VARCHAR2（50），薪水NUMBER，CONSTRAINT cond_id_pk PRIMARY KEY（con_id））; CREATE INDEX salary_ix ON承包商（薪水）;</code></pre></li>
                           <li>
                              <p>在此表中插入一行。</p><pre class="pre codeblock"><code>INSERT INTO承包商VALUES（8，'JONES'，1000）;承诺;</code></pre></li>
                           <li>
                              <p>收集表的统计信息。</p><pre class="pre codeblock"><code>EXECUTE DBMS_STATS.GATHER_TABLE_STATS（user，tabname =&gt;'CONTRACTORS'）;</code></pre></li>
                           <li>
                              <p>查询表和索引的行数（包括样本输出）：</p><pre class="pre codeblock"><code>SQL&gt; SELECT NUM_ROWS FROM USER_TABLES WHERE TABLE_NAME ='CONTRACTORS'; NUM_ROWS ---------- 1 SQL&gt; SELECT NUM_ROWS FROM USER_INDEXES WHERE INDEX_NAME ='SALARY_IX'; NUM_ROWS ---------- 1</code></pre></li>
                           <li>
                              <p>查询工资为1000的承包商，使用<code class="codeph">dynamic_sampling</code>提示禁用动态抽样：</p><pre class="pre codeblock"><code>SELECT / * + dynamic_sampling（承包商0）* / * FROM承包商WHERE薪水= 1000;</code></pre></li>
                           <li>
                              <p>查询优化器选择的执行计划（包括样本输出）：</p><pre class="pre codeblock"><code>SQL&gt; SELECT * FROM TABLE（DBMS_XPLAN.DISPLAY_CURSOR）; SQL_ID cy0wzytc16g9n，子编号0 ------------------------------------- SELECT / * + dynamic_sampling（contractors） 0）* / * FROM承包商WHERE salary = 1000计划哈希值：5038823 ---------------------------------- ------------------------------------ | Id |操作|名称|行|字节|成本（％CPU）|时间| -------------------------------------------------- -------------------- | 0 |选择声明| | | | 2（100）| | | * 1 |表访问完全|承包商| 1 | 12 | 2（0）| 00:00:01 | -------------------------------------------------- --------------------谓词信息（由操作ID标识）：--------------------- ------------------------------ 1  -  filter（“SALARY”= 1000）选择了19行。
</code></pre><p>由于表中只存在1行，因此优化程序会在索引范围扫描中选择全表扫描。</p>
                           </li>
                           <li>
                              <p>使用<code class="codeph">SET_TABLE_STATS</code>和<code class="codeph">SET_INDEX_STATS</code>模拟存储在10个数据块中的2000行的表的统计信息：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.SET_TABLE_STATS（ownname =&gt; user，tabname =&gt;'CONTRACTORS'，numrows =&gt; 2000，numblks =&gt; 10）;结束; / BEGIN DBMS_STATS.SET_INDEX_STATS（ownname =&gt; user，indname =&gt;'SALARY_IX'，numrows =&gt; 2000）;结束; /</code></pre></li>
                           <li>
                              <p>查询表和索引的行数（包括样本输出）：</p><pre class="pre codeblock"><code>SQL&gt; SELECT NUM_ROWS FROM USER_TABLES WHERE TABLE_NAME ='CONTRACTORS'; NUM_ROWS ---------- 2000 SQL&gt; SELECT NUM_ROWS FROM USER_INDEXES WHERE INDEX_NAME ='SALARY_IX'; NUM_ROWS ---------- 2000</code></pre><p>现在优化器认为该表包含10个块中的2000行，即使一个块中实际只存在1行。</p>
                           </li>
                           <li>
                              <p>刷新共享池以消除计划重用的可能性，然后执行相同的<code class="codeph">contractors</code>查询：</p><pre class="pre codeblock"><code>ALTER SYSTEM FLUSH SHARED_POOL; SELECT / * + dynamic_sampling（承包商0）* / * FROM承包商WHERE薪水= 1000;</code></pre></li>
                           <li>
                              <p>根据人工统计信息（包括样本输出）查询优化程序选择的执行计划：</p><pre class="pre codeblock"><code>SQL&gt; SELECT * FROM TABLE（DBMS_XPLAN.DISPLAY_CURSOR）; SQL_ID cy0wzytc16g9n，子编号0 ------------------------------------- SELECT / * + dynamic_sampling（contractors） 0）* / * FROM承包商WHERE薪水= 1000计划哈希值：996794789 ---------------------------------- ----------------------------------------------- | Id |操作|名称|行|字节|成本（％CPU）|时间| -------------------------------------------------- ------------------------------- | 0 |选择声明| | | | 3（100）| | | 1 |按行索引的表格访问权限|承包商| 2000 | 24000 | 3（34）| 00:00:01 | | * 2 | INDEX RANGE SCAN | SALARY_IX | 2000 | | 1（0）| 00:00:01 | -------------------------------------------------- -------------------------------谓词信息（由操作ID标识）：---------- ----------------------------------------- 2  -  access（“SALARY”= 1000 ）选择了20行。
</code></pre><p>基于人工生成的行数和块分布的统计信息，优化器认为索引范围扫描更具成本效益。</p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-87A26DD9-E2C1-41E3-9EF0-D141F44F0968" title="要为优化程序提供用户创建的统计信息以进行测试，可以使用DBMS_STATS.SET _ * _ STATS过程。这些过程为优化程序提供指定统计信息的人工值。">为测试创建人工优化器统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>