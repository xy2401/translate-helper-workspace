<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>使用Data Recovery Advisor诊断和修复故障</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96241-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="rman-data-repair-concepts.html" title="Previous" type="text/html"></link>
      <link rel="next" href="validating-database-files-backups.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="BRADV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="rman-data-repair-concepts.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="validating-database-files-backups.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复用户指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-diagnosing-responding-failures.html" property="item" typeof="WebPage"><span property="name">诊断和应对失败</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用Data Recovery Advisor诊断和修复故障</li>
            </ol>
            <a id="GUID-8C219B50-1F7F-4F7A-95EE-5F029AE7EB2A" name="GUID-8C219B50-1F7F-4F7A-95EE-5F029AE7EB2A"></a><a id="BRADV246"></a>
            
            <h2 id="BRADV-GUID-8C219B50-1F7F-4F7A-95EE-5F029AE7EB2A" class="sect2"><span class="enumeration_chapter">15</span>使用Data Recovery Advisor诊断和修复故障</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍如何使用RMAN中的Data Recovery Advisor工具诊断和修复数据库故障。本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="diagnosing-repairing-failures-dra.html#GUID-636EA9BE-2DFB-4FA0-959E-B1290C774ABD" title="Data Recovery Advisor是一种通过确定数据库故障的最佳自动修复选项来帮助减少数据库恢复时间的工具。">Data Recovery Advisor概述</a></p>
                  </li>
                  <li>
                     <p><a href="diagnosing-repairing-failures-dra.html#GUID-05C2861A-4EC0-4F0C-8860-42AC2BC4CC17" title="如果您怀疑或知道发生了一个或多个数据库故障，请使用LIST FAILURE获取有关它们的信息。">列出失败</a></p>
                  </li>
                  <li>
                     <p><a href="diagnosing-repairing-failures-dra.html#GUID-D9D58DB7-05ED-4A21-9D1A-94D57D600271" title="当用户事务试图访问损坏的数据时，数据库会被动地调用数据完整性检查。在某些情况下，潜在的故障可能无法检测到。">通过验证数据库检查块损坏</a></p>
                  </li>
                  <li>
                     <p><a href="diagnosing-repairing-failures-dra.html#GUID-13944F9E-545E-480A-A47B-CE0A73FED3C7" title="在RMAN会话中运行LIST FAILURE后，使用ADVISE FAILURE命令显示修复选项。此命令打印故障摘要，并隐式关闭所有已修复的打开故障。">确定修复选项</a></p>
                  </li>
                  <li>
                     <p><a href="diagnosing-repairing-failures-dra.html#GUID-31DF1037-325F-4FED-8A37-23216EFF9526" title="您可以使用Data Recovery Advisor自动修复故障。">修复失败</a></p>
                  </li>
                  <li>
                     <p><a href="diagnosing-repairing-failures-dra.html#GUID-9F467E37-DC05-494A-890E-439330493056" title="在某些情况下，您可能希望使用CHANGE FAILURE命令来更改故障的状态或优先级。">更改故障状态和优先级</a></p>
                  </li>
               </ul>
            </div><a id="BRADV89714"></a><div class="props_rev_3"><a id="GUID-636EA9BE-2DFB-4FA0-959E-B1290C774ABD" name="GUID-636EA9BE-2DFB-4FA0-959E-B1290C774ABD"></a><h3 id="BRADV-GUID-636EA9BE-2DFB-4FA0-959E-B1290C774ABD" class="sect3"><span class="enumeration_section">15.1</span> Data Recovery Advisor概述</h3>
               <p>Data Recovery Advisor是一种通过确定数据库故障的最佳自动修复选项来帮助减少数据库恢复时间的工具。</p><a id="BRADV89715"></a><div class="props_rev_3"><a id="GUID-FC7012E1-0834-4220-873A-B7409B9AB7A7" name="GUID-FC7012E1-0834-4220-873A-B7409B9AB7A7"></a><h4 id="BRADV-GUID-FC7012E1-0834-4220-873A-B7409B9AB7A7" class="sect4"><span class="enumeration_section">15.1.1</span> Data Recovery Advisor的目的</h4>
                  <div>
                     <p>Data Recovery Advisor是一个Oracle数据库工具，可自动诊断数据故障，确定并提供适当的修复选项，并根据用户的请求执行修复。</p>
                     <p>在此上下文中，数据故障是磁盘上的持久性数据损坏或丢失。通过提供用于自动数据修复的集中式工具，Data Recovery Advisor可提高Oracle数据库的可管理性和可靠性，从而有助于降低<a href="glossary.html#GUID-A3EA33D7-BB93-4179-9BFF-5C0CFBFD26D1"><span class="xrefglossterm">MTTR</span></a> 。</p>
                     <p>诊断数据故障并设计最佳维修策略需要高度的培训和经验。与传统的修复技术相比，Data Recovery Advisor具有以下优势：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>Data Recovery Advisor可以<span class="italic">在</span>数据库进程发现损坏并发出错误信号<span class="italic">之前</span>检测，分析和修复数据故障。预警有助于限制腐败造成的损害。
                           </p>
                        </li>
                        <li>
                           <p>手动评估数据故障的症状并将其与问题陈述相关联可能很复杂，容易出错且耗时。Data Recovery Advisor自动诊断故障，评估其影响，并将这些发现报告给用户。</p>
                        </li>
                        <li>
                           <p>传统上，用户必须手动确定修复选项以及修复影响。如果存在多个故障，则用户必须确定正确的修复执行顺序并尝试合并修复。相比之下，Data Recovery Advisor会自动确定最佳修复选项并运行检查以确保这些选项在您的环境中可行。</p>
                        </li>
                        <li>
                           <p>执行数据修复可能很复杂且容易出错。如果选择自动修复选项，则Data Recovery Advisor将执行修复并验证其成功与否。</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="BRADV89716"></a><div class="props_rev_3"><a id="GUID-665CCC0F-102C-442E-A6AD-89619784294D" name="GUID-665CCC0F-102C-442E-A6AD-89619784294D"></a><h4 id="BRADV-GUID-665CCC0F-102C-442E-A6AD-89619784294D" class="sect4"><span class="enumeration_section">15.1.2</span> Data Recovery Advisor的基本概念</h4>
                  <div>
                     <p>在使用Data Recovery Advisor之前，您必须熟悉一些概念。</p>
                     <div class="infoboxnotealso" id="GUID-665CCC0F-102C-442E-A6AD-89619784294D__GUID-0A2F0204-CC37-4B50-BA6A-F07F41122143">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="diagnosing-repairing-failures-dra.html#GUID-8F059E94-7CCB-4087-AEB5-1EF85DB857E4" title="Data Recovery Advisor具有命令行和GUI界面。Oracle企业管理器云控制中提供了GUI界面。">Data Recovery Advisor的用户界面</a></p>
                           </li>
                           <li>
                              <p><a href="diagnosing-repairing-failures-dra.html#GUID-58AB169E-7015-4551-BEF1-6E2F39B0E844" title="检查器是在Health Monitor中注册的诊断操作或过程，用于评估数据库或其组件的运行状况。">关于数据完整性检查</a></p>
                           </li>
                           <li>
                              <p><a href="diagnosing-repairing-failures-dra.html#GUID-8990058E-4CF3-4165-92DF-F75706D8F310" title="失败是由数据完整性检查检测到的持久性数据损坏。">关于失败</a></p>
                           </li>
                           <li>
                              <p><a href="diagnosing-repairing-failures-dra.html#GUID-04826048-906A-46DD-A9B1-128DEDFA492C" title="ADVISE FAILURE命令可以显示手动和自动修复选项。Data Recovery Advisor将手动操作分类为必需或可选。">关于手动操作和自动修复选项</a></p>
                           </li>
                           <li>
                              <p><a href="diagnosing-repairing-failures-dra.html#GUID-1B27227C-84B1-41E1-98EC-53A89A337FF5" title="仅在某些数据库配置上支持Data Recovery Advisor。">关于Data Recovery Advisor支持的数据库配置</a></p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="BRADV89717"></a><div class="props_rev_3"><a id="GUID-8F059E94-7CCB-4087-AEB5-1EF85DB857E4" name="GUID-8F059E94-7CCB-4087-AEB5-1EF85DB857E4"></a><h5 id="BRADV-GUID-8F059E94-7CCB-4087-AEB5-1EF85DB857E4" class="sect5"><span class="enumeration_section">15.1.2.1</span> Data Recovery Advisor的用户界面</h5>
                     <div>
                        <p>Data Recovery Advisor具有命令行和GUI界面。Oracle企业管理器云控制中提供了GUI界面。</p>
                        <p>在RMAN命令行界面中，Data Recovery Advisor命令是<code class="codeph">LIST FAILURE</code> ， <code class="codeph">ADVISE FAILURE</code> ， <code class="codeph">REPAIR FAILURE</code>和<code class="codeph">CHANGE FAILURE</code> 。</p>
                        <p>数据库或通过手动检查（如<code class="codeph">VALIDATE</code>命令）自动检测到<a href="glossary.html#GUID-046A9407-B78B-4BBA-BE2F-55D74EF4F2D8"><span class="xrefglossterm">故障</span></a> 。您可以使用<code class="codeph">LIST FAILURE</code>命令查看故障的问题语句以及这些故障对数据库操作的影响。每个故障由故障编号唯一标识。在同一个RMAN会话中，您可以使用<code class="codeph">ADVISE FAILURE</code>命令查看修复选项，通常包括自动和手动选项。
                        </p>
                        <p>执行<code class="codeph">ADVISE FAILURE</code> ，您可以手动修复故障或运行<code class="codeph">REPAIR FAILURE</code>命令自动修复故障。<a href="glossary.html#GUID-021686F4-9813-468B-A83E-9E7773FD4D4C"><span class="xrefglossterm">修复</span></a>是修复一个或多个故障的操作。修复示例包括<a href="glossary.html#GUID-923A509A-1C36-4EA4-91C8-6E4F372722C0"><span class="xrefglossterm">块介质恢复</span></a> ， <a href="glossary.html#GUID-01B3A956-DA97-4B47-9600-FA5549B7E868"><span class="xrefglossterm">数据文件介质恢复</span></a>和<a href="glossary.html#GUID-DD883C9B-0441-48D3-9DDC-755597782971"><span class="xrefglossterm">Oracle闪回数据库</span></a> 。选择自动<a href="glossary.html#GUID-76EA30CA-A51E-44C9-AB25-E1D89AF711B2"><span class="xrefglossterm">修复选项时</span></a> ，Data Recovery Advisor会验证修复是否成功并关闭相关的已修复故障。
                        </p>
                     </div>
                  </div><a id="BRADV89718"></a><div class="props_rev_3"><a id="GUID-58AB169E-7015-4551-BEF1-6E2F39B0E844" name="GUID-58AB169E-7015-4551-BEF1-6E2F39B0E844"></a><h5 id="BRADV-GUID-58AB169E-7015-4551-BEF1-6E2F39B0E844" class="sect5"><span class="enumeration_section">15.1.2.2</span>关于数据完整性检查</h5>
                     <div>
                        <p>检查器是在Health Monitor中注册的诊断操作或过程，用于评估数据库或其组件的运行状况。</p>
                        <div class="section">
                           <p>健康评估称为<a href="glossary.html#GUID-AECF0DB7-EEF4-4676-9978-42F0B5F9F9DE"><span class="xrefglossterm">数据完整性检查</span></a> ，可以被动地或主动地调用。
                           </p>
                           <p>通常会被动地检测到故障。涉及数据损坏的数据库操作会导致错误，该错误会自动调用数据完整性检查，以检查数据库中与错误相关的故障。如果诊断出故障，则将它们记录在<a href="glossary.html#GUID-BDCE90D1-13B7-4D2C-A761-1583A238A247"><span class="xrefglossterm">自动诊断存储库（ADR）中</span></a> ，该<a href="glossary.html#GUID-BDCE90D1-13B7-4D2C-A761-1583A238A247"><span class="xrefglossterm">存储库</span></a>是存储在数据库外部的目录结构。只有在数据库检测到故障并存储在ADR中后，才能使用Data Recovery Advisor生成修复建议和修复故障。</p>
                           <p>您还可以主动调用数据完整性检查。您可以通过运行状况监视器执行检查，该监视器以与响应性调用检查时相同的方式检测和存储故障。您还可以使用<code class="codeph">VALIDATE</code>和<code class="codeph">BACKUP VALIDATE</code>命令<span class="q"><a href="diagnosing-repairing-failures-dra.html#GUID-D9D58DB7-05ED-4A21-9D1A-94D57D600271" title="The database invokes data integrity checks reactively when a user transaction is trying to access corrupted data. In some cases, latent failures can go undetected.">检查块损坏</a></span> ，如<span class="q">“ <a href="diagnosing-repairing-failures-dra.html#GUID-D9D58DB7-05ED-4A21-9D1A-94D57D600271" title="当用户事务试图访问损坏的数据时，数据库会被动地调用数据完整性检查。在某些情况下，潜在的故障可能无法检测到。">通过验证数据库检查块损坏</a> ”中所述</span> 。
                           </p>
                           <div class="infoboxnotealso" id="GUID-58AB169E-7015-4551-BEF1-6E2F39B0E844__GUID-24E0C6C3-F867-4DD8-BF23-042DB54CC6B1">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=ADMIN11269" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a> ，了解如何使用<a id="d71715e686" class="indexterm-anchor"></a>健康监测</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV89719"></a><div class="props_rev_3"><a id="GUID-8990058E-4CF3-4165-92DF-F75706D8F310" name="GUID-8990058E-4CF3-4165-92DF-F75706D8F310"></a><h5 id="BRADV-GUID-8990058E-4CF3-4165-92DF-F75706D8F310" class="sect5"><span class="enumeration_section">15.1.2.3</span>关于失败</h5>
                     <div>
                        <p>失败是由数据完整性检查检测到的持久性数据损坏。</p>
                        <p>失败可以表现为可观察到的症状，例如错误消息和警报，但失败与症状不同，因为它代表了诊断<a href="glossary.html#GUID-3D711236-2A12-4726-AF42-A04D030732B0"><span class="xrefglossterm">问题</span></a> 。在数据库将问题诊断为故障后，您可以获取有关故障的信息，并可能使用Data Recovery Advisor对其进行修复。
                        </p>
                        <p>由于故障信息未存储在数据库本身中，因此无需打开或装入数据库即可访问它。您可以在<code class="codeph">NOMOUNT</code>模式下启动数据库时查看失败。因此，控制文件和<a href="glossary.html#GUID-CBFA8015-2DFF-42B1-A818-D6C5B92C608F"><span class="xrefglossterm">恢复目录</span></a>的可用性不会影响查看检测到的故障的能力，尽管它可能会影响某些维修的可行性。
                        </p>
                        <p>Data Recovery Advisor可以诊断以下故障：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>数据文件和控制文件之类的组件（由于它们不存在而无法访问），没有正确的访问权限，已脱机等等</p>
                           </li>
                           <li>
                              <p>物理损坏，例如块校验和失败和无效的块头字段值</p>
                           </li>
                           <li>
                              <p>不一致，例如比其他数据库文件旧的数据文件</p>
                           </li>
                           <li>
                              <p>I / O故障，例如硬件错误，操作系统驱动程序故障和超出操作系统资源限制（例如，打开文件的数量）</p>
                           </li>
                        </ul>
                        <p>Data Recovery Advisor可以检测或处理某些逻辑损坏。通常，此类损坏需要Oracle支持服务的帮助。</p>
                        <div class="infoboxnotealso" id="GUID-8990058E-4CF3-4165-92DF-F75706D8F310__GUID-537072FB-8032-446E-A44C-12630E41306E">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="diagnosing-repairing-failures-dra.html#GUID-C9E7EC3F-5250-45C2-9A4E-3DDE01CA5F20" title="每个故障都有故障状态：OPEN或CLOSED。">关于失败状态</a></p>
                              </li>
                              <li>
                                 <p><a href="diagnosing-repairing-failures-dra.html#GUID-D5E24BF1-3CDF-41EE-8B17-F3067DDEDBD2" title="每个故障都有一个失败优先级：CRITICAL，HIGH或LOW。 Data Recovery Advisor仅为诊断出的故障分配CRITICAL或HIGH优先级。">关于失败优先权</a></p>
                              </li>
                              <li>
                                 <p><a href="diagnosing-repairing-failures-dra.html#GUID-B28DCBBE-ACFA-4199-A5F0-71767CC30B2F" title="为清楚起见，Data Recovery Advisor将相关故障组合在一起。">关于失败分组</a></p>
                              </li>
                           </ul>
                        </div>
                     </div><a id="BRADV89720"></a><div class="props_rev_3"><a id="GUID-C9E7EC3F-5250-45C2-9A4E-3DDE01CA5F20" name="GUID-C9E7EC3F-5250-45C2-9A4E-3DDE01CA5F20"></a><h6 id="BRADV-GUID-C9E7EC3F-5250-45C2-9A4E-3DDE01CA5F20" class="sect6"><span class="enumeration_section">15.1.2.3.1</span>关于故障状态</h6>
                        <div>
                           <p>每个故障都有故障状态： <code class="codeph">OPEN</code>或<code class="codeph">CLOSED</code> 。</p>
                           <p>在调用适当的修复操作之前，失败的状态为<code class="codeph">OPEN</code> 。修复故障后，状态将更改为<code class="codeph">CLOSED</code> 。
                           </p>
                           <p>每次执行<code class="codeph">LIST FAILURE</code> ，Data Recovery Advisor都会重新验证所有打开的故障并关闭不再存在的故障。因此，如果您将某些故障修复为单独过程的一部分，或者如果故障是自身消失的瞬态问题，则运行<code class="codeph">LIST FAILURE</code>自动关闭它们。
                           </p>
                           <p>如果已手动修复，则可以使用<code class="codeph">CHANGE FAILURE</code>将打开故障的状态更改为<code class="codeph">CLOSED</code> 。但是，使用<code class="codeph">CHANGE FAILURE ...是有道理的<code class="codeph">CHANGE FAILURE ...仅在由于某种原因故障未自动CLOSED</code>时才关闭。如果使用<code class="codeph">CHANGE</code>手动关闭它时仍然存在故障，则在执行相应的数据完整性检查时，Data Recover Advisor会使用其他故障ID重新创建它。
                           </p>
                        </div>
                     </div><a id="BRADV89721"></a><div class="props_rev_3"><a id="GUID-D5E24BF1-3CDF-41EE-8B17-F3067DDEDBD2" name="GUID-D5E24BF1-3CDF-41EE-8B17-F3067DDEDBD2"></a><h6 id="BRADV-GUID-D5E24BF1-3CDF-41EE-8B17-F3067DDEDBD2" class="sect6"><span class="enumeration_section">15.1.2.3.2</span>关于故障优先级</h6>
                        <div>
                           <p>每个故障都有一个失败优先级： <code class="codeph">CRITICAL</code> ， <code class="codeph">HIGH</code>或<code class="codeph">LOW</code> 。 Data Recovery Advisor仅为诊断出的故障分配<code class="codeph">CRITICAL</code>或<code class="codeph">HIGH</code>优先级。
                           </p>
                           <p>具有<code class="codeph">CRITICAL</code>优先级的故障需要立即关注，因为它们使整个数据库不可用。例如，包含当前控制文件的磁盘可能会失败。与故障<code class="codeph">HIGH</code>优先级使数据库部分不可用或无法恢复的，通常必须迅速修复。示例包括块损坏和丢失的归档重做日志。
                           </p>
                           <p>如果为故障分配了<code class="codeph">HIGH</code>优先级，但故障对数据库可用性和可恢复性几乎没有影响，则可以将优先级降级为<code class="codeph">LOW</code> 。 <code class="codeph">LOW</code>优先级表示在修复更重要的故障之前可以忽略故障。
                           </p>
                           <p>默认情况下， <code class="codeph">LIST FAILURE</code>仅显示具有<code class="codeph">CRITICAL</code>和<code class="codeph">HIGH</code>优先级的故障。您可以使用<code class="codeph">CHANGE</code>命令更改<code class="codeph">LOW</code>和<code class="codeph">HIGH</code>故障的状态，但不能更改<code class="codeph">CRITICAL</code>故障的状态。将优先级更改为<code class="codeph">LOW</code>主要原因是减少<code class="codeph">LIST FAILURE</code>输出。如果此时无法重新验证故障（例如，由于另一个故障），则<code class="codeph">LIST FAILURE</code>将<code class="codeph">LIST FAILURE</code>显示为打开。
                           </p>
                        </div>
                     </div><a id="BRADV99975"></a><div class="props_rev_3"><a id="GUID-B28DCBBE-ACFA-4199-A5F0-71767CC30B2F" name="GUID-B28DCBBE-ACFA-4199-A5F0-71767CC30B2F"></a><h6 id="BRADV-GUID-B28DCBBE-ACFA-4199-A5F0-71767CC30B2F" class="sect6"><span class="enumeration_section">15.1.2.3.3</span>关于故障分组</h6>
                        <div>
                           <p>为清楚起见，Data Recovery Advisor将相关故障组合在一起。</p>
                           <p>例如，如果文件中的20个不同块被破坏，则这些故障将在单个父故障下分组。默认情况下，Data Recovery Advisor会列出有关失败组的信息，但您可以指定<code class="codeph">DETAIL</code>选项以列出有关各个子故障的信息。
                           </p>
                           <p>子故障具有与故障相同的格式。您可以获得有关次级故障的建议，并单独修复或与其他任何故障一起修复。</p>
                        </div>
                     </div>
                  </div><a id="BRADV89722"></a><div class="props_rev_3"><a id="GUID-04826048-906A-46DD-A9B1-128DEDFA492C" name="GUID-04826048-906A-46DD-A9B1-128DEDFA492C"></a><h5 id="BRADV-GUID-04826048-906A-46DD-A9B1-128DEDFA492C" class="sect5"><span class="enumeration_section">15.1.2.4</span>关于手动操作和自动修复选项</h5>
                     <div>
                        <p><code class="codeph">ADVISE FAILURE</code>命令可以显示手动和自动修复选项。Data Recovery Advisor将手动操作分类为必需或可选。
                        </p>
                        <p>在某些情况下，唯一可能的操作是手动操作。假设丢失的控制文件不存在备份。在这种情况下，手动操作是执行<code class="codeph">CREATE CONTROLFILE</code>语句。Data Recovery Advisor将此手动操作显示为必需操作，因为没有可用的自动修复。相反，假设存在丢失数据文件的RMAN备份。在这种情况下， <code class="codeph">REPAIR FAILURE</code>命令可以通过恢复和恢复数据文件自动执行修复。可选的手动操作是在无意中重命名或移动数据文件时还原该数据文件。Data Recovery Advisor建议使用可选的手动操作，如果它们可能阻止更极端的修复形式，例如数据文件恢复和恢复。
                        </p>
                        <p>与手动操作相比，Data Recovery Advisor可以执行自动修复。<code class="codeph">ADVISE FAILURE</code>命令为每个自动修复选项提供选项ID，并总结操作。
                        </p>
                        <p>Data Recovery Advisor在推荐自动修复之前执行可行性检查。例如，Data Recovery Advisor会检查介质恢复所需的所有备份和归档重做日志是否存在且一致。Data Recovery Advisor可能需要特定备份和归档重做日志。如果恢复所需的文件不可用，则无法进行恢复。</p>
                        <div class="infoboxnote" id="GUID-04826048-906A-46DD-A9B1-128DEDFA492C__GUID-05CEAAA3-A26E-4971-8E13-36726D263988">
                           <p class="notep1">注意：</p>
                           <p>出于性能原因，Data Recovery Advisor不会详尽检查每个文件中的每个字节。因此，由于备份或归档重做日志文件损坏，可行修复可能仍会失败。</p>
                        </div>
                     </div><a id="BRADV99976"></a><div class="props_rev_3"><a id="GUID-025E4E97-B061-4CF9-AB12-665C9AB1D92B" name="GUID-025E4E97-B061-4CF9-AB12-665C9AB1D92B"></a><h6 id="BRADV-GUID-025E4E97-B061-4CF9-AB12-665C9AB1D92B" class="sect6"><span class="enumeration_section">15.1.2.4.1</span>关于综合维修</h6>
                        <div>
                           <p>如果可能，Data Recovery Advisor会整合修复以将多个故障修复为单个修复。合并修复可能包含多个步骤。</p>
                           <p>有时无法进行整合修复，因为当一个故障阻止为其他故障创建修复时。例如，当控制文件丢失时，无法确定数据文件修复的可行性。在这种情况下，Data Recovery Advisor会为可以修复的故障生成修复选项，并打印一条消息，指出此时无法修复某些选定的故障。执行建议的修复后，您可以重复<code class="codeph">LIST</code> ， <code class="codeph">ADVISE</code>和<code class="codeph">REPAIR</code>序列来修复剩余的故障。
                           </p>
                        </div>
                     </div><a id="BRADV328"></a><a id="BRADV89723"></a><div class="props_rev_3"><a id="GUID-E16E2906-B3D4-439C-8F77-8CB52D02A9BE" name="GUID-E16E2906-B3D4-439C-8F77-8CB52D02A9BE"></a><h6 id="BRADV-GUID-E16E2906-B3D4-439C-8F77-8CB52D02A9BE" class="sect6"><span class="enumeration_section">15.1.2.4.2</span>关于修复脚本</h6>
                        <div>
                           <p>每当Data Recovery Advisor生成自动修复选项时，它都会创建一个脚本，说明RMAN打算使用哪些命令来修复故障。Data Recovery Advisor打印此脚本的位置，该脚本是驻留在操作系统上的文本文件。</p>
                           <p><a href="diagnosing-repairing-failures-dra.html#GUID-E16E2906-B3D4-439C-8F77-8CB52D02A9BE__CHDHJBFE">示例15-1</a>显示了一个示例修复脚本，该脚本显示了Data Recovery Advisor如何计划修复数据文件丢失<code class="codeph">27</code> 。
                           </p>
                           <div class="example" id="GUID-E16E2906-B3D4-439C-8F77-8CB52D02A9BE__CHDHJBFE">
                              <p class="titleinexample">示例15-1示例修复脚本</p><pre class="pre codeblock"><code>#recovery and recover data file ALTER DATABASE DATAFILE 27 OFFLINE;恢复数据文件27; recover datafile 27; ALTER DATABASE DATAFILE 27 ONLINE;</code></pre><p>如果您不希望Data Recovery Advisor自动修复故障，则可以复制脚本，编辑脚本并手动执行。</p>
                           </div>
                           <!-- class="example" -->
                        </div>
                     </div>
                  </div><a id="BRADV89724"></a><div class="props_rev_3"><a id="GUID-1B27227C-84B1-41E1-98EC-53A89A337FF5" name="GUID-1B27227C-84B1-41E1-98EC-53A89A337FF5"></a><h5 id="BRADV-GUID-1B27227C-84B1-41E1-98EC-53A89A337FF5" class="sect5"><span class="enumeration_section">15.1.2.5</span>关于Data Recovery Advisor支持的数据库配置</h5>
                     <p>仅在某些数据库配置上支持Data Recovery Advisor。</p><a id="BRADV795"></a><div class="props_rev_3"><a id="GUID-FF08A639-24B2-46C6-BA39-2C0875D6F99E" name="GUID-FF08A639-24B2-46C6-BA39-2C0875D6F99E"></a><h6 id="BRADV-GUID-FF08A639-24B2-46C6-BA39-2C0875D6F99E" class="sect6"><span class="enumeration_section">15.1.2.5.1</span>关于Data Recovery Advisor和Oracle Real Application Clusters</h6>
                        <div>
                           <p>Data Recovery Advisor仅支持单实例数据库。不支持Oracle Real Application Clusters（Oracle RAC）数据库。</p>
                           <p>如果发生导致所有Oracle RAC实例故障的数据故障，则可以在单实例模式下装入数据库，并使用Data Recovery Advisor检测和修复控制文件， <code class="codeph">SYSTEM</code>数据文件和数据字典故障。您还可以主动调用数据恢复检查，以测试其他数据库组件是否存在数据故障。此方法不会检测其他群集实例本地的数据故障，例如，无法访问的数据文件。
                           </p>
                        </div>
                     </div><a id="BRADV796"></a><div class="props_rev_3"><a id="GUID-A5587038-2082-4502-ADD3-647CBCF39684" name="GUID-A5587038-2082-4502-ADD3-647CBCF39684"></a><h6 id="BRADV-GUID-A5587038-2082-4502-ADD3-647CBCF39684" class="sect6"><span class="enumeration_section">15.1.2.5.2</span>关于Data Recovery Advisor和Oracle Data Guard</h6>
                        <div>
                           <p>Oracle Data Guard环境中的Data Recovery Advisor存在一些限制。</p>
                           <p>在Data Guard环境中，Data Recovery Advisor无法执行以下操作：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>使用从<a href="glossary.html#GUID-009B3F56-8C1E-4CF6-AF0F-A9D2C2E4B9C2"><span class="xrefglossterm">物理备用数据库</span></a>传输的文件来修复主数据库上的故障</p>
                              </li>
                              <li>
                                 <p>诊断和修复备用数据库上的故障</p>
                              </li>
                           </ul>
                           <p>但是，如果主数据库不可用，则Data Recovery Advisor可能会建议故障转移到备用数据库。故障转移后，您可以修复旧的主数据库。如果您在Data Guard配置中使用Enterprise Manager Cloud Control，则可以通过Data Recovery Advisor建议页面启动故障转移。</p>
                           <div class="infoboxnotealso" id="GUID-A5587038-2082-4502-ADD3-647CBCF39684__GUID-7DF1DF1A-8DD0-461A-A01D-ECB616246828">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=SBYDB04700" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a> ，了解如何在Data Guard配置中使用RMAN</p>
                           </div>
                        </div>
                     </div><a id="BRADV797"></a><div class="props_rev_3"><a id="GUID-E6AE8C65-B5DC-4BA4-A2EA-BDB168C0169A" name="GUID-E6AE8C65-B5DC-4BA4-A2EA-BDB168C0169A"></a><h6 id="BRADV-GUID-E6AE8C65-B5DC-4BA4-A2EA-BDB168C0169A" class="sect6"><span class="enumeration_section">15.1.2.5.3</span>关于Data Recovery Advisor和CDB</h6>
                        <p>Data Recovery Advisor只能用于诊断和修复非CDB中的数据损坏以及多租户容器数据库（CDB）的根目录。可插拔数据库（PDB）不支持Data Recovery Advisor。</p>
                     </div>
                  </div>
               </div><a id="BRADV89725"></a><div class="props_rev_3"><a id="GUID-C83E6265-9D82-4636-B041-B10D9C66C1F7" name="GUID-C83E6265-9D82-4636-B041-B10D9C66C1F7"></a><h4 id="BRADV-GUID-C83E6265-9D82-4636-B041-B10D9C66C1F7" class="sect4"><span class="enumeration_section">15.1.3</span>诊断和修复故障的基本步骤</h4>
                  <div>
                     <p>当您怀疑或发现故障时，Data Recovery Advisor工作流程就会开始。您可以通过多种方式发现故障，包括错误消息，警报，跟踪文件和失败的数据完整性检查。</p>
                     <div class="section">
                        <p>如<span class="q">“ <a href="diagnosing-repairing-failures-dra.html#GUID-58AB169E-7015-4551-BEF1-6E2F39B0E844" title="检查器是在Health Monitor中注册的诊断操作或过程，用于评估数据库或其组件的运行状况。">关于数据完整性检查</a> ”</span>中所述，数据库可以在发生错误时自动诊断故障。
                        </p>
                        <p>要响应失败，请启动RMAN会话，并按照列出的顺序在同一会话中执行以下所有步骤：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>通过运行<code class="codeph">LIST FAILURE</code>命令列出故障。</span><div>
                              <p><span class="q">“ <a href="diagnosing-repairing-failures-dra.html#GUID-05C2861A-4EC0-4F0C-8860-42AC2BC4CC17" title="如果您怀疑或知道发生了一个或多个数据库故障，请使用LIST FAILURE获取有关它们的信息。">清单失败</a> ”中</span>解释了此任务。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>如果您怀疑存在未由数据库自动诊断的故障，请运行<code class="codeph">VALIDATE DATABASE</code>以检查是否存在损坏的块和丢失的文件。</span><div>
                              <p>如果<code class="codeph">VALIDATE</code>检测到问题，则RMAN会触发执行故障评估。如果检测到故障，则RMAN将其记录到自动诊断存储库中，Data Recovery Advisor可以访问该存储库。
                              </p>
                              <p><span class="q">“ <a href="diagnosing-repairing-failures-dra.html#GUID-D9D58DB7-05ED-4A21-9D1A-94D57D600271" title="当用户事务试图访问损坏的数据时，数据库会被动地调用数据完整性检查。在某些情况下，潜在的故障可能无法检测到。">通过验证数据库检查块损坏</a> ”中</span>介绍了此任务。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>通过运行<code class="codeph">ADVISE FAILURE</code>命令确定修复选项。</span><div>
                              <p><span class="q">“ <a href="diagnosing-repairing-failures-dra.html#GUID-13944F9E-545E-480A-A47B-CE0A73FED3C7" title="在RMAN会话中运行LIST FAILURE后，使用ADVISE FAILURE命令显示修复选项。此命令打印故障摘要，并隐式关闭所有已修复的打开故障。">确定修复选项</a> ”中</span>介绍了此任务。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>选择修复选项。您可以手动修复故障或运行<code class="codeph">REPAIR FAILURE</code>命令自动修复它们。</span><div>
                              <p><span class="q">“ <a href="diagnosing-repairing-failures-dra.html#GUID-31DF1037-325F-4FED-8A37-23216EFF9526" title="您可以使用Data Recovery Advisor自动修复故障。">修复故障</a> ”中</span>介绍了此任务。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>返回第一步以确认所有故障都已修复或确定哪些故障仍然存在。</span></li>
                     </ol>
                     <div class="section">
                        <p>按照与本节中列出的顺序不同的顺序执行诊断和修复故障的步骤可能会导致错误。</p>
                        <p>如果适用，您可以随时在Data Recovery Advisor工作流程中使用<code class="codeph">CHANGE FAILURE</code>命令将故障的优先级从<code class="codeph">LOW</code>更改为<code class="codeph">HIGH</code>或<code class="codeph">HIGH</code>更改为<code class="codeph">LOW</code> ，或关闭已手动修复的故障。<span class="q">“ <a href="diagnosing-repairing-failures-dra.html#GUID-9F467E37-DC05-494A-890E-439330493056" title="在某些情况下，您可能希望使用CHANGE FAILURE命令来更改故障的状态或优先级。">更改故障状态和优先级</a> ”中</span>说明了此任务。
                        </p>
                        <div class="infoboxnotealso" id="GUID-C83E6265-9D82-4636-B041-B10D9C66C1F7__GUID-6169906B-75DC-453D-A83C-D666A5E3E16D">
                           <p class="notep1">也可以看看：</p>
                           <p>有关使用Data Recovery Advisor恢复数据库的完整示例，请参阅<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF90269" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV743"></a><div class="props_rev_3"><a id="GUID-E932D9A9-5505-43BC-AC56-774BBD5A9DCE" name="GUID-E932D9A9-5505-43BC-AC56-774BBD5A9DCE"></a><h4 id="BRADV-GUID-E932D9A9-5505-43BC-AC56-774BBD5A9DCE" class="sect4"><span class="enumeration_section">15.1.4</span>诊断和修复CDB中的故障</h4>
                  <div>
                     <p>您可以使用Data Recovery Advisor自动诊断数据故障，确定适当的修复选项以及在CDB中执行修复。</p>
                     <div class="section">
                        <p>用于CDB的步骤类似于您将用于<a href="glossary.html#GUID-62A96A52-3B97-455A-A443-75B999DCAC94"><span class="xrefglossterm">非CDB的步骤</span></a> 。唯一的区别是，对于CDB，您连接到根，然后使用本章中描述的步骤执行修复操作。
                        </p>
                        <p>您无法诊断数据故障并对CDB中的各个<a href="glossary.html#GUID-993BFB3F-3305-481C-999D-26132095DEC9"><span class="xrefglossterm">PDB</span></a>执行修复。</p>
                        <div class="infoboxnotealso" id="GUID-E932D9A9-5505-43BC-AC56-774BBD5A9DCE__GUID-2A24D345-D8EB-4113-A989-6190305B749F">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="您可以将RMAN客户端连接到多租户容器数据库（CDB）和可插拔数据库（PDB）。">与CDB建立RMAN连接</a> ”</span></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV89726"></a><div class="props_rev_3"><a id="GUID-05C2861A-4EC0-4F0C-8860-42AC2BC4CC17" name="GUID-05C2861A-4EC0-4F0C-8860-42AC2BC4CC17"></a><h3 id="BRADV-GUID-05C2861A-4EC0-4F0C-8860-42AC2BC4CC17" class="sect3"><span class="enumeration_section">15.2</span>列出失败</h3>
               <div>
                  <p>如果您怀疑或知道发生了一个或多个数据库故障，请使用<code class="codeph">LIST FAILURE</code>获取有关它们的信息。
                  </p>
                  <p>您可以列出所有或部分故障并以各种方式限制输出。故障由故障编号唯一标识。这些数字不是连续的，因此故障数之间的差距没有意义。</p>
                  <p><code class="codeph">LIST FAILURE</code>命令不执行数据完整性检查以诊断新故障;相反，它列出了先前执行的评估的结果。因此，重复执行<code class="codeph">LIST FAILURE</code>只有在数据库自动诊断它们以响应命令执行之间发生的错误时才会显示新故障。但是，执行<code class="codeph">LIST FAILURE</code>会导致Data Recovery Advisor重新验证所有现有故障。如果用户手动修复了故障，或者瞬态故障消失，则Data Recovery Advisor会从<code class="codeph">LIST FAILURE</code>输出中删除这些故障。如果此时无法重新验证故障（例如，由于另一个故障）， <code class="codeph">LIST FAILURE</code>将<code class="codeph">LIST FAILURE</code>显示为打开。
                  </p>
                  <div class="infoboxnotealso" id="GUID-05C2861A-4EC0-4F0C-8860-42AC2BC4CC17__GUID-C40CFA38-B64B-41D6-983C-79A7DBCEB506">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="diagnosing-repairing-failures-dra.html#GUID-1D2A9D25-C112-4F11-BCE1-7163A37E9750" title="确定数据库遇到问题的最简单方法是使用LIST FAILURE命令。">列出所有失败</a></p>
                        </li>
                        <li>
                           <p><a href="diagnosing-repairing-failures-dra.html#GUID-D94EC4F3-02C8-4C0B-A09B-CC871E394947" title="除了提供更详细的输出外，LIST FAILURE还可以限制输出。">列出失败的子集</a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="BRADV329"></a><a id="BRADV89727"></a><div class="props_rev_3"><a id="GUID-1D2A9D25-C112-4F11-BCE1-7163A37E9750" name="GUID-1D2A9D25-C112-4F11-BCE1-7163A37E9750"></a><h4 id="BRADV-GUID-1D2A9D25-C112-4F11-BCE1-7163A37E9750" class="sect4"><span class="enumeration_section">15.2.1</span>列出所有失败</h4>
                  <div>
                     <p>确定数据库遇到问题的最简单方法是使用<code class="codeph">LIST FAILURE</code>命令。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-1D2A9D25-C112-4F11-BCE1-7163A37E9750__GUID-BA926F65-8ACD-4DC2-8B37-D279D8B8168B">列出所有失败：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库。必须启动目标数据库实例。</span></li>
                        <li class="stepexpand"><span>执行<code class="codeph">LIST FAILURE</code>命令。</span><div>
                              <p>以下示例报告Data Recovery Advisor已知的所有故障（输出已重新格式化以适合页面）。</p><pre class="pre codeblock"><code>RMAN&gt; LIST FAILURE;数据库故障列表=========================故障ID优先级状态检测时间摘要---------- ---- ---- --------- ------------- ------- 142 HIGH OPEN 23-APR-13缺少一个或多个非系统数据文件101 HIGH OPEN 23-APR-13数据文件1：'/ disk1 / oddata / prod / system01.dbf'包含一个或多个损坏的块</code></pre><p>在此示例中，RMAN报告两种不同的故障：一组丢失的数据文件和一个包含损坏块的数据文件。输出指示每个故障（142和101）的唯一标识符，优先级，状态和检测时间。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>（可选）执行<code class="codeph">LIST FAILURE ...DETAIL</code>列出单独的故障。</span><div>
                              <p>Data Recovery Advisor会在可能的情况下整合故障。指定<code class="codeph">DETAIL</code>选项以单独列出故障。例如，如果文件中存在多个块损坏，则指定<code class="codeph">DETAIL</code>选项会列出每个块损坏。以下示例列出了有关故障101的详细信息。
                              </p><pre class="pre codeblock"><code>RMAN&gt; LIST FAILURE 101 DETAIL;数据库故障列表=========================故障ID优先级状态检测时间摘要---------- ---- ---- --------- ------------- ------- 101 HIGH OPEN 23-APR-13数据文件1：'/ disk1 / oradata / prod / system01.dbf'包含一个或多个损坏的块父故障的子故障列表ID 101故障ID优先级状态检测到的时间摘要---------- -------- ---- ----- ------------- ------- 104 HIGH OPEN 23-APR-13数据文件1中的块56416：'/ disk1 / oddata / prod / system01.dbf '是媒体损坏影响：SYS拥有的对象BLKTEST可能不可用</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>继续确定如何修复<code class="codeph">LIST FAILURE</code>命令显示的<code class="codeph">LIST FAILURE</code> ，如<span class="q">“ <a href="diagnosing-repairing-failures-dra.html#GUID-13944F9E-545E-480A-A47B-CE0A73FED3C7" title="在RMAN会话中运行LIST FAILURE后，使用ADVISE FAILURE命令显示修复选项。此命令打印故障摘要，并隐式关闭所有已修复的打开故障。">确定修复选项</a> ”中所述</span> 。</span></li>
                     </ol>
                  </div>
               </div><a id="BRADV330"></a><a id="BRADV89728"></a><div class="props_rev_3"><a id="GUID-D94EC4F3-02C8-4C0B-A09B-CC871E394947" name="GUID-D94EC4F3-02C8-4C0B-A09B-CC871E394947"></a><h4 id="BRADV-GUID-D94EC4F3-02C8-4C0B-A09B-CC871E394947" class="sect4"><span class="enumeration_section">15.2.2</span>列出失败子集</h4>
                  <div>
                     <p>除了提供更详细的输出外， <code class="codeph">LIST FAILURE</code>还可以限制输出。
                     </p>
                     <div class="section">
                        <p>例如，您可以使用<code class="codeph">CRITICAL</code> ， <code class="codeph">HIGH</code> ， <code class="codeph">LOW</code>或<code class="codeph">CLOSED</code>选项执行<code class="codeph">LIST FAILURE</code> ，以仅列出具有特定状态或优先级的故障。您还可以通过指定<code class="codeph">EXCLUDE FAILURE</code>从输出中排除指定的失败。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-D94EC4F3-02C8-4C0B-A09B-CC871E394947__GUID-6E1693DF-5DC7-4E68-8BF3-2292074E0B92">列出失败的子集：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库。必须启动目标数据库实例。</span></li>
                        <li class="stepexpand"><span>使用所需选项执行<code class="codeph">LIST FAILURE</code> 。</span><div>
                              <p>以下示例说明了一些<code class="codeph">LIST FAILURE</code>命令：</p><pre class="pre codeblock"><code>列表失败低;列表失败已关闭; LIST FAILURE EXCLUDE FAILURE 234234;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-D94EC4F3-02C8-4C0B-A09B-CC871E394947__GUID-91857CC9-1ADD-4A88-88A8-993C4290F8F7">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF132" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a>了解<code class="codeph">LIST FAILURE</code>命令</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV331"></a><a id="BRADV89729"></a><div class="props_rev_3"><a id="GUID-D9D58DB7-05ED-4A21-9D1A-94D57D600271" name="GUID-D9D58DB7-05ED-4A21-9D1A-94D57D600271"></a><h3 id="BRADV-GUID-D9D58DB7-05ED-4A21-9D1A-94D57D600271" class="sect3"><span class="enumeration_section">15.3</span>通过验证数据库检查块损坏</h3>
               <div>
                  <p>当用户事务试图访问损坏的数据时，数据库会被动地调用数据完整性检查。在某些情况下，潜在的故障可能无法检测到。</p>
                  <div class="section">
                     <p>例如，当发生数据块损坏错误时，数据库会反应性地执行数据完整性检查，以检查发生错误的块和其附近的其他块。但是，附近的区域可能已损坏。此外，无法通过反应式数据完整性检查检测到数据库永远不会读取的损坏块。</p>
                     <p>主动执行数据完整性检查的一种有效方法是在RMAN中运行<code class="codeph">VALIDATE</code>或<code class="codeph">BACKUP VALIDATE</code>命令。这些命令可以检查数据文件和控制文件是否存在物理和逻辑损坏。如果RMAN发现块损坏，则会将它们记录到自动诊断存储库中并创建一个或多个故障。然后，您可以使用Data Recovery Advisor列出有关故障的信息并进行修复。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-D9D58DB7-05ED-4A21-9D1A-94D57D600271__GUID-E45CCCCA-70D8-48C1-81B2-5827BD9E9E13">要验证数据库：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>启动RMAN并连接到目标数据库。必须安装目标数据库。</span></li>
                     <li class="stepexpand"><span>验证所需的数据库文件。</span><div>
                           <p>以下示例使用<code class="codeph">VALIDATE DATABASE</code>检查整个数据库中的物理和逻辑损坏（包括部分示例输出）。因为<span class="q">“ <a href="diagnosing-repairing-failures-dra.html#GUID-05C2861A-4EC0-4F0C-8860-42AC2BC4CC17" title="如果您怀疑或知道发生了一个或多个数据库故障，请使用LIST FAILURE获取有关它们的信息。">列出失败</a> ”</span>表示缺少某些数据文件，所以指定了<code class="codeph">SKIP INACCESSIBLE</code>子句。输出显示<code class="codeph">system01.dbf</code>数据库文件有一个新损坏的块（块失败），并且之前没有被数据库标记为损坏的块（标记为已损坏）。
                           </p><pre class="pre codeblock"><code>RMAN&gt;验证检查逻辑跳过无法访问的数据库;在23-APR-13分配的通道上启动验证：ORA_DISK_1通道ORA_DISK_1：SID = 103设备类型= DISK无法访问数据文件28跳过不可访问的文件28 RMAN-06060：警告：跳过数据文件会损害表空间USERS可恢复性RMAN-06060：警告：跳过datafile危害表空间USERS可恢复性通道ORA_DISK_1：开始验证数据文件通道ORA_DISK_1：指定数据文件以进行验证输入数据文件文件号= 00001 name = / disk1 / oradata / prod / system01.dbf输入数据文件文件号= 00002 name = / disk1 /oradata/prod/sysaux01.dbf输入数据文件文件号= 00022 name = / disk1 / oradata / prod / undotbs01.dbf输入数据文件文件号= 00023名称= / disk1 / oradata / prod / cwmlite01.dbf输入数据文件文件号= 00024 name = / disk1 / oradata / prod / drsys01.dbf input datafile file number = 00025 name = / disk1 / oradata / prod / example01.dbf input datafile file number = 00026 name = / disk1 / oradata / prod / indx01.dbf input datafile文件号= 00027 name = / disk1 / oradata / prod / tool s01.dbf通道ORA_DISK_1：验证完成，已用时间：00：00：25数据文件列表=================文件状态标记已损坏空块已检测到高SCN --- -  ------ -------------- ------------ ---------------  - -------- 1 FAILED 0 3536 57600 637711文件名：/disk1/oradata/prod/system01.dbf块类型块处理失败块---------- ------- ------- ----------------数据1 41876索引0 7721其他0 4467。。。文件状态标记损坏空块阻止检查高SCN ---- ------ -------------- ------------ ---- ----------- ---------- 27 OK 0 1272 1280 400914文件名：/disk1/oradata/prod/tools01.dbf块类型块处理失败块---- ------ -------------- ----------------数据0 0索引0 0其他0 8验证找到一个或多个损坏的块请参阅跟踪文件/disk1/oracle/log/diag/rdbms/prod/prod/trace/prod_ora_2596.trc以获取详细信息通道ORA_DISK_1：开始验证数据文件通道ORA_DISK_1：指定用于验证的数据文件，包括用于验证的当前控制文件包括备份集通道ORA_DISK_1中的当前SPFILE：验证完成，已用时间：00：00：01控制文件列表和SPFILE ======================== =======文件类型状态块检查失败块------------ ------ -------------- ---- ----------- SPFILE OK 0 2控制文件OK 0 512在23-APR-13完成验证</code></pre></div>
                     </li>
                  </ol>
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-D9D58DB7-05ED-4A21-9D1A-94D57D600271__GUID-07C2152E-8660-4648-B637-35E43750F453">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="diagnosing-repairing-failures-dra.html#GUID-58AB169E-7015-4551-BEF1-6E2F39B0E844" title="检查器是在Health Monitor中注册的诊断操作或过程，用于评估数据库或其组件的运行状况。">关于数据完整性检查</a></p>
                           </li>
                           <li>
                              <p><a href="validating-database-files-backups.html#GUID-CC967929-9610-410D-B881-66E71353D84C" title="验证使您可以检查备份的完整性。RMAN验证的主要目的是检查损坏的块和丢失的文件。您还可以使用RMAN确定是否可以还原备份。数据库可防止导致无法使用的备份文件或损坏的已还原数据文件的操作。损坏的块是一个已更改的块，因此它与Oracle数据库期望找到的块不同。在物理损坏（也称为媒体损坏）中，数据库根本无法识别块：校验和无效，块包含全零，或块的页眉和页脚不匹配。您可以使用SET MAXCORRUPT命令设置RMAN备份文件中允许的未标记损坏总数。默认值为零，这意味着RMAN不会容忍任何类型的未标记的损坏块。Oracle数据库支持用于检测，修复和监视块损坏的不同技术。您可以使用VALIDATE命令手动检查数据库文件中的物理和逻辑损坏。您还可以使用BACKUP VALIDATE命令执行验证。你可以运行RESTORE ...VALIDATE以测试RMAN是否可以从备份还原特定文件或文件集。RMAN选择要使用的备份。RMAN使您可以使用VALIDATE命令验证多租户容器数据库（CDB）和可插拔数据库（PDB）。验证CDB的步骤与用于验证非CDB的步骤类似。有多种方法可以验证PDB。">验证数据库文件和备份</a></p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF162" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a>了解<code class="codeph">VALIDATE</code>命令</p>
                           </li>
                           <li>
                              <p><a href="../admin/diagnosing-and-resolving-problems.html#ADMIN11007" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a> ，了解Oracle数据库如何管理诊断数据</p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="BRADV89730"></a><div class="props_rev_3"><a id="GUID-13944F9E-545E-480A-A47B-CE0A73FED3C7" name="GUID-13944F9E-545E-480A-A47B-CE0A73FED3C7"></a><h3 id="BRADV-GUID-13944F9E-545E-480A-A47B-CE0A73FED3C7" class="sect3"><span class="enumeration_section">15.4</span>确定修复选项</h3>
               <div>
                  <p>在RMAN会话中运行<code class="codeph">LIST FAILURE</code>后，使用<code class="codeph">ADVISE FAILURE</code>命令显示修复选项。此命令打印故障摘要，并隐式关闭所有已修复的打开故障。
                  </p>
                  <p>在适当的情况下， <code class="codeph">ADVISE FAILURE</code>命令会显示手动和自动修复选项列表。首先显示手动选项，这些选项分为强制选项或可选选项。在某些情况下，可选的手动修复可以避免更极端的操作，例如恢复和恢复数据文件。通常，使用对数据库影响最小且修复可能性最小的修复技术。
                  </p>
                  <div class="infoboxnotealso" id="GUID-13944F9E-545E-480A-A47B-CE0A73FED3C7__GUID-33698374-CF88-429A-88EA-1EA1AAB92F15">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="diagnosing-repairing-failures-dra.html#GUID-916107F7-7DB8-4E4D-8787-D50A30BD7CB6" title="如果存在一个或多个故障，则通常使用LIST FAILURE显示有关故障的信息，然后在同一个RMAN会话中显示ADVISE FAILURE以获取修复选项的报告。">确定所有故障的修复选项</a></p>
                        </li>
                        <li>
                           <p><a href="diagnosing-repairing-failures-dra.html#GUID-C9CDEE7B-EDA6-4E74-AB78-300A60B6CA3C" title="您还可以请求特定故障的修复选项。您可以按状态（CRITICAL，HIGH或LOW）或故障编号指定故障。您还可以使用EXCLUDE FAILURE从报告中排除一个或多个故障。">确定故障子集的修复选项</a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="BRADV332"></a><a id="BRADV89731"></a><div class="props_rev_3"><a id="GUID-916107F7-7DB8-4E4D-8787-D50A30BD7CB6" name="GUID-916107F7-7DB8-4E4D-8787-D50A30BD7CB6"></a><h4 id="BRADV-GUID-916107F7-7DB8-4E4D-8787-D50A30BD7CB6" class="sect4"><span class="enumeration_section">15.4.1</span>确定所有故障的修复选项</h4>
                  <div>
                     <p>如果存在一个或多个故障，则通常使用<code class="codeph">LIST FAILURE</code>显示有关故障的信息，然后在同一个RMAN会话中显示<code class="codeph">ADVISE FAILURE</code>以获取修复选项的报告。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-916107F7-7DB8-4E4D-8787-D50A30BD7CB6__GUID-2EADA743-E70E-4085-AFBF-AFC71DBA398D">要确定所有故障的修复选项：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>列出<span class="q">“ <a href="diagnosing-repairing-failures-dra.html#GUID-1D2A9D25-C112-4F11-BCE1-7163A37E9750" title="The easiest way to determine problems that your database is encountering is to use the LIST FAILURE command.">列出所有失败</a> ”中</span>描述的<span class="q"><a href="diagnosing-repairing-failures-dra.html#GUID-1D2A9D25-C112-4F11-BCE1-7163A37E9750" title="确定数据库遇到问题的最简单方法是使用LIST FAILURE命令。">失败</a></span> 。</span></li>
                        <li class="stepexpand"><span>在同一个RMAN会话中，执行<code class="codeph">ADVISE FAILURE</code> 。</span><div>
                              <p>以下示例请求Data Recovery Advisor已知的所有故障的修复选项，并包括示例输出（重新格式化以适合页面）。</p><pre class="pre codeblock"><code>RMAN&gt;建议失败;数据库故障列表=========================故障ID优先级状态检测时间摘要---------- ---- ---- --------- ------------- ------- 142 HIGH OPEN 23-APR-13缺少一个或多个非系统数据文件101 HIGH OPEN 23-APR-13数据文件1：'/ disk1 / oddata / prod / system01.dbf'包含一个或多个分析自动修复选项的损坏块;这可能需要一些时间使用通道ORA_DISK_1分析自动修复选项完成强制手动操作========================没有可用的手动操作可选手动操作=== ==================== 1。如果无意中重命名或移动了文件/disk1/oradata/prod/users01.dbf，请将其恢复为自动修复选项========================选项修复说明------ ------------------ 1恢复和恢复数据文件28;在文件1中执行块56416的块介质恢复策略：修复包括完整的介质恢复，没有数据丢失修复脚本：/disk1/oracle/log/diag/rdbms/prod/prod/hm/reco_660500184.hm</code></pre><p>在前面的示例中， <code class="codeph">ADVISE FAILURE</code>报告了两个故障：缺少数据文件和具有损坏块的数据文件。该命令未列出必需的手动操作，但它建议确保不会意外重命名或删除丢失的数据文件。自动修复选项涉及<a href="glossary.html#GUID-923A509A-1C36-4EA4-91C8-6E4F372722C0"><span class="xrefglossterm">块介质恢复</span></a>以及恢复和恢复丢失的数据文件。<code class="codeph">ADVISE FAILURE</code>列出修复脚本的位置。
                              </p>
                              <p>同一示例的以下变体显示了自动修复所需的RMAN备份或归档重做日志不可用时的输出。命令<code class="codeph">ADVISE FAILURE</code>现在显示强制手动操作。
                              </p><pre class="pre codeblock"><code>RMAN&gt;建议失败;数据库故障列表=========================故障ID优先级状态检测时间摘要---------- ---- ---- --------- ------------- ------- 142 HIGH OPEN 23-APR-13缺少一个或多个非系统数据文件101 HIGH OPEN 23-APR-13数据文件1：'/ disk1 / oddata / prod / system01.dbf'包含一个或多个分析自动修复选项的损坏块;这可能需要一些时间分配通道：ORA_DISK_1通道ORA_DISK_1：SID = 103设备类型= DISK分析自动修复选项完成强制手动操作======================= = 1。如果无意中重命名或移动了文件/disk1/oradata/prod/users01.dbf，请将其恢复2。如果无法使用上述建议，或者如果它们未修复为修复选择的故障，请联系Oracle支持服务可选手动操作=======================否可用的手动操作自动修复选项========================选项修复说明------ ----------- ------- 1在文件1中执行块56416的块介质恢复策略：修复包括完整的介质恢复，没有数据丢失修复脚本：/ disk1 / oracle / log / diag / rdbms / prod / prod / hm / reco_1863891774.hm</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>继续<span class="q">“ <a href="diagnosing-repairing-failures-dra.html#GUID-31DF1037-325F-4FED-8A37-23216EFF9526" title="您可以使用Data Recovery Advisor自动修复故障。">修复故障</a> ”</span>以确定如何修复<code class="codeph">LIST FAILURE</code>输出中显示的<code class="codeph">LIST FAILURE</code> 。</span></li>
                     </ol>
                  </div>
               </div><a id="BRADV333"></a><a id="BRADV89732"></a><div class="props_rev_3"><a id="GUID-C9CDEE7B-EDA6-4E74-AB78-300A60B6CA3C" name="GUID-C9CDEE7B-EDA6-4E74-AB78-300A60B6CA3C"></a><h4 id="BRADV-GUID-C9CDEE7B-EDA6-4E74-AB78-300A60B6CA3C" class="sect4"><span class="enumeration_section">15.4.2</span>确定故障子集的修复选项</h4>
                  <div>
                     <p>您还可以请求特定故障的修复选项。您可以按状态（ <code class="codeph">CRITICAL</code> ， <code class="codeph">HIGH</code>或<code class="codeph">LOW</code> ）或故障编号指定故障。您还可以使用<code class="codeph">EXCLUDE FAILURE</code>从报告中排除一个或多个故障。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-C9CDEE7B-EDA6-4E74-AB78-300A60B6CA3C__GUID-E6CBCEB7-A3AE-4A6F-B18B-8CAF2A3FA01F">要确定故障子集的修复选项：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>列出<span class="q">“ <a href="diagnosing-repairing-failures-dra.html#GUID-1D2A9D25-C112-4F11-BCE1-7163A37E9750" title="The easiest way to determine problems that your database is encountering is to use the LIST FAILURE command.">列出所有失败</a> ”中</span>描述的<span class="q"><a href="diagnosing-repairing-failures-dra.html#GUID-1D2A9D25-C112-4F11-BCE1-7163A37E9750" title="确定数据库遇到问题的最简单方法是使用LIST FAILURE命令。">失败</a></span> 。</span></li>
                        <li class="stepexpand"><span>在同一个RMAN会话中，使用所需选项执行<code class="codeph">ADVISE FAILURE</code> 。</span><div>
                              <p>以下示例仅请求故障101的修复选项。</p><pre class="pre codeblock"><code>RMAN&gt; ADVISE FAILURE 101;数据库故障列表=========================故障ID优先级状态检测时间摘要---------- ---- ---- --------- ------------- ------- 101 HIGH OPEN 23-APR-13数据文件1：'/ disk1 / oradata / prod / system01.dbf'包含一个或多个分析自动修复选项的损坏块;这可能需要一些时间使用通道ORA_DISK_1分析自动修复选项完成强制手动操作========================没有可用的手动操作可选手动操作=== ====================没有可用的手动操作自动修复选项======================= =选项修复说明------ ------------------ 1在文件1中执行块56416的块介质恢复策略：修复包括完整的介质恢复，没有数据丢失修复脚本：/disk1/oracle/log/diag/rdbms/prod/prod/hm/reco_708819503.htm</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>继续<span class="q">“ <a href="diagnosing-repairing-failures-dra.html#GUID-31DF1037-325F-4FED-8A37-23216EFF9526" title="您可以使用Data Recovery Advisor自动修复故障。">修复故障</a> ”</span>以确定如何修复<code class="codeph">LIST FAILURE</code>命令显示的<code class="codeph">LIST FAILURE</code> 。</span></li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-C9CDEE7B-EDA6-4E74-AB78-300A60B6CA3C__GUID-D7853B49-0AB8-4C7B-88D0-20F558F817AB">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../rcmrf/ADVISE-FAILURE.html#RCMRF166" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a> ，了解<code class="codeph">ADVISE FAILURE</code>命令</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV89733"></a><div class="props_rev_3"><a id="GUID-31DF1037-325F-4FED-8A37-23216EFF9526" name="GUID-31DF1037-325F-4FED-8A37-23216EFF9526"></a><h3 id="BRADV-GUID-31DF1037-325F-4FED-8A37-23216EFF9526" class="sect3"><span class="enumeration_section">15.5</span>修复故障</h3>
               <div>
                  <p>您可以使用Data Recovery Advisor自动修复故障。</p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="diagnosing-repairing-failures-dra.html#GUID-CABB41D1-393B-4A6C-A3B9-F66D49895942" title="如果ADVISE FAILURE建议手动修理，请先尝试这些。如果无法进行手动修复，或者无法修复所有故障，则可以使用REPAIR FAILURE自动修复当前RMAN会话中最新ADVISE FAILURE命令中建议的故障。">关于修复失败</a></p>
                     </li>
                     <li>
                        <p><a href="diagnosing-repairing-failures-dra.html#GUID-3DCF4326-2B62-43B0-BAFA-B9F5F6AF484F" title="默认情况下，脚本显示为标准输出。您可以使用SPOOL命令将脚本写入可编辑文件。">修复失败</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89734"></a><div class="props_rev_3"><a id="GUID-CABB41D1-393B-4A6C-A3B9-F66D49895942" name="GUID-CABB41D1-393B-4A6C-A3B9-F66D49895942"></a><h4 id="BRADV-GUID-CABB41D1-393B-4A6C-A3B9-F66D49895942" class="sect4"><span class="enumeration_section">15.5.1</span>关于修复故障</h4>
                  <div>
                     <p>如果<code class="codeph">ADVISE FAILURE</code>建议手动修理，请先尝试这些。如果无法进行手动维修，或者无法修复所有故障，则可以使用<code class="codeph">REPAIR FAILURE</code>自动修复当前RMAN会话中最新<code class="codeph">ADVISE FAILURE</code>命令中建议的<code class="codeph">ADVISE FAILURE</code> 。
                     </p>
                     <p>默认情况下， <code class="codeph">REPAIR FAILURE</code>在开始执行之前会提示确认。您可以通过指定<code class="codeph">NOPROMPT</code>选项来禁止确认提示。在它开始执行后，该命令指示当前的修复阶段。根据具体情况，RMAN可能会提示您做出回应。执行修复后，RMAN会重新评估所有现有故障，以确定在修复期间可能已修复的故障。
                     </p>
                     <p>在修复故障时，只要有可能，RMAN会将文件联机，恢复并恢复，然后再将其重新联机。您可以修复所选数据库，表空间或数据文件的故障。</p>
                     <p>在执行修复之前，通常建议通过指定<code class="codeph">PREVIEW</code>选项进行<code class="codeph">PREVIEW</code> 。RMAN不进行任何修复并生成包含所有修复操作和注释的脚本。如果未指定特定的修复选项，则RMAN将使用当前会话中最新<code class="codeph">ADVISE FAILURE</code>命令的第一个修复选项。默认情况下，修复脚本显示为标准输出。您可以使用<code class="codeph">SPOOL</code>命令将脚本写入可编辑文件。
                     </p>
                     <div class="infoboxnotealso" id="GUID-CABB41D1-393B-4A6C-A3B9-F66D49895942__GUID-92C3373A-2F0A-4220-A7E8-53C605E73B19">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="../rcmrf/REPAIR-FAILURE.html#RCMRF199" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a>以了解<code class="codeph">REPAIR FAILURE</code>命令</p>
                           </li>
                           <li>
                              <p><a href="../rcmrf/SPOOL.html#RCMRF156" target="_blank"><span><cite>Oracle数据库备份和恢复参考，</cite></span></a>以了解<code class="codeph">SPOOL</code>命令</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV334"></a><a id="BRADV89735"></a><div class="props_rev_3"><a id="GUID-3DCF4326-2B62-43B0-BAFA-B9F5F6AF484F" name="GUID-3DCF4326-2B62-43B0-BAFA-B9F5F6AF484F"></a><h4 id="BRADV-GUID-3DCF4326-2B62-43B0-BAFA-B9F5F6AF484F" class="sect4"><span class="enumeration_section">15.5.2</span>修复故障</h4>
                  <div>
                     <p>默认情况下，脚本显示为标准输出。您可以使用<code class="codeph">SPOOL</code>命令将脚本写入可编辑文件。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-3DCF4326-2B62-43B0-BAFA-B9F5F6AF484F__GUID-CB2ADE72-BDB9-46BB-9838-FE82E9B1F324">修复故障：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>列出<span class="q">“ <a href="diagnosing-repairing-failures-dra.html#GUID-1D2A9D25-C112-4F11-BCE1-7163A37E9750" title="The easiest way to determine problems that your database is encountering is to use the LIST FAILURE command.">列出所有失败</a> ”中</span>描述的<span class="q"><a href="diagnosing-repairing-failures-dra.html#GUID-1D2A9D25-C112-4F11-BCE1-7163A37E9750" title="确定数据库遇到问题的最简单方法是使用LIST FAILURE命令。">失败</a></span> 。</span></li>
                        <li class="stepexpand"><span>显示<span class="q">“ <a href="diagnosing-repairing-failures-dra.html#GUID-13944F9E-545E-480A-A47B-CE0A73FED3C7" title="Use the ADVISE FAILURE command to display repair options after running LIST FAILURE in an RMAN session. This command prints a summary of the failures and implicitly closes all open failures that are repaired.">确定修复选项</a> ”中</span>所述的<span class="q"><a href="diagnosing-repairing-failures-dra.html#GUID-13944F9E-545E-480A-A47B-CE0A73FED3C7" title="在RMAN会话中运行LIST FAILURE后，使用ADVISE FAILURE命令显示修复选项。此命令打印故障摘要，并隐式关闭所有已修复的打开故障。">修复选项</a></span> 。</span></li>
                        <li class="stepexpand"><span>（可选）执行<code class="codeph">REPAIR FAILURE PREVIEW</code> 。</span><div>
                              <p>以下示例预览RMAN会话中先前<code class="codeph">ADVISE FAILURE</code>命令显示的第一个修复选项。
                              </p><pre class="pre codeblock"><code>RMAN&gt;维修失败预览;策略：修复包括完整的介质恢复，没有数据丢失修复脚本：/disk1/oracle/log/diag/rdbms/prod/prod/hm/reco_475549922.hm修复脚本的内容：#recovery and recover datafile sql'alter database datafile 28离线';恢复数据文件28;恢复数据文件28; sql'alter database datafile 28 online'; #block media recovery recover datafile 1 block 56416;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>执行<code class="codeph">REPAIR FAILURE</code> 。</span><div>
                              <p>以下修复将恢复并恢复一个数据文件，并在一个损坏的块上执行块介质恢复。RMAN会提示确认它应该执行修复。用户输入的文本以粗体显示。</p><pre class="pre codeblock"><code>RMAN&gt;维修失败;策略：修复包括完整的介质恢复，没有数据丢失修复脚本：/disk1/oracle/log/diag/rdbms/prod/prod/hm/reco_475549922.hm修复脚本的内容：＃恢复和恢复数据文件sql'alter database datafile 28 offline';恢复数据文件28;恢复数据文件28; sql'alter database datafile 28 online'; #block media recovery recover datafile 1 block 56416;你真的想要执行上面的修复（输入是或否）？<span class="bold">是</span>执行修复脚本sql语句：alter database datafile 28 offline使用通道ORA_DISK_1通道在23-APR-13开始恢复ORA_DISK_1：启动数据文件备份集恢复通道ORA_DISK_1：指定要从备份集通道恢复的数据文件ORA_DISK_1：恢复数据文件00028到/disk1/oradata/prod/users01.dbf频道ORA_DISK_1：从备份片段读取/disk2/PROD/backupset/2013_04_18/o1_mf_nnndf_TAG20130418T182042_32fjzd3z_.bkp频道ORA_DISK_1：piece handle = / disk2 / PROD / backupset / 2013_04_18 / o1_mf_nnndf_TAG20130418T182042_32fjzd3z_.bkp tag = TAG20130418T182042频道ORA_DISK_1：恢复备份1频道ORA_DISK_1：恢复完成，已用时间：00：00：03 23-APR-13完成恢复使用频道ORA_DISK_1开始恢复23-APR-13开始媒体恢复媒体恢复完成，已用时间：00：00：01在23-APR-13 sql语句完成恢复：alter database datafile 28 online使用通道ORA_DISK_1搜索在23-APR-13开始恢复阻止图像的闪回日志，直到SCN 429690完成闪回日志搜索，恢复1个块开始介质恢复介质恢复完成，已用时间：00：00：03完成恢复23-APR-13修复失败完成</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>（可选）执行<code class="codeph">LIST FAILURE</code>确认</span></li>
                     </ol>
                  </div>
               </div>
            </div><a id="BRADV335"></a><a id="BRADV89736"></a><div class="props_rev_3"><a id="GUID-9F467E37-DC05-494A-890E-439330493056" name="GUID-9F467E37-DC05-494A-890E-439330493056"></a><h3 id="BRADV-GUID-9F467E37-DC05-494A-890E-439330493056" class="sect3"><span class="enumeration_section">15.6</span>更改故障状态和优先级</h3>
               <div>
                  <p>在某些情况下，您可能希望使用<code class="codeph">CHANGE FAILURE</code>命令来<code class="codeph">CHANGE FAILURE</code>的状态或优先级。
                  </p>
                  <div class="section">
                     <p>例如，如果块损坏具有<code class="codeph">HIGH</code>优先级，则如果块位于一个很少使用的表空间中，您可能希望暂时将其更改为<code class="codeph">LOW</code> 。
                     </p>
                     <p>如果通过<code class="codeph">REPAIR FAILURE</code>命令以外的方法<code class="codeph">REPAIR FAILURE</code> ，则Data Recovery Advisor会在您下次执行<code class="codeph">LIST FAILURE</code>时隐式关闭它。因此，您通常不需要执行<code class="codeph">CHANGE FAILURE ...CLOSED</code>命令。仅当自动故障重新验证失败时才需要使用此命令，但您认为故障不再存在。如果使用<code class="codeph">CHANGE FAILURE</code>关闭仍然存在的故障，则在执行适当的数据完整性检查时，Data Recovery Advisor会使用其他故障ID重新创建该故障。
                     </p>
                     <p>通常，您指定要按故障编号更改的故障。您还可以通过指定<code class="codeph">ALL</code> ， <code class="codeph">CRITICAL</code> ， <code class="codeph">HIGH</code>或<code class="codeph">LOW</code>来批量更改故障。您可以将故障更改为<code class="codeph">CLOSED</code>或<code class="codeph">PRIORITY HIGH</code>或<code class="codeph">PRIORITY LOW</code> 。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-9F467E37-DC05-494A-890E-439330493056__GUID-41C1C8A2-D517-4D4E-A93B-65FD67C56F4C">要更改故障的状态或优先级：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>列出<span class="q">“ <a href="diagnosing-repairing-failures-dra.html#GUID-1D2A9D25-C112-4F11-BCE1-7163A37E9750" title="The easiest way to determine problems that your database is encountering is to use the LIST FAILURE command.">列出所有失败</a> ”中</span>描述的<span class="q"><a href="diagnosing-repairing-failures-dra.html#GUID-1D2A9D25-C112-4F11-BCE1-7163A37E9750" title="确定数据库遇到问题的最简单方法是使用LIST FAILURE命令。">失败</a></span> 。</span><div>
                           <p>以下示例列出了一个涉及损坏数据块的故障。</p><pre class="pre codeblock"><code>RMAN&gt; LIST FAILURE;数据库故障列表=========================故障ID优先级状态检测时间摘要---------- ---- ---- --------- ------------- ------- 142 HIGH OPEN 23-APR-13缺少一个或多个非系统数据文件101 HIGH OPEN 23-APR-13数据文件25：'/ disk1 / oradata / prod / example01.dbf'包含一个或多个损坏的块</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>使用所需选项执行<code class="codeph">CHANGE FAILURE</code> 。</span><div>
                           <p>以下示例将块损坏故障的优先级从<code class="codeph">HIGH</code>更改为<code class="codeph">LOW</code> 。</p><pre class="pre codeblock"><code>RMAN&gt; CHANGE FAILURE 101优先级低;数据库故障列表=========================故障ID优先级状态检测时间摘要---------- ---- ---- --------- ------------- ------- 101 HIGH OPEN 23-APR-13数据文件25：'/ disk1 / oradata / prod / example01.dbf'包含一个或多个损坏的块你真的想改变上面的失败（输入YES或NO）吗？<span class="bold">YES</span>将1个故障更改为LOW优先级</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>（可选）执行<code class="codeph">LIST FAILURE ALL</code>以查看更改。</span><div>
                           <p>如果在没有<code class="codeph">ALL</code>情况下执行<code class="codeph">LIST FAILURE</code> ，则只有在不存在<code class="codeph">CRITICAL</code>或<code class="codeph">HIGH</code>优先级故障时，该命令才会列出具有<code class="codeph">LOW</code>优先级的故障。
                           </p><pre class="pre codeblock"><code>RMAN&gt; LIST FAILURE ALL;数据库故障列表=========================故障ID优先级状态检测时间摘要---------- ---- ---- --------- ------------- ------- 142 HIGH OPEN 23-APR-13缺少一个或多个非系统数据文件101 LOW OPEN 23-APR-13数据文件25：'/ disk1 / oddata / prod / example01.dbf'包含一个或多个损坏的块</code></pre></div>
                     </li>
                  </ol>
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-9F467E37-DC05-494A-890E-439330493056__GUID-0019CB88-CB52-469C-A996-79B1B9246479">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../rcmrf/CHANGE.html#RCMRF110" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a>了解<code class="codeph">CHANGE</code>命令</p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>