<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="After creating a SQL Performance Analyzer task and selecting a SQL tuning set as the input source, you need to establish the initial environment on the test system."></meta>
      <meta name="description" content="After creating a SQL Performance Analyzer task and selecting a SQL tuning set as the input source, you need to establish the initial environment on the test system."></meta>
      <title>创建一个更改前的SQL试用版</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Testing Guide "></meta>
      <meta property="og:description" content="After creating a SQL Performance Analyzer task and selecting a SQL tuning set as the input source, you need to establish the initial environment on the test system."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Testing Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="testing-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-07T01:43:11-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2008, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96279-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="creating-an-analysis-task.html" title="Previous" type="text/html"></link>
      <link rel="next" href="creating-a-post-change-sql-trial.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Testing Guide"></meta>
    <meta name="dcterms.isVersionOf" content="RATUG"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="creating-an-analysis-task.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="creating-a-post-change-sql-trial.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">测试指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="sql-performance-analyzer.html" property="item" typeof="WebPage"><span property="name">SQL性能分析器</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">创建一个更改前的SQL试用版</li>
            </ol>
            <a id="GUID-34F13B73-7FFA-4E5E-862E-2D38128ED582" name="GUID-34F13B73-7FFA-4E5E-862E-2D38128ED582"></a><a id="RATUG180"></a>
            
            <h2 id="RATUG-GUID-34F13B73-7FFA-4E5E-862E-2D38128ED582" class="sect2"><span class="enumeration_chapter">4</span>创建更改前SQL测试</h2>
         </header>
         <div class="ind">
            <div>
               <div><span>在创建SQL Performance Analyzer任务并选择SQL调优集作为输入源之后，您需要在测试系统上建立初始环境。</span> 在测试系统上建立数据库环境涉及手动进行任何影响SQL优化和性能的必要环境更改。这些更改可能包括更改初始化参数，收集或设置优化程序统计信息以及创建索引。建议您构建一个尽可能与生产系统类似的测试系统。Enterprise Manager中的专用工作流通过自动创建SQL试验和执行仅限于测试会话的更改来简化此过程。
               </div>
               <div class="infoboxnote" id="GUID-34F13B73-7FFA-4E5E-862E-2D38128ED582__GUID-AD7C47CC-A03C-49E0-8AFB-EDD14BCD019F">
                  <p class="notep1">注意：</p>
                  <p>您可以选择通过提供对公共数据库链接的访问来在远程系统上运行SQL试验。执行远程SQL试验时，执行SQL语句的远程数据库的数据库版本必须小于或等于其连接的数据库的数据库版本。从Oracle Database 11.2.0.2开始，远程数据库可以是只读数据库，例如Oracle Active Data Guard实例。</p>
               </div>
               <p>一旦正确配置了测试系统上的环境，就可以构建<a id="d8292e91" class="indexterm-anchor"></a>在执行系统更改之前预先更改性能数据的版本。您可以使用以下方法之一使用SQL Performance Analyzer构建SQL试验：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p>在工作负载中执行SQL语句</p>
                  </li>
                  <li>
                     <p>为工作负载中的SQL语句生成执行计划</p>
                  </li>
                  <li>
                     <p>从SQL调优集加载性能数据和执行计划（仅限API）</p>
                  </li>
               </ul>
               <p>本章介绍如何创建更改前的SQL试用版，并包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="creating-a-pre-change-sql-trial.html#GUID-377E9D3B-3B20-4C18-A631-C04D164891FD" title="本节介绍如何使用Oracle Enterprise Manager收集更改前的SQL性能数据。">使用Enterprise Manager创建预更改SQL试用版</a></p>
                  </li>
                  <li>
                     <p><a href="creating-a-pre-change-sql-trial.html#GUID-93D5C8A9-7E85-4467-B3E4-323B1732BA5D" title="本节介绍如何使用DBMS_SQLPA包构建更改前的性能数据。">使用API创建预更改SQL试用版</a></p>
                  </li>
               </ul>
               <div class="infoboxnote" id="GUID-34F13B73-7FFA-4E5E-862E-2D38128ED582__GUID-AE8672E0-11F4-4C3D-8DC1-D731095A79B2">
                  <p class="notep1">注意：</p>
                  <p>用于创建更改前SQL测试的主要界面是Oracle Enterprise Manager。如果由于某种原因Oracle Enterprise Manager不可用，您可以使用<code class="codeph">DBMS_SQLPA</code> PL / SQL包创建更改前的SQL试用版。
                  </p>
               </div>
               <div class="infoboxnotealso" id="GUID-34F13B73-7FFA-4E5E-862E-2D38128ED582__GUID-02FE0AFF-46BD-4CD7-AA61-DE5562B1C555">
                  <p class="notep1">也可以看看：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><span class="q">“ <a href="introduction-to-sql-performance-analyzer.html#GUID-15E99CE8-282C-4A7E-BD3B-B7C2B93DE0C1" title="将SQL工作负载捕获到生产系统上的SQL调优集后，可以在捕获工作负载的同一数据库上或在其他数据库上执行SQL Performance Analyzer分析。">设置测试系统</a> ”</span></p>
                     </li>
                     <li>
                        <p><span class="q">“ <a href="introduction-to-sql-performance-analyzer.html#GUID-310A0AA6-38C9-49A1-97C1-9BED682E654A" title="在进行系统更改之前创建一个更改前的SQL试用版。">衡量预更改SQL性能</a> ”</span></p>
                     </li>
                  </ul>
               </div>
            </div><a id="RATUG276"></a><a id="RATUG181"></a><div class="props_rev_3"><a id="GUID-377E9D3B-3B20-4C18-A631-C04D164891FD" name="GUID-377E9D3B-3B20-4C18-A631-C04D164891FD"></a><h3 id="RATUG-GUID-377E9D3B-3B20-4C18-A631-C04D164891FD" class="sect3"><span class="enumeration_section">4.1</span>使用Enterprise Manager创建更改前的SQL试用版</h3>
               <div>
                  <p>本节介绍如何使用Oracle Enterprise Manager收集更改前的SQL性能数据。</p>
                  <div class="p">在创建更改前的SQL试验之前，您需要创建SQL Performance Analyzer任务，如<a href="creating-an-analysis-task.html#GUID-41CB8DDE-01C8-42BF-AD16-3494D4648A63" title="一旦捕获了要分析到SQL调优集（STS）的SQL工作负载，就可以运行SQL Performance Analyzer来分析系统更改对SQL性能的影响。">创建分析任务中所述</a> 。
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-377E9D3B-3B20-4C18-A631-C04D164891FD__GUID-3C704D1E-EC7F-4386-8531-AC339F8584D0">要使用Enterprise Manager创建更改前的SQL试用版，请执行以下操作：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ol>
                        <li>
                           <p>在“引导式工作流”页面上，单击“初始环境中的创建SQL试验”步骤的“ <span class="bold">执行”</span>图标。
                           </p>
                           <p>将出现“创建SQL试用版”页面。将显示包含SQL工作负载的所选SQL调优集的摘要。</p>
                           <div class="figure" id="GUID-377E9D3B-3B20-4C18-A631-C04D164891FD__GUID-0131610D-407E-40AD-B527-C9CEC48C497E"><img src="img/spa_create_trial.gif" width="510" alt="spa_create_trial.gif的描述如下" title="spa_create_trial.gif的描述如下" longdesc="img_text/spa_create_trial.html"><br><a href="img_text/spa_create_trial.html">插图描述spa_create_trial.gif</a></div>
                           <!-- class="figure" -->
                        </li>
                        <li>
                           <p>在“SQL试验名称”字段中，输入SQL试用版的名称。</p>
                        </li>
                        <li>
                           <p>在“SQL试用说明”字段中，输入SQL试用版的说明。</p>
                        </li>
                        <li>
                           <p>在“创建方法”列表中，通过执行以下操作之一来确定如何创建SQL试用版以及生成哪些内容：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>选择“ <span class="bold">本地执行SQL”</span> 。
                                 </p>
                                 <p>SQL试验通过在测试系统上本地运行SQL语句，为SQL调优集中的每个SQL语句生成执行计划和统计信息。</p>
                              </li>
                              <li>
                                 <p>选择<span class="bold">远程执行SQL</span> 。
                                 </p>
                                 <p>SQL试验通过在公共数据库链接上通过另一个测试系统远程实际运行SQL语句，为SQL调优集中的每个SQL语句生成执行计划和统计信息。</p>
                              </li>
                              <li>
                                 <p>选择<span class="bold">本地生成计划</span> 。
                                 </p>
                                 <p>在试用绑定值和优化器配置之后，SQL试验调用优化器在测试系统上本地创建执行计划，而不实际运行SQL语句。</p>
                              </li>
                              <li>
                                 <p>选择<span class="bold">远程生成计划</span> 。
                                 </p>
                                 <p>在试用绑定值和优化器配置之后，SQL试验调用优化器在另一个测试系统上远程创建执行计划，而不是实际运行SQL语句。</p>
                              </li>
                              <li>
                                 <p>选择“ <span class="bold">从SQL调整集构建”</span> 。
                                 </p>
                                 <p>SQL试用版将SQL调优集中的执行计划和统计信息直接复制到试用版中。</p>
                              </li>
                           </ul>
                           <p>有关不同方法的详细信息，请参阅<span class="q">“ <a href="introduction-to-sql-performance-analyzer.html#GUID-310A0AA6-38C9-49A1-97C1-9BED682E654A" title="在进行系统更改之前创建一个更改前的SQL试用版。">测量更改前SQL性能</a> ”</span> 。
                           </p>
                        </li>
                        <li>
                           <p>在“每SQL时间限制”列表中，通过执行以下操作之一来确定试用期间SQL执行的时间限制：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>选择<span class="bold">5分钟</span> 。
                                 </p>
                                 <p>执行将在SQL调优设置中运行每个SQL语句最多5分钟并收集性能数据。</p>
                              </li>
                              <li>
                                 <p>选择<span class="bold">无限制</span> 。
                                 </p>
                                 <p>执行将运行SQL调优集中的每个SQL语句以完成并收集性能数据。收集执行统计信息可以提高性能分析的准确性，但需要更长的时间。建议不要使用此设置，因为任务可能会被一个SQL语句长时间停止。</p>
                              </li>
                              <li>
                                 <p>选择“ <span class="bold">自定义”</span>并输入指定的秒数，分钟数或小时数。
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>确保测试系统上的数据库环境尽可能与生产环境匹配，并选择已<span class="bold">建立的试用环境</span> 。
                           </p>
                        </li>
                        <li>
                           <p>在Schedule部分中：</p>
                           <ol type="a">
                              <li>
                                 <p>在时区列表中，选择您的时区代码。</p>
                              </li>
                              <li>
                                 <p>选择<span class="bold">立即立即</span>启动任务，或<span class="bold">稍后</span>选择安排任务在使用日期和时间字段指定的时间启动。
                                 </p>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p>单击“ <span class="bold">提交”</span>
                           </p>
                           <p>执行开始时将显示Guided Workflow页面。</p>
                           <p>执行过程中，此步骤的状态图标将变为时钟。要刷新状态图标，请单击“ <span class="bold">刷新”</span> 。根据所选的选项和SQL工作负载的大小，执行可能需要很长时间才能完成。执行完成后，“状态”图标将变为复选标记，并启用下一步的“执行”图标。
                           </p>
                        </li>
                        <li>
                           <p>构建更改前性能数据后，您可以通过在更改后测试系统上的SQL调整集中重新执行SQL语句来更改系统并构建更改后的性能数据，如<a href="creating-a-post-change-sql-trial.html#GUID-CE3A1060-2BD8-4EA9-81F8-E101CD9AD9D5" title="计算更改前的SQL性能数据后，可以在测试系统上执行系统更改。">创建帖子中所述- 更改SQL试用版</a> 。
                           </p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="RATUG182"></a><div class="props_rev_3"><a id="GUID-93D5C8A9-7E85-4467-B3E4-323B1732BA5D" name="GUID-93D5C8A9-7E85-4467-B3E4-323B1732BA5D"></a><h3 id="RATUG-GUID-93D5C8A9-7E85-4467-B3E4-323B1732BA5D" class="sect3"><span class="enumeration_section">4.2</span>使用API创建更改前的SQL试用版</h3>
               <div>
                  <p>本节介绍如何使用<code class="codeph">DBMS_SQLPA</code>包构建更改前的性能数据。
                  </p>
                  <div class="p">在创建更改前的SQL试验之前，您需要创建SQL Performance Analyzer任务，如<a href="creating-an-analysis-task.html#GUID-41CB8DDE-01C8-42BF-AD16-3494D4648A63" title="一旦捕获了要分析到SQL调优集（STS）的SQL工作负载，就可以运行SQL Performance Analyzer来分析系统更改对SQL性能的影响。">创建分析任务中所述</a> 。
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-93D5C8A9-7E85-4467-B3E4-323B1732BA5D__GUID-85C77B1E-B9C2-4E87-A30D-737090556C42">要创建更改前的SQL试用版：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>打电话给<a id="d8292e493" class="indexterm-anchor"></a>使用以下参数执行<code class="codeph">EXECUTE_ANALYSIS_TASK</code>过程：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>将<code class="codeph">task_name</code>参数设置为要执行的SQL Performance Analyzer任务的名称。
                                 </p>
                              </li>
                              <li>
                                 <p>使用以下方法之一设置<code class="codeph">execution_type</code>参数：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>设置为<code class="codeph">EXPLAIN PLAN</code> ，为SQL调优集中的所有SQL语句生成执行计划，而不执行它们。
                                       </p>
                                    </li>
                                    <li>
                                       <p>设置为<code class="codeph">TEST EXECUTE</code> （推荐）以执行SQL调优集中的所有语句并生成其执行计划和统计信息。指定<code class="codeph">TEST EXECUTE</code> ，该过程将生成执行计划和执行统计信息。执行统计信息使SQL Performance Analyzer能够识别已改进或已退化的SQL语句。除了生成执行计划之外，收集执行统计信息还可以提高性能分析的准确性，但需要更长的时间。
                                       </p>
                                    </li>
                                    <li>
                                       <p>设置为<code class="codeph">CONVERT SQLSET</code>以引用SQL调试集，以用于SQL试验的执行统计信息和计划。还应指定执行参数<code class="codeph">SQLSET_NAME</code>和<code class="codeph">SQLSET_OWNER</code>值。
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>使用<code class="codeph">execution_name</code>参数指定名称以标识<code class="codeph">execution_name</code> 。如果未指定，则SQL Performance Analyzer会自动为任务执行生成名称。
                                 </p>
                              </li>
                              <li>
                                 <p>使用<code class="codeph">execution_params</code>参数指定<code class="codeph">execution_params</code>参数。<code class="codeph">execution_params</code>参数被指定为指定执行的（ <span class="italic">名称</span> ， <span class="italic">值</span> ）对。例如，您可以设置以下执行参数：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><code class="codeph">time_limit</code>参数指定在超时之前处理SQL调优集中所有SQL语句的全局时间限制。
                                       </p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">local_time_limit</code>参数指定在超时之前处理SQL调优集中的每个SQL语句的时间限制。
                                       </p>
                                    </li>
                                    <li>
                                       <p>要执行远程测试执行，请将<code class="codeph">DATABASE_LINK</code>任务参数设置为连接到具有<code class="codeph">DBMS_SQLPA</code>程序包的<code class="codeph">EXECUTE</code>特权和测试系统的<code class="codeph">ADVISOR</code>特权的用户的公共数据库链接的全局名称。
                                       </p>
                                    </li>
                                    <li>
                                       <p>要完全执行DML语句（包括获取行锁和修改行设置），请将<code class="codeph">EXECUTE_FULLDML</code>参数设置为<code class="codeph">TRUE</code> 。 SQL Performance Analyzer将在执行DML语句后发出回滚，以防止发生持久更改。此参数的默认值为<code class="codeph">FALSE</code> ，它仅执行DML语句的查询部分而不修改数据。
                                       </p>
                                    </li>
                                    <li>
                                       <p>要在测试执行期间恢复相关捕获的<code class="codeph">init.ora</code>设置，请将<code class="codeph">APPLY_CAPTURED_COMPILENV</code>参数设置为<code class="codeph">TRUE</code> 。这不是默认行为，因为通常在运行SQL试验以在更改环境时测试更改。但是，此方法可用于未更改<code class="codeph">init.ora</code>设置的情况（例如创建索引）。远程SQL试验不支持此方法。
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                           </ul>
                           <p>以下示例说明了<span class="italic">在</span>系统更改<span class="italic">之前</span>进行的函数调用：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_SQLPA.EXECUTE_ANALYSIS_TASK（task_name =&gt;'my_spa_task'， -  execution_type =&gt;'TEST EXECUTE'， -  execution_name =&gt;'my_exec_BEFORE_change'）;</pre></li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>构建更改前性能数据后，您可以通过在更改后测试系统上的SQL调整集中重新执行SQL语句来更改系统并构建更改后的性能数据，如<a href="creating-a-post-change-sql-trial.html#GUID-CE3A1060-2BD8-4EA9-81F8-E101CD9AD9D5" title="计算更改前的SQL性能数据后，可以在测试系统上执行系统更改。">创建帖子中所述- 更改SQL试用版</a> 。
                     </p>
                     <div class="infoboxnotealso" id="GUID-93D5C8A9-7E85-4467-B3E4-323B1732BA5D__GUID-51D252BF-5FFB-4C79-964B-70F9048FBD58">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="../arpls/DBMS_SQLPA.html#ARPLS229" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a> ，了解<code class="codeph">DBMS_SQLPA.EXECUTE_ANALYSIS_TASK</code>函数</p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>