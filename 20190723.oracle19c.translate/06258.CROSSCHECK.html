<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>CROSSCHECK</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery Reference"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery Reference"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-reference.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T19:31:58-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96242-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="CREATE-SCRIPT.html" title="Previous" type="text/html"></link>
      <link rel="next" href="DELETE.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery Reference"></meta>
    <meta name="dcterms.isVersionOf" content="RCMRF"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="CREATE-SCRIPT.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="DELETE.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复参考</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="rman-commands-at-sign-to-quit.html" property="item" typeof="WebPage"><span property="name">RMAN命令：@（at符号）到QUIT</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">CROSSCHECK</li>
            </ol>
            <a id="GUID-07E07E7E-9A29-4901-9739-FFC472029A7D" name="GUID-07E07E7E-9A29-4901-9739-FFC472029A7D"></a><a id="RCMRF90126"></a><a id="RCMRF90127"></a><a id="RCMRF90128"></a><a id="RCMRF90129"></a><a id="RCMRF90130"></a><a id="RCMRF90131"></a><a id="RCMRF90132"></a><a id="RCMRF119"></a>
            
            <h2 id="RCMRF-GUID-07E07E7E-9A29-4901-9739-FFC472029A7D" class="sect2"><span class="enumeration_section">2.14</span> CROSSCHECK</h2>
         </header>
         <div class="ind">
            <div>
               <div class="section">
                  <p class="subhead1" id="GUID-07E07E7E-9A29-4901-9739-FFC472029A7D__GUID-46D123FA-5F13-4C82-BB08-53628A0D4A16">目的</p>
                  <p>使用<code class="codeph">CROSSCHECK</code>命令将备份和副本的物理实际与RMAN存储库中的逻辑记录同步。
                  </p>
                  <div class="infoboxnotealso" id="GUID-07E07E7E-9A29-4901-9739-FFC472029A7D__GUID-264DD691-3044-47DB-A6FF-944444C8B5CA">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="../bradv/maintaining-rman-backups.html#BRADV8171" target="_blank"><span class="italic">Oracle数据库备份和恢复用户指南</span></a> ，了解如何在恢复目录中管理数据库记录</p>
                  </div>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-07E07E7E-9A29-4901-9739-FFC472029A7D__GUID-4232CBE1-7167-49E1-9145-22C32F9720A1">先决条件</p>
                  <p>RMAN必须连接到必须启动的目标数据库实例。</p>
                  <p>磁盘交叉检查不需要维护通道。如果您使用媒体管理器但尚未为其配置自动通道，则必须在<code class="codeph">CROSSCHECK</code>之前使用运行<code class="codeph"><a href="ALLOCATE-CHANNEL-FOR-MAINTENANCE.html#GUID-6F9887A0-1D48-4332-8E59-6FA2EFE67824">ALLOCATE CHANNEL FOR MAINTENANCE</a></code> 。例如，如果您在SBT通道上创建了备份，但尚未为此设备配置自动SBT通道，则必须先手动分配SBT通道，然后<code class="codeph">CROSSCHECK</code>才能检查备份。此外，如果使用不同的介质管理器选项（池，服务器，库等）执行备份，则必须为每个组合分配维护通道。
                  </p>
                  <p><code class="codeph">CROSSCHECK</code>验证所有指定的备份和副本，即使它们是在以前的数据库版本中创建的。
                  </p>
                  <p></p>
                  <p>对于预备份备份，CDB必须以读写模式打开，并且必须以<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的身份以普通用户身份进行连接。
                  </p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-07E07E7E-9A29-4901-9739-FFC472029A7D__GUID-0FCFEC25-EAA0-4871-A8A0-524697507BB7">使用说明</p>
                  <p>RMAN始终在其执行操作的每个目标数据库的控制文件中维护有关备份的元数据。如果将RMAN与恢复目录一起使用，则RMAN还会维护恢复目录中每个已注册数据库的元数据。</p>
                  <p>如果备份在磁盘上，则<code class="codeph">CROSSCHECK</code>确定文件的标头是否有效。如果备份在磁带上，则RMAN会在RMAN存储库中查询要检查的备份片的名称和位置。RMAN将此元数据发送到目标数据库服务器，该服务器向媒体管理软件查询备份。然后，媒体管理软件检查其媒体目录，并使用备份状态向服务器报告。
                  </p>
                  <p><span class="bold">过期和可用状态</span></p>
                  <p>您可以查看状态<a id="d40370e175" class="indexterm-anchor"></a><a id="d40370e179" class="indexterm-anchor"></a>通过<code class="codeph"><a href="LIST.html#GUID-2BAB704C-A3C9-4F76-8D96-4BD961FBEF2E">LIST</a></code> ， <code class="codeph">V$</code>视图或恢复目录视图记录在RMAN存储库中的备份集和副本（如果将RMAN与目录一起使用）。<a href="CROSSCHECK.html#GUID-07E07E7E-9A29-4901-9739-FFC472029A7D__G1039376" title="描述CROSSCHECK命令报告的状态类型">表2-4</a>描述了每种状态的含义。
                  </p>
                  <p><code class="codeph">CROSSCHECK</code>命令仅处理在与用于交叉检查的通道相同的设备类型上创建的文件。<code class="codeph">CROSSCHECK</code>命令通过检查磁盘上的<code class="codeph">DISK</code>通道文件或通过查询来检查存储库中标记为<code class="codeph">AVAILABLE</code>或<code class="codeph">EXPIRED</code>对象。 <a id="d40370e215" class="indexterm-anchor"></a> <code class="codeph">sbt</code>频道的媒体经理。
                  </p>
                  <div class="tblformalwide" id="GUID-07E07E7E-9A29-4901-9739-FFC472029A7D__G1039376">
                     <p class="titleintable">表2-4 CROSSCHECK状态的含义</p>
                     <table cellpadding="4" cellspacing="0" class="FormalWide" title="CROSSCHECK状态的含义" width="100%" border="1" summary="Describes the status types reported by the CROSSCHECK command" frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="33%" id="d40370e233">状态</th>
                              <th align="left" valign="bottom" width="67%" id="d40370e236">描述</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="33%" id="d40370e241" headers="d40370e233 ">
                                 <p><code class="codeph">过期</code></p>
                              </td>
                              <td align="left" valign="top" width="67%" headers="d40370e241 d40370e236 ">
                                 <p>在文件系统（对于<code class="codeph">DISK</code> ）或媒体管理器（对于<code class="codeph">sbt</code> ）中<code class="codeph">sbt</code> 。如果集合中的任何备份片段已<code class="codeph">EXPIRED</code>则备份集为<code class="codeph">EXPIRED</code> 。</p>
                                 <p><code class="codeph">CROSSCHECK</code>命令不会删除它找不到的文件的存储库记录，但会将其存储库记录更新为<code class="codeph">EXPIRED</code> 。您可以运行<code class="codeph"><a href="DELETE.html#GUID-FB4EAC69-4978-42F7-8B09-77C6736188B3">DELETE</a></code> <code class="codeph">EXPIRED</code>来删除过期文件和状态为<code class="codeph">EXPIRED</code>任何现有物理文件的存储库记录。</p>
                                 <p>如果备份<code class="codeph">EXPIRED</code> ，您可以稍后再重新执行交叉检查，确定过期的备份是否可用。将RMAN与媒体管理器一起使用时，此预防措施特别有用。例如，如果某些备份片段或副本被错误地标记为<code class="codeph">EXPIRED</code>因为<code class="codeph">PARMS</code>通道设置不正确，则在确保文件确实存在于媒体管理器中之后，再次运行<code class="codeph">CROSSCHECK BACKUP</code>命令将这些文件还原为<code class="codeph">AVAILABLE</code>状态。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="33%" id="d40370e297" headers="d40370e233 ">
                                 <p><code class="codeph">可用</code></p>
                              </td>
                              <td align="left" valign="top" width="67%" headers="d40370e297 d40370e236 ">
                                 <p>对象可供RMAN使用。要使备份集具有<code class="codeph">AVAILABLE</code> ，集中的所有备份片必须具有状态<code class="codeph">AVAILABLE</code> 。</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <p><span class="bold">在Data Guard环境中进行交叉检查</span></p>
                  <p><span class="q">“ <a href="BACKUP.html#GUID-73642FF2-43C5-48B2-9969-99001C52EB50__CHDJIIGD">Data Guard环境中的RMAN备份</a> ”</span>解释了备份的关联和可访问性之间的区别。在Data Guard环境中，创建备份或副本的数据库与该文件相关联。如果可以访问备份，则可以在连接到Data Guard环境中的任何数据库时使用<code class="codeph">CHANGE</code> ， <code class="codeph"><a href="DELETE.html#GUID-FB4EAC69-4978-42F7-8B09-77C6736188B3">DELETE</a></code>和<code class="codeph"><a href="CROSSCHECK.html#GUID-07E07E7E-9A29-4901-9739-FFC472029A7D">CROSSCHECK</a></code>等维护命令进行备份。通常，RMAN将在任何数据库上创建的磁带备份视为环境中所有数据库都可访问，而磁盘备份只能由创建它们的数据库访问。
                  </p>
                  <p><a id="d40370e332" class="indexterm-anchor"></a>当作为<code class="codeph">TARGET</code>连接到与备份关联的数据库时，RMAN只能将备份的状态从<code class="codeph">AVAILABLE</code>更新为<code class="codeph">EXPIRED</code>或<code class="codeph">DELETED</code> 。如果RMAN因为未与目标数据库关联而无法删除备份，则RMAN会提示您对与其关联的数据库的文件执行相同的<code class="codeph">CROSSCHECK</code>操作。通过这种方式，RMAN可以防止因错误的SBT配置而导致的不需要的状态更改。
                  </p>
                  <p>例如，假设您将RMAN作为<code class="codeph">TARGET</code>连接到备用数据库<code class="codeph">standby1</code>并将其备份到磁带。如果从磁带手动删除备份，并且在<code class="codeph">standby2</code>上执行交叉检查备份，则RMAN会提示您在<code class="codeph">standby1</code>上运行交叉检查。当介质管理器报告已删除备份时， <code class="codeph">standby1</code>上的交叉检查<code class="codeph">standby1</code>磁带备份的状态更新为<code class="codeph">EXPIRED</code> 。
                  </p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-07E07E7E-9A29-4901-9739-FFC472029A7D__GUID-3D38E196-2E9C-474A-B661-020FEAF4AEE2">句法</p>
                  <p><span class="bold"><span class="italic">crosscheck</span> :: =</span></p>
                  <div class="figure" id="GUID-07E07E7E-9A29-4901-9739-FFC472029A7D__GUID-A4D262E0-E767-43CE-8EE3-91739627781A"><img src="img/crosscheck.gif" alt="下面是crosscheck.eps的描述" title="下面是crosscheck.eps的描述" longdesc="img_text/crosscheck.html"><br><a href="img_text/crosscheck.html">说明crosscheck.eps的说明</a></div>
                  <!-- class="figure" -->
                  <p><span class="bold"><span class="italic">maintSpec</span> :: =</span></p>
                  <div class="figure" id="GUID-07E07E7E-9A29-4901-9739-FFC472029A7D__GUID-1ADAF578-5647-4856-AE78-2C10C6AC1DCE"><img src="img/maintspec.gif" alt="maintspec.eps的描述如下" title="maintspec.eps的描述如下" longdesc="img_text/maintspec.html"><br><a href="img_text/maintspec.html">说明maintspec.eps的说明</a></div>
                  <!-- class="figure" -->
                  <p>（ <span class="italic"><a href="listObjList.html#GUID-73596ED4-99FE-45B8-B333-FECC698E1374__BABBEIIJ">listObjList :: =</a></span> ， <span class="italic"><a href="archivelogRecordSpecifier.html#GUID-DDF929FF-796B-4AD6-AE58-F831CAFC7703__BABJGBFG">archivelogRecordSpecifier :: =</a></span> ， <span class="italic"><a href="foreignlogRecordSpecifier.html#GUID-122E19A7-5BCC-434C-BE2A-9D4F248EA02C__BABHBICI">foreignlogRecordSpecifier :: =</a></span> ， <span class="italic"><a href="maintQualifier.html#GUID-6AF4DA92-BBBD-4931-96D2-766D9D29EA3F__BABEEGAJ">maintQualifier :: =</a></span> ， <span class="italic"><a href="recordSpec.html#GUID-92F09EC0-5E30-47C0-834E-5A24FAE98F14__BABEIAEB">recordSpec :: =</a></span> ， <span class="italic"><a href="deviceSpecifier.html#GUID-F653748D-4AB5-4A0E-B6E5-D891A000ADAC__BABDEJAC">deviceSpecifier :: =</a></span> ）</p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-07E07E7E-9A29-4901-9739-FFC472029A7D__GUID-02CB40AD-143E-4DE9-8BBC-179328AEF2A2">语义</p>
                  <div class="tblformalwide" id="GUID-07E07E7E-9A29-4901-9739-FFC472029A7D__GUID-7B928660-5AEB-4F2B-9DE2-94B1A4CF0E65">
                     <table cellpadding="4" cellspacing="0" class="FormalWide" title="" width="100%" border="1" summary="Describes the CROSSCHECK command parameters" frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="33%" id="d40370e430">语法元素</th>
                              <th align="left" valign="bottom" width="67%" id="d40370e433">描述</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="33%" id="d40370e438" headers="d40370e430 ">
                                 <p><code class="codeph">PREPLUGIN</code></p>
                              </td>
                              <td align="left" valign="top" width="67%" headers="d40370e438 d40370e433 ">
                                 <p>交叉检查预包装备份。预备份备份可以是非CDB或PDB的备份，然后再将它们作为PDB插入当前CDB。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="33%" id="d40370e446" headers="d40370e430 ">
                                 <p><span class="italic"><code class="codeph"><a href="maintSpec.html#GUID-933AD976-5FCC-4684-80BB-264F6FC8A06B">maintSpec</a></code></span></p>
                              </td>
                              <td align="left" valign="top" width="67%" headers="d40370e446 d40370e433 ">
                                 <p>交叉检查备份。有关<span class="italic"><code class="codeph">maintSpec</code></span>选项，请参阅中的参数说明<span class="bold"> </span> <span class="italic"><code class="codeph"><a href="maintSpec.html#GUID-933AD976-5FCC-4684-80BB-264F6FC8A06B">maintSpec</a></code></span> 。</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-07E07E7E-9A29-4901-9739-FFC472029A7D__GUID-611B8E40-8C05-4DC9-9A7C-43521A99D33B">例子</p>
               </div>
               <!-- class="section" -->
               <div class="example" id="GUID-07E07E7E-9A29-4901-9739-FFC472029A7D__GUID-45DD22C0-B5B0-40FE-B993-63E4AD58B1C6">
                  <p class="titleinexample">示例2-75交叉检查所有备份和副本</p>
                  <p>此示例假定默认配置的通道为<code class="codeph">DEVICE TYPE sbt</code> ，交叉检查所有备份和磁盘（包括部分输出）。由于RMAN预先配置磁盘通道，因此您无需手动分配磁盘通道。
                  </p><pre class="oac_no_warn" dir="ltr">RMAN&gt; CROSSCHECK BACKUP;已分配的通道：ORA_SBT_TAPE_1通道ORA_SBT_TAPE_1：SID = 84设备类型= SBT_TAPE通道ORA_SBT_TAPE_1：Oracle Secure Backup分配的通道：ORA_DISK_1通道ORA_DISK_1：SID = 86设备类型= DISK备份件句柄= / disk2 / backup / 08i9umon_1_1 RECID = 7 STAMP = 614423319交叉检查备份件：发现'EXPIRED'备件件手柄= / disk2 / backup / 09i9umso_1_1 RECID = 8 STAMP = 614423448交叉检查备件：发现'EXPIRED'备件件手柄= / disk1 / cfauto / c-26213402-20130213 -00 RECID = 9 STAMP = 614423452交叉检查备件：发现'AVAILABLE'备件手柄= 0bi9uo81_1_1 RECID = 10 STAMP = 614424833交叉检查备件：发现'AVAILABLE'备件手柄= c-26213402-20130213-01 RECID = 11 STAMP = 614424851交叉检查备份：发现是'可用'。。。</pre></div>
               <!-- class="example" -->
               <div class="example" id="GUID-07E07E7E-9A29-4901-9739-FFC472029A7D__GUID-AF03260C-40DB-4E85-8A07-7BE38F3FB678">
                  <p class="titleinexample">例2-76在一系列日期内进行交叉检查</p>
                  <p><a id="d40370e485" class="indexterm-anchor"></a><a id="d40370e489" class="indexterm-anchor"></a>此示例向媒体管理器查询给定六周范围内备份集的状态。RMAN使用<code class="codeph">NLS_DATE_FORMAT</code>参数中指定的日期格式，在此示例中为“ <code class="codeph">DD-MON-YY</code> ”。第一个命令仅交叉检查磁带上的备份：</p><pre class="oac_no_warn" dir="ltr">用于维护设备类型的分配信道sbt;在'01-JAN-13'和'14-FEB-13'之间完成的CROSSCHECK BACKUP;发布频道;</pre><p>以下命令指定<code class="codeph">DEVICE TYPE DISK</code>仅交叉检查磁盘：</p><pre class="oac_no_warn" dir="ltr">在'01-JAN-13'和'14-FEB-13'之间完成的CROSSCHECK BACKUP设备类型磁盘;</pre><p>如果默认通道是SBT，则可以通过使用默认通道运行<code class="codeph">CROSSCHECK</code>来交叉检查磁盘和SBT备份：</p><pre class="oac_no_warn" dir="ltr">在'01-JAN-13'和'14-FEB-13'之间完成的CROSSCHECK BACKUP;</pre></div>
               <!-- class="example" -->
            </div>
         </div>
      </article>
   </body>
</html>