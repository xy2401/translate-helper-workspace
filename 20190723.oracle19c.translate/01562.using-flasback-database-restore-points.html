<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>使用闪回数据库和还原点</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96241-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="configuring-rman-client-advanced.html" title="Previous" type="text/html"></link>
      <link rel="next" href="part-backing-up-archiving.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="BRADV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="configuring-rman-client-advanced.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="part-backing-up-archiving.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复用户指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-starting-configuring-rman.html" property="item" typeof="WebPage"><span property="name">启动和配置RMAN和闪回数据库</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用闪回数据库和还原点</li>
            </ol>
            <a id="GUID-909BBEEF-389B-443B-8CD7-F3C027AAFFF3" name="GUID-909BBEEF-389B-443B-8CD7-F3C027AAFFF3"></a><a id="BRADV71000"></a>
            
            <h2 id="BRADV-GUID-909BBEEF-389B-443B-8CD7-F3C027AAFFF3" class="sect2"><span class="enumeration_chapter">7</span>使用闪回数据库和还原点</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍闪回数据库和还原点。它讨论了配置，监视和维护这些功能，作为整体数据保护策略的一部分。</p>
               <p>本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="using-flasback-database-restore-points.html#GUID-FAA04D1F-36E2-4B20-954F-845E42386775" title="Oracle闪回数据库和还原点是相关的数据保护功能，使您能够及时回溯数据，以纠正在指定时间窗口内由逻辑数据损坏或用户错误导致的任何问题。">闪回数据库，还原点和保证还原点概述</a></p>
                  </li>
                  <li>
                     <p><a href="using-flasback-database-restore-points.html#GUID-E90F7FBD-CCE2-4234-A3B4-FDFEC3BC2E90" title="记录闪回数据库和保证还原点涉及在应用更改之前捕获数据文件块的映像。FLASHBACK DATABASE命令可以使用这些图像将数据文件返回到先前的状态。">关于记录闪回数据库和保证还原点</a></p>
                  </li>
                  <li>
                     <p><a href="using-flasback-database-restore-points.html#GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D" title="要确保闪回数据库的成功运行和有保证的还原点，必须先设置一些关键数据库选项。">闪回数据库和保证还原点的先决条件</a></p>
                  </li>
                  <li>
                     <p><a href="using-flasback-database-restore-points.html#GUID-2C846D84-EDCC-4FAA-9F6A-05CD0C6C7C09" title="您可以创建，监视和删除正常和保证还原点。">使用正常和保证还原点</a></p>
                  </li>
                  <li>
                     <p><a href="using-flasback-database-restore-points.html#GUID-4E96DB60-3616-4680-866A-F38A6049053A" title="要对目标数据库使用闪回日志记录，必须启用闪回数据库。可以遵循某些准则以确保闪回数据库的最佳性能。">使用闪回数据库</a></p>
                  </li>
               </ul>
               <div class="infoboxnote" id="GUID-909BBEEF-389B-443B-8CD7-F3C027AAFFF3__GUID-DC5B60B4-8FC2-4C41-B8BF-DBF72DC7ABCE">
                  <p class="notep1">注意：</p>
                  <p>有关使用闪回数据库以及正常和保证还原点的恢复方案的详细信息，请参阅<a href="rman-performing-flashback-dbpitr.html#GUID-5463669A-DC89-4FF4-ACCE-136A72DF687B" title="此概述描述了Oracle闪回技术和数据库时间点恢复的目的和基本概念。某些情况适合使用时间点恢复或闪回功能，以便在之前的某个时间点将数据库或数据库对象返回到其状态。数据库时间点恢复（DBPITR）和闪回功能使您可以将数据库恢复到先前的某个时间点。DBPITR在物理级别工作，以在过去的目标时间将数据文件返回到其状态。RMAN为一个或多个PDB的时间点恢复提供支持。要恢复PDB，必须以具有SYSDBA或SYSBACKUP权限的用户身份连接到root。恢复后，PDB的旧备份仍然有效，并且可以在发生介质故障时使用。在大多数可用的情况下，Oracle数据库的闪回功能比介质恢复更有效。您可以使用它们来调查数据库的过去状态。Oracle闪回数据库是DBPITR最有效的替代方法。逻辑闪回功能用于将表及其内容恢复到过去的时间。您可以对整个多租户容器数据库（CDB）或特定可插拔数据库（PDB）执行闪回数据库操作。多租户容器数据库（CDB）可以使用共享撤消或本地撤消。RMAN用于执行闪回数据库操作的技术取决于CDB的撤消配置类型.RMAN提供了管理PDB中数据块的重做损坏的方法。闪回表使用撤消表空间中的信息而不是恢复的备份来检索表。发生闪回表操作时，将删除新行并重新插入旧行。在执行表的闪回时，数据库的其余部分仍然可用。要执行闪回表操作，该表必须有资格闪回，并且执行操作的用户必须具有所需的权限。要在一个或多个表上使用闪回表功能，请使用带有目标时间或SCN的FLASHBACK TABLE SQL语句。默认情况下，数据库在执行FLASHBACK TABLE操作之前禁用受影响表上的触发器。在操作之后，数据库将触发器返回到操作之前的状态（启用或禁用）。您可以使用FLASHBACK TABLE从回收站中检索对象...在DROP声明之前。Flashback Drop可以反转DROP TABLE操作的效果。闪回丢弃比在这种情况下可以使用的其他恢复机制（如时间点恢复）更快，并且不会导致停机或丢失最近的事务。在执行闪回删除操作之前，必须满足先决条件。使用FLASHBACK TABLE ...在DROP语句之前要从回收站中恢复对象。您可以指定回收站中表的名称或原始表名。您可以使用相同的原始名称创建，然后删除多个对象。所有丢弃的对象都存储在回收站中。闪回数据库通过将数据库返回到先前某个时间点的状态来反转不需要的更改。闪回数据库通过撤消对运行命令时存在的数据文件的更改来工作。必须满足先决条件才能执行闪回数据库操作。闪回数据库操作使用FLASHBACK DATABASE命令将数据库回滚到过去的某个时间点。您可以使用FLASHBACK DATABASE命令为整个多租户容器数据库（CDB）执行闪回数据库操作。您可以使用FLASHBACK DATABASE命令对多租户容器数据库（CDB）中的单个可插拔数据库（PDB）执行闪回数据库操作。数据字典视图包含用于监视闪回数据库的信息。RMAN DBPITR在目标恢复时间之前从备份还原数据库，然后使用增量备份和重做将数据库前滚到目标时间。您可以恢复到SCN，时间，日志序列号或还原点。Oracle建议您在重要时间创建还原点，以便在必要时使时间点恢复更易于管理。必须满足某些先决条件才能执行数据库时间点恢复（DBPITR）。使用RESTORE和RECOVER命令执行DBPITR。使用RECOVER命令执行容器数据库（CDB）和可插拔数据库（PDB）的时间点恢复（PITR）。PDB的PITR只能使用RMAN执行。使用RESTORE和RECOVER命令为整个CDB执行时间点恢复。当您将一个或多个PDB恢复到指定的时间点时，剩余的PDB将在国家开发银行不受影响，可以开放和运作。使用RESTORE和RECOVER命令执行应用程序PDB的时间点恢复。执行稀疏数据库的时间点恢复类似于执行正常数据库的时间点恢复。本节介绍基本闪回数据库和DBPITR方案的变体。闪回数据库可用于撤消OPEN RESETLOGS操作。跨OPEN RESETLOGS的闪回数据库可用于在Data Guard环境中执行多个功能。您可以使用闪回数据库将数据库回滚到废弃的数据库化身。要将DPITR执行到非当前数据库化身，必须显式执行RESET DATABASE以将数据库重置为目标SCN上当前的化身。您还必须从包含目标SCN的数据库化身中还原控制文件。">执行闪回和数据库时间点恢复</a> 。
                  </p>
               </div>
            </div><a id="BRADV180"></a><div class="props_rev_3"><a id="GUID-FAA04D1F-36E2-4B20-954F-845E42386775" name="GUID-FAA04D1F-36E2-4B20-954F-845E42386775"></a><h3 id="BRADV-GUID-FAA04D1F-36E2-4B20-954F-845E42386775" class="sect3"><span class="enumeration_section">7.1</span>闪回数据库，还原点和保证还原点概述</h3>
               <div>
                  <p>Oracle闪回数据库和还原点是相关的数据保护功能，使您能够及时回溯数据，以纠正在指定时间窗口内由逻辑数据损坏或用户错误导致的任何问题。</p>
                  <p>这些功能提供了一种更有效的时间点恢复替代方案，并且不需要首先恢复数据库的备份。效果类似于<a href="glossary.html#GUID-FCC8BB91-79B6-4AF1-974A-43E75CD161E3"><span class="xrefglossterm">数据库时间点恢复（DBPITR）</span></a> 。闪回数据库和还原点不仅在传统数据库恢复情况下有效，而且在必须快速创建和重新创建测试数据库的数据库升级，应用程序部署和测试方案期间也很有用。闪回数据库还提供了在Data Guard故障转移后重建故障主数据库的有效替代方法。
                  </p>
                  <p>还原点提供与闪回数据库和其他介质恢复操作相关的功能。特别是，在系统更改号（SCN）上创建的保证还原点可确保您可以使用闪回数据库将数据库回滚到此SCN。您可以单独或一起使用还原点和闪回数据库。</p>
                  <p>闪回数据库可通过RMAN和SQL作为<code class="codeph">FLASHBACK DATABASE</code> 。您可以使用任一语言从逻辑数据损坏或用户错误中快速恢复数据库。以下示例将数据库返回到指定的SCN或还原点：</p><pre class="pre codeblock"><code>FLASHBACK DATABASE恢复PO''before_upgrade'; FLASHBACK DATABASE TO SCN 202381;</code></pre><div class="infoboxnotealso" id="GUID-FAA04D1F-36E2-4B20-954F-845E42386775__GUID-DB8A922F-0AA5-403B-BC4F-D927F669F039">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="../sbydb/examples-of-using-oracle-data-guard.html#SBYDB4891" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a></p>
                  </div>
               </div><a id="BRADV582"></a><div class="props_rev_3"><a id="GUID-509FB7A6-4CB2-4730-80CA-7B2D68F50773" name="GUID-509FB7A6-4CB2-4730-80CA-7B2D68F50773"></a><h4 id="BRADV-GUID-509FB7A6-4CB2-4730-80CA-7B2D68F50773" class="sect4"><span class="enumeration_section">7.1.1</span>关于闪回数据库</h4>
                  <div>
                     <p>闪回数据库的效果类似于传统的时间点恢复。它使您能够在最近的某个时间将数据库返回到其状态。闪回数据库比时间点恢复快得多，因为它不需要从备份中恢复数据文件，并且需要从归档重做日志中应用较少的更改。</p>
                     <p>如果数据文件完好无损，您可以使用闪回数据库将大多数不需要的更改反转到数据库。您可以将数据库返回到先前<a href="glossary.html#GUID-4CCAB7DD-FEA7-4237-AF2C-304BA3BD52B1"><span class="xrefglossterm">版本中的</span></a>状态，并撤消<a href="../sqlrf/ALTER-DATABASE.html#SQLRF00802" target="_blank"><code class="codeph">ALTER DATABASE OPEN RESETLOGS</code></a>语句的效果。 <span class="q">“ <a href="rman-performing-flashback-dbpitr.html#GUID-953FA30D-BED2-4DBA-8361-9DA1B8FF073F" title="闪回数据库通过将数据库返回到先前某个时间点的状态来反转不需要的更改。">使用闪回数据库重绕数据库</a> ”</span>说明了如何使用<code class="codeph">FLASHBACK</code> <code class="codeph">DATABASE</code>命令来反转数据库更改。
                     </p>
                     <p>闪回数据库使用自己的日志记录机制，创建<a href="glossary.html#GUID-725ED3D7-5077-4F16-85AA-CDAD5BFCE554"><span class="xrefglossterm">闪回日志</span></a>并将其存储在<a href="glossary.html#GUID-6E3CDD76-A573-4E5C-B12D-59C232C96C19"><span class="xrefglossterm">快速恢复区域中</span></a> 。如果闪回日志可用，则只能使用闪回数据库。要利用此功能，必须事先设置数据库以创建闪回日志。
                     </p>
                     <p>要启用闪回数据库，请配置快速恢复区域并设置<a href="glossary.html#GUID-F472DAAD-F619-47F7-B025-7FE21FD9E5DB"><span class="xrefglossterm">闪回保留目标</span></a> 。此保留目标指定使用闪回数据库回退数据库的时间。
                     </p>
                     <p>从那时起，数据库定期将每个数据文件中每个更改块的图像复制到闪回日志中。这些块图像可以在以后重复使用，以便在捕获日志的任何时刻重建数据文件内容。</p>
                     <p>使用闪回数据库将数据库回滚到过去的目标时间时，该命令将确定在目标时间之后更改了哪些块，并从闪回日志中恢复它们。数据库将恢复紧接目标时间之前的每个块的版本。然后，数据库使用重做日志重新应用在将这些块写入闪回日志后所做的更改。</p>
                     <p>磁盘或磁带上的重做日志必须在闪回日志跨越的整个时间段内可用。例如，如果闪回保留目标为1周，则必须确保可以访问包含过去一周所有更改的联机和归档重做日志。实际上，重做日志通常比闪回保留目标更长，以支持时间点恢复。</p>
                  </div>
               </div><a id="BRADV583"></a><div class="props_rev_3"><a id="GUID-9699CDF3-C01E-4104-8452-8F01443760AC" name="GUID-9699CDF3-C01E-4104-8452-8F01443760AC"></a><h4 id="BRADV-GUID-9699CDF3-C01E-4104-8452-8F01443760AC" class="sect4"><span class="enumeration_section">7.1.2</span>关于闪回数据库窗口</h4>
                  <div>
                     <p>当前有足够的闪回日志数据来支持<code class="codeph">FLASHBACK DATABASE</code>命令的SCN范围称为闪回数据库窗口。闪回数据库窗口不能比可用闪回日志中最早的SCN延伸得更远。
                     </p>
                     <p>您无法将闪回日志备份到快速恢复区域之外的位置。要增加保留足够的闪回日志以满足闪回数据库窗口的可能性，可以增加快速恢复区域的空间（请参阅<span class="q">“ <a href="configuring-rman-client-basic.html#GUID-233338E2-3EE6-4248-A2B6-16A7899DB14F__CHDDJJHE" title="该表描述了DB_RECOVERY_FILE_DEST_SIZE和DB_RECOVERY_FILE_DEST参数。">表5-3</a> ”</span> ）。
                     </p>
                     <p>如果快速恢复区域不足以容纳闪回日志和文件（如归档重做日志和保留策略所需的其他备份），则数据库可能会从最早的SCN中删除闪回日志，以便为其他文件腾出空间。因此，闪回数据库窗口可能比闪回保留目标短，具体取决于快速恢复区域的大小，必须保留的其他备份以及需要多少闪回日志记录数据。闪回保留目标是目标，而不是闪回数据库可用的保证。</p>
                     <p>如果由于闪回数据库窗口不够长而无法使用<code class="codeph">FLASHBACK DATABASE</code> ，那么通常可以使用数据库时间点恢复（DBPITR）来实现类似的结果。保证还原点是确保您可以使用闪回数据库返回特定时间点或保证闪回窗口大小的唯一方法。
                     </p>
                     <div class="infoboxnote" id="GUID-9699CDF3-C01E-4104-8452-8F01443760AC__GUID-CA78ADB1-9F49-4235-ADF1-471147F6858A">
                        <p class="notep1">注意：</p>
                        <p>某些数据库操作（例如删除表空间或缩小数据文件）无法使用闪回数据库进行反转。有关详细信息，请参阅<span class="q">“ <a href="using-flasback-database-restore-points.html#GUID-28EB12CA-6E98-4ED4-A798-1326E4A938AB" title="因为闪回数据库通过撤消对运行命令时存在的数据文件的更改来工作，所以它具有某些限制。">闪回数据库的限制</a> ”</span> 。
                        </p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-9699CDF3-C01E-4104-8452-8F01443760AC__GUID-CDAA88FD-BB79-406E-882C-4FFBA793F84D">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="rman-performing-flashback-dbpitr.html#GUID-953FA30D-BED2-4DBA-8361-9DA1B8FF073F" title="Flashback Database reverses unwanted changes by returning your database to its state at a previous point in time.">使用闪回数据库</a>重绕<a href="rman-performing-flashback-dbpitr.html#GUID-953FA30D-BED2-4DBA-8361-9DA1B8FF073F" title="闪回数据库通过将数据库返回到先前某个时间点的状态来反转不需要的更改。">数据库</a>以了解闪回数据库</p>
                           </li>
                           <li>
                              <p><a href="rman-performing-flashback-dbpitr.html#GUID-7D3EE2F7-77A2-4264-8875-CC0AEC64ABE0" title="RMAN DBPITR在目标恢复时间之前从备份还原数据库，然后使用增量备份和重做将数据库前滚到目标时间。您可以恢复到SCN，时间，日志序列号或还原点。Oracle建议您在重要时间创建还原点，以便在必要时使时间点恢复更易于管理。">执行数据库时间点恢复</a>以了解DBPITR</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV286"></a><div class="props_rev_3"><a id="GUID-28EB12CA-6E98-4ED4-A798-1326E4A938AB" name="GUID-28EB12CA-6E98-4ED4-A798-1326E4A938AB"></a><h4 id="BRADV-GUID-28EB12CA-6E98-4ED4-A798-1326E4A938AB" class="sect4"><span class="enumeration_section">7.1.3</span>闪回数据库的局限性</h4>
                  <div>
                     <p>因为闪回数据库通过撤消对运行命令时存在的数据文件的更改来工作，所以它具有某些限制。</p>
                     <p>以下是闪回数据库的限制：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>闪回数据库只能撤消对Oracle数据库创建的数据文件的更改。它不能用于修复介质故障，也不能用于意外删除数据文件。</p>
                        </li>
                        <li>
                           <p>您无法使用闪回数据库撤消收缩数据文件操作。但是，您可以使缩小的文件脱机，闪回数据库的其余部分，然后还原并恢复缩小的数据文件。</p>
                        </li>
                        <li>
                           <p>您无法单独使用闪回数据库来检索已删除的数据文件。如果将数据库闪回到数据库中存在已删除数据文件的时间，则只会将数据文件条目添加到控制文件中。您只能使用RMAN恢复已删除的数据文件，以完全还原和恢复数据文件。</p>
                        </li>
                        <li>
                           <p>如果从备份还原或重新创建数据库控制文件，则会丢弃所有累积的闪回日志信息。您无法使用<code class="codeph">FLASHBACK DATABASE</code>返回到还原或重新创建控制文件之前的某个时间点。
                           </p>
                        </li>
                        <li>
                           <p>当使用具有<code class="codeph">NOLOGGING</code>操作正在进行的目标时间的闪回数据库时，受<code class="codeph">NOLOGGING</code>操作影响的数据库对象和数据文件中可能存在块损坏。例如，如果在<code class="codeph">NOLOGGING</code>模式下执行直接路径<code class="codeph">INSERT</code>操作，并且该操作在2005年4月3日9:00到9:15运行，并且您稍后使用闪回数据库返回到目标时间09:07在该日期，直接路径<code class="codeph">INSERT</code>更新的对象和数据文件可能在闪回数据库操作完成后留下块损坏。
                           </p>
                           <p>如果可能，请避免使用闪回数据库，其目标时间或SCN与<code class="codeph">NOLOGGING</code>操作一致。此外，在任何<code class="codeph">NOLOGGING</code>操作之后立即执行受影响数据文件的完全备份或增量备份，以确保在操作之后的时间点的可恢复性。如果您希望在诸如直接路径<code class="codeph">INSERT</code>类的操作期间使用闪回数据库返回某个时间点，请考虑在<code class="codeph">LOGGING</code>模式下执行操作。
                           </p>
                           <div class="infoboxnotealso" id="GUID-28EB12CA-6E98-4ED4-A798-1326E4A938AB__GUID-76D3EF63-9FC7-4084-ACEA-9F811164EAEA">
                              <p class="notep1">也可以看看：</p>
                              <p>有关支持<code class="codeph">NOLOGGING</code>模式的操作的详细信息，请<a href="../sqlrf/logging_clause.html#SQLRF30009" target="_blank"><span><cite>参见Oracle数据库SQL语言参考</cite></span></a> 。
                              </p>
                           </div>
                        </li>
                     </ul>
                  </div>
               </div><a id="BRADV529"></a><div class="props_rev_3"><a id="GUID-1EE0CCDD-BAA4-402B-B808-D228212AF772" name="GUID-1EE0CCDD-BAA4-402B-B808-D228212AF772"></a><h4 id="BRADV-GUID-1EE0CCDD-BAA4-402B-B808-D228212AF772" class="sect4"><span class="enumeration_section">7.1.4</span>关于正常还原点</h4>
                  <div>
                     <p>创建正常还原点会将还原点名称分配给SCN或特定时间点。</p>
                     <p>因此，还原点用作此SCN的书签或别名。在执行您可能必须撤消的任何操作之前，您可以创建正常的还原点。控制文件存储还原点的名称和SCN。</p>
                     <p>如果使用闪回功能或时间点恢复，则可以使用还原点的名称而不是时间或SCN。以下命令支持使用还原点：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>RMAN中的<a href="../rcmrf/RECOVER.html#RCMRF140" target="_blank"><code class="codeph">RECOVER DATABASE</code></a>和<code class="codeph">FLASHBACK DATABASE</code>命令</p>
                        </li>
                        <li>
                           <p>SQL中的<a href="../sqlrf/FLASHBACK-TABLE.html#SQLRF01802" target="_blank"><code class="codeph">FLASHBACK TABLE</code></a>语句</p>
                        </li>
                     </ul>
                     <p>创建正常还原点消除了事先手动记录SCN或通过使用闪回查询等功能确定事后的正确SCN。</p>
                     <p>正常还原点是轻量级的。控制文件可以维护数千个正常还原点的记录，而不会对数据库性能产生重大影响。如果不手动删除，正常还原点最终会从控制文件中老化，因此它们不需要持续维护。</p>
                     <div class="infoboxnotealso" id="GUID-1EE0CCDD-BAA4-402B-B808-D228212AF772__GUID-04F2EBB0-9D6A-42CE-A57B-278B783C0C6F">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../adfns/flashback.html#ADFNS1008" target="_blank"><span><cite>Oracle数据库开发指南</cite></span></a> ，了解如何使用闪回查询</p>
                     </div>
                  </div>
               </div><a id="BRADV530"></a><div class="props_rev_3"><a id="GUID-82523F18-5AE7-40C8-972D-35A9423F19B7" name="GUID-82523F18-5AE7-40C8-972D-35A9423F19B7"></a><h4 id="BRADV-GUID-82523F18-5AE7-40C8-972D-35A9423F19B7" class="sect4"><span class="enumeration_section">7.1.5</span>关于保证还原点</h4>
                  <div>
                     <p>与正常还原点一样，保证还原点充当恢复操作中SCN的别名。主要区别在于保证的还原点永远不会超出控制文件的范围，必须明确删除。</p>
                     <p>通常，您可以使用保证还原点作为SCN的别名，并使用适用于正常还原点的任何命令。除非另有说明，否则有关使用正常还原点的位置和方式的信息也适用于保证还原点。</p>
                     <p>保证还原点可确保您可以使用闪回数据库将数据库回滚到还原点SCN的状态，即使禁用了<a href="glossary.html#GUID-725ED3D7-5077-4F16-85AA-CDAD5BFCE554"><span class="xrefglossterm">闪回日志</span></a>的生成也是如此。如果启用了闪回日志记录，则保证还原点会强制在最早的保证还原点之后将闪回数据库所需的闪回日志保留到任何SCN。因此，如果启用了闪回日志记录，则可以将数据库回滚到连续统一体中的任何SCN，而不是仅回滚到单个SCN。
                     </p>
                     <div class="infoboxnote" id="GUID-82523F18-5AE7-40C8-972D-35A9423F19B7__GUID-6108369A-D8BC-4DD7-93F6-A811F2A453E9">
                        <p class="notep1">注意：</p>
                        <p>如果禁用了闪回日志记录，那么您<span class="italic">无法</span>在保证还原点和当前时间之间直接向SCN进行<code class="codeph">FLASHBACK DATABASE</code> 。但是，您可以先闪回保证还原点，然后在保证还原点和当前时间之间恢复到SCN。
                        </p>
                     </div>
                     <p>如果恢复区域有足够的磁盘空间来存储所需的日志，那么您可以使用保证的还原点将整个数据库倒回到几天或几周前的已知良好状态。与闪回数据库一样，即使是直接加载插入等<code class="codeph">NOLOGGING</code>操作的效果也可以通过保证还原点来反转。
                     </p>
                     <div class="infoboxnote" id="GUID-82523F18-5AE7-40C8-972D-35A9423F19B7__GUID-B993BD4D-AB0A-4E19-B8EA-0FF07F26656E">
                        <p class="notep1">注意：</p>
                        <p>适用于闪回数据库的限制也适用于保证还原点。例如，缩小数据文件或删除表空间可以防止将受影响的数据文件闪回到保证还原点。有关详细信息，请参阅<span class="q">“ <a href="using-flasback-database-restore-points.html#GUID-28EB12CA-6E98-4ED4-A798-1326E4A938AB" title="因为闪回数据库通过撤消对运行命令时存在的数据文件的更改来工作，所以它具有某些限制。">闪回数据库的限制</a> ”</span> 。此外，如果数据库中有保证的还原点，则无法将数据库兼容性参数设置为更高的数据库版本。尝试这样做会导致错误。存在此限制是因为闪回数据库当前无法使用兼容性初始化参数来逆转增加数据库版本的影响。
                        </p>
                     </div>
                  </div><a id="BRADV543"></a><div class="props_rev_3"><a id="GUID-F70E202F-A53C-4E33-AB0F-7091EA3DE608" name="GUID-F70E202F-A53C-4E33-AB0F-7091EA3DE608"></a><h5 id="BRADV-GUID-F70E202F-A53C-4E33-AB0F-7091EA3DE608" class="sect5"><span class="enumeration_section">7.1.5.1</span>保证还原点与存储快照</h5>
                     <div>
                        <p>实际上，有保证的还原点是存储快照的有用替代方案。</p>
                        <p>存储快照通常用于在风险操作（如大规模数据库更新或应用程序修补程序或升级）之前保护数据库。您可以在主<a href="glossary.html#GUID-009B3F56-8C1E-4CF6-AF0F-A9D2C2E4B9C2"><span class="xrefglossterm">数据库</span></a>或<a href="glossary.html#GUID-009B3F56-8C1E-4CF6-AF0F-A9D2C2E4B9C2"><span class="xrefglossterm">物理备用数据库</span></a>上创建保证还原点，而不是创建快照或<a href="glossary.html#GUID-FFB6CFD5-300C-4290-B3C0-BFD930ACA30C"><span class="xrefglossterm">重复数据库</span></a>来测试操作。然后，您可以确保保留所需的闪回日志，从而执行危险操作。
                        </p>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-1150031F-3C15-40C8-BA91-A387F75DC49A" name="GUID-1150031F-3C15-40C8-BA91-A387F75DC49A"></a><h4 id="BRADV-GUID-1150031F-3C15-40C8-BA91-A387F75DC49A" class="sect4"><span class="enumeration_section">7.1.6</span>多租户环境中还原点概述</h4>
                  <div>
                     <p>您可以在多租户环境中创建正常和保证还原点。</p>
                     <p>数据库还原点的基本概念也适用于多租户环境中的还原点。您可以在多租户环境中创建以下类型的还原点：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>CDB还原点</p>
                        </li>
                        <li>
                           <p>PDB还原点</p>
                        </li>
                        <li>
                           <p>清理PDB还原点</p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-1150031F-3C15-40C8-BA91-A387F75DC49A__GUID-8755F8B6-622E-4F09-B935-65BC555C1852">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="using-flasback-database-restore-points.html#GUID-FAA04D1F-36E2-4B20-954F-845E42386775" title="Oracle闪回数据库和还原点是相关的数据保护功能，使您能够及时回溯数据，以纠正在指定时间窗口内由逻辑数据损坏或用户错误导致的任何问题。">闪回数据库，还原点和保证还原点概述</a></p>
                           </li>
                           <li>
                              <p><a href="using-flasback-database-restore-points.html#GUID-434CD26D-D3DC-454B-A598-70F64D7C01EB" title="CDB还原点充当SCN的别名或多租户容器数据库（CDB）中的时间点。它可以是正常的还原点或保证还原点。">关于CDB还原点</a></p>
                           </li>
                           <li>
                              <p><a href="using-flasback-database-restore-points.html#GUID-34C48821-B29D-4A2E-94DE-CD97CFA7784E" title="您可以在可插拔数据库（PDB）中创建正常和保证还原点。PDB还原点只能由定义它们的PDB访问。">关于PDB中的还原点</a></p>
                           </li>
                           <li>
                              <p><a href="using-flasback-database-restore-points.html#GUID-B48EF079-BBAF-45C3-8FB5-8BA5BBE90BE4" title="每个可插拔数据库（PDB）都有自己的还原点命名空间。因此，您可以在多个PDB中定义具有相同名称的PDB还原点。">关于PDB还原点的命名空间</a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-434CD26D-D3DC-454B-A598-70F64D7C01EB" name="GUID-434CD26D-D3DC-454B-A598-70F64D7C01EB"></a><h5 id="BRADV-GUID-434CD26D-D3DC-454B-A598-70F64D7C01EB" class="sect5"><span class="enumeration_section">7.1.6.1</span>关于CDB还原点</h5>
                     <div>
                        <p>CDB还原点充当SCN的别名或多租户容器数据库（CDB）中的时间点。它可以是正常的还原点或保证还原点。</p>
                        <p>CDB还原点与非CDB中的还原点类似，只是您需要以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的公共用户身份连接到root用户才能创建它们。您可以从Oracle Database 12 <span class="italic">c</span>第1版（12.1）开始创建CDB还原点。CDB中的每个<a href="glossary.html#GUID-D4239448-A344-41EF-9566-0B7716FEAE72"><span class="xrefglossterm">可插拔数据库（PDB）</span></a>都可以访问CDB还原点。但是，CDB还原点不反映其任何PDB的PDB子化身。
                        </p>
                        <p>CDB还原点在以下方案中很有用：</p>
                        <div class="p">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>整个CDB需要恢复到特定时间点</p>
                              </li>
                              <li>
                                 <p>CDB中的多个PDB需要恢复到特定时间点</p>
                              </li>
                           </ul>
                        </div>
                        <div class="infoboxnotealso" id="GUID-434CD26D-D3DC-454B-A598-70F64D7C01EB__GUID-7E1B6E0B-21C0-4318-B1DF-8A200C839894">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="using-flasback-database-restore-points.html#GUID-1150031F-3C15-40C8-BA91-A387F75DC49A" title="您可以在多租户环境中创建正常和保证还原点。">多租户环境中的还原点概述</a></p>
                              </li>
                              <li>
                                 <p><a href="using-flasback-database-restore-points.html#GUID-34C48821-B29D-4A2E-94DE-CD97CFA7784E" title="您可以在可插拔数据库（PDB）中创建正常和保证还原点。PDB还原点只能由定义它们的PDB访问。">关于PDB中的还原点</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-A2146E48-16FC-40CC-B25D-902DEB93CB75" title="您可以对整个多租户容器数据库（CDB）或特定可插拔数据库（PDB）执行闪回数据库操作。">为CDB和PDB执行闪回数据库的基本概念</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-8466CA3C-652A-4AAB-88EB-8815575D6266" title="您可以使用FLASHBACK DATABASE命令为整个多租户容器数据库（CDB）执行闪回数据库操作。">为整个CDB执行闪回数据库操作</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-34C48821-B29D-4A2E-94DE-CD97CFA7784E" name="GUID-34C48821-B29D-4A2E-94DE-CD97CFA7784E"></a><h5 id="BRADV-GUID-34C48821-B29D-4A2E-94DE-CD97CFA7784E" class="sect5"><span class="enumeration_section">7.1.6.2</span>关于PDB中的还原点</h5>
                     <div>
                        <p>您可以在可插拔数据库（PDB）中创建正常和保证还原点。PDB还原点只能由定义它们的PDB访问。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-34C48821-B29D-4A2E-94DE-CD97CFA7784E__GUID-3D24200C-BF0F-40F9-A313-F7C61DC3D1B1">PDB还原点</p>
                           <p>PDB还原点是指向特定<a href="glossary.html#GUID-D4239448-A344-41EF-9566-0B7716FEAE72"><span class="xrefglossterm">可插拔数据库（PDB）</span></a>中的时间点或SCN的书签。它仅适用于创建它的PDB，仅可用于该PDB上的操作。 PDB还原点表示创建它的时间点的PDB子化身。
                           </p>
                           <p>PDB还原点可以是正常还原点或保证还原点。保证的PDB还原点可确保您可以执行PDB到此还原点的闪回操作。</p>
                           <p>PDB还原点可用于仅对创建它的PDB执行闪回数据库操作或时间点恢复。</p>
                           <div class="infoboxnote" id="GUID-34C48821-B29D-4A2E-94DE-CD97CFA7784E__GUID-089C70FC-0407-4230-857E-D48FB875DBD3">
                              <p class="notep1">注意：</p>创建有保证的PDB还原点需要仔细考虑，因为此类还原点可以防止<a href="glossary.html#GUID-3E156A59-F6CC-4A2A-9749-DB7D1CE25F13"><span class="xrefglossterm">多租户容器数据库（CDB）中</span></a>所需的闪回日志被重用。这可能会影响CDB的运行，因为快速恢复区域可能会耗尽空间。
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-34C48821-B29D-4A2E-94DE-CD97CFA7784E__GUID-E2BAB79B-382A-4B96-AA7B-1208CF6509DE">清理PDB还原点</p>
                           <p>干净的PDB还原点是在PDB关闭时以及该PDB没有未完成的事务时创建的PDB还原点。 Clean PDB还原点仅适用于使用共享撤消的CDB。</p>
                           <p>清洁PDB还原点可以是正常或保证还原点。使用<code class="codeph">CREATE CLEAN RESTORE POINT</code>命令显式创建干净的PDB还原点。对于使用共享撤消的CDB，如果PDB已关闭且没有未完成的事务，则创建的任何PDB还原点都将标记为干净的PDB还原点。
                           </p>
                           <p>如果您预计可能需要将PDB回放到特定时间点（例如，应用程序升级之前的某个状态），则建议您创建一个干净的PDB保证还原点。</p>
                           <p>对于使用共享撤消的CDB，对干净PDB还原点的闪回数据库操作比对SCN或其他不是干净PDB还原点的还原点的闪回数据库操作要快。这是因为RMAN不需要在对干净的PDB还原点执行闪回操作时还原任何备份。</p>
                           <div class="infoboxnotealso" id="GUID-34C48821-B29D-4A2E-94DE-CD97CFA7784E__GUID-3943E87F-DF4B-40DD-852D-191E5BBF2434">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="using-flasback-database-restore-points.html#GUID-B48EF079-BBAF-45C3-8FB5-8BA5BBE90BE4" title="每个可插拔数据库（PDB）都有自己的还原点命名空间。因此，您可以在多个PDB中定义具有相同名称的PDB还原点。">关于PDB还原点的命名空间</a></p>
                                 </li>
                                 <li>
                                    <p><a href="using-flasback-database-restore-points.html#GUID-434CD26D-D3DC-454B-A598-70F64D7C01EB" title="CDB还原点充当SCN的别名或多租户容器数据库（CDB）中的时间点。它可以是正常的还原点或保证还原点。">关于CDB还原点</a></p>
                                 </li>
                                 <li>
                                    <p><a href="rman-performing-flashback-dbpitr.html#GUID-A2146E48-16FC-40CC-B25D-902DEB93CB75" title="您可以对整个多租户容器数据库（CDB）或特定可插拔数据库（PDB）执行闪回数据库操作。">为CDB和PDB执行闪回数据库的基本概念</a></p>
                                 </li>
                                 <li>
                                    <p><a href="rman-performing-flashback-dbpitr.html#GUID-C1215E86-9A7B-4EC9-9777-2A18BD627394" title="您可以使用FLASHBACK DATABASE命令对多租户容器数据库（CDB）中的单个可插拔数据库（PDB）执行闪回数据库操作。">为PDB执行闪回数据库操作</a></p>
                                 </li>
                                 <li>
                                    <p><a href="rman-data-repair-concepts.html#GUID-195FE6CA-9CEB-4ED1-9810-F7323F119D87" title="可插拔数据库（PDB）版本是多租户容器数据库（CDB）的子实现，表示为（database_incarnation，pdb_incarnation）。">关于PDB的化身</a></p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-B48EF079-BBAF-45C3-8FB5-8BA5BBE90BE4" name="GUID-B48EF079-BBAF-45C3-8FB5-8BA5BBE90BE4"></a><h5 id="BRADV-GUID-B48EF079-BBAF-45C3-8FB5-8BA5BBE90BE4" class="sect5"><span class="enumeration_section">7.1.6.3</span>关于PDB还原点的命名空间</h5>
                     <div>
                        <p>每个可插拔数据库（PDB）都有自己的还原点命名空间。因此，您可以在多个PDB中定义具有相同名称的PDB还原点。</p>
                        <p>在多租户环境中，当您在PDB中使用还原点名称或PDB操作时，该名称首先被解释为相关PDB的<a href="glossary.html#GUID-7C3A47D4-B9C5-40D3-89D0-8BD77281AAB1"><span class="xrefglossterm">PDB还原点</span></a> 。如果找不到具有指定名称的PDB还原点，则将其解释为<a href="glossary.html#GUID-6BFC6E77-175D-4055-8198-6091D47AD8F6"><span class="xrefglossterm">CDB还原点</span></a> 。
                        </p>
                        <div class="infoboxnotealso" id="GUID-B48EF079-BBAF-45C3-8FB5-8BA5BBE90BE4__GUID-0A64EBF8-E3C5-408F-8C6A-F0A3CF405C9A">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="using-flasback-database-restore-points.html#GUID-34C48821-B29D-4A2E-94DE-CD97CFA7784E" title="您可以在可插拔数据库（PDB）中创建正常和保证还原点。PDB还原点只能由定义它们的PDB访问。">关于PDB中的还原点</a></p>
                        </div>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV577"></a><div class="props_rev_3"><a id="GUID-E90F7FBD-CCE2-4234-A3B4-FDFEC3BC2E90" name="GUID-E90F7FBD-CCE2-4234-A3B4-FDFEC3BC2E90"></a><h3 id="BRADV-GUID-E90F7FBD-CCE2-4234-A3B4-FDFEC3BC2E90" class="sect3"><span class="enumeration_section">7.2</span>关于记录闪回数据库和保证还原点</h3>
               <div>
                  <p>记录闪回数据库和保证还原点涉及在应用更改之前捕获数据文件块的映像。<code class="codeph">FLASHBACK DATABASE</code>命令可以使用这些图像将数据文件返回到先前的状态。
                  </p>
                  <p>正常闪回日志记录和保证还原点的日志记录之间的主要区别与何时记录块以及是否可以响应快速恢复区域中的空间压力而删除日志有关。这些差异会影响日志和数据库性能的空间使用。</p>
                  <p>您的可恢复性目标部分地确定是启用闪回数据库的日志记录，还是使用保证还原点，或两者都使用。这些功能在性能和空间使用方面的影响，分别和一起使用时，也会影响您的决策。</p>
               </div><a id="BRADV581"></a><div class="props_rev_3"><a id="GUID-36048C35-BCC7-4D1F-8E2A-C2254D732EEE" name="GUID-36048C35-BCC7-4D1F-8E2A-C2254D732EEE"></a><h4 id="BRADV-GUID-36048C35-BCC7-4D1F-8E2A-C2254D732EEE" class="sect4"><span class="enumeration_section">7.2.1</span>保证还原点和快速恢复区空间使用</h4>
                  <div>
                     <p>某些规则管理快速恢复区域中空间的使用。</p>
                     <p>创建保证还原点时，无论是否启用完全闪回数据库日志记录，都必须监视快速恢复区域中的可用空间。 <span class="q">“ <a href="maintaining-rman-backups.html#GUID-26C1A1E8-5555-4399-9DD1-39BA90E45A0C" title="除了设置闪回保留目标或使用保证还原点之外，您无法直接管理快速恢复区域中的闪回日志。">在快速恢复区域中管理闪回日志的空间</a> ”</span>介绍了如何监视快速恢复区磁盘空间的使用情况。
                     </p>
                     <p>以下规则管理快速恢复区域中闪回日志的创建，保留，覆盖和删除：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>如果快速恢复区域有足够的空间，则会在必要时创建闪回日志以满足闪回保留目标。</p>
                        </li>
                        <li>
                           <p>如果闪回日志足够大，不再需要满足闪回保留目标，则会重复使用闪回日志。</p>
                        </li>
                        <li>
                           <p>如果数据库必须创建闪回日志并且快速恢复区域已满或没有磁盘空间，则会重新使用最旧的闪回日志。</p>
                           <div class="infoboxnote" id="GUID-36048C35-BCC7-4D1F-8E2A-C2254D732EEE__GUID-AF4F2CFC-7C8D-4C5D-8922-E0FF099A4C11">
                              <p class="notep1">注意：</p>
                              <p>重用最旧的闪回日志可缩短闪回数据库窗口。如果由于磁盘空间不足而重用了足够的闪回日志，则可能无法满足闪回保留目标。</p>
                           </div>
                        </li>
                        <li>
                           <p>如果快速恢复区域已满，则可以通过快速恢复区域自动删除根据快速恢复区域规则可回收的归档重做日志，以便为其他文件腾出空间。在这种情况下，任何需要使用该重做日志文件以使用<code class="codeph">FLASHBACK DATABASE</code>闪回日志也将被删除。
                           </p>
                           <div class="infoboxnote" id="GUID-36048C35-BCC7-4D1F-8E2A-C2254D732EEE__GUID-8D953A0A-806D-43DB-AF26-DFA84707E8FE">
                              <p class="notep1">注意：</p>
                              <p>根据快速恢复区域规则，当满足以下条件之一时，文件可回收：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>该文件报告为过时，闪回数据库不需要。例如，该文件位于<code class="codeph">DB_FLASHBACK_RETENTION_TARGET</code>参数之外。
                                    </p>
                                 </li>
                                 <li>
                                    <p>该文件备份到磁带。</p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li>
                           <p>如果需要满足保证还原点，则快速恢复区中的文件不符合删除条件。但是，在备份到磁盘或磁带后，可能会删除满足保证还原点所需的归档重做日志。使用RMAN <code class="codeph">FLASHBACK DATABASE</code>命令时，如果快速恢复区域中没有满足指定保证还原点所需的归档重做日志，则会从备份中还原它们。
                           </p>
                           <p>除了满足备份保留策略所需的文件之外，保留闪回日志和满足保证还原点所需的其他文件可以使快速恢复区域完全填满。如果您的快速恢复区域已满，请参阅<span class="q">“ <a href="maintaining-rman-backups.html#GUID-3F11ECB5-1321-45F5-A557-BB1A5BAF011F" title="如果RMAN保留策略要求保留一组大于快速恢复区磁盘配额的备份，或者保留策略设置为NONE，则快速恢复区域可以完全填充，没有可回收空间。">响应完全快速恢复区</a> ”</span> 。
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-36048C35-BCC7-4D1F-8E2A-C2254D732EEE__GUID-DE859F0F-29CD-4859-9113-B871BD4DC08D">
                        <p class="notep1">警告：</p>
                        <p>如果由于保留策略和保证还原点所强加的要求，没有文件可以从快速恢复区域中删除，则数据库就会像遇到磁盘已满状态一样执行。在许多情况下，这会导致数据库暂停。请参阅<span class="q">“ <a href="maintaining-rman-backups.html#GUID-3F11ECB5-1321-45F5-A557-BB1A5BAF011F" title="如果RMAN保留策略要求保留一组大于快速恢复区磁盘配额的备份，或者保留策略设置为NONE，则快速恢复区域可以完全填充，没有可回收空间。">响应完全快速恢复区</a> ”</span> 。
                        </p>
                     </div>
                  </div>
               </div><a id="BRADV584"></a><div class="props_rev_3"><a id="GUID-D0FAAADC-6185-4F8D-A557-18346EE3BDFF" name="GUID-D0FAAADC-6185-4F8D-A557-18346EE3BDFF"></a><h4 id="BRADV-GUID-D0FAAADC-6185-4F8D-A557-18346EE3BDFF" class="sect4"><span class="enumeration_section">7.2.2</span>关于禁用闪回日志记录的有保证还原点的日志记录</h4>
                  <div>
                     <p>假设您在禁用闪回数据库的日志记录时创建了保证还原点。在这种情况下，第一次在保证还原点之后修改数据文件块时，数据库在闪回日志中存储修改之前的块的映像。因此，当创建保证还原点时，闪回日志会保留每个已更改数据块的内容。稍后对同一块的修改不会导致再次记录内容，除非在上次修改块之后创建了另一个保证还原点，或者后续闪回数据库操作已恢复块的原始内容。使用闪回数据库将数据库多次还原到同一还原点时，通常会每次都删除并重新创建保证还原点。这将删除旧的闪回日志，并确保不会超出快速恢复区域的空间配额。</p>
                     <p>这种日志记录方法具有以下重要结果：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">FLASHBACK DATABASE</code>可以使用块图像在保证还原点时重新创建数据文件内容。
                           </p>
                        </li>
                        <li>
                           <p>对于反复修改相同数据的工作负载，磁盘空间使用量可能低于正常的闪回日志记录。需要更少的空间，因为每个更改的块只记录一次。具有低容量插入的应用程序可以从节省磁盘空间中受益。对于具有高容量插入物或大批量插入物的应用，该优点不太可能。在没有启用闪回数据库日志记录的情况下记录保证还原点的性能开销也可能较低。</p>
                        </li>
                     </ul>
                     <p>假设您的主要目标是将数据库返回到创建保证还原点的时间。在这种情况下，关闭闪回日志记录并仅使用保证还原点通常更有效。例如，假设您在一个周末在数据库主机上执行应用程序升级。您可以在升级开始时创建保证还原点。如果升级失败，则使用<code class="codeph">FLASHBACK DATABASE</code>命令反转更改。
                     </p>
                  </div>
               </div><a id="BRADV585"></a><div class="props_rev_3"><a id="GUID-502D1646-2A81-4F04-BC3A-1927298A8F8D" name="GUID-502D1646-2A81-4F04-BC3A-1927298A8F8D"></a><h4 id="BRADV-GUID-502D1646-2A81-4F04-BC3A-1927298A8F8D" class="sect4"><span class="enumeration_section">7.2.3</span>关于定义保证还原点的闪回数据库的日志记录</h4>
                  <div>
                     <p>如果启用闪回数据库并定义一个或多个保证还原点，则数据库将执行正常的闪回日志记录。</p>
                     <p>在这种情况下，恢复区域保留闪回到当前和最早的当前定义的保证还原点之间的任意时间所需的闪回日志。如果要求闪回日志满足保证，则不会删除闪回日志以响应空间压力。</p>
                     <p>闪回日志记录会导致一些性能开销。根据数据库上的活动模式，它还可能在快速恢复区域中造成巨大的空间压力。因此，您应该监视快速恢复区域中使用的空间。</p>
                  </div>
               </div>
            </div><a id="BRADV587"></a><a id="BRADV588"></a><a id="BRADV586"></a><div class="props_rev_3"><a id="GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D" name="GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D"></a><h3 id="BRADV-GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D" class="sect3"><span class="enumeration_section">7.3</span>闪回数据库和还原点的先决条件</h3>
               <div>
                  <p>要确保闪回数据库的成功运行和有保证的还原点，必须先设置一些关键数据库选项。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D__GUID-87114FE1-B383-4CB4-B570-357182ED62F3">闪回数据库</p>
                  </div>
                  <!-- class="section" -->
                  <p>在启用闪回数据库之前配置以下数据库设置：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>您的数据库必须以<code class="codeph">ARCHIVELOG</code>模式运行，因为存档日志用于闪回数据库操作。
                        </p>
                     </li>
                     <li>
                        <p>您必须启用快速恢复区域，因为闪回日志只能存储在快速恢复区域中。</p>
                     </li>
                     <li>
                        <p>对于Oracle Real Application Clusters（Oracle RAC）数据库，快速恢复区域必须位于群集文件系统或ASM中。</p>
                        <p></p>
                     </li>
                     <li>
                        <p>要在CDB中创建还原点， <code class="codeph">COMPATIBLE</code>初始化参数必须设置为12.1.0或更高。
                        </p>
                     </li>
                  </ul>
                  <div class="section">
                     <p class="subhead2" id="GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D__GUID-445F9F3A-43B3-497A-A7DB-D40039A65732">保证还原点</p>
                  </div>
                  <!-- class="section" -->
                  <p>要使用有保证的还原点，数据库必须满足以下附加先决条件： <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=REFRN10019" target="_blank"><code class="codeph">COMPATIBLE</code></a>初始化参数必须设置为10.2.0或更高。
                  </p>
                  <div class="infoboxnote" id="GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D__GUID-5DA71B43-3FF6-410F-ADC8-7002C19DA1EA">
                     <p class="notep1">注意：</p>
                     <p>在使用正常还原点之前，没有特殊的先决条件。</p>
                  </div>
                  <div class="section">
                     <p class="subhead2" id="GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D__GUID-953B42D0-1F22-4958-BF09-8BC0528FB166">在PDB中还原点</p>要在<a href="glossary.html#GUID-D4239448-A344-41EF-9566-0B7716FEAE72"><span class="xrefglossterm">可插拔数据库（PDB）中</span></a>创建还原点， <code class="codeph">COMPATIBLE</code>初始化参数必须设置为12.2.0或更高。
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="BRADV589"></a><div class="props_rev_3"><a id="GUID-2C846D84-EDCC-4FAA-9F6A-05CD0C6C7C09" name="GUID-2C846D84-EDCC-4FAA-9F6A-05CD0C6C7C09"></a><h3 id="BRADV-GUID-2C846D84-EDCC-4FAA-9F6A-05CD0C6C7C09" class="sect3"><span class="enumeration_section">7.4</span>使用正常和保证的还原点</h3>
               <div>
                  <p>您可以创建，监视和删除正常和保证还原点。</p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="using-flasback-database-restore-points.html#GUID-1FD69FF6-F131-47D6-9ED8-592FEA1D13E1" title="要创建正常或保证还原点，请使用CREATE RESTORE POINT SQL语句，为还原点提供名称，并指定它是保证还原点还是正常还原点（默认值）。">在非CDB中创建正常和保证的还原点</a></p>
                     </li>
                     <li>
                        <p><a href="using-flasback-database-restore-points.html#GUID-952278F2-DBBA-4CB9-AAC4-616B56837AAB" title="CREATE RESTORE POINT SQL命令使您可以在多租户容器数据库（CDB）中创建正常和保证还原点。">创建CDB还原点</a></p>
                     </li>
                     <li>
                        <p><a href="using-flasback-database-restore-points.html#GUID-9363C4B9-48E5-470F-B13B-43FA56667978" title="您可以使用CREATE RESTORE POINT SQL语句在可插拔数据库（PDB）中创建还原点。">创建PDB还原点</a></p>
                     </li>
                     <li>
                        <p><a href="using-flasback-database-restore-points.html#GUID-305E9D61-0F50-4885-891C-A7D86C6D3C8D">使用LIST命令列出还原点</a></p>
                     </li>
                     <li>
                        <p><a href="using-flasback-database-restore-points.html#GUID-1A583D44-66CB-4D21-B170-2A07CFF6EE65" title="您可以使用V $ RESTORE_POINT控制文件视图来获取有关所有当前定义的还原点（正常和保证）的信息，包括CDB还原点和PDB还原点。">使用V $ RESTORE_POINT视图列出还原点</a></p>
                     </li>
                     <li>
                        <p><a href="using-flasback-database-restore-points.html#GUID-A1563822-015B-4941-B7EB-C3D44A63232C" title="如果您对不需要现有还原点感到满意，或者想要使用现有还原点的名称创建还原点，则可以使用DROP RESTORE POINT SQL * Plus语句删除还原点。">删除还原点</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV591"></a><a id="BRADV590"></a><div class="props_rev_3"><a id="GUID-1FD69FF6-F131-47D6-9ED8-592FEA1D13E1" name="GUID-1FD69FF6-F131-47D6-9ED8-592FEA1D13E1"></a><h4 id="BRADV-GUID-1FD69FF6-F131-47D6-9ED8-592FEA1D13E1" class="sect4"><span class="enumeration_section">7.4.1</span>在非CDB中创建正常和保证的还原点</h4>
                  <div>
                     <p>要创建正常或保证还原点，请使用<code class="codeph">CREATE RESTORE POINT</code> SQL语句，为还原点提供名称，并指定它是保证还原点还是正常还原点（默认值）。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-1FD69FF6-F131-47D6-9ED8-592FEA1D13E1__GUID-57886AAB-2D06-490D-A9CC-7CDEB295EF52">要创建还原点：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>将SQL * Plus连接到目标数据库。</span><div>
                              <div class="infoboxnotealso" id="GUID-1FD69FF6-F131-47D6-9ED8-592FEA1D13E1__GUID-B60F84B6-AF9E-436D-8665-24189928BC26">
                                 <p class="notep1">也可以看看：</p>
                                 <p>使用SQL * Plus连接<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=ADMIN-GUID-7842AF72-DA25-4559-A8E7-9883D0C63BF2" target="_blank"><span><cite>数据库的Oracle数据库管理员指南</cite></span></a></p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>确保数据库已打开或已装入。如果已装入数据库，则必须完全关闭它（除非它是物理备用数据库）。</span></li>
                        <li class="stepexpand"><span>运行<code class="codeph">CREATE RESTORE POINT</code>语句。</span><div>
                              <p>以下示例显示如何在SQL * Plus中创建常规还原点：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE RESTORE POINT before_upgrade;</pre><p>此示例显示如何创建保证还原点：</p><pre class="pre codeblock"><code>SQL&gt; CREATE RESTORE POINT before_upgrade GUARANTEE FLASHBACK DATABASE;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-1FD69FF6-F131-47D6-9ED8-592FEA1D13E1__GUID-2071B65F-23F8-44AF-A55F-C3E871D9D02B">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关SQL <code class="codeph">CREATE RESTORE POINT</code>语句的参考信息，请参见<a href="../sqlrf/CREATE-RESTORE-POINT.html#SQLRF20001" target="_blank"><span><cite>Oracle数据库SQL语言参考</cite></span></a></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="using-flasback-database-restore-points.html#GUID-305E9D61-0F50-4885-891C-A7D86C6D3C8D">使用LIST命令</a></span>列出还原点<span class="q">”</span>以了解如何列出还原点</p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="using-flasback-database-restore-points.html#GUID-A1563822-015B-4941-B7EB-C3D44A63232C" title="如果您对不需要现有还原点感到满意，或者想要使用现有还原点的名称创建还原点，则可以使用DROP RESTORE POINT SQL * Plus语句删除还原点。">删除还原点</a> ”</span>以了解如何删除还原点</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-952278F2-DBBA-4CB9-AAC4-616B56837AAB" name="GUID-952278F2-DBBA-4CB9-AAC4-616B56837AAB"></a><h4 id="BRADV-GUID-952278F2-DBBA-4CB9-AAC4-616B56837AAB" class="sect4"><span class="enumeration_section">7.4.2</span>创建CDB还原点</h4>
                  <div>
                     <p><code class="codeph">CREATE RESTORE POINT</code> SQL命令使您可以在多租户容器数据库（CDB）中创建正常和保证还原点。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-952278F2-DBBA-4CB9-AAC4-616B56837AAB__GUID-B7C0E398-DF3B-4609-A3BF-8F0F7B56CF41">要创建CDB还原点：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>确保满足<a href="using-flasback-database-restore-points.html#GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D" title="To ensure successful operation of Flashback Database and guaranteed restore points, you must first set some key database options.">闪回数据库和还原点</a>的先决条件中描述的<a href="using-flasback-database-restore-points.html#GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D" title="要确保闪回数据库的成功运行和有保证的还原点，必须先设置一些关键数据库选项。">先决条件</a> 。</span></li>
                        <li class="stepexpand"><span>使用<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限将SQL * Plus作为普通用户连接到root用户。</span></li>
                        <li class="stepexpand"><span>确保CDB已打开或已安装。如果安装了CDB，则必须干净地关闭它（除非它是物理备用数据库）。</span></li>
                        <li class="stepexpand"><span>运行<code class="codeph">CREATE RESTORE POINT</code>语句以创建<a href="glossary.html#GUID-6BFC6E77-175D-4055-8198-6091D47AD8F6"><span class="xrefglossterm">CDB还原点</span></a> 。</span><div>
                              <p>以下命令创建正常的CDB还原点：</p><pre class="pre codeblock"><code>SQL&gt; CREATE RESTORE POINT cdb_before_upgrade;</code></pre><p>以下命令创建有保证的CDB还原点：</p><pre class="pre codeblock"><code>SQL&gt; CREATE RESTORE POINT cdb_grp_before_upgrade GUARANTEE FLASHBACK DATABASE;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-952278F2-DBBA-4CB9-AAC4-616B56837AAB__GUID-AD694122-9165-4FD8-A398-FB92EB1E0454">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="using-flasback-database-restore-points.html#GUID-434CD26D-D3DC-454B-A598-70F64D7C01EB" title="CDB还原点充当SCN的别名或多租户容器数据库（CDB）中的时间点。它可以是正常的还原点或保证还原点。">关于CDB还原点</a></p>
                              </li>
                              <li>
                                 <p><a href="using-flasback-database-restore-points.html#GUID-9363C4B9-48E5-470F-B13B-43FA56667978" title="您可以使用CREATE RESTORE POINT SQL语句在可插拔数据库（PDB）中创建还原点。">创建PDB还原点</a></p>
                              </li>
                              <li>
                                 <p><a href="using-flasback-database-restore-points.html#GUID-1A583D44-66CB-4D21-B170-2A07CFF6EE65" title="您可以使用V $ RESTORE_POINT控制文件视图来获取有关所有当前定义的还原点（正常和保证）的信息，包括CDB还原点和PDB还原点。">使用V $ RESTORE_POINT视图列出还原点</a></p>
                              </li>
                              <li>
                                 <p>有关将SQL * Plus连接到根目录的步骤的<a href="../admin/getting-started-with-database-administration.html#ADMIN-GUID-7842AF72-DA25-4559-A8E7-9883D0C63BF2" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-9363C4B9-48E5-470F-B13B-43FA56667978" name="GUID-9363C4B9-48E5-470F-B13B-43FA56667978"></a><h4 id="BRADV-GUID-9363C4B9-48E5-470F-B13B-43FA56667978" class="sect4"><span class="enumeration_section">7.4.3</span>创建PDB还原点</h4>
                  <div>
                     <p>您可以使用<code class="codeph">CREATE RESTORE POINT</code> SQL语句在可插拔数据库（PDB）中创建还原点。
                     </p>
                     <div class="section">还原点可以是正常的<a href="glossary.html#GUID-7C3A47D4-B9C5-40D3-89D0-8BD77281AAB1"><span class="xrefglossterm">PDB还原点</span></a> ，保证的PDB还原点或干净的PDB还原点。您可以在连接到PDB或根目录时创建PDB还原点。
                     </div>
                     <!-- class="section" -->
                     <div class="section">当PDB使用共享撤消时，只有在PDB没有任何未完成的事务时才能创建干净的还原点。</div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-9363C4B9-48E5-470F-B13B-43FA56667978__GUID-F760138D-D0B8-42E5-B91E-C6F52F5C17D7">要在连接到PDB时创建PDB还原点，请执行以下操作：</p>
                        <ol>
                           <li>
                              <p>确保<a href="using-flasback-database-restore-points.html#GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D" title="To ensure successful operation of Flashback Database and guaranteed restore points, you must first set some key database options.">满足闪回数据库和还原点</a>的先决条件中描述的<a href="using-flasback-database-restore-points.html#GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D" title="要确保闪回数据库的成功运行和有保证的还原点，必须先设置一些关键数据库选项。">先决条件</a> 。
                              </p>
                           </li>
                           <li>
                              <p>将SQL * Plus作为具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的公共用户或本地用户连接到PDB。
                              </p>
                           </li>
                           <li>
                              <p>如果要在使用共享撤消的CDB中创建干净的PDB还原点，则必须关闭PDB。</p>
                              <p>以下命令显示PDB的状态：</p><pre class="pre codeblock"><code>SQL&gt; SELECT name，open_mode FROM V $ PDBs;</code></pre><p>使用以下命令关闭PDB：</p><pre class="pre codeblock"><code>SQL&gt; ALTER PLUGGABLE DATABASE CLOSE;</code></pre></li>
                           <li>
                              <p>如果<a href="glossary.html#GUID-3E156A59-F6CC-4A2A-9749-DB7D1CE25F13"><span class="xrefglossterm">多租户容器数据库（CDB）</span></a>处于已装入状态，则它必须一致地关闭（除非它是物理备用数据库）。
                              </p>
                           </li>
                           <li>
                              <p>将当前容器设置为PDB。</p>
                              <p>以下命令将当前容器设置为PDB <code class="codeph">my_pdb</code> ：</p><pre class="pre codeblock"><code>SQL&gt; ALTER SESSION SET CONTAINER = my_pdb;</code></pre></li>
                           <li>
                              <p>使用<code class="codeph">CREATE RESTORE POINT</code>命令创建PDB还原点。
                              </p>
                              <p>以下命令创建正常的PDB还原点：</p><pre class="pre codeblock"><code>SQL&gt; CREATE RESTORE POINT before_patching;</code></pre><p>以下命令可创建有保证的PDB还原点：</p><pre class="pre codeblock"><code>SQL&gt; CREATE RESTORE POINT before_upgrade GUARENTEE FLASHBACK DATABASE;</code></pre><p>以下命令显式创建一个干净的PDB还原点。如果无法创建干净的还原点，则会返回错误。</p><pre class="pre codeblock"><code>SQL&gt; CREATE CLEAN RESTORE POINT before_patching;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-9363C4B9-48E5-470F-B13B-43FA56667978__GUID-9214C3FA-54CD-460D-AD18-A35E8F07AC13">要在连接到CDB时创建PDB还原点，请执行以下操作：</p>
                        <p></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>确保<a href="using-flasback-database-restore-points.html#GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D" title="To ensure successful operation of Flashback Database and guaranteed restore points, you must first set some key database options.">满足闪回数据库和还原点</a>的先决条件中描述的<a href="using-flasback-database-restore-points.html#GUID-AE2AD6A0-507A-4E40-A8FF-76AFC88EC56D" title="要确保闪回数据库的成功运行和有保证的还原点，必须先设置一些关键数据库选项。">先决条件</a> 。</span></li>
                        <li class="stepexpand"><span>使用<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限将SQL * Plus作为普通用户连接到root用户。</span></li>
                        <li class="stepexpand"><span>如果要在使用共享撤消的CDB中创建干净的PDB还原点，则必须关闭PDB。</span><div>以下命令关闭PDB <code class="codeph">my_pdb</code> ：</div>
                           <div><pre class="pre codeblock"><code>SQL&gt; ALTER PLUGGABLE DATABASE my_pdb CLOSE;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>包含PDB的CDB可以打开或安装。如果安装了CDB，则必须始终关闭它（除非它是物理备用数据库）。</span><div>
                              <p>以下命令将CDB置于已装入状态：</p>
                           </div>
                           <div><pre class="pre codeblock"><code>SQL&gt; SHUTDOWN IMMEDIATE; SQL&gt; STARTUP MOUNT;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>将当前容器设置为root。</span><div><code class="codeph">SQL&gt; ALTER SESSION SET CONTAINER = CDB $ ROOT;</code></div>
                        </li>
                        <li class="stepexpand"><span>使用带有<code class="codeph">FOR PLUGGABLE DATABASE</code>子句的<code class="codeph">CREATE RESTORE POINT</code>命令创建PDB还原点。</span><div>以下命令创建正常的PDB还原点：<pre class="pre codeblock"><code>SQL&gt; CREATE RESTORE POINT mypdb_before_patching FOR PLUGGABLE DATABASE my_pdb;</code></pre><p>以下命令可创建有保证的PDB还原点：</p><pre class="pre codeblock"><code>SQL&gt; CREATE RESTORE POINT mypdb_grp_before_upgrade FOR PLUGGABLE DATABASE my_pdb GUARANTEE FLASHBACK DATABASE;</code></pre><p>以下命令显式创建一个干净的PDB还原点（当PDB关闭且没有挂起的事务时）。如果无法创建还原点，则会显示错误。</p><pre class="pre codeblock"><code>SQL&gt; CREATE CLEAN RESTORE POINT mypdb_crp_before_patching FOR PLUGGABLE DATABASE my_pdb;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-9363C4B9-48E5-470F-B13B-43FA56667978__GUID-9CB8C1F3-2282-4E0A-819A-5401961C8FC5">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-66B1A12D-1C92-43B5-A204-AA8A6D177ABD" title="多租户容器数据库（CDB）可以使用共享撤消或本地撤消。RMAN用于执行闪回数据库操作的技术取决于CDB的撤消配置类型。">关于PDB的撤消和闪回数据库操作</a></p>
                              </li>
                              <li>
                                 <p><a href="using-flasback-database-restore-points.html#GUID-34C48821-B29D-4A2E-94DE-CD97CFA7784E" title="您可以在可插拔数据库（PDB）中创建正常和保证还原点。PDB还原点只能由定义它们的PDB访问。">关于PDB中的还原点</a></p>
                              </li>
                              <li>
                                 <p><a href="using-flasback-database-restore-points.html#GUID-952278F2-DBBA-4CB9-AAC4-616B56837AAB" title="CREATE RESTORE POINT SQL命令使您可以在多租户容器数据库（CDB）中创建正常和保证还原点。">创建CDB还原点</a></p>
                              </li>
                              <li>
                                 <p>有关将SQL * Plus连接到根目录的步骤的<a href="../admin/getting-started-with-database-administration.html#ADMIN-GUID-7842AF72-DA25-4559-A8E7-9883D0C63BF2" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a></p>
                              </li>
                              <li>
                                 <p><a href="using-flasback-database-restore-points.html#GUID-1A583D44-66CB-4D21-B170-2A07CFF6EE65" title="您可以使用V $ RESTORE_POINT控制文件视图来获取有关所有当前定义的还原点（正常和保证）的信息，包括CDB还原点和PDB还原点。">使用V $ RESTORE_POINT视图列出还原点</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV592"></a><div class="props_rev_3"><a id="GUID-305E9D61-0F50-4885-891C-A7D86C6D3C8D" name="GUID-305E9D61-0F50-4885-891C-A7D86C6D3C8D"></a><h4 id="BRADV-GUID-305E9D61-0F50-4885-891C-A7D86C6D3C8D" class="sect4"><span class="enumeration_section">7.4.4</span>使用LIST命令列出还原点</h4>
                  <div>
                     <div class="section">
                        <p></p>
                        <p><a id="d33613e2822" class="indexterm-anchor"></a>您可以使用<code class="codeph">LIST</code>命令列出特定还原点或RMAN存储库已知的所有还原点。命令的变化如下：</p><pre class="oac_no_warn" dir="ltr">LIST RESTORE POINT <span class="italic">restore_point_name</span> ;列表恢复点全部;</pre><p>RMAN表示还原点的SCN和时间，还原点的类型以及还原点的名称。以下示例显示了示例输出：</p><pre class="oac_no_warn" dir="ltr">RMAN&gt; LIST RESTORE POINT ALL;使用目标数据库控制文件而不是恢复目录SCN RSP时间类型时间名称---------------- --------- ---------- --------- ---- 341859 28-APR-15 28-APR-15 NORMAL_RS 343690 28-APR-15保证28-APR-15 GUARANTEED_RS</pre><div class="infoboxnote" id="GUID-305E9D61-0F50-4885-891C-A7D86C6D3C8D__GUID-05810482-DBDD-4011-8594-16F5B12B8E47">
                           <p class="notep1">注意：</p><code class="codeph">LIST</code>命令不显示PDB化身编号等详细信息以及还原点是否为PDB还原点。要查看有关多租户环境中还原点的其他详细信息，请参阅<a href="using-flasback-database-restore-points.html#GUID-1A583D44-66CB-4D21-B170-2A07CFF6EE65" title="您可以使用V $ RESTORE_POINT控制文件视图来获取有关所有当前定义的还原点（正常和保证）的信息，包括CDB还原点和PDB还原点。">使用V $ RESTORE_POINT视图列出还原点</a> 。
                        </div>
                        <div class="infoboxnotealso" id="GUID-305E9D61-0F50-4885-891C-A7D86C6D3C8D__GUID-4195DB14-20E0-460E-A713-BCFED405EB8B">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="rman-performing-flashback-dbpitr.html#GUID-953FA30D-BED2-4DBA-8361-9DA1B8FF073F" title="闪回数据库通过将数据库返回到先前某个时间点的状态来反转不需要的更改。">使用闪回数据库重绕数据库</a> ”</span></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-1A583D44-66CB-4D21-B170-2A07CFF6EE65" name="GUID-1A583D44-66CB-4D21-B170-2A07CFF6EE65"></a><h4 id="BRADV-GUID-1A583D44-66CB-4D21-B170-2A07CFF6EE65" class="sect4"><span class="enumeration_section">7.4.5</span>使用V $ RESTORE_POINT视图列出还原点</h4>
                  <div>
                     <p>您可以使用<code class="codeph">V$RESTORE_POINT</code>控制文件视图来获取有关所有当前定义的还原点（正常和保证）的信息，包括CDB还原点和PDB还原点。
                     </p>
                     <div class="section"><code class="codeph">V$RESTORE_POINT</code>视图包含有关多租户环境中还原点的其他信息，这些还原点未由<code class="codeph">LIST RESTORE POINT</code>命令显示。这包括诸如<a href="glossary.html#GUID-D4239448-A344-41EF-9566-0B7716FEAE72"><span class="xrefglossterm">可</span></a>创建<a href="glossary.html#GUID-7C3A47D4-B9C5-40D3-89D0-8BD77281AAB1"><span class="xrefglossterm">PDB还原点</span></a>的<a href="glossary.html#GUID-D4239448-A344-41EF-9566-0B7716FEAE72"><span class="xrefglossterm">可插拔数据库（PDB）</span></a>的化身以及还原点是PDB还原点还是干净PDB还原点等详细信息。
                     </div>
                     <!-- class="section" -->
                     <div class="p">
                        <p>以下步骤显示有关CDB中所有PDB的PDB还原点的信息：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>将SQL * Plus连接到目标数据库。如果目标数据库是<a href="glossary.html#GUID-3E156A59-F6CC-4A2A-9749-DB7D1CE25F13"><span class="xrefglossterm">多租户容器数据库（CDB）</span></a> ，则连接到根目录。</span><div>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>要查看所有PDB的还原点，必须使用<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限连接到根目录。
                                    </p>
                                 </li>
                                 <li>
                                    <p>要查看特定PDB中的还原点，您可以作为具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的公共用户或本地用户连接到该PDB。
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>查询<code class="codeph">V$RESTORE_POINT</code>视图以显示有关还原点的信息。</span></li>
                     </ol>
                     <div class="example" id="GUID-1A583D44-66CB-4D21-B170-2A07CFF6EE65__GUID-242EBFA4-87DC-4B01-9AFD-80AE6FDF7B1F">
                        <p class="titleinexample">示例7-1在多租户环境中显示还原点</p>
                        <p></p>
                        <p>以下查询显示有关多租户环境中所有还原点的详细信息（格式化为适合页面的查询输出）：</p><pre class="oac_no_warn" dir="ltr">SELECT name，guarantee_flashback_database，pdb_restore_point，clean_pdb_restore_point，pdb_incarnation＃，storage_sizeFROM v $ restore_point;</pre><pre class="oac_no_warn" dir="ltr">名称GUARANTEE_ PDB_RESTORE_POINT CLEAN_PDB_RESTORE_POINT STORAGE_SIZE -------- ---------- ---------------- ----------- ------------ ------------ CDB_GRP_BEFORE_PATCH YES NO NO 84586 PDB_GRP_BEFORE_UPGRADE_TEMP YES YES NO 4562 CDB_RP1 NO NO NO 0 PDB1_BEFORE_PATCHING NO YES NO 0 MYPDB_CLEAN_GRP_BEFORE_UPGRADE NO YES YES 0</pre><p>对于正常还原点， <code class="codeph">STORAGE_SIZE</code>为零。对于保证还原点， <code class="codeph">STORAGE_SIZE</code>指示快速恢复区域中的磁盘空间的大致字节数，该区域保留了保留<code class="codeph">FLASHBACK</code> <code class="codeph">DATABASE</code>到该还原点所需的日志。
                        </p>
                        <div class="infoboxnotealso" id="GUID-1A583D44-66CB-4D21-B170-2A07CFF6EE65__GUID-00A96BB4-D232-4EF6-B0E6-C85EE99731E5">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">V$RESTORE_POINT</code>信息，请<a href="../refrn/V-RESTORE_POINT.html#REFRN30390" target="_blank"><span><cite>参见Oracle数据库参考</cite></span></a></p>
                              </li>
                              <li>
                                 <p><a href="using-flasback-database-restore-points.html#GUID-305E9D61-0F50-4885-891C-A7D86C6D3C8D">使用LIST命令列出还原点</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-953FA30D-BED2-4DBA-8361-9DA1B8FF073F" title="闪回数据库通过将数据库返回到先前某个时间点的状态来反转不需要的更改。">使用闪回数据库重绕数据库</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-8466CA3C-652A-4AAB-88EB-8815575D6266" title="您可以使用FLASHBACK DATABASE命令为整个多租户容器数据库（CDB）执行闪回数据库操作。">为整个CDB执行闪回数据库操作</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-C1215E86-9A7B-4EC9-9777-2A18BD627394" title="您可以使用FLASHBACK DATABASE命令对多租户容器数据库（CDB）中的单个可插拔数据库（PDB）执行闪回数据库操作。">为PDB执行闪回数据库操作</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="example" -->
                  </div>
               </div><a id="BRADV593"></a><div class="props_rev_3"><a id="GUID-A1563822-015B-4941-B7EB-C3D44A63232C" name="GUID-A1563822-015B-4941-B7EB-C3D44A63232C"></a><h4 id="BRADV-GUID-A1563822-015B-4941-B7EB-C3D44A63232C" class="sect4"><span class="enumeration_section">7.4.6</span>删除还原点</h4>
                  <div>
                     <p>如果您对不需要现有还原点感到满意，或者想要使用现有还原点的名称创建还原点，则可以使用<code class="codeph">DROP RESTORE POINT</code> SQL * Plus语句删除还原点。
                     </p>
                     <div class="section">
                        <p>例如：</p><pre class="pre codeblock"><code>SQL&gt; DROP RESTORE POINT before_app_upgrade;还原点已删除。
</code></pre><p>同一语句用于删除正常和保证还原点。</p>
                        <div class="infoboxnote" id="GUID-A1563822-015B-4941-B7EB-C3D44A63232C__GUID-C8141E34-1290-4E83-BDEE-5C4A65BA07D2">
                           <p class="notep1">注意：</p>
                           <p>即使未明确删除，正常还原点也最终会超出控制文件的范围。管理控制文件中还原点保留的规则是：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>无论年龄大小，最近的2048个还原点始终保存在控制文件中。</p>
                              </li>
                              <li>
                                 <p>无论定义了多少个还原点，都会保留比<code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code>的值更新的任何还原点。
                                 </p>
                              </li>
                           </ul>
                           <p>不满足这些条件的正常还原点可能会超出控制文件的范围。</p>
                        </div>
                        <p>保证还原点永远不会超出控制文件的范围。它们一直存在，直到它们被明确删除</p>
                        <div class="infoboxnote" id="GUID-A1563822-015B-4941-B7EB-C3D44A63232C__GUID-CF9D23CC-90DF-4B8C-B01A-0FF25B10A8E0">
                           <p class="notep1">也可以看看：</p>
                           <p>有关SQL <code class="codeph">DROP RESTORE POINT</code>语句的参考信息，请参见<a href="../sqlrf/DROP-RESTORE-POINT.html#SQLRF20002" target="_blank"><span><cite>Oracle数据库SQL语言参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV594"></a><div class="props_rev_3"><a id="GUID-4E96DB60-3616-4680-866A-F38A6049053A" name="GUID-4E96DB60-3616-4680-866A-F38A6049053A"></a><h3 id="BRADV-GUID-4E96DB60-3616-4680-866A-F38A6049053A" class="sect3"><span class="enumeration_section">7.5</span>使用闪回数据库</h3>
               <div>
                  <p>要对目标数据库使用闪回日志记录，必须启用闪回数据库。可以遵循某些准则以确保闪回数据库的最佳性能。</p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="using-flasback-database-restore-points.html#GUID-FC98B2D7-9F18-4A62-BE4A-E97A0AA10BF4" title="使用ALTER DATABASE命令启用闪回数据库">启用闪回数据库</a></p>
                     </li>
                     <li>
                        <p><a href="using-flasback-database-restore-points.html#GUID-B343C3D9-0CA1-49E5-AC62-1E872E9966A6" title="使用ALTER DATABASE命令禁用闪回数据库。">禁用闪回数据库日志记录</a></p>
                     </li>
                     <li>
                        <p><a href="using-flasback-database-restore-points.html#GUID-A214980E-8DF5-49A3-A2CF-35C90E74A045" title="维护闪回日志会对数据库实例施加相对有限的开销。更改的块以相对不频繁的定期间隔从内存写入闪回日志，以限制处理和I / O开销。">配置环境以获得最佳闪回数据库性能</a></p>
                     </li>
                     <li>
                        <p><a href="using-flasback-database-restore-points.html#GUID-19A3894F-22A9-49B1-91F4-951E9824C95F" title="有几种数据分析方法可用于监视系统上的闪回数据库工作负载。">监控闪回数据库对性能的影响</a></p>
                     </li>
                     <li>
                        <p><a href="using-flasback-database-restore-points.html#GUID-C6E3FBBA-188F-4D26-AC7D-31ED3D190E88" title="启用闪回或有保证还原点时，后台进程RVWR会将闪回数据写入快速恢复区域中的闪回数据库日志。">关于具有I / O错误的闪回写入器（RVWR）行为</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV596"></a><a id="BRADV595"></a><div class="props_rev_3"><a id="GUID-FC98B2D7-9F18-4A62-BE4A-E97A0AA10BF4" name="GUID-FC98B2D7-9F18-4A62-BE4A-E97A0AA10BF4"></a><h4 id="BRADV-GUID-FC98B2D7-9F18-4A62-BE4A-E97A0AA10BF4" class="sect4"><span class="enumeration_section">7.5.1</span>启用闪回数据库</h4>
                  <div>
                     <p>使用<code class="codeph">ALTER DATABASE</code>命令启用闪回数据库</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-FC98B2D7-9F18-4A62-BE4A-E97A0AA10BF4__GUID-A6BCA30F-8B5E-4EE6-BC8E-C58DEF3AF562">要启用闪回日志记录：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>按<span class="q">“ <a href="configuring-rman-client-basic.html#GUID-233338E2-3EE6-4248-A2B6-16A7899DB14F" title="You enable the fast recovery area by setting two initialization parameters. These parameters enable the fast recovery area with or without having to shut down and restart the database instance.">启用快速恢复区</a> ”中的说明<a href="configuring-rman-client-basic.html#GUID-233338E2-3EE6-4248-A2B6-16A7899DB14F" title="通过设置两个初始化参数来启用快速恢复区域。这些参数启用快速恢复区域，无论是否必须关闭并重新启动数据库实例。">配置恢复区</a></span> 。</span></li>
                        <li class="stepexpand"><span>确保数据库实例已打开或已装入。如果已装入实例，则必须干净地关闭数据库，除非它是物理备用数据库。其他Oracle Real Application Clusters（Oracle RAC）实例可以处于任何模式。</span></li>
                        <li class="stepexpand"><span>（可选）将<code class="codeph">DB_FLASHBACK_RETENTION_TARGET</code>设置为所需闪回窗口的长度（以分钟为单位）：</span><div><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SET DB_FLASHBACK_RETENTION_TARGET = 4320 SCOPE = BOTH; ＃ 3天</pre><p>默认情况下， <code class="codeph">DB_FLASHBACK_RETENTION_TARGET</code>设置为1天（1440分钟）。
                              </p>
                              <div class="infoboxnote" id="GUID-FC98B2D7-9F18-4A62-BE4A-E97A0AA10BF4__GUID-7D7A30FD-341C-4C0D-8B66-FA5049E0ACB1">
                                 <p class="notep1">注意：</p>
                                 <p>此设置必须在数据库启动和关闭期间保持不变。</p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>为整个数据库启用闪回数据库功能：</span><div><pre class="pre codeblock"><code>ALTER DATABASE FLASHBACK ON;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>（可选）禁用特定表空间的闪回日志记录。</span><div>
                              <p>默认情况下，会为所有永久表空间生成闪回日志。您可以通过禁用特定表空间的闪回日志记录来减少开销，如以下示例所示：</p><pre class="pre codeblock"><code>ALTER TABLESPACE tbs_3 FLASHBACK OFF;</code></pre><p>您可以稍后使用以下命令为表空间重新启用闪回日志记录：</p><pre class="pre codeblock"><code>ALTER TABLESPACE tbs_3 FLASHBACK ON;</code></pre><p>如果为表空间禁用闪回数据库，则必须在运行<code class="codeph">FLASHBACK</code> <code class="codeph">DATABASE</code>之前使其数据文件脱机。</p>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <p>在数据库打开时启用闪回数据库时，命令很可能无法获取所需的内存。如果命令因此原因失败，请在一段时间后重试该命令，或在关闭并重新启动实例后重试。</p>
                        <p>在<a href="glossary.html#GUID-009B3F56-8C1E-4CF6-AF0F-A9D2C2E4B9C2"><span class="xrefglossterm">物理备用数据库</span></a>上启用闪回数据库时，可以闪回备用数据库。备用数据库的闪回数据库在Data Guard环境中有一些应用程序。
                        </p>
                        <div class="infoboxnotealso" id="GUID-FC98B2D7-9F18-4A62-BE4A-E97A0AA10BF4__GUID-674A0CA8-6517-4278-ABFA-29FAF383F2AF">
                           <p class="notep1">也可以看看：</p>
                           <p>有关备用数据库的详细信息，请参阅<a href="../sbydb/examples-of-using-oracle-data-guard.html#SBYDB4891" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV597"></a><div class="props_rev_3"><a id="GUID-B343C3D9-0CA1-49E5-AC62-1E872E9966A6" name="GUID-B343C3D9-0CA1-49E5-AC62-1E872E9966A6"></a><h4 id="BRADV-GUID-B343C3D9-0CA1-49E5-AC62-1E872E9966A6" class="sect4"><span class="enumeration_section">7.5.2</span>禁用闪回数据库日志记录</h4>
                  <div>
                     <p>使用<code class="codeph">ALTER DATABASE</code>命令禁用闪回数据库。
                     </p>
                     <div class="section">
                        <p>在处于装入或打开状态的数据库实例上，发出以下命令：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE FLASHBACK OFF;</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV598"></a><div class="props_rev_3"><a id="GUID-A214980E-8DF5-49A3-A2CF-35C90E74A045" name="GUID-A214980E-8DF5-49A3-A2CF-35C90E74A045"></a><h4 id="BRADV-GUID-A214980E-8DF5-49A3-A2CF-35C90E74A045" class="sect4"><span class="enumeration_section">7.5.3</span>配置环境以获得最佳闪回数据库性能</h4>
                  <div>
                     <p>维护闪回日志会对数据库实例施加相对有限的开销。更改的块以相对不频繁的定期间隔从内存写入闪回日志，以限制处理和I / O开销。</p>
                     <div class="section">
                        <p>为了在启用闪回数据库的情况下为大型生产数据库实现良好性能，Oracle建议如下：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>为快速恢复区域使用快速文件系统，最好不使用操作系统文件缓存。</p>
                              <p>数据库在快速恢复区域中创建的文件（包括闪回日志）通常很大。操作系统文件缓存通常对这些文件无效，实际上可能会增加CPU开销，以便读取和写入这些文件。因此，建议使用避免操作系统文件缓存的文件系统，例如自动存储管理（ASM）。</p>
                           </li>
                           <li>
                              <p>为包含快速恢复区域的文件系统配置足够的磁盘轴。</p>
                              <p>对于大型生产数据库，可能需要多个磁盘轴来支持数据库所需的磁盘吞吐量，以便有效地写入闪回日志。</p>
                           </li>
                           <li>
                              <p>如果用于保存快速恢复区的存储系统没有非易失性RAM，请尝试在条带化存储卷上配置文件系统。</p>
                              <p>使用相对较小的条带大小，如128 KB。此技术使每次闪回日志的写入能够分布在多个磁盘轴上，从而提高性能。</p>
                           </li>
                           <li>
                              <p>对于大型数据库，请将初始化参数<code class="codeph">LOG_BUFFER</code>设置为至少8 MB。</p>
                           </li>
                        </ul>
                        <p>记录闪回数据库的开销取决于数据库工作负载中读写的混合。当您具有写入密集型工作负载时，闪回数据库的日志记录开销很高，因为它必须记录所有这些数据库更改。查询不会更改数据，因此不会为闪回数据库的日志记录活动做出贡献。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV600"></a><a id="BRADV599"></a><div class="props_rev_3"><a id="GUID-19A3894F-22A9-49B1-91F4-951E9824C95F" name="GUID-19A3894F-22A9-49B1-91F4-951E9824C95F"></a><h4 id="BRADV-GUID-19A3894F-22A9-49B1-91F4-951E9824C95F" class="sect4"><span class="enumeration_section">7.5.4</span>监控闪回数据库对性能的影响</h4>
                  <div>
                     <p>有几种数据分析方法可用于监视系统上的闪回数据库工作负载。</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>AWR报道</p>
                           <p>自动工作负载存储库（AWR）通过收集，处理和维护数据库问题检测和自我调整的性能统计信息来自动化数据库统计信息收集。您可以比较启用闪回数据库之前和之后的AWR报告，以监控性能影响。</p>
                        </li>
                        <li>
                           <p>AWR快照</p>
                           <p>您可以查看AWR快照以查明由闪回日志记录引起的系统使用情况。例如，如果<code class="codeph">flashback buf free by RVWR</code>是最高等待事件，那么您就知道Oracle数据库无法非常快速地写入闪回日志。因此，您可能希望调整快速恢复区使用的文件系统和存储，可能使用<span class="q">“ <a href="using-flasback-database-restore-points.html#GUID-A214980E-8DF5-49A3-A2CF-35C90E74A045" title="维护闪回日志会对数据库实例施加相对有限的开销。更改的块以相对不频繁的定期间隔从内存写入闪回日志，以限制处理和I / O开销。">配置环境以获得最佳闪回数据库性能</a> ”中</span>描述的技术</p>
                        </li>
                        <li>
                           <p><code class="codeph">V$FLASHBACK_DATABASE_STAT</code>视图</p>
                           <p><code class="codeph">V$FLASHBACK_DATABASE_STAT</code>视图显示数据库记录的闪回数据的字节数。视图中的每一行都显示累积的统计信息（通常在一小时内）。<code class="codeph">FLASHBACK_DATA</code>和<code class="codeph">REDO_DATA</code>列描述了在时间间隔内分别写入的闪回数据和重做数据的字节，而<code class="codeph">DB_DATA</code>列描述了读取和写入的数据块的字节。列<code class="codeph">FLASHBACK_DATA</code>和<code class="codeph">REDO_DATA</code>对应于顺序写入，而<code class="codeph">DB_DATA</code>列对应于随机读取和写入。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">V$SYSSTAT</code>视图</p>
                           <p>由于顺序I / O和随机I / O之间的差异，更好的I / O开销指示是为闪回日志发出的I / O操作数。<a href="using-flasback-database-restore-points.html#GUID-19A3894F-22A9-49B1-91F4-951E9824C95F__CFHBHCAG" title="描述V $ SYSSTAT视图中的列">表7-1中</a>显示的<code class="codeph">V$SYSSTAT</code>统计信息可以告诉您实例为各种目的发出的I / O操作数。
                           </p>
                        </li>
                     </ul>
                     <div class="tblformal" id="GUID-19A3894F-22A9-49B1-91F4-951E9824C95F__CFHBHCAG">
                        <p class="titleintable">表7-1 V $ SYSSTAT统计信息</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="V $ SYSSTAT统计" width="100%" border="1" summary="Describes columns in the V$SYSSTAT View" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="31%" id="d33613e3819">列名称</th>
                                 <th align="left" valign="bottom" width="69%" id="d33613e3822">列含义</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d33613e3827" headers="d33613e3819 ">
                                    <p>物理写入I / O请求</p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d33613e3827 d33613e3822 ">
                                    <p>为写入数据块而发出的写入操作数</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d33613e3834" headers="d33613e3819 ">
                                    <p>物理读取I / O请求</p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d33613e3834 d33613e3822 ">
                                    <p>为读取数据块而发出的读取操作数</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d33613e3841" headers="d33613e3819 ">
                                    <p>重做写道</p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d33613e3841 d33613e3822 ">
                                    <p>为写入重做日志而发出的写入操作数</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d33613e3848" headers="d33613e3819 ">
                                    <p>闪回日志写入</p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d33613e3848 d33613e3822 ">
                                    <p>为写入闪回日志而发出的写入操作数</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d33613e3855" headers="d33613e3819 ">
                                    <p>闪回日志写入字节</p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d33613e3855 d33613e3822 ">
                                    <p>从此实例写入的闪回数据库数据的总大小（以字节为单位）</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="infoboxnotealso" id="GUID-19A3894F-22A9-49B1-91F4-951E9824C95F__GUID-82CC01DB-6C2C-4835-9076-5FDD2F685269">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关<code class="codeph">V$SYSSTAT</code>视图中列的更多详细信息，请<a href="../refrn/statistics-descriptions.html#REFRN103" target="_blank"><span><cite>参见Oracle数据库参考</cite></span></a></p>
                           </li>
                           <li>
                              <p><a href="../tgdba/gathering-database-statistics.html#TGDBA185" target="_blank"><span><cite>Oracle数据库性能调优指南</cite></span></a> ，了解AWR</p>
                           </li>
                           <li>
                              <p>有关AWR报告的详细信息，请参阅<a href="../tdppt/resolving-performance-degradation-over-time.html#TDPPT091" target="_blank"><span><cite>“Oracle数据库2天+性能调整指南”</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV601"></a><div class="props_rev_3"><a id="GUID-C6E3FBBA-188F-4D26-AC7D-31ED3D190E88" name="GUID-C6E3FBBA-188F-4D26-AC7D-31ED3D190E88"></a><h4 id="BRADV-GUID-C6E3FBBA-188F-4D26-AC7D-31ED3D190E88" class="sect4"><span class="enumeration_section">7.5.5</span>关于具有I / O错误的闪回写入器（RVWR）行为</h4>
                  <div>
                     <p>启用闪回或有保证还原点时，后台进程RVWR会将闪回数据写入快速恢复区域中的闪回数据库日志。</p>
                     <p>如果RVWR遇到I / O错误，则预期会出现以下行为：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>如果定义了任何保证的还原点，则当RVWR遇到I / O错误时，实例将失败。</p>
                        </li>
                        <li>
                           <p>如果未定义保证还原点，则当RVWR遇到I / O错误时，实例不受影响。请注意以下情况：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>在主数据库上，Oracle数据库在数据库打开时自动禁用闪回数据库。所有现有事务和查询都不受影响。单实例和Oracle RAC数据库都需要此行为。</p>
                              </li>
                              <li>
                                 <p>在物理或逻辑备用数据库上，RVWR似乎已停止响应，并定期重试I / O.这可能最终导致物理备用数据库的逻辑备用或受管恢复暂停。（Oracle数据库不会导致备用实例失败，因为它不希望在最大保护模式下导致主数据库失败。）要解决此问题，您可以发出<code class="codeph">SHUTDOWN ABORT</code>或<code class="codeph">ALTER DATABASE FLASHBACK OFF</code>命令。
                                 </p>
                              </li>
                           </ul>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>