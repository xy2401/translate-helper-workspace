<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="An explanation is given of how to determine the differences between two Extensible Markup Language (XML) inputs, using the Java library included in the Oracle XML Developer&#39;s Kit (XDK)."></meta>
      <meta name="description" content="An explanation is given of how to determine the differences between two Extensible Markup Language (XML) inputs, using the Java library included in the Oracle XML Developer&#39;s Kit (XDK)."></meta>
      <title>使用Java确定XML差异</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Programmer&#39;s Guide"></meta>
      <meta property="og:description" content="An explanation is given of how to determine the differences between two Extensible Markup Language (XML) inputs, using the Java library included in the Oracle XML Developer&#39;s Kit (XDK)."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Programmer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="xml-developers-kit-programmers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-11T05:58:48-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2001, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96292-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="using-XML-pipeline-processor-for-Java.html" title="Previous" type="text/html"></link>
      <link rel="next" href="using-XML-SQL-utility.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="XML Developers Kit Programmers Guide"></meta>
    <meta name="dcterms.isVersionOf" content="ADXDK"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="using-XML-pipeline-processor-for-Java.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="using-XML-SQL-utility.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">程序员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="XDK-for-Java.html" property="item" typeof="WebPage"><span property="name">Oracle XML Developer's Kit for Java</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用Java确定XML差异</li>
            </ol>
            <a id="GUID-BA951010-1085-4715-89F0-1F2312C4AA4A" name="GUID-BA951010-1085-4715-89F0-1F2312C4AA4A"></a><a id="ADXDK1005"></a><a id="ADXDK199"></a>
            
            <h2 id="ADXDK-GUID-BA951010-1085-4715-89F0-1F2312C4AA4A" class="sect2"><span class="enumeration_chapter">20</span>使用Java确定XML差异</h2>
         </header>
         <div class="ind">
            <div>
               <p>解释了如何使用Oracle XML Developer's Kit（XDK）中包含的Java库来确定两个可扩展标记语言（XML）输入之间的差异。</p>
               <div class="section"> </div>
               <!-- class="section" -->
            </div><a id="ADXDK128"></a><div class="props_rev_3"><a id="GUID-D7465EE7-EE9C-48D2-8F8F-85294B2BE20C" name="GUID-D7465EE7-EE9C-48D2-8F8F-85294B2BE20C"></a><h3 id="ADXDK-GUID-D7465EE7-EE9C-48D2-8F8F-85294B2BE20C" class="sect3">Java的XML差异实用程序概述</h3>
               <div>
                  <p>在Java XML版本比较库包括版本比较，散列和用于在类XML输入平等-比较方法<code class="codeph">XmlUtils</code>包的<code class="codeph">oracle.xml.diff</code> 。
                  </p>
                  <p><code class="codeph">oracle.xml.diff</code>包中的<code class="codeph">Options</code>类提供了一些选项，使用户可以控制<code class="codeph">XmlUtils</code>类中的方法处理输入的方式（请参阅<a href="determining-XML-differences-using-Java.html#GUID-B5320E40-B2BD-4548-9ED4-FD71C426DCAC" title="Java XML diffing库支持两个选项，您可以使用oracle.xml.diff包的Options类中的方法设置这两个选项。Options对象在每次调用时直接传递给diff，hash和equal方法。">Java XML Diffing Library的用户选项</a> ）。其中一个受支持的选项是空白区域标准化，默认情况下已启用。
                  </p>
                  <p>XML diffing方法使用的算法专门针对在几秒钟内查找两个大型XML文档（5 MB或更多）之间差异的用例，其中不需要最小差异。最小差异是最小的可能变化集，当应用于第一个XML输入时，产生与第二个XML输入等效的输出（相同）。已知的最小差异算法需要非常大量的内存和时间来处理多兆字节输入。在XML输入中没有重复出现的相同子树的情况下，XML diff方法中使用的算法可以产生最佳质量（尽可能接近最小）差异。</p>
                  <p>Java XML diffing库为每种方法提供了几种等效变体，以允许不同形式的XML输入，包括文档对象模型（DOM）节点，文件和输入流。在内部，差异，散列和相等比较在DOM树上运行。不是DOM树形式的输入在内部转换为DOM树。为了减少计算开销，Oracle建议尽可能直接传入DOM。</p>
                  <p>Java XML diffing库包括将diff输出作为DOM文档或作为对象列表返回的方法，每个对象都表示diff操作。使用第二个选项，可以避免生成XML文档的开销。使用第一个选项，生成的文档符合<a href="determining-XML-differences-using-Java.html#GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3" title="将介绍Java XML diffing库符合的输出模式xdiff.xsd。">Diff Output Schema中</a>描述的XML模式。第一个选项很有用，例如，如果必须将diff输出存储为日志以供将来参考。
                  </p>
                  <p>Java XML diffing库提供的哈希方法计算XML输入的哈希值。如果两个XML输入的哈希值相等，则它们的概率非常高。</p>
                  <p>Java XML diffing库中提供的相等方法比较两个输入是否相等。</p>
                  <p>要使用Java XML差异库，您的应用程序必须在Java 1.6或更高版本上运行，并且可以使用任何DOM实现。</p>
                  <div class="infoboxnote" id="GUID-D7465EE7-EE9C-48D2-8F8F-85294B2BE20C__GUID-0943AF26-DB52-4EB3-A960-24197461333F">
                     <p class="notep1">注意：</p>
                     <p>本章中描述的应用程序编程接口（API）组件包含在Java包<code class="codeph">oracle.xml.diff</code> 。为简洁起见，仅在必要时使用完全限定名称以避免混淆。
                     </p>
                     <p>有关<code class="codeph">oracle.xml.diff</code>包的更多信息，请参见<a href="../jaxml/index.html" target="_blank"><span><cite>Oracle数据库XML Java API参考</cite></span></a> 。
                     </p>
                  </div>
               </div>
            </div><a id="ADXDK129"></a><div class="props_rev_3"><a id="GUID-B5320E40-B2BD-4548-9ED4-FD71C426DCAC" name="GUID-B5320E40-B2BD-4548-9ED4-FD71C426DCAC"></a><h3 id="ADXDK-GUID-B5320E40-B2BD-4548-9ED4-FD71C426DCAC" class="sect3">Java XML Diffing Library的用户选项</h3>
               <div>
                  <p>Java XML diffing库支持两个选项，您可以使用<code class="codeph">oracle.xml.diff</code>包的<code class="codeph">Options</code>类中的方法设置这两个选项。<code class="codeph">Options</code>对象在每次调用时直接传递给diff，hash和equal方法。
                  </p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>文本节点规范化（默认启用）</p>
                        <p>文本节点在DOM树中标准化，diff树，hash和equal方法在DOM树中运行。文本节点规范化涉及合并相邻的文本节点，然后从合并的节点中剥离前导和尾随空白。单个文本节点的前导和尾随空格被剥离。仅消除空白文本节点。</p>
                        <p>规范化在库中执行，具有最小的额外空间，并且无需修改提供的XML输入。</p>
                        <p>要在将DOM输入传递给库之前对DOM输入执行自己的规范化，必须在<code class="codeph">Options</code>对象上调用<code class="codeph">normalizeTextNodes(false)</code>方法以关闭默认规范化。
                        </p>
                        <p>Oracle不建议在不执行某些类型的规范化（默认或自己的规范化）的情况下调用diff方法。差异质量在存在相同的空白文本节点时受到影响，这些节点通常出现在XML文档中。</p>
                     </li>
                     <li>
                        <p>忽略命名空间前缀差异（默认情况下启用）</p>
                        <p>diff，hash和equal方法忽略XML名称空间前缀差异。例如，如果两个DOM节点相同，则除了具有不同的前缀之外（即使两个不同的前缀映射到相同命名空间的统一资源标识符（URI）），它们被认为是相等的。要将库配置为将不同的名称空间前缀视为真正不同，即使它们映射到同一URI，您也可以在<code class="codeph">Options</code>对象上调用<code class="codeph">ignorePrefixDifferences(false)</code>方法来关闭默认名称空间前缀行为。
                        </p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-B5320E40-B2BD-4548-9ED4-FD71C426DCAC__GUID-20627278-C69D-40B9-AB45-405F3EB664CC">
                     <p class="notep1">也可以看看：</p>
                     <p>有关<code class="codeph">Options</code>类中方法的详细信息，请参阅<a href="../jaxml/index.html" target="_blank"><span><cite>Oracle数据库XML Java API参考</cite></span></a></p>
                  </div>
               </div>
            </div><a id="ADXDK1006"></a><a id="ADXDK130"></a><div class="props_rev_3"><a id="GUID-10A0F3AF-DDD9-4511-9F35-D0106B74CC94" name="GUID-10A0F3AF-DDD9-4511-9F35-D0106B74CC94"></a><h3 id="ADXDK-GUID-10A0F3AF-DDD9-4511-9F35-D0106B74CC94" class="sect3">使用Java XML Diffing方法查找差异</h3>
               <div>
                  <p>Java的XML dffing库提供各种<code class="codeph">diff</code>和<code class="codeph">diffToDoc</code>的方法<code class="codeph">XmlUtils</code>类的<code class="codeph">oracle.xml.diff</code>包。您可以使用这些方法比较两个XML输入，以确定它们之间是否存在任何差异。
                  </p>
                  <p><code class="codeph">diffToDoc</code>方法将输出作为DOM文档返回，该文档符合<a href="determining-XML-differences-using-Java.html#GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3" title="The output schema xdiff.xsd, to which the Java XML diffing library conforms, is presented.">Diff Output Schema中</a>描述的<a href="determining-XML-differences-using-Java.html#GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3" title="将介绍Java XML diffing库符合的输出模式xdiff.xsd。">模式</a> 。Java XML diffing库包含这些方法的几个等效变体，它们接受不同形式的输入（DOM节点，文件和其他形式）。
                  </p>
                  <p>Java XML diffing库包含一组等效的<code class="codeph">diff</code>方法，使您可以处理作为diff操作对象列表返回的diff输出。
                  </p>
                  <p>因为不需要构造表示diff的DOM文档，所以使用<code class="codeph">diff</code>方法比使用<code class="codeph">difftoDoc</code>方法更有效。只要不需要XML格式的diff表示，就应该考虑使用这些方法。要使用<code class="codeph">diff</code>方法，必须创建<code class="codeph">DiffOpReceiver</code>接口的实现，然后将其作为参数传递给<code class="codeph">diff</code>方法。<code class="codeph">DiffOpReceiver.receiveDiff</code>方法接收diff作为<code class="codeph">DiffOp</code>对象的列表。
                  </p>
                  <p>diff结果，无论是作为DOM文档还是作为<code class="codeph">DiffOps</code>对象列表<code class="codeph">DiffOps</code> ，都可以理解为一系列diff操作。可能的差异操作是：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>追加节点</p>
                     </li>
                     <li>
                        <p>插入节点，前</p>
                     </li>
                     <li>
                        <p>删除节点</p>
                     </li>
                  </ul>
                  <p>在第一个DOM树上应用diff操作序列会生成一个等同于第二个DOM树的树。例如，使用这两个XML输入：</p>
                  <p>第一个输入： <code class="codeph">&lt;a&gt;&lt;b/&gt;&lt;/a&gt;</code></p>
                  <p>第二个输入： <code class="codeph">&lt;a&gt;&lt;c/&gt;&lt;/a&gt;</code></p>
                  <p>比较第一个和第二个输入的差异结果是一个列表，具有这两个差异操作：</p><pre class="pre codeblock"><code>delete-node / a [1] / b [1] append-node &lt;c /&gt; to / a [1]</code></pre><p>在第一个输入中删除由XPath表达式<code class="codeph">/a/b</code>表示的节点，然后将<code class="codeph">&lt;c/&gt;</code>附加到第一个输入中由XPath表达式<code class="codeph">/a</code>表示的节点，将生成结果<code class="codeph">&lt;a&gt;&lt;c/&gt;&lt;/a&gt;</code> ，相当于第二个输入。
                  </p>
                  <p>当diff操作通过<code class="codeph">domToDoc(…)</code>方法输出到DOM文档时，它们依赖于XPath表达式来指示节点位置。这些XPath位置指的是原始第一个输入中的节点位置。它们不反映应用的差异操作。
                  </p>
                  <div class="infoboxnote" id="GUID-10A0F3AF-DDD9-4511-9F35-D0106B74CC94__GUID-0426B707-A522-421F-ACD9-E2E963666982">
                     <p class="notep1">注意：</p>
                     <p>Java XML diffing库不支持属性节点的append-node，insert-node-before和delete-node操作。因此，当更改节点的任何属性时，更改将显示为整个节点的删除，后跟插入或具有更改的属性的新节点的附加。</p>
                     <p>例如，对于这两个输入：</p>
                     <p>第一个输入： <code class="codeph">&lt;a attr1="val1"&gt;&lt;b/&gt;&lt;/a&gt;</code></p>
                     <p>第二个输入： <code class="codeph">&lt;a attr2="val2"&gt;&lt;b/&lt;/a&gt;</code></p>
                     <p>差异由这两个差异操作组成：</p><pre class="pre codeblock"><code>在/ [1]删除/ a [1]之前插入&lt;a attr2="val2"&gt; &lt;b /&gt; &lt;/a&gt;</code></pre></div>
                  <div class="section"> </div>
                  <!-- class="section" -->
                  <div class="section">
                     <div class="infoboxnote" id="GUID-10A0F3AF-DDD9-4511-9F35-D0106B74CC94__GUID-6D59B4CF-C68E-4922-9056-5BC104A7FCB6">
                        <p class="notep1">注意：</p>
                        <p>本节使用XML文档输出来描述每个diff操作。虽然这里没有描述它们，但是以编程方式返回的diff操作结果是等效的。</p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-10A0F3AF-DDD9-4511-9F35-D0106B74CC94__GUID-C00159F4-0834-44FC-B78D-3B96990ED441">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<code class="codeph">DiffOpReceiver</code>接口的更多信息，以及有关<code class="codeph">XmlUtils</code>类中的方法的详细信息，请<code class="codeph">DiffOpReceiver</code> <a href="../jaxml/index.html" target="_blank"><span><cite>Oracle数据库XML Java API参考</cite></span></a></p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADXDK138"></a><a id="ADXDK131"></a><div class="props_rev_3"><a id="GUID-8E436BF5-210B-49BE-8C11-EFB007CFA70C" name="GUID-8E436BF5-210B-49BE-8C11-EFB007CFA70C"></a><h4 id="ADXDK-GUID-8E436BF5-210B-49BE-8C11-EFB007CFA70C" class="sect4">关于append-node操作</h4>
                  <div>
                     <p>append-node操作指定将给定节点作为特定第一个输入节点的最后一个子节点附加。</p>
                     <p><a href="determining-XML-differences-using-Java.html#GUID-8E436BF5-210B-49BE-8C11-EFB007CFA70C__BABCHAEI">例20-1</a>显示了一个append-node操作，它将突出显示的节点<code class="codeph">&lt;enumeration value="FL"/&gt;</code>到文档中。
                     </p>
                     <p>调用<code class="codeph">diffToDoc(…)</code>方法，使用原始文档（没有突出显示的更改）和更改的文档作为输入生成此输出：</p><pre class="oac_no_warn" dir="ltr">&lt;xd：append-node xd：parent-xpath =“/ schema [1] / simpleType [1] / restriction [1]”xd：node-type =“element”&gt; &lt;xd：content&gt; &lt;enumeration value =“FL “/&gt; &lt;/ xd：content&gt; &lt;/ xd：append-node&gt;</pre><p>append-node操作由前面输出中的<code class="codeph">&lt;append-node&gt;</code>元素表示。此元素指定将给定类型的节点添加为给定第一个输入父节点的最后一个子节点。<code class="codeph">parent-xpath</code>属性指定父节点。<code class="codeph">node-type</code>属性指定要追加的节点的类型。<code class="codeph">&lt;content&gt;</code>子元素指定要追加的节点。
                     </p>
                     <p>或者，当使用<code class="codeph">diff(…)</code>方法时，可以在<code class="codeph">DiffOpReceiver.receiverDiff(…)</code>方法中将附加节点操作作为<code class="codeph">DiffOp</code>对象访问。在这种情况下，操作返回对diff操作中涉及的两个DOM树中的节点的实际引用。通过调用<code class="codeph">DiffOp</code>的<code class="codeph">getParent()</code>方法返回对第一个输入中父节点的<code class="codeph">DiffOp</code> 。于待从第二输入追加的节点的基准是通过调用返回<code class="codeph">getNew()</code>的方法<code class="codeph">DiffOp</code> 。</p>
                     <div class="example" id="GUID-8E436BF5-210B-49BE-8C11-EFB007CFA70C__BABCHAEI">
                        <p class="titleinexample">例20-1附加节点</p><pre class="oac_no_warn" dir="ltr">&lt;schema&gt; ... &lt;simpleType name =“USState”&gt; &lt;restriction base =“string”&gt; &lt;enumeration value =“NY”/&gt; &lt;enumeration value =“TX”/&gt; &lt;enumeration value =“CA”/&gt; <span class="bold">&lt;枚举值=“FL”/&gt;</span> &lt;/ restriction&gt; &lt;/ simpleType&gt; ... &lt;/ schema&gt;</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="ADXDK140"></a><a id="ADXDK139"></a><div class="props_rev_3"><a id="GUID-06A4BA93-73E3-44CB-950F-71689D0B23C6" name="GUID-06A4BA93-73E3-44CB-950F-71689D0B23C6"></a><h4 id="ADXDK-GUID-06A4BA93-73E3-44CB-950F-71689D0B23C6" class="sect4">关于insert-node-before操作</h4>
                  <div>
                     <p>insert-node-before操作指定在第一个输入中的特定节点之前插入给定节点。</p>
                     <p><a href="determining-XML-differences-using-Java.html#GUID-06A4BA93-73E3-44CB-950F-71689D0B23C6__BABGGHJD">示例20-2</a>显示了insert-node-before操作，该操作在文档中的节点<code class="codeph">&lt;simpleType name="USState"&gt;</code>之前插入突出显示的节点<code class="codeph">&lt;!-- A type representing US States --&gt;</code> 。
                     </p>
                     <p>调用<code class="codeph">diffToDoc(…)</code>方法，使用原始文档（没有突出显示的更改）和更改的文档作为输入生成此输出：</p><pre class="oac_no_warn" dir="ltr">&lt;xd：insert-node-before xd：node-type =“comment”xd：xpath =“/ schema [1] / simpleType [1]”&gt; &lt;xd：content&gt; &lt;！ - 代表美国各州的类型 - &gt; &lt;/ xd：content&gt; &lt;/ xd：insert-node-before&gt;</pre><p>insert-node-before操作由前面输出中的<code class="codeph">&lt;insert-node-before&gt;</code>元素表示。此元素指定在给定的第一个输入节点之前插入给定类型的节点。<code class="codeph">xpath</code>属性指定第一个输入节点的位置。<code class="codeph">node-type</code>属性指定要插入的节点的类型。<code class="codeph">&lt;content&gt;</code>子元素指定要插入的节点。
                     </p>
                     <p>或者，当使用<code class="codeph">diff(…)</code>方法时，可以在<code class="codeph">DiffOpReceiver.receiverDiff(…)</code>方法中作为<code class="codeph">DiffOp</code>对象访问insert-node-before操作。在这种情况下，操作返回对diff操作中涉及的两个DOM树中的节点的实际引用。通过调用<code class="codeph">DiffOp</code> <code class="codeph">getSibling()</code>方法返回对在第一个输入中插入节点之前的节点的<code class="codeph">DiffOp</code> 。到该节点的参考将被从第二输入插入是通过调用返回<code class="codeph">getNew()</code>的方法<code class="codeph">DiffOp</code> 。</p>
                     <div class="example" id="GUID-06A4BA93-73E3-44CB-950F-71689D0B23C6__BABGGHJD">
                        <p class="titleinexample">示例20-2插入节点</p><pre class="oac_no_warn" dir="ltr">&lt;schema&gt; ... <span class="bold">&lt;！ - 表示美国州的类型 - &gt;</span> &lt;simpleType name =“USState”&gt; &lt;restriction base =“string”&gt; &lt;enumeration value =“NY”/&gt; &lt;enumeration value =“TX”/&gt; &lt;enumeration value =“CA”/&gt; &lt;/ restriction&gt; &lt;/ simpleType&gt; ... &lt;/ schema&gt;</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="ADXDK197"></a><a id="ADXDK141"></a><div class="props_rev_3"><a id="GUID-F1C7A6C0-0386-4A15-B11C-813D5C96611B" name="GUID-F1C7A6C0-0386-4A15-B11C-813D5C96611B"></a><h4 id="ADXDK-GUID-F1C7A6C0-0386-4A15-B11C-813D5C96611B" class="sect4">关于删除节点操作</h4>
                  <div>
                     <p>删除节点操作指定要删除第一个输入中的特定节点（及其子树）。</p>
                     <p><a href="determining-XML-differences-using-Java.html#GUID-F1C7A6C0-0386-4A15-B11C-813D5C96611B__BABJAAAJ">示例20-3</a>显示了删除节点操作，该操作从文档中删除突出显示的节点<code class="codeph">&lt;element name="LineItems" maxOccurs="unbounded"&gt;</code> 。
                     </p>
                     <p>调用diffToDoc（...）方法，使用原始文档（没有突出显示的更改）和更改的文档作为输入生成此输出：</p><pre class="oac_no_warn" dir="ltr">&lt;xd：delete-node xd：node-type =“element”xd：xpath =“/ schema [1] / element [1] / complexType [1] / sequence [1] / element [1] / element [1] “/&gt;</pre><p>删除节点操作由前面输出中的<code class="codeph">&lt;delete-node&gt;</code>元素表示。此元素指定删除给定类型的节点。<code class="codeph">xpath</code>属性指定第一个输入节点的位置。<code class="codeph">node-type</code>属性指定要删除的节点的类型。
                     </p>
                     <p>或者，当使用<code class="codeph">diff(…)</code>方法时，可以在<code class="codeph">DiffOpReceiver.receiverDiff(…)</code>方法中将<code class="codeph">DiffOp</code> -node操作作为<code class="codeph">DiffOp</code>对象访问。在这种情况下，操作返回对第一个输入DOM树中的节点的实际引用。通过调用<code class="codeph">DiffOp</code> <code class="codeph">getCurrent()</code>方法返回对要从第一个输入中删除的节点的引用。</p>
                     <div class="example" id="GUID-F1C7A6C0-0386-4A15-B11C-813D5C96611B__BABJAAAJ">
                        <p class="titleinexample">示例20-3删除节点</p><pre class="oac_no_warn" dir="ltr">&lt;schema&gt; ... &lt;element name =“PurchaseOrder”&gt; &lt;complexType&gt; &lt;sequence&gt; &lt;element name =“PO-Number”type =“string”&gt; <span class="bold">&lt;element name =“LineItems”maxOccurs =“unbounded”&gt;</span> ... &lt;/ schema &gt;</pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div><a id="ADXDK200"></a><a id="ADXDK203"></a><a id="ADXDK198"></a><div class="props_rev_3"><a id="GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0" name="GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0"></a><h3 id="ADXDK-GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0" class="sect3">在Java应用程序中调用diff和difftoDoc方法</h3>
               <div>
                  <p>此处的示例显示如何通过从Java应用程序调用<code class="codeph">diff</code>和<code class="codeph">diffToDoc</code>方法来比较两个输入。
                  </p>
                  <div class="section">
                     <p></p>
                     <p><a href="determining-XML-differences-using-Java.html#GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0__BABHAGEF">例20-4</a>显示了如何使用<code class="codeph">diffToDoc</code>方法比较输入文件<code class="codeph">doc</code>和<code class="codeph">doc1</code> 。
                     </p>
                     <p>继续此示例，两个输入文件<code class="codeph">f1.xml</code>和<code class="codeph">f2.xml</code>包含与<a href="determining-XML-differences-using-Java.html#GUID-8E436BF5-210B-49BE-8C11-EFB007CFA70C__BABCHAEI">示例20-1中</a>相同的数据。
                     </p>
                     <p>此示例代码显示<code class="codeph">f1.xml</code>的内容：</p><pre class="oac_no_warn" dir="ltr">&lt;schema&gt; &lt;simpleType name =“USState”&gt; &lt;restriction base =“string”&gt; &lt;enumeration value =“NY”/&gt; &lt;enumeration value =“TX”/&gt; &lt;enumeration value =“CA”/&gt; &lt;/ restriction&gt; &lt;/ simpleType&gt; &lt;/ schema&gt;</pre><p>此示例代码显示<code class="codeph">f2.xml</code>的内容：</p><pre class="oac_no_warn" dir="ltr">&lt;schema&gt; &lt;simpleType name =“USState”&gt; &lt;restriction base =“string”&gt; &lt;enumeration value =“NY”/&gt; &lt;enumeration value =“TX”/&gt; &lt;enumeration value =“CA”/&gt; &lt;enumeration value = “FL”/&gt; &lt;/ restriction&gt; &lt;/ simpleType&gt; &lt;/ schema&gt;</pre><p>假设<code class="codeph">textDiff.java</code>和输入文件在当前目录中。然后输入以下命令来编译并运行示例：</p><pre class="oac_no_warn" dir="ltr">javac -classpath“xml.jar”textDiff.java java -classpath“xml.jar：。”textDiff f1.xml f2.xml</pre><p>序列化生成的<code class="codeph">diffAsDom</code>文档会生成以下输出：</p><pre class="oac_no_warn" dir="ltr">&lt;xd：xdiff xmlns：xd =“http://xmlns.oracle.com/xdb/xdiff.xsd”xmlns：xsi =“http://www.w3.org/2001/XMLSchema-instance”xsi：schemaLocation = “http://xmlns.oracle.com/xdb/xdiff.xsd http://xmlns.oracle.com/xdb/xdiff.xsd”&gt; &lt;？oracle-xmldiff operations-in-docorder =“true”output-model =“snapshot”diff-algorithm =“greedy-heuristic”？&gt; &lt;xd：append-node xd：node-type =“element”xd：parent-xpath =“/ schema [1] / simpleType [1] / restriction [1]”&gt; &lt;xd：content&gt; &lt;enumeration value =“ FL“/&gt; &lt;/ xd：content&gt; &lt;/ xd：append-node&gt; &lt;/ xd：xdiff&gt;</pre><p><a href="determining-XML-differences-using-Java.html#GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0__BABIEBAA">例20-5</a>显示了如何使用<code class="codeph">DiffOpReceiver</code>接口的实现来处理从两个XML输入之间的比较返回的diff作为<code class="codeph">DiffOp</code>对象列表。
                     </p>
                     <p>输入以下命令来编译并运行示例：</p><pre class="oac_no_warn" dir="ltr">javac -classpath“xml.jar”progDiff.java java -classpath“xml.jar：。”progDiff f1.xml f2.xml</pre><p>该示例生成此输出：</p><pre class="oac_no_warn" dir="ltr">附加节点：&lt;enumeration value =“FL”/&gt; TO PARENT NODE：&lt;restriction base =“string”&gt; &lt;enumeration value =“NY”/&gt; &lt;enumeration value =“TX”/&gt; &lt;enumeration value =“CA” /&gt; &lt;/ restriction&gt;</pre></div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0__BABHAGEF">
                     <p class="titleinexample">示例20-4从Java应用程序获取diff作为文档</p><pre class="oac_no_warn" dir="ltr">import oracle.xml.diff。XmlUtils; import oracle.xml.diff。选项; import java.io.文件; import org.w3c.dom。节点; import org.w3c.dom。文献; import javax.xml.parsers。的DocumentBuilderFactory; import javax.xml.parsers。DocumentBuilder的; public class textDiff {public static void main（String [] args）throws Exception {XmlUtils xmlUtils = new XmlUtils（）; //解析两个输入文件DocumentBuilderFactory dbFactory = DocumentBuilderFactory.newInstance（）; dbFactory.setNamespaceAware（真）; DocumentBuilder docBuilder = dbFactory.newDocumentBuilder（）; Node doc = docBuilder.parse（new File（args [0]））; Node doc1 = docBuilder.parse（new File（args [1]））; //运行diff try {Document diffAsDom = xmlUtils.diffToDoc（doc，doc1，new Options（））; } catch（Exception e）{e.printStackTrace（）; }}}</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0__BABIEBAA">
                     <p class="titleinexample">示例20-5从Java应用程序中使用DiffOpReceiver获取diff</p><pre class="oac_no_warn" dir="ltr">import oracle.xml.diff。DiffOp; import oracle.xml.diff。DiffOpReceiver; import java.util。清单; import java.util。性能; import java.io.文件; import org.w3c.dom。节点; import javax.xml.parsers。的DocumentBuilderFactory; import javax.xml.parsers。DocumentBuilder的; public class progDiff {public static void main（String [] args）throws Exception {XmlUtils xmlUtils = new XmlUtils（）; //解析两个输入文件DocumentBuilderFactory dbFac = DocumentBuilderFactory.newInstance（）; dbFac.setNamespaceAware（真）; DocumentBuilder docBuilder = dbFac.newDocumentBuilder（）; Node doc = docBuilder.parse（new File（args [0]））; Node doc1 = docBuilder.parse（new File（args [1]））;选项opt = new Options（）; //实例化DiffOpReceiver。这是//将接收DiffOps的对象，即XmlDiff //输出的diff操作。每个对象代表删除或插入//或附加节点。在DiffOpReceiver //接口的DiffOpReceiverImpl //实现（见下文）中，我们只打印出每个diff操作。DiffOpReceiver diffOpRec = new progDiff（）。new DiffOpReceiverImpl（）; xmlUtils.diff（doc，doc1，diffOpRec，opt）; class DiffOpReceiverImpl实现DiffOpReceiver {public void receiveDiff（List &lt;DiffOp&gt; diffOps）{try {for（int i = 0; i &lt;diffOps.size（）; i ++）{DiffOp diffOperation = diffOps.get（i）; //删除操作，如果（diffOperation.getOpName（）== DiffOp.Name，则从第一个树中打印出已删除的//节点。DELETE）System.out.println（“DELETING NODE：\ n”+ XmlUtils.nodeToString（diffOperation.getCurrent（），false））; //插入操作打印节点//从要插入的第二个树//和第一个树的节点//在此之前插入将发生，否则if（diffOperation.getOpName（）== DiffOp.Name。INSERT_BEFORE_NODE）System.out.println（“INSERTING NODE：\ n”+ XmlUtils.nodeToString（diffOperation.getNew（），false）+“BEFORE NODE：\ n”+ XmlUtils.nodeToString（diffOperation.getSibling（），false）） ; //追加为父节点的最后一个节点。//从第二个树//打印出将要追加的节点，以及//将前一个节点作为//最后一个子节点附加到第一棵树的父节点。else if（diffOperation.getOpName（）== DiffOp.Name。INSERT_BY_APPENDING）System.out.println（“APPENDING NODE：\ n”+ XmlUtils.nodeToString（diffOperation.getNew（），false）+“TO PARENT NODE：\ n”+ XmlUtils.nodeToString（diffOperation.getParent（），false ））; catch（Exception e）{System.err.println（“打印出diff结果时出错：”+ e.getMessage（））; }}}}</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="ADXDK204"></a><div class="props_rev_3"><a id="GUID-1E3D0182-7F76-48C6-AF27-239EEE6F6C44" name="GUID-1E3D0182-7F76-48C6-AF27-239EEE6F6C44"></a><h3 id="ADXDK-GUID-1E3D0182-7F76-48C6-AF27-239EEE6F6C44" class="sect3">使用Java XML哈希和相等的方法来识别和比较输入</h3>
               <div>
                  <p>Java XML diffing库提供<code class="codeph">hash</code>方法来计算唯一标识输入的哈希值，概率很高。由于散列冲突的可能性非常低，因此无法保证两个输入在其哈希值匹配时是相同的。
                  </p>
                  <p>要检查两个输入是否与绝对确定性完全相同，请使用<code class="codeph">equal</code>方法。<code class="codeph">equal</code>方法同时处理两个输入，同时检查它们是否绝对相等。
                  </p>
                  <p>Java XML diffing库提供了几种等效的<code class="codeph">hash</code>方法和<code class="codeph">equal</code>接受不同形式（DOM节点，文件等）输入的方法。
                  </p>
                  <div class="infoboxnotealso" id="GUID-1E3D0182-7F76-48C6-AF27-239EEE6F6C44__GUID-2F7D5446-48F4-4B07-8FDF-E746A6B039AD">
                     <p class="notep1">也可以看看：</p>
                     <p>有关<code class="codeph">XmlUtils</code>类中的<code class="codeph">hash</code>和<code class="codeph">equal</code>方法的详细信息，请参阅<a href="../jaxml/index.html" target="_blank"><span><cite>Oracle数据库XML Java API参考</cite></span></a></p>
                  </div>
               </div>
            </div><a id="ADXDK206"></a><a id="ADXDK205"></a><div class="props_rev_3"><a id="GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3" name="GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3"></a><h3 id="ADXDK-GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3" class="sect3">差异输出模式</h3>
               <div>
                  <p>将介绍Java XML diffing库符合的输出模式<code class="codeph">xdiff.xsd</code> 。
                  </p>
                  <div class="example" id="GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3__BABBHHCB">
                     <p class="titleinexample">例20-6 Diff输出模式：xdiff.xsd</p><pre class="oac_no_warn" dir="ltr">&lt;schema targetNamespace =“http://xmlns.oracle.com/xdb/xdiff.xsd”xmlns =“http://www.w3.org/2001/XMLSchema”xmlns：xd =“http://xmlns.oracle .com / xdb / xdiff.xsd“version =”1.0“elementFormDefault =”qualified“attributeFormDefault =”qualified“&gt; &lt;annotation&gt; &lt;documentation xml：lang =”en“&gt;定义捕获两者之间差异的XML文档的结构XML输入。Oracle XmlDiff不支持的更改可能无法在此架构中表达。'oracle-xmldiff'PI：我们使用'oracle-xmldiff'PI来描述差异的某些方面。这应该是顶级xdiff元素的第一个元素。version-number：XML diff架构输出模型的版本号：用于表示diff的输出模型。目前，仅支持“快照”模型。快照模型：每个操作都使用XPath，就好像没有对输入文档应用任何操作一样。默认并适用于Xmldiff和XmlPatch。&lt;！ - 示例：&lt;？oracle-xmldiff version-number =“1.0”output-model =“snapshot”？&gt;  - &gt; &lt;/ documentation&gt; &lt;/ annotation&gt; &lt;！ - 枚举支持的节点类型 - &gt; &lt;simpleType name =“xdiff-nodetype”&gt; &lt;restriction base =“string”&gt; &lt;enumeration value =“element”/ &gt; &lt;enumeration value =“text”/&gt; &lt;enumeration value =“cdata”/&gt; &lt;enumeration value =“processing-instruction”/&gt; &lt;enumeration value =“comment”/&gt; &lt;/ restriction&gt; &lt;/ simpleType&gt; &lt;element name =“xdiff”&gt; &lt;complexType&gt; &lt;choice minOccurs =“0”maxOccurs =“unbounded”&gt; &lt;element name =“append-node”&gt; &lt;complexType&gt; &lt;sequence&gt; &lt;element name =“content”type =“anyType”/ &gt; &lt;/ sequence&gt; &lt;attribute name =“node-type”type =“xd：xdiff-nodetype”/&gt; &lt;attribute name =“parent-xpath”type =“string”/&gt; &lt;/ complexType&gt; &lt;/ element&gt; &lt; element name =“insert-node-before”&gt; &lt;complexType&gt; &lt;sequence&gt; &lt;element name =“content”type =“anyType”/&gt; &lt;/ sequence&gt; &lt;attribute name =“xpath”type =“string”/&gt; &lt; attribute name =“node-type”type =“xd：xdiff-nodetype”/&gt; &lt;/ complexType&gt; &lt;/ element&gt; &lt;element name =“delete-node”&gt; &lt;complexType&gt; &lt;attribute name =“node-type”type =“xd：xdiff-nodetype”/&gt; &lt;attribute n ame =“xpath”type =“string”/&gt; &lt;/ complexType&gt; &lt;/ element&gt; &lt;/ choice&gt; &lt;/ complexType&gt; &lt;/ element&gt; &lt;/ schema&gt;</pre></div>
                  <!-- class="example" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>