<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="This chapter describes using various workload scale-up techniques with Consolidated Database Replay."></meta>
      <meta name="description" content="This chapter describes using various workload scale-up techniques with Consolidated Database Replay."></meta>
      <title>使用Workload Scale-Up</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Testing Guide "></meta>
      <meta property="og:description" content="This chapter describes using various workload scale-up techniques with Consolidated Database Replay."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Testing Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="testing-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-07T01:43:11-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2008, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96279-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="using-consolidated-database-replay.html" title="Previous" type="text/html"></link>
      <link rel="next" href="book-index.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Testing Guide"></meta>
    <meta name="dcterms.isVersionOf" content="RATUG"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="using-consolidated-database-replay.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="book-index.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">测试指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="database-replay.html" property="item" typeof="WebPage"><span property="name">数据库重播</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用Workload Scale-Up</li>
            </ol>
            <a id="GUID-6EE876DA-F6E0-435A-8728-CFDA1AFD1FF0" name="GUID-6EE876DA-F6E0-435A-8728-CFDA1AFD1FF0"></a><a id="RATUG4173"></a>
            
            <h2 id="RATUG-GUID-6EE876DA-F6E0-435A-8728-CFDA1AFD1FF0" class="sect2"><span class="enumeration_chapter">16</span>使用Workload Scale-Up</h2>
         </header>
         <div class="ind">
            <div>
               <div><span>本章介绍如何使用各种工作负载扩展技术和Consolidated Database Replay。</span> 它包含以下部分：</div>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="using-workload-scale-up.html#GUID-E6DA6F54-F5DF-48F3-9B32-E4A821A4B42B" title="通过统一数据库重放，您可以同时重播从一个或多个系统捕获的多个工作负载。">工作量扩展概述</a></p>
                  </li>
                  <li>
                     <p><a href="using-workload-scale-up.html#GUID-A8D66BDD-5B60-4A0D-81E8-FF88D9F68A49" title="本节介绍如何使用Consolidated Database Replay进行时移，并假设您希望使用时移来协调从三个应用程序捕获的工作负载峰值并同时重放它们。">使用时间转换</a></p>
                  </li>
                  <li>
                     <p><a href="using-workload-scale-up.html#GUID-756772FF-1F7E-4EB5-AFB5-152CB3DF6704" title="本节介绍如何使用Consolidated Database Replay使用工作负载折叠，并假设您希望使用工作负载折叠将捕获的工作负载增加三倍。该场景演示了如何使用工作负载折叠进行向上扩展测试。">使用工作负载折叠</a></p>
                  </li>
                  <li>
                     <p><a href="using-workload-scale-up.html#GUID-8564F1A9-E002-45DB-B049-6AABB3A88B82" title="本节介绍如何将架构重新映射与Consolidated Database Replay一起使用，并假设您希望在部署应用程序的多个实例时使用架构重新映射来识别可能的主机瓶颈。">使用架构重映射</a></p>
                  </li>
               </ul>
            </div><a id="RATUG4174"></a><div class="props_rev_3"><a id="GUID-E6DA6F54-F5DF-48F3-9B32-E4A821A4B42B" name="GUID-E6DA6F54-F5DF-48F3-9B32-E4A821A4B42B"></a><h3 id="RATUG-GUID-E6DA6F54-F5DF-48F3-9B32-E4A821A4B42B" class="sect3"><span class="enumeration_section">16.1</span>工作负载<span class="enumeration_section">放大</span>概述</h3>
               <div>
                  <div><span>通过统一数据库重放，您可以同时重播从一个或多个系统捕获的多个工作负载。</span> 在重放期间，合并重播开始时，合并的每个工作负载捕获都将开始重放。根据使用情况，您可以在使用Consolidated Database Replay时使用各种工作负载扩展技术。
                  </div>
                  <p>本节介绍以下工作负载扩展技术：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="using-workload-scale-up.html#GUID-DADDFA47-C013-43A9-8036-23C2410890AB" title="数据库重放使您可以在重放捕获的工作负载时执行时移。如果您希望通过向现有工作负载捕获添加工作负载并将它们重放在一起来对系统进行压力测试，则此方法非常有用。">关于时间转移</a></p>
                     </li>
                     <li>
                        <p><a href="using-workload-scale-up.html#GUID-AC8F20C7-F1B9-41BF-9FC7-74D4DF033A73" title="数据库重放使您可以通过折叠现有工作负载捕获来执行纵向扩展测试。">关于Workload Folding</a></p>
                     </li>
                     <li>
                        <p><a href="using-workload-scale-up.html#GUID-87C4565F-607D-4A5E-8A00-FE441E0E62A6" title="数据库重放使您可以通过重新映射数据库模式来执行向上扩展测试。当您部署同一应用程序的多个实例（例如多tenet应用程序）或向现有应用程序添加新地理区域时，此技术非常有用。">关于Schema Remapping</a></p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-E6DA6F54-F5DF-48F3-9B32-E4A821A4B42B__GUID-5351CE5D-4033-4EA8-B60E-1E0003786DF4">
                     <p class="notep1">也可以看看：</p>
                     <p><span class="q">“ <a href="using-consolidated-database-replay.html#GUID-CA75813D-10DB-4635-B127-6747CEC0C6D8" title="通过统一数据库重放，您可以同时重播从一个或多个系统捕获的多个工作负载。">用于统一数据库重放的用例</a> ”，</span>以获取有关统一数据库重放的典型用例的信息</p>
                  </div>
               </div><a id="RATUG4085"></a><div class="props_rev_3"><a id="GUID-DADDFA47-C013-43A9-8036-23C2410890AB" name="GUID-DADDFA47-C013-43A9-8036-23C2410890AB"></a><h4 id="RATUG-GUID-DADDFA47-C013-43A9-8036-23C2410890AB" class="sect4"><span class="enumeration_section">16.1.1</span>关于时间转换</h4>
                  <div>
                     <p>数据库重放使您可以在重放捕获的工作负载时执行时移。如果您希望通过向现有工作负载捕获添加工作负载并将它们重放在一起来对系统进行压力测试，则此方法非常有用。</p>
                     <p>例如，假设从三个应用程序中捕获了三个工作负载：Sales，CRM和DW。为了执行压力测试，您可以使用Consolidated Database Replay将这些工作负载捕获的峰值对齐并重放它们。</p>
                     <div class="infoboxnotealso" id="GUID-DADDFA47-C013-43A9-8036-23C2410890AB__GUID-CA08FC70-57AF-4FBD-B31B-474F283CB163">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="using-workload-scale-up.html#GUID-A8D66BDD-5B60-4A0D-81E8-FF88D9F68A49" title="本节介绍如何使用Consolidated Database Replay进行时移，并假设您希望使用时移来协调从三个应用程序捕获的工作负载峰值并同时重放它们。">使用时间转换</a> ”</span>获取有关使用时移的信息</p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="using-consolidated-database-replay.html#GUID-A2836514-C2B9-4170-B76F-DA8E4B298C2B" title="Consolidated Database Replay的另一个用途是用于压力测试或容量规划。">压力测试</a> ”</span>有关使用Consolidated Database Replay进行压力测试的信息</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RATUG4084"></a><div class="props_rev_3"><a id="GUID-AC8F20C7-F1B9-41BF-9FC7-74D4DF033A73" name="GUID-AC8F20C7-F1B9-41BF-9FC7-74D4DF033A73"></a><h4 id="RATUG-GUID-AC8F20C7-F1B9-41BF-9FC7-74D4DF033A73" class="sect4"><span class="enumeration_section">16.1.2</span>关于工作负载折叠</h4>
                  <div>
                     <div><span>数据库重放使您可以通过折叠现有工作负载捕获来执行纵向扩展测试。</span> 例如，假设从上午2点到晚上8点捕获工作负载您可以使用数据库重放将原始工作负载折叠为三个捕获子集：一个从凌晨2点到早上8点，第二个从早上8点到下午2点，第三个从下午2点到晚上8点通过将三个捕获子集重放在一起，您可以折叠原始捕获并在重放期间将工作负载增加三倍以执行放大测试。
                     </div>
                     <div class="infoboxnotealso" id="GUID-AC8F20C7-F1B9-41BF-9FC7-74D4DF033A73__GUID-01870BF8-42B8-4321-8348-007C618B67A2">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="using-workload-scale-up.html#GUID-756772FF-1F7E-4EB5-AFB5-152CB3DF6704" title="本节介绍如何使用Consolidated Database Replay使用工作负载折叠，并假设您希望使用工作负载折叠将捕获的工作负载增加三倍。该场景演示了如何使用工作负载折叠进行向上扩展测试。">使用工作负载折叠</a> ”</span>获取有关使用工作负载折叠的信息</p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="using-consolidated-database-replay.html#GUID-C4DC0795-74B2-456D-AA0A-B4F7F45C81F8" title="通过Consolidated Database Replay，您可以将现有工作负载捕获转换为新的较小的捕获子集。">捕获子集</a> ”</span>以获取有关捕获子集的信息</p>
                           </li>
                           <li>
                              <p><span class="q">“</span>纵向扩展<span class="q"><a href="using-consolidated-database-replay.html#GUID-0A835930-BD73-4C32-AC02-35D2E21AF725" title="Consolidated Database Replay的第三个用途是用于扩展测试。">测试</a> ”</span> ，了解有关使用整合数据库重放进行扩展测试的信息</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RATUG4175"></a><div class="props_rev_3"><a id="GUID-87C4565F-607D-4A5E-8A00-FE441E0E62A6" name="GUID-87C4565F-607D-4A5E-8A00-FE441E0E62A6"></a><h4 id="RATUG-GUID-87C4565F-607D-4A5E-8A00-FE441E0E62A6" class="sect4"><span class="enumeration_section">16.1.3</span>关于模式重映射</h4>
                  <div>
                     <p>数据库重放使您可以通过重新映射数据库模式来执行向上扩展测试。当您部署同一应用程序的多个实例（例如多tenet应用程序）或向现有应用程序添加新地理区域时，此技术非常有用。</p>
                     <p>例如，假设Sales应用程序存在单个工作负载。要执行向上扩展测试并识别可能的主机瓶颈，请使用Sales架构中的多个架构设置测试系统。</p>
                     <div class="infoboxnotealso" id="GUID-87C4565F-607D-4A5E-8A00-FE441E0E62A6__GUID-BFF50C94-F243-4112-90D0-F2A6AB7511B6">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="using-workload-scale-up.html#GUID-8564F1A9-E002-45DB-B049-6AABB3A88B82" title="本节介绍如何将架构重新映射与Consolidated Database Replay一起使用，并假设您希望在部署应用程序的多个实例时使用架构重新映射来识别可能的主机瓶颈。">使用架构重映射</a> ”</span>获取有关使用架构重映射的信息</p>
                           </li>
                           <li>
                              <p><span class="q">“</span>纵向扩展<span class="q"><a href="using-consolidated-database-replay.html#GUID-0A835930-BD73-4C32-AC02-35D2E21AF725" title="Consolidated Database Replay的第三个用途是用于扩展测试。">测试</a> ”</span> ，了解有关使用整合数据库重放进行扩展测试的信息</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div><a id="RATUG4203"></a><div class="props_rev_3"><a id="GUID-A8D66BDD-5B60-4A0D-81E8-FF88D9F68A49" name="GUID-A8D66BDD-5B60-4A0D-81E8-FF88D9F68A49"></a><h3 id="RATUG-GUID-A8D66BDD-5B60-4A0D-81E8-FF88D9F68A49" class="sect3"><span class="enumeration_section">16.2</span>使用时移</h3>
               <div>
                  <div><span>本节介绍如何使用Consolidated Database Replay进行时移，并假设您希望使用时移来协调从三个应用程序捕获的工作负载峰值并同时重放它们。</span> 该场景演示了如何使用时移进行压力测试。有关时移的更多信息，请参阅<span class="q">“ <a href="using-workload-scale-up.html#GUID-DADDFA47-C013-43A9-8036-23C2410890AB" title="数据库重放使您可以在重放捕获的工作负载时执行时移。如果您希望通过向现有工作负载捕获添加工作负载并将它们重放在一起来对系统进行压力测试，则此方法非常有用。">关于时间转换</a> ”</span> 。
                  </div>
                  <div class="section">
                     <p>此方案使用以下假设：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>从Sales应用程序捕获第一个工作负载。</p>
                        </li>
                        <li>
                           <p>第二个工作负载从CRM应用程序捕获，其高峰时间发生在Sales工作负载之前1小时。</p>
                        </li>
                        <li>
                           <p>第三个工作负载从DW应用程序捕获，其高峰时间出现在Sales工作负载之前30分钟。</p>
                        </li>
                        <li>
                           <p>为了协调这些工作负载的峰值，通过向CRM工作负载添加一小时的延迟并在重放期间向DW工作负载延迟30分钟来执行时移。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-A8D66BDD-5B60-4A0D-81E8-FF88D9F68A49__GUID-E8BEF84F-33FC-48BD-B2F8-EB1B3E1CF6A8">要在此方案中执行时移：</p>
                     <ol>
                        <li>
                           <p>在将要进行压力测试的重放系统上，为存储捕获的工作负载的根目录创建目录对象：</p><pre class="oac_no_warn" dir="ltr">CREATE [OR REPLACE] DIRECTORY cons_dir AS'/ u01 / test / cons_dir';</pre></li>
                        <li>
                           <p>将各个工作负载捕获预处理到单独的目录中：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>对于销售工作量：</p>
                                 <ol type="a">
                                    <li>
                                       <p>创建目录对象：</p><pre class="oac_no_warn" dir="ltr">创建或更换DIRECTORY销售AS'/ u01 / test / cons_dir / cap_sales';</pre></li>
                                    <li>
                                       <p>确保Sales应用程序中捕获的工作负载存储在此目录中。</p>
                                    </li>
                                    <li>
                                       <p>预处理工作量：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.PROCESS_CAPTURE（'SALES'）;</pre></li>
                                 </ol>
                              </li>
                              <li>
                                 <p>对于CRM工作负载：</p>
                                 <ol type="a">
                                    <li>
                                       <p>创建目录对象：</p><pre class="oac_no_warn" dir="ltr">创建或更换目录crm AS'/ u01 / test / cons_dir / cap_crm';</pre></li>
                                    <li>
                                       <p>确保从CRM应用程序捕获的工作负载存储在此目录中。</p>
                                    </li>
                                    <li>
                                       <p>预处理工作量：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.PROCESS_CAPTURE（'CRM'）;</pre></li>
                                 </ol>
                              </li>
                              <li>
                                 <p>对于DW工作负载：</p>
                                 <ol type="a">
                                    <li>
                                       <p>创建目录对象：</p><pre class="oac_no_warn" dir="ltr">创建或更换DIRECTORY DW AS'/ u01 / test / cons_dir / cap_dw';</pre></li>
                                    <li>
                                       <p>确保从DW应用程序捕获的工作负载存储在此目录中。</p>
                                    </li>
                                    <li>
                                       <p>预处理工作量：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.PROCESS_CAPTURE（'DW'）;</pre></li>
                                 </ol>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>将replay目录设置为根目录：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.SET_REPLAY_DIRECTORY（'CONS_DIR'）;</pre></li>
                        <li>
                           <p>创建重播计划并添加工作负载捕获：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.BEGIN_REPLAY_SCHEDULE（'align_peaks_schedule'）; SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE（'SALES'）FROM dual; SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE（'CRM'，3600）FROM dual; SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE（'DW'，1800）FROM dual; EXEC DBMS_WORKLOAD_REPLAY.END_REPLAY_SCHEDULE;</pre><p>请注意，CRM工作负载会添加3,600秒（或1小时）的延迟，并且DW工作负载会延迟1,800秒（或30分钟）。</p>
                        </li>
                        <li>
                           <p>初始化整合重播：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.INITIALIZE_CONSOLIDATED_REPLAY（'align_peaks_replay'，'align_peaks_schedule'）;</pre></li>
                        <li>
                           <p>重新映射连接：</p>
                           <ol type="a">
                              <li>
                                 <p>在<code class="codeph">DBA_WORKLOAD_CONNECTION_MAP</code>视图中查询连接映射信息：</p><pre class="oac_no_warn" dir="ltr">SELECT schedule_cap_id，conn_id，capture_conn，replay_conn FROM dba_workload_connection_map;</pre></li>
                              <li>
                                 <p>重新映射连接：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION（schedule_cap_id =&gt; 1，conn_id =&gt; 1，replay_connection =&gt;'inst1'）; EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION（schedule_cap_id =&gt; 1，conn_id =&gt; 2，replay_connection =&gt;'inst1'）; EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION（schedule_cap_id =&gt; 2，conn_id =&gt; 1，replay_connection =&gt;'inst2'）; EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION（schedule_cap_id =&gt; 2，conn_id =&gt; 2，replay_connection =&gt;'inst2'）; EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION（schedule_cap_id =&gt; 3，conn_id =&gt; 1，replay_connection =&gt;'inst3'）; EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION（schedule_cap_id =&gt; 3，conn_id =&gt; 2，replay_connection =&gt;'inst3'）;</pre><p><code class="codeph">replay_connection</code>参数表示在测试系统上定义的服务。
                                 </p>
                              </li>
                              <li>
                                 <p>验证连接重映射：</p><pre class="oac_no_warn" dir="ltr">SELECT schedule_cap_id，conn_id，capture_conn，replay_conn FROM dba_workload_connection_map;</pre></li>
                           </ol>
                        </li>
                        <li>
                           <p>准备整合重播：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.PREPARE_CONSOLIDATED_REPLAY;</pre></li>
                        <li>
                           <p>开始重播客户：</p>
                           <ol type="a">
                              <li>
                                 <p>估计所需的重播客户端数量：</p><pre class="oac_no_warn" dir="ltr">wrc mode = calibrate replaydir = / u01 / test / cons_dir / cap_sales wrc mode = calibrate replaydir = / u01 / test / cons_dir / cap_crm wrc mode = calibrate replaydir = / u01 / test / cons_dir / cap_dw</pre></li>
                              <li>
                                 <p>添加输出以确定所需的重播客户端数。</p>
                                 <p>您需要在整合工作负载中包含的每个工作负载捕获中至少启动一个重播客户端。</p>
                              </li>
                              <li>
                                 <p>重复此命令启动所需数量的重播客户端：</p><pre class="oac_no_warn" dir="ltr">wrc <span class="italic">用户名</span> / <span class="italic">密码</span>模式=重播replaydir = / u01 / test / cons_dir</pre><p><code class="codeph">replaydir</code>参数设置为存储工作负载捕获的根目录。
                                 </p>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p>开始整合重播：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.START_CONSOLIDATED_REPLAY;</pre></li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="RATUG4204"></a><div class="props_rev_3"><a id="GUID-756772FF-1F7E-4EB5-AFB5-152CB3DF6704" name="GUID-756772FF-1F7E-4EB5-AFB5-152CB3DF6704"></a><h3 id="RATUG-GUID-756772FF-1F7E-4EB5-AFB5-152CB3DF6704" class="sect3"><span class="enumeration_section">16.3</span>使用工作负载折叠</h3>
               <div>
                  <div><span>本节介绍如何使用Consolidated Database Replay使用工作负载折叠，并假设您希望使用工作负载折叠将捕获的工作负载增加三倍。该场景演示了如何使用工作负载折叠进行向上扩展测试。</span> 有关工作负载折叠的详细信息，请参阅<span class="q">“ <a href="using-workload-scale-up.html#GUID-AC8F20C7-F1B9-41BF-9FC7-74D4DF033A73" title="数据库重放使您可以通过折叠现有工作负载捕获来执行纵向扩展测试。">关于工作负载折叠</a> ”</span> 。
                  </div>
                  <div class="section">
                     <p>此方案使用以下假设：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>原始工作量从凌晨2点到晚上8点被捕获并折叠成三个捕获子集。</p>
                        </li>
                        <li>
                           <p>第一个捕获子集包含从凌晨2点到早上8点的原始工作负载的一部分</p>
                        </li>
                        <li>
                           <p>第二个捕获子集包含从上午8点到下午2点的原始工作负载的一部分</p>
                        </li>
                        <li>
                           <p>第三个捕获子集包含从下午2点到晚上8点的原始工作负载的一部分</p>
                        </li>
                        <li>
                           <p>为了在重放期间使工作负载增加三倍，通过同时重放三个捕获子集来执行工作负载折叠。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-756772FF-1F7E-4EB5-AFB5-152CB3DF6704__GUID-26DFDFE7-8A62-4F6E-BD80-CD142E99439F">要在此方案中执行工作负载折叠：</p>
                     <ol>
                        <li>
                           <p>在计划执行纵向扩展测试的重放系统上，为存储捕获的工作负载的根目录创建目录对象：</p><pre class="oac_no_warn" dir="ltr">创建或替换目录cons_dir AS'/ u01 / test / cons_dir';</pre></li>
                        <li>
                           <p>为存储原始工作负载的目录创建目录对象：</p><pre class="oac_no_warn" dir="ltr">创建或替换目录cap_monday AS'/ u01 / test / cons_dir / cap_monday';</pre></li>
                        <li>
                           <p>为计划存储捕获子集的目录创建目录对象：</p>
                           <ol type="a">
                              <li>
                                 <p>为第一个捕获子集创建目录对象：</p><pre class="oac_no_warn" dir="ltr">创建或更换目录cap_mon_2am_8am AS'/ u01 / test / cons_dir / cap_monday_2am_8am';</pre></li>
                              <li>
                                 <p>为第二个捕获子集创建目录对象：</p><pre class="oac_no_warn" dir="ltr">创建或更换目录cap_mon_8am_2pm AS'/ u01 / test / cons_dir / cap_monday_8am_2pm';</pre></li>
                              <li>
                                 <p>为第三个捕获子集创建目录对象：</p><pre class="oac_no_warn" dir="ltr">创建或替换目录cap_mon_2pm_8pm AS'/ u01 / test / cons_dir / cap_monday_2pm_8pm';</pre></li>
                           </ol>
                        </li>
                        <li>
                           <p>创建捕获子集：</p>
                           <ol type="a">
                              <li>
                                 <p>生成从凌晨2点到早上8点的第一个捕获子集：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.GENERATE_CAPTURE_SUBSET（'CAP_MONDAY'，'CAP_MON_2AM_8AM'，'mon_2am_8am_wkld'，0，TRUE，21600，FALSE，1）;</pre></li>
                              <li>
                                 <p>生成从上午8点到下午2点的时间段的第二个捕获子集：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.GENERATE_CAPTURE_SUBSET（'CAP_MONDAY'，'CAP_MON_8AM_2PM'，'mon_8am_2pm_wkld'，21600，TRUE，43200，FALSE，1）;</pre></li>
                              <li>
                                 <p>生成从下午2点到晚上8点的时间段的第三个捕获子集：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.GENERATE_CAPTURE_SUBSET（'CAP_MONDAY'，'CAP_MON_2PM_8PM'，'mon_2pm_8pm_wkld'，43200，TRUE，0，FALSE，1）;</pre></li>
                           </ol>
                        </li>
                        <li>
                           <p>预处理捕获子集：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.PROCESS_CAPTURE（'CAP_MON_2AM_8AM'）; EXEC DBMS_WORKLOAD_REPLAY.PROCESS_CAPTURE（'CAP_MON_8AM_2PM'）; EXEC DBMS_WORKLOAD_REPLAY.PROCESS_CAPTURE（'CAP_MON_2PM_8PM'）;</pre></li>
                        <li>
                           <p>将replay目录设置为根目录：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.SET_REPLAY_DIRECTORY（'CONS_DIR'）;</pre></li>
                        <li>
                           <p>创建重播计划并添加捕获子集：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.BEGIN_REPLAY_SCHEDULE（'monday_folded_schedule'）; SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE（'CAP_MON_2AM_8AM'）FROM dual; SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE（'CAP_MON_8AM_2PM'）FROM dual; SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE（'CAP_MON_2PM_8PM'）FROM dual; EXEC DBMS_WORKLOAD_REPLAY.END_REPLAY_SCHEDULE;</pre></li>
                        <li>
                           <p>初始化整合重播：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.INITIALIZE_CONSOLIDATED_REPLAY（'monday_folded_replay'，'monday_folded_schedule'）;</pre></li>
                        <li>
                           <p>重新映射连接：</p>
                           <ol type="a">
                              <li>
                                 <p>在<code class="codeph">DBA_WORKLOAD_CONNECTION_MAP</code>视图中查询连接映射信息：</p><pre class="oac_no_warn" dir="ltr">SELECT schedule_cap_id，conn_id，capture_conn，replay_conn FROM dba_workload_connection_map;</pre></li>
                              <li>
                                 <p>重新映射连接：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION（schedule_cap_id =&gt; 1，conn_id =&gt; 1，replay_connection =&gt;'inst1'）; EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION（schedule_cap_id =&gt; 1，conn_id =&gt; 2，replay_connection =&gt;'inst1'）; EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION（schedule_cap_id =&gt; 2，conn_id =&gt; 1，replay_connection =&gt;'inst2'）; EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION（schedule_cap_id =&gt; 2，conn_id =&gt; 2，replay_connection =&gt;'inst2'）; EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION（schedule_cap_id =&gt; 3，conn_id =&gt; 1，replay_connection =&gt;'inst3'）; EXEC DBMS_WORKLOAD_REPLAY.REMAP_CONNECTION（schedule_cap_id =&gt; 3，conn_id =&gt; 2，replay_connection =&gt;'inst3'）;</pre><p><code class="codeph">replay_connection</code>参数表示在测试系统上定义的服务。
                                 </p>
                              </li>
                              <li>
                                 <p>验证连接重映射：</p><pre class="oac_no_warn" dir="ltr">SELECT schedule_cap_id，conn_id，capture_conn，replay_conn FROM dba_workload_connection_map;</pre></li>
                           </ol>
                        </li>
                        <li>
                           <p>准备整合重播：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.PREPARE_CONSOLIDATED_REPLAY;</pre></li>
                        <li>
                           <p>开始重播客户：</p>
                           <ol type="a">
                              <li>
                                 <p>估计所需的重播客户端数量：</p><pre class="oac_no_warn" dir="ltr">wrc mode =校准replaydir = / u01 / test / cons_dir / cap_monday_2am_8am wrc mode =校准replaydir = / u01 / test / cons_dir / cap_monday_8am_2pm wrc mode =校准replaydir = / u01 / test / cons_dir / cap_monday_2pm_8pm</pre></li>
                              <li>
                                 <p>添加输出以确定所需的重播客户端数。</p>
                                 <p>您需要在整合工作负载中包含的每个工作负载捕获中至少启动一个重播客户端。</p>
                              </li>
                              <li>
                                 <p>重复此命令启动所需数量的重播客户端：</p><pre class="oac_no_warn" dir="ltr">wrc <span class="italic">用户名</span> / <span class="italic">密码</span>模式=重播replaydir = / u01 / test / cons_dir</pre><p><code class="codeph">replaydir</code>参数设置为存储工作负载捕获的根目录。
                                 </p>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p>开始整合重播：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.START_CONSOLIDATED_REPLAY;</pre></li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="RATUG4205"></a><div class="props_rev_3"><a id="GUID-8564F1A9-E002-45DB-B049-6AABB3A88B82" name="GUID-8564F1A9-E002-45DB-B049-6AABB3A88B82"></a><h3 id="RATUG-GUID-8564F1A9-E002-45DB-B049-6AABB3A88B82" class="sect3"><span class="enumeration_section">16.4</span>使用架构重映射</h3>
               <div>
                  <div><span>本节介绍如何将架构重新映射与Consolidated Database Replay一起使用，并假设您希望在部署应用程序的多个实例时使用架构重新映射来识别可能的主机瓶颈。</span> 该场景演示了如何使用模式重新映射进行向上扩展测试。有关架构重新映射的详细信息，请参阅<span class="q">“ <a href="using-workload-scale-up.html#GUID-87C4565F-607D-4A5E-8A00-FE441E0E62A6" title="数据库重放使您可以通过重新映射数据库模式来执行向上扩展测试。当您部署同一应用程序的多个实例（例如多tenet应用程序）或向现有应用程序添加新地理区域时，此技术非常有用。">关于架构重新映射</a> ”</span> 。
                  </div>
                  <div class="section">
                     <p>此方案使用以下假设：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>存在从Sales应用程序捕获的单个工作负载。</p>
                        </li>
                        <li>
                           <p>要使用Sales模式中的多个模式设置重播系统，可以通过将捕获的工作负载多次添加到重放计划并将用户重新映射到不同模式来执行模式重新映射。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-8564F1A9-E002-45DB-B049-6AABB3A88B82__GUID-7CAF8269-85D7-43F3-A347-D999C3F01C9B">要在此方案中执行架构重映射：</p>
                     <ol>
                        <li>
                           <p>在计划执行纵向扩展测试的重放系统上，为存储捕获的工作负载的根目录创建目录对象：</p><pre class="oac_no_warn" dir="ltr">创建或替换目录cons_dir AS'/ u01 / test / cons_dir';</pre></li>
                        <li>
                           <p>为存储捕获的工作负载的目录创建目录对象：</p><pre class="oac_no_warn" dir="ltr">创建或替换目录cap_sales AS'/ u01 / test / cons_dir / cap_sales';</pre><p>确保Sales应用程序中捕获的工作负载存储在此目录中。</p>
                        </li>
                        <li>
                           <p>预处理捕获的工作负载：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.PROCESS_CAPTURE（'CAP_SALES'）;</pre></li>
                        <li>
                           <p>将replay目录设置为根目录：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.SET_REPLAY_DIRECTORY（'CONS_DIR'）;</pre></li>
                        <li>
                           <p>创建重播计划并多次添加捕获的工作负载：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.BEGIN_REPLAY_SCHEDULE（'double_sales_schedule'）; SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE（'CAP_SALES'）FROM dual; SELECT DBMS_WORKLOAD_REPLAY.ADD_CAPTURE（'CAP_SALES'）FROM dual; EXEC DBMS_WORKLOAD_REPLAY.END_REPLAY_SCHEDULE;</pre></li>
                        <li>
                           <p>初始化整合重播：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.INITIALIZE_CONSOLIDATED_REPLAY（'double_sales_replay'，'double_sales_schedule）;</pre></li>
                        <li>
                           <p>重新映射用户：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.SET_USER_MAPPING（2，'sales_usr'，'sales_usr_2'）;</pre></li>
                        <li>
                           <p>准备整合重播：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.PREPARE_CONSOLIDATED_REPLAY;</pre></li>
                        <li>
                           <p>开始重播客户：</p>
                           <ol type="a">
                              <li>
                                 <p>估计所需的重播客户端数量：</p><pre class="oac_no_warn" dir="ltr">wrc mode = calibrate replaydir = / u01 / test / cons_dir / cap_sales</pre></li>
                              <li>
                                 <p>添加输出以确定所需的重播客户端数。</p>
                                 <p>您需要在整合工作负载中包含的每个工作负载捕获中至少启动一个重播客户端。</p>
                              </li>
                              <li>
                                 <p>重复此命令启动所需数量的重播客户端：</p><pre class="oac_no_warn" dir="ltr">wrc <span class="italic">用户名</span> / <span class="italic">密码</span>模式=重播replaydir = / u01 / test / cons_dir</pre><p><code class="codeph">replaydir</code>参数设置为存储工作负载捕获的根目录。
                                 </p>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p>开始整合重播：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_WORKLOAD_REPLAY.START_CONSOLIDATED_REPLAY;</pre></li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>