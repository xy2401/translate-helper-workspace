<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="An analytic view is a type of view that you can use to easily extend the content of a star schema, snowflake schema, or a flat (denormalized) fact table with aggregated data, measure calculations and descriptive metadata, and to simplify the SQL needed to access data."></meta>
      <meta name="description" content="An analytic view is a type of view that you can use to easily extend the content of a star schema, snowflake schema, or a flat (denormalized) fact table with aggregated data, measure calculations and descriptive metadata, and to simplify the SQL needed to access data."></meta>
      <title>分析视图对象</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Data Warehousing Guide"></meta>
      <meta property="og:description" content="An analytic view is a type of view that you can use to easily extend the content of a star schema, snowflake schema, or a flat (denormalized) fact table with aggregated data, measure calculations and descriptive metadata, and to simplify the SQL needed to access data."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Data Warehousing Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-data-warehousing-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T00:20:13-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2001, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96243-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="analytic-view-attribute-dimensions.html" title="Previous" type="text/html"></link>
      <link rel="next" href="glossary.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Data Warehousing Guide"></meta>
    <meta name="dcterms.isVersionOf" content="DWHSG"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="analytic-view-attribute-dimensions.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="glossary.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据仓库指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-analytic-views.html" property="item" typeof="WebPage"><span property="name">分析观点</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">分析视图对象</li>
            </ol>
            <a id="GUID-3FF2F855-ACB3-43A3-9D7B-C319F821B601" name="GUID-3FF2F855-ACB3-43A3-9D7B-C319F821B601"></a><a id="RESOURCEID-18623-7EE84997"></a>
            
            <h2 id="DWHSG-GUID-3FF2F855-ACB3-43A3-9D7B-C319F821B601" class="sect2"><span class="enumeration_chapter">26</span>分析视图对象</h2>
         </header>
         <div class="ind">
            <div>
               <p>分析视图是一种视图，您可以使用该视图轻松扩展星型模式，雪花模式或平面（非规范化）事实表的内容，其中包含聚合数据，度量计算和描述性元数据，并简化所需的SQL访问数据。</p>
               <p>以下主题中描述了分析视图。</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="analytic-view-objects.html#GUID-EE854CA8-9BE5-4BF8-AFC9-C3B020B06DE2" title="分析视图将数据层次/维度模型分层。">关于分析视图</a></p>
                  </li>
                  <li>
                     <p><a href="analytic-view-objects.html#GUID-E6A33251-56D4-4F3D-9C00-BB1160CBBC03" title="分析视图度量指定事实数据以及要对数据执行的计算或其他操作。">分析观点的测量</a></p>
                  </li>
                  <li>
                     <p><a href="analytic-view-objects.html#GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B" title="在创建分析视图时，您可以指定一个或多个层次结构和一个事实表，该事实表至少有一个可以连接到每个层次结构的度量列。">创建分析视图</a></p>
                  </li>
                  <li>
                     <p><a href="analytic-view-objects.html#GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529" title="计算度量是以measure_name AS（表达式）的形式添加到分析视图的MEASURES子句的表达式。">计算度量的示例</a></p>
                  </li>
                  <li>
                     <p><a href="analytic-view-objects.html#GUID-8EFF4827-208C-40B0-AFA2-6838BFFEB2C1" title="您可以在层次结构中使用属性维度的任何属性，并在分析视图中为其汇总数据。">属性报告</a></p>
                  </li>
                  <li>
                     <p><a href="analytic-view-objects.html#GUID-BEE5DB77-C00D-46F7-8543-F4EE3356BCE2" title="从分析视图中查询SELECT的查询可能包括FILTER FACT关键字，用于在任何计算之前过滤分析视图访问的事实数据，以及ADD MEASURES关键字以定义查询的其他计算度量。">使用过滤事实和附加度量的分析视图查询</a></p>
                  </li>
               </ul>
            </div><a id="RESOURCEID-186323-7FDC9206"></a><div class="sect2"><a id="GUID-EE854CA8-9BE5-4BF8-AFC9-C3B020B06DE2" name="GUID-EE854CA8-9BE5-4BF8-AFC9-C3B020B06DE2"></a><h3 id="DWHSG-GUID-EE854CA8-9BE5-4BF8-AFC9-C3B020B06DE2" class="sect3"><span class="enumeration_section">26.1</span>关于分析视图</h3>
               <div>
                  <div><span>分析视图将数据层次/维度模型分层。</span> 
                  </div>
                  <p>分析视图是在维度表和星形或雪花模式的事实表上定义的。您还可以在非规范化表上定义分析视图，其中维度属性和事实数据位于同一个表中。层次结构是在维度表上定义的。分析视图引用层次结构和事实表。</p>
                  <p>即使分析视图是在建模为星型模式的数据上定义的，也不需要将数据存储在星型模式中。您可以使用视图将其他形式的存储数据表示为分析视图。通常，如果表或视图在星型查询中表现良好，则它们可以很好地与分析视图配合使用。较小的数据集可能适用于视图。对于星型模式中的表，较大的数据集可能表现更好。最高性能的模式是使用Oracle Database In-Memory选项加载到内存中列存储中的星型模式。</p>
                  <p>与内存中列存储一起使用时，分析视图会优化SQL执行计划以利用内存中聚合（即矢量转换执行计划）。分析视图可以利用物化视图来进一步加速聚合级别查询（请注意，物化视图可以加载到内存中的列存储中）。</p>
                  <p>分析视图的最低要求包括以下内容：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>维度表（或视图）。此表应具有主键，该主键提供唯一的值列表并连接到事实表。</p>
                     </li>
                     <li>
                        <p>具有至少一个事实（度量）列和连接到维度表的主键的键列的事实表。</p>
                     </li>
                  </ul>
                  <p>更典型地，分析视图具有以下特征：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>定义使用两个或多个维度表，这使得能够切片和切块数据。</p>
                     </li>
                     <li>
                        <p>一个或多个维度表包含不同聚合级别的数据（例如：天，月，季度和年）。</p>
                     </li>
                  </ul>
                  <p>分析视图包含三种类型的对象：属性维，层次结构和分析视图。</p>
                  <p>属性维度是一个元数据对象，它引用表或视图，并将列组织为更高级别的对象，如属性和级别。与维和层次结构相关的大多数元数据都在属性维对象中定义。</p>
                  <p>层次结构是一种视图。层次结构引用属性维对象。层次结构使用层次结构成员之间的层次关系来组织数据。层次结构的查询返回详细信息和聚合级别键（“层次结构值”）以及这些值的属性。</p>
                  <p>分析视图是一种返回事实数据的视图。分析视图引用事实表和层次结构。从分析视图中选择层次结构和度量数据。</p>
               </div>
            </div><a id="RESOURCEID-186623-7FDCA04F"></a><div class="sect2"><a id="GUID-E6A33251-56D4-4F3D-9C00-BB1160CBBC03" name="GUID-E6A33251-56D4-4F3D-9C00-BB1160CBBC03"></a><h3 id="DWHSG-GUID-E6A33251-56D4-4F3D-9C00-BB1160CBBC03" class="sect3"><span class="enumeration_section">26.2</span>分析观点的测量</h3>
               <div>
                  <p>分析视图度量指定事实数据以及要对数据执行的计算或其他操作。</p>
                  <p>在分析视图定义中，您可以指定一个或多个基本度量和计算度量。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-E6A33251-56D4-4F3D-9C00-BB1160CBBC03__GUID-DF23721B-8262-4567-AE16-ACEC7AB69CB8">基本措施</p>
                     <p>基本度量是对事实表中列的引用。您可以选择指定<code class="codeph">meas_aggregate_clause</code> ，它会覆盖分析视图的默认聚合方法。每个基本度量可以指定默认聚合。聚合可以是简单的操作，如<code class="codeph">SUM</code>或<code class="codeph">AVG</code> ，也可以是由属性维度变化的复杂操作嵌套。
                     </p>
                     <p>您可以使用<code class="codeph">default_aggregate_clause</code>为没有<code class="codeph">meas_aggregate_clause</code>基本度量指定默认聚合方法。<code class="codeph">default_aggregate_clause</code>的默认值为<code class="codeph">SUM</code> 。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-E6A33251-56D4-4F3D-9C00-BB1160CBBC03__GUID-746CECAD-9DBE-4A96-9211-B61A3B623334">计算的措施</p>
                     <p>计算度量是一种表达式，可以是用户定义的表达式，也可以是许多预定义的分析计算之一。计算的度量表达式可以包括其他度量，行函数和层次函数。层次结构函数允许基于识别和处理层次结构中的相关成员进行计算。表达式可以引用分析视图中的其他度量，但可能不引用事实列。由于计算可以参考其他度量，因此您可以通过嵌套轻松构建复杂的计算。</p>
                     <p>在定义计算的度量表达式时，无论您定义分析视图的度量的顺序如何，您都可以在分析视图中使用任何其他度量。唯一的限制是在计算中不会引入任何循环。</p>
                     <p>除了在分析视图的定义中使用计算度量之外，还可以在查询分析视图的<code class="codeph">SELECT</code>语句中添加计算度量。为此，您可以在语句的<code class="codeph">WITH</code>或<code class="codeph">FROM</code>子句中使用<code class="codeph">ADD</code> <code class="codeph">MEASURES</code>关键字。无论是在分析视图的定义中还是在<code class="codeph">SELECT</code>语句中，计算度量的语法都是相同的。
                     </p>
                     <p>计算出的度量表达式的类别如下：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>分析视图度量表达式</p>
                        </li>
                        <li>
                           <p>分析视图分层表达式</p>
                        </li>
                        <li>
                           <p>简单的表达</p>
                        </li>
                        <li>
                           <p>单行函数表达式</p>
                        </li>
                        <li>
                           <p>复合表达式</p>
                        </li>
                        <li>
                           <p>日期时间表达式</p>
                        </li>
                        <li>
                           <p>区间表达式</p>
                        </li>
                     </ul>
                     <p>分析视图度量表达式包括以下操作：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>领先和滞后</p>
                        </li>
                        <li>
                           <p>合格数据参考（QDR）</p>
                        </li>
                        <li>
                           <p>秩</p>
                        </li>
                        <li>
                           <p>相关成员</p>
                        </li>
                        <li>
                           <p>分享</p>
                        </li>
                        <li>
                           <p>窗口计算</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="analytic-view-objects.html#GUID-36131726-9188-465F-9C35-69D3F657D080">具有附加度量的分析视图查询</a></li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B" name="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B"></a><h3 id="DWHSG-GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B" class="sect3"><span class="enumeration_section">26.3</span>创建分析视图</h3>
               <div>
                  <p>在创建分析视图时，您可以指定一个或多个层次结构和一个事实表，该事实表至少有一个可以连接到每个层次结构的度量列。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B__GUID-1D668795-E27B-49A6-BBB4-30B3055039D3">创建一个简单的分析视图</p>
                     <p>分析视图必须具有对事实表的引用以及可以加入层次结构的度量。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B__GUID-3E323FF9-5FED-4485-8E1C-E92857E78508">
                     <p class="titleinexample">示例26-1创建简单分析视图</p>
                     <p>此分析视图使用TIME_HIER层次结构和SALE_FACT表。它包含一个单一的度量，SALES。</p><pre class="pre codeblock"><code>创建或替换ANALYTIC VIEW sales_av USING sales_fact  - 引用SALES_FACT表DIMENSION BY  - 属性维度列表（time_attr_dim  -  TIME_ATTR_DIM属性维度KEY month_id参考month_id  - 维度键连接到事实列HIERARCHIES（ - 层次结构列表使用time_hier DEFAULT）） - 属性维度MEASURES  - 度量列表（销售FACT销售） -  SALES度量参考SALES列DEFAULT MEASURE SALES; - 分析视图的默认度量</code></pre><p>从不包含过滤器的分析视图中选择的查询可能会返回大量行。但是，在此查询中，SALES_AV分析视图包含仅返回86行的单个层次结构。</p><pre class="pre codeblock"><code>SELECT * FROM sales_av HIERARCHIES（time_hier）ORDER BY time_hier.hier_order;</code></pre><p>这是返回值的摘录。</p><img src="img/simple_av_sel.png" alt="simple_av_sel.png的描述如下" title="simple_av_sel.png的描述如下" longdesc="img_text/simple_av_sel.html"><br><a href="img_text/simple_av_sel.html">插图说明simple_av_sel.png</a></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B__GUID-B6CB1896-ED1C-494A-A344-B5503999D6DD">添加另一个基本测量</p>
                     <p>要将另一个基本度量添加到分析视图，请在<code class="codeph">MEASURES</code>列表中包含该度量。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B__GUID-7527476C-452D-4D6A-AC84-9D397589D0AA">
                     <p class="titleinexample">示例26-2将基本度量添加到分析视图</p><pre class="pre codeblock"><code>创建或替换ANALYTIC VIEW sales_av使用sales_fact DIMENSION BY（time_attr_dim KEY month_id参考month_id HIERARCHIES（time_hier DEFAULT））措施（销售FACT销售，单位FACT单位） - 添加UNITS基准测量DEFAULT MEASURE SALES;</code></pre><p>由于分析视图的查询可能返回很多行，因此查询通常使用过滤器来限制结果。在<code class="codeph">WHERE</code>子句中，此查询将时间段过滤为YEAR级别的时间段，因此它仅返回该级别的SALES和UNITS数据。
                     </p><pre class="pre codeblock"><code>SELECT time_hier.member_name as TIME，sales，units FROM sales_av HIERARCHIES（time_hier）WHERE time_hier.level_name ='YEAR'ORDER BY time_hier.hier_order;</code></pre><p>这些是返回的值。</p><img src="img/av_sel_2measures.png" alt="下面是av_sel_2measures.png的说明" title="下面是av_sel_2measures.png的说明" longdesc="img_text/av_sel_2measures.html"><br><a href="img_text/av_sel_2measures.html">av_sel_2measures.png插图的描述</a></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B__GUID-95D07451-A0C4-4BB9-80CF-0EE4656B998C">将层次结构添加到分析视图</p>
                     <p>通常，分析视图使用一个或多个属性维度具有多个层次结构。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B__GUID-C7978C62-E297-4C66-9301-56C4BE1ED427">
                     <p class="titleinexample">示例26-3将层次结构添加到分析视图</p>
                     <p>此示例将属性维和层次结构添加到分析视图的<code class="codeph">DIMENSION</code> <code class="codeph">BY</code>列表中。
                     </p><pre class="pre codeblock"><code>创建或替换ANALYTIC VIEW sales_av使用sales_fact DIMENSION BY（time_attr_dim KEY month_id参考month_id HIERARCHIES（time_hier DEFAULT），product_attr_dim KEY category_id REFERENCES category_id HIERARCHIES（product_hier DEFAULT），geography_attr_dim KEY state_province_id REFERENCES state_province_id HIERARCHIES（geography_hier DEFAULT））措施（销售FACT销售，单位FACT单位）DEFAULT MEASURE销售;</code></pre><p>以下查询将PRODUCT_HIER和GEOGRAPHY_HIER层次结构添加到<code class="codeph">FROM</code>子句的<code class="codeph">HIERARCHIES</code>短语中。
                     </p><pre class="pre codeblock"><code>SELECT time_hier.member_name AS Time，product_hier.member_name AS Product，geography_hier.member_name AS地理位置，销售，单位FROM sales_av HIERARCHIES（time_hier，product_hier，geography_hier）WHERE time_hier.level_name in（'YEAR'）AND product_hier.level_name in（'DEPARTMENT '）AND geography_hier.level_name in（'REGION'）ORDER BY time_hier.hier_order，product_hier.hier_order，geography_hier.hier_order;</code></pre><p>查询返回50行。下图仅显示前20行。</p><img src="img/av_sel_all_hiers.png" alt="下面是av_sel_all_hiers.png的说明" title="下面是av_sel_all_hiers.png的说明" longdesc="img_text/av_sel_all_hiers.html"><br><a href="img_text/av_sel_all_hiers.html">av_sel_all_hiers.png插图的描述</a></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p>您可以在<a href="https://livesql.oracle.com/apex/livesql/file/index.html" target="_blank">https://livesql.oracle.com/apex/livesql/file/index上</a>查看和运行创建表，分析视图组件对象以及Oracle Live SQL网站示例中使用的查询的SQL脚本<a href="https://livesql.oracle.com/apex/livesql/file/index.html" target="_blank">。 HTML</a> 。</p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529" name="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529"></a><h3 id="DWHSG-GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529" class="sect3"><span class="enumeration_section">26.4</span>计算措施的例子</h3>
               <div>
                  <p>计算度量是以<span class="italic"><code class="codeph">measure_name</code></span> <code class="codeph">AS</code> <code class="codeph">( <span class="codeinlineitalic">expression</span> )</code>的形式添加到分析视图的<code class="codeph">MEASURES</code>子句的<code class="codeph"><span class="codeinlineitalic">( expression )</span></code> 。
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529__GUID-AB000187-1756-4FAD-8F04-08963A988D73">添加LAG表达式</p>
                     <p>此示例将使用<code class="codeph">LAG</code>操作的计算度量添加到SALES_AV分析视图。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529__GUID-7F1BE548-BECB-4589-85EA-AA1B72A54EAA">
                     <p class="titleinexample">示例26-4添加LAG表达式</p><pre class="pre codeblock"><code>创建或替换ANALYTIC VIEW sales_av使用sales_fact DIMENSION BY（time_attr_dim KEY month_id参考month_id HIERARCHIES（time_hier DEFAULT），product_attr_dim KEY category_id REFERENCES category_id HIERARCHIES（product_hier DEFAULT），geography_attr_dim KEY state_province_id REFERENCES state_province_id HIERARCHIES（geography_hier DEFAULT））措施（销售FACT销售，单位FACT单位，sales_prior_period AS  - 添加计算的度量。（LAG（销售）超过（HIERARCHY time_hier OFFSET 1）））默认测量销售;</code></pre><p>在YEAR和QUARTER级别选择SALES和SALES_PRIOR_PERIOD度量。</p><pre class="pre codeblock"><code>SELECT time_hier.member_name为TIME，sales，sales_prior_period FROM sales_av HIERARCHIES（time_hier）WHERE time_hier.level_name IN（'YEAR'，'QUARTER'）ORDER BY time_hier.hier_order;</code></pre><p>在查询结果的摘录中，请注意<code class="codeph">LAG</code>表达式返回同一级别中的前一个句点。
                     </p><img src="img/av_calc_meas_lag.png" alt="下面是av_calc_meas_lag.png的说明" title="下面是av_calc_meas_lag.png的说明" longdesc="img_text/av_calc_meas_lag.html"><br><a href="img_text/av_calc_meas_lag.html">av_calc_meas_lag.png插图的描述</a></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529__GUID-C6EDDFE8-AF2B-44AD-A6A9-520303E37F71">分享表达</p>
                     <p>度量共享计算当前行与父行，祖先行或当前级别中所有行的比率;例如，地理成员与成员的父成员的比率。使用<code class="codeph">SHARE</code> <code class="codeph">OF</code>表达式指定度量的份额。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529__GUID-015E9CA4-DFBF-4467-9AE9-DB8104E4019D">
                     <p class="titleinexample">例26-5使用SHARE OF表达式</p>
                     <p>此示例将使用<code class="codeph">SHARE</code> <code class="codeph">OF</code>操作的计算度量添加到SALES_AV分析视图。
                     </p><pre class="pre codeblock"><code>创建或替换ANALYTIC VIEW sales_av使用sales_fact DIMENSION BY（time_attr_dim KEY month_id参考month_id HIERARCHIES（time_hier DEFAULT），product_attr_dim KEY category_id REFERENCES category_id HIERARCHIES（product_hier DEFAULT），geography_attr_dim KEY state_province_id REFERENCES state_province_id HIERARCHIES（geography_hier DEFAULT））措施（销售FACT销售，单位FACT单位， - 计算份额sales_shr_parent_prod AS（SHARE_OF（销售HIERARCHY product_hier PARENT）），sales_shr_parent_geog AS（SHARE_OF（销售层级geography_hier PARENT）），sales_shr_region AS（SHARE_OF（销售层级geography_hier LEVEL REGION）））DEFAULT MEASURE SALES;</code></pre><p>SALES_SHR_PARENT_PROD度量计算PRODUCTORY或DEPARTMENT级别的SALES值与PRODUCT_HIER层次结构中父级的SALES的比率，例如总服务器计算机与计算机的SALES之比。</p>
                     <p>此查询在PRODUCT_HIER层次结构的每个级别选择CY2014的SALES和SALES_SHR_PARENT_PROD度量。</p><pre class="pre codeblock"><code>SELECT time_hier.member_name AS Time，product_hier.member_name AS Product，product_hier.level_name AS Prod_Level，sales，ROUND（sales_shr_parent_prod，2）AS sales_shr_parent_prod FROM sales_av HIERARCHIES（time_hier，product_hier）WHERE time_hier.year_name ='CY2014'AND time_hier.level_name = '年'订单来自product_hier.hier_order;</code></pre><p>查询结果如下：</p><img src="img/av_calc_meas_share.png" alt="下面是av_calc_meas_share.png的说明" title="下面是av_calc_meas_share.png的说明" longdesc="img_text/av_calc_meas_share.html"><br><a href="img_text/av_calc_meas_share.html">av_calc_meas_share.png插图的描述</a><p>SALE_SHR_REGION度量计算州级或国家级别的SALES在REGION级别的SALES的份额，例如，加州 - 美国的SALES与北美的SALES的比率。</p>
                     <p>此查询返回2014年CY2014的SALES和SALES_SHR_REGION度量值以及美国的状态值。</p><pre class="pre codeblock"><code>SELECT time_hier.member_name AS Time，geography_hier.member_name AS Geography，geography_hier.level_name AS Geog_Level，sales，ROUND（sales_shr_region，2）AS sales_shr_region FROM sales_av HIERARCHIES（time_hier，geography_hier）WHERE time_hier.year_name ='CY2014'AND time_hier.level_name = '年'和geography_hier.country_name ='美国'AND geography_hier.level_name ='STATE_PROVINCE'ORDER BY geography_hier.hier_order;</code></pre><p>这是查询的结果。</p><img src="img/av_calc_meas_share_region.png" alt="下面是av_calc_meas_share_region.png的描述" title="下面是av_calc_meas_share_region.png的描述" longdesc="img_text/av_calc_meas_share_region.html"><br><a href="img_text/av_calc_meas_share_region.html">av_calc_meas_share_region.png插图的描述</a></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529__GUID-DD175022-14B7-4A52-B144-8D14A9270EEE">QDR表达</p>
                     <p><code class="codeph">qdr_expression</code>使用<code class="codeph">QUALIFY</code>关键字将度量值限制为单个维度成员的值。一个例子是CY2011年的Sales，或当前时间段和CY2011之间SALES的百分比差异。<code class="codeph">QUALIFY</code>表达式引用<code class="codeph">KEY</code>属性值。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529__GUID-7E0C2ECF-9CBC-45CF-BB16-FB34A405CAC9">
                     <p class="titleinexample">示例26-6使用QUALIFY表达式</p>
                     <p>使用SALES_2011和SALES_PCT_CHG_2011度量创建SALES_AV分析视图。</p><pre class="pre codeblock"><code>创建或替换ANALYTIC VIEW sales_av使用sales_fact DIMENSION BY（time_attr_dim KEY month_id参考month_id HIERARCHIES（time_hier DEFAULT），product_attr_dim KEY category_id REFERENCES category_id HIERARCHIES（product_hier DEFAULT），geography_attr_dim KEY state_province_id REFERENCES state_province_id HIERARCHIES（geography_hier DEFAULT））措施（销售FACT销售，单位FACT单位， -  CY2011 sales_2011 AS的销售额（QUALIFY（销售额，time_hier =年['11']））， -  2011年销售额变化百分比。sales_pct_chg_2011 AS（（销售 - （QUALIFY（销售，time_hier =年['11']）））/（QUALIFY（销售，time_hier =年['11']））））DEFAULT MEASURE SALES;</code></pre><p>无论查询中的过滤器如何，SALES_2011度量始终返回CY2011年的数据。SALES_PCT_CHG_2011度量计算当前时间段与CY2011之间的百分比差异。</p>
                     <p>此查询在YEAR和REGION级别选择SALES，SALES_2011和SALES_PCT_CHG_2011。</p><pre class="pre codeblock"><code>SELECT time_hier.member_name AS Time，geography_hier.member_name AS Geography，sales，sales_2011，ROUND（sales_pct_chg_2011,2）as sales_pct_chg_2011 FROM sales_av HIERARCHIES（time_hier，geography_hier）WHERE time_hier.level_name ='YEAR'AND geography_hier.level_name ='REGION'ORDER BY geography_hier.hier_order，time_hier.hier_order;</code></pre><p>这是查询结果的摘录。请注意，SALES_2011每行返回CY2011的SALES。</p><img src="img/av_calc_meas_qualify.png" alt="下面是av_calc_meas_qualify.png的描述" title="下面是av_calc_meas_qualify.png的描述" longdesc="img_text/av_calc_meas_qualify.html"><br><a href="img_text/av_calc_meas_qualify.html">av_calc_meas_qualify.png插图的描述</a></div>
                  <!-- class="example" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-8EFF4827-208C-40B0-AFA2-6838BFFEB2C1" name="GUID-8EFF4827-208C-40B0-AFA2-6838BFFEB2C1"></a><h3 id="DWHSG-GUID-8EFF4827-208C-40B0-AFA2-6838BFFEB2C1" class="sect3"><span class="enumeration_section">26.5</span>属性报告</h3>
               <div>
                  <p>您可以在层次结构中使用属性维度的任何属性，并在分析视图中为其汇总数据。</p>
                  <p>您可以使用属性来过滤数据或显示在报表中。您还可以通过属性分解（聚合）数据。您可以使用该属性在分析视图中创建计算度量;然后，分析视图提供属性的聚合行。</p>
                  <div class="example" id="GUID-8EFF4827-208C-40B0-AFA2-6838BFFEB2C1__GUID-F4434745-B5D1-4B59-91EF-8DEC18202516">
                     <p class="titleinexample">示例26-7使用SEASON属性</p>
                     <p>此示例首先创建一个以SEASON和SEASON_ORDER作为属性的属性维。这允许层次结构和分析视图重用这些属性的一些元数据并将属性与其他级别相关联。例如，SEASON由MONTH值确定。</p><pre class="pre codeblock"><code>- 使用SEASON属性创建时间属性维度。创建或替换属性维度time_attr_dim维度类型时间使用time_dim属性（year_id，year_name，year_end_date，quarter_id，quarter_name，quarter_end_date，month_id，month_name，month_long_name，month_end_date，season，season_order）LEVEL month LEVEL TYPE MONTHS KEY month_id MEMBER NAME month_name MEMBER CAPTION month_name成员说明month_long_name ORDER BY month_end_date DETERMINES（quarter_id，season，season_order）LEVEL quarter LEVEL TYPE QUARTERS KEY quarter_id成员名称quarter_name成员CAPIT quarter_name成员说明quarter_name ORDER BY quarter_end_date决定（year_id）级别年份级别年份关键年份_id成员名称年份名称成员姓名年份名称会员描述年份名称ORDER BY year_end_date LEVEL季节级别季度关键季度会员名称季度会员季节成员说明季节订单按季节顺序;</code></pre><p>创建MONTH是SEASON子级的层次结构。</p><pre class="pre codeblock"><code>使用time_attr_dim（月份CHILD OF季节）创建或替换HIERARCHY time_season_hier;</code></pre><p>从TIME_SEASON_HIER层次结构中选择数据。</p><pre class="pre codeblock"><code>SELECT member_name，member_unique_name，level_name，hier_order FROM time_season_hier ORDER BY hier_order;</code></pre><p>在查询结果中，TIME_SEASON_HIER层次结构返回ALL级别，SEASONS和MONTHS的行。此图像捕获返回的前20行。</p><img src="img/av_calc_meas_attr_report.png" alt="下面是av_calc_meas_attr_report.png的说明" title="下面是av_calc_meas_attr_report.png的说明" longdesc="img_text/av_calc_meas_attr_report.html"><br><a href="img_text/av_calc_meas_attr_report.html">av_calc_meas_attr_report.png插图的描述</a><p>下面的示例创建一个分析视图，为SEASON提供聚合数据。</p><pre class="pre codeblock"><code>创建或替换ANALYTIC VIEW sales_av使用sales_fact DIMENSION BY（time_attr_dim KEY month_id参考month_id HIERARCHIES（time_hier DEFAULT，time_season_hier），product_attr_dim KEY category_id REFERENCES category_id HIERARCHIES（product_hier DEFAULT），geography_attr_dim KEY state_province_id REFERENCES state_province_id HIERARCHIES（geography_hier DEFAULT））措施（销售事实）销售，单位FACT单位）DEFAULT MEASURE SALES;</code></pre><p>您现在可以直接从分析视图中选择YEAR和SEASON的SALES。此查询从YEAR和SEASON级别的TIME_HIER和TIME_SEASON_HIER层次结构中进行选择。</p><pre class="pre codeblock"><code>SELECT time_hier.member_name AS Time，time_season_hier.member_name AS Season，ROUND（sales）AS Sales FROM sales_av HIERARCHIES（time_hier，time_season_hier）WHERE time_hier.level_name ='YEAR'AND time_season_hier.level_name ='SEASON'ORDER BY time_hier.hier_order，time_season_hier .hier_order;</code></pre><p>查询结果的摘录显示返回的前12行。</p><img src="img/av_calc_meas_season_sales.png" alt="下面是av_calc_meas_season_sales.png的描述" title="下面是av_calc_meas_season_sales.png的描述" longdesc="img_text/av_calc_meas_season_sales.html"><br><a href="img_text/av_calc_meas_season_sales.html">av_calc_meas_season_sales.png插图的描述</a></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p>您可以在<a href="https://livesql.oracle.com/apex/livesql/file/index.html" target="_blank">https://livesql.oracle.com/apex/livesql/file/index上</a>查看和运行创建表的SQL脚本，分析视图组件对象以及Oracle Live SQL网站示例中使用的查询。 <a href="https://livesql.oracle.com/apex/livesql/file/index.html" target="_blank">.html</a> 。</p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-BEE5DB77-C00D-46F7-8543-F4EE3356BCE2" name="GUID-BEE5DB77-C00D-46F7-8543-F4EE3356BCE2"></a><h3 id="DWHSG-GUID-BEE5DB77-C00D-46F7-8543-F4EE3356BCE2" class="sect3"><span class="enumeration_section">26.6</span>使用过滤事实和附加度量的分析视图查询</h3>
               <div>
                  <p>从分析视图中查询<code class="codeph">SELECT</code>查询可能包括<code class="codeph">FILTER</code> <code class="codeph">FACT</code>关键字，用于在任何计算之前过滤分析视图访问的事实数据，以及<code class="codeph">ADD</code> <code class="codeph">MEASURES</code>关键字以定义查询的其他计算度量。
                  </p>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="analytic-view-objects.html#GUID-CBB7C952-7331-4532-8627-6F27F96F327A">使用过滤事实的分析视图查询</a></li>
                        <li><a href="analytic-view-objects.html#GUID-36131726-9188-465F-9C35-69D3F657D080">具有附加度量的分析视图查询</a></li>
                        <li><a href="analytic-view-objects.html#GUID-E5DD2E53-995F-4B45-B9D9-BDFE0DC53A05">具有过滤事实和多个附加度量的分析视图查询</a></li>
                     </ul>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-CBB7C952-7331-4532-8627-6F27F96F327A" name="GUID-CBB7C952-7331-4532-8627-6F27F96F327A"></a><h4 id="DWHSG-GUID-CBB7C952-7331-4532-8627-6F27F96F327A" class="sect4"><span class="enumeration_section">26.6.1</span>带有过滤事实的分析视图查询</h4>
                  <div>
                     <p>在分析视图的查询中，您可以在分析视图聚合更高级别层次结构成员的数据之前过滤事实数据。</p>
                     <p></p>
                     <p>分析视图返回的聚合记录的值由分析视图的层次结构，聚合运算符和事实表中包含的行确定。查询分析视图的<code class="codeph">SELECT</code>语句中的谓词限制分析视图返回的行，但不影响聚合记录的计算。
                     </p>
                     <p>通过在<code class="codeph">SELECT</code>语句中使用<code class="codeph">FILTER</code> <code class="codeph">FACT</code>关键字，可以在分析视图聚合数据之前过滤事实记录，该分析视图仅为指定的层次结构成员生成聚合值。
                     </p>
                     <div class="example" id="GUID-CBB7C952-7331-4532-8627-6F27F96F327A__GUID-E3097227-29F2-4331-9725-2B3512ECD433">
                        <p class="titleinexample">示例26-8使用和不使用Filter-Before Aggregation Predicates的查询</p>
                        <p>以下查询从sales_av分析视图中选择层次结构成员名称和销售值。查询谓词将层次结构成员限制为YEAR级别的成员。过滤不会影响度量值的聚合。</p><pre class="pre codeblock"><code>SELECT time_hier.member_name，TO_CHAR（sales，'999,999,999,999'）AS sales FROM sales_av HIERARCHIES（time_hier）WHERE time_hier.level_name ='YEAR'ORDER BY time_hier.hier_order;</code></pre><p>查询结果如下。结果包括YEAR级别的层次结构成员的聚合度量值。</p><pre class="pre codeblock"><code>MEMBER_NAME SALES ----------- ------------- CY2011 6,755,115,981 CY2012 6,901,682,399 CY2013 7,240,938,718 CY2014 7,579,746,353 CY2015 7,941,102,885</code></pre><p>以下查询定义了一个内联分析视图，该视图在聚合之前过滤层次结构成员。</p><pre class="pre codeblock"><code>SELECT time_hier.member_name，TO_CHAR（sales，'999,999,999,999'）AS FROM FROM ANALYTIC VIEW（ - 内联分析视图USING sales_av HIERARCHIES（time_hier）FILTER FACT（time_hier TO level_name ='MONTH'和TO_CHAR（month_end_date，'Q'）IN （1,2）））WHERE time_hier.level_name ='YEAR'）ORDER BY time_hier.hier_order;</code></pre><p>查询结果如下。内联分析视图的<code class="codeph">FILTER FACT</code>子句会过滤除前两个季度之外的所有月份。结果包括这些季度的YEAR级别的汇总值。聚合不包括第三和第四季度值。
                        </p><pre class="pre codeblock"><code>MEMBER_NAME SALES ----------- ------------- CY2011 3,340,459,835 CY2012 3,397,271,965 CY2013 3,564,557,290 CY2014 3,739,283,051 CY2015 3,926,231,605</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="analytic-view-objects.html#GUID-E5DD2E53-995F-4B45-B9D9-BDFE0DC53A05">具有过滤事实和多个附加度量的分析视图查询</a></li>
                        </ul>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-36131726-9188-465F-9C35-69D3F657D080" name="GUID-36131726-9188-465F-9C35-69D3F657D080"></a><h4 id="DWHSG-GUID-36131726-9188-465F-9C35-69D3F657D080" class="sect4"><span class="enumeration_section">26.6.2</span>带有附加度量的分析视图查询</h4>
                  <div>
                     <p>使用<code class="codeph">ADD</code> <code class="codeph">MEASURES</code>关键字，您可以将度量计算添加到分析视图的查询中。
                     </p>
                     <div class="example" id="GUID-36131726-9188-465F-9C35-69D3F657D080__GUID-EF46DA67-C961-4ED8-90D4-C23F0A8F1B16">
                        <p class="titleinexample">示例26-9计算在FROM子句中添加度量</p>
                        <p>此示例具有内联分析视图，该视图使用sales_av分析视图将计算的度量share_sales添加到查询。</p><pre class="pre codeblock"><code>SELECT time_hier.member_name AS“Member”，TO_CHAR（sales，'999,999,999,999'）AS“Sales”，ROUND（share_sales，2）AS“销售份额”来自ANALYTIC VIEW（使用sales_av HIERARCHIES（time_hier）ADD MEASURES（share_sales as（ SHARE_OF（销售HIERARCHY time_hier PARENT））））WHERE time_hier.level_name IN（'ALL'，'YEAR'）ORDER BY time_hier.hier_order;</code></pre><p>以下是查询的结果。</p><pre class="pre codeblock"><code>销售会员销售份额------ -------------- --------------所有36,418,586,336 CY2011 6,755,115,981 0.19 CY2012 6,901,682,399 0.19 CY2013 7,240,938,718 0.2 CY2014 7,579,746,353 0.21 CY2015 7,941,102,885 0.22</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-36131726-9188-465F-9C35-69D3F657D080__GUID-D3EB5701-F0F4-4572-B17D-CC8B1D9A5DC6">
                        <p class="titleinexample">示例26-10计算在WITH子句中添加度量</p>
                        <p>此示例定义与前一示例中相同的分析视图，但它在<code class="codeph">SELECT</code>语句的<code class="codeph">WITH</code>子句中执行此操作。
                        </p><pre class="pre codeblock"><code>WITH my_av ANALYTIC VIEW AS（使用sales_av HIERARCHIES（time_hier）添加措施（share_sales为（SHARE_OF（销售层次时间_父亲））））SELECT time_hier.member_name AS“会员”，TO_CHAR（销售，'999,999,999,999'）AS“销售”， ROUND（share_sales，2）AS“销售份额”FROM my_av WHERE time_hier.level_name IN（'ALL'，'YEAR'）ORDER BY time_hier.hier_order;</code></pre><p>查询结果与前一个示例相同。</p><pre class="pre codeblock"><code>销售会员销售份额------ -------------- --------------所有36,418,586,336 CY2011 6,755,115,981 0.19 CY2012 6,901,682,399 0.19 CY2013 7,240,938,718 0.2 CY2014 7,579,746,353 0.21 CY2015 7,941,102,885 0.22</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="analytic-view-objects.html#GUID-E5DD2E53-995F-4B45-B9D9-BDFE0DC53A05">具有过滤事实和多个附加度量的分析视图查询</a></li>
                        </ul>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-E5DD2E53-995F-4B45-B9D9-BDFE0DC53A05" name="GUID-E5DD2E53-995F-4B45-B9D9-BDFE0DC53A05"></a><h4 id="DWHSG-GUID-E5DD2E53-995F-4B45-B9D9-BDFE0DC53A05" class="sect4"><span class="enumeration_section">26.6.3</span>带有过滤事实和多个附加度量的分析视图查询</h4>
                  <div>
                     <p>在分析视图的查询中，您可以指定预聚合过滤器和添加的度量。</p>
                     <div class="example" id="GUID-E5DD2E53-995F-4B45-B9D9-BDFE0DC53A05__GUID-342E220C-0D43-409D-A31B-67A898119742">
                        <p class="titleinexample">示例26-11使用筛选事实和多个计算度量的查询</p>
                        <p>此查询中<code class="codeph">WITH</code>子句中的分析视图基于sales_av分析视图。my_av分析视图将time_hier层次结构成员过滤到QUARTER级别的第一和第二季度，将geography_hier层次结构成员过滤到COUNTRY级别的墨西哥和加拿大国家。它增加了计算上一期间销售额的计算方法，以及销售额与前期销售额之间差异的百分比变化。
                        </p><pre class="pre codeblock"><code>使用my_av ANALYTIC VIEW AS（使用sales_av HIERARCHIES（time_hier，geography_hier）FILTER FACT（time_hier TO level_name ='QUARTER'AND（quarter_name LIKE'Q1％'或quarter_name LIKE'Q2％'），geography_hier TO level_name ='COUNTRY'和country_name IN（'墨西哥'，'加拿大'））添加措施（sales_pp AS（LAG（销售）OVER（HIERARCHY time_hier OFFSET 1）），sales_pp_pct_change AS（LAG_DIFF_PERCENT（销售）OVER（HIERARCHY time_hier OFFSET 1））））SELECT time_hier。 member_name AS time，geography_hier.member_name AS地理位置，sales，sales_pp，ROUND（sales_pp_pct_change，3）AS“更改”FROM my_av HIERARCHIES（time_hier，geography_hier）WHERE time_hier.level_name IN（'YEAR'）AND geography_hier.level_name ='REGION' ORDER BY time_hier.hier_order;</code></pre><p>结果如下。</p><pre class="pre codeblock"><code>时间地理销售SALES_PP改变------ ------------- ------------ ----------- --- --- CY2011北美229,884,616 CY2012北美233,688,485 229,884,616 .017 CY2013北美245,970,470 233,688,485 .053 CY2014北美256,789,511 245,970,470 .044 CY2015北美270,469,199 256,789,511 .053</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="analytic-view-objects.html#GUID-CBB7C952-7331-4532-8627-6F27F96F327A">使用过滤事实的分析视图查询</a></li>
                           <li><a href="analytic-view-objects.html#GUID-36131726-9188-465F-9C35-69D3F657D080">具有附加度量的分析视图查询</a></li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>