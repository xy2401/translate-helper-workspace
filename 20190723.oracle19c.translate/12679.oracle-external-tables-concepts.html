<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="The external tables feature is a complement to existing SQL*Loader functionality. It enables you to access data in external sources as if it were in a table in the database."></meta>
      <meta name="description" content="The external tables feature is a complement to existing SQL*Loader functionality. It enables you to access data in external sources as if it were in a table in the database."></meta>
      <title>外部表概念</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Utilities "></meta>
      <meta property="og:description" content="The external tables feature is a complement to existing SQL*Loader functionality. It enables you to access data in external sources as if it were in a table in the database."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Utilities"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-utilities.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-04-23T19:07:17-07:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2002, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96081-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="oracle-external-tables.html" title="Previous" type="text/html"></link>
      <link rel="next" href="oracle_loader-access-driver.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Utilities"></meta>
    <meta name="dcterms.isVersionOf" content="SUTIL"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="oracle-external-tables.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="oracle_loader-access-driver.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">公用事业</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="oracle-external-tables.html" property="item" typeof="WebPage"><span property="name">外部表格</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">外部表概念</li>
            </ol>
            <a id="GUID-44323E01-7D72-45EC-915A-99E596769D9E" name="GUID-44323E01-7D72-45EC-915A-99E596769D9E"></a><a id="SUTIL011"></a>
            
            <h2 id="SUTIL-GUID-44323E01-7D72-45EC-915A-99E596769D9E" class="sect2"><span class="enumeration_chapter">14</span>外部表概念</h2>
         </header>
         <div class="ind">
            <div>
               <p>外部表功能是对现有SQL * Loader功能的补充。它使您可以访问外部源中的数据，就像它在数据库中的表中一样。</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="oracle-external-tables-concepts.html#GUID-ACF1D3AA-1D61-4682-AEC5-42C944756E12">如何创建外部表？</a><br>使用SQL <code class="codeph">CREATE</code> <code class="codeph">TABLE...创建外部表<code class="codeph">TABLE...ORGANIZATION EXTERNAL</code>声明。
                  </li>
                  <li class="ulchildlink"><a href="oracle-external-tables-concepts.html#GUID-05AA7C84-2C2D-45CE-8F52-392D4A2B4864">数据文件和输出文件的位置</a><br>数据文件和输出文件必须位于服务器上。您必须具有一个目录对象，该对象指定从中读取和写入文件的位置。
                  </li>
                  <li class="ulchildlink"><a href="oracle-external-tables-concepts.html#GUID-07D30CE6-128D-426F-8B76-B13E1C53BD5A">访问外部表的参数</a><br>要修改外部表的访问驱动程序的默认行为，请指定访问参数。
                  </li>
                  <li class="ulchildlink"><a href="oracle-external-tables-concepts.html#GUID-7AB423F1-C688-4A1C-A940-77C221839BCA">外部表使用期间的数据类型转换</a><br>读取外部表时以及写入外部表时可能会发生转换错误。
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="oracle-external-tables.html#GUID-038ED956-A6EE-4C6D-B7C9-0D406B8088B6">外部表</a></p>
                  </div>
               </div>
            </div>
            <a id="SUTIL1357"></a><div class="props_rev_3"><a id="GUID-ACF1D3AA-1D61-4682-AEC5-42C944756E12" name="GUID-ACF1D3AA-1D61-4682-AEC5-42C944756E12"></a><h3 id="SUTIL-GUID-ACF1D3AA-1D61-4682-AEC5-42C944756E12" class="sect3"><span class="enumeration_section">14.1</span>如何创建外部表？
               </h3>
               <div>
                  <p>使用SQL <code class="codeph">CREATE</code> <code class="codeph">TABLE...创建外部表<code class="codeph">TABLE...ORGANIZATION EXTERNAL</code>声明。
                  </p>
                  <p>请注意，在需要对登台表进行额外索引的数据加载情况下，SQL * Loader可能是更好的选择。有关<a href="oracle-sql-loader-concepts.html#GUID-AC0DBDB3-BD68-45A4-ABA3-3DE38BB038ED" title="This section describes important differences between loading data with external tables, using the ORACLE_LOADER access driver, as opposed to loading data with SQL*Loader conventional and direct path loads.">SQL * Loader与外部表</a>之间的加载行为如何不同的详细信息，请参阅<a href="oracle-sql-loader-concepts.html#GUID-AC0DBDB3-BD68-45A4-ABA3-3DE38BB038ED" title="本节介绍使用ORACLE_LOADER访问驱动程序加载数据与外部表之间的重要区别，而不是使用SQL * Loader传统和直接路径加载来加载数据。">SQL * Loader和外部表</a>之间的行为差异。
                  </p>
                  <p>从Oracle Database 12 <span class="italic">c</span>第2版（12.2.0.1）开始，您可以对外部表中包含的数据进行分区，这样您就可以利用分区存储在数据库中的表时提供的相同性能改进（例如，分区修剪） 。
                  </p>
                  <div class="infoboxnotealso" id="GUID-ACF1D3AA-1D61-4682-AEC5-42C944756E12__GUID-68CAF487-8DC2-4A11-84A3-231E140C7E3F">
                     <p class="notep1">也可以看看：</p>
                     <p>有关创建和管理外部表以及对其进行分区的其他信息，请参见<a href="../admin/managing-tables.html#ADMIN01507" target="_blank"><span><cite>“Oracle数据库管理员指南”</cite></span></a> 。
                     </p>
                  </div>
                  <div class="infoboxnote" id="GUID-ACF1D3AA-1D61-4682-AEC5-42C944756E12__GUID-A01A2BC3-CFE0-429C-A41E-9D86ACF56C3A">
                     <p class="notep1">注意：</p>
                     <p>外部表可用作SQL语句中的内联外部表，因此无需在数据字典中创建外部表作为持久数据库对象。有关其他信息，请参见<a href="../sqlrf/SELECT.html#SQLRF-GUID-CFA006CA-6FF1-4972-821E-6996142A51C6" target="_blank"><span><cite>Oracle数据库SQL语言参考</cite></span></a> 。
                     </p>
                  </div>
                  <p>创建外部表时，请指定以下属性：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><code class="codeph">TYPE</code> - 指定外部表的类型。每种类型的外部表都由其自己的访问驱动程序支持。
                        </p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">ORACLE_LOADER</code> - 这是默认的访问驱动程序。它将数据从外部表加载到内部表。数据必须来自文本数据文件。（ <code class="codeph">ORACLE_LOADER</code>访问驱动程序无法执行卸载;也就是说，它无法将数据从内部表移动到外部表。）
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">ORACLE_DATAPUMP</code> - 此访问驱动程序可以执行加载和卸载。数据必须来自二进制转储文件。从外部表加载内部表是通过从二进制转储文件中获取来完成的。通过填充外部表的二进制转储文件来完成从内部表到外部表的卸载。<code class="codeph">ORACLE_DATAPUMP</code>访问驱动程序只能在使用SQL <code class="codeph">CREATE TABLE AS SELECT</code>语句创建外部表的过程中写入转储文件。创建转储文件后，可以多次读取它，但不能修改它（也就是说，不能执行DML操作）。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">ORACLE_HDFS</code> - 提取存储在Hadoop分布式文件系统（HDFS）中的数据。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">ORACLE_HIVE</code> - 提取存储在Apache HIVE中的数据。</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p><code class="codeph">DEFAULT</code> <code class="codeph">DIRECTORY</code> - 指定用于未明确命名目录对象的所有输入和输出文件的默认目录。使用目录对象而不是目录路径指定位置。您必须在创建外部表之前创建目录对象;否则，会产生错误。有关更多信息，请参阅<a href="oracle-external-tables-concepts.html#GUID-05AA7C84-2C2D-45CE-8F52-392D4A2B4864" title="数据文件和输出文件必须位于服务器上。您必须具有一个目录对象，该对象指定从中读取和写入文件的位置。">数据文件和输出文件的位置</a> 。
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">ACCESS</code> <code class="codeph">PARAMETERS</code> - 描述外部数据源并实现指定的外部表的类型。每种类型的外部表都有自己的访问驱动程序，该驱动程序提供对该类外部表唯一的访问参数。访问参数是可选的。请参阅<a href="oracle-external-tables-concepts.html#GUID-07D30CE6-128D-426F-8B76-B13E1C53BD5A" title="要修改外部表的访问驱动程序的默认行为，请指定访问参数。">访问参数</a> 。
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">LOCATION</code> - 指定外部表的数据文件。
                        </p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>对于<code class="codeph">ORACLE_LOADER</code>和<code class="codeph">ORACLE_DATAPUMP</code> ，文件在表单<span class="italic"><code class="codeph">directory:file</code></span>中命名。<span class="italic"><code class="codeph">directory</code></span>部分是可选的。如果缺少，则默认目录用作文件的目录。如果您使用的是<code class="codeph">ORACLE_LOADER</code>访问驱动程序，则可以在文件名中使用通配符：星号（*）表示多个字符，一个问号（？）表示单个字符。
                              </p>
                           </li>
                           <li>
                              <p>对于<code class="codeph">ORACLE_HDFS</code> ， <code class="codeph">LOCATION</code>子句是目录或文件的统一资源标识符（URI）列表。没有与URI关联的目录对象。</p>
                           </li>
                           <li>
                              <p>对于<code class="codeph">ORACLE_HIVE</code> ，不使用<code class="codeph">LOCATION</code>子句。而是读取Hadoop HCatalog表以获取有关数据源位置（可以是文件或其他数据库）的信息。
                              </p>
                           </li>
                        </ul>
                     </li>
                  </ul>
                  <p>以下示例简要说明了每个访问驱动程序的属性使用情况。</p>
                  <div class="example" id="GUID-ACF1D3AA-1D61-4682-AEC5-42C944756E12__GUID-C0EE1690-9140-4243-80FC-EA88AC886123">
                     <p class="titleinexample">示例14-1指定ORACLE_LOADER访问驱动程序的属性</p>
                     <p>以下示例使用<code class="codeph">ORACLE_LOADER</code>访问驱动程序显示每个属性的使用（它假定默认目录<code class="codeph">def_dir1</code>已存在）：</p><pre class="pre codeblock"><code>SQL&gt; CREATE TABLE emp_load 2（employee_number CHAR（5），3 employee_dob CHAR（20），4 employee_last_name CHAR（20），5 employee_first_name CHAR（15），6 employee_middle_name CHAR（15），7 employee_hire_date DATE）8 ORGANIZATION EXTERNAL 9（ <span class="bold">TYPE</span> ORACLE_LOADER 10 <span class="bold">默认目录</span> def_dir1 11 <span class="bold">访问参数</span> 12（NEWLINE 13字段删除的记录（employee_number CHAR（2），14 employee_dob CHAR（20），15 employee_last_name CHAR（18），16 employee_first_name CHAR（11），17 employee_middle_name CHAR（11 ），18 employee_hire_date CHAR（10）date_format DATE掩码“mm / dd / yyyy”19）20）21 <span class="bold">LOCATION</span> （'info.dat'）22）;表创建。
</code></pre><p>您通过访问驱动程序提供的信息可确保处理来自数据源的数据，以使其与外部表的定义相匹配。上市后的字段<code class="codeph">CREATE</code> <code class="codeph">TABLE</code> <code class="codeph">emp_load</code>实际上是定义在该数据的元数据<code class="codeph">info</code> 。 <code class="codeph">dat</code>源文件。
                     </p>
                  </div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-ACF1D3AA-1D61-4682-AEC5-42C944756E12__GUID-B81DE8BA-774C-48AA-86AD-55E41B276AC3">
                     <p class="titleinexample">示例14-2指定ORACLE_DATAPUMP访问驱动程序的属性</p>
                     <p>此示例创建一个名为<code class="codeph">inventories_xt</code>的外部表，并使用<code class="codeph">oe</code>示例模式中的表<code class="codeph">inventories</code>中的数据填充外部表的转储文件。
                     </p><pre class="pre codeblock"><code>SQL&gt; CREATE TABLE inventories_xt 2 ORGANIZATION EXTERNAL 3（4 TYPE ORACLE_DATAPUMP 5 DEFAULT DIRECTORY def_dir1 6 LOCATION（'inv_xt.dmp'）7）8 AS SELECT * FROM inventoryories;表创建。</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-ACF1D3AA-1D61-4682-AEC5-42C944756E12__GUID-94542F48-C4CF-47E9-8089-7ABF3BC9E666">
                     <p class="titleinexample">示例14-3指定ORACLE_HDFS访问驱动程序的属性</p><pre class="pre codeblock"><code>CREATE TABLE sales_external（time_id DATE NOT NULL，... amount_sold NUMBER（10,2））ORGANIZATION EXTERNAL（TYPE ORACLE_HDFS ACCESS PARAMETERS（com.oracle.bigdata.cluster = hadoop1）LOCATION（“hdfs：/usr/sales_1.csv”，“ hdfs：/ usr / my_sales _ * .csv“））</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-ACF1D3AA-1D61-4682-AEC5-42C944756E12__GUID-5441F127-0F76-4B74-B6A6-EE23C5CBF7A8">
                     <p class="titleinexample">示例14-4指定ORACLE_HIVE访问驱动程序的属性</p><pre class="pre codeblock"><code>CREATE TABLE sales_external（time_id DATE NOT NULL，... amount_sold NUMBER（10,2））ORGANIZATION EXTERNAL（TYPE ORACLE_HIVE ACCESS PARAMETERS（com.oracle.bigdata.cluster = hadoop1 com.oracle.bigdata.tablename = default.ratings_hive_table））;</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="oracle-external-tables-concepts.html#GUID-44323E01-7D72-45EC-915A-99E596769D9E" title="外部表功能是对现有SQL * Loader功能的补充。它使您可以访问外部源中的数据，就像它在数据库中的表中一样。">外部表概念</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="SUTIL1359"></a><div class="props_rev_3"><a id="GUID-05AA7C84-2C2D-45CE-8F52-392D4A2B4864" name="GUID-05AA7C84-2C2D-45CE-8F52-392D4A2B4864"></a><h3 id="SUTIL-GUID-05AA7C84-2C2D-45CE-8F52-392D4A2B4864" class="sect3"><span class="enumeration_section">14.2</span>数据文件和输出文件的位置</h3>
               <div>
                  <p>数据文件和输出文件必须位于服务器上。您必须具有一个目录对象，该对象指定从中读取和写入文件的位置。</p>
                  <div class="infoboxnote" id="GUID-05AA7C84-2C2D-45CE-8F52-392D4A2B4864__GUID-45EEFFDC-F14B-4FFD-AF03-349102267FCD">
                     <p class="notep1">注意：</p>本节中有关目录对象的信息不适用于<code class="codeph">ORACLE_HDFS</code>访问驱动程序或<code class="codeph">ORACLE_HIVE</code>访问驱动程序的数据文件。使用<code class="codeph">ORACLE_HDFS</code>驱动程序，数据的位置使用目录或文件的URI列表指定，并且没有与URI关联的目录对象。 <code class="codeph">ORACLE_HIVE</code>驱动程序未指定数据源位置;它读取Hive Metastore表以获取该信息，因此不需要目录对象。
                  </div>
                  <p>访问驱动程序在数据库服务器内运行。此行为与SQL * Loader不同，后者是一个客户端程序，用于将要加载的数据发送到服务器。这种差异具有以下含义：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>服务器需要访问访问驱动程序可以加载的文件。</p>
                     </li>
                     <li>
                        <p>服务器必须创建和写入访问驱动程序创建的输出文件：日志文件，错误文件，丢弃文件以及<code class="codeph">ORACLE_DATAPUMP</code>访问驱动程序创建的任何转储文件。
                        </p>
                     </li>
                  </ul>
                  <p>要指定读取和写入文件的位置，访问驱动程序要求您使用目录对象。目录对象将名称映射到文件系统上的目录名称。例如，以下语句创建一个名为<code class="codeph">ext_tab_dir</code>的目录对象，该对象映射到位于<code class="codeph">/usr/apps/datafiles.</code></p><pre class="oac_no_warn" dir="ltr">CREATE DIRECTORY ext_tab_dir AS'/ usr / apps / datafiles';</pre><p>DBA或任何用户都可以使用<code class="codeph">CREATE</code> <code class="codeph">ANY</code> <code class="codeph">DIRECTORY</code>权限创建目录对象。
                  </p>
                  <div class="infoboxnote" id="GUID-05AA7C84-2C2D-45CE-8F52-392D4A2B4864__GUID-92D64368-0498-4BCD-AAF8-D4F444B61A6C">
                     <p class="notep1">注意：</p>
                     <p>要在Oracle Real Applications Cluster（Oracle RAC）配置中使用外部表，必须确保目录对象路径位于群集范围的文件系统上。</p>
                  </div>
                  <p>创建目录后，创建目录对象的用户必须将该目录的<code class="codeph">READ</code>和<code class="codeph">WRITE</code>权限授予其他用户。必须显式授予这些特权，而不是使用角色分配。例如，要允许服务器代表<code class="codeph">ext_tab_dir</code>指定的目录中的用户<code class="codeph">scott</code>读取文件，创建目录对象的用户必须执行以下命令：</p><pre class="oac_no_warn" dir="ltr">GRANT READ ON DIRECTORY ext_tab_dir TO scott;</pre><p><code class="codeph">SYS</code>用户是唯一可以拥有目录对象的用户，但<code class="codeph">SYS</code>用户可以授予其他用户创建目录对象的权限。对目录对象的<code class="codeph">READ</code>或<code class="codeph">WRITE</code>权限仅表示Oracle数据库代表您读取或写入该文件。除非您具有相应的操作系统权限，否则不能直接访问Oracle数据库之外的那些文件。同样，Oracle数据库需要操作系统的许可才能读取和写入目录中的文件。
                  </p>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="oracle-external-tables-concepts.html#GUID-44323E01-7D72-45EC-915A-99E596769D9E" title="外部表功能是对现有SQL * Loader功能的补充。它使您可以访问外部源中的数据，就像它在数据库中的表中一样。">外部表概念</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="SUTIL1358"></a><div class="props_rev_3"><a id="GUID-07D30CE6-128D-426F-8B76-B13E1C53BD5A" name="GUID-07D30CE6-128D-426F-8B76-B13E1C53BD5A"></a><h3 id="SUTIL-GUID-07D30CE6-128D-426F-8B76-B13E1C53BD5A" class="sect3"><span class="enumeration_section">14.3</span>外部表的访问参数</h3>
               <div>
                  <p>要修改外部表的访问驱动程序的默认行为，请指定访问参数。</p>
                  <p>创建特定类型的外部表时，可以指定访问参数以修改访问驱动程序的默认行为。每个访问驱动程序都有自己的访问参数语法。Oracle提供以下访问驱动程序以用于外部表： <code class="codeph">ORACLE_LOADER</code> ， <code class="codeph">ORACLE_DATAPUMP</code> ， <code class="codeph">ORACLE_HDFS</code>和<code class="codeph">ORACLE_HIVE</code> 。</p>
                  <div class="infoboxnote" id="GUID-07D30CE6-128D-426F-8B76-B13E1C53BD5A__GUID-A53BD2B8-51CE-478E-B02A-B0D8B1BA9542">
                     <p class="notep1">注意：</p>
                     <p>这些访问参数统称为SQL <code class="codeph">CREATE TABLE...的<code class="codeph">opaque_format_spec</code> <code class="codeph">CREATE TABLE...ORGANIZATION EXTERNAL</code>声明。
                     </p>
                  </div>
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-07D30CE6-128D-426F-8B76-B13E1C53BD5A__GUID-195C9544-02C6-4F63-B2A2-9586DD340712">
                     <p class="notep1">也可以看看：</p>
                     <p></p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="oracle_loader-access-driver.html#GUID-EA56D498-E8BB-4E02-8ABF-12E7083ED9D5" title="ORACLE_LOADER访问驱动程序提供了一组对ORACLE_LOADER类型的外部表唯一的访问参数。">ORACLE_LOADER访问驱动程序</a></p>
                        </li>
                        <li>
                           <p><a href="oracle_datapump-access-driver.html#GUID-084DC623-9656-499C-885B-D8180C07704B" title="ORACLE_DATAPUMP访问驱动程序提供一组访问参数，这些参数对于ORACLE_DATAPUMP类型的外部表是唯一的。">ORACLE_DATAPUMP访问驱动程序</a></p>
                        </li>
                        <li>
                           <p><a href="oracle_hdfs-oracle_hive-access-drivers.html#GUID-597D7F45-D37F-49CE-A7E5-C92C7D707AE9" title="用于创建使用ORACLE_HDFS或ORACLE_HIVE访问驱动程序的外部表的属性在SQL CREATE TABLE ORGANIZATION EXTERNAL语句中的ACCESS PARAMETERS的opaque_format_spec子句中指定。">ORACLE_HDFS和ORACLE_HIVE访问驱动程序</a></p>
                        </li>
                        <li>
                           <p>有关在使用SQL <code class="codeph">CREATE TABLE</code>语句时指定<code class="codeph">opaque_format_spec</code>信息，请<a href="../sqlrf/CREATE-TABLE.html#SQLRF01402" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="oracle-external-tables-concepts.html#GUID-44323E01-7D72-45EC-915A-99E596769D9E" title="外部表功能是对现有SQL * Loader功能的补充。它使您可以访问外部源中的数据，就像它在数据库中的表中一样。">外部表概念</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="SUTIL1365"></a><div class="props_rev_3"><a id="GUID-7AB423F1-C688-4A1C-A940-77C221839BCA" name="GUID-7AB423F1-C688-4A1C-A940-77C221839BCA"></a><h3 id="SUTIL-GUID-7AB423F1-C688-4A1C-A940-77C221839BCA" class="sect3"><span class="enumeration_section">14.4</span>外部表使用期间的数据类型转换</h3>
               <div>
                  <p>读取外部表时以及写入外部表时可能会发生转换错误。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-7AB423F1-C688-4A1C-A940-77C221839BCA__GUID-B7E4AA53-3D5A-4D82-8D0D-AEB1E9901C8F">读取外部表时的转换错误</p>
                     <p>从外部表中选择行时，访问驱动程序将执行任何必要的转换，以使数据源中的数据与外部表中相应列的数据类型相匹配。根据所需的数据和转换类型，转换可能会遇到错误。</p>
                     <p>为了说明从外部表读取时可能发生的数据转换问题的类型，假设您创建以下外部表<code class="codeph">KV_TAB_XT</code>其中包含两列：数据类型为<code class="codeph">VARCHAR2(4)</code> <code class="codeph">KEY</code>和数据类型为<code class="codeph">NUMBER</code> <code class="codeph">VAL</code> 。</p><pre class="pre codeblock"><code>SQL&gt; CREATE TABLE KV_TAB_XT（KEY，VARCHAR2（4），VAL NUMBER）2 ORGANIZATION EXTERNAL 3（DEFAULT DIRECTORY DEF_DIR1 LOCATION（'key_val.csv'））;</code></pre><p>外部表<code class="codeph">KV_TAB_XT</code>使用访问参数的默认值，这意味着：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>记录由新行分隔。</p>
                        </li>
                        <li>
                           <p>数据文件和数据库具有相同的字符集。</p>
                        </li>
                        <li>
                           <p>数据文件中的字段具有相同的名称，并且与外部表中的列的顺序相同。</p>
                        </li>
                        <li>
                           <p>字段的数据类型是<code class="codeph">CHAR(255)</code> 。
                           </p>
                        </li>
                        <li>
                           <p>每个字段的数据以逗号结束。</p>
                        </li>
                     </ul>
                     <p><code class="codeph">KV_TAB_XT</code>外部表的数据文件中的记录应为：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>一个字符串，最长4个字节。如果字符串为空，则该字段的值为<code class="codeph">NULL</code> 。</p>
                        </li>
                        <li>
                           <p>终止逗号。</p>
                        </li>
                        <li>
                           <p>一串数字字符。如果字符串为空，则此字段的值为<code class="codeph">NULL</code> 。</p>
                        </li>
                        <li>
                           <p>可选的终止逗号。</p>
                        </li>
                     </ul>
                     <p>当访问驱动程序从数据文件中读取记录时，它会验证数据文件中<code class="codeph">KEY</code>字段的值的长度是否小于或等于4，并且它尝试转换数据中<code class="codeph">VAL</code>字段的值文件到Oracle号码。
                     </p>
                     <p>如果<code class="codeph">KEY</code>字段的值的长度大于4，或者<code class="codeph">VAL</code>的值中存在非数字字符，则<code class="codeph">ORACLE_LOADER</code>访问驱动程序拒绝该行，这会导致写入该行的行的副本文件和写入日志文件的错误消息。
                     </p>
                     <p>所有访问驱动程序都必须处理来自外部表的源的字段的数据类型的转换以及外部表的列的数据类型。以下是访问驱动程序执行的转换和检查类型的一些示例：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>将字符数据从源数据使用的字符集转换为数据库使用的字符集。</p>
                        </li>
                        <li>
                           <p>从字符数据转换为数字数据。</p>
                        </li>
                        <li>
                           <p>从数字数据转换为字符数据。</p>
                        </li>
                        <li>
                           <p>从字符数据转换为日期或时间戳。</p>
                        </li>
                        <li>
                           <p>从日期或时间戳转换为字符数据。</p>
                        </li>
                        <li>
                           <p>从字符数据转换为间隔数据类型。</p>
                        </li>
                        <li>
                           <p>从间隔数据类型转换为字符数据。</p>
                        </li>
                        <li>
                           <p>验证字符列的数据值长度是否超过该列的长度限制。</p>
                        </li>
                     </ul>
                     <p>当访问驱动程序遇到执行所需转换或验证的错误时，它可以决定如何处理错误。当<code class="codeph">ORACLE_LOADER</code>和<code class="codeph">ORACLE_DATAPUMP</code>访问驱动程序遇到错误时，它们会拒绝该记录并将错误消息写入日志文件。就好像该记录不在数据源中。当<code class="codeph">ORACLE_HDFS</code>和<code class="codeph">ORACLE_HIVE</code>访问驱动程序遇到错误时，遇到错误的字段的值将设置为NULL。这与Hive如何处理Hadoop中的错误的行为一致。
                     </p>
                     <p>即使访问驱动程序已从数据源转换数据以匹配外部表列的数据类型，访问外部表的SQL语句也可能需要其他数据类型转换。如果任何这些额外的转换遇到错误，则整个语句将失败。（例外情况是，如果您使用SQL语句中的DML错误日志记录功能来处理这些错误。）这些转换与执行SQL语句时通常需要的转换相同。例如，假设您更改的定义<code class="codeph">KV_TAB_XT</code>外部表只具有字符数据类型的列，然后执行<code class="codeph">INSERT</code>语句从外部表将数据加载到具有另一个表<code class="codeph">NUMBER</code>列数据类型<code class="codeph">VAL</code> ：</p><pre class="pre codeblock"><code>SQL&gt; CREATE TABLE KV_TAB_XT（KEY VARCHAR2（20），VAL VARCHAR2（20））2 ORGANIZATION EXTERNAL 3（DEFAULT DIRECTORY DEF_DIR1 LOCATION（'key_val.csv'））; 4 CREATE TABLE KV_TAB（KEY VARCHAR2（4），VAL NUMBER）; 5插入KV_TAB SELECT * FROM KV_TAB_XT;</code></pre><p>在此示例中，如果<code class="codeph">VAL</code>的数据包含非数字字符，则访问驱动程序不会拒绝记录，因为外部表中<code class="codeph">VAL</code>的数据类型现在为<code class="codeph">VARCHAR2</code> （而不是<code class="codeph">NUMBER</code> ）。但是，SQL执行现在需要处理从<code class="codeph">KV_TAB_XT</code>字符数据类型到<code class="codeph">KV_TAB_XT</code>中的数字数据类型的<code class="codeph">KV_TAB</code> 。如果外部表中<code class="codeph">VAL</code>的值中存在非数字字符，则SQL会引发转换错误并回滚所有已插入的行。为避免SQL执行中的转换错误，请尝试使外部表中列的数据类型与将使用这些列的值的其他表或函数所期望的数据类型相匹配。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-7AB423F1-C688-4A1C-A940-77C221839BCA__GUID-5F43FDDF-21F7-4131-9085-CB1DEE6D2D57">写入外部表时的转换错误</p>
                     <p><code class="codeph">ORACLE_DATAPUMP</code>访问驱动程序允许您使用<code class="codeph">CREATE TABLE AS SELECT</code>语句将数据卸载到外部表中。如果<code class="codeph">SELECT</code>表达式中列的数据类型与外部表中列的数据类型不匹配，则会发生数据转换。如果SQL遇到转换数据类型的错误，则SQL将中止该语句，并且数据文件将不可读。
                     </p>
                     <p>为避免导致操作失败的转换错误问题，外部表中列的数据类型应与用于写入外部表的源表或表达式中的列的数据类型相匹配。这并不总是可行的，因为外部表不支持所有数据类型。在这些情况下，必须将源表中不受支持的数据类型转换为外部表可以支持的数据类型。以下<code class="codeph">CREATE TABLE</code>语句显示了以下示例：</p><pre class="pre codeblock"><code>CREATE TABLE LONG_TAB_XT（LONG_COL CLOB）组织外部...从LONG_TAB中选择TO_LOB（LONG_COL）;</code></pre><p>名为<code class="codeph">LONG_TAB</code>的源表具有<code class="codeph">LONG</code>列，因此正在创建的外部表中的相应列<code class="codeph">LONG_TAB_XT</code>必须是<code class="codeph">CLOB</code> ，并且用于填充外部表的<code class="codeph">SELECT</code>子查询必须使用<code class="codeph">TO_LOB</code>运算符来加载列。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="oracle-external-tables-concepts.html#GUID-44323E01-7D72-45EC-915A-99E596769D9E" title="外部表功能是对现有SQL * Loader功能的补充。它使您可以访问外部源中的数据，就像它在数据库中的表中一样。">外部表概念</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>