<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="The requirements for Oracle ACFS snapshot-based replication are discussed in this section.">
      <meta name="description" content="The requirements for Oracle ACFS snapshot-based replication are discussed in this section.">
      <title>Configuring Oracle ACFS Snapshot-Based Replication</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Administrator's Guide">
      <meta property="og:description" content="The requirements for Oracle ACFS snapshot-based replication are discussed in this section.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Administrator's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="automatic-storage-management-administrators-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-04-23T18:56:15-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="2007, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96198-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="acfs-advanced-topics.html" title="Previous" type="text/html">
      <link rel="next" href="manage-flex-asm.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Automatic Storage Management Administrator's Guide">
    <meta name="dcterms.isVersionOf" content="OSTMG">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="acfs-advanced-topics.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="manage-flex-asm.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Administrator's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-advanced-topics.html" property="item" typeof="WebPage"><span property="name">Advanced Topics</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Configuring Oracle ACFS Snapshot-Based Replication</li>
            </ol>
            <a id="GUID-1BB7CD34-399B-496C-B458-DA3E68F48D31" name="GUID-1BB7CD34-399B-496C-B458-DA3E68F48D31"></a>
            
            <h2 id="OSTMG-GUID-1BB7CD34-399B-496C-B458-DA3E68F48D31" class="sect2"><span class="enumeration_chapter">18 </span>Configuring Oracle ACFS Snapshot-Based Replication
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>The requirements for Oracle ACFS snapshot-based replication are discussed in this section.</p>
               <p>This chapter describes how to configure Oracle ACFS snapshot-based replication available with release 12.2 or higher. As with Oracle ACFS replication installations before release 12.2, the overall functional goal of snapshot-based replication is to ensure that updates from a primary cluster are replicated to a standby cluster. However, the snapshot based replication technology uses snapshots of the primary storage location and transfers the differences between successive snapshots to the standby storage location using the standard <code class="codeph">ssh</code> command. Oracle ACFS replication functionality before release 12.2 replicated changes continuously, building on Oracle networking technologies, notably Network Foundation Technologies (NFT), to ensure connectivity between the primary and standby clusters.
               </p>
               <p>This change in the design and implementation of Oracle ACFS replication introduces some differences in how replication is configured and used. For example, the use of <code class="codeph">ssh</code> requires setting up host and user keys appropriately on the primary and standby nodes where replication is performed. 
               </p>
               <p>Oracle ACFS replication also provides a role reversal capability that you can configure by enabling both the primary cluster and the standby cluster to communicate with the other as required. In role reversal, the standby assumes the role of the primary and the primary becomes the standby.</p>
               <p>This chapter contains the following topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="configure-acfs-replication.html#GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4">Configuring ssh for Use With Oracle ACFS Replication</a></p>
                  </li>
                  <li>
                     <p><a href="configure-acfs-replication.html#GUID-D2CADB0B-E03D-4576-90DD-F1214362798D">Installing ssh and Cygwin on Windows</a></p>
                  </li>
                  <li>
                     <p><a href="configure-acfs-replication.html#GUID-990E0BAF-AD12-4DB2-9423-AE8DE4A121D7">Upgrading to Oracle ACFS Snapshot-Based Replication</a></p>
                  </li>
               </ul>
               <p>For an overview of Oracle ACFS replication, refer to <a href="understand-acfs-admin.html#GUID-8522E0B6-BE6E-4BE3-B7C7-5EA2ED4A602C" title="Oracle ACFS snapshot-based replication enables replication of Oracle ACFS file systems across a network to a remote site, providing disaster recovery capability for the file system.">Oracle ACFS Replication</a>. For information about Oracle ACFS replication commands, refer to <a href="acfs-commands-replication.html#GUID-F40FA4A4-2ED0-461F-A1E0-5F886DA7FC0A" title="This topic provides a summary of the commands for Oracle ACFS snapshot-based replication.">Oracle ACFS Command-Line Tools for Replication</a>.
               </p>
            </div>
            <div class="sect2"><a id="GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4" name="GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4"></a><h3 id="OSTMG-GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4" class="sect3">Configuring ssh for Use With Oracle ACFS Replication</h3>
               <div>
                  <p>This topic describes how to configure <code class="codeph">ssh</code> for use by Oracle ACFS snapshot-based replication available with release 12.2 or higher.
                  </p>
                  <p>Oracle ACFS snapshot-based replication uses <code class="codeph">ssh</code> as the transport between the primary and standby clusters. To support the full capabilities of replication, <code class="codeph">ssh</code> must be usable in either direction between the clusters — from the primary cluster to the standby cluster and from the standby to the primary.
                  </p>
                  <p>The procedures in this topic describe how to configure <code class="codeph">ssh</code> for replication in one direction — from the primary to the standby. To configure <code class="codeph">ssh</code> completely, you must perform the instructions a second time with the primary and standby roles reversed. When you perform the instructions the first time, complete the steps as written for the primary cluster and the standby cluster. The second time, reverse the primary and standby roles. Perform the steps marked as necessary on the <span class="italic">primary</span> cluster on your standby cluster and perform the steps marked as necessary on the <span class="italic">standby</span> cluster on your primary cluster. The procedures that must be performed twice are described in:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="configure-acfs-replication.html#GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__CHOOSINGANORACLEACFSREPLICATIONUSER-04CFEE35">Choosing an Oracle ACFS replication user</a></p>
                     </li>
                     <li>
                        <p><a href="configure-acfs-replication.html#GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__DISTRIBUTINGKEYSFORORACLEACFSREPLIC-0530A539">Distributing keys for Oracle ACFS replication</a></p>
                     </li>
                     <li>
                        <p><a href="configure-acfs-replication.html#GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__GETTINGAPUBLICKEYFORROOTFROMTHEPRIM-052F3C38">Getting a public key for root from the primary cluster</a></p>
                     </li>
                     <li>
                        <p><a href="configure-acfs-replication.html#GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__GETTINGHOSTKEYSFORTHESTANDBYCLUSTER-052F3FCF">Getting host keys for the standby cluster</a></p>
                     </li>
                     <li>
                        <p><a href="configure-acfs-replication.html#GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__NOTESONPERMISSIONSFORSSH-RELATEDFIL-052F42E6">Notes on permissions for ssh-related files</a></p>
                     </li>
                     <li>
                        <p><a href="configure-acfs-replication.html#GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__NOTESONSSHDCONFIGURATION-052F45A9">Notes on sshd configuration</a></p>
                     </li>
                  </ul>
                  <p>After you have completed all the necessary procedures, you can use the instructions described in <a href="configure-acfs-replication.html#GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__VALIDATINGYOURSSH-RELATEDKEYCONFIGU-052F498A">Validating your ssh-related key configuration</a> to confirm that you have configured <code class="codeph">ssh</code> correctly in both directions.
                  </p>
                  <div class="section" id="GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__CHOOSINGANORACLEACFSREPLICATIONUSER-04CFEE35">
                     <p class="subhead2" id="GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__GUID-E1D91EB6-3D57-48DA-957B-43D004839291">Choosing an Oracle ACFS replication user</p>
                     <p>Oracle ACFS snapshot-based replication uses <code class="codeph">ssh</code> as the transport between the primary and standby clusters, so the user identity under which replication is performed on the standby must be carefully managed. In the replication process, the <code class="codeph">root</code> user (or local <code class="codeph">SYSTEM</code> on Windows) on the primary node where replication is running uses <code class="codeph">ssh</code> to log in to the standby node involved in replication. 
                     </p>
                     <p>Because it is not advisable for <code class="codeph">ssh</code> to log in as <code class="codeph">root</code> on the standby node, a minimally-privileged user identity should be used. The user chosen should have Oracle ASM administration privileges. Usually, the user specified to the Oracle installer when the Oracle software was first installed belongs to the needed groups, so can be convenient to choose as the replication user. In this discussion, the replication user is identified as <span class="italic">repluser</span>; however, you would replace <span class="italic">repluser</span> with the actual user name that you have selected. For information about user privileges for Oracle ASM, refer to <a href="authenticate-access-asm-instance.html#GUID-7396FD18-628B-4026-AA55-79C6D6205EAE">About Privileges for Oracle ASM</a>. For information about running Oracle ACFS <code class="codeph">acfsutil</code> commands, refer to <a href="steps-manage-acfs.html#GUID-FA9F9335-ADA4-48D1-B060-6F096E3BAE6C" title="This topic provides an overview of the use of Oracle ACFS acfsutil commands.">About Using Oracle ACFS Command-Line Tools</a>.
                     </p>
                     <div class="infoboxnote" id="GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__GUID-5D336002-E430-4C35-A4A6-E8092C4E2ECD">
                        <p class="notep1">Note:</p>
                        <p> The same user and group identities must be specified for <span class="italic">repluser</span> on both your primary cluster and your standby cluster. Additionally, the mappings between user names and numeric <code class="codeph">uids</code>, and between group names and numeric <code class="codeph">gids</code>, must be identical on both the primary cluster and the standby cluster.&nbsp;This is required to ensure that the numeric values are used in the same manner on both clusters because replication transfers only the numeric values from the primary to standby.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__DISTRIBUTINGKEYSFORORACLEACFSREPLIC-0530A539">
                     <p class="subhead2" id="GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__GUID-C4685F1C-426C-4492-A882-191B7993F60D">Distributing keys for Oracle ACFS replication</p>
                     <p>The process of distributing keys for Oracle ACFS replication includes getting a public key from the primary cluster, getting host keys for the standby cluster, ensuring permissions are configured properly for <code class="codeph">ssh</code>-related files, configuring <code class="codeph">sshd</code> as necessary, and lastly validating the <code class="codeph">ssh</code> configuration.
                     </p>
                     <div class="infoboxnote" id="GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__GUID-DF9DC152-83DC-4DFA-A5CE-DA276608CB11">
                        <p class="notep1">Note:</p>
                        <p>When creating host keys, ensure that you create keys for both fully-qualified domain hostnames and the local hostnames.</p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__GETTINGAPUBLICKEYFORROOTFROMTHEPRIM-052F3C38">
                     <p class="subhead2" id="GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__GUID-F03646CD-F88D-4CD6-9342-F3B8C34C2222">Getting a public key for root from the primary cluster</p>
                     <p>A public key for <code class="codeph">root</code> defined on each node of your primary cluster must be known to <span class="italic">repluser</span> on each node of your standby cluster.
                     </p>
                     <p>To make the key known, the directory <code class="codeph">~repluser/.ssh</code> must exist on each standby node. If this directory does not exist, then create it with access only for <span class="italic">repluser</span>. Ensure that an <code class="codeph">ls</code> command for the <code class="codeph">.ssh</code> directory displays output similar to:
                     </p><pre class="oac_no_warn" dir="ltr">repluser@standby $ ls -ld ~/.ssh
drwx------ 2 repluser dba 4096 Jan 27 17:01 .ssh</pre><p>If a public key for <code class="codeph">root</code> is defined on a given primary node, then it resides in a <code class="codeph">.pub</code> file, such as <code class="codeph">/root/.ssh/id_rsa.pub</code>.  If a public key file exists, then add its contents to the set of keys authorized to log in as <span class="italic">repluser</span> on each node of the standby where replication is run. Append the key to the file <code class="codeph">~repluser/.ssh/authorized_keys2</code> on each standby node, creating this file if necessary.
                     </p>
                     <p>If a public key file does not exist, generate a public and private key pair on the primary by running the following command as <code class="codeph">root</code>.
                     </p><pre class="oac_no_warn" dir="ltr"># ssh-keygen -t rsa</pre><p>You can press the enter key in response to each prompt issued by the command. Copy the resulting <code class="codeph">.pub</code> file to each standby node.
                     </p>
                     <p>You have the option to share the same public/private key pair for <code class="codeph">root</code> across all of the nodes in your primary cluster, or to establish a different key pair for each primary node. If the same public key is valid for <code class="codeph">root</code> across all nodes in your primary cluster, then only that key must be added to the file <code class="codeph">~repluser/.ssh/authorized_keys2</code> on each node of your standby cluster. If each primary node has its own public key for <code class="codeph">root</code>, then all the public keys must be added to the file. In either case, you can minimize work by copying the updated <code class="codeph">authorized_keys2</code> file on a given node of the standby to the other nodes of the cluster. 
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__GETTINGHOSTKEYSFORTHESTANDBYCLUSTER-052F3FCF">
                     <p class="subhead2" id="GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__GUID-C78516CB-C930-469E-8ED1-45CEF5A17F1B">Getting host keys for the standby cluster</p>
                     <p>A host key for each standby node where replication may run must be known on each primary node where replication may run. One way to generate the correct key is to run <code class="codeph">ssh</code> manually as <code class="codeph">root</code> from each primary node to each standby node. If the correct host key is not known already, then a warning displays and you can enable <code class="codeph">ssh</code> to add the key.  
                     </p>
                     <p>Note that there are two users involved in the <code class="codeph">ssh</code> connection. While <code class="codeph">ssh</code> on the primary node connects to the standby node as <code class="codeph">root</code>, <code class="codeph">ssh</code> logs in on the standby node as <span class="italic">repluser</span>. Any command run by <code class="codeph">ssh</code> on the standby runs with the privileges of <span class="italic">repluser</span>, not with <code class="codeph">root</code> privileges.  
                     </p>
                     <p>Because the primary node connects to the standby node as user <code class="codeph">root</code>, the host key for the standby node must be added to the <code class="codeph">known_hosts</code> file of the <code class="codeph">root</code> user, not the file for <span class="italic">repluser</span>. The following is an example of obtaining a host key:
                     </p><pre class="oac_no_warn" dir="ltr">[root@primary usm]# ssh repluser@standby date
The authenticity of host 'standby (10.137.13.85)' can't be established.
RSA key fingerprint is 1b:a9:c6:68:47:b4:ec:7c:df:3a:f0:2a:6f:cf:a7:0a.
Are you sure you want to continue connecting (yes/no)?</pre><p>If you respond with <code class="codeph">yes</code>, then the <code class="codeph">ssh</code> setup is complete. A host key for host standby is stored in the <code class="codeph">known_hosts</code> file (<code class="codeph">~root/.ssh/known_hosts</code>) on the host <span class="italic">primary</span> for the user <code class="codeph">root</code>. 
                     </p>
                     <p>After the host key setup for standby nodes is complete on a given primary node, you need to perform an additional step if you use a Virtual IP address (VIP) to communicate with your standby cluster. You must add the VIP name or address at the start of each line of the <code class="codeph">known_hosts</code> file that refers to a host in the standby cluster. For example, if you use a VIP with the name <code class="codeph">standby12_vip</code>, and your <code class="codeph">known_hosts</code> file contains the following two lines that refer to your standby:
                     </p><pre class="oac_no_warn" dir="ltr">standby1,10.242.20.22 ssh-rsa
AAAAB3NzaC1yc2EAAAADAQABAAABAQC3pM2YTd4UUiEWEoCKDGgaTgsmPkQToDrdtU+JtVIq/96muivU
BaJUK83aqzeNIQkh+hUULsUdgKoKT5bxrWYqhY6AlTEqNgBHjBrJt9C73BbQd9y48jsc2G+WQWyuI/
+s1Q+hIJdBNMxvMBQAfisPWWUcaIx9Y/JzlPgF6lRP2cbfqAzixDot9fqRrAKL3G6A75A/6TbwmEW07d1zqOv
l7ZGyeDYf5zQ72F/V0P9UgMEt/5DmcYTn3kTVGjOTbnRBe4A4lY4rVw5c+nZBDFre66XtORfQgwQB5ztW/Pi
08GYbcIszKoZx2HST9AZxYIAgcrnNYG2Ae0K6QLxxxScP
standby2,10.242.20.23 ssh-rsa
AAAAB3NzaC1yc2EAAAADAQABAAABAQDIszcjzNtKN03SY8Kl846skFTVP1HF/ykswbmkctEjL6KTWTW+NR
U4MGbvkBqqdXxuPCR7aoGO2U3PEOg1UVf3DWUoux8IRvqKU+dJcdTibMFkDAIhTnzb14gZ/lRTjn+GYsuP5
Qz2vgL/U0ki887mZCRjWVL1b5FNH8sXBUV2QcD7bjF98VXF6n4gd5UiIC3jv6l2nVTKDwtNHpUTS1dQAi+1D
tr0AieZTsuxXMaDdUZHgKDotjciMB3mCkKm/u3IFoioDqdZE4+vITX9G7DBN4CVPXawp+b5Kg8X9P+08Eehu
tMlBJ5lafy1bxoVlXUDLVIIFBJNKrsqBvxxxpS7</pre><p>To enable the use of the VIP, you would modify these two lines to read as follows:</p><pre class="oac_no_warn" dir="ltr">
<span class="bold">standby12_vip,standby1,10.242.20.22 ssh-rsa</span>
AAAAB3NzaC1yc2EAAAADAQABAAABAQC3pM2YTd4UUiEWEoCKDGgaTgsmPkQToDrdtU+JtVIq/96muivU
BaJUK83aqzeNIQkh+hUULsUdgKoKT5bxrWYqhY6AlTEqNgBHjBrJt9C73BbQd9y48jsc2G+WQWyuI/
+s1Q+hIJdBNMxvMBQAfisPWWUcaIx9Y/JzlPgF6lRP2cbfqAzixDot9fqRrAKL3G6A75A/6TbwmEW07d1zqOv
l7ZGyeDYf5zQ72F/V0P9UgMEt/5DmcYTn3kTVGjOTbnRBe4A4lY4rVw5c+nZBDFre66XtORfQgwQB5ztW/Pi
08GYbcIszKoZx2HST9AZxYIAgcrnNYG2Ae0K6QLxxxScP
<span class="bold">standby12_vip,standby2,10.242.20.23 ssh-rsa</span>
AAAAB3NzaC1yc2EAAAADAQABAAABAQDIszcjzNtKN03SY8Kl846skFTVP1HF/ykswbmkctEjL6KTWTW+NR
U4MGbvkBqqdXxuPCR7aoGO2U3PEOg1UVf3DWUoux8IRvqKU+dJcdTibMFkDAIhTnzb14gZ/lRTjn+GYsuP5
Qz2vgL/U0ki887mZCRjWVL1b5FNH8sXBUV2QcD7bjF98VXF6n4gd5UiIC3jv6l2nVTKDwtNHpUTS1dQAi+1D
tr0AieZTsuxXMaDdUZHgKDotjciMB3mCkKm/u3IFoioDqdZE4+vITX9G7DBN4CVPXawp+b5Kg8X9P+08Eehu
tMlBJ5lafy1bxoVlXUDLVIIFBJNKrsqBvxxxpS7</pre><p>Ultimately, the host key configuration performed on this first node of your primary cluster must be performed on every node in your primary cluster; the result of the above sequence, or an equivalent, must exist on each primary node. One way to minimize the manual effort required to achieve this configuration is to update the <code class="codeph">known_hosts</code> file on one node of the primary cluster, then copy the updated file to the other nodes of the cluster.  
                     </p>
                     <div class="infoboxnote" id="GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__GUID-5E9BEBF3-D353-4C3C-B343-DA65EE35014C">
                        <p class="notep1">Note:</p>
                        <p>By default, replication enables strict host key checking by <code class="codeph">ssh</code>, to ensure that the primary node connects to the intended standby node or cluster when it runs <code class="codeph">ssh</code>. However, if you are certain that this checking is unneeded, such as the case when the primary and standby clusters communicate over a private network, the use of strict host key checking by <code class="codeph">ssh</code> can be disabled. For information about disabling strict host key checking, refer to the <code class="codeph">-o sshStrictKey=no</code> option of the <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">init</code> <code class="codeph">primary</code> command. If strict host key checking is disabled, then no host key setup is required. For information about the <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">init</code> command, refer to <a href="acfs-commands-replication.html#GUID-E96CD9A2-00BD-4673-8FCC-DBB28A9E2DCD">acfsutil repl init</a>.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__NOTESONPERMISSIONSFORSSH-RELATEDFIL-052F42E6">
                     <p class="subhead2" id="GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__GUID-D427A8C6-7947-4CDB-83E6-F3CF53E79D5D">Notes on permissions for ssh-related files</p>
                     <p>For <code class="codeph">ssh</code> to work with the keys you have established, you must ensure that permissions are set properly on each node for the relevant <code class="codeph">.ssh</code> directory and some of the files the directory contains. On each primary node, this refers to the <code class="codeph">.ssh</code> directory for <code class="codeph">root</code>. On each standby node, the <code class="codeph">.ssh</code> directory to check is the one for <span class="italic">repluser</span>. 
                     </p>
                     <p>For details on the permissions that should be given to each <code class="codeph">.ssh</code> directory and key files within the directory, refer to the documentation for your <code class="codeph">ssh</code> implementation, such as the <code class="codeph">FILES</code> section of the <code class="codeph">ssh(1)</code> manual page.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__NOTESONSSHDCONFIGURATION-052F45A9">
                     <p class="subhead2" id="GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__GUID-02ED30E2-D4F1-4C24-A449-B7264C02A287">Notes on sshd configuration</p>
                     <p>After you begin using replication, <code class="codeph">ssh</code> is started frequently to perform replication operations. On some platforms, the <code class="codeph">ssh</code> daemon <code class="codeph">sshd</code> may be configured to log a message through <code class="codeph">syslog</code> or a similar facility each time an <code class="codeph">ssh</code> connection is established. To avoid this, the server configuration file <code class="codeph">/etc/ssh/sshd_config</code> can be modified to specify a lower frequency of logging. The parameter that controls logging is called <code class="codeph">LogLevel</code>. Connection messages are issued at level <code class="codeph">INFO</code>. Any lower <code class="codeph">LogLevel</code> setting, such as <code class="codeph">ERROR</code>, suppresses those messages. For example, you can suppress log messages by adding the following line to the file: 
                     </p><pre class="oac_no_warn" dir="ltr">LogLevel ERROR</pre></div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__VALIDATINGYOURSSH-RELATEDKEYCONFIGU-052F498A">
                     <p class="subhead2" id="GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4__GUID-FEA106F4-08E5-4326-A329-894F45B09935">Validating your ssh-related key configuration</p>
                     <p>After you have established the host and user keys for <code class="codeph">ssh</code> on both your primary and your standby clusters, you can use the command <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">info</code> <code class="codeph">-c</code> <code class="codeph">-u</code> to validate the keys. You run this command as <code class="codeph">root</code> on each node of each cluster. It takes as arguments all the hostnames or addresses on the remote cluster that the local cluster may use in the future to perform replication. 
                     </p>
                     <p>If you are not using a VIP to connect to your remote cluster, then for a given replication relationship, only one remote hostname or address is provided to <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">init</code> <code class="codeph">primary</code>. However, if future relationships involve other remote host addresses, specify the complete set of remote addresses when running the <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">info</code> <code class="codeph">-c</code> <code class="codeph">-u</code> command. 
                     </p>
                     <p>If you are using a VIP to connect to your remote cluster, then you should specify the names or host-specific addresses of all remote hosts on which the VIP may be active. Do not specify the VIP name or an address associated with the VIP. When replication uses <code class="codeph">ssh</code> to connect to a VIP, the host key returned is the key associated with the host where the VIP is currently active. Only the hostnames or addresses of individual remote nodes are used by <code class="codeph">ssh</code> in this situation.
                     </p>
                     <p>The validation command to run on each node of your primary cluster has the following format:</p><pre class="oac_no_warn" dir="ltr"># acfsutil repl info -c -u repluser standby1 [standby2 …] standby-mountpoint
</pre><p>In the command, <code class="codeph">standby<span class="codeinlineitalic">n</span></code> specifies the standby cluster hostname or address. The validation command confirms that user <span class="italic">repluser</span> can use <code class="codeph">ssh</code> to connect to each standby hostname or address given, in the same manner as replication initialization. Use the same command format if you are using a VIP, such as <code class="codeph">standby12_vip</code>, to connect to the cluster. Do not specify the name of the VIP.
                     </p>
                     <p></p>
                     <p>If you plan to disable strict host key checking, you can skip this checking by adding the <code class="codeph">-o sshStrictKey=no</code> option to the command line.
                     </p>
                     <p>After you have confirmed that each node of your primary cluster can connect to all nodes of your standby cluster, run the validation command again. This time run the command on each node of your standby cluster. Specify a hostname or IP address for all nodes of your primary cluster using the following format:</p><pre class="oac_no_warn" dir="ltr"># acfsutil repl info -c -u repluser primary1 [primary2 ...] primary-mountpoint</pre><p>In the command, <code class="codeph">primary<span class="codeinlineitalic">n</span></code> specifies the primary cluster hostname or address. 
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-D2CADB0B-E03D-4576-90DD-F1214362798D" name="GUID-D2CADB0B-E03D-4576-90DD-F1214362798D"></a><h3 id="OSTMG-GUID-D2CADB0B-E03D-4576-90DD-F1214362798D" class="sect3">Installing ssh and Cygwin on Windows</h3>
               <div>
                  <p>This section describes how to install Cygwin and start the <code class="codeph">ssh</code> daemon on Microsoft Windows hosts. This information is only applicable when you want to use Oracle ACFS snapshot-based replication on a Windows host.
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-D2CADB0B-E03D-4576-90DD-F1214362798D__GUID-234B1C81-531E-41D6-BAB0-2F8D3FE4D7B2">Cygwin Requirement for Oracle ACFS Replication</p>
                     <p>Oracle ACFS snapshot-based replication uses <code class="codeph">ssh</code> to transfer replication-related data from the primary cluster to the standby cluster. When you use replication on a host running on Microsoft Windows, you must install Cygwin and start the <code class="codeph">ssh</code> daemon on the host, as described in this section.
                     </p>
                     <p>Cygwin is essentially a utility that offers a Linux-like environment on a Microsoft  Windows host. Technically, it is a DLL (<code class="codeph">cygwin1.dll</code>) that acts as a Linux API layer providing substantial Linux API functionality. After you install Cygwin, you can configure the <code class="codeph">ssh</code> daemon on the host. Oracle ACFS replication is certified and supported with Cygwin 2.0.
                     </p>
                     <p>The <code class="codeph">ssh</code> daemon enables Oracle ACFS Replication to establish <code class="codeph">ssh</code> connectivity from the primary cluster running replication to the standby cluster running replication. 
                     </p>
                     <div class="infoboxnote" id="GUID-D2CADB0B-E03D-4576-90DD-F1214362798D__GUID-99AC42CF-96A5-41B3-8DAB-EA04B61BD846">
                        <p class="notep1">Note:</p>
                        <p>These instructions for installing the <code class="codeph">ssh</code> daemon result in a daemon that is usable only to log in and run commands as the specific user <span class="italic">repluser</span>. The daemon is not intended to work correctly when logging in and running commands as any other user. This restriction results from two factors:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Users defined for Oracle ACFS must be domain-based users.</p>
                           </li>
                           <li>
                              <p>Enabling the general-purpose use of the <code class="codeph">ssh</code> daemon for a domain-based user involves creating a domain policy that gives that user some very powerful privileges, including <code class="codeph">SeTcbPrivilege</code> which lets the user act as part of the <span class="italic">Trusted Computing Base</span>. Creating such a policy would not likely be allowed in most corporate environments, so the use of such a policy is not included in these instructions.
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-D2CADB0B-E03D-4576-90DD-F1214362798D__GUID-89207EDC-DEE6-4787-B070-368261B17086">Steps Before Installing Cygwin</p>
                     <p>Before starting with the <code class="codeph">ssh</code> setup, ensure you are not using <code class="codeph">OpenSSH</code> and <code class="codeph">MKSNT</code> by performing the checks in the following steps.
                     </p>
                     <p>Note that the navigational steps described in this section may vary for different Microsoft Windows operating systems.</p>
                     <ol>
                        <li>
                           <p>Ensure <code class="codeph">OpenSSH\bin</code> and any directory where <code class="codeph">mksnt</code> executable files are stored are not in your <code class="codeph">PATH</code> environment variable. If they are, remove them from the path string by performing the following:
                           </p>
                           <ol type="a">
                              <li>
                                 <p>Right-click on <span class="uicontrol bold">My Computer</span> and go to <span class="uicontrol bold">Properties</span>.
                                 </p>
                              </li>
                              <li>
                                 <p>In the <span class="uicontrol bold">System Properties</span> window, click <span class="uicontrol bold">Advanced</span>. 
                                 </p>
                              </li>
                              <li>
                                 <p>In this tab, click <span class="uicontrol bold">Environment Variables</span>.
                                 </p>
                              </li>
                              <li>
                                 <p>Search for the <code class="codeph">PATH</code> system variable, select it, and if <code class="codeph">OpenSSH\bin</code>  or <code class="codeph">mksnt</code>-related values are present in <code class="codeph">PATH</code> string, click <span class="uicontrol bold">Edit</span>. 
                                 </p>
                              </li>
                              <li>
                                 <p>In the Edit System Variable dialog box, delete these values from <code class="codeph">PATH</code> string, then click <span class="uicontrol bold">OK</span>. 
                                 </p>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p>Stop and disable the <code class="codeph">ssh</code> <code class="codeph">daemon</code> if it is running from <code class="codeph">OpenSSH</code>, <code class="codeph">MKS</code> or any other source. If the <code class="codeph">ssh</code> daemon is running, stop and disable it by doing the following: 
                           </p>
                           <ol type="a">
                              <li>
                                 <p>Right-click on <span class="uicontrol bold">My Computer</span>, and select <span class="uicontrol bold">Manage</span>.
                                 </p>
                              </li>
                              <li>
                                 <p>In the <span class="uicontrol bold">Computer Management</span> window, in the left pane, expand <span class="uicontrol bold">Services and Applications</span>, and select <span class="uicontrol bold">Services</span>.
                                 </p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>In the right pane, right-click the <code class="codeph">ssh</code> daemon/<code class="codeph">MKS Secure Shell</code> service, then click the <span class="uicontrol bold">Stop</span> entry on the menu that appears. 
                                       </p>
                                    </li>
                                    <li>
                                       <p>In the same pane, right-click the <code class="codeph">ssh</code> daemon/<code class="codeph">MKS Secure Shell</code> service, then click the <span class="uicontrol bold">Properties</span> entry on the menu that appears.  In the dialog box that opens, select <span class="uicontrol bold">Disabled</span> as the <span class="uicontrol bold">Startup</span> type, and click <span class="uicontrol bold">OK</span>. 
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                           </ol>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-D2CADB0B-E03D-4576-90DD-F1214362798D__GUID-40EE4B4F-3EC1-4032-A977-6F49F3B56BBE">Installing Cygwin</p>
                     <p>To install Cygwin on a Microsoft Windows host, perform the following steps: </p>
                     <ol>
                        <li>
                           <p>Access the following URL, then click <span class="uicontrol bold">Install Cygwin</span>: 
                           </p><pre class="oac_no_warn" dir="ltr">http://www.cygwin.com/ </pre></li>
                        <li>
                           <p>Depending on the version of Microsoft Windows you are running, download the 32-bit version or the 64-bit version of the Cygwin setup executable.</p>
                        </li>
                        <li>
                           <p>Run the setup executable, then click <span class="uicontrol bold">Next</span> to proceed.
                           </p>
                        </li>
                        <li>
                           <p>On the <span class="uicontrol bold">Choose Installation Type</span> screen, select <span class="uicontrol bold">Install from Internet</span>, then click <span class="uicontrol bold">Next</span>.
                           </p>
                        </li>
                        <li>
                           <p>On the <span class="uicontrol bold">Choose Installation Directory</span> screen, enter <code class="codeph">C:\cygwin</code> as the <span class="uicontrol bold">Root Directory</span>, then click <span class="uicontrol bold">Next</span>.
                           </p>
                        </li>
                        <li>
                           <p>On the <span class="uicontrol bold">Select Local Package Directory</span> screen, select a directory on your local machine where you want to store the downloaded installation files, then click <span class="uicontrol bold">Next</span>.
                           </p>
                        </li>
                        <li>
                           <p>On the <span class="uicontrol bold">Select Connection Type</span> screen, select appropriate settings to connect to the internet, then click <span class="uicontrol bold">Next</span>. 
                           </p>
                        </li>
                        <li>
                           <p>On the <span class="uicontrol bold">Choose Download Site(s)</span> screen, select any site from the available list, then click <span class="uicontrol bold">Next</span>.
                           </p>
                        </li>
                        <li>
                           <p>On the select packages screen, ensure that you select the following packages, then click <span class="uicontrol bold">Next</span>.  From the <span class="uicontrol bold">Archive</span> category, select <span class="uicontrol bold">unzip</span> and  <span class="uicontrol bold">zip</span>.  From the <span class="uicontrol bold">Net</span> category, select <span class="uicontrol bold">openssh</span> and <span class="uicontrol bold">openssl</span>.  After selecting the packages and clicking <span class="uicontrol bold">Next</span>, the <span class="uicontrol bold">Resolving Dependencies</span> screen is displayed. Click <span class="uicontrol bold">Next</span> to proceed. 
                           </p>
                        </li>
                        <li>
                           <p>On the <span class="uicontrol bold">Installation Status and Create Icons</span> screen, do not make any changes. Click <span class="uicontrol bold">Finish</span> to complete the installation process.
                           </p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-D2CADB0B-E03D-4576-90DD-F1214362798D__GUID-51C95050-C99D-409D-8DEA-95B4EAF37FDE">Configuring ssh</p>
                     <p>This section describes how to configure <code class="codeph">ssh</code> for Oracle ACFS replication after installing Cygwin on a host.
                     </p>
                     <div><span class="bold">Choosing Replication Users</span><p>Oracle ACFS Replication uses <code class="codeph">ssh</code> as the transport between the primary and standby clusters, so the user identities under which replication is performed need to be explicitly specified. In the replication process, a privileged user on the primary node uses <code class="codeph">ssh</code> to log in to the standby node involved in replication. It is not desirable for <code class="codeph">ssh</code> to log in as a privileged user on the standby node. Instead, a minimally-privileged user identity should be used. The user chosen must be a domain-based user, and must be a member of the <code class="codeph">ORA_ASMADMIN</code> group. 
                        </p>
                        <p>In this discussion, <span class="italic">repladmin</span> and <span class="italic">repluser</span> are used to refer to the replication users; however, you would replace <span class="italic">repladmin</span> and <span class="italic">repladmin</span> with the actual user names that you have selected. The <span class="italic">repladmin</span> user refers to the user that runs the <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">init</code> command on both the primary and the standby. This user must be a member of the <code class="codeph">Administrators</code> group. The <span class="italic">repluser</span> user refers to the user that <code class="codeph">ssh</code> uses to log in on the standby.  This user must be a domain-based user, and must be a member of the <code class="codeph">ORA_ASMADMIN</code> group, but not a member of the <code class="codeph">Administrators</code> group.  If a suitable user already exists for the use of Oracle RAC, that user should be used as <span class="italic">repluser</span>.
                        </p>
                        <p>For information about user privileges for Oracle ASM, refer to <a href="authenticate-access-asm-instance.html#GUID-7396FD18-628B-4026-AA55-79C6D6205EAE">About Privileges for Oracle ASM</a>. For information about running Oracle ACFS <code class="codeph">acfsutil</code> commands, refer to <a href="steps-manage-acfs.html#GUID-FA9F9335-ADA4-48D1-B060-6F096E3BAE6C" title="This topic provides an overview of the use of Oracle ACFS acfsutil commands.">About Using Oracle ACFS Command-Line Tools</a>.
                        </p>
                     </div>
                     <div><span class="bold">Configuration Steps</span><p>While configuring <code class="codeph">ssh</code>, you may need to run the <code class="codeph">cygwin.bat</code> script. While running <code class="codeph">cygwin.bat</code> on Microsoft Windows Server 2008 and Microsoft Windows Vista, ensure that you invoke the batch file in administrator mode. To do this, right-click the <code class="codeph">cygwin.bat</code> file and select <code class="codeph">Run as administrator</code>.  
                        </p>
                        <p>To configure <code class="codeph">ssh</code> and test your Cygwin setup, follow these steps:
                        </p>
                        <ol>
                           <li>
                              <p>After you install Cygwin, navigate to the <code class="codeph">C:\cygwin</code> directory, open the Cygwin.bat file in edit mode using any editor, and add the following line before invoking the <code class="codeph">bash</code> shell.
                              </p><pre class="oac_no_warn" dir="ltr">set CYGWIN=binmode ntsec</pre><p> The following lines are the possible contents of the <code class="codeph">Cygwin.bat</code> file after adding the previous line:
                              </p><pre class="oac_no_warn" dir="ltr">@echo off  
C: 
chdir C:\cygwin\bin 
set CYGWIN=binmode ntsec bash --login &#x2013;i</pre></li>
                           <li>
                              <p>To verify if Cygwin (<code class="codeph">cygrunsrv</code>) is installed properly, run <code class="codeph">C:\cygwin\Cygwin.bat</code>, and run the following command:
                              </p><pre class="oac_no_warn" dir="ltr">cygrunsrv &#x2013;h</pre><p> If Cygwin is installed properly, then all Cygwin help options are displayed on the screen. If the command returns an error message, then you may have to reinstall Cygwin.</p>
                           </li>
                           <li>
                              <p>Define the <span class="italic">repladmin</span> and <span class="italic">repluser</span> identities at the Windows level.  
                              </p>
                              <p>You can also use existing users instead for these roles.  If you define new identities for these roles, note the following:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>The <span class="italic">repladmin</span> user must be a member of the Administrators group.  It is recommended that <span class="italic">repladmin</span> also be a domain-based user.  If <span class="italic">repladmin</span> is a local user, it should be defined  with the same group memberships on all primary nodes.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The <span class="italic">repluser</span> user must be a domain-based user, and must be a member of the <code class="codeph">ORA_ASMADMIN</code> group. 
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>Configure the <code class="codeph">sshd</code> service.  Run <code class="codeph">C:\cygwin\Cygwin.bat</code>, and execute the following command:
                              </p><pre class="oac_no_warn" dir="ltr">ssh-host-config</pre><p>After running the command, you are prompted with the following questions. Appropriate responses are shown in bold. Other output may also appear, but is not shown here.</p><pre class="oac_no_warn" dir="ltr">*** Query: Should StrictModes be used? (yes/no) <span class="bold">yes</span>
*** Query: Should privilege separation be used? &lt;yes/no&gt;: <span class="bold">yes</span>
*** Query: New local account ’sshd’? &lt;yes/no&gt;: <span class="bold">yes</span>
*** Query: Do you want to install sshd as a service?
*** Query: &lt;Say "no" if it is already installed as a service&gt; &lt;yes/no&gt;: <span class="bold">yes</span>
*** Query: Enter the value of CYGWIN for the daemon: [] <span class="bold">binmode ntsec</span></pre><p>Now <code class="codeph">ssh-host-config</code> outputs some notes concerning the user account required to use passwordless logins.  This capability is required by Oracle ACFS replication.  The <span class="italic">repluser</span> account should be specified as this account.
                              </p><pre class="oac_no_warn" dir="ltr">*** Info: The following privileged accounts were found: 'cyg_server' .
*** Info: This script plans to use 'cyg_server'.
*** Info: 'cyg_server' will only be used by registered services.
*** Query: Do you want to use a different name? (yes/no) <span class="bold">yes</span></pre><p>You should respond <span class="uicontrol bold">yes</span> to the prompt, and should specify <span class="italic">repluser</span> as the name under which you run <code class="codeph">sshd</code>.  You are then prompted with the following questions. 
                              </p><pre class="oac_no_warn" dir="ltr">*** Query: Enter the new user name: <span class="bold">repluser</span>
*** Query: Reenter: <span class="bold">repluser</span>

***Warning: The specified account 'repluser' does not have the
***Warning: required permissions or group memberships.  This may
***Warning: cause problems if not corrected; continuing...
*** Query: Please enter the password for user 'repluser':
*** Query: Reenter:</pre><p>The above assumes that the user <span class="italic">repluser</span> already exists. You may ignore the warning output about missing permissions or group memberships. If the configuration is successful, the following message displays.
                              </p><pre class="oac_no_warn" dir="ltr">Host configuration finished. Have fun!</pre></li>
                           <li>
                              <p>Ensure that the directory <code class="codeph">/var/empty</code> exists and is owned by <span class="italic">repluser</span>.
                              </p>
                           </li>
                           <li>
                              <p>Ensure that the <span class="italic">repluser</span> and <span class="italic">repladmin</span> users are known to Cygwin.
                              </p>
                              <p>Backup the <code class="codeph">c:\cygwin\etc\passwd</code> file and then open the file in edit mode.  Remove any lines from this file that refer to the <span class="italic">repladmin</span> or <span class="italic">repluser</span> users. For each user, run the following command.  Both users are assumed to be domain-based users.
                              </p><pre class="oac_no_warn" dir="ltr">/bin/mkpasswd -d -u repladmin &gt;&gt; /etc/passwd</pre><p>Ensure that the home directory named for each user in <code class="codeph">/etc/passwd</code> exists.  If necessary, create it.  For example, if <code class="codeph">/home/repladmin</code> is the directory shown for user <span class="italic">repladmin</span>, perform the following to create the necessary directory.
                              </p><pre class="oac_no_warn" dir="ltr">mkdir -p /home/repladmin
chown repladmin /home/repladmin</pre></li>
                           <li>
                              <p>Ensure that the <code class="codeph">ssh</code> daemon starts, and is configured to start automatically:
                              </p>
                              <ol type="a">
                                 <li>
                                    <p>Right-click on <span class="uicontrol bold">My Computer</span>, and select <span class="uicontrol bold">Manage</span>. 
                                    </p>
                                 </li>
                                 <li>
                                    <p>In the <span class="uicontrol bold">Computer Management</span> window, in the left pane, expand <span class="uicontrol bold">Services and Applications</span>, and select <span class="uicontrol bold">Services</span>. 
                                    </p>
                                 </li>
                                 <li>
                                    <p>In the right pane, right-click the <span class="uicontrol bold">CYGWIN</span> <span class="uicontrol bold">sshd</span> service, then click the <span class="uicontrol bold">Properties</span> entry on the menu that appears.  In the dialog box that opens, select <span class="uicontrol bold">Automatic</span> as the <span class="uicontrol bold">Startup</span> type, and click <span class="uicontrol bold">OK</span>.
                                    </p>
                                 </li>
                              </ol>
                           </li>
                        </ol>
                        <p>If the <code class="codeph">ssh</code> daemon does not start, view the <code class="codeph">c:\cygwin\var\log\sshd.log</code> file for information that relates to the failure of the startup process.
                        </p>
                     </div>
                     <div><span class="bold">Getting the public key for repladmin from the primary</span><p>A public key for  <span class="italic">repladmin</span> defined on each node of your primary cluster must be known to <span class="italic">repluser</span> on each node of your standby cluster.
                        </p>
                        <p>To make the key known, the directory <code class="codeph">~repluser/.ssh</code> must exist on each standby node. If this directory does not exist, then create it with access only for <span class="italic">repluser</span>. Ensure that an <code class="codeph">ls</code> command for the <code class="codeph">.ssh</code> directory displays output similar to:
                        </p><pre class="oac_no_warn" dir="ltr">repluser@standby $ ls -ld ~/.ssh
drwx------+ 1 repluser Domain Users 4096 2016-02-23 11:27 .ssh
</pre><p>If a public key for <span class="italic">repladmin</span> is defined on a given primary node, then it resides in a <code class="codeph">.pub</code> file, such as <code class="codeph">~repladmin/.ssh/id_rsa.pub</code>.  If a public key file exists, then add its contents to the set of keys authorized to log in as <span class="italic">repluser</span> on each node of the standby where replication is run. Append the key to the file <code class="codeph">~repluser/.ssh/authorized_keys2</code> on each standby node, creating this file if necessary.
                        </p>
                        <p>If a public key file does not exist, generate a public and private key pair on the primary by running the following command as <span class="italic">repladmin</span>.
                        </p><pre class="oac_no_warn" dir="ltr"># ssh-keygen -t rsa</pre><p>You can press the enter key in response to each prompt issued by the command. Copy the resulting <code class="codeph">.pub</code> file to each standby node.
                        </p>
                        <p>You have the option to share the same public/private key pair for <span class="italic">repladmin</span> across all of the nodes in your primary cluster, or to establish a different key pair for each primary node. If the same public key is valid for <span class="italic">repladmin</span> across all nodes in your primary cluster, then only that key must be added to the file <code class="codeph">~repluser/.ssh/authorized_keys2</code> on each node of your standby cluster. If each primary node has its own public key for <span class="italic">repladmin</span>, then all the public keys must be added to the file. In either case, you can minimize work by copying the updated <code class="codeph">authorized_keys2</code> file on a given node of the standby to the other nodes of the cluster. 
                        </p>
                     </div>
                     <div><span class="bold">Getting the standby host key</span><p>A host key for each standby node where replication may run must be known on each primary node where replication may run. One way to generate the correct key is to run <code class="codeph">ssh</code> manually as the <span class="italic">repladmin</span> user from each primary node to each standby node. If the correct host key is not known already, then a warning displays and you can enable <code class="codeph">ssh</code> to add the key.  
                        </p>
                        <p>Note that there are two users involved in the <code class="codeph">ssh</code> connection. While <code class="codeph">ssh</code> on the primary node connects to the standby node as <span class="italic">repladmin</span>, <code class="codeph">ssh</code> logs in on the standby node as <span class="italic">repluser</span>. Any command run by <code class="codeph">ssh</code> on the standby runs with the privileges of <span class="italic">repluser</span>, not with <span class="italic">repladmin</span> privileges.  
                        </p>
                        <p>Because the primary node connects to the standby node as user <span class="italic">repladmin</span>, the host key for the standby node must be added to the <code class="codeph">known_hosts</code> file of the <span class="italic">repladmin</span> user, not the file for <span class="italic">repluser</span>. The following is an example of obtaining a host key:
                        </p><pre class="oac_no_warn" dir="ltr">[repladmin@primary usm]# ssh repluser@standby date
The authenticity of host 'standby (10.137.13.85)' can't be established.
RSA key fingerprint is 1b:a9:c6:68:47:b4:ec:7c:df:3a:f0:2a:6f:cf:a7:0a.
Are you sure you want to continue connecting (yes/no)?</pre><p>If you respond with <code class="codeph">yes</code>, then the <code class="codeph">ssh</code> setup is complete. A host key for host standby is stored in the <code class="codeph">known_hosts</code> file (<code class="codeph">~repladmin/.ssh/known_hosts</code>) on the host <span class="italic">primary</span> for the user <span class="italic">repladmin</span>. 
                        </p>
                        <p>After the host key setup for standby nodes is complete on a given primary node, you need to perform an additional step if you use a Virtual IP address (VIP) to communicate with your standby cluster. You must add the VIP name or address at the start of each line of the <code class="codeph">known_hosts</code> file that refers to a host in the standby cluster. For example, if you use a VIP with the name <code class="codeph">standby12_vip</code>, and your <code class="codeph">known_hosts</code> file contains the following two lines that refer to your standby:
                        </p><pre class="oac_no_warn" dir="ltr">standby1,10.242.20.22 ssh-rsa
AAAAB3NzaC1yc2EAAAADAQABAAABAQC3pM2YTd4UUiEWEoCKDGgaTgsmPkQToDrdtU+JtVIq/96muivU
BaJUK83aqzeNIQkh+hUULsUdgKoKT5bxrWYqhY6AlTEqNgBHjBrJt9C73BbQd9y48jsc2G+WQWyuI/
+s1Q+hIJdBNMxvMBQAfisPWWUcaIx9Y/JzlPgF6lRP2cbfqAzixDot9fqRrAKL3G6A75A/6TbwmEW07d1zqOv
l7ZGyeDYf5zQ72F/V0P9UgMEt/5DmcYTn3kTVGjOTbnRBe4A4lY4rVw5c+nZBDFre66XtORfQgwQB5ztW/Pi
08GYbcIszKoZx2HST9AZxYIAgcrnNYG2Ae0K6QLxxxScP
standby2,10.242.20.23 ssh-rsa
AAAAB3NzaC1yc2EAAAADAQABAAABAQDIszcjzNtKN03SY8Kl846skFTVP1HF/ykswbmkctEjL6KTWTW+NR
U4MGbvkBqqdXxuPCR7aoGO2U3PEOg1UVf3DWUoux8IRvqKU+dJcdTibMFkDAIhTnzb14gZ/lRTjn+GYsuP5
Qz2vgL/U0ki887mZCRjWVL1b5FNH8sXBUV2QcD7bjF98VXF6n4gd5UiIC3jv6l2nVTKDwtNHpUTS1dQAi+1D
tr0AieZTsuxXMaDdUZHgKDotjciMB3mCkKm/u3IFoioDqdZE4+vITX9G7DBN4CVPXawp+b5Kg8X9P+08Eehu
tMlBJ5lafy1bxoVlXUDLVIIFBJNKrsqBvxxxpS7</pre><p>To enable the use of the VIP, you would modify these two lines to read as follows:</p><pre class="oac_no_warn" dir="ltr">
<span class="bold">standby12_vip,standby1,10.242.20.22 ssh-rsa</span>
AAAAB3NzaC1yc2EAAAADAQABAAABAQC3pM2YTd4UUiEWEoCKDGgaTgsmPkQToDrdtU+JtVIq/96muivU
BaJUK83aqzeNIQkh+hUULsUdgKoKT5bxrWYqhY6AlTEqNgBHjBrJt9C73BbQd9y48jsc2G+WQWyuI/
+s1Q+hIJdBNMxvMBQAfisPWWUcaIx9Y/JzlPgF6lRP2cbfqAzixDot9fqRrAKL3G6A75A/6TbwmEW07d1zqOv
l7ZGyeDYf5zQ72F/V0P9UgMEt/5DmcYTn3kTVGjOTbnRBe4A4lY4rVw5c+nZBDFre66XtORfQgwQB5ztW/Pi
08GYbcIszKoZx2HST9AZxYIAgcrnNYG2Ae0K6QLxxxScP
<span class="bold">standby12_vip,standby2,10.242.20.23 ssh-rsa</span>
AAAAB3NzaC1yc2EAAAADAQABAAABAQDIszcjzNtKN03SY8Kl846skFTVP1HF/ykswbmkctEjL6KTWTW+NR
U4MGbvkBqqdXxuPCR7aoGO2U3PEOg1UVf3DWUoux8IRvqKU+dJcdTibMFkDAIhTnzb14gZ/lRTjn+GYsuP5
Qz2vgL/U0ki887mZCRjWVL1b5FNH8sXBUV2QcD7bjF98VXF6n4gd5UiIC3jv6l2nVTKDwtNHpUTS1dQAi+1D
tr0AieZTsuxXMaDdUZHgKDotjciMB3mCkKm/u3IFoioDqdZE4+vITX9G7DBN4CVPXawp+b5Kg8X9P+08Eehu
tMlBJ5lafy1bxoVlXUDLVIIFBJNKrsqBvxxxpS7</pre><p>Ultimately, the host key configuration performed on this first node of your primary cluster must be performed on every node in your primary cluster; the result of the above sequence, or an equivalent, must exist on each primary node. One way to minimize the manual effort required to achieve this configuration is to update the <code class="codeph">known_hosts</code> file on one node of the primary cluster, then copy the updated file to the other nodes of the cluster.  
                        </p>
                        <div class="infoboxnote" id="GUID-D2CADB0B-E03D-4576-90DD-F1214362798D__GUID-5E9BEBF3-D353-4C3C-B343-DA65EE35014C">
                           <p class="notep1">Note:</p>
                           <p>By default, replication enables strict host key checking by <code class="codeph">ssh</code>, to ensure that the primary node connects to the intended standby node or cluster when it runs <code class="codeph">ssh</code>. However, if you are certain that this checking is unneeded, such as the case when the primary and standby clusters communicate over a private network, the use of strict host key checking by <code class="codeph">ssh</code> can be disabled. For information about disabling strict host key checking, refer to the <code class="codeph">/o sshStrictKey=no</code> option of the <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">init</code> <code class="codeph">primary</code> command. If strict host key checking is disabled, then no host key setup is required. For information about the <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">init</code> command, refer to <a href="acfs-commands-replication.html#GUID-E96CD9A2-00BD-4673-8FCC-DBB28A9E2DCD">acfsutil repl init</a>.
                           </p>
                        </div>
                     </div>
                     <div><span class="bold">Adding keys for the SYSTEM user</span><p>Oracle ACFS replication uses a daemon running on a node of the primary cluster to control the progress of replication. This daemon is automatically started using the identity <code class="codeph">NT_AUTHORITY\SYSTEM</code>. With this daemon, replication, using <code class="codeph">ssh</code>, is able to transfer and apply primary data to the standby site.   
                        </p>
                        <p>The processes started by the daemon have the identity of the daemon. If the user is <code class="codeph">NT_AUTHORITY\SYSTEM</code>, that is the user actually contacting the standby through <code class="codeph">ssh</code>.  <code class="codeph">ssh</code> searches in the home directory for the <code class="codeph">SYSTEM</code> user for a public key to present to the standby, and checks there to verify the host key presented by the standby.
                        </p>
                        <p> To enable the daemon's successful use of <code class="codeph">ssh</code>, the contents of the <code class="codeph">.ssh</code> directory set up for <span class="italic">repladmin</span> on the primary should be copied to a <code class="codeph">.ssh</code> directory in the home directory for <code class="codeph">SYSTEM</code>. Use a location for this directory that is parallel to the locations used for other home directories.
                        </p>
                        <p>For instance, if the home directory for user <span class="italic">repladmin</span> is <code class="codeph">/home/repladmin</code>, then use <code class="codeph">/home/SYSTEM</code> as the home directory for <code class="codeph">SYSTEM</code>.  Create the <code class="codeph">.ssh</code> directory like this, while logged in as <span class="italic">repladmin</span>. 
                        </p>
                        <p>First, create the home directory for <code class="codeph">SYSTEM</code> if it does not already exist:
                        </p><pre class="oac_no_warn" dir="ltr">$ mkdir /home/SYSTEM</pre><p>Next, copy the <code class="codeph">.ssh</code> directory for <span class="italic">repladmin</span> into the directory for <code class="codeph">SYSTEM</code>:
                        </p><pre class="oac_no_warn" dir="ltr"> $ cd  $HOME
 $ cp -p -R .ssh /home/SYSTEM</pre></div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-D2CADB0B-E03D-4576-90DD-F1214362798D__TESTINGYOURCYGWINSETUP-DDC2192C">Testing Your Cygwin Setup</p>
                     <p>Now test your Cygwin setup. Using a different computer that has the <code class="codeph">ssh</code> client available, execute the following command as the user <span class="italic">repladmin</span>: 
                     </p><pre class="oac_no_warn" dir="ltr">ssh -l repluser host-address date</pre><p>where <code class="codeph">host-address</code> refers to the host where you just configured <code class="codeph">ssh</code>.  For example: 
                     </p><pre class="oac_no_warn" dir="ltr">ssh -l repluser standby1.us.example.com date</pre><p>If you have completed the installation and configuring steps successfully, the previous command should run without prompting for a password. </p>
                     <p>If you experience a process fork failure, memory leak error, or a file access error after configuring <code class="codeph">ssh</code>, view the following link for a workaround:
                     </p><pre class="oac_no_warn" dir="ltr">http://cygwin.com/faq.html</pre><p>If you are unable to find a workaround for your problem, report your problem to the Cygwin community using the following link: </p><pre class="oac_no_warn" dir="ltr">http://cygwin.com/problems.html</pre></div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-990E0BAF-AD12-4DB2-9423-AE8DE4A121D7" name="GUID-990E0BAF-AD12-4DB2-9423-AE8DE4A121D7"></a><h3 id="OSTMG-GUID-990E0BAF-AD12-4DB2-9423-AE8DE4A121D7" class="sect3">Upgrading to Oracle ACFS Snapshot-Based Replication</h3>
               <div>
                  <p>This section describes the upgrade to Oracle ACFS snapshot-based replication. With Oracle Grid Infrastructure 12<span class="italic">c</span> release 2 (12.2), Oracle ACFS snapshot-based replication becomes the supported Oracle ACFS replication implementation. If you have a replication environment from a release before 12.2, then you must upgrade your existing replication installation to snapshot-based replication when you upgrade to Oracle Grid Infrastructure 12<span class="italic">c</span> release 2 (12.2).
                  </p>
                  <div class="infoboxnote" id="GUID-990E0BAF-AD12-4DB2-9423-AE8DE4A121D7__GUID-5B0317C4-D820-4409-9041-377DB52D83FE">
                     <p class="notep1">Note:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>After the replication upgrade process has started, it must be completed. The process cannot be rolled back.</p>
                        </li>
                        <li>
                           <p>Oracle Flex ASM should be enabled, and if necessary a password file conversion performed, before upgrading to snapshot-based replication.</p>
                        </li>
                     </ul>
                  </div>
                  <p>Oracle Flex ASM must be enabled for any existing instance when the instance is upgraded to Oracle Grid Infrastructure 12<span class="italic">c</span> release 2 (12.2). If a password file exists in the instance to support replication, the file must be enabled for use in the new Oracle Flex ASM instance. For example, if an instance had a previous <code class="codeph">ORACLE_SID</code> set to <code class="codeph">ASM</code> and a current <code class="codeph">ORACLE_SID</code> set to <code class="codeph">APX1</code>, then the following steps must be performed:
                  </p>
                  <ol>
                     <li>
                        <p>Copy the existing <code class="codeph">orapw+ASM</code> file to an <code class="codeph">+APX1</code> version
                        </p><pre class="oac_no_warn" dir="ltr">$ cp /oraroot/app/12.2.0/has0626/dbs/orapw+ASM /oraroot/app/12.2.0/has0626/dbs/orapw+APX1 </pre></li>
                     <li>Create a new text file called <code class="codeph">init+APX1.ora</code> in the <code class="codeph">dbs</code> directory and add only the following line to the new file:<pre class="oac_no_warn" dir="ltr">remote_login_passwordfile = exclusive </pre></li>
                     <li>
                        <p>Restart the Oracle ASM proxy (APX) instance.</p><pre class="oac_no_warn" dir="ltr">$ asmcmd shutdown --target APX --immediate
</pre><p>Ensure that the environment variable <code class="codeph">ORACLE_SID</code> is set to the Oracle ASM proxy (APX) instance. Then restart the instance.
                        </p><pre class="oac_no_warn" dir="ltr">$ asmcmd startup --pfile init+APX1.ora</pre></li>
                  </ol>
                  <p>Snapshot-based replication uses <code class="codeph">ssh</code> as the transport between the primary and standby clusters. Before starting the upgrade process, you must configure <code class="codeph">ssh</code> as described in <a href="configure-acfs-replication.html#GUID-C1CB3914-E278-473A-ACCC-FD1BA7CDC0B4">Configuring ssh for Use With Oracle ACFS Replication</a>. 
                  </p>
                  <p>Before upgrading to snapshot-based replication, you must upgrade your standby cluster system to Oracle Grid Infrastructure 12<span class="italic">c</span> release 2 (12.2).This cluster upgrade should be completed within 24 hours. The standby cluster continues to run existing replication during this upgrade process. Next, upgrade to Oracle Grid Infrastructure 12<span class="italic">c</span> release 2 (12.2) on the primary cluster.  This upgrade should also be completed within 24 hours. During this upgrade, the primary cluster continues to run existing replication that was installed before 12.2. After the completion of the Oracle Grid Infrastructure 12<span class="italic">c</span> release 2 (12.2) upgrade of the standby and primary clusters, the existing replication implementation installed before 12.2 is not supported. 
                  </p>
                  <p>Immediately following the upgrade of the two clusters, you must set the <code class="codeph">COMPATIBLE.ADVM</code> disk group attribute associated with the file systems to be involved in replication to <code class="codeph">12.2.0.0.0</code>. Now you are ready to transition to snapshot-based replication. The transition can made with one of the following options: 
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Terminate your existing replication and initialize to use snapshot-based replication. This option is recommended if the amount of data being replicated is small (less than a few hundred gigabytes). This option may also be preferable if your primary file system cannot easily be restricted to being mounted on only one node, or if activity on the primary cannot easily be quiesced.</p>
                     </li>
                     <li>
                        <p>Run the <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">upgrade</code> command to upgrade your existing replication environment without terminating and initializing replication. This option avoids the need to transfer the entire contents of your primary file system to the standby by enabling snapshot-based replication to continue from the point where existing replication has stopped.  This option is advantageous when larger amounts of data are being replicated. Because very little data is transferred by the upgrade process, you can expect the process to complete quickly. 
                        </p>
                     </li>
                  </ul>
                  <p>The following list provides details on running the <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">upgrade</code> command options to upgrade to snapshot-based replication.
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Before starting the replication upgrade process, you must ensure that  your primary file system is mounted on only one node of the primary cluster.  In addition, it is strongly recommended that you quiesce all application updates to the primary file system, then run <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">sync</code> <code class="codeph">apply</code> one final time to ensure all changes on the primary are replicated.
                        </p>
                     </li>
                     <li>
                        <p>The initial step in the upgrade process is to run the <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">upgrade</code> <code class="codeph">prepare</code> command on the primary cluster.  This command specifies the user and host or interface name that will be used for snapshot-based replication, as well as the primary mount point.  The user and host names are given with the <code class="codeph">-s</code> option, exactly as they are for the <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">init</code> <code class="codeph">primary</code> command used for snapshot-based replication. 
                        </p>
                     </li>
                     <li>
                        <p>The next step in the process is to upgrade replication on the standby cluster, by running the <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">upgrade</code> <code class="codeph">standby</code> command.  This command specifies the user to be used for snapshot-based replication, as well as the standby mount point.  The user name is given with the <code class="codeph">-u</code> option, exactly as it is for the <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">init</code> <code class="codeph">standby</code> command used for snapshot-based replication.
                        </p>
                     </li>
                     <li>
                        <p>The final step in the process is to run the a<code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">upgrade</code> <code class="codeph">primary</code> command on the primary cluster. This is the command that automatically terminates the previous replication deployment and initiates snapshot-based replication.  This command accepts any of the command-line options accepted by the <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">init</code> <code class="codeph">primary</code> command for snapshot-based replication, except for the <code class="codeph">-m</code> and <code class="codeph">-s</code> options, as that information is obtained from the now-terminated previous replication environment.
                        </p>
                     </li>
                     <li>
                        <p>After the <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">upgrade</code> <code class="codeph">primary</code>  command completes, snapshot-based replication should be active between the affected primary and standby clusters, exactly as though the <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">init</code> commands had been run with snapshot-based replication in the 12.2 release.  You can use the command <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">info</code>  <code class="codeph">-c</code> on both the primary and standby cluster to confirm the status of replication on each cluster.
                        </p>
                     </li>
                  </ul>
                  <div class="infoboxnote" id="GUID-990E0BAF-AD12-4DB2-9423-AE8DE4A121D7__GUID-0F4AD5A2-37E2-4827-B35B-0BE4D2AB4AE5">
                     <p class="notep1">Note:</p>
                     <p>If an error occurs in running either <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">upgrade</code> <code class="codeph">standby</code> or <code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">upgrade</code> <code class="codeph">primary</code>, then consider the following:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Depending on the error, replication may appear to be uninitialized (<code class="codeph">acfsutil</code> <code class="codeph">repl</code> <code class="codeph">info</code> may indicate that) until the upgrade command has completed successfully.
                           </p>
                        </li>
                        <li>
                           <p>To continue with the upgrade, you should correct whatever error was indicated by the failing upgrade command, then simply re-issue the failing command. The command may be re-issued multiple times.</p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>