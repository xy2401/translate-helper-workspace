<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>日期时间数据类型和时区支持</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Database Globalization Support Guide "></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Database Globalization Support Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-globalization-support-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-02-12T02:55:13-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2007, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96349-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="setting-up-globalization-support-environment.html" title="Previous" type="text/html"></link>
      <link rel="next" href="linguistic-sorting-and-matching.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Globalization Support Guide"></meta>
    <meta name="dcterms.isVersionOf" content="NLSPG"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="setting-up-globalization-support-environment.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="linguistic-sorting-and-matching.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据库全球化支持指南</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">日期时间数据类型和时区支持</li>
            </ol>
            <a id="GUID-7A1BA319-767A-43CC-A579-4DAC7063B243" name="GUID-7A1BA319-767A-43CC-A579-4DAC7063B243"></a><a id="NLSPG004"></a>
            
            <h2 id="NLSPG-GUID-7A1BA319-767A-43CC-A579-4DAC7063B243" class="sect2"><span class="enumeration_chapter">4个</span>日期时间数据类型和时区支持</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章包括以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="datetime-data-types-and-time-zone-support.html#GUID-C2FD0A7D-974F-4C62-8210-1C356243E222">日期时间和间隔数据类型和时区支持概述</a></p>
                  </li>
                  <li>
                     <p><a href="datetime-data-types-and-time-zone-support.html#GUID-789689BF-5682-4577-8ADE-8105C652CBB7">日期时间和间隔数据类型</a></p>
                  </li>
                  <li>
                     <p><a href="datetime-data-types-and-time-zone-support.html#GUID-B6CAA1E5-2A82-42B2-889C-F3F5AFBD53AF">日期时间和区间算术和比较</a></p>
                  </li>
                  <li>
                     <p><a href="datetime-data-types-and-time-zone-support.html#GUID-429C290A-C201-4272-A369-FF8F4F8E54F7">日期时间SQL函数</a></p>
                  </li>
                  <li>
                     <p><a href="datetime-data-types-and-time-zone-support.html#GUID-ABF6392E-EBCA-484B-88F1-E69BA3E1721C">日期时间和时区参数和环境变量</a></p>
                  </li>
                  <li>
                     <p><a href="datetime-data-types-and-time-zone-support.html#GUID-805AB986-DE12-4FEA-AF56-5AABCD2132DF">选择时区文件</a></p>
                  </li>
                  <li>
                     <p><a href="datetime-data-types-and-time-zone-support.html#GUID-B0ACDB2E-4B49-4EB4-B4CC-9260DAE1567A">使用时区数据升级时区文件和时间戳</a></p>
                  </li>
                  <li>
                     <p><a href="datetime-data-types-and-time-zone-support.html#GUID-1A80594A-6D9D-4088-8240-F7CA18300E76">使用不同版本的时区文件运行的客户端和服务器</a></p>
                  </li>
                  <li>
                     <p><a href="datetime-data-types-and-time-zone-support.html#GUID-2AF15A96-CD19-4074-8DE6-17BAD0D7DF37">设置数据库时区</a></p>
                  </li>
                  <li>
                     <p><a href="datetime-data-types-and-time-zone-support.html#GUID-578B5988-31E2-4D0F-ACEA-95C827F6012B">设置会话时区</a></p>
                  </li>
                  <li>
                     <p><a href="datetime-data-types-and-time-zone-support.html#GUID-D8C7A7EB-A507-42A2-9B10-5301E822A7F2">使用AT TIME ZONE子句转换时区</a></p>
                  </li>
                  <li>
                     <p><a href="datetime-data-types-and-time-zone-support.html#GUID-E5171DEF-74D7-482A-B4E9-1EE3403E18BC">支持夏令时</a></p>
                  </li>
               </ul>
            </div><a id="NLSPG236"></a><div class="props_rev_3"><a id="GUID-C2FD0A7D-974F-4C62-8210-1C356243E222" name="GUID-C2FD0A7D-974F-4C62-8210-1C356243E222"></a><h3 id="NLSPG-GUID-C2FD0A7D-974F-4C62-8210-1C356243E222" class="sect3"><span class="enumeration_section">4</span> .1日期时间和间隔数据类型和时区支持概述</h3>
               <div>
                  <p>企业在不同时区进行交易。Oracle数据库日期时间和间隔数据类型以及时区支持使得可以存储有关事件和事务时间的一致信息。</p>
                  <div class="infoboxnote" id="GUID-C2FD0A7D-974F-4C62-8210-1C356243E222__GUID-2E2B21C9-6472-4209-AA60-E9B42F2AAEEE">
                     <p class="notep1">注意：</p>
                     <p>本章介绍Oracle数据库日期时间和间隔数据类型。除非另有说明，否则它不会尝试描述ANSI数据类型或其他类型的数据类型。</p>
                  </div>
               </div>
            </div><a id="NLSPG237"></a><div class="props_rev_3"><a id="GUID-789689BF-5682-4577-8ADE-8105C652CBB7" name="GUID-789689BF-5682-4577-8ADE-8105C652CBB7"></a><h3 id="NLSPG-GUID-789689BF-5682-4577-8ADE-8105C652CBB7" class="sect3"><span class="enumeration_section">4。2</span>日期时间和间隔数据类型</h3>
               <div>
                  <p><span class="bold">日期时间数据类型</span>为<code class="codeph">DATE</code> ， <code class="codeph">TIMESTAMP</code> ， <code class="codeph">TIMESTAMP WITH TIME ZONE,</code>和<code class="codeph">TIMESTAMP WITH LOCAL TIME ZONE</code> 。 datetime数据类型的值有时称为<span class="bold">日期时间</span> 。
                  </p>
                  <p><span class="bold">区间数据类型</span>是<code class="codeph">INTERVAL YEAR TO MONTH</code>和<code class="codeph">INTERVAL DAY TO SECOND</code> 。间隔数据类型的值有时称为<span class="bold">间隔</span> 。
                  </p>
                  <p>日期时间和间隔都由字段组成。这些字段的值确定数据类型的值。适用于所有Oracle数据库日期时间和间隔数据类型的字段为：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><code class="codeph">年</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">月</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">天</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">小时</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">分钟</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">第二</code></p>
                     </li>
                  </ul>
                  <p><code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>还包括以下字段：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><code class="codeph">TIMEZONE_HOUR</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">TIMEZONE_MINUTE</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">TIMEZONE_REGION</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">TIMEZONE_ABBR</code></p>
                     </li>
                  </ul>
                  <p><code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">LOCAL</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>不在内部存储时区信息，但如果<code class="codeph">TZH:TZM</code>或<code class="codeph">TZR</code> ，您可以在SQL输出中看到本地时区信息<code class="codeph"> </code>指定了<code class="codeph">TZD</code>格式元素。
                  </p>
                  <p>以下部分更详细地描述了日期时间数据类型和间隔数据类型：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="datetime-data-types-and-time-zone-support.html#GUID-3A1B7AC6-2EDB-4DDC-9C9D-223D4C72AC74">日期时间数据类型</a></p>
                     </li>
                     <li>
                        <p><a href="datetime-data-types-and-time-zone-support.html#GUID-773BD5B5-D6AD-4AF6-B38B-EBD1459C8445">区间数据类型</a></p>
                        <div class="infoboxnotealso" id="GUID-789689BF-5682-4577-8ADE-8105C652CBB7__GUID-D527B5CF-4861-4906-AAAF-A5F5A1B376C1">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../sqlrf/Data-Types.html#SQLRF00200" target="_blank"><span class="italic">Oracle数据库SQL语言参考，</span></a>用于获取日期时间和间隔字段的有效值</p>
                              </li>
                              <li>
                                 <p>有关格式元素的信息，请<a href="../sqlrf/Format-Models.html#SQLRF51076" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                              </li>
                           </ul>
                        </div>
                     </li>
                  </ul>
               </div><a id="NLSPG238"></a><div class="props_rev_3"><a id="GUID-3A1B7AC6-2EDB-4DDC-9C9D-223D4C72AC74" name="GUID-3A1B7AC6-2EDB-4DDC-9C9D-223D4C72AC74"></a><h4 id="NLSPG-GUID-3A1B7AC6-2EDB-4DDC-9C9D-223D4C72AC74" class="sect4"><span class="enumeration_section">4。2。1</span>日期时间数据类型</h4>
                  <div>
                     <p>本节包括以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="datetime-data-types-and-time-zone-support.html#GUID-4D95F6B2-8F28-458A-820D-6C05F848CA23">日期数据类型</a></p>
                        </li>
                        <li>
                           <p><a href="datetime-data-types-and-time-zone-support.html#GUID-CD2954CE-45E2-4938-A599-CCB96879510F">TIMESTAMP数据类型</a></p>
                        </li>
                        <li>
                           <p><a href="datetime-data-types-and-time-zone-support.html#GUID-5BC5D2C1-6506-49BE-8177-F743A46FDC09">TIMESTAMP WITH TIME ZONE数据类型</a></p>
                        </li>
                        <li>
                           <p><a href="datetime-data-types-and-time-zone-support.html#GUID-3F1C388E-C651-43D5-ADBC-1A49E5C2CA05">TIMESTAMP与本地时区数据类型</a></p>
                        </li>
                        <li>
                           <p><a href="datetime-data-types-and-time-zone-support.html#GUID-C5DBDD5B-A781-4D2B-8CC2-DB9BB2D335FF">将值插入日期时间数据类型</a></p>
                        </li>
                        <li>
                           <p><a href="datetime-data-types-and-time-zone-support.html#GUID-2DFBD56C-5832-4AE8-831E-7EF1EFB7F0BB">选择TIMESTAMP数据类型</a></p>
                        </li>
                     </ul>
                  </div><a id="NLSPG239"></a><div class="props_rev_3"><a id="GUID-4D95F6B2-8F28-458A-820D-6C05F848CA23" name="GUID-4D95F6B2-8F28-458A-820D-6C05F848CA23"></a><h5 id="NLSPG-GUID-4D95F6B2-8F28-458A-820D-6C05F848CA23" class="sect5"><span class="enumeration_section">4.2.1.1</span>日期数据类型</h5>
                     <div>
                        <p><code class="codeph">DATE</code>数据类型存储日期和时间信息。虽然日期和时间信息可以用字符和数字数据类型表示，但<code class="codeph">DATE</code>数据类型具有特殊的关联属性。对于每个<code class="codeph">DATE</code>值，Oracle数据库存储以下信息：世纪，年，月，日，小时，分钟和秒。
                        </p>
                        <p>您可以通过以下方式指定日期值：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>将日期值指定为文字</p>
                           </li>
                           <li>
                              <p>使用<code class="codeph">TO_DATE</code>函数将字符或数值转换为日期值</p>
                           </li>
                        </ul>
                        <p>日期可以指定为ANSI日期文字或Oracle数据库日期值。</p>
                        <p>ANSI日期文字不包含时间部分，必须严格按以下格式指定：</p><pre class="oac_no_warn" dir="ltr">日期'YYYY-MM-DD'</pre><p>以下是ANSI日期文字的示例：</p><pre class="oac_no_warn" dir="ltr">日期'1998-12-25'</pre><p>或者，您可以指定Oracle数据库日期值，如以下示例所示：</p><pre class="oac_no_warn" dir="ltr">TO_DATE（'1998-DEC-25 17:30'，'YYYY-MON-DD HH24：MI'，'NLS_DATE_LANGUAGE = AMERICAN'）</pre><p>Oracle数据库日期值的默认日期格式是从<code class="codeph">NLS_DATE_FORMAT</code>和<code class="codeph">NLS_DATE_LANGUAGE</code>初始化参数派生的。示例中的日期格式包括一个月中的两位数字，月份名称的缩写，一年中的四位数字以及24小时时间指定。包含<code class="codeph">NLS_DATE_LANGUAGE</code>的规范，因为' <code class="codeph">DEC'</code>不是所有语言环境中<code class="codeph">MON</code>的有效值。
                        </p>
                        <p>Oracle数据库在日期表达式中使用时，会自动将默认日期格式的字符值转换为日期值。</p>
                        <p>如果指定没有时间组件的日期值，则默认时间为午夜。如果指定没有日期的日期值，则默认日期是当前月份的第一天。</p>
                        <p>Oracle Database <code class="codeph">DATE</code>列始终包含日期和时间的字段。如果查询使用的日期格式没有时间部分，则必须确保<code class="codeph">DATE</code>列中的时间字段设置为午夜。您可以使用<code class="codeph">TRUNC</code> （日期）SQL函数来确保将时间字段设置为午夜，或者可以使查询的测试大于或小于（ <code class="codeph">&lt;</code> ， <code class="codeph">&lt;=</code> ， <code class="codeph">&gt;=</code>或<code class="codeph">&gt;)</code>而不是相等或不平等（ <code class="codeph">=</code>或<code class="codeph">!=)</code> 。否则，Oracle数据库可能不会返回您期望的查询结果。
                        </p>
                        <div class="infoboxnotealso" id="GUID-4D95F6B2-8F28-458A-820D-6C05F848CA23__GUID-17C56F16-AF55-4E42-92D1-081E6026F686">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">DATE</code>数据类型的详细信息，请<a href="../sqlrf/Data-Types.html#SQLRF00202" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="setting-up-globalization-support-environment.html#GUID-0887A83E-06E1-469A-AA8A-A9A50B8B7B57">NLS_DATE_FORMAT</a> ”</span></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="setting-up-globalization-support-environment.html#GUID-52E080BC-83F9-43A3-B58C-D5F45CBE10C2">NLS_DATE_LANGUAGE</a> ”</span></p>
                              </li>
                              <li>
                                 <p>有关文字，格式元素（如<code class="codeph">MM</code> ）和<code class="codeph">TO_DATE</code>函数的详细信息，请<a href="../sqlrf/Format-Models.html#SQLRF00210" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="NLSPG240"></a><div class="props_rev_3"><a id="GUID-CD2954CE-45E2-4938-A599-CCB96879510F" name="GUID-CD2954CE-45E2-4938-A599-CCB96879510F"></a><h5 id="NLSPG-GUID-CD2954CE-45E2-4938-A599-CCB96879510F" class="sect5"><span class="enumeration_section">4.2.1.2</span> TIMESTAMP数据类型</h5>
                     <div>
                        <p><code class="codeph">TIMESTAMP</code>数据类型是<code class="codeph">DATE</code>数据类型的扩展。它存储年，月，日，小时，分钟和秒值。它还存储小数秒，它们不会被<code class="codeph">DATE</code>数据类型存储。
                        </p>
                        <p>指定<code class="codeph">TIMESTAMP</code>数据类型，如下所示：</p><pre class="oac_no_warn" dir="ltr">TIMESTAMP [（ <span class="italic"><code class="codeph">fractional_seconds_precision)</code></span> ]</pre><p><span class="italic"><code class="codeph">fractional_seconds_precision</code></span>是可选的，它指定<code class="codeph">SECOND</code>日期时间字段的小数部分中的位数。它可以是0到9范围内的数字。默认值为6。
                        </p>
                        <p>例如， <code class="codeph">'26-JUN-02 09:39:16.78'</code>显示16.78秒。小数秒精度为2，因为' <code class="codeph">78</code> '中有2位数。
                        </p>
                        <p>您可以使用以下格式指定<code class="codeph">TIMESTAMP</code>文字：</p><pre class="oac_no_warn" dir="ltr">TIMESTAMP'YYYY-MM-DD HH24：MI：SS.FF'</pre><p>使用示例格式，将<code class="codeph">TIMESTAMP</code>指定为文字，如下所示：</p><pre class="oac_no_warn" dir="ltr">TIMESTAMP'1997-01-31 09：26：50.12'</pre><p>当字符串转换为<code class="codeph">TIMESTAMP</code>数据类型时， <code class="codeph">NLS_TIMESTAMP_FORMAT</code>初始化参数的值确定时间戳格式。<code class="codeph">NLS_DATE_LANGUAGE</code>确定用于字符数据的语言，例如<code class="codeph">MON</code> 。</p>
                        <div class="infoboxnotealso" id="GUID-CD2954CE-45E2-4938-A599-CCB96879510F__GUID-4753FB29-60C1-455D-9794-B0C131C95CB4">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">TIMESTAMP</code>数据类型的更多信息，请<a href="../sqlrf/Data-Types.html#SQLRF00203" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="setting-up-globalization-support-environment.html#GUID-0BB80533-A202-4D1A-95BC-0CFA2192DCD2">NLS_TIMESTAMP_FORMAT</a> ”</span></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="setting-up-globalization-support-environment.html#GUID-52E080BC-83F9-43A3-B58C-D5F45CBE10C2">NLS_DATE_LANGUAGE</a> ”</span></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="NLSPG241"></a><div class="props_rev_3"><a id="GUID-5BC5D2C1-6506-49BE-8177-F743A46FDC09" name="GUID-5BC5D2C1-6506-49BE-8177-F743A46FDC09"></a><h5 id="NLSPG-GUID-5BC5D2C1-6506-49BE-8177-F743A46FDC09" class="sect5"><span class="enumeration_section">4.2.1.3</span> TIMESTAMP WITH TIME ZONE数据类型</h5>
                     <div>
                        <p><code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>是<code class="codeph">TIMESTAMP</code>的变体，其值包括时区区域名称或时区偏移量。时区偏移量是本地时间和UTC之间的差异（以小时和分钟为单位） <a id="d33975e999" class="indexterm-anchor"></a><a id="d33975e1002" class="indexterm-anchor"></a><a id="d33975e1004" class="indexterm-anchor"></a> （世界协调时间，以前的格林威治标准时间）。指定<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>数据类型，如下所示：</p><pre class="oac_no_warn" dir="ltr">TIMESTAMP [（ <span class="italic"><code class="codeph">fractional_seconds_precision</code></span> ）] WITH TIME ZONE</pre><p><span class="italic"><code class="codeph">fractional_seconds_precision</code></span>是可选的，它指定<code class="codeph">SECOND</code>日期时间字段的小数部分中的位数。
                        </p>
                        <p>您可以将<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>指定为文字，如下所示：</p><pre class="oac_no_warn" dir="ltr">TIMESTAMP'1997-01-31 09：26：56.66 +02：00'</pre><p>如果两个<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>值代表UTC中的相同时刻，则它们被视为相同，无论数据中存储的<code class="codeph">TIME</code> <code class="codeph">ZONE</code>偏移如何。例如，以下表达式具有相同的值：</p><pre class="oac_no_warn" dir="ltr">TIMESTAMP'1999-01-15 8：00：00 -8：00'TIMESTAMP'1999-01-15 11:00:00 -5:00'</pre><p>您可以使用<code class="codeph">TZR</code> （时区区域）格式元素替换UTC偏移量。以下表达式为时区区域指定<code class="codeph">America/Los_Angeles</code> ：</p><pre class="oac_no_warn" dir="ltr">TIMESTAMP'1999-01-15 8:00:00 America / Los_Angeles'</pre><p>要在时间从标准时间切换到夏令时时消除边界情况的模糊性，请同时使用<code class="codeph">TZR</code>格式元素和相应的<code class="codeph">TZD</code>格式元素。<code class="codeph">TZD</code>格式元素是包含夏令时信息的时区区域的缩写。例如美国太平洋标准时间的<code class="codeph">PST</code>和美国太平洋夏令时的<code class="codeph">PDT</code> 。以下规范确保返回夏令时值：</p><pre class="oac_no_warn" dir="ltr">TIMESTAMP'1999-10-29 01:30:00 America / Los_Angeles PDT'</pre><p>如果未添加<code class="codeph">TZD</code>格式元素，并且日期时间值不明确，则如果将<code class="codeph">ERROR_ON_OVERLAP_TIME</code>会话参数设置为<code class="codeph">TRUE</code> ，Oracle数据库将返回错误。如果<code class="codeph">ERROR_ON_OVERLAP_TIME</code>设置为<code class="codeph">FALSE</code> （默认值），则Oracle数据库会将模糊日期时间解释为标准时间。
                        </p>
                        <p><code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>数据类型的默认日期格式由<code class="codeph">NLS_TIMESTAMP_TZ_FORMAT</code>初始化参数的值确定。
                        </p>
                        <div class="infoboxnotealso" id="GUID-5BC5D2C1-6506-49BE-8177-F743A46FDC09__GUID-4CE0DDFC-8276-4695-8CB2-CFC6BF252BD3">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>数据类型的更多信息，请<a href="../sqlrf/Data-Types.html#SQLRF00204" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-CD2954CE-45E2-4938-A599-CCB96879510F">TIMESTAMP数据类型</a> ”</span>有关小数秒精度的更多信息</p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-E5171DEF-74D7-482A-B4E9-1EE3403E18BC">支持夏令时</a> ”</span></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="setting-up-globalization-support-environment.html#GUID-A00DF2B2-2A01-4517-B8DA-D595788F16B5">NLS_TIMESTAMP_TZ_FORMAT</a> ”</span></p>
                              </li>
                              <li>
                                 <p>有关格式元素的更多信息，请<a href="../sqlrf/Format-Models.html#SQLRF00210" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                              </li>
                              <li>
                                 <p>有关设置<code class="codeph">ERROR_ON_OVERLAP_TIME</code>会话参数的详细信息，请<a href="../sqlrf/ALTER-SESSION.html#SQLRF53052" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="NLSPG242"></a><div class="props_rev_3"><a id="GUID-3F1C388E-C651-43D5-ADBC-1A49E5C2CA05" name="GUID-3F1C388E-C651-43D5-ADBC-1A49E5C2CA05"></a><h5 id="NLSPG-GUID-3F1C388E-C651-43D5-ADBC-1A49E5C2CA05" class="sect5"><span class="enumeration_section">4.2.1.4具有</span>本地时区的TIMESTAMP数据类型</h5>
                     <div>
                        <p><code class="codeph">TIMESTAMP WITH LOCAL TIME ZONE</code>是<code class="codeph">TIMESTAMP</code>另一种变体。它与<code class="codeph">TIMESTAMP WITH TIME ZONE</code>区别如下：存储在数据库中的数据规范化为数据库时区，时区偏移量不作为列数据的一部分存储。当用户检索数据时，Oracle数据库会在用户的本地会话时区中返回该数据。时区偏移量是本地时间和UTC之间的差异（以小时和分钟为单位） <a id="d33975e1275" class="indexterm-anchor"></a><a id="d33975e1277" class="indexterm-anchor"></a><a id="d33975e1279" class="indexterm-anchor"></a> （世界协调时间，以前的格林威治标准时间）。
                        </p>
                        <p>指定<code class="codeph">TIMESTAMP WITH LOCAL TIME ZONE</code>数据类型，如下所示：</p><pre class="oac_no_warn" dir="ltr">TIMESTAMP [（ <span class="italic"><code class="codeph">fractional_seconds_precision</code></span> ）] WITH LOCAL TIME ZONE</pre><p><span class="italic"><code class="codeph">fractional_seconds_precision</code></span>是可选的，它指定<code class="codeph">SECOND</code>日期时间字段的小数部分中的位数。
                        </p>
                        <p><code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">LOCAL</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>没有文字，但<code class="codeph">TIMESTAMP</code>文字和<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>文字可以插入<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">LOCAL</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>列。
                        </p>
                        <p><code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">LOCAL</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>的默认日期格式由<code class="codeph">NLS_TIMESTAMP_FORMAT</code>初始化参数的值确定。
                        </p>
                        <div class="infoboxnotealso" id="GUID-3F1C388E-C651-43D5-ADBC-1A49E5C2CA05__GUID-449C8B96-9BEB-45BA-9BFA-5B688F36FAFF">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">TIMESTAMP WITH LOCAL TIME ZONE</code>数据类型的更多信息，请<a href="../sqlrf/Data-Types.html#SQLRF00205" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-CD2954CE-45E2-4938-A599-CCB96879510F">TIMESTAMP数据类型</a> ”</span>有关小数秒精度的更多信息</p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="setting-up-globalization-support-environment.html#GUID-0BB80533-A202-4D1A-95BC-0CFA2192DCD2">NLS_TIMESTAMP_FORMAT</a> ”</span></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="NLSPG751"></a><a id="NLSPG752"></a><a id="NLSPG753"></a><a id="NLSPG754"></a><a id="NLSPG243"></a><div class="props_rev_3"><a id="GUID-C5DBDD5B-A781-4D2B-8CC2-DB9BB2D335FF" name="GUID-C5DBDD5B-A781-4D2B-8CC2-DB9BB2D335FF"></a><h5 id="NLSPG-GUID-C5DBDD5B-A781-4D2B-8CC2-DB9BB2D335FF" class="sect5"><span class="enumeration_section">4.2.1.5</span>将值插入日期时间数据类型</h5>
                     <div>
                        <div class="section">
                           <p>你可以插入<a id="d33975e1475" class="indexterm-anchor"></a><a id="d33975e1479" class="indexterm-anchor"></a>通过以下方式将值转换为datetime列：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>插入格式基于相应NLS格式值的字符串</p>
                              </li>
                              <li>
                                 <p>插入文字</p>
                              </li>
                              <li>
                                 <p>插入要执行隐式转换的文字</p>
                              </li>
                              <li>
                                 <p>使用<code class="codeph">TO_TIMESTAMP</code> ， <code class="codeph">TO_TIMESTAMP_TZ</code>或<code class="codeph">TO_DATE</code> SQL函数</p>
                              </li>
                           </ul>
                           <p>以下示例显示如何将数据插入到datetime数据类型中。</p>
                           <div class="infoboxnotealso" id="GUID-C5DBDD5B-A781-4D2B-8CC2-DB9BB2D335FF__GUID-EADF521B-F536-4277-A574-028E676BC616">
                              <p class="notep1">也可以看看：</p>
                              <p><span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-429C290A-C201-4272-A369-FF8F4F8E54F7">日期时间SQL函数</a> ”</span> ，以获取有关<code class="codeph">TO_TIMESTAMP</code>或<code class="codeph">TO_TIMESTAMP_TZ</code> SQL函数的更多信息</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-C5DBDD5B-A781-4D2B-8CC2-DB9BB2D335FF__GUID-2FA1A39E-A936-41EC-909F-C43504CA8916">
                           <p class="titleinexample">示例4-1将数据插入DATE列</p>
                           <p>设置日期格式。</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER SESSION SET NLS_DATE_FORMAT ='DD-MON-YYYY HH24：MI：SS';</pre><p>创建一个表<code class="codeph">table_dt</code>的列<code class="codeph">c_id</code>和<code class="codeph">c_dt</code> 。<code class="codeph">c_id</code>列具有<code class="codeph">NUMBER</code>数据类型，有助于识别输入数据的方法。<code class="codeph">c_dt</code>列是<code class="codeph">DATE</code>数据类型。
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE TABLE table_dt（c_id NUMBER，c_dt DATE）;</pre><p>将日期作为字符串插入。</p><pre class="oac_no_warn" dir="ltr">SQL&gt; INSERT INTO table_dt VALUES（1，'01 -JAN-2003'）;</pre><p>插入与<code class="codeph">DATE</code>文字相同的日期。
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; INSERT INTO table_dt VALUES（2，DATE'2003-01-01'）;</pre><p>将日期作为<code class="codeph">TIMESTAMP</code>文字插入。Oracle数据库删除时区信息。
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; INSERT INTO table_dt VALUES（3，TIMESTAMP'2003-01-01 00:00:00 America / Los_Angeles'）;</pre><p>使用<code class="codeph">TO_DATE</code>函数插入日期。
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; INSERT INTO table_dt VALUES（4，TO_DATE（'01 -JAN-2003'，'DD-MON-YYYY'））;</pre><p>显示数据。</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT * FROM table_dt; C_ID C_DT ---------- -------------------- 1 01-JAN-2003 00:00:00 2 01-JAN-2003 00 ：00：00 3 01-JAN-2003 00:00:00 4 01-JAN-2003 00:00:00</pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-C5DBDD5B-A781-4D2B-8CC2-DB9BB2D335FF__GUID-C894235A-2E0A-49A8-BC78-7BEA1CCC8808">
                           <p class="titleinexample">示例4-2将数据插入TIMESTAMP列</p>
                           <p>设置时间戳格式。</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER SESSION SET NLS_TIMESTAMP_FORMAT ='DD-MON-YY HH：MI：SSXFF';</pre><p>创建一个表<code class="codeph">table_ts</code>的列<code class="codeph">c_id</code>和<code class="codeph">c_ts</code> 。<code class="codeph">c_id</code>列具有<code class="codeph">NUMBER</code>数据类型，有助于识别输入数据的方法。<code class="codeph">c_ts</code>列是<code class="codeph">TIMESTAMP</code>数据类型。
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE TABLE table_ts（c_id NUMBER，c_ts TIMESTAMP）;</pre><p>将日期和时间作为字符串插入。</p><pre class="oac_no_warn" dir="ltr">SQL&gt; INSERT INTO table_ts VALUES（1，'01 -JAN-2003 2:00:00'）;</pre><p>插入与<code class="codeph">TIMESTAMP</code>文字相同的日期和时间。
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; INSERT INTO table_ts VALUES（2，TIMESTAMP'2003-01-01 2:00:00'）;</pre><p>插入与<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>文字相同的日期和时间。Oracle数据库将其转换为<code class="codeph">TIMESTAMP</code>值，这意味着删除了时区信息。
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; INSERT INTO table_ts VALUES（3，TIMESTAMP'2003-01-01 2:00:00 -08：00'）;</pre><p>显示数据。</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT * FROM table_ts; C_ID C_TS ---------- ----------------------------- 1 01-JAN-03 02:00 ：00：000000 AM 2 01-JAN-03 02：00：00.000000 AM 3 01-JAN-03 02：00：00.000000 AM</pre><p>请注意，这三种方法会导致存储相同的值。</p>
                        </div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-C5DBDD5B-A781-4D2B-8CC2-DB9BB2D335FF__GUID-359ED73C-033E-4CD8-8730-E071847BD477">
                           <p class="titleinexample">示例4-3使用TIME ZONE数据类型将数据插入TIMESTAMP</p>
                           <p>设置时间戳格式。</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER SESSION SET NLS_TIMESTAMP_TZ_FORMAT ='DD-MON-RR HH：MI：SSXFF AM TZR';</pre><p>将时区设置为<code class="codeph">'-07:00'</code> 。
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER SESSION SET TIME_ZONE =' -  7:00';</pre><p>创建一个表<code class="codeph">table_tstz</code>的列<code class="codeph">c_id</code>和<code class="codeph">c_tstz</code> 。<code class="codeph">c_id</code>列具有<code class="codeph">NUMBER</code>数据类型，有助于识别输入数据的方法。<code class="codeph">c_tstz</code>列是<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>数据类型。
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE TABLE table_tstz（c_id NUMBER，c_tstz TIMESTAMP WITH TIME ZONE）;</pre><p>将日期和时间作为字符串插入。</p><pre class="oac_no_warn" dir="ltr">SQL&gt; INSERT INTO table_tstz VALUES（1，'01 -JAN-2003 2:00:00 AM -07：00'）;</pre><p>插入与<code class="codeph">TIMESTAMP</code>文字相同的日期和时间。Oracle数据库将其转换为<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>文字，这意味着会话时区附加到<code class="codeph">TIMESTAMP</code>值。
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; INSERT INTO table_tstz VALUES（2，TIMESTAMP'2003-01-01 2:00:00'）;</pre><p>插入与<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>文字相同的日期和时间。
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; INSERT INTO table_tstz VALUES（3，TIMESTAMP'2003-01-01 2:00:00 -8：00'）;</pre><p>显示数据。</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT * FROM table_tstz; C_ID C_TSTZ ---------- ------------------------------------ 1 01 -JAN-03 02：00.00：000000 AM -07：00 2 01-JAN-03 02：00：00.000000 AM -07：00 3 01-JAN-03 02：00：00.000000 AM -08：00</pre><p>请注意，方法3的时区不同，因为时区信息被指定为<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>文字的一部分。
                           </p>
                        </div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-C5DBDD5B-A781-4D2B-8CC2-DB9BB2D335FF__GUID-BBA8B250-B90C-42A7-9BAF-86CF9BBB188E">
                           <p class="titleinexample">示例4-4使用LOCAL TIME ZONE数据类型将数据插入TIMESTAMP</p>
                           <p>考虑在美国科罗拉多州丹佛市输入的数据，其时区为UTC-7。</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER SESSION SET TIME_ZONE =' -  07:00';</pre><p>创建一个表<code class="codeph">table_tsltz</code>的列<code class="codeph">c_id</code>和<code class="codeph">c_tsltz</code> 。<code class="codeph">c_id</code>列具有<code class="codeph">NUMBER</code>数据类型，有助于识别输入数据的方法。<code class="codeph">c_tsltz</code>列是<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">LOCAL</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>数据类型。
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE TABLE table_tsltz（c_id NUMBER，c_tsltz TIMESTAMP WITH LOCAL TIME ZONE）;</pre><p>将日期和时间作为字符串插入。</p><pre class="oac_no_warn" dir="ltr">SQL&gt; INSERT INTO table_tsltz VALUES（1，'01 -JAN-2003 2:00:00'）;</pre><p>插入与<code class="codeph">TIMESTAMP WITH LOCAL TIME ZONE</code>文字相同的数据。
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; INSERT INTO table_tsltz VALUES（2，TIMESTAMP'2003-01-01 2:00:00'）;</pre><p>插入与<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>文字相同的数据。Oracle数据库将数据转换为<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">LOCAL</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>值。这意味着输入的时区（ <code class="codeph">-08:00</code> ）将转换为会话时区值（ <code class="codeph">-07:00</code> ）。
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; INSERT INTO table_tsltz VALUES（3，TIMESTAMP'2003-01-01 2:00:00 -08：00'）;</pre><p>显示数据。</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT * FROM table_tsltz; C_ID C_TSLTZ ---------- ------------------------------------ 1 01 -JAN-03 02.00.00.000000 AM 2 01-JAN-03 02.00.00.000000 AM 3 01-JAN-03 03.00.00.000000 AM</pre><p>请注意，以UTC-8输入的信息已更改为本地时区，将小时从<code class="codeph">2</code>更改为<code class="codeph">3</code> 。
                           </p>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="NLSPG244"></a><div class="props_rev_3"><a id="GUID-2DFBD56C-5832-4AE8-831E-7EF1EFB7F0BB" name="GUID-2DFBD56C-5832-4AE8-831E-7EF1EFB7F0BB"></a><h5 id="NLSPG-GUID-2DFBD56C-5832-4AE8-831E-7EF1EFB7F0BB" class="sect5"><span class="enumeration_section">4.2.1.6</span>选择TIMESTAMP数据类型</h5>
                     <div>
                        <p>当您需要datetime值来记录没有时区的事件的时间时，请使用<code class="codeph">TIMESTAMP</code>数据类型。例如，您可以存储有关工作人员将时间卡打入和移出装配线工作站的时间的信息。因为这始终是本地时间，所以不需要存储时区部分。<code class="codeph">TIMESTAMP</code>数据类型使用7或11个字节的存储空间。
                        </p>
                        <p>当datetime值表示将来的本地时间或必须使用该值记录时区信息时，请使用<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>数据类型。考虑当地时间的预约。如果时区定义（例如夏令时规则）发生更改，则可能需要调整将来的本地时间。否则，该值可能会变得不正确。这种数据类型最不受此类影响。
                        </p>
                        <p><code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>数据类型需要13个字节的存储空间，或者比<code class="codeph">TIMESTAMP</code>和<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">LOCAL</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>数据类型多2个字节的存储空间，因为它存储时区信息。时区存储为时区区域名称或UTC的偏移量。无需额外处理即可显示或计算数据。<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>列不能用作主键。如果在<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>列上创建索引，则它将成为基于函数的索引。
                        </p>
                        <p><code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">LOCAL</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>数据类型存储没有时区信息的时间戳。每次向客户端发送数据和从客户端发送数据时，它都会将数据规范化为数据库时区。它需要11个字节的存储空间。
                        </p>
                        <p>当原始时区不感兴趣时， <code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">LOCAL</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>数据类型是合适的，但事件的相对时间很重要，并且夏令时调整不一定准确。由于夏令时调整，此数据类型与数据库时区之间执行的时区转换是不对称的。由于此数据类型不保留时区信息，因此无法区分秋季调整附近的值，无论是夏令时还是标准时。不同时刻之间的这种混淆可能导致应用程序出乎意料地表现，尤其是如果调整发生在用户的正常工作时间内。
                        </p>
                        <p>请注意，一些地区，如巴西和以色列，经常和不定期地更新其夏令时过渡日期，特别容易受到时区调整问题的影响。如果来自这些区域的时间信息对您的应用程序至关重要，您可能需要考虑使用其他日期时间类型之一。</p>
                     </div>
                  </div>
               </div><a id="NLSPG245"></a><div class="props_rev_3"><a id="GUID-773BD5B5-D6AD-4AF6-B38B-EBD1459C8445" name="GUID-773BD5B5-D6AD-4AF6-B38B-EBD1459C8445"></a><h4 id="NLSPG-GUID-773BD5B5-D6AD-4AF6-B38B-EBD1459C8445" class="sect4"><span class="enumeration_section">4.2.2</span>区间数据类型</h4>
                  <div>
                     <p>间隔数据类型存储持续时间。它们主要用于分析功能。例如，您可以使用它们来计算股票价格的移动平均值。您必须使用间隔数据类型来确定与特定百分位数对应的值。你也可以使用<a id="d33975e2155" class="indexterm-anchor"></a><a id="d33975e2157" class="indexterm-anchor"></a>用于更新历史表的间隔数据类型。
                     </p>
                     <p>本节包括以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="datetime-data-types-and-time-zone-support.html#GUID-517CEB46-C6FA-4B94-9299-5BBB5A58CF7B">间隔年到月数据类型</a></p>
                        </li>
                        <li>
                           <p><a href="datetime-data-types-and-time-zone-support.html#GUID-FD8C41B7-8CDC-4D02-8E6B-5250416BC17D">INTERVAL DAY到第二种数据类型</a></p>
                        </li>
                        <li>
                           <p><a href="datetime-data-types-and-time-zone-support.html#GUID-158FDE82-6032-4E94-801D-A71901C5986A">将值插入间隔数据类型</a></p>
                           <div class="infoboxnotealso" id="GUID-773BD5B5-D6AD-4AF6-B38B-EBD1459C8445__GUID-CD1B2A9D-79EA-48A7-ABB6-68879BF43933">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="../dwhsg/sql-analysis-reporting-data-warehouses.html#DWHSG-GUID-20EFBF1E-F79D-4E4A-906C-6E496EECA684" target="_blank"><span class="italic">Oracle数据库数据仓库指南</span></a> ，了解有关分析函数的更多信息，包括移动平均值和反向百分位数</p>
                           </div>
                        </li>
                     </ul>
                  </div><a id="NLSPG246"></a><div class="props_rev_3"><a id="GUID-517CEB46-C6FA-4B94-9299-5BBB5A58CF7B" name="GUID-517CEB46-C6FA-4B94-9299-5BBB5A58CF7B"></a><h5 id="NLSPG-GUID-517CEB46-C6FA-4B94-9299-5BBB5A58CF7B" class="sect5"><span class="enumeration_section">4.2.2.1</span>间隔年月数据类型</h5>
                     <div>
                        <p><code class="codeph">INTERVAL</code> <code class="codeph">YEAR</code> <code class="codeph">TO</code> <code class="codeph">MONTH</code>使用<code class="codeph">YEAR</code>和<code class="codeph">MONTH</code>日期时间字段存储一段时间。<code class="codeph">INTERVAL YEAR TO MONTH</code>指定<code class="codeph">INTERVAL YEAR TO MONTH</code> ：</p><pre class="oac_no_warn" dir="ltr">间隔年[（ <span class="italic"><code class="codeph">year_precision</code></span> ）]到月</pre><p><span class="italic"><code class="codeph">year_precision</code></span>是<code class="codeph">YEAR</code>日期时间字段中的位数。可接受的值为0到9。<span class="italic"><code class="codeph">year_precision</code></span>的默认值为2。
                        </p>
                        <p>间隔值可以指定为文字。有许多方法可以指定区间文字。以下是指定123年和2个月的间隔的一个示例。年精度为3。</p><pre class="oac_no_warn" dir="ltr">INTERVAL'123-2'年（3）至月</pre><div class="infoboxnotealso" id="GUID-517CEB46-C6FA-4B94-9299-5BBB5A58CF7B__GUID-C9E1F398-27DF-4064-A83F-9F65E48916DA">
                           <p class="notep1">也可以看看：</p>
                           <p>有关使用<code class="codeph">INTERVAL YEAR TO MONTH</code>数据类型指定区间文字的详细信息，请参阅<a href="../sqlrf/Data-Types.html#SQLRF00206" target="_blank"><span class="italic">Oracle数据库SQL语言参考</span></a></p>
                        </div>
                     </div>
                  </div><a id="NLSPG247"></a><div class="props_rev_3"><a id="GUID-FD8C41B7-8CDC-4D02-8E6B-5250416BC17D" name="GUID-FD8C41B7-8CDC-4D02-8E6B-5250416BC17D"></a><h5 id="NLSPG-GUID-FD8C41B7-8CDC-4D02-8E6B-5250416BC17D" class="sect5"><span class="enumeration_section">4.2.2.2</span>第二种数据类型的间隔日</h5>
                     <div>
                        <p><code class="codeph">INTERVAL</code> <code class="codeph">DAY</code> <code class="codeph">TO</code> <code class="codeph">SECOND</code>以天，小时，分钟和秒为单位存储一段时间。指定此数据类型如下：</p><pre class="oac_no_warn" dir="ltr">INTERVAL DAY [（ <span class="italic"><code class="codeph">day_precision</code></span> ）] TO SECOND [（ <span class="italic"><code class="codeph">fractional_seconds_precision</code></span> ）]</pre><p><span class="italic"><code class="codeph">day_precision</code></span>是<code class="codeph">DAY</code> datetime字段中的位数。可接受的值为0到9。默认值为2。
                        </p>
                        <p><span class="italic"><code class="codeph">fractional_seconds_precision</code></span>是<code class="codeph">SECOND</code>日期时间字段的小数部分中的位数。可接受的值为0到9。默认值为6。
                        </p>
                        <p>以下是指定4天，5小时，12分钟，10秒和222千分之一秒的间隔的一个示例。小数秒精度为3。</p><pre class="oac_no_warn" dir="ltr">INTERVAL'4 5：12：10.222'第二天（3）</pre><p>间隔值可以指定为文字。有许多方法可以指定区间文字。</p>
                        <div class="infoboxnotealso" id="GUID-FD8C41B7-8CDC-4D02-8E6B-5250416BC17D__GUID-A340F358-3186-41BA-9AAF-6259D92234E5">
                           <p class="notep1">也可以看看：</p>
                           <p>有关使用<code class="codeph">INTERVAL DAY TO SECOND</code>数据类型指定区间文字的详细信息，请<a href="../sqlrf/Data-Types.html#SQLRF00207" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                        </div>
                     </div>
                  </div><a id="NLSPG248"></a><div class="props_rev_3"><a id="GUID-158FDE82-6032-4E94-801D-A71901C5986A" name="GUID-158FDE82-6032-4E94-801D-A71901C5986A"></a><h5 id="NLSPG-GUID-158FDE82-6032-4E94-801D-A71901C5986A" class="sect5"><span class="enumeration_section">4.2.2.3</span>将值插入间隔数据类型</h5>
                     <div>
                        <div class="section">
                           <p>你可以插入<a id="d33975e2517" class="indexterm-anchor"></a><a id="d33975e2521" class="indexterm-anchor"></a>通过以下方式将值放入间隔列：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>插入一个区间作为文字。例如：</p><pre class="oac_no_warn" dir="ltr">插入表1值（区间'4-2'年至月）;</pre><p>此语句插入4年和2个月的间隔。</p>
                                 <p>Oracle数据库可识别其他ANSI间隔类型的文字，并将值转换为Oracle数据库间隔值。</p>
                              </li>
                              <li>
                                 <p>使用<code class="codeph">NUMTODSINTERVAL</code> ， <code class="codeph">NUMTOYMINTERVAL</code> ， <code class="codeph">TO_DSINTERVAL</code>和<code class="codeph">TO_YMINTERVAL</code> SQL函数。
                                 </p>
                                 <div class="infoboxnotealso" id="GUID-158FDE82-6032-4E94-801D-A71901C5986A__GUID-9399D831-1E85-4EA2-8B7B-BC24CFDB932A">
                                    <p class="notep1">也可以看看：</p>
                                    <p><span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-429C290A-C201-4272-A369-FF8F4F8E54F7">日期时间SQL函数</a> ”</span></p>
                                 </div>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="NLSPG249"></a><div class="props_rev_3"><a id="GUID-B6CAA1E5-2A82-42B2-889C-F3F5AFBD53AF" name="GUID-B6CAA1E5-2A82-42B2-889C-F3F5AFBD53AF"></a><h3 id="NLSPG-GUID-B6CAA1E5-2A82-42B2-889C-F3F5AFBD53AF" class="sect3"><span class="enumeration_section">4.3</span>日期时间和区间算术和比较</h3>
               <div>
                  <p>本节包括以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="datetime-data-types-and-time-zone-support.html#GUID-772A1B60-BF0F-43D8-9049-AD0BF4073D9D">日期时间和间隔算术</a></p>
                     </li>
                     <li>
                        <p><a href="datetime-data-types-and-time-zone-support.html#GUID-F29074EF-81CA-48C5-A060-2789EF439256">日期时间比较</a></p>
                     </li>
                     <li>
                        <p><a href="datetime-data-types-and-time-zone-support.html#GUID-81D56D0A-84DF-44F8-A82D-E850AD338153">日期时间数据类型的显式转换</a></p>
                     </li>
                  </ul>
               </div><a id="NLSPG250"></a><div class="props_rev_3"><a id="GUID-772A1B60-BF0F-43D8-9049-AD0BF4073D9D" name="GUID-772A1B60-BF0F-43D8-9049-AD0BF4073D9D"></a><h4 id="NLSPG-GUID-772A1B60-BF0F-43D8-9049-AD0BF4073D9D" class="sect4"><span class="enumeration_section">4。3。1</span>日期时间和间隔算术</h4>
                  <div>
                     <p>您可以在日期（ <code class="codeph">DATE</code> ），时间戳（ <code class="codeph">TIMESTAMP</code> ， <code class="codeph">TIMESTAMP WITH TIME ZONE</code>和<code class="codeph">TIMESTAMP WITH LOCAL TIME ZONE</code> ）和间隔（ <code class="codeph">INTERVAL DAY TO SECOND</code>和<code class="codeph">INTERVAL YEAR TO MONTH</code> ）数据上执行算术运算。通过使用具有间隔数据类型的时间戳数据类型，可以在算术运算中保持最高精度。
                     </p>
                     <p>您可以在日期和时间戳值的算术运算中使用<code class="codeph">NUMBER</code>常量。Oracle数据库在对<code class="codeph">NUMBER</code>常量进行算术运算之前，会在内部将时间戳值转换为日期值。这意味着在包含日期和时间戳值的操作期间，有关小数秒的信息会丢失。Oracle数据库将日期时间和间隔表达式中的<code class="codeph">NUMBER</code>常量解释为天数。
                     </p>
                     <p>每个<code class="codeph">DATE</code>值包含一个时间组件。许多日期操作的结果包括一个分数。该分数表示一天的一部分。例如，1.5天是36小时。这些分数也由Oracle数据库内置SQL函数返回，用于<code class="codeph">DATE</code>数据的常见操作。例如，内置的<code class="codeph">MONTHS_BETWEEN</code> SQL函数返回两个日期之间的月数。结果的小数部分代表31天月份的一部分。
                     </p>
                     <p>Oracle数据库以UTC时间执行所有时间戳算法。对于<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">LOCAL</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>数据，Oracle数据库将日期时间值从数据库时区转换为UTC，并在执行算术后转换回数据库时区。对于<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>数据，日期时间值始终为UTC，因此不需要进行转换。
                     </p>
                     <div class="infoboxnotealso" id="GUID-772A1B60-BF0F-43D8-9049-AD0BF4073D9D__GUID-7F94DA9B-B16C-44BE-BCB6-52CE7D8811BB">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关日期时间和间隔算术运算的详细信息，请<a href="../sqlrf/Data-Types.html#SQLRF00208" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-429C290A-C201-4272-A369-FF8F4F8E54F7">日期时间SQL函数</a> ”，</span>用于获取有关哪些函数导致隐式转换为<code class="codeph">DATE</code></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="NLSPG251"></a><div class="props_rev_3"><a id="GUID-F29074EF-81CA-48C5-A060-2789EF439256" name="GUID-F29074EF-81CA-48C5-A060-2789EF439256"></a><h4 id="NLSPG-GUID-F29074EF-81CA-48C5-A060-2789EF439256" class="sect4"><span class="enumeration_section">4。3。2</span>日期时间比较</h4>
                  <div>
                     <p>比较日期和时间戳值时，Oracle数据库会在进行比较之前将数据转换为更精确的数据类型。例如，如果将<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code>数据类型的数据与<code class="codeph">TIMESTAMP</code>数据类型的数据进行比较，Oracle数据库将使用会话时区将<code class="codeph">TIMESTAMP</code>数据转换为<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME</code> <code class="codeph">ZONE</code> 。
                     </p>
                     <p>转换日期和时间戳数据的优先顺序如下：</p>
                     <ol>
                        <li>
                           <p><code class="codeph">日期</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">TIMESTAMP</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">TIMESTAMP与当地时区</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">TIMESTAMP与时区</code></p>
                        </li>
                     </ol>
                     <p>对于任何数据类型对，Oracle数据库会将前面列表中数字较小的数据类型转换为数字较大的数据类型。</p>
                  </div>
               </div><a id="NLSPG252"></a><div class="props_rev_3"><a id="GUID-81D56D0A-84DF-44F8-A82D-E850AD338153" name="GUID-81D56D0A-84DF-44F8-A82D-E850AD338153"></a><h4 id="NLSPG-GUID-81D56D0A-84DF-44F8-A82D-E850AD338153" class="sect4"><span class="enumeration_section">4.3</span> .3日期时间数据类型的显式转换</h4>
                  <div>
                     <p>如果要显式转换datetime数据类型，请使用<code class="codeph">CAST</code> SQL函数。您可以将<code class="codeph">DATE</code> ， <code class="codeph">TIMESTAMP</code> ， <code class="codeph">TIMESTAMP WITH TIME ZONE</code>和<code class="codeph">TIMESTAMP WITH LOCAL TIME ZONE</code>显式转换为列表中的其他数据类型。
                     </p>
                     <div class="infoboxnotealso" id="GUID-81D56D0A-84DF-44F8-A82D-E850AD338153__GUID-840153B0-F0AC-439F-B4F1-F01AF4309E34">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../sqlrf/CAST.html#SQLRF00613" target="_blank"><span class="italic">Oracle数据库SQL语言参考</span></a></p>
                     </div>
                  </div>
               </div>
            </div><a id="NLSPG755"></a><a id="NLSPG756"></a><a id="NLSPG757"></a><a id="NLSPG253"></a><div class="props_rev_3"><a id="GUID-429C290A-C201-4272-A369-FF8F4F8E54F7" name="GUID-429C290A-C201-4272-A369-FF8F4F8E54F7"></a><h3 id="NLSPG-GUID-429C290A-C201-4272-A369-FF8F4F8E54F7" class="sect3"><span class="enumeration_section">4。4</span>日期时间SQL函数</h3>
               <div>
                  <p>日期时间函数按日期（ <code class="codeph">DATE</code> ），时间戳（ <code class="codeph">TIMESTAMP</code> ， <code class="codeph">TIMESTAMP WITH TIME ZONE</code>和<code class="codeph">TIMESTAMP WITH LOCAL TIME ZONE</code> ）和间隔（ <code class="codeph">INTERVAL DAY TO SECOND</code> ， <code class="codeph">INTERVAL YEAR TO MONTH</code> ）值运行。
                  </p>
                  <p>某些datetime函数是为Oracle Database <code class="codeph">DATE</code>数据类型设计的。如果您提供时间戳值作为其参数，则Oracle数据库在内部将输入类型转换为<code class="codeph">DATE</code>值。Oracle数据库不会对<code class="codeph">ROUND</code>和<code class="codeph">TRUNC</code>函数执行内部转换。
                  </p>
                  <p>下表显示了为Oracle Database <code class="codeph">DATE</code>数据类型设计的日期时间函数。
                  </p>
                  <div class="tblformal" id="GUID-429C290A-C201-4272-A369-FF8F4F8E54F7__G1010956">
                     <p class="titleintable">表4-1为DATE数据类型设计的日期时间函数</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="为DATE数据类型设计的日期时间函数" width="100%" border="1" summary="This table describes datetime functions designed for the DATE data type." frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" id="d33975e3159">功能</th>
                              <th align="left" valign="bottom" id="d33975e3162">描述</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3167" headers="d33975e3159 ">
                                 <p><a href="../sqlrf/ADD_MONTHS.html#SQLRF00603" target="_blank"><code class="codeph">ADD_MONTHS</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3167 d33975e3162 ">
                                 <p>返回日期<span class="italic"><code class="codeph">d</code></span>加<span class="italic"><code class="codeph">n</code></span>个月</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3192" headers="d33975e3159 ">
                                 <p><a href="../sqlrf/LAST_DAY.html#SQLRF00654" target="_blank"><code class="codeph">最后一天</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3192 d33975e3162 ">
                                 <p>返回包含<span class="italic"><code class="codeph">date</code></span>的月份的最后一天</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3212" headers="d33975e3159 ">
                                 <p><a href="../sqlrf/MONTHS_BETWEEN.html#SQLRF00669" target="_blank"><code class="codeph">MONTHS_BETWEEN</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3212 d33975e3162 ">
                                 <p>返回<a id="d33975e3221" class="indexterm-anchor"></a><a id="d33975e3223" class="indexterm-anchor"></a> <span class="italic"><code class="codeph">date1</code></span>和<span class="italic"><code class="codeph">date2</code></span>之间的月数</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3236" headers="d33975e3159 ">
                                 <p><a href="../sqlrf/NEW_TIME.html#SQLRF00671" target="_blank"><code class="codeph">NEW_TIME</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3236 d33975e3162 ">
                                 <p>当<span class="italic"><code class="codeph">zone1</code></span>时区中的日期和时间是<span class="italic"><code class="codeph">date</code></span>时，返回<span class="italic"><code class="codeph">zone2</code></span>时区中的日期和时间</p>
                                 <p><span class="bold">注意：</span>此功能仅将有限数量的时区用作输入。通过组合<code class="codeph">FROM_TZ</code>函数和日期时间表达式，您可以访问更多数量的时区。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3271" headers="d33975e3159 ">
                                 <p><a href="../sqlrf/NEXT_DAY.html#SQLRF00672" target="_blank"><code class="codeph">明天</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3271 d33975e3162 ">
                                 <p>返回由<span class="italic"><code class="codeph">char</code></span>命名的第一个工作日的日期，该<span class="italic"><code class="codeph">date</code></span>晚于<span class="italic"><code class="codeph">date</code></span></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3295" headers="d33975e3159 ">
                                 <p><a href="../sqlrf/ROUND-date.html#SQLRF00699" target="_blank"><code class="codeph">ROUND（日期）</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3295 d33975e3162 ">
                                 <p>将ns <span class="italic"><code class="codeph">date</code></span>舍入舍入为<span class="italic"><code class="codeph">fmt</code></span>格式模型指定的单位</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3320" headers="d33975e3159 ">
                                 <p><a href="../sqlrf/TRUNC-date.html#SQLRF06151" target="_blank"><code class="codeph">TRUNC（日期）</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3320 d33975e3162 ">
                                 <p>返回ns <span class="italic"><code class="codeph">date</code></span> ，截断<span class="italic"><code class="codeph">date</code></span>的时间部分到<span class="italic"><code class="codeph">fmt</code></span>格式模型指定的单位</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <p>下表介绍了其他日期时间函数。</p>
                  <div class="tblformal" id="GUID-429C290A-C201-4272-A369-FF8F4F8E54F7__G1010984">
                     <p class="titleintable">表4-2其他日期时间函数</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="附加日期时间功能" width="100%" border="1" summary="This table describes additional datetime functions." frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" id="d33975e3356">日期时间功能</th>
                              <th align="left" valign="bottom" id="d33975e3359">描述</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3364" headers="d33975e3356 ">
                                 <p><a href="../sqlrf/CURRENT_DATE.html#SQLRF00628" target="_blank"><code class="codeph">当前的日期</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3364 d33975e3359 ">
                                 <p>返回<a id="d33975e3373" class="indexterm-anchor"></a><a id="d33975e3375" class="indexterm-anchor"></a>会话时区中当前日期的公历日历中<code class="codeph">DATE</code>数据类型的值</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3384" headers="d33975e3356 ">
                                 <p><a href="../sqlrf/CURRENT_TIMESTAMP.html#SQLRF00629" target="_blank"><code class="codeph">CURRENT_TIMESTAMP</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3384 d33975e3359 ">
                                 <p>将会话时区中的日期和时间作为<code class="codeph">TIMESTAMP WITH TIME ZONE</code>值返回</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3404" headers="d33975e3356 ">
                                 <p><a href="../sqlrf/DBTIMEZONE.html#SQLRF00630" target="_blank"><code class="codeph">DBTIMEZONE</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3404 d33975e3359 ">
                                 <p>返回值<a id="d33975e3413" class="indexterm-anchor"></a><a id="d33975e3415" class="indexterm-anchor"></a>数据库时区。该值是时区偏移量或时区区域名称</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3421" headers="d33975e3356 ">
                                 <p><a href="../sqlrf/EXTRACT-datetime.html#SQLRF00639" target="_blank"><code class="codeph">EXTRACT</code> （日期时间）</a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3421 d33975e3359 ">
                                 <p>提取和返回日期时间或间隔值表达式中指定的日期时间字段的值</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3439" headers="d33975e3356 ">
                                 <p><a href="../sqlrf/FROM_TZ.html#SQLRF00644" target="_blank"><code class="codeph">FROM_TZ</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3439 d33975e3359 ">
                                 <p>将时区的<code class="codeph">TIMESTAMP</code>值转换为<code class="codeph">TIMESTAMP WITH TIME ZONE</code>值</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3462" headers="d33975e3356 ">
                                 <p><a href="../sqlrf/LOCALTIMESTAMP.html#SQLRF00660" target="_blank"><code class="codeph">LOCALTIMESTAMP</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3462 d33975e3359 ">
                                 <p>返回<a id="d33975e3471" class="indexterm-anchor"></a><a id="d33975e3473" class="indexterm-anchor"></a>会话时区中当前日期和时间的<code class="codeph">TIMESTAMP</code>数据类型的值</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3482" headers="d33975e3356 ">
                                 <p><a href="../sqlrf/NUMTODSINTERVAL.html#SQLRF00682" target="_blank"><code class="codeph">NUMTODSINTERVAL</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3482 d33975e3359 ">
                                 <p>将s号<span class="italic"><code class="codeph">n</code></span>转换为<code class="codeph">INTERVAL DAY TO SECOND</code> literal</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3506" headers="d33975e3356 ">
                                 <p><a href="../sqlrf/NUMTOYMINTERVAL.html#SQLRF00683" target="_blank"><code class="codeph">NUMTOYMINTERVAL</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3506 d33975e3359 ">
                                 <p>转换数字为<span class="italic"><code class="codeph">n</code></span>到<code class="codeph">INTERVAL YEAR TO MONTH</code>字面值</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3530" headers="d33975e3356 ">
                                 <p><a href="../sqlrf/SESSIONTIMEZONE.html#SQLRF06105" target="_blank"><code class="codeph">SESSIONTIMEZONE</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3530 d33975e3359 ">
                                 <p>返回当前会话时区的值</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3547" headers="d33975e3356 ">
                                 <p><a href="../sqlrf/SYS_EXTRACT_UTC.html#SQLRF06119" target="_blank"><code class="codeph">SYS_EXTRACT_UTC</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3547 d33975e3359 ">
                                 <p>Extr从具有时区偏移的日期时间开始执行UTC</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3564" headers="d33975e3356 ">
                                 <p><a href="../sqlrf/SYSDATE.html#SQLRF06124" target="_blank"><code class="codeph">SYSDATE</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3564 d33975e3359 ">
                                 <p>返回数据库所在的操作系统的日期和时间，同时考虑数据库的时区<a id="d33975e3573" class="indexterm-anchor"></a><a id="d33975e3575" class="indexterm-anchor"></a>数据库启动时生效的服务器操作系统</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3582" headers="d33975e3356 ">
                                 <p><a href="../sqlrf/SYSTIMESTAMP.html#SQLRF06125" target="_blank"><code class="codeph">SYSTIMESTAMP</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3582 d33975e3359 ">
                                 <p>返回系统日期，包括数据库所在系统的小数秒和时区</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3599" headers="d33975e3356 ">
                                 <p><a href="../sqlrf/TO_CHAR-character.html#SQLRF06128" target="_blank"><code class="codeph">TO_CHAR</code> （日期时间）</a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3599 d33975e3359 ">
                                 <p>转换a <a id="d33975e3609" class="indexterm-anchor"></a><a id="d33975e3611" class="indexterm-anchor"></a>日期时间或间隔值<code class="codeph">DATE</code> ， <code class="codeph">TIMESTAMP</code> ， <code class="codeph">TIMESTAMP WITH TIME ZONE</code>或<code class="codeph">TIMESTAMP WITH LOCAL TIME ZONE</code>数据类型为<code class="codeph">VARCHAR2</code>数据类型的值，采用<span class="italic"><code class="codeph">fmt</code></span>日期格式指定的格式</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3637" headers="d33975e3356 ">
                                 <p><a href="../sqlrf/TO_DSINTERVAL.html#SQLRF06133" target="_blank"><code class="codeph">TO_DSINTERVAL</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3637 d33975e3359 ">
                                 <p>将<code class="codeph">CHAR</code> ， <code class="codeph">VARCHAR2</code> ， <code class="codeph">NCHAR</code>或<code class="codeph">NVARCHAR2</code>数据类型的字符串字符串转换为<code class="codeph">INTERVAL DAY TO SECOND</code>数据类型的值</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3670" headers="d33975e3356 ">
                                 <p><a href="../sqlrf/TO_NCHAR-datetime.html#SQLRF06137" target="_blank"><code class="codeph">TO_NCHAR</code> （日期时间）</a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3670 d33975e3359 ">
                                 <p>转换日期时间或间隔值<code class="codeph">DATE</code> ， <code class="codeph">TIMESTAMP</code> ， <code class="codeph">TIMESTAMP WITH TIME ZONE</code> ， <code class="codeph">TIMESTAMP WITH LOCAL TIME ZONE</code> ， <code class="codeph">INTERVAL MONTH TO YEAR</code>或<code class="codeph">INTERVAL DAY TO SECOND</code>数据类型从数据库字符集转换为国家字符集</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3700" headers="d33975e3356 ">
                                 <p><a href="../sqlrf/TO_TIMESTAMP.html#SQLRF06142" target="_blank"><code class="codeph">TO_TIMESTAMP</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3700 d33975e3359 ">
                                 <p>将<code class="codeph">CHAR</code> ， <code class="codeph">VARCHAR2</code> ， <code class="codeph">NCHAR</code>或<code class="codeph">NVARCHAR2</code>数据类型的字符串转换为<code class="codeph">TIMESTAMP</code>数据类型的值</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3733" headers="d33975e3356 ">
                                 <p><a href="../sqlrf/TO_TIMESTAMP_TZ.html#SQLRF06143" target="_blank"><code class="codeph">TO_TIMESTAMP_TZ</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3733 d33975e3359 ">
                                 <p>转换ac <a id="d33975e3742" class="indexterm-anchor"></a><a id="d33975e3744" class="indexterm-anchor"></a> <code class="codeph">CHAR</code> ， <code class="codeph">VARCHAR2</code> ， <code class="codeph">NCHAR</code>或<code class="codeph">NVARCHAR2</code>数据类型的字符串，其值为<code class="codeph">TIMESTAMP WITH TIME ZONE</code>数据类型</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3766" headers="d33975e3356 ">
                                 <p><a href="../sqlrf/TO_YMINTERVAL.html#SQLRF06144" target="_blank"><code class="codeph">TO_YMINTERVAL</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3766 d33975e3359 ">
                                 <p>将<code class="codeph">CHAR</code> ， <code class="codeph">VARCHAR2</code> ， <code class="codeph">NCHAR</code>或<code class="codeph">NVARCHAR2</code>数据类型的字符串转换为<code class="codeph">INTERVAL YEAR TO MONTH</code>数据类型的值</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3799" headers="d33975e3356 ">
                                 <p><a href="../sqlrf/TZ_OFFSET.html#SQLRF06152" target="_blank"><code class="codeph">TZ_OFFSET</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3799 d33975e3359 ">
                                 <p>根据语句执行的日期返回与输入值对应的时区偏移量</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <p>下表介绍了与夏令时（DST）升级过程相关的功能。</p>
                  <div class="tblformal" id="GUID-429C290A-C201-4272-A369-FF8F4F8E54F7__CBBICFDB">
                     <p class="titleintable">表4-3时区转换功能</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="时区转换功能" width="100%" border="1" summary="This table lists and describes timezone functions." frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" id="d33975e3827">时区功能</th>
                              <th align="left" valign="bottom" id="d33975e3830">描述</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3835" headers="d33975e3827 ">
                                 <p><a href="../sqlrf/ORA_DST_AFFECTED.html#SQLRF30032" target="_blank"><code class="codeph">ORA_DST_AFFECTED</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3835 d33975e3830 ">
                                 <p>通过将DST规则从一个版本升级到另一个版本，使您能够验证列中的数据是否受到影响</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3852" headers="d33975e3827 ">
                                 <p><a href="../sqlrf/ORA_DST_CONVERT.html#SQLRF30034" target="_blank"><code class="codeph">ORA_DST_CONVERT</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3852 d33975e3830 ">
                                 <p>使您能够将TSTZ列数据从一个版本升级到<a id="d33975e3861" class="indexterm-anchor"></a><a id="d33975e3863" class="indexterm-anchor"></a>另一个</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d33975e3869" headers="d33975e3827 ">
                                 <p><a href="../sqlrf/ORA_DST_ERROR.html#SQLRF30033" target="_blank"><code class="codeph">ORA_DST_ERROR</code></a></p>
                              </td>
                              <td align="left" valign="top" headers="d33975e3869 d33975e3830 ">
                                 <p>使您能够<a id="d33975e3878" class="indexterm-anchor"></a><a id="d33975e3880" class="indexterm-anchor"></a>验证升级datetime值时没有错误</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <div class="infoboxnotealso" id="GUID-429C290A-C201-4272-A369-FF8F4F8E54F7__GUID-39B19E01-FF5B-4CEB-A4EB-0654B3B5A82C">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>有关Oracle数据库日期时间函数的更多信息，请<a href="../sqlrf/Single-Row-Functions.html#SQLRF-GUID-5652DBC2-41C7-4F07-BEDD-DAF620E35F3C" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                        </li>
                        <li>
                           <p><span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-E5171DEF-74D7-482A-B4E9-1EE3403E18BC">支持夏令时</a> ”</span> ，以获取有关Oracle数据库夏令时功能的更多信息</p>
                        </li>
                        <li>
                           <p><span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-7ECF5B82-C3B5-4873-AC78-61080C8F756A">夏令时会话参数</a> ”，</span>用于获取与夏令时相关的会话参数<code class="codeph">ERROR_ON_OVERLAP_TIME</code>信息</p>
                        </li>
                        <li>
                           <p><span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-8B7DFC05-31F1-4843-8E70-3BE5BEE9BFD5">夏令时升级参数</a> ”</span> ，了解有关夏令时升级过程中使用的初始化参数<code class="codeph">DST_UPGRADE_INSERT_CONV</code>信息</p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="NLSPG254"></a><div class="props_rev_3"><a id="GUID-ABF6392E-EBCA-484B-88F1-E69BA3E1721C" name="GUID-ABF6392E-EBCA-484B-88F1-E69BA3E1721C"></a><h3 id="NLSPG-GUID-ABF6392E-EBCA-484B-88F1-E69BA3E1721C" class="sect3"><span class="enumeration_section">4。5</span>日期时间和时区参数和环境变量</h3>
               <div>
                  <p>本节包括以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="datetime-data-types-and-time-zone-support.html#GUID-644948A3-FF6B-4843-9C7A-7EA554862549">日期时间格式参数</a></p>
                     </li>
                     <li>
                        <p><a href="datetime-data-types-and-time-zone-support.html#GUID-3E815FC2-E6AB-4442-8729-915657CEC7A5">时区环境变量</a></p>
                     </li>
                     <li>
                        <p><a href="datetime-data-types-and-time-zone-support.html#GUID-7ECF5B82-C3B5-4873-AC78-61080C8F756A">夏令时会话参数</a></p>
                     </li>
                     <li>
                        <p><a href="datetime-data-types-and-time-zone-support.html#GUID-8B7DFC05-31F1-4843-8E70-3BE5BEE9BFD5">夏令时升级参数</a></p>
                     </li>
                  </ul>
               </div><a id="NLSPG758"></a><a id="NLSPG255"></a><div class="props_rev_3"><a id="GUID-644948A3-FF6B-4843-9C7A-7EA554862549" name="GUID-644948A3-FF6B-4843-9C7A-7EA554862549"></a><h4 id="NLSPG-GUID-644948A3-FF6B-4843-9C7A-7EA554862549" class="sect4"><span class="enumeration_section">4。5。1</span>日期时间格式参数</h4>
                  <div>
                     <p>下表包含日期时间格式参数的名称和说明。</p>
                     <div class="tblformal" id="GUID-644948A3-FF6B-4843-9C7A-7EA554862549__G1011052">
                        <p class="titleintable">表4  -  4日期时间格式参数</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="日期时间格式参数" width="100%" border="1" summary="Datetime format parameters" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="37%" id="d33975e4102">参数</th>
                                 <th align="left" valign="bottom" width="63%" id="d33975e4105">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="37%" id="d33975e4110" headers="d33975e4102 ">
                                    <p><code class="codeph">NLS_DATE_FORMAT</code></p>
                                 </td>
                                 <td align="left" valign="top" width="63%" headers="d33975e4110 d33975e4105 ">
                                    <p>定义<a id="d33975e4117" class="indexterm-anchor"></a>与<code class="codeph">TO_CHAR</code>和<code class="codeph">TO_DATE</code>函数一起使用的默认日期f ormat</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="37%" id="d33975e4136" headers="d33975e4102 ">
                                    <p><code class="codeph">NLS_TIMESTAMP_FORMAT</code></p>
                                 </td>
                                 <td align="left" valign="top" width="63%" headers="d33975e4136 d33975e4105 ">
                                    <p>定义<a id="d33975e4143" class="indexterm-anchor"></a><a id="d33975e4145" class="indexterm-anchor"></a>用于<code class="codeph">TO_CHAR</code>和<code class="codeph">TO_TIMESTAMP</code>函数的默认时间戳格式</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="37%" id="d33975e4157" headers="d33975e4102 ">
                                    <p><code class="codeph">NLS_TIMESTAMP_TZ_FORMAT</code></p>
                                 </td>
                                 <td align="left" valign="top" width="63%" headers="d33975e4157 d33975e4105 ">
                                    <p>定义带有时区格式的默认时间戳，以与<code class="codeph">TO_CHAR</code>和<code class="codeph">TO_TIMESTAMP_TZ</code>函数一起使用</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>它们的默认值来自<code class="codeph">NLS_TERRITORY</code> 。</p>
                     <p>您可以通过在初始化参数文件中设置它们来指定它们的值。如果更改初始化参数文件中的值，则必须重新启动实例才能使更改生效。您还可以将客户端的值指定为客户端环境变量。对于Java客户端， <code class="codeph">NLS_TERRITORY</code>的值派生自JRE的缺省语言环境。初始化参数文件中指定的值不用于JDBC会话。
                     </p>
                     <p>要在会话期间更改其值，请使用<code class="codeph">ALTER SESSION</code>语句。
                     </p>
                     <div class="infoboxnotealso" id="GUID-644948A3-FF6B-4843-9C7A-7EA554862549__GUID-C81DBFE7-4410-498A-868C-60965F6C343F">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="setting-up-globalization-support-environment.html#GUID-2796FB20-5F58-4471-B28D-748C514DEE32">日期和时间参数</a> ”</span>以获取更多信息，包括示例</p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="setting-up-globalization-support-environment.html#GUID-0887A83E-06E1-469A-AA8A-A9A50B8B7B57">NLS_DATE_FORMAT</a> ”</span></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="setting-up-globalization-support-environment.html#GUID-0BB80533-A202-4D1A-95BC-0CFA2192DCD2">NLS_TIMESTAMP_FORMAT</a> ”</span></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="setting-up-globalization-support-environment.html#GUID-A00DF2B2-2A01-4517-B8DA-D595788F16B5">NLS_TIMESTAMP_TZ_FORMAT</a> ”</span></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="NLSPG256"></a><div class="props_rev_3"><a id="GUID-3E815FC2-E6AB-4442-8729-915657CEC7A5" name="GUID-3E815FC2-E6AB-4442-8729-915657CEC7A5"></a><h4 id="NLSPG-GUID-3E815FC2-E6AB-4442-8729-915657CEC7A5" class="sect4"><span class="enumeration_section">4.5.2</span>时区环境变量</h4>
                  <div>
                     <p>该<a id="d33975e4293" class="indexterm-anchor"></a><a id="d33975e4297" class="indexterm-anchor"></a><a id="d33975e4299" class="indexterm-anchor"></a><a id="d33975e4301" class="indexterm-anchor"></a><a id="d33975e4305" class="indexterm-anchor"></a>时区环境变量是：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">ORA_TZFILE</code> ，使您可以在客户端和Oracle数据库服务器上指定时区。请注意，在Oracle数据库服务器上指定<code class="codeph">ORA_TZFILE</code>时，此环境变量生效的唯一时间是在创建数据库期间。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">ORA_SDTZ</code> ，指定默认会话时区。
                           </p>
                           <div class="infoboxnotealso" id="GUID-3E815FC2-E6AB-4442-8729-915657CEC7A5__GUID-2043B787-DC8A-4F13-B865-65A7E425FC7B">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-805AB986-DE12-4FEA-AF56-5AABCD2132DF">选择时区文件</a> ”</span></p>
                                 </li>
                                 <li>
                                    <p><span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-578B5988-31E2-4D0F-ACEA-95C827F6012B">设置会话时区</a> ”</span></p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                     </ul>
                  </div>
               </div><a id="NLSPG257"></a><div class="props_rev_3"><a id="GUID-7ECF5B82-C3B5-4873-AC78-61080C8F756A" name="GUID-7ECF5B82-C3B5-4873-AC78-61080C8F756A"></a><h4 id="NLSPG-GUID-7ECF5B82-C3B5-4873-AC78-61080C8F756A" class="sect4"><span class="enumeration_section">4.5.3</span>夏令时会话参数</h4>
                  <div>
                     <p><code class="codeph">ERROR_ON_OVERLAP_TIME</code>是一个会话参数，用于确定Oracle数据库如何处理不明确的日期时间边界值。当夏令时和标准时间之间的时间变化时，可能会出现不明确的日期时间值。
                     </p>
                     <p>可能的值为<code class="codeph">TRUE</code>和<code class="codeph">FALSE</code> 。当<code class="codeph">ERROR_ON_OVERLAP_TIME</code>为<code class="codeph">TRUE</code> ，当Oracle数据库遇到不明确的日期时间值时，将返回错误。当<code class="codeph">ERROR_ON_OVERLAP_TIME</code>为<code class="codeph">FALSE</code> ，则假定模糊日期时间值是该区域的标准时间表示。默认值为<code class="codeph">FALSE</code> 。</p>
                     <div class="infoboxnotealso" id="GUID-7ECF5B82-C3B5-4873-AC78-61080C8F756A__GUID-FE3A9D91-E52F-4DB5-8516-33F08F61C0EF">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-E5171DEF-74D7-482A-B4E9-1EE3403E18BC">支持夏令时</a> ”</span></p>
                           </li>
                           <li>
                              <p><a href="../sqlrf/ALTER-SESSION.html#SQLRF53052" target="_blank"><span class="italic">Oracle数据库SQL语言参考</span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="NLSPG759"></a><div class="props_rev_3"><a id="GUID-8B7DFC05-31F1-4843-8E70-3BE5BEE9BFD5" name="GUID-8B7DFC05-31F1-4843-8E70-3BE5BEE9BFD5"></a><h4 id="NLSPG-GUID-8B7DFC05-31F1-4843-8E70-3BE5BEE9BFD5" class="sect4"><span class="enumeration_section">4.5.4</span>夏令时升级参数</h4>
                  <div>
                     <p><code class="codeph">DST_UPGRADE_INSERT_CONV</code>是<a id="d33975e4529" class="indexterm-anchor"></a><a id="d33975e4531" class="indexterm-anchor"></a><a id="d33975e4535" class="indexterm-anchor"></a><a id="d33975e4537" class="indexterm-anchor"></a>初始化参数，仅在夏令时（DST）升级过程的升级窗口期间使用。它仅适用于具有<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME ZONE</code>列的表，因为这些是在DST升级期间修改的唯一列。
                     </p>
                     <p>在DST修补过程的升级窗口（在<code class="codeph">DBMS_DST</code>包中描述）中，具有<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIMEZONE</code>数据的表将转换为新的时区版本。尚未转换的表中的列仍将具有反映先前时区版本的<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIMEZONE</code> 。为了在这些列中显示数据，就好像它们在发出<code class="codeph">SELECT</code>语句时已转换为新的时区版本一样，Oracle默认情况下会在列上添加转换运算符以将它们转换为新版本。但是，添加转换运算符可能会减慢查询速度并禁用<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIMEZONE</code>列上的索引<code class="codeph">WITH</code> 。因此，Oracle提供了一个参数<code class="codeph">DST_UPGRADE_INSERT_CONV</code> ，该参数指定是否在尚未升级的表的<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIMEZONE</code>列之上分配内部运算符。默认情况下，其值为<code class="codeph">TRUE</code> 。如果用户知道转换过程不会影响<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIMEZONE</code>列，则可以将此参数设置为<code class="codeph">FALSE</code> 。</p>
                     <p>Oracle强烈建议您在整个DST修补过程中将此参数设置为<code class="codeph">TRUE</code> 。默认情况下，此参数设置为<code class="codeph">TRUE</code> 。但是，如果设置为<code class="codeph">TRUE</code> ，则未转换的表上的查询性能可能会降低。请注意，这仅适用于升级窗口期间。
                     </p>
                     <div class="infoboxnotealso" id="GUID-8B7DFC05-31F1-4843-8E70-3BE5BEE9BFD5__GUID-DE5083C7-DB94-43E3-A614-D9D2D25FB558">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="../refrn/DST_UPGRADE_INSERT_CONV.html#REFRN-GUID-806A8F78-8170-43BC-8C14-42A6D5C24157" target="_blank"><span class="italic">Oracle数据库参考</span></a></p>
                           </li>
                           <li>
                              <p><a href="../arpls/DBMS_DST.html#ARPLS234" target="_blank"><span class="italic">Oracle数据库PL / SQL包和类型参考</span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div><a id="NLSPG258"></a><div class="props_rev_3"><a id="GUID-805AB986-DE12-4FEA-AF56-5AABCD2132DF" name="GUID-805AB986-DE12-4FEA-AF56-5AABCD2132DF"></a><h3 id="NLSPG-GUID-805AB986-DE12-4FEA-AF56-5AABCD2132DF" class="sect3"><span class="enumeration_section">4.6</span>选择时区文件</h3>
               <div>
                  <p>Oracle数据库时区文件包含有效的时区名称。每个时区还包含以下信息：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>协调世界时（UTC）的偏差</p>
                     </li>
                     <li>
                        <p>夏令时的转换时间</p>
                     </li>
                     <li>
                        <p>标准时间和夏令时的缩写</p>
                     </li>
                  </ul>
                  <p>Oracle数据库提供多个版本的时区文件，每种版本都有两种类型的文件：一个包含数据库中定义的所有时区的大文件，以及一个只包含最常用时间的小文件区域。大版本文件命名为<code class="codeph">timezlrg_ <span class="codeinlineitalic">version_number</span> .dat</code> ，小版本文件命名为<code class="codeph">timezone_ <span class="codeinlineitalic">version_number</span> .dat</code> ，其中<code class="codeph"><span class="codeinlineitalic">version_number</span></code>是时区文件的版本号。时区文件存储在<code class="codeph">$ORACLE_HOME/oracore/zoneinfo</code>目录中，默认时区文件是具有最高版本号的大时区文件。在Oracle Database 19c中，默认时区文件是<code class="codeph">$ORACLE_HOME/oracore/zoneinfo/timezlrg_32.dat</code> 。
                  </p>
                  <p>时区文件的示例如下：</p><pre class="oac_no_warn" dir="ltr">$ ORACLE_HOME / oracore / zoneinfo / timezlrg_4.dat  - 大版本4 $ ORACLE_HOME / oracore / zoneinfo / timezone_4.dat  - 小版本4 $ ORACLE_HOME / oracore / zoneinfo / timezlrg_5.dat  - 大版本5 $ ORACLE_HOME / oracore / zoneinfo / timezone_5.dat  - 小版本5</pre><p>在数据库创建过程中，您可以选择服务器的时区版本。此版本已修复，但您可以通过升级过程来获得更高版本。您可以在客户端和服务器上使用不同版本的时区文件，但Oracle建议您不要这样做。这是因为当一个版本上的客户端与不同版本上的服务器通信时会有性能损失。由于<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIME ZONE</code> （TSTZ）数据是使用本地时间戳而不是UTC传输的，因此会产生性能损失。</p>
                  <p>在服务器上，Oracle数据库始终使用大文件。在客户端上，您可以使用大文件或小文件。如果您在客户端上使用大时区文件，那么您应该继续使用它，除非您确定如果切换到较小的信息将不会丢失任何信息。如果使用小文件，则必须确保客户端不查询小时区文件中不存在的数据。否则，您会收到错误消息。</p>
                  <p>您可以在客户端或服务器上启用特定时区文件的使用。如果要在服务器上启用时区文件，则有两种情况。一种是您希望将时区升级到目标版本。有关详细信息，请参阅<span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-B0ACDB2E-4B49-4EB4-B4CC-9260DAE1567A">使用时区数据升级时区文件和时间戳</a> ”</span> 。另一种是当您想要创建新数据库时。在这种情况下，您可以将<code class="codeph">ORA_TZFILE</code>环境变量设置为指向您选择的时区文件。
                  </p>
                  <p>要在客户端上启用特定时区文件，可以将<code class="codeph">ORA_TZFILE</code>设置为所需的任何时区文件。如果未设置<code class="codeph">ORA_TZFILE</code> ，Oracle数据库将自动选择并使用具有最新时区版本的文件。
                  </p>
                  <div class="infoboxnotealso" id="GUID-805AB986-DE12-4FEA-AF56-5AABCD2132DF__GUID-B9F5450C-2420-4C9D-AFE2-9F8C733E13EE">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="../lnoci/index.html" target="_blank"><span class="italic">Oracle Call Interface Programmer's Guide</span></a> ，了解有关如何在客户端上升级夏令时的更多信息</p>
                  </div>
                  <div class="infoboxnote" id="GUID-805AB986-DE12-4FEA-AF56-5AABCD2132DF__GUID-CA1EA8A4-E7F0-4D15-9778-20923F404449">
                     <p class="notep1">注意：</p>
                     <p>Oracle数据库时区数据源自<span class="italic"><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/nlspg&amp;id=iana_time_zones" target="_blank">IANA职能</a></span>网站上提供的公共域信息。Oracle数据库时区数据可能无法反映此网站上提供的最新数据。
                     </p>
                  </div>
                  <p>您可以通过输入以下语句从数据库中安装的时区文件中获取时区名称和时区缩写列表：</p><pre class="oac_no_warn" dir="ltr">选择TZNAME，TZABBREV来自V $ TIMEZONE_NAMES订购TZNAME，TZABBREV;</pre><p>对于默认时区文件，此语句将产生类似于以下内容的输出：</p><pre class="oac_no_warn" dir="ltr">TZNAME TZABBREV -------------------- ----------非洲/阿比让GMT非洲/阿比让LMT ......非洲/阿尔及尔CEST非洲/阿尔及尔CET非洲/阿尔及尔LMT非洲/阿尔及尔PMT非洲/阿尔及尔WET非洲/阿尔及尔西...WET LMT WET WEST WET WET选择了2137行。
</pre><p>在上面的输出中，2个时区缩写与非洲/阿比让时区相关联，6个缩写与非洲/阿尔及尔时区相关联。下表显示了一些时区缩写及其含义。</p>
                  <div class="tblformal" id="GUID-805AB986-DE12-4FEA-AF56-5AABCD2132DF__GUID-C74C8481-6D12-4E61-8328-658B4936A3F3">
                     <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="This table is described in the preceding text" frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="49%" id="d33975e4846">时区缩写</th>
                              <th align="left" valign="bottom" width="51%" id="d33975e4849">含义</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="49%" id="d33975e4854" headers="d33975e4846 ">
                                 <p>LMT</p>
                              </td>
                              <td align="left" valign="top" width="51%" headers="d33975e4854 d33975e4849 ">
                                 <p>当地平均时间</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="49%" id="d33975e4861" headers="d33975e4846 ">
                                 <p>PMT</p>
                              </td>
                              <td align="left" valign="top" width="51%" headers="d33975e4861 d33975e4849 ">
                                 <p>巴黎平均时间</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="49%" id="d33975e4868" headers="d33975e4846 ">
                                 <p>湿</p>
                              </td>
                              <td align="left" valign="top" width="51%" headers="d33975e4868 d33975e4849 ">
                                 <p>西欧时间</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="49%" id="d33975e4875" headers="d33975e4846 ">
                                 <p>西方</p>
                              </td>
                              <td align="left" valign="top" width="51%" headers="d33975e4875 d33975e4849 ">
                                 <p>西欧夏令时</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="49%" id="d33975e4882" headers="d33975e4846 ">
                                 <p>CET</p>
                              </td>
                              <td align="left" valign="top" width="51%" headers="d33975e4882 d33975e4849 ">
                                 <p>中欧时间</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="49%" id="d33975e4889" headers="d33975e4846 ">
                                 <p>CEST</p>
                              </td>
                              <td align="left" valign="top" width="51%" headers="d33975e4889 d33975e4849 ">
                                 <p>中欧夏令时</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="49%" id="d33975e4896" headers="d33975e4846 ">
                                 <p>欧洲东部时间</p>
                              </td>
                              <td align="left" valign="top" width="51%" headers="d33975e4896 d33975e4849 ">
                                 <p>东欧时间</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="49%" id="d33975e4903" headers="d33975e4846 ">
                                 <p>EEST</p>
                              </td>
                              <td align="left" valign="top" width="51%" headers="d33975e4903 d33975e4849 ">
                                 <p>东欧夏令时</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <p>请注意，缩写可以与多个时区相关联。例如，CET与非洲/阿尔及尔和非洲/卡萨布兰卡以及欧洲的时区有关。</p>
                  <p>如果您需要时区列表而不重复每个缩写的时区名称，请使用以下查询：</p><pre class="oac_no_warn" dir="ltr">从V $ TIMEZONE_NAMES中选择UNIQUE TZNAME;</pre><p>例如，版本11包含类似于以下内容的输出：</p><pre class="oac_no_warn" dir="ltr">TZNAME --------------------非洲/ Addis_Ababa非洲/比绍非洲/ Ceuta ......土耳其美国/东印第安纳州美国/萨摩亚</pre><p>默认时区文件，即大时区文件包含超过350个唯一时区名称。小时区文件包含180多个唯一的时区名称。</p>
                  <div class="infoboxnotealso" id="GUID-805AB986-DE12-4FEA-AF56-5AABCD2132DF__GUID-8D2EB05A-AC95-457C-AB87-B0EA4A86983C">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="q">“ <a href="appendix-A-locale-data.html#GUID-21D14370-A707-4482-A3FE-9277263F292A">时区区域名称</a> ”</span> ，以获取有效的Oracle数据库时区名称列表</p>
                        </li>
                        <li>
                           <p><code class="codeph">$ORACLE_HOME/oracore/zoneinfo/timezdif.csv</code>随Oracle数据库软件安装<code class="codeph">$ORACLE_HOME/oracore/zoneinfo/timezdif.csv</code>提供，以获取每个版本的时区文件中更改的时区的完整列表。
                           </p>
                        </li>
                        <li>
                           <p><a href="../upgrd/using-preupgrade-information-tool-for-oracle-database.html#UPGRD52789" target="_blank"><span class="italic">Oracle数据库升级指南，</span></a>了解升级信息</p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="NLSPG259"></a><div class="props_rev_3"><a id="GUID-B0ACDB2E-4B49-4EB4-B4CC-9260DAE1567A" name="GUID-B0ACDB2E-4B49-4EB4-B4CC-9260DAE1567A"></a><h3 id="NLSPG-GUID-B0ACDB2E-4B49-4EB4-B4CC-9260DAE1567A" class="sect3"><span class="enumeration_section">4.7</span>使用时区数据升级时区文件和时间戳</h3>
               <div>
                  <p>随Oracle Database提供的时区文件会定期更新，以反映各个时区区域的转换规则的更改。要查找数据库当前使用的时区文件，请查询<code class="codeph">V$TIMEZONE_FILE</code>视图。
                  </p>
                  <div class="infoboxnote" id="GUID-B0ACDB2E-4B49-4EB4-B4CC-9260DAE1567A__GUID-899C0F64-8DC4-4EE0-8D87-81C92B6BF606">
                     <p class="notep1">注意：</p>
                     <p>每个Oracle数据库发行版都包含一个时区文件，该文件在发布时是最新的，还包含许多旧版本文件。在Oracle数据库版本之间，可以在补丁集或单个补丁中提供新的时区文件版本，以反映各个时区区域的转换规则的更改。较旧的时区文件版本允许您运行升级的数据库，而无需立即将时区文件升级到最新版本。</p>
                  </div>
                  <div class="section">
                     <p class="subhead2" id="GUID-B0ACDB2E-4B49-4EB4-B4CC-9260DAE1567A__GUID-B597ECC1-15A5-4E81-8396-1ADD9DE6963B">夏令时（DST）转换规则更改</p>
                     <p>政府可以而且确实改变夏令时生效或如何处理的规则。发生这种情况时，Oracle提供了一组新的转换规则，用于处理带有时区数据的时间戳。</p>
                     <p>在处理带有时区数据的时间戳时，夏令时开始或结束的过渡期可能会引入问题（例如数据丢失）。Oracle提供了PL / SQL包<code class="codeph">DBMS_DST</code>和<code class="codeph">utltz_*</code>脚本来处理这种转换。
                     </p>
                     <p>由于Oracle数据库在内部存储此数据的方式，对DST转换规则的更改可能会影响<code class="codeph">TIMESTAMP WITH TIME ZONE</code>数据类型的现有数据。当用户输入带时区的时间戳时，Oracle数据库会根据时区文件中的转换规则将数据转换为UTC，并将数据与原始时区的ID一起存储在磁盘上。检索数据时，会发生UTC的反向转换。例如，在过去，在版本2转换规则下，值<code class="codeph">TIMESTAMP</code> <code class="codeph">'2007-11-02 12:00:00 America/Los_Angeles'</code>被存储为UTC值<code class="codeph">'2007-11-02 20:00:00'</code>加上时区ID。洛杉矶的时间存储为UTC减去8小时（PST）。在转换规则的第3版中，同一天的偏移量为负七小时（PDT）。从2007年开始，DST的实施时间更长（直到11月的第一个星期日，即2007年的11月4日）。现在，当用户检索相同的时间戳并将新的偏移量添加到存储的UTC时间时，他们会收到<code class="codeph">TIMESTAMP</code> <code class="codeph">'2007-11-02 13:00:00 America/Los_Angeles'</code> 。与版本3生效之前的数据相比，有一个小时的差异。
                     </p>
                     <div class="infoboxnote" id="GUID-B0ACDB2E-4B49-4EB4-B4CC-9260DAE1567A__GUID-5A4C76E7-31F8-4DBC-A853-F69DD5875063">
                        <p class="notep1">注意：</p>
                        <p>对于已更新其转换规则的任何时区区域，本节中讨论的升级过程仅影响指向相对于相应DST规则更改的生效日期的未来的时间戳。例如，2007年之前的时间戳不会受到对<code class="codeph">'America/Los_Angeles'</code>时区的版本3更改的影响。
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-B0ACDB2E-4B49-4EB4-B4CC-9260DAE1567A__GUID-AD4497F6-9F58-4AEA-9722-CB0E53B18BB9">准备使用时区数据升级时区文件和时间戳</p>
                     <p>在实际升级任何数据（即数据库中的<code class="codeph">TIMESTAMP WITH TIME ZONE (TSTZ)</code>数据<code class="codeph">TIMESTAMP WITH TIME ZONE (TSTZ)</code> ，您应该验证升级可能产生的影响。通常，您可以将升级过程视为具有两个单独的子过程 - 准备和升级。要准备升级，请启动一个准备窗口，该窗口是您检查数据库中必须更新的数据量的时间。要升级，请启动升级窗口，这是实际发生数据更改的时间。
                     </p>
                     <p>虽然不是必需的，但Oracle强烈建议您执行准备步骤。除了了解升级过程中需要修改多少数据外，还可以估算升级所需的时间，您还可以看到可能遇到的任何语义错误。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-B0ACDB2E-4B49-4EB4-B4CC-9260DAE1567A__GUID-07D68C22-0CEC-43F9-8481-EDB6D589D6B4">使用时区数据升级时区文件和时间戳的方法</p>
                     <p>您可以使用以下任一方法，根据最新发布的时区文件升级数据库中的时区数据：</p>
                     <ul id="GUID-B0ACDB2E-4B49-4EB4-B4CC-9260DAE1567A__UL_YM1_MYN_4GB" style="list-style-type:disc">
                        <li>
                           <p><a href="datetime-data-types-and-time-zone-support.html#GUID-8815B03F-473E-4E77-919B-7A3066442C21">使用utltz_ *脚本升级时区数据</a></p>
                        </li>
                        <li>
                           <p><a href="datetime-data-types-and-time-zone-support.html#GUID-42DDBBFA-FF58-41B6-81A1-515FD7968A38">使用DBMS_DST包升级时区数据</a></p>
                        </li>
                     </ul>
                     <p>从Oracle Database 18c开始引入使用<code class="codeph">utltz_*</code>脚本的升级方法，与使用<code class="codeph">DBMS_DST</code>包的方法相比，更容易实现。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div class="sect3"><a id="GUID-8815B03F-473E-4E77-919B-7A3066442C21" name="GUID-8815B03F-473E-4E77-919B-7A3066442C21"></a><h4 id="NLSPG-GUID-8815B03F-473E-4E77-919B-7A3066442C21" class="sect4"><span class="enumeration_section">4.7.1</span>使用utltz_ *脚本升级时区数据</h4>
                  <div>
                     <p>本节包含以下与使用<code class="codeph">utltz_*</code>脚本进行时区数据升级相关的主题。
                     </p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="datetime-data-types-and-time-zone-support.html#GUID-AD43E0FF-516C-4E6A-BF80-74B8940D7ACF">准备窗口</a></p>
                        </li>
                        <li>
                           <p><a href="datetime-data-types-and-time-zone-support.html#GUID-599FB3E6-F0D5-473A-8A24-49CCC4928F24">升级窗口</a></p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-8815B03F-473E-4E77-919B-7A3066442C21__GUID-55AD1CDA-3BA2-40FD-AB19-B6C7FECAA32A">
                        <p class="notep1">注意：</p>
                        <p>这种使用<code class="codeph">utltz_*</code>脚本的升级方法从Oracle Database 18c开始引入，与使用<code class="codeph">DBMS_DST</code>包升级数据库中的时区数据的其他升级方法相比，更容易实现。
                        </p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-8815B03F-473E-4E77-919B-7A3066442C21__GUID-F211A414-8505-4006-AF24-04E3729A94C4">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-42DDBBFA-FF58-41B6-81A1-515FD7968A38">使用DBMS_DST包升级时区数据</a> ”</span></p>
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-AD43E0FF-516C-4E6A-BF80-74B8940D7ACF" name="GUID-AD43E0FF-516C-4E6A-BF80-74B8940D7ACF"></a><h5 id="NLSPG-GUID-AD43E0FF-516C-4E6A-BF80-74B8940D7ACF" class="sect5"><span class="enumeration_section">4.7.1.1</span>准备窗口</h5>
                     <div>
                        <div class="section">
                           <p>在准备窗口期间，您可以运行<code class="codeph">$ORACLE_HOME/rdbms/admin</code>目录中的以下任何脚本，以检查在时区数据升级期间需要在数据库中更新的数据量：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">utltz_countstats.sql</code></p>
                                 <p>此脚本显示具有<code class="codeph">TIMESTAMP WITH TIME ZONE</code> （TSTZ）数据的所有表的<code class="codeph">num_rows</code>的优化程序统计信息。
                                 </p>
                                 <div class="infoboxnote" id="GUID-AD43E0FF-516C-4E6A-BF80-74B8940D7ACF__GUID-43A717AC-7666-49E7-A8B6-2C03D77779E0">
                                    <p class="notep1">注意：</p>
                                    <p>运行<code class="codeph">utltz_countstats.sql</code>只有当数据库优化的统计数据是最新的脚本，否则运行<code class="codeph">utltz_countstar.sql</code>脚本。如果运行<code class="codeph">utltz_countstats.sql</code>脚本，则无需运行<code class="codeph">utltz_countstar.sql</code>脚本。
                                    </p>
                                 </div>
                              </li>
                              <li>
                                 <p><code class="codeph">utltz_countstar.sql</code></p>
                                 <p>此脚本显示具有<code class="codeph">TIMESTAMP WITH TIME ZONE</code> （TSTZ）数据的所有表的<code class="codeph">count(*)</code>操作的结果。
                                 </p>
                                 <div class="infoboxnote" id="GUID-AD43E0FF-516C-4E6A-BF80-74B8940D7ACF__GUID-6132D54F-F133-4FFF-81F3-9273388DD323">
                                    <p class="notep1">注意：</p>
                                    <p><code class="codeph">utltz_countstar.sql</code>脚本可能需要相当长的时间才能完成执行。
                                    </p>
                                 </div>
                              </li>
                           </ul>
                           <p><code class="codeph">DBMS_SCHEDULER</code>表通常包含大量时区数据。如果不需要此表中的数据，请在运行升级步骤之前使用以下命令将其删除。如果一系列作业中的某些主要作业仍在运行，则在运行此命令之前停止主要作业，因为它可能无法从<code class="codeph">DBMS_SCHEDULER</code>表中删除所有数据。
                           </p><pre class="pre codeblock"><code>exec dbms_scheduler.purge_log;</code></pre><p>可能包含大量时区数据的其他表是<code class="codeph">SYS.WRI$_OPTSTAT_HISTGRM_HISTORY</code>和<code class="codeph">SYS.WRI$_OPTSTAT_HISTHEAD_HISTORY</code>表。如果您不需要此数据，则可以使用以下命令将其删除：</p><pre class="pre codeblock"><code>- 检查表中的行数，从SYS.WRI $ _OPTSTAT_HISTGRM_HISTORY中选择count（*）;从SYS.WRI $ _OPTSTAT_HISTHEAD_HISTORY中选择count（*）; - 检查统计数据的数据保留期 - 默认值为31选择systimestamp  -  dbms_stats.get_stats_history_availability from dual; - 禁用统计信息保留exec dbms_stats.alter_stats_history_retention（0）; - 删除所有stats exec DBMS_STATS.PURGE_STATS（systimestamp）; - 检查清除操作的结果从SYS.WRI $ _OPTSTAT_HISTGRM_HISTORY中选择计数（*）;从SYS.WRI $ _OPTSTAT_HISTHEAD_HISTORY中选择count（*）;</code></pre><p>完成时区数据升级后，您可以使用以下命令将数据保留期设置回其原始值：</p><pre class="pre codeblock"><code>exec dbms_stats.alter_stats_history_retention（31）;</code></pre></div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-599FB3E6-F0D5-473A-8A24-49CCC4928F24" name="GUID-599FB3E6-F0D5-473A-8A24-49CCC4928F24"></a><h5 id="NLSPG-GUID-599FB3E6-F0D5-473A-8A24-49CCC4928F24" class="sect5"><span class="enumeration_section">4.7.1.2</span>升级窗口</h5>
                     <div>
                        <div class="section">
                           <p>在升级窗口期间，您可以运行<code class="codeph">$ORACLE_HOME/rdbms/admin</code>目录中的以下脚本来升级数据库中的时区数据：</p>
                           <ol>
                              <li>
                                 <p>从<code class="codeph">$ORACLE_HOME</code>目录运行<code class="codeph">utltz_upg_check.sql</code>脚本：</p><pre class="pre codeblock"><code>spool utltz_upg_check.log @ utltz_upg_check.sql spool off</code></pre><p>成功执行脚本后，屏幕上会显示以下信息：</p><pre class="pre codeblock"><code>信息：找到比当前使用的版本更新的RDBMS DST版本。信息：请注意，尚未完成DST更新。信息：现在运行utltz_upg_apply.sql来进行实际的RDBMS DST更新。信息：请注意，utltz_upg_apply.sql脚本将INFO：重启数据库2次没有任何确认或提示。</code></pre><p>该脚本还会在<code class="codeph">alert.log</code>文件中写入以下信息：</p>
                                 <p><code class="codeph">utltz_upg_check成功找到了更新的RDBMS DSTv <span class="codeinlineitalic">new_time_zone_version</span>并运行了<span class="codeinlineitalic">number_of_minutes</span>分钟。</code></p>
                                 <p>如果<code class="codeph">utltz_upg_check.sql</code>脚本显示以下错误，请检查屏幕上显示的上一条消息并继续。
                                 </p>
                                 <p><code class="codeph">ORA-20 <span class="codeinlineitalic">xxx</span> ：停止脚本 - 请参阅上一条消息...</code></p>
                              </li>
                              <li>
                                 <p>成功执行<code class="codeph">utltz_upg_check.sql</code>脚本后，从<code class="codeph">$ORACLE_HOME</code>目录运行<code class="codeph">utltz_upg_apply.sql</code>脚本：</p><pre class="pre codeblock"><code>spool utltz_upg_apply.log @ utltz_upg_apply.sql spool off</code></pre><div class="infoboxnote" id="GUID-599FB3E6-F0D5-473A-8A24-49CCC4928F24__GUID-8C5DCC4E-2A06-4F4A-9CED-5164305EA829">
                                    <p class="notep1">注意：</p>
                                    <p>以下是运行<code class="codeph">utltz_upg_apply.sql</code>脚本的先决条件：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p>在时区升级过程中，任何应用程序都不应在数据库中查询或插入时区数据。</p>
                                       </li>
                                       <li>
                                          <p>在RAC环境中，必须将RAC数据库作为单个数据库实例启动。</p>
                                       </li>
                                       <li>
                                          <p>在多租户环境中，必须先关闭所有PDB，然后再在CDB上运行<code class="codeph">utltz_upg_apply.sql</code>脚本。</p>
                                       </li>
                                    </ul>
                                    <p>另请注意以下事项：</p>
                                    <ul id="GUID-599FB3E6-F0D5-473A-8A24-49CCC4928F24__UL_MJJ_VSP_TGB" style="list-style-type:disc">
                                       <li>
                                          <p><code class="codeph">utltz_upg_apply.sql</code>脚本在执行期间会多次自动重启数据库。
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">utltz_upg_apply.sql</code>脚本的执行时间通常比<code class="codeph">utltz_upg_check.sql</code>脚本少。
                                          </p>
                                       </li>
                                    </ul>
                                 </div>
                                 <p>成功执行<code class="codeph">utltz_upg_apply.sql</code>脚本后，屏幕上会显示以下信息：</p><pre class="pre codeblock"><code>信息：RDBMS DST更新已成功完成。信息：确保退出此sqlplus会话。信息：不要将它用于与时区相关的选择。</code></pre><p>现在， <code class="codeph">Registry$database</code>表中的<code class="codeph">TZ_VERSION</code>列将使用新的时区版本进行更新。
                                 </p>
                                 <p>如果脚本显示以下错误消息，请检查屏幕上显示的上一条消息并继续。</p>
                                 <p><code class="codeph">ORA-20 <span class="codeinlineitalic">xxx</span> ：停止脚本 - 请参阅上一条消息...</code></p>
                              </li>
                           </ol>
                           <div class="infoboxnote" id="GUID-599FB3E6-F0D5-473A-8A24-49CCC4928F24__GUID-7ADC8A41-B509-45C5-BA7D-2939BA7B0DAD">
                              <p class="notep1">注意：</p>
                              <p>如果要查看正在执行脚本<code class="codeph">utltz_upg_check.sql</code>和<code class="codeph">utltz_upg_apply.sql</code>时发生的情况，请运行以下命令：</p><pre class="pre codeblock"><code>设置PAGES 1000  - 查询V $ SESSION_LONGOPS视图从V $ SESSION_LONGOPS中选择TARGET，TO_CHAR（START_TIME，'HH24：MI：SS  -  DD-MM-YY'），TIME_REMAINING，SOFAR，TOTALWORK，SID，SERIAL＃，OPNAME sid in（从V $ SESSION选择SID，其中CLIENT_INFO ='upg_tzv'）和SOFAR &lt;TOTALWORK顺序由START_TIME; - 查询V $ SESSION和V $ SQLAREA视图选择S.SID，S.SERIAL＃，S.SQL_ID，S.PREV_SQL_ID，S.EVENT＃，S.EVENT，S.P1TEXT，S.P1，S.P2TEXT ，S.P2，S.P3TEXT，S.P3，S.TIME_REMAINING_MICRO，S.SEQ＃，S.BLOCKING_SESSION，BS.PROGRAM“Blocking Program”，Q1。SQL_TEXT“当前SQL”，Q2。来自V $ SESSION S的SQL_TEXT“Previous SQL”，V $ SQLAREA Q1，V $ SQLAREA Q2，V $ SESSION BS，其中S.SQL_ID = Q1。SQL_ID（+）和S.PREV_SQL_ID = Q2。SQL_ID（+）和S.BLOCKING_SESSION = BS.SID（+）和S.CLIENT_INFO ='upg_tzv';</code></pre></div>
                           <div class="infoboxnote" id="GUID-599FB3E6-F0D5-473A-8A24-49CCC4928F24__GUID-DEF43451-69AE-490D-A691-ADC6EB3A2ACC">
                              <p class="notep1">注意：</p>
                              <p>以下是与多租户环境中的时区升级相关的一些注意事项：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>更新CDB的时区版本不会更改PDB的时区版本。</p>
                                 </li>
                                 <li>
                                    <p>更新PDB的时区版本不会更改其他PDB的时区版本。</p>
                                 </li>
                                 <li>
                                    <p>始终为新PDB分配<code class="codeph">PDB$SEED</code>的时区版本。</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">PDB$SEED</code>始终在创建CDB时分配时区版本。<code class="codeph">PDB$SEED</code>的时区版本无法更改。
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-42DDBBFA-FF58-41B6-81A1-515FD7968A38" name="GUID-42DDBBFA-FF58-41B6-81A1-515FD7968A38"></a><h4 id="NLSPG-GUID-42DDBBFA-FF58-41B6-81A1-515FD7968A38" class="sect4"><span class="enumeration_section">4.7.2</span>使用DBMS_DST包升级时区数据</h4>
                  <div>
                     <p>本节包含与使用<code class="codeph">DBMS_DST</code>程序包进行时区数据升级相关的以下主题。
                     </p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="datetime-data-types-and-time-zone-support.html#GUID-F0283FDA-7BA0-4D28-BBBD-80CD5538DD4B">准备窗口</a></p>
                        </li>
                        <li>
                           <p><a href="datetime-data-types-and-time-zone-support.html#GUID-12830F09-735F-4E25-B141-42B4776A110A">升级窗口</a></p>
                        </li>
                        <li>
                           <p><a href="datetime-data-types-and-time-zone-support.html#GUID-AD9EFCFB-CBEA-4BE2-A91E-9CC2A28CB199">升级示例</a></p>
                        </li>
                        <li>
                           <p><a href="datetime-data-types-and-time-zone-support.html#GUID-6377A1C4-F76A-4C53-82CD-BF4AE6148D6D">升级错误处理</a></p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-42DDBBFA-FF58-41B6-81A1-515FD7968A38__GUID-F211A414-8505-4006-AF24-04E3729A94C4">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-8815B03F-473E-4E77-919B-7A3066442C21">使用utltz_ *脚本升级时区数据</a> ”</span></p>
                     </div>
                  </div><a id="NLSPG760"></a><div class="props_rev_3"><a id="GUID-F0283FDA-7BA0-4D28-BBBD-80CD5538DD4B" name="GUID-F0283FDA-7BA0-4D28-BBBD-80CD5538DD4B"></a><h5 id="NLSPG-GUID-F0283FDA-7BA0-4D28-BBBD-80CD5538DD4B" class="sect5"><span class="enumeration_section">4.7.2.1</span>准备窗口</h5>
                     <div>
                        <div class="section">
                           <p>在准备窗口期间，您可以使用以下步骤获取有关在时区升级过程中将受影响的数据的信息：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li><span>安装所需的时区文件版本，稍后将迁移到<code class="codeph">$ORACLE_HOME/oracore/zoneinfo</code> 。如果所需版本是<code class="codeph"><span class="codeinlineitalic">version_number</span></code> ，则必须添加文件<code class="codeph">timezlrg_ <span class="codeinlineitalic">version_number</span> .dat</code> 。您可以稍后自行添加文件<code class="codeph">timezone_ <span class="codeinlineitalic">version_number</span> .dat</code> 。可以在My Oracle Support上找到这些文件。所需的版本应该是可用的最新版本，除非最新版本包含相关的DST规则更改，这些更改在版本发布后由相应的政府回滚。</span></li>
                           <li><span>您可以选择创建以下表格：</span><ul>
                                 <li>
                                    <p>一个错误表，其中包含使用<code class="codeph">DBMS_DST.CREATE_ERROR_TABLE</code>过程在升级过程中生成的错误。如果未显式创建此表，则使用的默认表为<code class="codeph">sys.dst$error_table</code> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p>通过使用<code class="codeph">DBMS_DST.CREATE_AFFECTED_TABLE</code>过程包含受时区信息影响的时间戳的表。如果未显式创建此表，则使用的默认表为<code class="codeph">sys.dst$affected_tables</code> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p>存储禁用的TSTZ表的触发器表通过使用<code class="codeph">DBMS_DST.CREATE_TRIGGER_TABLE</code>过程触发信息。如果未显式创建此表，则使用的默认表为<code class="codeph">sys.dst$trigger_table</code> 。请注意，在升级窗口期间，Oracle数据库首先禁用TSTZ表上的触发器，然后执行其受影响的TSTZ数据的升级。Oracle数据库在<code class="codeph">sys.dst$trigger_table</code>表中保存有关这些触发器的信息。完成表中受影响的TSTZ数据的升级后，通过从<code class="codeph">sys.dst$trigger_table</code>表中读取信息来启用已禁用的触发器，然后从<code class="codeph">sys.dst$trigger_table</code>表中删除它们的信息。如果发生任何致命错误，例如在升级窗口期间意外关闭实例，则应检查<code class="codeph">sys.dst$trigger_table</code>表，以查看在升级之前是否有任何触发器尚未恢复到其先前的活动状态。
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li><span>执行过程<code class="codeph">DBMS_DST.BEGIN_PREPARE( <span class="codeinlineitalic">new_version</span> )</code> ，其中<code class="codeph"><span class="codeinlineitalic">new_version</span></code>是您在步骤1中选择的时区文件版本。</span></li>
                           <li><span>通过执行<code class="codeph">DBMS_DST.FIND_AFFECTED_TABLES</code>过程收集有关受影响数据的信息，可选择将步骤2中创建的自定义表的名称作为参数传递。通过查询<code class="codeph">sys.dst$affected_tables</code>或相应的自定义表来验证受影响的列。此外，检查<code class="codeph">sys.dst$affected_tables.error_count</code>或自定义表中相应的<code class="codeph">error_count</code>列以查找可能的错误尤为重要。如果错误计数大于0，则可以通过检查<code class="codeph">sys.dst$error_table</code>或相应的自定义错误表来检查升级期间可能出现的错误类型。请参阅<span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-6377A1C4-F76A-4C53-82CD-BF4AE6148D6D">升级错误处理</a> ”</span> 。</span></li>
                           <li><span>通过执行<code class="codeph">DBMS_DST.END_PREPARE</code>过程结束准备窗口。</span></li>
                        </ol>
                        <div class="section">
                           <div class="infoboxnote" id="GUID-F0283FDA-7BA0-4D28-BBBD-80CD5538DD4B__GUID-1CB5D622-7F2D-4718-A2EE-8588E4B92946">
                              <p class="notep1">注意：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>只有一个DBA应该一次运行准备窗口。此外，请确保在运行升级之前更正所有错误。</p>
                                 </li>
                                 <li>
                                    <p>您可以通过转到Oracle支持并阅读文档ID 412160.1找到可用于更新时区文件的修补程序矩阵。</p>
                                 </li>
                              </ul>
                           </div>
                           <div class="infoboxnotealso" id="GUID-F0283FDA-7BA0-4D28-BBBD-80CD5538DD4B__GUID-BB8E93E9-7064-41F5-B6C4-7C43056CF973">
                              <p class="notep1">也可以看看：</p>
                              <p>有关<code class="codeph">DBMS_DST</code>包的更多信息，请<code class="codeph">DBMS_DST</code> <a href="../arpls/DBMS_DST.html#ARPLS234" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="NLSPG261"></a><div class="props_rev_3"><a id="GUID-12830F09-735F-4E25-B141-42B4776A110A" name="GUID-12830F09-735F-4E25-B141-42B4776A110A"></a><h5 id="NLSPG-GUID-12830F09-735F-4E25-B141-42B4776A110A" class="sect5"><span class="enumeration_section">4.7.2.2</span>升级窗口</h5>
                     <div>
                        <div class="section">
                           <p>在升级窗口期间，您可以使用以下步骤升级时区数据：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>如果您还没有这样做，请下载所需版本的<code class="codeph">timezlrg_ <span class="codeinlineitalic">version_number</span> .dat</code>并将其安装在<code class="codeph">$ORACLE_HOME/oracore/zoneinfo</code> 。此外，您可以选择从My Oracle Support下载<code class="codeph">timezone_ <span class="codeinlineitalic">version_number</span> .dat</code>并将其放在同一位置。</span></li>
                           <li class="stepexpand"><span>关闭数据库。在Oracle RAC中，您必须关闭所有实例。</span></li>
                           <li class="stepexpand"><span>以<code class="codeph">UPGRADE</code>模式启动数据库。请注意，在Oracle RAC中，只应启动一个实例。有关<code class="codeph">UPGRADE</code>模式的详细信息，请参阅“ <a href="../upgrd/troubleshooting-oracle-database-upgrade.html#UPGRD52874" target="_blank"><span class="italic">Oracle数据库升级指南”</span></a> 。</span></li>
                           <li class="stepexpand"><span>执行<code class="codeph">DBMS_DST.BEGIN_UPGRADE( <span class="codeinlineitalic">new_version</span> )</code> 。（可选）如果您不希望在包含带时区数据的时间戳的字典表升级期间忽略语义错误，则可以将其他两个参数指定为<code class="codeph">TRUE</code> 。如果为这些参数中的一个或两个指定<code class="codeph">TRUE</code> ，则会将错误填充到<code class="codeph">sys.dst$error_table</code> 。在这种情况下，您可能希望在执行<code class="codeph">BEGIN_UPGRADE</code>过程之前截断错误表。有关更多信息，请参见<span class="italic">Oracle Database PL / SQL包和类型参考</span> 。</span></li>
                           <li class="stepexpand"><span>如果<code class="codeph">BEGIN_UPGRADE</code>过程失败，则显示错误<span class="q">“ <code class="codeph">ORA-56927: Starting an upgrade window failed</code> ”</span> 。</span><div>
                                 <p>在<code class="codeph">BEGIN_UPGRADE</code>过程完成错误执行后，检查<code class="codeph">sys.dst$error_table</code>以确定字典转换是否成功。如果成功，表中将不会有任何行。如果有错误，请手动更正这些错误并重新运行<code class="codeph">BEGIN_UPGRADE</code>过程。请参阅<span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-6377A1C4-F76A-4C53-82CD-BF4AE6148D6D">升级错误处理</a> ”</span> 。
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>以正常模式重新启动数据库。</span></li>
                           <li class="stepexpand"><span>截断错误和触发表（默认情况下， <code class="codeph">sys.dst$error_table</code>和<code class="codeph">sys.dst$trigger_table</code> ）。</span></li>
                           <li class="stepexpand"><span>通过执行<code class="codeph">DBMS_DST.UPGRADE_DATABASE</code>过程升级所有表中的TSTZ数据。</span></li>
                           <li class="stepexpand"><span>通过查询<code class="codeph">DBA_TSTZ_TABLES</code>视图验证是否已升级所有表，如<span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-AD9EFCFB-CBEA-4BE2-A91E-9CC2A28CB199">升级示例</a> ”中所示</span> 。然后检查<code class="codeph">dst$error_table</code>以查看是否有任何错误。如果有错误，请更正错误并重新运行相关表的<code class="codeph">DBMS_DST.UPGRADE_TABLE</code>过程。或者，如果您认为这些错误不重要，请重新运行<code class="codeph">DBMS_DST.UPGRADE_TABLE</code>过程，并将参数设置为忽略错误。</span></li>
                           <li class="stepexpand"><span>通过执行<code class="codeph">DBMS_DST.END_UPGRADE</code>过程结束升级窗口。</span></li>
                        </ol>
                        <div class="section">
                           <div class="infoboxnote" id="GUID-12830F09-735F-4E25-B141-42B4776A110A__GUID-780832F9-AC0A-438F-A224-76F3D34501C7">
                              <p class="notep1">注意：</p>
                              <p>包含带时区列的时间戳的表需要处于可以更新的状态。因此，作为示例，列不能具有验证和禁用的检查约束，因为这会阻止更新。</p>
                              <p>如果表大小大于2千兆字节，Oracle建议您使用parallel选项。Oracle还建议您允许Oracle处理可能出现的任何语义错误。</p>
                              <p>请注意，在为error，trigger或affected表执行<code class="codeph">CREATE</code>语句时，必须仅传递表名，而不是模式名。这是因为表是在执行<code class="codeph">CREATE</code>语句的模式中创建的。
                              </p>
                           </div>
                           <div class="infoboxnotealso" id="GUID-12830F09-735F-4E25-B141-42B4776A110A__GUID-BB8E93E9-7064-41F5-B6C4-7C43056CF973">
                              <p class="notep1">也可以看看：</p>
                              <p>有关<code class="codeph">DBMS_DST</code>包的更多信息，请<code class="codeph">DBMS_DST</code> <a href="../arpls/DBMS_DST.html#ARPLS234" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="NLSPG761"></a><div class="props_rev_3"><a id="GUID-AD9EFCFB-CBEA-4BE2-A91E-9CC2A28CB199" name="GUID-AD9EFCFB-CBEA-4BE2-A91E-9CC2A28CB199"></a><h5 id="NLSPG-GUID-AD9EFCFB-CBEA-4BE2-A91E-9CC2A28CB199" class="sect5"><span class="enumeration_section">4.7.2.3</span>升级示例</h5>
                     <div>
                        <div class="section">
                           <p>此示例说明将DST行为更新到Oracle Database <span class="italic">11g</span> ，版本2，默认时区版本为14。首先，假设您当前的数据库使用时区版本3，并假设您有一个现有的表<code class="codeph">t</code> ，其中包含带有时区数据的时间戳。
                           </p>
                           <p>以用户<code class="codeph">scott</code>身份连接到数据库并执行以下语句：</p><pre class="oac_no_warn" dir="ltr">DROP TABLE t; CREATE TABLE t（c NUMBER，mark VARCHAR（25），ts TIMESTAMP WITH TIME ZONE）; INSERT IN TO VALUES（1，'not_affected'，to_timestamp_tz（'22 -sep-2006 13:00:00 america / los_angeles'，'dd-mon-yyyy hh24：mi：ss tzr tzd'））; INSERT IN TO VALUES（4，'affected_err_exist'，to_timestamp_tz（'11 -mar-2007 00:30:00 america / st_johns'，'dd-mon-yyyy hh24：mi：ss tzr tzd'））; INSERT IN TO VALUES（6，'affected_no_err'，to_timestamp_tz（'11 -mar-2007 01:30:00 america / st_johns'，'dd-mon-yyyy hh24：mi：ss tzr tzd'））; INSERT IN TO VALUES（14，'affected_err_dup'，to_timestamp_tz（'21 -sep-2006 23:30:00 egypt'，'dd-mon-yyyy hh24：mi：ss tzr tzd'））;承诺;</pre><p>然后，可选地，您可以启动准备窗口以检查受影响的数据以及存在重叠或不存在时间的潜在语义错误。为此，您应该启动一个窗口，准备迁移到时区版本14。假设您拥有必要的权限。这些权限由<code class="codeph">DBMS_DST</code>包控制。
                           </p>
                           <div class="infoboxnotealso" id="GUID-AD9EFCFB-CBEA-4BE2-A91E-9CC2A28CB199__GUID-F56FCB8A-50F2-40EC-92FE-3BBFD311E503">
                              <p class="notep1">也可以看看：</p>
                              <p>有关<code class="codeph">DBMS_DST</code>包的更多信息，请<code class="codeph">DBMS_DST</code> <a href="../arpls/DBMS_DST.html#ARPLS234" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a></p>
                           </div>
                           <p>例如，首先，准备窗口。</p><pre class="oac_no_warn" dir="ltr">connect / as sysdba set serveroutput on EXEC DBMS_DST.BEGIN_PREPARE（14）;准备窗口已成功启动。PL / SQL过程成功完成。
 </pre><p>请注意，参数14会导致在此语句中使用时区版本14。成功启动此窗口后，您可以在<code class="codeph">DATABASE_PROPERTIES</code>检查DST的状态，如以下示例所示：</p><pre class="oac_no_warn" dir="ltr">SELECT property_name，SUBSTR（property_value，1,30）value FROM database_properties WHERE property_name LIKE'DST_％'ORDER BY property_name;</pre><p>您将看到类似于以下内容的输出：</p><pre class="oac_no_warn" dir="ltr">PROPERTY_NAME VALUE --------------------------- --------- DST_PRIMARY_TT_VERSION 3 DST_SECONDARY_TT_VERSION 14 DST_UPGRADE_STATE PREPARE</pre><p>接下来，您可以执行<code class="codeph">DBMS_DST.FIND_AFFECTED_TABLES</code>以查找从版本3升级到版本14时受影响的数据库中的所有表。此表包含表所有者，表名，列名，行计数和错误计数。在这里，您可以选择使用错误表（ <code class="codeph">sys.dst$error_table</code> ）和受影响的表（ <code class="codeph">sys.dst$affected_table</code> ）的默认值，也可以创建自己的默认值。在此示例中，我们使用<code class="codeph">DBMS_DST.CREATE_ERROR_TABLE</code>和<code class="codeph">DBMS_DST.CREATE_AFFECTED_TABLE</code>创建自己的表，然后传递给<code class="codeph">FIND_AFFECTED_TABLES</code> ，如下所示。
                           </p>
                           <p>以用户<code class="codeph">scott</code>身份连接到数据库并执行以下语句：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_DST.CREATE_AFFECTED_TABLE（'my_affected_tables'）; EXEC DBMS_DST.CREATE_ERROR_TABLE（'my_error_table'）;</pre><p>确保这些表中没有行是个好主意。你可以通过截断表来做到这一点：</p><pre class="oac_no_warn" dir="ltr">TRUNCATE TABLE my_affected_tables; TRUNCATE TABLE my_error_table;</pre><p>然后，您可以执行<code class="codeph">FIND_AFFECTED_TABLES</code>以查看在升级期间受影响的表：</p><pre class="oac_no_warn" dir="ltr">connect / as sysdba BEGIN DBMS_DST.FIND_AFFECTED_TABLES（affected_tables =&gt;'scott.my_affected_tables'，log_errors =&gt; TRUE，log_errors_table =&gt;'scott.my_error_table'）;结束; /</pre><p>然后，检查受影响的表：</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM scott.my_affected_tables; TABLE_OWNER TABLE_NAME COLUMN_NAM ROW_COUNT ERROR_COUNT ----------- ---------- ---------- --------- ----- ------ SCOTT T TS 3 2</pre><p>然后，检查错误表：</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM scott.my_error_table; TABLE_OWNER TABLE_NAME COLUMN_NAME ROWID ERROR_NUMBER ----------- ---------- ----------- ------------- ----- ------------ SCOTT T TS AAAPW3AABAAANzoAAB 1878 SCOTT T TS AAAPW3AABAAANzoAAE 1883</pre><p>可以按照<span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-6377A1C4-F76A-4C53-82CD-BF4AE6148D6D">升级错误处理</a> ”中的</span>说明更正这些错误。然后，结束准备窗口，如下面的语句所示：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_DST.END_PREPARE;准备窗口已成功结束。PL / SQL过程成功完成。
 </pre><p>在此之后，您可以在<code class="codeph">DATABASE_PROPERTIES</code>检查DST状态：</p><pre class="oac_no_warn" dir="ltr">SELECT property_name，SUBSTR（property_value，1,30）value FROM database_properties WHERE property_name LIKE'DST_％'ORDER BY property_name; PROPERTY_NAME VALUE ------------------------ -------- DST_PRIMARY_TT_VERSION 3 DST_SECONDARY_TT_VERSION 0 DST_UPGRADE_STATE NONE</pre><p>接下来，您可以使用升级窗口升级受影响的数据。为此，首先，启动升级窗口。请注意，必须先在<code class="codeph">UPGRADE</code>模式下打开数据库，然后才能执行<code class="codeph">DBMS_DST.BEGIN_UPGRADE</code> 。在Oracle RAC中，只能启动一个实例。<code class="codeph">BEGIN_UPGRADE</code>在一个事务中升级所有字典表，因此调用将成功或失败。在过程执行期间，所有具有TSTZ数据的用户表都标记为正在进行的升级。有关更多信息，请参见<a href="../upgrd/major-steps-upgrade-process-oracle-database.html#UPGRD52705" target="_blank"><span class="italic">Oracle数据库升级指南</span></a>
                           </p>
                           <p>此外，只有<code class="codeph">SYSDBA</code>才能启动升级窗口。如果您不以<code class="codeph">UPGRADE</code>模式打开数据库并调用<code class="codeph">BEGIN_UPGRADE</code> ，您将看到以下错误：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_DST.BEGIN_UPGRADE（14）; BEGIN DBMS_DST.BEGIN_UPGRADE（14）;结束; *第1行的错误：ORA-56926：数据库必须处于UPGRADE模式才能启动升级窗口ORA-06512：位于“SYS.DBMS_SYS_ERROR”，第79行ORA-06512：位于“SYS.DBMS_DST”，第1021行ORA -06512：第1行</pre><p>因此， <code class="codeph">BEGIN_UPGRADE</code>升级包含TSTZ数据的系统表，并使用<code class="codeph">UPGRADE_IN_PROGRESS</code>属性标记用户表（包含TSTZ数据）。这可以在<code class="codeph">DBA_TSTZ_TABLES</code>中检查，稍后将在此示例中进行说明。
                           </p>
                           <p><code class="codeph">BEGIN_UPGRADE</code>中有两个用于处理语义错误的参数： <code class="codeph">error_on_overlap_time</code> （错误号ORA-1883）和<code class="codeph">error_on_nonexisting_time</code> （错误号ORA-1878）。如果参数使用默认设置<code class="codeph">FALSE</code> ，则Oracle使用默认转换转换数据，并且不会发出错误信号。有关它们的含义以及如何处理错误的详细信息，请参阅<span class="q">“ <a href="datetime-data-types-and-time-zone-support.html#GUID-6377A1C4-F76A-4C53-82CD-BF4AE6148D6D">升级错误处理</a> ”</span> 。
                           </p>
                           <p>升级字典表时，以下调用可以根据某些默认值自动更正语义错误。如果您不忽略语义错误，并且在字典表中确实存在此类错误，则<code class="codeph">BEGIN_UPGRADE</code>将失败。这些语义错误填充到<code class="codeph">sys.dst$error_table</code> 。
                           </p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_DST.BEGIN_UPGRADE（14）;已成功启动升级窗口。PL / SQL过程成功完成。
 </pre><p>在此之后，您可以在<code class="codeph">DATABASE_PROPERTIES</code>检查DST状态，如下所示：</p><pre class="oac_no_warn" dir="ltr">SELECT property_name，SUBSTR（property_value，1,30）value FROM database_properties WHERE property_name LIKE'DST_％'ORDER BY property_name; PROPERTY_NAME VALUE ------------------------ -------- DST_PRIMARY_TT_VERSION 14 DST_SECONDARY_TT_VERSION 3 DST_UPGRADE_STATE UPGRADE</pre><p>然后，检查哪些用户表标有<code class="codeph">UPGRADE_IN_PROGRESS</code> ：</p><pre class="oac_no_warn" dir="ltr">SELECT owner，table_name，upgrade_in_progress FROM dba_tstz_tables; OWNER TABLE_NAME UPGRADE_IN_PROGRESS ----- ------------------------- ----------------- -  SYS WRI $ _OPTSTAT_AUX_HISTORY NO SYS WRI $ _OPTSTAT_OPR NO SYS OPTSTAT_HIST_CONTROL $ NO SYS调度器$ _JOB NO SYS KET $ _AUTOTASK_STATUS NO SYS AQ $ _ALERT_QT_S NO SYS AQ $ _KUPC $ DATAPUMP_QUETAB_S NO DBSNMP MGMT_DB_FEATURE_LOG NO WMSYS WM $ VERSIONED_TABLES NO SYS WRI $ _OPTSTAT_IND_HISTORY NO SYS OPTSTAT_USER_PREFS $ NO SYS FGR $ _FILE_GROUP_FILES NO SYS SCHEDULER $ _WINDOW NO SYS WRR $ _REPLAY_DIVERGENCE NO SCOTT T YES IX AQ $ _ORDERS_QUEUETABLE_S YES ...
 </pre><p>在此输出中，字典表（在<code class="codeph">SYS</code>模式中）已由<code class="codeph">BEGIN_UPGRADE</code>升级。用户表，例如<code class="codeph">SCOTT.T</code> ，尚未进行过。
                           </p>
                           <p>现在，您可以使用<code class="codeph">DBMS_DST.UPGRADE_DATABASE</code>执行用户表的升级。必须升级所有表，否则，您将无法使用<code class="codeph">END_UPGRADE</code>过程结束升级窗口。在此步骤之前，必须以<code class="codeph">normal</code>模式重新启动数据库。语法示例如下：</p><pre class="oac_no_warn" dir="ltr">VAR numfail号码; BEGIN DBMS_DST.UPGRADE_DATABASE（：numfail，parallel =&gt; TRUE，log_errors =&gt; TRUE，log_errors_table =&gt;'SYS.DST $ ERROR_TABLE'，log_triggers_table =&gt;'SYS.DST $ TRIGGER_TABLE'，error_on_overlap_time =&gt; TRUE，error_on_nonexisting_time =&gt; TRUE） ; DBMS_OUTPUT.PUT_LINE（'表无法升级的表：'||：numfail）;结束; /</pre><p>如果有任何错误，您应该更正它们并在各个表上使用<code class="codeph">UPGRADE_TABLE</code> 。在这种情况下，您可能需要处理与实例化视图相关的表，例如物化视图基表，物化视图日志表和物化视图容器表。升级这些表时，需要记住几个注意事项。首先，必须以原子方式升级基表及其物化视图日志表。接下来，必须在物料化视图容器表的所有基表和物化视图日志表都已升级后进行升级。通常，Oracle建议您通过让Oracle数据库采取默认操作来处理语义错误。
                           </p>
                           <p>为了这个例子，让我们假设你运行<code class="codeph">UPGRADE_DATABASE</code>后<code class="codeph">SCOTT.T</code>有一些错误。在这种情况下，您可以使用以下查询检查这些错误：</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM sys.dst $ error_table; TABLE_OWNER TABLE_NAME COLUMN_NAME ROWID ERROR_NUMBER ----------- ---------- ----------- ------------- ----- ------------ SCOTT T TS AAAO2XAABAAANrgAAD 1878 SCOTT T TS AAAO2XAABAAANrgAAE 1878</pre><p>在输出中，您可以看到编号为1878的错误。此错误表示在不存在的时间内发生了错误。</p>
                           <p>继续这个例子，假设<code class="codeph">SCOTT.T</code>有一个物化视图日志<code class="codeph">scott.mlog$_t</code> ，并且在<code class="codeph">SCOTT.T</code>上有一个物化视图。然后，假设此1878错误已得到纠正。
                           </p>
                           <p>最后，您可以升级表，物化视图日志和物化视图，如下所示：</p><pre class="oac_no_warn" dir="ltr">VAR numfail号码; BEGIN DBMS_DST.UPGRADE_TABLE（：numfail，table_list =&gt;'SCOTT.t，SCOTT.mlog $ _T'，parallel =&gt; TRUE，continue_after_errors =&gt; FALSE，log_errors =&gt; TRUE，log_errors_table =&gt;'SYS.DST $ ERROR_TABLE'，error_on_overlap_time =&gt; FALSE，error_on_nonexisting_time =&gt; TRUE，log_triggers_table =&gt;'SYS.DST $ TRIGGER_TABLE'，atomic_upgrade =&gt; TRUE）; DBMS_OUTPUT.PUT_LINE（'表无法升级的表：'||：numfail）;结束; / VAR numfail number; BEGIN DBMS_DST.UPGRADE_TABLE（：numfail，table_list =&gt;'SCOTT.MYMV_T'，parallel =&gt; TRUE，continue_after_errors =&gt; FALSE，log_errors =&gt; TRUE，log_errors_table =&gt;'SYS.DST $ ERROR_TABLE'，error_on_overlap_time =&gt; FALSE，error_on_nonexisting_time = &gt; TRUE，log_triggers_table =&gt;'SYS.DST $ TRIGGER_TABLE'，atomic_upgrade =&gt; TRUE）; DBMS_OUTPUT.PUT_LINE（'表无法升级的表：'||：numfail）;结束; /</pre><p><code class="codeph">atomic_upgrade</code>参数使您可以将表的升级与其物化视图日志相结合。
                           </p>
                           <p>升级<code class="codeph">END_UPGRADE</code>所有表后，可以调用<code class="codeph">END_UPGRADE</code>结束升级窗口，如下所示：</p><pre class="oac_no_warn" dir="ltr">VAR numfail号码; BEGIN DBMS_DST.END_UPGRADE（：numfail）; DBMS_OUTPUT.PUT_LINE（'表无法升级的表：'||：numfail）;结束; /</pre><p>如果所有受影响的表都已成功升级，则升级窗口结束，否则输出将显示未成功升级的表的数量。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="NLSPG762"></a><div class="props_rev_3"><a id="GUID-6377A1C4-F76A-4C53-82CD-BF4AE6148D6D" name="GUID-6377A1C4-F76A-4C53-82CD-BF4AE6148D6D"></a><h5 id="NLSPG-GUID-6377A1C4-F76A-4C53-82CD-BF4AE6148D6D" class="sect5"><span class="enumeration_section">4.7.2.4</span>升级错误处理</h5>
                     <div>
                        <p>升级期间可能发生三种主要语义错误。第一种是现有时间变为不存在时间，第二种是时间变为重复时，第三种是重复时间变为非重复时间。</p>
                        <p>作为第一种情况的一个例子，考虑从2007年太平洋标准时间（PST）到太平洋夏令时（PDT）的变化。当时钟向前移动一小时到凌晨3点并且在凌晨2点到凌晨3点之间产生间隙时，此更改将在2007年3月11日凌晨2点根据版本3（以及任何后续版本至少为32）进行。在版本2中，此时间更改发生在2007年4月1日。如果将时区文件从版本2升级到版本3，则在2007年3月11日凌晨2点到3点之间的任何时间都无效，如果<code class="codeph">ERROR_ON_NONEXISTING_TIME</code>设置为<code class="codeph">TRUE</code> <code class="codeph">ERROR_ON_NONEXISTING_TIME</code>引发错误（ORA-1878）。因此，存在不存在的时间问题。当<code class="codeph">ERROR_ON_NONEXISTING_TIME</code>设置为<code class="codeph">FALSE</code> （此参数的默认值）时，不报告错误，并且Oracle在此情况下保留UTC时间。例如，版本2中的“Mar-11-2007 02:30 PST”在版本3中变为“Mar-11-2007 03:30 PDT”，因为它们都被转换为相同的UTC时间戳。
                        </p>
                        <p>从PDT更改为PST时出现第二种情况的示例。例如，在2007年的第3版中，更改发生在Nov-04-2007，当时间从凌晨2点回到凌晨1点。这意味着在2007年11月4日的区间&lt;1AM，2AM&gt;的时间可以出现两次，一次是PST，一次是PDT。在版本2中，此转换发生在2007年10月28日凌晨2点。因此，如果<code class="codeph">ERROR_ON_OVERLAP_TIME</code>设置为<code class="codeph">TRUE</code> ，则在版本2中唯一标识的Nov-04-2007 &lt;1AM，2AM&gt;内的任何时间戳都会导致版本3中的错误（ORA-1883）。如果将此参数保留为其默认设置<code class="codeph">FALSE</code> ，则会保留UTC时间戳值，并且不会引发错误。在这种情况下，如果您将版本从2更改为3，则版本2中的时间戳“Nov-04-2007 01:30 PST”将成为版本3中的“Nov-04-2007 01:30 PST”。
                        </p>
                        <p>第三种情况发生在重复时间变为非重复时间时。考虑从2007年的PDT到PST的转变，例如，2007年10月28日版本2中的&lt;1AM，2AM&gt;是重叠间隔。然后，“Oct-28-2007 01:30 PDT”和“Oct-28-2007 01:30 PST”都是版本2中的有效时间戳。如果<code class="codeph">ERROR_ON_OVERLAP_TIME</code>设置为<code class="codeph">TRUE</code> ，则在从版本2升级到版本3期间会引发ORA-1883错误。但是，如果将<code class="codeph">ERROR_ON_OVERLAP_TIME</code>设置为<code class="codeph">FALSE</code> （此参数的默认值），则会保留LOCAL时间并且不会报告错误。在这种情况下，版本2中的“Oct-28-2007 01:30 PDT”和“Oct-28-2007 01:30 PST”在版本3中转换为相同的“Oct-28-2007 01:30 PDT”。请注意，将<code class="codeph">ERROR_ON_OVERLAP_TIME</code>设置为<code class="codeph">FALSE</code>可能会导致某些时间序列被反转。例如，在版本2中“Oct-28-2007 01:45 PDT”安排的作业（作业A）应该在“2007年10月28日01:30太平洋标准时间”安排的作业（作业B）之前执行。 。升级到版本3后，作业A安排在“Oct-28-2007 01:45 PDT”，作业B保持在“Oct-28-2007 01:30 PDT”，导致作业B在作业A之前执行。即使不保证以特定顺序执行未链接的预定作业，在设置预定作业时也应记住此问题。
                        </p>
                        <div class="infoboxnotealso" id="GUID-6377A1C4-F76A-4C53-82CD-BF4AE6148D6D__GUID-5FBB09AF-72C8-43AC-A75B-814961ADA2B7">
                           <p class="notep1">也可以看看：</p>
                           <p>有关如何使用这些参数的详细信息，请<a href="../arpls/DBMS_DST.html#ARPLS234" target="_blank"><span class="italic">参见Oracle Database PL / SQL包和类型参考</span></a></p>
                        </div>
                     </div>
                  </div>
               </div>
            </div><a id="NLSPG975"></a><div class="props_rev_3"><a id="GUID-1A80594A-6D9D-4088-8240-F7CA18300E76" name="GUID-1A80594A-6D9D-4088-8240-F7CA18300E76"></a><h3 id="NLSPG-GUID-1A80594A-6D9D-4088-8240-F7CA18300E76" class="sect3"><span class="enumeration_section">4.8</span>使用不同版本的时区文件运行的客户端和服务器</h3>
               <div>
                  <p>在Oracle Database <span class="italic">11g</span> （版本11.2和更高版本）中，您可以在客户端和服务器上使用不同版本的时区文件。早期的Oracle数据库发行版不支持此操作模式。客户端和服务器都必须是Oracle Database <span class="italic">11g</span> ，版本11.2或更高版本才能以这种混合模式运行。
                  </p>
                  <div class="infoboxnotealso" id="GUID-1A80594A-6D9D-4088-8240-F7CA18300E76__GUID-528135C7-D272-48EF-9DBF-DAF60E545A1B">
                     <p class="notep1">也可以看看：</p>
                     <p>关于在混合模式下工作的分支的<a href="../lnoci/index.html" target="_blank"><span class="italic">Oracle调用接口程序员指南</span></a></p>
                  </div>
                  <p>OCI，JDBC，Pro * C和SQL * Plus客户端现在可以继续与数据库服务器通信，而无需更新客户端时区文件。对于其他产品，如果未在产品特定文档中明确说明，则应假定此类客户端无法与具有与客户端不同的时区文件的数据库服务器一起运行。否则，基于区域ID的<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIMEZONE</code>值的计算可能会在客户端上产生不一致的结果。这是由于不同的夏令时（DST）规则对客户端和服务器上不同时区文件版本之间受影响的时区区域有效。
                  </p>
                  <p>请注意，如果应用程序直接或通过数据库链接连接到不同的数据库，建议所有数据库都使用相同的时区文件版本。否则，对这些不同数据库上的<code class="codeph">TIMESTAMP</code> <code class="codeph">WITH</code> <code class="codeph">TIMEZONE</code>值的计算可能会产生不一致的结果。这是因为不同的DST规则对不同数据库服务器上不同时区文件版本之间受影响的时区区域有效。
                  </p>
               </div>
            </div><a id="NLSPG262"></a><div class="props_rev_3"><a id="GUID-2AF15A96-CD19-4074-8DE6-17BAD0D7DF37" name="GUID-2AF15A96-CD19-4074-8DE6-17BAD0D7DF37"></a><h3 id="NLSPG-GUID-2AF15A96-CD19-4074-8DE6-17BAD0D7DF37" class="sect3"><span class="enumeration_section">4.9</span>设置数据库时区</h3>
               <div>
                  <div class="section">
                     <p>设置<a id="d33975e6777" class="indexterm-anchor"></a><a id="d33975e6779" class="indexterm-anchor"></a>使用<code class="codeph">CREATE DATABASE</code>语句的<code class="codeph">SET TIME_ZONE</code>子句创建数据库时的数据库时区。如果未设置数据库时区，则默认为服务器操作系统的时区。
                     </p>
                     <p>时区可以设置为命名区域或与UTC的绝对偏移量。要将时区设置为命名区域，请使用类似于以下示例的语句：</p><pre class="oac_no_warn" dir="ltr">创建数据库db01 ...SET TIME_ZONE ='欧洲/伦敦';</pre><p>要将时区设置为与UTC的偏移量，请使用类似于以下示例的语句：</p><pre class="oac_no_warn" dir="ltr">创建数据库db01 ...SET TIME_ZONE =' -  05:00';</pre><p>有效偏移的范围是-12：00到+14：00。</p>
                     <div class="infoboxnote" id="GUID-2AF15A96-CD19-4074-8DE6-17BAD0D7DF37__GUID-3F7611FB-D22B-4BD8-8352-41B01662300D">
                        <p class="notep1">注意：</p>
                        <p>数据库时区仅与<code class="codeph">TIMESTAMP WITH LOCAL TIME ZONE</code>列相关。Oracle建议您将数据库时区设置为UTC（0:00），以避免数据转换，并在数据库之间传输数据时提高性能。这对于分布式数据库，复制以及导出和导入尤为重要。
                        </p>
                     </div>
                     <p>您可以使用<code class="codeph">ALTER DATABASE</code>语句的<code class="codeph">SET TIME_ZONE</code>子句更改数据库时区。例如：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE SET TIME_ZONE ='Europe / London'; ALTER DATABASE SET TIME_ZONE =' -  05:00';</pre><p>如果数据库包含具有<code class="codeph">TIMESTAMP WITH LOCAL TIME ZONE</code>列且该列包含数据的表，则<code class="codeph">ALTER DATABASE SET TIME_ZONE</code>语句将返回错误。
                     </p>
                     <p>在关闭并重新启动数据库之前，更改不会生效。</p>
                     <p>您可以通过输入以下查询来查找数据库时区：</p><pre class="oac_no_warn" dir="ltr">SELECT dbtimezone FROM DUAL;</pre></div>
                  <!-- class="section" -->
               </div>
            </div><a id="NLSPG263"></a><div class="props_rev_3"><a id="GUID-578B5988-31E2-4D0F-ACEA-95C827F6012B" name="GUID-578B5988-31E2-4D0F-ACEA-95C827F6012B"></a><h3 id="NLSPG-GUID-578B5988-31E2-4D0F-ACEA-95C827F6012B" class="sect3"><span class="enumeration_section">4.10</span>设置会话时区</h3>
               <div>
                  <div class="section">
                     <p>您可以设置默认值<a id="d33975e6906" class="indexterm-anchor"></a><a id="d33975e6908" class="indexterm-anchor"></a>具有<code class="codeph">ORA_SDTZ</code>环境变量的会话时区。当用户<code class="codeph">TIMESTAMP WITH LOCAL TIME ZONE</code>数据检索<code class="codeph">TIMESTAMP WITH LOCAL TIME ZONE</code> ，Oracle数据库会在用户的会话时区中返回它。当<code class="codeph">TIMESTAMP</code>值转换为<code class="codeph">TIMESTAMP WITH TIME ZONE</code>或<code class="codeph">TIMESTAMP WITH LOCAL TIME ZONE</code>数据类型时，会话时区也会生效。
                     </p>
                     <div class="infoboxnote" id="GUID-578B5988-31E2-4D0F-ACEA-95C827F6012B__GUID-9D09C194-DF98-49F9-A141-B5CECAA2D65B">
                        <p class="notep1">注意：</p>
                        <p>设置会话时区不会影响<code class="codeph">SYSDATE</code>和<code class="codeph">SYSTIMESTAMP</code> SQL函数返回的值。<code class="codeph">SYSDATE</code>返回数据库所在的操作系统的日期和时间，并考虑数据库启动时生效的数据库服务器操作系统的时区。
                        </p>
                     </div>
                     <p><code class="codeph">ORA_SDTZ</code>环境变量可以设置为以下值：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>操作系统本地时区（ <code class="codeph">'OS_TZ'</code> ）</p>
                        </li>
                        <li>
                           <p>数据库时区（ <code class="codeph">'DB_TZ'</code> ）</p>
                        </li>
                        <li>
                           <p>与UTC的绝对偏移量（例如， <code class="codeph">'-05:00'</code> ）</p>
                        </li>
                        <li>
                           <p>时区地区名称（例如， <code class="codeph">'Europe/London'</code> ）</p>
                        </li>
                     </ul>
                     <p>要设置<code class="codeph">ORA_SDTZ</code> ，请在UNIX环境（C shell）中使用与以下内容类似的语句：</p><pre class="oac_no_warn" dir="ltr">％setenv ORA_SDTZ'OS_TZ'％setenv ORA_SDTZ'DB_TZ'％setenv ORA_SDTZ'European / London'％setenv ORA_SDTZ' -05：00'</pre><p>在Microsoft Windows环境中设置<code class="codeph">ORA_SDTZ</code>变量时 - 在注册表中，系统环境变量之间或命令提示符窗口中 - 不要将时区值括在引号中。
                     </p>
                     <p>您可以使用<code class="codeph">ALTER SESSION</code>语句的<code class="codeph">SET TIME_ZONE</code>子句<code class="codeph">ALTER SESSION</code>特定SQL会话的时区。
                     </p>
                     <p><code class="codeph">TIME_ZONE</code>可以设置为以下值：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>会话启动时的默认本地时区（ <code class="codeph">local</code> ）</p>
                        </li>
                        <li>
                           <p>数据库时区（ <code class="codeph">dbtimezone</code> ）</p>
                        </li>
                        <li>
                           <p>与UTC的绝对偏移量（例如， <code class="codeph">'+10:00'</code> ）</p>
                        </li>
                        <li>
                           <p>时区地区名称（例如， <code class="codeph">'Asia/Hong_Kong'</code> ）</p>
                        </li>
                     </ul>
                     <p>使用类似于以下内容的<code class="codeph">ALTER SESSION</code>语句：</p><pre class="oac_no_warn" dir="ltr">ALTER SESSION SET TIME_ZONE = local; ALTER SESSION SET TIME_ZONE = dbtimezone; ALTER SESSION SET TIME_ZONE ='Asia / Hong_Kong'; ALTER SESSION SET TIME_ZONE ='+ 10:00';</pre><p>您可以通过输入以下查询来查找当前会话时区：</p><pre class="oac_no_warn" dir="ltr">SELECT sessiontimezone FROM DUAL;</pre></div>
                  <!-- class="section" -->
               </div>
            </div><a id="NLSPG764"></a><a id="NLSPG264"></a><div class="props_rev_3"><a id="GUID-D8C7A7EB-A507-42A2-9B10-5301E822A7F2" name="GUID-D8C7A7EB-A507-42A2-9B10-5301E822A7F2"></a><h3 id="NLSPG-GUID-D8C7A7EB-A507-42A2-9B10-5301E822A7F2" class="sect3"><span class="enumeration_section">4.11</span>使用AT TIME ZONE子句转换时区</h3>
               <div>
                  <div class="section">
                     <p>datetime SQL表达式可以是以下之一：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>日期时间列</p>
                        </li>
                        <li>
                           <p>生成日期时间值的复合表达式</p>
                        </li>
                     </ul>
                     <p>日期时间表达式可以包括<code class="codeph">AT LOCAL</code>子句或<code class="codeph">AT TIME ZONE</code>子句。如果包含<code class="codeph">AT LOCAL</code>子句，则会在当前会话时区中返回结果。如果包含<code class="codeph">AT TIME ZONE</code>子句，则使用以下设置之一：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>时区偏移：字符串' <code class="codeph">(+|-)HH:MM'</code>指定时区作为与UTC的偏移量。例如， <code class="codeph">'-07:00'</code>指定比UTC晚7小时的时区。例如，如果UTC时间是上午11:00，那么<code class="codeph">'-07:00'</code>时区<code class="codeph">'-07:00'</code>时间是凌晨4:00</p>
                        </li>
                        <li>
                           <p><code class="codeph">DBTIMEZONE</code> ：Oracle数据库使用在数据库创建期间（显式或默认）建立的数据库时区。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">SESSIONTIMEZONE</code> ：Oracle数据库使用默认情况下或最近的<code class="codeph">ALTER SESSION</code>语句中建立的会话时区。
                           </p>
                        </li>
                        <li>
                           <p>时区区域名称：Oracle数据库返回时区区域名称指示的时区中的值。例如，您可以指定<code class="codeph">Asia/Hong_Kong</code> 。
                           </p>
                        </li>
                        <li>
                           <p>表达式：如果表达式返回具有有效时区格式的字符串，则Oracle数据库将返回该时区中的输入。否则，Oracle数据库会返回错误。</p>
                        </li>
                     </ul>
                     <p>以下示例转换<a id="d33975e7167" class="indexterm-anchor"></a><a id="d33975e7169" class="indexterm-anchor"></a> <code class="codeph">America/New_York</code>时区的datetime值到<code class="codeph">America/Los_Angeles</code>时区的datetime值。
                     </p>
                     <div class="infoboxnotealso" id="GUID-D8C7A7EB-A507-42A2-9B10-5301E822A7F2__GUID-0F10BB3E-4A19-47A9-AC60-409E189A071F">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../sqlrf/FROM_TZ.html#SQLRF00644" target="_blank"><span class="italic">Oracle数据库SQL语言参考</span></a></p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-D8C7A7EB-A507-42A2-9B10-5301E822A7F2__GUID-45A0F380-458B-4692-8955-C120D50B5E5E">
                     <p class="titleinexample">示例4-5将日期时间值转换为另一个时区</p><pre class="oac_no_warn" dir="ltr">SELECT FROM_TZ（CAST（TO_DATE（'1999-12-01 11:00:00'，'YYYY-MM-DD HH：MI：SS'）作为TIMESTAMP），'America / New_York'）AT TIME ZONE'America / Los_Angeles “西海岸时间”来自双重;西海岸时间----------------------------------------------- ----------- 01-DEC-99 08.00.00.000000 AM AMERICA / LOS_ANGELES</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="NLSPG265"></a><div class="props_rev_3"><a id="GUID-E5171DEF-74D7-482A-B4E9-1EE3403E18BC" name="GUID-E5171DEF-74D7-482A-B4E9-1EE3403E18BC"></a><h3 id="NLSPG-GUID-E5171DEF-74D7-482A-B4E9-1EE3403E18BC" class="sect3"><span class="enumeration_section">4.12</span>支持夏令时</h3>
               <div>
                  <p>Oracle数据库自动确定是否<a id="d33975e7266" class="indexterm-anchor"></a>夏令时对指定时区有效，并返回相应的本地时间。通常，日期/时间值足以允许Oracle数据库确定夏令时是否对指定时区有效。夏令时开始或结束的时段是边界情况。例如，在美国东部地区，当夏令时生效时，时间从上午01:59:59变为凌晨3:00:00。上午02:00:00和02:59:59之间的时间间隔不存在。该间隔中的值无效。当夏令时结束时，时间从02:00:00 am变为01:00:01 am重复01:00:01到02:00:00 am之间的间隔。该间隔的值不明确，因为它们出现两次。
                  </p>
                  <p>要解决这些边界情况，Oracle数据库使用<code class="codeph">TZR</code>和<code class="codeph">TZD</code>格式元素。<code class="codeph">TZR</code>表示日期时间输入字符串中的时区区域。例如' <code class="codeph">Australia/North</code> '，' <code class="codeph">UTC</code> '和' <code class="codeph">Singapore</code> '。<code class="codeph">TZD</code>表示具有夏令时信息的时区区域的缩写形式。例如美国太平洋标准时间的“ <code class="codeph">PST</code> ”和美国太平洋夏令时的“ <code class="codeph">PDT</code> ”。要查看<code class="codeph">TZR</code>和<code class="codeph">TZD</code>格式元素的有效值列表，请查询<code class="codeph">V$TIMEZONE_NAMES</code>动态性能视图的<code class="codeph">TZNAME</code>和<code class="codeph">TZABBREV</code>列。
                  </p>
                  <div class="infoboxnotealso" id="GUID-E5171DEF-74D7-482A-B4E9-1EE3403E18BC__GUID-70CF630E-DCB5-47EF-8466-B21E94C92B8D">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>有关会话参数<code class="codeph">ERROR_ON_OVERLAP_TIME</code>详细信息，请<a href="../sqlrf/ALTER-SESSION.html#SQLRF53052" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                        </li>
                        <li>
                           <p><span class="q">“ <a href="appendix-A-locale-data.html#GUID-21D14370-A707-4482-A3FE-9277263F292A">时区区域名称</a> ”，</span>用于有效时区列表</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="NLSPG765"></a><a id="NLSPG766"></a><a id="NLSPG767"></a><a id="NLSPG266"></a><div class="props_rev_3"><a id="GUID-C874556E-F66E-4A35-A0C8-28C527673451" name="GUID-C874556E-F66E-4A35-A0C8-28C527673451"></a><h4 id="NLSPG-GUID-C874556E-F66E-4A35-A0C8-28C527673451" class="sect4"><span class="enumeration_section">4.12.1</span>示例：夏令时对日期时间计算的影响</h4>
                  <div>
                     <p><code class="codeph">TIMESTAMP</code>数据类型不接受时区值，也不计算夏令时。
                     </p>
                     <p><code class="codeph">TIMESTAMP WITH TIME ZONE</code>和<code class="codeph">TIMESTAMP WITH LOCAL TIME ZONE</code>数据类型具有以下行为：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>如果时区区域与日期时间值相关联，则数据库服务器将知道该区域的夏令时规则并在计算中使用规则。</p>
                        </li>
                        <li>
                           <p>不使用夏令时的区域不计算夏令时。</p>
                        </li>
                     </ul>
                     <p>本节的其余部分包含使用datetime数据类型的示例。这些示例使用<code class="codeph">global_orders</code>表。它包含<code class="codeph">orderdate1</code>列<code class="codeph">TIMESTAMP</code>数据类型和<code class="codeph">orderdate2</code>列<code class="codeph">TIMESTAMP WITH TIME ZONE</code>数据类型。<code class="codeph">global_orders</code>表创建如下：</p><pre class="oac_no_warn" dir="ltr">CREATE TABLE global_orders（orderdate1 TIMESTAMP（0），orderdate2 TIMESTAMP（0）WITH TIME ZONE）; INSERT INTO global_orders VALUES（'28 -OCT-00 11:24:54 PM'，'28 -OCT-00 11:24:54 PM America / New_York'）;</pre><div class="infoboxnote" id="GUID-C874556E-F66E-4A35-A0C8-28C527673451__GUID-24AC5578-4BC5-4553-BEC6-1794AC62634E">
                        <p class="notep1">注意：</p>
                        <p>如果已为前面的示例创建了<code class="codeph">global_orders</code>表，则在尝试<a href="datetime-data-types-and-time-zone-support.html#GUID-C874556E-F66E-4A35-A0C8-28C527673451__i1006829">示例4-7</a>到<a href="datetime-data-types-and-time-zone-support.html#GUID-C874556E-F66E-4A35-A0C8-28C527673451__i1006863">示例4-8</a>之前删除<code class="codeph">global_orders</code>表。
                        </p>
                     </div>
                     <div class="example" id="GUID-C874556E-F66E-4A35-A0C8-28C527673451__i1006793">
                        <p class="titleinexample">示例4-6使用TIMESTAMP WITH TIME ZONE和TIMESTAMP比较夏令时计算</p><pre class="oac_no_warn" dir="ltr">SELECT orderdate1 + INTERVAL'8'HOUR，orderdate2 + INTERVAL'8'HOUR FROM global_orders;</pre><p>以下输出结果：</p><pre class="oac_no_warn" dir="ltr">ORDERDATE1 + INTERVAL'8'HOUR ORDERDATE2 + INTERVAL'8'HOUR -------------------------- ---------- ---------------- 29-OCT-00 07.24.54.000000 AM 29-OCT-00 06.24.54.000000 AM AMERICA / NEW_YORK</pre><p>此示例显示向列添加8小时的效果。时间段包括夏令时边界（从夏令时到标准时间的变化）。<code class="codeph">orderdate1</code>列是<code class="codeph">TIMESTAMP</code>数据类型，它不使用夏令时信息，因此不会调整8小时间隔内发生的更改。所述<code class="codeph">TIMESTAMP WITH TIME ZONE</code>数据类型并调整为变化的，所以<code class="codeph">orderdate2</code>列显示时间比在所示的时间早1小时<code class="codeph">orderdate1</code>柱。
                        </p>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-C874556E-F66E-4A35-A0C8-28C527673451__i1006829">
                        <p class="titleinexample">示例4-7使用TIMESTAMP与LOCAL TIME ZONE和TIMESTAMP比较夏令时计算</p>
                        <p><code class="codeph">TIMESTAMP WITH LOCAL TIME ZONE</code>数据类型使用为会话环境设置的<code class="codeph">TIME_ZONE</code>值。以下语句设置<code class="codeph">TIME_ZONE</code>会话参数的值并创建<code class="codeph">global_orders</code>表。<code class="codeph">global_orders</code>表有一列<code class="codeph">TIMESTAMP</code>数据类型和一列<code class="codeph">TIMESTAMP WITH LOCAL TIME ZONE</code>数据类型。
                        </p><pre class="oac_no_warn" dir="ltr">ALTER SESSION SET TIME_ZONE ='America / New_York'; CREATE TABLE global_orders（orderdate1 TIMESTAMP（0），orderdate2 TIMESTAMP（0）WITH LOCAL TIME ZONE）; INSERT INTO global_orders VALUES（'28 -OCT-00 11:24:54 PM'，'28 -OCT-00 11:24:54 PM'）;</pre><p>两列添加8小时。</p><pre class="oac_no_warn" dir="ltr">SELECT orderdate1 + INTERVAL'8'HOUR，orderdate2 + INTERVAL'8'HOUR FROM global_orders;</pre><p>由于时区区域与<code class="codeph">orderdate2</code>的日期时间值相关联，因此Oracle数据库服务器使用该区域的夏令时规则。因此输出与<a href="datetime-data-types-and-time-zone-support.html#GUID-C874556E-F66E-4A35-A0C8-28C527673451__i1006793">例4-6</a>相同。两个计算之间存在一小时的差异，因为不计算<code class="codeph">TIMESTAMP</code>数据类型的夏令时，并且计算跨越夏令时边界。
                        </p>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-C874556E-F66E-4A35-A0C8-28C527673451__i1006863">
                        <p class="titleinexample">示例4-8不计算夏令时区域的夏令时不计算</p>
                        <p>将时区区域设置为UTC。 UTC不使用夏令时。</p><pre class="oac_no_warn" dir="ltr">ALTER SESSION SET TIME_ZONE ='UTC';</pre><p>截断<code class="codeph">global_orders</code>表。
                        </p><pre class="oac_no_warn" dir="ltr">TRUNCATE TABLE global_orders;</pre><p>将值插入<code class="codeph">global_orders</code>表。
                        </p><pre class="oac_no_warn" dir="ltr">INSERT INTO global_orders VALUES（'28 -OCT-00 11:24:54 PM'，TIMESTAMP'2000-10-28 23:24:54'）;</pre><p>添加8小时到列。</p><pre class="oac_no_warn" dir="ltr">SELECT orderdate1 + INTERVAL'8'HOUR，orderdate2 + INTERVAL'8'HOUR FROM global_orders;</pre><p>以下输出结果。</p><pre class="oac_no_warn" dir="ltr">ORDERDATE1 + INTERVAL'8'HOUR ORDERDATE2 + INTERVAL'8'HOUR -------------------------- ---------- ----------------- 29-OCT-00 07.24.54.000000000 AM 29-OCT-00 07.24.54.000000000 AM UTC</pre><p>时间相同，因为不计算UTC时区区域的夏令时。</p>
                     </div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>