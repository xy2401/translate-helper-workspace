<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>RMAN数据修复概念</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96241-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="part-diagnosing-responding-failures.html" title="Previous" type="text/html"></link>
      <link rel="next" href="diagnosing-repairing-failures-dra.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="BRADV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="part-diagnosing-responding-failures.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="diagnosing-repairing-failures-dra.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复用户指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-diagnosing-responding-failures.html" property="item" typeof="WebPage"><span property="name">诊断和应对失败</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">RMAN数据修复概念</li>
            </ol>
            <a id="GUID-1805CCF7-4AF2-482D-B65A-998192F89C2B" name="GUID-1805CCF7-4AF2-482D-B65A-998192F89C2B"></a><a id="BRADV89703"></a>
            
            <h2 id="BRADV-GUID-1805CCF7-4AF2-482D-B65A-998192F89C2B" class="sect2"><span class="enumeration_chapter">14</span> RMAN数据修复概念</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍了执行<a href="glossary.html#GUID-80C351AD-232F-4C8F-995C-0B5239E6C378"><span class="xrefglossterm">数据修复时</span></a>必须了解的一般概念。本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="rman-data-repair-concepts.html#GUID-6718D3FE-E35D-42D3-BD45-D50E662B5C23" title="虽然有几个问题可以阻止Oracle数据库的正常运行或影响数据库I / O操作，但只有以下内容通常需要DBA干预和数据修复：用户错误，应用程序错误和介质故障。当由于应用程序逻辑错误或手动错误导致数据库中的数据被错误地更改或删除时，会发生用户错误。有时，软件故障可能会破坏数据块。在物理损坏（也称为介质损坏）中，数据库无法识别该块。当数据库外部的问题阻止其在正常操作期间读取或写入文件时，会发生介质故障。RMAN提供多种数据修复方法。">RMAN数据修复概述</a></p>
                  </li>
                  <li>
                     <p><a href="rman-data-repair-concepts.html#GUID-D6322BFA-1EF4-48CA-A52D-3FC7E35044FA" title="在RMAN还原操作中，选择要还原的文件，然后运行RESTORE命令。通常，您还原文件以准备介质恢复。">关于RMAN还原操作</a></p>
                  </li>
                  <li>
                     <p><a href="rman-data-repair-concepts.html#GUID-76B772E9-9B69-4D86-8735-D9453A425017" title="在介质恢复中，RMAN会对已还原的数据应用更改，以便及时前滚此数据。">关于RMAN Media Recovery</a></p>
                  </li>
               </ul>
            </div><a id="BRADV8199"></a><div class="props_rev_3"><a id="GUID-6718D3FE-E35D-42D3-BD45-D50E662B5C23" name="GUID-6718D3FE-E35D-42D3-BD45-D50E662B5C23"></a><h3 id="BRADV-GUID-6718D3FE-E35D-42D3-BD45-D50E662B5C23" class="sect3"><span class="enumeration_section">14.1</span> RMAN数据修复概述</h3>
               <div>
                  <p>如<span class="q">“ <a href="introduction-backup-recovery.html#GUID-7D5CF571-0B7A-46D7-B9DC-CD15F3A4C34F" title="作为备份管理员，您的主要工作是制作和监视数据保护备份。">关于数据保护</a> ”</span>中所述，备份和恢复策略的主要目的是数据保护。有效，高效战略的关键是了解数据修复的基本选项。
                  </p>
               </div><a id="BRADV89704"></a><div class="props_rev_3"><a id="GUID-4E91B620-9FB4-4DDF-BB1D-A1C5DA71B7F9" name="GUID-4E91B620-9FB4-4DDF-BB1D-A1C5DA71B7F9"></a><h4 id="BRADV-GUID-4E91B620-9FB4-4DDF-BB1D-A1C5DA71B7F9" class="sect4"><span class="enumeration_section">14.1.1</span>关于需要修复数据的问题</h4>
                  <p>虽然有几个问题可以阻止Oracle数据库的正常运行或影响数据库I / O操作，但只有以下内容通常需要DBA干预和数据修复：用户错误，应用程序错误和介质故障。</p><a id="BRADV89705"></a><div class="props_rev_3"><a id="GUID-8F3BC8E9-34F6-46DF-BDF4-7F69770C349F" name="GUID-8F3BC8E9-34F6-46DF-BDF4-7F69770C349F"></a><h5 id="BRADV-GUID-8F3BC8E9-34F6-46DF-BDF4-7F69770C349F" class="sect5"><span class="enumeration_section">14.1.1.1</span>关于用户错误</h5>
                     <div>
                        <p>当由于应用程序逻辑错误或手动错误导致数据库中的数据被错误地更改或删除时，会发生用户错误。</p>
                        <p>例如，用户登录到错误的数据库并删除数据库表。用户错误估计是导致数据库停机的最大原因。</p>
                     </div>
                  </div><a id="BRADV89706"></a><div class="props_rev_3"><a id="GUID-5591B05F-8253-4B25-B64C-E7084E7A8DD9" name="GUID-5591B05F-8253-4B25-B64C-E7084E7A8DD9"></a><h5 id="BRADV-GUID-5591B05F-8253-4B25-B64C-E7084E7A8DD9" class="sect5"><span class="enumeration_section">14.1.1.2</span>关于应用程序错误</h5>
                     <p>有时，软件故障可能会破坏数据块。在物理损坏（也称为介质损坏）中，数据库无法识别该块。</p>
                  </div><a id="BRADV89707"></a><div class="props_rev_3"><a id="GUID-5664E5E8-A5DA-4BA5-91C2-A50954010920" name="GUID-5664E5E8-A5DA-4BA5-91C2-A50954010920"></a><h5 id="BRADV-GUID-5664E5E8-A5DA-4BA5-91C2-A50954010920" class="sect5"><span class="enumeration_section">14.1.1.3</span>关于介质故障</h5>
                     <div>
                        <p>当数据库外部的问题阻止其在正常操作期间读取或写入文件时，会发生介质故障。</p>
                        <p>典型的介质故障包括磁盘故障和数据库文件的删除。媒体故障不像用户或应用程序错误那么常见，但您的备份和恢复策略应该为它们做好准备。</p>
                     </div>
                  </div>
               </div><a id="BRADV89708"></a><div class="props_rev_3"><a id="GUID-E78CF06A-1EF0-4B18-8AFA-6C4297B0AF8A" name="GUID-E78CF06A-1EF0-4B18-8AFA-6C4297B0AF8A"></a><h4 id="BRADV-GUID-E78CF06A-1EF0-4B18-8AFA-6C4297B0AF8A" class="sect4"><span class="enumeration_section">14.1.2</span>关于RMAN数据修复技术</h4>
                  <div>
                     <p>RMAN提供多种数据修复方法。</p>
                     <div class="p">根据您预期的情况，考虑将下表中描述的每个选项合并到响应数据丢失的策略中，然后设置数据库以使这些选项成为可能。
                        <div class="tblformal" id="GUID-E78CF06A-1EF0-4B18-8AFA-6C4297B0AF8A__GUID-3099E9BC-871C-4502-A352-65D7A2046955">
                           <p class="titleintable">表14-1 RMAN数据修复技术</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="RMAN数据修复技术" border="1" summary="This table briefly describes and then provides links to additional information about RMAN data repair techniques." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" id="d69940e580">数据修复技术</th>
                                    <th align="left" valign="bottom" id="d69940e582">描述</th>
                                    <th align="left" valign="bottom" id="d69940e584">附加信息</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d69940e588" headers="d69940e580 ">
                                       <p><a href="glossary.html#GUID-5E618F7B-127F-4BE2-9ED5-E9D1B828434D"><span class="xrefglossterm">数据恢复顾问</span></a></p>
                                    </td>
                                    <td align="left" valign="top" headers="d69940e588 d69940e582 ">
                                       <p>此Oracle数据库基础架构可以诊断故障，建议您如何响应故障并自动修复故障。</p>
                                    </td>
                                    <td align="left" valign="top" headers="d69940e588 d69940e584 ">
                                       <p><span class="q">“ <a href="diagnosing-repairing-failures-dra.html#GUID-636EA9BE-2DFB-4FA0-959E-B1290C774ABD" title="Data Recovery Advisor是一种通过确定数据库故障的最佳自动修复选项来帮助减少数据库恢复时间的工具。">数据恢复顾问概述</a> ”</span> 
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d69940e605" headers="d69940e580 ">
                                       <p><a href="glossary.html#GUID-66505C98-875E-4C34-AB45-39762061D6D7"><span class="xrefglossterm">逻辑闪回功能</span></a></p>
                                    </td>
                                    <td align="left" valign="top" headers="d69940e605 d69940e582 ">
                                       <p>通过<a href="glossary.html#GUID-B9B3A008-D1DB-4B83-B825-70E8B79A9920"><span class="xrefglossterm">Oracle闪回技术</span></a>功能的这一子集，您可以查看或回滚过去的各个数据库对象或事务。这些功能不需要使用RMAN。</p>
                                    </td>
                                    <td align="left" valign="top" headers="d69940e605 d69940e584 ">
                                       <p><span class="q">“ <a href="rman-performing-flashback-dbpitr.html#GUID-94B90ECF-69C9-40D4-A318-DC4AE9776557" title="此概述描述了Oracle闪回技术和数据库时间点恢复的目的和基本概念。">Oracle闪回技术和数据库时间点恢复概述</a> ”</span></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d69940e624" headers="d69940e580 ">
                                       <p><a href="glossary.html#GUID-DD883C9B-0441-48D3-9DDC-755597782971"><span class="xrefglossterm">Oracle闪回数据库</span></a></p>
                                    </td>
                                    <td align="left" valign="top" headers="d69940e624 d69940e582 ">
                                       <p>闪回数据库是一种块级恢复机制，类似于介质恢复，但通常速度更快，不需要还原备份。如果您事先启用了闪回日志记录，则可以将整个数据库返回到先前的状态，而无需从备份中恢复数据文件的旧副本。您必须配置快速恢复区域以记录闪回数据库或保证还原点。</p>
                                    </td>
                                    <td align="left" valign="top" headers="d69940e624 d69940e584 ">
                                       <p><span class="q">“ <a href="rman-performing-flashback-dbpitr.html#GUID-15D5CF76-8622-4117-8954-3D872A0B0A86" title="数据库时间点恢复（DBPITR）和闪回功能使您可以将数据库恢复到先前的某个时间点。">时间点恢复和闪回功能的基本概念</a> ”</span></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d69940e640" headers="d69940e580 ">
                                       <p><a href="glossary.html#GUID-01B3A956-DA97-4B47-9600-FA5549B7E868"><span class="xrefglossterm">数据文件媒体恢复</span></a></p>
                                    </td>
                                    <td align="left" valign="top" headers="d69940e640 d69940e582 ">
                                       <p>通过这种形式的<a href="glossary.html#GUID-5FEE9C7C-AD8F-4CFB-BAF2-E6B52EDC67AB"><span class="xrefglossterm">介质恢复，</span></a>您可以还原数据文件备份并应用归档重做日志或增量备份以恢复丢失的更改。您可以恢复整个数据库或数据库的子集。数据文件介质恢复是最通用的恢复形式，可以防止物理和逻辑故障。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" headers="d69940e640 d69940e584 ">
                                       <ul style="list-style-type:disc">
                                          <li>
                                             <p><span class="q">“ <a href="rman-complete-database-recovery.html#GUID-D908719C-9D46-4084-850C-0F81C25094EB" title="丢失一个或多个数据库文件后，完全恢复会使数据库恢复正常运行。完全恢复正在将数据库恢复到最近的某个时间点，而不会丢失任何已提交的事务。本章中描述的完整恢复操作受特定条件的限制。零数据丢失恢复设备（恢复设备）大大减少了连续归档重做日志备份之间存在的潜在数据丢失窗口。您可以在数据库故障的几个亚之内恢复目标数据库。您必须根据恢复目标以及丢失的数据库文件来规划数据库还原和恢复策略。用于确定哪些文件需要还原或恢复的技术取决于丢失的文件类型。当任何多路复用控制文件变得不可访问时，数据库立即关闭。关于何时以及如何恢复的决定取决于数据库的状态和数据文件的位置。确定缺少哪些数据文件的简单方法是运行VALIDATE DATABASE命令。尽管VALIDATE DATABASE是确定文件是否不可访问的好方法，但您可能希望使用SQL查询来获取更详细的信息。建议您记录数据库的DBID。预览备份可帮助您确保还原和恢复操作所需的所有备份都可用。异地备份存储在远程位置，例如安全存储设施，除非媒体管理器检索媒体，否则无法恢复。验证备份可确定备份是否可用。RMAN会根据需要自动从备份还原存档的重做日志文件以执行恢复。RMAN使您可以覆盖已还原的归档重做日志文件的默认位置。要管理用于包含已还原日志的磁盘空间，可以在一个RUN块中多次指定已归档日志的还原目标，以在多个目标之间分配已还原的日志。对于使用某些技术加密的备份，您必须提供用于解密这些备份的密码。在完全恢复期间，RMAN将还原一个或多个数据文件，然后应用还原备份后生成的所有重做。您使用RESTORE和RECOVER命令来还原和恢复数据库。如果无法将数据文件还原到其默认位置，则必须更新控制文件以反映数据文件的新位置。此方案假定数据库trgt已丢失其大部分或全部数据文件。它还假定数据库使用快速恢复区域。使用带有TABLESPACE选项的RESTORE和RECOVER命令执行表空间的完全恢复您可以通过切换到无法访问的数据文件的映像副本来恢复数据库。这种技术比传统的恢复和恢复花费的时间更少，因为不需要恢复备份。当一个或多个数据文件损坏时，您可以通过切换到损坏的数据文件的现有映像副本来执行恢复。您可以通过切换到损坏的数据文件的映像副本而不是还原这些数据文件来执行完整的数据库恢复。RMAN和Oracle Enterprise Manager云控制（云控制）为多租户环境中的备份和恢复提供全面支持。恢复整个CDB时，可以在单个操作中恢复根和所有PDB。如果发生仅影响根的数据损坏或用户错误，您可以考虑仅恢复根。您可以执行一个或多个PDB的完全恢复，而不会影响其他打开的PDB的操作。企业管理器云控制（云控制）提供了恢复PDB的界面。使用RECOVER命令使用预包装备份执行完全恢复。预打印备份用于在PDB插入当前CDB之前的某个时间将PDB恢复并恢复到其状态。 RMAN使用预包装备份执行PDB的完全恢复。在将PDB迁移到当前目标CDB之前，在源非CDB或源CDB上创建了这些预制备份备份。此示例使用预刷新备份执行目标CDB prod_cdb中PDB my_pdb的完全恢复。由于不同PDB中的表空间可以具有相同的名称，以消除歧义，因此必须直接连接到PDB以恢复其一个或多个表空间。相反，由于数据文件编号和路径在整个CDB中是唯一的，因此您可以在恢复PDB数据文件时连接到根或PDB。Oracle企业管理器云控制（云控制）提供了一个用于恢复PDB中的表空间的界面。通过切换到副本来恢复CDB比传统的恢复和恢复更快。RMAN使您可以使用RESTORE和RECOVER命令执行应用程序容器的完全恢复，而不会影响CDB中的其他容器。使用RESTORE和RECOVER命令执行应用程序根目录的完全恢复。您可以执行应用程序容器的完全恢复，其中包括应用程序根目录及其所有应用程序PDB，而不会影响CDB中的其他PDB。使用RESTORE和RECOVER命令执行一个或多个应用程序PDB的完全恢复。您可以使用RESTORE和RECOVER命令将稀疏数据库恢复到最近的时间点。执行包含稀疏数据文件的数据库的恢复与执行整个数据库的恢复非常相似。执行稀疏CDB的恢复与执行稀疏数据库的完全恢复非常相似。在根级别或CDB级别连接时，可以恢复稀疏PDB。">执行完整的数据库恢复</a> ”</span></p>
                                          </li>
                                          <li>
                                             <p><span class="q">“ <a href="rman-performing-flashback-dbpitr.html#GUID-7D3EE2F7-77A2-4264-8875-CC0AEC64ABE0" title="RMAN DBPITR在目标恢复时间之前从备份还原数据库，然后使用增量备份和重做将数据库前滚到目标时间。您可以恢复到SCN，时间，日志序列号或还原点。Oracle建议您在重要时间创建还原点，以便在必要时使时间点恢复更易于管理。">执行数据库时间点恢复</a> ”</span></p>
                                          </li>
                                       </ul>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d69940e732" headers="d69940e580 ">
                                       <p><a href="glossary.html#GUID-923A509A-1C36-4EA4-91C8-6E4F372722C0"><span class="xrefglossterm">阻止媒体恢复</span></a></p>
                                    </td>
                                    <td align="left" valign="top" headers="d69940e732 d69940e582 ">
                                       <p>这种形式的<a href="glossary.html#GUID-5FEE9C7C-AD8F-4CFB-BAF2-E6B52EDC67AB"><span class="xrefglossterm">介质恢复</span></a>使您可以恢复数据文件中的各个块，而不是整个数据文件。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" headers="d69940e732 d69940e584 ">
                                       <p><span class="q">“ <a href="rman-block-media-recovery.html#GUID-B6CFA426-5B2D-401F-B8B3-58FCD9ED3216" title="阻止介质恢复恢复通过恢复损坏的数据块提供较低的平均恢复时间（MTTR）。">块介质恢复概述</a> ”</span></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d69940e751" headers="d69940e580 ">
                                       <p><a href="glossary.html#GUID-8A257409-B3DC-41FD-A2AF-D47560FF9F18"><span class="xrefglossterm">表空间时间点恢复（TSPITR）</span></a></p>
                                    </td>
                                    <td align="left" valign="top" headers="d69940e751 d69940e582 ">
                                       <p>这是一种特殊形式的<a href="glossary.html#GUID-491BEF3A-18F0-4670-B078-2D84765141E8"><span class="xrefglossterm">时间点恢复</span></a> ，您可以将一个或多个表空间恢复到比数据库其余部分早的时间。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" headers="d69940e751 d69940e584 ">
                                       <p><span class="q">“ <a href="performing-rman-tspitr.html#GUID-416AF503-9611-46AA-81A9-7B9E1A0A5AC1" title="要有效地使用RMAN表空间时间点恢复（TSPITR），了解它可以解决的问题类型，组件，RMAN在TSPITR期间所执行的操作以及对何时以及如何进行的各种限制和限制很有帮助。跑。本节介绍运行RMAN TSPITR的基本概念，准备任务和模式。">RMAN TSPITR概述</a> ”</span></p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <p>通常，解释使用前述修复技术所需的概念以及技术。本章介绍了几种RMAN数据修复解决方案常见的概念。</p>
                  </div>
               </div>
            </div><a id="BRADV116"></a><div class="props_rev_3"><a id="GUID-D6322BFA-1EF4-48CA-A52D-3FC7E35044FA" name="GUID-D6322BFA-1EF4-48CA-A52D-3FC7E35044FA"></a><h3 id="BRADV-GUID-D6322BFA-1EF4-48CA-A52D-3FC7E35044FA" class="sect3"><span class="enumeration_section">14.2</span>关于RMAN还原操作</h3>
               <div>
                  <p>在RMAN还原操作中，选择要还原的文件，然后运行<code class="codeph">RESTORE</code>命令。通常，您还原文件以准备介质恢复。
                  </p>
                  <p>您可以还原以下类型的文件：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>数据库（所有数据文件）</p>
                     </li>
                     <li>
                        <p>表空间</p>
                     </li>
                     <li>
                        <p>控制文件</p>
                     </li>
                     <li>
                        <p>存档的重做日志</p>
                     </li>
                     <li>
                        <p>服务器参数文件</p>
                     </li>
                  </ul>
                  <p>您可以为还原的数据文件和控制文件指定默认位置或新位置。如果还原到默认位置，则RMAN将覆盖此位置中当前存在的具有相同名称的所有文件。或者，您可以使用<code class="codeph">SET NEWNAME</code>命令为还原的数据文件指定新位置。然后，您可以运行<code class="codeph">SWITCH</code>命令来更新控制文件，以指示其新位置中的已还原文件现在是当前数据文件。
                  </p>
                  <div class="infoboxnotealso" id="GUID-D6322BFA-1EF4-48CA-A52D-3FC7E35044FA__GUID-C1D72C97-1445-4CA2-A388-BA8F5FE26BC7">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>适用于<code class="codeph">RESTORE</code>语法和先决条件的<a href="../rcmrf/RESTORE.html#RCMRF149" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                        </li>
                        <li>
                           <p><code class="codeph">SET NEWNAME</code>语法的<a href="../rcmrf/SET.html#RCMRF153" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                        </li>
                        <li>
                           <p>适用于<code class="codeph">SWITCH</code>语法的<a href="../rcmrf/SWITCH.html#RCMRF159" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="BRADV89709"></a><div class="props_rev_3"><a id="GUID-164F7AD2-EF3F-4541-98A3-5DE198D87550" name="GUID-164F7AD2-EF3F-4541-98A3-5DE198D87550"></a><h4 id="BRADV-GUID-164F7AD2-EF3F-4541-98A3-5DE198D87550" class="sect4"><span class="enumeration_section">14.2.1</span>关于RMAN备份选择</h4>
                  <div>
                     <p>RMAN使用RMAN存储库中可用备份集或映像副本的记录来选择用于还原操作的最佳可用备份。</p>
                     <p>可用的最新备份或满足<code class="codeph">RESTORE</code>命令中指定的任何<code class="codeph">UNTIL</code>子句的最新备份是首选。如果两个备份来自同一时间点，则RMAN优先于备份集上的映像副本，因为RMAN可以从映像副本中快速恢复，而不是从备份集（尤其是存储在磁带上的备份集）中恢复。
                     </p>
                     <p>在RMAN恢复备份之前，必须满足<code class="codeph">RESTORE</code>命令的所有规范。除非受<code class="codeph">DEVICE</code> <code class="codeph">TYPE</code>子句的限制，否则<code class="codeph">RESTORE</code>命令将在所有已配置通道的设备类型上搜索备份。如果存储库中没有可用备份满足所有指定条件，则RMAN将返回错误，指示无法还原该文件。
                     </p>
                     <p>如果仅使用手动分配的通道，则如果在您为其分配通道的介质上没有可用的备份，则备份作业可能会失败。配置自动通道使RMAN更有可能找到并恢复满足指定条件的备份。</p>
                     <div class="infoboxnotealso" id="GUID-164F7AD2-EF3F-4541-98A3-5DE198D87550__GUID-78909369-4757-4D9E-889D-C6AA4E9B5F1F">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="configuring-rman-client-advanced.html#GUID-EF072AB8-AE89-4847-90B1-2214FD2336B3" title="CONFIGURE CHANNEL命令用于配置RMAN通道选项。">配置高级频道选项</a> ”</span></p>
                     </div>
                  </div>
               </div><a id="BRADV30001"></a><div class="props_rev_3"><a id="GUID-D76CD1E8-2B9E-40F6-A13F-3264D6BA2B8C" name="GUID-D76CD1E8-2B9E-40F6-A13F-3264D6BA2B8C"></a><h4 id="BRADV-GUID-D76CD1E8-2B9E-40F6-A13F-3264D6BA2B8C" class="sect4"><span class="enumeration_section">14.2.2</span>关于RMAN还原故障转移</h4>
                  <div>
                     <p>RMAN自动使用还原故障转移来跳过损坏或无法访问的备份并查找可用的备份。如果未找到备份或包含损坏的数据，RMAN会自动查找从中还原所需文件的另一个备份。</p>
                     <p>RMAN生成指示其正在执行的故障转移类型的消息。例如，当RMAN故障转移到同一文件的另一个备份时，它会生成类似于以下内容的消息：</p><pre class="oac_no_warn" dir="ltr">故障转移到句柄= / u01 / backup / db_1 tag = BACKUP_031009</pre><p>如果没有可用的副本，则RMAN将搜索以前的备份。生成的消息类似于以下示例：</p><pre class="oac_no_warn" dir="ltr">ORA-19624：操作失败，重试可能ORA-19505：无法识别文件“/ u01 / backup / db_1”ORA-27037：无法获取文件状态SVR4错误：2：没有此类文件或目录附加信息：3故障转移到以前的备份</pre><p>RMAN重复执行还原故障转移，直到它耗尽所有可能的备份。如果所有备份都不可用或没有备份，则RMAN会尝试重新创建数据文件。在<code class="codeph">RECOVER</code> ， <code class="codeph">RECOVER ...期间恢复归档重做日志时出现错误时，也会使用还原故障转移<code class="codeph">RECOVER ...BLOCK</code>和<code class="codeph">FLASHBACK DATABASE</code>命令。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-111D4107-6A6A-4910-BB95-D20C4036D7AD" name="GUID-111D4107-6A6A-4910-BB95-D20C4036D7AD"></a><h4 id="BRADV-GUID-111D4107-6A6A-4910-BB95-D20C4036D7AD" class="sect4"><span class="enumeration_section">14.2.3</span>关于RMAN恢复加密备份</h4>
                  <div>
                     <p>RMAN会在还原其内容时自动解密受备份加密保护的备份集。其他步骤（如果有）取决于用于加密备份的技术。</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>如果Oracle密钥库可用，则使用自动登录软件密钥库的透明备份加密不需要干预。</p>
                           <p>在与创建备份的源主机不同的主机上还原备份时，请手动将Oracle密钥库从源数据库复制到目标主机。</p>
                        </li>
                        <li>
                           <p>使用基于密码的密钥库进行透明备份加密需要打开密钥库。</p>
                           <p>手动将Oracle软件密钥库复制到要还原备份的目标主机，并提供打开密钥库所需的密码。<code class="codeph">SET DECRYPTION WALLET OPEN IDENTIFIED BY</code>命令提供密码。
                           </p>
                        </li>
                        <li>
                           <p>密码加密的备份需要输入正确的密码才能还原。</p>
                           <p>使用<code class="codeph">SET DECRYPTION IDENTIFIED BY</code>命令指定必须用于解密加密备份的密码。
                           </p>
                        </li>
                        <li>
                           <p>可以使用Oracle软件密钥库透明地或通过指定解密密码来恢复双模式加密备份。</p>
                        </li>
                     </ul>
                     <div class="section">
                        <p class="subhead3" id="GUID-111D4107-6A6A-4910-BB95-D20C4036D7AD__GUID-DEE1B266-2336-44B2-84FC-B4C941405FEB">TDE主密钥和透明加密备份</p>
                        <p>重置（或旋转，重新生成）TDE主加密密钥时，RMAN仍可以还原使用旧TDE主加密密钥加密的备份。这是可能的，因为Oracle密钥库存储了所有已停用的TDE主加密密钥的历史记录。</p>
                        <div class="infoboxnote" id="GUID-111D4107-6A6A-4910-BB95-D20C4036D7AD__GUID-B0FA373C-41FE-4915-849B-9D66B375405B">
                           <p class="notep1">注意：</p>如果包含TDE主密钥的Oracle密钥库丢失并需要重新创建，则使用旧TDE主密钥加密的任何备份都将失效并且无法使用。
                        </div>
                        <div class="infoboxnotealso" id="GUID-111D4107-6A6A-4910-BB95-D20C4036D7AD__GUID-CB1B9672-9246-4B6A-9CC8-366AE0DA2AA6">
                           <p class="notep1">也可以看看：</p><a href="../asoag/managing-keystore-and-tde-master-encryption-key.html#ASOAG-GUID-0C080CA8-1812-4DCD-AC30-FE47534C7962" target="_blank"><span><cite>Oracle数据库高级安全性指南</cite></span></a></div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV850"></a><div class="props_rev_3"><a id="GUID-1AE2D74F-250D-4D58-9025-3F47F494AC40" name="GUID-1AE2D74F-250D-4D58-9025-3F47F494AC40"></a><h4 id="BRADV-GUID-1AE2D74F-250D-4D58-9025-3F47F494AC40" class="sect4"><span class="enumeration_section">14.2.4</span>关于RMAN还原操作和ASM</h4>
                  <div>
                     <p>使用自动存储管理（ASM）磁盘组时，仅当数据文件的全名（包括化身）与现有数据文件的名称不匹配时，RMAN还原操作才会创建数据文件的新副本。</p>
                     <p>完全限定的ASM文件名的格式为<code>+diskgroup/dbname/filetype/filetypetag.file.incarnation</code> 。首次还原控制文件然后还原其他数据库文件时，控制文件中的数据文件名可能与现有数据文件的名称不匹配，因此会重新创建数据文件。
                     </p>
                     <p>使用以下方法之一确保在还原或重复操作期间不重新创建现有数据文件：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>在控制文件中，为每个数据文件使用别名。别名不得包含ASM化身编号。</p>
                        </li>
                        <li>
                           <p>还原控制文件之后和还原其他数据库文件之前，请使用<code class="codeph">CATALOG</code>命令确保在还原的控制文件中编目现有数据文件。接下来，使用<code class="codeph">SWITCH</code>命令使还原的控制文件指向现有数据文件。
                           </p>
                        </li>
                        <li>
                           <p>在还原数据文件之前和还原控制文件之后，使用<code class="codeph">SET NEWNAME</code>重命名数据文件。
                           </p>
                        </li>
                     </ul>
                  </div>
               </div><a id="BRADV89710"></a><div class="props_rev_3"><a id="GUID-43A50B18-3F02-46C9-B760-FF7375FFF5D4" name="GUID-43A50B18-3F02-46C9-B760-FF7375FFF5D4"></a><h4 id="BRADV-GUID-43A50B18-3F02-46C9-B760-FF7375FFF5D4" class="sect4"><span class="enumeration_section">14.2.5</span>关于RMAN还原优化</h4>
                  <div>
                     <p>RMAN使用还原优化来避免在可能的情况下从备份还原数据文件。如果数据文件存在于正确的位置且其标头包含预期信息，则RMAN不会从备份还原数据文件。</p>
                     <div class="infoboxnote" id="GUID-43A50B18-3F02-46C9-B760-FF7375FFF5D4__GUID-E2108717-8DA3-41F9-A348-1F6827F14DE7">
                        <p class="notep1">注意：</p>
                        <p>还原优化仅检查数据文件头。它不会扫描数据文件正文中的已损坏块。</p>
                     </div>
                     <p>您可以使用<code class="codeph">RESTORE</code>命令的<code class="codeph">FORCE</code>选项覆盖此行为并无条件地还原所请求的文件。
                     </p>
                     <p>当恢复多个数据文件的操作被中断时，恢复优化特别有用。例如，假设除了一个数据文件已恢复之外，完整数据库还原在遇到电源故障之后。如果再次运行相同的<code class="codeph">RESTORE</code>命令，则RMAN仅还原在上一次尝试期间未还原的单个数据文件。
                     </p>
                     <p>复制数据库时也使用还原优化。如果副本中的数据文件位于具有正确标头内容的正确位置，则不会复制数据文件。与<code class="codeph">RESTORE</code>不同， <code class="codeph">DUPLICATE</code>不支持<code class="codeph">FORCE</code>选项。要强制RMAN复制由于还原优化而跳过的数据文件，请在运行<code class="codeph">DUPLICATE</code>命令之前从副本中删除数据文件。
                     </p>
                     <div class="infoboxnotealso" id="GUID-43A50B18-3F02-46C9-B760-FF7375FFF5D4__GUID-EEB887D1-30F9-43C3-BC85-AEB345E82743">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../racad/managing-backup-and-recovery.html#RACAD059" target="_blank"><span><cite>“Oracle Real Application Clusters管理和部署指南”，</cite></span></a>了解Oracle RAC配置中的<code class="codeph">RESTORE</code>行为</p>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV117"></a><div class="props_rev_3"><a id="GUID-76B772E9-9B69-4D86-8735-D9453A425017" name="GUID-76B772E9-9B69-4D86-8735-D9453A425017"></a><h3 id="BRADV-GUID-76B772E9-9B69-4D86-8735-D9453A425017" class="sect3"><span class="enumeration_section">14.3</span>关于RMAN Media Recovery</h3>
               <div>
                  <p>在介质恢复中，RMAN会对已还原的数据应用更改，以便及时前滚此数据。</p>
                  <p>RMAN可以执行<a href="glossary.html#GUID-01B3A956-DA97-4B47-9600-FA5549B7E868"><span class="xrefglossterm">数据文件介质恢复</span></a>或<a href="glossary.html#GUID-923A509A-1C36-4EA4-91C8-6E4F372722C0"><span class="xrefglossterm">阻止介质恢复</span></a> 。
                  </p>
                  <p>数据文件介质恢复是将重做日志或增量备份应用于已还原的数据文件，以将其更新为当前时间或某个其他指定时间。如<a href="../cncpt/concepts-for-database-administrators.html#CNCPT031" target="_blank"><span><cite>Oracle数据库概念中所述</cite></span></a> ，您可以使用RMAN执行<a href="glossary.html#GUID-6486CE9C-3487-4B47-BDAF-EF5199D27E3A"><span class="xrefglossterm">完全恢复</span></a> ， <a href="glossary.html#GUID-FCC8BB91-79B6-4AF1-974A-43E75CD161E3"><span class="xrefglossterm">数据库时间点恢复（DBPITR）</span></a>或<a href="glossary.html#GUID-8A257409-B3DC-41FD-A2AF-D47560FF9F18"><span class="xrefglossterm">表空间时间点恢复（TSPITR）</span></a> 。您可以使用<code class="codeph">RESTORE</code>命令恢复丢失和损坏的数据文件或控制文件的备份，使用<code class="codeph">RECOVER</code>命令执行介质恢复。
                  </p>
                  <p>阻止介质恢复是恢复单个数据块而不是整个数据文件。本节仅介绍数据文件介质恢复。块媒体恢复是一种特殊形式的媒体恢复，在<span class="q">“ <a href="rman-block-media-recovery.html#GUID-B6CFA426-5B2D-401F-B8B3-58FCD9ED3216" title="阻止介质恢复恢复通过恢复损坏的数据块提供较低的平均恢复时间（MTTR）。">块媒体恢复概述”中进行了</a></span>解释。
                  </p>
               </div><a id="BRADV89711"></a><div class="props_rev_3"><a id="GUID-EC33413A-79B8-4ECF-A77B-DF91957D76FF" name="GUID-EC33413A-79B8-4ECF-A77B-DF91957D76FF"></a><h4 id="BRADV-GUID-EC33413A-79B8-4ECF-A77B-DF91957D76FF" class="sect4"><span class="enumeration_section">14.3.1</span>关于增量备份和归档重做日志的选择</h4>
                  <div>
                     <p>RMAN自动化媒体恢复。RMAN自动恢复并应用增量备份和归档重做日志，无论哪种组合最有效。</p>
                     <p>如果RMAN存储库指示磁盘上不存在所需日志序列号的副本，则它会自动从备份还原所需的日志。默认情况下，如果归档目标设置为<code class="codeph">USE_DB_RECOVERY_FILE_DEST</code> ，则RMAN会将归档日志还原到快速恢复区域。否则，RMAN会将日志还原到初始化参数文件中指定的第一个本地归档目标。
                     </p>
                     <div class="infoboxnotealso" id="GUID-EC33413A-79B8-4ECF-A77B-DF91957D76FF__GUID-59AEC854-59F6-4D66-BD4A-7E91E46898D7">
                        <p class="notep1">也可以看看：</p>
                        <p>用于<code class="codeph">CROSSCHECK</code>语法的<a href="../rcmrf/CROSSCHECK.html#RCMRF119" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                     </div>
                  </div>
               </div><a id="BRADV1171"></a><div class="props_rev_3"><a id="GUID-9942AC94-A35D-4A06-9A45-A5A43B82B23D" name="GUID-9942AC94-A35D-4A06-9A45-A5A43B82B23D"></a><h4 id="BRADV-GUID-9942AC94-A35D-4A06-9A45-A5A43B82B23D" class="sect4"><span class="enumeration_section">14.3.2</span>关于数据库化身</h4>
                  <div>
                     <p>只要使用<code class="codeph">RESETLOGS</code>选项打开数据库，就会创建数据库化身。
                     </p>
                     <p>完全恢复后，您可以在没有<code class="codeph">OPEN RESETLOGS</code>情况下恢复正常操作。但是，在使用备份控制文件进行DBPITR或恢复之后，必须使用<code class="codeph">RESETLOGS</code>选项打开数据库，从而创建数据库的新版本。当两个不同的重做流具有相同的SCN但是在不同的时间发生时，数据库需要新的化身以避免混淆。如果您将错误的重做应用于您的数据库，那么您就会破坏它。
                     </p>
                     <p>单个数据库的多个化身的存在决定了RMAN如何处理不在当前化身路径中的备份。通常，当前的数据库化身是正确使用的。然而，在某些情况下，将数据库重置为先前的化身是最好的方法。例如，您可能不满意已执行的时间点恢复的结果，并希望将数据库返回到<code class="codeph">RESETLOGS</code>之前的时间。了解数据库化身有助于为这种情况做好准备。
                     </p>
                  </div><a id="BRADV89712"></a><div class="props_rev_3"><a id="GUID-3DC071AD-5209-4F3D-98AA-6C0FA656D1B7" name="GUID-3DC071AD-5209-4F3D-98AA-6C0FA656D1B7"></a><h5 id="BRADV-GUID-3DC071AD-5209-4F3D-98AA-6C0FA656D1B7" class="sect5"><span class="enumeration_section">14.3.2.1</span>关于RMAN OPEN RESETLOGS操作</h5>
                     <div>
                        <p>使用<code class="codeph">RESETLOGS</code>选项打开数据库时，RMAN会执行某些操作。
                        </p>
                        <p>执行的操作如下：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>归档当前的联机重做日志（如果可访问），然后擦除联机重做日志的内容并将日志序列号重置为1。</p>
                              <p>例如，如果当前打开<code class="codeph">RESETLOGS</code> ，当前联机重做日志为序列1000和1001，则数据库归档日志1000和1001，然后将联机重做日志重置为序列1和2。
                              </p>
                           </li>
                           <li>
                              <p>如果当前不存在，则创建联机重做日志文件。</p>
                           </li>
                           <li>
                              <p>将控制文件中的重做线程记录和联机重做日志记录初始化为新数据库化身的开头。</p>
                              <p>更具体地说，数据库将重做线程状态设置为关闭，将重做线程记录中的当前线程序列设置为1，将每个重做线程的线程检查点设置为日志序列1的开头，从每个线程中选择一个重做日志，将其序列初始化为1，依此类推。</p>
                           </li>
                           <li>
                              <p>使用新的<code class="codeph">RESETLOGS SCN</code>和时间戳更新所有当前数据文件和联机重做日志以及所有后续归档重做日志。
                              </p>
                           </li>
                        </ul>
                        <p>由于数据库不会将归档重做日志应用于数据文件，除非<code class="codeph">RESETLOGS SCN</code>和时间戳匹配，因此<code class="codeph">RESETLOGS</code>要求可防止您使用不是来自当前化身的直接父化身的归档日志来破坏数据文件。在下一节中将更全面地解释化身之间的关系。
                        </p>
                        <p>在以前的版本中，建议您在<code class="codeph">OPEN RESETLOGS</code>之后立即备份数据库。因为您现在可以像任何其他备份一样轻松恢复预<code class="codeph">RESETLOGS</code>备份，因此可以选择新的数据库备份。要通过<code class="codeph">RESETLOGS</code>执行恢复，必须在最近一次备份后生成所有归档日志，并且必须至少有一个控制文件（当前，备份或创建）。
                        </p>
                     </div>
                  </div><a id="BRADV326"></a><a id="BRADV99974"></a><div class="props_rev_3"><a id="GUID-EC2E2F24-0AD3-486D-9289-407E7F1F5C9C" name="GUID-EC2E2F24-0AD3-486D-9289-407E7F1F5C9C"></a><h5 id="BRADV-GUID-EC2E2F24-0AD3-486D-9289-407E7F1F5C9C" class="sect5"><span class="enumeration_section">14.3.2.2</span>数据库化身<span class="enumeration_section">之间的</span>关系</h5>
                     <div>
                        <p>数据库化身可以相互建立以下关系：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="glossary.html#GUID-4CC16BA6-2C59-4202-AEBB-3518F45BFD56"><span class="xrefglossterm">当前的化身</span></a>是数据库当前正在运行的<a href="glossary.html#GUID-4CC16BA6-2C59-4202-AEBB-3518F45BFD56"><span class="xrefglossterm">化身</span></a> 。
                              </p>
                           </li>
                           <li>
                              <p>在<code class="codeph">OPEN RESETLOGS</code>操作之后当前化身分支的<a href="glossary.html#GUID-6DFC5F78-79E6-480B-9E29-B20876535B78"><span class="xrefglossterm">化身</span></a>是当前化身的<a href="glossary.html#GUID-6DFC5F78-79E6-480B-9E29-B20876535B78"><span class="xrefglossterm">父母</span></a>化身。
                              </p>
                           </li>
                           <li>
                              <p>父母化身的父母是<a href="glossary.html#GUID-853064EA-D07A-43C2-B27A-1E41928D43A7"><span class="xrefglossterm">祖先的化身</span></a> 。任何祖先化身的父母也是当前化身的祖先。
                              </p>
                           </li>
                           <li>
                              <p>当前化身的<a href="glossary.html#GUID-9FA6E4CA-C9C0-47E8-8FDF-2C2A313F8944"><span class="xrefglossterm">直接祖先路径</span></a>始于最早的化身，并且仅包括当前化身的祖先，父母的化身或当前的化身。
                              </p>
                           </li>
                        </ul>
                        <p>化身编号用于唯一标记和标识重做流。<a href="rman-data-repair-concepts.html#GUID-EC2E2F24-0AD3-486D-9289-407E7F1F5C9C__CHDCJGGD">图14-1</a>说明了一个经历了几个化身的数据库，每个化身都有不同的化身编号。
                        </p>
                        <div class="figure" id="GUID-EC2E2F24-0AD3-486D-9289-407E7F1F5C9C__CHDCJGGD">
                           <p class="titleinfigure">图14-1数据库化身历史</p><img src="img/bradv039.gif" alt="下面是图14-1的描述" title="下面是图14-1的描述" longdesc="img_text/bradv039.html"><br><a href="img_text/bradv039.html">“图14-1数据库化身历史”的描述</a></div>
                        <!-- class="figure" -->
                        <p>数据库的化身1从SCN 1开始并继续通过SCN 1000到SCN 2000。假设在版本1的SCN 2000中，您执行时间点恢复回SCN 1000，然后使用<code class="codeph">RESETLOGS</code>选项打开数据库。化身2现在从SCN 1000开始并继续到SCN 3000。在这个例子中，化身1是化身2的父母。
                        </p>
                        <p>假设在版本2的SCN 3000中，您执行SCN 2000的时间点恢复并使用<code class="codeph">RESETLOGS</code>选项打开数据库。在这种情况下，化身2是化身3的父母。化身1是化身3的祖先。
                        </p>
                        <p>当数据库中出现DBPITR或闪回数据库时，SCN可以引用多个时间点，具体取决于当前的化身。例如， <a href="rman-data-repair-concepts.html#GUID-EC2E2F24-0AD3-486D-9289-407E7F1F5C9C__CHDCJGGD">图14-1中的</a> SCN 1500可以指代化身1或2中的SCN。
                        </p>
                        <p>您可以使用<code class="codeph">RESET DATABASE TO INCARNATION</code>命令指定要在特定数据库化身的引用框架中解释SCN。当您使用<code class="codeph">FLASHBACK</code> ， <code class="codeph">RESTORE</code>或<code class="codeph">RECOVER</code>返回非当前数据库版本中的SCN时，需要<code class="codeph">RESET DATABASE TO INCARNATION</code>命令。但是，RMAN使用闪回隐式执行<code class="codeph">RESET DATABASE TO INCARNATION</code>命令，如<span class="q">“ <a href="managing-recovery-catalog.html#GUID-304B2237-0921-422F-A084-D83E7B5C8D2B" title="使用RESETLOGS选项打开数据库时，可以创建数据库的化身。您可以在V $ DATABASE_INCARNATION视图中访问新化身的记录。">在恢复目录中重置数据库化身”中所述</a></span> 。
                        </p>
                        <div class="infoboxnotealso" id="GUID-EC2E2F24-0AD3-486D-9289-407E7F1F5C9C__GUID-E295537F-7A2D-4B82-B057-B1F466123BDC">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="rman-performing-flashback-dbpitr.html#GUID-F1818201-98E5-4B70-BDFE-A61AB84397E6" title="要将DPITR执行到非当前数据库化身，必须显式执行RESET DATABASE以将数据库重置为目标SCN上当前的化身。您还必须从包含目标SCN的数据库化身中还原控制文件。">将数据库恢复为祖先的化身</a> ”</span></p>
                              </li>
                              <li>
                                 <p>有关<code class="codeph">RESET DATABASE</code>命令的详细信息，请<a href="../rcmrf/RESET-DATABASE.html#RCMRF148" target="_blank"><span><cite>参见Oracle数据库备份和恢复参考</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="BRADV679"></a><div class="props_rev_3"><a id="GUID-195FE6CA-9CEB-4ED1-9810-F7323F119D87" name="GUID-195FE6CA-9CEB-4ED1-9810-F7323F119D87"></a><h5 id="BRADV-GUID-195FE6CA-9CEB-4ED1-9810-F7323F119D87" class="sect5"><span class="enumeration_section">14.3.2.3</span>关于PDB的化身</h5>
                     <div>
                        <p>可插拔数据库（PDB）版本是多租户容器数据库（CDB）的子实现，表示为<code class="codeph">(</code> <span class="italic"><code class="codeph">database_incarnation, pdb_incarnation</code></span> <code class="codeph">)</code> 。
                        </p>
                        <p>例如，如果CDB是化身<code class="codeph">5</code> ，并且PDB是化身<code class="codeph">3</code> ，那么PDB的完全指定的化身编号是<code class="codeph">(5, 3)</code> 5,3 <code class="codeph">(5, 3)</code> 。PDB的初始化身为0。后续的化身是唯一的，但并不总是连续的数字。
                        </p>
                        <p><code class="codeph">V$PDB_INCARNATION</code>视图包含有关所有PDB化身的信息。使用以下查询显示PDB的当前版本：</p><pre class="pre codeblock"><code>SELECT PDB_INCARNATION＃FROM V $ PDB_INCARNATION WHERE STATUS =' <span class="italic">CURRENT'AND</span> CON_ID = <span class="italic">PDB_container_id</span> ;</code></pre></div>
                  </div><a id="BRADV89713"></a><div class="props_rev_3"><a id="GUID-8D278206-A634-422C-BA3B-3D4DD09B6B26" name="GUID-8D278206-A634-422C-BA3B-3D4DD09B6B26"></a><h5 id="BRADV-GUID-8D278206-A634-422C-BA3B-3D4DD09B6B26" class="sect5"><span class="enumeration_section">14.3.2.4</span>关于孤立备份</h5>
                     <div>
                        <p>当数据库经历多个化身时，某些备份可能成为孤立备份。孤立备份是在数据库的化身期间创建的备份，这些备份不在直接祖先路径中。</p>
                        <p>假设场景如图<a href="rman-data-repair-concepts.html#GUID-EC2E2F24-0AD3-486D-9289-407E7F1F5C9C__CHDCJGGD">14-1</a>所示。如果化身3是当前的化身，则以下备份是孤立的：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>SCN 1000之后的所有备份都来自化身1</p>
                           </li>
                           <li>
                              <p>SCN 2000之后的所有备份来自化身2</p>
                           </li>
                        </ul>
                        <p>相反，以下备份不是孤立的，因为它们位于直接祖先路径中：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>所有来自SCN 1000之前的化身1的备份</p>
                           </li>
                           <li>
                              <p>来自SCN 2000之前的化身2的所有备份</p>
                           </li>
                           <li>
                              <p>所有来自化身的备份3</p>
                           </li>
                        </ul>
                        <p>当您打算将数据库还原到不在直接祖先路径中的SCN时，可以使用孤立备份。如果从最早的备份到要恢复的点存在连续的归档日志路径，则RMAN可以从父级和祖先的版本恢复备份并恢复到当前时间，即使是在<code class="codeph">OPEN RESETLOGS</code>操作中也是如此。如果从尚未放弃备份中表示的更改的化身还原控制文件，则RMAN还可以还原和恢复孤立备份。
                        </p>
                     </div>
                  </div><a id="BRADV742"></a><div class="props_rev_3"><a id="GUID-21E646E6-CE3C-4C07-BD03-3904D30AD509" name="GUID-21E646E6-CE3C-4C07-BD03-3904D30AD509"></a><h5 id="BRADV-GUID-21E646E6-CE3C-4C07-BD03-3904D30AD509" class="sect5"><span class="enumeration_section">14.3.2.5</span>关于孤立的PDB备份</h5>
                     <div>
                        <p>当您在可插拔数据库（PDB）上执行时间点恢复，然后使用<code class="codeph">RESETLOGS</code>选项打开PDB时，可能会导致孤立PDB备份。
                        </p>
                        <p>将PDB恢复到指定的时间点后，当您使用<code class="codeph">RESETLOGS</code>选项打开PDB时，将创建PDB的新版本。孤立PDB备份是在SCN或时间值介于SCN或恢复PDB的时间与SCN或在<code class="codeph">RESETLOGS</code>模式下打开PDB的时间之间创建的备份。<code class="codeph">V$PDB_INCARNATION</code>视图的<code class="codeph">END_RESETLOGS_SCN</code>列包含在<code class="codeph">RESETLOGS</code>模式下打开PDB的SCN。
                        </p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>