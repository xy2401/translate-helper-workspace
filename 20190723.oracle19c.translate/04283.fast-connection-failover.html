<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>关于快速连接故障转移</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Universal Connection Pool Developer&#39;s Guide "></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Universal Connection Pool Developer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="universal-connection-pool-developers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-02-13T06:57:38-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1999, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96473-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="overview-Oracle-RAC-features.html" title="Previous" type="text/html"></link>
      <link rel="next" href="run-time-connection-load-balancing.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Universal Connection Pool Developer&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="JJUCP"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="overview-Oracle-RAC-features.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="run-time-connection-load-balancing.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">通用连接池开发人员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="using-Oracle-RAC-features.html" property="item" typeof="WebPage"><span property="name">使用Oracle RAC功能</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">关于快速连接故障转移</li>
            </ol>
            <a id="GUID-126F8C9B-C0B3-426B-B07D-4B127BBDD867" name="GUID-126F8C9B-C0B3-426B-B07D-4B127BBDD867"></a><a id="JJUCP08100"></a>
            
            <h2 id="JJUCP-GUID-126F8C9B-C0B3-426B-B07D-4B127BBDD867" class="sect2"><span class="enumeration_section">9.2</span>关于快速连接故障转移</h2>
         </header>
         <div class="ind">
            <div>
               <p>本节包含以下小节：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="fast-connection-failover.html#GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763">快速连接故障转移概述</a></p>
                  </li>
                  <li>
                     <p><a href="fast-connection-failover.html#GUID-1777BFF1-1FDB-4D3C-BA68-8DD165733F69">什么是快速连接故障转移</a></p>
                  </li>
                  <li>
                     <p><a href="fast-connection-failover.html#GUID-DEBA115B-9B14-4C4C-83EB-7D09F9F48970">快速连接故障转移先决条件</a></p>
                  </li>
                  <li>
                     <p><a href="fast-connection-failover.html#GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F">快速连接故障转移配置示例</a></p>
                  </li>
                  <li>
                     <p><a href="fast-connection-failover.html#GUID-A85462D1-A4F1-43DC-869E-721AE30B7E78">启用快速连接故障转移</a></p>
                  </li>
                  <li>
                     <p><a href="fast-connection-failover.html#GUID-F361FE59-9D12-47F9-B5DC-F5D996809AF4">什么是ONS</a></p>
                  </li>
                  <li>
                     <p><a href="fast-connection-failover.html#GUID-C54F3D4D-9973-41EA-B62B-E574DE94970F">配置连接URL</a></p>
                  </li>
               </ul>
            </div><a id="JJUCP8203"></a><a id="JJUCP8204"></a><a id="JJUCP8205"></a><a id="JJUCP8269"></a><div class="props_rev_3"><a id="GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763" name="GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763"></a><h3 id="JJUCP-GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763" class="sect3"><span class="enumeration_section">9.2.1</span>快速连接故障转移概述</h3>
               <div>
                  <p><a id="d8155e109" class="indexterm-anchor"></a><a id="d8155e111" class="indexterm-anchor"></a><a id="d8155e115" class="indexterm-anchor"></a>快速连接故障转移（FCF）功能是通过连接池实现的快速应用程序通知（FAN）客户端。该功能要求在单个实例数据库上使用Oracle JDBC驱动程序和Oracle RAC数据库或Oracle Restart。
                  </p>
                  <div class="infoboxnote" id="GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763__GUID-EE02456E-B8FE-4E2C-B661-11EE24F52479">
                     <p class="notep1">注意：</p>
                     <p>本节仅介绍在将FCF与Oracle RAC一起使用时应用程序必须执行的步骤。</p>
                  </div>
                  <div class="infoboxnotealso" id="GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763__GUID-657D6D96-11B8-47FE-9501-08F3E034E69D">
                     <p class="notep1">也可以看看：</p>
                     <p>有关设置Oracle RAC数据库或咨询Oracle数据库管理员的详细信息<a href="../racad/introduction-to-oracle-rac.html#RACAD-GUID-3FE2D3E6-EC1C-4478-A9E4-3751F7A47C9E" target="_blank"><span><cite>，请参见“Oracle Real Application Clusters管理和部署指南”</cite></span></a> 。
                     </p>
                  </div>
                  <p><a id="d8155e130" class="indexterm-anchor"></a> FCF管理池化连接以实现高可用性，并提供以下功能：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>FCF支持意外中断。快速检测到死连接，然后中止连接并从池中删除。连接删除依赖于中止来快速切断套接字连接以防止挂起。借用和使用中的连接仅在意外中断时中断。</p>
                     </li>
                     <li>
                        <p>FCF支持计划中断。借用或使用中的连接不会中断和关闭，直到工作完成并且连接的控制权返回到池中。</p>
                     </li>
                     <li>
                        <p>FCF将致命的连接错误和异常封装到<code class="codeph">isValid</code> API中，以实现强大而高效的重试。
                        </p>
                     </li>
                     <li>
                        <p>FCF识别加入Oracle RAC集群的新节点，并在该节点上适当地放置新连接，以便在运行时为应用程序提供最高质量的服务。这有助于从应用程序层进行Oracle RAC节点连接和工作请求路由的中间层集成。</p>
                     </li>
                     <li>
                        <p>FCF将运行时工作请求分发给所有活动的Oracle RAC实例。</p>
                     </li>
                  </ul>
                  <div class="section">
                     <p class="subhead2" id="GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763__GUID-3B4C12DF-5416-46E0-8347-1CAFADA48E1A">计划外关机方案</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>FCF通过检测和删除与Oracle RAC集群的过时连接来支持计划外关闭方案。过时连接包括由于服务中断和节点关闭事件而在Oracle RAC集群中的任何实例上没有可用服务的连接。检测到已借入的连接和过时的可用连接，并且在将它们从池中删除之前，它们的网络连接将被切断。这些已删除的连接不会被池替换。相反，应用程序必须在执行任何连接工作之前重试连接。</p>
                     <div class="infoboxnote" id="GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763__GUID-CF4EBDED-EAB9-4F2B-A4E2-797C21C43C74">
                        <p class="notep1">注意：</p>
                        <p>在计划外关闭情况下，借用的连接会立即中止并关闭。任何正在进行的交易都会立即收到异常。</p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763__BABGFIFI">
                     <p class="subhead2" id="GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763__GUID-7952931A-59EC-4C88-ACA7-C82C40E45D4E">计划关机方案</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>FCF支持计划关闭方案，可以正常关闭Oracle RAC服务。在这种情况下，过时的借用连接会被标记，只有在它们返回池后才会被中止和删除。任何正在进行的交易都没有看到任何差异并继续完成。</p>
                     <p>计划外和计划关闭方案之间的主要区别在于如何处理借用的连接。池中空闲（未借用）的过时连接将以与计划外关闭方案相同的方式删除。</p>
                     <p>从Oracle Database 12 <span class="italic">c</span>第1版（12.1.0.2）开始，UCP支持从任何计划中的Oracle RAC实例中正常连接耗尽。受影响的借用连接在宽限期内平稳删除，而不是在返回池时立即删除。这有助于在任何服务重定位期间避免吞吐量影响和登录风暴。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763__GUID-EC296D45-D419-40E5-AF46-9C4E109073CD">Oracle RAC实例重新加入和新实例方案</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>FCF支持Oracle RAC集群添加提供感兴趣服务的实例的方案。该实例可能是群集的新实例，也可能是在关闭事件后重新启动的。在这两种情况下，UCP都会识别新实例并根据需要创建与节点的连接。</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="validating-ucp-connections.html#GUID-39E5A876-8C54-423F-B6A7-5E827DE202C7">检查连接是否有效</a></li>
                        <li><a href="fast-connection-failover.html#GUID-A85462D1-A4F1-43DC-869E-721AE30B7E78">启用快速连接故障转移</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="JJUCP8270"></a><div class="props_rev_3"><a id="GUID-1777BFF1-1FDB-4D3C-BA68-8DD165733F69" name="GUID-1777BFF1-1FDB-4D3C-BA68-8DD165733F69"></a><h3 id="JJUCP-GUID-1777BFF1-1FDB-4D3C-BA68-8DD165733F69" class="sect3"><span class="enumeration_section">9.2.2</span>什么是快速连接故障转移？
               </h3>
               <div>
                  <p>启用快速连接故障转移后，该机制是自动的;不需要应用程序干预。本节讨论如何向应用程序提供连接故障转移以及应用程序恢复所需的步骤，在以下各节中：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="fast-connection-failover.html#GUID-AF352305-6B8F-47A9-BD73-1C7479E467BB">应用程序看到了什么</a></p>
                     </li>
                     <li>
                        <p><a href="fast-connection-failover.html#GUID-BD32FED1-6EE1-4148-A4C0-87A0A5E1DA85">FCF如何运作</a></p>
                     </li>
                  </ul>
               </div><a id="JJUCP8271"></a><div class="props_rev_3"><a id="GUID-AF352305-6B8F-47A9-BD73-1C7479E467BB" name="GUID-AF352305-6B8F-47A9-BD73-1C7479E467BB"></a><h4 id="JJUCP-GUID-AF352305-6B8F-47A9-BD73-1C7479E467BB" class="sect4"><span class="enumeration_section">9.2.2.1</span>应用程序看到了什么</h4>
                  <div>
                     <p>当Oracle RAC服务故障传播到JDBC应用程序时，数据库已回滚本地事务。然后缓存管理器清除所有无效连接。当持有无效连接的应用程序尝试通过该连接工作时，可以接收<code class="codeph">SQLException, ORA-17008, Closed Connection</code> 。
                     </p>
                     <p>当应用程序收到“ <code class="codeph">Closed Connection</code>错误消息时，应执行以下操作：</p>
                     <ol>
                        <li>
                           <p>重试连接请求。这是必不可少的，因为旧连接不再开放。</p>
                        </li>
                        <li>
                           <p>重播交易。在连接关闭之前完成的所有工作都已丢失。</p>
                        </li>
                     </ol>
                     <div class="infoboxnote" id="GUID-AF352305-6B8F-47A9-BD73-1C7479E467BB__GUID-92DFE648-F63A-4ABE-8FE7-906C62EAF721">
                        <p class="notep1">注意：</p>
                        <p>应用程序不应尝试回滚事务。在应用程序收到异常时，事务已在数据库中回滚。</p>
                     </div>
                  </div>
               </div><a id="JJUCP8272"></a><div class="props_rev_3"><a id="GUID-BD32FED1-6EE1-4148-A4C0-87A0A5E1DA85" name="GUID-BD32FED1-6EE1-4148-A4C0-87A0A5E1DA85"></a><h4 id="JJUCP-GUID-BD32FED1-6EE1-4148-A4C0-87A0A5E1DA85" class="sect4"><span class="enumeration_section">9.2.2.2</span> FCF的工作原理</h4>
                  <div>
                     <p>在快速连接故障转移下，缓存中的每个连接都维护到服务，实例，数据库和主机名的映射。</p>
                     <p>当数据库生成Oracle RAC事件时，该事件将转发到运行JDBC的JVM。JVM中的守护程序线程接收Oracle RAC事件并将其传递给Connection Cache Manager。然后，连接缓存管理器将SQL异常抛出到受Oracle RAC事件影响的应用程序。</p>
                     <p>典型的故障转移方案可能如下所示：</p>
                     <ol>
                        <li>
                           <p>数据库实例失败，在缓存中留下了几个陈旧的连接。</p>
                        </li>
                        <li>
                           <p>数据库中的Oracle RAC机制生成Oracle RAC事件，该事件将发送到包含JDBC的JVM。</p>
                        </li>
                        <li>
                           <p>JVM中的守护程序线程查找受Oracle RAC事件影响的所有连接，通过SQL异常通知它们已关闭的连接，并回滚所有打开的事务。</p>
                        </li>
                        <li>
                           <p>每个单独的连接都会收到SQL异常，必须重试。</p>
                        </li>
                     </ol>
                  </div>
               </div>
            </div><a id="JJUCP8273"></a><div class="props_rev_3"><a id="GUID-DEBA115B-9B14-4C4C-83EB-7D09F9F48970" name="GUID-DEBA115B-9B14-4C4C-83EB-7D09F9F48970"></a><h3 id="JJUCP-GUID-DEBA115B-9B14-4C4C-83EB-7D09F9F48970" class="sect3"><span class="enumeration_section">9.2.3</span>快速连接故障转移先决条件</h3>
               <div>
                  <div class="section">
                     <p><a id="d8155e386" class="indexterm-anchor"></a>在以下情况下可以使用快速连接故障转移：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>通用连接池已启用。</p>
                           <p>快速连接故障转移与JDBC连接缓存机制结合使用。这有助于应用程序管理连接以确保高可用性。</p>
                        </li>
                        <li>
                           <p>应用程序使用服务名称连接到数据库。</p>
                           <p>应用程序无法使用服务标识符。</p>
                        </li>
                        <li>
                           <p>底层数据库具有Oracle Database 12 <span class="italic">c</span>第1版（12.1）或更高版本的Real Application Clusters（Oracle RAC）功能或配置有单实例数据库或Oracle RAC的Oracle Data Guard。</p>
                           <p>如果未传播故障转移事件，则不会发生连接故障转移。</p>
                        </li>
                        <li>
                           <p>Oracle Notification Service（ONS）已在运行JDBC的节点上配置并可用。</p>
                           <p>JDBC依赖于ONS来传播数据库事件并通知它们的JDBC。</p>
                        </li>
                        <li>
                           <p>运行JDBC实例的Java虚拟机（JVM）必须将<code class="codeph">oracle.ons.oraclehome</code>设置为指向<span class="italic"><code class="codeph">ORACLE_HOME</code></span> 。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJUCP8207"></a><a id="JJUCP8206"></a><div class="props_rev_3"><a id="GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F" name="GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F"></a><h3 id="JJUCP-GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F" class="sect3"><span class="enumeration_section">9.2.4</span>快速连接故障转移配置示例</h3>
               <div>
                  <p><a id="d8155e462" class="indexterm-anchor"></a><a id="d8155e466" class="indexterm-anchor"></a>以下示例演示了使用FCF功能的连接池。FCF通过启用池的数据源进行配置。该示例包括启用FCF，配置Oracle Notification Service（ONS）和配置连接URL。这些主题在示例后讨论。
                  </p>
                  <p><code class="codeph">oracle.ucp.jdbc.的<code class="codeph">isValid</code>方法<code class="codeph">oracle.ucp.jdbc.ValidConnection</code>接口通常与FCF功能结合使用，用于检查在由于Oracle RAC关闭事件而引发SQL异常后，借用的连接是否仍然可用。例如：</p><pre class="oac_no_warn" dir="ltr">试试{conn = pds.getConnection; ...} catch（SQLException sqlexc）{if（conn == null ||！（（ValidConnection）conn）.isValid（））//采取适当的行动......conn.close（）; }</pre><div class="example" id="GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F__CHDEEBAJ">
                     <p class="titleinexample">例9-1快速连接故障转移配置示例</p><pre class="oac_no_warn" dir="ltr">PoolDataSource pds = PoolDataSourceFactory.getPoolDataSource（）; pds.setConnectionPoolName（ “FCFSamplePool”）; pds.setFastConnectionFailoverEnabled（真）; pds.setONSConfiguration（“nodes = racnode1：4200，racnode2：4200 \ nwalletfile = / oracle11 / onswalletfile”）; pds.setConnectionFactoryClassName（“oracle.jdbc.pool。OracleDataSource“）; pds.setURL（”jdbc：oracle：thin @（DESCRIPTION =“+”（LOAD_BALANCE = on）“+”（ADDRESS =（PROTOCOL = TCP）（HOST = racnode1）（PORT = 1521））“+ “（ADDRESS =（PROTOCOL = TCP）（HOST = racnode2）（PORT = 1521））”+“（CONNECT_DATA =（SERVICE_NAME = service_name）））”）; ...
</pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="validating-ucp-connections.html#GUID-39E5A876-8C54-423F-B6A7-5E827DE202C7">检查连接是否有效</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="JJUCP8274"></a><a id="JJUCP8208"></a><div class="props_rev_3"><a id="GUID-A85462D1-A4F1-43DC-869E-721AE30B7E78" name="GUID-A85462D1-A4F1-43DC-869E-721AE30B7E78"></a><h3 id="JJUCP-GUID-A85462D1-A4F1-43DC-869E-721AE30B7E78" class="sect3"><span class="enumeration_section">9.2.5</span>启用快速连接故障转移</h3>
               <div>
                  <div class="section">
                     <p><a id="d8155e535" class="indexterm-anchor"></a><a id="d8155e539" class="indexterm-anchor"></a><a id="d8155e541" class="indexterm-anchor"></a> FCF池属性用于启用和禁用FCF。默认情况下禁用FCF。以下示例演示如<a href="fast-connection-failover.html#GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F__CHDEEBAJ">示例9-1中</a>所示启用FCF。
                     </p><pre class="oac_no_warn" dir="ltr">pds.setFastConnectionFailoverEnabled（真）;</pre><div class="infoboxnote" id="GUID-A85462D1-A4F1-43DC-869E-721AE30B7E78__GUID-27E76B4E-1D85-4718-AB9D-374C7F0E9716">
                        <p class="notep1">注意：</p>
                        <p>从Oracle Database 12 <span class="italic">c</span> Release 1（12.1.0.2）开始，UCP支持<code class="codeph">oracle.ucp.PlannedDrainingPeriod</code>系统属性。它指定宽限时间段（以整数秒为单位），在该时间段内，池平稳地消耗受计划关闭影响的借用连接。当同一数据库服务在另一个与正在运行的实例不同的实例上可用时，将开始排空。
                        </p>
                        <p>如果未设置此属性或设置为<code class="codeph">0</code> ，则池将在返回池时立即关闭任何受影响的借用连接。
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-A85462D1-A4F1-43DC-869E-721AE30B7E78__GUID-9F37273B-B6E5-4865-A14B-09410599C158">查询快速连接故障转移状态</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>应用程序通过调用<code class="codeph">OracleDataSource.getFastConnectionFailoverEnabled</code>确定是否启用了快速连接故障转移，如果启用了故障转移，则返回<code class="codeph">true</code> ，否则返回<code class="codeph">false</code> 。
                     </p>
                     <div class="infoboxnote" id="GUID-A85462D1-A4F1-43DC-869E-721AE30B7E78__GUID-7E85EAB0-7719-427A-A33F-9153055DAD8B">
                        <p class="notep1">注意：</p>
                        <p>还必须启用FCF以使用运行时连接负载平衡和连接关联。这些功能将在本章后面讨论。</p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJUCP8209"></a><div class="props_rev_3"><a id="GUID-F361FE59-9D12-47F9-B5DC-F5D996809AF4" name="GUID-F361FE59-9D12-47F9-B5DC-F5D996809AF4"></a><h3 id="JJUCP-GUID-F361FE59-9D12-47F9-B5DC-F5D996809AF4" class="sect3"><span class="enumeration_section">9.2.6</span>什么是ONS？
               </h3>
               <div>
                  <p><a id="d8155e621" class="indexterm-anchor"></a><a id="d8155e625" class="indexterm-anchor"></a><a id="d8155e627" class="indexterm-anchor"></a><a id="d8155e629" class="indexterm-anchor"></a><a id="d8155e631" class="indexterm-anchor"></a><a id="d8155e635" class="indexterm-anchor"></a> FCF依靠Oracle Notification Service（ONS）在连接池和Oracle RAC数据库之间传播数据库事件。在运行时，连接池必须能够设置ONS环境。ONS（ <code class="codeph">ons.jar</code> ）作为Oracle客户端软件的一部分包含在内。可以使用远程配置或客户端ONS守护程序配置来配置ONS。远程配置是独立客户端应用程序的首选配置。本节讨论以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="fast-connection-failover.html#GUID-0D8CD8C4-734F-49F7-8737-9AC03173C73F">ONS配置文件概述</a></p>
                     </li>
                     <li>
                        <p><a href="fast-connection-failover.html#GUID-C8D5FF91-6333-4E7F-BC81-CF7B93D56BEE">ONS的远程配置</a></p>
                     </li>
                     <li>
                        <p><a href="fast-connection-failover.html#GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63">客户端ONS守护进程的配置</a></p>
                     </li>
                  </ul>
               </div><a id="JJUCP8276"></a><a id="JJUCP8277"></a><a id="JJUCP8275"></a><div class="props_rev_3"><a id="GUID-0D8CD8C4-734F-49F7-8737-9AC03173C73F" name="GUID-0D8CD8C4-734F-49F7-8737-9AC03173C73F"></a><h4 id="JJUCP-GUID-0D8CD8C4-734F-49F7-8737-9AC03173C73F" class="sect4"><span class="enumeration_section">9.2.6.1</span> ONS配置文件概述</h4>
                  <div>
                     <p>ONS配置由ONS配置文件<span class="italic"><code class="codeph">ORACLE_HOME</code></span> <code class="codeph">/opmn/conf/ons.config</code> 。该文件告诉ONS守护进程它应该如何表现。<code class="codeph">ons.config</code>配置信息以简单的名称和值对定义。
                     </p>
                     <p><code class="codeph">ons.config</code>文件中的某些参数是必需的，有些是可选的。<a href="fast-connection-failover.html#GUID-0D8CD8C4-734F-49F7-8737-9AC03173C73F__BABFBABC" title="此表列出了ons.config文件中的必需参数。">表9-2</a>列出了所需的ONS配置参数， <a href="fast-connection-failover.html#GUID-0D8CD8C4-734F-49F7-8737-9AC03173C73F__BABDHGCD" title="此表列出了ons.config文件中的可选参数。">表9-3</a>列出了可选的ONS配置参数。更新<code class="codeph">ons.config</code>文件后，必须刷新ONS。
                     </p>
                     <div class="tblformal" id="GUID-0D8CD8C4-734F-49F7-8737-9AC03173C73F__BABFBABC">
                        <p class="titleintable">表9-2所需的ONS配置参数</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="必需的ONS配置参数" width="100%" border="1" summary="This table lists the required parameters in the ons.config file." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="20%" id="d8155e733">参数</th>
                                 <th align="left" valign="bottom" width="80%" id="d8155e736">说明</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d8155e741" headers="d8155e733 ">
                                    <p><code class="codeph">将localPort</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d8155e741 d8155e736 ">
                                    <p>指定ONS在本地主机接口上绑定的端口以与本地客户端通信。</p>
                                    <p>例如， <code class="codeph">localport=4100</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d8155e753" headers="d8155e733 ">
                                    <p><code class="codeph">远程端口</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d8155e753 d8155e736 ">
                                    <p>指定ONS在所有接口上绑定的端口，用于与其他ONS守护进程通信。</p>
                                    <p>例如， <code class="codeph">remoteport=4200</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d8155e765" headers="d8155e733 ">
                                    <p><code class="codeph">节点</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d8155e765 d8155e736 ">
                                    <p>指定要与之通信的其他ONS守护程序的列表。节点值以逗号分隔的主机名或IP地址加端口列表的形式给出。给出的端口值是每个ONS实例正在侦听的远程端口。为了在所有节点上维护相同的文件，当前ONS节点的<code class="codeph">host:port</code>也可以列在节点列表中。读取列表时将忽略它。
                                    </p>
                                    <p>例如， <code class="codeph">nodes=myhost.example.com:4200,123.123.123.123:4200</code></p>
                                    <p>节点行中列出的节点对应于Oracle RAC实例中的各个节点。列出节点可确保中间层节点可以与Oracle RAC节点通信。必须将Oracle RAC实例中的至少一个中间层节点和一个节点配置为彼此查看。只要每侧的一个节点知道另一个节点，所有节点都是可见的。您无需在每个Oracle RAC节点的ONS配置文件中列出每个群集和中间层节点。特别是，如果一个ONS配置文件群集节点知道中间层，则群集中的所有节点都知道它。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="tblformal" id="GUID-0D8CD8C4-734F-49F7-8737-9AC03173C73F__BABDHGCD">
                        <p class="titleintable">表9-3可选的ONS配置参数</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="可选的ONS配置参数" width="100%" border="1" summary="This table lists the optional parameters in the ons.config file." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="20%" id="d8155e791">参数</th>
                                 <th align="left" valign="bottom" width="80%" id="d8155e794">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d8155e799" headers="d8155e791 ">
                                    <p><code class="codeph">logcomp</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d8155e799 d8155e794 ">
                                    <p>指定要记录的ONS组件。格式如下：</p><pre class="oac_no_warn" dir="ltr">&lt;组分&gt; [&lt;子&gt;，...]; &lt;部件&gt; [&lt;子&gt;，...]; ...
</pre><p>如果不需要指定子组件，则不要在组件名称后面包括括号（[]）。要从子组件中排除消息，请在子组件名称前加上感叹号（！）。例如，要从<code class="codeph">topology</code>子组件中排除消息，请使用以下格式：</p><pre class="oac_no_warn" dir="ltr">[所有，！拓扑]</pre><p>请注意，在指定要从中排除消息的子组件之前，必须首先确保子组件包含消息。</p>
                                    <p>以下是组件的有效值：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><code class="codeph">内部</code></p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">附件</code></p>
                                       </li>
                                    </ul>
                                    <p>如果将组件指定为<code class="codeph">internal</code>组件，则子组件没有有效值。如果将组件指定为<code class="codeph">ons</code> ，则可以为子组件指定以下值：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><code class="codeph">all</code> ：指定所有消息</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">ons</code> ：ONS本地信息</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">listener</code> ：ONS监听器信息</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">discover</code> ：ONS发现（服务器或多播）信息</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">servers</code> ：当前启动并连接到群集的ONS远程服务器</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">topology</code> ：ONS当前群集范围的服务器连接拓扑</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">server</code> ：ONS远程服务器连接信息</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">client</code> ：ONS客户端连接信息</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">connect</code> ：ONS通用连接信息</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">subscribe</code> ：ONS客户端订阅信息</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">message</code> ：ONS通知接收和处理信息</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">deliver</code> ：ONS通知交付信息</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">special</code> ：ONS特殊通知处理</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">internal</code> ：ONS内部资源信息</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">secure</code> ：ONS SSL操作信息</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">workers</code> ：ONS工作者线程</p>
                                       </li>
                                    </ul>
                                    <p>下面的例子表明，你要记录消息下的所有子<code class="codeph">ons</code> ，除了<code class="codeph">secure</code>子组件：</p><pre class="oac_no_warn" dir="ltr">logcomp =项[所有,!安全]</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d8155e929" headers="d8155e791 ">
                                    <p><code class="codeph">日志文件</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d8155e929 d8155e794 ">
                                    <p>指定ONS用于记录消息的日志文件。日志文件的默认值为<code class="codeph">$ORACLE_HOME/opmn/logs/ons.log</code> 。
                                    </p>
                                    <p>例如， <code class="codeph">logfile=/private/oraclehome/opmn/logs/myons.log</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d8155e944" headers="d8155e791 ">
                                    <p><code class="codeph">walletfile</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d8155e944 d8155e794 ">
                                    <p>指定Oracle安全套接字层（SSL）用于存储SSL证书的钱包文件。如果将钱包文件指定给ONS，则它在与其他ONS实例通信时使用SSL，并且需要尝试连接到它的所有ONS实例的SSL证书身份验证。这意味着如果要为一个ONS实例启用SSL，则必须为所有已连接的实例启用SSL。该值应指向<code class="codeph">ewallet.p12</code>文件所在的目录。
                                    </p>
                                    <p>例如， <code class="codeph">walletfile=/private/oraclehome/opmn/conf/ssl.wlt/default</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d8155e959" headers="d8155e791 ">
                                    <p><code class="codeph">useocr</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d8155e959 d8155e794 ">
                                    <p>指定保留在服务器端使用的值，以指示它是否应在Oracle Cluster Registry（OCR）中存储所有Oracle RAC节点和端口号，而不是ONS配置文件。<code class="codeph">useocr=on</code>值用于存储Oracle Cluster Registry（OCR）中的所有Oracle RAC节点和端口号。
                                    </p>
                                    <p>不要在客户端使用此选项。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d8155e972" headers="d8155e791 ">
                                    <p><code class="codeph">allowgroup</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d8155e972 d8155e794 ">
                                    <p>指定ONS设置以指示连接到<code class="codeph">localport</code>的用户组。设置为<code class="codeph">true</code> ，ONS允许同一OS组中的用户连接到其本地端口。设置为<code class="codeph">false</code> ，ONS仅允许运行ONS守护程序的同一用户访问其本地端口。此参数的默认值为<code class="codeph">false</code> 。使用远程ONS配置时，无需设置此参数。
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p><code class="codeph">ons.config</code>文件允许以数字符号（ <code class="codeph">#</code> ）开头的行显示空行和注释。
                     </p>
                  </div>
               </div><a id="JJUCP8210"></a><div class="props_rev_3"><a id="GUID-C8D5FF91-6333-4E7F-BC81-CF7B93D56BEE" name="GUID-C8D5FF91-6333-4E7F-BC81-CF7B93D56BEE"></a><h4 id="JJUCP-GUID-C8D5FF91-6333-4E7F-BC81-CF7B93D56BEE" class="sect4"><span class="enumeration_section">9.2.6.2</span> ONS的远程配置</h4>
                  <div>
                     <p>UCP支持通过<code class="codeph">ONSConfiguration</code>池属性远程配置ONS。<code class="codeph">ONSConfiguration</code>池属性值是一个非常类似于<code class="codeph">ons.config</code>文件内容的字符串。该字符串包含由新行字符（ <code class="codeph">\n</code> ）分隔的<code class="codeph">name=value</code>对列表。您可以通过以下两种方式设置此池属性：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>名称可以是以下之一： <code class="codeph">nodes</code> ， <code class="codeph">walletfile</code>或<code class="codeph">walletpassword</code> 。参数字符串至少应将ONS配置<code class="codeph">nodes</code>属性指定为由逗号分隔的<code class="codeph">host:port</code>对列表。将<code class="codeph">walletfile</code>属性指定为Oracle钱包文件时使用SSL。
                           </p>
                           <p>以下示例演示了ONS配置字符串，如<a href="fast-connection-failover.html#GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F__CHDEEBAJ">例9-1</a>所示：</p><pre class="oac_no_warn" dir="ltr">...pds.setONSConfiguration（ “节点= racnode1：4200，racnode2：4200 \ nwalletfile = / ORACLE11 / onswalletfile”）; ...
</pre></li>
                        <li>
                           <p>该名称只能是<code class="codeph">propertiesfile</code> 。该值是特定于ONS的Java属性文件的位置。此文件必须包含<code class="codeph">oracle.ons.nodes</code>属性，以及以下一个或两个ONS Java属性：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">oracle.ons.walletfile</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">oracle.ons.walletpassword</code></p>
                                 <p>以下示例说明了这样的<code class="codeph">ONSConfiguration</code>字符串：</p><pre class="oac_no_warn" dir="ltr">pds.setONSConfiguration（ “propertiesfile =的/ usr /插件/ ons.properties”）;</pre><p>以下是<code class="codeph">ons.properties</code>文件中Java属性的内容示例：</p><pre class="oac_no_warn" dir="ltr">oracle.ons.nodes = racnode1：4200，racnode2：4200 oracle.ons.walletfile = / oracle11 / onswalletfile</pre></li>
                           </ul>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-C8D5FF91-6333-4E7F-BC81-CF7B93D56BEE__GUID-200D4E8D-7170-40DA-8B69-14A09588092E">
                        <p class="notep1">注意：</p>
                        <p>配置字符串中的参数必须与Oracle RAC数据库中的参数匹配。此外，如果您使用的是Oracle应用服务器，则必须使用适用于服务器的过程配置ONS。</p>
                        <p>对于独立Java应用程序，必须使用<code class="codeph">setONSConfiguration</code>方法配置ONS。但是，如果您的应用程序满足以下要求，则不再需要调用<code class="codeph">setONSConfiguration</code>方法来启用FCF：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您的应用程序使用的是Oracle Database 12 <span class="italic">c</span>第1版（12.1）或更高版本的UCP和Oracle RAC数据库12 <span class="italic">c</span>第1版（12.1）或更高版本</p>
                           </li>
                           <li>
                              <p>您的应用程序不需要ONS钱包或密钥库</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="JJUCP8279"></a><a id="JJUCP8280"></a><a id="JJUCP8278"></a><a id="JJUCP8211"></a><div class="props_rev_3"><a id="GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63" name="GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63"></a><h4 id="JJUCP-GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63" class="sect4"><span class="enumeration_section">9.2.6.3</span>客户端ONS守护进程的配置</h4>
                  <div>
                     <p>客户端ONS守护程序配置是在中间层服务器（如Oracle Application Server）上运行的典型应用程序。此方案中的客户端通过更新<code class="codeph">ons.config</code>文件直接配置ONS。根据平台，文件的位置可能不同。<a href="fast-connection-failover.html#GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63__BABIIAHB">例9-2</a>演示了<a href="fast-connection-failover.html#GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F__CHDEEBAJ">例9-1</a>的<code class="codeph">ons.config</code>文件：</p>
                     <div class="infoboxnote" id="GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63__GUID-D3CFF3F5-C855-4FEB-864C-17B9ABF9B78C">
                        <p class="notep1">注意：</p>
                        <p>对于客户端ONS守护程序配置，如果启动连接池的操作系统（OS）用户和启动客户端守护程序的OS用户不同，则它们都<span class="italic">必须</span>属于同一OS组。此外，必须在<code class="codeph">ons.config</code>文件中将<code class="codeph">allowgroup</code>参数的值设置为<code class="codeph">true</code> 。
                        </p>
                     </div>
                     <p>配置ONS后，使用<code class="codeph">onsctl</code>命令启动ONS守护程序。您<span class="italic">必须</span>确保ONS守护程序始终在运行。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63__GUID-D0D267BD-7839-440A-89F9-9115EA3B2088">使用onsctl命令</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>配置完成后，使用<span class="italic"><code class="codeph">ORACLE_HOME</code></span> <code class="codeph">/opmn/bin/onsctl</code>启动，停止，重新配置和监视ONS守护程序。<a href="fast-connection-failover.html#GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63__BABEBDBA" title="表">表9-4</a>是<code class="codeph">onsctl</code>支持的命令的摘要。
                        </p>
                        <div class="tblformal" id="GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63__BABEBDBA">
                           <p class="titleintable">表9-4 onsctl命令</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="onsctl命令" width="100%" border="1" summary="table" frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="16%" id="d8155e1253">命令</th>
                                    <th align="left" valign="bottom" width="34%" id="d8155e1256">影响</th>
                                    <th align="left" valign="bottom" width="50%" id="d8155e1259">产量</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="16%" id="d8155e1264" headers="d8155e1253 ">
                                       <p><code class="codeph">开始</code></p>
                                    </td>
                                    <td align="left" valign="top" width="34%" headers="d8155e1264 d8155e1256 ">
                                       <p>启动ONS守护程序</p>
                                    </td>
                                    <td align="left" valign="top" width="50%" headers="d8155e1264 d8155e1259 ">
                                       <p><code class="codeph">onsctl：ons开始了</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="16%" id="d8155e1276" headers="d8155e1253 ">
                                       <p><code class="codeph">停</code></p>
                                    </td>
                                    <td align="left" valign="top" width="34%" headers="d8155e1276 d8155e1256 ">
                                       <p>停止ONS守护程序</p>
                                    </td>
                                    <td align="left" valign="top" width="50%" headers="d8155e1276 d8155e1259 ">
                                       <p><code class="codeph">onsctl：关闭ons守护进程......</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="16%" id="d8155e1288" headers="d8155e1253 ">
                                       <p><code class="codeph">平</code></p>
                                    </td>
                                    <td align="left" valign="top" width="34%" headers="d8155e1288 d8155e1256 ">
                                       <p>验证ONS守护程序是否正在运行</p>
                                    </td>
                                    <td align="left" valign="top" width="50%" headers="d8155e1288 d8155e1259 ">
                                       <p><code class="codeph">ons正在运行......</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="16%" id="d8155e1300" headers="d8155e1253 ">
                                       <p><code class="codeph">重新配置</code></p>
                                    </td>
                                    <td align="left" valign="top" width="34%" headers="d8155e1300 d8155e1256 ">
                                       <p>触发重新加载ONS配置而不关闭ONS守护程序</p>
                                    </td>
                                    <td align="left" valign="top" width="50%" headers="d8155e1300 d8155e1259 "> </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="16%" id="d8155e1309" headers="d8155e1253 ">
                                       <p><code class="codeph">救命</code></p>
                                    </td>
                                    <td align="left" valign="top" width="34%" headers="d8155e1309 d8155e1256 ">
                                       <p>打印onsctl的帮助摘要消息</p>
                                    </td>
                                    <td align="left" valign="top" width="50%" headers="d8155e1309 d8155e1259 "> </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="16%" id="d8155e1318" headers="d8155e1253 ">
                                       <p><code class="codeph">详细</code></p>
                                    </td>
                                    <td align="left" valign="top" width="34%" headers="d8155e1318 d8155e1256 ">
                                       <p>打印onsctl的详细帮助消息</p>
                                    </td>
                                    <td align="left" valign="top" width="50%" headers="d8155e1318 d8155e1259 "> </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <div class="infoboxnotealso" id="GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63__GUID-F31529FB-E316-489F-91FB-6D56753620F1">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../racad/adding-and-deleting-oracle-rac-from-nodes-on-linux-and-unix-systems.html#RACAD0067" target="_blank"><span class="italic">“Oracle Real Application Clusters管理和部署指南”</span></a></p>
                        </div>
                        <div class="infoboxnote" id="GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63__GUID-83B2CEFD-E3B5-43C3-8A54-9B14825AA94D">
                           <p class="notep1">注意：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>运行JDBC实例的Java虚拟机（JVM）必须在启动应用程序之前将<code class="codeph">oracle.ons.oraclehome</code>系统属性设置为<code class="codeph">ORACLE_HOME</code>的位置。例如：</p><pre class="oac_no_warn" dir="ltr">java -Doracle.ons.oraclehome = $ ORACLE_HOME ...
</pre></li>
                              <li>
                                 <p>Oracle建议为UCP远程配置ONS。</p>
                              </li>
                           </ul>
                        </div>
                        <div class="infoboxnote" id="GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63__GUID-FC0815E1-7A68-4F89-8468-FAB6C7536552">
                           <p class="notep1">注意：</p>
                           <p>在Oracle RAC 12.1.0.2.0中，默认情况下，服务器安装需要设置<code class="codeph">walletfile</code> ONS参数的值，并强制对所有ONS连接使用SSL。
                           </p>
                           <p>如果您的UCP应用程序已在ONS远程配置字符串或本地配置文件中使用<code class="codeph">walletfile</code>参数，则唯一的要求是，对于相同的拓扑，客户端上的钱包文件必须具有与服务器端的钱包文件。您可以复制服务器端文件并使其在客户端可用。
                           </p>
                           <p>对于使用Oracle RAC功能而未设置<code class="codeph">walletfile</code>参数的UCP应用程序，您必须执行以下操作之一：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>将walletfile参数设置添加到ONS远程配置字符串或本地配置文件，如<a href="fast-connection-failover.html#GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F__CHDEEBAJ">例9-1</a>所示。请记住，对于相同的拓扑，客户端上的钱包文件必须与Oracle RAC服务器端的钱包文件具有相同的内容。
                                 </p>
                              </li>
                              <li>
                                 <p>执行以下命令，从客户端和服务器ONS配置字符串和本地配置文件中删除<code class="codeph">walletfile</code>参数设置：</p><pre class="oac_no_warn" dir="ltr">srvctl修改nodeapps -clientdata</pre></li>
                           </ul>
                           <p>对于安全通信，首次安装或修补Oracle RAC 12.1.0.2.0时，Oracle RAC 12.1.x中的ONS自动配置不再有效。应用程序必须使用显式ONS配置（远程或本地），并进行前面讨论的更改之一。</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63__BABIIAHB">
                        <p class="titleinexample">示例9-2示例ons.config文件的示例</p><pre class="oac_no_warn" dir="ltr">＃这是ons.config文件的示例##前三个值是必需的localport = 4100 remoteport = 4200 nodes = racnode1.example.com：4200，racnode2.example.com：4200</pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div><a id="JJUCP8213"></a><a id="JJUCP8212"></a><div class="props_rev_3"><a id="GUID-C54F3D4D-9973-41EA-B62B-E574DE94970F" name="GUID-C54F3D4D-9973-41EA-B62B-E574DE94970F"></a><h3 id="JJUCP-GUID-C54F3D4D-9973-41EA-B62B-E574DE94970F" class="sect3"><span class="enumeration_section">9.2.7</span>配置连接URL</h3>
               <div>
                  <div class="section">
                     <p><a id="d8155e1423" class="indexterm-anchor"></a><a id="d8155e1427" class="indexterm-anchor"></a><a id="d8155e1429" class="indexterm-anchor"></a>使用FCF时，连接工厂的连接URL必须使用服务名称语法。服务名称用于将连接池映射到服务。此外，工厂类必须是Oracle工厂类。以下示例演示如何配置连接URL，如<a href="fast-connection-failover.html#GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F__CHDEEBAJ">例9-1</a>所示：</p><pre class="oac_no_warn" dir="ltr">...pds.setConnectionFactoryClassName（“oracle.jdbc.pool。OracleDataSource“）; pds.setURL（”jdbc：oracle：thin @ // host：port / service_name“）; ...
</pre><div class="infoboxnote" id="GUID-C54F3D4D-9973-41EA-B62B-E574DE94970F__GUID-BF84AC3C-CF73-44E5-AAF7-C6149968791A">
                        <p class="notep1">注意：</p>
                        <p>如果在启用FCF时为连接URL指定了服务标识符（SID），则抛出异常。</p>
                     </div>
                     <p>以下示例演示了连接到Oracle RAC数据库时的有效连接URL语法。包括Oracle JDBC瘦和Oracle OCI驱动程序的示例。请注意，URL可用于在Oracle RAC节点之间显式启用负载平衡：<a id="d8155e1441" class="indexterm-anchor"></a></p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-C54F3D4D-9973-41EA-B62B-E574DE94970F__GUID-90B76114-F8BC-4A8C-B914-E124DBBD9D5E">有效的连接URL用法</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section"><pre class="oac_no_warn" dir="ltr">pds.setURL（ “JDBC：预言：薄@ //主机：端口/服务名”）; pds.setURL（ “JDBC：预言：薄@ //群集别名：端口/服务名”）; pds.setURL（“jdbc：oracle：thin：@（DESCRIPTION =”+“（LOAD_BALANCE = on）”+“（ADDRESS =（PROTOCOL = TCP）（HOST = host1）（PORT = 1521））”+“（ADDRESS =（PROTOCOL = TCP）（HOST = host2）（PORT = 1521））“+”（CONNECT_DATA =（SERVICE_NAME = service_name）））“）; pds.setURL（“jdbc：oracle：thin：@（DESCRIPTION =”+“（ADDRESS =（PROTOCOL = TCP）（HOST = cluster_alias）（PORT = 1521））”+“（CONNECT_DATA =（SERVICE_NAME = service_name））） “）; pds.setURL（ “JDBC：预言：OCI：@TNS_ALIAS”）; pds.setURL（“jdbc：oracle：oci：@（DESCRIPTION =”+“（LOAD_BALANCE = on）”+“（ADDRESS =（PROTOCOL = TCP）（HOST = host1）（PORT = 1521））”+“（地址） =（PROTOCOL = TCP）（HOST = host2）（PORT = 1521））“+”（CONNECT_DATA =（SERVICE_NAME = service_name）））“）; pds.setURL（“jdbc：oracle：oci：@（DESCRIPTION =”+“（ADDRESS =（PROTOCOL = TCP）（HOST = cluster_alias）（PORT = 1521））”+“（CONNECT_DATA =（SERVICE_NAME = service_name））） “）;</pre></div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>