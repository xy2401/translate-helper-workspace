<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="Distributed transactions update data on two or more distinct nodes of a distributed database."></meta>
      <meta name="description" content="Distributed transactions update data on two or more distinct nodes of a distributed database."></meta>
      <title>分布式事务概念</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Database Administrator’s Guide "></meta>
      <meta property="og:description" content="Distributed transactions update data on two or more distinct nodes of a distributed database."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Database Administrator’s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-administrators-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-03-14T11:02:35-07:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96348-04"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="developing-applications-for-a-distributed-database-system.html" title="Previous" type="text/html"></link>
      <link rel="next" href="managing-distributed-transactions.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Administrator&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="ADMIN"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="developing-applications-for-a-distributed-database-system.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="managing-distributed-transactions.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据库管理员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="distributed-database-management.html" property="item" typeof="WebPage"><span property="name">分布式数据库管理</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">分布式事务概念</li>
            </ol>
            <a id="GUID-C1B373BA-410E-4F38-8522-F72A74665919" name="GUID-C1B373BA-410E-4F38-8522-F72A74665919"></a><a id="ADMIN031"></a>
            
            <h2 id="ADMIN-GUID-C1B373BA-410E-4F38-8522-F72A74665919" class="sect2"><span class="enumeration_chapter">34</span>分布式事务概念</h2>
         </header>
         <div class="ind">
            <p>分布式事务在分布式数据库的两个或多个不同节点上更新数据。</p>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-8BD7FE27-8C61-4C2D-B4C1-C2ABED94BA15">什么是分布式事务？</a><br><span class="bold">分布式事务</span>包括一个或多个语句，这些语句单独地或作为一组更新分布式数据库的两个或更多个不同节点上的数据。
                  </li>
                  <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-14FCA872-AC76-4166-A1BE-2545D7E43E32">分布式事务的会话树</a><br>会话树是一种分层模型，用于描述会话及其角色之间的关系。
                  </li>
                  <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-8152084F-4760-4B89-A91C-9A84F81C23D1">两阶段提交机制</a><br>在分布式数据库环境中，数据库必须协调作为独立单元的分布式事务中的更改的提交或回滚。
                  </li>
                  <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-5FA12AC8-2E77-4180-ACA6-D2E8CED8462A">怀疑交易</a><br>如果两阶段提交机制失败，则事务变得不确定。
                  </li>
                  <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-7C9FDBB8-171D-422C-A944-A9CE2CB6B2AF">分布式事务处理：案例研究</a><br>案例研究说明了分布式事务处理。
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="distributed-database-management.html#GUID-43B1A794-4C8E-4CC5-BF5B-A408A50EB6FA" title="您可以管理分布式数据库环境。">分布式数据库管理</a></p>
                  </div>
               </div>
            </div>
            <a id="ADMIN13143"></a><a id="ADMIN12211"></a><div class="props_rev_3"><a id="GUID-8BD7FE27-8C61-4C2D-B4C1-C2ABED94BA15" name="GUID-8BD7FE27-8C61-4C2D-B4C1-C2ABED94BA15"></a><h3 id="ADMIN-GUID-8BD7FE27-8C61-4C2D-B4C1-C2ABED94BA15" class="sect3"><span class="enumeration_section">34.1</span>什么是分布式事务？
               </h3>
               <div>
                  <p><span class="bold">分布式事务</span>包括一个或多个语句，这些语句单独地或作为一组更新分布式数据库的两个或更多个不同节点上的数据。
                  </p>
                  <p>例如，假设<a href="distributed-transactions-concepts.html#GUID-8BD7FE27-8C61-4C2D-B4C1-C2ABED94BA15__i1107562">图34-1</a>中描述了数据库配置：</p>
                  <div class="figure" id="GUID-8BD7FE27-8C61-4C2D-B4C1-C2ABED94BA15__i1107562">
                     <p class="titleinfigure">图34-1分布式系统</p><img src="img/admin051.gif" width="452" alt="下面是图34-1的描述" title="下面是图34-1的描述" longdesc="img_text/admin051.html"><br><a href="img_text/admin051.html">“图34-1分布式系统”的描述</a></div>
                  <!-- class="figure" -->
                  <p><code class="codeph">scott</code>执行的以下分布式事务更新本地<code class="codeph">sales</code>数据库，远程<code class="codeph">hq</code>数据库和远程<code class="codeph">maint</code>数据库：</p><pre class="oac_no_warn" dir="ltr">更新scott.dept@hq.us.example.com SET loc ='REDWOOD SHORES'THERE deptno = 10; UPDATE scott.emp SET deptno = 11 WHERE deptno = 10;更新scott.bldg@maint.us.example.com设置房间= 1225房间= 1163;承诺;</pre><div class="infoboxnote" id="GUID-8BD7FE27-8C61-4C2D-B4C1-C2ABED94BA15__GUID-00CCF6B6-33AA-4264-A5FC-8F1EB3D700F4">
                     <p class="notep1">注意：</p>
                     <p>如果事务的所有语句仅引用单个远程节点，则事务是远程的，而不是分布式的。</p>
                  </div>
                  <p>分布式事务中有两种类型的允许操作：DML和DDL事务以及事务控制语句。</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-1877D055-CF22-45C6-BFBD-F8126A1F517F">DML和DDL事务</a><br>分布式事务中支持某些DML和DDL操作。
                     </li>
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-66FABBBA-9E62-49B0-953B-72771346511A">交易控制声明</a><br>分布式事务中支持某些事务控制语句。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-C1B373BA-410E-4F38-8522-F72A74665919" title="分布式事务在分布式数据库的两个或多个不同节点上更新数据。">分布式事务概念</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADMIN12212"></a><div class="props_rev_3"><a id="GUID-1877D055-CF22-45C6-BFBD-F8126A1F517F" name="GUID-1877D055-CF22-45C6-BFBD-F8126A1F517F"></a><h4 id="ADMIN-GUID-1877D055-CF22-45C6-BFBD-F8126A1F517F" class="sect4"><span class="enumeration_section">34.1.1</span> DML和DDL事务</h4>
                  <div>
                     <p>分布式事务中支持某些DML和DDL操作。</p>
                     <p>以下是分布式事务中支持的DML和DDL操作：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">CREATE</code> <code class="codeph">TABLE</code> <code class="codeph">AS</code> <code class="codeph">SELECT</code> 
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">删除</code> 
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">INSERT</code> （默认和直接加载）</p>
                        </li>
                        <li>
                           <p><code class="codeph">UPDATE</code> 
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">LOCK</code> <code class="codeph">TABLE</code> 
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">选择</code> 
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code> 
                           </p>
                        </li>
                     </ul>
                     <p>您可以并行执行DML和DDL语句，并按顺序<code class="codeph">INSERT</code>直接加载语句，但请注意以下限制：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>所有远程操作都必须是<code class="codeph">SELECT</code>语句。
                           </p>
                        </li>
                        <li>
                           <p>这些语句不能是另一个分布式事务中的子句。</p>
                        </li>
                        <li>
                           <p>如果<code class="codeph">INSERT</code> ， <code class="codeph">UPDATE</code>或<code class="codeph">DELETE</code>语句的<span class="italic">table_expression_clause</span>中引用的表是远程的，则执行是串行而不是并行。
                           </p>
                        </li>
                        <li>
                           <p>发出并行DML / DDL或直接加载<code class="codeph">INSERT</code>后，您无法执行远程操作。</p>
                        </li>
                        <li>
                           <p>如果事务开始使用XA或OCI，它将按顺序执行。</p>
                        </li>
                        <li>
                           <p>不能对源自并行操作的事务执行环回操作。例如，您不能引用实际上是本地对象的同义词的远程对象。</p>
                        </li>
                        <li>
                           <p>如果在事务中执行除<code class="codeph">SELECT</code>之外的分布式操作，则不会并行化DML。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-8BD7FE27-8C61-4C2D-B4C1-C2ABED94BA15" title="分布式事务包括一个或多个语句，这些语句单独地或作为一组更新分布式数据库的两个或更多个不同节点上的数据。">什么是分布式事务？</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN12213"></a><div class="props_rev_3"><a id="GUID-66FABBBA-9E62-49B0-953B-72771346511A" name="GUID-66FABBBA-9E62-49B0-953B-72771346511A"></a><h4 id="ADMIN-GUID-66FABBBA-9E62-49B0-953B-72771346511A" class="sect4"><span class="enumeration_section">34.1.2</span>交易控制声明</h4>
                  <div>
                     <p>分布式事务中支持某些事务控制语句。</p>
                     <p>以下是受支持的事务控制语句：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">承诺</code> 
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">ROLLBACK</code> 
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">SAVEPOINT</code> 
                           </p>
                           <div class="infoboxnotealso" id="GUID-66FABBBA-9E62-49B0-953B-72771346511A__GUID-55007788-8BCB-417D-8EA3-153353EB54CA">
                              <p class="notep1">也可以看看：</p>
                              <p>有关这些SQL语句的详细信息，请<a href="../sqlrf/index.html" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                           </div>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-8BD7FE27-8C61-4C2D-B4C1-C2ABED94BA15" title="分布式事务包括一个或多个语句，这些语句单独地或作为一组更新分布式数据库的两个或更多个不同节点上的数据。">什么是分布式事务？</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="sect2"><a id="GUID-14FCA872-AC76-4166-A1BE-2545D7E43E32" name="GUID-14FCA872-AC76-4166-A1BE-2545D7E43E32"></a><h3 id="ADMIN-GUID-14FCA872-AC76-4166-A1BE-2545D7E43E32" class="sect3"><span class="enumeration_section">34.2</span>分布式事务的会话树</h3>
               <p>会话树是一种分层模型，用于描述会话及其角色之间的关系。</p>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C">关于分布式事务的会话树</a><br>当发布分布式事务中的语句时，数据库定义参与事务的所有节点的<span class="bold">会话树</span> 。
                     </li>
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-EDF6B245-7FE7-4114-A112-349DB5690EE1">客户端</a><br>当节点从另一个节点上的数据库引用信息时，该节点充当客户端。
                     </li>
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-44F33D25-94AB-497C-8FC7-8002E2661465">数据库服务器</a><br>数据库服务器是托管客户端请求数据的数据库的节点。
                     </li>
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-7FD5C82A-0A78-4A91-9281-794D4D4422B5">当地协调员</a><br>必须引用其他节点上的数据以在分布式事务中完成其部分的节点称为本地协调器。
                     </li>
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-1C9E8C56-9AB6-4560-9D70-33F772C5942B">全球协调员</a><br>分布式事务发起的节点称为全局协调器。
                     </li>
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-51F21E1B-B735-48DC-8500-94DACAA863A0">提交点网站</a><br>系统管理员始终将一个节点指定为提交点站点。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-C1B373BA-410E-4F38-8522-F72A74665919" title="分布式事务在分布式数据库的两个或多个不同节点上更新数据。">分布式事务概念</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADMIN13144"></a><a id="ADMIN12214"></a><div class="props_rev_3"><a id="GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C" name="GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C"></a><h4 id="ADMIN-GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C" class="sect4"><span class="enumeration_section">34.2.1</span>关于分布式事务的会话树</h4>
                  <div>
                     <p>当发布分布式事务中的语句时，数据库定义参与事务的所有节点的<span class="bold">会话树</span> 。
                     </p>
                     <p>会话树是一种分层模型，用于描述会话及其角色之间的关系。<a href="distributed-transactions-concepts.html#GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C__CHDCFICE">图34-2</a>说明了一个会话树：</p>
                     <div class="figure" id="GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C__CHDCFICE">
                        <p class="titleinfigure">图34-2会话树示例</p><img src="img/admin031.png" width="596" alt="下面是图34-2的描述" title="下面是图34-2的描述" longdesc="img_text/admin031.html"><br><a href="img_text/admin031.html">“图34-2会话树示例”的说明</a></div>
                     <!-- class="figure" -->
                     <p>参与分布式事务的会话树的所有节点都承担以下一个或多个角色：</p>
                     <div class="tblformal" id="GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C__GUID-C3FFF1DC-13A2-4E1C-9AED-DBB9C9003FBC">
                        <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="Column 1 contains the name of the role and column 2 describes node behavior." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="28%" id="d316272e521">角色</th>
                                 <th align="left" valign="bottom" width="72%" id="d316272e524">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d316272e529" headers="d316272e521 ">
                                    <p>客户</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d316272e529 d316272e524 ">
                                    <p>引用属于不同节点的数据库中的信息的节点。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d316272e536" headers="d316272e521 ">
                                    <p>数据库服务器</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d316272e536 d316272e524 ">
                                    <p>从另一个节点接收信息请求的节点。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d316272e543" headers="d316272e521 ">
                                    <p>全球协调员</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d316272e543 d316272e524 ">
                                    <p>发起分布式事务的节点。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d316272e550" headers="d316272e521 ">
                                    <p>当地协调员</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d316272e550 d316272e524 ">
                                    <p>被强制引用其他节点上的数据以完成其部分事务的节点。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d316272e557" headers="d316272e521 ">
                                    <p>提交点网站</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d316272e557 d316272e524 ">
                                    <p>按照全局协调程序的指示提交或回滚事务的节点。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>节点在分布式事务中扮演的角色由以下因素确定：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>交易是本地交易还是远程交易</p>
                        </li>
                        <li>
                           <p>节点的<span class="bold">提交点强度</span> （ <span class="q">“ <a href="distributed-transactions-concepts.html#GUID-FB773DD4-B700-423F-A9EB-8D6F6765583E" title="提交点站点的工作是按照全局协调器的指示启动提交或回滚操作。">提交点站点</a> ”</span> ）</p>
                        </li>
                        <li>
                           <p>是否所有请求的数据在节点上都可用，或者是否需要引用其他节点来完成事务</p>
                        </li>
                        <li>
                           <p>节点是否为只读</p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-14FCA872-AC76-4166-A1BE-2545D7E43E32" title="会话树是一种分层模型，用于描述会话及其角色之间的关系。">分布式事务的会话树</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN12215"></a><div class="props_rev_3"><a id="GUID-EDF6B245-7FE7-4114-A112-349DB5690EE1" name="GUID-EDF6B245-7FE7-4114-A112-349DB5690EE1"></a><h4 id="ADMIN-GUID-EDF6B245-7FE7-4114-A112-349DB5690EE1" class="sect4"><span class="enumeration_section">34.2.2</span>客户</h4>
                  <div>
                     <p>当节点从另一个节点上的数据库引用信息时，该节点充当客户端。</p>
                     <p>引用的节点是数据库服务器。在<a href="distributed-transactions-concepts.html#GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C__CHDCFICE">图34-2中</a> ，节点<code class="codeph">sales</code>是托管<code class="codeph">warehouse</code>和<code class="codeph">finance</code>数据库的节点的客户端。
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-14FCA872-AC76-4166-A1BE-2545D7E43E32" title="会话树是一种分层模型，用于描述会话及其角色之间的关系。">分布式事务的会话树</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN12216"></a><div class="props_rev_3"><a id="GUID-44F33D25-94AB-497C-8FC7-8002E2661465" name="GUID-44F33D25-94AB-497C-8FC7-8002E2661465"></a><h4 id="ADMIN-GUID-44F33D25-94AB-497C-8FC7-8002E2661465" class="sect4"><span class="enumeration_section">34.2.3</span>数据库服务器</h4>
                  <div>
                     <p>数据库服务器是托管客户端请求数据的数据库的节点。</p>
                     <p>在<a href="distributed-transactions-concepts.html#GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C__CHDCFICE">图34-2中</a> ， <code class="codeph">sales</code>节点上的应用程序启动分布式事务，该事务访问来自<code class="codeph">warehouse</code>和<code class="codeph">finance</code>节点的数据。因此， <code class="codeph">sales.example.com</code>具有客户端节点的角色， <code class="codeph">warehouse</code>和<code class="codeph">finance</code>都是数据库服务器。在此示例中， <code class="codeph">sales</code>是数据库服务器<span class="italic">和</span>客户端，因为应用程序还修改了<code class="codeph">sales</code>数据库中的数据。
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-14FCA872-AC76-4166-A1BE-2545D7E43E32" title="会话树是一种分层模型，用于描述会话及其角色之间的关系。">分布式事务的会话树</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN12217"></a><div class="props_rev_3"><a id="GUID-7FD5C82A-0A78-4A91-9281-794D4D4422B5" name="GUID-7FD5C82A-0A78-4A91-9281-794D4D4422B5"></a><h4 id="ADMIN-GUID-7FD5C82A-0A78-4A91-9281-794D4D4422B5" class="sect4"><span class="enumeration_section">34.2.4</span>当地协调员</h4>
                  <div>
                     <p>必须引用其他节点上的数据以在分布式事务中完成其部分的节点称为本地协调器。</p>
                     <p>在<a href="distributed-transactions-concepts.html#GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C__CHDCFICE">图34-2中</a> ， <code class="codeph">sales</code>是一个本地协调器，因为它协调它直接引用的节点： <code class="codeph">warehouse</code>和<code class="codeph">finance.</code>节点<code class="codeph">sales</code>也恰好是全局协调器，因为它协调事务中涉及的所有节点。
                     </p>
                     <p>本地协调员负责通过以下方式协调与其直接通信的节点之间的事务：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>从这些节点接收和中继事务状态信息</p>
                        </li>
                        <li>
                           <p>将查询传递给这些节点</p>
                        </li>
                        <li>
                           <p>从这些节点接收查询并将其传递给其他节点</p>
                        </li>
                        <li>
                           <p>将查询结果返回给发起它们的节点</p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-14FCA872-AC76-4166-A1BE-2545D7E43E32" title="会话树是一种分层模型，用于描述会话及其角色之间的关系。">分布式事务的会话树</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN12218"></a><div class="props_rev_3"><a id="GUID-1C9E8C56-9AB6-4560-9D70-33F772C5942B" name="GUID-1C9E8C56-9AB6-4560-9D70-33F772C5942B"></a><h4 id="ADMIN-GUID-1C9E8C56-9AB6-4560-9D70-33F772C5942B" class="sect4"><span class="enumeration_section">34.2.5</span>全球协调员</h4>
                  <div>
                     <p>分布式事务发起的节点称为全局协调器。</p>
                     <p>发布分布式事务的数据库应用程序直接连接到充当全局协调器的节点。例如，在<a href="distributed-transactions-concepts.html#GUID-B7BC755E-3049-4626-9967-3AB6ACA6E09C__CHDCFICE">图34-2中</a> ，节点<code class="codeph">sales</code>处发出的事务引用了来自数据库服务器<code class="codeph">warehouse</code>和<code class="codeph">finance</code> 。因此， <code class="codeph">sales.example.com</code>是此分布式事务的全局协调者。
                     </p>
                     <p>全局协调器成为会话树的父或根。全局协调器在分布式事务期间执行以下操作：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>将所有分布式事务SQL语句，远程过程调用等发送到直接引用的节点，从而形成会话树</p>
                        </li>
                        <li>
                           <p>指示除提交点站点之外的所有直接引用的节点以准备事务</p>
                        </li>
                        <li>
                           <p>如果所有节点都成功准备，则指示提交点站点启动事务的全局提交</p>
                        </li>
                        <li>
                           <p>如果存在中止响应，则指示所有节点启动事务的全局回滚</p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-14FCA872-AC76-4166-A1BE-2545D7E43E32" title="会话树是一种分层模型，用于描述会话及其角色之间的关系。">分布式事务的会话树</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-51F21E1B-B735-48DC-8500-94DACAA863A0" name="GUID-51F21E1B-B735-48DC-8500-94DACAA863A0"></a><h4 id="ADMIN-GUID-51F21E1B-B735-48DC-8500-94DACAA863A0" class="sect4"><span class="enumeration_section">34.2.6</span>提交点站点</h4>
                  <p>系统管理员始终将一个节点指定为提交点站点。</p>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-FB773DD4-B700-423F-A9EB-8D6F6765583E">关于提交点网站</a><br>提交点站点的工作是按照全局协调器的指示启动提交或回滚操作。
                        </li>
                        <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-AA225F8C-3896-4B37-88F4-4B2B8F974202">分布式事务如何提交</a><br>在准备好所有非提交点站点之后，分布式事务被视为已提交，并且事务已在提交点站点实际提交。
                        </li>
                        <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-A3DA5714-5DAC-4D8C-AEDF-0D6050D74035">承诺点力量</a><br>必须为每个数据库服务器分配一个提交点强度。如果在分布式事务中引用数据库服务器，则其提交点强度的值将确定它在两阶段提交中扮演的角色。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-14FCA872-AC76-4166-A1BE-2545D7E43E32" title="会话树是一种分层模型，用于描述会话及其角色之间的关系。">分布式事务的会话树</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="ADMIN13145"></a><a id="ADMIN12219"></a><div class="props_rev_3"><a id="GUID-FB773DD4-B700-423F-A9EB-8D6F6765583E" name="GUID-FB773DD4-B700-423F-A9EB-8D6F6765583E"></a><h5 id="ADMIN-GUID-FB773DD4-B700-423F-A9EB-8D6F6765583E" class="sect5"><span class="enumeration_section">34.2.6.1</span>关于提交点站点</h5>
                     <div>
                        <p>提交点站点的工作是按照全局协调器的指示启动提交或回滚操作。</p>
                        <p>系统管理员始终通过为所有节点分配提交点强度，将一个节点指定为会话树中的提交点站点。选择作为提交点站点的节点应该是存储最关键数据的节点。</p>
                        <p><a href="distributed-transactions-concepts.html#GUID-FB773DD4-B700-423F-A9EB-8D6F6765583E__i1007732">图34-3</a>说明了分布式系统的示例，其中<code class="codeph">sales</code>用作提交点站点：</p>
                        <div class="figure" id="GUID-FB773DD4-B700-423F-A9EB-8D6F6765583E__i1007732">
                           <p class="titleinfigure">图34-3提交点站点</p><img src="img/admin050.gif" width="416" alt="下面是图34-3的描述" title="下面是图34-3的描述" longdesc="img_text/admin050.html"><br><a href="img_text/admin050.html">“图34-3提交点站点”的说明</a></div>
                        <!-- class="figure" -->
                        <p>提交点站点与以下方式与分布式事务中涉及的所有其他节点不同：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>提交点站点永远不会进入准备状态。因此，如果提交点站点存储最关键的数据，即使发生故障，该数据也不会存在疑问。在故障情况下，失败的节点仍处于准备状态，对数据进行必要的锁定，直到解决了不确定的事务。</p>
                           </li>
                           <li>
                              <p>提交点站点在事务中涉及的其他节点之前提交。实际上，提交点站点上的分布式事务的结果确定是否提交或回滚所有节点上的事务：其他节点跟随提交点站点的引导。全局协调器确保所有节点以与提交点站点相同的方式完成事务。</p>
                           </li>
                        </ul>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-51F21E1B-B735-48DC-8500-94DACAA863A0" title="系统管理员始终将一个节点指定为提交点站点。">提交点站点</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN12220"></a><div class="props_rev_3"><a id="GUID-AA225F8C-3896-4B37-88F4-4B2B8F974202" name="GUID-AA225F8C-3896-4B37-88F4-4B2B8F974202"></a><h5 id="ADMIN-GUID-AA225F8C-3896-4B37-88F4-4B2B8F974202" class="sect5"><span class="enumeration_section">34.2.6.2</span>分布式事务如何提交</h5>
                     <div>
                        <p>在准备好所有非提交点站点之后，分布式事务被视为已提交，并且事务已在提交点站点实际提交。</p>
                        <p>只要在此节点上提交分布式事务，就会更新提交点站点上的重做日志。</p>
                        <p>由于提交点日志包含提交记录，因此即使某些参与节点仍然只处于准备状态且事务尚未在这些节点上实际提交，该事务也会被视为已提交。同样，如果未在提交点站点记录提交，则认为<span class="italic">未</span>提交分布式事务。
                        </p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-51F21E1B-B735-48DC-8500-94DACAA863A0" title="系统管理员始终将一个节点指定为提交点站点。">提交点站点</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN13146"></a><a id="ADMIN12221"></a><div class="props_rev_3"><a id="GUID-A3DA5714-5DAC-4D8C-AEDF-0D6050D74035" name="GUID-A3DA5714-5DAC-4D8C-AEDF-0D6050D74035"></a><h5 id="ADMIN-GUID-A3DA5714-5DAC-4D8C-AEDF-0D6050D74035" class="sect5"><span class="enumeration_section">34.2.6.3</span>承诺点强度</h5>
                     <div>
                        <p>必须为每个数据库服务器分配一个提交点强度。如果在分布式事务中引用数据库服务器，则其提交点强度的值将确定它在两阶段提交中扮演的角色。</p>
                        <p>具体地，提交点强度确定给定节点是否是分布式事务中的提交点站点，因此在所有其他节点之前提交。使用初始化参数<code class="codeph">COMMIT_POINT_STRENGTH</code>指定此值。本节介绍数据库如何确定提交点站点。
                        </p>
                        <p>在准备阶段开始时确定的提交点站点仅从参与事务的节点中选择。发生以下事件序列：</p>
                        <ol>
                           <li>
                              <p>在全局协调器直接引用的节点中，数据库选择具有最高提交点强度的节点作为提交点站点。</p>
                           </li>
                           <li>
                              <p>最初选择的节点确定它必须从中获取该事务的信息的任何节点是否具有更高的提交点强度。</p>
                           </li>
                           <li>
                              <p>在事务中直接引用的具有最高提交点强度的节点或具有较高提交点强度的其中一个服务器将成为提交点站点。</p>
                           </li>
                           <li>
                              <p>在确定最终提交点站点之后，全局协调器向参与该事务的所有节点发送准备响应。</p>
                           </li>
                        </ol>
                        <p><a href="distributed-transactions-concepts.html#GUID-A3DA5714-5DAC-4D8C-AEDF-0D6050D74035__i1007762">图34-4</a>在示例会话树中显示了每个节点的提交点强度（在括号中），并显示了选择作为提交点站点的节点：</p>
                        <div class="figure" id="GUID-A3DA5714-5DAC-4D8C-AEDF-0D6050D74035__i1007762">
                           <p class="titleinfigure">图34-4提交点强度和提交点站点的确定</p><img src="img/admin032.png" width="578" alt="下面是图34-4的描述" title="下面是图34-4的描述" longdesc="img_text/admin032.html"><br><a href="img_text/admin032.html">“图34-4提交点强度和提交点站点的确定”的描述</a></div>
                        <!-- class="figure" -->
                        <p>确定提交点站点时，以下条件适用：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>只读节点不能是提交点站点。</p>
                           </li>
                           <li>
                              <p>如果全局协调器直接引用的多个节点具有相同的提交点强度，则数据库将其中一个指定为提交点站点。</p>
                           </li>
                           <li>
                              <p>如果分布式事务以回滚结束，则不需要准备和提交阶段。因此，数据库永远不会确定提交点站点。相反，全局协调器向所有节点发送<code class="codeph">ROLLBACK</code>语句，并结束分布式事务的处理。
                              </p>
                           </li>
                        </ul>
                        <p><a href="distributed-transactions-concepts.html#GUID-A3DA5714-5DAC-4D8C-AEDF-0D6050D74035__i1007762">如图34-4</a>所示，提交点站点和全局协调器可以是会话树的不同节点。在进行初始连接时，将每个节点的提交点强度传递给协调器。协调器保留与它们直接通信的每个节点的提交点强度，以便在两阶段提交期间可以有效地选择提交点站点。因此，每次提交发生时，协调器和节点之间不必交换提交点强度。
                        </p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-A3DA5714-5DAC-4D8C-AEDF-0D6050D74035__GUID-F4E4418A-C484-4B33-B544-0DE984DA7821">
                           <p class="notep1">也可以看看：</p>
                           <p></p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="managing-distributed-transactions.html#GUID-45329B02-514E-446E-89FE-14BA008BEA07" title="具有最高提交点强度的数据库确定哪个节点在分布式事务中首先提交。">指定节点的提交点强度</a> ”</span>以了解如何设置节点的提交点强度</p>
                              </li>
                              <li>
                                 <p>有关初始化参数<code class="codeph">COMMIT_POINT_STRENGTH</code>更多信息，请<a href="../refrn/COMMIT_POINT_STRENGTH.html#REFRN10018" target="_blank"><span class="italic">参见Oracle数据库参考</span></a></p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-51F21E1B-B735-48DC-8500-94DACAA863A0" title="系统管理员始终将一个节点指定为提交点站点。">提交点站点</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-8152084F-4760-4B89-A91C-9A84F81C23D1" name="GUID-8152084F-4760-4B89-A91C-9A84F81C23D1"></a><h3 id="ADMIN-GUID-8152084F-4760-4B89-A91C-9A84F81C23D1" class="sect3"><span class="enumeration_section">34.3</span>两阶段提交机制</h3>
               <p>在分布式数据库环境中，数据库必须协调作为独立单元的分布式事务中的更改的提交或回滚。</p>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-70B07308-1C4C-404C-9165-9563DC3DE09C">关于两阶段承诺机制</a><br>与本地数据库上的事务不同，分布式事务涉及更改多个数据库上的数据。因此，分布式事务处理更复杂，因为数据库必须协调提交或回滚事务中的更改作为独立单元。换句话说，整个事务提交，或整个事务回滚。
                     </li>
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-97E7DFD0-BB98-45EA-97E7-8ACE4D63E155">准备阶段</a><br>准备阶段是提交分布式事务的第一阶段。
                     </li>
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-6D72F449-2A6C-49E3-84C6-10E09C751605">提交阶段</a><br>提交分布式事务的第二个阶段是提交阶段。在此阶段发生之前，除分布式事务中引用的提交点站点之外的<span class="italic">所有</span>节点都保证它们已准备好，即它们具有提交事务所需的资源。
                     </li>
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-3A7B038B-61F9-42C1-823F-4E304B68462C">忘记阶段</a><br>在参与节点通知提交点站点他们已提交之后，提交点站点可以忘记该事务。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-C1B373BA-410E-4F38-8522-F72A74665919" title="分布式事务在分布式数据库的两个或多个不同节点上更新数据。">分布式事务概念</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADMIN12222"></a><div class="props_rev_3"><a id="GUID-70B07308-1C4C-404C-9165-9563DC3DE09C" name="GUID-70B07308-1C4C-404C-9165-9563DC3DE09C"></a><h4 id="ADMIN-GUID-70B07308-1C4C-404C-9165-9563DC3DE09C" class="sect4"><span class="enumeration_section">34.3.1</span>关于两阶段提交机制</h4>
                  <div>
                     <p>与本地数据库上的事务不同，分布式事务涉及更改多个数据库上的数据。因此，分布式事务处理更复杂，因为数据库必须协调提交或回滚事务中的更改作为独立单元。换句话说，整个事务提交，或整个事务回滚。</p>
                     <p>数据库使用<span class="bold">两阶段提交机制</span>确保分布式事务中数据的完整性。在<span class="bold">准备阶段</span> ，事务中的发起节点要求其他参与节点承诺提交或回滚事务。在<span class="bold">提交阶段</span> ，发起节点要求所有参与节点提交事务。如果无法获得此结果，则会要求所有节点回滚。
                     </p>
                     <p>分布式事务中的所有参与节点应执行相同的操作：它们应该全部提交或全部执行事务的回滚。数据库自动控制和监视分布式事务的提交或回滚，并使用两阶段提交机制维护<span class="bold">全局数据库</span> （参与事务的数据库集合）的完整性。这种机制是完全透明的，不需要用户或应用程序开发人员进行编程。
                     </p>
                     <p>提交机制具有以下不同阶段，每当用户提交分布式事务时，数据库都会自动执行：</p>
                     <div class="tblformal" id="GUID-70B07308-1C4C-404C-9165-9563DC3DE09C__GUID-0C79A9BC-545F-4A92-8476-8CDE11C2510A">
                        <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="Column 1 lists the phases of commit and column 2 describes each phase." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="28%" id="d316272e1354">相</th>
                                 <th align="left" valign="bottom" width="72%" id="d316272e1357">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d316272e1362" headers="d316272e1354 ">
                                    <p>准备阶段</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d316272e1362 d316272e1357 ">
                                    <p>称为<span class="bold">全局协调器的</span>初始节点要求除提交点站点以外的参与节点承诺提交或回滚事务，即使出现故障也是如此。如果任何节点无法准备，则回滚事务。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d316272e1372" headers="d316272e1354 ">
                                    <p>提交阶段</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d316272e1372 d316272e1357 ">
                                    <p>如果所有参与者都响应协调器他们已准备好，则协调器要求提交点站点提交。提交后，协调器会要求所有其他节点提交事务。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d316272e1379" headers="d316272e1354 ">
                                    <p>忘记阶段</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d316272e1379 d316272e1357 ">
                                    <p>全球协调员忘记了交易。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-8152084F-4760-4B89-A91C-9A84F81C23D1" title="在分布式数据库环境中，数据库必须协调作为独立单元的分布式事务中的更改的提交或回滚。">两阶段提交机制</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-97E7DFD0-BB98-45EA-97E7-8ACE4D63E155" name="GUID-97E7DFD0-BB98-45EA-97E7-8ACE4D63E155"></a><h4 id="ADMIN-GUID-97E7DFD0-BB98-45EA-97E7-8ACE4D63E155" class="sect4"><span class="enumeration_section">34.3.2</span>准备阶段</h4>
                  <p>准备阶段是提交分布式事务的第一阶段。</p>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-EC878E07-1749-4F4A-B358-12D02B5B0EF3">关于准备阶段</a><br>提交分布式事务的第一阶段是准备阶段。
                        </li>
                        <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-07D726E4-1F4D-4C1C-B9EE-FE333AAB86D7">准备阶段的回应类型</a><br>当一个节点被告知准备时，它可以以不同的方式响应。
                        </li>
                        <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-77A6C58F-AF82-40FA-A12D-8168026DBBC6">准备阶段的步骤</a><br>两阶段提交过程中的准备阶段包括特定步骤。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-8152084F-4760-4B89-A91C-9A84F81C23D1" title="在分布式数据库环境中，数据库必须协调作为独立单元的分布式事务中的更改的提交或回滚。">两阶段提交机制</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="ADMIN12223"></a><div class="props_rev_3"><a id="GUID-EC878E07-1749-4F4A-B358-12D02B5B0EF3" name="GUID-EC878E07-1749-4F4A-B358-12D02B5B0EF3"></a><h5 id="ADMIN-GUID-EC878E07-1749-4F4A-B358-12D02B5B0EF3" class="sect5"><span class="enumeration_section">34.3.2.1</span>关于准备阶段</h5>
                     <div>
                        <p>提交分布式事务的第一阶段是准备阶段。</p>
                        <p>在此阶段，数据库实际上不提交或回滚事务。相反，分布式事务中引用的所有节点（ <span class="q">“ <a href="distributed-transactions-concepts.html#GUID-FB773DD4-B700-423F-A9EB-8D6F6765583E" title="The job of the commit point site is to initiate a commit or roll back operation as instructed by the global coordinator.">提交点站点</a> ”中</span>描述的<span class="q"><a href="distributed-transactions-concepts.html#GUID-FB773DD4-B700-423F-A9EB-8D6F6765583E" title="提交点站点的工作是按照全局协调器的指示启动提交或回滚操作。">提交点站点</a></span>除外）都被告知准备提交。通过准备，一个节点：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>记录重做日志中的信息，以便随后可以提交或回滚事务，而不管中间的故障</p>
                           </li>
                           <li>
                              <p>在已修改的表上放置分布式锁，以防止读取</p>
                           </li>
                        </ul>
                        <p>当节点响应它准备提交的全局协调器时，准备好的节点<span class="italic">承诺</span>稍后提交或回滚事务，但不会单独决定是提交还是回滚事务。承诺意味着如果此时发生实例故障，则节点可以使用联机日志中的重做记录将数据库恢复回准备阶段。
                        </p>
                        <div class="infoboxnote" id="GUID-EC878E07-1749-4F4A-B358-12D02B5B0EF3__GUID-26D79DB7-713C-42C7-A636-CDBFC252E550">
                           <p class="notep1">注意：</p>
                           <p>在节点准备好后启动的查询无法访问关联的锁定数据，直到所有阶段完成。除非发生故障，否则时间是微不足道的（参见<span class="q">“ <a href="managing-distributed-transactions.html#GUID-297F05FA-6F3E-40E6-8C11-C6B68CFAD9FE" title="当两阶段提交的任何方面出现故障时，事务是不确定的。分布式事务在以下方面变得不确定：运行Oracle数据库软件的服务器系统崩溃，分布式处理中涉及的两个或多个Oracle数据库之间的网络连接断开，或者发生未处理的软件错误。">决定如何处理疑难事务</a> ”</span> ）。
                           </p>
                        </div>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-97E7DFD0-BB98-45EA-97E7-8ACE4D63E155" title="准备阶段是提交分布式事务的第一阶段。">准备阶段</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN12224"></a><div class="props_rev_3"><a id="GUID-07D726E4-1F4D-4C1C-B9EE-FE333AAB86D7" name="GUID-07D726E4-1F4D-4C1C-B9EE-FE333AAB86D7"></a><h5 id="ADMIN-GUID-07D726E4-1F4D-4C1C-B9EE-FE333AAB86D7" class="sect5"><span class="enumeration_section">34.3.2.2</span>准备阶段的响应类型</h5>
                     <div>
                        <p>当一个节点被告知准备时，它可以以不同的方式响应。</p>
                        <div class="tblformal" id="GUID-07D726E4-1F4D-4C1C-B9EE-FE333AAB86D7__GUID-7416C366-2D44-4FFD-B30A-99D06BFFF7AD">
                           <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="Column 1 lists possible responses when a node is told to prepare; column 2 explains the meaning of the response." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="28%" id="d316272e1562">响应</th>
                                    <th align="left" valign="bottom" width="72%" id="d316272e1565">含义</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="28%" id="d316272e1570" headers="d316272e1562 ">
                                       <p>准备</p>
                                    </td>
                                    <td align="left" valign="top" width="72%" headers="d316272e1570 d316272e1565 ">
                                       <p>节点上的数据已由分布式事务中的语句修改，并且节点已成功准备。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="28%" id="d316272e1577" headers="d316272e1562 ">
                                       <p>只读</p>
                                    </td>
                                    <td align="left" valign="top" width="72%" headers="d316272e1577 d316272e1565 ">
                                       <p>节点上的数据没有或者可以修改（仅查询），因此无需准备。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="28%" id="d316272e1584" headers="d316272e1562 ">
                                       <p>退出</p>
                                    </td>
                                    <td align="left" valign="top" width="72%" headers="d316272e1584 d316272e1565 ">
                                       <p>节点无法成功准备。</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-AB89D9C3-0176-403F-B60C-D6A69D79EA52">准备好的回应</a><br>节点成功准备后，会发出<span class="bold">准备好的消息</span> 。
                           </li>
                           <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-16E4E2D9-9364-425F-84CC-2266BECC340F">只读响应</a><br>当要求节点进行准备，并且影响数据库的SQL语句不更改节点上的任何数据时，节点将以<span class="bold">只读消息进行</span>响应。
                           </li>
                           <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-F8F33909-35EB-49A2-9D77-C14D7A0BCCF6">中止响应</a><br><span class="bold">中止消息</span>导致特定操作。
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-97E7DFD0-BB98-45EA-97E7-8ACE4D63E155" title="准备阶段是提交分布式事务的第一阶段。">准备阶段</a></p>
                           </div>
                        </div>
                     </div>
                     <a id="ADMIN12225"></a><div class="props_rev_3"><a id="GUID-AB89D9C3-0176-403F-B60C-D6A69D79EA52" name="GUID-AB89D9C3-0176-403F-B60C-D6A69D79EA52"></a><h6 id="ADMIN-GUID-AB89D9C3-0176-403F-B60C-D6A69D79EA52" class="sect6"><span class="enumeration_section">34.3.2.2.1</span>准备<span class="enumeration_section">好的</span>响应</h6>
                        <div>
                           <p>节点成功准备后，会发出<span class="bold">准备好的消息</span> 。
                           </p>
                           <p>该消息表明该节点具有联机日志中的更改记录，因此准备提交或执行回滚。该消息还保证为事务保持的锁可以在失败时存活。</p>
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-07D726E4-1F4D-4C1C-B9EE-FE333AAB86D7" title="当一个节点被告知准备时，它可以以不同的方式响应。">准备阶段中的响应类型</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="ADMIN12226"></a><div class="props_rev_3"><a id="GUID-16E4E2D9-9364-425F-84CC-2266BECC340F" name="GUID-16E4E2D9-9364-425F-84CC-2266BECC340F"></a><h6 id="ADMIN-GUID-16E4E2D9-9364-425F-84CC-2266BECC340F" class="sect6"><span class="enumeration_section">34.3.2.2.2</span>只读响应</h6>
                        <div>
                           <p>当要求节点进行准备，并且影响数据库的SQL语句不更改节点上的任何数据时，节点将以<span class="bold">只读消息进行</span>响应。
                           </p>
                           <p>该消息表明该节点不参与提交阶段。</p>
                           <p>有三种情况，其中全部或部分分布式事务是只读的：</p>
                           <div class="tblformal" id="GUID-16E4E2D9-9364-425F-84CC-2266BECC340F__GUID-C1CF6127-0C5E-49AB-8A85-83FC22882255">
                              <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="Column 1 lists the cases where a distributed transaction might be read-only; column 2 lists the associated conditions; column 3 explains the consequences." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="25%" id="d316272e1740">案件</th>
                                       <th align="left" valign="bottom" width="34%" id="d316272e1743">条件</th>
                                       <th align="left" valign="bottom" width="41%" id="d316272e1746">后果</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d316272e1751" headers="d316272e1740 ">
                                          <p>部分只读</p>
                                       </td>
                                       <td align="left" valign="top" width="34%" headers="d316272e1751 d316272e1743 ">
                                          <p>发生以下任何情况：</p>
                                          <ul style="list-style-type:disc">
                                             <li>
                                                <p>仅在一个或多个节点上发出查询。</p>
                                             </li>
                                             <li>
                                                <p>没有数据被更改。</p>
                                             </li>
                                             <li>
                                                <p>由于触发器触发或违反约束而回滚的更改。</p>
                                             </li>
                                          </ul>
                                       </td>
                                       <td align="left" valign="top" width="41%" headers="d316272e1751 d316272e1746 ">
                                          <p>只读节点在要求准备时识别其状态。他们给当地协调员一个只读回复。因此，提交阶段完成得更快，因为数据库从后续处理中消除了只读节点。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d316272e1771" headers="d316272e1740 ">
                                          <p>完全只读准备阶段</p>
                                       </td>
                                       <td align="left" valign="top" width="34%" headers="d316272e1771 d316272e1743 ">
                                          <p>发生以下所有情况：</p>
                                          <ul style="list-style-type:disc">
                                             <li>
                                                <p>没有数据变化。</p>
                                             </li>
                                             <li>
                                                <p><span class="italic">不</span>使用<code class="codeph">SET TRANSACTION READ ONLY</code>语句启动<code class="codeph">SET TRANSACTION READ ONLY</code> 。
                                                </p>
                                             </li>
                                          </ul>
                                       </td>
                                       <td align="left" valign="top" width="41%" headers="d316272e1771 d316272e1746 ">
                                          <p>所有节点都在准备阶段识别出它们是只读的，因此不需要提交阶段。不知道所有节点是否为只读的全局协调器仍必须执行准备阶段。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="25%" id="d316272e1794" headers="d316272e1740 ">
                                          <p>完全只读，无需两阶段提交</p>
                                       </td>
                                       <td align="left" valign="top" width="34%" headers="d316272e1794 d316272e1743 ">
                                          <p>发生以下所有情况：</p>
                                          <ul style="list-style-type:disc">
                                             <li>
                                                <p>没有数据变化。</p>
                                             </li>
                                             <li>
                                                <p><span class="italic">交易</span>开始<code class="codeph">SET TRANSACTION READ ONLY</code>语句。
                                                </p>
                                             </li>
                                          </ul>
                                       </td>
                                       <td align="left" valign="top" width="41%" headers="d316272e1794 d316272e1746 ">
                                          <p>事务中只允许查询，因此全局协调器不必执行两阶段提交。由于节点之间的全局SCN协调，其他事务的更改不会降低全局事务级读取一致性。该事务不使用还原段。</p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p>请注意，如果将分布式事务设置为只读，则不使用还原段。如果许多用户连接到数据库并且他们的事务<span class="italic">未</span>设置为<code class="codeph">READ ONLY</code> ，则即使他们仅执行查询，他们也会分配撤消空间。
                           </p>
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-07D726E4-1F4D-4C1C-B9EE-FE333AAB86D7" title="当一个节点被告知准备时，它可以以不同的方式响应。">准备阶段中的响应类型</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="ADMIN12227"></a><div class="props_rev_3"><a id="GUID-F8F33909-35EB-49A2-9D77-C14D7A0BCCF6" name="GUID-F8F33909-35EB-49A2-9D77-C14D7A0BCCF6"></a><h6 id="ADMIN-GUID-F8F33909-35EB-49A2-9D77-C14D7A0BCCF6" class="sect6"><span class="enumeration_section">34.3.2.2.3</span>中止响应</h6>
                        <div>
                           <p><span class="bold">中止消息</span>导致特定操作。
                           </p>
                           <p>当节点无法成功准备时，它将执行以下操作：</p>
                           <ol>
                              <li>
                                 <p>释放事务当前持有的资源并回滚事务的本地部分。</p>
                              </li>
                              <li>
                                 <p>使用中止消息响应在分布式事务中引用它的节点。</p>
                              </li>
                           </ol>
                           <p>然后，这些操作将传播到分布式事务中涉及的其他节点，以便它们可以回滚事务并保证全局数据库中数据的完整性。此响应强制执行分布式事务的主要规则：事务<span class="italic">中涉及的所有节点全部提交或全部在同一逻辑时间回滚事务</span> 。
                           </p>
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-07D726E4-1F4D-4C1C-B9EE-FE333AAB86D7" title="当一个节点被告知准备时，它可以以不同的方式响应。">准备阶段中的响应类型</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div><a id="ADMIN12228"></a><div class="props_rev_3"><a id="GUID-77A6C58F-AF82-40FA-A12D-8168026DBBC6" name="GUID-77A6C58F-AF82-40FA-A12D-8168026DBBC6"></a><h5 id="ADMIN-GUID-77A6C58F-AF82-40FA-A12D-8168026DBBC6" class="sect5"><span class="enumeration_section">34.3.2.3</span>准备阶段的步骤</h5>
                     <div>
                        <p>两阶段提交过程中的准备阶段包括特定步骤。</p>
                        <p>要完成准备阶段，除提交点站点之外的每个节点都执行以下步骤：</p>
                        <ol>
                           <li>
                              <p>节点请求其<span class="bold">后代</span> （即随后引用的节点）准备提交。
                              </p>
                           </li>
                           <li>
                              <p>节点检查事务是否更改自身或其后代的数据。如果数据没有变化，则节点跳过剩余的步骤并返回只读响应（参见<span class="q">“ <a href="distributed-transactions-concepts.html#GUID-16E4E2D9-9364-425F-84CC-2266BECC340F" title="当要求节点进行准备，并且影响数据库的SQL语句不更改节点上的任何数据时，节点将以只读消息进行响应。">只读响应</a> ”</span> ）。
                              </p>
                           </li>
                           <li>
                              <p>如果数据发生更改，节点将分配必须提交事务的资源。</p>
                           </li>
                           <li>
                              <p>该节点将与事务所做更改相对应的重做记录保存到其重做日志中。</p>
                           </li>
                           <li>
                              <p>该节点保证为事务保持的锁能够承受故障。</p>
                           </li>
                           <li>
                              <p>节点使用准备好的响应响应发起节点（请参阅<span class="q">“ <a href="distributed-transactions-concepts.html#GUID-AB89D9C3-0176-403F-B60C-D6A69D79EA52" title="When a node has successfully prepared, it issues a prepared message.">准备</a></span>好的<span class="q"><a href="distributed-transactions-concepts.html#GUID-AB89D9C3-0176-403F-B60C-D6A69D79EA52" title="节点成功准备后，会发出准备好的消息。">响应</a> ”</span> ） <span class="italic"> </span>或者，如果其尝试或其后代的一次尝试未能成功，则作出中止回应（参见<span class="q">“ <a href="distributed-transactions-concepts.html#GUID-F8F33909-35EB-49A2-9D77-C14D7A0BCCF6" title="中止消息导致特定操作。">中止回应</a> ”</span> ）。
                              </p>
                           </li>
                        </ol>
                        <p>这些操作保证节点可以随后在节点上提交或回滚事务。然后，准备好的节点等待，直到从全局协调器接收到<code class="codeph">COMMIT</code>或<code class="codeph">ROLLBACK</code>请求。
                        </p>
                        <p>在准备节点之后，分布式事务被认为是<span class="bold">不确定的</span> （参见<span class="q">“</span> <span class="bold">疑难</span> <span class="q"><a href="distributed-transactions-concepts.html#GUID-364CA7BD-A02E-4A74-AF72-45021CAC3E3C" title="两阶段提交机制确保所有节点一起提交或执行回滚。如果由于系统或网络错误导致三个阶段中的任何一个失败，会发生什么？交易变得毫无疑问。">事务</a> ”</span> ）。在所有更改都已提交或回滚之前，它会保持不确定状态。
                        </p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-97E7DFD0-BB98-45EA-97E7-8ACE4D63E155" title="准备阶段是提交分布式事务的第一阶段。">准备阶段</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="ADMIN12229"></a><div class="props_rev_3"><a id="GUID-6D72F449-2A6C-49E3-84C6-10E09C751605" name="GUID-6D72F449-2A6C-49E3-84C6-10E09C751605"></a><h4 id="ADMIN-GUID-6D72F449-2A6C-49E3-84C6-10E09C751605" class="sect4"><span class="enumeration_section">34.3.3</span>提交阶段</h4>
                  <p>提交分布式事务的第二个阶段是提交阶段。在此阶段发生之前，除分布式事务中引用的提交点站点之外的<span class="italic">所有</span>节点都保证它们已准备好，即它们具有提交事务所需的资源。
                  </p>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-29693A46-C02E-4B2B-B914-412E1DD58098">提交阶段的步骤</a><br>两阶段提交过程中的提交阶段包括特定步骤。
                        </li>
                        <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-6DD3BBAF-B0D6-493C-888F-936B5E4F0B0C">保证全球数据库的一致性</a><br>每个已提交的事务都有一个关联的系统更改编号（SCN），用于唯一标识该事务中SQL语句所做的更改。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-8152084F-4760-4B89-A91C-9A84F81C23D1" title="在分布式数据库环境中，数据库必须协调作为独立单元的分布式事务中的更改的提交或回滚。">两阶段提交机制</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="ADMIN12230"></a><div class="props_rev_3"><a id="GUID-29693A46-C02E-4B2B-B914-412E1DD58098" name="GUID-29693A46-C02E-4B2B-B914-412E1DD58098"></a><h5 id="ADMIN-GUID-29693A46-C02E-4B2B-B914-412E1DD58098" class="sect5"><span class="enumeration_section">34.3.3.1</span>提交阶段的步骤</h5>
                     <div>
                        <p>两阶段提交过程中的提交阶段包括特定步骤。</p>
                        <p>提交阶段包括以下步骤：</p>
                        <ol>
                           <li>
                              <p>全局协调器指示提交点站点提交。</p>
                           </li>
                           <li>
                              <p>提交点站点提交。</p>
                           </li>
                           <li>
                              <p>提交点站点通知全局协调器它已提交。</p>
                           </li>
                           <li>
                              <p>全局和本地协调器向所有节点发送消息，指示它们提交事务。</p>
                           </li>
                           <li>
                              <p>在每个节点上，数据库提交分布式事务的本地部分并释放锁。</p>
                           </li>
                           <li>
                              <p>在每个节点上，数据库在本地重做日志中记录一个额外的重做条目，指示事务已提交。</p>
                           </li>
                           <li>
                              <p>参与节点通知全局协调器他们已经提交。</p>
                           </li>
                        </ol>
                        <p>提交阶段完成后，分布式系统的所有节点上的数据都是一致的。</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-6D72F449-2A6C-49E3-84C6-10E09C751605" title="提交分布式事务的第二个阶段是提交阶段。在此阶段发生之前，除分布式事务中引用的提交点站点之外的所有节点都保证它们已准备好，即它们具有提交事务所需的资源。">提交阶段</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN12231"></a><div class="props_rev_3"><a id="GUID-6DD3BBAF-B0D6-493C-888F-936B5E4F0B0C" name="GUID-6DD3BBAF-B0D6-493C-888F-936B5E4F0B0C"></a><h5 id="ADMIN-GUID-6DD3BBAF-B0D6-493C-888F-936B5E4F0B0C" class="sect5"><span class="enumeration_section">34.3.3.2</span>保证全局数据库一致性</h5>
                     <div>
                        <p>每个已提交的事务都有一个关联的系统更改编号（SCN），用于唯一标识该事务中SQL语句所做的更改。</p>
                        <p>SCN用作唯一标识数据库的已提交版本的内部时间戳。</p>
                        <p>在分布式系统中，当发生以下所有操作时，协调通信节点的SCN：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>使用一个或多个数据库链接描述的路径进行连接</p>
                           </li>
                           <li>
                              <p>执行分布式SQL语句</p>
                           </li>
                           <li>
                              <p>分布式事务提交</p>
                           </li>
                        </ul>
                        <p>除了其他好处之外，SCN在分布式系统的节点之间的协调确保了语句和事务级别的全局读取一致性。如有必要，还可以完成全球基于时间的恢复。</p>
                        <p>在准备阶段，数据库确定事务中涉及的所有节点的最高SCN。然后，事务在提交点站点提交高SCN。然后，使用提交决定将提交SCN发送到所有准备好的节点。</p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-6DD3BBAF-B0D6-493C-888F-936B5E4F0B0C__GUID-257994BE-CAA6-462E-BEA0-F1481ADFD034">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="managing-distributed-transactions.html#GUID-195124A5-FF1B-40BA-BAF9-CB5272E8BFD3" title="分布式读取一致性的Oracle数据库实现存在一个重要的限制。">管理读一致性</a> ”</span>以获取有关管理读取一致性中的时滞问题的信息</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-6D72F449-2A6C-49E3-84C6-10E09C751605" title="提交分布式事务的第二个阶段是提交阶段。在此阶段发生之前，除分布式事务中引用的提交点站点之外的所有节点都保证它们已准备好，即它们具有提交事务所需的资源。">提交阶段</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="ADMIN12232"></a><div class="props_rev_3"><a id="GUID-3A7B038B-61F9-42C1-823F-4E304B68462C" name="GUID-3A7B038B-61F9-42C1-823F-4E304B68462C"></a><h4 id="ADMIN-GUID-3A7B038B-61F9-42C1-823F-4E304B68462C" class="sect4"><span class="enumeration_section">34.3.4</span>忘记阶段</h4>
                  <div>
                     <p>在参与节点通知提交点站点他们已提交之后，提交点站点可以忘记该事务。</p>
                     <p>发生以下步骤：</p>
                     <ol>
                        <li>
                           <p>在收到全局协调器通知所有节点已提交的通知后，提交点站点将擦除有关此事务的状态信息。</p>
                        </li>
                        <li>
                           <p>提交点站点通知全局协调器它已擦除状态信息。</p>
                        </li>
                        <li>
                           <p>全球协调员删除自己有关交易的信息。</p>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-8152084F-4760-4B89-A91C-9A84F81C23D1" title="在分布式数据库环境中，数据库必须协调作为独立单元的分布式事务中的更改的提交或回滚。">两阶段提交机制</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="sect2"><a id="GUID-5FA12AC8-2E77-4180-ACA6-D2E8CED8462A" name="GUID-5FA12AC8-2E77-4180-ACA6-D2E8CED8462A"></a><h3 id="ADMIN-GUID-5FA12AC8-2E77-4180-ACA6-D2E8CED8462A" class="sect3"><span class="enumeration_section">34.4</span>疑难事务</h3>
               <p>如果两阶段提交机制失败，则事务变得不确定。</p>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-364CA7BD-A02E-4A74-AF72-45021CAC3E3C">关于In-Doubt交易</a><br>两阶段提交机制确保所有节点一起提交或执行回滚。如果由于系统或网络错误导致三个阶段中的任何一个失败，会发生什么？交易变得毫无疑问。
                     </li>
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-92DD1154-C137-4E08-BB91-BCCB227F81B5">自动解决疑难事务</a><br>在大多数情况下，数据库会自动解决不确定事务。假设在以下场景中有两个节点， <code class="codeph">local</code>和<code class="codeph">remote</code> 。本地节点是提交点站点。用户<code class="codeph">scott</code>连接到<code class="codeph">local</code>并执行和提交更新<code class="codeph">local</code>和<code class="codeph">remote</code>的分布式事务。
                     </li>
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-AD2C34BB-3619-486C-B9CF-CB872EF71076">手动解决疑难事务</a><br>在某些情况下，您必须手动解决不确定的事务。
                     </li>
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-97643C4A-6FB3-4B0B-8C0C-E44CDB560508">系统变更编号在疑难事务中的相关性</a><br><span class="bold">系统更改号</span> （SCN）是已提交的数据库版本的内部时间戳。Oracle数据库服务器使用SCN时钟值来保证事务的一致性。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-C1B373BA-410E-4F38-8522-F72A74665919" title="分布式事务在分布式数据库的两个或多个不同节点上更新数据。">分布式事务概念</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADMIN12233"></a><div class="props_rev_3"><a id="GUID-364CA7BD-A02E-4A74-AF72-45021CAC3E3C" name="GUID-364CA7BD-A02E-4A74-AF72-45021CAC3E3C"></a><h4 id="ADMIN-GUID-364CA7BD-A02E-4A74-AF72-45021CAC3E3C" class="sect4"><span class="enumeration_section">34.4.1</span>关于<span class="enumeration_section">疑难</span>事务</h4>
                  <div>
                     <p>两阶段提交机制确保所有节点一起提交或执行回滚。如果由于系统或网络错误导致三个阶段中的任何一个失败，会发生什么？交易变得毫无疑问。</p>
                     <p></p>
                     <p>分布式事务可能会在以下方面变得不确定：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>运行Oracle数据库软件的服务器系统崩溃</p>
                        </li>
                        <li>
                           <p>断开了分布式处理中涉及的两个或多个Oracle数据库之间的网络连接</p>
                        </li>
                        <li>
                           <p>发生未处理的软件错误</p>
                        </li>
                     </ul>
                     <p>当系统，网络或软件问题得到解决时，RECO进程会自动解决不确定的事务。在RECO可以解决事务之前，数据将被锁定以进行读取和写入。数据库阻止读取，因为它无法确定要为查询显示哪个版本的数据。</p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-5FA12AC8-2E77-4180-ACA6-D2E8CED8462A" title="如果两阶段提交机制失败，则事务变得不确定。">In-Doubt Transactions</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN12234"></a><div class="props_rev_3"><a id="GUID-92DD1154-C137-4E08-BB91-BCCB227F81B5" name="GUID-92DD1154-C137-4E08-BB91-BCCB227F81B5"></a><h4 id="ADMIN-GUID-92DD1154-C137-4E08-BB91-BCCB227F81B5" class="sect4"><span class="enumeration_section">34.4.2自我</span>解决疑问事务</h4>
                  <p>在大多数情况下，数据库会自动解决不确定事务。假设在以下场景中有两个节点， <code class="codeph">local</code>和<code class="codeph">remote</code> 。本地节点是提交点站点。用户<code class="codeph">scott</code>连接到<code class="codeph">local</code>并执行和提交更新<code class="codeph">local</code>和<code class="codeph">remote</code>的分布式事务。
                  </p>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-5278559F-5755-4913-9117-B1B8EE7FB9DC">准备阶段失败</a><br>一个示例说明了在两阶段事务的准备阶段发生故障时遵循的步骤。
                        </li>
                        <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-3BB64534-3900-4731-8688-A5D75B5BDAC8">提交阶段失败</a><br>一个示例说明了在两阶段事务的提交阶段发生故障时遵循的步骤。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-5FA12AC8-2E77-4180-ACA6-D2E8CED8462A" title="如果两阶段提交机制失败，则事务变得不确定。">In-Doubt Transactions</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="ADMIN13147"></a><a id="ADMIN12235"></a><div class="props_rev_3"><a id="GUID-5278559F-5755-4913-9117-B1B8EE7FB9DC" name="GUID-5278559F-5755-4913-9117-B1B8EE7FB9DC"></a><h5 id="ADMIN-GUID-5278559F-5755-4913-9117-B1B8EE7FB9DC" class="sect5"><span class="enumeration_section">34.4.2.1</span>准备阶段的失败</h5>
                     <div>
                        <p>一个示例说明了在两阶段事务的准备阶段发生故障时遵循的步骤。</p>
                        <p><a href="distributed-transactions-concepts.html#GUID-5278559F-5755-4913-9117-B1B8EE7FB9DC__i1008049">图34-5</a>说明了在分布式事务的准备阶段发生故障时的事件序列：</p>
                        <div class="figure" id="GUID-5278559F-5755-4913-9117-B1B8EE7FB9DC__i1008049">
                           <p class="titleinfigure">图34-5准备阶段失败</p><img src="img/admin049.gif" width="463" alt="下面是图34-5的描述" title="下面是图34-5的描述" longdesc="img_text/admin049.html"><br><a href="img_text/admin049.html">“图34-5准备阶段失败”的描述</a></div>
                        <!-- class="figure" -->
                        <p>发生以下步骤：</p>
                        <ol>
                           <li>
                              <p>用户<code class="codeph">SCOTT</code>连接到<code class="codeph">Local</code>并执行分布式事务。
                              </p>
                           </li>
                           <li>
                              <p>全局协调器（在此示例中也是提交点站点）请求提交点站点以外的所有数据库承诺在被告知时提交或回滚。</p>
                           </li>
                           <li>
                              <p><code class="codeph">remote</code>数据库在将准备响应发回<code class="codeph">local</code>之前崩溃。
                              </p>
                           </li>
                           <li>
                              <p>当远程站点恢复时，RECO进程最终在每个数据库上回滚事务。</p>
                           </li>
                        </ol>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-92DD1154-C137-4E08-BB91-BCCB227F81B5" title="在大多数情况下，数据库会自动解决不确定事务。假设在以下场景中有两个节点，本地和远程。本地节点是提交点站点。用户scott连接到本地并执行和提交更新本地和远程的分布式事务。">疑问事务的自动解决方案</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADMIN13148"></a><a id="ADMIN12236"></a><div class="props_rev_3"><a id="GUID-3BB64534-3900-4731-8688-A5D75B5BDAC8" name="GUID-3BB64534-3900-4731-8688-A5D75B5BDAC8"></a><h5 id="ADMIN-GUID-3BB64534-3900-4731-8688-A5D75B5BDAC8" class="sect5"><span class="enumeration_section">34.4.2.2</span>提交阶段的失败</h5>
                     <div>
                        <p>一个示例说明了在两阶段事务的提交阶段发生故障时遵循的步骤。</p>
                        <p><a href="distributed-transactions-concepts.html#GUID-3BB64534-3900-4731-8688-A5D75B5BDAC8__CHDGGDDE">图34-6</a>说明了在分布式事务的提交阶段发生故障时的事件序列：</p>
                        <div class="figure" id="GUID-3BB64534-3900-4731-8688-A5D75B5BDAC8__CHDGGDDE">
                           <p class="titleinfigure">图34-6提交阶段失败</p><img src="img/admin048.gif" width="509" alt="下面是图34-6的描述" title="下面是图34-6的描述" longdesc="img_text/admin048.html"><br><a href="img_text/admin048.html">“图34-6提交阶段失败”的描述</a></div>
                        <!-- class="figure" -->
                        <p>发生以下步骤：</p>
                        <ol>
                           <li>
                              <p>用户<code class="codeph">Scott</code>连接到<code class="codeph">local</code>并执行分布式事务。
                              </p>
                           </li>
                           <li>
                              <p>全局协调器（在这种情况下也是提交点站点）请求提交点站点以外的所有数据库承诺在被告知时提交或回滚。</p>
                           </li>
                           <li>
                              <p>提交点站点从<code class="codeph">remote</code>接收准备好的消息，表示它将提交。
                              </p>
                           </li>
                           <li>
                              <p>提交点站点在本地提交事务，然后向<code class="codeph">remote</code>发送提交消息，要求它提交。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">remote</code>数据库接收提交消息，但由于网络故障而无法响应。
                              </p>
                           </li>
                           <li>
                              <p>在网络恢复后，RECO进程最终在远程数据库上提交事务。</p>
                              <div class="infoboxnotealso" id="GUID-3BB64534-3900-4731-8688-A5D75B5BDAC8__GUID-B0A9A84C-61E5-4AC3-8A50-F2AE67BF8DE6">
                                 <p class="notep1">也可以看看：</p>
                                 <p><span class="q">“ <a href="managing-distributed-transactions.html#GUID-297F05FA-6F3E-40E6-8C11-C6B68CFAD9FE" title="当两阶段提交的任何方面出现故障时，事务是不确定的。分布式事务在以下方面变得不确定：运行Oracle数据库软件的服务器系统崩溃，分布式处理中涉及的两个或多个Oracle数据库之间的网络连接断开，或者发生未处理的软件错误。">决定如何处理疑难事务</a> ”</span>以描述故障情况以及数据库如何在两阶段提交期间解决干预故障</p>
                              </div>
                           </li>
                        </ol>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-92DD1154-C137-4E08-BB91-BCCB227F81B5" title="在大多数情况下，数据库会自动解决不确定事务。假设在以下场景中有两个节点，本地和远程。本地节点是提交点站点。用户scott连接到本地并执行和提交更新本地和远程的分布式事务。">疑问事务的自动解决方案</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="ADMIN12237"></a><div class="props_rev_3"><a id="GUID-AD2C34BB-3619-486C-B9CF-CB872EF71076" name="GUID-AD2C34BB-3619-486C-B9CF-CB872EF71076"></a><h4 id="ADMIN-GUID-AD2C34BB-3619-486C-B9CF-CB872EF71076" class="sect4"><span class="enumeration_section">34.4.3</span>手动解决<span class="enumeration_section">疑难</span>事务</h4>
                  <div>
                     <p>在某些情况下，您必须手动解决不确定的事务。</p>
                     <p>在以下情况下，您只需要手动解决不确定的事务：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>不确定事务会锁定关键数据或还原段。</p>
                        </li>
                        <li>
                           <p>系统，网络或软件故障的原因无法快速修复。</p>
                        </li>
                     </ul>
                     <p>解决不确定交易可能很复杂。该过程要求您执行以下操作：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>识别不确定事务的事务标识号。</p>
                        </li>
                        <li>
                           <p>查询<code class="codeph">DBA_2PC_PENDING</code>和<code class="codeph">DBA_2PC_NEIGHBORS</code>视图以确定事务中涉及的数据库是否已提交。
                           </p>
                        </li>
                        <li>
                           <p>如有必要，使用<code class="codeph">COMMIT FORCE</code>语句强制提交或使用<code class="codeph">ROLLBACK FORCE</code>语句进行回滚。
                           </p>
                           <div class="infoboxnotealso" id="GUID-AD2C34BB-3619-486C-B9CF-CB872EF71076__GUID-E03E3E1B-490B-4A4F-89A5-B6545BCDBDBA">
                              <p class="notep1">也可以看看：</p>
                              <p>以下部分介绍了如何解决不确定事务：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><span class="q">“ <a href="managing-distributed-transactions.html#GUID-297F05FA-6F3E-40E6-8C11-C6B68CFAD9FE" title="当两阶段提交的任何方面出现故障时，事务是不确定的。分布式事务在以下方面变得不确定：运行Oracle数据库软件的服务器系统崩溃，分布式处理中涉及的两个或多个Oracle数据库之间的网络连接断开，或者发生未处理的软件错误。">决定如何处理疑难事务</a> ”</span> 
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="q">“ <a href="managing-distributed-transactions.html#GUID-ED8FA97B-AA2E-4CB8-9F9F-D9575CBE3E93" title="使用带有FORCE选项的COMMIT或ROLLBACK语句以及指示要提交的不确定事务的本地或全局事务ID的文本字符串。">手动覆盖疑难事务</a> ”</span></p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-5FA12AC8-2E77-4180-ACA6-D2E8CED8462A" title="如果两阶段提交机制失败，则事务变得不确定。">In-Doubt Transactions</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN12238"></a><div class="props_rev_3"><a id="GUID-97643C4A-6FB3-4B0B-8C0C-E44CDB560508" name="GUID-97643C4A-6FB3-4B0B-8C0C-E44CDB560508"></a><h4 id="ADMIN-GUID-97643C4A-6FB3-4B0B-8C0C-E44CDB560508" class="sect4"><span class="enumeration_section">34.4.4疑难事务</span>的系统变更号的相关性</h4>
                  <div>
                     <p><span class="bold">系统更改号</span> （SCN）是已提交的数据库版本的内部时间戳。Oracle数据库服务器使用SCN时钟值来保证事务的一致性。
                     </p>
                     <p>例如，当用户提交事务时，数据库会在重做日志中记录此提交的SCN。</p>
                     <p>数据库使用SCN来协调不同数据库之间的分布式事务。例如，数据库以下列方式使用SCN：</p>
                     <ol>
                        <li>
                           <p>应用程序使用数据库链接建立连接。</p>
                        </li>
                        <li>
                           <p>分布式事务在所涉及的所有数据库中提交最高的全局SCN。</p>
                        </li>
                        <li>
                           <p>提交全局SCN将发送到事务中涉及的所有数据库。</p>
                        </li>
                     </ol>
                     <p>SCN对于分布式事务很重要，因为它们用作事务的同步提交时间戳，即使事务失败也是如此。如果事务变得不确定，管理员可以使用此SCN来协调对全局数据库所做的更改。事务提交的全局SCN也可用于稍后识别事务，例如，在分布式恢复中。</p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-5FA12AC8-2E77-4180-ACA6-D2E8CED8462A" title="如果两阶段提交机制失败，则事务变得不确定。">In-Doubt Transactions</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="sect2"><a id="GUID-7C9FDBB8-171D-422C-A944-A9CE2CB6B2AF" name="GUID-7C9FDBB8-171D-422C-A944-A9CE2CB6B2AF"></a><h3 id="ADMIN-GUID-7C9FDBB8-171D-422C-A944-A9CE2CB6B2AF" class="sect3"><span class="enumeration_section">34.5</span>分布式事务处理：案例研究</h3>
               <p>案例研究说明了分布式事务处理。</p>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-EC814CDE-5481-4FA7-A9F4-2FCFDD3535AA">关于分布式事务处理案例研究</a><br>在此方案中，公司具有单独的Oracle数据库服务器<code class="codeph">sales.example.com</code>和<code class="codeph">warehouse.example.com</code> 。当用户将销售记录插入<code class="codeph">sales</code>数据库时，相关记录将在<code class="codeph">warehouse</code>数据库中更新。
                     </li>
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-4EBA12EC-6B82-444D-B933-EF321B0846F0">第1阶段：客户端应用程序发布DML语句</a><br>一个例子说明了分布式事务处理的第一个阶段。
                     </li>
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-8041782B-495C-4D10-8297-E3A79C756CA6">第2阶段：Oracle数据库确定提交点站点</a><br>一个例子说明了分布式事务处理的第二个阶段。
                     </li>
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-2B94119F-66C7-4441-8D4B-32265E0F8B64">第3阶段：全球协调员发送准备响应</a><br>一个例子说明了分布式事务处理的第三个阶段。
                     </li>
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-9B71148F-3E08-4C0F-9EA5-DD9CCCE044A0">第4阶段：提交点网站提交</a><br>一个例子说明了分布式事务处理的第四个阶段。
                     </li>
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-086BF245-5E2D-4612-8109-9E2206CA4234">第5阶段：提交点站点通知全局协调员</a><br>一个例子说明了分布式事务处理的第五个阶段。
                     </li>
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-A857F477-5FF1-4CEE-A3D8-1AE4088104FB">第6阶段：全球和本地协调员告诉所有节点提交</a><br>一个例子说明了分布式事务处理的第六个阶段。
                     </li>
                     <li class="ulchildlink"><a href="distributed-transactions-concepts.html#GUID-6C7CD670-9137-4430-AE9C-772EDF773BC6">第7阶段：全球协调员和提交点站点完成提交</a><br>一个例子说明了分布式事务处理的第七个阶段。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-C1B373BA-410E-4F38-8522-F72A74665919" title="分布式事务在分布式数据库的两个或多个不同节点上更新数据。">分布式事务概念</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADMIN12239"></a><div class="props_rev_3"><a id="GUID-EC814CDE-5481-4FA7-A9F4-2FCFDD3535AA" name="GUID-EC814CDE-5481-4FA7-A9F4-2FCFDD3535AA"></a><h4 id="ADMIN-GUID-EC814CDE-5481-4FA7-A9F4-2FCFDD3535AA" class="sect4"><span class="enumeration_section">34.5.1</span>关于分布式事务处理案例研究</h4>
                  <div>
                     <p>在此方案中，公司具有单独的Oracle数据库服务器<code class="codeph">sales.example.com</code>和<code class="codeph">warehouse.example.com</code> 。当用户将销售记录插入<code class="codeph">sales</code>数据库时，相关记录将在<code class="codeph">warehouse</code>数据库中更新。
                     </p>
                     <p>这个分布式处理案例研究说明：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>会话树的定义</p>
                        </li>
                        <li>
                           <p>如何确定提交点站点</p>
                        </li>
                        <li>
                           <p>准备消息时发送</p>
                        </li>
                        <li>
                           <p>当事务实际提交时</p>
                        </li>
                        <li>
                           <p>本地存储有关交易的信息</p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-7C9FDBB8-171D-422C-A944-A9CE2CB6B2AF" title="案例研究说明了分布式事务处理。">分布式事务处理：案例研究</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN13149"></a><a id="ADMIN12240"></a><div class="props_rev_3"><a id="GUID-4EBA12EC-6B82-444D-B933-EF321B0846F0" name="GUID-4EBA12EC-6B82-444D-B933-EF321B0846F0"></a><h4 id="ADMIN-GUID-4EBA12EC-6B82-444D-B933-EF321B0846F0" class="sect4"><span class="enumeration_section">34.5.2</span>第1阶段：客户端应用程序发布DML语句</h4>
                  <div>
                     <p>一个例子说明了分布式事务处理的第一个阶段。</p>
                     <p>在销售部门，销售人员使用SQL * Plus输入销售订单，然后提交。应用程序发出多个SQL语句以将订单输入<code class="codeph">sales</code>数据库并更新<code class="codeph">warehouse</code>数据库中的<code class="codeph">warehouse</code> ：</p><pre class="oac_no_warn" dir="ltr">CONNECT scott@sales.example.com ...;插入订单......;更新inventory@warehouse.example.com ...;插入订单......;更新inventory@warehouse.example.com ...;承诺;</pre><p>这些SQL语句是单个分布式事务的一部分，保证所有已发布的SQL语句作为一个单元成功或失败。将报表作为一个单元处理可防止下订单的可能性，然后不更新库存以反映订单。实际上，事务保证了全局数据库中数据的一致性。</p>
                     <p>当事务中的每个SQL语句执行时，会定义会话树， <a href="distributed-transactions-concepts.html#GUID-4EBA12EC-6B82-444D-B933-EF321B0846F0__CHDJICHD">如图34-7</a>所示。
                     </p>
                     <div class="figure" id="GUID-4EBA12EC-6B82-444D-B933-EF321B0846F0__CHDJICHD">
                        <p class="titleinfigure">图34-7定义会话树</p><img src="img/admin033.png" width="584" alt="下面是图34-7的描述" title="下面是图34-7的描述" longdesc="img_text/admin033.html"><br><a href="img_text/admin033.html">“图34-7定义会话树”的描述</a></div>
                     <!-- class="figure" -->
                     <p>请注意以下事项：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>在<code class="codeph">sales</code>数据库上运行的订单输入应用程序启动该事务。因此， <code class="codeph">sales.example.com</code>是分布式事务的全局协调器。
                           </p>
                        </li>
                        <li>
                           <p>订单输入应用程序将新的销售记录插入<code class="codeph">sales</code>数据库并更新仓库中的库存。因此，节点<code class="codeph">sales.example.com</code>和<code class="codeph">warehouse.example.com</code>都是数据库服务器。
                           </p>
                        </li>
                        <li>
                           <p>由于<code class="codeph">sales.example.com</code>更新了库存，因此它是<code class="codeph">warehouse.example.com</code>的客户端。
                           </p>
                        </li>
                     </ul>
                     <p>此阶段完成此分布式事务的会话树定义。树中的每个节点都已获取必要的数据锁，以执行引用本地数据的SQL语句。在执行SQL语句之后，这些锁仍然存在，直到两阶段提交完成。</p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-7C9FDBB8-171D-422C-A944-A9CE2CB6B2AF" title="案例研究说明了分布式事务处理。">分布式事务处理：案例研究</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN13150"></a><a id="ADMIN12241"></a><div class="props_rev_3"><a id="GUID-8041782B-495C-4D10-8297-E3A79C756CA6" name="GUID-8041782B-495C-4D10-8297-E3A79C756CA6"></a><h4 id="ADMIN-GUID-8041782B-495C-4D10-8297-E3A79C756CA6" class="sect4"><span class="enumeration_section">34.5.3</span>第2阶段：Oracle数据库确定提交点站点</h4>
                  <div>
                     <p>一个例子说明了分布式事务处理的第二个阶段。</p>
                     <p>数据库确定紧跟<code class="codeph">COMMIT</code>语句后的提交点站点。 <code class="codeph">sales.example.com</code> （全局协调器）被确定为提交点站点， <a href="distributed-transactions-concepts.html#GUID-8041782B-495C-4D10-8297-E3A79C756CA6__i1008181">如图34-8</a>所示。
                     </p>
                     <div class="infoboxnotealso" id="GUID-8041782B-495C-4D10-8297-E3A79C756CA6__GUID-BF0CE623-A2A3-4333-B5C1-AF21741174E1">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="distributed-transactions-concepts.html#GUID-A3DA5714-5DAC-4D8C-AEDF-0D6050D74035" title="必须为每个数据库服务器分配一个提交点强度。如果在分布式事务中引用数据库服务器，则其提交点强度的值将确定它在两阶段提交中扮演的角色。">提交点强度</a> ”</span> ，以获取有关如何确定提交点站点的更多信息</p>
                     </div>
                     <div class="figure" id="GUID-8041782B-495C-4D10-8297-E3A79C756CA6__i1008181">
                        <p class="titleinfigure">图34-8确定提交点站点</p><img src="img/admin034.png" width="441" alt="下面是图34-8的描述" title="下面是图34-8的描述" longdesc="img_text/admin034.html"><br><a href="img_text/admin034.html">“图34-8确定提交点站点”的说明</a></div>
                     <!-- class="figure" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-7C9FDBB8-171D-422C-A944-A9CE2CB6B2AF" title="案例研究说明了分布式事务处理。">分布式事务处理：案例研究</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN13151"></a><a id="ADMIN12242"></a><div class="props_rev_3"><a id="GUID-2B94119F-66C7-4441-8D4B-32265E0F8B64" name="GUID-2B94119F-66C7-4441-8D4B-32265E0F8B64"></a><h4 id="ADMIN-GUID-2B94119F-66C7-4441-8D4B-32265E0F8B64" class="sect4"><span class="enumeration_section">34.5.4</span>第3阶段：全球协调员发送准备响应</h4>
                  <div>
                     <p>一个例子说明了分布式事务处理的第三个阶段。</p>
                     <p>准备阶段包括以下步骤：</p>
                     <ol>
                        <li>
                           <p>在数据库确定提交点站点之后，全局协调器将准备消息发送到会话树的所有直接引用的节点， <span class="italic">不包括</span>提交点站点。在此示例中， <code class="codeph">warehouse.example.com</code>是唯一要求准备的节点。
                           </p>
                        </li>
                        <li>
                           <p>节点<code class="codeph">warehouse.example.com</code>尝试准备。如果节点可以保证它可以提交事务的本地相关部分并且可以在其本地重做日志中记录提交信息，则节点可以成功准备。在此示例中，只有<code class="codeph">warehouse.example.com</code>接收准备消息，因为<code class="codeph">sales.example.com</code>是提交点站点。
                           </p>
                        </li>
                        <li>
                           <p>Node <code class="codeph">warehouse.example.com</code>使用准备好的消息响应<code class="codeph">sales.example.com</code> 。
                           </p>
                        </li>
                     </ol>
                     <p>在每个节点准备时，它会将消息发送回要求其准备的节点。根据响应，可能会发生以下情况之一：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>如果要求准备的<span class="italic">任何</span>节点用中止消息响应全局协调器，则全局协调器告知所有节点回滚事务，并且操作完成。
                           </p>
                        </li>
                        <li>
                           <p>如果要求<span class="italic">所有</span>节点准备响应准备好的或只读消息给全局协调器，即它们已成功准备，则全局协调器要求提交点站点提交事务。
                           </p>
                        </li>
                     </ul>
                     <div class="figure" id="GUID-2B94119F-66C7-4441-8D4B-32265E0F8B64__GUID-FE73F862-33F9-4072-94EA-58A4C646B750">
                        <p class="titleinfigure">图34-9发送和确认准备消息</p><img src="img/admin035.png" width="441" alt="下面是图34-9的描述" title="下面是图34-9的描述" longdesc="img_text/admin035.html"><br><a href="img_text/admin035.html">“图34-9发送和确认准备消息”的描述</a></div>
                     <!-- class="figure" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-7C9FDBB8-171D-422C-A944-A9CE2CB6B2AF" title="案例研究说明了分布式事务处理。">分布式事务处理：案例研究</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN12243"></a><div class="props_rev_3"><a id="GUID-9B71148F-3E08-4C0F-9EA5-DD9CCCE044A0" name="GUID-9B71148F-3E08-4C0F-9EA5-DD9CCCE044A0"></a><h4 id="ADMIN-GUID-9B71148F-3E08-4C0F-9EA5-DD9CCCE044A0" class="sect4"><span class="enumeration_section">34.5.5</span>第4阶段：提交点网站提交</h4>
                  <div>
                     <p>一个例子说明了分布式事务处理的第四个阶段。</p>
                     <p>提交点站点提交事务涉及以下步骤：</p>
                     <ol>
                        <li>
                           <p>接收确认<code class="codeph">warehouse.example.com</code>准备的节点<code class="codeph">sales.example.com</code>指示提交点站点提交事务。
                           </p>
                        </li>
                        <li>
                           <p>提交点站点现在在本地提交事务，并将此事实记录在其本地重做日志中。</p>
                        </li>
                     </ol>
                     <p>即使<code class="codeph">warehouse.example.com</code>尚未提交，此交易的结果也是预先确定的。换句话说，即使给定节点提交的能力被延迟，事务<span class="italic">也</span>将在所有节点上提交。
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-7C9FDBB8-171D-422C-A944-A9CE2CB6B2AF" title="案例研究说明了分布式事务处理。">分布式事务处理：案例研究</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN12244"></a><div class="props_rev_3"><a id="GUID-086BF245-5E2D-4612-8109-9E2206CA4234" name="GUID-086BF245-5E2D-4612-8109-9E2206CA4234"></a><h4 id="ADMIN-GUID-086BF245-5E2D-4612-8109-9E2206CA4234" class="sect4"><span class="enumeration_section">34.5.6</span>第5阶段：提交点站点通知全球协调员</h4>
                  <div>
                     <p>一个例子说明了分布式事务处理的第五个阶段。</p>
                     <p>此阶段包括以下步骤：</p>
                     <ol>
                        <li>
                           <p>提交点站点告诉全局协调器该事务已提交。由于提交点站点和全局协调器在此示例中是相同的节点，因此不需要任何操作。提交点站点知道事务已提交，因为它在其在线日志中记录了此事实。</p>
                        </li>
                        <li>
                           <p>全局协调器确认事务已在分布式事务中涉及的所有其他节点上提交。</p>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-7C9FDBB8-171D-422C-A944-A9CE2CB6B2AF" title="案例研究说明了分布式事务处理。">分布式事务处理：案例研究</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN13152"></a><a id="ADMIN12245"></a><div class="props_rev_3"><a id="GUID-A857F477-5FF1-4CEE-A3D8-1AE4088104FB" name="GUID-A857F477-5FF1-4CEE-A3D8-1AE4088104FB"></a><h4 id="ADMIN-GUID-A857F477-5FF1-4CEE-A3D8-1AE4088104FB" class="sect4"><span class="enumeration_section">34.5.7</span>第6阶段：全球和本地协调员将所有节点告知提交</h4>
                  <div>
                     <p>一个例子说明了分布式事务处理的第六个阶段。</p>
                     <p>事务中所有节点提交事务涉及以下步骤：</p>
                     <ol>
                        <li>
                           <p>在提交点站点通知全局协调器提交后，它会告知所有其他直接引用的节点。</p>
                        </li>
                        <li>
                           <p>反过来，任何本地协调员都会指示他们的服务器提交，等等。</p>
                        </li>
                        <li>
                           <p>每个节点（包括全局协调器）都提交事务并在本地记录适当的重做日志条目。当每个节点提交时，将释放为该事务本地保存的资源锁。</p>
                        </li>
                     </ol>
                     <p>在<a href="distributed-transactions-concepts.html#GUID-A857F477-5FF1-4CEE-A3D8-1AE4088104FB__i1008221">图34-10中</a> ， <code class="codeph">sales.example.com</code> （它是提交点站点和全局协调器）已在本地提交了事务。 <code class="codeph">sales</code>现在指示<code class="codeph">warehouse.example.com</code>提交事务。
                     </p>
                     <div class="figure" id="GUID-A857F477-5FF1-4CEE-A3D8-1AE4088104FB__i1008221">
                        <p class="titleinfigure">图34-10指示要提交的节点</p><img src="img/admin036.png" width="439" alt="下面是图34-10的描述" title="下面是图34-10的描述" longdesc="img_text/admin036.html"><br><a href="img_text/admin036.html">“图34-10指示节点提交”的说明</a></div>
                     <!-- class="figure" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-7C9FDBB8-171D-422C-A944-A9CE2CB6B2AF" title="案例研究说明了分布式事务处理。">分布式事务处理：案例研究</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADMIN12246"></a><div class="props_rev_3"><a id="GUID-6C7CD670-9137-4430-AE9C-772EDF773BC6" name="GUID-6C7CD670-9137-4430-AE9C-772EDF773BC6"></a><h4 id="ADMIN-GUID-6C7CD670-9137-4430-AE9C-772EDF773BC6" class="sect4"><span class="enumeration_section">34.5.8</span>第7阶段：全球协调员和提交点站点完成提交</h4>
                  <div>
                     <p>一个例子说明了分布式事务处理的第七个阶段。</p>
                     <p>完成提交事务的过程如下：</p>
                     <ol>
                        <li>
                           <p>在所有引用的节点和全局协调器都已提交事务之后，全局协调器会向提交点站点通知此事实。</p>
                        </li>
                        <li>
                           <p>已等待此消息的提交点站点将擦除有关此分布式事务的状态信息。</p>
                        </li>
                        <li>
                           <p>提交点站点通知全局协调器它已完成。换句话说，提交点站点忘记了提交分布式事务。此操作是允许的，因为两阶段提交中涉及的所有节点都已成功提交事务，因此他们将来不必确定其状态。</p>
                        </li>
                        <li>
                           <p>全局协调员通过忘记事务本身来完成事务。</p>
                        </li>
                     </ol>
                     <p>在<code class="codeph">COMMIT</code>阶段完成之后，分布式事务本身就完成了。所描述的步骤是在几分之一秒内自动完成的。
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="distributed-transactions-concepts.html#GUID-7C9FDBB8-171D-422C-A944-A9CE2CB6B2AF" title="案例研究说明了分布式事务处理。">分布式事务处理：案例研究</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>