<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>使用区域地图</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Data Warehousing Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Data Warehousing Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-data-warehousing-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T00:20:13-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2001, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96243-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="attribute-clustering.html" title="Previous" type="text/html"></link>
      <link rel="next" href="part-etl.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Data Warehousing Guide"></meta>
    <meta name="dcterms.isVersionOf" content="DWHSG"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="attribute-clustering.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="part-etl.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据仓库指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-optimizing-dw.html" property="item" typeof="WebPage"><span property="name">优化数据仓库</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用区域地图</li>
            </ol>
            <a id="GUID-BEA5ACA1-6718-4948-AB38-1F2C0335FDE4" name="GUID-BEA5ACA1-6718-4948-AB38-1F2C0335FDE4"></a>
            
            <h2 id="DWHSG-GUID-BEA5ACA1-6718-4948-AB38-1F2C0335FDE4" class="sect2"><span class="enumeration_chapter">14</span>使用区域地图</h2>
         </header>
         <div class="ind">
            <div>
               <p>区域映射是可以为表构建的独立访问结构。在表和索引扫描期间，区域映射使您能够根据表列上的谓词修剪表的磁盘块以及分区表的可能完整分区。区域地图可以使用或不使用属性聚类。</p>
               <p>本章包括以下部分：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="using-zone-maps.html#GUID-7E5C3F5A-C1F5-4A5E-A501-DB50B8948263">关于Zone Maps</a></p>
                  </li>
                  <li>
                     <p><a href="using-zone-maps.html#GUID-BD689807-825D-47F2-81AB-9FD32A3E39C0">区域地图操作</a></p>
                  </li>
                  <li>
                     <p><a href="using-zone-maps.html#GUID-EEE26E3B-38B7-47DD-9892-818CB8432158" title="当区域映射所基于的表中的数据发生更改时，与更改的行对应的区域将标记为陈旧。您需要刷新区域图以使区域成为当前区域。">区域地图的刷新和陈旧</a></p>
                  </li>
                  <li>
                     <p><a href="using-zone-maps.html#GUID-1E6AF386-E601-4382-B84D-B811DA142E0F">使用区域映射执行修剪</a></p>
                  </li>
                  <li>
                     <p><a href="using-zone-maps.html#GUID-DA1762AC-4F66-4DDA-A28A-8A754FB6E75E">查看区域地图信息</a></p>
                  </li>
               </ul>
            </div><a id="DWHSG8935"></a><div class="props_rev_3"><a id="GUID-7E5C3F5A-C1F5-4A5E-A501-DB50B8948263" name="GUID-7E5C3F5A-C1F5-4A5E-A501-DB50B8948263"></a><h3 id="DWHSG-GUID-7E5C3F5A-C1F5-4A5E-A501-DB50B8948263" class="sect3"><span class="enumeration_section">14.1</span>关于区域地图</h3>
               <div>
                  <p><span class="bold">区域</span> <span class="bold">地图</span>是<a id="d56099e78" class="indexterm-anchor"></a>为表创建的独立访问结构，用于存储有关表区域的信息。区域映射使数据库能够修剪无法满足表列谓词的数据块。<span class="bold">区域</span>是一组<a id="d56099e86" class="indexterm-anchor"></a>磁盘上的连续数据块。
                  </p>
                  <p>传统区域映射存储每个磁盘单元，块组或范围的表中列的最小值和最大值。如果查询符合群集列的要求，则会进行I / O修剪。Oracle数据库中的区域映射存储一系列块（称为区域）的列的最小值和最大值。除了基于聚类事实表的谓词执行I / O修剪之外，区域映射修剪维度表的谓词，前提是事实表通过外部联接与维度表的维度属性进行属性聚类。</p>
                  <p>您最多可以在表上定义一个区域映射。对于分区表，所有分区（和子分区）都有一个区域映射。分区表的区域映射还跟踪每个区域，每个分区和每个子分区的最小值和最大值。区域映射定义可以包括维列的最小值和最大值，前提是表具有与维表的外连接。</p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="using-zone-maps.html#GUID-6E965132-485A-4A70-8DA3-18FCF6E5C4AA">区域地图和索引之间的区别</a></p>
                     </li>
                     <li>
                        <p><a href="using-zone-maps.html#GUID-6874226F-1DC1-4864-9695-5FBDF646F59D">区域映射和属性聚类</a></p>
                     </li>
                     <li>
                        <p><a href="using-zone-maps.html#GUID-17F2043C-BD41-400F-9FBE-BD14CE87980E">区域地图的类型</a></p>
                     </li>
                     <li>
                        <p><a href="using-zone-maps.html#GUID-E6E8BDF4-F3FA-49AF-B56C-BA1245CC8BB2">区域地图的好处</a></p>
                     </li>
                     <li>
                        <p><a href="using-zone-maps.html#GUID-14BE02F3-C78F-45FA-BD15-78FA554B7699">受益于区域地图的场景</a></p>
                     </li>
                     <li>
                        <p><a href="using-zone-maps.html#GUID-08DB84F2-8163-4E02-9D2E-8A10351335E4">关于维护区域地图</a></p>
                     </li>
                  </ul>
               </div><a id="DWHSG9356"></a><div class="props_rev_3"><a id="GUID-6E965132-485A-4A70-8DA3-18FCF6E5C4AA" name="GUID-6E965132-485A-4A70-8DA3-18FCF6E5C4AA"></a><h4 id="DWHSG-GUID-6E965132-485A-4A70-8DA3-18FCF6E5C4AA" class="sect4"><span class="enumeration_section">14.1.1</span>区域映射和索引之间的区别</h4>
                  <div>
                     <p>区域图类似于粗略索引结构。但是，指数存在根本差异：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>区域映射存储每个区域而不是每行的信息。因此，它比索引更紧凑。</p>
                        </li>
                        <li>
                           <p>区域映射不会像索引与DML操作同步一样进行主动管理。因此，即使区域映射具有<code class="codeph">REFRESH</code> <code class="codeph">ON</code> <code class="codeph">COMMIT</code>选项，它也可能在事务中失效，直到发生提交或回滚。
                           </p>
                        </li>
                        <li>
                           <p>区域映射可以包含某些区域的陈旧信息和其他区域的新信息，Oracle数据库仍将使用区域映射在事实表扫描期间执行I / O修剪。</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="DWHSG9357"></a><div class="props_rev_3"><a id="GUID-6874226F-1DC1-4864-9695-5FBDF646F59D" name="GUID-6874226F-1DC1-4864-9695-5FBDF646F59D"></a><h4 id="DWHSG-GUID-6874226F-1DC1-4864-9695-5FBDF646F59D" class="sect4"><span class="enumeration_section">14.1.2</span>区域映射和属性聚类</h4>
                  <div>
                     <p>属性聚类不是区域映射的强制性预先要求。区域地图可以使用或不使用属性聚类。因此，您可以在没有区域映射的情况下指定属性聚类，并在表中不构建聚类的情况下构建区域映射。</p>
                     <p>由于ETL处理，数据仓库环境通常具有合理的群集数据，例如，按时间列或按地理区域进行群集。由于聚类，列的最小值和最大值更可能与属性聚类表中的连续数据块相关，这允许使用区域映射进行更有效的修剪。通过利用属性聚类执行的数据排序，区域映射可以实现更有效的修剪。在表扫描和索引扫描期间（例如，通过rowid获取），区域映射允许修剪不满足表列上的谓词的数据块。</p>
                     <div class="infoboxnotealso" id="GUID-6874226F-1DC1-4864-9695-5FBDF646F59D__GUID-F3BBC05F-991F-4E35-8631-6065A4636C76">
                        <p class="notep1">也可以看看：</p>
                        <p>有关属性聚类的信息，请参阅<span class="q">“ <a href="attribute-clustering.html#GUID-08788616-8D61-4550-9871-301503557E60">关于属性聚类</a> ”</span></p>
                     </div>
                  </div>
               </div><a id="DWHSG9358"></a><div class="props_rev_3"><a id="GUID-17F2043C-BD41-400F-9FBE-BD14CE87980E" name="GUID-17F2043C-BD41-400F-9FBE-BD14CE87980E"></a><h4 id="DWHSG-GUID-17F2043C-BD41-400F-9FBE-BD14CE87980E" class="sect4"><span class="enumeration_section">14.1.3</span>区域图的类型</h4>
                  <div>
                     <p>那里有两个<a id="d56099e227" class="indexterm-anchor"></a><a id="d56099e231" class="indexterm-anchor"></a>区域地图的类型：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>基本区域映射在单个表上定义，并维护此表的某些列的最小值和最大值。</p>
                        </li>
                        <li>
                           <p>在具有到一个或多个其他表的外部联接的表上定义联接区域映射，并维护其他表中某些列的最小值和最大值。这些连接条件在主 - 细节关系以及事实和维度表之间的星型模式中很常见。</p>
                           <p>对于星型查询，多个维度表通过PK-FK关系与事实表连接。此处，连接区域映射维护事实表的区域的维度表中的列的最小值和最大值。</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="DWHSG9359"></a><div class="props_rev_3"><a id="GUID-E6E8BDF4-F3FA-49AF-B56C-BA1245CC8BB2" name="GUID-E6E8BDF4-F3FA-49AF-B56C-BA1245CC8BB2"></a><h4 id="DWHSG-GUID-E6E8BDF4-F3FA-49AF-B56C-BA1245CC8BB2" class="sect4"><span class="enumeration_section">14.1.4</span>区域地图的好处</h4>
                  <div>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>在表或表分区的顺序扫描或索引扫描期间启用I / O减少</p>
                        </li>
                        <li>
                           <p>区域映射列与分区键相关时，为分区和复合分区表启用基于非键列的分区修剪</p>
                        </li>
                        <li>
                           <p>通过交叉排序，在聚类列的子集上启用I / O减少，以进行属性聚类</p>
                        </li>
                        <li>
                           <p>消除与使用索引相关的存储成本</p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-E6E8BDF4-F3FA-49AF-B56C-BA1245CC8BB2__GUID-2EE3EA3F-AF00-42C1-B48A-D3E2A08E1D6A">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../sqlrf/CREATE-MATERIALIZED-ZONEMAP.html#SQLRF56947" target="_blank"><span class="italic">Oracle数据库SQL语言参考</span></a></p>
                     </div>
                  </div>
               </div><a id="DWHSG9360"></a><div class="props_rev_3"><a id="GUID-14BE02F3-C78F-45FA-BD15-78FA554B7699" name="GUID-14BE02F3-C78F-45FA-BD15-78FA554B7699"></a><h4 id="DWHSG-GUID-14BE02F3-C78F-45FA-BD15-78FA554B7699" class="sect4"><span class="enumeration_section">14.1.5</span>从区域地图中获益的场景</h4>
                  <div>
                     <p>运用<a id="d56099e312" class="indexterm-anchor"></a>区域映射在以下场景中可能是有益的：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>使用常用谓词执行表扫描</p>
                           <p>区域映射使Oracle数据库能够避免扫描列谓词排除的区域。</p>
                        </li>
                        <li>
                           <p>连接在事实表和维度表之间定义，在维度层次结构列上使用常用谓词</p>
                           <p>事实表行可以按维度属性值排序，修剪区域由属性值的谓词排除。</p>
                        </li>
                        <li>
                           <p>分区表中的列包含与分区键相关的值</p>
                           <p>这将有助于基于“非键”列进行分区修剪。例如，按日期分区的表通常会有其他日期列与分区键或包含随时间变化或循环的序列值的列相关联。</p>
                        </li>
                        <li>
                           <p>对区域映射列值执行数据聚类</p>
                           <p>属性集群专门为此目的而设计。或者，使用数据中固有的排序（例如，顺序加载的基于时间的列值或加载时排序的数据）是合适的。</p>
                        </li>
                        <li>
                           <p>在表上执行频繁和低基数索引范围扫描</p>
                           <p>可以单独使用属性聚类来改进压缩因子。区域映射可用于通过修剪排除区域中的查找来提高索引扫描的效率。或者，区域映射可用于替换索引。</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="DWHSG9361"></a><div class="props_rev_3"><a id="GUID-08DB84F2-8163-4E02-9D2E-8A10351335E4" name="GUID-08DB84F2-8163-4E02-9D2E-8A10351335E4"></a><h4 id="DWHSG-GUID-08DB84F2-8163-4E02-9D2E-8A10351335E4" class="sect4"><span class="enumeration_section">14.1.6</span>关于维护区域映射</h4>
                  <div>
                     <p>区域映射基于表，因此，对基础表的任何更改都会影响区域映射的状态。根据对表执行的操作，区域映射的部分或全部区域会受到影响。受基础表更改影响的区域映射需要维护。</p>
                     <p>区域地图维护包含一个或多个任务：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>检查受影响的区域地图的有效性</p>
                        </li>
                        <li>
                           <p>跟踪受影响区域地图的陈旧性</p>
                        </li>
                        <li>
                           <p>刷新已变为陈旧的受影响区域映射（取决于为区域映射设置的刷新模式）</p>
                        </li>
                     </ul>
                     <p>当区域映射所基于的基表结构发生更改时，例如，删除由区域映射维护其最小值和最大值的表列，则区域映射将变为<span class="bold">无效</span> 。查询不使用无效的区域映射，Oracle数据库不维护这些区域映射。但是，如果基表的结构发生了与区域映射无关的更改（例如，向表中添加新列），则区域映射将保持有效，但需要进行编译。Oracle数据库会在后续操作中自动编译区域映射，例如通过查询使用区域映射。或者，您可以使用<code class="codeph">ALTER MATERIALIZED ZONEMAP</code>命令的<code class="codeph">COMPILE</code>子句编译区域映射。
                     </p>
                     <div class="infoboxnotealso" id="GUID-08DB84F2-8163-4E02-9D2E-8A10351335E4__GUID-0F56EFD6-3860-49DB-B8C2-3C9FE59EC1D6">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="using-zone-maps.html#GUID-1D2BB7B1-440D-403C-BD24-AFAA39789568">编译区域地图</a> ”</span></p>
                     </div>
                     <p>当基础表的数据发生更改时，受这些更改影响的区域将标记为<span class="bold">过时</span> 。只有陈旧区域映射中的数据不是最新的或新鲜的，但其定义仍然有效。由于基础表上的不同类型的操作，Oracle数据库会自动跟踪区域映射的过时性。根据在基础表上执行的操作类型，Oracle数据库会将整个区域映射标记为陈旧，或者区域映射中的某些区域标记为陈旧。
                     </p>
                     <p>本节包含以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="using-zone-maps.html#GUID-03B84C4C-BA4A-4C5C-8F92-AD4A56AD617A">需要区域地图维护的操作</a></p>
                        </li>
                        <li>
                           <p><a href="using-zone-maps.html#GUID-586FD01D-2F00-4185-BCF9-424E19B8E8E9">区域地图自动刷新的场景</a></p>
                        </li>
                     </ul>
                  </div><a id="DWHSG9362"></a><div class="props_rev_3"><a id="GUID-03B84C4C-BA4A-4C5C-8F92-AD4A56AD617A" name="GUID-03B84C4C-BA4A-4C5C-8F92-AD4A56AD617A"></a><h5 id="DWHSG-GUID-03B84C4C-BA4A-4C5C-8F92-AD4A56AD617A" class="sect5"><span class="enumeration_section">14.1.6.1</span>需要区域地图维护的操作</h5>
                     <div>
                        <p>在一个或多个基础表上执行以下操作时，需要区域映射维护：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>DML（插入，删除，更新，常规加载）。</p>
                           </li>
                           <li>
                              <p>直接路径插入和加载。</p>
                           </li>
                           <li>
                              <p>分区维护操作（ <code class="codeph">MOVE</code> ， <code class="codeph">SPLIT</code> ， <code class="codeph">MERGE</code> ， <code class="codeph">DROP</code> ， <code class="codeph">TRUNCATE</code>和<code class="codeph">EXCHANGE</code> ），移动表数据和表的在线重新定义。
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="DWHSG9363"></a><div class="props_rev_3"><a id="GUID-586FD01D-2F00-4185-BCF9-424E19B8E8E9" name="GUID-586FD01D-2F00-4185-BCF9-424E19B8E8E9"></a><h5 id="DWHSG-GUID-586FD01D-2F00-4185-BCF9-424E19B8E8E9" class="sect5"><span class="enumeration_section">14.1.6.2</span>自动刷新区域映射的场景</h5>
                     <div>
                        <p>区域映射刷新模式确定Oracle数据库是否将自动刷新受上述操作影响的区域映射。</p>
                        <p>Oracle数据库对受以下内容影响的区域映射执行自动刷新：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>如果刷新模式为<code class="codeph">REFRESH ON COMMIT</code>则为DML操作。具有<code class="codeph">REFRESH ON COMMIT</code>模式的区域映射在事务上保持新鲜。提交事务时执行刷新。
                              </p>
                           </li>
                           <li>
                              <p>如果刷新模式为<code class="codeph">REFRESH ON LOAD</code>则直接路径插入或加载。</p>
                              <p>在基础表上执行DML或PMOP操作后，带有<code class="codeph">REFRESH ON LOAD</code>区域映射可能会过时。
                              </p>
                           </li>
                           <li>
                              <p>如果刷新模式为<code class="codeph">REFRESH ON DATA MOVEMENT</code> ，则PMOP（ <code class="codeph">MOVE</code> ， <code class="codeph">SPLIT</code> ， <code class="codeph">MERGE</code> ， <code class="codeph">DROP</code> ）或表移动。</p>
                              <p>在DML，直接路径插入或加载，PMOP（ <code class="codeph">TRUNCATE</code> ， <code class="codeph">EXCHANGE</code> ）或基础表的在线重新定义之后，具有<code class="codeph">REFRESH ON DATA MOVEMENT</code>区域映射可能会变得陈旧</p>
                           </li>
                           <li>
                              <p>如果刷新模式为<code class="codeph">REFRESH ON LOAD DATA MOVEMENT</code> ，则直接路径插入或加载，PMOP（ <code class="codeph">MOVE</code> ， <code class="codeph">SPLIT</code> ， <code class="codeph">MERGE</code> ， <code class="codeph">DROP</code> ）或表移动。</p>
                              <p>在DML，PMOP（ <code class="codeph">TRUNCATE</code> ， <code class="codeph">EXCHANGE</code> ）或基础表的在线重新定义之后，带有<code class="codeph">REFRESH ON LOAD DATA MOVEMENT</code>区域映射可能会变得陈旧。
                              </p>
                           </li>
                        </ul>
                        <p>如果刷新模式为<code class="codeph">REFRESH ON DEMAND</code> Oracle数据库不会自动刷新受基础表上任何操作影响的区域映射。必须手动刷新<code class="codeph">REFRESH ON DEMAND</code>区域地图</p>
                        <div class="infoboxnotealso" id="GUID-586FD01D-2F00-4185-BCF9-424E19B8E8E9__GUID-FC9E03E2-1DB1-4B82-8950-8FC1738F08F5">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="using-zone-maps.html#GUID-EEE26E3B-38B7-47DD-9892-818CB8432158" title="当区域映射所基于的表中的数据发生更改时，与更改的行对应的区域将标记为陈旧。您需要刷新区域图以使区域成为当前区域。">区域地图的刷新和陈旧</a> ”</span></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="using-zone-maps.html#GUID-904D917B-DA6D-45AB-96F6-7FBF567D19FE">维护区域地图</a> ”</span></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div>
            </div><a id="DWHSG8938"></a><div class="props_rev_3"><a id="GUID-BD689807-825D-47F2-81AB-9FD32A3E39C0" name="GUID-BD689807-825D-47F2-81AB-9FD32A3E39C0"></a><h3 id="DWHSG-GUID-BD689807-825D-47F2-81AB-9FD32A3E39C0" class="sect3"><span class="enumeration_section">14.2</span>区域地图操作</h3>
               <div>
                  <p>本节介绍涉及区域映射的常见任务，包括：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="using-zone-maps.html#GUID-2942249C-B601-4AF1-8D3E-19B50548A32A">区域映射所需的权限</a></p>
                     </li>
                     <li>
                        <p><a href="using-zone-maps.html#GUID-4FDF378C-B8CC-4C12-A545-237B42F084BA">创建区域地图</a></p>
                     </li>
                     <li>
                        <p><a href="using-zone-maps.html#GUID-70722C5D-2785-4934-9EA6-93114EF9ED0A">修改区域地图</a></p>
                     </li>
                     <li>
                        <p><a href="using-zone-maps.html#GUID-6560A78B-D132-4555-8619-CCDC2C9FCF38">删除区域地图</a></p>
                     </li>
                     <li>
                        <p><a href="using-zone-maps.html#GUID-1D2BB7B1-440D-403C-BD24-AFAA39789568">编译区域地图</a></p>
                     </li>
                     <li>
                        <p><a href="using-zone-maps.html#GUID-8266B0F1-29B0-418C-90F5-09B0AAA87F8F">控制区域地图的使用</a></p>
                     </li>
                     <li>
                        <p><a href="using-zone-maps.html#GUID-904D917B-DA6D-45AB-96F6-7FBF567D19FE">维护区域地图</a></p>
                     </li>
                  </ul>
               </div><a id="DWHSG9364"></a><div class="props_rev_3"><a id="GUID-2942249C-B601-4AF1-8D3E-19B50548A32A" name="GUID-2942249C-B601-4AF1-8D3E-19B50548A32A"></a><h4 id="DWHSG-GUID-2942249C-B601-4AF1-8D3E-19B50548A32A" class="sect4"><span class="enumeration_section">14.2.1</span>区域映射所需的权限</h4>
                  <div>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>要在自己的架构中创建，更改或删除区域映射，您必须具有<code class="codeph">CREATE MATERIALIZED ZONEMAP</code>特权</p>
                        </li>
                        <li>
                           <p>要在其他模式中创建区域映射，您必须具有<code class="codeph">CREATE</code> <code class="codeph">ANY</code> <code class="codeph">MATERIALIZED</code> <code class="codeph">ZONEMAP</code>特权。
                           </p>
                        </li>
                        <li>
                           <p>要在您自己的模式中创建区域映射，但在其他模式的表上创建区域映射，您必须具有<code class="codeph">SELECT</code> <code class="codeph">ANY</code> <code class="codeph">TABLE</code>或<code class="codeph">READ ANY TABLE</code>特权。
                           </p>
                        </li>
                        <li>
                           <p>要使用其他模式中的表在其他模式中创建区域映射，您必须同时具有<code class="codeph">SELECT</code> <code class="codeph">ANY</code> <code class="codeph">TABLE</code>和<code class="codeph">CREATE</code> <code class="codeph">ANY</code> <code class="codeph">MATERIALIZED</code> <code class="codeph">ZONEMAP</code>特权。您可以拥有<code class="codeph">READ ANY TABLE</code>权限，而不是<code class="codeph">SELECT ANY TABLE</code>权限。
                           </p>
                        </li>
                        <li>
                           <p>要更改其他模式中的区域映射，您必须具有<code class="codeph">ALTER ANY MATERIALIZED ZONEMAP</code>权限。
                           </p>
                        </li>
                        <li>
                           <p>要删除其他模式中的区域映射，您必须具有<code class="codeph">DROP ANY MATERIALIZED ZONEMAP</code>特权。
                           </p>
                        </li>
                     </ul>
                  </div>
               </div><a id="DWHSG8939"></a><div class="props_rev_3"><a id="GUID-4FDF378C-B8CC-4C12-A545-237B42F084BA" name="GUID-4FDF378C-B8CC-4C12-A545-237B42F084BA"></a><h4 id="DWHSG-GUID-4FDF378C-B8CC-4C12-A545-237B42F084BA" class="sect4"><span class="enumeration_section">14.2.2</span>创建区域图</h4>
                  <div>
                     <div class="section">
                        <p>虽然可以在表上创建区域映射以及属性聚类，但区域映射与属性聚类无关。无论属性聚类如何，都可以独立创建区域地图。</p>
                        <p>区域映射使用的存储结构是在定义它们的表的缺省表空间中创建的。</p>
                        <div class="infoboxnotealso" id="GUID-4FDF378C-B8CC-4C12-A545-237B42F084BA__GUID-DE56A852-C005-4835-88A6-0B6B47F4AAB3">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>用于区域映射创建语法的<a href="../sqlrf/CREATE-MATERIALIZED-ZONEMAP.html#SQLRF56867" target="_blank"><span class="italic">Oracle数据库SQL语言参考</span></a></p>
                              </li>
                              <li>
                                 <p>有关区域映射限制的信息，请<a href="../sqlrf/CREATE-MATERIALIZED-ZONEMAP.html#SQLRF56947" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                              </li>
                           </ul>
                        </div>
                        <p>本节包含以下主题：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="using-zone-maps.html#GUID-655206D5-CD38-4CE3-AD20-DC984BB7CE26">使用属性聚类创建区域映射</a></p>
                           </li>
                           <li>
                              <p><a href="using-zone-maps.html#GUID-C3A55971-2E72-4B5E-A5B4-27104DF05C0A">创建区域映射独立于属性聚类</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div><a id="DWHSG9365"></a><div class="props_rev_3"><a id="GUID-655206D5-CD38-4CE3-AD20-DC984BB7CE26" name="GUID-655206D5-CD38-4CE3-AD20-DC984BB7CE26"></a><h5 id="DWHSG-GUID-655206D5-CD38-4CE3-AD20-DC984BB7CE26" class="sect5"><span class="enumeration_section">14.2.2.1</span>使用属性聚类创建区域映射</h5>
                     <div>
                        <div class="section">
                           <p>您可以使用<code class="codeph">WITH MATERIALIZED ZONEMAP</code>子条款创建区域映射。在为表定义属性集群时，或者在修改集群定义时，可以使用此子条款。
                           </p>
                           <p>使用以下任一主题中描述的步骤创建具有属性群集的区域映射：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="using-zone-maps.html#GUID-F33AC20C-D551-4A62-AE11-37C5764667D4">使用线性属性聚类创建基本区域图</a></p>
                              </li>
                              <li>
                                 <p><a href="using-zone-maps.html#GUID-A9972E60-FF25-42AF-ABB8-D8C12759ECF3">使用Interleaved Attribute Clustering创建连接区域映射</a></p>
                              </li>
                              <li>
                                 <p><a href="using-zone-maps.html#GUID-FCAB2956-727F-4C8A-BD47-AF51DAB14D95">在属性聚类后创建区域映射</a></p>
                              </li>
                           </ul>
                           <div class="infoboxnotealso" id="GUID-655206D5-CD38-4CE3-AD20-DC984BB7CE26__GUID-6B4C5EA7-CAF4-4DF3-B571-41E73870ED54">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="attribute-clustering.html#GUID-7B007A3C-53C2-4437-9E71-9ECECF8B4FAB">属性聚类，</a>用于获取有关属性聚类的信息</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div><a id="DWHSG9366"></a><div class="props_rev_3"><a id="GUID-F33AC20C-D551-4A62-AE11-37C5764667D4" name="GUID-F33AC20C-D551-4A62-AE11-37C5764667D4"></a><h6 id="DWHSG-GUID-F33AC20C-D551-4A62-AE11-37C5764667D4" class="sect6"><span class="enumeration_section">14.2.2.1.1</span>使用线性属性聚类创建基本区域图</h6>
                        <div>
                           <div class="section">
                              <p>假设销售查询通常指定客户ID或客户ID和产品ID的组合。您可以创建属性聚簇表，以便通过区域映射修剪查询。您创建一个表如下：</p><pre class="oac_no_warn" dir="ltr">CREATE TABLE销售（prod_id NUMBER NOT NULL，cust_id NUMBER NOT NULL，time_id DATE NOT NULL，channel_id NUMBER NOT NULL，promo_id NUMBER NOT NULL，quantity_sold NUMBER（10,2），amount_sold NUMBER（10,2））按线性顺序聚类（ cust_id，prod_id）YES ON LOAD YES数据运动带材料ZONEMAP;</pre><p><code class="codeph">ZMAP$_SALES</code>了列（ <code class="codeph">cust_id</code> ， <code class="codeph">prod_id</code> ）上的区域映射<code class="codeph">ZMAP$_SALES</code> 。这里， <code class="codeph">ZMAP$_SALES</code>是Oracle数据库为区域映射自动生成的名称。但是，您可以通过将其包含在<code class="codeph">WITH MATERIALIZED ZONEMAP</code>后面的括号中来指定区域映射的名称，如<span class="q">“ <a href="using-zone-maps.html#GUID-A9972E60-FF25-42AF-ABB8-D8C12759ECF3">使用Interleaved Attribute Clustering创建连接区域映射</a> ”中所述</span> 。
                              </p>
                              <p>对<code class="codeph">cust_id</code>和<code class="codeph">prod_id</code>或前缀<code class="codeph">cust_id</code>限定的查询将经历自然修剪。以下示例显示了数据库在表扫描期间如何修剪。
                              </p>
                              <p>应用程序发出以下查询：</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM sales WHERE cust_id = 100;</pre><p>由于该表是<code class="codeph">LINEAR</code>的<code class="codeph">BY</code> <code class="codeph">LINEAR</code> <code class="codeph">ORDER</code> ，因此数据库只能读取包含<code class="codeph">cust_id</code>值100的区域。
                              </p>
                              <p>应用程序发出以下查询：</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM sales WHERE cust_id = 100 AND prod_id = 2300;</pre><p>由于该表是<code class="codeph">LINEAR</code>的<code class="codeph">BY</code> <code class="codeph">LINEAR</code> <code class="codeph">ORDER</code> ，因此数据库必须只读取包含<code class="codeph">cust_id</code>值100和<code class="codeph">prod_id</code>为2300的区域。
                              </p>
                           </div>
                           <!-- class="section" -->
                        </div>
                     </div><a id="DWHSG9367"></a><div class="props_rev_3"><a id="GUID-A9972E60-FF25-42AF-ABB8-D8C12759ECF3" name="GUID-A9972E60-FF25-42AF-ABB8-D8C12759ECF3"></a><h6 id="DWHSG-GUID-A9972E60-FF25-42AF-ABB8-D8C12759ECF3" class="sect6"><span class="enumeration_section">14.2.2.1.2</span>使用Interleaved Attribute Clustering创建连接区域映射</h6>
                        <div>
                           <div class="section">
                              <p>考虑一个包含<code class="codeph">sales</code>事实表及其两个维度表的数据仓库： <code class="codeph">customers</code>和<code class="codeph">products</code> 。大多数查询都有<code class="codeph">customers</code>表层次结构（ <code class="codeph">country_id</code> ， <code class="codeph">cust_state_province</code> ， <code class="codeph">cust_city</code> ）和<code class="codeph">products</code>层次结构（ <code class="codeph">prod_category</code> ， <code class="codeph">prod_subcategory</code> ）的<code class="codeph">prod_subcategory</code> 。您可以对<code class="codeph">sales</code>表使用交叉排序，如以下部分语句所示：</p><pre class="oac_no_warn" dir="ltr">CREATE TABLE销售（prod_id NUMBER NOT NULL，cust_id NUMBER NOT NULL，amount_sold NUMBER（10,2））CLUSTERING销售JOIN产品ON（sales.prod_id = products.prod_id）JOIN customers ON（sales.cust_id = customers.cust_id）BY INTERLEAVED ORDER（（products.prod_category，products.prod_subcategory），（customers.country_id，customers.cust_state_province，customers.cust_city））YES ON LOAD YES FOR DATA MOVEMENT WITH MATERIALIZED ZONEMAP（sales_zmap）;</pre><p>为属性聚簇表创建名为<code class="codeph">sales_zmap</code>的区域映射。请注意，在此clustering子句中，维度表的连接列必须具有主键或唯一键约束。请注意，对于来自单个维度的交错顺序列，应该在聚类子句中出现一个单独的组，例如括号为'（'..'）'（ <code class="codeph">prod_category</code> ， <code class="codeph">prod_subcategory</code> ）。此外，列应遵循维度中的层次结构（例如<code class="codeph">prod_category</code>的自然层次结构， <code class="codeph">prod_subcategory</code> ），并且组中列的顺序应遵循层次结构的顺序。这允许Oracle数据库根据维度表中存在的层次结构有效地聚类数据。
                              </p>
                           </div>
                           <!-- class="section" -->
                        </div>
                     </div><a id="DWHSG9368"></a><div class="props_rev_3"><a id="GUID-FCAB2956-727F-4C8A-BD47-AF51DAB14D95" name="GUID-FCAB2956-727F-4C8A-BD47-AF51DAB14D95"></a><h6 id="DWHSG-GUID-FCAB2956-727F-4C8A-BD47-AF51DAB14D95" class="sect6"><span class="enumeration_section">14.2.2.1.3</span>属性聚类后创建区域映射</h6>
                        <div>
                           <div class="section">
                              <p>假设数据库中存在一个名为<code class="codeph">sales</code>的表。您可以使用以下命令为<code class="codeph">sales</code>表定义属性集群：</p><pre class="oac_no_warn" dir="ltr">ALTER TABLE销售ADD CLUSTERING按交错订单（cust_id，prod_id）是在装载时是数据移动;</pre><p>虽然此命令将属性集群添加到表定义，但它不会对<code class="codeph">sales</code>表中的现有数据进行集群。在<code class="codeph">sales</code>表上执行数据移动操作时，由于<code class="codeph">YES ON DATA MOVEMENT</code>选项，其数据将被聚类。
                              </p>
                              <p>以下命令将<code class="codeph">sales</code>表中的数据进行聚类：</p><pre class="oac_no_warn" dir="ltr">ALTER TABLES销售MOVE;</pre><p>在<code class="codeph">sales</code>表中的数据进行群集后，您可以通过使用以下命令修改群集来在<code class="codeph">sales</code>表上定义区域映射：</p><pre class="oac_no_warn" dir="ltr">ALTER TABLE销售使用MATERIALIZED ZONEMAP进行MODIFY CLUSTERING（sales_zmap）;</pre><p>随后，如有必要，可以使用以下命令通过修改群集来删除区域映射：</p><pre class="oac_no_warn" dir="ltr">ALTER TABLE销售无需物料化ZONEMAP的MODIFY CLUSTERING;</pre></div>
                           <!-- class="section" -->
                        </div>
                     </div>
                  </div><a id="DWHSG9369"></a><div class="props_rev_3"><a id="GUID-C3A55971-2E72-4B5E-A5B4-27104DF05C0A" name="GUID-C3A55971-2E72-4B5E-A5B4-27104DF05C0A"></a><h5 id="DWHSG-GUID-C3A55971-2E72-4B5E-A5B4-27104DF05C0A" class="sect5"><span class="enumeration_section">14.2.2.2</span>创建独立于属性聚类的区域映射</h5>
                     <div>
                        <div class="section">
                           <p>使用<code class="codeph">CREATE MATERIALIZED ZONEMAP</code>命令在表上创建区域映射。此区域映射独立于属性集群，这意味着它可以在集群或非集群表上创建。此外，用于区域映射的列集可以与用于属性集群的列集相同或不同。
                           </p>
                           <p>创建区域映射时，必须指定区域映射所基于的表列。</p>
                           <p>使用以下任一主题中描述的步骤创建独立于属性群集的区域映射：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="using-zone-maps.html#GUID-5847A577-5E12-491E-8570-787A270ABF41">创建独立于属性聚类的基本区域映射</a></p>
                              </li>
                              <li>
                                 <p><a href="using-zone-maps.html#GUID-42FC0CDF-9D54-42F5-AA6B-705FA6272605">创建独立于属性聚类的连接区域映射</a></p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div><a id="DWHSG9371"></a><a id="DWHSG9370"></a><div class="props_rev_3"><a id="GUID-5847A577-5E12-491E-8570-787A270ABF41" name="GUID-5847A577-5E12-491E-8570-787A270ABF41"></a><h6 id="DWHSG-GUID-5847A577-5E12-491E-8570-787A270ABF41" class="sect6"><span class="enumeration_section">14.2.2.2.1</span>创建独立于属性聚类的基本区域图</h6>
                        <div>
                           <div class="section">
                              <p>假设<code class="codeph">sales</code>表上的查询经常指定客户ID，产品ID或两列的组合。您可以在<code class="codeph">sales</code>表的customer ID和product ID列上创建区域映射，以便查询从修剪中受益，如<a href="using-zone-maps.html#GUID-5847A577-5E12-491E-8570-787A270ABF41__CIHFDHHD">例14-1</a>所示。
                              </p>
                           </div>
                           <!-- class="section" -->
                           <div class="example" id="GUID-5847A577-5E12-491E-8570-787A270ABF41__CIHFDHHD">
                              <p class="titleinexample">示例14-1创建独立于属性群集的基本区域映射</p>
                              <p>您可以使用以下语句在<code class="codeph">sales</code>表上创建区域映射<code class="codeph">sales_zmap</code> ：</p><pre class="oac_no_warn" dir="ltr">CREATE MATERIALIZED ZONEMAP sales_zmap ON sales（cust_id，prod_id）;</pre><p>此语句相当于以下<code class="codeph">CREATE</code> <code class="codeph">...</code> <code class="codeph">AS</code>声明：</p><pre class="oac_no_warn" dir="ltr">CREATE MATERIALIZED ZONEMAP sales_zmap REFRESH ON LOAD DATA MOVEMENT AS SELECT SYS_OP_ZONE_ID（rowid），MIN（cust_id），MAX（cust_id），MIN（prod_id），MAX（prod_id）FROM sales GROUP BY SYS_OP_ZONE_ID（rowid）;</pre><p>在此语句中， <code class="codeph">SYS_OP_ZONE_ID(rowid)</code>函数用于处理区域映射。<code class="codeph">SYS_OP_ZONE_ID</code>函数在给定事实表行的rowid的情况下标识特定范围的连续磁盘块（区域）。此功能有助于维护分区级别的最小和最大范围，执行分区修剪和区域映射的快速刷新。与区域映射一起使用时，有助于将一组连续数据块中的所有行映射到单个区域。
                              </p>
                           </div>
                           <!-- class="example" -->
                        </div>
                     </div><a id="DWHSG9373"></a><a id="DWHSG9372"></a><div class="props_rev_3"><a id="GUID-42FC0CDF-9D54-42F5-AA6B-705FA6272605" name="GUID-42FC0CDF-9D54-42F5-AA6B-705FA6272605"></a><h6 id="DWHSG-GUID-42FC0CDF-9D54-42F5-AA6B-705FA6272605" class="sect6"><span class="enumeration_section">14.2.2.2.2</span>创建独立于属性聚类的连接区域映射</h6>
                        <div>
                           <div class="section">
                              <p>考虑一个包含<code class="codeph">sales</code>事实和多个维度的数据仓库。大多数查询都有<code class="codeph">customers</code>表层次结构（ <code class="codeph">cust_state_province, cust_city</code> ）的谓词。您可以对sales表使用交错排序，如<a href="using-zone-maps.html#GUID-42FC0CDF-9D54-42F5-AA6B-705FA6272605__CreatingAJoinZoneMapIndependentOfAt-08315BD3">例14-2</a>所示。
                              </p>
                           </div>
                           <!-- class="section" -->
                           <div class="example" id="GUID-42FC0CDF-9D54-42F5-AA6B-705FA6272605__CreatingAJoinZoneMapIndependentOfAt-08315BD3">
                              <p class="titleinexample">示例14-2创建独立于属性群集的连接区域映射</p>
                              <p>连接区域映射涉及从创建区域映射的表到一个或多个其他表的外连接。最常用于星型模式设置的连接区域映射跟踪维度表中的列的最小值和最大值，而不是事实表中的列，如以下语句中所示：</p><pre class="oac_no_warn" dir="ltr">CREATE MATERIALIZED ZONEMAP sales_zmap REFRESH ON LOAD DATA MOVEMENT AS SELECT SYS_OP_ZONE_ID（s.rowid），MIN（cust_state_province），MAX（cust_state_province），MIN（cust_city），MAX（cust_city）FROM sales s，customers c WHERE s.cust_id = c。 cust_id（+）GROUP BY SYS_OP_ZONE_ID（s.rowid）;</pre></div>
                           <!-- class="example" -->
                        </div>
                     </div>
                  </div>
               </div><a id="DWHSG9374"></a><a id="DWHSG9375"></a><a id="DWHSG9376"></a><a id="DWHSG9377"></a><a id="DWHSG9378"></a><a id="DWHSG9379"></a><a id="DWHSG9380"></a><a id="DWHSG8941"></a><div class="props_rev_3"><a id="GUID-70722C5D-2785-4934-9EA6-93114EF9ED0A" name="GUID-70722C5D-2785-4934-9EA6-93114EF9ED0A"></a><h4 id="DWHSG-GUID-70722C5D-2785-4934-9EA6-93114EF9ED0A" class="sect4"><span class="enumeration_section">14.2.3</span>修改区域映射</h4>
                  <div>
                     <div class="section">
                        <p>您可以使用<code class="codeph">ALTER</code> <code class="codeph">MATERIALIZED</code> <code class="codeph">ZONEMAP</code>语句更改区域映射。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-70722C5D-2785-4934-9EA6-93114EF9ED0A__GUID-1B45F73E-B0EB-43B0-B132-CEB67082A48E">
                        <p class="titleinexample">示例14-3使区域映射不可用</p>
                        <p>以下语句使区域映射不可用，这意味着查询不再使用此区域映射，Oracle数据库不再维护区域映射。</p><pre class="oac_no_warn" dir="ltr">ALTER MATERIALIZED ZONEMAP sales_zmap UNUSABLE;</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-70722C5D-2785-4934-9EA6-93114EF9ED0A__GUID-93532198-C610-4E05-A92A-3D22088777C6">
                        <p class="titleinexample">示例14-4为区域映射执行完全刷新</p>
                        <p>以下语句执行区域映射的完整刷新：</p><pre class="oac_no_warn" dir="ltr">ALTER MATERIALIZED ZONEMAP sales_zmap REBUILD COMPLETE;</pre><p>作为重建的一部分，如果区域映射早先标记为不可用，则该区域映射也可用。</p>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-70722C5D-2785-4934-9EA6-93114EF9ED0A__GUID-4D616835-C011-455D-AE32-53D81DBFC10F">
                        <p class="titleinexample">示例14-5刷新区域映射</p>
                        <p>如果可能，以下语句将执行快速刷新。否则，执行完整的刷新。</p><pre class="oac_no_warn" dir="ltr">ALTER MATERIALIZED ZONEMAP sales_zmap REBUILD;</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-70722C5D-2785-4934-9EA6-93114EF9ED0A__GUID-348E97C0-AF08-49A4-B097-307EBB4EBE5C">
                        <p class="titleinexample">示例14-6禁用区域映射的修剪</p>
                        <p>以下语句禁用修剪，您可能希望对其进行性能测量：</p><pre class="oac_no_warn" dir="ltr">ALTER MATERIALIZED ZONEMAP sales_zmap DISABLE PRUNING;</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-70722C5D-2785-4934-9EA6-93114EF9ED0A__GUID-4F785988-FF12-484A-8B73-3AA9725F536B">
                        <p class="titleinexample">示例14-7启用区域映射的修剪</p>
                        <p>以下语句为区域映射启用了可能先前已禁用的修剪：</p><pre class="oac_no_warn" dir="ltr">ALTER MATERIALIZED ZONEMAP sales_zmap ENABLE PRUNING;</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-70722C5D-2785-4934-9EA6-93114EF9ED0A__GUID-F739DBD7-1B67-464D-83D5-A7A484BDEED0">
                        <p class="titleinexample">示例14-8禁用区域映射的刷新</p>
                        <p>以下语句将关闭加载和数据移动时的刷新，这使您可以控制刷新区域映射的方式和时间：</p><pre class="oac_no_warn" dir="ltr">ALTER MATERIALIZED ZONEMAP sales_zmap REFRESH ON DEMAND;</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-70722C5D-2785-4934-9EA6-93114EF9ED0A__GUID-9F46E0DC-CF23-484D-844B-DC9B182F7C78">
                        <p class="titleinexample">示例14-9在区域映射的提交时启用刷新</p>
                        <p>以下语句将在每个事务提交时打开区域映射的刷新：</p><pre class="oac_no_warn" dir="ltr">ALTER MATERIALIZED ZONEMAP sales_zmap REFRESH ON COMMIT;</pre><div class="infoboxnotealso" id="GUID-70722C5D-2785-4934-9EA6-93114EF9ED0A__GUID-9DBF7F15-2114-4CF1-B5AA-DE7EBCFDF73A">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../sqlrf/ALTER-MATERIALIZED-ZONEMAP.html#SQLRF56854" target="_blank"><span class="italic">Oracle数据库SQL语言参考，</span></a>用于更改区域映射的语法</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="example" -->
                  </div>
               </div><a id="DWHSG8942"></a><div class="props_rev_3"><a id="GUID-6560A78B-D132-4555-8619-CCDC2C9FCF38" name="GUID-6560A78B-D132-4555-8619-CCDC2C9FCF38"></a><h4 id="DWHSG-GUID-6560A78B-D132-4555-8619-CCDC2C9FCF38" class="sect4"><span class="enumeration_section">14.2.4</span>丢弃区域映射</h4>
                  <div>
                     <div class="section">
                        <p>你可以放弃<a id="d56099e1420" class="indexterm-anchor"></a><a id="d56099e1424" class="indexterm-anchor"></a>区域映射通过发出<code class="codeph">DROP</code> <code class="codeph">MATERIALIZED</code> <code class="codeph">ZONEMAP</code>语句，如下所示：</p><pre class="oac_no_warn" dir="ltr">DROP MATERIALIZED ZONEMAP sales_zmap;</pre><div class="infoboxnotealso" id="GUID-6560A78B-D132-4555-8619-CCDC2C9FCF38__GUID-DEABFA45-65CE-46EB-8CB1-9F473859E489">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../sqlrf/DROP-MATERIALIZED-ZONEMAP.html#SQLRF56892" target="_blank"><span class="italic">Oracle Database SQL语言参考，</span></a>用于删除区域映射的语法</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DWHSG9171"></a><div class="props_rev_3"><a id="GUID-1D2BB7B1-440D-403C-BD24-AFAA39789568" name="GUID-1D2BB7B1-440D-403C-BD24-AFAA39789568"></a><h4 id="DWHSG-GUID-1D2BB7B1-440D-403C-BD24-AFAA39789568" class="sect4"><span class="enumeration_section">14.2.5</span>编译区域映射</h4>
                  <div>
                     <div class="section">
                        <p>区域映射所基于的基表上的任何DDL操作都将影响区域映射的编译状态。这意味着必须编译定义区域映射的查询以检查区域映射是否仍然有效。此行为类似于实例化视图，它们也受基表上执行的DDL的影响。Oracle数据库将在第一次尝试在DDL操作后使用区域映射时编译区域映射。但是，您可以使用alter DDL语句显式编译区域映射，如下所示：</p><pre class="oac_no_warn" dir="ltr">ALTER MATERIALIZED ZONEMAP sales_zmap COMPILE;</pre><p>编译区域映射的结果将有效或无效，具体取决于DDL执行的特定操作。例如，如果完成DDL以向事实表添加列，则编译后区域映射将有效。但是如果完成DDL以删除定义查询中引用的列，则编译后区域映射将无效。</p>
                        <p>要记住的一些要点是：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>如果删除了群集子句中显示的列，则会删除群集。此外，如果在群集中创建了区域地图，则也会删除区域地图。</p>
                           </li>
                           <li>
                              <p>如果删除星型模式中的维度表，并且它涉及事实表上的群集，则会删除事实表上的群集。此外，如果作为群集的一部分创建了区域地图，则将删除区域地图。</p>
                           </li>
                           <li>
                              <p>如果用户在聚类子句中涉及的维度表上删除了所需的主键或唯一键，则群集将失效（数据将不会在后续加载或某些类型的PMOP执行的数据移动操作上进行聚类）。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DWHSG9172"></a><div class="props_rev_3"><a id="GUID-8266B0F1-29B0-418C-90F5-09B0AAA87F8F" name="GUID-8266B0F1-29B0-418C-90F5-09B0AAA87F8F"></a><h4 id="DWHSG-GUID-8266B0F1-29B0-418C-90F5-09B0AAA87F8F" class="sect4"><span class="enumeration_section">14.2.6</span>控制区域地图的使用</h4>
                  <div>
                     <p>您可以控制整个SQL工作负载或特定SQL语句的区域映射的使用。</p>
                     <p>本节包含以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="using-zone-maps.html#GUID-6016EDDE-05BC-4316-B63D-95CACE3A5F37">控制整个SQL工作负载的区域映射用法</a></p>
                        </li>
                        <li>
                           <p><a href="using-zone-maps.html#GUID-F8CDC4B6-9472-4825-8B95-69EEEC80EEFC">控制特定SQL语句的区域映射用法</a></p>
                        </li>
                     </ul>
                  </div><a id="DWHSG9381"></a><div class="props_rev_3"><a id="GUID-6016EDDE-05BC-4316-B63D-95CACE3A5F37" name="GUID-6016EDDE-05BC-4316-B63D-95CACE3A5F37"></a><h5 id="DWHSG-GUID-6016EDDE-05BC-4316-B63D-95CACE3A5F37" class="sect5"><span class="enumeration_section">14.2.6.1</span>控制整个SQL工作负载的区域映射用法</h5>
                     <div>
                        <div class="section">
                           <p>您可以在对象级别控制区域贴图的使用。对象级更改适用于SQL工作负载中的所有语句。创建区域映射时，除非通过指定<code class="codeph">DISABLE PRUNING</code>覆盖默认值，否则它可用于修剪。例如，以下语句创建禁用修剪的区域映射：</p><pre class="oac_no_warn" dir="ltr">CREATE MATERIALIZED ZONEMAP sales_zmap禁止销售销售（cust_id，prod_id）;</pre><p>此区域映射由Oracle数据库创建和维护，但不用于工作负载中的任何SQL。您可以使用以下<code class="codeph">ALTER MATERIALIZED ZONEMAP</code>语句使其可用于修剪：</p><pre class="oac_no_warn" dir="ltr">ALTER MATERIALIZED ZONEMAP sales_zmap ENABLE PRUNING;</pre><p>同样，您可以使用以下语句使区域映射不可用于修剪：</p><pre class="oac_no_warn" dir="ltr">ALTER MATERIALIZED ZONEMAP sales_zmap DISABLE PRUNING;</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="DWHSG9174"></a><a id="DWHSG9176"></a><a id="DWHSG9178"></a><a id="DWHSG9382"></a><div class="props_rev_3"><a id="GUID-F8CDC4B6-9472-4825-8B95-69EEEC80EEFC" name="GUID-F8CDC4B6-9472-4825-8B95-69EEEC80EEFC"></a><h5 id="DWHSG-GUID-F8CDC4B6-9472-4825-8B95-69EEEC80EEFC" class="sect5"><span class="enumeration_section">14.2.6.2</span>控制特定SQL语句的区域映射用法</h5>
                     <div>
                        <div class="section">
                           <p>您可以使用提示来控制在单个SQL语句级别使用区域映射。请注意，如果禁用区域映射的修剪，则不能使用提示来控制区域映射用法。通过启用修剪并在单个SQL语句中指定负提示，可以通过提示实现更精细的控制。</p>
                           <p>使用<code class="codeph">NO_ZONEMAP</code>提示禁用区域映射的使用以进行修剪。以下示例在修剪数据时禁用区域贴图的使用。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-F8CDC4B6-9472-4825-8B95-69EEEC80EEFC__GUID-33066484-4279-40BD-8542-A7D1C7A01012">
                           <p class="titleinexample">示例14-10扫描修剪：使用NO_ZONEMAP提示禁用区域映射</p><pre class="oac_no_warn" dir="ltr">SELECT / * + NO_ZONEMAP（S SCAN）* / * FROM sales S WHERE s.time_id BETWEEN'1-15-2008'and'1-31-2008';</pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-F8CDC4B6-9472-4825-8B95-69EEEC80EEFC__GUID-C518CEC3-6784-44B3-9A72-17766861B052">
                           <p class="titleinexample">示例14-11 Join Pruning：使用NO_ZONEMAP提示禁用区域映射</p><pre class="oac_no_warn" dir="ltr">SELECT / * + NO_ZONEMAP（S JOIN）* / * FROM sales s WHERE s.time_id BETWEEN'1-15-2008'and'1-31-2008';</pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-F8CDC4B6-9472-4825-8B95-69EEEC80EEFC__GUID-D234271E-9129-4750-9767-628C9C74CE66">
                           <p class="titleinexample">示例14-12分区修剪：使用NO_ZONEMAP提示禁用区域映射</p><pre class="oac_no_warn" dir="ltr">SELECT / * + NO_ZONEMAP（S PARTITION）* / * FROM sales S WHERE s.time_id BETWEEN'1-15-2008'and'1-31-2008';</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div><a id="DWHSG9383"></a><a id="DWHSG9384"></a><a id="DWHSG9385"></a><a id="DWHSG8947"></a><div class="props_rev_3"><a id="GUID-904D917B-DA6D-45AB-96F6-7FBF567D19FE" name="GUID-904D917B-DA6D-45AB-96F6-7FBF567D19FE"></a><h4 id="DWHSG-GUID-904D917B-DA6D-45AB-96F6-7FBF567D19FE" class="sect4"><span class="enumeration_section">14.2.7</span>维护区域映射</h4>
                  <div>
                     <div class="section">
                        <p>您可以<a id="d56099e1652" class="indexterm-anchor"></a>指定在创建区域映射时或者稍后通过更改区域映射定义时必须如何维护区域映射。请参阅<span class="q">“ <a href="using-zone-maps.html#GUID-394749A4-73A6-421D-B792-27B748450222">区域地图维护注意事项</a> ”</span> 。
                        </p>
                        <div class="infoboxnotealso" id="GUID-904D917B-DA6D-45AB-96F6-7FBF567D19FE__GUID-84EA2C58-3612-44C8-B96C-A1124DFC97AC">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="using-zone-maps.html#GUID-08DB84F2-8163-4E02-9D2E-8A10351335E4">关于维护区域地图</a> ”</span></p>
                        </div>
                        <p>使用<code class="codeph">CREATE MATERIALIZED ZONEMAP</code>或<code class="codeph">ALTER MATERIALIZED ZONEMAP</code>语句中的<code class="codeph">REFRESH</code>子句指定必须如何维护区域映射。如果省略<code class="codeph">CREATE MATERIALIZED ZONEMAP</code>语句中的<code class="codeph">REFRESH</code>子句，则使用的默认值是<code class="codeph">REFRESH ON LOAD DATA MOVEMENT</code> ，它允许Oracle数据库在直接路径加载和某些数据移动操作时维护区域映射。
                        </p>
                        <p>以下语句创建一个区域映射，其维护由用户手动管理：</p><pre class="oac_no_warn" dir="ltr">CREATE MATERIALIZED ZONEMAP sales_zmap REFRESH ON DEMAND ON sales（cust_id，prod_id）;</pre><p>以下语句创建一个区域映射，其维护由Oracle Database在每个事务提交结束时进行管理：</p><pre class="oac_no_warn" dir="ltr">CREATE MATERIALIZED ZONEMAP sales_zmap REFRESH ON COMMIT ON sales（cust_id，prod_id）;</pre><p>因为它在提交时刷新，所以上面的区域映射永远不会变得陈旧。</p>
                        <p>使用<code class="codeph">ALTER MATERIALIZED ZONEMAP</code>语句更改现有区域映射的维护。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-904D917B-DA6D-45AB-96F6-7FBF567D19FE__GUID-0B1A533D-C0C3-455B-9B89-9D5B2D9841AB">
                        <p class="titleinexample">示例14-13在数据移动上启用区域映射维护</p>
                        <p>以下语句允许Oracle数据库对数据移动操作（如<code class="codeph">MOVE</code> ， <code class="codeph">SPLIT</code> ， <code class="codeph">MERGE</code>和<code class="codeph">DROP</code>进行区域映射维护：</p><pre class="oac_no_warn" dir="ltr">ALTER MATERIALIZED ZONEMAP sales_zmap REFRESH ON DATA MOVEMENT;</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-904D917B-DA6D-45AB-96F6-7FBF567D19FE__GUID-FD274025-ABB4-44D0-A936-A1DE072A003E">
                        <p class="titleinexample">示例14-14在直接路径加载上启用区域映射维护</p>
                        <p>以下语句允许Oracle数据库在直接路径加载操作（例如<code class="codeph">INSERT /*+ APPEND */</code> statements）上进行区域映射维护：</p><pre class="oac_no_warn" dir="ltr">ALTER MATERIALIZED ZONEMAP sales_zmap REFRESH ON LOAD;</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-904D917B-DA6D-45AB-96F6-7FBF567D19FE__GUID-371EE29C-DE59-47C7-B780-84B467514E23">
                        <p class="titleinexample">示例14-15在数据移动和加载上启用区域图维护</p>
                        <p>以下语句启用Oracle数据库对数据移动和加载操作的区域映射维护：</p><pre class="oac_no_warn" dir="ltr">ALTER MATERIALIZED ZONEMAP sales_zmap更新负载数据移动;</pre><p>请注意， <code class="codeph">REFRESH ON LOAD DATA MOVEMENT</code>是默认选项。
                        </p>
                     </div>
                     <!-- class="example" -->
                  </div><a id="DWHSG8948"></a><div class="props_rev_3"><a id="GUID-394749A4-73A6-421D-B792-27B748450222" name="GUID-394749A4-73A6-421D-B792-27B748450222"></a><h5 id="DWHSG-GUID-394749A4-73A6-421D-B792-27B748450222" class="sect5"><span class="enumeration_section">14.2.7.1</span>区域地图维护注意事项</h5>
                     <div>
                        <p>以下是维护区域地图或跟踪其陈旧性时要记住的一些问题：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>对事实表的DML /并行DML操作</p>
                              <p>创建区域映射时，Oracle数据库会创建内部触发器以跟踪传统DML操作所做的行更改。例如，如果将新行插入到<code class="codeph">sales</code>表中，则此触发器将从<code class="codeph">rowid</code>计算<code class="codeph">zone_id</code> ，并将区域映射中的相应聚合行标记为陈旧。因此，逐区跟踪区域地图的陈旧性，这意味着即使在对事实表进行DML之后，区域地图仍可用于使用新区域中的<code class="codeph">MIN</code> / <code class="codeph">MAX</code>聚合进行修剪。
                              </p>
                              <p>事实表更新后，如果区域映射未引用要更新的列，则区域映射过时不受影响。否则，内部触发器将对应于更新行的区域标记为陈旧。</p>
                           </li>
                           <li>
                              <p>直接加载（即<code class="codeph">INSERT /*+ APPEND */</code> ）操作到事实表</p>
                              <p>即使直接载荷将数据插入高水位线以上，新添加的行也可以属于已为区域地图计算的区域。因此，Oracle数据库将识别其<code class="codeph">MIN</code> / <code class="codeph">MAX</code>聚合可能受新添加数据影响的现有区域，并将此类区域标记为陈旧。同样，Oracle数据库可以继续使用区域映射进行修剪，尽管通过利用仍然保持新鲜的区域的<code class="codeph">MIN</code> / <code class="codeph">MAX</code>聚合直接加载到区域图。如果区域映射具有<code class="codeph">REFRESH ON LOAD</code>选项，则Oracle数据库将在加载结束时执行区域映射刷新。
                              </p>
                           </li>
                           <li>
                              <p>事实表上的数据移动（例如，分区维护操作）</p>
                              <p>数据移动操作包括分区维护操作和在线分区/表重新定义。但是，数据移动（例如，移动分区）将使属于旧分区的现有区域在区域映射中过时，而属于新分区的区域在刷新区域映射之前不会计算。无论区域映射是否刷新，Oracle数据库都将继续使用区域映射来修剪以下数据移动操作。如果区域映射具有<code class="codeph">REFRESH</code> <code class="codeph">ON</code> <code class="codeph">DATA</code> <code class="codeph">MOVEMENT</code>选项，则Oracle数据库将在数据移动操作结束时执行刷新。
                              </p>
                           </li>
                           <li>
                              <p>维度表上的数据移动</p>
                              <p>此操作不会影响区域映射。</p>
                           </li>
                           <li>
                              <p>维度表的任何DML</p>
                              <p>此操作使整个区域映射失效，因此需要完全刷新。但是，有一个例外。如果是更新操作并且区域映射未引用更新列集，则它不会受到影响。</p>
                           </li>
                           <li>
                              <p>直接加载到维度表</p>
                              <p>此操作使整个区域映射失效。如果为区域映射指定了<code class="codeph">REFRESH</code> <code class="codeph">ON</code> <code class="codeph">LOAD</code>选项，则Oracle数据库将在加载操作后立即执行区域映射刷新。
                              </p>
                           </li>
                           <li>
                              <p>DDL到事实或维度表</p>
                              <p>在DDL操作时，区域映射标记为未知的过期（即，陈旧设置为<code class="codeph">'unknown'</code> ）并且需要编译（即， <code class="codeph">compile_state</code>设置为<code class="codeph">'needs_compile</code> '）。在此状态下，Oracle数据库不会使用区域映射进行修剪。但是，在DDL操作之后首次使用区域映射时，Oracle数据库将编译区域映射，并根据其结果适当地设置无效和失效状态。例如，如果DDL操作删除了其<code class="codeph">MIN</code> / <code class="codeph">MAX</code>聚合存储在区域映射中的列，则区域映射编译将失败，因此区域映射<code class="codeph">compile_state</code>设置为<code class="codeph">'compilation error'</code> ，过时保留为<code class="codeph">'unknown'</code> ，无效为设为<code class="codeph">'yes'</code> 。
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div><a id="DWHSG9165"></a><div class="props_rev_3"><a id="GUID-EEE26E3B-38B7-47DD-9892-818CB8432158" name="GUID-EEE26E3B-38B7-47DD-9892-818CB8432158"></a><h3 id="DWHSG-GUID-EEE26E3B-38B7-47DD-9892-818CB8432158" class="sect3"><span class="enumeration_section">14.3</span>区域地图的刷新和陈旧</h3>
               <div>
                  <p>当数据库基表中的数据发生更改时，Oracle数据库会将区域映射标记为区域映射中的陈旧区域或单个区域。过时的区域地图不用于修剪，但带有陈旧区域的区域地图仍用于修剪。您必须刷新区域映射以更新区域并使其可用于修剪。</p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="using-zone-maps.html#GUID-67445DF7-1688-4007-B52E-EE55EB55B090" title="当区域映射所基于的表中的数据发生更改时，与更改的行对应的区域将标记为陈旧。您需要刷新区域图以使区域成为当前区域。">关于区域地图的陈旧性</a></p>
                     </li>
                     <li>
                        <p><a href="using-zone-maps.html#GUID-4B36B2E5-03A1-4004-9E8A-E95E94E91356">关于刷新区域地图</a></p>
                     </li>
                     <li>
                        <p><a href="using-zone-maps.html#GUID-3800B313-23CB-45C5-AD09-1ACA78EFD449">刷新区域地图</a></p>
                     </li>
                  </ul>
               </div><a id="DWHSG9387"></a><a id="DWHSG9388"></a><a id="DWHSG9389"></a><a id="DWHSG9386"></a><div class="props_rev_3"><a id="GUID-67445DF7-1688-4007-B52E-EE55EB55B090" name="GUID-67445DF7-1688-4007-B52E-EE55EB55B090"></a><h4 id="DWHSG-GUID-67445DF7-1688-4007-B52E-EE55EB55B090" class="sect4"><span class="enumeration_section">14.3.1</span>关于区域地图的陈旧性</h4>
                  <div>
                     <p>当区域映射所基于的表中的数据发生更改时，与更改的行对应的区域将标记为陈旧。您需要刷新区域图以使区域成为当前区域。</p>
                     <p>当更新事实表的分区中的行时，由于更新，与分区表中的区域对应的行被标记为陈旧。这会自动使聚合的分区级别信息无效，并且只能在区域级别进行修剪。由于更新，区域映射中与此特定分区对应的行也标记为陈旧。</p>
                     <p>在<a href="using-zone-maps.html#GUID-67445DF7-1688-4007-B52E-EE55EB55B090__CIHGDIJE">图14-1中</a> ，这是通过<code class="codeph">P2</code> <code class="codeph">Z4</code>更新来说明的，并且相应的<code class="codeph">Z4</code>被标记为陈旧。但请注意，区域图仍然可用。只要区域地图部分陈旧，将始终读取与<code class="codeph">Z4</code>相对应的表格数据（在<code class="codeph">Z4</code>上不执行修剪）。
                     </p>
                     <div class="figure" id="GUID-67445DF7-1688-4007-B52E-EE55EB55B090__CIHGDIJE">
                        <p class="titleinfigure">图14-1部分陈旧区域图</p><img src="img/dwhsg139.gif" alt="下面是图14-1的描述" title="下面是图14-1的描述" longdesc="img_text/dwhsg139.html"><br><a href="img_text/dwhsg139.html">“图14-1部分陈旧区域地图”的说明</a></div>
                     <!-- class="figure" -->
                     <p>如果将维度表添加到事实表中，则状态类似于<a href="using-zone-maps.html#GUID-67445DF7-1688-4007-B52E-EE55EB55B090__CIHFDAEG">图14-2中</a>的状态。
                     </p>
                     <div class="figure" id="GUID-67445DF7-1688-4007-B52E-EE55EB55B090__CIHFDAEG">
                        <p class="titleinfigure">图14-2带尺寸表的区域图</p><img src="img/dwhsg150.png" alt="下面是图14-2的描述" title="下面是图14-2的描述" longdesc="img_text/dwhsg150.html"><br><a href="img_text/dwhsg150.html">“图14-2带尺寸表的区域图”的描述</a></div>
                     <!-- class="figure" -->
                     <p>如果对维度表进行了任何DML，则区域映射将变为完全陈旧， <a href="using-zone-maps.html#GUID-67445DF7-1688-4007-B52E-EE55EB55B090__CIHBGBJE">如图14-3所示</a> 。由于区域映射变为完全状态，因此在完全刷新之前，它不可用于修剪。使用<code class="codeph">ALTER MATERIALIZED ZONEMAP</code>语句的<code class="codeph">REBUILD</code>选项刷新区域映射。
                     </p>
                     <div class="figure" id="GUID-67445DF7-1688-4007-B52E-EE55EB55B090__CIHBGBJE">
                        <p class="titleinfigure">图14-3带有尺寸表和失效的区域图</p><img src="img/dwhsg151.gif" alt="下面是图14-3的描述" title="下面是图14-3的描述" longdesc="img_text/dwhsg151.html"><br><a href="img_text/dwhsg151.html">“图14-3带有尺寸表和失效的区域图”的描述</a></div>
                     <!-- class="figure" -->
                  </div>
               </div><a id="DWHSG9390"></a><div class="props_rev_3"><a id="GUID-4B36B2E5-03A1-4004-9E8A-E95E94E91356" name="GUID-4B36B2E5-03A1-4004-9E8A-E95E94E91356"></a><h4 id="DWHSG-GUID-4B36B2E5-03A1-4004-9E8A-E95E94E91356" class="sect4"><span class="enumeration_section">14.3.2</span>关于刷新区域映射</h4>
                  <div>
                     <p>Oracle数据库需要通过在更改其基础表后刷新区域映射来维护区域映射。用于区域映射的刷新方法可以是完全刷新或增量刷新。使用<code class="codeph">REFRESH COMPLETE</code>子句指定的完整刷新涉及重建区域映射中的所有区域。当需要处理大量数据时，完全刷新很慢。使用<code class="codeph">REFRESH FAST</code>子句指定的增量刷新仅处理自上次刷新以来发生的更改。此方法使您可以刷新区域映射而无需从头开始重建它们。虽然区域映射是使用物化视图在内部实现的，但基表上的物化视图日志不需要执行区域映射的快速刷新</p>
                     <p>刷新模式指定触发区域映射刷新的操作。使用以下刷新模式之一：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">ON COMMIT</code></p>
                           <p>提交对基表的更改时，将刷新区域映射。</p>
                        </li>
                        <li>
                           <p><code class="codeph">一经请求</code></p>
                           <p>必须在DML或分区维护操作后手动刷新区域映射。</p>
                        </li>
                        <li>
                           <p><code class="codeph">关于数据运动</code></p>
                           <p>在基表上执行数据移动操作时，将刷新区域映射。</p>
                        </li>
                        <li>
                           <p><code class="codeph">负载</code></p>
                           <p>在基表上执行直接路径插入操作时，将刷新区域映射。</p>
                        </li>
                        <li>
                           <p><code class="codeph">关于负载数据移动</code></p>
                           <p>在基表上执行直接路径插入或某些数据移动操作时，将刷新区域映射。这是默认值。</p>
                        </li>
                     </ul>
                     <p>默认情况下，区域映射会在加载和数据移动时刷新。要覆盖此默认值，请在创建或修改区域映射时指定以下刷新模式之一： <code class="codeph">ON COMMIT</code> ， <code class="codeph">ON LOAD</code> ， <code class="codeph">ON DATA MOVEMENT</code>或<code class="codeph">ON LOAD</code> 。</p>
                  </div>
               </div><a id="DWHSG8943"></a><div class="props_rev_3"><a id="GUID-3800B313-23CB-45C5-AD09-1ACA78EFD449" name="GUID-3800B313-23CB-45C5-AD09-1ACA78EFD449"></a><h4 id="DWHSG-GUID-3800B313-23CB-45C5-AD09-1ACA78EFD449" class="sect4"><span class="enumeration_section">14.3.3</span>刷新区域映射</h4>
                  <div>
                     <div class="section">
                        <p>在未指定<code class="codeph">REFRESH</code>选项的情况下创建区域映射时，Oracle数据库默认在直接加载和某些数据移动操作后执行区域映射维护。例外是DML操作，例如删除，插入和更新。对于这些操作，Oracle数据库将适当地将区域映射或区域映射中的某些区域标记为陈旧。要手动控制区域映射的刷新维护，必须指定<code class="codeph">REFRESH ON DEMAND</code>选项。
                        </p>
                        <p>以下命令将创建禁用刷新维护的区域映射，这意味着必须在对基础表进行更改后手动刷新区域映射。</p><pre class="oac_no_warn" dir="ltr">CREATE MATERIALIZED ZONEMAP sales_zmap ON sales（time_id，cust_id）REFRESH ON DEMAND;</pre><p>Oracle数据库提供了以下两种刷新区域映射的方法：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="using-zone-maps.html#GUID-3EB3014A-0713-4EA5-95FF-FA070172E33D">使用ALTER MATERIALIZED ZONEMAP命令刷新区域映射</a></p>
                           </li>
                           <li>
                              <p><a href="using-zone-maps.html#GUID-36F8CA88-FD6B-4911-9B84-E51B2A742219">使用DBMS_MVIEW包刷新区域映射</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div><a id="DWHSG9391"></a><div class="props_rev_3"><a id="GUID-3EB3014A-0713-4EA5-95FF-FA070172E33D" name="GUID-3EB3014A-0713-4EA5-95FF-FA070172E33D"></a><h5 id="DWHSG-GUID-3EB3014A-0713-4EA5-95FF-FA070172E33D" class="sect5"><span class="enumeration_section">14.3.3.1</span>使用ALTER MATERIALIZED ZONEMAP命令刷新区域映射</h5>
                     <div>
                        <div class="section">
                           <p>使用<code class="codeph">ALTER MATERIALIZED ZONEMAP</code>命令的<code class="codeph">REBUILD</code>选项刷新区域贴图。
                           </p>
                           <p>以下命令执行区域映射的完整刷新：</p><pre class="oac_no_warn" dir="ltr">ALTER MATERIALIZED ZONEMAP sales_zmap REBUILD COMPLETE;</pre><p>如果区域映射完全过时或标记为不可用，则以下命令将执行完全刷新。否则，执行增量（快速）刷新。</p><pre class="oac_no_warn" dir="ltr">ALTER MATERIALIZED ZONEMAP sales_zmap REBUILD;</pre><div class="infoboxnotealso" id="GUID-3EB3014A-0713-4EA5-95FF-FA070172E33D__GUID-8ADECBDA-95A8-4F57-B0C0-4EFD2C7277B7">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="../sqlrf/ALTER-MATERIALIZED-ZONEMAP.html#SQLRF56854" target="_blank"><span class="italic">Oracle Database SQL语言参考，</span></a>用于刷新区域映射的语法</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="DWHSG9392"></a><div class="props_rev_3"><a id="GUID-36F8CA88-FD6B-4911-9B84-E51B2A742219" name="GUID-36F8CA88-FD6B-4911-9B84-E51B2A742219"></a><h5 id="DWHSG-GUID-36F8CA88-FD6B-4911-9B84-E51B2A742219" class="sect5"><span class="enumeration_section">14.3.3.2</span>刷新区地图使用DBMS_MVIEW包</h5>
                     <div>
                        <div class="section">
                           <p>您可以使用<code class="codeph">DBMS_MVIEW</code>包的<code class="codeph">REFRESH</code>过程来刷新区域映射。
                           </p>
                           <p>使用<code class="codeph">DBMS_MVIEW.REFRESH</code>过程时，Oracle数据库将根据为其<code class="codeph">refresh_method</code>参数指定的值刷新区域映射，如下所示：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>C：执行完整刷新。</p>
                              </li>
                              <li>
                                 <p>F  - 执行快速刷新。如果无法快速刷新，则会发出错误。</p>
                              </li>
                              <li>
                                 <p>？ - 尽可能快速刷新。否则执行完整的刷新。</p>
                                 <p>如果未指定任何值，则使用此默认值。</p>
                              </li>
                           </ul>
                           <p>使用<code class="codeph">REFRESH</code>过程的示例如下：</p><pre class="oac_no_warn" dir="ltr">EXECUTE DBMS_MVIEW.REFRESH（'sales_zmap'，'C'）;</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="DWHSG9164"></a><div class="props_rev_3"><a id="GUID-1E6AF386-E601-4382-B84D-B811DA142E0F" name="GUID-1E6AF386-E601-4382-B84D-B811DA142E0F"></a><h3 id="DWHSG-GUID-1E6AF386-E601-4382-B84D-B811DA142E0F" class="sect3"><span class="enumeration_section">14.4</span>使用区域映射执行修剪</h3>
               <div>
                  <div class="section">
                     <p>区域映射的主要优点是表扫描的I / O减少。修剪利用有关记录的自然位置的信息来避免不必要的I / O.当SQL语句包含区域映射中跟踪的列的谓词时，数据库会将谓词值与每个区域的最小值和最大值进行比较，以确定在表扫描期间要读取或跳过的块区域。</p>
                     <p>区域地图修剪的候选者包括以下谓词：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>关系谓词=，&lt;=，&lt;，&gt;，&gt; =</p>
                        </li>
                        <li>
                           <p>（格式为<code class="codeph">column_name</code> <code class="codeph">relational_predicate</code> <code class="codeph">constant</code> ，例如， <code class="codeph">WHERE country_name='US'</code>或<code class="codeph">WHERE country_name=:name</code> ）</p>
                        </li>
                        <li>
                           <p><code class="codeph">IN</code>列表（例如， <code class="codeph">WHERE product_name IN ('a','b')</code> ）</p>
                        </li>
                        <li>
                           <p><code class="codeph">LIKE</code>谓词后缀为<code class="codeph">%</code> （例如， <code class="codeph">company_name LIKE 'ORA%'</code> ）</p>
                        </li>
                     </ul>
                     <p>本节包含以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="using-zone-maps.html#GUID-C6BD71FC-BCD6-46D3-B0F0-AB1F26CC0E15">Oracle数据库如何使用区域映射执行修剪</a></p>
                        </li>
                        <li>
                           <p><a href="using-zone-maps.html#GUID-E91FA258-4538-4B14-ADAA-156B65A03F09">示例：使用区域映射和属性群集执行修剪</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="DWHSG9393"></a><div class="props_rev_3"><a id="GUID-C6BD71FC-BCD6-46D3-B0F0-AB1F26CC0E15" name="GUID-C6BD71FC-BCD6-46D3-B0F0-AB1F26CC0E15"></a><h4 id="DWHSG-GUID-C6BD71FC-BCD6-46D3-B0F0-AB1F26CC0E15" class="sect4"><span class="enumeration_section">14.4.1</span> Oracle数据库如何使用区域映射执行修剪</h4>
                  <div>
                     <p>本节使用以下示例说明如何使用区域映射和属性群集执行修剪：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="using-zone-maps.html#GUID-2814D6ED-6C38-4275-8BC5-09BB75A7DA84">使用区域映射修剪表</a></p>
                        </li>
                        <li>
                           <p><a href="using-zone-maps.html#GUID-C9F4766E-ED0E-4CEB-8C97-96326B29C536">使用区域映射和属性聚类修剪分区表</a></p>
                        </li>
                     </ul>
                  </div><a id="DWHSG9395"></a><a id="DWHSG9396"></a><a id="DWHSG9394"></a><div class="props_rev_3"><a id="GUID-2814D6ED-6C38-4275-8BC5-09BB75A7DA84" name="GUID-2814D6ED-6C38-4275-8BC5-09BB75A7DA84"></a><h5 id="DWHSG-GUID-2814D6ED-6C38-4275-8BC5-09BB75A7DA84" class="sect5"><span class="enumeration_section">14.4.1.1</span>使用区域映射修剪表</h5>
                     <div>
                        <p>此示例说明如何创建区域映射，该映射可以修剪其谓词包含常量的查询中的数据。使用以下语句创建<a href="using-zone-maps.html#GUID-2814D6ED-6C38-4275-8BC5-09BB75A7DA84__CIHBGDBJ" title="此表显示lineitem表中数据的数据块和列值。">表14-1中</a>所示的<code class="codeph">lineitem</code>表：</p><pre class="oac_no_warn" dir="ltr">CREATE TABLE lineitem（orderkey NUMBER，shipdate DATE，receipttdate DATE，destination VARCHAR2（50），Quantity NUMBER）;</pre><p>假设该表包含四个数据块，每个块有两行。<a href="using-zone-maps.html#GUID-2814D6ED-6C38-4275-8BC5-09BB75A7DA84__CIHBGDBJ" title="This table shows the data blocks and column values for data in the lineitem table.">表14-1</a>显示了<a href="using-zone-maps.html#GUID-2814D6ED-6C38-4275-8BC5-09BB75A7DA84__CIHBGDBJ" title="此表显示lineitem表中数据的数据块和列值。">表</a>的八行。
                        </p>
                        <div class="tblformal" id="GUID-2814D6ED-6C38-4275-8BC5-09BB75A7DA84__CIHBGDBJ">
                           <p class="titleintable">表14-1 lineitem表的数据块</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="lineitem表的数据块" width="100%" border="1" summary="This table shows the data blocks and column values for data in the lineitem table." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="11%" id="d56099e2431">块</th>
                                    <th align="left" valign="bottom" width="14%" id="d56099e2434">orderkey</th>
                                    <th align="left" valign="bottom" width="17%" id="d56099e2437">发货日期</th>
                                    <th align="left" valign="bottom" width="18%" id="d56099e2440">发票日期</th>
                                    <th align="left" valign="bottom" width="21%" id="d56099e2443">目的地</th>
                                    <th align="left" valign="bottom" width="19%" id="d56099e2446">数量</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="11%" id="d56099e2451" headers="d56099e2431 ">
                                       <p>1</p>
                                    </td>
                                    <td align="left" valign="top" width="14%" headers="d56099e2451 d56099e2434 ">
                                       <p>1</p>
                                    </td>
                                    <td align="left" valign="top" width="17%" headers="d56099e2451 d56099e2437 ">
                                       <p>2011年1月1日</p>
                                    </td>
                                    <td align="left" valign="top" width="18%" headers="d56099e2451 d56099e2440 ">
                                       <p>2011年1月10日</p>
                                    </td>
                                    <td align="left" valign="top" width="21%" headers="d56099e2451 d56099e2443 ">
                                       <p>San_Fran</p>
                                    </td>
                                    <td align="left" valign="top" width="19%" headers="d56099e2451 d56099e2446 ">
                                       <p>100</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="11%" id="d56099e2470" headers="d56099e2431 ">
                                       <p>1</p>
                                    </td>
                                    <td align="left" valign="top" width="14%" headers="d56099e2470 d56099e2434 ">
                                       <p>2</p>
                                    </td>
                                    <td align="left" valign="top" width="17%" headers="d56099e2470 d56099e2437 ">
                                       <p>2011年1月2日</p>
                                    </td>
                                    <td align="left" valign="top" width="18%" headers="d56099e2470 d56099e2440 ">
                                       <p>2011年1月10日</p>
                                    </td>
                                    <td align="left" valign="top" width="21%" headers="d56099e2470 d56099e2443 ">
                                       <p>San_Fran</p>
                                    </td>
                                    <td align="left" valign="top" width="19%" headers="d56099e2470 d56099e2446 ">
                                       <p>200</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="11%" id="d56099e2489" headers="d56099e2431 ">
                                       <p>2</p>
                                    </td>
                                    <td align="left" valign="top" width="14%" headers="d56099e2489 d56099e2434 ">
                                       <p>3</p>
                                    </td>
                                    <td align="left" valign="top" width="17%" headers="d56099e2489 d56099e2437 ">
                                       <p>2011年1月3日</p>
                                    </td>
                                    <td align="left" valign="top" width="18%" headers="d56099e2489 d56099e2440 ">
                                       <p>2011年1月5日</p>
                                    </td>
                                    <td align="left" valign="top" width="21%" headers="d56099e2489 d56099e2443 ">
                                       <p>San_Fran</p>
                                    </td>
                                    <td align="left" valign="top" width="19%" headers="d56099e2489 d56099e2446 ">
                                       <p>100</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="11%" id="d56099e2508" headers="d56099e2431 ">
                                       <p>2</p>
                                    </td>
                                    <td align="left" valign="top" width="14%" headers="d56099e2508 d56099e2434 ">
                                       <p>4</p>
                                    </td>
                                    <td align="left" valign="top" width="17%" headers="d56099e2508 d56099e2437 ">
                                       <p>2011年1月5日</p>
                                    </td>
                                    <td align="left" valign="top" width="18%" headers="d56099e2508 d56099e2440 ">
                                       <p>2011年1月10日</p>
                                    </td>
                                    <td align="left" valign="top" width="21%" headers="d56099e2508 d56099e2443 ">
                                       <p>圣地亚哥</p>
                                    </td>
                                    <td align="left" valign="top" width="19%" headers="d56099e2508 d56099e2446 ">
                                       <p>100</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="11%" id="d56099e2527" headers="d56099e2431 ">
                                       <p>3</p>
                                    </td>
                                    <td align="left" valign="top" width="14%" headers="d56099e2527 d56099e2434 ">
                                       <p>五</p>
                                    </td>
                                    <td align="left" valign="top" width="17%" headers="d56099e2527 d56099e2437 ">
                                       <p>2011年1月10日</p>
                                    </td>
                                    <td align="left" valign="top" width="18%" headers="d56099e2527 d56099e2440 ">
                                       <p>2011年1月15日</p>
                                    </td>
                                    <td align="left" valign="top" width="21%" headers="d56099e2527 d56099e2443 ">
                                       <p>San_Fran</p>
                                    </td>
                                    <td align="left" valign="top" width="19%" headers="d56099e2527 d56099e2446 ">
                                       <p>100</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="11%" id="d56099e2546" headers="d56099e2431 ">
                                       <p>3</p>
                                    </td>
                                    <td align="left" valign="top" width="14%" headers="d56099e2546 d56099e2434 ">
                                       <p>6</p>
                                    </td>
                                    <td align="left" valign="top" width="17%" headers="d56099e2546 d56099e2437 ">
                                       <p>2011年1月12日</p>
                                    </td>
                                    <td align="left" valign="top" width="18%" headers="d56099e2546 d56099e2440 ">
                                       <p>2011年1月16日</p>
                                    </td>
                                    <td align="left" valign="top" width="21%" headers="d56099e2546 d56099e2443 ">
                                       <p>San_Fran</p>
                                    </td>
                                    <td align="left" valign="top" width="19%" headers="d56099e2546 d56099e2446 ">
                                       <p>200</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="11%" id="d56099e2565" headers="d56099e2431 ">
                                       <p>4</p>
                                    </td>
                                    <td align="left" valign="top" width="14%" headers="d56099e2565 d56099e2434 ">
                                       <p>7</p>
                                    </td>
                                    <td align="left" valign="top" width="17%" headers="d56099e2565 d56099e2437 ">
                                       <p>2011年1月13日</p>
                                    </td>
                                    <td align="left" valign="top" width="18%" headers="d56099e2565 d56099e2440 ">
                                       <p>2011年1月20日</p>
                                    </td>
                                    <td align="left" valign="top" width="21%" headers="d56099e2565 d56099e2443 ">
                                       <p>San_Fran</p>
                                    </td>
                                    <td align="left" valign="top" width="19%" headers="d56099e2565 d56099e2446 ">
                                       <p>100</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="11%" id="d56099e2584" headers="d56099e2431 ">
                                       <p>4</p>
                                    </td>
                                    <td align="left" valign="top" width="14%" headers="d56099e2584 d56099e2434 ">
                                       <p>8</p>
                                    </td>
                                    <td align="left" valign="top" width="17%" headers="d56099e2584 d56099e2437 ">
                                       <p>2011年1月15日</p>
                                    </td>
                                    <td align="left" valign="top" width="18%" headers="d56099e2584 d56099e2440 ">
                                       <p>2011年1月30日</p>
                                    </td>
                                    <td align="left" valign="top" width="21%" headers="d56099e2584 d56099e2443 ">
                                       <p>圣荷西</p>
                                    </td>
                                    <td align="left" valign="top" width="19%" headers="d56099e2584 d56099e2446 ">
                                       <p>100</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>接下来，使用<code class="codeph">CREATE</code> <code class="codeph">MATERIALED</code> <code class="codeph">ZONEMAP</code>语句在<code class="codeph">lineitem</code>表上创建区域映射。
                        </p><pre class="oac_no_warn" dir="ltr">在线条上创建材料化的ZONEMAP lineitem_zmap（orderkey，shipdate，receiptdate）;</pre><p>每个区域包含两个块，并存储<code class="codeph">orderkey</code> ， <code class="codeph">shipdate</code>和<code class="codeph">receiptdate</code>列的最小值和最大值。<a href="using-zone-maps.html#GUID-2814D6ED-6C38-4275-8BC5-09BB75A7DA84__CIHEJACJ" title="此表显示lineitem表中数据的数据块范围和列值。">表14-2</a>表示区域图。
                        </p>
                        <div class="tblformal" id="GUID-2814D6ED-6C38-4275-8BC5-09BB75A7DA84__CIHEJACJ">
                           <p class="titleintable">表14-2 lineitem表的区域图</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="lineitem表的区域图" width="100%" border="1" summary="This table shows the data block range and column values for the data in the lineitem table." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="12%" id="d56099e2649">块范围</th>
                                    <th align="left" valign="bottom" width="14%" id="d56099e2652">min orderkey</th>
                                    <th align="left" valign="bottom" width="14%" id="d56099e2655">最大订单</th>
                                    <th align="left" valign="bottom" width="14%" id="d56099e2658">min shipdate</th>
                                    <th align="left" valign="bottom" width="14%" id="d56099e2661">最大发货日期</th>
                                    <th align="left" valign="bottom" width="15%" id="d56099e2664">最小收据</th>
                                    <th align="left" valign="bottom" width="17%" id="d56099e2667">最大收据</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="12%" id="d56099e2672" headers="d56099e2649 ">
                                       <p>1-2</p>
                                    </td>
                                    <td align="left" valign="top" width="14%" headers="d56099e2672 d56099e2652 ">
                                       <p>1</p>
                                    </td>
                                    <td align="left" valign="top" width="14%" headers="d56099e2672 d56099e2655 ">
                                       <p>4</p>
                                    </td>
                                    <td align="left" valign="top" width="14%" headers="d56099e2672 d56099e2658 ">
                                       <p>2011年1月1日</p>
                                    </td>
                                    <td align="left" valign="top" width="14%" headers="d56099e2672 d56099e2661 ">
                                       <p>2011年1月5日</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d56099e2672 d56099e2664 ">
                                       <p>2011年1月9日</p>
                                    </td>
                                    <td align="left" valign="top" width="17%" headers="d56099e2672 d56099e2667 ">
                                       <p>2011年1月10日</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="12%" id="d56099e2694" headers="d56099e2649 ">
                                       <p>3-4</p>
                                    </td>
                                    <td align="left" valign="top" width="14%" headers="d56099e2694 d56099e2652 ">
                                       <p>五</p>
                                    </td>
                                    <td align="left" valign="top" width="14%" headers="d56099e2694 d56099e2655 ">
                                       <p>8</p>
                                    </td>
                                    <td align="left" valign="top" width="14%" headers="d56099e2694 d56099e2658 ">
                                       <p>2011年1月10日</p>
                                    </td>
                                    <td align="left" valign="top" width="14%" headers="d56099e2694 d56099e2661 ">
                                       <p>2011年1月15日</p>
                                    </td>
                                    <td align="left" valign="top" width="15%" headers="d56099e2694 d56099e2664 ">
                                       <p>2011年1月15日</p>
                                    </td>
                                    <td align="left" valign="top" width="17%" headers="d56099e2694 d56099e2667 ">
                                       <p>2011年1月30日</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>执行以下查询时，数据库可以读取区域映射，然后仅扫描块1和2，因为日期1-3-2011介于最小和最大日期之间：</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM lineitem WHERE shipdate ='1-3-2011';</pre></div>
                  </div><a id="DWHSG9398"></a><a id="DWHSG9397"></a><div class="props_rev_3"><a id="GUID-C9F4766E-ED0E-4CEB-8C97-96326B29C536" name="GUID-C9F4766E-ED0E-4CEB-8C97-96326B29C536"></a><h5 id="DWHSG-GUID-C9F4766E-ED0E-4CEB-8C97-96326B29C536" class="sect5"><span class="enumeration_section">14.4.1.2</span>使用区域映射和属性聚类修剪分区表</h5>
                     <div>
                        <p>以下语句在分区表上创建带有属性集群的区域映射：</p><pre class="oac_no_warn" dir="ltr">CREATE TABLE销售（NUMBER PROD_ID NOT NULL，CUST_ID NUMBER NOT NULL，TIME_ID DATE NOT NULL，CHANNEL_ID NUMBER NOT NULL，PROMO_ID NUMBER NOT NULL，quantity_sold NUMBER（10,2）NOT NULL，AMOUNT_SOLD NUMBER（10,2）） <span>聚类</span> <span>销售JOIN产品ON（sales.prod_id = products.prod_id）</span> <span>BY LINEAR ORDER</span> <span>（products.prod_id）</span> <span>WITH MATERIALIZED ZONEMAP</span> （sales_zmap）PARTITION BY HASH（amount_sold）（PARTITION p1，PARTITION p2）;</pre><p><a href="using-zone-maps.html#GUID-C9F4766E-ED0E-4CEB-8C97-96326B29C536__CIHDGJGJ">图14-4</a>说明了为分区表<code class="codeph">sales</code>创建区域映射。对于五个区域中的每个区域，区域图将存储区域图中跟踪的列的最小值和最大值。如果谓词超出给定区域的存储列的最小值和最大值，则不必读取该区域。例如，如果区域<code class="codeph">Z4</code>跟踪列<code class="codeph">prod_id</code>的最小值10和最大值100，则谓词<code class="codeph">prod_id</code> <code class="codeph">=</code> <code class="codeph">200</code>将永远不会在此区域中具有任何匹配记录，因此将不会读取区域<code class="codeph">Z4</code> 。
                        </p>
                        <p>对于分区表，修剪既可以在分区上进行，也可以在区域级别进行。如果区域映射中的聚合分区级别信息排除了给定谓词集的任何匹配数据，则将修剪整个分区;否则，将在每个区域级别进行分区修剪。</p>
                        <div class="figure" id="GUID-C9F4766E-ED0E-4CEB-8C97-96326B29C536__CIHDGJGJ">
                           <p class="titleinfigure">图14-4分区事实表的区域图</p><img src="img/dwhsg137.png" alt="下面是图14-4的描述" title="下面是图14-4的描述" longdesc="img_text/dwhsg137.html"><br><a href="img_text/dwhsg137.html">“图14-4分区事实表的区域图”的描述</a></div>
                        <!-- class="figure" -->
                     </div>
                  </div>
               </div><a id="DWHSG9399"></a><a id="DWHSG8949"></a><div class="props_rev_3"><a id="GUID-E91FA258-4538-4B14-ADAA-156B65A03F09" name="GUID-E91FA258-4538-4B14-ADAA-156B65A03F09"></a><h4 id="DWHSG-GUID-E91FA258-4538-4B14-ADAA-156B65A03F09" class="sect4"><span class="enumeration_section">14.4.2</span>示例：使用区域映射和属性聚类执行修剪</h4>
                  <div>
                     <p>本节提供有关使用区域映射和属性群集执行修剪的示例。这些示例基于如<a href="using-zone-maps.html#GUID-E91FA258-4538-4B14-ADAA-156B65A03F09__CIHEHFIE">示例14-16中</a>所示创建的<code class="codeph">my_sales</code>表。
                     </p>
                     <div class="example" id="GUID-E91FA258-4538-4B14-ADAA-156B65A03F09__CIHEHFIE">
                        <p class="titleinexample">示例14-16创建my_sales表</p>
                        <p><code class="codeph">my_sales</code>表是一个包含区域映射的连接属性聚簇表。它基于<code class="codeph">SH</code>模式中的<code class="codeph">sales</code>表，并使用以下语句创建：</p><pre class="oac_no_warn" dir="ltr">CREATE TABLE my_sales PARTITION BY LIST（channel_id）（PARTITION mysales_chan_c VALUES（'C'），PARTITION mysales_chan_i VALUES（'I'），PARTITION mysales_chan_p VALUES（'P'），PARTITION mysales_chan_s VALUES（'S'），PARTITION mysales_chan_t VALUES（ 'T'））CLUSTERING my_sales JOIN customers ON（my_sales.cust_id = customers.cust_id）BY INTERLEAVED ORDER（（my_sales.time_id），（customers.country_id，customers.cust_state_province，customers.cust_city））WITH MATERIALIZED ZONEMAP（mysales_zmap）AS SELECT * FROM sales;</pre></div>
                     <!-- class="example" -->
                     <p>本节包含以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="using-zone-maps.html#GUID-82200641-EF9A-41FD-A2DE-536B49A4F6C7">示例：分区和表扫描修剪</a></p>
                        </li>
                        <li>
                           <p><a href="using-zone-maps.html#GUID-5754CBC5-CCA4-4A1D-9721-1AC2AC6E2A85">示例：区域映射加入修剪</a></p>
                        </li>
                     </ul>
                  </div><a id="DWHSG9400"></a><div class="props_rev_3"><a id="GUID-82200641-EF9A-41FD-A2DE-536B49A4F6C7" name="GUID-82200641-EF9A-41FD-A2DE-536B49A4F6C7"></a><h5 id="DWHSG-GUID-82200641-EF9A-41FD-A2DE-536B49A4F6C7" class="sect5"><span class="enumeration_section">14.4.2.1</span>示例：分区和表扫描修剪</h5>
                     <div>
                        <div class="section">
                           <p>此示例说明了区域映射如何修剪区域和分区（或复合分区表中的子分区）。</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>创建<code class="codeph">my_sales</code>表。<a href="using-zone-maps.html#GUID-E91FA258-4538-4B14-ADAA-156B65A03F09__CIHEHFIE">示例14-16</a>包含用于创建此表的语法。</span></li>
                           <li class="stepexpand"><span>使用以下语句查询与<code class="codeph">customers</code>维度连接的<code class="codeph">my_sales</code>表：</span><div><pre class="oac_no_warn" dir="ltr">SELECT c.cust_city，SUM（quantity_sold）FROM my_sales s，customers c WHERE s.cust_id = c.cust_id AND c.country_id ='US'AND c.cust_state_province ='CA'AND s.promo_id &lt;50 GROUP BY c.cust_city ;</pre></div>
                           </li>
                           <li class="stepexpand"><span>使用以下语句显示计划：</span><div><pre class="oac_no_warn" dir="ltr">SELECT * FROM TABLE（dbms_xplan.display_cursor（FORMAT =&gt;'BASIC PREDICATE PARTITION'））;</pre><pre class="oac_no_warn" dir="ltr">-------------------------------------------------- ----------------------- | Id |操作|名称| Pstart时| Pstop | -------------------------------------------------- ----------------------- | 0 |选择声明| | | | | 1 | HASH GROUP BY | | | | | * 2 | HASH JOIN | | | | | 3 |加入过滤器创建| ：BF0000 | | | | * 4 |表访问完全|客户| | | | 5 |加入过滤器使用| ：BF0000 | | | | 6 | PARTITION LIST ITERATOR | | KEY（ZM）| KEY（ZM）| | * 7 |完全使用ZONEMAP的表访问| MY_SALES | KEY（ZM）| KEY（ZM）| -------------------------------------------------- -----------------------谓词信息（由操作ID标识）：PLAN_TABLE_OUTPUT ----------------- -------------------------------------------------- ------ 2  - 访问（“S”。“CUST_ID”=“C”。“CUST_ID”）4  - 过滤器（（“C”。“CUST_STATE_PROVINCE”='CA'和“C”。“COUNTRY_ID” ='US'））7  - 过滤器（（SYS_ZMAP_FILTER（'/ * ZM_PRUNING * / SELECT“ZONE_ID $”，BITAND时的情况（zm。“ZONE_STATE $”，1）= 1那么1个案例时（zm。“MIN_2_COUNTRY_ID “&gt;：1 OR zm。”MAX_2_COUNTRY_ID“&lt;：2 OR zm。”MIN_3_CUST_STATE_PROVINCE“&gt;：3或zm。”MAX_3_CUST_STATE_PROVINCE“&lt;：4）那么3 ELSE 2 END END从”SH“开始。”MYSALES_ZMAP“zm在哪里zm。 “ZONE_LEVEL $”= 0 ORDER BY zm。“ZONE_ID $”'，SYS_OP_ZONE_ID（ROWID），'US'，'U S'，'CA'，'CA'）&lt;3 AND“S”。“PROMO_ID”&lt;50 AND SYS_OP_BLOOM_FILTER（：BF0000，“S”。“CUST_ID”）））</pre><p>第7行说明正在使用区域地图。请注意区域映射分区列表迭代器“KEY（ZM）”。</p>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="DWHSG9401"></a><div class="props_rev_3"><a id="GUID-5754CBC5-CCA4-4A1D-9721-1AC2AC6E2A85" name="GUID-5754CBC5-CCA4-4A1D-9721-1AC2AC6E2A85"></a><h5 id="DWHSG-GUID-5754CBC5-CCA4-4A1D-9721-1AC2AC6E2A85" class="sect5"><span class="enumeration_section">14.4.2.2</span>示例：区域映射加入修剪</h5>
                     <div>
                        <div class="section">
                           <p>此示例说明了使用区域映射和属性群集进行连接修剪。如果维度的主键包含维度层次结构值，则通过相应的外键对事实表进行聚类就足够了。在该示例中， <code class="codeph">times.time_id</code>包括（ <code class="codeph">calendar_year</code> ， <code class="codeph">calendar_month_number</code> ， <code class="codeph">day_number_in_month</code> ）。因此， <code class="codeph">time_id</code>转换为日历时间层次结构以及财务时间层次结构。当存在财务或日历层次结构的谓词时，您可以在<code class="codeph">times</code>和<code class="codeph">my_sales</code>之间修剪连接。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>创建<code class="codeph">my_sales</code>表。<a href="using-zone-maps.html#GUID-E91FA258-4538-4B14-ADAA-156B65A03F09__CIHEHFIE">示例14-16</a>包含用于创建此表的语法。</span></li>
                           <li class="stepexpand"><span>使用以下语句查询与<code class="codeph">times</code>连接的<code class="codeph">my_sales</code>表：</span><div><pre class="oac_no_warn" dir="ltr">SELECT SUM（quantity_sold）FROM my_sales s，times tWHERE s.time_id = t.time_id AND t.calendar_year ='1999';</pre></div>
                           </li>
                           <li class="stepexpand"><span>使用以下语句显示计划：</span><div><pre class="oac_no_warn" dir="ltr">SELECT * FROM TABLE（dbms_xplan.display_cursor（FORMAT =&gt;'BASIC PREDICATE PARTITION'））;</pre><pre class="oac_no_warn" dir="ltr">-------------------------------------------------- ------------------------- | Id |操作|名称| Pstart时| Pstop | -------------------------------------------------- ------------------------- | 0 |选择声明| | | | | 1 | SORT AGGREGATE | | | | | * 2 | HASH JOIN | | | | | 3 |加入过滤器创建| ：BF0000 | | | | * 4 |表访问完全|时代| | | | 5 |加入过滤器使用| ：BF0000 | | | | 6 | PARTITION LIST ALL | | 1 | 5 | | * 7 |完全使用ZONEMAP的表访问| MY_SALES | 1 | 5 | -------------------------------------------------- -------------------------谓词信息（由操作ID标识）：---------------- ----------------------------------- PLAN_TABLE_OUTPUT -------------- -------------------------------------- 2  -  access（“S”。“TIME_ID”= “T”。“TIME_ID”）4  - 过滤器（“T”。“CALENDAR_YEAR”= 1999）7  - 过滤器（（SYS_ZMAP_FILTER（'/ * ZM_PRUNING * / SELECT“ZONE_ID $”，BITAND时的情况（zm。“ZONE_STATE $ “，1）= 1那么1个案例时（（ORA_RAWCOMPARE（zm。”MIN_1_TIME_ID“，：1,8）&gt; 0或ORA_RAWCOMPARE（zm。”MAX_1_TIME_ID“，：2,8）&lt;0））那么3 ELSE 2 END END FROM“SH”。“MYSALES_ZMAP”zm WHERE zm。“ZONE_LEVEL $”= 0 ORDER BY zm。“ZONE_ID $”'，SYS_OP_ZONE_ID（ROWID），SYSVARCOL，SYSVARCOL）&lt;3 AND SYS_OP_BLOOM_FILTER（：BF0000，“S” “TIME_ID”）））</pre><p>第7行说明正在使用区域地图，连接匹配的<code class="codeph">time_id</code>区域。
                                 </p>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div>
            </div><a id="DWHSG9402"></a><div class="props_rev_3"><a id="GUID-DA1762AC-4F66-4DDA-A28A-8A754FB6E75E" name="GUID-DA1762AC-4F66-4DDA-A28A-8A754FB6E75E"></a><h3 id="DWHSG-GUID-DA1762AC-4F66-4DDA-A28A-8A754FB6E75E" class="sect3"><span class="enumeration_section">14.5</span>查看区域地图信息</h3>
               <div>
                  <p>信息<a id="d56099e3026" class="indexterm-anchor"></a>关于区域地图及其度量存储在数据字典视图中。
                  </p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="using-zone-maps.html#GUID-945125B2-FD0C-438E-90D8-1335B9190860">在数据库中查看区域映射的详细信息</a></p>
                     </li>
                     <li>
                        <p><a href="using-zone-maps.html#GUID-A68118DA-01A5-41F6-87EF-3EB6C1742D26">查看区域地图的度量</a></p>
                     </li>
                  </ul>
               </div><a id="DWHSG9403"></a><div class="props_rev_3"><a id="GUID-945125B2-FD0C-438E-90D8-1335B9190860" name="GUID-945125B2-FD0C-438E-90D8-1335B9190860"></a><h4 id="DWHSG-GUID-945125B2-FD0C-438E-90D8-1335B9190860" class="sect4"><span class="enumeration_section">14.5.1</span>查看数据库中区域映射的详细信息</h4>
                  <div>
                     <div class="section">
                        <p>使用以下数据字典视图之一显示有关数据库中区域映射的信息：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">DBA_ZONEMAPS</code>显示数据库中的所有区域映射</p>
                           </li>
                           <li>
                              <p><code class="codeph">ALL_ZONEMAPS</code>显示用户可访问的区域映射</p>
                           </li>
                           <li>
                              <p><code class="codeph">USER_ZONEMAPS</code>显示用户拥有的区域映射</p>
                           </li>
                        </ul>
                        <p>以下查询显示当前用户拥有的区域映射的名称，基表，类型，刷新模式和过期性，并指示是否使用属性集群创建区域映射：</p><pre class="oac_no_warn" dir="ltr">SELECT zonemap_name，fact_table，hierarchical，with_clustering，refresh_mode，stale FROM USER_ZONEMAPS; ZONEMAP_NAME FACT_TABLE HIERARCHICAL WITH_CLUSTERING REFRESH_MODE STALE ------------ ---------- ------------ ---------- ----- ------------ ----- ZMAP $ _MY_SALES MY_SALES NO YES LOAD DATAMOVEMENT NO</pre><p>以下查询显示用户可访问的所有区域映射的状态。禁用<code class="codeph">PRUNING</code>区域映射不用于I / O修剪。标记为无效的区域映射需要重新编译，因为底层基表的结构已更改。
                        </p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT zonemap_name，pruning，refresh_method，invalid，complie_state FROM all_zonemaps; ZONEMAP_NAME PRUNING REFRESH_METHOD INVALID UNUSABLE COMPILE_STATE ------------ --------- -------------- -------  - ---- ------------- SALES_ZMAP启用力量无效ZMAP $ _MY_SALES禁用力量无效</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DWHSG9404"></a><div class="props_rev_3"><a id="GUID-A68118DA-01A5-41F6-87EF-3EB6C1742D26" name="GUID-A68118DA-01A5-41F6-87EF-3EB6C1742D26"></a><h4 id="DWHSG-GUID-A68118DA-01A5-41F6-87EF-3EB6C1742D26" class="sect4"><span class="enumeration_section">14.5.2</span>查看区域图的度量</h4>
                  <div>
                     <div class="section">
                        <p>使用以下视图之一显示有关区域映射中度量的信息：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">DBA_ZONEMAP_MEASURES</code>用于显示数据库中所有区域映射的度量</p>
                           </li>
                           <li>
                              <p><code class="codeph">ALL_ZONEMAP_MEASURES</code>用于显示用户可访问的区域映射的度量</p>
                           </li>
                           <li>
                              <p><code class="codeph">USER_ZONEMAP_MEASURES</code>用于显示用户拥有的区域映射的度量</p>
                           </li>
                        </ul>
                        <p>以下查询显示区域映射，度量和列，其中为当前用户可访问的每个区域维护其MIN / MAX值：</p><pre class="oac_no_warn" dir="ltr">SELECT zonemap_name，measure，agg_function FROM ALL_ZONEMAP_MEASURES; ZONEMAP_NAME MEASURE AGG_FUNCTION --------------- -------------------------- ------ ------- ZMAP $ _MY_SALES“SH”。“MY_SALES”。“PROD_ID”MAX ZMAP $ _MY_SALES“SH”。“MY_SALES”。“PROD_ID”MIN ZMAP $ _MY_SALES“SH”。“MY_SALES”。“CUST_ID “MAX ZMAP $ _MY_SALES”SH“。”MY_SALES“。”CUST_ID“MIN</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>