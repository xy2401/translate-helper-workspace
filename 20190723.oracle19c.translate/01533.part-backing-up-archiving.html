<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>备份和存档数据</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96241-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="using-flasback-database-restore-points.html" title="Previous" type="text/html"></link>
      <link rel="next" href="rman-backup-concepts.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="BRADV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="using-flasback-database-restore-points.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="rman-backup-concepts.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复用户指南</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">备份和存档数据</li>
            </ol>
            <a id="GUID-008E0F84-E623-4467-8706-A99B34002DD6" name="GUID-008E0F84-E623-4467-8706-A99B34002DD6"></a><a id="BRADV191"></a>
            
            <h2 id="BRADV-GUID-008E0F84-E623-4467-8706-A99B34002DD6" class="sect2"><span class="enumeration_part">第三部分</span>备份和存档数据</h2>
         </header>
         <div class="ind">
            <div>
               <p>本部分的章节介绍了如何使用RMAN实用程序执行高级备份和恢复操作，并解释了RMAN性能调整和故障排除。</p>
               <p>这部分包含以下章节：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="rman-backup-concepts.html#GUID-B3380142-ABCD-437F-9E06-B219D74E6738" title="使用RMAN BACKUP命令创建一致和不一致的备份。当数据库处于一致状态时，将发生一致的备份。您可以使用BACKUP命令对数据库进行一致的备份。任何不一致的数据库备份都是不一致的备份。数据库打开时进行的备份不一致，实例失败或SHUTDOWN ABORT命令后进行备份也是如此。您可以创建RMAN备份或用户管理的备份。在RMAN中执行BACKUP命令时，您将创建一个或多个备份集或映像副本。默认情况下，无论目标是磁盘还是媒体管理器，RMAN都会创建备份集。RMAN可以将备份数据存储在称为备份集的逻辑结构中，该备份集是RMAN备份的最小单元。创建备份集时，RMAN可以使用块压缩。使用未使用的块压缩时，RMAN会跳过读取和备份当前未分配给某个数据库对象的任何数据库块。这与先前是否已分配这些块无关。当使用空块压缩时，RMAN从其输出中省略任何从未包含数据的块。RMAN支持备份集的二进制压缩。二进制压缩仅在BACKUP命令中指定AS COMPRESSED BACKUPSET时启用，或者一次使用配置设备类型[DISK | SBT] BACKUP TYPE TO COMPRESSED BACKUPSET命令。在备份撤消优化中，RMAN排除了恢复备份时不需要的撤销，即已经提交的事务。RMAN支持备份集的备份加密。您可以使用基于密钥库的透明加密，基于密码的加密或两者。您可以让RMAN确定备份片段的唯一名称，也可以使用FORMAT子句指定名称。默认情况下，备份集包含一个备份片。要限制每个备份片的大小，请指定CONFIGURE CHANNEL或ALLOCATE CHANNEL命令的MAXPIECESIZE选项。您可以使用BACKUP命令的backupSpec子句指定要备份的对象。每个backupSpec子句至少生成一个备份集。创建备份集时，RMAN可以同时从磁盘读取多个文件，然后将其块写入同一备份集。例如，RMAN可以同时读取两个数据文件，然后将这些数据文件中的块组合成一个备份片。来自多个文件的块组合称为备份多路复用。在代理副本期间，RMAN将数据传输的控制权转交给支持此功能的媒体管理器。代理副本只能与支持它的媒体管理器一起使用，不能与DISK类型的通道一起使用。 BACKUP命令的PROXY选项指定备份是代理副本。映像副本是单个数据文件，归档重做日志文件或控制文件的精确副本。要创建映像副本并将其记录在RMAN存储库中，请运行RMAN BACKUP AS COPY命令。RMAN可以使用由RMAN外部的机制创建的映像副本，例如本机操作系统文件复制命令或将文件的映像副本保留在磁盘上的第三方实用程序。此类副本称为用户管理的备份或操作系统备份。您可以使用RMAN BACKUP命令从稀疏数据文件，包含稀疏数据文件的表空间，稀疏可插拔数据库（PDB）和包含稀疏PDB的多租户容器数据库（CDB）备份数据块。预包装备份是在非CDB或PDB插入其他CDB之前创建的非CDB或PDB的RMAN备份.RMAN使您可以创建多个相同的备份副本。RMAN BACKUP BACKUPSET命令备份在磁盘上创建的备份集。该命令是在多个媒体之间传播备份的有用方法。在许多恢复情况下，最近备份控制文件和服务器参数文件非常有用。为确保您备份这些文件，数据库支持控制文件和服务器参数文件自动备份。根据目标数据库的配置，RMAN可以执行控制文件和服务器参数文件的自动备份。在备份作业期间分配的第一个通道创建自动备份并将其放入其自己的备份集中。对于数据库结构更改后的自动备份，与结构更改关联的服务器进程进行备份。增量备份仅复制自上次备份以来已更改的数据块。您可以使用RMAN创建数据文件，表空间或整个数据库的增量备份。RMAN可以创建多级增量备份。每个增量级别由值0或1表示。在差异级别1备份中，RMAN备份自级别1（累积或差异）或级别0的最新增量备份以来已更改的所有块。在累积级别1备份中，RMAN备份自当前或父级化身中最近的0级增量备份以来使用的所有块。增量备份的块更改跟踪功能通过在块更改跟踪文件中记录每个数据文件中的更改块来提高增量备份性能。在介质恢复期间，RMAN会检查还原的文件，以确定是否可以使用增量备份来恢复它们。如果可以选择，则RMAN始终在归档重做日志上选择增量备份，因为在块级别应用更改比应用重做更快。备份永久备份策略消除了在备份到零数据丢失恢复设备（恢复设备）时创建重复完整备份的需要。虽然Recovery Appliance支持其他RMAN备份策略，但是持续备份的推荐方法是永久增量备份策略。您可以使用CONFIGURE RETENTION POLICY命令创建持久性和自动备份保留策略。恢复窗口是一个以当前时间开始并向后延伸到可恢复点的时间段。可恢复性是假设时间点恢复的最早时间，也就是说，在媒体故障后您可以恢复的最早时间点。在某些情况下，使用恢复窗口会使磁盘空间规划复杂化，因为必须保留的备份数量不是恒定的，并且取决于备份计划。相反，基于冗余的保留策略指定必须保留每个数据文件的备份数。您可以运行REPORT OBSOLETE命令，以根据保留策略确定当前哪些备份已过时。如果配置快速恢复区域，则数据库使用内部算法选择快速恢复区域中不再需要的文件以满足配置的保留策略。">RMAN备份概念</a></p>
                  </li>
                  <li>
                     <p><a href="backing-up-database.html#GUID-93BAB347-063F-439E-BDF3-109AB8D1F8E7" title="使用BACKUP命令创建RMAN备份。RMAN备份的主要目的是保护您的数据。如果发生介质故障或灾难，则可以还原备份并恢复丢失的更改。您可以使用RMAN客户端中的BACKUP命令备份全部或部分数据库。您可以为BACKUP命令提供参数以覆盖默认备份选项。BACKUP命令采用DEVICE TYPE子句，指定是备份到磁盘还是磁带设备。RMAN可以在磁盘上创建备份作为映像副本或备份集。RMAN提供了一系列选项来命名BACKUP命令生成的文件。备份到磁盘时，您可以指定一种格式以将备份分布在多个驱动器上以提高性能。RMAN将一个称为标记的字符串附加到它创建的每个备份上，作为识别备份的一种方式。您可以接受默认标记，也可以使用BACKUP命令的TAG参数指定自己的标记。用户指定的标记是指示不同类别的备份或副本的用途或用法的有用方法。将TAG参数与BACKUP命令一起使用可指定备份集和映像副本的标记。创建备份集时，可以通过在BACKUP命令中包含AS COMPRESSED BACKUPSET选项，使用RMAN支持对备份集进行二进制压缩。通过多节备份，可以将大型数据文件划分为多个部分，这些部分可以跨多个通道并行备份。这提供了更快的备份性能和更好的恢复时间。在创建映像副本时，RMAN使用多个通道写入文件节。但是，此操作的输出是每个数据文件的一个副本。您可以在装入或打开数据库的情况下执行整个数据库备份。您可以使用BACKUP TABLESPACE命令备份一个或多个表空间，或使用BACKUP DATAFILE命令备份一个或多个数据文件。您可以在装入或打开数据库时备份控制文件。RMAN使用快照控制文件来确保读取一致的版本。控制文件的手动备份与控制文件自动备份不同。在备份BACKUP命令中指定的文件后，RMAN会进行控制文件自动备份。要进行手动备份，可以在备份其他文件时指定INCLUDE CURRENT CONTROLFILE或指定BACKUP CURRENT CONTROLFILE。在某些情况下，RMAN会自动备份当前服务器参数文件。BACKUP SPFILE命令显式备份参数文件。备份的服务器参数文件是实例当前使用的文件。只有在数据库关闭且处于一致状态时，才能以NOARCHIVELOG模式备份数据库。预打印备份确保在将非CDB作为PDB插入CDB后可以使用RMAN备份。使用BACKUP命令备份多租户容器数据库（CDB）和可插拔数据库（PDB）。RMAN和Oracle Enterprise Manager Cloud Control为多租户环境中的备份和恢复提供全面支持。备份整个多租户容器数据库（CDB）类似于备份非CDB。备份整个CDB时，RMAN会备份根，所有可插拔数据库（PDB）和归档重做日志。您可以使用RMAN仅备份根。由于根包含整个CDB的关键元数据，因此Oracle建议您定期备份根或备份整个CDB。Oracle Enterprise Manager云控制（云控制）可用于备份根。RMAN允许您使用BACKUP命令备份CDB中的一个或多个PDB。迁移PDB并将其插入到其他目标CDB后，PDB的预刷新备份可用于执行还原和恢复操作.Oracle Enterprise Manager云控制（云控制）可用于执行可插拔数据库（PDB）的备份。由于不同PDB中的表空间可以具有相同的名称，因此为了消除歧义，您必须直接连接到PDB以备份其一个或多个表空间。此示例创建CDB cdb_prod中包含的PDB my_pdb的预包装备份。CDB使用共享撤消，并在读写模式下打开。RMAN使您可以使用BACKUP命令在应用程序根，一个或多个应用程序PDB和应用程序容器上执行备份操作。RMAN可以备份应用程序容器，应用程序PDB和应用程序根目录。使用RMAN BACKUP命令备份应用程序根目录。使用BACKUP命令备份应用程序容器，该容器由应用程序根目录和属于应用程序根目录的所有应用程序PDB组成。BACKUP命令用于备份一个或多个应用程序PDB。使用BACKUP命令备份稀疏数据库。RMAN使您可以使用备份集或映像副本格式中的备份整个数据库的步骤来备份稀疏数据库。您可以使用BACKUP命令备份包含稀疏数据文件或单个稀疏数据文件的一个或多个表空间。RMAN使您可以备份CDB中的一个或多个稀疏PDB。归档重做日志是成功恢复媒体的关键。你应该定期备份它们。RMAN备份的若干功能特定于归档重做日志。例如，您可以使用BACKUP ...删除以将备份到备份集后从磁盘中删除一个或所有归档重做日志副本。即使您的重做日志存档到多个目标并且您使用RMAN备份存档的重做日志，RMAN也只选择一个存档的重做日志文件副本以包含在备份集中。由于具有相同日志序列号的日志相同，因此RMAN不需要包含多个日志副本。自动在线重做日志切换是一项重要的RMAN功能。在CDB中，只有当您以具有SYSDBA或SYSBACKUP权限的普通用户身份连接到根时，才能备份存档的重做日志。要备份存档日志，请使用BACKUP ARCHIVELOG命令。您可以指示RMAN应自动跳过归档重做日志的备份。您可以使用BACKUP ARCHIVELOG命令备份多租户容器数据库（CDB）中的归档重做日志。BACKUP ARCHIVELOG ......DELETE INPUT命令在备份后删除存档的日志文件。此命令消除了手动删除存档重做日志的单独步骤。在CDB中，您可以使用BACKUP ARCHIVELOG备份后删除存档的重做日志...DELETE INPUT命令。增量备份仅复制自指定的先前备份以来已更改的数据文件块。使用BACKUP命令创建增量备份。RMAN增量备份提供多种好处。根据可接受的MTTR（平均恢复时间）选择备份策略。您可以将卷影复制服务（VSS）与Oracle VSS编写器一起使用，以在数据库中制作卷影副本或文件快照。通过逐步更新备份，可以避免对数据文件进行完整映像副本备份的开销，同时还可以最大限度地减少介质恢复数据库所需的时间。例如，如果您运行每日备份脚本，那么您永远不会有超过1天的重做时间来申请媒体恢复。要创建增量备份以用于增量更新的备份策略，请使用BACKUP ...使用TAG形式的BACKUP命令恢复COPY。在实现策略的示例脚本中最好地理解该命令。增量备份的块更改跟踪功能通过记录每个数据文件的更改块来提高备份性能。如果在主数据库或备用数据库上启用了块更改跟踪，则RMAN使用块更改跟踪文件来标识已更改的块以进行增量备份。通过读取这个小位图文件来确定哪些块发生了变化，RMAN避免了必须扫描它备份的数据文件中的每个块。Oracle数据库自动管理更改跟踪文件中的空间，以保留涵盖最近八个备份的块更改数据。达到最多八个位图后，最旧的位图将被跟踪当前更改的位图覆盖。默认情况下，块更改跟踪文件在DB_CREATE_FILE_DEST初始化参数指定的目标中创建为Oracle托管文件。您还可以通过在启用块更改跟踪时指定其名称，将块更改跟踪文件放在您选择的任何位置。块更改跟踪文件的大小与数据库的大小和重做的已启用线程数成比例。您可以在打开或装入数据库时启用块更改跟踪。禁用块更改跟踪时，数据库将从操作系统中删除块更改跟踪文件。您可以查询V $ BLOCK_CHANGE_TRACKING视图以确定是否启用了更改跟踪，如果是，则确定块更改跟踪文件的文件名。要移动更改跟踪文件，请使用ALTER DATABASE RENAME FILE语句。你可以使用BACKUP ......保持创建既包含所有权又不受备份保留策略限制的备份。通过使用带有BACKUP命令的KEEP选项，可以从保留策略中免除备份。通常，您将归档备份到磁带。由于您的数据保护备份最有可能位于一组仍可访问且可回收的磁带上，因此建议为归档备份保留一组磁带。使用带有KEEP选项的BACKUP命令进行归档备份。归档备份的一个目的是创建测试数据库。您可以使用BACKUP BACKUPSET命令备份其他备份作业生成的备份集。您还可以使用BACKUP RECOVERY AREA备份在当前和所有先前快速恢复区域目标中创建的恢复文件。BACKUP BACKUPSET命令在备份集中创建备份片的其他副本，但不创建新的备份集。对于基于冗余的备份保留策略，备份集将计为备份的一个实例。即使存在构成备份集的备份片的多个副本（例如，备份集已从磁盘备份到磁带），此语句也是如此。使用BACKUP BACKUPSET命令将备份集从磁盘复制到磁带。使用BACKUP命令将映像副本备份到磁带。">备份数据库</a></p>
                  </li>
                  <li>
                     <p><a href="backing-up-database-advanced.html#GUID-A4FABEF4-677C-42ED-9DF8-3731ADA12E5F" title="您可以使用CONFIGURE命令创建管理备份集大小的持久设置。BACKUP命令的MAXSETSIZE参数指定备份集的最大大小，以字节（默认），千字节，兆字节或千兆字节为单位。在超过文件系统或媒体管理软件的最大文件大小的情况下，备份大小是一个问题。使用CONFIGURE CHANNEL或ALLOCATE CHANNEL命令的MAXSETSIZE参数来限制备份片的大小。如果在BACKUP命令上指定SECTION SIZE参数，则RMAN会创建一个备份集，其中每个备份片段包含来自一个文件节的块。您运行CONFIGURE BACKUP OPTIMIZATION命令以启用备份优化。满足特定条件时，RMAN会跳过与已备份文件相同的文件备份。在Oracle Secure Backup中，媒体系列是一组命名的卷，具有一组共享的用户定义属性。在此方案中，您将不在磁带上的日志备份到一个媒体系列，然后将相同的日志备份到第二个媒体系列。最后，删除旧日志。默认情况下，BACKUP命令在无法访问数据文件时终止。RMAN最多可以同时备份四个备份集，每个副本与其他备份集完全相同。配置......BACKUP COPIES命令指定要在指定设备类型上创建的相同备份集的数量。BACKUP命令的COPIES选项会覆盖所有其他COPIES或DUPLEX设置，以控制备份集的双工。许多站点保留存储在磁盘上的数据库的备份，以防主数据库发生介质故障或不正确的用户操作需要时间点恢复。磁盘上的数据文件备份简化了恢复的恢复步骤，使恢复更加快速和可靠。您可以使用备份加密保护RMAN备份集。如果未经授权的用户获取加密备份，则无法读取这些备份。备份加密基于指定的加密设置执行。您可以通过执行SET ENCRYPTION BY PASSWORD命令在RMAN会话中设置加密密码。如果配置了透明加密，则指定ONLY关键字以指示备份受密码保护，而不是使用配置的透明加密。在RMAN提示符下使用SET ENCRYPTION BY PASSWORD命令进行受密码保护的备份。如果配置了透明加密，则省略ONLY关键字以指示备份受密码和配置的透明加密保护。使用可重新启动的备份功能，RMAN仅备份在指定日期之后未备份的那些文件。可重启性的最小单位是数据文件。但是，如果备份集包含一个备份片，并且如果该片包含来自多个数据文件的块，则可重新启动单元是备份片。图像副本的可重启性单位是数据文件。使用BACKUP命令的SINCE TIME参数指定需要新备份的日期。备份窗口是备份必须完成的一段时间。例如，您可能希望将数据库备份限制在系统上的用户活动较少时的时间窗口，例如凌晨2:00到6:00 am之间使用BACKUP命令的DURATION参数指定给定的时间长度允许备份作业运行。指定PARTIAL时，由于备份窗口结束，备份中断时RMAN不会报告错误。相反，RMAN会显示一条消息，显示未备份哪些文件。使用DURATION时，您可以以最大可能性能运行备份，或者在仍然在指定时间内完成的同时尽可能慢地运行备份，以最大程度地降低备份任务对性能的影响。">备份数据库：高级主题</a></p>
                  </li>
               </ul>
            </div>
         </div>
      </article>
   </body>
</html>