<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>维护RMAN备份和存储库记录</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96241-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="reporting-rman-operations.html" title="Previous" type="text/html"></link>
      <link rel="next" href="managing-recovery-catalog.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="BRADV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="reporting-rman-operations.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="managing-recovery-catalog.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复用户指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-managing-rman-backups.html" property="item" typeof="WebPage"><span property="name">管理RMAN备份</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">维护RMAN备份和存储库记录</li>
            </ol>
            <a id="GUID-F5C3D045-279B-4AB3-8A91-3231A716402C" name="GUID-F5C3D045-279B-4AB3-8A91-3231A716402C"></a><a id="BRADV8007"></a>
            
            <h2 id="BRADV-GUID-F5C3D045-279B-4AB3-8A91-3231A716402C" class="sect2"><span class="enumeration_chapter">12</span>维护RMAN备份和存储库记录</h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d58406e69" class="indexterm-anchor"></a><a id="d58406e73" class="indexterm-anchor"></a><a id="d58406e75" class="indexterm-anchor"></a><a id="d58406e77" class="indexterm-anchor"></a>本章介绍如何管理RMAN存储库记录以及RMAN备份和副本。本章还介绍了与快速恢复区相关的维护任务。本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="maintaining-rman-backups.html#GUID-9B20BEFF-DE04-481C-8A50-46902B3B8B5F" title="建议的维护策略是配置快速恢复区域，备份保留策略和归档重做日志删除策略。在这种情况下，数据库会根据需要自动维护和删除备份和归档重做日志。但是，有时需要手动维护数据库备份和归档重做日志。RMAN提供多个命令来维护RMAN备份和存储库记录。RMAN始终将其元数据存储在其执行操作的每个目标数据库的控制文件中。如果在恢复目录中注册目标数据库，则RMAN会将此目标数据库的元数据存储在恢复目录中。创建备份或副本的Data Guard环境中的数据库与该文件相关联。例如，如果RMAN连接到目标数据库standby1并备份它，则此备份与standby1关联。对于交叉检查，RMAN只能在连接到与文件关联的数据库时将文件状态从AVAILABLE更新为EXPIRED。RMAN可以在连接到任何数据库时删除文件。如果RMAN未作为TARGET连接到与文件关联的数据库，并且RMAN无法成功删除文件，则RMAN会提示您将TARGET连接到与该文件关联的数据库。然后你必须使用DELETE ...FORCE删除文件元数据。如果维护命令仅更改RMAN元数据，则可以将RMAN作为TARGET连接到Data Guard环境中的任何数据库。除非您明确使用CHANGE，否则备份仍与数据库关联...RESET DB_UNIQUE_NAME将备份与其他数据库关联。">RMAN备份和存储库维护概述</a></p>
                  </li>
                  <li>
                     <p><a href="maintaining-rman-backups.html#GUID-7DEB9336-5398-4CAE-8418-09285E363CD5" title="RMAN旨在在没有恢复目录的情况下工作。但是，如果选择不使用恢复目录，则每个目标数据库的控制文件都是RMAN元数据的独占存储库。">维护控制文件存储库</a></p>
                  </li>
                  <li>
                     <p><a href="maintaining-rman-backups.html#GUID-A60E5493-8988-40E5-9E70-36AE6A0DFD69" title="虽然快速恢复区域主要是自我管理，但某些情况可能需要数据库管理干预。">维护快速恢复区</a></p>
                  </li>
                  <li>
                     <p><a href="maintaining-rman-backups.html#GUID-93AE3A35-4B8C-424A-A5D4-CE14E160738C" title="某些情况可能会导致存储库与其记录的文件之间出现差异，包括磁带或磁盘故障以及用户管理的副本或RMAN相关文件的删除。">更新RMAN存储库</a></p>
                  </li>
                  <li>
                     <p><a href="maintaining-rman-backups.html#GUID-8C4B395D-7C24-485F-BEA0-A355821FB93D" title="您可以使用RMAN DELETE命令删除存档的重做日志和RMAN备份。">删除RMAN备份和归档重做日志</a></p>
                  </li>
                  <li>
                     <p><a href="maintaining-rman-backups.html#GUID-45EFE02D-488C-4F55-A648-6FFF5CB7A32F" title="要从操作系统中删除数据库，可以在RMAN中使用DROP DATABASE命令。 RMAN删除服务器参数文件，所有数据文件，联机重做日志和属于目标数据库的控制文件。">删除数据库</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-F5C3D045-279B-4AB3-8A91-3231A716402C__GUID-AC9CD89C-7FF4-486D-9B25-0E0265166ACD">
                  <p class="notep1">也可以看看：</p>
                  <p><a href="managing-recovery-catalog.html#GUID-E836E243-6620-495B-ACFB-AC0001EF4E89" title="本节介绍与管理恢复目录相关的基本概念。恢复目录是RMAN用于存储有关一个或多个Oracle数据库的元数据的数据库模式。通常，您将目录存储在专用数据库中。恢复目录包含有关每个已注册目标数据库的RMAN操作的元数据。当RMAN连接到恢复目录时，RMAN将仅从目录中获取其元数据。在RMAN使用的恢复目录中注册数据库的过程称为注册。集中式恢复目录的所有者（也称为基本恢复目录）可以向其他数据库用户授予或撤消对目录的受限访问。对于RMAN操作（如备份，还原和交叉检查），RMAN始终首先更新控制文件，然后将元数据传播到恢复目录。从挂载的控制文件到恢复目录的此元数据流（称为恢复目录重新同步）确保RMAN从控制文件获取的元数据是最新的。您可以使用存储的脚本替代命令文件来管理常用的RMAN命令序列。该脚本存储在恢复目录中，而不是存储在文件系统中。必须使用恢复目录来管理Data Guard环境中所有物理数据库（主数据库和备用数据库）的RMAN元数据。RMAN使用恢复目录作为Data Guard环境的唯一事实来源。管理恢复目录包括创建目录，然后使用目录注册目标数据库。创建恢复目录包含多个阶段，包括配置恢复目录数据库，创建恢复目录模式所有者，然后创建目录。使用恢复目录时，RMAN要求您维护恢复目录架构。恢复目录存储在架构的默认表空间中。SYS等特权用户不能是恢复目录的所有者。您必须分配目录模式使用的空间。恢复目录模式的大小取决于目录监视的数据库数。如果要在现有数据库中创建恢复目录，请添加足够的空间来保存恢复目录模式的默认表空间。选择恢复目录数据库并创建必要的空间后，即可创建恢复目录的所有者，并为此用户授予必要的权限。创建目录所有者后，使用RMAN CREATE CATALOG命令创建目录表。该命令在目录所有者的默认表空间中创建目录。在恢复目录中注册目标数据库可在恢复目录中维护数据库的记录。在恢复目录中注册目标数据库的过程称为注册。在Data Guard环境中，主数据库和备用数据库共享相同的DBID和数据库名称。要符合在恢复目录中注册的条件，Data Guard环境中的每个数据库都必须具有不同的DB_UNIQUE_NAME值。将恢复目录与目标数据库一起使用的第一步是在恢复目录中注册目标数据库。如果在Data Guard环境中使用目录，则只能以这种方式注册主数据库。如果磁盘上有数据文件副本，备份片或归档日志，则可以使用CATALOG命令在恢复目录中对它们进行编目。使用恢复目录时，对已超出控制文件的旧备份进行编录可使RMAN在还原操作期间使用较旧的备份。RMAN提供了多个命令来创建和管理虚拟专用目录。RMAN使用虚拟专用数据库（VPD）功能来实现虚拟专用目录。创建虚拟专用目录是一个多步骤过程，您首先要创建将拥有虚拟专用目录的数据库用户，然后创建虚拟专用目录。要在虚拟专用目录中存储目标数据库的备份元数据，必须使用虚拟专用目录注册数据库。创建虚拟专用目录后，可以根据需要撤消目录访问权限。本节介绍如何使用UPGRADE CATALOG命令升级虚拟专用目录。在备份和恢复策略中包含恢复目录数据库。如果不备份恢复目录并且发生破坏恢复目录数据库的磁盘故障，则可能会丢失目录中的元数据。如果没有恢复目录内容，则恢复其他数据库可能会更加困难。单个恢复目录可以存储多个目标数据库的元数据。因此，恢复目录的丢失可能是灾难性的。您必须经常备份恢复目录。恢复目录数据库与任何其他数据库一样，也是备份和恢复策略的关键部分。通过备份来保护恢复目录，就像数据库的任何其他部分一样。恢复目录数据库的备份策略是整体备份和恢复策略的一部分。备份恢复目录数据库时，可以使用RMAN进行备份。恢复目录仅在与旨在保护的数据分开时才有效。因此，您绝不能将包含数据库的RMAN存储库的恢复目录存储在与目标数据库相同的数据库中。另外，请勿将目录数据库存储在与目标数据库相同的磁盘上。使用“数据泵导出”实用程序创建的RMAN恢复目录的逻辑备份可以作为物理备份的有用补充。恢复和恢复恢复目录数据库非常类似于使用RMAN恢复和恢复任何其他数据库。您可以在恢复目录中创建和存储脚本。您可以使用存储的脚本替代命令文件来管理常用的RMAN命令序列。该脚本存储在恢复目录中，而不是存储在文件系统中。您可以使用CREATE SCRIPT命令创建存储的脚本。要更新存储的脚本，请使用REPLACE SCRIPT命令。使用EXECUTE SCRIPT命令运行存储的脚本。您可以在CREATE SCRIPT命令中指定替换变量。PRINT SCRIPT命令显示存储的脚本或将其写入文件。使用列表......SCRIPT NAMES命令显示恢复目录中定义的脚本的名称。使用DELETE GLOBAL SCRIPT命令从恢复目录中删除存储的脚本。要在启动时运行RMAN客户端并在恢复目录中启动存储的脚本，请在启动RMAN客户端时使用SCRIPT参数。维护恢复目录包括重新同步，更新和升级恢复目录等任务。创建恢复目录并注册目标数据库后，必须维护此目录。当RMAN执行重新同步时，它会将恢复目录与目标数据库的当前或备份控制文件进行比较，并使用缺少或更改的元数据更新目录。恢复目录的重新同步可确保RMAN从控制文件中获取的元数据保持最新。重新同步可以是完全或部分的。当作为TARGET连接到此数据库时，RMAN仅自动将恢复目录与数据库重新同步。因此，当作为TARGET连接到环境中的一个数据库时，RMAN不会自动重新同步Data Guard环境中的每个数据库。当RMAN连接到目标数据库和恢复目录并且您已执行RMAN命令时，RMAN会自动重新同步恢复目录。如果在发出导致部分重新同步的RMAN命令时恢复目录不可用，则稍后打开目录数据库并使用RESYNC CATALOG命令手动重新同步它。即使未以TARGET身份连接到此数据库，也可以为备用数据库创建或更改RMAN配置。您的目标是确保恢复目录中的元数据是最新的。由于恢复目录从目标控制文件获取其元数据，因此目录中数据的货币取决于控制文件中数据的货币。您必须确保控制文件中的备份元数据在被新记录覆盖之前记录在目录中。使用RESYNC CATALOG强制恢复目录与目标数据库控制文件完全重新同步。您可以决定在Data Guard环境中更改数据库的DB_UNIQUE_NAME。在这种情况下，您可以运行CHANGE DB_UNIQUE_NAME命令，将存储在旧DB_UNIQUE_NAME的恢复目录中的元数据与新的DB_UNIQUE_NAME关联。您可以使用UNREGISTER DATABASE命令从恢复目录中取消注册数据库。使用UNREGISTER DATABASE命令取消注册目标数据库。UNREGISTER命令支持DB_UNIQUE_NAME子句以在Data Guard环境中使用。您可以使用此子句删除特定数据库的元数据。在零数据丢失恢复设备（恢复设备）环境中，UNREGISTER DATABASE命令不能用于从恢复设备目录中注销受保护的数据库。而是使用DBMS_RA.DELETE_DB过程。使用RESETLOGS选项打开数据库时，可以创建数据库的化身。您可以在V $ DATABASE_INCARNATION视图中访问新化身的记录。本节介绍恢复目录升级的内容以及何时必须执行此操作。如果要升级到Oracle Database 12c第1版（12.1.0.2）或更高版本，则恢复目录数据库必须使用Oracle数据库企业版。假设您在Data Guard环境中将恢复目录库架构升级到Oracle Database 11g或更高版本。当RMAN连接到备用数据库时，它会自动注册新的数据库信息并重新同步以从控制文件中获取文件名。恢复目录的模式版本存储在恢复目录本身中。如果在生产系统中维护多个不同版本的数据库，则必须确定信息，并且必须确定目录模式版本是否可用于特定目标数据库版本。此方案假定您要将恢复目录库架构升级到当前版本。您可以使用RMAN中的IMPORT CATALOG命令将一个恢复目录模式合并到另一个模式中。使用IMPORT CATALOG时，源目录模式是要导入到其他模式的目录模式。目标目录模式是要导入源目录模式的目录模式。在恢复设备环境中，所有受保护数据库共享驻留在恢复设备上的单个集中管理的恢复设备目录。所有将备份发送到恢复设备的受保护数据库都必须使用此目录。目标数据库，恢复目录数据库和恢复目录模式可以位于不同的数据库版本中。建议的做法是将所有现有恢复目录导入到最新版本的恢复目录模式的单个恢复目录中。将一个恢复目录导入另一个目录时，不需要与目标数据库建立连接。RMAN只需要连接到源和目标目录。将恢复目录从一个数据库移动到另一个数据库的过程是导入目录的过程的变体。DROP CATALOG命令删除由CREATE CATALOG命令创建的那些对象。如果拥有恢复目录的用户还拥有不是由CREATE CATALOG创建的对象，则DROP CATALOG命令不会删除这些对象。">管理恢复目录</a>为特定于RMAN维护问题<a href="glossary.html#GUID-CBFA8015-2DFF-42B1-A818-D6C5B92C608F"><span class="xrefglossterm">恢复目录</span></a></p>
               </div>
            </div><a id="BRADV89607"></a><div class="props_rev_3"><a id="GUID-9B20BEFF-DE04-481C-8A50-46902B3B8B5F" name="GUID-9B20BEFF-DE04-481C-8A50-46902B3B8B5F"></a><h3 id="BRADV-GUID-9B20BEFF-DE04-481C-8A50-46902B3B8B5F" class="sect3"><span class="enumeration_section">12.1</span> RMAN备份和存储库维护概述</h3>
               <div>
                  <p>本节介绍RMAN存储库维护的目的和基本概念。</p>
               </div><a id="BRADV89608"></a><div class="props_rev_3"><a id="GUID-B6224394-4309-4225-BECF-20A8E7155368" name="GUID-B6224394-4309-4225-BECF-20A8E7155368"></a><h4 id="BRADV-GUID-B6224394-4309-4225-BECF-20A8E7155368" class="sect4"><span class="enumeration_section">12.1.1</span>备份和存储库维护的目的</h4>
                  <div>
                     <p>建议的维护策略是配置快速恢复区域，备份保留策略和归档重做日志删除策略。在这种情况下，数据库会根据需要自动维护和删除备份和归档重做日志。但是，有时需要手动维护数据库备份和归档重做日志。</p>
                     <p>管理RMAN备份涉及以下相关任务：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>管理存储在磁盘或磁带上的数据库备份</p>
                        </li>
                        <li>
                           <p>管理RMAN存储库中这些备份的记录</p>
                        </li>
                     </ul>
                     <p>RMAN维护的一个重要部分是删除不再需要的备份。如果配置快速恢复区域，则数据库会自动自动删除此区域中不需要的文件;即便如此，您可能希望从磁带中删除备份和副本。您甚至可能需要删除整个数据库。您可以使用RMAN命令执行这些任务。</p>
                     <p>快速恢复区可能需要偶尔进行维护。例如，快速恢复区域可能已满，在这种情况下，您可以为其添加空间。或者，您可能希望更改恢复区域的位置。</p>
                     <p><a href="glossary.html#GUID-F5643EDD-CE1B-4A9F-9E6E-ADDFD6452341"><span class="xrefglossterm">RMAN存储库</span></a>可能无法反映磁盘或磁带上文件的真实状态。例如，用户可以使用操作系统实用程序从磁盘中删除备份。在这种情况下，RMAN存储库显示文件存在时不存在。在类似情况下，包含RMAN备份的磁带可能已损坏。您可以使用<a href="glossary.html#GUID-F89B6EF7-3067-45B0-A45C-DE5247E0C326"><span class="xrefglossterm">RMAN维护命令</span></a>来使用准确的信息更新存储库。
                     </p>
                  </div>
               </div><a id="BRADV990"></a><div class="props_rev_3"><a id="GUID-E5BBAAFE-1191-4A96-A63A-91EDF87F7C3E" name="GUID-E5BBAAFE-1191-4A96-A63A-91EDF87F7C3E"></a><h4 id="BRADV-GUID-E5BBAAFE-1191-4A96-A63A-91EDF87F7C3E" class="sect4"><span class="enumeration_section">12.1.2</span>备份和存储库维护的基本概念</h4>
                  <div>
                     <p>RMAN提供多个命令来维护RMAN备份和存储库记录。</p>
                     <p>以下是RMAN维护命令：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="../rcmrf/CATALOG.html#RCMRF109" target="_blank"><code class="codeph">CATALOG</code></a>命令使您可以添加有关当前未记录在RMAN存储库中的RMAN和用户管理的备份的记录，或者删除记录的备份的记录。
                           </p>
                        </li>
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF110" target="_blank"><code class="codeph">CHANGE</code></a>命令使您可以更新RMAN存储库中的记录状态。
                           </p>
                        </li>
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF119" target="_blank"><code class="codeph">CROSSCHECK</code></a>命令使您可以将逻辑备份记录与备份存储中的文件的物理实际同步。
                           </p>
                        </li>
                        <li>
                           <p><a href="../rcmrf/DELETE.html#RCMRF121" target="_blank"><code class="codeph">DELETE</code></a>命令使您可以从操作系统中删除备份。
                           </p>
                        </li>
                     </ul>
                  </div><a id="BRADV90061"></a><div class="props_rev_3"><a id="GUID-E67EC11B-BEB9-40F4-AEC7-F97574960EE0" name="GUID-E67EC11B-BEB9-40F4-AEC7-F97574960EE0"></a><h5 id="BRADV-GUID-E67EC11B-BEB9-40F4-AEC7-F97574960EE0" class="sect5"><span class="enumeration_section">12.1.2.1</span>关于维护命令和RMAN存储库元数据</h5>
                     <div>
                        <p>RMAN始终将其元数据存储在其执行操作的每个目标数据库的控制文件中。如果在恢复目录中注册目标数据库，则RMAN会将此目标数据库的元数据存储在恢复目录中。</p>
                        <p>所有RMAN维护命令都可以使用或不使用恢复目录。</p>
                        <div class="infoboxnotealso" id="GUID-E67EC11B-BEB9-40F4-AEC7-F97574960EE0__GUID-9978B34B-B665-4F3D-B23B-52F0FBF6F47D">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="managing-recovery-catalog.html#GUID-5FC1C46A-748D-4DAF-9EF4-62781ACBE319" title="维护恢复目录包括重新同步，更新和升级恢复目录等任务。">维护恢复目录</a></p>
                        </div>
                     </div>
                  </div><a id="BRADV90062"></a><div class="props_rev_3"><a id="GUID-F0C0A8F9-CBDF-4EDE-BAAF-F93CC37638B1" name="GUID-F0C0A8F9-CBDF-4EDE-BAAF-F93CC37638B1"></a><h5 id="BRADV-GUID-F0C0A8F9-CBDF-4EDE-BAAF-F93CC37638B1" class="sect5"><span class="enumeration_section">12.1.2.2</span>关于Data Guard环境中的维护命令</h5>
                     <div>
                        <p>创建备份或副本的Data Guard环境中的数据库与该文件相关联。例如，如果RMAN连接到目标数据库<code class="codeph">standby1</code>并备份它，则此备份与<code class="codeph">standby1</code>关联。
                        </p>
                        <p>如果RMAN根据<span class="q">“ <a href="rman-architecture.html#GUID-E514F9D2-D96E-4087-B8C5-5A8EB6A44E6B" title="RMAN使用恢复目录来跟踪Data Guard环境中所有数据库文件的文件名。">关于Data Guard环境中的关于RMAN文件管理</a> ”中</span>指定的条件可以访问备份，则可以在连接到任何主数据库或备用数据库时使用RMAN维护命令（如<code class="codeph">CHANGE</code> ， <code class="codeph">DELETE</code>和<code class="codeph">CROSSCHECK</code>进行备份。
                        </p>
                     </div><a id="BRADV99968"></a><div class="props_rev_3"><a id="GUID-2792BBD5-2FD4-435B-85A3-0916D8EF6EC6" name="GUID-2792BBD5-2FD4-435B-85A3-0916D8EF6EC6"></a><h6 id="BRADV-GUID-2792BBD5-2FD4-435B-85A3-0916D8EF6EC6" class="sect6"><span class="enumeration_section">12.1.2.2.1</span>关于Data Guard环境中的交叉检查</h6>
                        <div>
                           <p>对于交叉检查，RMAN只能在连接到与文件关联的数据库时将文件状态从<code class="codeph">AVAILABLE</code>更新为<code class="codeph">EXPIRED</code> 。
                           </p>
                           <p>因此，如果RMAN交叉检查文件但未找到该文件，并且该文件与未作为<code class="codeph">TARGET</code>连接的数据库关联，则RMAN会在连接到与该文件关联的目标数据库时提示您执行交叉检查。运行<code class="codeph">CROSSCHECK</code>或<code class="codeph">CHANGE ...时，RMAN执行交叉检查<code class="codeph">CHANGE ...AVAILABLE</code>命令。
                           </p>
                        </div>
                     </div><a id="BRADV99969"></a><div class="props_rev_3"><a id="GUID-99A84A87-1B70-46E0-934C-320BBE230C33" name="GUID-99A84A87-1B70-46E0-934C-320BBE230C33"></a><h6 id="BRADV-GUID-99A84A87-1B70-46E0-934C-320BBE230C33" class="sect6"><span class="enumeration_section">12.1.2.2.2</span>关于Data Guard环境中的删除</h6>
                        <p>RMAN可以在连接到任何数据库时删除文件。如果RMAN未作为<code class="codeph">TARGET</code>连接到与文件关联的数据库，并且RMAN无法成功删除文件，则RMAN会提示您将<code class="codeph">TARGET</code>连接到与该文件关联的数据库。然后你必须使用<code class="codeph">DELETE ...FORCE</code>删除文件元数据。
                        </p>
                     </div><a id="BRADV99970"></a><div class="props_rev_3"><a id="GUID-41D4B085-7D27-4D12-937B-5CB2BB039312" name="GUID-41D4B085-7D27-4D12-937B-5CB2BB039312"></a><h6 id="BRADV-GUID-41D4B085-7D27-4D12-937B-5CB2BB039312" class="sect6"><span class="enumeration_section">12.1.2.2.3</span>关于Data Guard环境中RMAN元数据的更新</h6>
                        <div>
                           <p>如果维护命令仅更改RMAN元数据，则可以将RMAN作为<code class="codeph">TARGET</code>连接到Data Guard环境中的任何数据库。
                           </p>
                           <p>仅更改元数据的命令包括：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">改变......UNAVAILABLE</code>或<code class="codeph">CHANGE ...UNCATALOG</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">改变......KEEP</code>或<code class="codeph">CHANGE ...NOKEEP</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">改变......重置DB_UNIQUE_NAME</code></p>
                              </li>
                           </ul>
                           <p>默认情况下， <code class="codeph">CHANGE</code>命令仅对可根据<span class="q">“ <a href="rman-architecture.html#GUID-4176237B-67BE-4C87-A4B8-7AF2E0E6035E" title="备份的可访问性与其关联不同。在Data Guard环境中，恢复目录将磁盘备份视为只能与它们关联的数据库访问，而在一个数据库上创建的磁带备份可供所有数据库访问。">关于Data Guard环境中的备份的</a></span>可访问性<span class="q">”中</span>指定的规则访问的文件进行操作。但是，您可以使用<code class="codeph">FOR DB_UNIQUE_NAME</code>选项更改与目标数据库以外的数据库关联的文件的状态。
                           </p>
                        </div>
                     </div><a id="BRADV99971"></a><div class="props_rev_3"><a id="GUID-C64AF73E-8824-4F60-B6AC-D05133691B7E" name="GUID-C64AF73E-8824-4F60-B6AC-D05133691B7E"></a><h6 id="BRADV-GUID-C64AF73E-8824-4F60-B6AC-D05133691B7E" class="sect6"><span class="enumeration_section">12.1.2.2.4</span>关于与数据库<span class="enumeration_section">无关的</span>文件</h6>
                        <div>
                           <p>除非您明确使用<code class="codeph">CHANGE ...否则备份仍与数据库关联<code class="codeph">CHANGE ...RESET DB_UNIQUE_NAME</code>将备份与其他数据库关联。
                           </p>
                           <p>在某些情况下，可能不知道特定文件的<code class="codeph">DB_UNIQUE_NAME</code> 。例如， <code class="codeph">DB_UNIQUE_NAME</code>恢复目录不知道数据库名称，则<code class="codeph">DB_UNIQUE_NAME</code>值为<code class="codeph">null</code> ，就像在恢复目录中注册的Oracle9 <span class="italic">i</span>数据库一样。此外，行的<code class="codeph">DB_UNIQUE_NAME</code>为<code class="codeph">null</code>因为数据库已升级到当前版本，但恢复目录架构尚未协调所有文件的<code class="codeph">DB_UNIQUE_NAME</code>值。默认情况下，RMAN将<code class="codeph">SITE_KEY</code>为<code class="codeph">null</code>文件与RMAN连接到的数据库关联为<code class="codeph">TARGET</code> 。</p>
                           <div class="infoboxnotealso" id="GUID-C64AF73E-8824-4F60-B6AC-D05133691B7E__GUID-8A3138A8-C360-4F1F-B1E6-D45105CC2D25">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a> ，了解如何使用RMAN在Data Guard环境中备份和还原文件</p>
                                 </li>
                                 <li>
                                    <p>有关RMAN <code class="codeph">CHANGE</code>命令的说明，请<a href="../rcmrf/CHANGE.html#RCMRF110" target="_blank"><span><cite>参见Oracle数据库备份和恢复参考</cite></span></a></p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV8602"></a><div class="props_rev_3"><a id="GUID-7DEB9336-5398-4CAE-8418-09285E363CD5" name="GUID-7DEB9336-5398-4CAE-8418-09285E363CD5"></a><h3 id="BRADV-GUID-7DEB9336-5398-4CAE-8418-09285E363CD5" class="sect3"><span class="enumeration_section">12.2</span>维护控制文件存储库</h3>
               <div>
                  <p>RMAN旨在在没有恢复目录的情况下工作。但是，如果选择不使用恢复目录，则每个目标数据库的控制文件都是RMAN元数据的独占存储库。</p>
                  <p>您必须知道信息如何存储在控制文件中，并确保备份和恢复策略保护控制文件。</p>
                  <div class="infoboxnotealso" id="GUID-7DEB9336-5398-4CAE-8418-09285E363CD5__GUID-1FE55C6B-1A1D-4168-8680-AC2B703B8C32">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="../admin/managing-control-files.html#ADMIN006" target="_blank"><span><cite>“Oracle数据库管理员指南”</cite></span></a> ，其中提供了控制文件的概述以及有关管理控制文件的更多详细信息</p>
                  </div>
               </div><a id="BRADV89609"></a><div class="props_rev_3"><a id="GUID-3588948E-87A2-42BD-931B-F62BEC9C7EC9" name="GUID-3588948E-87A2-42BD-931B-F62BEC9C7EC9"></a><h4 id="BRADV-GUID-3588948E-87A2-42BD-931B-F62BEC9C7EC9" class="sect4"><span class="enumeration_section">12.2.1</span>关于控制文件记录</h4>
                  <div>
                     <p>控制文件包含两种类型的记录：循环重用记录和非圆形重用记录。</p>
                     <p>循环重用记录包含非关键信息，如果需要，可以覆盖这些信息。这些记录包含由数据库不断生成的信息。当所有可用记录槽已满时，数据库会扩展控制文件以为新记录腾出空间或覆盖最旧记录。<code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code>初始化参数指定记录在可以重用之前的最小年龄（以天为单位）。
                     </p>
                     <p>非圆形重用记录包含不经常更改且无法覆盖的关键信息。非圆重用记录中的一些信息示例包括数据文件，联机重做日志文件和重做线程。</p>
                     <p>在备份目标数据库时，数据库会将这些备份记录在控制文件中。为防止控制文件因添加新记录而变得过大，如果记录超过您指定的阈值，则可以重复使用这些记录。<code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code>初始化参数确定记录在被覆盖之前的最小年龄（以天为单位）：</p><pre class="pre codeblock"><code>CONTROL_FILE_RECORD_KEEP_TIME = <span class="italic">整数</span>
</code></pre><p>例如，如果参数值为<code class="codeph">14</code> ，那么任何14天或更早的记录都是重用的候选者。覆盖记录中的信息丢失。首先使用可用于重用的最旧记录。
                     </p>
                     <p>当数据库必须将新的RMAN存储库记录添加到控制文件中，但没有记录超过阈值时，数据库会尝试扩展控制文件的大小。如果底层操作系统阻止了控制文件的扩展（例如，由于磁盘已满），则数据库将覆盖控制文件中最旧的记录。</p>
                     <p>数据库将覆盖记录在<a href="glossary.html#GUID-BDCE90D1-13B7-4D2C-A761-1583A238A247"><span class="xrefglossterm">自动诊断存储库（ADR）</span></a>中的警报日志中。对于它覆盖的每个记录，数据库在警报日志中记录一个类似于以下内容的条目：</p><pre class="pre codeblock"><code>kccwnc：写入以下控制文件记录：RECID＃72 Recno 72记录时间戳07/28/06 22:15:21线程= 1 Seq＃= 3460备份集密钥：stamp = 372031415，count = 17低scn：0x0000.3af33f36 07/27/06 21:00:08下一个scn：0x0000.3af3871b 07/27/06 23:23:54 Resetlogs scn和time scn：0x0000.00000001</code></pre></div><a id="BRADV89610"></a><div class="props_rev_3"><a id="GUID-B6C169D5-C93F-40E2-AF15-A17A9E1CB873" name="GUID-B6C169D5-C93F-40E2-AF15-A17A9E1CB873"></a><h5 id="BRADV-GUID-B6C169D5-C93F-40E2-AF15-A17A9E1CB873" class="sect5"><span class="enumeration_section">12.2.1.1</span>关于快速恢复区和控制文件记录</h5>
                     <div>
                        <p>当包含有关在快速恢复区域中创建的文件的信息的控制文件记录即将被重用时，数据库尝试在文件有资格删除时从快速恢复区域中删除该文件。否则，数据库会扩展包含此文件记录的控制文件部分的大小。</p>
                        <p>数据库使用类似于此示例的消息在警报日志中记录扩展，其中<span class="italic"><code class="codeph">nnnn</code></span>是控制文件记录类型的编号：</p><pre class="pre codeblock"><code>kccwnc：尝试扩展Oracle Managed Files的控制文件部分<span class="italic">nnnn</span></code></pre><p>如果控制文件处于主机操作系统下支持的最大大小，则数据库无法扩展控制文件。在这种情况下，警告日志中会显示此警告：</p><pre class="pre codeblock"><code>警告：控制文件未知Oracle托管文件文件名。这是控制文件大小限制的结果，无法保留所有恢复区文件。
</code></pre><p>上述消息表示控制文件无法保存满足配置的保留策略所需的所有快速恢复区文件的记录。下一节将介绍如何应对这种情况。</p>
                        <div class="infoboxnotealso" id="GUID-B6C169D5-C93F-40E2-AF15-A17A9E1CB873__GUID-5026AC33-190D-47A1-AE11-F870F71E353E">
                           <p class="notep1">也可以看看：</p>
                           <p>有关<code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code>初始化参数的信息，请<a href="../refrn/CONTROL_FILE_RECORD_KEEP_TIME.html#REFRN10020" target="_blank"><span><cite>参见Oracle数据库参考</cite></span></a></p>
                        </div>
                     </div>
                  </div>
               </div><a id="BRADV8206"></a><div class="props_rev_3"><a id="GUID-1DE96E35-27A3-42DE-BF96-89AE66FD7D2A" name="GUID-1DE96E35-27A3-42DE-BF96-89AE66FD7D2A"></a><h4 id="BRADV-GUID-1DE96E35-27A3-42DE-BF96-89AE66FD7D2A" class="sect4"><span class="enumeration_section">12.2.2</span>防止丢失控制文件记录</h4>
                  <div>
                     <p>防止因覆盖控制文件记录而丢失RMAN元数据的最佳方法是使用恢复目录。</p>
                     <div class="section">
                        <p>如果您无法使用恢复目录，则可以采取以下措施：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>将<code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code>值设置为略长于您必须保留的最旧文件。例如，如果您每周备份一次整个数据库，则必须将每个备份保留至少7天。将<code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code>设置为诸如<code class="codeph">10</code>或<code class="codeph">14</code>类的值。<code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code>的默认值为7天。
                              </p>
                              <div class="infoboxnote" id="GUID-1DE96E35-27A3-42DE-BF96-89AE66FD7D2A__GUID-5B47F210-6F43-4385-AD05-448A3CBF612E">
                                 <p class="notep1">警告：</p>
                                 <p>无论您是否使用恢复目录，在<code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code>设置为0时都不要使用RMAN。如果这样做，那么您可能会丢失备份记录。
                                 </p>
                              </div>
                           </li>
                           <li>
                              <p>将控制文件存储在文件系统中而不是存储在<a href="glossary.html#GUID-D6545038-B176-4D0E-9B4B-E4187A063984"><span class="xrefglossterm">原始设备上，</span></a>以便它可以扩展。
                              </p>
                           </li>
                           <li>
                              <p>监视警报日志以确保Oracle数据库不会覆盖控制文件记录。警报日志位于<a href="glossary.html#GUID-BDCE90D1-13B7-4D2C-A761-1583A238A247"><span class="xrefglossterm">自动诊断存储库（ADR）中</span></a> 。
                              </p>
                           </li>
                        </ul>
                        <p>如果使用快速恢复区域，请遵循以下准则以避免控制文件无法保存满足备份保留策略所需的所有快速恢复区域文件的记录的情况：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>如果控制文件的块大小不是最大值，则使用更大的块大小，最好是32千字节。</p>
                              <p>要实现此目标，必须将<code class="codeph">SYSTEM</code>表空间块大小设置为大于或等于控制文件块大小，并在更改<code class="codeph">DB_BLOCK_SIZE</code>后重新创建控制文件。快速恢复区域中的文件已重新编目，但磁带上文件的记录将丢失。
                              </p>
                           </li>
                           <li>
                              <p>通过将快速恢复区域中的文件备份到磁带等第三级存储，使其可以在快速恢复区域中进行删除。</p>
                              <p>例如，您可以使用<code class="codeph">BACKUP RECOVERY AREA</code>将快速恢复区中的文件专门备份到媒体管理器。
                              </p>
                           </li>
                           <li>
                              <p>如果备份保留策略使备份和归档日志长于业务要求，则可以通过将保留策略更改为更短的恢复窗口或更低的冗余度，使快速恢复区域中的更多文件符合删除条件。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV284"></a><a id="BRADV89611"></a><div class="props_rev_3"><a id="GUID-9490431E-F205-4ABD-81D8-993A9F3A9EF7" name="GUID-9490431E-F205-4ABD-81D8-993A9F3A9EF7"></a><h4 id="BRADV-GUID-9490431E-F205-4ABD-81D8-993A9F3A9EF7" class="sect4"><span class="enumeration_section">12.2.3</span>保护控制文件</h4>
                  <div>
                     <p>如果您没有使用恢复目录来存储RMAN元数据，那么保护每个目标数据库控制文件是非常重要的。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-9490431E-F205-4ABD-81D8-993A9F3A9EF7__GUID-71B051E7-46D9-4DD3-B4FD-E83B9642152A">要保护控制文件：</p>
                        <p>您可以使用以下策略来保护控制文件。</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>通过<a href="glossary.html#GUID-635043F8-78E2-4B43-A3C4-E27AFEAF363C"><span class="xrefglossterm">多路复用</span></a>或操作系统<a href="glossary.html#GUID-305BF676-5718-47C7-9902-A6E3A200A0DF"><span class="xrefglossterm">镜像</span></a>创建控制文件的冗余副本。</span><div>
                              <p>通过这种方式，数据库可以在丢失控制文件子集的情况下继续运行，而无需从备份中恢复控制文件。Oracle建议您在不同的磁盘上至少使用两个多路复用或镜像控制文件。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>配置<a href="glossary.html#GUID-7CDA6567-DFB0-450D-8771-B033E9872AF7"><span class="xrefglossterm">控制文件自动备份</span></a>功能。</span><div>
                              <p>在这种情况下，RMAN会在您运行某些RMAN命令时自动备份控制文件。如果控制文件自动备份可用，RMAN可以还原服务器参数和备份控制文件，并装入数据库。装入控制文件后，您可以还原数据库的其余部分。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>保留数据库DBID的记录。</span><div>
                              <p>如果丢失了控制文件，则可以使用DBID恢复数据库。</p>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-9490431E-F205-4ABD-81D8-993A9F3A9EF7__GUID-CB330F9E-F3F9-4799-B786-55F42E4E840C">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="backing-up-database.html#GUID-D25F0A92-12AE-490E-AB8F-C9E54E081CDD" title="您可以在装入或打开数据库时备份控制文件。RMAN使用快照控制文件来确保读取一致的版本。">使用RMAN备份控制文件</a>以了解手动和自动控制文件备份</p>
                              </li>
                              <li>
                                 <p><a href="rman-backup-concepts.html#GUID-95840C84-1595-49AC-923D-310DA750676B" title="在许多恢复情况下，最近备份控制文件和服务器参数文件非常有用。为确保您备份这些文件，数据库支持控制文件和服务器参数文件自动备份。">关于RMAN控制文件和服务器参数文件自动备份</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV89612"></a><div class="props_rev_3"><a id="GUID-A60E5493-8988-40E5-9E70-36AE6A0DFD69" name="GUID-A60E5493-8988-40E5-9E70-36AE6A0DFD69"></a><h3 id="BRADV-GUID-A60E5493-8988-40E5-9E70-36AE6A0DFD69" class="sect3"><span class="enumeration_section">12.3</span>维护快速恢复区域</h3>
               <p>虽然快速恢复区域主要是自我管理，但某些情况可能需要数据库管理干预。</p><a id="BRADV89613"></a><div class="props_rev_3"><a id="GUID-2D7B9EF4-C306-4377-82F2-DDE3549FB63C" name="GUID-2D7B9EF4-C306-4377-82F2-DDE3549FB63C"></a><h4 id="BRADV-GUID-2D7B9EF4-C306-4377-82F2-DDE3549FB63C" class="sect4"><span class="enumeration_section">12.3.1</span>快速恢复区的删除规则</h4>
                  <div>
                     <p>RMAN使用某些规则来确定何时可以从快速恢复区域删除文件。</p>
                     <p>以下规则控制何时文件有资格从恢复区域删除：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>永久文件永远不会被删除。</p>
                        </li>
                        <li>
                           <p>根据保留策略过时的文件可以删除。</p>
                        </li>
                        <li>
                           <p>已复制到磁带的瞬态文件可以删除。</p>
                        </li>
                        <li>
                           <p>在日志的所有使用者满足其要求之前，归档重做日志不符合删除条件。</p>
                           <p>日志的使用者可以包括RMAN，备用数据库和闪回数据库功能。</p>
                        </li>
                        <li>
                           <p>在逻辑备用数据库上由LogMiner会话挖掘的外部归档日志可以删除。由于它是从与当前数据库不同的数据库生成的，因此<a href="glossary.html#GUID-E2428029-4C01-4DFF-8C08-028EF57CF8C7"><span class="xrefglossterm">外部存档重做日志</span></a>的DBID与当前存档的重做日志不同。
                           </p>
                        </li>
                     </ul>
                     <p>控制从快速恢复区域删除文件的安全可靠方法是配置保留策略和存档日志删除策略。要增加将文件移动到磁带的可能性保留在磁盘上，请增加快速恢复区配额。</p>
                     <div class="infoboxnotealso" id="GUID-2D7B9EF4-C306-4377-82F2-DDE3549FB63C__GUID-21407E1D-E1B9-4863-B75F-FFD43881CFA6">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="configuring-rman-client-basic.html#GUID-061CCF1D-2C8D-4460-B469-9C32893A590A" title="快速恢复区域可以包含控制文件，联机重做日志，归档重做日志，闪回日志和RMAN备份。">快速恢复区中的文件概述</a> ”，</span>以获取有关快速恢复区域内容以及永久文件和临时文件之间差异的信息</p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="configuring-rman-client-basic.html#GUID-FA142760-8ACB-43DA-939C-8407618D2D0F" title="您可以使用RMAN创建一个持久性配置，以管理归档重做日志何时有资格从磁盘中删除。">配置存档重做日志删除策略</a> ”</span> ，了解有关如何配置存档重做日志删除策略以确定何时可以删除日志的信息</p>
                           </li>
                           <li>
                              <p><a href="configuring-rman-client-basic.html#GUID-03DE4CF6-9D9F-4806-B5CA-CAA4CF5F2133" title="备份保留策略指定必须保留哪些备份以满足您的数据恢复要求。">配置备份保留策略</a>以获取有关如何配置保留策略的信息</p>
                           </li>
                           <li>
                              <p><a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a> ，了解Data Guard环境中的归档重做日志管理</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV285"></a><a id="BRADV89614"></a><div class="props_rev_3"><a id="GUID-86350744-262F-4C51-81F6-410712D08FEC" name="GUID-86350744-262F-4C51-81F6-410712D08FEC"></a><h4 id="BRADV-GUID-86350744-262F-4C51-81F6-410712D08FEC" class="sect4"><span class="enumeration_section">12.3.2</span>监控快速恢复区空间使用情况</h4>
                  <div>
                     <p>您可以使用<code class="codeph">V$RECOVERY_FILE_DEST</code>和<code class="codeph">V$RECOVERY_AREA_USAGE</code>视图来确定是否为快速恢复区域分配了足够的空间。
                     </p>
                     <div class="section">
                        <p>查询<code class="codeph">V$RECOVERY_FILE_DEST</code>视图以发现当前位置，磁盘配额，正在使用的空间，通过删除文件可回收的空间以及快速恢复区域中的文件总数。空格列指定以字节为单位的数量。查询<code class="codeph">V$RECOVERY_AREA_USAGE</code>视图以发现不同类型文件使用的总磁盘配额的百分比。此外，您可以通过删除过时，冗余或备份到磁带的文件来确定可以回收每种类型文件的空间大小。
                        </p>
                        <p>如果在数据库上定义了保证还原点，则必须监视快速恢复区域中用于满足保证所需文件的空间量。使用查询查看<span class="q">“ <a href="using-flasback-database-restore-points.html#GUID-1A583D44-66CB-4D21-B170-2A07CFF6EE65" title="您可以使用V $ RESTORE_POINT控制文件视图来获取有关所有当前定义的还原点（正常和保证）的信息，包括CDB还原点和PDB还原点。">使用V $ RESTORE_POINT视图列出还原点</a> ”中的</span>保证还原点，并查看<code class="codeph">STORAGE_SIZE</code>列以确定与每个保证还原点相关的文件所需的空间。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-86350744-262F-4C51-81F6-410712D08FEC__CHDJIBFG">
                        <p class="titleinexample">例12-1快速恢复区空间消耗</p>
                        <p>以下示例显示有关快速恢复区域的详细信息，例如位置，磁盘配额，空间使用情况和文件数。</p><pre class="pre codeblock"><code>SELECT * FROM V $ RECOVERY_FILE_DEST;名称SPACE_LIMIT SPACE_USED SPACE_RECLAIMABLE NUMBER_OF_FILES CON_ID ------------ ----------- ---------- ----------- ------ --------------- ------ / mydisk / rcva 5368709120 109240320 256000 28 0</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-86350744-262F-4C51-81F6-410712D08FEC__GUID-438D91B3-155D-467D-93B0-2365C5241B37">
                        <p class="titleinexample">例12-2基于文件类型的快速恢复区空间使用情况</p>
                        <p>以下示例显示了每种类型文件使用的空间百分比，可回收的空间百分比以及快速恢复区域中的文件数。</p><pre class="pre codeblock"><code>SELECT * FROM V $ RECOVERY_AREA_USAGE; FILE_TYPE PERCENT_SPACE_USED PERCENT_SPACE_RECLAIMABLE NUMBER_OF_FILES CON_ID ------------ ------------------ --------------- ---------- --------------- ------ CONTROLFILE 0 0 0 0 ONLINELOG 2 0 22 0 ARCHIVELOG 4.05 2.01 31 0 BACKUPPIECE 3.94 3.86 8 0 IMAGECOPY 15.64 10.43 66 0 FLASHBACKLOG .08 0 1 0</code></pre><div class="infoboxnotealso" id="GUID-86350744-262F-4C51-81F6-410712D08FEC__GUID-2A44A4C5-F348-46B0-AB95-06F9A090583D">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../refrn/V-RECOVERY_FILE_DEST.html#REFRN30304" target="_blank"><span><cite>Oracle数据库参考中的</cite></span></a> <code class="codeph">V$RECOVERY_AREA_USAGE</code></p>
                              </li>
                              <li>
                                 <p><a href="../refrn/V-RECOVERY_AREA_USAGE.html#REFRN30377" target="_blank"><span><cite>Oracle数据库参考中的</cite></span></a> <code class="codeph">V$RECOVERY_FILE_DEST</code></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="example" -->
                  </div>
               </div><a id="BRADV89615"></a><div class="props_rev_3"><a id="GUID-26C1A1E8-5555-4399-9DD1-39BA90E45A0C" name="GUID-26C1A1E8-5555-4399-9DD1-39BA90E45A0C"></a><h4 id="BRADV-GUID-26C1A1E8-5555-4399-9DD1-39BA90E45A0C" class="sect4"><span class="enumeration_section">12.3.3</span>管理快速恢复区域中闪回日志的空间</h4>
                  <div>
                     <p>除了设置闪回保留目标或使用保证还原点之外，您无法直接管理快速恢复区域中的闪回日志。</p>
                     <div class="section">
                        <p>不过，您可以整体管理快速恢复区域空间，以最大限度地利用可用于保留闪回日志的空间。通过这种方式，您可以提高实现闪回目标的可能性。</p>
                        <p>要为闪回日志腾出空间，请使用<code class="codeph">BACKUP</code> <code class="codeph">RECOVERY</code> <code class="codeph">AREA</code> ， <code class="codeph">BACKUP</code> <code class="codeph">BACKUPSET</code>等命令将快速恢复区的其他内容<code class="codeph">BACKUP</code>到磁带。Oracle数据库会自动从快速恢复区域中删除过时的文件。如果将备份卸载到磁带仍然无法创建足够的空间来满足备份保留策略和闪回保留目标，则在快速恢复区域中分配更多空间。
                        </p>
                        <p>从Oracle Database Release 19c开始，简化了快速恢复区域中的空间管理。Oracle数据库监视快速恢复区域中的闪回日志，并自动删除超出保留期的闪回日志。当保留目标减少时，将立即删除超出保留期的闪回日志。</p>
                        <p>必须将<code class="codeph">COMPATIBLE</code>初始化参数设置为19.0.0或更高，才能自动删除闪回日志。
                        </p>
                        <p>在突然的工作负载峰值导致创建大量闪回日志的情况下，在删除超出保留期的闪回日志之前，将监视工作负荷几天。如果在不久之后发生另一个峰值工作负载，则可以避免重新创建闪回日志的开销。</p>
                        <div class="infoboxnote" id="GUID-26C1A1E8-5555-4399-9DD1-39BA90E45A0C__GUID-DAD66707-ECBD-423A-90F1-2C04480202A5">
                           <p class="notep1">注意：</p>
                           <p>您无法备份闪回日志。因此，在将快速恢复区内容备份到磁带时， <code class="codeph">BACKUP</code> <code class="codeph">RECOVERY</code> <code class="codeph">AREA</code>操作不包括闪回日志。
                           </p>
                        </div>
                        <div class="infoboxnotealso" id="GUID-26C1A1E8-5555-4399-9DD1-39BA90E45A0C__GUID-8CA85899-9F57-477F-802D-3E30E61FDB95">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="using-flasback-database-restore-points.html#GUID-502D1646-2A81-4F04-BC3A-1927298A8F8D" title="If you enable Flashback Database and define one or more guaranteed restore points, then the database performs normal flashback logging.">关于使用保证还原点记录闪回数据库</a>为闪回日志删除规则<a href="using-flasback-database-restore-points.html#GUID-502D1646-2A81-4F04-BC3A-1927298A8F8D" title="如果启用闪回数据库并定义一个或多个保证还原点，则数据库将执行正常的闪回日志记录。">定义</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89616"></a><div class="props_rev_3"><a id="GUID-3F11ECB5-1321-45F5-A557-BB1A5BAF011F" name="GUID-3F11ECB5-1321-45F5-A557-BB1A5BAF011F"></a><h4 id="BRADV-GUID-3F11ECB5-1321-45F5-A557-BB1A5BAF011F" class="sect4"><span class="enumeration_section">12.3.4</span>响应完全快速恢复区域</h4>
                  <div>
                     <p>如果RMAN保留策略要求保留一组大于快速恢复区磁盘配额的备份，或者保留策略设置为<code class="codeph">NONE</code> ，则快速恢复区域可以完全填充，没有可回收空间。
                     </p>
                     <div class="section">
                        <p>当可回收空间小于15％时，数据库发出警告警报，当可回收空间小于3％时，数据库发出严重警报。要向DBA警告此情况，会在警报日志和<code class="codeph">DBA_OUTSTANDING_ALERTS</code>表（由Enterprise Manager使用）中添加一个条目。然而，数据库继续占用快速恢复区域的空间，直到没有可回收的空间。</p>
                        <p>当恢复区域完全填满时，显示的错误如下所示，其中<span class="italic">nnnnn</span>是所需的字节数， <span class="italic">mmmmm</span>是磁盘配额：</p><pre class="oac_no_warn" dir="ltr">ORA-19809：恢复文件超出限制ORA-19804：无法从<span class="italic">mmmmm</span>限制中回收<span class="italic">nnnnn</span>字节磁盘空间</pre><p>当没有文件可以删除时，您有多种选择来解决完整的快速恢复区域：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>增加可用磁盘空间并增加<code class="codeph">DB_RECOVERY_FILE_DEST_SIZE</code>以反映额外空间。
                              </p>
                           </li>
                           <li>
                              <p>将备份从快速恢复区域移动到第三级存储（如磁带）。</p>
                              <p>将所有恢复区文件备份到磁带的一种便捷方法是<code class="codeph">BACKUP</code> <code class="codeph">RECOVERY</code> <code class="codeph">AREA</code>命令。将备份从恢复区域传输到磁带后，可以从快速恢复区域中删除文件。闪回日志无法在恢复区域外备份，也无法由<code class="codeph">BACKUP</code> <code class="codeph">RECOVERY</code> <code class="codeph">AREA</code> <code class="codeph">BACKUP</code> 。</p>
                           </li>
                           <li>
                              <p>对于使用操作系统实用程序<code class="codeph">DELETE</code>的任何文件，请运行<code class="codeph">DELETE</code> 。
                              </p>
                              <p>如果使用主机操作系统命令删除文件，则数据库不会知道生成的可用空间。您可以运行RMAN <code class="codeph">CROSSCHECK</code>命令让RMAN重新检查快速恢复区域的内容并识别过期文件，然后使用<code class="codeph">DELETE EXPIRED</code>命令从RMAN存储库中删除每个<a href="glossary.html#GUID-A8547B27-5415-4AAA-B2B4-C0998EB62E47"><span class="xrefglossterm">过期的备份</span></a> 。
                              </p>
                           </li>
                           <li>
                              <p>确保您的保证还原点是必要的。如果没有，删除它们。</p>
                              <p>自动删除保证还原点不需要的闪回日志，以便为快速恢复区域中的其他文件腾出空间。保证还原点会强制保留执行闪回数据库到还原点SCN所需的闪回日志。</p>
                           </li>
                           <li>
                              <p>查看备份保留策略，如果使用Data Guard，则检查归档重做日志删除策略。</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-3F11ECB5-1321-45F5-A557-BB1A5BAF011F__GUID-BE7D2B8C-9E15-4E5B-BC64-EAA04E9C9422">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="maintaining-rman-backups.html#GUID-8C4B395D-7C24-485F-BEA0-A355821FB93D" title="您可以使用RMAN DELETE命令删除存档的重做日志和RMAN备份。">删除RMAN备份和归档重做日志</a></p>
                              </li>
                              <li>
                                 <p><a href="using-flasback-database-restore-points.html#GUID-A1563822-015B-4941-B7EB-C3D44A63232C" title="如果您对不需要现有还原点感到满意，或者想要使用现有还原点的名称创建还原点，则可以使用DROP RESTORE POINT SQL * Plus语句删除还原点。">删除还原点</a></p>
                              </li>
                              <li>
                                 <p><a href="backing-up-database.html#GUID-93BAB347-063F-439E-BDF3-109AB8D1F8E7" title="使用BACKUP命令创建RMAN备份。RMAN备份的主要目的是保护您的数据。如果发生介质故障或灾难，则可以还原备份并恢复丢失的更改。您可以使用RMAN客户端中的BACKUP命令备份全部或部分数据库。您可以为BACKUP命令提供参数以覆盖默认备份选项。BACKUP命令采用DEVICE TYPE子句，指定是备份到磁盘还是磁带设备。RMAN可以在磁盘上创建备份作为映像副本或备份集。RMAN提供了一系列选项来命名BACKUP命令生成的文件。备份到磁盘时，您可以指定一种格式以将备份分布在多个驱动器上以提高性能。RMAN将一个称为标记的字符串附加到它创建的每个备份上，作为识别备份的一种方式。您可以接受默认标记，也可以使用BACKUP命令的TAG参数指定自己的标记。用户指定的标记是指示不同类别的备份或副本的用途或用法的有用方法。将TAG参数与BACKUP命令一起使用可指定备份集和映像副本的标记。创建备份集时，可以通过在BACKUP命令中包含AS COMPRESSED BACKUPSET选项，使用RMAN支持对备份集进行二进制压缩。通过多节备份，可以将大型数据文件划分为多个部分，这些部分可以跨多个通道并行备份。这提供了更快的备份性能和更好的恢复时间。在创建映像副本时，RMAN使用多个通道写入文件节。但是，此操作的输出是每个数据文件的一个副本。您可以在装入或打开数据库的情况下执行整个数据库备份。您可以使用BACKUP TABLESPACE命令备份一个或多个表空间，或使用BACKUP DATAFILE命令备份一个或多个数据文件。您可以在装入或打开数据库时备份控制文件。RMAN使用快照控制文件来确保读取一致的版本。控制文件的手动备份与控制文件自动备份不同。在备份BACKUP命令中指定的文件后，RMAN会进行控制文件自动备份。要进行手动备份，可以在备份其他文件时指定INCLUDE CURRENT CONTROLFILE或指定BACKUP CURRENT CONTROLFILE。在某些情况下，RMAN会自动备份当前服务器参数文件。BACKUP SPFILE命令显式备份参数文件。备份的服务器参数文件是实例当前使用的文件。只有在数据库关闭且处于一致状态时，才能以NOARCHIVELOG模式备份数据库。预打印备份确保在将非CDB作为PDB插入CDB后可以使用RMAN备份。使用BACKUP命令备份多租户容器数据库（CDB）和可插拔数据库（PDB）。RMAN和Oracle Enterprise Manager Cloud Control为多租户环境中的备份和恢复提供全面支持。备份整个多租户容器数据库（CDB）类似于备份非CDB。备份整个CDB时，RMAN会备份根，所有可插拔数据库（PDB）和归档重做日志。您可以使用RMAN仅备份根。由于根包含整个CDB的关键元数据，因此Oracle建议您定期备份根或备份整个CDB。Oracle Enterprise Manager云控制（云控制）可用于备份根。RMAN允许您使用BACKUP命令备份CDB中的一个或多个PDB。迁移PDB并将其插入到不同的目标CDB后，PDB的预打印备份可用于执行还原和恢复操作.Oracle Enterprise Manager云控制（云控制）可用于执行可插拔数据库（PDB）的备份。由于不同PDB中的表空间可以具有相同的名称，因此为了消除歧义，您必须直接连接到PDB以备份其一个或多个表空间。此示例创建CDB cdb_prod中包含的PDB my_pdb的预包装备份。CDB使用共享撤消，并在读写模式下打开。RMAN使您可以使用BACKUP命令在应用程序根，一个或多个应用程序PDB和应用程序容器上执行备份操作。RMAN可以备份应用程序容器，应用程序PDB和应用程序根目录。使用RMAN BACKUP命令备份应用程序根目录。使用BACKUP命令备份应用程序容器，该容器由应用程序根目录和属于应用程序根目录的所有应用程序PDB组成。BACKUP命令用于备份一个或多个应用程序PDB。使用BACKUP命令备份稀疏数据库。RMAN使您可以使用备份集或映像副本格式中的备份整个数据库的步骤来备份稀疏数据库。您可以使用BACKUP命令备份包含稀疏数据文件或单个稀疏数据文件的一个或多个表空间。RMAN使您可以备份CDB中的一个或多个稀疏PDB。归档重做日志是成功恢复媒体的关键。你应该定期备份它们。RMAN备份的若干功能特定于归档重做日志。例如，您可以使用BACKUP ...删除以将备份到备份集后从磁盘中删除一个或所有归档重做日志副本。即使您的重做日志存档到多个目标并且您使用RMAN备份存档的重做日志，RMAN也只选择一个存档的重做日志文件副本以包含在备份集中。由于具有相同日志序列号的日志相同，因此RMAN不需要包含多个日志副本。自动在线重做日志切换是一项重要的RMAN功能。在CDB中，只有当您以具有SYSDBA或SYSBACKUP权限的普通用户身份连接到根时，才能备份存档的重做日志。要备份存档日志，请使用BACKUP ARCHIVELOG命令。您可以指示RMAN应自动跳过归档重做日志的备份。您可以使用BACKUP ARCHIVELOG命令备份多租户容器数据库（CDB）中的归档重做日志。BACKUP ARCHIVELOG ......DELETE INPUT命令在备份后删除存档的日志文件。此命令消除了手动删除存档重做日志的单独步骤。在CDB中，您可以使用BACKUP ARCHIVELOG备份后删除存档的重做日志...DELETE INPUT命令。增量备份仅复制自指定的先前备份以来已更改的数据文件块。使用BACKUP命令创建增量备份。RMAN增量备份提供多种好处。根据可接受的MTTR（平均恢复时间）选择备份策略。您可以将卷影复制服务（VSS）与Oracle VSS编写器一起使用，以在数据库中制作卷影副本或文件快照。通过逐步更新备份，可以避免对数据文件进行完整映像副本备份的开销，同时还可以最大限度地减少介质恢复数据库所需的时间。例如，如果您运行每日备份脚本，那么您永远不会有超过1天的重做时间来申请媒体恢复。要创建增量备份以用于增量更新的备份策略，请使用BACKUP ...使用TAG形式的BACKUP命令恢复COPY。在实现策略的示例脚本中最好地理解该命令。增量备份的块更改跟踪功能通过记录每个数据文件的更改块来提高备份性能。如果在主数据库或备用数据库上启用了块更改跟踪，则RMAN使用块更改跟踪文件来标识已更改的块以进行增量备份。通过读取这个小位图文件来确定哪些块发生了变化，RMAN避免了必须扫描它备份的数据文件中的每个块。Oracle数据库自动管理更改跟踪文件中的空间，以保留涵盖最近八个备份的块更改数据。达到最多八个位图后，最旧的位图将被跟踪当前更改的位图覆盖。默认情况下，块更改跟踪文件在DB_CREATE_FILE_DEST初始化参数指定的目标中创建为Oracle托管文件。您还可以通过在启用块更改跟踪时指定其名称，将块更改跟踪文件放在您选择的任何位置。块更改跟踪文件的大小与数据库的大小和重做的已启用线程数成比例。您可以在打开或装入数据库时启用块更改跟踪。禁用块更改跟踪时，数据库将从操作系统中删除块更改跟踪文件。您可以查询V $ BLOCK_CHANGE_TRACKING视图以确定是否启用了更改跟踪，如果是，则确定块更改跟踪文件的文件名。要移动更改跟踪文件，请使用ALTER DATABASE RENAME FILE语句。你可以使用BACKUP ......保持创建既包含所有权又不受备份保留策略限制的备份。通过使用带有BACKUP命令的KEEP选项，可以从保留策略中免除备份。通常，您将归档备份到磁带。由于您的数据保护备份最有可能位于一组仍可访问且可回收的磁带上，因此建议为归档备份保留一组磁带。使用带有KEEP选项的BACKUP命令进行归档备份。归档备份的一个目的是创建测试数据库。您可以使用BACKUP BACKUPSET命令备份其他备份作业生成的备份集。您还可以使用BACKUP RECOVERY AREA备份在当前和所有先前快速恢复区域目标中创建的恢复文件。BACKUP BACKUPSET命令在备份集中创建备份片的其他副本，但不创建新的备份集。对于基于冗余的备份保留策略，备份集将计为备份的一个实例。即使存在构成备份集的备份片的多个副本（例如，备份集已从磁盘备份到磁带），此语句也是如此。使用BACKUP BACKUPSET命令将备份集从磁盘复制到磁带。使用BACKUP命令将映像副本备份到磁带。">备份数据库</a>以确定保留策略</p>
                              </li>
                              <li>
                                 <p>有关使用Data Guard的归档日志删除策略的详细信息，请参阅<a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89618"></a><div class="props_rev_3"><a id="GUID-733CDB10-D2EE-45C8-A408-0774CC4CA875" name="GUID-733CDB10-D2EE-45C8-A408-0774CC4CA875"></a><h4 id="BRADV-GUID-733CDB10-D2EE-45C8-A408-0774CC4CA875" class="sect4"><span class="enumeration_section">12.3.5</span>将快速恢复区域更改为新位置</h4>
                  <div>
                     <p>使用<code class="codeph">ALTER SYSTEM</code>命令更改快速恢复区域的位置。
                     </p>
                     <div class="section">
                        <p>如果必须将数据库的快速恢复区域移动到新位置，请执行以下步骤：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>在目标数据库上启动SQL * Plus并更改<code class="codeph">DB_RECOVERY_FILE_DEST</code>初始化参数。例如，输入以下命令将目标设置为ASM磁盘组<code class="codeph">disk1</code> ：</span><div><pre class="pre codeblock"><code>ALTER SYSTEM SET DB_RECOVERY_FILE_DEST ='+ disk1'SCOPE = BOTH SID ='*';</code></pre><p>更改此参数后，将在新位置创建所有新的快速恢复区域文件。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>在旧的闪回恢复位置中保留或移动永久文件，闪回日志和瞬态文件。</span><div>
                              <p>如果将现有文件保留在闪回恢复中，则数据库会删除旧快速恢复区域中的临时文件，因为它们有资格删除。</p>
                              <p>如果必须将旧文件移动到新的快速恢复区域，请参阅“ <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=OSTMG89997" target="_blank"><span><cite>Oracle自动存储管理管理员指南”</cite></span></a> 。使用RMAN将数据库文件移入和移出ASM磁盘组的过程在将文件移入和移出快速恢复区域时起作用。
                              </p>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV89619"></a><div class="props_rev_3"><a id="GUID-C04DF4D4-07BA-47F1-A5AD-878C99C55F98" name="GUID-C04DF4D4-07BA-47F1-A5AD-878C99C55F98"></a><h4 id="BRADV-GUID-C04DF4D4-07BA-47F1-A5AD-878C99C55F98" class="sect4"><span class="enumeration_section">12.3.6</span>禁用快速恢复区域</h4>
                  <div>
                     <p><code class="codeph">ALTER SYSTEM</code>命令可用于禁用快速恢复区域。
                     </p>
                     <div class="p">在禁用快速恢复区域之前，必须首先删除所有保证的还原点，然后关闭闪回数据库。</div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>然后，您可以将<code class="codeph">DB_RECOVERY_FILE_DEST</code>初始化参数设置为空字符串以禁用快速恢复区域。例如，使用以下SQL语句更改正在运行的数据库上的参数：</p><pre class="pre codeblock"><code>ALTER SYSTEM SET DB_RECOVERY_FILE_DEST =''SCOPE = BOTH SID ='*';</code></pre><p>数据库不再为存储在旧<code class="codeph">DB_RECOVERY_FILE_DEST</code>位置的文件提供快速恢复区域的空间管理功能。但是，RMAN存储库仍然知道这些文件，并且这些文件可用于备份和还原活动。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89620"></a><div class="props_rev_3"><a id="GUID-435335A2-95DC-41C1-9CEE-9539AD595FA7" name="GUID-435335A2-95DC-41C1-9CEE-9539AD595FA7"></a><h4 id="BRADV-GUID-435335A2-95DC-41C1-9CEE-9539AD595FA7" class="sect4"><span class="enumeration_section">12.3.7</span>响应文件创建过程中的实例崩溃</h4>
                  <div>
                     <p>通常，快速恢复区域是自我维护的。但是，当在快速恢复区域中创建文件期间实例崩溃时，数据库可能会将文件保留在快速恢复区域中。</p>
                     <div class="section">
                        <p>发生这种情况时，警报日志包含以下错误，其中<span class="italic"><code class="codeph">location</code></span>是快速恢复区域的位置：</p><pre class="oac_no_warn" dir="ltr">ORA-19816：警告：文件可能存在于数据库未知的<span class="italic">位置</span> 。
</pre><p>在这种情况下，使用RMAN命令<code class="codeph">CATALOG RECOVERY AREA</code>重新编目任何此类文件。如果相关文件的文件头已损坏，则使用操作系统实用程序手动删除该文件。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV89623"></a><div class="props_rev_3"><a id="GUID-93AE3A35-4B8C-424A-A5D4-CE14E160738C" name="GUID-93AE3A35-4B8C-424A-A5D4-CE14E160738C"></a><h3 id="BRADV-GUID-93AE3A35-4B8C-424A-A5D4-CE14E160738C" class="sect3"><span class="enumeration_section">12.4</span>更新RMAN存储库</h3>
               <div>
                  <p>某些情况可能会导致存储库与其记录的文件之间出现差异，包括磁带或磁盘故障以及用户管理的副本或RMAN相关文件的删除。</p>
                  <p>本节介绍如何确保RMAN存储库准确反映存储在磁盘和磁带上的RMAN相关文件的实际情况。</p>
               </div><a id="BRADV8171"></a><div class="props_rev_3"><a id="GUID-EFF8F8D1-D67C-4202-9C8E-DE74ADFF1FFB" name="GUID-EFF8F8D1-D67C-4202-9C8E-DE74ADFF1FFB"></a><h4 id="BRADV-GUID-EFF8F8D1-D67C-4202-9C8E-DE74ADFF1FFB" class="sect4"><span class="enumeration_section">12.4.1</span>交叉检查RMAN存储库</h4>
                  <div>
                     <p>要确保恢复目录或控制文件中的备份数据与磁盘上或介质管理目录中的相应数据同步，请执行交叉检查。<code class="codeph">CROSSCHECK</code>命令仅对当前记录在RMAN存储库中的文件进行操作。
                     </p>
                     <p>如果使用快速恢复区域，备份保留策略和归档重做日志删除策略，则无需经常执行交叉检查。如果通过RMAN以外的方式删除文件，则必须定期执行交叉检查以确保存储库数据保持最新。</p>
                  </div><a id="BRADV287"></a><a id="BRADV89624"></a><div class="props_rev_3"><a id="GUID-85697492-1075-484C-9B45-35277BBC2305" name="GUID-85697492-1075-484C-9B45-35277BBC2305"></a><h5 id="BRADV-GUID-85697492-1075-484C-9B45-35277BBC2305" class="sect5"><span class="enumeration_section">12.4.1.1</span>关于RMAN交叉检查</h5>
                     <div>
                        <p>交叉检查更新过期的RMAN存储库信息，该信息与存储库记录与其物理状态不匹配的备份有关。例如，如果用户使用操作系统命令从磁盘中删除存档日志，则存储库仍会指示日志位于磁盘上，而实际上并非如此。</p>
                        <p><a href="maintaining-rman-backups.html#GUID-85697492-1075-484C-9B45-35277BBC2305__I1010226">图12-1</a>说明了媒体管理器的交叉检查。RMAN在RMAN存储库中查询要检查的四个备份集的名称和位置。RMAN将此信息发送到目标数据库服务器，该服务器向媒体管理软件查询备份。然后，媒体管理软件检查其媒体目录，并向服务器报告缺少备份集<code class="codeph">3</code> 。RMAN将存储库中备份集<code class="codeph">3</code>的状态更新为<code class="codeph">EXPIRED</code> 。运行<code class="codeph">DELETE</code> <code class="codeph">EXPIRED</code>后，将<code class="codeph">DELETE</code>备份集<code class="codeph">3</code>的记录。</p>
                        <div class="figure" id="GUID-85697492-1075-484C-9B45-35277BBC2305__I1010226">
                           <p class="titleinfigure">图12-1交叉检查媒体管理器</p><img src="img/bradv031.png" alt="下面是图12-1的描述" title="下面是图12-1的描述" longdesc="img_text/bradv031.html"><br><a href="img_text/bradv031.html">“图12-1交叉检查媒体管理器”的描述</a></div>
                        <!-- class="figure" -->
                        <p>交叉检查很有用，因为它们可以执行以下操作：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>更新有关从磁盘或磁带上消失或已损坏的备份的过期信息</p>
                           </li>
                           <li>
                              <p>如果使用操作系统命令删除存档的重做日志或其他文件，请更新存储库</p>
                           </li>
                        </ul>
                        <p>使用交叉检查功能检查磁盘或磁带上的备份状态。如果备份在磁盘上，则<code class="codeph">CROSSCHECK</code>检查文件的标头是否有效。如果备份在磁带上，则该命令将检查介质管理软件目录中是否存在备份。
                        </p>
                        <p>备份件和图像副本的状态可以是<code class="codeph">AVAILABLE</code> ， <code class="codeph">EXPIRED</code>或<code class="codeph">UNAVAILABLE</code> 。您可以通过运行RMAN <code class="codeph">LIST</code>命令或查询<code class="codeph">V$BACKUP_FILES</code>或恢复目录视图（如<code class="codeph">RC_DATAFILE_COPY</code>或<code class="codeph">RC_ARCHIVED_LOG</code>来查看备份状态。交叉检查更新RMAN存储库，以便所有这些技术都能提供准确的信息。如果备份不再可用，RMAN <code class="codeph">EXPIRED</code> RMAN存储库中的每个备份更新为<code class="codeph">EXPIRED</code>状态。如果新的交叉检查确定再次可用的<a href="glossary.html#GUID-A8547B27-5415-4AAA-B2B4-C0998EB62E47"><span class="xrefglossterm">过期备份</span></a> ，则RMAN会将其状态更新为<code class="codeph">AVAILABLE</code> 。</p>
                        <div class="infoboxnote" id="GUID-85697492-1075-484C-9B45-35277BBC2305__GUID-FE122600-9448-4489-B153-FFAA2D1503F4">
                           <p class="notep1">注意：</p>
                           <p>该<code class="codeph">CROSSCHECK</code>命令<span class="italic">不会</span>删除操作系统文件或删除资料档案库记录。必须使用<code class="codeph">DELETE</code>命令执行这些操作。
                           </p>
                        </div>
                        <p>您可以发出<code class="codeph">DELETE</code> <code class="codeph">EXPIRED</code>命令来删除所有过期的备份。RMAN从存储库中删除过期文件的记录。如果由于某种原因文件仍然存在于媒体上，则RMAN会发出警告并列出无法删除的不匹配对象。
                        </p>
                        <div class="infoboxnotealso" id="GUID-85697492-1075-484C-9B45-35277BBC2305__GUID-95A4763F-70E8-43A9-AEC8-F1C1AAC501C5">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>用于<code class="codeph">CROSSCHECK</code>语法的<a href="../rcmrf/CROSSCHECK.html#RCMRF119" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a>以及可能的状态值的说明</p>
                              </li>
                              <li>
                                 <p>用于<code class="codeph">DELETE</code>语法的<a href="../rcmrf/DELETE.html#RCMRF121" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="BRADV89625"></a><div class="props_rev_3"><a id="GUID-E1D38362-4C8E-4F16-AEBF-6A6429D7BB3A" name="GUID-E1D38362-4C8E-4F16-AEBF-6A6429D7BB3A"></a><h5 id="BRADV-GUID-E1D38362-4C8E-4F16-AEBF-6A6429D7BB3A" class="sect5"><span class="enumeration_section">12.4.1.2</span>交叉检查所有备份和副本</h5>
                     <div>
                        <p>连接到目标数据库和恢复目录（如果使用）后，根据需要运行<code class="codeph">CROSSCHECK</code>命令以验证RMAN已知的备份的状态和可用性。</p>
                        <div class="section">
                           <p>您可以在发出<code class="codeph">CROSSCHECK</code>或<code class="codeph">DELETE</code>命令之前配置或手动分配多个通道。RMAN在与用于创建备份的通道具有相同设备类型的所有通道上搜索每个备份。多通道功能主要用于在单个命令中交叉检查或删除磁盘和磁带上的备份时使用。例如，假设您具有如下配置的<a href="glossary.html#GUID-2E48CE71-9547-4196-B715-5CE59033262E"><span class="xrefglossterm">SBT</span></a>通道：</p><pre class="pre codeblock"><code>配置设备类型sbt PARALLELISM 1; CONFIGURE DEFAULT DEVICE TYPE sbt;</code></pre><p>在这种情况下，您可以运行以下命令来交叉检查磁盘和SBT：</p><pre class="pre codeblock"><code>CROSSCHECK BACKUP; CROSSCHECK COPY;</code></pre><p>RMAN使用SBT通道和预配置的磁盘通道来执行交叉检查。示例输出如下：</p><pre class="pre codeblock"><code>已分配的通道：ORA_SBT_TAPE_1通道ORA_SBT_TAPE_1：sid = 12 devtype = SBT_TAPE通道ORA_SBT_TAPE_1：警告：Oracle Test Disk API使用通道ORA_DISK_1交叉检查备件：发现是'AVAILABLE'备件句柄= / oracle / dbs / 16c5esv4_1_1 recid = 36 stamp = 408384484交叉验证备份件：发现'AVAILABLE'备件件手柄= / oracle / dbs / c-674966176-20000915-01 recid = 37 stamp = 408384496交叉检查备件：发现'AVAILABLE'备件件手柄= 12c5erb2_1_1 recid = 32邮票= 408382820。。。
</code></pre><p>如果您没有配置自动SBT通道，则可以在磁盘和磁带上手动分配维护通道。</p><pre class="pre codeblock"><code>用于维护设备类型的分配信道sbt; CROSSCHECK BACKUP; CROSSCHECK COPY;</code></pre><p>您不必手动分配磁盘通道，因为RMAN使用预配置的磁盘通道。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV288"></a><a id="BRADV89626"></a><div class="props_rev_3"><a id="GUID-C306C814-ACB3-49E7-AEBD-C0A7FC78D163" name="GUID-C306C814-ACB3-49E7-AEBD-C0A7FC78D163"></a><h5 id="BRADV-GUID-C306C814-ACB3-49E7-AEBD-C0A7FC78D163" class="sect5"><span class="enumeration_section">12.4.1.3</span>交叉检查特定备份集和副本</h5>
                     <div>
                        <p>您可以使用<code class="codeph">LIST</code>命令报告备份，然后使用<code class="codeph">CROSSCHECK</code>命令检查<code class="codeph">LIST</code>输出中描述的特定备份是否仍然存在。
                        </p>
                        <p><code class="codeph">DELETE</code> <code class="codeph">EXPIRED</code>命令删除未通过交叉检查的备份的存储库记录。
                        </p>
                        <div class="section">
                           <p class="subhead3" id="GUID-C306C814-ACB3-49E7-AEBD-C0A7FC78D163__GUID-5C69440C-888B-4CC5-986C-8FA4EA1814F5">要交叉检查指定的备份：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ol>
                              <li>
                                 <p>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</p>
                              </li>
                              <li>
                                 <p>运行<code class="codeph">LIST</code>命令以标识要检查的备份。
                                 </p>
                                 <p>例如，运行以下命令：</p><pre class="pre codeblock"><code>列表备份; ＃列出所有备份集，代理副本和映像副本</code></pre><p>交叉检查所需的备份或副本。</p>
                                 <p>以下示例命令说明了不同类型的交叉检查：</p>
                                 <p></p><pre class="pre codeblock"><code>CROSSCHECK BACKUP; ＃检查备份集，代理副本和映像副本CROSSCHECK COPY OF DATABASE; CROSSCHECK BACKUPSET 1338,1339,1340; CROSSCHECK BACKUPPIECE TAG'nightly_backup';交叉检查ARCHIVELOG所有的SPFILE备份; CROSSCHECK备份数据文件“？/oradata/trgt/system01.dbf“完成后'SYSDATE-14'; CROSSCHECK BACKUPSET设备类型磁盘备份3次; sbt; CROSSCHECK备份数据库备份2次到sbt; CROSSCHECK CONTROLFILECOPY'/ tmp / control01.ctl' ; CROSSCHECK DATAFILECOPY 113,114,115; CROSSCHECK PROXY 789;</code></pre></li>
                           </ol>
                           <div class="infoboxnotealso" id="GUID-C306C814-ACB3-49E7-AEBD-C0A7FC78D163__GUID-D0628D95-1639-498A-ADFB-C4E939600C9A">
                              <p class="notep1">也可以看看：</p>
                              <p>有关使用<code class="codeph">CROSSCHECK</code>检查特定文件备份的更多详细信息，请参阅<a href="../rcmrf/CROSSCHECK.html#RCMRF119" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-13BC4512-CCD8-4ADA-A7DB-45EEF10A58C5" name="GUID-13BC4512-CCD8-4ADA-A7DB-45EEF10A58C5"></a><h5 id="BRADV-GUID-13BC4512-CCD8-4ADA-A7DB-45EEF10A58C5" class="sect5"><span class="enumeration_section">12.4.1.4</span>交叉检查预填充备份</h5>
                     <div>
                        <p>使用<code class="codeph">CROSSCHECK</code>命令验证RMAN已知的预刷新备份和预刷新归档重做日志文件的状态和可用性。</p>
                        <div class="section">
                           <p></p>
                        </div>
                        <!-- class="section" -->
                        <div class="p">确保目标数据库可以访问在源CDB上创建的预刷新备份和预打印归档重做日志文件。</div>
                        <!-- class="section" -->
                        <div class="p"><span class="bold">要交叉检查预包装备份：</span></div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>启动RMAN并以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的公共用户身份连接到目标数据库的根目录。如果使用，请连接到恢复目录。</span><div>
                                 <p>请参阅<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”</span> 。
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>确保目标CDB以读写模式打开。</span><div>
                                 <p>以下命令显示数据库的打开模式：</p><pre class="pre codeblock"><code>从V $ DATABASE中选择OPEN_MODE;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>将预包装容器设置为必须交叉检查其预包装备份的PDB。</span><div>
                                 <p>以下示例将预包装容器设置为PDB <code class="codeph">my_pdb</code> ：</p><pre class="pre codeblock"><code>SET PREPLUGIN CONTAINER = my_pdb;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>运行<code class="codeph">CROSSCHECK</code>命令以验证预包装备份的状态和可用性。</span><div>
                                 <p>以下命令交叉检查PDB <code class="codeph">my_pdb</code>的备份。
                                 </p><pre class="pre codeblock"><code>CROSSCHECK PREPLUGIN可插入数据库的备份my_pdb;</code></pre></div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div><a id="BRADV8173"></a><div class="props_rev_3"><a id="GUID-D7C0DB1F-A0E6-43A2-8A6F-4B175D37BDFE" name="GUID-D7C0DB1F-A0E6-43A2-8A6F-4B175D37BDFE"></a><h4 id="BRADV-GUID-D7C0DB1F-A0E6-43A2-8A6F-4B175D37BDFE" class="sect4"><span class="enumeration_section">12.4.2</span>更改备份和副本的存储库状态</h4>
                  <div>
                     <p>RMAN提供了多种更改备份和副本的存储库状态的方法。</p>
                     <p>执行以下任何任务以更改备份和副本的存储库状态：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>使备份可用或不可用</p>
                           <p>如果备份暂时可用或不可用，您可以更改备份的状态。例如，如果已安装的磁盘进行维护，则可以将磁盘上备份的记录更新为<code class="codeph">UNAVAILABLE</code>状态。</p>
                           <p><a href="maintaining-rman-backups.html#GUID-B8ADC6B5-A7F4-4045-9BCE-CC9912F8FCFC" title="运行CHANGE ...无法找到备份或已异地迁移时的UNAVAILABLE命令。">将备份更新为状态AVAILABLE或UNAVAILABLE</a>描述了如何使备份可用或不可用。
                           </p>
                        </li>
                        <li>
                           <p>包括或免除保留策略中的备份</p>
                           <p>可以使用<code class="codeph">KEEP</code>子句创建存档备份，以从配置的保留策略中免除备份。您还可以更改存档备份的状态，然后将其包含在配置的保留策略中。
                           </p>
                           <p><a href="maintaining-rman-backups.html#GUID-9450FE74-62AE-4194-88BA-41E709576163" title="您可以将备份指定为免除保留策略。此技术对于归档备份以满足业务要求非常有用。">更改存档备份的状态</a>介绍了如何更改存档备份的状态。
                           </p>
                        </li>
                     </ul>
                  </div><a id="BRADV289"></a><a id="BRADV89627"></a><div class="props_rev_3"><a id="GUID-B8ADC6B5-A7F4-4045-9BCE-CC9912F8FCFC" name="GUID-B8ADC6B5-A7F4-4045-9BCE-CC9912F8FCFC"></a><h5 id="BRADV-GUID-B8ADC6B5-A7F4-4045-9BCE-CC9912F8FCFC" class="sect5"><span class="enumeration_section">12.4.2.1</span>将备份更新为可用或不可用的状态</h5>
                     <div>
                        <p>运行<code class="codeph">CHANGE...无法找到备份或已异地迁移时的UNAVAILABLE</code>命令。
                        </p>
                        <div class="section">
                           <p>RMAN不在<code class="codeph">RESTORE</code>或<code class="codeph">RECOVER</code>命令中使用状态为<code class="codeph">UNAVAILABLE</code>文件。如果稍后找到该文件或返回主站点，则可以通过发出<code class="codeph">CHANGE...再次更新其状态<code class="codeph">CHANGE...AVAILABLE</code> 。快速恢复区中的文件不能标记为<code class="codeph">UNAVAILABLE</code> 。</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-B8ADC6B5-A7F4-4045-9BCE-CC9912F8FCFC__GUID-114FAEE6-0832-4829-B58E-00EC1E86CA24">要将存储库中文件的状态更新为UNAVAILABLE或AVAILABLE：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>发出<code class="codeph">LIST</code>命令以确定RMAN备份的可用性状态。例如，发出以下命令以列出所有备份：</span><div><pre class="pre codeblock"><code>列表备份;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>使用<code class="codeph">UNAVAILABLE</code>或<code class="codeph">AVAILABLE</code>关键字运行<code class="codeph">CHANGE</code>以更新其在RMAN存储库中的状态。</span><div>
                                 <p>以下示例说明了<code class="codeph">CHANGE</code>命令的形式：</p><pre class="pre codeblock"><code>CHANGE DATAFILECOPY'/ tmp / control01.ctl'无法使用; 1000和1012之间的ARCHIVELOG序列的变化不可用;更改BACKUPSET 12无法使用;更改贴标签“TAG20120208T154556”无法使用; CHANGE DATAFILECOPY'/ tmp / system01.dbf'可用;更换BACKUPSET 12可用;更换SPFILE标签“TAG20120208T154556”可用;</code></pre></div>
                           </li>
                        </ol>
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-B8ADC6B5-A7F4-4045-9BCE-CC9912F8FCFC__GUID-8CE4A116-713D-4330-B05A-B1071B590C25">
                              <p class="notep1">也可以看看：</p>
                              <p>用于<code class="codeph">CHANGE</code>命令语法的<a href="../rcmrf/CHANGE.html#RCMRF110" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV290"></a><a id="BRADV99973"></a><div class="props_rev_3"><a id="GUID-9450FE74-62AE-4194-88BA-41E709576163" name="GUID-9450FE74-62AE-4194-88BA-41E709576163"></a><h5 id="BRADV-GUID-9450FE74-62AE-4194-88BA-41E709576163" class="sect5"><span class="enumeration_section">12.4.2.2</span>更改存档备份的状态</h5>
                     <div>
                        <p>您可以将备份指定为免除保留策略。此技术对于归档备份以满足业务要求非常有用。</p>
                        <div class="section">
                           <p>但是， <a href="glossary.html#GUID-52B0BB49-8AC2-4C8E-A52F-1908CDE77717"><span class="xrefglossterm">归档备份</span></a>仍然是完全有效的备份，并且可以像任何其他RMAN备份一样进行恢复。
                           </p>
                           <div class="infoboxnote" id="GUID-9450FE74-62AE-4194-88BA-41E709576163__GUID-A80A4F2B-5618-458C-AA17-E0B34D2207CE">
                              <p class="notep1">注意：</p>
                              <p><code class="codeph">KEEP</code> <code class="codeph">FOREVER</code>子句需要使用恢复目录，因为控制文件不能包含无限大的RMAN存储库数据集。
                              </p>
                           </div>
                           <p>您可以使用<code class="codeph">CHANGE</code>命令更改现有备份的<code class="codeph">KEEP</code>状态。例如，您可能决定不再需要长期备份。<code class="codeph">BACKUP...可用的选项相同<code class="codeph">BACKUP...KEEP</code>可用于<code class="codeph">CHANGE...KEEP</code> 。
                           </p>
                           <p>您无法为<a href="glossary.html#GUID-6E3CDD76-A573-4E5C-B12D-59C232C96C19"><span class="xrefglossterm">快速恢复区域中</span></a>存储的备份集或文件设置<code class="codeph">KEEP</code>属性。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-9450FE74-62AE-4194-88BA-41E709576163__GUID-085015B8-A1B4-4637-A2DF-0A2322153292">要更改存档备份的KEEP状态：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>发出<code class="codeph">LIST</code>命令以列出备份。例如，发出以下命令以列出所有备份：</span><div><pre class="pre codeblock"><code>列表备份;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>发出<code class="codeph">CHANGE...KEEP</code>命令为此备份定义不同的保留期，或<code class="codeph">CHANGE...NOKEEP</code>命令让保留策略应用于此文件。</span><div>
                                 <p>此示例允许备份集受备份保留策略的约束：</p><pre class="pre codeblock"><code>更换BACKUPSET 231 NOKEEP;</code></pre><p>此示例使数据文件副本免于保留策略180天：</p><pre class="pre codeblock"><code>CHANGE DATAFILECOPY'/ tmp / system01.dbf'保持时间'SYSDATE + 180';</code></pre></div>
                           </li>
                        </ol>
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-9450FE74-62AE-4194-88BA-41E709576163__GUID-C831D5C9-2383-4C3C-88D3-F566B489BAE3">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="backing-up-database.html#GUID-8894680E-8BBA-475D-8815-D789C1A04FD9" title="你可以使用BACKUP ......保持创建既包含所有权又不受备份保留策略限制的备份。通过使用带有BACKUP命令的KEEP选项，可以从保留策略中免除备份。通常，您将归档备份到磁带。由于您的数据保护备份最有可能位于一组仍可访问且可回收的磁带上，因此建议为归档备份保留一组磁带。使用带有KEEP选项的BACKUP命令进行归档备份。归档备份的一个目的是创建测试数据库。">为长期存储进行数据库备份</a></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-79700ED7-B63B-4538-B939-7F9370585FF5" name="GUID-79700ED7-B63B-4538-B939-7F9370585FF5"></a><h5 id="BRADV-GUID-79700ED7-B63B-4538-B939-7F9370585FF5" class="sect5"><span class="enumeration_section">12.4.2.3</span>更改丢弃的PDB的备份状态</h5>
                     <div>
                        <p>使用带有<code class="codeph">GUID</code>选项的<code class="codeph">CHANGE</code>命令可更改与从多租户容器数据库（CDB）中删除的可插拔数据库（PDB）对应的备份的状态。
                        </p>
                        <div class="section">
                           <p></p>
                           <p>删除PDB后，无法使用PDB名称更改与已删除的PDB关联的备份的状态。而是使用GUID来标识已删除的PDB。</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>使用<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限以普通用户身份连接到root用户。</span></li>
                           <li class="stepexpand"><span>查询<code class="codeph">DBA_PDB_HISTORY</code>视图以确定已删除的PDB的GUID。</span><div>
                                 <p>以下示例显示从CDB <code class="codeph">test_db</code>中删除的PDB：</p><pre class="pre codeblock"><code>SELECT pdb_name，pdb_guid FROM dba_pdb_history WHERE db_name ='test_db';</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>将<code class="codeph">CHANGE</code>命令与<code class="codeph">GUID</code>子句一起使用可以修改与已删除的PDB对应的备份的状态。</span><div>
                                 <p>以下命令删除与使用其GUID标识的已删除PDB关联的备份片段和映像副本的RMAN存储库记录。</p><pre class="pre codeblock"><code>更改BACKUPPIECE GUID'DFCE8C3A437F214EB4230070EC0D294E'UNCATALOG;更改复制指令'DFCE8C3A437F214EB4230070EC0D294E'UNCATALOG;</code></pre></div>
                           </li>
                        </ol>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-7528E10B-F7DE-4421-ADDE-EF6F63EA55E8" name="GUID-7528E10B-F7DE-4421-ADDE-EF6F63EA55E8"></a><h5 id="BRADV-GUID-7528E10B-F7DE-4421-ADDE-EF6F63EA55E8" class="sect5"><span class="enumeration_section">12.4.2.4</span>更改预置备份的状态</h5>
                     <div>
                        <p>使用<code class="codeph">CHANGE</code>命令可以修改预存储备份和预存储存档重做日志文件的存储库状态。
                        </p>
                        <div class="section">
                           <p></p>
                        </div>
                        <!-- class="section" -->
                        <div class="p">确保目标数据库可以访问在源CDB上创建的预刷新备份和归档重做日志文件。</div>
                        <!-- class="section" -->
                        <div class="section">
                           <p><span class="bold">要更改预包装备份的状态：</span></p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>启动RMAN并以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的公共用户身份连接到root。如果使用，请连接到恢复目录。</span><div>
                                 <p>请参阅<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”</span> 。
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>确保目标CDB以读写模式打开。</span><div>
                                 <p>以下命令显示数据库的打开模式：</p><pre class="pre codeblock"><code>从V $ DATABASE中选择OPEN_MODE;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>将当前容器设置为必须交叉检查其预包装备份的PDB。</span><div>
                                 <p>以下示例将预包装容器设置为PDB <code class="codeph">my_pdb</code> ：</p><pre class="pre codeblock"><code>SET PREPLUGIN CONTAINER = my_pdb;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>运行<code class="codeph">CHANGE</code>命令以验证preplugin归档重做日志文件的状态和可用性。</span><div>
                                 <p>以下命令使所有预制存档归档重做日志文件可用。</p><pre class="pre codeblock"><code>更改预备文件备份所有可用的;</code></pre></div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div><a id="BRADV8174"></a><div class="props_rev_3"><a id="GUID-3FC88C14-C9CC-445D-8922-C92659004FA4" name="GUID-3FC88C14-C9CC-445D-8922-C92659004FA4"></a><h4 id="BRADV-GUID-3FC88C14-C9CC-445D-8922-C92659004FA4" class="sect4"><span class="enumeration_section">12.4.3</span>将备份记录添加到RMAN存储库</h4>
                  <div>
                     <p>您可以使用<code class="codeph">CATALOG</code>命令使RMAN知道存储库中未记录的存档日志的存在，或者通过RMAN以外的方式创建的数据库文件的副本。</p>
                  </div><a id="BRADV89628"></a><div class="props_rev_3"><a id="GUID-57DADE2D-4663-4FDC-9563-EC39603642C1" name="GUID-57DADE2D-4663-4FDC-9563-EC39603642C1"></a><h5 id="BRADV-GUID-57DADE2D-4663-4FDC-9563-EC39603642C1" class="sect5"><span class="enumeration_section">12.4.3.1</span>关于编目操作</h5>
                     <div>
                        <p>目标数据库控制文件保留目标数据库和所有RMAN备份生成的所有归档重做日志的记录。<code class="codeph">CATALOG</code>命令的目的是在没有要管理的RMAN文件记录时将元数据添加到存储库。
                        </p>
                        <p>在以下情况下运行RMAN <code class="codeph">CATALOG</code>命令：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您使用操作系统实用程序来复制数据文件，存档日志或备份片。在这种情况下，存储库没有它们的记录。</p>
                           </li>
                           <li>
                              <p>使用备份控制文件执行恢复，并在恢复期间更改存档目标或格式。在这种情况下，存储库不包含有关恢复所需的存档日志的信息，您必须对这些日志进行编目。</p>
                           </li>
                           <li>
                              <p>您希望将数据文件副本编目为0级备份，从而使您可以稍后使用数据文件副本作为增量备份策略的基础来执行增量备份。</p>
                           </li>
                           <li>
                              <p>您希望编制在迁移到更高版本之前创建的Oracle7数据库文件的用户管理副本，或者在开始使用RMAN之前创建的Oracle8及更高版本数据库文件的目录。如果数据库在迁移后但在您有机会备份迁移的数据库之前失败，则可以使用这些数据文件副本来恢复数据库。</p>
                           </li>
                        </ul>
                        <p>每当您创建用户管理的副本时（例如，使用UNIX <code class="codeph">cp</code>命令复制数据文件），请务必对其进行编目。制作用户管理的副本时，您可以使用<code class="codeph">ALTER TABLESPACE...BEGIN/END BACKUP</code>语句使数据文件副本脱离在线表空间。虽然RMAN不会创建此类数据文件副本，但您可以使用<code class="codeph">CATALOG</code>命令将它们添加到恢复目录中，以便RMAN知道它们。
                        </p>
                        <p>要对用户管理的副本进行编目，必须为：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>可在磁盘上访问</p>
                           </li>
                           <li>
                              <p>单个文件的完整映像副本</p>
                           </li>
                           <li>
                              <p>数据文件副本，控制文件副本，归档重做日志副本或备份片副本</p>
                           </li>
                        </ul>
                        <p>例如，如果将数据文件存储在镜像磁盘驱动器上，则可以通过断开镜像来创建用户管理的副本。在此方案中，使用<code class="codeph">CATALOG</code>命令在断开镜像后通知RMAN存在用户管理的副本。在改造镜子之前，运行<code class="codeph">CHANGE...UNCATALOG</code>命令通知RMAN文件副本不再存在。
                        </p>
                     </div>
                  </div><a id="BRADV291"></a><a id="BRADV89629"></a><div class="props_rev_3"><a id="GUID-F5DB5D09-59AE-42D8-87C7-B8AE671DEE02" name="GUID-F5DB5D09-59AE-42D8-87C7-B8AE671DEE02"></a><h5 id="BRADV-GUID-F5DB5D09-59AE-42D8-87C7-B8AE671DEE02" class="sect5"><span class="enumeration_section">12.4.3.2</span>编目用户管理的数据文件副本</h5>
                     <div>
                        <p>使用<code class="codeph">CATALOG</code>命令将有关用户管理的副本的信息传播到RMAN存储库。对文件进行编目后，可以运行<code class="codeph">LIST</code>命令或查询<code class="codeph">V$BACKUP_FILES</code>视图以确认信息包含在RMAN存储库中。
                        </p>
                        <div class="section">
                           <p class="subhead3" id="GUID-F5DB5D09-59AE-42D8-87C7-B8AE671DEE02__GUID-C3014C81-1BC5-4C52-A72F-3D99CCC00AED">要创建和编目数据文件的用户管理副本，请执行以下操作：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>使用操作系统实用程序创建数据文件副本。如果数据库已打开且备份正在进行时数据文件处于联机状态，则需要<code class="codeph">ALTER TABLESPACE BEGIN/END BACKUP</code> 。此示例使用SQL * Plus <code class="codeph">HOST</code>命令备份联机数据文件以发出操作系统命令。</span><div><pre class="pre codeblock"><code>SQL&gt; ALTER TABLESPACE用户BEGIN BACKUP; SQL&gt; HOST CP $ ORACLE_HOME / oradata / trgt / users01.dbf /tmp/users01.dbf; SQL&gt; ALTER TABLESPACE用户END BACKUP;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span></li>
                           <li class="stepexpand"><span>运行<code class="codeph">CATALOG</code>命令。</span><div>
                                 <p>例如，输入以下命令以编目用户管理的数据文件副本：</p><pre class="pre codeblock"><code>CATALOG DATAFILECOPY'/ tmp / usersrs.10.dbf';</code></pre><p>如果您尝试从连接的目标数据库以外的数据库编目数据文件副本，则RMAN会发出如下错误：</p><pre class="pre codeblock"><code>RMAN-00571：============================================== ============= RMAN-00569：===============错误信息堆栈跟踪============== = RMAN-00571：============================================= ============== RMAN-03009：默认通道上的catalog命令失败，发生在08/29/2013 14:44:34 ORA-19563：文件/ tmp /的数据文件复制头验证失败tools01.dbf</code></pre><div class="infoboxnotealso" id="GUID-F5DB5D09-59AE-42D8-87C7-B8AE671DEE02__GUID-ADC5BD7B-DBBE-4DC9-8E3C-87DADFB38C82">
                                    <p class="notep1">也可以看看：</p>
                                    <p>用于<code class="codeph">CATALOG</code>命令语法的<a href="../rcmrf/CATALOG.html#RCMRF109" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                                 </div>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="BRADV292"></a><a id="BRADV8204"></a><div class="props_rev_3"><a id="GUID-A049B0D9-C035-4A31-81D6-B54229C9A10D" name="GUID-A049B0D9-C035-4A31-81D6-B54229C9A10D"></a><h5 id="BRADV-GUID-A049B0D9-C035-4A31-81D6-B54229C9A10D" class="sect5"><span class="enumeration_section">12.4.3.3</span>编目备份片</h5>
                     <div>
                        <p>您可以在磁盘上编目备份片段。如果使用操作系统实用程序将备份片段从一个位置复制到同一主机上的另一个位置，或从一个主机复制到另一个主机，则此技术非常有用。</p>
                        <div class="section">
                           <p>您甚至可以从数据库的先前<a href="glossary.html#GUID-4CCAB7DD-FEA7-4237-AF2C-304BA3BD52B1"><span class="xrefglossterm">版本</span></a>中编制备份片段。RMAN可以确定在后续还原和恢复操作期间是否可以使用该备份片。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-A049B0D9-C035-4A31-81D6-B54229C9A10D__GUID-367133C5-AFB3-4B63-9C19-DC7216563863">要编制备份片段：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span></li>
                           <li class="stepexpand"><span>编目备份片段的文件名。</span><div>
                                 <p>例如，输入以下命令：</p><pre class="pre codeblock"><code>CATALOG BACKUPPIECE'/ disk2 / 09dtq55d_1_2'，'/ disk2 / 0bdtqdou_1_1';</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>（可选）运行<code class="codeph">LIST</code>命令或查询<code class="codeph">V$</code>视图以验证您的更改。</span><div>
                                 <p>视图包括<code class="codeph">V$BACKUP_PIECE</code> ， <code class="codeph">V$BACKUP_SET</code> ， <code class="codeph">V$BACKUP_DATAFILE</code> ， <code class="codeph">V$BACKUP_REDOLOG</code>和<code class="codeph">V$BACKUP_SPFILE</code> 。以下查询显示备份件的名称：</p><pre class="pre codeblock"><code>从V $ BACKUP_PIECE中选择HANDLE;</code></pre><div class="infoboxnotealso" id="GUID-A049B0D9-C035-4A31-81D6-B54229C9A10D__GUID-BBA33C5D-59AC-44D9-B81F-1A4B52D50E5F">
                                    <p class="notep1">也可以看看：</p>
                                    <p>针对<code class="codeph">CATALOG</code> <code class="codeph">BACKUPPIECE</code>限制的<a href="../rcmrf/CATALOG.html#RCMRF109" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                                 </div>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="BRADV293"></a><a id="BRADV8203"></a><div class="props_rev_3"><a id="GUID-6DAB69CD-17D1-48AD-B1DD-7D1A6D073BB8" name="GUID-6DAB69CD-17D1-48AD-B1DD-7D1A6D073BB8"></a><h5 id="BRADV-GUID-6DAB69CD-17D1-48AD-B1DD-7D1A6D073BB8" class="sect5"><span class="enumeration_section">12.4.3.4</span>编目磁盘位置中的所有文件</h5>
                     <div>
                        <p>如果使用自动存储管理（ASM），Oracle托管文件框架或快速恢复区域，则可能需要重新编目磁盘管理系统已知但不再列在RMAN存储库中的文件。当用于跟踪文件名的预期机制因介质故障，软件错误或用户错误而失败时，可能会发生这种情况。</p>
                        <div class="section">
                           <p>使用<code class="codeph">CATALOG START WITH</code>命令可以搜索ASM磁盘组，Oracle Managed Files位置或传统文件系统目录中的所有文件，并调查那些未记录在RMAN存储库中的文件。如果该命令可以编目文件，那么它就会这样做。如果它无法对文件进行编目，那么它会对跳过的文件的内容进行最佳猜测。
                           </p>
                           <p>使用<code class="codeph">CATALOG RECOVERY AREA</code>命令可以对恢复区中的所有文件进行编目。通常，您不需要手动运行此命令，因为RMAN会根据需要自动运行它，例如，还原或创建控制文件时。通过操作系统实用程序将文件复制到快速恢复区域时，可以运行此命令。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-6DAB69CD-17D1-48AD-B1DD-7D1A6D073BB8__GUID-AC8F20BA-BA89-4F02-9245-AA2A7D80B79F">要编目磁盘位置中的所有文件：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span></li>
                           <li class="stepexpand"><span>运行<code class="codeph">CATALOG</code>命令，指定要编目其文件的磁盘位置。</span><div>
                                 <p>例如，输入以下命令：</p><pre class="pre codeblock"><code>CATALOG START WITH'+ disk'; #cnile ASM磁盘组CATALOG START WITH'/ fs1 / datafiles /'中的所有文件;编目目录中的所有文件</code></pre><div class="infoboxnote" id="GUID-6DAB69CD-17D1-48AD-B1DD-7D1A6D073BB8__GUID-8702E0E0-4498-42FD-A697-19D3980AC0E8">
                                    <p class="notep1">注意：</p>
                                    <p>通配符在<code class="codeph">START WITH</code>子句中不合法。
                                    </p>
                                 </div>
                                 <p>您可以使用<code class="codeph">CATALOG RECOVERY AREA</code>命令对<code class="codeph">CATALOG RECOVERY AREA</code>所有文件进行编目。在此操作期间，将添加未在RMAN存储库中列出的恢复区中的任何文件。例如：</p><pre class="pre codeblock"><code>目录恢复区;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>运行<code class="codeph">LIST</code>命令以验证文件是否已编目。</span></li>
                        </ol>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-CFB5CC03-24AD-458E-881C-561256136120" name="GUID-CFB5CC03-24AD-458E-881C-561256136120"></a><h5 id="BRADV-GUID-CFB5CC03-24AD-458E-881C-561256136120" class="sect5"><span class="enumeration_section">12.4.3.5</span>编制Preplugin存档重做日志</h5>
                     <div>
                        <p>使用<code class="codeph">CATALOG</code>命令将preplugin归档重做日志文件添加到RMAN存储库。
                        </p>
                        <div class="section">
                           <p></p>
                        </div>
                        <!-- class="section" -->
                        <div class="p">确保目标数据库可以访问在源CDB上创建的预刷新归档重做日志文件。</div>
                        <!-- class="section" -->
                        <div class="section"><span class="bold">要对归档重做日志文件的预备份备份进行编目：</span></div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>启动RMAN并以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的公共用户身份连接到目标数据库的根目录。如果使用，请连接到恢复目录。</span><div>
                                 <p>请参阅<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”</span> 。
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>确保目标CDB以读写模式打开。</span><div>
                                 <p>以下命令显示数据库的打开模式：</p><pre class="pre codeblock"><code>从V $ DATABASE中选择OPEN_MODE;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>将当前容器设置为必须交叉检查其预包装备份的PDB。</span><div>
                                 <p>以下示例将预包装容器设置为PDB <code class="codeph">my_pdb</code> ：</p><pre class="pre codeblock"><code>SET PREPLUGIN CONTAINER = my_pdb;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>运行<code class="codeph">CATALOG</code>命令以对RMAN存储库中的预存续归档重做日志文件进行编目。</span><div>
                                 <div class="p">以下命令对指定的preplugin归档重做日志进行编目。<pre class="pre codeblock"><code>CATALOG PREPLUGIN ARCHIVELOG'/disk1/backups/DB18c/backupset/2017_10_09/o1_mf_annnn_MYPDB_MIGR_dxq2r45h_.bkp';</code></pre></div>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div><a id="BRADV8175"></a><div class="props_rev_3"><a id="GUID-C675D0A5-E764-4A76-B91E-CC66EE19E801" name="GUID-C675D0A5-E764-4A76-B91E-CC66EE19E801"></a><h4 id="BRADV-GUID-C675D0A5-E764-4A76-B91E-CC66EE19E801" class="sect4"><span class="enumeration_section">12.4.4</span>从RMAN存储库中删除记录</h4>
                  <p>您可以从RMAN存储库中删除文件的记录。</p><a id="BRADV89630"></a><div class="props_rev_3"><a id="GUID-ED189CEE-26C0-4DA9-891F-E940F9050660" name="GUID-ED189CEE-26C0-4DA9-891F-E940F9050660"></a><h5 id="BRADV-GUID-ED189CEE-26C0-4DA9-891F-E940F9050660" class="sect5"><span class="enumeration_section">12.4.4.1</span>关于RMAN存储库中的Uncataloging操作</h5>
                     <div>
                        <p>运行<code class="codeph">CHANGE...UNCATALOG</code>命令对RMAN存储库记录执行以下操作：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>将控制文件存储库中的备份记录更新为<code class="codeph">DELETED</code>状态</p>
                           </li>
                           <li>
                              <p>从恢复目录中删除特定备份记录（如果使用的话）</p>
                           </li>
                        </ul>
                        <p>RMAN不会更改指定的物理文件：它只会更改这些文件的存储库记录。</p>
                        <p>通过RMAN以外的方法删除备份时，可以使用此命令。例如，如果使用操作系统实用程序删除存档的重做日志，则通过发出<code class="codeph">CHANGE</code> <code class="codeph">ARCHIVELOG</code>从存储库中删除此日志的记录<code class="codeph">...</code> <code class="codeph">UNCATALOG</code>命令。
                        </p>
                     </div>
                  </div><a id="BRADV294"></a><a id="BRADV89631"></a><div class="props_rev_3"><a id="GUID-56D305E0-DA23-4B63-BDF5-33776987FB43" name="GUID-56D305E0-DA23-4B63-BDF5-33776987FB43"></a><h5 id="BRADV-GUID-56D305E0-DA23-4B63-BDF5-33776987FB43" class="sect5"><span class="enumeration_section">12.4.4.2</span>删除使用操作系统实用程序删除的文件的记录</h5>
                     <div>
                        <p>你可以使用<code class="codeph">CHANGE ...UNCATALOG</code>命令更新缺少文件的RMAN存储库。
                        </p>
                        <div class="section">
                           <p>在某些情况下，用户可能已使用操作系统实用程序删除了备份或归档重做日志。除非您运行<code class="codeph">CROSSCHECK</code> ，否则RMAN不知道删除。在这种情况下，您可以使用<code class="codeph">CHANGE..UNCATALOG</code>命令。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-56D305E0-DA23-4B63-BDF5-33776987FB43__GUID-F6F095A0-C2EC-4431-B5CE-892B26085B0F">要删除备份或归档重做日志的目录记录，请执行以下操作：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>运行<code class="codeph">CHANGE</code> <code class="codeph">...</code> <code class="codeph">UNCATALOG</code>命令用于使用操作系统命令从操作系统中删除的备份。此示例删除对控制文件和数据文件<code class="codeph">1</code>磁盘副本的存储库引用：</span><div><pre class="pre codeblock"><code>CHANGE CONTROLFILECOPY'/ tmp / control01.ctl'UNCATALOG; CHANGE DATAFILECOPY'/ tmp / system01.dbf'UNCATALOG;更改备忘录'/disk1/oradata/backups/db1_full.bkp'UNCATALOG;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>（可选）查看相关的恢复目录视图，例如<code class="codeph">RC_DATAFILE_COPY</code>或<code class="codeph">RC_CONTROLFILE_COPY</code> ，以确认已删除给定记录。此查询确认已删除副本<code class="codeph">4833</code>的记录：</span><div><pre class="pre codeblock"><code>SELECT CDF_KEY，STATUS FROM RC_DATAFILE_COPY WHERE CDF_KEY = 4833; CDF_KEY STATUS ---------- ------选择了0行。</code></pre></div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV8172"></a><div class="props_rev_3"><a id="GUID-8C4B395D-7C24-485F-BEA0-A355821FB93D" name="GUID-8C4B395D-7C24-485F-BEA0-A355821FB93D"></a><h3 id="BRADV-GUID-8C4B395D-7C24-485F-BEA0-A355821FB93D" class="sect3"><span class="enumeration_section">12.5</span>删除RMAN备份和归档重做日志</h3>
               <div>
                  <p>您可以使用RMAN <code class="codeph">DELETE</code>命令删除存档的重做日志和RMAN备份。
                  </p>
                  <p>对于磁盘上的备份，删除备份会从磁盘中删除备份文件。对于<a href="glossary.html#GUID-2E48CE71-9547-4196-B715-5CE59033262E"><span class="xrefglossterm">SBT</span></a>设备上的备份，RMAN <code class="codeph">DELETE</code>命令指示介质管理器删除磁带上的备份片或代理副本。在任何一种情况下，RMAN都会更新RMAN存储库以反映删除。
                  </p>
                  <div class="infoboxnote" id="GUID-8C4B395D-7C24-485F-BEA0-A355821FB93D__GUID-C9F5E703-BE0A-4331-B2DE-6CB3879999AA">
                     <p class="notep1">注意：</p>
                     <p>在CDB中，只有在以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的用户身份连接到root时，才能删除存档日志。连接到PDB时，无法删除存档的重做日志。</p>
                  </div>
               </div><a id="BRADV89632"></a><div class="props_rev_3"><a id="GUID-8EFDE192-A385-457E-B00A-7A9ED7598223" name="GUID-8EFDE192-A385-457E-B00A-7A9ED7598223"></a><h4 id="BRADV-GUID-8EFDE192-A385-457E-B00A-7A9ED7598223" class="sect4"><span class="enumeration_section">12.5.1</span>删除RMAN备份概述</h4>
                  <div>
                     <p>每个RMAN备份在RMAN存储库中生成相应的记录。该记录存储在控制文件中。如果使用了恢复目录，则在从控制文件重新同步恢复目录后，也可以在恢复目录中找到该记录。</p>
                     <p>例如，如果生成完整数据库备份集，则可以在<code class="codeph">V$BACKUP_SET</code>查看此备份集的记录。如果使用恢复目录，则还可以访问<code class="codeph">RC_BACKUP_SET</code>目录视图中的记录。
                     </p>
                     <p><code class="codeph">V$</code>控制文件视图和恢复目录视图在存储信息的方式上有所不同，这会影响RMAN处理存储库记录的方式。恢复目录RMAN存储库存储在实际数据库表中，而存储库的控制文件版本存储在控制文件的内部结构中。
                     </p>
                     <p>使用RMAN命令删除备份或归档重做日志文件时，RMAN执行以下操作：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>从操作系统中删除物理文件（如果文件仍然存在）</p>
                        </li>
                        <li>
                           <p>将控制文件中的文件记录更新为<code class="codeph">DELETED</code>状态</p>
                        </li>
                        <li>
                           <p>从恢复目录表中删除文件记录（如果RMAN连接到恢复目录）</p>
                        </li>
                     </ul>
                     <p>由于存储控制文件数据的方式，RMAN无法从控制文件中删除记录，只能将其更新为<code class="codeph">DELETED</code>状态。但是，由于恢复目录表是普通数据库表，因此RMAN会从中删除行，其方式与从任何表中删除行的方式相同。
                     </p>
                  </div><a id="BRADV295"></a><a id="BRADV90079"></a><div class="props_rev_3"><a id="GUID-1A707B20-A04E-4D24-9722-605E95158754" name="GUID-1A707B20-A04E-4D24-9722-605E95158754"></a><h5 id="BRADV-GUID-1A707B20-A04E-4D24-9722-605E95158754" class="sect5"><span class="enumeration_section">12.5.1.1</span>关于RMAN删除命令</h5>
                     <div>
                        <p>您可以删除备份的备份和恢复目录记录。</p>
                        <p>下表介绍了可以删除备份的RMAN命令。</p>
                        <div class="tblformal" id="GUID-1A707B20-A04E-4D24-9722-605E95158754__CHDDBBIJ">
                           <p class="titleintable">表12-1 RMAN删除命令</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="RMAN删除命令" width="100%" border="1" summary="This table describes RMAN commands that can delete backups." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" id="d58406e5890">命令</th>
                                    <th align="left" valign="bottom" id="d58406e5893">目的</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d58406e5898" headers="d58406e5890 ">
                                       <p><code class="codeph">删除</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d58406e5898 d58406e5893 ">
                                       <p>要删除备份，请将控制文件记录更新为<code class="codeph">DELETED</code>状态，并从恢复目录中删除其记录（如果使用了恢复目录）。
                                       </p>
                                       <p>您可以指定<code class="codeph">DELETE</code>删除<code class="codeph">EXPIRED</code>或<code class="codeph">OBSOLETE</code>备份。如果对存在的备份运行<code class="codeph">DELETE</code> <code class="codeph">EXPIRED</code> ，则RMAN会发出警告并且不会删除备份。如果将<code class="codeph">DELETE</code>命令与可选的<code class="codeph">FORCE</code>关键字一起使用，则RMAN会删除指定的备份，但会忽略任何I / O错误，包括磁盘或磁带中缺少备份时发生的错误。然后，它会更新RMAN存储库以反映删除备份的事实，无论RMAN是否能够删除该文件或文件是否丢失。
                                       </p>
                                       <p>RMAN使用所有已配置的通道执行删除。如果对未配置为自动通道的设备上的文件使用<code class="codeph">DELETE</code> ，则必须首先使用<code class="codeph">ALLOCATE CHANNEL FOR MAINTENANCE</code>命令。例如，如果使用SBT通道进行备份，但只配置了磁盘通道，则必须手动为<code class="codeph">DELETE</code>分配SBT通道。在仅磁盘文件上使用<code class="codeph">DELETE</code>命令时，需要自动或手动分配的维护通道。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d58406e5947" headers="d58406e5890 ">
                                       <p><code class="codeph">备份...删除[全部]输入</code> 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" headers="d58406e5947 d58406e5893 ">
                                       <p>要备份存档日志，数据文件副本或备份集，请在成功完成备份后从操作系统中删除输入文件。RMAN还删除并更新已删除输入文件的存储库记录。</p>
                                       <p>如果指定<code class="codeph">DELETE</code> <code class="codeph">INPUT</code> （不包括<code class="codeph">ALL</code> ），则RMAN仅删除它备份的特定文件。如果指定<code class="codeph">ALL INPUT</code> ，则RMAN将删除RMAN存储库中记录的文件的所有副本。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d58406e5970" headers="d58406e5890 ">
                                       <p><code class="codeph">更改...UNCATALOG</code> 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" headers="d58406e5970 d58406e5893 ">
                                       <p>删除指定备份的恢复目录记录，并将其控制文件记录更改为<code class="codeph">DELETED</code>状态。 <code class="codeph">CHANGE...UNCATALOG</code>命令仅更改备份的RMAN存储库记录，并不实际删除备份。
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>对象的RMAN存储库记录有时可能无法反映对象的物理状态。例如，您将归档的重做日志备份到磁盘，然后使用操作系统实用程序将其删除。如果在未先运行<code class="codeph">CROSSCHECK</code>情况下运行<code class="codeph">DELETE</code> ，则存储库会错误地将日志列为<code class="codeph">AVAILABLE</code> 。</p>
                        <p>如果以交互方式运行RMAN，则RMAN会在删除任何文件之前要求确认。您可以通过任何形式的<code class="codeph">BACKUP</code>命令使用<code class="codeph">NOPROMPT</code>关键字来禁止这些确认：</p><pre class="pre codeblock"><code>删除NOPROMPT ARCHIVELOG ALL;</code></pre><div class="infoboxnotealso" id="GUID-1A707B20-A04E-4D24-9722-605E95158754__GUID-ACCD65CE-855A-49C2-9EF7-DA27A273B3D5">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../rcmrf/DELETE.html#RCMRF121" target="_blank"><span><cite>Oracle数据库备份和恢复参考，</cite></span></a>用于描述RMAN存储库与物理介质之间发生不匹配时的<code class="codeph">DELETE</code>行为</p>
                        </div>
                     </div>
                  </div><a id="BRADV90080"></a><div class="props_rev_3"><a id="GUID-8E5E9B7B-6627-4B14-8BFC-1C53EFB82FEF" name="GUID-8E5E9B7B-6627-4B14-8BFC-1C53EFB82FEF"></a><h5 id="BRADV-GUID-8E5E9B7B-6627-4B14-8BFC-1C53EFB82FEF" class="sect5"><span class="enumeration_section">12.5.1.2</span>关于删除存档的重做日志</h5>
                     <div>
                        <p>建议的维护策略是配置快速恢复区域，备份保留策略和归档重做日志删除策略。</p>
                        <p>默认情况下，归档重做日志删除策略配置为<code class="codeph">NONE</code> 。在这种情况下，快速恢复区域会将符合删除条件的日志视为已至少备份一次到磁盘或磁带，或者日志已根据备份保留策略过时。
                        </p>
                        <p>归档重做日志可以由数据库或<a href="maintaining-rman-backups.html#GUID-1A707B20-A04E-4D24-9722-605E95158754__CHDDBBIJ" title="此表描述了可以删除备份的RMAN命令。">表12-1中</a>列出的任何用户启动的RMAN命令自动删除。对于恢复区域中的日志，数据库会尽可能长时间地保留它们，并在需要磁盘空间时自动删除符合条件的日志。您可以使用<code class="codeph">BACKUP ...从恢复区域内部或外部的任何位置删除符合条件的日志<code class="codeph">BACKUP ...DELETE INPUT</code>或<code class="codeph">DELETE ARCHIVELOG</code> 。当策略是<code class="codeph">NONE</code>以外的任何设置时，这两个命令都遵循归档重做日志删除策略。您可以使用<code class="codeph">DELETE</code>命令中的<code class="codeph">FORCE</code>选项覆盖存档的重做日志删除策略设置。
                        </p>
                        <div class="infoboxnotealso" id="GUID-8E5E9B7B-6627-4B14-8BFC-1C53EFB82FEF__GUID-932E245A-5414-45AC-B1FC-C785C73BF966">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="maintaining-rman-backups.html#GUID-E5BBAAFE-1191-4A96-A63A-91EDF87F7C3E" title="RMAN提供多个命令来维护RMAN备份和存储库记录。">备份和存储库维护的基本概念</a></p>
                              </li>
                              <li>
                                 <p><a href="configuring-rman-client-basic.html#GUID-FA142760-8ACB-43DA-939C-8407618D2D0F" title="您可以使用RMAN创建一个持久性配置，以管理归档重做日志何时有资格从磁盘中删除。">配置存档重做日志删除策略</a></p>
                              </li>
                              <li>
                                 <p>有关策略选项的详细信息，请参阅<a href="../rcmrf/CONFIGURE.html#RCMRF113" target="_blank"><span><cite>Oracle数据库备份和恢复参考中</cite></span></a>的<code class="codeph">CONFIGURE ARCHIVELOG DELETION POLICY</code>条目</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div><a id="BRADV296"></a><a id="BRADV89633"></a><div class="props_rev_3"><a id="GUID-0F82F489-C5FB-41C2-9687-AE9A5CD89406" name="GUID-0F82F489-C5FB-41C2-9687-AE9A5CD89406"></a><h4 id="BRADV-GUID-0F82F489-C5FB-41C2-9687-AE9A5CD89406" class="sect4"><span class="enumeration_section">12.5.2</span>删除所有备份和副本</h4>
                  <div>
                     <p>使用RMAN <code class="codeph">DELETE</code>命令删除备份和映像副本。
                     </p>
                     <div class="section">
                        <p>在某些情况下，您可能需要删除与数据库关联的所有备份集，代理副本和映像副本。例如，您不再需要数据库并且想要从系统中删除所有相关文件。映像副本是使用<code class="codeph">BACKUP AS COPY</code>命令生成的文件，由数据库归档的日志或使用<code class="codeph">CATALOG</code>命令编目的文件。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-0F82F489-C5FB-41C2-9687-AE9A5CD89406__GUID-D4F05D76-331B-4B4E-9155-3BC5BB145A2E">要删除所有备份和副本：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span></li>
                        <li class="stepexpand"><span>如有必要，为包含要删除的备份的设备分配维护通道。</span><div>
                              <p>如<a href="maintaining-rman-backups.html#GUID-1A707B20-A04E-4D24-9722-605E95158754__CHDDBBIJ" title="此表描述了可以删除备份的RMAN命令。">表12-1中所述</a> ，RMAN使用所有已配置的通道执行删除。如果配置了通道，则无需手动分配维护通道。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>交叉检查备份和副本以确保逻辑记录与物理介质同步。</span><div><pre class="pre codeblock"><code>CROSSCHECK BACKUP; CROSSCHECK COPY;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>删除备份和副本。</span><div>
                              <p>例如，输入以下命令，然后在提示时输入<code class="codeph">YES</code> ：</p><pre class="pre codeblock"><code>删除备份;删除复制;</code></pre><p>如果配置了磁盘和磁带通道，则RMAN在删除时使用配置的SBT通道和预配置的磁盘通道。在删除任何文件之前，RMAN会提示您进行确认。</p>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV297"></a><a id="BRADV89634"></a><div class="props_rev_3"><a id="GUID-D39FCF70-C71B-46C7-8ED5-94CF33A5611D" name="GUID-D39FCF70-C71B-46C7-8ED5-94CF33A5611D"></a><h4 id="BRADV-GUID-D39FCF70-C71B-46C7-8ED5-94CF33A5611D" class="sect4"><span class="enumeration_section">12.5.3</span>删除指定的备份和副本</h4>
                  <div>
                     <p>你可以同时使用<code class="codeph">DELETE</code>和<code class="codeph">BACKUP ...DELETE</code>命令以删除特定备份和副本。
                     </p>
                     <div class="section">
                        <p><code class="codeph">BACKUP ...DELETE</code>命令首先备份文件，通常备份到磁带，然后删除输入文件。
                        </p>
                        <p><code class="codeph">DELETE</code>命令支持多种选项来标识要删除的对象。删除存档的重做日志时，RMAN使用配置的设置来确定是否可以删除日志。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-D39FCF70-C71B-46C7-8ED5-94CF33A5611D__GUID-CAAA59BD-9164-4940-933C-F5435DAC7083">要删除指定的备份和副本：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span></li>
                        <li class="stepexpand"><span>如有必要，为包含要删除的备份的设备分配维护通道。</span><div>
                              <p>如<a href="maintaining-rman-backups.html#GUID-1A707B20-A04E-4D24-9722-605E95158754__CHDDBBIJ" title="此表描述了可以删除备份的RMAN命令。">表12-1中所述</a> ，RMAN使用所有已配置的通道执行删除。如果配置了通道，则无需手动分配维护通道。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>删除指定的备份和副本。</span><div>
                              <p>以下示例显示了使用<code class="codeph">DELETE</code>命令指定要删除的备份和归档日志的许多常用方法：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>使用<code class="codeph">LIST</code>输出中的主键删除备份：</p><pre class="pre codeblock"><code>删除BACKUPPIECE 101;</code></pre></li>
                                 <li>
                                    <p>按磁盘上的文件名删除备份：</p><pre class="pre codeblock"><code>DELETE CONTROLFILECOPY'/ tmp / control01.ctl';</code></pre></li>
                                 <li>
                                    <p>删除存档的重做日志：</p><pre class="pre codeblock"><code>删除NOPROMPT ARCHIVELOG直到SEQUENCE 300;</code></pre></li>
                                 <li>
                                    <p>根据标记删除备份：</p><pre class="pre codeblock"><code>删除备份标记'before_upgrade';</code></pre></li>
                                 <li>
                                    <p>根据备份的对象以及存储备份的介质或磁盘位置删除备份：</p><pre class="pre codeblock"><code>删除TABLESPACE用户备份设备类型sbt; ＃仅从磁带中删除DELETE COPY OF CONTROLFILE LIKE'/ tmp /％';</code></pre></li>
                                 <li>
                                    <p>根据磁盘上是否备份磁盘，从磁盘中删除归档重做日志：</p><pre class="pre codeblock"><code>DELETE ARCHIVELOG全部备份3次;</code></pre><p></p>
                                 </li>
                                 <li>
                                    <p>删除已备份两次到磁带的备份集：</p><pre class="pre codeblock"><code>删除BACKUPSET设备类型磁盘备份2次sbt;</code></pre></li>
                                 <li>
                                    <p>删除曾经备份到磁带的目标数据库的备份：</p><pre class="pre codeblock"><code>删除数据库设备类型的备份磁盘备份1次到sbt;</code></pre></li>
                              </ul>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-D39FCF70-C71B-46C7-8ED5-94CF33A5611D__GUID-AF54462F-A006-4381-98F3-9B2747BC0C83">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="configuring-rman-client-basic.html#GUID-FA142760-8ACB-43DA-939C-8407618D2D0F" title="您可以使用RMAN创建一个持久性配置，以管理归档重做日志何时有资格从磁盘中删除。">配置存档重做日志删除策略</a></p>
                              </li>
                              <li>
                                 <p>有关<code class="codeph">DELETE</code>命令选项的完整信息，请<a href="../rcmrf/DELETE.html#RCMRF121" target="_blank"><span><cite>参见Oracle数据库备份和恢复参考</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div><a id="BRADV89636"></a><div class="props_rev_3"><a id="GUID-4B7E3F2B-25E0-4F66-B34D-E547200DF4AD" name="GUID-4B7E3F2B-25E0-4F66-B34D-E547200DF4AD"></a><h5 id="BRADV-GUID-4B7E3F2B-25E0-4F66-B34D-E547200DF4AD" class="sect5"><span class="enumeration_section">12.5.3.1</span>使用BACKUP删除指定的文件...删除</h5>
                     <div>
                        <p>你可以使用<code class="codeph">BACKUP ...DELETE</code>以备份存档的重做日志，数据文件副本或备份集，然后在成功备份后删除输入文件。
                        </p>
                        <div class="section">
                           <p>指定<code class="codeph">DELETE INPUT</code>选项等同于为输入文件发出<code class="codeph">DELETE</code>命令。RMAN使用配置的设置来确定是否可以删除存档的重做日志。<code class="codeph">DELETE ALL INPUT</code>子句中的<code class="codeph">ALL</code>选项仅适用于归档重做日志。如果你运行<code class="codeph">BACKUP ...DELETE ALL INPUT</code> ，然后该命令将删除与<code class="codeph">BACKUP</code>命令中的选择条件匹配的相应归档重做日志或数据文件副本的所有副本。
                           </p>
                           <div class="infoboxnotealso" id="GUID-4B7E3F2B-25E0-4F66-B34D-E547200DF4AD__GUID-80C13516-3875-46D7-84AE-0EA54872600D">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="configuring-rman-client-basic.html#GUID-FA142760-8ACB-43DA-939C-8407618D2D0F" title="您可以使用RMAN创建一个持久性配置，以管理归档重做日志何时有资格从磁盘中删除。">配置存档重做日志删除策略</a></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="BRADV300"></a><a id="BRADV89637"></a><div class="props_rev_3"><a id="GUID-ABB66655-6FAC-4375-AFA0-2E40634085A5" name="GUID-ABB66655-6FAC-4375-AFA0-2E40634085A5"></a><h4 id="BRADV-GUID-ABB66655-6FAC-4375-AFA0-2E40634085A5" class="sect4"><span class="enumeration_section">12.5.4</span>删除过期的RMAN备份和副本</h4>
                  <div>
                     <p>如果您运行<code class="codeph">CROSSCHECK</code> ，并且RMAN无法找到文件，则它会将RMAN存储库中的记录更新为<code class="codeph">EXPIRED</code>状态。然后，您可以使用<code class="codeph">DELETE EXPIRED</code>命令从RMAN存储库中删除过期备份和副本的记录。
                     </p>
                     <div class="section">
                        <p>如果任何标记为<code class="codeph">EXPIRED</code>文件实际存在，则<code class="codeph">DELETE EXPIRED</code>命令会发出警告。在极少数情况下，即使文件存在，存储库也可以将文件标记为<code class="codeph">EXPIRED</code> 。例如，包含文件的目录在交叉检查时已损坏，但稍后已修复，或者媒体管理器未正确配置，并且报告某些备份在它们确实存在时不存在。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-ABB66655-6FAC-4375-AFA0-2E40634085A5__GUID-B793C621-31B3-4D50-BDFC-8E2B57CD79E4">要删除过期的存储库记录：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>如果您最近未执行交叉检查，则发出<code class="codeph">CROSSCHECK</code>命令。例如，问题：</span><div><pre class="pre codeblock"><code>CROSSCHECK BACKUP;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>删除过期的备份。例如，问题：</span><div><pre class="pre codeblock"><code>DELETE EXPIRED BACKUP;</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV89639"></a><div class="props_rev_3"><a id="GUID-DB5F52FF-58DE-4486-B0B3-D0EAEA26A776" name="GUID-DB5F52FF-58DE-4486-B0B3-D0EAEA26A776"></a><h4 id="BRADV-GUID-DB5F52FF-58DE-4486-B0B3-D0EAEA26A776" class="sect4"><span class="enumeration_section">12.5.5</span>根据保留策略删除过时的RMAN备份</h4>
                  <div>
                     <p>RMAN <code class="codeph">DELETE</code>命令支持<code class="codeph">OBSOLETE</code>选项，该选项删除不再需要的备份以满足指定的可恢复性要求。
                     </p>
                     <div class="section">
                        <p>您可以根据配置的默认保留策略或您指定为<code class="codeph">DELETE OBSOLETE</code>命令选项的其他保留策略<code class="codeph">DELETE OBSOLETE</code> 。与其他形式的<code class="codeph">DELETE</code>命令一样，删除的文件将从备份媒体中删除，从恢复目录中删除，并在控制文件中标记为<code class="codeph">DELETED</code> 。
                        </p>
                        <p>如果指定不带参数的<code class="codeph">DELETE OBSOLETE</code>命令，则RMAN将删除由配置的保留策略定义的所有过时备份。例如：</p><pre class="pre codeblock"><code>DELETE OBSOLETE;</code></pre></div>
                     <!-- class="section" -->
                  </div><a id="BRADV89640"></a><div class="props_rev_3"><a id="GUID-74F6BD50-B15F-40C6-95A1-6E8196C2D03F" name="GUID-74F6BD50-B15F-40C6-95A1-6E8196C2D03F"></a><h5 id="BRADV-GUID-74F6BD50-B15F-40C6-95A1-6E8196C2D03F" class="sect5"><span class="enumeration_section">12.5.5.1</span>当KEEP UNTIL TIME到期时，DELETE OBSOLETE行为</h5>
                     <div>
                        <p>如果存档备份的<code class="codeph">KEEP UNTIL TIME</code>周期尚未到期，则RMAN不会将备份视为过时。但是，只要<code class="codeph">KEEP UNTIL</code>期限到期，无论是否配置了任何备份保留策略，备份都会立即被视为已过时。因此， <code class="codeph">DELETE OBSOLETE</code>删除使用<code class="codeph">BACKUP ...创建的任何备份<code class="codeph">BACKUP ...KEEP UNTIL TIME</code>如果<code class="codeph">KEEP</code>时间已过期。
                        </p>
                        <div class="infoboxnotealso" id="GUID-74F6BD50-B15F-40C6-95A1-6E8196C2D03F__GUID-FDE903BF-76B8-4689-96BC-3789623DECAB">
                           <p class="notep1">也可以看看：</p>
                           <p>适用于<span class="italic"><code class="codeph">keepOption</code></span>语法的<a href="../rcmrf/keepOption.html#RCMRF131" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-89EE05B7-1610-4FE7-BA33-0C212E30420A" name="GUID-89EE05B7-1610-4FE7-BA33-0C212E30420A"></a><h4 id="BRADV-GUID-89EE05B7-1610-4FE7-BA33-0C212E30420A" class="sect4"><span class="enumeration_section">12.5.6</span>删除丢弃的PDB的备份</h4>
                  <div>
                     <p>使用带有<code class="codeph">GUID</code>选项的<code class="codeph">DELETE</code>命令可以删除已从多租户容器数据库（CDB）中删除的可插拔数据库（PDB）的备份。
                     </p>
                     <div class="section">
                        <p><code class="codeph">DELETE BACKUP ...OF PLUGGABLE DATABASE</code>命令删除指定PDB的备份。但是，在删除PDB后，您无法使用此命令，因为具有指定名称的PDB不再存在。在这种情况下，请使用<code class="codeph">DELETE BACKUP … GUID</code>命令删除已删除PDB的备份。每个PDB具有全局唯一标识符（GUID），其可用于唯一地标识PDB。删除的PDB的GUID在<code class="codeph">DBA_PDB_HISTORY</code>视图中可用。
                        </p>
                        <p><span class="bold">要删除已删除PDB的备份：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>使用<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限以普通用户身份连接到root用户。</span></li>
                        <li class="stepexpand"><span>查询<code class="codeph">DBA_PDB_HISTORY</code>视图以确定已删除的PDB的GUID。</span><div>
                              <p>以下示例显示从CDB <code class="codeph">prod_db</code>中删除的PDB：</p><pre class="pre codeblock"><code>SELECT pdb_name，pdb_guid FROM dba_pdb_history WHERE db_name ='prod_db';</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>使用带有<code class="codeph">GUID</code>选项的<code class="codeph">DELETE</code>命令删除与已删除的PDB关联的备份或副本。</span><div>
                              <p>以下命令删除具有指定GUID的已删除PDB的备份集和映像副本：</p><pre class="pre codeblock"><code>DELETE BACKUP GUID'100E64EC12445321C0352900AF0FAC93';删除复制指令'100E64EC12445321C0352900AF0FAC93';</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-9180E139-6C6E-41C2-8615-D99FC1C2C238" name="GUID-9180E139-6C6E-41C2-8615-D99FC1C2C238"></a><h4 id="BRADV-GUID-9180E139-6C6E-41C2-8615-D99FC1C2C238" class="sect4"><span class="enumeration_section">12.5.7</span>删除预刷新备份</h4>
                  <div>
                     <p>使用<code class="codeph">DELETE</code>命令删除预制备份备份和prelplugin存档重做日志文件。
                     </p>
                     <div class="section">
                        <p></p>
                     </div>
                     <!-- class="section" -->
                     <div class="p">确保目标CDB可以访问在源数据库上创建的预包装备份。</div>
                     <!-- class="section" -->
                     <div class="section"><span class="bold">要删除预包装备份：</span></div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的公共用户身份连接到目标CDB的根目录。如果使用，请连接到恢复目录。</span><div>
                              <p>请参阅<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”</span> 。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>确保目标CDB以读写模式打开。</span><div>
                              <p>以下命令显示数据库的打开模式：</p><pre class="pre codeblock"><code>从V $ DATABASE中选择OPEN_MODE;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>将当前容器设置为必须交叉检查其预包装备份的PDB。</span><div>
                              <p>以下示例将预包装容器设置为PDB <code class="codeph">my_pdb</code> ：</p><pre class="pre codeblock"><code>SET PREPLUGIN CONTAINER = my_pdb;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>运行<code class="codeph">DELETE</code>命令以验证预包装备份的状态和可用性。</span><div>
                              <p>以下命令删除PDB <code class="codeph">my_pdb</code>份备份。
                              </p><pre class="pre codeblock"><code>DELETE PREPLUGIN BACKUP OF PLUGGABLE DATABASE my_pdb;</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div><a id="BRADV612"></a><a id="BRADV89641"></a><div class="props_rev_3"><a id="GUID-45EFE02D-488C-4F55-A648-6FFF5CB7A32F" name="GUID-45EFE02D-488C-4F55-A648-6FFF5CB7A32F"></a><h3 id="BRADV-GUID-45EFE02D-488C-4F55-A648-6FFF5CB7A32F" class="sect3"><span class="enumeration_section">12.6</span>删除数据库</h3>
               <div>
                  <p>要从操作系统中删除数据库，可以在RMAN中使用<code class="codeph">DROP</code> <code class="codeph">DATABASE</code>命令。 RMAN删除服务器参数文件，所有数据文件，联机重做日志和属于目标数据库的控制文件。
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-45EFE02D-488C-4F55-A648-6FFF5CB7A32F__GUID-0CFAA00F-2165-4581-B0F7-38866089E00C">要删除数据库：</p>
                     <p><code class="codeph">DROP</code> <code class="codeph">DATABASE</code>要求将RMAN连接到目标数据库，并且要挂载目标数据库。该命令不需要连接到恢复目录。如果RMAN已连接到恢复目录，并且您指定了<code class="codeph">INCLUDE</code> <code class="codeph">COPIES</code> <code class="codeph">AND</code> <code class="codeph">BACKUPS</code>选项，则RMAN也会注销该数据库。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span><div>
                           <div class="infoboxnotealso" id="GUID-45EFE02D-488C-4F55-A648-6FFF5CB7A32F__GUID-F2AB446A-61BB-44CD-9D17-D3DD98E11CA8">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a></p>
                           </div>
                        </div>
                     </li>
                     <li class="stepexpand"><span>编目与数据库关联的所有备份。例如，以下命令在快速恢复区域中编目目录文件，然后在辅助存档目标中编目：</span><div><pre class="pre codeblock"><code>CATALOG START WITH'+ disk1'; #ASM磁盘上的恢复区域中的所有文件CATALOG START WITH'/ arch_dest2'; ＃来自第二个归档位置的所有文件</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>删除与数据库关联的所有备份和副本。例如：</span><div><pre class="pre codeblock"><code>删除BACKUPSET; ＃删除所有备份DELETE COPY; ＃删除所有映像副本（包括存档日志）</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>从操作系统中删除数据库。</span><div>
                           <p>以下命令将删除数据库并自动从恢复目录中取消注册（如果使用）。RMAN提示确认。</p><pre class="pre codeblock"><code>DROP DATABASE;</code></pre></div>
                     </li>
                  </ol>
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-45EFE02D-488C-4F55-A648-6FFF5CB7A32F__GUID-9EB81D90-5D86-418E-B992-FA537D5BBA49">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="user-managed-recovery-advanced.html#GUID-834054AF-7189-4CD6-93D4-1CD4EB6BF1F1">使用SQL * Plus删除数据库</a>以了解如何使用SQL <code class="codeph">DROP</code> <code class="codeph">DATABASE</code>语句</p>
                           </li>
                           <li>
                              <p>适用于RMAN <code class="codeph">DROP DATABASE</code>命令语法的<a href="../rcmrf/DROP-DATABASE.html#RCMRF190" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>