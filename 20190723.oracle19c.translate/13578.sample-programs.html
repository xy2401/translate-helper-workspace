<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>示例程序</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Supplement to the Oracle Precompilers Guide "></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Supplement to the Oracle Precompilers Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="fortran-supplement-oracle-precompilers.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-11T01:30:46-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1994, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96472-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="error-handling-and-diagnostics.html" title="Previous" type="text/html"></link>
      <link rel="next" href="implementing-dynamic-SQL-method-4.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Pro*FORTRAN Supplement to the Oracle Precompilers"></meta>
    <meta name="dcterms.isVersionOf" content="ZZFOR"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="error-handling-and-diagnostics.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="implementing-dynamic-SQL-method-4.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Oracle预编译器指南的补充</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">示例程序</li>
            </ol>
            <a id="GUID-72CCB4C2-16CC-4FF8-B08B-0292D07D7F4D" name="GUID-72CCB4C2-16CC-4FF8-B08B-0292D07D7F4D"></a>
            
            <h2 id="ZZFOR-GUID-72CCB4C2-16CC-4FF8-B08B-0292D07D7F4D" class="sect2"><span class="enumeration_chapter">3个</span>示例程序</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章提供了几个嵌入式SQL程序来指导您编写自己的程序。这些程序说明了Pro * FORTRAN编程的关键概念和特性，并演示了可以充分利用SQL的强大功能和灵活性的技术。</p>
               <p>本章中的每个示例程序均可在线获取。<a href="sample-programs.html#GUID-72CCB4C2-16CC-4FF8-B08B-0292D07D7F4D__CHDJECCG" title="示例文件的文件名">表3-1</a>显示了示例程序的常用文件名。但是，确切的文件名是系统相关的。有关特定文件名，请参阅Oracle系统特定的文档。
               </p>
               <p>本章包含以下部分：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="sample-programs.html#GUID-D58D382C-5EB7-440B-A24E-8386DD85C266">示例程序1：简单查询</a></p>
                  </li>
                  <li>
                     <p><a href="sample-programs.html#GUID-8D4C1E42-5F48-4CFB-8E95-5B12D5BD77E0">示例程序2：光标操作</a></p>
                  </li>
                  <li>
                     <p><a href="sample-programs.html#GUID-B48B5304-3082-40B2-A1E2-C0C86F55BD14">示例程序3：批量获取</a></p>
                  </li>
                  <li>
                     <p><a href="sample-programs.html#GUID-BC1BDDA1-D790-4FAA-B674-2E7A09C21605">示例程序4：数据类型等效</a></p>
                  </li>
                  <li>
                     <p><a href="sample-programs.html#GUID-822E574E-681D-4085-907E-6567F574E0B3">示例程序5：Oracle Forms用户出口</a></p>
                  </li>
                  <li>
                     <p><a href="sample-programs.html#GUID-9BDB9778-9D4F-4143-BA2A-BBD86E4E9653">示例程序6：动态SQL方法1</a></p>
                  </li>
                  <li>
                     <p><a href="sample-programs.html#GUID-8EC6FCC4-22BF-422A-82FF-90C15525126C">示例程序7：动态SQL方法2</a></p>
                  </li>
                  <li>
                     <p><a href="sample-programs.html#GUID-05317B01-A4DE-4AE6-9E44-522837719BD9">示例程序8：动态SQL方法3</a></p>
                  </li>
                  <li>
                     <p><a href="sample-programs.html#GUID-19825544-BCF1-405A-8A79-91F997571E90">示例程序9：调用存储过程</a></p>
                  </li>
               </ul>
               <div class="tblformalwide" id="GUID-72CCB4C2-16CC-4FF8-B08B-0292D07D7F4D__CHDJECCG">
                  <p class="titleintable">表3-1 Pro * FORTAN示例程序</p>
                  <table cellpadding="4" cellspacing="0" class="FormalWide" title="Pro * FORTAN示例程序" width="100%" border="1" summary="filenames of sample files" frame="hsides" rules="rows">
                     <thead>
                        <tr align="left" valign="top">
                           <th align="left" valign="bottom" width="31%" id="d13927e72">文件名</th>
                           <th align="left" valign="bottom" width="69%" id="d13927e75">演示...</th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="31%" id="d13927e80" headers="d13927e72 ">
                              <p>SAMPLE1。PFO</p>
                           </td>
                           <td align="left" valign="top" width="69%" headers="d13927e80 d13927e75 ">
                              <p>一个简单的查询</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="31%" id="d13927e87" headers="d13927e72 ">
                              <p>SAMPLE2。PFO</p>
                           </td>
                           <td align="left" valign="top" width="69%" headers="d13927e87 d13927e75 ">
                              <p>游标操作</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="31%" id="d13927e94" headers="d13927e72 ">
                              <p>样本3。PFO</p>
                           </td>
                           <td align="left" valign="top" width="69%" headers="d13927e94 d13927e75 ">
                              <p>数组提取</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="31%" id="d13927e101" headers="d13927e72 ">
                              <p>SAMPLE4。PFO</p>
                           </td>
                           <td align="left" valign="top" width="69%" headers="d13927e101 d13927e75 ">
                              <p>数据类型等价</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="31%" id="d13927e108" headers="d13927e72 ">
                              <p>实例5。PFO</p>
                           </td>
                           <td align="left" valign="top" width="69%" headers="d13927e108 d13927e75 ">
                              <p>Oracle Forms用户出口</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="31%" id="d13927e115" headers="d13927e72 ">
                              <p>SAMPLE6。PFO</p>
                           </td>
                           <td align="left" valign="top" width="69%" headers="d13927e115 d13927e75 ">
                              <p>动态SQL方法1</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="31%" id="d13927e122" headers="d13927e72 ">
                              <p>SAMPLE7。PFO</p>
                           </td>
                           <td align="left" valign="top" width="69%" headers="d13927e122 d13927e75 ">
                              <p>动态SQL方法2</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="31%" id="d13927e129" headers="d13927e72 ">
                              <p>样品8。PFO</p>
                           </td>
                           <td align="left" valign="top" width="69%" headers="d13927e129 d13927e75 ">
                              <p>动态SQL方法3</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="31%" id="d13927e136" headers="d13927e72 ">
                              <p>SAMPLE9。PFO</p>
                           </td>
                           <td align="left" valign="top" width="69%" headers="d13927e136 d13927e75 ">
                              <p>调用存储过程</p>
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </div>
               <!-- class="inftblhruleinformal" -->
            </div><a id="ZZFOR236"></a><div class="props_rev_3"><a id="GUID-D58D382C-5EB7-440B-A24E-8386DD85C266" name="GUID-D58D382C-5EB7-440B-A24E-8386DD85C266"></a><h3 id="ZZFOR-GUID-D58D382C-5EB7-440B-A24E-8386DD85C266" class="sect3"><span class="enumeration_section">3.1</span>示例程序1：简单查询</h3>
               <div>
                  <p>该程序连接到Oracle，提示用户输入员工编号，在数据库中查询员工姓名，工资和佣金，然后显示结果。当用户输入零员工编号时，程序结束。</p><pre class="oac_no_warn" dir="ltr">PROGRAM QUERY EXEC SQL BEGIN DECLARE SECTION CHARACTER * 10 UID CHARACTER * 10 PWD INTEGER EMPNO CHARACTER * 10 ENAME REAL SAL REAL COMM INTEGER * 2 ICOMM EXEC SQL END DECLARE SECTION INTEGER TECAL EXEC SQL包含SQLCA EXEC SQL SQLERROR DO CALL SQLERR * LOG ON到ORACLE。 UID ='SCOTT'PWD ='TIGER'EXEC SQL CONNECT：UID识别者：PWD PRINT *，'连接到ORACLE作为用户：'，UID * QUERY LOOP REPEATS直到用户输入A 0 TOTAL = 0 2000 CONTINUE PRINT *， '\ NENTER EMPLOYEE NUMBER（0 TO QUIT）：'READ'（I10）'，EMPNO IF（EMPNO。EQ。 0）CALL SIGNOFF（TOTAL）EXEC SQL WHENEVER NOT FOUND GOTO 7000 EXEC SQL SELECT ENAME，SAL，COMM 1 INTO：ENAME，：SAL，：COMM：ICOMM 2 FROM EMP 3 WHERE EMPNO =：EMPNO PRINT *，'EMPLOYEE SALARY COMMISSION \ N'，+'---------- ------- ----------'如果（ICOMM。EQ。 -1）THEN PRINT'（A10,2X，F7.2，A12）'，ENAME，SAL，'NULL'ELSE PRINT'（A10,2X，F7.2,5X，F7.2）'，ENAME，SAL， COMM END如果TOTAL = TOTAL + 1 GOTO 2000 7000 CONTINUE PRINT *，'不是有效的员工人数 - 再试一次。' GOTO 2000 END SUBROUTINE SIGNOFF（NUMQ）INTEGER NUMQ EXEC SQL包括SQLCA PRINT *，'总数已查询：'，NUMQ PRINT *，'有一个好日子'。 EXEC SQL COMMIT工作版本停止结束子程序SQLERR EXEC SQL包含SQLCA EXEC SQL SQLERROR CONTINUE PRINT *，'ORACLE ERROR DETECTED：'PRINT'（70A1）'，SQLEMC EXEC SQL ROLLBACK WORK RELEASE STOP END</pre></div>
            </div><a id="ZZFOR237"></a><div class="props_rev_3"><a id="GUID-8D4C1E42-5F48-4CFB-8E95-5B12D5BD77E0" name="GUID-8D4C1E42-5F48-4CFB-8E95-5B12D5BD77E0"></a><h3 id="ZZFOR-GUID-8D4C1E42-5F48-4CFB-8E95-5B12D5BD77E0" class="sect3"><span class="enumeration_section">3.2</span>示例程序2：光标操作</h3>
               <div>
                  <p>该程序连接到Oracle，声明并打开游标，获取所有销售人员的姓名，工资和佣金，显示结果，然后关闭游标。</p><pre class="oac_no_warn" dir="ltr">PROGRAM CURSOR EXEC SQL BEGIN DECLARE SECTION CHARACTER * 10 UID CHARACTER * 10 PWD CHARACTER * 10 ENAME REAL SAL REAL COMM EXEC SQL END DECLARE SECTION EXEC SQL包含SQLCA EXEC SQL SQLERROR会调用SQLERR *登录到ORACLE。 UID ='SCOTT'PWD ='TIGER'EXEC SQL CONNECT：UID IDENTIFIED BY：PWD PRINT *，'作为用户连接到ORACLE：'，UID *声明游标。 EXEC SQL DECLARE SALESPEOPLE CURSOR for 1 SELECT ENAME，SAL，COMM 2 FROM EMP 3 WHERE JOB LIKE'SALES％'EXEC SQL OPEN SALESPEOPLE PRINT *，'SALESPERSON SALARY COMMISSION \ N'，+'--------- -  ------- ----------'*循环，找到所有销售人员的统计数据EXEC SQL无法找到，请调用SIGNOFF 3000 EXEC SQL FETCH SALESPEOPLE INTO：ENAME，：SAL，：COMM PRINT '（1X，A10,3X，F7.2,5X，F7.2）'，ENAME，SAL，COMM GOTO 3000 END SUBROUTINE SIGNOFF EXEC SQL包含SQLCA EXEC SQL关闭SALESPEOPLE PRINT *，'有一个好日子'。 EXEC SQL COMMIT工作版本停止结束子程序SQLERR EXEC SQL包含SQLCA EXEC SQL SQLERROR CONTINUE PRINT *，'ORACLE ERROR DETECTED：'PRINT'（70A1）'，SQLEMC EXEC SQL ROLLBACK WORK RELEASE STOP END</pre></div>
            </div><a id="ZZFOR238"></a><div class="props_rev_3"><a id="GUID-B48B5304-3082-40B2-A1E2-C0C86F55BD14" name="GUID-B48B5304-3082-40B2-A1E2-C0C86F55BD14"></a><h3 id="ZZFOR-GUID-B48B5304-3082-40B2-A1E2-C0C86F55BD14" class="sect3"><span class="enumeration_section">3.3</span>示例程序3：批量获取</h3>
               <div>
                  <p>该程序登录到Oracle，声明并打开游标，使用数组批量提取，并使用子例程PRTRES打印结果。</p><pre class="oac_no_warn" dir="ltr">PROGRAM ARRAYS EXEC SQL BEGIN DECLARE SECTION CHARACTER * 10 UID CHARACTER * 10 PWD CHARACTER * 10 ENAME（5）INTEGER EMPNO（5）REAL SAL（5）EXEC SQL END DECLARE SECTION *返回的行数，以及打印INTEGER NUMRET INTEGER的数量NUMP EXEC SQL包含SQLCA EXEC SQL SQLERROR会调用SQLERR *登录到ORACLE。 UID ='SCOTT'PWD ='TIGER'EXEC SQL CONNECT：UID IDENTIFIED BY：PWD PRINT *，'作为用户连接到ORACLE：'，UID *声明游标，然后打开它。 EXEC SQL DECLARE C1 CURSOR用于1个EMPNO，ENAME，SAL 2来自EMP EXEC SQL OPEN C1 NUMRET = 0 * LOOP，FETCHING和PRINTING BATCHES，*直到找不到为真。 EXEC SQL WHENEVER未找到GOTO 3000 2000 EXEC SQL FETCH C1 INTO：EMPNO，：ENAME，：SAL NUMP = SQLERD（3） -  NUMRET CALL PRTRES（NUMP，EMPNO，ENAME，SAL）NUMRET = SQLERD（3）GOTO 2000 * PRINT最终的行，如果有的话。 3000 NUMP = SQLERD（3） -  NUMRET IF（NUMP。GT。 0）CALL PRTRES（NUMP，EMPNO，ENAME，SAL）CALL SIGNOFF END SUBROUTINE PRTRES（NUMP，EMPNO，ENAME，SAL）INTEGER NUMP INTEGER EMPNO（NUMP）CHARACTER * 10 ENAME（NUMP）REAL SAL（NUMP）* PRINT HEADER。打印*，'员工姓名员工姓名薪水\ N'，+'--------------- ------------- ------- '*行打印批次。 DO 7000 I = 1，NUMP PRINT'（1X，I4,13X，A10,5X，F7.2）'，+ EMPNO（I），ENAME（I），SAL（I）7000 CONTINUE RETURN END SUBROUTINE SIGNOFF EXEC SQL INCLUDE SQLCA EXEC SQL关闭C1打印*，“有一个好日子。” EXEC SQL COMMIT工作版本停止结束子程序SQLERR EXEC SQL包含SQLCA EXEC SQL SQLERROR CONTINUE PRINT *，'ORACLE ERROR DETECTED：'PRINT'（70A1）'，SQLEMC EXEC SQL ROLLBACK WORK RELEASE STOP END</pre></div>
            </div><a id="ZZFOR239"></a><div class="props_rev_3"><a id="GUID-BC1BDDA1-D790-4FAA-B674-2E7A09C21605" name="GUID-BC1BDDA1-D790-4FAA-B674-2E7A09C21605"></a><h3 id="ZZFOR-GUID-BC1BDDA1-D790-4FAA-B674-2E7A09C21605" class="sect3"><span class="enumeration_section">3.4</span>示例程序4：数据类型等价</h3>
               <div>
                  <p>连接到Oracle后，该程序在SCOTT帐户中创建一个名为IMAGE的数据库表，然后模拟将员工编号的位图图像插入表中。数据类型等效允许程序使用Oracle外部数据类型LONG RAW来表示图像。之后，当用户输入员工编号时，从IMAGE表中选择编号的“位图”并在终端屏幕上伪显示。</p><pre class="oac_no_warn" dir="ltr">PROGRAM DTYEQV EXEC SQL BEGIN DECLARE SECTION CHARACTER * 10 UID CHARACTER * 10 PWD INTEGER EMPNO CHARACTER * 10 ENAME REAL SAL REAL COMM CHARACTER * 8192 BUFFER EXEC SQL VAR BUFFER是LONG RAW INTEGER SELECTION EXEC SQL END DECLARE SECTION CHARACTER * 10 REP EXEC SQL INCLUDE SQLCA EXEC SQL WHENEVER SQLERROR请调用SQLERR *登录到ORACLE。 UID ='SCOTT'PWD ='TIGER'EXEC SQL CONNECT：UID识别者：PWD PRINT *，'连接到ORACLE作为用户：'，UID打印*，'程序是关于降低图像'，+'表 - 确定[Y / N]？'READ'（A10）'，如果答复（（答复（1：1）。NE。 'Y'）。和。 （回复（1：1）。NE。 'Y'））1 CALL SIGNOFF EXEC SQL SQLERNROR继续执行SQL DROP表图像IF（SQLCDE。EQ。 0）然后打印*，'表格图像已被删除 - '，+'创建新表。' ELSE IF（SQLCDE。EQ。 -942）然后打印*，'表格图像不存在 - '，+'创建新表。' ELSE CALL SQLERR END IF EXEC SQL WHENEVER SQLERROR DO CALL SQLERR EXEC SQL CREATE TABLE IMAGE 1（EMPNO NUMBER（4）NOT NULL，BITMAP LONG RAW）EXEC SQL DECLARE EMPCUR CURSOR for 1 SELECT EMPNO，ENAME from EMP EXEC SQL OPEN EMPCUR PRINT * ，'为所有员工插入图像进入图像......'7000继续执行SQL，无法找到GOTO 10000 EXEC SQL FETCH EMPCUR INTO：EMPNO，：ENAME CALL GETIMG（EMPNO，BUFFER）EXEC SQL插入图像值（：EMPNO，：BUFFER）PRINT *，'EMPLOYEE'，ENAME，' ..........已经完成了！'GOTO 7000 10000 EXEC SQL CLOSE EMPCUR EXEC SQL COMMIT WORK PRINT *，'完成插入BITMAPS。下一个，让我们看看。“ *显示循环开始12000选择= 0打印*，'\ NENTER员工编号（0退出）：'读'（I10）'，选择如果（选择。EQ。 0）CALL SIGNOFF EXEC SQL WHENEVER NOT FOUND GOTO 16000 EXEC SQL SELECT EMP.EMPNO，ENAME，SAL，NVL（COMM，0），BITMAP 1 INTO：EMPNO，：ENAME，：SAL，：COMM，：BUFFER 2来自EMP， IMAGE 3 EMP.EMPNO =：SELECTION 4 AND EMP.EMPNO = IMAGE.EMPNO CALL SHWIMG（BUFFER）PRINT *，'\ NEMPLOYEE'，ENAME，'SAL SAL'，SAL，+'和COMMISSION'，COMM GOTO 12000 16000打印*，'不是有效的员工人数 - 再试一次。' GOTO 12000 END SUBROUTINE GETIMG（ENUM，BUF）INTEGER ENUM CHARACTER * 8192 BUF INTEGER I Do 18000 I = 1,8192 BUF（I：I）='*'18000 CONTINUE END SUBROUTINE SHWIMG（BUF）CHARACTER * 8192 BUF INTEGER I PRINT *，'***************************'DO 22000 I = 1,9 PRINT *，'******** *******************'22000继续结束子程序SIGNOFF执行SQL包括SQLCA打印*，“有一个好日子。” EXEC SQL COMMIT工作版本停止结束子程序SQLERR EXEC SQL包含SQLCA EXEC SQL SQLERROR CONTINUE PRINT *，'ORACLE ERROR DETECTED：'PRINT'（70A1）'，SQLEMC EXEC SQL ROLLBACK WORK RELEASE STOP END</pre></div>
            </div><a id="ZZFOR240"></a><div class="props_rev_3"><a id="GUID-822E574E-681D-4085-907E-6567F574E0B3" name="GUID-822E574E-681D-4085-907E-6567F574E0B3"></a><h3 id="ZZFOR-GUID-822E574E-681D-4085-907E-6567F574E0B3" class="sect3"><span class="enumeration_section">3.5</span>示例程序5：Oracle Forms用户退出</h3>
               <div>
                  <p>此用户出口连接表单字段。要从Oracle Forms触发器调用用户出口，请使用语法</p><pre class="oac_no_warn" dir="ltr">&lt;user_exit&gt;（'CONCAT &lt;field1&gt;，&lt;field2&gt;，...，&lt;result_field&gt;'）;</pre><p>其中<span class="italic">user_exit</span>是随Oracle Forms提供的打包过程，CONCAT是用户出口的名称。示例CONCAT表单调用用户出口。有关Oracle Forms用户出口的更多信息，请参阅<a href="../zzpre/writing-user-exits.html#ZZPRE-GUID-B7C64641-93A1-4F04-8DAA-03187A91300C" target="_blank">编写用户出口</a> 。
                  </p>
                  <p><span class="bold">注意</span> ：列出的示例代码用于Oracle * Forms用户出口，并不打算以与本章中列出的其他示例程序相同的方式进行编译。
                  </p><pre class="oac_no_warn" dir="ltr">INTEGER FUNCTION CONCAT（CMD，CMDL，ERR，ERRL，INQRY）EXEC SQL BEGIN DECLARE SECTION LOGICAL * 1 VALUE（81）LOGICAL * 1 FINAL（241）LOGICAL * 1 FIELD（81）EXEC SQL END DECLARE SECTION EXEC SQL包含SQLCA EXEC SQL WHENEVER SQLERROR转到999 LOGICAL * 1 CMD（80）LOGICAL * 1 ERR（80）INTEGER * 2 CMDL，ERRL，INQRY * CERR是一个动态建立的错误消息返回* SQL *形式。 LOGICAL * 1 CERR（80）*临时变量做弦操作。 INTEGER * 2 CMDCNT INTEGER * 2 FLDCNT INTEGER * 2 FNLCNT * INITIALIZE VARIABLES。 DO 1 I = 1,81 FIELD（I）=''1 VALUE（I）=''DO 2 I = 1,241 2 FINAL（I）=''FNLCNT = 0 *来自命令行的STRIP CONCAT。 CMDCNT = 7 I = 1 * LOOP直到命令行结束。做什么（CMDCNT。LE。 CMDL）* PARMA每个字段由COMMA删除。 FLDCNT = 0 DO WHILE（（CMD（CMDCNT）。NE。 ''）。和。（CMDCNT。LE。 CMDL））FLDCNT = FLDCNT + 1场（FLDCNT）= CMD（CMDCNT）CMDCNT = CMDCNT + 1 END DO IF（CMDCNT。LT。 CMDL）那么*我们有FIELD1 ......字段N。这些是* SQL * FORMS FIELDS的名称;获得价值。 EXEC TOOLS GET：FIELD INTO：VALUE * REINITIALIZIZ FIELD NAME。 DO 20 K = 1，FLDCNT 20 FIELD（K）=''*从字段返回移动值到字符*找到长度。做什么（价值（我）。NE。 ''）FNLCNT = FNLCNT + 1 FINAL（FNLCNT）= VALUE（I）I = I + 1 END DO I = 1 CMDCNT = CMDCNT + 1 ELSE *我们有RESULT_FIELD;存储在SQL * FORMS FIELD中。 EXEC TOOLS SET：FIELD VALUES（：FINAL）END IF END DO * ALL OK。返回成功代码。 CONCAT = IAPSUC返回*发生错误。用户退出ORACLE的前缀名称*错误消息，设置故障返回代码和退出。 999 CERR（1）='C'CERR（2）='O'CERR（3）='N'CERR（4）='C'CERR（5）='A'CERR（6）='T'CERR （7）='：'CERR（8）=''DO 1000 J = 1,70 CERR（J + 8）= SQLEMC（J）1000 CONTINUE ERRL = 78 CALL TOOLS MESSAGE（CERR，ERRL）CONCAT = IAPFAI RETURN END</pre></div>
            </div><a id="ZZFOR241"></a><div class="props_rev_3"><a id="GUID-9BDB9778-9D4F-4143-BA2A-BBD86E4E9653" name="GUID-9BDB9778-9D4F-4143-BA2A-BBD86E4E9653"></a><h3 id="ZZFOR-GUID-9BDB9778-9D4F-4143-BA2A-BBD86E4E9653" class="sect3"><span class="enumeration_section">3.6</span>示例程序6：动态SQL方法1</h3>
               <div>
                  <p>此程序使用动态SQL方法1创建表，插入行，提交插入，然后删除表。</p><pre class="oac_no_warn" dir="ltr">PROGRAM DYN1 EXEC SQL包含SQLCA EXEC SQL包含ORACA EXEC ORACLE选项（ORACA = YES）EXEC ORACLE选项（RELEASE_CURSOR = YES）EXEC SQL BEGIN DECLARE SECTION CHARACTER * 10 USERNAME CHARACTER * 10 PASSWORD CHARACTER * 80 DYNSTM EXEC SQL END DECLARE SECTION EXEC SQL WHEREVER SQLERROR GOTO 9000 ORATXF = 1 USERNAME ='SCOTT'PASSWORD ='TIGER'EXEC SQL CONNECT：USERNAME IDENTIFIED BY：PASSWORD PRINT *，'CONNECTED TO ORACLE'。 PRINT *，'CREATE TABLE DYN1（COL1 CHAR（4））'EXEC SQL EXECUTE IMMEDIATE 1'CREATE TABLE DYN1（COL1 CHAR（4））'DYNSTM ='插入DYN1值（''TEST''）'打印*， DYNSTM EXEC SQL EXECUTE IMMEDIATE：DYNSTM EXEC SQL COMMIT WORK DYNSTM ='DROP TABLE DYN1'PRINT *，DYNSTM EXEC SQL EXECUTE IMMEDIATE：DYNSTM EXEC SQL COMMIT RELEASE PRINT *，'有一个好日子！'GOTO 9999 9000 PRINT *，'\ N-- ORACLE ERROR：'PRINT'（70A）'，SQLEMC PRINT'（3A，70A）'，'IN'，ORATXC PRINT *，'在线'，ORASLN PRINT'（ 3A，70A）'，'OF'，ORAFNC EXEC SQL WHENEVER SQLERROR CONTINUE EXEC SQL ROLLBACK RELEASE 9999 CONTINUE END</pre></div>
            </div><a id="ZZFOR242"></a><div class="props_rev_3"><a id="GUID-8EC6FCC4-22BF-422A-82FF-90C15525126C" name="GUID-8EC6FCC4-22BF-422A-82FF-90C15525126C"></a><h3 id="ZZFOR-GUID-8EC6FCC4-22BF-422A-82FF-90C15525126C" class="sect3"><span class="enumeration_section">3.7</span>示例程序7：动态SQL方法2</h3>
               <div>
                  <p>此程序使用动态SQL方法2将两行插入EMP表，然后删除它们。</p><pre class="oac_no_warn" dir="ltr">PROGRAM DYN2 EXEC SQL包含SQLCA EXEC SQL BEGIN DECLARE SECTION CHARACTER * 10 USERNAME CHARACTER * 10 DUTHSTORD CHAREG * 80 EYNNO INTEGER * 2 EMPNO INTEGER * 2 DEPTNO1 INTEGER * 2 DEPTNO2 EXEC SQL END DECLARE SECTION EXEC SQL WHENEVER SQLERROR GOTO 9000 USERNAME ='SCOTT 'PASSWORD ='TIGER'EXEC SQL CONNECT：USERNAME IDENTIFIED BY：PASSWORD PRINT *，'连接到ORACLE'。 DYNSTM ='插入EMP（EMPNO，DEPTNO）值（：V1，：V2）'打印*，DYNSTM EMPNO = 1234 DEPTNO1 = 97打印*，'V1 ='，EMPNO PRINT *，'V2 ='，DEPTNO1 EXEC SQL PREPARE S FROM：DYNSTM EXEC SQL EXECUTE S使用：EMPNO，：DEPTNO1 PRINT *，'INSERT STATEMENT EXECUTED。\ N'EMPNO = EMPNO + 1 DEPTNO2 = 99 PRINT *，'更改的绑定变量V1和V2 \ NV1 ='，EMPNO PRINT *，'V2 ='，DEPTNO2 PRINT *，'再次声明新的'BIND'，+'VARIABLES'。 EXEC SQL EXECUTE S使用：EMPNO，：DEPTNO2 PRINT *，'DONE，NOW DELETING ...\ N'DYNSTM = +'从EMP删除DEPTNO =：V1或DEPTNO =：V2'PRINT *，DYNSTM PRINT *，'V1 ='，DEPTNO1 PRINT *，'V2 ='，DEPTNO2 EXEC SQL PREPARE S FROM：DYNSTM EXEC SQL EXECUTE S使用：DEPTNO1，：DEPTNO2 EXEC SQL COMMIT RELEASE PRINT *，'有一个好日子！'GOTO 9999 9000 PRINT'（70A1）'，SQLEMC EXEC SQL WHENEVER SQLERROR CONTINUE EXEC SQL ROLLBACK RELEASE 9999 CONTINUE END</pre></div>
            </div><a id="ZZFOR243"></a><div class="props_rev_3"><a id="GUID-05317B01-A4DE-4AE6-9E44-522837719BD9" name="GUID-05317B01-A4DE-4AE6-9E44-522837719BD9"></a><h3 id="ZZFOR-GUID-05317B01-A4DE-4AE6-9E44-522837719BD9" class="sect3"><span class="enumeration_section">3.8</span>示例程序8：动态SQL方法3</h3>
               <div>
                  <p>此程序使用动态SQL方法3从EMP表中检索给定部门中所有员工的名称。</p><pre class="oac_no_warn" dir="ltr">PROGRAM DYN3 EXEC SQL包含SQLCA EXEC SQL BEGIN DECLARE SECTION CHARACTER * 10 USERNAME CHARACTER * 10 PASSWORD CHARACTER * 80 DYNSTM CHARACTER * 10 ENAME INTEGER * 2 DEPTNO EXEC SQL END DECLARE SECTION EXEC SQL WHENEVER SQLERROR GOTO 9000 USERNAME ='SCOTT'PASSWORD =' TIGER'EXEC SQL CONNECT：USERNAME IDENTIFIED BY：PASSWORD PRINT *，'连接到ORACLE。\ N'DYNSTM ='从EMP中选择ENAME，其中DEPTNO =：V1'PRINT *，DYNSTM DEPTNO = 10 PRINT *，'V1 ='， DEPTNO EXEC SQL PREPARE S FROM：DYNSTM EXEC SQL DECLARE C CURSOR for S EXEC SQL OPEN C使用：DEPTNO EXEC SQL WHENEVER NOT FOUND GOTO 110 PRINT *，'\ NEMPLOYEE NAME \ N ------------ - '100 EXEC SQL FETCH C INTO：ENAME PRINT *，ENAME GOTO 100 110 PRINT *，'\ NQUERY RETURNED'，SQLERD（3），'ROWS。' EXEC SQL CLOSE C EXEC SQL COMMIT RELEASE PRINT *，'\ NHAVE A good DAY。' GOTO 9999 9000 PRINT'（70A1）'，SQLEMC EXEC SQL WHENEVER SQLERROR CONTINUE EXEC SQL CLOSE C EXEC SQL ROLLBACK RELEASE 9999 CONTINUE END</pre></div>
            </div><a id="ZZFOR244"></a><div class="props_rev_3"><a id="GUID-19825544-BCF1-405A-8A79-91F997571E90" name="GUID-19825544-BCF1-405A-8A79-91F997571E90"></a><h3 id="ZZFOR-GUID-19825544-BCF1-405A-8A79-91F997571E90" class="sect3"><span class="enumeration_section">3.9</span>示例程序9：调用存储过程</h3>
               <div>
                  <p>在尝试示例程序之前，必须通过运行名为CALLDEMO.SQL的脚本来创建名为<span class="italic">calldemo</span>的PL / SQL包，该脚本随Pro * FORTRAN提供，并在以下示例中显示。该脚本可以在Pro * FORTRAN演示库中找到。检查Oracle系统特定的文档，以获取脚本的准确拼写。
                  </p><pre class="oac_no_warn" dir="ltr">创建或替换包装calldemo AS TYPE name_array IS表格emp.ename％type INDEX BY BINARY_INTEGER; TYPE job_array IS TABLE of emp.job％type INDEX BY BINARY_INTEGER; TYPE sal_array IS TABLE of emp.sal％type INDEX BY BINARY_INTEGER;程序get_employees（dept_number IN号， - 部门查询batch_size IN INTEGER， - 行一次找到IN OUT INTEGER， - 行实际返回done_fetch OUT INTEGER， - 所有已完成标志emp_name OUT name_array，job OUT job_array，sal OUT sal_array）; END calldemo; / CREATE OR REPLACE PACKAGE BODY calldemo AS CURSOR get_emp（dept_number IN number）IS SELECT ename，job，sal FROM emp WHERE deptno = dept_number; - 过程“get_employees”获取一批雇员 - 行（批处理大小由过程的客户端/调用者确定）。它可以从其他存储过程或客户端应用程序中调用。- 如果光标不是 - 已打开，则会打开光标，提取一批行，然后 - 返回实际检索的行数。在获取结束时，该过程将关闭游标。程序get_employees（dept_number IN号，batch_size IN INTEGER，找到IN OUT INTEGER，done_fetch OUT INTEGER，emp_name OUT name_array，job OUT job_array，sal OUT sal_array）IS BEGIN如果不是get_emp％ISOPEN那么 - 如果OPEN get_emp（dept_number）打开游标）; - 尚未开放END IF; - 将“batch_size”行提取到PL / SQL表中 - 计算检索到的行。当所有行都被提取时，关闭光标并退出 - 循环，只返回找到的最后一组行。done_fetch：= 0; - 设置完成标志FALSE：= 0; FOR i IN 1..batch_size LOOP FETCH get_emp INTO emp_name（i），job（i），sal（i）;如果get_emp％NOTFOUND那么 - 如果没有找到行CLOSE get_emp; done_fetch：= 1; - 表示所有已完成退出; ELSE发现：=找到+ 1; - 计数行END IF;结束循环;结束;结束; /</pre><p>以下示例程序连接到Oracle，提示用户输入部门号，然后调用名为<span class="italic">get_employees</span>的PL / SQL过程，该过程存储在包<span class="italic">calldemo中</span> 。该过程将三个PL / SQL表声明为OUT形式参数，然后将一批员工数据提取到PL / SQL表中。匹配的实际参数是主机表。该过程完成后，PL / SQL表中的行值将自动分配给主机表中的相应元素。程序重复调用该过程，显示每批员工数据，直到找不到更多数据。
                  </p><pre class="oac_no_warn" dir="ltr">PROGRAM CALLSP EXEC SQL BEGIN DECLARE SECTION CHARACTER * 10 UID CHARACTER * 10 PWD INTEGER DEPTNO CHARACTER * 10 ENAME（10）CHARACTER * 10 JOB（10）REAL SAL（10）INTEGER ENDFLG INTEGER ARYSIZ INTEGER NUMRET INTEGER * 4 SQLCOD EXEC SQL END DECLARE部分EXEC SQL包含SQLCA EXEC SQL SQLERROR请调用SQLERR UID ='SCOTT'PWD ='TIGER'EXEC SQL CONNECT：UID识别者：PWD PRINT *，'连接到ORACLE as USER'，UID PRINT *，'输入部门号码：'READ'（I10）'，DEPTNO * INITIALIZE VARIABLES AND ARRAYS。 ENDFLG = 0 ARYSIZ = 10 NUMRET = 0 DO 4000 I = 1，ARYSIZ ENAME（I）=''JOB（I）=''SAL（I）= 0 4000 CONTINUE * DISPLAY HEADER。 PRINT *，'员工姓名职业标题SALARY \ N'，+'------------- --------- ------'*循环，取样和印刷批量直到结束标志已设置。 6000 EXEC SQL EXECUTE 1 BEGIN 2 CALLDEMO.GET_EMPLOYEES（：DEPTNO，：ARYSIZ，3：NUMRET，：ENDFLG，：ENAME，：JOB，：SAL）; 4结束; 5 END-EXEC CALL PBATCH（NUMRET，ENAME，JOB，SAL）IF（ENDFLG。EQ。 0）GOTO 6000 CALL SIGNOFF END *********************** SUBROUTINES ******************* ** *显示一批行。 SUBROUTINE PBATCH（ROWS，ENAME，JOB，SAL）INTEGER ROWS CHARACTER * 10 ENAME（ROWS）CHARACTER * 10 JOB（ROWS）REAL SAL（ROWS）DO 8000 I = 1，ROWS PRINT'（1X，A10,5X，A10， 1X，F7.2）'，ENAME（I），JOB（I），SAL（I）8000 CONTINUE RETURN END * LOG OFF ORACLE。 SUBROUTINE SIGNOFF EXEC SQL包括SQLCA PRINT *，'有一个好日子'。 EXEC SQL COMMIT WORK RELEASE STOP END *处理SQL错误。 SUBROUTINE SQLERR EXEC SQL包含SQLCA EXEC SQL SQLERROR CONTINUE PRINT *，'ORACLE ERROR DETECTED：'PRINT'（70A1）'，SQLEMC EXEC SQL ROLLBACK WORK RELEASE STOP END</pre></div>
            </div>
         </div>
      </article>
   </body>
</html>