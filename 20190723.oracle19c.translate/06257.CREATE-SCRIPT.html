<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>创建脚本</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery Reference"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery Reference"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-reference.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T19:31:58-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96242-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="CREATE-CATALOG.html" title="Previous" type="text/html"></link>
      <link rel="next" href="CROSSCHECK.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery Reference"></meta>
    <meta name="dcterms.isVersionOf" content="RCMRF"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="CREATE-CATALOG.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="CROSSCHECK.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复参考</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="rman-commands-at-sign-to-quit.html" property="item" typeof="WebPage"><span property="name">RMAN命令：@（at符号）到QUIT</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">创建脚本</li>
            </ol>
            <a id="GUID-4741C1E1-C365-4597-BF2F-8679145B4946" name="GUID-4741C1E1-C365-4597-BF2F-8679145B4946"></a><a id="RCMRF90121"></a><a id="RCMRF90122"></a><a id="RCMRF90123"></a><a id="RCMRF90124"></a><a id="RCMRF90125"></a><a id="RCMRF118"></a>
            
            <h2 id="RCMRF-GUID-4741C1E1-C365-4597-BF2F-8679145B4946" class="sect2"><span class="enumeration_section">2.13</span>创建脚本</h2>
         </header>
         <div class="ind">
            <div>
               <div class="section">
                  <p class="subhead1" id="GUID-4741C1E1-C365-4597-BF2F-8679145B4946__GUID-7E1CE28F-2DF4-4FDE-8EFF-B0DC8B87617D">目的</p>
                  <p>使用<code class="codeph">CREATE SCRIPT</code>命令在恢复目录中创建存储的脚本。存储的脚本是一系列RMAN命令，它们被赋予一个名称并存储在恢复目录中以供以后执行。
                  </p>
                  <div class="infoboxnotealso" id="GUID-4741C1E1-C365-4597-BF2F-8679145B4946__GUID-F80C9D71-C597-4462-AB68-C3CAC7B4A7A0">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="../bradv/managing-recovery-catalog.html#BRADV182" target="_blank"><span class="italic">Oracle数据库备份和恢复用户指南</span></a> ，了解如何使用存储的脚本</p>
                        </li>
                        <li>
                           <p><code class="codeph"><a href="REPLACE-SCRIPT.html#GUID-2C86EDA9-63BE-4F21-9138-AF75597D5ADF">REPLACE SCRIPT</a></code>以了解如何更新存储的脚本</p>
                        </li>
                     </ul>
                  </div>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-4741C1E1-C365-4597-BF2F-8679145B4946__GUID-7D5AD48C-516A-4901-96DA-0A2620644B47">先决条件</p>
                  <p>仅在RMAN提示符下执行<code class="codeph">CREATE SCRIPT</code> 。RMAN必须连接到目标数据库和恢复目录。必须打开恢复目录数据库。
                  </p>
                  <p>如果指定了<code class="codeph">GLOBAL</code> ，则恢复目录中不得存在具有此名称的全局脚本。如果未指定<code class="codeph">GLOBAL</code> ，则必须不存在具有相同目标数据库相同名称的本地脚本。如果您不满足这些先决条件，则RMAN将返回错误<code class="codeph">RMAN-20401</code> 。
                  </p>
               </div>
               <!-- class="section" -->
               <div class="section" id="GUID-4741C1E1-C365-4597-BF2F-8679145B4946__CHDBJHHH">
                  <p class="subhead1" id="GUID-4741C1E1-C365-4597-BF2F-8679145B4946__GUID-EE2EC5C3-6726-45C6-9C03-380844A028E3">使用说明</p>
                  <p><a id="d39531e143" class="indexterm-anchor"></a>存储的脚本可以是本地脚本或全局脚本。仅为当前目标数据库创建本地脚本，而全局脚本可用于在恢复目录中注册的任何数据库。
                  </p>
                  <p>允许创建与本地脚本同名的全局脚本，或者与全局脚本同名的本地脚本。</p>
                  <p><span class="bold">存储脚本中的替换变量</span></p>
                  <p><a id="d39531e152" class="indexterm-anchor"></a><a id="d39531e156" class="indexterm-anchor"></a><a id="d39531e160" class="indexterm-anchor"></a><a id="d39531e162" class="indexterm-anchor"></a> RMAN支持在存储的脚本中使用替换变量。 <code class="codeph">&amp;1</code>表示放置第一个值的位置， <code class="codeph">&amp;2</code>表示放置第二个值的位置，依此类推。必须引用特殊字符。
                  </p>
                  <p>替换变量语法是<code class="codeph">&amp;</code> <span class="italic"><code class="codeph">integer</code></span>后跟可选的句点，例如<code class="codeph">&amp;1.3</code> 。可选句点是变量的一部分，并替换为值，从而使替换文本后面紧跟另一个整数。例如，如果将值<code class="codeph">mybackup</code>传递给包含替换变量<code class="codeph">&amp;1.3</code>的命令文件，则替换的结果为<code class="codeph">mybackup3</code> 。要创建结果<code class="codeph">mybackup.3</code> ，请在语法<code class="codeph">&amp;1..3</code>使用两个句点。
                  </p>
                  <p>使用替换变量创建存储脚本时，必须在创建时提供示例值。您可以在启动RMAN时<code class="codeph">USING</code>子句提供这些值（请参阅<code class="codeph"><a href="RMAN.html#GUID-E5514ACB-59F6-4DB0-B4DB-64DF4C87CDE7">RMAN</a></code> ），或在提示时输入它们（请参阅<a href="CREATE-SCRIPT.html#GUID-4741C1E1-C365-4597-BF2F-8679145B4946__CHDBBABA">示例2-74</a> ）。
                  </p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-4741C1E1-C365-4597-BF2F-8679145B4946__GUID-CAB25E5E-6891-499B-9438-0F75A80D0F26">句法</p>
                  <p><span class="bold"><span class="italic">createScript</span> :: =</span></p>
                  <div class="figure" id="GUID-4741C1E1-C365-4597-BF2F-8679145B4946__GUID-137B88F2-81A6-44B3-9469-FE7B9B2E60BF"><img src="img/createscript.gif" alt="下面是createscript.eps的描述" title="下面是createscript.eps的描述" longdesc="img_text/createscript.html"><br><a href="img_text/createscript.html">说明createscript.eps的说明</a></div>
                  <!-- class="figure" -->
                  <p><span class="italic"><a href="RUN.html#GUID-88250EEF-DC49-42A9-822C-4011B1345C7B__CHDIDAJB">backupCommands :: =</a></span> ， <span class="italic"><a href="RUN.html#GUID-88250EEF-DC49-42A9-822C-4011B1345C7B__CHDHAGID">maintenanceCommands :: =</a></span> ， <span class="italic"><a href="RUN.html#GUID-88250EEF-DC49-42A9-822C-4011B1345C7B__CHDJFJFH">miscellaneousCommands :: =</a></span> ， <span class="italic"><a href="RUN.html#GUID-88250EEF-DC49-42A9-822C-4011B1345C7B__CHDIFJGG">restoreCommands :: =</a></span> ）</p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-4741C1E1-C365-4597-BF2F-8679145B4946__GUID-DDE27E84-17F0-4873-A999-E2626088BDA6">语义</p>
                  <div class="tblformalwide" id="GUID-4741C1E1-C365-4597-BF2F-8679145B4946__GUID-C30BB26E-F2E4-4A51-BBB8-39ACF3435EB0">
                     <table cellpadding="4" cellspacing="0" class="FormalWide" title="" width="100%" border="1" summary="Describes CREATE SCRIPT command parameters" frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="29%" id="d39531e249">语法元素</th>
                              <th align="left" valign="bottom" width="71%" id="d39531e252">描述</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d39531e257" headers="d39531e249 ">
                                 <p><code class="codeph">创建或替换</code></p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d39531e257 d39531e252 ">
                                 <p></p>
                                 <p>如果不存在具有指定名称的脚本，则创建新脚本。如果已存在具有指定名称的脚本，则会重新创建该脚本。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d39531e266" headers="d39531e249 ">
                                 <p><code class="codeph">全球</code></p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d39531e266 d39531e252 ">
                                 <p>将脚本标识为全局。</p>
                                 <p><span class="bold">注意：</span>虚拟专用目录具有对全局脚本的只读访问权限。必须在连接到基本恢复目录时创建或更新全局脚本。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d39531e278" headers="d39531e249 ">
                                 <p><code class="codeph">SCRIPT</code> <span class="italic"><code class="codeph">script_name</code></span></p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d39531e278 d39531e252 ">
                                 <p>指定脚本的名称。当名称包含空格或保留字时，必须在脚本名称周围使用引号。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d39531e289" headers="d39531e249 ">
                                 <p><code class="codeph">COMMENT</code> <code class="codeph">'</code> <span class="italic"><code class="codeph">comment</code></span> <code class="codeph">'</code></p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d39531e289 d39531e252 ">
                                 <p>将解释性注释与恢复目录中存储的脚本相关联。注释用于<code class="codeph"><a href="LIST.html#GUID-2BAB704C-A3C9-4F76-8D96-4BD961FBEF2E">LIST</a></code> <code class="codeph">SCRIPT NAMES</code>的输出。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d39531e312" headers="d39531e249 ">
                                 <p><span class="italic"><code class="codeph">backupCommands</code></span></p>
                                 <p><span class="italic"><code class="codeph">maintenanceCommands</code></span></p>
                                 <p><span class="italic"><code class="codeph">miscellaneousCommands</code></span></p>
                                 <p><span class="italic"><code class="codeph">restoreCommands</code></span></p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d39531e312 d39531e252 ">
                                 <p>指定要包含在存储脚本中的命令。的命令的括号内是允许<code class="codeph">CREATE SCRIPT</code> <code class="codeph">'</code> <span class="italic"><code class="codeph">script_name</code></span> <code class="codeph">'</code> <code class="codeph">{</code> <code class="codeph">...</code> <code class="codeph">}</code>命令的一个内所支持的相同的命令<code class="codeph"><a href="RUN.html#GUID-88250EEF-DC49-42A9-822C-4011B1345C7B">RUN</a></code>命令。在存储的脚本中允许在<code class="codeph">RUN</code>命令中有效的任何命令。以下命令在存储的脚本中无效： <code class="codeph"><a href="RUN.html#GUID-88250EEF-DC49-42A9-822C-4011B1345C7B">RUN</a></code> ， <code class="codeph"><a href="at-sign.html#GUID-7A3919FE-140B-4F50-BA2F-3CEE3285E771">@ (at sign)</a></code>和<code class="codeph"><a href="double-at-sign.html#GUID-E2B8B99B-73CB-4D4E-8065-0B9F44AF8A52">@@ (double at sign)</a></code> 。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d39531e375" headers="d39531e249 ">
                                 <p><code class="codeph">FROM FILE '</code> <span class="italic"><code class="codeph">filename</code></span> <code class="codeph">'</code></p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d39531e375 d39531e252 ">
                                 <p>读取命令序列以从指定文件定义脚本。</p>
                                 <p>该文件看起来像有效存储脚本的主体。文件的第一行必须是左大括号（ <code class="codeph">{</code> ），最后一行必须包含右大括号（ <code class="codeph">}</code> ）。文件中的RMAN命令必须在存储的脚本中有效。
                                 </p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-4741C1E1-C365-4597-BF2F-8679145B4946__GUID-2273A389-3036-417F-9BE6-3B323619421A">例子</p>
               </div>
               <!-- class="section" -->
               <div class="example" id="GUID-4741C1E1-C365-4597-BF2F-8679145B4946__GUID-7478E03D-5943-4397-B276-6E03DE9F586B">
                  <p class="titleinexample">示例2-72创建本地存储脚本</p>
                  <p>假设您要创建用于备份数据库<code class="codeph">prod</code>的本地存储脚本。您启动RMAN，连接到<code class="codeph">TARGET</code> <code class="codeph">prod</code> ，并连接到恢复目录。您创建一个名为<code class="codeph">backup_whole</code>的存储脚本，然后使用<code class="codeph"><a href="EXECUTE-SCRIPT.html#GUID-553B5C55-0BA6-4B47-86A9-0BCF839CCE04">EXECUTE SCRIPT</a></code>运行它，如下所示：</p><pre class="oac_no_warn" dir="ltr">CREATE SCRIPT backup_whole COMMENT“备份整个数据库和归档重做日志文件”{BACKUP INCREMENTAL LEVEL 0 TAG backup_whole FORMAT“/ disk2 / backup /％U”DATABASE PLUS ARCHIVELOG; }运行{EXECUTE SCRIPT backup_whole; }</pre></div>
               <!-- class="example" -->
               <div class="example" id="GUID-4741C1E1-C365-4597-BF2F-8679145B4946__CHDFABFG">
                  <p class="titleinexample">示例2-73创建全局存储脚本</p>
                  <p>此示例将RMAN连接到目标数据库<code class="codeph">prod</code>和恢复目录数据库<code class="codeph">catdb</code>作为目录用户<code class="codeph">rco</code> 。该示例创建一个名为<code class="codeph">global_backup_db</code>的全局脚本，用于备份数据库和归档的重做日志文件：</p><pre class="oac_no_warn" dir="ltr">RMAN&gt; CONNECT TARGET“sbu @ prod AS SYSBACKUP”目标数据库密码：连接到目标数据库的<span class="italic">密码</span> ：PROD（DBID = 39525561）RMAN&gt; CONNECT CATALOG rco @ catdb恢复目录数据库密码：连接到恢复目录数据库的<span class="italic">密码</span> RMAN&gt; CREATE GLOBAL SCRIPT global_backup_db {BACKUP DATABASE PLUS ARCHIVELOG; } RMAN&gt;退出;</pre><p>您现在可以将RMAN连接到不同的目标数据库（例如<code class="codeph">prod2</code>并运行全局存储的脚本：</p><pre class="oac_no_warn" dir="ltr">RMAN&gt; CONNECT TARGET“sbu @ prod2 AS SYSBACKUP”目标数据库密码：连接到目标数据库的<span class="italic">密码</span> ：PROD2（DBID = 36508508）RMAN&gt; CONNECT CATALOG rco @ catdb恢复目录数据库密码：连接到恢复目录数据库的<span class="italic">密码</span> RMAN&gt; RUN {EXECUTE SCRIPT global_backup_db; }</pre></div>
               <!-- class="example" -->
               <div class="example" id="GUID-4741C1E1-C365-4597-BF2F-8679145B4946__CHDBBABA">
                  <p class="titleinexample">示例2-74创建使用替换变量的存储脚本</p>
                  <p>以下示例将RMAN连接到目标数据库和恢复目录，并使用<code class="codeph"><a href="CREATE-SCRIPT.html#GUID-4741C1E1-C365-4597-BF2F-8679145B4946">CREATE SCRIPT</a></code>创建包含三个替换变量的备份脚本。RMAN会提示您输入变量的初始值（用户输入以粗体显示）。
                  </p><pre class="oac_no_warn" dir="ltr">RMAN&gt; CONNECT TARGET / RMAN&gt; CONNECT CATALOG rco @ catdb恢复目录数据库密码：连接到恢复目录数据库的<span class="italic">密码</span> RMAN&gt; CREATE SCRIPT backup_df 2&gt; {BACKUP DATAFILE＆1 TAG＆2.1 FORMAT'/ disk1 /＆3_％U';输入1： <span class="bold">1的</span>值输入2的值： <span class="bold">df1_backup</span>输入3的值： <span class="bold">df1</span>启动恢复目录的完全重新同步完全重新同步完成创建的脚本backup_df</pre><p>运行<code class="codeph"><a href="EXECUTE-SCRIPT.html#GUID-553B5C55-0BA6-4B47-86A9-0BCF839CCE04">EXECUTE SCRIPT</a></code> ，可以将不同的值传递给脚本。以下示例将值<code class="codeph">3</code> ， <code class="codeph">test_backup</code>和<code class="codeph">test</code>传递给存储脚本中的替换变量：</p><pre class="oac_no_warn" dir="ltr">RMAN&gt; RUN {EXECUTE SCRIPT backup_df使用3 test_backup df3; }</pre><p>替换值后，脚本执行如下：</p><pre class="oac_no_warn" dir="ltr">备份数据文件3标签test_backup1格式'/ disk1 / df3_％U';</pre></div>
               <!-- class="example" -->
            </div>
         </div>
      </article>
   </body>
</html>