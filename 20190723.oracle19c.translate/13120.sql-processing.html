<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="This chapter explains how database processes DDL statements to create objects, DML to modify data, and queries to retrieve data."></meta>
      <meta name="description" content="This chapter explains how database processes DDL statements to create objects, DML to modify data, and queries to retrieve data."></meta>
      <title>SQL处理</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="SQL Tuning Guide"></meta>
      <meta property="og:description" content="This chapter explains how database processes DDL statements to create objects, DML to modify data, and queries to retrieve data."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="SQL Tuning Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="sql-tuning-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-31T14:57:08-08:00"></meta>
      <meta name="dcterms.title" content="SQL Tuning Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="2013, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96095-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="query-optimizer-fundamentals.html" title="Previous" type="text/html"></link>
      <link rel="next" href="query-optimizer-concepts.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGSQL"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="query-optimizer-fundamentals.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="query-optimizer-concepts.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL调优指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="query-optimizer-fundamentals.html" property="item" typeof="WebPage"><span property="name">查询优化工具基础知识</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">SQL处理</li>
            </ol>
            <a id="GUID-B3415175-41F2-4EBB-95CF-5F8B5C39E927" name="GUID-B3415175-41F2-4EBB-95CF-5F8B5C39E927"></a>
            
            <h2 id="TGSQL-GUID-B3415175-41F2-4EBB-95CF-5F8B5C39E927" class="sect2"><span class="enumeration_chapter">3</span> SQL处理</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍数据库如何处理DDL语句以创建对象，DML如何修改数据以及查询以检索数据。</p>
               <p>本章包含以下主题：</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="sql-processing.html#GUID-873A7B2C-CD17-428A-8AE2-5B08906E45FB">关于SQL处理</a><br><strong class="term">SQL处理</strong>是SQL语句的解析，优化，行源生成和执行。
                  </li>
                  <li class="ulchildlink"><a href="sql-processing.html#GUID-BEB00996-3614-45F4-991B-2585E08D8C97">Oracle数据库如何处理DML</a><br>大多数DML语句都有一个查询组件。在查询中，执行游标会将查询结果放入一组称为<strong class="term">结果集</strong>的行中。
                  </li>
                  <li class="ulchildlink"><a href="sql-processing.html#GUID-C7B96C36-3AE9-4120-A511-C4B2992275DD">Oracle数据库如何处理DDL</a><br>Oracle数据库以不同于DML的方式处理DDL。</li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="query-optimizer-fundamentals.html#GUID-EF45F82A-F17D-4C79-9B6A-8CBBB95F0684" title="要调优Oracle SQL，您必须了解查询优化器。优化器是内置软件，用于确定语句访问数据的最有效方法。">查询优化器基础知识</a></p>
                  </div>
               </div>
            </div>
            <a id="TGSQL177"></a><a id="TGSQL175"></a><a id="TGSQL176"></a><div class="props_rev_3"><a id="GUID-873A7B2C-CD17-428A-8AE2-5B08906E45FB" name="GUID-873A7B2C-CD17-428A-8AE2-5B08906E45FB"></a><h3 id="TGSQL-GUID-873A7B2C-CD17-428A-8AE2-5B08906E45FB" class="sect3"><span class="enumeration_section">3.1</span>关于SQL处理</h3>
               <div>
                  <p><strong class="term">SQL处理</strong>是SQL语句的解析，优化，行源生成和执行。
                  </p>
                  <p>下图描绘了SQL处理的一般阶段。根据声明，数据库可能会省略其中一些阶段。</p>
                  <div class="figure" id="GUID-873A7B2C-CD17-428A-8AE2-5B08906E45FB__BABHAJJE">
                     <p class="titleinfigure">图3-1 SQL处理的阶段</p><img src="img/cncpt250.gif" alt="下面是图3-1的描述" title="下面是图3-1的描述" longdesc="img_text/cncpt250.html"><br><a href="img_text/cncpt250.html">“图3-1 SQL处理阶段”的描述</a></div>
                  <!-- class="figure" -->
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="sql-processing.html#GUID-8CF633B1-EAC4-47C7-9189-C479ADEF1FFA">SQL解析</a><br>SQL处理的第一个阶段是<strong class="term">解析</strong> 。
                     </li>
                     <li class="ulchildlink"><a href="sql-processing.html#GUID-0196D949-6B0F-4DB0-BCCF-768F16B0964C">SQL优化</a><br>在优化期间，Oracle数据库必须至少对每个唯一的DML语句执行一次硬解析，并在此解析期间执行优化。
                     </li>
                     <li class="ulchildlink"><a href="sql-processing.html#GUID-E052E274-586D-4D76-960F-B831140F7B94">SQL行源生成</a><br><strong class="term">行源生成器</strong>是从优化器接收最佳执行计划并生成可由数据库的其余部分使用的迭代执行计划的软件。
                     </li>
                     <li class="ulchildlink"><a href="sql-processing.html#GUID-CC83C349-364F-4AB4-8113-0FD6753EF3FB">SQL执行</a><br>在执行期间，SQL引擎执行行源生成器生成的树中的每个行源。此步骤是DML处理中唯一必需的步骤。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="sql-processing.html#GUID-B3415175-41F2-4EBB-95CF-5F8B5C39E927" title="本章介绍数据库如何处理DDL语句以创建对象，DML如何修改数据以及查询以检索数据。">SQL处理</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL178"></a><div class="props_rev_3"><a id="GUID-8CF633B1-EAC4-47C7-9189-C479ADEF1FFA" name="GUID-8CF633B1-EAC4-47C7-9189-C479ADEF1FFA"></a><h4 id="TGSQL-GUID-8CF633B1-EAC4-47C7-9189-C479ADEF1FFA" class="sect4"><span class="enumeration_section">3.1.1</span> SQL解析</h4>
                  <div>
                     <p>SQL处理的第一个阶段是<strong class="term">解析</strong> 。
                     </p>
                     <p>解析阶段涉及将SQL语句的各个部分分离为其他例程可以处理的数据结构。数据库在应用程序指示时解析语句，这意味着只有应用程序而不是数据库本身才能减少解析的数量。</p>
                     <p>当应用程序发出SQL语句时，应用程序会对数据库进行<a href="glossary.html#GUID-B7B23E36-A65E-43CD-AE96-37B62EA8CB32"><span class="xrefglossterm">解析调用</span></a>以准备要执行的语句。解析调用将打开或创建一个<a href="glossary.html#GUID-B29D6FB9-8D89-4124-A14F-E0FAEDAB2AA5"><span class="xrefglossterm">游标</span></a> ，该<a href="glossary.html#GUID-B29D6FB9-8D89-4124-A14F-E0FAEDAB2AA5"><span class="xrefglossterm">游标</span></a>是特定于会话的<a href="glossary.html#GUID-CD39D395-8176-4A4F-AEEA-4971F8CB7C58"><span class="xrefglossterm">私有SQL区域</span></a>的句柄，该<a href="glossary.html#GUID-CD39D395-8176-4A4F-AEEA-4971F8CB7C58"><span class="xrefglossterm">区域</span></a>包含已解析的SQL语句和其他处理信息。游标和私有SQL区域位于程序全局区域（PGA）中。
                     </p>
                     <p>在解析调用期间，数据库执行检查以识别<span class="italic">在语句执行之前</span>可以找到的错误。解析时无法捕获一些错误。例如，数据库只能在语句执行期间遇到数据转换中的死锁或错误。
                     </p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="sql-processing.html#GUID-26F3EC36-A200-482E-AAE5-35248A118873">语法检查</a><br>Oracle数据库必须检查每个SQL语句的语法有效性。
                        </li>
                        <li class="ulchildlink"><a href="sql-processing.html#GUID-EBB3A725-BF76-4B7C-A3A0-1D8CE20EFF7C">语义检查</a><br>声明的语义是它的意义。语义检查确定语句是否有意义，例如，语句中的对象和列是否存在。
                        </li>
                        <li class="ulchildlink"><a href="sql-processing.html#GUID-BFF0B26C-0A5D-4F79-B01E-8E1C4064A6AD">共享池检查</a><br>在解析期间，数据库执行共享池检查以确定它是否可以跳过资源密集的语句处理步骤。
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-8CF633B1-EAC4-47C7-9189-C479ADEF1FFA__GUID-E4A08F0E-B2E7-4D1C-8457-DF580481A02E">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../cncpt/data-concurrency-and-consistency.html#CNCPT1336" target="_blank"><span><cite>Oracle Database Concepts</cite></span></a>了解死锁</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-processing.html#GUID-873A7B2C-CD17-428A-8AE2-5B08906E45FB" title="SQL处理是SQL语句的解析，优化，行源生成和执行。">关于SQL处理</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL179"></a><div class="props_rev_3"><a id="GUID-26F3EC36-A200-482E-AAE5-35248A118873" name="GUID-26F3EC36-A200-482E-AAE5-35248A118873"></a><h5 id="TGSQL-GUID-26F3EC36-A200-482E-AAE5-35248A118873" class="sect5"><span class="enumeration_section">3.1.1.1</span>语法检查</h5>
                     <div>
                        <p>Oracle数据库必须检查每个SQL语句的语法有效性。</p>
                        <p>打破格式良好的SQL语法规则的语句未通过检查。例如，以下语句失败，因为关键字<code class="codeph">FROM</code>拼写错误为<code class="codeph">FORM</code> ：</p><pre class="pre codeblock"><code>SQL&gt; SELECT * FORM员工; SELECT * FORM employees *第1行的错误：ORA-00923：找不到FROM关键字</code></pre></div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-processing.html#GUID-8CF633B1-EAC4-47C7-9189-C479ADEF1FFA" title="SQL处理的第一个阶段是解析。">SQL解析</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL180"></a><div class="props_rev_3"><a id="GUID-EBB3A725-BF76-4B7C-A3A0-1D8CE20EFF7C" name="GUID-EBB3A725-BF76-4B7C-A3A0-1D8CE20EFF7C"></a><h5 id="TGSQL-GUID-EBB3A725-BF76-4B7C-A3A0-1D8CE20EFF7C" class="sect5"><span class="enumeration_section">3.1.1.2</span>语义检查</h5>
                     <div>
                        <p>声明的语义是它的意义。语义检查确定语句是否有意义，例如，语句中的对象和列是否存在。</p>
                        <p>语法正确的语句可能无法进行语义检查，如以下不存在的表的查询示例所示：</p><pre class="pre codeblock"><code>SQL&gt; SELECT * FROM nonexistent_table; SELECT * FROM nonexistent_table *第1行的错误：ORA-00942：表或视图不存在</code></pre></div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-processing.html#GUID-8CF633B1-EAC4-47C7-9189-C479ADEF1FFA" title="SQL处理的第一个阶段是解析。">SQL解析</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL182"></a><a id="TGSQL181"></a><div class="props_rev_3"><a id="GUID-BFF0B26C-0A5D-4F79-B01E-8E1C4064A6AD" name="GUID-BFF0B26C-0A5D-4F79-B01E-8E1C4064A6AD"></a><h5 id="TGSQL-GUID-BFF0B26C-0A5D-4F79-B01E-8E1C4064A6AD" class="sect5"><span class="enumeration_section">3.1.1.3</span>共享池检查</h5>
                     <div>
                        <p>在解析期间，数据库执行共享池检查以确定它是否可以跳过资源密集的语句处理步骤。</p>
                        <p>为此，数据库使用散列算法为每个SQL语句生成散列值。语句哈希值是<code class="codeph">V$SQL.SQL_ID</code>显示的<a href="glossary.html#GUID-894D17CF-F10C-4BD5-B2A2-E3AC23759B78"><span class="xrefglossterm">SQL ID</span></a> 。此哈希值在Oracle数据库版本中是确定性的，因此单个实例或不同实例中的相同语句具有相同的SQL ID。</p>
                        <p>当用户提交SQL语句时，数据库将搜索<a href="glossary.html#GUID-577D0DD3-FB98-4B1B-BCFB-95313BB35C01"><span class="xrefglossterm">共享SQL区域</span></a>以查看现有的已解析语句是否具有相同的哈希值。SQL语句的哈希值与以下值不同：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>语句的内存地址</p>
                              <p>Oracle数据库使用SQL ID在查找表中执行键控读取。这样，数据库就可以获得语句的可能内存地址。</p>
                           </li>
                           <li>
                              <p>该语句的<a href="glossary.html#GUID-800F2BE7-A383-4FF3-A9A6-FCE786AABA3B"><span class="xrefglossterm">执行计划的</span></a>哈希值</p>
                              <p>SQL语句可以在共享池中具有多个计划。通常，每个计划都有不同的哈希值。如果相同的SQL ID具有多个计划哈希值，则数据库知道此SQL ID存在多个计划。</p>
                           </li>
                        </ul>
                        <p>解析操作属于以下类别，具体取决于提交的语句类型和散列检查的结果：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>硬解析</p>
                              <p>如果Oracle数据库无法重用现有代码，那么它必须构建应用程序代码的新可执行版本。此操作称为<a href="glossary.html#GUID-AB764C9E-2F03-49A9-BF8B-36A9FBD03BCE"><span class="xrefglossterm">硬解析</span></a>或<a href="glossary.html#GUID-D12396D3-DCDA-4A61-8891-64AD81876EFD"><span class="xrefglossterm">库高速缓存未命中</span></a> 。
                              </p>
                              <div class="infoboxnote" id="GUID-BFF0B26C-0A5D-4F79-B01E-8E1C4064A6AD__GUID-BB11D2CF-1232-49C2-A010-BC21F727B77A">
                                 <p class="notep1">注意：</p>
                                 <p>数据库总是执行DDL的硬解析。</p>
                              </div>
                              <p>在硬解析期间，数据库多次访问库高速缓存和数据字典高速缓存以检查数据字典。当数据库访问这些区域时，它会在所需对象上使用称为<a href="glossary.html#GUID-B1C1EE03-1E9E-45F9-BD12-3B05654F7615"><span class="xrefglossterm">锁存器</span></a>的序列化设备，以便它们的定义不会更改。Latch争用会增加语句执行时间并降低并发性。
                              </p>
                           </li>
                           <li>
                              <p>软解析</p>
                              <p><a href="glossary.html#GUID-BA91B10B-FBA3-4DF6-B59B-9AA57C683D33"><span class="xrefglossterm">软解析</span></a>是任何不是硬解析的解析。如果提交的语句与共享池中的可重用SQL语句相同，则Oracle Database将重用现有代码。这种代码重用也称为<a href="glossary.html#GUID-22628BDA-52D1-4349-827A-071163A13D1A"><span class="xrefglossterm">库缓存命中</span></a> 。
                              </p>
                              <p>软解析可以在他们执行的工作量上有所不同。例如，配置会话共享SQL区域有时可以减少软解析中的锁存量，使其“更柔和”。</p>
                              <p>通常，软解析比硬解析更可取，因为数据库会跳过优化和行源生成步骤，直接执行。</p>
                           </li>
                        </ul>
                        <p>下图是专用服务器体系结构中<code class="codeph">UPDATE</code>语句的共享池检查的简化表示。
                        </p>
                        <div class="figure" id="GUID-BFF0B26C-0A5D-4F79-B01E-8E1C4064A6AD__BABDFGJD">
                           <p class="titleinfigure">图3-2共享池检查</p><img src="img/cncpt251.gif" alt="下面是图3-2的描述" title="下面是图3-2的描述" longdesc="img_text/cncpt251.html"><br><a href="img_text/cncpt251.html">“图3-2共享池检查”的说明</a></div>
                        <!-- class="figure" -->
                        <p>如果检查确定共享池中的语句具有相同的哈希值，则数据库将执行语义和环境检查以确定语句是否具有相同的含义。相同的语法是不够的。例如，假设两个不同的用户登录到数据库并发出以下SQL语句：</p><pre class="pre codeblock"><code>CREATE TABLE my_table（some_col INTEGER）; SELECT * FROM my_table;</code></pre><p>两个用户的<code class="codeph">SELECT</code>语句在语法上是相同的，但是两个单独的模式对象名为<code class="codeph">my_table</code> 。这种语义差异意味着第二个语句不能重用第一个语句的代码。
                        </p>
                        <p>即使两个语句在语义上相同，环境差异也会导致难以解析。在此上下文中， <a href="glossary.html#GUID-689C2576-297D-471D-8575-86FAE0185AAD"><span class="xrefglossterm">优化程序环境</span></a>是可影响执行计划生成的会话设置的总和，例如工作区大小或优化程序设置（例如，优化程序模式）。考虑由单个用户执行的以下一系列SQL语句：</p><pre class="pre codeblock"><code>ALTER SESSION SET OPTIMIZER_MODE = ALL_ROWS; ALTER SYSTEM FLUSH SHARED_POOL; ＃optimizer environment 1 SELECT * FROM sh.sales; ALTER SESSION SET OPTIMIZER_MODE = FIRST_ROWS; ＃optimizer environment 2 SELECT * FROM sh.sales; ALTER SESSION SET SQL_TRACE = true; ＃optimizer environment 3 SELECT * FROM sh.sales;</code></pre><p>在前面的示例中，相同的<code class="codeph">SELECT</code>语句在三个不同的优化器环境中执行。因此，数据库为这些语句创建了三个单独的共享SQL区域，并强制对每个语句进行硬解析。
                        </p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-BFF0B26C-0A5D-4F79-B01E-8E1C4064A6AD__GUID-D4B61C91-2173-4F68-A257-F72ECADE3297">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../cncpt/memory-architecture.html#CNCPT007" target="_blank"><span><cite>Oracle Database Concepts</cite></span></a> ，了解私有SQL区域和共享SQL区域</p>
                              </li>
                              <li>
                                 <p><a href="../tgdba/tuning-shared-pool-and-large-pool.html#TGDBA558" target="_blank"><span><cite>Oracle数据库性能调优指南</cite></span></a> ，了解如何配置共享池</p>
                              </li>
                              <li>
                                 <p><a href="../cncpt/data-concurrency-and-consistency.html#CNCPT1358" target="_blank"><span><cite>Oracle Database Concepts</cite></span></a>了解锁存器</p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="sql-processing.html#GUID-8CF633B1-EAC4-47C7-9189-C479ADEF1FFA" title="SQL处理的第一个阶段是解析。">SQL解析</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL183"></a><div class="props_rev_3"><a id="GUID-0196D949-6B0F-4DB0-BCCF-768F16B0964C" name="GUID-0196D949-6B0F-4DB0-BCCF-768F16B0964C"></a><h4 id="TGSQL-GUID-0196D949-6B0F-4DB0-BCCF-768F16B0964C" class="sect4"><span class="enumeration_section">3.1.2</span> SQL优化</h4>
                  <div>
                     <p>在优化期间，Oracle数据库必须至少对每个唯一的DML语句执行一次硬解析，并在此解析期间执行优化。</p>
                     <p>数据库不优化DDL。唯一的例外是DDL包含DML组件，例如需要优化的子查询。</p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-processing.html#GUID-873A7B2C-CD17-428A-8AE2-5B08906E45FB" title="SQL处理是SQL语句的解析，优化，行源生成和执行。">关于SQL处理</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL185"></a><a id="TGSQL184"></a><div class="props_rev_3"><a id="GUID-E052E274-586D-4D76-960F-B831140F7B94" name="GUID-E052E274-586D-4D76-960F-B831140F7B94"></a><h4 id="TGSQL-GUID-E052E274-586D-4D76-960F-B831140F7B94" class="sect4"><span class="enumeration_section">3.1.3</span> SQL行源生成</h4>
                  <div>
                     <p><strong class="term">行源生成器</strong>是从优化器接收最佳执行计划并生成可由数据库的其余部分使用的迭代执行计划的软件。
                     </p>
                     <p>迭代计划是一个二进制程序，当由SQL引擎执行时，会生成结果集。该计划采取步骤组合的形式。每个步骤都返回一个<a href="glossary.html#GUID-88998F10-D77C-43B5-B148-E649BF366DC2"><span class="xrefglossterm">行集</span></a> 。下一步要么使用此集合中的行，要么最后一步将行返回给发出SQL语句的应用程序。
                     </p>
                     <p><a href="glossary.html#GUID-BDE98BD8-BC33-45AD-97BF-81831BF94B04"><span class="xrefglossterm">行源</span></a>是执行计划中的步骤返回的行集，以及可以迭代处理行的控制结构。行源可以是表，视图或连接或分组操作的结果。
                     </p>
                     <p>行源生成器生成<a href="glossary.html#GUID-8C474809-DFD4-4EA6-90FE-A17882D07E58"><span class="xrefglossterm">行源树</span></a> ，它是行源的集合。行源树显示以下信息：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>语句引用的表的排序</p>
                        </li>
                        <li>
                           <p>语句中提到的每个表的访问方法</p>
                        </li>
                        <li>
                           <p>对语句中的连接操作影响的表的连接方法</p>
                        </li>
                        <li>
                           <p>数据操作，例如过滤，排序或聚合</p>
                        </li>
                     </ul>
                     <div class="example" id="GUID-E052E274-586D-4D76-960F-B831140F7B94__BABGEIBF">
                        <p class="titleinexample">示例3-1执行计划</p>
                        <p>此示例显示启用<code class="codeph">AUTOTRACE</code>时<code class="codeph">SELECT</code>语句的执行计划。该语句为姓氏以字母<code class="codeph">A</code>开头的所有员工选择姓氏，职位和部门名称。此语句的执行计划是行源生成器的输出。
                        </p><pre class="pre codeblock"><code>SELECT e.last_name，j.job_title，d.department_name FROM hr.employees e，hr.departments d，hr.jobs j WHERE e.department_id = d.department_id AND e.job_id = j.job_id AND e.last_name LIKE'A ％';执行计划------------------------------------------------ ----------计划哈希值：975837011 ----------------------------------- --------------------------------------------- | ID |操作|名称|行|字节|成本（％CPU）|时间| -------------------------------------------------- ------------------------------ | 0 |选择声明| | 3 | 189 | 7（15）| 00:00:01 | | * 1 | HASH JOIN | | 3 | 189 | 7（15）| 00:00:01 | | * 2 | HASH JOIN | | 3 | 141 | 5（20）| 00:00:01 | | 3 |按INDEX ROWID表的访问权限|员工| 3 | 60 | 2（0）| 00:00:01 | | * 4 | INDEX RANGE SCAN | EMP_NAME_IX | 3 | | 1（0）| 00:00:01 | | 5 |表访问完全|工作| 19 | 513 | 2（0）| 00:00:01 | | 6 |表访问完全|部门| 27 | 432 | 2（0）| 00:00:01 | -------------------------------------------------- ------------------------------谓词信息（由操作ID标识）：----------- ---------------------------------------- 1  - 访问（“E”。“DEPARTMENT_ID “=”D“。”DEPARTMENT_ID“）2  - 访问（”E“。”JOB_ID“=”J“。”JOB_ID“）4  - 访问（”E“。”LAST_NAME“LIKE'A％'）过滤器（” E“。”LAST_NAME“喜欢'％''）</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-processing.html#GUID-873A7B2C-CD17-428A-8AE2-5B08906E45FB" title="SQL处理是SQL语句的解析，优化，行源生成和执行。">关于SQL处理</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL187"></a><a id="TGSQL186"></a><div class="props_rev_3"><a id="GUID-CC83C349-364F-4AB4-8113-0FD6753EF3FB" name="GUID-CC83C349-364F-4AB4-8113-0FD6753EF3FB"></a><h4 id="TGSQL-GUID-CC83C349-364F-4AB4-8113-0FD6753EF3FB" class="sect4"><span class="enumeration_section">3.1.4</span> SQL执行</h4>
                  <div>
                     <p>在执行期间，SQL引擎执行行源生成器生成的树中的每个行源。此步骤是DML处理中唯一必需的步骤。</p>
                     <p><a href="sql-processing.html#GUID-CC83C349-364F-4AB4-8113-0FD6753EF3FB__BABJECHA">图3-3</a>是一个<a href="glossary.html#GUID-CB39EBA4-C228-4A41-960C-B0D180FA9A13"><span class="xrefglossterm">执行树</span></a> ，也称为<span class="italic">解析树</span> ，它显示了<a href="sql-processing.html#GUID-E052E274-586D-4D76-960F-B831140F7B94__BABGEIBF">示例3-1中</a>计划中从一个步骤到另一个步骤的行源流。通常，执行步骤的顺序与计划中的顺序<span class="italic">相反</span> ，因此您从下往上阅读计划。
                     </p>
                     <p>执行计划中的每个步骤都有一个ID号。<a href="sql-processing.html#GUID-CC83C349-364F-4AB4-8113-0FD6753EF3FB__BABJECHA">图3-3中</a>的数字对应于<a href="sql-processing.html#GUID-E052E274-586D-4D76-960F-B831140F7B94__BABGEIBF">例3-1中</a>所示计划中的<code class="codeph">Id</code>列。计划的“ <code class="codeph">Operation</code>列中的初始空间表示层次关系。例如，如果操作的名称前面有两个空格，则此操作是前面有一个空格的操作的子操作。以一个空格开头的操作是<code class="codeph">SELECT</code>语句本身的子项。
                     </p>
                     <div class="figure" id="GUID-CC83C349-364F-4AB4-8113-0FD6753EF3FB__BABJECHA">
                        <p class="titleinfigure">图3-3行源树</p><img src="img/cncpt001.gif" alt="下面是图3-3的描述" title="下面是图3-3的描述" longdesc="img_text/cncpt001.html"><br><a href="img_text/cncpt001.html">“图3-3行源树”的描述</a></div>
                     <!-- class="figure" -->
                     <p>在<a href="sql-processing.html#GUID-CC83C349-364F-4AB4-8113-0FD6753EF3FB__BABJECHA">图3-3中</a> ，树的每个节点都充当行源，这意味着<a href="sql-processing.html#GUID-E052E274-586D-4D76-960F-B831140F7B94__BABGEIBF">示例3-1</a>中的执行计划的每个步骤都从数据库中检索行，或者从一个或多个行源接受行作为输入。SQL引擎执行每个行源，如下所示：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>黑框指示的步骤从数据库中的对象物理地检索数据。这些步骤是访问路径或从数据库检索数据的技术。</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>步骤6使用全表扫描从<code class="codeph">departments</code>表中检索所有行。
                                 </p>
                              </li>
                              <li>
                                 <p>步骤5使用全表扫描从<code class="codeph">jobs</code>表中检索所有行。
                                 </p>
                              </li>
                              <li>
                                 <p>步骤4按顺序扫描<code class="codeph">emp_name_ix</code>索引，查找以字母<code class="codeph">A</code>开头并检索相应rowid的每个键。例如，对应于<code class="codeph">Atkinson</code>的rowid是<code class="codeph">AAAPzRAAFAAAABSAAe</code> 。
                                 </p>
                              </li>
                              <li>
                                 <p>步骤3从<code class="codeph">employees</code>表中检索步骤4返回rowid的行。例如，数据库使用rowid <code class="codeph">AAAPzRAAFAAAABSAAe</code>来检索<code class="codeph">Atkinson</code>的行。
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>清除框指示的步骤在行源上操作。</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>步骤2执行<a href="glossary.html#GUID-FF45796B-8A90-45C6-8A40-0B308B72AF7C"><span class="xrefglossterm">散列连接</span></a> ，接受来自步骤3和5的行源，将步骤5行源中的每一行连接到步骤3中的相应行，并将结果行返回到步骤1。
                                 </p>
                                 <p>例如，员工<code class="codeph">Atkinson</code>的行与作业名称<code class="codeph">Stock Clerk</code>相关联。
                                 </p>
                              </li>
                              <li>
                                 <p>步骤1执行另一个散列连接，接受来自步骤2和6的行源，将步骤6源中的每一行连接到步骤2中的相应行，并将结果返回给客户端。</p>
                                 <p>例如，员工<code class="codeph">Atkinson</code>的行与名为<code class="codeph">Shipping</code>的部门相关联。
                                 </p>
                              </li>
                           </ul>
                        </li>
                     </ul>
                     <p>在一些执行计划中，步骤是迭代的，而在其他执行计划中是顺序<a href="sql-processing.html#GUID-E052E274-586D-4D76-960F-B831140F7B94__BABGEIBF">例3-1中</a>显示的散列连接是顺序的。数据库根据连接顺序完成整个步骤。数据库以<code class="codeph">emp_name_ix</code>的索引范围扫描开始。使用它从索引中检索的rowid，数据库将读取<code class="codeph">employees</code>表中的匹配行，然后扫描<code class="codeph">jobs</code>表。在从<code class="codeph">jobs</code>表中检索行之后，数据库将执行散列连接。
                     </p>
                     <p>在执行期间，如果数据不在内存中，则数据库将数据从磁盘读入内存。数据库还会获取确保数据完整性所需的任何锁和锁存器，并记录在SQL执行期间所做的任何更改。处理SQL语句的最后阶段是关闭游标。</p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-processing.html#GUID-873A7B2C-CD17-428A-8AE2-5B08906E45FB" title="SQL处理是SQL语句的解析，优化，行源生成和执行。">关于SQL处理</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL188"></a><div class="props_rev_3"><a id="GUID-BEB00996-3614-45F4-991B-2585E08D8C97" name="GUID-BEB00996-3614-45F4-991B-2585E08D8C97"></a><h3 id="TGSQL-GUID-BEB00996-3614-45F4-991B-2585E08D8C97" class="sect3"><span class="enumeration_section">3.2</span> Oracle数据库如何处理DML</h3>
               <div>
                  <p>大多数DML语句都有一个查询组件。在查询中，执行游标会将查询结果放入一组称为<strong class="term">结果集</strong>的行中。
                  </p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="sql-processing.html#GUID-422F679D-80AD-42CF-B38C-7D22A550E2AA">如何获取行集</a><br>结果集行可以一次提取一行，也可以组提取。
                     </li>
                     <li class="ulchildlink"><a href="sql-processing.html#GUID-7F6D150A-DC47-4A34-8455-ECA648206297">阅读一致性</a><br>通常，查询使用Oracle数据库读取一致性机制检索数据，该机制可确保查询读取的所有数据块与单个时间点保持一致。
                     </li>
                     <li class="ulchildlink"><a href="sql-processing.html#GUID-14D902DA-5CAC-4892-BE8B-880A4F8A6914">数据变更</a><br>必须更改数据的DML语句使用读取一致性来仅检索修改开始时与搜索条件匹配的数据。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="sql-processing.html#GUID-B3415175-41F2-4EBB-95CF-5F8B5C39E927" title="本章介绍数据库如何处理DDL语句以创建对象，DML如何修改数据以及查询以检索数据。">SQL处理</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="props_rev_3"><a id="GUID-422F679D-80AD-42CF-B38C-7D22A550E2AA" name="GUID-422F679D-80AD-42CF-B38C-7D22A550E2AA"></a><h4 id="TGSQL-GUID-422F679D-80AD-42CF-B38C-7D22A550E2AA" class="sect4"><span class="enumeration_section">3.2.1</span>如何获取行集</h4>
                  <div>
                     <p>结果集行可以一次提取一行，也可以组提取。</p>
                     <p>在fetch阶段，数据库选择行，如果查询请求，则对行进行排序。每次连续提取都会检索结果的另一行，直到获取最后一行。</p>
                     <p>通常，在获取最后一行之前，数据库无法确定查询要检索的行数。Oracle数据库检索数据以响应fetch调用，因此数据库读取的行越多，它执行的工作就越多。对于某些查询，数据库会尽快返回第一行，而对于其他查询，它会在返回第一行之前创建整个结果集。</p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-processing.html#GUID-BEB00996-3614-45F4-991B-2585E08D8C97" title="大多数DML语句都有一个查询组件。在查询中，执行游标会将查询结果放入一组称为结果集的行中。">Oracle数据库如何处理DML</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL189"></a><div class="props_rev_3"><a id="GUID-7F6D150A-DC47-4A34-8455-ECA648206297" name="GUID-7F6D150A-DC47-4A34-8455-ECA648206297"></a><h4 id="TGSQL-GUID-7F6D150A-DC47-4A34-8455-ECA648206297" class="sect4"><span class="enumeration_section">3.2.2</span>读取一致性</h4>
                  <div>
                     <p>通常，查询使用Oracle数据库读取一致性机制检索数据，该机制可确保查询读取的所有数据块与单个时间点保持一致。</p>
                     <p>读取一致性使用撤消数据来显示过去的数据版本。例如，假设查询必须在全表扫描中读取100个数据块。查询处理前10个块，而不同会话中的DML修改块75。当第一会话到达块75时，它实现该改变并使用撤销数据来检索旧的未修改版本的数据并在存储器中构造块75的非当前版本。</p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-7F6D150A-DC47-4A34-8455-ECA648206297__GUID-D9C83CC9-747D-4DBB-B825-3B1A7269B8B7">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../cncpt/data-concurrency-and-consistency.html#CNCPT020" target="_blank"><span><cite>Oracle Database Concepts</cite></span></a>了解多版本读取一致性</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-processing.html#GUID-BEB00996-3614-45F4-991B-2585E08D8C97" title="大多数DML语句都有一个查询组件。在查询中，执行游标会将查询结果放入一组称为结果集的行中。">Oracle数据库如何处理DML</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL190"></a><div class="props_rev_3"><a id="GUID-14D902DA-5CAC-4892-BE8B-880A4F8A6914" name="GUID-14D902DA-5CAC-4892-BE8B-880A4F8A6914"></a><h4 id="TGSQL-GUID-14D902DA-5CAC-4892-BE8B-880A4F8A6914" class="sect4"><span class="enumeration_section">3.2.3</span>数据变更</h4>
                  <div>
                     <p>必须更改数据的DML语句使用读取一致性来仅检索修改开始时与搜索条件匹配的数据。</p>
                     <p>之后，这些语句将检索存在于当前状态的数据块并进行必要的修改。数据库必须执行与修改数据相关的其他操作，例如生成重做和撤消数据。</p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="sql-processing.html#GUID-BEB00996-3614-45F4-991B-2585E08D8C97" title="大多数DML语句都有一个查询组件。在查询中，执行游标会将查询结果放入一组称为结果集的行中。">Oracle数据库如何处理DML</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL191"></a><div class="props_rev_3"><a id="GUID-C7B96C36-3AE9-4120-A511-C4B2992275DD" name="GUID-C7B96C36-3AE9-4120-A511-C4B2992275DD"></a><h3 id="TGSQL-GUID-C7B96C36-3AE9-4120-A511-C4B2992275DD" class="sect3"><span class="enumeration_section">3.3</span> Oracle数据库如何处理DDL</h3>
               <div>
                  <p>Oracle数据库以不同于DML的方式处理DDL。</p>
                  <p>例如，在创建表时，数据库不会优化<code class="codeph">CREATE TABLE</code>语句。相反，Oracle数据库会解析DDL语句并执行该命令。
                  </p>
                  <p>数据库以不同方式处理DDL，因为它是在数据字典中定义对象的一种方法。通常，Oracle数据库必须解析并执行许多<a href="glossary.html#GUID-4BBB2EED-7E8C-4BAF-A3B3-B1CEF98342AC"><span class="xrefglossterm">递归SQL</span></a>语句才能执行DDL语句。假设您创建一个表，如下所示：</p><pre class="pre codeblock"><code>CREATE TABLE mytable（mycolumn INTEGER）;</code></pre><p>通常，数据库将运行许多递归语句来执行前面的语句。递归SQL将执行以下操作：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>在执行<code class="codeph">CREATE TABLE</code>语句之前发出<code class="codeph">COMMIT</code></p>
                     </li>
                     <li>
                        <p>验证用户权限是否足以创建表</p>
                     </li>
                     <li>
                        <p>确定表应该驻留在哪个表空间中</p>
                     </li>
                     <li>
                        <p>确保未超出表空间配额</p>
                     </li>
                     <li>
                        <p>确保架构中没有对象具有相同的名称</p>
                     </li>
                     <li>
                        <p>将定义表的行插入到数据字典中</p>
                     </li>
                     <li>
                        <p>如果DDL语句成功则发出<code class="codeph">COMMIT</code> ，否则发出<code class="codeph">ROLLBACK</code></p>
                     </li>
                  </ul>
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-C7B96C36-3AE9-4120-A511-C4B2992275DD__GUID-302442FA-173D-444D-A365-653658578EED">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="../adfns/sql-processing-for-application-developers.html#ADFNS134" target="_blank"><span><cite>Oracle数据库开发指南</cite></span></a> ，了解有关处理DDL，事务控制和其他类型语句的信息</p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="sql-processing.html#GUID-B3415175-41F2-4EBB-95CF-5F8B5C39E927" title="本章介绍数据库如何处理DDL语句以创建对象，DML如何修改数据以及查询以检索数据。">SQL处理</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>