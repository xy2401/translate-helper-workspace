<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="Workload management includes load balancing, enabling clients for Oracle Real Application Clusters (Oracle RAC), distributed transaction processing, and services."></meta>
      <meta name="description" content="Workload management includes load balancing, enabling clients for Oracle Real Application Clusters (Oracle RAC), distributed transaction processing, and services."></meta>
      <title>使用动态数据库服务管理工作负载</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Real Application Clusters Administration and Deployment Guide"></meta>
      <meta property="og:description" content="Workload management includes load balancing, enabling clients for Oracle Real Application Clusters (Oracle RAC), distributed transaction processing, and services."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Real Application Clusters Administration and Deployment Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="real-application-clusters-administration-and-deployment-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-04-25T14:02:30-07:00"></meta>
      <meta name="dcterms.title" content="Real Application Clusters Administration and Deployment Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="1999, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E95728-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="administering-oracle-rac-one-node.html" title="Previous" type="text/html"></link>
      <link rel="next" href="ensuring-application-continuity.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="RACAD"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="administering-oracle-rac-one-node.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="ensuring-application-continuity.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Real Application Clusters管理和部署指南</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用动态数据库服务管理工作负载</li>
            </ol>
            <a id="GUID-8DC4D5E0-CA9D-47BC-BAD0-8769405AFEC5" name="GUID-8DC4D5E0-CA9D-47BC-BAD0-8769405AFEC5"></a><a id="RACAD076"></a>
            
            <h2 id="RACAD-GUID-8DC4D5E0-CA9D-47BC-BAD0-8769405AFEC5" class="sect2"><span class="enumeration_chapter">5</span>使用动态数据库服务的工作负载管理</h2>
         </header>
         <div class="ind"><script type="text/javascript">window.name='workload-management-with-dynamic-database-services'</script><script type="text/javascript">
    function footdisplay(footnum,footnote) {
    var msg = window.open('about:blank', 'NewWindow' + footnum,
        'directories=no,height=100,location=no,menubar=no,resizable=yes,' +
        'scrollbars=yes,status=no,toolbar=no,width=598');
    msg.document.open('text/html');
    msg.document.write('<!DOCTYPE html ');
    msg.document.write('PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" ');
    msg.document.write('"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">'); 
    msg.document.write('<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us" dir="ltr"><head><title>');
   
    msg.document.write('Footnote&nbsp; ' + footnum);
    msg.document.write('<\/title><meta http-equiv="Content-Type" ');
    msg.document.write('content="text/html; charset=utf-8" />');
    msg.document.write('<meta http-equiv="Content-Script-Type" ');
    msg.document.write('content="text/javascript" />');
    msg.document.write('<style type="text/css"> <![CDATA[ ');
    msg.document.write('h1 {text-align: center; font-size: 14pt;}');
    msg.document.write('fieldset {border: none;}');
    msg.document.write('form {text-align: center;}');
    msg.document.write(' ]]u003e </style>');
    msg.document.write('<\/head><body><div id="footnote"><h1>Footnote&nbsp; ' + footnum + '<\/h1><p>');
    msg.document.write(footnote);
    msg.document.write('<\/p><form action="" method="post"><fieldset>');
    msg.document.write('<input type="button" value="OK" ');
    msg.document.write('onclick="window.close();" />');
    msg.document.write('<\/fieldset><\/form><\/div><\/body><\/html>');
    msg.document.close();
    setTimeout(function() {
        var height = msg.document.getElementById('footnote').offsetHeight;
        msg.resizeTo(598, height + 100);
    }
    , 100);
    msg.focus();
}
            </script><noscript>
               <p>此页面上的脚本内容仅用于导航目的，不会以任何方式更改内容。</p>
            </noscript>
            <div>
               <p>工作负载管理包括负载平衡，为Oracle Real Application Clusters（Oracle RAC），分布式事务处理和服务启用客户端。</p>
               <p>本章包括以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="workload-management-with-dynamic-database-services.html#GUID-095B67FB-3E3A-44BE-84A4-321174015A08" title="Oracle Net Services提供了在Oracle RAC配置中跨实例分发客户端连接的功能。">连接负载平衡</a></p>
                  </li>
                  <li>
                     <p><a href="workload-management-with-dynamic-database-services.html#GUID-26E66434-7A68-4B63-B759-3E0A8CA14A8B" title="您可以通过为要为其启用负载平衡的每个服务定义服务级别目标来配置环境以使用负载平衡通知。负载平衡咨询FAN事件为负载平衡算法提供度量。">负载平衡咨询</a></p>
                  </li>
                  <li>
                     <p><a href="workload-management-with-dynamic-database-services.html#GUID-074729CB-8A91-419C-A6E1-3B9E4FD8D869" title="FAN的总体目标是实现应用程序的端到端，无人值守恢复以及基于实际事务性能的负载平衡。为通用连接池和Oracle WebLogic Server启用快速连接故障转移（FCF）Active GridLink for Oracle RAC支持使用FAN HA和负载平衡咨询事件。您可以为通用连接池或隐式连接缓存启用FCF。运行时连接负载平衡需要使用Oracle JDBC驱动程序和Oracle RAC数据库。重播数据源（oracle.jdbc.replay。OracleDataSource）是Application Continuity对Java要求的JDBC瘦数据源。Transaction Guard为应用程序提供协议和通用工具，以便在计划内和计划外中断时最多执行一次。从Oracle Database 12c开始，OCI会话池使应用程序的多个线程能够使用动态管理的一组预先创建的数据库会话。OCI支持FAN消息和Transaction Guard。FAN旨在快速通知基于OCI的应用程序在节点，数据库，实例，服务和公共网络级别的中断。ODP.NET连接池可以订阅FAN HA通知，指示节点，服务和服务成员何时关闭。连接到Oracle Database 12c及更高版本时，ODP.NET使用Oracle Notification Service而不是Advanced Queuing。ODP.NET支持FAN消息和Transaction Guard。FAN旨在快速通知基于ODP.NET的应用程序在节点，数据库，实例，服务和公共网络级别的中断。">为Oracle RAC启用客户端</a></p>
                  </li>
                  <li>
                     <p><a href="workload-management-with-dynamic-database-services.html#GUID-7948E56B-D455-4852-A3EF-20E4F59156A5">Oracle RAC中的分布式事务处理</a></p>
                  </li>
                  <li>
                     <p><a href="workload-management-with-dynamic-database-services.html#GUID-C3CD2DCE-38BD-46BA-BC32-7A28CAC9A7FD" title="自动工作负载存储库（AWR）收集，处理和维护数据库的性能统计信息。">自动工作负载存储库</a></p>
                  </li>
                  <li>
                     <p><a href="workload-management-with-dynamic-database-services.html#GUID-559FB230-857B-4D97-B36A-F4F76C3A1D47" title="服务为性能调优添加了新维度，因为工作负载是可见且可测量的，因此资源消耗和等待时间可归因于应用程序。">使用自动工作负载存储库按服务测量性能</a></p>
                  </li>
                  <li>
                     <p><a href="workload-management-with-dynamic-database-services.html#GUID-27E6E869-570C-4B01-BF49-C147744D0D7D">自动工作负载存储库服务阈值和警报</a></p>
                  </li>
                  <li>
                     <p><a href="workload-management-with-dynamic-database-services.html#GUID-4CC2D344-02D6-40E7-85B6-BB3AA7D6461A">使用Oracle服务</a></p>
                  </li>
                  <li>
                     <p><a href="workload-management-with-dynamic-database-services.html#GUID-6524637F-FE3E-46D9-8B47-887C0D7C562C" title="Oracle GoldenGate利用Oracle RAC功能。使用Oracle Clusterware管理数据库时，可以使用带有-policy参数的srvctl add service命令添加服务时，为每个单独的数据库服务配置启动选项。如果在您的环境中配置了Oracle Data Guard，则可以在使用SRVCTL添加或修改服务时为服务定义角色，并使用适当的命令添加-role参数。为管理员管理的数据库定义服务时，可以使用带有-preferred参数的SRVCTL定义通常支持该服务的实例。如果可能，Oracle RAC将具有相同COLOCATION_TAG的客户端路由到同一数据库实例。为策略管理的数据库定义服务时，可以使用带有-serverpool参数的SRVCTL将服务分配给托管数据库的服务器池。Oracle Net Services提供连接负载平衡，使您能够跨所有支持服务的实例分布用户连接。默认情况下，此功能仅允许从本地IP地址注册侦听器，并提供配置和动态更新侦听器允许注册请求的一组IP地址或子网的功能。">服务部署选项</a></p>
                  </li>
                  <li>
                     <p><a href="workload-management-with-dynamic-database-services.html#GUID-2678C005-1B70-4B88-90E0-174A324F7DAA" title="在创建和管理服务时，您将数据库执行的工作划分为可管理的单元。Cluster Managed Database Services页面是用于开始与服务相关的所有任务的母版页。使用SRVCTL创建服务时，必须使用单独的SRVCTL命令启动该服务。要使用SRVCTL创建服务，请在命令行上使用srvctl add service命令。要为Application Continuity配置服务，在使用SRVCTL创建服务时，请将-failovertype参数设置为TRANSACTION，并将-commit_outcome设置为TRUE。">管理服务</a></p>
                  </li>
                  <li>
                     <p><a href="workload-management-with-dynamic-database-services.html#GUID-4C9FACD5-E959-4C79-A962-EFACBBC46545" title="Oracle RAC支持数据库服务，并支持跨单个集群中的实例进行服务级工作负载管理。">全球服务</a></p>
                  </li>
                  <li>
                     <p><a href="workload-management-with-dynamic-database-services.html#GUID-6552E661-CB51-462C-8C0C-02CEE4E50001">连接服务：一个例子</a></p>
                  </li>
               </ul>
            </div><a id="RACAD7122"></a><div class="sect2"><a id="GUID-095B67FB-3E3A-44BE-84A4-321174015A08" name="GUID-095B67FB-3E3A-44BE-84A4-321174015A08"></a><h3 id="RACAD-GUID-095B67FB-3E3A-44BE-84A4-321174015A08" class="sect3">连接负载平衡</h3>
               <div>
                  <p>Oracle Net Services提供了在Oracle RAC配置中跨实例分发客户端连接的功能。</p>
                  <p>您可以实现两种类型的负载平衡：客户端和服务器端负载平衡。客户端负载平衡在每个客户端独立地在侦听器之间分配连接请求。通过服务器端负载平衡，SCAN侦听器根据服务的<code class="codeph">-clbgoal</code>和<code class="codeph">-rlbgoal</code>设置将连接请求定向到当前提供服务的最佳实例。
                  </p>
                  <p>SCAN侦听器知道HTTP协议，因此它可以将HTTP客户端重定向到适当的处理程序，该处理程序可以驻留在集群中的不同节点上，而不是SCAN侦听器所驻留的节点。</p>
                  <p>在Oracle RAC数据库中，客户端连接应使用两种类型的连接负载平衡。</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-523373FE-A5E0-4891-A1C6-76B7C35C4F6D">服务器端负载平衡</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-02CF045D-EC05-4B4E-BB7D-41966BC700BD" title="Oracle Net Services使您可以将CONNECT_TIMEOUT，RETRY_COUNT和TRANSPORT_CONNECT_TIMEOUT参数添加到tnsnames.ora连接字符串。">通用数据库客户端</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-10F7892A-92DD-482C-8D68-AE80CE956010">客户端负载平衡</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-5129AD20-E50A-47D4-95D5-99A8DE72294E" title="对于OCI客户端，请在客户端创建本地sqlnet.ora文件。">旧客户端的客户端连接配置</a></p>
                     </li>
                  </ul>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="../netag/identifying-and-accessing-database.html#NETAG-GUID-4872CA90-12EE-4909-B504-622122FFCDAE" target="_blank"><span><cite>Oracle数据库网络服务管理员指南</cite></span></a></li>
                     </ul>
                  </div>
               </div><a id="RACAD8280"></a><div class="sect3"><a id="GUID-523373FE-A5E0-4891-A1C6-76B7C35C4F6D" name="GUID-523373FE-A5E0-4891-A1C6-76B7C35C4F6D"></a><h4 id="RACAD-GUID-523373FE-A5E0-4891-A1C6-76B7C35C4F6D" class="sect4">服务器端负载平衡</h4>
                  <div>
                     <p>使用DBCA创建Oracle RAC数据库时，它会自动：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>配置并启用服务器端负载平衡</p>
                        </li>
                        <li>
                           <p>在服务器上的<code class="codeph">tnsnames.ora</code>文件中创建示例客户端负载平衡连接定义</p>
                        </li>
                     </ul>
                     <p>Oracle Clusterware Database Agent负责管理<code class="codeph">LISTENER_NETWORKS</code>参数。
                     </p>
                     <div class="infoboxnote" id="GUID-523373FE-A5E0-4891-A1C6-76B7C35C4F6D__GUID-011F73AC-3E3D-4F89-8C3D-95B32798FD39">
                        <p class="notep1">注意：</p>
                        <p>注意：如果手动设置<code class="codeph">REMOTE_LISTENER</code>参数，则将此参数设置为<span class="italic"><code class="codeph">scan_name</code></span> <code class="codeph">:</code> <span class="italic"><code class="codeph">scan_port</code></span> 。
                        </p>
                     </div>
                     <p>FAN，快速连接故障转移和负载平衡建议取决于准确的连接负载平衡配置，包括设置服务的连接负载平衡目标。您可以使用<code class="codeph">LONG</code>或<code class="codeph">SHORT</code>的目标进行连接负载平衡。这些目标具有以下特征：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="bold">简短</span> ：使用<code class="codeph">SHORT</code> <a id="d17899e658" class="indexterm-anchor"></a>连接负载平衡方法，用于使用运行时负载平衡的应用程序。使用与Load Balancing Advisory集成的连接池时，请将<code class="codeph">CLB_GOAL</code>设置为<code class="codeph">SHORT</code> 。以下示例修改了名为<code class="codeph">oltpapp</code>的服务，使用SRVCTL将连接负载平衡目标设置为<code class="codeph">SHORT</code> ：</p><pre class="oac_no_warn" dir="ltr">$ srvctl修改服务-db <span class="italic">db_unique_name</span> -service oltpapp -clbgoal SHORT</pre></li>
                        <li>
                           <p><span class="bold">LONG</span> ：使用<code class="codeph">LONG</code> <a id="d17899e689" class="indexterm-anchor"></a>连接负载平衡方法，如果不需要运行时负载平衡。这是批处理操作的典型情况。<code class="codeph">LONG</code>是默认的连接负载平衡目标。下面是修改服务的一个例子<code class="codeph">batchconn</code> ，使用SRVCTL定义为长期会话的连接负载均衡的目标：</p><pre class="oac_no_warn" dir="ltr">$ srvctl修改服务-db <span class="italic">db_unique_name</span> -service batchconn -clbgoal LONG</pre></li>
                     </ul>
                  </div>
               </div><a id="RACAD8276"></a><div class="sect3"><a id="GUID-02CF045D-EC05-4B4E-BB7D-41966BC700BD" name="GUID-02CF045D-EC05-4B4E-BB7D-41966BC700BD"></a><h4 id="RACAD-GUID-02CF045D-EC05-4B4E-BB7D-41966BC700BD" class="sect4">通用数据库客户端</h4>
                  <div>
                     <p>Oracle Net Services使您可以将<code class="codeph">CONNECT_TIMEOUT</code> ， <code class="codeph">RETRY_COUNT</code>和<code class="codeph">TRANSPORT_CONNECT_TIMEOUT</code>参数添加到<code class="codeph">tnsnames.ora</code>连接字符串。
                     </p>
                     <p>例如，在数据库中为远程侦听器使用SCAN地址时：</p><pre class="pre codeblock"><code>jdbc：oracle：thin：@（DESCRIPTION =（TRANSPORT_CONNECT_TIMEOUT = 3）（CONNECT_TIMEOUT = 60）（RETRY_COUNT = 3）（FAILOVER = ON）（ADDRESS_LIST =（ADDRESS =（PROTOCOL = tcp）（HOST = CLOUD-SCANVIP.example。 com）（PORT = 5221））（CONNECT_DATA =（SERVICE_NAME = orcl）））Remote_listeners = CLOUD-SCANVIP.example.com:5221</code></pre><p>例如，在数据库中使用指向VIP的远程侦听器时：</p><pre class="pre codeblock"><code>jdbc：oracle：thin：@（DESCRIPTION =（TRANSPORT_CONNECT_TIMEOUT = 3）（CONNECT_TIMEOUT = 60）（RETRY_COUNT = 20）（RETRY_DELAY = 3）（FAILOVER = ON）（ADDRESS_LIST =（ADDRESS =（PROTOCOL = tcp）（HOST = CLOUD） -VIP1）（PORT = 1521））（ADDRESS =（PROTOCOL = tcp）（HOST = CLOUD-VIP2）（PORT = 1521））（ADDRESS =（PROTOCOL = tcp）（HOST = CLOUD-VIP3）（PORT = 1521） ））（CONNECT_DATA =（SERVICE_NAME = GOLD）））</code></pre><p>这些参数的值以秒表示。在前面的示例中，Oracle Net等待60秒以使每个完整连接接收响应，之后它假定发生了故障并重试<code class="codeph">ADDRESS_LIST</code>的下一个地址。 Oracle Net在向客户端返回失败消息之前重试地址列表3次。<code class="codeph">TRANSPORT_CONNECT_TIMEOUT</code>参数确定等待与数据库服务器建立TCP连接的时间。
                     </p>
                     <p>对于SCAN，Oracle Net Services会在将故障返回给客户端之前尝试所有三个地址（由SCAN地址返回）。带SCAN的EZConnect包括此连接故障转移功能。</p>
                     <p>此行为称为Oracle Net <span class="italic">连接故障转移</span> 。如果从列表中的所选地址返回错误，则Oracle Net Services将尝试列表中的下一个地址，直到它成功或者已耗尽其列表中的所有地址。
                     </p>
                  </div>
               </div><a id="RACAD8277"></a><div class="sect3"><a id="GUID-5129AD20-E50A-47D4-95D5-99A8DE72294E" name="GUID-5129AD20-E50A-47D4-95D5-99A8DE72294E"></a><h4 id="RACAD-GUID-5129AD20-E50A-47D4-95D5-99A8DE72294E" class="sect4">旧客户端的客户端连接配置</h4>
                  <div>
                     <p>除客户端负载平衡外，Oracle Net Services还包括<span class="bold">连接故障转移</span> 。如果从列表中的所选地址返回错误，Oracle Net Services将尝试列表中的下一个地址，直到它成功或已耗尽其列表中的所有地址。对于SCAN，Oracle Net Services会在将故障返回给客户端之前尝试所有三个地址。带SCAN的EZConnect包括此连接故障转移功能。
                     </p>
                     <p>要提高可用性，可以指定一个超时，指定Oracle Net在返回错误之前等待侦听器响应的时间。设置此超时参数的方法取决于客户端访问的类型。Oracle Net维护这些参数以实现向后兼容性。</p>
                     <p>本节包括以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-325F6E12-B60B-4B22-9A8E-96813FCD4601">JDBC瘦客户端</a></p>
                        </li>
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-32381119-7046-418A-A992-A18E8E55F316" title="对于OCI客户端，请在客户端创建本地sqlnet.ora文件。">OCI客户</a></p>
                        </li>
                     </ul>
                  </div><a id="RACAD8278"></a><div class="sect4"><a id="GUID-325F6E12-B60B-4B22-9A8E-96813FCD4601" name="GUID-325F6E12-B60B-4B22-9A8E-96813FCD4601"></a><h5 id="RACAD-GUID-325F6E12-B60B-4B22-9A8E-96813FCD4601" class="sect5">JDBC瘦客户端</h5>
                     <div>
                        <p>您可以通过设置<code class="codeph">oracle.net.ns.来避免延迟<code class="codeph">oracle.net.ns.SQLnetDef。TCP_CONNTIMEOUT_STR</code>属性，如下：</p><pre class="oac_no_warn" dir="ltr">属性prop = new Properties（）; prop.put（oracle.net.ns。SQLnetDef。TCP_CONNTIMEOUT_STR，“”+（1 * 1000））; // 1秒dbPools [poolIndex] .setConnectionProperties（prop）;</pre><p>参数值以毫秒为单位指定。因此，如果应用程序重试连接，则可以将超时减少到500M。</p>
                     </div>
                  </div><a id="RACAD8279"></a><div class="sect4"><a id="GUID-32381119-7046-418A-A992-A18E8E55F316" name="GUID-32381119-7046-418A-A992-A18E8E55F316"></a><h5 id="RACAD-GUID-32381119-7046-418A-A992-A18E8E55F316" class="sect5">OCI客户</h5>
                     <div>
                        <p>对于OCI客户端，请在客户端创建本地<code class="codeph">sqlnet.ora</code>文件。
                        </p>
                        <p>通过添加以下行在此文件中配置连接超时：</p><pre class="pre codeblock"><code>sqlnet.outbound_connect_timeout = <span class="variable" translate="no">number_of_seconds</span></code></pre><p>OCI客户端的超时值的粒度以秒为单位。<code class="codeph">sqlnet.ora</code>文件会影响使用此客户端的所有连接。
                        </p>
                        <div class="infoboxnote" id="GUID-32381119-7046-418A-A992-A18E8E55F316__GUID-B3C15BA4-C878-4D99-AE24-6E544E063E03">
                           <p class="notep1">注意：</p>
                           <p><span class="italic">不要</span>在配置连接超时<code class="codeph">sqlnet.ora</code>服务器上的文件。
                           </p>
                        </div>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="../lnoci/instant-client.html#LNOCI-GUID-B3694EC0-637E-434F-A92F-C301CC133CA2" target="_blank"><span><cite>Oracle调用接口程序员指南</cite></span></a></li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div><a id="RACAD8275"></a><div class="sect3"><a id="GUID-10F7892A-92DD-482C-8D68-AE80CE956010" name="GUID-10F7892A-92DD-482C-8D68-AE80CE956010"></a><h4 id="RACAD-GUID-10F7892A-92DD-482C-8D68-AE80CE956010" class="sect4">客户端负载平衡</h4>
                  <div>
                     <p>通过设置参数<code class="codeph">LOAD_BALANCE=ON</code> ，在客户端连接定义（例如<code class="codeph">tnsnames.ora</code>文件）中定义客户端负载平衡。将此参数设置为<code class="codeph">ON</code> ，Oracle数据库会随机选择地址列表中的地址，并连接到该节点的侦听器。这可以平衡群集中可用SCAN侦听器之间的客户端连接。
                     </p>
                     <p>如果为连接请求配置了SCAN，则客户端负载平衡与支持SCAN访问的客户端无关。当客户端使用SCAN进行连接时，除非您使用EZConnect，否则Oracle Net会自动平衡您为SCAN定义的三个IP地址的客户端连接请求负载。</p>
                     <p>SCAN侦听器将连接请求重定向到最小负载实例的本地侦听器（如果<code class="codeph">-clbgoal</code>设置为<code class="codeph">SHORT</code> ）并提供所请求的服务。当侦听器收到连接请求时，侦听器将用户连接到侦听器知道提供所请求服务的实例。要查看侦听器支持的服务，请运行<code class="codeph">lsnrctl services</code>命令。
                     </p>
                     <p>当客户端使用SCAN进行连接时，Oracle Net会自动在您为SCAN定义的三个IP地址上对客户端连接请求进行负载平衡，除非您使用的是EZConnect。</p>
                     <p>如果您使用的是不支持SCAN的客户端（例如，客户端版本是Oracle Database <span class="italic">11g之前</span>版本2（11.2）），则要使用SCAN，您必须更改客户端<code class="codeph">tnsnames.ora</code>以包含SCAN VIP，并设置<code class="codeph">LOAD_BALANCE=ON</code>以平衡VIP之间的请求。例如：</p><pre class="pre codeblock"><code>Sales.example.com =（DESCRIPTION =（ADDRESS_LIST =（LOAD_BALANCE = ON）（FAILOVER = ON）（ADDRESS =（PROTOCOL = TCP）（HOST = 172.22.67.192）（PORT = 1521））（ADDRESS =（PROTOCOL = TCP） ）（HOST = 172.22.67.193）（PORT = 1521））（ADDRESS =（PROTOCOL = TCP）（HOST = 172.22.67.194）（PORT = 1521））（CONNECT_DATA =（SERVICE_NAME = salesservice.example.com））））</code></pre><div class="infoboxnote" id="GUID-10F7892A-92DD-482C-8D68-AE80CE956010__GUID-4338FFA0-808B-46DF-91DA-67920AF35F6B">
                        <p class="notep1">注意：</p>
                        <p>如果您的数据库不是Oracle Database <span class="italic">11g第</span> 2版（11.2）或更高版本，并且您希望使用SCAN，则必须将SCAN VIP添加到<code class="codeph">REMOTE_LISTENER</code>参数以启用正确的侦听器交叉注册。
                        </p>
                     </div>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="../refrn/REMOTE_LISTENER.html#REFRN-GUID-FEE2E8B5-CE02-4158-A6B4-030E59316756" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div><a id="RACAD7302"></a><div class="sect2"><a id="GUID-26E66434-7A68-4B63-B759-3E0A8CA14A8B" name="GUID-26E66434-7A68-4B63-B759-3E0A8CA14A8B"></a><h3 id="RACAD-GUID-26E66434-7A68-4B63-B759-3E0A8CA14A8B" class="sect3">负载平衡咨询</h3>
               <div>
                  <p>本节介绍了<a id="d17899e1710" class="indexterm-anchor"></a>在以下主题下的负载平衡咨询：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-FD9404EA-65B4-4972-96DF-C81A5DAF2768">负载平衡咨询概述</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-BA90E5A3-140D-40BB-97F7-466E994CA3E5" title="您可以通过为要为其启用负载平衡的每个服务定义服务级别目标来配置环境以使用负载平衡通知。">配置环境以使用负载平衡通报</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-0EF444E4-6EC3-46A9-AF14-307995FEA664" title="负载平衡咨询FAN事件为负载平衡算法提供度量。">负载平衡咨询FAN事件</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-60D61506-EAAD-45D9-BE78-E93158B547FA">监控负载平衡咨询FAN事件</a></p>
                     </li>
                  </ul>
               </div><a id="RACAD7303"></a><div class="sect3"><a id="GUID-FD9404EA-65B4-4972-96DF-C81A5DAF2768" name="GUID-FD9404EA-65B4-4972-96DF-C81A5DAF2768"></a><h4 id="RACAD-GUID-FD9404EA-65B4-4972-96DF-C81A5DAF2768" class="sect4">负载平衡咨询概述</h4>
                  <div>
                     <p>负载平衡在所有可用的Oracle RAC数据库实例中分配工作。Oracle建议应用程序使用具有跨越提供特定服务的实例的持久连接的连接池。使用持久连接时，连接很少创建并且存在很长时间。工作以高频率进入系统，借用这些连接，并且存在的持续时间相对较短。负载平衡咨询提供有关如何将传入工作定向到为该工作提供最佳服务质量的实例的建议。这最大限度地减少了以后重新安置工作的需要。</p>
                     <p>通过使用负载平衡咨询和运行时连接负载平衡<a id="d17899e1885" class="indexterm-anchor"></a>目标，反馈内置于系统中。工作路由以在全球范围内提供最佳服务时间，并且路由可以适应不断变化的系统条件。在稳定状态下，系统通过所有Oracle RAC实例的吞吐量提高来达到平衡。
                     </p>
                     <p>可以使用负载平衡建议的标准体系结构包括连接负载平衡，事务处理监视器，应用程序服务器，连接集中器，硬件和软件负载平衡器，作业调度程序，批处理调度程序和消息排队系统。所有这些应用程序都可以分配工作。</p>
                     <p>该<a id="d17899e1894" class="indexterm-anchor"></a>负载平衡咨询部署在关键Oracle客户端上，例如侦听器，JDBC通用连接池，OCI会话池，Oracle WebLogic Server Active GridLink for Oracle RAC和ODP.NET连接池。第三方应用程序还可以使用JDBC和Oracle RAC FAN API或使用OCI回调来订阅负载平衡咨询事件。</p>
                  </div>
               </div><a id="RACAD7304"></a><div class="sect3"><a id="GUID-BA90E5A3-140D-40BB-97F7-466E994CA3E5" name="GUID-BA90E5A3-140D-40BB-97F7-466E994CA3E5"></a><h4 id="RACAD-GUID-BA90E5A3-140D-40BB-97F7-466E994CA3E5" class="sect4">配置环境以使用负载平衡通报</h4>
                  <div>
                     <p>您可以通过为要为其启用负载平衡的每个服务定义服务级别目标来配置环境以使用负载平衡通知。</p>
                     <p>配置服务级别目标可以为该服务启用负载平衡通知和FAN负载平衡事件的发布。运行时连接负载平衡有两种类型的服务级别目标：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">SERVICE_TIME</code> ：尝试根据响应时间将工作请求定向到实例。负载平衡咨询数据基于服务中完成的工作所用的时间加上服务的可用带宽。使用<code class="codeph">SERVICE_TIME</code>一个示例是针对诸如互联网购物之类的工作负载，其中需求变化率。以下示例显示如何使用<code class="codeph">online</code>服务将目标设置为<code class="codeph">SERVICE_TIME</code> ：</p><pre class="pre codeblock"><code>$ srvctl修改服务-db <span class="variable" translate="no">db_unique_name</span> -service online -rlbgoal SERVICE_TIME -clbgoal SHORT</code></pre></li>
                        <li>
                           <p><code class="codeph">THROUGHPUT</code> ：尝试根据吞吐量来指导工作请求。负载平衡建议基于服务中完成的工作速率加上服务的可用带宽。使用<code class="codeph">THROUGHPUT</code>一个示例适用于批处理等工作负载，其中下一个作业在上一个作业完成时启动。以下示例显示如何使用<code class="codeph">sjob</code>服务将目标设置为<code class="codeph">THROUGHPUT</code>以进行连接：</p><pre class="pre codeblock"><code>$ srvctl修改服务-db <span class="variable" translate="no">db_unique_name</span> -service sjob -rlbgoal THROUGHPUT -clbgoal LONG</code></pre></li>
                     </ul>
                     <p>将运行时连接负载平衡目标设置为<code class="codeph">NONE</code>会禁用服务的负载平衡。您可以通过查询<code class="codeph">DBA_SERVICES</code> ， <code class="codeph">V$SERVICES</code>和<code class="codeph">V$ACTIVE_SERVICES</code>视图来查看数据字典中服务的目标设置。您还可以使用Oracle Enterprise Manager查看服务的负载平衡设置。
                     </p>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="workload-management-with-dynamic-database-services.html#GUID-2678C005-1B70-4B88-90E0-174A324F7DAA" title="在创建和管理服务时，您将数据库执行的工作划分为可管理的单元。Cluster Managed Database Services页面是用于开始与服务相关的所有任务的母版页。使用SRVCTL创建服务时，必须使用单独的SRVCTL命令启动该服务。要使用SRVCTL创建服务，请在命令行上使用srvctl add service命令。要为Application Continuity配置服务，在使用SRVCTL创建服务时，请将-failovertype参数设置为TRANSACTION，并将-commit_outcome设置为TRUE。">管理服务</a></li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RACAD7689"></a><a id="RACAD7305"></a><div class="sect3"><a id="GUID-0EF444E4-6EC3-46A9-AF14-307995FEA664" name="GUID-0EF444E4-6EC3-46A9-AF14-307995FEA664"></a><h4 id="RACAD-GUID-0EF444E4-6EC3-46A9-AF14-307995FEA664" class="sect4">负载平衡咨询FAN事件</h4>
                  <div>
                     <p>负载平衡咨询FAN事件为负载平衡算法提供度量。</p>
                     <p>利用这些事件的最简单方法是使用Oracle集成客户端的运行时连接负载平衡功能，例如JDBC，通用连接池（或不推荐使用的隐式连接缓存），ODP.NET连接池，OCI会话池或Oracle WebLogic Server Active GridLink for Oracle RAC。其他客户端应用程序可以通过使用Oracle RAC FAN API订阅FAN事件并在收到时执行事件处理操作，以编程方式利用FAN。<a href="workload-management-with-dynamic-database-services.html#GUID-0EF444E4-6EC3-46A9-AF14-307995FEA664__BABHJDGB" title="事件有效负载参数和描述">表5-1</a>介绍了负载均衡顾问FAN事件参数。
                     </p>
                     <div class="infoboxnotealso" id="GUID-0EF444E4-6EC3-46A9-AF14-307995FEA664__GUID-15217374-F3F9-4572-A486-40A962F99672">
                        <p class="notep1">也可以看看：</p>
                        <p>有关Oracle RAC FAN API的更多信息，请参见<span><cite>“Oracle数据库JDBC开发人员指南”</cite></span></p>
                     </div>
                     <div class="tblformalwide" id="GUID-0EF444E4-6EC3-46A9-AF14-307995FEA664__BABHJDGB">
                        <p class="titleintable">表5-1负载均衡咨询风扇事件</p>
                        <table cellpadding="4" cellspacing="0" class="FormalWide" title="负载平衡咨询FAN事件" width="100%" border="1" summary="Event payload parameters and descriptions" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="21%" id="d17899e2304">参数</th>
                                 <th align="left" valign="bottom" width="79%" id="d17899e2307">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="21%" id="d17899e2312" headers="d17899e2304 "><pre class="oac_no_warn" dir="ltr">版</pre></td>
                                 <td align="left" valign="top" width="79%" headers="d17899e2312 d17899e2307 ">
                                    <p>事件记录的版本。用于标识版本更改。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="21%" id="d17899e2319" headers="d17899e2304 "><pre class="oac_no_warn" dir="ltr">事件类型</pre></td>
                                 <td align="left" valign="top" width="79%" headers="d17899e2319 d17899e2307 ">
                                    <p>负载平衡顾问事件始终是<code class="codeph">SERVICEMETRICS</code>事件类型。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="21%" id="d17899e2329" headers="d17899e2304 "><pre class="oac_no_warn" dir="ltr">服务</pre></td>
                                 <td align="left" valign="top" width="79%" headers="d17899e2329 d17899e2307 ">
                                    <p>服务名称;匹配<code class="codeph">DBA_SERVICES</code>中<code class="codeph">NAME</code>的值。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="21%" id="d17899e2342" headers="d17899e2304 "><pre class="oac_no_warn" dir="ltr">数据库</pre></td>
                                 <td align="left" valign="top" width="79%" headers="d17899e2342 d17899e2307 ">
                                    <p>支持服务的独特数据库;匹配<code class="codeph">DB_UNIQUE_NAME</code>的初始化参数值，默认值为初始化参数<code class="codeph">DB_NAME</code>的值。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="21%" id="d17899e2355" headers="d17899e2304 "><pre class="oac_no_warn" dir="ltr">INSTANCE</pre></td>
                                 <td align="left" valign="top" width="79%" headers="d17899e2355 d17899e2307 ">
                                    <p>支持该服务的实例的名称;匹配<code class="codeph">ORACLE_SID</code>值。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="21%" id="d17899e2365" headers="d17899e2304 "><pre class="oac_no_warn" dir="ltr">百分</pre></td>
                                 <td align="left" valign="top" width="79%" headers="d17899e2365 d17899e2307 ">
                                    <p>要发送到此数据库实例的工作请求的百分比。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="21%" id="d17899e2372" headers="d17899e2304 "><pre class="oac_no_warn" dir="ltr">旗</pre></td>
                                 <td align="left" valign="top" width="79%" headers="d17899e2372 d17899e2307 ">
                                    <p>指示相对于服务目标的服务质量。有效值为<code class="codeph">GOOD</code> ， <code class="codeph">VIOLATING</code> ， <code class="codeph">NO DATA</code>和<code class="codeph">BLOCKED</code> 。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="21%" id="d17899e2391" headers="d17899e2304 "><pre class="oac_no_warn" dir="ltr">TIMESTAMP</pre></td>
                                 <td align="left" valign="top" width="79%" headers="d17899e2391 d17899e2307 ">
                                    <p>订购通知事件时使用的本地时区。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="infoboxnote" id="GUID-0EF444E4-6EC3-46A9-AF14-307995FEA664__GUID-998C07D5-3D9B-4469-A34C-CF8F6C7A4C4F">
                        <p class="notep1">注意：</p>
                        <p>为提供服务的每个实例生成<code class="codeph">INSTANCE</code> ， <code class="codeph">PERCENT</code>和<code class="codeph">FLAG</code>事件参数。每组实例数据都包含在大括号（ <code class="codeph">{}</code> ）中。
                        </p>
                     </div>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="../jjdbc/Oracle-RAC-FAN-API.html#JJDBC-GUID-672941ED-9553-4779-B1AD-7FEBC07603D6" target="_blank"><span><cite>Oracle数据库JDBC开发人员指南</cite></span></a></li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RACAD8281"></a><div class="sect3"><a id="GUID-60D61506-EAAD-45D9-BE78-E93158B547FA" name="GUID-60D61506-EAAD-45D9-BE78-E93158B547FA"></a><h4 id="RACAD-GUID-60D61506-EAAD-45D9-BE78-E93158B547FA" class="sect4">监控负载平衡咨询FAN事件</h4>
                  <div>
                     <p>您可以对内部队列表使用以下查询来进行负载平衡通知FAN事件，以监视为实例生成的负载平衡通报事件：</p><pre class="oac_no_warn" dir="ltr">设置页面60 COLSEP'|' LINES 132 NUM 8 VERIFY OFF FEEDBACK OFF COLUMN user_data HEADING“AQ服务指标”格式A60 WRAP BREAK ON service_name SKIP 1 SELECT TO_CHAR（enq_time，'HH：MI：SS'）Enq_time，user_data FROM sys.sys $ service_metrics_tab ORDER BY 1;</pre><p>此查询的结果包含类似于以下内容的行：</p><pre class="oac_no_warn" dir="ltr">02：56：05 | SYS $ RLBTYP（'hr'，'VERSION = 1.0 database = sales service = hr {{instance = sales_4 percent = 38 flag = GOOD aff = TRUE} {instance = sales_1 percent = 62 flag = GOOD aff = TRUE}} timestamp = 2012-07-16 07:56:05'）</pre><p>以下是使用Oracle RAC FAN API从Oracle Notification Service捕获的两个实例（ <code class="codeph">orcl1</code>和<code class="codeph">orcl2</code> ）上提供的<code class="codeph">lba_serv</code>服务的负载平衡顾问事件的<code class="codeph">lba_serv</code> ：</p><pre class="oac_no_warn" dir="ltr">通知类型：database / event / servicemetrics / lba_serv.example.com VERSION = 1.0 database = orcl service = lba_serv.example.com {{instance = orcl2 percent = 50 flag = UNKNOWN aff = FALSE} {instance = orcl1 percent = 50 flag = UNKNOWN aff = FALSE}} timestamp = 2012-07-06 13:19:12</pre><div class="infoboxnote" id="GUID-60D61506-EAAD-45D9-BE78-E93158B547FA__GUID-80A6B0B5-0FC1-4985-9A19-2C2FB36106B6">
                        <p class="notep1">注意：</p>
                        <p>通过FAN标注机制无法看到<code class="codeph">SERVICMETRICS</code>事件。
                        </p>
                     </div>
                  </div>
               </div>
            </div><a id="RACAD7134"></a><div class="sect2"><a id="GUID-074729CB-8A91-419C-A6E1-3B9E4FD8D869" name="GUID-074729CB-8A91-419C-A6E1-3B9E4FD8D869"></a><h3 id="RACAD-GUID-074729CB-8A91-419C-A6E1-3B9E4FD8D869" class="sect3">为Oracle RAC启用客户端</h3>
               <div>
                  <p>Oracle已将FAN与许多常见功能集成在一起<a id="d17899e2726" class="indexterm-anchor"></a>用于连接Oracle RAC数据库的客户端应用程序环境。因此，使用FAN的最简单方法是使用集成的Oracle客户端。
                  </p>
                  <p>以下部分讨论FAN如何与Oracle客户端集成以及如何为多个特定客户端开发环境启用FAN事件：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-8CA1B780-FC7E-4050-8A11-468D27CBD308" title="FAN的总体目标是实现应用程序的端到端，无人值守恢复以及基于实际事务性能的负载平衡。">Oracle集成客户端和FAN概述</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-EE246927-2883-44EC-80F6-A3FCB019624E" title="为通用连接池和Oracle WebLogic Server启用快速连接故障转移（FCF）Active GridLink for Oracle RAC支持使用FAN HA和负载平衡咨询事件。">启用JDBC瘦客户端以实现快速连接故障转移</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-C3061DB8-C974-4734-98EB-EDED23B79423" title="运行时连接负载平衡需要使用Oracle JDBC驱动程序和Oracle RAC数据库。">为运行时连接负载平衡启用JDBC客户端</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-CBD1ABAA-34B4-4486-BB8B-111BDA7FE44A" title="重播数据源（oracle.jdbc.replay。OracleDataSource）是Application Continuity对Java要求的JDBC瘦数据源。">为Java的应用程序连续性配置JDBC瘦客户端</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-F94A5DDE-4E87-4C6B-9DBB-1702E706B2D9" title="Transaction Guard为应用程序提供协议和通用工具，以便在计划内和计划外中断时最多执行一次。">为Transaction Guard配置JDBC瘦客户端</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-C9BDC6E3-16A6-4175-8B0B-E15DFD07466E">启用OCI客户端以实现快速连接故障转移</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-AEEE07D0-057A-4617-A716-9957D98B593D" title="从Oracle Database 12c开始，OCI会话池使应用程序的多个线程能够使用动态管理的一组预先创建的数据库会话。">为运行时连接负载平衡启用OCI客户端</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-DDD78F92-BC57-472A-9729-CEFDBFB32142" title="OCI支持FAN消息和Transaction Guard。FAN旨在快速通知基于OCI的应用程序在节点，数据库，实例，服务和公共网络级别的中断。">配置OCI客户端以使用Transaction Guard</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-1A7346B1-AFE3-4B17-AD7E-E35FE628CDF9" title="ODP.NET连接池可以订阅FAN HA通知，指示节点，服务和服务成员何时关闭。">启用ODP.NET客户端以接收FAN高可用性事件</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-D779F756-F8EA-4BEF-8A54-94395B6B9AF6" title="连接到Oracle Database 12c及更高版本时，ODP.NET使用Oracle Notification Service而不是Advanced Queuing。">使ODP.NET客户端能够接收FAN负载平衡咨询事件</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-34DB264E-3210-4C79-A104-AE0AAF269CDF" title="ODP.NET支持FAN消息和Transaction Guard。FAN旨在快速通知基于ODP.NET的应用程序在节点，数据库，实例，服务和公共网络级别的中断。">配置ODP.NET客户端以使用Transaction Guard</a></p>
                     </li>
                  </ul>
               </div><a id="RACAD8282"></a><div class="sect3"><a id="GUID-8CA1B780-FC7E-4050-8A11-468D27CBD308" name="GUID-8CA1B780-FC7E-4050-8A11-468D27CBD308"></a><h4 id="RACAD-GUID-8CA1B780-FC7E-4050-8A11-468D27CBD308" class="sect4">Oracle集成客户端和FAN概述</h4>
                  <div>
                     <p>FAN的总体目标是实现应用程序的端到端，无人值守恢复以及基于实际事务性能的负载平衡。</p>
                     <p>应用程序使用FAN高可用性（HA）事件来实现非常快速的故障检测，故障后连接池的平衡以及故障组件修复后的连接分布。</p>
                     <p>承载负载平衡建议的FAN事件有助于连接池始终如一地提供与提供最佳服务的可用实例的连接。FAN HA与JDBC-thin和OCI驱动程序集成在一起。FAN HA和FAN负载平衡都与JDBC通用连接池（以及不推荐使用的隐式连接缓存），OCI会话池，ODP.NET连接池和Oracle WebLogic Server Active GridLink for Oracle RAC集成在一起。</p>
                     <p>由于与FAN的集成，Oracle集成客户端更加了解Oracle RAC集群的当前状态。这可以防止客户端连接等待或尝试连接到不再可用的实例或服务。实例启动时，Oracle RAC使用FAN通知连接池，以便连接池可以创建与最近启动的实例的连接，并利用此实例提供的其他资源。</p>
                     <p>与FAN集成的Oracle客户端驱动程序可以：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>在服务在实例中声明为<code class="codeph">DOWN</code>时立即删除已终止的连接，并在节点声明为<code class="codeph">DOWN</code>时立即删除</p>
                        </li>
                        <li>
                           <p>当Oracle数据库检测到<code class="codeph">NOT RESTARTING</code>状态时，立即向客户端报告错误，而不是在服务重复尝试重新启动时使客户端等待</p>
                        </li>
                     </ul>
                     <p>与FAN集成的Oracle连接池可以：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>在服务启动时平衡所有Oracle RAC实例的连接;这最好是将为连接池定义的会话定向到支持该服务的第一个Oracle RAC实例</p>
                        </li>
                        <li>
                           <p>使用负载平衡顾问事件在运行时平衡工作请求</p>
                        </li>
                     </ul>
                     <p>使用客户端驱动程序或连接池和FAN要求您正确配置Oracle Notification Service以将FAN事件传递给客户端。此外，对于负载平衡，请在提供连接池使用的服务的所有实例之间配置数据库连接负载平衡。Oracle建议您使用Oracle Net Services配置客户端和服务器端负载平衡。如果使用DBCA创建数据库，则默认情况下会配置客户端和服务器端负载平衡。</p>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="workload-management-with-dynamic-database-services.html#GUID-095B67FB-3E3A-44BE-84A4-321174015A08" title="Oracle Net Services提供了在Oracle RAC配置中跨实例分发客户端连接的功能。">连接负载平衡</a></li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RACAD7135"></a><div class="sect3"><a id="GUID-EE246927-2883-44EC-80F6-A3FCB019624E" name="GUID-EE246927-2883-44EC-80F6-A3FCB019624E"></a><h4 id="RACAD-GUID-EE246927-2883-44EC-80F6-A3FCB019624E" class="sect4">启用JDBC瘦客户端以实现快速连接故障转移</h4>
                  <div>
                     <p>为通用连接池和Oracle WebLogic Server启用快速连接故障转移（FCF）Active GridLink for Oracle RAC支持使用FAN HA和负载平衡咨询事件。</p>
                     <p>要使通用连接池使用FAN，您的应用程序可以将JDBC开发环境用于JDBC OCI或JDBC瘦客户端。Java数据库连接Oracle调用接口（JDBC / OCI）驱动程序连接池功能是JDBC瘦客户机的一部分。此功能由<code class="codeph">OracleOCIConnectionPool</code>类提供。
                     </p>
                     <p>要为JDBC瘦客户机启用FCF，请在发出第一个<code class="codeph">getConnection()</code>请求之前调用<code class="codeph">oracle.jdbc.pool</code>包中<code class="codeph">OracleDataSource</code>类的方法<code class="codeph">setFastConnectionFailoverEnabled(true)</code> 。为JDBC瘦客户机启用FCF时，故障转移属性适用于连接池中的每个连接。使用JDBC-thin驱动程序或JDBC / OCI客户端启用FCF可使连接池接收并响应所有FAN事件。
                     </p>
                     <p>JDBC应用程序开发人员可以使用Oracle Database <span class="italic">11g第</span> 2版（11.2）中引入的一组API以编程方式与FAN集成。Oracle RAC FAN API使应用程序代码能够以下列方式接收和响应Oracle RAC发送的FAN事件通知：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>侦听Oracle RAC服务关闭，服务启动和节点关闭事件</p>
                        </li>
                        <li>
                           <p>侦听负载平衡咨询事件并对其进行响应</p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="../jjdbc/Oracle-RAC-FAN-API.html#JJDBC-GUID-672941ED-9553-4779-B1AD-7FEBC07603D6" target="_blank"><span><cite>Oracle数据库JDBC开发人员指南</cite></span></a></li>
                        </ul>
                     </div>
                  </div><a id="RACAD8283"></a><div class="sect4"><a id="GUID-E242A789-7118-45CD-82C8-2CB52248C47F" name="GUID-E242A789-7118-45CD-82C8-2CB52248C47F"></a><h5 id="RACAD-GUID-E242A789-7118-45CD-82C8-2CB52248C47F" class="sect5">JDBC瘦客户端的Oracle Notification Service</h5>
                     <div>
                        <p><a id="d17899e3374" class="indexterm-anchor"></a> FCF依靠Oracle Notification Service在连接池和Oracle RAC数据库之间传播数据库事件。在运行时，连接池必须能够设置Oracle Notification Service环境。Oracle Notification Service（ <code class="codeph">ons.jar</code> ）作为Oracle客户端软件的一部分包含在内。可以使用远程配置或客户端Oracle Notification Service守护程序配置来配置Oracle Notification Service。远程Oracle Notification Service订阅具有以下优势：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>支持All Java中间层软件</p>
                           </li>
                           <li>
                              <p>客户端系统上不需要Oracle Notification Service守护程序，因此您无需管理此过程</p>
                           </li>
                           <li>
                              <p>通过<code class="codeph">DataSource</code>属性进行简单配置</p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="RACAD7306"></a><div class="sect4"><a id="GUID-5396E213-81D5-45AA-84C0-FA74D9CD24A4" name="GUID-5396E213-81D5-45AA-84C0-FA74D9CD24A4"></a><h5 id="RACAD-GUID-5396E213-81D5-45AA-84C0-FA74D9CD24A4" class="sect5">为JDBC / OCI和JDBC-Thin驱动程序客户端配置FCF</h5>
                     <div>
                        <p>您可以为通用连接池或隐式连接缓存启用FCF。</p>
                        <p>Oracle建议使用Java的通用连接池，因为不推荐使用隐式连接缓存。您还可以使用Oracle WebLogic Server Active GridLink for Oracle RAC。</p>
                        <p>此过程说明如何为JDBC启用FCF。对于JDBC / OCI客户端，如果启用FCF，则不要使用为Oracle OCI客户端启用FAN的Oracle Database <span class="italic">11g第</span> 2版（11.2）中使用的方法（在服务上将<code class="codeph">notification</code>设置为TRUE），并且不要配置TAF，无论是在客户端还是在服务上。您还可以配置应用程序连续性和事务防护。
                        </p>
                        <p>要启用FCF，必须首先启用通用连接池，如以下过程中所述：</p>
                        <ol>
                           <li>
                              <p>创建连接池并设置<code class="codeph">setFastConnectionFailoverEnabled(true)</code> 。
                              </p>
                              <p>以下示例创建连接池并启用FCF。 <code class="codeph">ucp.jar</code>库必须包含在应用程序的类路径中才能使用此示例。
                              </p><pre class="pre codeblock"><code>PoolDataSource pds = PoolDataSourceFactory.getPoolDataSource（）; pds.setFastConnectionFailoverEnabled（真）;</code></pre></li>
                           <li>
                              <p>确定用于Oracle Notification Service远程订阅的端口。</p>
                              <p>使用以下命令在运行Oracle Clusterware的每个节点上查看Oracle Notification Service配置，如以下示例所示：</p><pre class="pre codeblock"><code>srvctl config nodeapps -onsonly</code></pre><p>此命令的输出列出为Oracle Notification Service配置的本地和远程端口。</p>
                              <div class="infoboxnote" id="GUID-5396E213-81D5-45AA-84C0-FA74D9CD24A4__GUID-821ABBEB-2C02-47FF-95CC-46C1B94BE1D7">
                                 <p class="notep1">注意：</p>
                                 <p>应在Oracle Clusterware安装期间自动完成Oracle Notification Service配置。</p>
                              </div>
                           </li>
                           <li>
                              <p>配置远程Oracle Notification Service订阅。</p>
                              <p>使用通用连接池时，应用程序会调用<code class="codeph">OracleDataSource</code>实例的<code class="codeph">setONSConfiguration</code> ，并指定要使用的节点和端口号。用于每个节点的端口号与步骤2中为每个节点显示的远程端口相同，如以下示例所示。<code class="codeph">ons.jar</code>库必须包含在应用程序的类路径中才能使用此示例。
                              </p><pre class="pre codeblock"><code>pds.setONSConfiguration（ “节点= racnode1：6200，racnode2：6200”）;</code></pre><p>使用远程Oracle Notification Service配置的应用程序必须在启动应用程序之前将<code class="codeph">oracle.ons.oraclehome</code>系统属性设置为<code class="codeph">ORACLE_HOME</code>的位置，例如：</p><pre class="pre codeblock"><code>java -Doracle.ons.oraclehome = $ ORACLE_HOME ...</code></pre></li>
                           <li>
                              <p>配置连接URL。</p>
                              <p>使用FCF时，连接工厂的连接URL必须使用服务名称语法。服务名称用于将连接池映射到服务。以下示例演示如何配置连接URL：</p><pre class="pre codeblock"><code>pds.setConnectionFactoryClassName（“oracle.jdbc.pool。OracleDataSource“）; pds.setURL（”jdbc：oracle：thin @ // <span class="variable" translate="no">SCAN_name</span> ： <span class="variable" translate="no">service_name</span> “）; ...</code></pre></li>
                        </ol>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="../jjdbc/introducing-JDBC.html#JJDBC-GUID-864DB502-5E50-4044-8132-33D6AAF8927A" target="_blank"><span><cite>Oracle数据库JDBC开发人员指南</cite></span></a></li>
                              <li><a href="../jjucp/fast-connection-failover.html#JJUCP-GUID-126F8C9B-C0B3-426B-B07D-4B127BBDD867" target="_blank"><span><cite>Oracle通用连接池开发人员指南</cite></span></a></li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div><a id="RACAD8284"></a><div class="sect3"><a id="GUID-C3061DB8-C974-4734-98EB-EDED23B79423" name="GUID-C3061DB8-C974-4734-98EB-EDED23B79423"></a><h4 id="RACAD-GUID-C3061DB8-C974-4734-98EB-EDED23B79423" class="sect4">为运行时连接负载平衡启用JDBC客户端</h4>
                  <div>
                     <p>运行时连接负载平衡需要使用Oracle JDBC驱动程序和Oracle RAC数据库。</p>
                     <p>Oracle JDBC通用连接池和Oracle WebLogic Server Active GridLink for Oracle RAC利用Oracle RAC数据库提供的负载平衡功能。</p>
                     <p>集成了通用连接池和Oracle WebLogic Server Active GridLink for Oracle RAC，以利用负载平衡咨询信息。Oracle在Oracle Database <span class="italic">11g</span> 11.1.0.7.0版中引入了JDBC的通用连接池。因此，Oracle弃用了现有的JDBC连接池，即隐式连接缓存，它是Oracle数据库<span class="italic">10g第</span> 1版中引入的，用于Oracle RAC数据库。除了Oracle Database <span class="italic">12c之外</span> ，您还可以将通用连接池与Oracle Database <span class="italic">10g</span>或Oracle Database <span class="italic">11g一起使用</span> 。
                     </p>
                     <p>运行时连接负载平衡要求正确启用和配置FCF。此外，必须为连接池使用的每个服务配置Oracle RAC负载平衡建议，其中包含服务级别目标。连接负载平衡目标应设置为<code class="codeph">SHORT</code> ，例如：</p><pre class="pre codeblock"><code>srvctl修改服务-db <span class="variable" translate="no">db_unique_name</span> -service <span class="variable" translate="no">service_name</span> -rlbgoal SERVICE_TIME -clbgoal SHORT</code></pre></div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="workload-management-with-dynamic-database-services.html#GUID-5396E213-81D5-45AA-84C0-FA74D9CD24A4" title="您可以为通用连接池或隐式连接缓存启用FCF。">为JDBC / OCI和JDBC-Thin驱动程序客户端配置FCF</a></li>
                           <li><a href="../jjucp/fast-connection-failover.html#JJUCP-GUID-126F8C9B-C0B3-426B-B07D-4B127BBDD867" target="_blank"><span><cite>Oracle通用连接池开发人员指南</cite></span></a></li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RACAD8430"></a><a id="RACAD8429"></a><div class="sect3"><a id="GUID-CBD1ABAA-34B4-4486-BB8B-111BDA7FE44A" name="GUID-CBD1ABAA-34B4-4486-BB8B-111BDA7FE44A"></a><h4 id="RACAD-GUID-CBD1ABAA-34B4-4486-BB8B-111BDA7FE44A" class="sect4">为Java的应用程序连续性配置JDBC瘦客户端</h4>
                  <div>
                     <p>重播数据源（ <code class="codeph">oracle.jdbc.replay.OracleDataSource</code> ）是Application Continuity对Java要求的JDBC瘦数据源。
                     </p>
                     <p>此数据源充当连接工厂，为通用连接池和Oracle WebLogic Server Active GridLink for Oracle RAC数据源生成新的物理JDBC连接。该JDBC驱动程序重播保持通话的历史与Oracle数据库<span class="italic">12c</span>中与客户的对话过程中，在与Oracle数据库的合作。在数据库指导下丢失数据库服务（计划内或计划外）导致会话中断后，JDBC重放驱动程序尝试重建非事务性和事务性数据库会话状态，以便中断显示为延迟执行。
                     </p>
                     <p>要使用Application Continuity for Java和JDBC重放驱动程序，必须使用Oracle Database 12 <span class="italic">c</span>客户端并连接到Oracle Database 12 <span class="italic">c</span>数据库。以下配置支持Java的应用程序连续性：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>使用Oracle JDBC Replay数据源并且既不使用通用连接池也不使用Oracle WebLogic Server Active GridLink的JDBC应用程序 - 典型的第三方，基于JDBC的连接池</p>
                        </li>
                        <li>
                           <p>使用通用连接池数据源的JDBC应用程序 - 配置为使用通用连接池数据源的独立或第三方应用程序服务器</p>
                        </li>
                        <li>
                           <p>仅使用Oracle WebLogic Server Active GridLink但不使用Universal Connection Pool数据源的JDBC应用程序 - 典型的Oracle WebLogic Server J2EE案例</p>
                        </li>
                     </ul>
                     <div class="section">
                        <p class="subhead3" id="GUID-CBD1ABAA-34B4-4486-BB8B-111BDA7FE44A__GUID-3FA235E0-CC7B-4491-8A35-654CBAFE41A4">要配置JDBC瘦客户机以使用JDBC重放驱动程序：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li>
                           <p>确保您使用的是经过重播认证的应用程序。</p>
                        </li>
                        <li>
                           <p>使用SRVCTL创建供应用程序使用的服务（如果尚不存在）。对于此服务，将<code class="codeph">-failovertype</code>参数设置为<code class="codeph">TRANSACTION</code> ，并将<code class="codeph">-commit_outcome</code>参数设置为<code class="codeph">TRUE</code> 。
                           </p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">PoolDataSource</code>对象配置连接元素，如以下示例所示：</p><pre class="pre codeblock"><code>PoolDataSource rds = PoolDataSourceFactory.getPoolDataSource（）; rds.setConnnectionPoolName（ “replayExample”）; rds.setONSConfiguration（ “节点= racnode1：4200，racnode2：4200”）; rds.setFastConnectionFailoverEnabled（真）; rds.setConnectionFactoryClassName（“oracle.jdbc.replay。OracleDataSourceImpl“）; Connection conn = rds.getConnection（）;</code></pre></li>
                        <li>
                           <p>连接到数据库时，请使用可以访问提供服务的所有实例的URL。</p>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="ensuring-application-continuity.html#GUID-BD699AEB-9F85-42A8-8687-5A979918938D" title="应用程序连续性通过还原数据库会话从应用程序和用户屏蔽许多可恢复的数据库中断（当重放成功时）：完整会话，包括所有状态，游标，变量和最后一个事务（如果有）。">关于应用程序连续性</a></li>
                           <li><a href="workload-management-with-dynamic-database-services.html#GUID-87EDF90F-1776-474A-AD9C-93F9CBE6CB31" title="要为Application Continuity配置服务，在使用SRVCTL创建服务时，请将-failovertype参数设置为TRANSACTION，并将-commit_outcome设置为TRUE。">为应用程序连续性和事务防护创建服务</a></li>
                           <li><a href="workload-management-with-dynamic-database-services.html#GUID-5396E213-81D5-45AA-84C0-FA74D9CD24A4" title="您可以为通用连接池或隐式连接缓存启用FCF。">为JDBC / OCI和JDBC-Thin驱动程序客户端配置FCF</a></li>
                           <li><a href="../jjdbc/application-continuity.html#JJDBC-GUID-AAC6F9B7-9B4C-4098-B0D5-312BF9A13928" target="_blank"><span><cite>Oracle数据库JDBC开发人员指南</cite></span></a></li>
                           <li><a href="../jjucp/intro.html#JJUCP-GUID-82ACD002-4C5F-4BF7-99FF-46A2A97DD35D" target="_blank"><span><cite>Oracle通用连接池开发人员指南</cite></span></a></li>
                        </ul>
                     </div>
                     <div class="infoboxnotealso" id="GUID-CBD1ABAA-34B4-4486-BB8B-111BDA7FE44A__GUID-39DCAB9F-6154-477F-8B2B-B74B7C1082B1">
                        <p class="notep1">也可以看看：</p>
                        <p>有关在不启用应用程序连续性的情况下配置Transaction Guard的信息，请<span><cite>参见“Oracle数据库JDBC开发人员指南</cite></span></p>
                     </div>
                  </div>
               </div><a id="RACAD8431"></a><div class="sect3"><a id="GUID-F94A5DDE-4E87-4C6B-9DBB-1702E706B2D9" name="GUID-F94A5DDE-4E87-4C6B-9DBB-1702E706B2D9"></a><h4 id="RACAD-GUID-F94A5DDE-4E87-4C6B-9DBB-1702E706B2D9" class="sect4">为Transaction Guard配置JDBC瘦客户端</h4>
                  <div>
                     <p>Transaction Guard为应用程序提供协议和通用工具，以便在计划内和计划外中断时最多执行一次。</p>
                     <p>应用程序使用逻辑事务ID来确定中断后数据库会话中打开的最后一个事务的结果。如果没有Transaction Guard，最终用户或尝试在中断后重试操作的应用程序可能会通过提交重复事务或无序提交事务而导致逻辑损坏。</p>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="../jjdbc/application-continuity.html#JJDBC-GUID-AAC6F9B7-9B4C-4098-B0D5-312BF9A13928" target="_blank"><span><cite>Oracle数据库JDBC开发人员指南</cite></span></a></li>
                           <li><a href="../adfns/transaction-guard.html#ADFNS-GUID-6C5880E5-C45F-4858-A069-A28BB25FD1DB" target="_blank"><span><cite>Oracle数据库开发指南</cite></span></a></li>
                           <li><a href="../lnoci/high-availability-in-oci.html#LNOCI-GUID-6A12DE3A-479A-4D06-8305-AA450BFF6B23" target="_blank"><span><cite>Oracle调用接口程序员指南</cite></span></a></li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RACAD8285"></a><a id="RACAD7307"></a><div class="sect3"><a id="GUID-C9BDC6E3-16A6-4175-8B0B-E15DFD07466E" name="GUID-C9BDC6E3-16A6-4175-8B0B-E15DFD07466E"></a><h4 id="RACAD-GUID-C9BDC6E3-16A6-4175-8B0B-E15DFD07466E" class="sect4">启用OCI客户端以实现快速连接故障转移</h4>
                  <div>
                     <p>OCI客户端可以通过注册接收Oracle RAC高可用性FAN事件的通知并在事件发生时进行响应来启用FCF。使用FCF可以改善OCI应用程序中的会话故障转移响应时间，还可以从连接和会话池中删除与非功能实例的连接。FCF可用于也使用TAF，OCI驱动程序（包括您自己的连接池），OCI连接池和OCI会话池的OCI应用程序。FAN通过Oracle Notification Service发布，用于高可用性和负载平衡事件。</p>
                     <p>要使用FCF，您必须使用启用了FAN的服务。FAN通过Oracle Notification Service发布。客户端应用程序还可以注册在事件发生时使用的回调。这减少了检测连接失败所需的时间。</p>
                     <p>在<code class="codeph">DOWN</code>事件处理期间，OCI：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>终止客户端上受影响的连接并返回错误</p>
                        </li>
                        <li>
                           <p>从OCI连接池和OCI会话池中删除连接 - 会话池将每个会话映射到连接池中的物理连接，并且每个连接可以有多个会话</p>
                        </li>
                        <li>
                           <p>如果已配置TAF，则无法通过连接。如果未配置TAF，则客户端仅在连接的实例失败时才会收到错误。</p>
                        </li>
                     </ul>
                     <p>如果您的应用程序使用TAF，则必须使用SRVCTL或Oracle Enterprise Manager为服务启用TAF属性。配置OCI客户端应用程序以使用配置的服务连接到Oracle RAC数据库。</p>
                     <div class="infoboxnote" id="GUID-C9BDC6E3-16A6-4175-8B0B-E15DFD07466E__GUID-6B4A007E-FDF1-4DCC-8912-8E083A22E1E0">
                        <p class="notep1">注意：</p>
                        <p>OCI不管理<code class="codeph">UP</code>事件。
                        </p>
                     </div>
                     <div class="section">
                        <p class="subhead3" id="GUID-C9BDC6E3-16A6-4175-8B0B-E15DFD07466E__GUID-B1EE69A9-A88A-469E-8761-E7348390F0EC">为OCI客户端配置FCF</p>
                     </div>
                     <!-- class="section" -->
                     <p>OCI应用程序必须连接到Oracle RAC实例才能启用HA事件通知。此外，这些应用程序必须执行以下步骤为OCI客户端配置FCF：</p>
                     <ol>
                        <li>
                           <p>配置OCI连接池的服务以启用FAN，连接负载平衡和运行时连接负载平衡，如以下示例所示：</p><pre class="pre codeblock"><code>$ srvctl修改服务-db crm -service ociapp.example.com -notification TRUE</code></pre></li>
                        <li>
                           <p>将应用程序与线程库链接。</p>
                        </li>
                        <li>
                           <p>在与线程库链接之后，应用程序可以注册每当发生FAN事件时调用的回调。</p>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="../netag/enabling-advanced-features.html#NETAG-GUID-8F532535-C401-4B51-BE0B-04FD74BB0621" target="_blank"><span><cite>Oracle数据库网络服务管理员指南</cite></span></a></li>
                           <li><a href="../lnoci/introduction.html#LNOCI-GUID-27645179-6957-4004-8BB8-38775266B038" target="_blank"><span><cite>Oracle调用接口程序员指南</cite></span></a></li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RACAD8286"></a><a id="RACAD7308"></a><div class="sect3"><a id="GUID-AEEE07D0-057A-4617-A716-9957D98B593D" name="GUID-AEEE07D0-057A-4617-A716-9957D98B593D"></a><h4 id="RACAD-GUID-AEEE07D0-057A-4617-A716-9957D98B593D" class="sect4">为运行时连接负载平衡启用OCI客户端</h4>
                  <div>
                     <p>如Oracle数据库<span class="italic">12c</span>中的，OCI会话池使应用程序能够使用动态管理组预先创建的数据库会话的多个线程。
                     </p>
                     <p>在连接池中，池元素是一个连接，但在会话池中，池元素是一个会话。Oracle数据库不断重用会话池中的会话，以形成几乎永久的实例通道，从而节省了每次应用程序需要时创建和关闭会话的开销。</p>
                     <p>默认情况下，Oracle Database <span class="italic">11g</span>发行版11.1或更高版本中的客户端与Oracle数据库<span class="italic">10g</span> 10.2版或更高版本的服务器通信时启用运行时连接负载平衡。对于Oracle RAC环境，会话池使用从Oracle RAC负载平衡通报<a id="fn_1" name="fn_1" href="#fn_1" run-time="" connection="" load="" balancing="" is="" basically="" routing="" work="" requests="" to="" sessions="" in="" a="" session="" pool="" that="" can="" best="" serve="" the="" work.="" it="" comes="" into="" effect="" when="" selecting="" from="" an="" existing="" pool.="" thus,="" very="" frequent="" activity=")" ="" onclick="footdisplay(1, "><sup>Foot 1</sup></a>到Fast Application Notification（FAN）事件接收的服务指标来平衡应用程序会话请求。进入会话池的工作请求可以使用当前服务性能分布在提供服务的Oracle RAC实例中。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-AEEE07D0-057A-4617-A716-9957D98B593D__GUID-E1920701-C318-4A73-94A4-78B0A170D60A">配置OCI客户端以接收负载平衡咨询FAN事件</p>
                     </div>
                     <!-- class="section" -->
                     <p>对于Oracle RAC环境，会话池使用通过快速应用程序通知（FAN）事件从Oracle RAC负载平衡通报接收的服务指标来平衡应用程序会话请求。要使应用程序能够根据服务时间接收服务度量标准，请确保为所使用的服务配置FAN，负载平衡顾问目标（ <code class="codeph">-rlbgoal</code>参数）和连接负载平衡目标（ <code class="codeph">-clbgoal</code>参数）。会话池，如以下示例所示：</p><pre class="pre codeblock"><code>$ srvctl modify service -db crm -service ociapp.example.com -rlbgoal SERVICE_TIME -clbgoal SHORT -notification TRUE</code></pre></div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="../lnoci/introduction.html#LNOCI-GUID-27645179-6957-4004-8BB8-38775266B038" target="_blank"><span><cite>Oracle调用接口程序员指南</cite></span></a></li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RACAD8432"></a><div class="sect3"><a id="GUID-DDD78F92-BC57-472A-9729-CEFDBFB32142" name="GUID-DDD78F92-BC57-472A-9729-CEFDBFB32142"></a><h4 id="RACAD-GUID-DDD78F92-BC57-472A-9729-CEFDBFB32142" class="sect4">配置OCI客户端以使用Transaction Guard</h4>
                  <div>
                     <p>OCI支持FAN消息和Transaction Guard。FAN旨在快速通知基于OCI的应用程序在节点，数据库，实例，服务和公共网络级别的中断。</p>
                     <p>一旦通知失败，应用程序就可以利用Transaction Guard可靠地确定最后一次飞行中交易的结果。</p>
                     <p>Transaction Guard避免了导致用户沮丧，客户支持电话和丢失机会的模糊错误的成本。与已知结果的本地解决方案相比，事务处理保护更安全，性能更好，开销更低。</p>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="ensuring-application-continuity.html#GUID-EB0E1525-D3B3-469C-BE22-A569C76864A6" title="Oracle RAC高可用性框架监视数据库及其服务，并使用快速应用程序通知（FAN）发送事件通知。">快速申请通知</a></li>
                           <li><a href="workload-management-with-dynamic-database-services.html#GUID-074729CB-8A91-419C-A6E1-3B9E4FD8D869" title="FAN的总体目标是实现应用程序的端到端，无人值守恢复以及基于实际事务性能的负载平衡。为通用连接池和Oracle WebLogic Server启用快速连接故障转移（FCF）Active GridLink for Oracle RAC支持使用FAN HA和负载平衡咨询事件。您可以为通用连接池或隐式连接缓存启用FCF。运行时连接负载平衡需要使用Oracle JDBC驱动程序和Oracle RAC数据库。重播数据源（oracle.jdbc.replay。OracleDataSource）是Application Continuity对Java要求的JDBC瘦数据源。Transaction Guard为应用程序提供协议和通用工具，以便在计划内和计划外中断时最多执行一次。从Oracle Database 12c开始，OCI会话池使应用程序的多个线程能够使用动态管理的一组预先创建的数据库会话。OCI支持FAN消息和Transaction Guard。FAN旨在快速通知基于OCI的应用程序在节点，数据库，实例，服务和公共网络级别的中断。ODP.NET连接池可以订阅FAN HA通知，指示节点，服务和服务成员何时关闭。连接到Oracle Database 12c及更高版本时，ODP.NET使用Oracle Notification Service而不是Advanced Queuing。ODP.NET支持FAN消息和Transaction Guard。FAN旨在快速通知基于ODP.NET的应用程序在节点，数据库，实例，服务和公共网络级别的中断。">为Oracle RAC启用客户端</a></li>
                           <li><a href="../lnoci/user-defined-callback-functions.html#LNOCI-GUID-215B52BB-6769-4A53-A2DC-EDB36AE031B7" target="_blank"><span><cite>Oracle调用接口程序员指南</cite></span></a></li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RACAD7136"></a><div class="sect3"><a id="GUID-1A7346B1-AFE3-4B17-AD7E-E35FE628CDF9" name="GUID-1A7346B1-AFE3-4B17-AD7E-E35FE628CDF9"></a><h4 id="RACAD-GUID-1A7346B1-AFE3-4B17-AD7E-E35FE628CDF9" class="sect4">启用ODP.NET客户端以接收FAN高可用性事件</h4>
                  <div>
                     <p>ODP.NET连接池可以订阅FAN HA通知，指示节点，服务和服务成员何时关闭。</p>
                     <p>在<code class="codeph">DOWN</code>事件之后，Oracle数据库会清除连接池中转到该实例的会话，并且ODP.NET会主动删除不再有效的连接。如果删除无效连接，则ODP.NET会建立与现有Oracle RAC实例的其他连接，从而将连接总数减少到<code class="codeph">Min Pool Size</code>参数的值以下。
                     </p>
                     <p>当连接到Oracle数据库<span class="italic">12c</span>与后，ODP.NET使用Oracle通知服务，而不是高级队列。
                     </p>
                     <p>通过订阅FAN高可用性事件为ODP.NET连接池启用快速连接故障转移。要启用快速连接故障转移，请在连接字符串中包含“ <code class="codeph">HA Events=true</code> ”和“ <code class="codeph">pooling=true</code> ”（默认值），如以下示例所示，其中<code class="codeph"><span class="variable" translate="no">user_name</span></code>是数据库用户的名称， <code class="codeph"><span class="variable" translate="no">password</span></code>是密码那个用户：</p><pre class="pre codeblock"><code>CON。ConnectionString =“User Id = <span class="variable" translate="no">user_name</span> ; Password = <span class="variable" translate="no">password</span> ; Data Source = odpnet;” +“最小池大小= 10;连接生存期= 120;连接超时= 60;” +“HA Events = true; Incr Pool Size = 5; Decr Pool Size = 2”;</code></pre></div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/racad&amp;id=ODPNT-GUID-0CFEB161-68EF-4BC2-8943-3BDFFB878602" target="_blank"><span><cite>适用于Microsoft Windows的Oracle数据提供程序开发人员指南</cite></span></a></li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RACAD7309"></a><div class="sect3"><a id="GUID-D779F756-F8EA-4BEF-8A54-94395B6B9AF6" name="GUID-D779F756-F8EA-4BEF-8A54-94395B6B9AF6"></a><h4 id="RACAD-GUID-D779F756-F8EA-4BEF-8A54-94395B6B9AF6" class="sect4">使ODP.NET客户端能够接收FAN负载平衡咨询事件</h4>
                  <div>
                     <p>当连接到Oracle数据库<span class="italic">12c</span>与后，ODP.NET使用Oracle通知服务，而不是高级队列。
                     </p>
                     <p>使用以下过程使ODP.NET客户端或应用程序能够接收FAN负载平衡顾问事件：</p>
                     <ol>
                        <li>
                           <p>使用SRVCTL启用Oracle Notification Service通知，并设置运行时负载平衡目标，如以下示例所示：</p><pre class="pre codeblock"><code>$ srvctl修改服务-db crm -service odpapp.example.com -notification TRUE -clbgoal LONG -rlbgoal SERVICE_TIME</code></pre></li>
                        <li>
                           <p>确保为FAN事件配置Oracle Notification Service（ONS），包括运行时负载平衡建议。</p>
                        </li>
                        <li>
                           <p>要利用ODP.NET连接池的负载平衡事件，请将ConnectionString中的负载平衡属性设置为<code class="codeph">TRUE</code> （默认值为<code class="codeph">FALSE</code> ）。您可以在连接时执行此操作。这仅在您使用连接池时，或者池属性设置为<code class="codeph">TRUE</code> （默认值）时才有效。
                           </p>
                           <p>以下示例演示如何配置ConnectionString以启用负载平衡，其中<code class="codeph"><span class="variable" translate="no">user_name</span></code>是用户的名称， <code class="codeph"><span class="variable" translate="no">password</span></code>是密码：</p><pre class="pre codeblock"><code>CON。ConnectionString =“User Id = <span class="variable" translate="no">user_name</span> ; Password = <span class="variable" translate="no">password</span> ; Data Source = odpapp;” +“最小池大小= 10;连接生存期= 120;连接超时= 60;” +“负载平衡=真; Incr池大小= 5; Decr池大小= 2”;</code></pre></li>
                     </ol>
                     <div class="infoboxnote" id="GUID-D779F756-F8EA-4BEF-8A54-94395B6B9AF6__GUID-E7E2658B-F504-433F-855C-B4B9489AC09A">
                        <p class="notep1">注意：</p>
                        <p>ODP.NET在节点启动时不支持连接重新分发（UP事件）。但是，如果您在服务器端启用了故障转移，则ODP.NET可以将连接迁移到新的可用实例。</p>
                     </div>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="server-control-utility-reference.html#GUID-DCA45A3F-78AD-4259-A8C3-8FCE49A0F4BC" title="修改服务配置。">srvctl修改服务</a></li>
                           <li><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/racad&amp;id=ODPNT-GUID-0CFEB161-68EF-4BC2-8943-3BDFFB878602" target="_blank"><span><cite>适用于Microsoft Windows的Oracle数据提供程序开发人员指南</cite></span></a></li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RACAD8434"></a><div class="sect3"><a id="GUID-34DB264E-3210-4C79-A104-AE0AAF269CDF" name="GUID-34DB264E-3210-4C79-A104-AE0AAF269CDF"></a><h4 id="RACAD-GUID-34DB264E-3210-4C79-A104-AE0AAF269CDF" class="sect4">配置ODP.NET客户端以使用Transaction Guard</h4>
                  <div>
                     <p>ODP.NET支持FAN消息和Transaction Guard。FAN旨在快速通知基于ODP.NET的应用程序在节点，数据库，实例，服务和公共网络级别的中断。</p>
                     <p>一旦通知失败，应用程序就可以利用Transaction Guard可靠地确定最后一次飞行中交易的结果。</p>
                     <p>Transaction Guard避免了导致用户沮丧，客户支持电话和丢失机会的模糊错误的成本。与已知结果的本地解决方案相比，事务处理保护更安全，性能更好，开销更低。</p>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="ensuring-application-continuity.html#GUID-EB0E1525-D3B3-469C-BE22-A569C76864A6" title="Oracle RAC高可用性框架监视数据库及其服务，并使用快速应用程序通知（FAN）发送事件通知。">快速申请通知</a></li>
                           <li><a href="workload-management-with-dynamic-database-services.html#GUID-2678C005-1B70-4B88-90E0-174A324F7DAA" title="在创建和管理服务时，您将数据库执行的工作划分为可管理的单元。Cluster Managed Database Services页面是用于开始与服务相关的所有任务的母版页。使用SRVCTL创建服务时，必须使用单独的SRVCTL命令启动该服务。要使用SRVCTL创建服务，请在命令行上使用srvctl add service命令。要为Application Continuity配置服务，在使用SRVCTL创建服务时，请将-failovertype参数设置为TRANSACTION，并将-commit_outcome设置为TRUE。">管理服务</a></li>
                           <li><a href="workload-management-with-dynamic-database-services.html#GUID-87EDF90F-1776-474A-AD9C-93F9CBE6CB31" title="要为Application Continuity配置服务，在使用SRVCTL创建服务时，请将-failovertype参数设置为TRANSACTION，并将-commit_outcome设置为TRUE。">为应用程序连续性和事务防护创建服务</a></li>
                           <li><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/racad&amp;id=ODPNT-GUID-635BAE6C-7D0B-4CF2-ADD8-8DB531B9C52E" target="_blank"><span><cite>适用于Microsoft Windows的Oracle数据提供程序开发人员指南</cite></span></a></li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div><a id="RACAD7147"></a><div class="sect2"><a id="GUID-7948E56B-D455-4852-A3EF-20E4F59156A5" name="GUID-7948E56B-D455-4852-A3EF-20E4F59156A5"></a><h3 id="RACAD-GUID-7948E56B-D455-4852-A3EF-20E4F59156A5" class="sect3">Oracle RAC中的分布式事务处理</h3>
               <div>
                  <p></p>
                  <p>X / Open分布式事务处理（DTP）体系结构定义了一种标准体系结构或接口，使多个应用程序（AP）能够共享由多个（可能是不同的）资源管理器（RM）提供的资源。它协调AP和RM之间的工作进入全局事务。</p>
                  <p>以下部分讨论Oracle RAC如何支持全局（XA）事务和DTP处理：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-73F9A0B6-E8E9-4759-8452-BB38615A5877" title="默认情况下，全局（XA）事务可以跨越Oracle RAC实例，允许使用Oracle XA库的任何应用程序充分利用Oracle RAC环境来增强应用程序的可用性和可伸缩性。">XA事务和Oracle RAC概述</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-CA948449-B4E1-40C0-80A4-1CE7827E5295" title="要通过Oracle RAC中的分布式事务处理（DTP）提供更高的应用程序性能，您可以利用XA关联性。">使用全局事务和XA亲和力进行XA事务</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-31769276-FE2C-4331-B2F5-D4A4D77434F5" title="在Oracle RAC上使用XA的大多数应用程序可以使用由连接池或事务处理监视器提供的具有XA亲和性的统一或（所有首选）服务。">在Oracle RAC上使用带有XA事务的服务</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-7A9D0A41-015F-4830-9BBA-73CD06596059">配置XA应用程序的服务</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-26060D52-5988-4272-84B2-73E63D0469D1" title="从Oracle Real Application Clusters 11g第1版（11.1）开始，全局事务和XA关联取代了对分布式事务处理（DTP）服务的需求。">在管理员管理的数据库中重新定位服务</a></p>
                     </li>
                  </ul>
               </div><a id="RACAD8287"></a><div class="sect3"><a id="GUID-73F9A0B6-E8E9-4759-8452-BB38615A5877" name="GUID-73F9A0B6-E8E9-4759-8452-BB38615A5877"></a><h4 id="RACAD-GUID-73F9A0B6-E8E9-4759-8452-BB38615A5877" class="sect4">XA事务和Oracle RAC概述</h4>
                  <div>
                     <p>默认情况下，全局（XA）事务可以跨越Oracle RAC实例，允许使用Oracle XA库的任何应用程序充分利用Oracle RAC环境来增强应用程序的可用性和可伸缩性。</p>
                     <p>GTX <span class="italic">n</span>后台进程支持Oracle RAC环境中的XA事务。<code class="codeph">GLOBAL_TXN_PROCESSES</code>初始化参数（默认设置为<code class="codeph">1</code>指定每个Oracle RAC实例的初始GTX <span class="italic">n</span>后台进程数。使用此参数clusterwide的默认值允许分布式事务跨越多个Oracle RAC实例。使用默认值允许跨这些Oracle RAC实例执行的工作单元共享资源并充当单个事务（即，工作单元<span class="italic">紧密耦合</span> ）。它还允许将2PC请求发送到群集中的任何节点。
                     </p>
                     <p>在Oracle RAC <span class="italic">11g第</span> 1版（11.1）之前，在Oracle RAC中实现紧耦合的方法是使用分布式事务处理（DTP）服务，即基数（一）确保所有紧密耦合的分支到达的服务。同一实例 - 无论是否启用了负载均衡。如果XA应用程序不在同一事务分支上使用suspend和resume，并且不发出跨越分支的保存点，则紧密耦合的XA事务不再需要在Oracle RAC数据库上部署特殊类型的单例服务。如果您的应用程序无法确定事务分支是否已被挂起和恢复，则应用程序必须继续使用DTP服务或最好使用XA关联。
                     </p>
                     <p>在挂起和恢复相同的XA分支或跨分支使用保存点时，XA亲缘关系（将同一XA事务的所有分支放在同一Oracle RAC实例中）是一项要求。它还提供了更好的性能，因为可以平衡不同的事务。Oracle WebLogic Server Active GridLink for Oracle RAC，JDBC通用连接池和Oracle Tuxedo可以使用XA亲缘关系。</p>
                     <div class="infoboxnote" id="GUID-73F9A0B6-E8E9-4759-8452-BB38615A5877__GUID-7C3BC022-3A4B-4AA2-8543-615A55144E3B">
                        <p class="notep1">注意：</p>
                        <p>有时，事务处理监视器继续需要XA亲缘关系或DTP服务，因为使用它们的应用程序会挂起并恢复相同的分支或使用保存点。</p>
                     </div>
                     <p>外部事务管理器（如Oracle Transaction for Microsoft Transaction Server（OraMTS））协调XA事务。但是，内部Oracle事务管理器协调分布式SQL事务。他们都可以使用单件服务或统一服务。Singleton服务提供XA亲和力，可以利用全局事务进行维护。</p>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="workload-management-with-dynamic-database-services.html#GUID-CA948449-B4E1-40C0-80A4-1CE7827E5295" title="要通过Oracle RAC中的分布式事务处理（DTP）提供更高的应用程序性能，您可以利用XA关联性。">使用全局事务和XA亲和力进行XA事务</a></li>
                           <li><a href="../refrn/GLOBAL_TXN_PROCESSES.html#REFRN-GUID-EDBA5E11-C2FB-4370-9CDC-A098D3951C7E" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RACAD8288"></a><div class="sect3"><a id="GUID-CA948449-B4E1-40C0-80A4-1CE7827E5295" name="GUID-CA948449-B4E1-40C0-80A4-1CE7827E5295"></a><h4 id="RACAD-GUID-CA948449-B4E1-40C0-80A4-1CE7827E5295" class="sect4">使用全局事务和XA亲和力进行XA事务</h4>
                  <div>
                     <p>要通过Oracle RAC中的分布式事务处理（DTP）提供更高的应用程序性能，您可以利用XA关联性。</p>
                     <p>使用XA关联，您可以将分布式事务的所有分支定向到集群中的单个实例。要实现XA关联，您可以使用提供XA关联的应用程序服务器，例如WebLogic Server和Universal Connection Pool。如果您的应用程序服务器没有XA关联，那么您还可以在Oracle RAC中使用单一服务。</p>
                     <p>应用程序服务器层上的连接池跨多个与Oracle RAC数据库的连接进行负载平衡，使用XA关联来确保全局分布式事务的所有紧密耦合的分支仅在一个Oracle RAC实例上运行。使用具有XA亲缘关系的连接池时，使用XA的服务可以跨越Oracle RAC。在使用X / Open Distributed Transaction Processing或Microsoft分布式事务处理协调器等协议的分布式事务环境中也是如此。</p>
                     <p>要增强分布式事务的性能，请使用服务来管理DTP环境。单个服务在Oracle RAC数据库中的一个Oracle RAC实例上运行。此服务仍允许耗费维护，因此具有比旧DTP服务更好的高可用性特征。要在群集之间进行负载平衡，最好有几组较小的应用程序服务器，每个组将其事务定向到单个服务或一组服务，而不是拥有一个或两个较大的应用程序服务器。使用单一服务，通过服务执行的全局分布式事务使其紧密耦合的分支在单个Oracle RAC实例上运行。这有以下好处：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>当紧密耦合的分支需要有关彼此所做更改的信息时，这些更改在一个Oracle RAC实例中可在本地获得</p>
                        </li>
                        <li>
                           <p>使用全局事务完全支持服务的重定位和故障转移</p>
                        </li>
                        <li>
                           <p>通过使用比Oracle RAC实例更多的单一服务，Oracle数据库可以平衡所有Oracle RAC数据库实例中的服务负载</p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-CA948449-B4E1-40C0-80A4-1CE7827E5295__GUID-D698C726-C61D-426F-8794-6AC0A396A89F">
                        <p class="notep1">注意：</p>如果应用程序挂起并恢复相同的XA分支，则需要DTP服务属性或XA亲缘关系。
                     </div>
                  </div>
               </div><a id="RACAD8289"></a><div class="sect3"><a id="GUID-31769276-FE2C-4331-B2F5-D4A4D77434F5" name="GUID-31769276-FE2C-4331-B2F5-D4A4D77434F5"></a><h4 id="RACAD-GUID-31769276-FE2C-4331-B2F5-D4A4D77434F5" class="sect4">在Oracle RAC上使用带有XA事务的服务</h4>
                  <div>
                     <p>在Oracle RAC上使用XA的大多数应用程序可以使用由连接池或事务处理监视器提供的具有XA亲和性的统一或（所有首选）服务。</p>
                     <p>应用程序还可以使用单例服务来提供XA亲和性。</p>
                     <p>使用单一服务时，要利用群集中的所有实例，请为承载分布式事务的每个Oracle RAC实例创建一个或多个单一服务。为应用程序服务器选择不同的服务，以平衡Oracle RAC数据库实例之间的工作负载。由于分布式事务的所有分支都在一个实例上，因此您可以利用所有实例通过多个单例服务来平衡许多分布式事务处理（DTP）事务的负载，从而最大化应用程序吞吐量。</p>
                     <p>如果从群集数据库添加或删除节点，则可能必须识别和重定位服务，以确保保持最佳性能级别。使用单件服务，可以完成当前的工作。如果使用DTP服务，则中止当前工作。</p>
                     <p>您只需要为暂停和恢复同一分支的XA应用程序使用DTP服务。当您使用DTP时，同样的方法适用于单身人士，但在重新定位服务时您无法消耗工作。</p>
                  </div>
               </div><a id="RACAD969"></a><div class="sect3"><a id="GUID-7A9D0A41-015F-4830-9BBA-73CD06596059" name="GUID-7A9D0A41-015F-4830-9BBA-73CD06596059"></a><h4 id="RACAD-GUID-7A9D0A41-015F-4830-9BBA-73CD06596059" class="sect4">配置XA应用程序的服务</h4>
                  <div>
                     <p>要为分布式事务处理创建分布式事务处理（DTP）服务，请执行以下步骤：</p>
                     <ol>
                        <li>
                           <p>使用Oracle Enterprise Manager或SRVCTL创建单一服务。</p>
                           <p>对于管理员管理的数据库，仅将一个实例定义为首选实例。您可以根据需要拥有尽可能多的可用实例，例如：</p><pre class="pre codeblock"><code>$ srvctl add service -db crm -service xa_01.example.com -preferred RAC01 -available RAC02，RAC03</code></pre><p>对于策略管理的数据库，请指定要使用的服务器池，并将服务的基数设置为<code class="codeph">SINGLETON</code> ，例如：</p><pre class="pre codeblock"><code>$ srvctl add service -db crm -service xa_01.example.com -serverpool dtp_pool -cardinality SINGLETON</code></pre></li>
                        <li>
                           <p>将服务的DTP参数（ <code class="codeph">-dtp</code> ）设置为<code class="codeph">TRUE</code> （默认值为<code class="codeph">FALSE)</code> 。您可以使用Oracle Enterprise Manager或SRVCTL来修改单件服务的DTP属性。以下示例显示如何使用SRVCTL修改<code class="codeph">xa_01.example.com</code>服务：</p><pre class="pre codeblock"><code>$ srvctl modify service -db crm -service xa_01.example.com -dtp TRUE</code></pre><div class="infoboxnote" id="GUID-7A9D0A41-015F-4830-9BBA-73CD06596059__GUID-1643B33E-550D-4789-9CA1-1CB6B20595C3">
                              <p class="notep1">注意：</p>如果应用程序确实需要DTP服务，则使用<code class="codeph">-dtp</code>参数。如果没有，则使用前面的示例，不带<code class="codeph">-dtp</code>参数。
                           </div>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="server-control-utility-reference.html#GUID-EC1BA6D7-D538-4E11-9B31-C59389FDF93B" title="将服务添加到数据库并将其分配给实例。">srvctl添加服务</a></li>
                           <li><a href="server-control-utility-reference.html#GUID-DCA45A3F-78AD-4259-A8C3-8FCE49A0F4BC" title="修改服务配置。">srvctl修改服务</a></li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RACAD8290"></a><div class="sect3"><a id="GUID-26060D52-5988-4272-84B2-73E63D0469D1" name="GUID-26060D52-5988-4272-84B2-73E63D0469D1"></a><h4 id="RACAD-GUID-26060D52-5988-4272-84B2-73E63D0469D1" class="sect4">在管理员管理的数据库中重新定位服务</h4>
                  <div>
                     <p>从Oracle Real Application Clusters <span class="italic">11g第</span> 1版（11.1）开始，全局事务和XA关联取代了对分布式事务处理（DTP）服务的需求。
                     </p>
                     <p>大多数XA部署应该使用具有XA亲和性的全局事务来提高负载平衡和灵活性，而不是DTP属性。</p>
                     <p>如果提供DTP服务的实例（例如<code class="codeph">XA_01</code> ）失败，则服务将以与任何其他服务相同的方式进行故障转移。但是，由于要求会话只存在于一个实例上，因此数据库会话的<code class="codeph">-f</code> （强制终止）选项始终适用。
                     </p>
                     <p>如果服务迁移到其他实例，则可能必须在重新启动服务后强制将服务重新定位到首选实例，以均匀地重新平衡所有可用硬件上的负载。您可以使用<code class="codeph">GV$ACTIVE_SERVICES</code>视图中的数据来确定是否需要重定位DTP服务。
                     </p>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-1100990E-18BD-4C92-A0C7-3C08C40AAD14" name="GUID-1100990E-18BD-4C92-A0C7-3C08C40AAD14"></a><h3 id="RACAD-GUID-1100990E-18BD-4C92-A0C7-3C08C40AAD14" class="sect3">Oracle RAC Sharding</h3>
               <div>
                  <p>Oracle RAC Sharding在表分区和Oracle RAC实例之间创建关联，并将指定分区键的数据库请求路由到逻辑上保存相应分区的实例。</p>
                  <p>Oracle将数据库请求路由到Oracle RAC实例，使得每个实例始终获取对数据库中不相交的行子集的请求，这会创建行与实例的亲缘关系。由于改进了缓存局部性并减少了节点间同步和块ping，因此亲和性可提高Oracle RAC性能和可伸缩性。</p>
                  <p>对Oracle RAC关联进行分片使用客户端和服务器端对基于密钥的路由的支持，这是Oracle数据库分片的一部分。使用与Oracle连接池（例如Universal Connection Pool，OCI）中的分片支持相同的API为数据库提供分片密钥的应用程序，与分片的方式相同，利用基于密钥的路由，并通过这样做可以启用Oracle RAC关联。</p>
                  <div class="p">提供分片键所需的应用程序更改不必影响应用程序的所有模块。更改只能应用于一些经常执行的数据库请求。不在连接字符串中提供分片键的请求将根据负载平衡策略进行路由。无密钥请求对数据亲和性没有任何负面影响，因为数据对象明确地为实例分配主控权。
                     <div class="infoboxnote" id="GUID-1100990E-18BD-4C92-A0C7-3C08C40AAD14__GUID-DBCCD176-1C04-49B5-8CDF-BC6EE2359FE2">
                        <p class="notep1">注意：</p>Oracle仅支持分区表的Oracle RAC关联。您可以使用任何支持的方法对表进行分区，而无需更改数据库模式以启用此功能，然后运行<code class="codeph">ALTER SYSTEM ENABLE AFFINITY</code>命令。
                     </div>
                  </div>
                  <p>如果要对应用程序进行更改以利用启用关联性的路由，那么当数据分布在多个独立数据库中时，您还可以利用分片。如果需要极高的可伸缩性或故障隔离，您可以稍后转移到分布式分片。</p>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="../sqlrf/ALTER-SYSTEM.html#SQLRF-GUID-2C638517-D73A-41CA-9D8E-A62D1A0B7ADB" target="_blank"><span><cite>Oracle数据库SQL语言参考</cite></span></a></li>
                        <li><a href="../netag/optimizing-performance.html#NETAG-GUID-5EC77A57-1DD5-49E7-85E6-5ABE57B18803" target="_blank"><span><cite>Oracle数据库网络服务管理员指南</cite></span></a></li>
                        <li><a href="../shard/sharding-overview.html#SHARD-GUID-3D41F762-BE04-486D-8018-C7A210D809F9" target="_blank"><span><cite>使用Oracle Sharding</cite></span></a></li>
                        <li><a href="../jjdbc/database-sharding.html#JJDBC-GUID-1D7795CA-79DC-452B-9FCC-0EF430F87461" target="_blank"><span><cite>Oracle数据库JDBC开发人员指南</cite></span></a></li>
                        <li><a href="../lnoci/oci-interface-for-using-shards.html#LNOCI-GUID-C64136C2-CF65-4507-8811-9A03946CC817" target="_blank"><span><cite>Oracle调用接口程序员指南</cite></span></a></li>
                     </ul>
                  </div>
               </div>
            </div><a id="RACAD951"></a><div class="sect2"><a id="GUID-C3CD2DCE-38BD-46BA-BC32-7A28CAC9A7FD" name="GUID-C3CD2DCE-38BD-46BA-BC32-7A28CAC9A7FD"></a><h3 id="RACAD-GUID-C3CD2DCE-38BD-46BA-BC32-7A28CAC9A7FD" class="sect3">自动工作负载存储库</h3>
               <div>
                  <p>自动工作负载存储库（AWR）收集，处理和维护数据库的性能统计信息。</p>
                  <p>收集的数据可以显示在报告和视图中。如果您在数据库中使用服务，则AWR会在服务级别跟踪<a href="glossary.html#GUID-3C591280-F8D5-4979-8134-152C2DF66F2F"><span class="xrefglossterm">度量标准</span></a> 。
                  </p>
                  <p>度量标准可以针对各种单位进行衡量，包括时间，事务或数据库调用。例如，每秒数据库调用的数量是一个度量。当服务器生成的警报超过或未达到用户指定的阈值时，可以将这些警报置于这些指标上。然后，数据库或系统管理员可以响应，例如：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>使用Oracle数据库资源管理器将一个服务的服务级别配置为具有相对于其他服务的优先级</p>
                     </li>
                     <li>
                        <p>停止重载的进程</p>
                     </li>
                     <li>
                        <p>修改服务级别要求</p>
                     </li>
                     <li>
                        <p>实施恢复方案以响应服务质量变化</p>
                     </li>
                  </ul>
                  <p>使用AWR指标和性能警报，您可以在服务级别更改的情况下保持持续的服务可用性。它还使您能够衡量数据库服务提供的服务质量。</p>
                  <p>AWR确保Oracle Clusterware工作负载管理框架和数据库资源管理器具有性能数据的持久和全局表示。此信息有助于Oracle数据库按服务计划作业类，并为使用者组分配优先级。如有必要，您可以使用Oracle Enterprise Manager或SRVCTL手动重新平衡工作负载。您还可以断开一系列会话，但保持服务正常运行。</p>
                  <div class="infoboxnote" id="GUID-C3CD2DCE-38BD-46BA-BC32-7A28CAC9A7FD__GUID-16934B29-63E3-4194-B497-6657487299B5">
                     <p class="notep1">注意：</p>
                     <p>Oracle建议<span class="italic">不要</span>使用DBMS_SERVICE包与Oracle RAC数据库使用的服务一起使用。使用SRVCTL或Oracle Enterprise Manager为Oracle RAC创建数据库服务。</p>
                  </div>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="../tdppt/resolving-performance-degradation-over-time.html#TDPPT-GUID-2831079F-326B-4F10-8B4F-D90DC0FDE270" target="_blank"><span><cite>Oracle数据库2天+性能调优指南</cite></span></a></li>
                        <li><a href="../tgdba/comparing-database-performance-over-time.html#TGDBA-GUID-BEDBF986-1A69-459A-90F5-350B8A407516" target="_blank"><span><cite>Oracle数据库性能调整指南</cite></span></a></li>
                        <li><a href="../arpls/DBMS_SERVICE.html#ARPLS-GUID-C11449DC-EEDE-4BB8-9D2C-0A45198C1928" target="_blank"><span><cite>Oracle数据库PL / SQL包和类型参考</cite></span></a></li>
                     </ul>
                  </div>
               </div>
            </div><a id="RACAD7127"></a><div class="sect2"><a id="GUID-559FB230-857B-4D97-B36A-F4F76C3A1D47" name="GUID-559FB230-857B-4D97-B36A-F4F76C3A1D47"></a><h3 id="RACAD-GUID-559FB230-857B-4D97-B36A-F4F76C3A1D47" class="sect3">使用自动工作负载存储库按服务测量性能</h3>
               <div>
                  <p>服务为性能调优添加了新维度，因为工作负载是可见且可测量的，因此资源消耗和等待时间可归因于应用程序。</p>
                  <p>在所有会话都是匿名和共享的大多数系统中，使用“服务和SQL”进行调优将取代“会话和SQL”调优。</p>
                  <p>AWR维护性能统计信息，其中包括有关数据库执行的所有服务和工作的响应时间，吞吐量，资源消耗和等待事件的信息。Oracle数据库还维护服务的度量标准，统计信息，等待事件，等待类和SQL级跟踪。您可以选择通过在应用程序中定义模块来监视某些统计信息来扩充这些统计信息。您还可以定义业务关键事务应响应特定统计值执行的那些模块中的操作。</p>
                  <p>使用<code class="codeph">DBMS_MONITOR</code> PL / SQL包启用模块和操作监视。例如，对于使用<code class="codeph">erp</code>服务的连接，以下命令可以监视<code class="codeph">payroll</code>模块中的<code class="codeph">exceptions pay</code>操作：</p><pre class="pre codeblock"><code>EXECUTE DBMS_MONITOR.SERV_MOD_ACT_STAT_ENABLE（SERVICE_NAME =&gt;'ERP'，MODULE_NAME =&gt;'PAYROLL'，ACTION_NAME =&gt;'EXCEPTIONS PAY'）;</code></pre><p>对于使用<code class="codeph">erp</code>服务的连接，以下命令可以监视<code class="codeph">payroll</code>模块中的所有操作：</p><pre class="pre codeblock"><code>EXECUTE DBMS_MONITOR.SERV_MOD_ACT_STAT_ENABLE（SERVICE_NAME =&gt;'ERP'，MODULE_NAME =&gt;'PAYROLL'，ACTION_NAME =&gt; NULL）;</code></pre><p>使用<code class="codeph">DBA_ENABLED_AGGREGATIONS</code>视图验证是否已启用对应用程序模块和操作的监视。
                  </p>
                  <p>按服务进行的统计信息聚合和跟踪是Oracle RAC数据库的全局范围。此外，这些统计聚合在Oracle RAC和非群集Oracle数据库的实例重新启动和服务重定位之间保持不变。</p>
                  <p>服务，模块和操作名称在<code class="codeph">V$SESSION</code> ， <code class="codeph">V$ACTIVE_SESSION_HISTORY</code>和<code class="codeph">V$SQL</code>视图中可见。呼叫时间和性能统计信息在<code class="codeph">V$SERVICE_STATS</code> ， <code class="codeph">V$SERVICE_EVENT</code> ， <code class="codeph">V$SERVICE_WAIT_CLASS</code> ， <code class="codeph">V$SERVICEMETRIC</code>和<code class="codeph">V$SERVICEMETRIC_HISTORY</code>中可见。为重要事务启用统计信息收集时，可以使用<code class="codeph">V$SERV_MOD_ACT_STATS</code>视图查看每个数据库实例的每个服务，模块和操作名称的调用速度。
                  </p>
                  <p>以下示例SQL * Plus脚本提供五秒间隔的服务质量统计信息。您可以使用这些服务质量统计信息来监视服务质量，指导工作以及跨Oracle RAC实例平衡服务：</p><pre class="pre codeblock"><code>SET PAGESIZE 60 COLSEP'|' NUMWIDTH 8 LINESIZE 132验证反馈关闭列service_name格式A20截断标题'服务'列开始时间标题'开始时间'格式A10列END_time标题'结束时间'格式A10列实例名称标题'实例'格式A10列服务_时间标题'服务时间| mSec / Call'FORMAT 999999999 COLUMN throughput HEADING'Calls / sec'FORMAT 99.99 BREAK ON service_name SKIP 1 SELECT service_name，TO_CHAR（begin_time，'HH：MI：SS'）begin_time，TO_CHAR（end_time，'HH：MI：SS'） end_time，instance_name，elapsedpercall service_time，callspersec throughput FROM gv $ instance i，gv $ active_services s，gv $ servicemetric m WHERE s.inst_id = m.inst_id AND s.name_hash = m.service_name_hash AND i.inst_id = m.inst_id AND m .group_id = 10 ORDER BY service_name，i.inst_id，begin_time;</code></pre></div>
            </div><a id="RACAD7317"></a><div class="sect2"><a id="GUID-27E6E869-570C-4B01-BF49-C147744D0D7D" name="GUID-27E6E869-570C-4B01-BF49-C147744D0D7D"></a><h3 id="RACAD-GUID-27E6E869-570C-4B01-BF49-C147744D0D7D" class="sect3">自动工作负载存储库服务阈值和警报</h3>
               <div>
                  <p>服务水平<a id="d17899e7404" class="indexterm-anchor"></a><a id="d17899e7408" class="indexterm-anchor"></a>阈值使您能够将实际服务级别与所需的服务级别进行比较。这为交付或未能提供商定的服务级别提供了责任。最终目标是实现服务水平的可预测系统。没有要求以最小的资源消耗尽可能快地执行;要求是满足服务<span class="italic">质量</span> 。
                  </p>
                  <p>AWR允许您为每个服务显式指定两个性能阈值：调用的响应时间（ <code class="codeph">ELAPSED_TIME_PER_CALL</code> ）和调用的CPU时间（ <code class="codeph">CPU_TIME_PER_CALL</code> ）。响应时间阈值表示每个服务的每个用户呼叫的经过时间不应超过某个值，并且呼叫的CPU时间阈值表示使用CPU为每个服务的每个呼叫花费的时间不应超过某个值。响应时间是反映可能阻止呼叫代表用户运行的所有延迟和故障的基本措施。响应时间还可以指示Oracle RAC数据库的节点之间的节点功率差异。
                  </p>
                  <p>您必须在Oracle RAC数据库的每个实例上设置这些阈值。经过时间和CPU时间计算为已用服务器端呼叫时间的移动平均值。AWR监视经过的时间和CPU时间，并在性能超过阈值时发布AWR警报。您可以使用安排操作<a id="d17899e7426" class="indexterm-anchor"></a>用于这些警报的Oracle Enterprise Manager作业，或者您可以安排在收到警报时以编程方式执行操作。您可以通过更改作业的优先级，停止过载的进程或重新定位，启动或停止服务来响应这些警报。这允许您在需求变化的情况下维持服务可用性。
                  </p>
                  <p>本节包括以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-CD8F12F3-E1B5-4E97-8443-414A651E1991">服务和阈值警报的示例</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-11C4EEF9-CC32-42A5-B8FD-C8E41C8D2BFA">启用Service_ Module_和Action Monitoring</a></p>
                     </li>
                  </ul>
               </div><a id="RACAD7318"></a><div class="sect3"><a id="GUID-CD8F12F3-E1B5-4E97-8443-414A651E1991" name="GUID-CD8F12F3-E1B5-4E97-8443-414A651E1991"></a><h4 id="RACAD-GUID-CD8F12F3-E1B5-4E97-8443-414A651E1991" class="sect4">服务和阈值警报的示例</h4>
                  <div>
                     <p>在此方案中，您需要检查工资核算服务的阈值。您可以使用AWR报告获取此信息。您应该比较在几个连续间隔内运行的报告的结果，在此期间系统以最佳方式运行。例如，假设对于工资单应用程序访问的服务器，AWR报告在每个星期四的下午1:00到下午5:00的高峰使用时间运行.AWR报告包含响应时间或已用数据库时间，以及CPU每个服务器（包括<code class="codeph">payroll</code>服务）的呼叫的消耗时间或CPU时间。AWR报告还提供了完成工作的细分和响应时间的等待时间。
                     </p>
                     <p>使用<code class="codeph">DBMS_MONITOR</code> ，您可以在0.5秒（500000微秒）内为<code class="codeph">payroll</code>服务的每次调用所用的时间设置警告阈值。您还可以在0.75秒（750000微秒）内为<code class="codeph">payroll</code>服务的每次呼叫设置的经过时间设置临界阈值。
                     </p>
                     <p>在此示例中，为<code class="codeph">payroll</code>服务添加了阈值，如下所示：</p><pre class="oac_no_warn" dir="ltr">EXECUTE DBMS_SERVER_ALERT.SET_THRESHOLD（METRICS_ID =&gt; DBMS_SERVER_ALERT.ELAPSED_TIME_PER_CALL，warning_operator =&gt; DBMS_SERVER_ALERT.OPERATOR_GE，warning_value =&gt;'500000'，critical_operator =&gt; DBMS_SERVER_ALERT.OPERATOR_GE，critical_value =&gt;'750000'，observation_period =&gt; 30，consecutive_occurrences =&gt; 5， instance_name =&gt; NULL，object_type =&gt; DBMS_SERVER_ALERT.OBJECT_TYPE_SERVICE，object_name =&gt;'payroll'）;</pre><p>您可以使用以下<code class="codeph">SELECT</code>语句验证是否在所有实例上设置了阈值配置：</p><pre class="oac_no_warn" dir="ltr">SELECT METRICS_NAME，INSTANCE_NAME，WARNING_VALUE，CRITICAL_VALUE，OBSERVATION_PERIOD FROM dba_thresholds;</pre></div>
               </div><a id="RACAD7319"></a><div class="sect3"><a id="GUID-11C4EEF9-CC32-42A5-B8FD-C8E41C8D2BFA" name="GUID-11C4EEF9-CC32-42A5-B8FD-C8E41C8D2BFA"></a><h4 id="RACAD-GUID-11C4EEF9-CC32-42A5-B8FD-C8E41C8D2BFA" class="sect4">启用服务，模块和操作监视</h4>
                  <div>
                     <p>您可以为每个服务中的重要模块和操作启用性能数据跟踪。性能统计信息位于<code class="codeph">V$SERV_MOD_ACT_STATS</code>视图中。例如，您可能决定设置以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>对于<code class="codeph">ERP</code>服务，启用对<code class="codeph">payroll</code>模块中的<code class="codeph">exceptions pay</code>操作的监控。
                           </p>
                        </li>
                        <li>
                           <p>对于<code class="codeph">ERP</code>服务，启用对<code class="codeph">payroll</code>模块中所有操作的监控。
                           </p>
                        </li>
                        <li>
                           <p>对于<code class="codeph">HOT_BATCH</code>服务，启用对<code class="codeph">posting</code>模块中所有操作的监视。
                           </p>
                        </li>
                     </ul>
                     <p>以下命令显示如何为服务启用模块和操作监视：</p><pre class="oac_no_warn" dir="ltr">EXECUTE DBMS_MONITOR.SERV_MOD_ACT_STAT_ENABLE（service_name =&gt;'erp'，module_name =&gt;'payroll'，action_name =&gt;'exception pay'）; EXECUTE DBMS_MONITOR.SERV_MOD_ACT_STAT_ENABLE（service_name =&gt;'erp'，module_name =&gt;'payroll'）; EXECUTE DBMS_MONITOR.SERV_MOD_ACT_STAT_ENABLE（service_name =&gt;'hot_batch'，module_name =&gt;'posts'）;</pre><p>要验证是否为服务，模块和操作启用了监视，请使用以下<code class="codeph">SELECT</code>语句：</p><pre class="oac_no_warn" dir="ltr">COLUMN AGGREGATION_TYPE格式A21截断的标题'聚合'列PRIMARY_ID格式A20截断的标题'服务'列QUALIFIER_ID1格式A20截断的标题'模块'列QUALIFIER_ID2格式A20截断的标题'操作'选择*来自DBA_ENABLED_AGGREGATIONS;</pre><p>输出类似于以下内容：</p><pre class="oac_no_warn" dir="ltr">聚合服务模块行动------------ -------------------- ---------- ---- --------- SERVICE_MODULE_ACTION erp工资单例外支付SERVICE_MODULE erp工资单SERVICE_MODULE hot_batch发布</pre></div>
               </div>
            </div><a id="RACAD841"></a><div class="sect2"><a id="GUID-4CC2D344-02D6-40E7-85B6-BB3AA7D6461A" name="GUID-4CC2D344-02D6-40E7-85B6-BB3AA7D6461A"></a><h3 id="RACAD-GUID-4CC2D344-02D6-40E7-85B6-BB3AA7D6461A" class="sect3">使用Oracle服务</h3>
               <div>
                  <p><a id="d17899e7943" class="indexterm-anchor"></a>管理<a id="d17899e7948" class="indexterm-anchor"></a>工作负载<a id="d17899e7953" class="indexterm-anchor"></a>或者一组应用程序，您可以定义分配给特定应用程序或应用程序操作子集的服务。您还可以按服务类型对工作进行分组。例如，在线用户可以使用一种服务，而批处理可以使用另一种服务，报告可以使用另一种服务连接到数据库。
                  </p>
                  <p><a id="d17899e7962" class="indexterm-anchor"></a>神谕<a id="d17899e7967" class="indexterm-anchor"></a>建议共享服务的所有用户具有相同的服务级别要求。您可以为服务定义特定的特征，每个服务可以代表一个单独的工作单元。使用服务时可以使用许多选项。虽然您不必实现这些选项，但使用它们有助于优化应用程序性能。
                  </p>
               </div>
            </div><a id="RACAD7300"></a><div class="sect2"><a id="GUID-6524637F-FE3E-46D9-8B47-887C0D7C562C" name="GUID-6524637F-FE3E-46D9-8B47-887C0D7C562C"></a><h3 id="RACAD-GUID-6524637F-FE3E-46D9-8B47-887C0D7C562C" class="sect3">服务部署选项</h3>
               <div>
                  <p>本节介绍以下服务部署主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-156DFA50-D18D-45CE-9AC1-5A6C71157263" title="Oracle GoldenGate利用Oracle RAC功能。">Oracle RAC数据库中的服务使用情况</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-539C0211-6AA2-44A3-9699-8DE9FBD9867D" title="使用Oracle Clusterware管理数据库时，可以使用带有-policy参数的srvctl add service命令添加服务时，为每个单独的数据库服务配置启动选项。如果在您的环境中配置了Oracle Data Guard，则可以在使用SRVCTL添加或修改服务时为服务定义角色，并使用适当的命令添加-role参数。为管理员管理的数据库定义服务时，可以使用带有-preferred参数的SRVCTL定义通常支持该服务的实例。如果可能，Oracle RAC将具有相同COLOCATION_TAG的客户端路由到同一数据库实例。为策略管理的数据库定义服务时，可以使用带有-serverpool参数的SRVCTL将服务分配给托管数据库的服务器池。Oracle Net Services提供连接负载平衡，使您能够跨所有支持服务的实例分布用户连接。">服务特色</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-599AD3C2-6E55-4124-A7A5-094DA2593D50">默认服务连接</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-07E4A746-8C68-4279-8932-0C86A402D9AE" title="默认情况下，此功能仅允许从本地IP地址注册侦听器，并提供配置和动态更新侦听器允许注册请求的一组IP地址或子网的功能。">受限制的服务注册</a></p>
                     </li>
                  </ul>
               </div><a id="RACAD8269"></a><div class="sect3"><a id="GUID-156DFA50-D18D-45CE-9AC1-5A6C71157263" name="GUID-156DFA50-D18D-45CE-9AC1-5A6C71157263"></a><h4 id="RACAD-GUID-156DFA50-D18D-45CE-9AC1-5A6C71157263" class="sect4">Oracle RAC数据库中的服务使用情况</h4>
                  <div>
                     <p>服务提供位置透明度。服务名称可以标识多个数据库实例，而实例可以属于多个服务。一些数据库功能使用Oracle RAC数据库的服务：</p>
                     <p>本节包括以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-6D9E7A56-F3F5-414F-B205-7329BE5C9394">用于服务的Oracle Clusterware资源</a></p>
                        </li>
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-FAD4432C-E317-4902-9CE5-60279AEC1284">数据库资源管理器消费者组服务映射</a></p>
                        </li>
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-3F445FCA-7825-4282-850F-B1234998DFB8">使用AWR进行服务性能监控</a></p>
                        </li>
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-538282FC-1607-42D7-91E8-C2C5253389E0">并行运营和服务</a></p>
                        </li>
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-A55E430B-5AE0-4C93-9C3E-FD26A650758C" title="Oracle GoldenGate利用Oracle RAC功能。">Oracle GoldenGate和Oracle RAC</a></p>
                        </li>
                     </ul>
                  </div><a id="RACAD8270"></a><div class="sect4"><a id="GUID-6D9E7A56-F3F5-414F-B205-7329BE5C9394" name="GUID-6D9E7A56-F3F5-414F-B205-7329BE5C9394"></a><h5 id="RACAD-GUID-6D9E7A56-F3F5-414F-B205-7329BE5C9394" class="sect5">用于服务的Oracle Clusterware资源</h5>
                     <div>
                        <p><a id="d17899e8472" class="indexterm-anchor"></a>定义服务时会自动创建资源配置文件。资源配置文件描述了Oracle Clusterware应如何管理服务，以及如果首选实例停止，服务应该故障转移到哪个实例。资源配置文件也定义<a id="d17899e8477" class="indexterm-anchor"></a>服务<a id="d17899e8482" class="indexterm-anchor"></a>实例和数据库的依赖关系。由于存在这些依赖关系，如果停止数据库，则实例和服务将按正确的顺序自动停止。
                        </p>
                     </div>
                  </div><a id="RACAD8271"></a><div class="sect4"><a id="GUID-FAD4432C-E317-4902-9CE5-60279AEC1284" name="GUID-FAD4432C-E317-4902-9CE5-60279AEC1284"></a><h5 id="RACAD-GUID-FAD4432C-E317-4902-9CE5-60279AEC1284" class="sect5">数据库资源管理器消费者组服务映射</h5>
                     <div>
                        <p>服务与Oracle集成<a id="d17899e8628" class="indexterm-anchor"></a>资源管理器，使您可以使用服务限制用户用于连接到实例的资源。通过Oracle Resource Manager，您可以将使用者组映射到服务，以便使用该服务连接到实例的用户是指定使用者组的成员。Oracle Resource Manager在实例级别运行。
                        </p>
                     </div>
                  </div><a id="RACAD8272"></a><div class="sect4"><a id="GUID-3F445FCA-7825-4282-850F-B1234998DFB8" name="GUID-3F445FCA-7825-4282-850F-B1234998DFB8"></a><h5 id="RACAD-GUID-3F445FCA-7825-4282-850F-B1234998DFB8" class="sect5">使用AWR进行服务性能监控</h5>
                     <div>
                        <p>自动工作负载存储库（AWR）生成的度量标准数据被组织到各种组中，例如事件，事件类，会话，服务和表空间度量。通常，您使用Oracle Enterprise Manager或AWR报告查看AWR数据。</p>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="../tgdba/comparing-database-performance-over-time.html#TGDBA-GUID-BEDBF986-1A69-459A-90F5-350B8A407516" target="_blank"><span><cite>Oracle数据库性能调整指南</cite></span></a></li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="RACAD8273"></a><div class="sect4"><a id="GUID-538282FC-1607-42D7-91E8-C2C5253389E0" name="GUID-538282FC-1607-42D7-91E8-C2C5253389E0"></a><h5 id="RACAD-GUID-538282FC-1607-42D7-91E8-C2C5253389E0" class="sect5">并行运营和服务</h5>
                     <div>
                        <p><a id="d17899e8932" class="indexterm-anchor"></a><a id="d17899e8934" class="indexterm-anchor"></a><a id="d17899e8938" class="indexterm-anchor"></a><a id="d17899e8942" class="indexterm-anchor"></a><a id="d17899e8946" class="indexterm-anchor"></a>默认情况下，在Oracle RAC环境中，并行执行的SQL语句可以在群集中的所有节点上运行。要使此跨节点或节点间并行执行良好，Oracle RAC环境中的互连必须适当调整大小，因为节点间并行执行可能会导致大量互连流量。要限制节点间并行执行，可以使用<code class="codeph">PARALLEL_FORCE_LOCAL</code>初始化参数控制Oracle RAC环境中的并行执行。通过将此参数设置为<code class="codeph">TRUE</code> ，并行执行服务器只能在启动SQL语句的同一Oracle RAC节点上执行。
                        </p>
                        <p>服务用于限制参与并行SQL操作的实例数。使用默认数据库服务时，并行SQL操作可以在所有可用实例上运行。您可以创建任意数量的服务，每个服务由一个或多个实例组成。启动并行SQL操作时，并行执行服务器仅在提供初始数据库连接中使用的指定服务的实例上生成。</p>
                        <p> <code class="codeph">PARALLEL_INSTANCE_GROUP</code>是一个Oracle RAC参数，当与服务一起使用时，允许您将并行查询操作限制为有限数量的实例。要将并行查询操作限制为有限数量的实例，请将<code class="codeph">PARALLEL_INSTANCE_GROUP</code>初始化参数设置为服务名称。这不会影响其他并行操作，例如并行恢复或<code class="codeph">GV$</code>查询的处理。
                        </p>
                     </div>
                  </div><a id="RACAD8274"></a><div class="sect4"><a id="GUID-A55E430B-5AE0-4C93-9C3E-FD26A650758C" name="GUID-A55E430B-5AE0-4C93-9C3E-FD26A650758C"></a><h5 id="RACAD-GUID-A55E430B-5AE0-4C93-9C3E-FD26A650758C" class="sect5">Oracle GoldenGate和Oracle RAC</h5>
                     <div>
                        <p>Oracle GoldenGate利用Oracle RAC功能。</p>
                        <p>在Oracle RAC环境中配置Oracle GoldenGate时，每个队列表都有一个拥有的实例。如果承载队列表的实例失败，则Oracle RAC数据库中的另一个实例将成为队列表的拥有实例，从而允许Oracle GoldenGate继续运行。</p>
                        <p>此外，在Oracle RAC数据库上，为每个缓冲的队列创建服务。此服务始终在目标队列的所有者实例上运行，并且如果所有权因实例启动，实例关闭等而切换，则遵循此队列的所有权。队列到队列的传播使用此服务。</p>
                     </div>
                  </div>
               </div><a id="RACAD8256"></a><div class="sect3"><a id="GUID-539C0211-6AA2-44A3-9699-8DE9FBD9867D" name="GUID-539C0211-6AA2-44A3-9699-8DE9FBD9867D"></a><h4 id="RACAD-GUID-539C0211-6AA2-44A3-9699-8DE9FBD9867D" class="sect4">服务特色</h4>
                  <div>
                     <p>为数据库创建新服务时，应定义<a id="d17899e9260" class="indexterm-anchor"></a>每项服务的自动工作负载管理特性。服务的特征包括：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-9032F733-346E-4E39-8E63-46F72E13F511">服务名称</a></p>
                        </li>
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-FC672BC8-2FAD-49F7-8683-3998C350E415">服务版</a></p>
                        </li>
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-0573F51A-7DF9-40AC-AE6A-0997F7EEEF3F" title="使用Oracle Clusterware管理数据库时，可以使用带有-policy参数的srvctl add service命令添加服务时，为每个单独的数据库服务配置启动选项。">服务管理政策</a></p>
                        </li>
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-785A51EA-2D3F-43BC-8D35-7BD7C24D08AD" title="如果在您的环境中配置了Oracle Data Guard，则可以在使用SRVCTL添加或修改服务时为服务定义角色，并使用适当的命令添加-role参数。">服务的数据库角色</a></p>
                        </li>
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-58636C69-C704-400C-A5C9-12A6BAC47E5A" title="为管理员管理的数据库定义服务时，可以使用带有-preferred参数的SRVCTL定义通常支持该服务的实例。">实例偏好</a></p>
                        </li>
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-1249F5AD-068A-4CC2-9BC5-9BF8AF754841" title="为策略管理的数据库定义服务时，可以使用带有-serverpool参数的SRVCTL将服务分配给托管数据库的服务器池。">服务器池分配</a></p>
                        </li>
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-57EBCB43-10AF-4DC1-A376-69EC53B11CD2">运行时连接负载平衡的负载平衡咨询目标</a></p>
                        </li>
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-B3DBD542-5EB4-4A23-9E6A-A48742A4754E" title="Oracle Net Services提供连接负载平衡，使您能够跨所有支持服务的实例分布用户连接。">连接负载平衡目标</a></p>
                        </li>
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-E71183DA-149D-49A9-8377-4B1B54CB3946">分布式事务处理</a></p>
                        </li>
                        <li>
                           <p><a href="ensuring-application-continuity.html#GUID-DEF850F6-27E9-428E-B8FC-530230D78AD2" title="当Oracle Net Services建立与实例的连接时，连接将保持打开状态，直到客户端关闭连接，实例关闭或发生故障。">使用TAF故障转移OCI客户端</a></p>
                        </li>
                     </ul>
                  </div><a id="RACAD8257"></a><div class="sect4"><a id="GUID-9032F733-346E-4E39-8E63-46F72E13F511" name="GUID-9032F733-346E-4E39-8E63-46F72E13F511"></a><h5 id="RACAD-GUID-9032F733-346E-4E39-8E63-46F72E13F511" class="sect5">服务名称</h5>
                     <div>
                        <p>每项服务都有一个服务名称。客户端使用服务名称连接到一个或多个实例。服务名称在整个系统中必须是唯一的。</p>
                     </div>
                  </div><a id="RACAD8259"></a><div class="sect4"><a id="GUID-FC672BC8-2FAD-49F7-8683-3998C350E415" name="GUID-FC672BC8-2FAD-49F7-8683-3998C350E415"></a><h5 id="RACAD-GUID-FC672BC8-2FAD-49F7-8683-3998C350E415" class="sect5">服务版</h5>
                     <div>
                        <p>基于版本的数据库对象重新定义使您可以在使用这些对象时升级应用程序的对象。你可以设置<a id="d17899e9633" class="indexterm-anchor"></a><a id="d17899e9639" class="indexterm-anchor"></a>创建数据库服务时的<span class="italic">版本</span>属性，或修改现有服务以设置版本。设置服务版本时，使用此服务的连接将使用此版本作为初始会话版本。如果服务未指定版本名称，则初始会话版本是数据库默认版本。
                        </p>
                        <p>您可以使用SRVCTL设置服务版本，如下所示：</p><pre class="oac_no_warn" dir="ltr">$ srvctl修改服务-db hr -s crmsrv -edition e2</pre></div>
                  </div><a id="RACAD8260"></a><div class="sect4"><a id="GUID-0573F51A-7DF9-40AC-AE6A-0997F7EEEF3F" name="GUID-0573F51A-7DF9-40AC-AE6A-0997F7EEEF3F"></a><h5 id="RACAD-GUID-0573F51A-7DF9-40AC-AE6A-0997F7EEEF3F" class="sect5">服务管理政策</h5>
                     <div>
                        <p>使用Oracle Clusterware管理数据库时，可以使用带有<code class="codeph">-policy</code>参数的<code class="codeph">srvctl add service</code>命令添加服务时，为每个单独的数据库服务配置启动选项。
                        </p>
                        <p>如果将服务的管理策略设置为<code class="codeph">AUTOMATIC</code> （默认值），则在使用SRVCTL启动数据库时，服务会自动启动。如果将管理策略设置为<code class="codeph">MANUAL</code> ，则服务不会自动启动，您必须使用SRVCTL手动启动它。 <code class="codeph">MANUAL</code>设置不会阻止Oracle Clusterware在服务运行时监视服务，并在发生故障时重新启动服务。在Oracle RAC <span class="italic">11g第</span> 2版（11.2）之前，所有服务都像使用<code class="codeph">MANUAL</code>管理策略一样定义。
                        </p>
                        <p>使用CRSCTL停止和重新启动Oracle Clusterware被视为失败，如果以前运行，则重新启动服务。</p>
                        <div class="infoboxnote" id="GUID-0573F51A-7DF9-40AC-AE6A-0997F7EEEF3F__GUID-A4E8C63F-65B1-4851-90D7-7D6CF0126857">
                           <p class="notep1">注意：</p>
                           <p>在管理员管理的数据库中使用自动服务时，在计划的数据库启动期间，只要启动的实例位于（组合的）首选和可用服务列表中，服务就可以在第一个实例上启动而不是首选实例。</p>
                        </div>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="server-control-utility-reference.html#GUID-EC1BA6D7-D538-4E11-9B31-C59389FDF93B" title="将服务添加到数据库并将其分配给实例。">srvctl添加服务</a></li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="RACAD8261"></a><div class="sect4"><a id="GUID-785A51EA-2D3F-43BC-8D35-7BD7C24D08AD" name="GUID-785A51EA-2D3F-43BC-8D35-7BD7C24D08AD"></a><h5 id="RACAD-GUID-785A51EA-2D3F-43BC-8D35-7BD7C24D08AD" class="sect5">服务的数据库角色</h5>
                     <div>
                        <p>如果您在环境中配置了Oracle Data Guard的，那么你可以定义当您添加或使用SRVCTL和修改服务的服务作用<code class="codeph">-role</code>用相应的命令参数。
                        </p>
                        <p>为服务指定角色时，仅当数据库角色与您为服务指定的角色匹配时，Oracle Clusterware才会自动启动该服务。有效角色为<code class="codeph">PRIMARY</code> ， <code class="codeph">PHYSICAL_STANDBY</code> ， <code class="codeph">LOGICAL_STANDBY</code>和<code class="codeph">SNAPSHOT_STANDBY</code> ，您可以为服务指定多个角色。
                        </p>
                        <div class="infoboxnote" id="GUID-785A51EA-2D3F-43BC-8D35-7BD7C24D08AD__GUID-BA5CD69B-57C8-481E-8BDF-822E549352B3">
                           <p class="notep1">注意：</p>
                           <p>服务角色仅控制服务的自动启动。即使角色不匹配，使用SRVCTL手动启动服务也会成功。</p>
                        </div>
                        <p>重做应用（物理备用数据库）可以在您可以配置的所有或部分备用实例上运行。这样，如有必要，可以通过添加其他备用实例来扩展Redo Apply性能。</p>
                        <p>如果群集中的多个数据库提供相同的服务名称，则Oracle RAC会在所有此类数据库之间平衡与该服务的连接。这对于备用和活动Oracle Data Guard数据库很有用，但如果您希望将服务的客户端连接定向到特定数据库，则服务名称在群集中必须是唯一的（不是由任何其他数据库提供）。</p>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="../sbydb/configuring-data-guard-standby-databases-in-oracle-RAC.html#SBYDB-GUID-00B72AF1-0453-4FBD-901F-A3764631BE1F" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a></li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="RACAD8262"></a><div class="sect4"><a id="GUID-58636C69-C704-400C-A5C9-12A6BAC47E5A" name="GUID-58636C69-C704-400C-A5C9-12A6BAC47E5A"></a><h5 id="RACAD-GUID-58636C69-C704-400C-A5C9-12A6BAC47E5A" class="sect5">实例偏好</h5>
                     <div>
                        <p>为管理员管理的数据库定义服务时，可以使用带有<code class="codeph">-preferred</code>参数的<code class="codeph">-preferred</code>定义通常支持该服务的实例。
                        </p>
                        <p>这些被称为<span class="italic">首选</span>实例。您也可以定义其他情况下，如果服务的首选实例使用SRVCTL与不支持服务<code class="codeph">-available</code>参数。这些被称为<span class="italic">可用</span>实例。
                        </p>
                        <p>指定首选实例时，您将指定服务正常运行的实例数。这是服务的<span class="italic">最大基数</span> 。Oracle Clusterware会尝试确保服务始终在您已为其配置服务的实例数上运行。之后，由于实例故障或计划的服务重定位，服务可能正在可用实例上运行。
                        </p>
                        <p>如果实例失败，那么，因为Oracle Clusterware将首选列表和可用列表解释为有序列表，所以如果列表中有多个实例，则可以控制Oracle Clusterware重定位服务的可用实例。但是，在计划的操作期间，您可以手动将服务定向到当前未提供服务的首选列表或可用列表中的任何实例。</p>
                        <p>当服务移动到可用实例时，Oracle数据库不会在首选实例重新启动时自动将服务移回首选实例，原因如下：</p>
                        <ul style="list-style-type:disc">
                           <li>该服务正在所需数量的实例上运行。</li>
                           <li>在当前实例上维护服务可提供更高级别的服务可用性。</li>
                           <li>不将服务移回初始首选实例可防止第二次中断。</li>
                        </ul>
                        <p>从Oracle数据库发行版19.3开始，如果为服务的<code class="codeph">-failback</code>属性指定<code class="codeph">yes</code> ，则在最后一个首选实例发生故障时故障转移到可用实例后，服务会在可用时转移回首选实例。对于早期版本，您可以使用FAN标注自动将故障回复到首选实例。
                        </p>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="administering-database-instances-and-cluster-databases.html#GUID-4F468ADC-D3E6-4D6F-B3AE-19BE5E5837A5" title="服务器控制实用程序（SRVCTL）是一个命令行界面，可用于以集中方式管理Oracle数据库。Oracle Enterprise Manager为Oracle RAC环境提供了一个集中控制点，允许您在多个集群数据库上同时执行管理任务。与SRVCTL或Oracle Enterprise Manager不同，SQL * Plus是面向实例的管理工具。">管理Oracle RAC的工具</a></li>
                           </ul>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-8E0EE7C3-AE33-4BA4-88C3-47EF96F80564" name="GUID-8E0EE7C3-AE33-4BA4-88C3-47EF96F80564"></a><h5 id="RACAD-GUID-8E0EE7C3-AE33-4BA4-88C3-47EF96F80564" class="sect5">服务共址</h5>
                     <div>
                        <p>如果可能，Oracle RAC将具有相同<code class="codeph">COLOCATION_TAG</code>客户端路由到同一数据库实例。
                        </p>
                        <p>同一实例上的会话协同定位有助于减少实例间通信，并提高在同一实例中执行的工作负载的性能。您可以在服务使用的TNS连接字符串的<code class="codeph">CONNECT_DATA</code>参数中配置<code class="codeph">COLOCATION_TAG</code> ，如<span><cite>Oracle数据库网络服务参考中所述</cite></span> 。
                        </p>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/racad&amp;id=NETRF-GUID-9D06528E-BBC4-4629-A119-C216EBF70201" target="_blank">COLOCATION_TAG</a></li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="RACAD8263"></a><div class="sect4"><a id="GUID-1249F5AD-068A-4CC2-9BC5-9BF8AF754841" name="GUID-1249F5AD-068A-4CC2-9BC5-9BF8AF754841"></a><h5 id="RACAD-GUID-1249F5AD-068A-4CC2-9BC5-9BF8AF754841" class="sect5">服务器池分配</h5>
                     <div>
                        <p>为策略管理的数据库定义服务时，可以使用带有<code class="codeph">-serverpool</code>参数的<code class="codeph">-serverpool</code>将服务分配给托管数据库的服务器池。
                        </p>
                        <p>您可以使用<code class="codeph">-cardinality</code>参数将服务定义为<code class="codeph">UNIFORM</code> （在服务器池中的所有实例上运行）或<code class="codeph">SINGLETON</code> （仅在服务器池中的一个实例上运行）。对于单例服务，Oracle RAC选择服务池中的哪个实例服务处于活动状态。如果该实例失败，则服务将故障转移到服务器池中的另一个实例。服务只能在一个服务器池中运行，Oracle建议每个服务器池至少有一个服务。
                        </p>
                        <div class="infoboxnote" id="GUID-1249F5AD-068A-4CC2-9BC5-9BF8AF754841__GUID-75BA1C09-9449-4BE3-B595-2A0687034259">
                           <p class="notep1">注意：</p>Oracle数据库服务质量管理（Oracle数据库QoS管理）管理服务器池中的单例服务（如果该服务器池的最大大小为1）。
                        </div>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="administering-database-instances-and-cluster-databases.html#GUID-4F468ADC-D3E6-4D6F-B3AE-19BE5E5837A5" title="服务器控制实用程序（SRVCTL）是一个命令行界面，可用于以集中方式管理Oracle数据库。Oracle Enterprise Manager为Oracle RAC环境提供了一个集中控制点，允许您在多个集群数据库上同时执行管理任务。与SRVCTL或Oracle Enterprise Manager不同，SQL * Plus是面向实例的管理工具。">管理Oracle RAC的工具</a></li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="RACAD8264"></a><div class="sect4"><a id="GUID-57EBCB43-10AF-4DC1-A376-69EC53B11CD2" name="GUID-57EBCB43-10AF-4DC1-A376-69EC53B11CD2"></a><h5 id="RACAD-GUID-57EBCB43-10AF-4DC1-A376-69EC53B11CD2" class="sect5">运行时连接负载平衡的负载平衡咨询目标</h5>
                     <div>
                        <p>同<a id="d17899e10712" class="indexterm-anchor"></a>运行时连接负载平衡，应用程序可以使用负载平衡咨询事件为用户提供更好的服务。Oracle JDBC，Oracle Oracle Java通用连接池，OCI会话池，ODP.NET和Oracle WebLogic Server Active GridLink for Oracle RAC客户端自动集成，以利用负载平衡咨询事件。负载平衡建议通知客户端实例为服务提供的当前服务级别。要启用负载平衡通报， <code class="codeph">-rlbgoal</code>在创建或修改服务时将SRVCTL与<code class="codeph">-rlbgoal</code>参数一起使用。
                        </p>
                        <p><a id="d17899e10719" class="indexterm-anchor"></a>负载平衡建议还建议应将多少工作负载发送到该实例。目标根据最佳服务质量（单个事务的完成效率）或最佳吞吐量（完整作业或长时间运行查询的完成效率）确定是否与服务建立连接。
                        </p>
                     </div>
                  </div><a id="RACAD8265"></a><div class="sect4"><a id="GUID-B3DBD542-5EB4-4A23-9E6A-A48742A4754E" name="GUID-B3DBD542-5EB4-4A23-9E6A-A48742A4754E"></a><h5 id="RACAD-GUID-B3DBD542-5EB4-4A23-9E6A-A48742A4754E" class="sect5">连接负载平衡目标</h5>
                     <div>
                        <p>Oracle Net Services提供连接负载平衡，使您能够跨所有支持服务的实例分布用户连接。</p>
                        <p>对于每个服务，您可以使用SRVCTL通过设置使用<code class="codeph">-clbgoal</code>参数指定的连接负载平衡目标来定义希望侦听器用于负载平衡的方法。连接分类为<code class="codeph">LONG</code> （例如连接池和SQL * FORMS），它告诉侦听器使用会话计数，或<code class="codeph">SHORT</code> ，它告诉侦听器使用响应时间或吞吐量统计信息。
                        </p>
                        <p>如果启用了负载平衡建议（ <code class="codeph">-rlbgoal</code>参数<span class="italic">不</span>等于<code class="codeph">NONE</code> ），则连接负载平衡会尝试使用负载平衡建议（无论是设置为<code class="codeph">SHORT</code>还是<code class="codeph">LONG</code> ）。如果负载平衡顾问设置为<code class="codeph">SHORT</code> ，那么它将使用服务的<code class="codeph">GOODNESS</code>值来尝试阻止所有连接请求转到一个实例。如果负载平衡顾问设置为<code class="codeph">LONG</code> ，则如果服务是非统一的，则使用<code class="codeph">run queue length</code>如果存在统一的服务分配，则使用<code class="codeph">session count</code> 。
                        </p>
                     </div>
                  </div><a id="RACAD8266"></a><div class="sect4"><a id="GUID-E71183DA-149D-49A9-8377-4B1B54CB3946" name="GUID-E71183DA-149D-49A9-8377-4B1B54CB3946"></a><h5 id="RACAD-GUID-E71183DA-149D-49A9-8377-4B1B54CB3946" class="sect5">分布式事务处理</h5>
                     <div>
                        <p></p>
                        <p><a href="glossary.html#GUID-2CD48F9F-B395-4ECC-ABE3-0F67EC3639ED"><span class="xrefglossterm">Oracle XA</span></a>应用程序具有独特的要求。Oracle提供跨Oracle RAC的全局事务。为获得最佳性能，请在大多数事务中使用XA affinity（同一实例中的所有分支），并在需要时使用全局事务。您可以将XA亲缘关系用于连接池，例如通用连接池和WebLogic Server。您还可以使用使用SRVCTL创建的单例服务。如果要挂起并恢复相同的Oracle XA分支，也可以使用SRVCTL将分布式事务处理参数（ <code class="codeph">-dtp</code> ）设置为<code class="codeph">TRUE</code> 。但是，一般不要使用它，因为它不提供滚动计划维护。
                        </p>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="workload-management-with-dynamic-database-services.html#GUID-7948E56B-D455-4852-A3EF-20E4F59156A5">Oracle RAC中的分布式事务处理</a></li>
                              <li><a href="server-control-utility-reference.html#GUID-EC1BA6D7-D538-4E11-9B31-C59389FDF93B" title="将服务添加到数据库并将其分配给实例。">srvctl添加服务</a></li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div><a id="RACAD7123"></a><div class="sect3"><a id="GUID-599AD3C2-6E55-4124-A7A5-094DA2593D50" name="GUID-599AD3C2-6E55-4124-A7A5-094DA2593D50"></a><h4 id="RACAD-GUID-599AD3C2-6E55-4124-A7A5-094DA2593D50" class="sect4">默认服务连接</h4>
                  <div>
                     <p>您的Oracle RAC数据库包括由<code class="codeph">DB_UNIQUE_NAME</code>标识的Oracle数据库服务（如果已设置），如果没有，则包括<code class="codeph">DB_NAME</code>或<code class="codeph">PDB_NAME</code> 。除非实例处于受限模式，否则此默认服务始终可用于Oracle RAC环境中的所有实例。您无法更改此服务或其属性。此外，该数据库支持以下两个内部服务：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">SYS$BACKGROUND</code>仅由后台进程使用</p>
                        </li>
                        <li>
                           <p><code class="codeph">SYS$USERS</code>是与任何应用程序服务无关的用户会话的默认服务</p>
                        </li>
                     </ul>
                     <p>所有这些服务都用于内部管理。您无法停止或禁用任何这些内部服务来执行计划中断或故障转移到Oracle Data Guard。不要将这些服务用于客户端连接。</p>
                     <div class="infoboxnote" id="GUID-599AD3C2-6E55-4124-A7A5-094DA2593D50__GUID-DB27C28D-20C2-48DE-B6AB-F8820014FF83">
                        <p class="notep1">注意：</p>
                        <p>您只能显式管理您创建的服务。如果数据库的某项功能创建了内部服务，则无法使用本章中的信息对其进行管理。</p>
                     </div>
                  </div>
               </div><a id="RACAD8421"></a><div class="sect3"><a id="GUID-07E4A746-8C68-4279-8932-0C86A402D9AE" name="GUID-07E4A746-8C68-4279-8932-0C86A402D9AE"></a><h4 id="RACAD-GUID-07E4A746-8C68-4279-8932-0C86A402D9AE" class="sect4">受限制的服务注册</h4>
                  <div>
                     <p>默认情况下，此功能仅允许从本地IP地址注册侦听器，并提供配置和动态更新侦听器允许注册请求的一组IP地址或子网的功能。</p>
                     <p>安全性是所有企业的高度优先事项，网络安全性和控制对数据库的访问是整体安全工作的关键组成部分。仅当请求源自有效节点时，才能使用侦听器注册数据库实例。网络管理员可以指定有效节点列表，排除节点或禁用有效节点检查。有效节点列表显式列出了可以向数据库注册的节点和子网。排除节点列表显式列出了无法向数据库注册的节点。对动态注册的控制可提高Oracle RAC部署的可管理性和安全性。</p>
                     <p>默认情况下，启用有效的注册节点检查（VNCR）。在默认配置中，仅允许来自群集内节点的注册请求，因为它们被重定向到私有子网，并且只有群集中的节点才能访问私有子网。非SCAN侦听器仅接受来自本地节点上的实例的注册。您必须使用<code class="codeph">listener.ora</code>文件中的<code class="codeph">registration_invited_nodes_ <span class="variable" translate="no">alias</span></code>参数或使用SRVCTL修改SCAN侦听器，在有效节点列表上手动包括SCAN侦听器子网外的远程节点或节点，如下所示：</p><pre class="pre codeblock"><code>$ srvctl modify scan_listener -invitednodes <span class="variable" translate="no">node_list</span> -invitedsubnets <span class="variable" translate="no">subnet_list</span></code></pre></div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/racad&amp;id=NETAG-GUID-A7F49477-1F13-49E7-9B23-9A50A4627862" target="_blank"><span><cite>Oracle数据库网络服务管理员指南</cite></span></a></li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div><a id="RACAD849"></a><div class="sect2"><a id="GUID-2678C005-1B70-4B88-90E0-174A324F7DAA" name="GUID-2678C005-1B70-4B88-90E0-174A324F7DAA"></a><h3 id="RACAD-GUID-2678C005-1B70-4B88-90E0-174A324F7DAA" class="sect3">管理服务</h3>
               <div>
                  <p><a id="d17899e11584" class="indexterm-anchor"></a>你可以创建和<a id="d17899e11589" class="indexterm-anchor"></a><a id="d17899e11593" class="indexterm-anchor"></a>管理服务<a id="d17899e11598" class="indexterm-anchor"></a><a id="d17899e11602" class="indexterm-anchor"></a>使用Oracle Enterprise Manager和SRVCTL实用程序。以下部分介绍如何使用这些工具执行与服务相关的任务：</p>
                  <p>本节包括以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-D594636D-17E5-42BC-A2B1-FD8FBEBCD06B" title="在创建和管理服务时，您将数据库执行的工作划分为可管理的单元。">服务管理概述</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-BE6E570F-FD1C-45B1-AA32-DE8B7405654E" title="Cluster Managed Database Services页面是用于开始与服务相关的所有任务的母版页。">使用Oracle Enterprise Manager管理服务</a></p>
                     </li>
                     <li>
                        <p><a href="workload-management-with-dynamic-database-services.html#GUID-CB82980F-8894-4142-8026-973895E03634" title="使用SRVCTL创建服务时，必须使用单独的SRVCTL命令启动该服务。">使用SRVCTL管理服务</a></p>
                     </li>
                  </ul>
                  <div class="infoboxnote" id="GUID-2678C005-1B70-4B88-90E0-174A324F7DAA__GUID-7A61E309-3991-460C-9F63-3E2938100BB3">
                     <p class="notep1">注意：</p>
                     <p>您还可以使用DBMS_SERVICE包来创建或修改服务和服务属性，但SRVCTL将覆盖使用此包进行的任何设置。建议不要将DBMS_SERVICE包用于Oracle RAC数据库使用的服务，也不建议使用Oracle Restart，也不建议Oracle Clusterware管理单实例数据库。</p>
                  </div>
               </div><a id="RACAD7124"></a><div class="sect3"><a id="GUID-D594636D-17E5-42BC-A2B1-FD8FBEBCD06B" name="GUID-D594636D-17E5-42BC-A2B1-FD8FBEBCD06B"></a><h4 id="RACAD-GUID-D594636D-17E5-42BC-A2B1-FD8FBEBCD06B" class="sect4">服务管理概述</h4>
                  <div>
                     <p>在创建和管理服务时，您将数据库执行的工作划分为可管理的单元。</p>
                     <p>使用服务的目标是实现数据库基础结构的最佳利用。您可以根据业务需求创建和部署服务。Oracle数据库可以衡量每项服务的性能。使用<code class="codeph">DBMS_MONITOR</code>程序包，您可以定义服务中的应用程序模块以及模块的各个操作，并监视这些操作的阈值，使您能够管理工作负载以按需交付容量。
                     </p>
                     <p>为数据库创建新服务时，应定义每个服务的自动工作负载管理特性，如<span class="q">“ <a href="workload-management-with-dynamic-database-services.html#GUID-539C0211-6AA2-44A3-9699-8DE9FBD9867D" title="使用Oracle Clusterware管理数据库时，可以使用带有-policy参数的srvctl add service命令添加服务时，为每个单独的数据库服务配置启动选项。如果在您的环境中配置了Oracle Data Guard，则可以在使用SRVCTL添加或修改服务时为服务定义角色，并使用适当的命令添加-role参数。为管理员管理的数据库定义服务时，可以使用带有-preferred参数的SRVCTL定义通常支持该服务的实例。如果可能，Oracle RAC将具有相同COLOCATION_TAG的客户端路由到同一数据库实例。为策略管理的数据库定义服务时，可以使用带有-serverpool参数的SRVCTL将服务分配给托管数据库的服务器池。Oracle Net Services提供连接负载平衡，使您能够跨所有支持服务的实例分布用户连接。">服务特征</a> ”中所述</span> 。
                     </p>
                     <div class="infoboxnotealso" id="GUID-D594636D-17E5-42BC-A2B1-FD8FBEBCD06B__GUID-7C30636F-91B7-4429-9525-DBF75220BCFB">
                        <p class="notep1">也可以看看：</p>
                        <p><span><cite>Oracle数据库服务质量管理用户指南</cite></span>如果您将Oracle数据库QoS管理与Oracle集群一起使用，以获取有关如何配置数据库服务的详细信息</p>
                     </div>
                     <p>除了创建服务外，您还可以：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="bold">删除服务</span> 。您可以删除您创建的服务。但是，您无法删除或修改Oracle数据库创建的默认数据库服务的属性。
                           </p>
                        </li>
                        <li>
                           <p><span class="bold">检查服务的状态</span> 。可以在可用实例中为服务分配不同的角色。在具有许多服务的复杂数据库中，您可能不记得每项服务的详细信息。因此，您可能必须在实例或服务的基础上检查状态。例如，在对该实例或运行它的Oracle主目录进行修改之前，您可能必须知道特定实例的服务状态。
                           </p>
                        </li>
                        <li>
                           <p><span class="bold">启动或停止数据库或实例的服务</span> 。必须先启动服务，然后才能将该服务用于与该实例的客户端连接。如果关闭数据库，例如，通过运行SRVCTL命令<code class="codeph">srvctl stop database -db</code> <code class="codeph"><span class="variable" translate="no">db_unique_name</span></code> ，其中<code class="codeph"><span class="variable" translate="no">db_unique_name</span></code>是要停止的数据库的名称，则Oracle Database将停止该数据库的所有服务。根据服务管理策略，您可能必须在启动数据库时手动重新启动服务。<code class="codeph">srvctl stop database</code>和<code class="codeph">srvctl stop service</code>命令都接受<code class="codeph">-force</code>选项以强制断开连接。要耗尽计划中断的会话，请不要使用<code class="codeph">-force</code>选项。
                           </p>
                           <div class="infoboxnote" id="GUID-D594636D-17E5-42BC-A2B1-FD8FBEBCD06B__GUID-42F98ADF-40DC-4911-B308-D9E25FA93677">
                              <p class="notep1">注意：</p>
                              <p>如果为Oracle RAC数据库启用了Oracle Database QoS Management，则服务在停止后会自动重新启动。</p>
                           </div>
                        </li>
                        <li>
                           <p><span class="bold">将服务映射到使用者组</span> 。您可以将服务映射到Resource Manager使用者组，以限制服务可在实例中使用的资源量。您必须创建使用者组，然后将服务映射到使用者组。
                           </p>
                        </li>
                        <li>
                           <p><span class="bold">启用或禁用数据库或实例的服务</span> 。默认情况下，Oracle Clusterware会在失败后尝试自动重新启动服务。您可以通过禁用服务来防止此行为。当您必须执行数据库或实例维护时，禁用服务非常有用，例如，当您执行升级并且希望阻止连接请求成功时。
                           </p>
                        </li>
                        <li>
                           <p><span class="bold">将服务重定位到其他实例</span> 。您可以将服务从一个实例移动到另一个实例以重新平衡工作负载，例如，在添加或删除群集节点之后。
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-D594636D-17E5-42BC-A2B1-FD8FBEBCD06B__GUID-CD038D06-DDB7-4C34-B719-3D73748E36B3">
                        <p class="notep1">注意：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>使用服务时，请不要为<code class="codeph">SERVICE_NAMES</code>参数设置值; Oracle数据库控制您为所创建的服务和默认数据库服务的此参数的设置。本章介绍的服务功能与Oracle数据库在设置<code class="codeph">SERVICE_NAMES</code>时提供的功能没有直接关系。此外，为此参数设置值可能会覆盖使用服务的一些好处。
                              </p>
                           </li>
                           <li>
                              <p>必须从SRVCTL或与服务相关的数据库视图（例如<code class="codeph">dba_services</code>获取服务状态信息。
                              </p>
                           </li>
                           <li>
                              <p>如果使用<code class="codeph">DISPATCHERS</code>初始化参数指定服务，它将覆盖<code class="codeph">SERVICE_NAMES</code>参数中的任何服务，并且无法进行管理。（例如，使用SRVCTL命令停止服务不会阻止用户与服务连接。）
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="workload-management-with-dynamic-database-services.html#GUID-074729CB-8A91-419C-A6E1-3B9E4FD8D869" title="FAN的总体目标是实现应用程序的端到端，无人值守恢复以及基于实际事务性能的负载平衡。为通用连接池和Oracle WebLogic Server启用快速连接故障转移（FCF）Active GridLink for Oracle RAC支持使用FAN HA和负载平衡咨询事件。您可以为通用连接池或隐式连接缓存启用FCF。运行时连接负载平衡需要使用Oracle JDBC驱动程序和Oracle RAC数据库。重播数据源（oracle.jdbc.replay。OracleDataSource）是Application Continuity对Java要求的JDBC瘦数据源。Transaction Guard为应用程序提供协议和通用工具，以便在计划内和计划外中断时最多执行一次。从Oracle Database 12c开始，OCI会话池使应用程序的多个线程能够使用动态管理的一组预先创建的数据库会话。OCI支持FAN消息和Transaction Guard。FAN旨在快速通知基于OCI的应用程序在节点，数据库，实例，服务和公共网络级别的中断。ODP.NET连接池可以订阅FAN HA通知，指示节点，服务和服务成员何时关闭。连接到Oracle Database 12c及更高版本时，ODP.NET使用Oracle Notification Service而不是Advanced Queuing。ODP.NET支持FAN消息和Transaction Guard。FAN旨在快速通知基于ODP.NET的应用程序在节点，数据库，实例，服务和公共网络级别的中断。">为Oracle RAC启用客户端</a></li>
                           <li><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/racad&amp;id=ARPLS-GUID-9876C289-99E4-416B-AB6F-D8318642053E" target="_blank"><span><cite>Oracle数据库PL / SQL包和类型参考</cite></span></a></li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RACAD7025"></a><div class="sect3"><a id="GUID-BE6E570F-FD1C-45B1-AA32-DE8B7405654E" name="GUID-BE6E570F-FD1C-45B1-AA32-DE8B7405654E"></a><h4 id="RACAD-GUID-BE6E570F-FD1C-45B1-AA32-DE8B7405654E" class="sect4">使用Oracle Enterprise Manager管理服务</h4>
                  <div>
                     <p>Cluster Managed Database Services页面是用于开始与服务相关的所有任务的母版页。</p>
                     <p>访问此页面，如下所示：</p>
                     <ol>
                        <li>
                           <p>在Oracle Enterprise Manager中，转到Cluster Database主页。</p>
                           <div class="infoboxnotealso" id="GUID-BE6E570F-FD1C-45B1-AA32-DE8B7405654E__GUID-812647F9-10C0-445E-BC84-99C53CA15E3C">
                              <p class="notep1">也可以看看：</p>
                              <p>有关登录Oracle Enterprise Manager的详细信息，请参见<span><cite>Oracle Database 2 Day DBA</cite></span> 。
                              </p>
                           </div>
                        </li>
                        <li>
                           <p>从“ <span class="bold">可用性”</span>菜单中，选择“ <span class="bold">群集托管数据库服务”</span>以显示“群集托管数据库服务”页面。
                           </p>
                        </li>
                        <li>
                           <p>输入或确认Oracle RAC数据库和主机操作系统的凭据，然后单击“ <span class="bold">继续”</span>以显示“群集托管数据库服务”页面。
                           </p>
                        </li>
                     </ol>
                     <p>在Cluster Managed Database Services页面中，您可以深入查看以执行以下任务：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>查看群集的服务列表</p>
                        </li>
                        <li>
                           <p>查看当前正在运行每个服务的实例</p>
                        </li>
                        <li>
                           <p>查看在策略管理环境中提供服务的服务器池和节点</p>
                        </li>
                        <li>
                           <p>查看每项服务的状态</p>
                        </li>
                        <li>
                           <p>创建或编辑服务</p>
                        </li>
                        <li>
                           <p>启动或停止服务</p>
                        </li>
                        <li>
                           <p>启用或禁用服务</p>
                        </li>
                        <li>
                           <p>执行服务的实例级任务</p>
                        </li>
                        <li>
                           <p>删除服务</p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-BE6E570F-FD1C-45B1-AA32-DE8B7405654E__GUID-7AF68126-079E-4A19-9971-7A25846F3DC3">
                        <p class="notep1">注意：</p>
                        <p>您必须具有<code class="codeph">SYSDBA</code>凭据才能访问群集数据库。群集托管数据库服务不允许您以<code class="codeph">SYSDBA</code>之外的任何其他方式进行连接。</p>
                     </div>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/racad&amp;id=ADMQS-GUID-BA75AD46-D22E-4914-A31E-C395CD6A2BBA" target="_blank"><span><cite>Oracle数据库2天DBA</cite></span></a></li>
                        </ul>
                     </div>
                     <div class="infoboxnotealso" id="GUID-BE6E570F-FD1C-45B1-AA32-DE8B7405654E__GUID-6B614B26-213C-49DC-A581-9820FE7912BF">
                        <p class="notep1">也可以看看：</p>
                        <p>有关使用Oracle Enterprise Manager管理服务的更多信息，请参见Oracle Enterprise Manager联机帮助</p>
                     </div>
                  </div>
               </div><a id="RACAD7026"></a><div class="sect3"><a id="GUID-CB82980F-8894-4142-8026-973895E03634" name="GUID-CB82980F-8894-4142-8026-973895E03634"></a><h4 id="RACAD-GUID-CB82980F-8894-4142-8026-973895E03634" class="sect4">使用SRVCTL管理服务</h4>
                  <div>
                     <p>使用SRVCTL创建服务时，必须使用单独的SRVCTL命令启动该服务。</p>
                     <p>但是，您可能稍后必须手动停止或重新启动该服务。您可能还必须禁用该服务以防止自动重新启动，手动重定位服务或获取有关服务的状态信息。以下部分说明如何使用SRVCTL执行以下管理任务：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-FD53AE5D-7D2A-4AFC-8363-A2E0DD77863D" title="要使用SRVCTL创建服务，请在命令行上使用srvctl add service命令。">使用SRVCTL创建服务</a></p>
                        </li>
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-87EDF90F-1776-474A-AD9C-93F9CBE6CB31" title="要为Application Continuity配置服务，在使用SRVCTL创建服务时，请将-failovertype参数设置为TRANSACTION，并将-commit_outcome设置为TRUE。">为应用程序连续性和事务防护创建服务</a></p>
                        </li>
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-35D1F2C6-7A21-4B63-8ED9-69FCAECBA16C">使用SRVCTL启动和停止服务</a></p>
                        </li>
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-4DE433AE-AC47-4591-92A7-866DBE77A930">使用SRVCTL启用和禁用服务</a></p>
                        </li>
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-153EAA56-6E30-48BF-B152-7841E5640EF2">使用SRVCTL重新定位服务</a></p>
                        </li>
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-506E7A9A-D204-4D30-A9CA-523C9FE58587">使用SRVCTL获取服务状态</a></p>
                        </li>
                        <li>
                           <p><a href="workload-management-with-dynamic-database-services.html#GUID-EBEFA349-1DD9-4978-B96B-0E0B092BE41D">使用SRVCTL获取服务配置</a></p>
                        </li>
                     </ul>
                  </div><a id="RACAD7126"></a><div class="sect4"><a id="GUID-FD53AE5D-7D2A-4AFC-8363-A2E0DD77863D" name="GUID-FD53AE5D-7D2A-4AFC-8363-A2E0DD77863D"></a><h5 id="RACAD-GUID-FD53AE5D-7D2A-4AFC-8363-A2E0DD77863D" class="sect5">使用SRVCTL创建服务</h5>
                     <div>
                        <p>要使用SRVCTL创建服务，请在命令行上使用<code class="codeph">srvctl add service</code>命令。
                        </p>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="server-control-utility-reference.html#GUID-EC1BA6D7-D538-4E11-9B31-C59389FDF93B" title="将服务添加到数据库并将其分配给实例。">srvctl添加服务</a></li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="RACAD8437"></a><a id="RACAD8438"></a><a id="RACAD8436"></a><div class="sect4"><a id="GUID-87EDF90F-1776-474A-AD9C-93F9CBE6CB31" name="GUID-87EDF90F-1776-474A-AD9C-93F9CBE6CB31"></a><h5 id="RACAD-GUID-87EDF90F-1776-474A-AD9C-93F9CBE6CB31" class="sect5">为应用程序连续性和事务防护创建服务</h5>
                     <div>
                        <p>要为Application Continuity配置服务，在使用SRVCTL创建服务时，请将<code class="codeph">-failovertype</code>参数设置为<code class="codeph">TRANSACTION</code>并将<code class="codeph">-commit_outcome</code>为<code class="codeph">TRUE</code> 。</p>
                        <p>在应用程序中使用Application Continuity和Transaction Guard时，必须配置服务。本节介绍如何根据您计划实现的功能配置这些应用程序服务。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-87EDF90F-1776-474A-AD9C-93F9CBE6CB31__GUID-7B531D6C-6766-4DD3-89E6-A5D9842E57AD">为应用程序连续性创建服务</p>
                        </div>
                        <!-- class="section" -->
                        <p>此外，您可以为应用程序连续性和负载平衡设置这些其他服务参数的值：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">-replay_init_time</code> ：指定允许重放开始的时间长度（以秒为单位）。Oracle建议您根据允许重播的时长来选择一个值。默认值为300秒。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">-retention</code> ：指定提交结果信息存储在数据库中的时间（以秒为单位）。默认值为86400（1天）。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">-session_state</code> ：执行COMMIT后，如果该事务中的状态已更改，则如果会话丢失，则无法重播事务以重新建立该状态。配置应用程序连续性时，应用程序的分类取决于初始设置后的会话状态是动态还是静态，然后是否继续通过请求中的COMMIT操作。</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><span class="bold">动态</span> :(默认）如果会话状态更改未通过初始化完全封装，则会话具有动态状态，并且在故障转移时无法在回调中完全捕获。一旦请求中的第一个事务提交，就会在内部禁用故障转移，直到下一个请求开始。这是几乎<span class="italic">所有</span>应用程序都应该用于请求的默认模式。
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="bold">静态</span> :(特殊请求）如果所有会话状态更改（例如NLS设置和PL / SQL包状态）都可以在初始化回调中重复，则会话具有静态。此设置仅用于不更改会话状态的数据库诊断应用程序。如果请求中存在无法通过回调重新建立的任何非事务状态更改，请不要指定<code class="codeph">STATIC</code> 。如果您不确定要指定的状态，请使用<code class="codeph">DYNAMIC</code> 。</p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p><code class="codeph">-failoverretry</code> ：每次连接尝试的连接重试次数;建议值是30。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">-failoverdelay</code> ：每次连接尝试之间以秒为单位的延迟;建议值是10。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">-notification</code> ：强烈建议使用FAN  - 将此值设置为<code class="codeph">TRUE</code> ，以便为OCI和ODP.Net客户端启用FAN。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">-clbgoal</code> ：对于连接负载平衡，在使用运行时负载平衡时使用<code class="codeph">SHORT</code> 。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">-rlbgoal</code> ：对于运行时负载平衡，设置为<code class="codeph">SERVICE_TIME</code> 。</p>
                           </li>
                        </ul>
                        <p>要为策略管理的Oracle RAC数据库创建应用程序连续性服务，请使用类似于以下的命令，其中<code class="codeph">racdb</code>是Oracle RAC数据库的名称， <code class="codeph">app2</code>是要修改的服务的名称， <code class="codeph">Svrpool1</code>是提供服务的服务器池的名称：</p><pre class="pre codeblock"><code>$ srvctl add service -db racdb -service app2 -serverpool Srvpool1 -failovertype TRANSACTION -commit_outcome TRUE -replay_init_time 1800 -retention 86400 -notification TRUE -rlbgoal SERVICE_TIME -clbgoal SHORT -failoverretry 30 -failoverdelay 10</code></pre><p>您可以使用SRVCTL修改Application Continuity的现有服务，类似于以下命令，其中<code class="codeph">racdb</code>是Oracle RAC数据库的名称， <code class="codeph">app1</code>是要修改的服务的名称：</p><pre class="pre codeblock"><code>$ srvctl修改服务-db racdb -service app1 -clbgoal SHORT -rlbgoal SERVICE_TIME -failoverretry 30 -failoverdelay 10 -failovertype TRANSACTION -commit_outcome TRUE -replay_init_time 1800 -retention 86400 -notification TRUE</code></pre><div class="section">
                           <p class="subhead3" id="GUID-87EDF90F-1776-474A-AD9C-93F9CBE6CB31__GUID-60B8FD2C-824B-4A26-B214-94514108E3BF">为Transaction Guard创建服务</p>
                        </div>
                        <!-- class="section" -->
                        <p>要启用Transaction Guard，而不启用Application Continuity，请使用SRVCTL创建服务，并仅设置<code class="codeph">-commit_outcome TRUE</code> 。</p>
                        <p>您可以使用SRVCTL修改现有服务以启用Transaction Guard，类似于以下命令，其中<code class="codeph">racdb</code>是Oracle RAC数据库的名称， <code class="codeph">app2</code>是要修改的服务的名称：</p><pre class="pre codeblock"><code>$ srvctl修改服务-db racdb -service app2 -commit_outcome TRUE -retention 86400 -notification TRUE</code></pre><p>在前面的示例中， <code class="codeph">-retention</code>参数指定维护历史记录的时间（以秒为单位）。此外， <code class="codeph">–notification</code>参数设置为<code class="codeph">TRUE</code> ，从而启用FAN事件。
                        </p>
                        <p>要使用Transaction Guard，DBA必须授予权限，如下所示：</p><pre class="pre codeblock"><code>DBMS_APP_CONT上的GRANT EXECUTE;</code></pre></div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/racad&amp;id=ADFNS-GUID-6C5880E5-C45F-4858-A069-A28BB25FD1DB" target="_blank"><span><cite>Oracle数据库开发指南</cite></span></a></li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="RACAD7027"></a><div class="sect4"><a id="GUID-35D1F2C6-7A21-4B63-8ED9-69FCAECBA16C" name="GUID-35D1F2C6-7A21-4B63-8ED9-69FCAECBA16C"></a><h5 id="RACAD-GUID-35D1F2C6-7A21-4B63-8ED9-69FCAECBA16C" class="sect5">使用SRVCTL启动和停止服务</h5>
                     <div>
                        <p>对于使用服务器进行连接的应用程序，必须启动该服务。如果您停止服务，则它暂时不可用，但仍然需要自动重新启动和故障转移。</p>
                        <p>在命令行中输入以下SRVCTL语法以启动或停止服务：</p><pre class="oac_no_warn" dir="ltr">$ srvctl start service -db <span class="italic">db_unique_name</span> [-service <span class="italic"><code class="codeph">service_name_list</code></span> ] [-instance <span class="italic"><code class="codeph">inst_name</code></span> ] [-startoption <span class="italic"><code class="codeph">start_options</code></span> ]</pre><pre class="oac_no_warn" dir="ltr">$ srvctl stop service -db <span class="italic">db_unique_name</span> -service <span class="italic"><code class="codeph">service_name_list</code></span> [-instance <span class="italic"><code class="codeph">inst_name</code></span> ] [-startoption <span class="italic"><code class="codeph">start_options</code></span> ]</pre></div>
                  </div><a id="RACAD7028"></a><div class="sect4"><a id="GUID-4DE433AE-AC47-4591-92A7-866DBE77A930" name="GUID-4DE433AE-AC47-4591-92A7-866DBE77A930"></a><h5 id="RACAD-GUID-4DE433AE-AC47-4591-92A7-866DBE77A930" class="sect5">使用SRVCTL启用和禁用服务</h5>
                     <div>
                        <p>如果禁用某项服务，则Oracle Clusterware不会将该服务视为自动启动，故障转移或重新启动。您可以在执行应用程序维护时禁用服务，以确保在您的维护操作完成之前Oracle Clusterware不会意外重新启动该服务。要使服务再次可用于正常操作，请启用该服务。</p>
                        <p>从命令行使用以下SRVCTL语法来启用和禁用服务：</p><pre class="oac_no_warn" dir="ltr">$ srvctl enable service -db <span class="italic"><code class="codeph">db_unique_name</code></span> -service <span class="italic"><code class="codeph">service_name_list</code></span> [-instance <span class="italic"><code class="codeph">inst_name</code></span> ]</pre><pre class="oac_no_warn" dir="ltr">$ srvctl禁用服务-db <span class="italic"><code class="codeph">db_unique_name</code></span> -service <span class="italic"><code class="codeph">service_name_list</code></span> [-instance <span class="italic"><code class="codeph">inst_name</code></span> ]</pre></div>
                  </div><a id="RACAD7029"></a><div class="sect4"><a id="GUID-153EAA56-6E30-48BF-B152-7841E5640EF2" name="GUID-153EAA56-6E30-48BF-B152-7841E5640EF2"></a><h5 id="RACAD-GUID-153EAA56-6E30-48BF-B152-7841E5640EF2" class="sect5">使用SRVCTL重新定位服务</h5>
                     <div>
                        <p>从命令行运行<code class="codeph">srvctl relocate service</code>命令以重定位服务。当服务故障转移到可用实例时，您可以使用此命令，但是您希望在重新启动该实例后将其移回首选实例。
                        </p>
                        <p>以下命令将<code class="codeph">crm</code>服务从实例<code class="codeph">apps1</code>到实例<code class="codeph">apps3</code> ：</p><pre class="oac_no_warn" dir="ltr">$ srvctl重定位服务-db apps -service crm -oldinst apps1 -newinst apps3</pre><p>以下命令使用节点语法将<code class="codeph">crm</code>服务从<code class="codeph">node1</code>到<code class="codeph">node3</code> ：</p><pre class="oac_no_warn" dir="ltr">$ srvctl重定位服务-db apps -service crm -currentnode node1 -targetnode node3</pre></div>
                  </div><a id="RACAD7030"></a><div class="sect4"><a id="GUID-506E7A9A-D204-4D30-A9CA-523C9FE58587" name="GUID-506E7A9A-D204-4D30-A9CA-523C9FE58587"></a><h5 id="RACAD-GUID-506E7A9A-D204-4D30-A9CA-523C9FE58587" class="sect5">使用SRVCTL获取服务状态</h5>
                     <div>
                        <p>从命令行运行<code class="codeph">srvctl status service</code>命令以获取服务的状态。例如，以下命令返回<code class="codeph">apps</code>数据库上运行的服务的状态：</p><pre class="oac_no_warn" dir="ltr">$ srvctl status service -db apps服务erp在节点上运行：apps02，apps03服务hr在节点上运行：apps02，apps03服务销售在节点上运行：apps01，apps04</pre></div>
                  </div><a id="RACAD7316"></a><div class="sect4"><a id="GUID-EBEFA349-1DD9-4978-B96B-0E0B092BE41D" name="GUID-EBEFA349-1DD9-4978-B96B-0E0B092BE41D"></a><h5 id="RACAD-GUID-EBEFA349-1DD9-4978-B96B-0E0B092BE41D" class="sect5">使用SRVCTL获取服务配置</h5>
                     <div>
                        <p>从命令行运行<code class="codeph">srvctl config service</code>命令以获取服务的高可用性配置。例如，以下命令返回在<code class="codeph">apps</code>数据库上运行的<code class="codeph">erp</code>服务的配置：</p><pre class="pre codeblock"><code><span class="bold">$ srvctl config service -db apps -service erp</span>服务名称：erp服务已启用服务器池：pool1基数：1断开连接：false服务角色：PRIMARY管理策略：AUTOMATIC DTP事务：false AQ HA通知：true全局：false提交结果： true故障转移类型：TRANSACTION故障转移方法：无TAF故障转移重试：30 TAF故障转移延迟：10连接负载平衡目标：LONG运行时负载平衡目标：SERVICE_TIME TAF策略规范：NONE版本：可插入数据库名称：最大延迟时间：任何SQL转换配置文件：保留时间：86400秒重播启动时间：1800秒会话状态一致性：STATIC首选实例：应用程序可用实例：</code></pre></div>
                  </div>
               </div>
            </div><a id="RACAD8419"></a><div class="sect2"><a id="GUID-4C9FACD5-E959-4C79-A962-EFACBBC46545" name="GUID-4C9FACD5-E959-4C79-A962-EFACBBC46545"></a><h3 id="RACAD-GUID-4C9FACD5-E959-4C79-A962-EFACBBC46545" class="sect3">全球服务</h3>
               <div>
                  <p>Oracle RAC支持数据库服务，并支持跨单个集群中的实例进行服务级工作负载管理。</p>
                  <p>全局服务为一组提供公共服务的复制数据库提供动态负载平衡，故障转移和集中服务管理。该组数据库可能包括Oracle RAC和由Oracle Data Guard，Oracle GoldenGate或任何其他复制技术互连的非群集Oracle数据库。</p>
                  <p>创建和使用全局服务时，可以使用以下工作负载管理功能：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>能够为全局服务指定首选和可用的数据库</p>
                     </li>
                     <li>
                        <p>处理复制滞后</p>
                     </li>
                     <li>
                        <p>客户端和服务器之间的地理关联</p>
                     </li>
                     <li>
                        <p>连接负载平衡</p>
                     </li>
                     <li>
                        <p>运行时负载平衡</p>
                     </li>
                     <li>
                        <p>数据库间服务故障转移</p>
                     </li>
                     <li>
                        <p>快速连接故障转移</p>
                     </li>
                     <li>
                        <p>连接时故障转移</p>
                     </li>
                     <li>
                        <p>应用程序连续性</p>
                     </li>
                     <li>
                        <p>交易卫士</p>
                     </li>
                     <li>
                        <p>向后兼容现有客户端</p>
                     </li>
                  </ul>
                  <div class="infoboxnote" id="GUID-4C9FACD5-E959-4C79-A962-EFACBBC46545__GUID-E742F3FE-0405-4BB5-A716-F85DA5A0B034">
                     <p class="notep1">注意：</p>
                     <p>您可以使用SRVCTL管理Oracle RAC数据库中的全局服务的实例放置，但您只能使用GDSCTL管理其他全局服务属性。</p>
                  </div>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/racad&amp;id=GSMUG-GUID-04D33448-2CB4-40C7-9DA0-1CFC6EC5E101" target="_blank"><span><cite>“Oracle数据库全球数据服务概念和管理指南”</cite></span></a></li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-20E8DA7D-EDE0-4B6D-9A4A-E54AD5B965A2" name="GUID-20E8DA7D-EDE0-4B6D-9A4A-E54AD5B965A2"></a><h3 id="RACAD-GUID-20E8DA7D-EDE0-4B6D-9A4A-E54AD5B965A2" class="sect3">面向服务的缓冲区高速缓存访问</h3>
               <div>
                  <p>面向服务的缓冲区高速缓存访问通过使用数据所属的服务管理数据来提高性能。</p>
                  <p>通过服务随时间访问对象被映射并持久保存到数据库，并且此信息可用于提高性能。通过服务访问的块将缓存在运行服务的实例中，更重要的是，信息不会缓存在服务未运行的位置。</p>
                  <p>此信息还可用于在服务启动之前预热缓存。可以通过实例启动或服务重定位来触发服务启动。面向服务的缓冲区高速缓存访问为该服务的任何用户提供一致的性能，因为服务用户访问的块被缓存在新的重定位实例中。</p>
               </div>
            </div><a id="RACAD8849"></a><a id="RACAD8850"></a><a id="RACAD8848"></a><div class="sect2"><a id="GUID-6552E661-CB51-462C-8C0C-02CEE4E50001" name="GUID-6552E661-CB51-462C-8C0C-02CEE4E50001"></a><h3 id="RACAD-GUID-6552E661-CB51-462C-8C0C-02CEE4E50001" class="sect3">连接服务：一个例子</h3>
               <div>
                  <p>以下示例说明了如何创建服务，然后提供了使用不同客户端方法连接到该服务的几个示例。</p>
                  <p>在此示例中，为运行时负载平衡启用了服务，如下所示：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>服务名称： <code class="codeph">HR.example.com</code></p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>在名为CRM的数据库上运行</p>
                           </li>
                           <li>
                              <p>该系统由4个节点组成</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>将<code class="codeph">SERVICE_TIME</code>指定为<code class="codeph">-rlbgoal</code>参数的值</p>
                     </li>
                     <li>
                        <p>侦听器的SCAN地址为<code class="codeph">rws3010104-scan.example.com</code></p>
                     </li>
                     <li>
                        <p>侦听器端口是1585</p>
                     </li>
                  </ul>
                  <p>该服务的基数为2，但如果需要，可以由任何CRM数据库实例提供。服务配置如下：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>首选实例：CRM1，CRM2</p>
                     </li>
                     <li>
                        <p>可用实例：CRM3，CRM4</p>
                     </li>
                     <li>
                        <p>将<code class="codeph">SHORT</code>指定为<code class="codeph">-clbgoal</code>参数的值</p>
                     </li>
                  </ul>
                  <p>使用此服务的应用程序利用了应用程序连续性，因此您必须设置<code class="codeph">-failovertype</code>和<code class="codeph">-commit_outcome</code> 。使用默认保留参数，但在连接尝试之间设置10秒延迟，在未能获得连接之前最多重试40次。
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-6552E661-CB51-462C-8C0C-02CEE4E50001__GUID-D7F85E96-023B-4278-B6DF-FC419D9A17E8">使用SRVCTL创建HR服务</p>
                  </div>
                  <!-- class="section" -->
                  <p>使用SRVCTL创建HR服务，如下所示：</p><pre class="pre codeblock"><code>$ srvctl add service -db CRM -service HR.example.com -preferred CRM1，CRM2 -available CRM3，CRM4 -clbgoal SHORT -failovertype TRANSACTION -commit_outcome TRUE -failoverdelay 10 -failoverretry 40</code></pre><p>启动<code class="codeph">HR.example.com</code>服务，如下所示：</p><pre class="pre codeblock"><code>$ srvctl启动服务-db CRM -service HR.example.com</code></pre><p>该服务现在最多可用于两个实例，CRM1和CRM2是首选实例。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-6552E661-CB51-462C-8C0C-02CEE4E50001__GUID-4A2AEB8E-4F70-4552-AD48-8F2F97B92671">从JDBC应用程序连接到HR服务</p>
                  </div>
                  <!-- class="section" -->
                  <p>在此示例中，连接到HR服务的应用程序是使用JDBC通用连接池和JDBC瘦驱动程序的JDBC应用程序。</p>
                  <p>在此示例中，构造了一个URL，指定数据库说明符的精简样式服务名称格式。启用快速连接故障转移，并配置远程Oracle Notification Service，其中群集上的Oracle Notification Service后台驻留程序侦听端口6200。</p><pre class="pre codeblock"><code>//导入包并注册驱动程序import java.sql。连接; import java.sql。的SQLException; import java.sql。声明; import oracle.ucp.jdbc。PoolDataSourceFactory; import oracle.ucp.jdbc。PoolDataSource; PoolDataSource pds = PoolDataSourceFactory.getPoolDataSource（）; //在数据源上设置连接属性。pds.setConnectionPoolName（ “FCFPool”）; pds.setFastConnectionFailoverEnabled（真）; pds.setONSConfiguration（ “节点= rws3010104-scan.example.com：6200”）; pds.setConnectionFactoryClassName（“oracle.jdbc.pool。OracleDataSource“）; pds.setURL（”jdbc：oracle：thin：@ // rws3010104-scan.example.com:1585/HR.example.com“）; pds.setUser（”HR“）; pds.setPassword（” hr“）; //覆盖任何池属性。pds.setInitialPoolSize（5）; //从数据源获取数据库连接。Connection conn = pds.getConnection（）; //做一些工作//返回连接到池conn.close（）;康恩= NULL</code></pre></div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/racad&amp;id=JJUCP-GUID-82ACD002-4C5F-4BF7-99FF-46A2A97DD35D" target="_blank"><span><cite>Oracle通用连接池开发人员指南</cite></span></a></li>
                     </ul>
                  </div>
               </div>
            </div>
            <hr><br><p style="text-decoration:underline">脚注图例</p>脚注1：<p>运行时连接负载平衡基本上是将工作请求路由到会话池中的会话，以最好地为工作服务。它从现有会话池中选择会话时生效。因此，运行时连接负载平衡是一种非常频繁的活动。</p><br></div>
      </article>
   </body>
</html>