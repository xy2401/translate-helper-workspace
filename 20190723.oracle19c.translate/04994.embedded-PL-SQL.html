<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>嵌入式PL / SQL</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Programmer&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Programmer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="c-c-programmers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-11T03:52:01-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96467-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="embedded-SQL.html" title="Previous" type="text/html"></link>
      <link rel="next" href="host-arrays.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Pro*C/C++ Programmer&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="LNPCC"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="embedded-SQL.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="host-arrays.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">程序员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="introduction-and-concepts.html" property="item" typeof="WebPage"><span property="name">介绍和概念</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">嵌入式PL / SQL</li>
            </ol>
            <a id="GUID-BCE83EB3-88D8-4EA1-853F-D5B66D426654" name="GUID-BCE83EB3-88D8-4EA1-853F-D5B66D426654"></a><a id="LNPCC3397"></a>
            
            <h2 id="LNPCC-GUID-BCE83EB3-88D8-4EA1-853F-D5B66D426654" class="sect2"><span class="enumeration_chapter">7</span>嵌入式PL / SQL</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍如何通过在程序中嵌入PL / SQL事务处理块来提高性能。本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="embedded-PL-SQL.html#GUID-F181104F-663F-4D4E-9BB8-9F0E9B93C82A">PL / SQL的优点</a></p>
                  </li>
                  <li>
                     <p><a href="embedded-PL-SQL.html#GUID-5BEE764D-014F-4677-AB9B-78A2DDCB39FB">嵌入式PL / SQL块</a></p>
                  </li>
                  <li>
                     <p><a href="embedded-PL-SQL.html#GUID-5E215CB6-82C4-4BA5-8D12-636BE005227E">主机变量</a></p>
                  </li>
                  <li>
                     <p><a href="embedded-PL-SQL.html#GUID-BC7145CA-5296-4287-B7E4-0D2A52CE2B70">指标变量</a></p>
                  </li>
                  <li>
                     <p><a href="embedded-PL-SQL.html#GUID-4C56DC0E-B857-405D-B88E-93B19DD9FCF2">主机阵列</a></p>
                  </li>
                  <li>
                     <p><a href="embedded-PL-SQL.html#GUID-117968E7-E597-4448-AC5D-581BF1361E2C">嵌入式PL / SQL中的游标用法</a></p>
                  </li>
                  <li>
                     <p><a href="embedded-PL-SQL.html#GUID-65965251-9158-442D-A69B-D52A33B35E22">存储的PL / SQL和Java子程序</a></p>
                  </li>
                  <li>
                     <p><a href="embedded-PL-SQL.html#GUID-2191B843-36C4-4936-B0F5-97AB0AB8CDEA">外部程序</a></p>
                  </li>
                  <li>
                     <p><a href="embedded-PL-SQL.html#GUID-A147B827-C733-47AD-944F-BEA87FC7CAD3">关于使用动态SQL</a></p>
                  </li>
               </ul>
            </div>
            <div>
               <div class="relinfo">
                  <p><strong>相关话题</strong></p>
                  <ul>
                     <li><a href="embedded-PL-SQL.html#GUID-BCE83EB3-88D8-4EA1-853F-D5B66D426654">嵌入式PL / SQL</a></li>
                  </ul>
               </div>
            </div>
            <a id="LNPCC3398"></a><div class="props_rev_3"><a id="GUID-F181104F-663F-4D4E-9BB8-9F0E9B93C82A" name="GUID-F181104F-663F-4D4E-9BB8-9F0E9B93C82A"></a><h3 id="LNPCC-GUID-F181104F-663F-4D4E-9BB8-9F0E9B93C82A" class="sect3"><span class="enumeration_section">7.1</span> PL / SQL的优点</h3>
               <div>
                  <p>本节介绍PL / SQL提供的一些功能和优点，例如：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="embedded-PL-SQL.html#GUID-06339EB1-7966-4F9D-8593-4DD7F53D2BDB">更好的性能</a></p>
                     </li>
                     <li>
                        <p><a href="embedded-PL-SQL.html#GUID-02AD4583-9307-4B4B-B67E-385274CD5A1B">与Oracle集成</a></p>
                     </li>
                     <li>
                        <p><a href="embedded-PL-SQL.html#GUID-B5D728FA-C238-4F28-AF1C-06920ED39036">光标FOR循环</a></p>
                     </li>
                     <li>
                        <p><a href="embedded-PL-SQL.html#GUID-CE9D6002-9C8D-430F-A518-54C7C3DAD322">程序和功能</a></p>
                     </li>
                     <li>
                        <p><a href="embedded-PL-SQL.html#GUID-D5C9AB9A-C065-4B82-AD99-E29908B93170">包</a></p>
                     </li>
                     <li>
                        <p><a href="embedded-PL-SQL.html#GUID-00730E73-71A2-4FB0-960E-97C2FADF9C20">PL / SQL表</a></p>
                     </li>
                     <li>
                        <p><a href="embedded-PL-SQL.html#GUID-C2B7D923-800B-4361-88DC-06FA50488F85">用户定义的记录</a></p>
                     </li>
                  </ul>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="../lnpls/index.html" target="_blank"><span><cite>Oracle数据库PL / SQL语言参考</cite></span></a></li>
                     </ul>
                  </div>
               </div><a id="LNPCC3399"></a><div class="props_rev_3"><a id="GUID-06339EB1-7966-4F9D-8593-4DD7F53D2BDB" name="GUID-06339EB1-7966-4F9D-8593-4DD7F53D2BDB"></a><h4 id="LNPCC-GUID-06339EB1-7966-4F9D-8593-4DD7F53D2BDB" class="sect4"><span class="enumeration_section">7.1.1</span>更好的表现</h4>
                  <div>
                     <p>PL / SQL可以帮助您减少开销，提高性能并提高工作效率。例如，如果没有PL / SQL，Oracle必须一次处理一个SQL语句。每个SQL语句都会导致对服务器的另一次调用以及更高的开销。但是，使用PL / SQL，您可以将整个SQL语句块发送到服务器。这可以最大限度地减少应用程序与Oracle之间的通<a id="d33328e129" class="indexterm-anchor"></a> 
                     </p>
                  </div>
               </div><a id="LNPCC3400"></a><div class="props_rev_3"><a id="GUID-02AD4583-9307-4B4B-B67E-385274CD5A1B" name="GUID-02AD4583-9307-4B4B-B67E-385274CD5A1B"></a><h4 id="LNPCC-GUID-02AD4583-9307-4B4B-B67E-385274CD5A1B" class="sect4"><span class="enumeration_section">7.1.2</span>与Oracle集成</h4>
                  <div>
                     <p>PL / SQL与Oracle Server紧密集成。例如，大多数PL / SQL数据类型是Oracle数据字典的原生数据类型。此外，您可以使用％TYPE属性将变量声明基于存储在数据字典中的列定义，如以下示例所示： <a id="d33328e146" class="indexterm-anchor"></a><a id="d33328e150" class="indexterm-anchor"></a><a id="d33328e154" class="indexterm-anchor"></a> 
                     </p><pre class="oac_no_warn" dir="ltr">job_title emp.job％TYPE;</pre><p>这样，您无需知道列的确切数据类型。此外，如果列定义发生更改，则变量声明会相应地自动更改。这提供了数据独立性，降低了维护成本，并允许程序随着数据库的变化而适应。</p>
                  </div>
               </div><a id="LNPCC3401"></a><div class="props_rev_3"><a id="GUID-B5D728FA-C238-4F28-AF1C-06920ED39036" name="GUID-B5D728FA-C238-4F28-AF1C-06920ED39036"></a><h4 id="LNPCC-GUID-B5D728FA-C238-4F28-AF1C-06920ED39036" class="sect4"><span class="enumeration_section">7.1.3</span>游标FOR循环</h4>
                  <div>
                     <p>使用PL / SQL，您无需使用DECLARE，OPEN，FETCH和CLOSE语句来定义和操作游标。相反，您可以使用游标FOR循环，它隐式声明其循环索引作为记录，打开与给定查询关联的游标，重复从游标中取出数据到记录中，然后关闭游标。一个例子如下： <a id="d33328e174" class="indexterm-anchor"></a><a id="d33328e178" class="indexterm-anchor"></a> 
                     </p><pre class="oac_no_warn" dir="ltr">宣布 ...BEGIN FOR emprec IN（SELECT empno，sal，comm FROM emp）LOOP IF emprec.comm / emprec.sal&gt; 0.25 THEN ......结束循环;结束;</pre><p>请注意，您使用点表示法来引用记录中的组件。</p>
                  </div>
               </div><a id="LNPCC3402"></a><div class="props_rev_3"><a id="GUID-CE9D6002-9C8D-430F-A518-54C7C3DAD322" name="GUID-CE9D6002-9C8D-430F-A518-54C7C3DAD322"></a><h4 id="LNPCC-GUID-CE9D6002-9C8D-430F-A518-54C7C3DAD322" class="sect4"><span class="enumeration_section">7.1.4</span>程序和功能</h4>
                  <div>
                     <p>PL / SQL有两种类型的子程序，称为<span class="italic">过程</span>和<span class="italic">函数</span> ，它们通过让您隔离操作来帮助开发应用程序。通常，您使用过程来执行操作，使用函数来计算值。 <a id="d33328e204" class="indexterm-anchor"></a><a id="d33328e208" class="indexterm-anchor"></a> 
                     </p>
                     <p>程序和功能提供了<span class="italic">可扩展性</span> 。也就是说，它们可以让您定制PL / SQL语言以满足您的需求。例如，如果您需要一个创建新部门的过程，请按如下方式编写自己的部门：</p><pre class="oac_no_warn" dir="ltr">PROCEDURE create_dept（new_dname IN CHAR（14），new_loc IN CHAR（13），new_deptno OUT NUMBER（2））IS BEGIN SELECT deptno_seq。NEXTVAL INTO new_deptno FROM dual; INSERT INTO dept VALUES（new_deptno，new_dname，new_loc）; END create_dept;</pre><p>调用时，此过程接受新的部门名称和位置，选择部门编号数据库序列中的下一个值，将新编号，名称和位置插入到<span class="italic">dept</span>表中，然后将新编号返回给调用者。
                     </p>
                     <p>您可以使用<span class="italic">参数模式</span>来定义形式参数的行为。有三种参数模式：IN（默认值），OUT和IN OUT。 IN参数允许您将值传递给被调用的子程序。OUT参数允许您将值返回给子程序的调用者。IN OUT参数允许您将初始值传递给被调用的子程序，并将更新的值返回给调用者。 <a id="d33328e230" class="indexterm-anchor"></a><a id="d33328e232" class="indexterm-anchor"></a><a id="d33328e234" class="indexterm-anchor"></a><a id="d33328e236" class="indexterm-anchor"></a><a id="d33328e238" class="indexterm-anchor"></a> 
                     </p>
                     <p>每个实际参数的数据类型必须可转换为其相应形式参数的数据类型。<a href="embedded-PL-SQL.html#GUID-4C56DC0E-B857-405D-B88E-93B19DD9FCF2__CHDDCCFE" title="法律数据类型转换">表7-1</a>显示了数据类型之间的合法转换。
                     </p>
                  </div>
               </div><a id="LNPCC3403"></a><div class="props_rev_3"><a id="GUID-D5C9AB9A-C065-4B82-AD99-E29908B93170" name="GUID-D5C9AB9A-C065-4B82-AD99-E29908B93170"></a><h4 id="LNPCC-GUID-D5C9AB9A-C065-4B82-AD99-E29908B93170" class="sect4"><span class="enumeration_section">7.1.5</span>包</h4>
                  <div>
                     <p>PL / SQL允许您将逻辑上相关的类型，程序对象和子程序捆绑到一个<span class="italic">包中</span> 。通过Procedural Database Extension，可以编译包并将其存储在Oracle数据库中，其中的内容可以由许多应用程序共享。 <a id="d33328e263" class="indexterm-anchor"></a><a id="d33328e267" class="indexterm-anchor"></a><a id="d33328e271" class="indexterm-anchor"></a> 
                     </p>
                     <p>包通常包含两部分：规范和正文。<span class="italic">规范</span>是应用程序的接口;它声明了可供使用的类型，常量，变量，异常，游标和子程序。<span class="italic">正文</span>定义了游标和子程序;它实现了规范。在以下示例中，您“打包”了两个雇佣程序：</p><pre class="oac_no_warn" dir="ltr">PACKAGE emp_actions IS  - 包规范PROCEDURE hire_employee（empno NUMBER，ename CHAR，...）;程序fire_employee（emp_id NUMBER）; END emp_actions; PACKAGE BODY emp_actions IS  - 包体PROCEDURE hire_employee（empno NUMBER，ename CHAR，...）是开始插入emp VALUES（empno，ename，...）; END hire_employee;程序fire_employee（emp_id NUMBER）从emp WHERE empno = emp_id开始删除;结束fire_employee; END emp_actions;</pre><p>只有包规范中的声明可见且可供应用程序访问。包体中的实现细节是隐藏的，无法访问。</p>
                  </div>
               </div><a id="LNPCC3404"></a><div class="props_rev_3"><a id="GUID-00730E73-71A2-4FB0-960E-97C2FADF9C20" name="GUID-00730E73-71A2-4FB0-960E-97C2FADF9C20"></a><h4 id="LNPCC-GUID-00730E73-71A2-4FB0-960E-97C2FADF9C20" class="sect4"><span class="enumeration_section">7.1.6</span> PL / SQL表</h4>
                  <div>
                     <p>PL / SQL提供名为TABLE的复合数据类型。 TABLE类型的对象称为<span class="italic">PL / SQL表</span> ，它们被建模为（但不是相同的）数据库表。PL / SQL表只有一列，并使用主键为您提供类似行的行访问。该列可以属于任何标量类型（例如CHAR，DATE或NUMBER），但主键必须属于BINARY_INTEGER，PLS_INTEGER或VARCHAR2类型。<a id="d33328e300" class="indexterm-anchor"></a><a id="d33328e304" class="indexterm-anchor"></a></p>
                     <p>您可以在任何块，过程，函数或包的声明部分中声明PL / SQL表类型。在以下示例中，您声明了一个名为<span class="italic">NumTabTyp</span>的TABLE类型：</p><pre class="oac_no_warn" dir="ltr">...DECLARE TYPE NumTabTyp是BINARY_INTEGER的数字索引表; ...开始 ...结束; ...
</pre><p>定义类型<span class="italic">NumTabTyp后</span> ，可以声明该类型的PL / SQL表，如下一个示例所示：</p><pre class="oac_no_warn" dir="ltr">num_tab NumTabTyp;</pre><p>标识符<span class="italic">num_tab</span>表示整个PL / SQL表。
                     </p>
                     <p>使用类似数组的语法引用PL / SQL表中的行以指定主键值。例如，您引用名为<span class="italic">num_tab</span>的PL / SQL表中的第九行，如下所示：</p><pre class="oac_no_warn" dir="ltr">num_tab（9）......</pre></div>
               </div><a id="LNPCC3405"></a><div class="props_rev_3"><a id="GUID-C2B7D923-800B-4361-88DC-06FA50488F85" name="GUID-C2B7D923-800B-4361-88DC-06FA50488F85"></a><h4 id="LNPCC-GUID-C2B7D923-800B-4361-88DC-06FA50488F85" class="sect4"><span class="enumeration_section">7.1.7</span>用户定义的记录</h4>
                  <div>
                     <p>您可以使用％ROWTYPE属性声明一条记录，该记录表示表中的行或游标提取的行。但是，您无法在记录中指定组件的数据类型或定义自己的组件。复合数据类型RECORD解除了这些限制。 <a id="d33328e345" class="indexterm-anchor"></a><a id="d33328e347" class="indexterm-anchor"></a><a id="d33328e349" class="indexterm-anchor"></a><a id="d33328e353" class="indexterm-anchor"></a> 
                     </p>
                     <p>RECORD类型的对象称为<span class="italic">记录</span> 。与PL / SQL表不同，记录具有唯一命名的组件，这些组件可以属于不同的数据类型。例如，假设您有关于员工的不同类型的数据，例如姓名，工资，雇用日期等。这些数据在类型上不同但在逻辑上相关。包含员工姓名，工资和雇用日期等组件的记录可让您将数据视为逻辑单元。
                     </p>
                     <p>您可以在任何块，过程，函数或包的声明部分中声明记录类型和对象。在以下示例中，您声明了一个名为<span class="italic">DeptRecTyp</span>的RECORD类型：</p><pre class="oac_no_warn" dir="ltr">DECLARE TYPE DeptRecTyp是RECORD（deptno NUMBER（4）NOT NULL， - 默认为NULL允许dname CHAR（9），loc CHAR（14））;</pre><p>请注意，组件声明与变量声明类似。每个组件都有唯一的名称和特定的数据类型。您可以将NOT NULL选项添加到任何组件声明中，从而防止将NULL分配给该组件。</p>
                     <p>一旦定义了类型<span class="italic">DeptRecTyp</span> ，就可以声明该类型的记录，如下一个示例所示：</p><pre class="oac_no_warn" dir="ltr">dept_rec DeptRecTyp;</pre><p>标识符<span class="italic">dept_rec</span>表示整个记录。
                     </p>
                     <p>您可以使用点表示法来引用记录中的各个组件。例如，您在<span class="italic">dept_rec</span>记录中引用<span class="italic">dname</span>组件，如下所示：</p><pre class="oac_no_warn" dir="ltr">dept_rec.dname ...</pre></div>
               </div>
            </div><a id="LNPCC3406"></a><div class="props_rev_3"><a id="GUID-5BEE764D-014F-4677-AB9B-78A2DDCB39FB" name="GUID-5BEE764D-014F-4677-AB9B-78A2DDCB39FB"></a><h3 id="LNPCC-GUID-5BEE764D-014F-4677-AB9B-78A2DDCB39FB" class="sect3"><span class="enumeration_section">7.2</span>嵌入式PL / SQL块</h3>
               <div>
                  <p>Pro * C / C ++预编译器将PL / SQL块视为单个嵌入式SQL语句。因此，您可以将PL / SQL块放在可以放置SQL语句的程序中的任何位置。 <a id="d33328e406" class="indexterm-anchor"></a><a id="d33328e410" class="indexterm-anchor"></a> 
                  </p>
                  <p>要在Pro * C / C ++程序中嵌入PL / SQL块，只需将PL / SQL块与关键字EXEC SQL EXECUTE和END-EXEC括在一起，如下所示：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL EXECUTE DECLARE ...开始 ...结束; END-EXEC;</pre><p>关键字END-EXEC必须后跟分号。 <a id="d33328e421" class="indexterm-anchor"></a> 
                  </p>
                  <p>编写程序后，以常规方式预编译源文件。</p>
                  <p>当程序包含嵌入式PL / SQL时，必须使用SQLCHECK = SEMANTICS命令行选项，因为必须由Oracle Server解析PL / SQL。SQLCHECK = SEMANTICS也需要USERID选项才能连接到服务器。</p>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="precompiler-options.html#GUID-1FB02C5F-DCC0-453C-A6AB-246421712F74">关于使用预编译器选项</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="LNPCC3407"></a><div class="props_rev_3"><a id="GUID-5E215CB6-82C4-4BA5-8D12-636BE005227E" name="GUID-5E215CB6-82C4-4BA5-8D12-636BE005227E"></a><h3 id="LNPCC-GUID-5E215CB6-82C4-4BA5-8D12-636BE005227E" class="sect3"><span class="enumeration_section">7.3</span>主机变量</h3>
               <div>
                  <p>主机变量是主机语言和PL / SQL块之间通信的关键。主机变量可以与PL / SQL共享，这意味着PL / SQL可以设置和引用主机变量。</p>
                  <p>例如，您可以提示用户输入信息并使用主机变量将该信息传递给PL / SQL块。然后，PL / SQL可以访问数据库并使用主机变量将结果传递回主机程序。<a id="d33328e452" class="indexterm-anchor"></a></p>
                  <p>在PL / SQL块中，主变量被视为整个块的全局变量，可以在允许PL / SQL变量的任何地方使用。与SQL语句中的主变量一样，PL / SQL块中的主机变量必须以冒号为前缀。冒号设置除PL / SQL变量和数据库对象之外的主变量。</p>
                  <div class="infoboxnote" id="GUID-5E215CB6-82C4-4BA5-8D12-636BE005227E__GUID-6482F7B7-91A4-419B-86E8-F84FAB0613E3">
                     <p class="notep1">注意：</p>
                     <p>要将VARCHAR，CHARZ或STRING类型用作PL / SQL块中的输出主机变量，必须<span class="italic">在</span>进入块<span class="italic">之前</span>初始化长度。将长度设置为VARCHAR，CHARZ或STRING的声明（最大）长度。</p>
                  </div>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="datatypes-and-host-variables.html#GUID-44E37B7E-C78E-4F3E-87D5-19152BDCE1B8">指针变量</a></li>
                     </ul>
                  </div>
               </div>
               <a id="LNPCC3408"></a><div class="props_rev_3"><a id="GUID-DB613125-638D-4254-9EA1-E81158B6D5DD" name="GUID-DB613125-638D-4254-9EA1-E81158B6D5DD"></a><h4 id="LNPCC-GUID-DB613125-638D-4254-9EA1-E81158B6D5DD" class="sect4"><span class="enumeration_section">7.3.1</span>示例：将主机变量与PL / SQL一起使用</h4>
                  <div>
                     <div class="section">
                        <p>以下示例说明了使用PL / SQL的主机变量。程序会提示用户输入员工编号，然后显示该员工的职位，雇用日期和工资。<a id="d33328e485" class="indexterm-anchor"></a></p><pre class="oac_no_warn" dir="ltr">char username [100]，密码[20]; char job_title [20]，hire_date [9]，temp [32]; int emp_number;浮动工资; #include &lt;sqlca.h&gt; printf（“用户名？\ n“）;获取（用户名）; printf（”密码？\ n“）;获取（密码）; EXEC SQL WHENEVER SQLERROR GOTO sql_error; EXEC SQL CONNECT：username IDENTIFIED BY：password; printf（”Connected to Oracle \ n“）; for（;;）{printf（”Employee Number（ 0到结束）？“）; gets（temp）; emp_number = atoi（temp）; if（emp_number == 0）{EXEC SQL COMMIT WORK RELEASE; printf（”退出程序\ n“）; break;} / * ------ --------开始PL / SQL块----------------- * / EXEC SQL EXECUTE BEGIN SELECT job，hiredate，sal INTO：job_title，：hire_date，： salary FROM emp WHERE empno =：emp_number; END; END-EXEC; / * --------------结束PL / SQL块-------------- --- * / printf（“Number Job Title Hire Date Salary \ n”）; printf（“---------------------------- -------- \ n“）; printf（”％6d％8.8s％9.9s％6.2f \ n“，emp_number，job_title，hire_date，salary）;} ...出口（0）; sql_error：EXEC SQL WHENEVER SQLERROR CONTINUE; EXEC SQL ROLLBACK工作版; printf（“处理错误\ n”）;出口（1）;</pre><p>请注意，在进入PL / SQL块之前主机变量<span class="italic">emp_number</span>被设定，并且主机变量<span class="italic"><span class="italic">JOB_TITLE，HIRE_DATE，</span></span>和<span class="italic">工资</span>所设置的块内。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="LNPCC3409"></a><div class="props_rev_3"><a id="GUID-46B51FA3-E1B5-4D42-A51D-E50E9DEA4339" name="GUID-46B51FA3-E1B5-4D42-A51D-E50E9DEA4339"></a><h4 id="LNPCC-GUID-46B51FA3-E1B5-4D42-A51D-E50E9DEA4339" class="sect4"><span class="enumeration_section">7.3.2</span>复杂的例子</h4>
                  <div>
                     <div class="section">
                        <p>在稍后的示例中，您提示用户输入银行帐号，交易类型和交易金额，然后借记或贷记帐户。如果该帐户不存在，则引发异常。交易完成后，您将显示其状态。 <a id="d33328e518" class="indexterm-anchor"></a> 
                        </p><pre class="oac_no_warn" dir="ltr">#include &lt;stdio.h&gt; #include &lt;sqlca.h&gt; char username [20]; char密码[20]; char status [80]; char temp [32]; int acct_num; double trans_amt; void sql_error（）; main（）{char trans_type; strcpy（密码，“TIGER”）; strcpy（用户名，“SCOTT”）;执行SQL WHENEVER SQLERROR DO sql_error（）; EXEC SQL CONNECT：用户名IDENTIFIED BY：密码; printf（“连接到Oracle \ n”）; for（;;）{printf（“帐号（0到结尾）？“）; gets（temp）; acct_num = atoi（temp）; if（acct_num == 0）{EXEC SQL COMMIT WORK RELEASE; printf（”退出程序\ n“）; break;} printf（”Transaction Type  -  D） ebit还是C）redit？“）;获取（temp）; trans_type = temp [0]; printf（”交易金额？“）; gets（temp）; trans_amt = atof（temp）; / * ----------------- begin PL / SQL block ----------- -------- * / EXEC SQL EXECUTE DECLARE old_bal NUMBER（9,2）; err_msg CHAR（70）;不存在EXCEPTION; BEGIN：trans_type：= UPPER（：trans_type）; IF：trans_type ='C'THEN - 贷记帐户UPDATE accts SET bal = bal +：trans_amt WHERE acctid =：acct_num; IF SQL％ROWCOUNT = 0 THEN  - 没有受影响的行RAISE不存在; ELSE：status：='Credit applied'; END IF; ELSIF： trans_type ='D'那么 - 借记帐户SELECT bal INTO old_bal FROM accts WHERE acctid =：acct_num; IF old_bal&gt; =：trans_amt那么 - 足够的资金UPDATE accts SET bal = bal  - ：trans_amt WHERE acctid =：acct_num;： status：='Debit applied'; ELSE：status：='资金不足'; END IF; ELSE：status：='无效类型：'||：trans_type; END IF; COMMIT; EXCEPTION NO_DATA_FOUND或不存在那么：状态： ='不存在的帐户';等等，然后err_msg：= SUBSTR（SQLERRM，1,70）;: status：='错误：'|| err_msg; END; END-EXEC; / * ---- -------------结束PL / SQL块----------------------- * / printf（“\ nStatus：％ s \ n“，状态）; } exit（0）; } void sql_error（）{EXEC SQL WHENEVER SQLERROR CONTINUE; EXEC SQL ROLLBACK工作版; printf（“处理错误\ n”）;出口（1）; }</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="LNPCC3410"></a><div class="props_rev_3"><a id="GUID-41DF2AB2-FCB7-4C3D-B394-26D09F376697" name="GUID-41DF2AB2-FCB7-4C3D-B394-26D09F376697"></a><h4 id="LNPCC-GUID-41DF2AB2-FCB7-4C3D-B394-26D09F376697" class="sect4"><span class="enumeration_section">7.3.3</span> VARCHAR Pseudotype</h4>
                  <div>
                     <p>您可以使用VARCHAR数据类型声明可变长度字符串。如果VARCHAR是输入主变量，则必须告诉Oracle预期的长度。因此，将length组件设置为存储在字符串组件中的值的实际长度。</p>
                     <p>如果VARCHAR是输出主机变量，Oracle会自动设置长度组件。但是，要在PL / SQL块中使用VARCHAR（以及CHARZ和STRING）输出主机变量，必须<span class="italic">在</span>进入块<span class="italic">之前</span>初始化长度组件。因此，将length组件设置为VARCHAR的声明（最大）长度，如下所示：<a id="d33328e541" class="indexterm-anchor"></a><a id="d33328e545" class="indexterm-anchor"></a></p><pre class="oac_no_warn" dir="ltr">int emp_number; varchar emp_name [10];浮动工资; ...emp_name.len = 10; / * initialize length component * / EXEC SQL EXECUTE BEGIN SELECT ename，sal INTO：emp_name ,: salary FROM emp WHERE empno =：emp_number; ...结束; END-EXEC; ...
</pre></div>
               </div><a id="LNPCC3411"></a><div class="props_rev_3"><a id="GUID-5B101D5D-041A-42BA-8EC7-BDED4155BEA7" name="GUID-5B101D5D-041A-42BA-8EC7-BDED4155BEA7"></a><h4 id="LNPCC-GUID-5B101D5D-041A-42BA-8EC7-BDED4155BEA7" class="sect4"><span class="enumeration_section">7.3.4</span>限制</h4>
                  <div>
                     <p>不要在PL / SQL块中使用C指针或数组语法。PL / SQL编译器不理解C主机变量表达式，因此无法解析它们。例如，以下内容<span class="italic">无效</span> ：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL EXECUTE BEGIN：x [5] .name：='SCOTT'; ...结束; END-EXEC;</pre><p>要避免语法错误，请使用占位符（临时变量）来保存结构字段的地址以填充结构，如以下<span class="italic">有效</span>示例所示：</p><pre class="oac_no_warn" dir="ltr">name = x [5] .name; EXEC SQL EXECUTE BEGIN：name：= ...; ...结束; END-EXEC;</pre></div>
               </div>
            </div><a id="LNPCC3412"></a><div class="props_rev_3"><a id="GUID-BC7145CA-5296-4287-B7E4-0D2A52CE2B70" name="GUID-BC7145CA-5296-4287-B7E4-0D2A52CE2B70"></a><h3 id="LNPCC-GUID-BC7145CA-5296-4287-B7E4-0D2A52CE2B70" class="sect3"><span class="enumeration_section">7.4</span>指标变量</h3>
               <div>
                  <p>PL / SQL不需要指示符变量，因为它可以操作NULL。例如，在PL / SQL中，您可以使用IS NULL运算符来测试NULL，如下所示： <a id="d33328e585" class="indexterm-anchor"></a> 
                  </p><pre class="oac_no_warn" dir="ltr">IF变量IS NULL那么......
</pre><p>并且，您可以使用赋值运算符（：=）来分配NULL，如下所示：</p><pre class="oac_no_warn" dir="ltr">变量：= NULL;</pre><p>但是，诸如C之类的宿主语言需要指示符变量，因为它无法操作NULL。嵌入式PL / SQL通过让您使用指示符变量来满足此需求</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>接受来自主程序的NULL输入</p>
                     </li>
                     <li>
                        <p>将NULL或截断值输出到宿主程序</p>
                     </li>
                  </ul>
                  <p>在PL / SQL块中使用时，指示符变量遵循以下规则：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>您不能单独引用指标变量;它必须附加到其关联的主变量。</p>
                     </li>
                     <li>
                        <p>如果您使用其指示符变量引用主变量，则必须始终在同一块中以该方式引用它。</p>
                     </li>
                  </ul>
                  <p>在下面的示例中，指示符变量<span class="italic">ind_comm</span>在SELECT语句中显示其主机变量<span class="italic">Commission</span> ，因此它必须以这种方式出现在IF语句中：</p><pre class="oac_no_warn" dir="ltr">...EXEC SQL EXECUTE BEGIN SELECT ename，comm INTO：emp_name，：commission：ind_comm FROM emp WHERE empno =：emp_number; IF：佣金：ind_comm IS NULL那么.........结束; END-EXEC;</pre><p>请注意，PL / SQL对待<span class="italic">：委托：ind_comm</span>与任何其他简单变量一样。虽然您不能直接引用PL / SQL块中的指示符变量，但PL / SQL在进入块时会检查指示符变量的值，并在退出块时正确设置值。
                  </p>
               </div><a id="LNPCC3413"></a><div class="props_rev_3"><a id="GUID-1A79CE80-DA07-456B-BE0E-435E8FB087AA" name="GUID-1A79CE80-DA07-456B-BE0E-435E8FB087AA"></a><h4 id="LNPCC-GUID-1A79CE80-DA07-456B-BE0E-435E8FB087AA" class="sect4"><span class="enumeration_section">7.4.1</span> NULL处理</h4>
                  <div>
                     <p>输入块时，如果指示符变量的值为-1，则PL / SQL会自动为主变量分配NULL。退出块时，如果主变量为NULL，PL / SQL会自动为指示符变量赋值-1。在下一个示例中，如果在输入PL / SQL块之前<span class="italic">ind_sal</span>的值为-1，则引发<span class="italic">salary_missing</span>异常。一个<span class="italic">例外</span>是命名错误条件。 <a id="d33328e649" class="indexterm-anchor"></a> 
                     </p><pre class="oac_no_warn" dir="ltr">...EXEC SQL EXECUTE BEGIN IF：salary：ind_sal IS NULL THEN RAISE salary_missing;万一; ...结束; END-EXEC; ...</pre></div>
               </div><a id="LNPCC3414"></a><div class="props_rev_3"><a id="GUID-67B13CF9-7E1D-4635-8026-BB2A91A792D8" name="GUID-67B13CF9-7E1D-4635-8026-BB2A91A792D8"></a><h4 id="LNPCC-GUID-67B13CF9-7E1D-4635-8026-BB2A91A792D8" class="sect4"><span class="enumeration_section">7.4.2</span>截断值</h4>
                  <div>
                     <p>将截断的字符串值分配给主机变量时，PL / SQL不会引发异常。但是，如果使用指示符变量，PL / SQL会将其设置为字符串的原始长度。在以下示例中，主机程序将能够通过检查<span class="italic">ind_name</span>的值来<span class="italic">判断</span>是否为<span class="italic">emp_name</span>分配了截断值： <a id="d33328e673" class="indexterm-anchor"></a> 
                     </p><pre class="oac_no_warn" dir="ltr">...EXEC SQL EXECUTE DECLARE ...new_name CHAR（10）;开始 ...：\ temp_name：ind_name：= new_name; ...结束; END-EXEC;</pre></div>
               </div>
            </div><a id="LNPCC3416"></a><a id="LNPCC3433"></a><a id="LNPCC3415"></a><div class="props_rev_3"><a id="GUID-4C56DC0E-B857-405D-B88E-93B19DD9FCF2" name="GUID-4C56DC0E-B857-405D-B88E-93B19DD9FCF2"></a><h3 id="LNPCC-GUID-4C56DC0E-B857-405D-B88E-93B19DD9FCF2" class="sect3"><span class="enumeration_section">7.5</span>主机阵列</h3>
               <div>
                  <p>您可以将输入主机数组和指示符数组传递给PL / SQL块。它们可以由BINARY_INTEGER或PLS_INTEGER类型的PL / SQL变量索引;不允许使用VARCHAR2键类型。通常，整个主机数组都会传递给PL / SQL，但您可以使用ARRAYLEN语句（稍后讨论）来指定较小的数组维度。</p>
                  <p>此外，您可以使用过程调用将主机数组中的所有值分配给PL / SQL表中的行。假设数组下标范围是<span class="italic">m</span> .. <span class="italic">n</span> ，则相应的PL / SQL表索引范围始终为1 .. <span class="italic">n</span> - <span class="italic">m</span> + 1。例如，如果数组下标范围是5 .. 10，则相应的PL / SQL表索引范围是1 ..（10  -  5 + 1）或1 ..6。
                  </p>
                  <p>在下面的示例中，将名为<span class="italic">salary</span>的数组传递给PL / SQL块，该块在函数调用中使用该数组。该函数名为<span class="italic">median，</span>因为它在一系列数字中找到中间值。其形式参数包括名为<span class="italic">num_tab</span>的PL / SQL表。函数调用将实际参数<span class="italic">salary</span>中的所有值分配给formal参数<span class="italic">num_tab</span>中的行。
                  </p><pre class="oac_no_warn" dir="ltr">...浮动工资[100]; / *填充主机数组* / EXEC SQL EXECUTE DECLARE TYPE NumTabTyp IS BINARY_INTEGER的真实索引表; median_salary REAL; n BINARY_INTEGER; ...功能中位数（num_tab NumTabTyp，n INTEGER）返回实际开始 - 计算中位数END;开始n：= 100; median_salary：=中位数（：salary，n）; ...结束; END-EXEC; ...
</pre><div class="infoboxnote" id="GUID-4C56DC0E-B857-405D-B88E-93B19DD9FCF2__GUID-AE98BE81-D407-4837-ACF5-8087FBB3E840">
                     <p class="notep1">注意：</p>
                     <p>在动态SQL方法4中，您无法使用类型为“table”的参数将主机数组绑定到PL / SQL过程。</p>
                  </div>
                  <p>您还可以使用过程调用将PL / SQL表中的所有行值分配给主机数组中的相应元素。</p>
                  <p><a href="embedded-PL-SQL.html#GUID-4C56DC0E-B857-405D-B88E-93B19DD9FCF2__CHDDCCFE" title="法律数据类型转换">表7-1</a>显示了PL / SQL表中的行值与主机数组中的元素之间的合法转换。例如，类型为LONG的主机数组与VARCHAR2，LONG，RAW或LONG RAW类型的PL / SQL表兼容。值得注意的是，它与CHAR类型的PL / SQL表不兼容。</p>
                  <div class="tblformal" id="GUID-4C56DC0E-B857-405D-B88E-93B19DD9FCF2__CHDDCCFE">
                     <p class="titleintable">表7-1 Legal数据类型转换</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="法律数据类型转换" width="100%" border="1" summary="Legal Datatype Conversions" frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="15%" id="d33328e755">PL / SQL表 - &gt;主机阵列</th>
                              <th align="left" valign="bottom" width="10%" id="d33328e762">CHAR</th>
                              <th align="left" valign="bottom" width="10%" id="d33328e766">日期</th>
                              <th align="left" valign="bottom" width="10%" id="d33328e770">长</th>
                              <th align="left" valign="bottom" width="11%" id="d33328e774">LONG RAW</th>
                              <th align="left" valign="bottom" width="11%" id="d33328e778">数</th>
                              <th align="left" valign="bottom" width="8%" id="d33328e782">生的</th>
                              <th align="left" valign="bottom" width="11%" id="d33328e786">ROWID</th>
                              <th align="left" valign="bottom" width="13%" id="d33328e790">VARCHAR2</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="15%" id="d33328e796" headers="d33328e755 ">
                                 <p>CHARF</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e796 d33328e762 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e796 d33328e766 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e796 d33328e770 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e796 d33328e774 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e796 d33328e778 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="8%" headers="d33328e796 d33328e782 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e796 d33328e786 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="13%" headers="d33328e796 d33328e790 ">
                                 <p>-</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="15%" id="d33328e824" headers="d33328e755 ">
                                 <p>CHARZ</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e824 d33328e762 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e824 d33328e766 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e824 d33328e770 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e824 d33328e774 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e824 d33328e778 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="8%" headers="d33328e824 d33328e782 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e824 d33328e786 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="13%" headers="d33328e824 d33328e790 ">
                                 <p>-</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="15%" id="d33328e852" headers="d33328e755 ">
                                 <p>日期</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e852 d33328e762 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e852 d33328e766 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e852 d33328e770 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e852 d33328e774 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e852 d33328e778 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="8%" headers="d33328e852 d33328e782 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e852 d33328e786 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="13%" headers="d33328e852 d33328e790 ">
                                 <p>-</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="15%" id="d33328e880" headers="d33328e755 ">
                                 <p>DECIMAL</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e880 d33328e762 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e880 d33328e766 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e880 d33328e770 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e880 d33328e774 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e880 d33328e778 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="8%" headers="d33328e880 d33328e782 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e880 d33328e786 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="13%" headers="d33328e880 d33328e790 ">
                                 <p>-</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="15%" id="d33328e908" headers="d33328e755 ">
                                 <p>显示</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e908 d33328e762 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e908 d33328e766 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e908 d33328e770 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e908 d33328e774 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e908 d33328e778 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="8%" headers="d33328e908 d33328e782 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e908 d33328e786 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="13%" headers="d33328e908 d33328e790 ">
                                 <p>-</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="15%" id="d33328e936" headers="d33328e755 ">
                                 <p>浮动</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e936 d33328e762 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e936 d33328e766 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e936 d33328e770 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e936 d33328e774 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e936 d33328e778 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="8%" headers="d33328e936 d33328e782 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e936 d33328e786 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="13%" headers="d33328e936 d33328e790 ">
                                 <p>-</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="15%" id="d33328e964" headers="d33328e755 ">
                                 <p>整数</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e964 d33328e762 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e964 d33328e766 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e964 d33328e770 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e964 d33328e774 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e964 d33328e778 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="8%" headers="d33328e964 d33328e782 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e964 d33328e786 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="13%" headers="d33328e964 d33328e790 ">
                                 <p>-</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="15%" id="d33328e992" headers="d33328e755 ">
                                 <p>长</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e992 d33328e762 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e992 d33328e766 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e992 d33328e770 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e992 d33328e774 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e992 d33328e778 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="8%" headers="d33328e992 d33328e782 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e992 d33328e786 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="13%" headers="d33328e992 d33328e790 ">
                                 <p>-</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="15%" id="d33328e1020" headers="d33328e755 ">
                                 <p>LONG VARCHAR</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1020 d33328e762 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1020 d33328e766 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1020 d33328e770 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1020 d33328e774 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1020 d33328e778 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="8%" headers="d33328e1020 d33328e782 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1020 d33328e786 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="13%" headers="d33328e1020 d33328e790 ">
                                 <p>X</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="15%" id="d33328e1048" headers="d33328e755 ">
                                 <p>LONG VARRAW</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1048 d33328e762 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1048 d33328e766 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1048 d33328e770 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1048 d33328e774 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1048 d33328e778 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="8%" headers="d33328e1048 d33328e782 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1048 d33328e786 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="13%" headers="d33328e1048 d33328e790 ">
                                 <p>-</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="15%" id="d33328e1076" headers="d33328e755 ">
                                 <p>数</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1076 d33328e762 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1076 d33328e766 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1076 d33328e770 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1076 d33328e774 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1076 d33328e778 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="8%" headers="d33328e1076 d33328e782 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1076 d33328e786 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="13%" headers="d33328e1076 d33328e790 ">
                                 <p>-</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="15%" id="d33328e1105" headers="d33328e755 ">
                                 <p>生的</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1105 d33328e762 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1105 d33328e766 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1105 d33328e770 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1105 d33328e774 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1105 d33328e778 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="8%" headers="d33328e1105 d33328e782 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1105 d33328e786 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="13%" headers="d33328e1105 d33328e790 ">
                                 <p>-</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="15%" id="d33328e1133" headers="d33328e755 ">
                                 <p>ROWID</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1133 d33328e762 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1133 d33328e766 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1133 d33328e770 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1133 d33328e774 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1133 d33328e778 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="8%" headers="d33328e1133 d33328e782 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1133 d33328e786 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="13%" headers="d33328e1133 d33328e790 ">
                                 <p>-</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="15%" id="d33328e1161" headers="d33328e755 ">
                                 <p>串</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1161 d33328e762 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1161 d33328e766 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1161 d33328e770 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1161 d33328e774 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1161 d33328e778 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="8%" headers="d33328e1161 d33328e782 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1161 d33328e786 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="13%" headers="d33328e1161 d33328e790 ">
                                 <p>X</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="15%" id="d33328e1189" headers="d33328e755 ">
                                 <p>UNSIGNED</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1189 d33328e762 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1189 d33328e766 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1189 d33328e770 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1189 d33328e774 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1189 d33328e778 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="8%" headers="d33328e1189 d33328e782 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1189 d33328e786 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="13%" headers="d33328e1189 d33328e790 ">
                                 <p>-</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="15%" id="d33328e1217" headers="d33328e755 ">
                                 <p>VARCHAR</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1217 d33328e762 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1217 d33328e766 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1217 d33328e770 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1217 d33328e774 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1217 d33328e778 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="8%" headers="d33328e1217 d33328e782 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1217 d33328e786 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="13%" headers="d33328e1217 d33328e790 ">
                                 <p>X</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="15%" id="d33328e1245" headers="d33328e755 ">
                                 <p>VARCHAR2</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1245 d33328e762 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1245 d33328e766 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1245 d33328e770 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1245 d33328e774 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1245 d33328e778 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="8%" headers="d33328e1245 d33328e782 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1245 d33328e786 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="13%" headers="d33328e1245 d33328e790 ">
                                 <p>X</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="15%" id="d33328e1273" headers="d33328e755 ">
                                 <p>VARNUM</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1273 d33328e762 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1273 d33328e766 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1273 d33328e770 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1273 d33328e774 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1273 d33328e778 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="8%" headers="d33328e1273 d33328e782 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1273 d33328e786 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="13%" headers="d33328e1273 d33328e790 ">
                                 <p>-</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="15%" id="d33328e1301" headers="d33328e755 ">
                                 <p>VARRAW</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1301 d33328e762 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1301 d33328e766 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="10%" headers="d33328e1301 d33328e770 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1301 d33328e774 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1301 d33328e778 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="8%" headers="d33328e1301 d33328e782 ">
                                 <p>X</p>
                              </td>
                              <td align="left" valign="top" width="11%" headers="d33328e1301 d33328e786 ">
                                 <p>-</p>
                              </td>
                              <td align="left" valign="top" width="13%" headers="d33328e1301 d33328e790 ">
                                 <p>-</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <div class="infoboxnote" id="GUID-4C56DC0E-B857-405D-B88E-93B19DD9FCF2__GUID-C4253D89-9342-423A-9969-49A5BAB10AB6">
                     <p class="notep1">注意：</p>
                     <p>Pro * C / C ++预编译器不会检查您对主机阵列的使用情况。例如，不进行索引范围检查。</p>
                  </div>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="Oracle-dynamic-SQL.html#GUID-AFD0B0E4-4B76-4AA9-AA4D-1027A620634E">使用方法4</a></li>
                        <li><a href="embedded-PL-SQL.html#GUID-65965251-9158-442D-A69B-D52A33B35E22">存储的PL / SQL和Java子程序</a></li>
                     </ul>
                  </div>
               </div>
               <a id="LNPCC3417"></a><div class="props_rev_3"><a id="GUID-F20E0407-E9BF-4160-8E75-7CE21CCF5C64" name="GUID-F20E0407-E9BF-4160-8E75-7CE21CCF5C64"></a><h4 id="LNPCC-GUID-F20E0407-E9BF-4160-8E75-7CE21CCF5C64" class="sect4"><span class="enumeration_section">7.5.1</span> ARRAYLEN声明</h4>
                  <div>
                     <p>假设您必须将输入主机数组传递给PL / SQL块进行处理。默认情况下，绑定此类主机阵列时，Pro * C / C ++预编译器将使用其声明的维度。但是，您可能不想处理整个阵列。在这种情况下，您可以使用ARRAYLEN语句指定较小的数组维度。ARRAYLEN将主机数组与主变量相关联，主变量存储较小的维度。语句语法是<a id="d33328e1357" class="indexterm-anchor"></a> 
                     </p><pre class="oac_no_warn" dir="ltr">EXEC SQL ARRAYLEN host_array（dimension）[EXECUTE];</pre><p>其中<span class="italic">dimension</span>是一个4字节的整数主变量， <span class="italic">而不是</span>文字或表达式。
                     </p>
                     <p>EXECUTE是一个可选的关键字。</p>
                     <p>ARRAYLEN语句必须与<span class="italic">host_array</span>和<span class="italic">dimension</span>的声明一起出现，但在其后的某处。您无法在主机阵列中指定偏移量。但是，您可以将C功能用于此目的。以下示例使用ARRAYLEN覆盖名为<span class="italic">bonus</span>的C主机数组的默认维度：</p><pre class="oac_no_warn" dir="ltr">浮动奖金[100]; int维; EXEC SQL ARRAYLEN奖金（维度）; / *填充主机数组* / ...维度= 25; / *设置较小的数组维度* / EXEC SQL EXECUTE DECLARE TYPE NumTabTyp是真实索引表BINARY_INTEGER; median_bonus REAL;功能中位数（num_tab NumTabTyp，n INTEGER）返回实际开始 - 计算中位数END; BEGIN median_bonus：=中位数（：奖金，：维度）; ...结束; END-EXEC;</pre><p>只有25个数组元素传递给PL / SQL块，因为ARRAYLEN将数组从100个元素减少到25个元素。因此，当PL / SQL块被发送到Oracle执行时，会发送一个小得多的主机阵列。这节省了时间，并且在网络环境中减少了网络流量。</p>
                  </div>
               </div><a id="LNPCC3418"></a><div class="props_rev_3"><a id="GUID-71BE5189-C875-4180-8B39-A16887CD27C2" name="GUID-71BE5189-C875-4180-8B39-A16887CD27C2"></a><h4 id="LNPCC-GUID-71BE5189-C875-4180-8B39-A16887CD27C2" class="sect4"><span class="enumeration_section">7.5.2</span>可选关键字EXECUTE</h4>
                  <div>
                     <p>动态SQL方法中使用的主机数组2 EXEC SQL EXECUTE语句可能有两种不同的解释，基于可选关键字EXECUTE的存在与否。</p>
                     <p>默认情况下（如果ARRAYLEN语句中不存在EXECUTE关键字）：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>在确定PL / SQL块执行的次数时，会考虑主机阵列。（使用最小数组维度。）</p>
                        </li>
                        <li>
                           <p>主机数组不得绑定到PL / SQL索引表。</p>
                        </li>
                     </ul>
                     <p>如果存在关键字EXECUTE：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>主机数组必须绑定到索引表。</p>
                        </li>
                        <li>
                           <p>PL / SQL块将被执行一次。</p>
                        </li>
                        <li>
                           <p>EXEC SQL EXECUTE语句中指定的所有主机变量都必须</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>在ARRAYLEN中指定......执行声明</p>
                              </li>
                              <li>
                                 <p>是标量。</p>
                              </li>
                           </ul>
                        </li>
                     </ul>
                     <p>例如，给定以下PL / SQL过程：</p><pre class="oac_no_warn" dir="ltr">创建或替换包装pkg AS TYPE选项卡是数字表（5）索引由BINARY_INTEGER; PROCEDURE proc1（parm1 tab，parm2 NUMBER，parm3 tab）;结束;</pre><p>以下Pro * C / C ++函数演示了如何使用主机数组来确定给定PL / SQL块的执行次数。在这种情况下，PL / SQL块将被执行3次，导致<code class="codeph">emp</code>表中有3个新行。
                     </p><pre class="oac_no_warn" dir="ltr">func1（）{int empno_arr [5] = {1111,2222,3333,4444,5555}; char * ename_arr [3] = {“MICKEY”，“MINNIE”，“GOOFY”}; char * stmt1 =“BEGIN INSERT INTO emp（empno，ename）VALUES：b1，：b2; END;”; EXEC SQL PREPARE s1 FROM：stmt1; EXEC SQL EXECUTE s1使用：empno_arr，：ename_arr; }</pre><p>以下Pro * C / C ++函数演示了如何通过动态方法2将主机数组绑定到PL / SQL索引表。注意ARRAYLEN的存在......EXECUTE语句，用于EXEC SQL EXECUTE语句中指定的所有主机数组。</p><pre class="oac_no_warn" dir="ltr">func2（）{int ii = 2; int int_tab [3] = {1,2,3}; int dim = 3; EXEC SQL ARRAYLEN int_tab（dim）EXECUTE; char * stmt2 =“begin pkg.proc1（：v1，：v2，：v3）; end;”; EXEC SQL PREPARE s2 FROM：stmt2; EXEC SQL EXECUTE s2使用：int_tab，：ii，：int_tab; }</pre><p>但是，以下Pro * C / C ++函数将导致预编译时警告，因为没有ARRAYLEN ...<code class="codeph">int_arr</code> EXECUTE语句。
                     </p><pre class="oac_no_warn" dir="ltr">func3（）{int int_arr [3]; int int_tab [3] = {1,2,3}; int dim = 3; EXEC SQL ARRAYLEN int_tab（dim）EXECUTE; char * stmt3 =“begin pkg.proc1（：v1，：v2，：v3）; end;”; EXEC SQL PREPARE s3 FROM：stmt3; EXEC SQL EXECUTE s3使用：int_tab，：int_arr，：int_tab; }</pre></div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="Oracle-dynamic-SQL.html#GUID-7B34257D-1DB8-4D5D-968B-4DA73F0683F2">使用方法2</a></li>
                           <li><a href="host-arrays.html#GUID-6B57FBAE-0303-41B9-9056-5C20384442B7">主机阵列</a></li>
                        </ul>
                     </div>
                  </div>
                  
               </div>
            </div><a id="LNPCC3419"></a><div class="props_rev_3"><a id="GUID-117968E7-E597-4448-AC5D-581BF1361E2C" name="GUID-117968E7-E597-4448-AC5D-581BF1361E2C"></a><h3 id="LNPCC-GUID-117968E7-E597-4448-AC5D-581BF1361E2C" class="sect3"><span class="enumeration_section">7.6</span>嵌入式PL / SQL中的游标用法</h3>
               <div>
                  <p>程序可以同时使用的最大游标数由数据库初始化参数OPEN_CURSORS确定。执行嵌入式PL / SQL块时，一个游标。父光标与整个块相关联，一个光标（子光标）与嵌入式PL / SQL块中的每个SQL语句相关联。父级和子级游标都计入<code class="codeph">OPEN_CURSORS</code>限制。
                  </p>
                  <p>以下计算显示如何确定使用的最大游标数。使用的游标总和不得超过<code class="codeph">OPEN_CURSORS</code> 。</p><pre class="oac_no_warn" dir="ltr">SQL语句游标PL / SQL父游标PL / SQL子游标+ 6个游标用于开销--------------------------正在使用的游标总和</pre><p>如果您的程序超出了<code class="codeph">OPEN_CURSORS</code>强加的限制，Oracle会给您一个错误。
                  </p>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="performance-tuning.html#GUID-989DD868-1723-48B9-B153-0233ED8BA776">嵌入式PL / SQL注意事项</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="LNPCC3420"></a><div class="props_rev_3"><a id="GUID-65965251-9158-442D-A69B-D52A33B35E22" name="GUID-65965251-9158-442D-A69B-D52A33B35E22"></a><h3 id="LNPCC-GUID-65965251-9158-442D-A69B-D52A33B35E22" class="sect3"><span class="enumeration_section">7.7</span>存储的PL / SQL和Java子程序</h3>
               <div>
                  <p>与匿名块不同，PL / SQL子程序（过程和函数）和Java方法可以单独编译，存储在Oracle数据库中，然后调用。</p>
                  <p>使用Oracle工具（如SQL * Plus）显式创建的子程序称为<span class="italic">存储</span>子程序。一旦编译并存储在数据字典中，它就是一个数据库对象，可以在不重新编译的情况下重新执行。<a id="d33328e1520" class="indexterm-anchor"></a></p>
                  <p>当PL / SQL块或存储过程中的子程序由应用程序发送到Oracle时，它称为<span class="italic">内联</span>子程序。Oracle编译内联子程序并将其缓存在系统全局区域（SGA）中，但不将源代码或目标代码存储在数据字典中。<a id="d33328e1529" class="indexterm-anchor"></a></p>
                  <p>程序包中定义的子程序被视为程序包的一部分，因此称为<span class="italic">打包的</span>子程序。未在包中定义的存储子程序称为<span class="italic">独立</span>子程序。 <a id="d33328e1539" class="indexterm-anchor"></a> 
                  </p>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="../jjdev/Java-applications-in-database.html#JJDEV-GUID-E7EEC053-2CAC-4A5D-8C90-EBFD047D32F7" target="_blank"><span class="italic">Oracle数据库上的Java应用程序</span></a></li>
                     </ul>
                  </div>
               </div><a id="LNPCC3421"></a><div class="props_rev_3"><a id="GUID-90FFC7F7-C299-48BF-BFB1-A7850F46D486" name="GUID-90FFC7F7-C299-48BF-BFB1-A7850F46D486"></a><h4 id="LNPCC-GUID-90FFC7F7-C299-48BF-BFB1-A7850F46D486" class="sect4"><span class="enumeration_section">7.7.1</span>关于创建存储的子程序</h4>
                  <div>
                     <p>您可以在宿主程序中嵌入SQL语句CREATE FUNCTION，CREATE PROCEDURE和CREATE PACKAGE，如以下示例所示：<a id="d33328e1561" class="indexterm-anchor"></a><a id="d33328e1565" class="indexterm-anchor"></a></p><pre class="oac_no_warn" dir="ltr">EXEC SQL CREATE FUNCTION sal_ok（salary REAL，title CHAR）RETURN BOOLEAN as min_sal REAL; max_sal REAL; BEGIN SELECT losal，hisal INTO min_sal，max_sal FROM sals WHERE job = title;返回（工资&gt; = min_sal）AND（工资&lt;= max_sal）;结束sal_ok; END-EXEC;</pre><p>请注意嵌入的CREATE {FUNCTION |程序| PACKAGE}语句是混合语句。与所有其他嵌入式CREATE语句一样，它以关键字EXEC SQL（不是EXEC SQL EXECUTE）开头。但是，与其他嵌入式CREATE语句不同，它以PL / SQL终止符END-EXEC结束。</p>
                     <p>在稍后的示例中，您将创建一个包含名为<span class="italic">get_employees</span>的过程的包，该过程从EMP表中提取一批行。批量大小由过程的调用者确定，该调用者可能是另一个存储的子程序或客户端应用程序。
                     </p>
                     <p>该过程将三个PL / SQL表声明为OUT形式参数，然后将一批员工数据提取到PL / SQL表中。匹配的实际参数是主机阵列。该过程完成后，它会自动将PL / SQL表中的所有行值分配给主机阵列中的相应元素。</p><pre class="oac_no_warn" dir="ltr">EXEC SQL CREATE或REPLACE PACKAGE emp_actions AS TYPE CharArrayTyp IS TABLE OF VARCHAR2（10）INDEX BY BINARY_INTEGER; TYPE NumArrayTyp是BINARY_INTEGER的FLOAT INDEX表;程序get_employees（dept_number IN INTEGER，batch_size IN INTEGER，找到IN OUT INTEGER，done_fetch OUT INTEGER，emp_name OUT CharArrayTyp，job_title OUT CharArrayTyp，salary OUT NumArrayTyp）; END emp_actions; END-EXEC; EXEC SQL CREATE或REPLACE PACKAGE BODY emp_actions AS CURSOR get_emp（dept_number IN INTEGER）是SELECT ename，job，sal FROM emp WHERE deptno = dept_number;程序get_employees（dept_number IN INTEGER，batch_size IN INTEGER，找到IN OUT INTEGER，done_fetch OUT INTEGER，emp_name OUT CharArrayTyp，job_title OUT CharArrayTyp，salary OUT NumArrayTyp）如果不是get_emp％ISOPEN则打开get_emp（dept_number）;万一; done_fetch：= 0;发现：= 0; FOR i IN 1..batch_size LOOP FETCH get_emp INTO emp_name（i），job_title（i），salary（i）;如果get_emp％NOTFOUND那么关闭get_emp; done_fetch：= 1;出口; ELSE发现：=找到+ 1;万一;结束循环; END get_employees; END emp_actions; END-EXEC;</pre><p>您在CREATE语句中指定REPLACE子句以重新定义现有包，而不必删除包，重新创建它，并重新授予它。有关CREATE语句的完整语法，请参阅<a href="../sqlrf/SQL-Statements-COMMIT-to-CREATE-JAVA.html#SQLRF-GUID-A087EE75-DE65-4AA6-A479-280413DB74C8" target="_blank">SQL语句：COMMIT to CREATE JAVA</a> 。</p>
                     <p>如果是嵌入式CREATE {FUNCTION |程序| PACKAGE}语句失败，Oracle生成警告，而不是错误。</p>
                  </div>
               </div><a id="LNPCC3422"></a><div class="props_rev_3"><a id="GUID-F20A70DA-AF53-41CB-82CA-D2DA5B77E4A5" name="GUID-F20A70DA-AF53-41CB-82CA-D2DA5B77E4A5"></a><h4 id="LNPCC-GUID-F20A70DA-AF53-41CB-82CA-D2DA5B77E4A5" class="sect4"><span class="enumeration_section">7.7.2</span>关于调用存储的PL / SQL或Java子程序</h4>
                  <div>
                     <div class="section">
                        <p>要从宿主程序中调用存储的子程序，可以使用匿名PL / SQL块或CALL嵌入式SQL语句。</p>
                     </div>
                     <!-- class="section" -->
                  </div><a id="LNPCC3423"></a><div class="props_rev_3"><a id="GUID-50FAE0D7-E6EB-48FE-9440-A88FA27E8C34" name="GUID-50FAE0D7-E6EB-48FE-9440-A88FA27E8C34"></a><h5 id="LNPCC-GUID-50FAE0D7-E6EB-48FE-9440-A88FA27E8C34" class="sect5"><span class="enumeration_section">7.7.2.1</span>匿名PL / SQL块</h5>
                     <div>
                        <p>在以下示例中，您将调用名为<span class="italic">raise_salary</span>的独立过程： <a id="d33328e1617" class="indexterm-anchor"></a> 
                        </p><pre class="oac_no_warn" dir="ltr">EXEC SQL EXECUTE BEGIN raise_salary（：emp_id，：increase）;结束; END-EXEC;</pre><p>请注意，存储的子程序可以采用参数。在此示例中，实际参数<span class="italic">emp_id</span>和<span class="italic">increase</span>是C主变量。
                        </p>
                        <p>在下一个示例中，过程<span class="italic">raise_salary</span>存储在名为<span class="italic">emp_actions</span>的包中，因此必须使用点表示法来完全限定过程调用：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL EXECUTE BEGIN emp_actions.raise_salary（：emp_id，：increase）;结束; END-EXEC;</pre><p>实际的IN参数可以是文字，标量主变量，主机数组，PL / SQL常量或变量，PL / SQL表，PL / SQL用户定义记录，过程调用或表达式。但是，实际的OUT参数不能是文字，过程调用或表达式。</p>
                        <p>必须将预编译器选项SQLCHECK = SEMANTICS与嵌入式PL / SQL块一起使用。</p>
                        <p>在以下示例中，三个形式参数是PL / SQL表，相应的实际参数是主机数组。程序重复调用存储过程<span class="italic">get_employees</span> ，显示每批员工数据，直到找不到更多数据。该程序可在<code class="codeph">demo</code>目录中的<code class="codeph">sample9.pc</code>文件中<code class="codeph">sample9.pc</code> 。一个SQL脚本来创建存储CALLDEMO包是在文件中提供<code class="codeph">calldemo.sql</code> 。 <a id="d33328e1660" class="indexterm-anchor"></a><a id="d33328e1664" class="indexterm-anchor"></a><a id="d33328e1669" class="indexterm-anchor"></a> 
                        </p><pre class="oac_no_warn" dir="ltr">/ ******************* ************示例程序9：调用存储过程该程序使用SCOTT / TIGER帐户连接到ORACLE。程序声明了几个主机数组，然后调用填充表OUT参数的PL / SQL存储过程（CALLDEMO包中的GET_EMPLOYEES）。PL / SQL过程返回ASIZE值。Sample9不断调用GET_EMPLOYEES，每次都获取ASIZE数组，并打印值，直到检索完所有行。GET_EMPLOYEES设置done_flag以指示“不再有数据”。 ************************************************** *********** / #include &lt;stdio.h&gt; #include &lt;string.h&gt; EXEC SQL INCLUDE sqlca.h; typedef char asciz [20]; typedef char vc2_arr [11]; EXEC SQL BEGIN DECLARE SECTION; / *以null结尾的字符串的用户定义类型* / EXEC SQL TYPE asciz IS STRING（20）REFERENCE; / * VARCHAR数组元素的用户定义类型。* / EXEC SQL TYPE vc2_arr IS VARCHAR2（11）参考; asciz用户名; asciz密码; int dept_no; / *哪个部门要查询？* / vc2_arr emp_name [10]; / *返回名称数组* / vc2_arr job [10];浮动工资[10]; int done_flag; int array_size; int num_ret; / *返回的行数* / EXEC SQL END DECLARE SECTION;长SQLCODE; void print_rows（）; / *产生程序输出* / void sql_error（）; / *处理不可恢复的错误* / main（）{int i; char temp_buf [32]; / *连接到ORACLE。 * / EXEC SQL WHENEVER SQLERROR DO sql_error（）; strcpy（用户名，“scott”）; strcpy（密码，“老虎”）; EXEC SQL CONNECT：用户名IDENTIFIED BY：密码; printf（“\ n以用户身份连接到ORACLE：％s \ n \ n”，用户名）; printf（“输入部门编号：”）;得到（temp_buf）; dept_no = atoi（temp_buf）; / *打印列标题。* / printf（“\ n \ n”）; printf（“％ -  10.10s％-10.10s％s \ n”，“员工”，“工作”，“薪水”）; printf（“％ -  10.10s％-10.10s％s \ n”，“--------”，“---”，“------”）; / *设置数组大小。* / array_size = 10; done_flag = 0; num_ret = 0; / *数组获取循环。*循环继续，直到OUT参数done_flag被设置。*传入部门编号，数组大小 -  *获取姓名，工作和工资。* / for（;;）{EXEC SQL EXECUTE BEGIN calldemo.get_employees（：dept_no，：array_size，：num_ret，：done_flag，：emp_name，：job，：salary）;结束; END-EXEC; print_rows（num_ret）;如果（done_flag）中断; } / *断开与数据库的连接。* / EXEC SQL COMMIT WORK RELEASE;出口（0）; } void print_rows（n）int n; {int i; if（n == 0）{printf（“没有检索到的行。\ n”）;返回; } for（i = 0; i &lt;n; i ++）printf（“％10.10s％10.10s％6.2f \ n”，emp_name [i]，job [i]，salary [i]）; } / *处理错误。退出任何错误。* / void sql_error（）{char msg [512]; int buf_len，msg_len; EXEC SQL WHENEVER SQLERROR CONTINUE; buf_len = sizeof（msg）; sqlglm（msg，＆buf_len，＆msg_len）; printf（“检测到\ nORACLE错误：”）; printf（“\ n％。* s \ n”，msg_len，msg）; EXEC SQL ROLLBACK工作版;出口（1）; }</pre><p>请记住，每个实际参数的数据类型必须可以转换为其相应形式参数的数据类型。此外，在退出存储过程之前，必须为所有OUT形式参数分配值。否则，相应的实际参数的值是不确定的。</p>
                        <p>使用匿名PL / SQL块时需要SQLCHECK = SEMANTICS。</p>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="embedded-PL-SQL.html#GUID-90FFC7F7-C299-48BF-BFB1-A7850F46D486">关于创建存储的子程序</a></li>
                           </ul>
                        </div>
                     </div>
                     
                  </div><a id="LNPCC3424"></a><div class="props_rev_3"><a id="GUID-563E1A04-F241-4617-AA62-AC3E75377A00" name="GUID-563E1A04-F241-4617-AA62-AC3E75377A00"></a><h5 id="LNPCC-GUID-563E1A04-F241-4617-AA62-AC3E75377A00" class="sect5"><span class="enumeration_section">7.7.2.2</span>远程访问</h5>
                     <div>
                        <p>PL / SQL允许您使用<span class="italic">数据库链接</span>访问远程数据库。通常，数据库链接由DBA建立并存储在Oracle数据字典中。数据库链接告诉Oracle远程数据库的位置，路径，以及要使用的Oracle用户名和密码。在以下示例中，您使用数据库链接<span class="italic">dallas</span>来调用<span class="italic">raise_salary</span>过程：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL EXECUTE BEGIN raise_salary @dallas（：emp_id，：increase）;结束; END-EXEC;</pre><p>您可以创建同义词以提供远程子程序的位置透明度，如以下示例所示：</p><pre class="oac_no_warn" dir="ltr">CREATE PUBLIC SYNONYM raise_salary FOR raise_salary @dallas;</pre></div>
                  </div><a id="LNPCC3425"></a><div class="props_rev_3"><a id="GUID-034F0DCE-9061-4DAA-9941-6E2E543C0F34" name="GUID-034F0DCE-9061-4DAA-9941-6E2E543C0F34"></a><h5 id="LNPCC-GUID-034F0DCE-9061-4DAA-9941-6E2E543C0F34" class="sect5"><span class="enumeration_section">7.7.2.3</span> CALL声明</h5>
                     <div>
                        <p>前面介绍的嵌入式PL / SQL块的概念也适用于CALL语句。CALL嵌入式SQL语句具有以下形式：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL CALL [schema。] [package。] stored_proc [@db_link]（arg1，...）[INTO：ret_var [[INDICATOR]：ret_ind]];</pre><p>哪里</p>
                        <p>模式</p>
                        <p>包含该过程的模式</p>
                        <p>包</p>
                        <p>包含程序的包</p>
                        <p>stored_proc</p>
                        <p>是要调用的Java或PL / SQL存储过程</p>
                        <p>db_link</p>
                        <p>是可选的远程数据库链接</p>
                        <p>ARG1 ...</p>
                        <p>是传递的参数（变量，文字或表达式）的列表，</p>
                        <p>ret_var</p>
                        <p>是接收结果的可选主变量</p>
                        <p>ind_var</p>
                        <p>ret_var的可选指示符变量。</p>
                        <p>您可以使用SQLCHECK = SYNTAX或SEMANTICS与CALL语句。</p>
                     </div>
                  </div><a id="LNPCC3426"></a><div class="props_rev_3"><a id="GUID-E828F0DF-6DFF-489D-953C-078654DFECEF" name="GUID-E828F0DF-6DFF-489D-953C-078654DFECEF"></a><h5 id="LNPCC-GUID-E828F0DF-6DFF-489D-953C-078654DFECEF" class="sect5"><span class="enumeration_section">7.7.2.4</span> CALL示例</h5>
                     <div>
                        <p>如果您已经创建了一个PL / SQL函数<code class="codeph">fact</code> （保存在包装<code class="codeph">mathpkg</code> ），其采用整数作为输入和一个整数返回其阶乘：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL CREATE或REPLACE PACKAGE BODY mathpkg as function fact（n IN INTEGER）RETURN INTEGER as BEGIN IF（n &lt;= 0）然后返回1; ELSE返回n * fact（n  -  1）;万一;结论;结束mathpkge; END-EXEC。</pre><p>然后使用CALL语句在Pro * C / C ++应用程序中使用<code class="codeph">fact</code> ：</p><pre class="oac_no_warn" dir="ltr">...int num，fact; ...EXEC SQL CALL mathpkge.fact（：num）INTO：fact; ...
</pre><div class="infoboxnotealso" id="GUID-E828F0DF-6DFF-489D-953C-078654DFECEF__GUID-CFAAEAA5-3C2C-45BA-A279-95753BFEC767">
                           <p class="notep1">也可以看看：</p>
                           <p></p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="embedded-SQL-statements-and-directives.html#GUID-F28B8E6F-1CF5-49D1-86F4-13CD01475BB1">CALL（可执行嵌入式SQL）</a> ”</span>以获取有关CALL语句的更多信息。
                                 </p>
                              </li>
                              <li>
                                 <p><a href="../adfns/index.html" target="_blank"><span class="italic">Oracle数据库高级应用程序开发人员指南</span></a> ，有关传递参数和其他问题的完整说明。
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div><a id="LNPCC3427"></a><div class="props_rev_3"><a id="GUID-57F71170-7A70-4938-9F1F-F3B6DFEA88A3" name="GUID-57F71170-7A70-4938-9F1F-F3B6DFEA88A3"></a><h4 id="LNPCC-GUID-57F71170-7A70-4938-9F1F-F3B6DFEA88A3" class="sect4"><span class="enumeration_section">7.7.3</span>关于获取存储子程序的信息</h4>
                  <div>
                     <div class="infoboxnote" id="GUID-57F71170-7A70-4938-9F1F-F3B6DFEA88A3__GUID-02B7881D-07F3-463B-91C2-8C19964E34E6">
                        <p class="notep1">注意：</p>
                        <p>Oracle <span class="italic">不再支持</span>登录数据区（LDA）。在Pro * C / C ++程序中嵌入OCI Release 7调用的能力将在下一个主要的Oracle版本中逐步淘汰。
                        </p>
                     </div>
                     <p><a href="datatypes-and-host-variables.html#GUID-18395E0D-263A-49BF-9DAB-DA0C8775B9FC">数据类型和主机变量</a>描述了如何在主机程序中嵌入OCI调用。在调用库例程SQLLDA以设置LDA之后，使用OCI调用<span class="italic">odessp</span>获取有关存储的子程序的有用信息。当你调用<span class="italic">odessp时</span> ，你必须传递一个有效的LDA和子程序的名称。对于打包的子程序，还必须传递包的名称。 <span class="italic">odessp</span>返回有关每个子程序参数的信息，例如其数据类型，大小，位置等。
                     </p>
                     <p>您还可以在DBMS_DESCRIBE包中使用DESCRIBE_PROCEDURE存储过程。</p>
                  </div>
               </div>
            </div><a id="LNPCC3428"></a><div class="props_rev_3"><a id="GUID-2191B843-36C4-4936-B0F5-97AB0AB8CDEA" name="GUID-2191B843-36C4-4936-B0F5-97AB0AB8CDEA"></a><h3 id="LNPCC-GUID-2191B843-36C4-4936-B0F5-97AB0AB8CDEA" class="sect3"><span class="enumeration_section">7.8</span>外部程序</h3>
               <div>
                  <p>PL / SQL可以调用外部过程的C函数。外部过程（也称为外部过程）存储在动态链接库（DLL）中，或者存储在Solaris下的<span class="italic">.so</span>库中。
                  </p>
                  <p>如果外部过程在服务器端执行，它可以回调到服务器以在同一事务中执行SQL和PL / SQL。服务器上的外部过程执行速度快于客户端，并且可以将数据库服务器与外部系统和数据源连接。</p>
                  <p>为了执行服务器端外部C函数，必须在该函数内使用REGISTER CONNECT嵌入式SQL语句。该语句的语法是：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL REGISTER连接使用：epctx [RETURNING：host_context];</pre><p>其中<code class="codeph">epctx</code>是外部过程上下文（指向<code class="codeph">OCIExtProcContext</code>的类型指针）。 <code class="codeph">epctx</code>通过PL / SQL传递给过程。</p>
                  <p><code class="codeph">host_context</code>是外部过程返回的运行时上下文。目前，它是默认（全局）上下文。
                  </p>
                  <p>REGISTER CONNECT语句将返回与当前Oracle连接和事务关联的OCI句柄集（OCIEnv，OCISvcCtx和OCIError）。然后，这些句柄用于为全局SQLLIB运行时上下文定义Pro * C / C ++默认的未命名连接。因此，使用REGISTER CONNECT语句<span class="italic">而不是</span> CONNECT语句。
                  </p>
                  <p>后续嵌入式SQL语句将使用这组OCI句柄。它们针对全局SQLLIB运行时上下文和未命名的连接执行，即使是那些处于单独预编译单元中的连接。未见未提交的更改。将来，可以在可选的RETURNING子句中返回（非默认）运行时上下文。</p>
                  <p>全局运行时上下文不能存在任何活动的默认连接。如果在连接已存在时尝试使用REGISTER CONNECT，则会返回运行时错误。</p>
                  <p>在实际情况中，外部过程应该是可以从许多不同应用程序重用的过程。</p>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="../lnoci/index.html" target="_blank"><span><cite>Oracle调用接口程序员指南</cite></span></a></li>
                     </ul>
                  </div>
               </div><a id="LNPCC3429"></a><div class="props_rev_3"><a id="GUID-1FC8608C-A8FD-4801-BC99-0AEC2DA1470C" name="GUID-1FC8608C-A8FD-4801-BC99-0AEC2DA1470C"></a><h4 id="LNPCC-GUID-1FC8608C-A8FD-4801-BC99-0AEC2DA1470C" class="sect4"><span class="enumeration_section">7.8.1</span>对外部程序的限制</h4>
                  <div>
                     <p>遵循这些外部程序规则：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>外部过程只能在C中。不支持C ++外部过程。</p>
                        </li>
                        <li>
                           <p>连接到外部过程上下文时，不允许任何其他连接，从而导致运行时错误。</p>
                        </li>
                        <li>
                           <p>不支持多线程外部过程。不允许执行EXEC SQL ENABLE THREADS语句，并且将返回运行时错误。Pro * C / C ++确实支持不使用我们描述的外部过程方法的应用程序中的多线程。</p>
                        </li>
                        <li>
                           <p>您不能使用DDL语句。它们会导致运行时错误。</p>
                        </li>
                        <li>
                           <p>您不能使用事务控制语句，例如EXEC SQL COMMIT和EXEC SQL ROLLBACK。</p>
                        </li>
                        <li>
                           <p>您不能使用对象导航语句，例如EXEC SQL OBJECT ....</p>
                        </li>
                        <li>
                           <p>您不能使用轮询EXEC SQL LOB语句。</p>
                        </li>
                        <li>
                           <p>您不能使用EXEC TOOLS语句。它们将导致运行时错误。</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="LNPCC3430"></a><div class="props_rev_3"><a id="GUID-3AA95FAE-B30C-4AB8-8AD8-EA6D6DC69828" name="GUID-3AA95FAE-B30C-4AB8-8AD8-EA6D6DC69828"></a><h4 id="LNPCC-GUID-3AA95FAE-B30C-4AB8-8AD8-EA6D6DC69828" class="sect4"><span class="enumeration_section">7.8.2</span>关于创建外部过程</h4>
                  <div>
                     <p>这是一个创建外部过程<code class="codeph">extp1</code>的简单示例。
                     </p>
                     <p>要存储外部C过程，请编译代码并将其链接到DLL等库。</p>
                     <p>参考NT删除了用户评论9561</p>
                     <p>然后使用以下SQL命令注册外部过程<code class="codeph">extp1</code> ：</p><pre class="oac_no_warn" dir="ltr">创建或替换程序extp1作为外部名称“extp1”具有上下文参数的LIBRARY mylib（上下文）;</pre><p>其中<span class="italic">mylib</span>是存储过程<span class="italic">extp1</span>的库的名称。WITH CONTEXT表示使用类型为<code class="codeph">OCIExtProcContext*</code>参数隐式调用此过程。您的调用中省略了上下文，但无论如何都会传递给过程。但是，关键字CONTEXT显示在CREATE语句中，作为位置标记。
                     </p>
                     <p>此上下文参数是<code class="codeph">extp1</code> EXEC SQL REGISTER CONNECT语句中引用的参数。
                     </p>
                     <p>以这种方式从SQL * Plus调用外部过程：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; BEGIN INSERT INTO emp VALUES（9999，'JOHNSON'，'SALESMAN'，7782，sysdate，1200,150,10）; extp1;结束;</pre><p><a id="d33328e2009" class="indexterm-anchor"></a>这是<code class="codeph">extp1.pc</code>的列表：</p><pre class="oac_no_warn" dir="ltr">void extp1（epctx）OCIExtProcContext * epctx; {char name [15]; EXEC SQL REGISTER连接使用：epctx;执行SQL WHENEVER SQLERROR转到错误; EXEC SQL SELECT ename INTO：name FROM emp WHERE empno = 9999;返回;错误：SQLExtProcError（SQL_SINGLE_RCTX，sqlca.sqlerrm.sqlerrmc，sqlca.sqlerrm.sqlerrml）;返回; }</pre></div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="../lnpls/plsql-subprograms.html#LNPLS-GUID-96B5DE2B-D809-4296-9CDE-B317B81895F8" target="_blank"><span class="italic">外部子程序</span></a></li>
                        </ul>
                     </div>
                  </div>
               </div><a id="LNPCC3431"></a><div class="props_rev_3"><a id="GUID-A7A53E22-3218-4261-8FAF-C369BDAEB2EF" name="GUID-A7A53E22-3218-4261-8FAF-C369BDAEB2EF"></a><h4 id="LNPCC-GUID-A7A53E22-3218-4261-8FAF-C369BDAEB2EF" class="sect4"><span class="enumeration_section">7.8.3</span> SQLExtProcError（）</h4>
                  <div>
                     <p>SQLLIB函数<code class="codeph">SQLExtProcError()</code>提供了在外部C过程中发生错误时将控制权返回给PL / SQL的功能。函数及其参数是：</p>
                     <p>SQLExtProcError（ctx，msg，msglen）</p>
                     <p>哪里：</p>
                     <p>ctx（IN）sql_context *</p>
                     <p>这是REGISTER CONNECT语句的目标SQLLIB运行时上下文，必须在调用此函数之前执行。现在只支持全局运行时上下文。</p>
                     <p>msg（OUT）字符*</p>
                     <p>错误消息的文本。</p>
                     <p>msglen（OUT）size_t</p>
                     <p>消息的字节长度。</p>
                     <p>执行此函数时，SQLLIB调用OCI服务函数OCIExtProcRaiseExcpWithMsg。</p>
                     <p>该消息来自SQLCA中的结构<code class="codeph">sqlerrm</code> 。</p>
                     <p>这是一个显示<code class="codeph">SQLExtProcError()</code>使用的<code class="codeph">SQLExtProcError()</code> ：</p><pre class="oac_no_warn" dir="ltr">void extp1（epctx）OCIExtProcContext * epctx; {char name [15]; EXEC SQL REGISTER连接使用：epctx;执行SQL WHENEVER SQLERROR转到错误; EXEC SQL SELECT ename INTO：name FROM emp WHERE smpno = 9999;返回;错误：SQLExtProcError（SQL_SINGLE_RCTX，sqlca.sqlerrm.sqlerrmc，sqlca.sqlerrm.sqlerrml）; printf（“\ n％* s \ n”，sqlca.sqlerrm.sqlerrml，sqlca.sqlerrm.sqlerrmc）;返回; }</pre></div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="handling-run-time-errors.html#GUID-08A1E4F0-7B6F-4166-BB8C-E9F23F6C355E">SQLCA结构</a></li>
                        </ul>
                     </div>
                  </div>
                  
               </div>
            </div><a id="LNPCC3432"></a><div class="props_rev_3"><a id="GUID-A147B827-C733-47AD-944F-BEA87FC7CAD3" name="GUID-A147B827-C733-47AD-944F-BEA87FC7CAD3"></a><h3 id="LNPCC-GUID-A147B827-C733-47AD-944F-BEA87FC7CAD3" class="sect3"><span class="enumeration_section">7.9</span>关于使用动态SQL</h3>
               <div>
                  <p>回想一下，预编译器将整个PL / SQL块视为单个SQL语句。因此，您可以将PL / SQL块存储在字符串主变量中。然后，如果块不包含主机变量，则可以使用动态SQL方法1来执行PL / SQL字符串。或者，如果块包含已知数量的主机变量，则可以使用动态SQL方法2来PREPARE和EXECUTE PL / SQL字符串。如果块包含未知数量的主机变量，则必须使用动态SQL方法4。</p>
                  <div class="infoboxnote" id="GUID-A147B827-C733-47AD-944F-BEA87FC7CAD3__GUID-CCBA43F3-B71D-4C2E-B2E5-7D266E17B50C">
                     <p class="notep1">注意：</p>
                     <p>在动态SQL方法4中，您无法使用类型为“table”的参数将主机数组绑定到PL / SQL过程。</p>
                  </div>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="ANSI-dynamic-SQL.html#GUID-BF450DA3-B05F-403E-B5DF-C967A20524BF">ANSI动态SQL</a></li>
                        <li><a href="Oracle-dynamic-SQL.html#GUID-3B9E253A-F03D-431D-A77E-84C02C43F494">Oracle动态SQL</a></li>
                        <li><a href="Oracle-dynamic-SQL-method-4.html#GUID-B516B7C8-1859-4A54-B15D-DF0C3D3C474D">Oracle动态SQL：方法4</a></li>
                        <li><a href="Oracle-dynamic-SQL.html#GUID-AFD0B0E4-4B76-4AA9-AA4D-1027A620634E">使用方法4</a></li>
                     </ul>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>