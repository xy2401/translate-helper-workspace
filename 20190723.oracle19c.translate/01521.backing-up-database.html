<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>备份数据库</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96241-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="rman-backup-concepts.html" title="Previous" type="text/html"></link>
      <link rel="next" href="backing-up-database-advanced.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="BRADV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="rman-backup-concepts.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="backing-up-database-advanced.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复用户指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-backing-up-archiving.html" property="item" typeof="WebPage"><span property="name">备份和存档数据</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">备份数据库</li>
            </ol>
            <a id="GUID-93BAB347-063F-439E-BDF3-109AB8D1F8E7" name="GUID-93BAB347-063F-439E-BDF3-109AB8D1F8E7"></a><a id="BRADV8003"></a>
            
            <h2 id="BRADV-GUID-93BAB347-063F-439E-BDF3-109AB8D1F8E7" class="sect2"><span class="enumeration_chapter">9</span>备份数据库</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍如何使用RMAN执行最基本的备份任务和实施备份策略。本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="backing-up-database.html#GUID-E31D9EAF-32FE-4599-BEEF-E3C52F116210" title="使用BACKUP命令创建RMAN备份。">RMAN备份概述</a></p>
                  </li>
                  <li>
                     <p><a href="backing-up-database.html#GUID-FCD2EDB0-817F-4E92-A318-6E4BEC35B467" title="您可以为BACKUP命令提供参数以覆盖默认备份选项。">指定备份输出选项</a></p>
                  </li>
                  <li>
                     <p><a href="backing-up-database.html#GUID-344F4D14-AC81-4093-B921-6403EE75112C" title="您可以在装入或打开数据库的情况下执行整个数据库备份。您可以使用BACKUP TABLESPACE命令备份一个或多个表空间，或使用BACKUP DATAFILE命令备份一个或多个数据文件。您可以在装入或打开数据库时备份控制文件。RMAN使用快照控制文件来确保读取一致的版本。控制文件的手动备份与控制文件自动备份不同。在备份BACKUP命令中指定的文件后，RMAN会进行控制文件自动备份。要进行手动备份，可以在备份其他文件时指定INCLUDE CURRENT CONTROLFILE或指定BACKUP CURRENT CONTROLFILE。在某些情况下，RMAN会自动备份当前服务器参数文件。BACKUP SPFILE命令显式备份参数文件。备份的服务器参数文件是实例当前使用的文件。只有在数据库关闭且处于一致状态时，才能以NOARCHIVELOG模式备份数据库。预打印备份确保在将非CDB作为PDB插入CDB后可以使用RMAN备份。">使用RMAN备份数据库文件</a></p>
                  </li>
                  <li>
                     <p><a href="backing-up-database.html#GUID-EB261F93-318D-4EBA-8E26-B0589703CC73" title="使用BACKUP命令备份多租户容器数据库（CDB）和可插拔数据库（PDB）。">备份CDB和PDB</a></p>
                  </li>
                  <li>
                     <p><a href="backing-up-database.html#GUID-896D464C-7741-4CE2-A8FD-E897300EB1AC" title="RMAN使您可以使用BACKUP命令在应用程序根，一个或多个应用程序PDB和应用程序容器上执行备份操作。">备份应用程序容器</a></p>
                  </li>
                  <li>
                     <p><a href="backing-up-database.html#GUID-17F2020E-9C9B-4D1C-BC60-A09C3A87CF55" title="使用BACKUP命令备份稀疏数据库。">使用RMAN备份稀疏数据库</a></p>
                  </li>
                  <li>
                     <p><a href="backing-up-database.html#GUID-4481CA5F-B1B5-4819-9E6B-7184951EC81A" title="归档重做日志是成功恢复媒体的关键。你应该定期备份它们。">使用RMAN备份存档的重做日志</a></p>
                  </li>
                  <li>
                     <p><a href="backing-up-database.html#GUID-2AF8EE74-CEB2-468D-A3B2-DD6AD8E41304" title="增量备份仅复制自指定的先前备份以来已更改的数据文件块。使用BACKUP命令创建增量备份。">制作和更新RMAN增量备份</a></p>
                  </li>
                  <li>
                     <p><a href="backing-up-database.html#GUID-8894680E-8BBA-475D-8815-D789C1A04FD9" title="你可以使用BACKUP ......保持创建既包含所有权又不受备份保留策略限制的备份。通过使用带有BACKUP命令的KEEP选项，可以从保留策略中免除备份。通常，您将归档备份到磁带。由于您的数据保护备份最有可能位于一组仍可访问且可回收的磁带上，因此建议为归档备份保留一组磁带。使用带有KEEP选项的BACKUP命令进行归档备份。归档备份的一个目的是创建测试数据库。">为长期存储进行数据库备份</a></p>
                  </li>
                  <li>
                     <p><a href="backing-up-database.html#GUID-731ADA67-235E-481D-AC17-9F9067AD55BF" title="您可以使用BACKUP BACKUPSET命令备份其他备份作业生成的备份集。您还可以使用BACKUP RECOVERY AREA备份在当前和所有先前快速恢复区域目标中创建的恢复文件。BACKUP BACKUPSET命令在备份集中创建备份片的其他副本，但不创建新的备份集。对于基于冗余的备份保留策略，备份集将计为备份的一个实例。即使存在构成备份集的备份片的多个副本（例如，备份集已从磁盘备份到磁带），此语句也是如此。使用BACKUP BACKUPSET命令将备份集从磁盘复制到磁带。使用BACKUP命令将映像副本备份到磁带。">备份RMAN备份</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-93BAB347-063F-439E-BDF3-109AB8D1F8E7__GUID-A354DABE-D5A3-4839-AA95-9480C96DC401">
                  <p class="notep1">也可以看看：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="backing-up-database-advanced.html#GUID-A4FABEF4-677C-42ED-9DF8-3731ADA12E5F" title="您可以使用CONFIGURE命令创建管理备份集大小的持久设置。BACKUP命令的MAXSETSIZE参数指定备份集的最大大小，以字节（默认），千字节，兆字节或千兆字节为单位。在超过文件系统或媒体管理软件的最大文件大小的情况下，备份大小是一个问题。使用CONFIGURE CHANNEL或ALLOCATE CHANNEL命令的MAXSETSIZE参数来限制备份片的大小。如果在BACKUP命令上指定SECTION SIZE参数，则RMAN会创建一个备份集，其中每个备份片段包含来自一个文件节的块。您运行CONFIGURE BACKUP OPTIMIZATION命令以启用备份优化。满足特定条件时，RMAN会跳过与已备份文件相同的文件备份。在Oracle Secure Backup中，媒体系列是一组命名的卷，具有一组共享的用户定义属性。在此方案中，您将不在磁带上的日志备份到一个媒体系列，然后将相同的日志备份到第二个媒体系列。最后，删除旧日志。默认情况下，BACKUP命令在无法访问数据文件时终止。RMAN最多可以同时备份四个备份集，每个副本与其他备份集完全相同。配置......BACKUP COPIES命令指定要在指定设备类型上创建的相同备份集的数量。BACKUP命令的COPIES选项会覆盖所有其他COPIES或DUPLEX设置，以控制备份集的双工。许多站点保留存储在磁盘上的数据库的备份，以防主数据库发生介质故障或不正确的用户操作需要时间点恢复。磁盘上的数据文件备份简化了恢复的恢复步骤，使恢复更加快速和可靠。您可以使用备份加密保护RMAN备份集。如果未经授权的用户获取加密备份，则无法读取这些备份。备份加密基于指定的加密设置执行。您可以通过执行SET ENCRYPTION BY PASSWORD命令在RMAN会话中设置加密密码。如果配置了透明加密，则指定ONLY关键字以指示备份受密码保护，而不是使用配置的透明加密。在RMAN提示符下使用SET ENCRYPTION BY PASSWORD命令进行受密码保护的备份。如果配置了透明加密，则省略ONLY关键字以指示备份受密码和配置的透明加密保护。使用可重新启动的备份功能，RMAN仅备份在指定日期之后未备份的那些文件。可重启性的最小单位是数据文件。但是，如果备份集包含一个备份片，并且如果该片包含来自多个数据文件的块，则可重新启动单元是备份片。图像副本的可重启性单位是数据文件。使用BACKUP命令的SINCE TIME参数指定需要新备份的日期。备份窗口是备份必须完成的一段时间。例如，您可能希望将数据库备份限制在系统上的用户活动较少时的时间窗口，例如凌晨2:00到6:00 am之间使用BACKUP命令的DURATION参数指定给定的时间长度允许备份作业运行。指定PARTIAL时，由于备份窗口结束，备份中断时RMAN不会报告错误。相反，RMAN会显示一条消息，显示未备份哪些文件。使用DURATION时，您可以以最大可能性能运行备份，或者在仍然在指定时间内完成的同时尽可能慢地运行备份，以最大限度地降低备份任务对性能的影响。">备份数据库：高级主题，</a>以了解更高级的主题，如备份优化，双工，备份加密和可重新启动的备份</p>
                     </li>
                     <li>
                        <p><a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span class="italic">Oracle Data Guard概念和管理</span></a> ，了解如何在Data Guard环境中执行RMAN备份和恢复</p>
                     </li>
                  </ul>
               </div>
            </div><a id="BRADV8131"></a><div class="props_rev_3"><a id="GUID-E31D9EAF-32FE-4599-BEEF-E3C52F116210" name="GUID-E31D9EAF-32FE-4599-BEEF-E3C52F116210"></a><h3 id="BRADV-GUID-E31D9EAF-32FE-4599-BEEF-E3C52F116210" class="sect3"><span class="enumeration_section">9.1</span> RMAN备份概述</h3>
               <div>
                  <p>使用<code class="codeph">BACKUP</code>命令创建RMAN备份。
                  </p>
                  <p>本节概述了RMAN备份。</p>
               </div><a id="BRADV89506"></a><div class="props_rev_3"><a id="GUID-CCFB214A-1334-44B6-862C-F4E2243EE3D2" name="GUID-CCFB214A-1334-44B6-862C-F4E2243EE3D2"></a><h4 id="BRADV-GUID-CCFB214A-1334-44B6-862C-F4E2243EE3D2" class="sect4"><span class="enumeration_section">9.1.1</span> RMAN备份的目的</h4>
                  <div>
                     <p>RMAN备份的主要目的是保护您的数据。如果发生介质故障或灾难，则可以还原备份并恢复丢失的更改。</p>
                     <p>您还可以进行备份以保留数据以进行长时间存档，如<span class="q">“ <a href="backing-up-database.html#GUID-8894680E-8BBA-475D-8815-D789C1A04FD9" title="你可以使用BACKUP ......保持创建既包含所有权又不受备份保留策略限制的备份。通过使用带有BACKUP命令的KEEP选项，可以从保留策略中免除备份。通常，您将归档备份到磁带。由于您的数据保护备份最有可能位于一组仍可访问且可回收的磁带上，因此建议为归档备份保留一组磁带。使用带有KEEP选项的BACKUP命令进行归档备份。归档备份的一个目的是创建测试数据库。">为长期存储制作数据库备份</a> ”中所述</span> ，以及传输数据，如<a href="part-transfering-data-rman.html#GUID-A341A776-5EEF-41C5-B708-338453D4DFB2">使用RMAN传输数据中</a>包含的章节中所述。</p>
                  </div>
               </div><a id="BRADV89507"></a><div class="props_rev_3"><a id="GUID-E8B1FE91-6C75-44AB-986C-3E91AA88FB6B" name="GUID-E8B1FE91-6C75-44AB-986C-3E91AA88FB6B"></a><h4 id="BRADV-GUID-E8B1FE91-6C75-44AB-986C-3E91AA88FB6B" class="sect4"><span class="enumeration_section">9.1.2</span> RMAN备份的基本概念</h4>
                  <div>
                     <p>您可以使用RMAN客户端中的<code class="codeph">BACKUP</code>命令<code class="codeph">BACKUP</code>全部或部分数据库。
                     </p>
                     <p>在许多情况下，在根据备份策略配置数据库之后，可以通过在RMAN提示符处输入以下命令来备份数据库：</p><pre class="pre codeblock"><code>RMAN&gt;备份数据库;</code></pre><p>RMAN使用已配置的设置，先前备份的记录以及数据库结构的控制文件记录来确定备份的一组有效步骤。然后RMAN执行这些步骤。</p>
                     <p>如<span class="q">“ <a href="rman-architecture.html#GUID-E514F9D2-D96E-4087-B8C5-5A8EB6A44E6B" title="RMAN使用恢复目录来跟踪Data Guard环境中所有数据库文件的文件名。">关于Data Guard环境中的RMAN文件管理”中所述</a></span> ，您可以在Data Guard环境中的任何数据库上运行RMAN备份。如果可以访问备份，则环境中任何数据库的任何备份都可用于恢复任何其他数据库。您可以将数据库文件的所有备份（包括控制文件备份）卸载到<a href="glossary.html#GUID-009B3F56-8C1E-4CF6-AF0F-A9D2C2E4B9C2"><span class="xrefglossterm">物理备用数据库</span></a> ，从而避免消耗主数据库上的资源。
                     </p>
                     <div class="infoboxnotealso" id="GUID-E8B1FE91-6C75-44AB-986C-3E91AA88FB6B__GUID-4EA16608-A109-4C06-A0CB-D06F546807B0">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a>了解<code class="codeph">BACKUP</code>命令</p>
                           </li>
                           <li>
                              <p><a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a> ，了解如何使用RMAN备份备用数据库</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV89508"></a><div class="props_rev_3"><a id="GUID-FCD2EDB0-817F-4E92-A318-6E4BEC35B467" name="GUID-FCD2EDB0-817F-4E92-A318-6E4BEC35B467"></a><h3 id="BRADV-GUID-FCD2EDB0-817F-4E92-A318-6E4BEC35B467" class="sect3"><span class="enumeration_section">9.2</span>指定备份输出选项</h3>
               <div>
                  <p>您可以为<code class="codeph">BACKUP</code>命令提供参数以覆盖默认备份选项。
                  </p>
                  <p>如果仅指定RMAN命令（如<a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><code class="codeph">BACKUP DATABASE</code></a>所需的最低选项，则RMAN会根据您配置的环境和内置RMAN默认值自动确定目标设备，备份输出位置和备份标记。
                  </p>
                  <p>以下各节介绍了最典型的备份选项：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="backing-up-database.html#GUID-5F7FFAD5-2D51-4803-B56A-9C94E7D2FBB2" title="BACKUP命令采用DEVICE TYPE子句，指定是备份到磁盘还是磁带设备。">指定RMAN备份的设备类型</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-030BA0C5-832E-42A1-A63A-5E2D768BABB9" title="RMAN可以在磁盘上创建备份作为映像副本或备份集。">为RMAN备份指定备份集或复制到磁盘</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-A733BDFC-8239-4610-8D26-40B6F2D07091" title="RMAN提供了一系列选项来命名BACKUP命令生成的文件。">指定RMAN备份的格式</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-88BAB25A-FD25-4577-A08A-71B78A91583F" title="RMAN将一个称为标记的字符串附加到它创建的每个备份上，作为识别备份的一种方式。您可以接受默认标记，也可以使用BACKUP命令的TAG参数指定自己的标记。">为RMAN备份指定标记</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-E0D30989-9477-45DD-8FE1-367BDD0A7A8E" title="创建备份集时，可以通过在BACKUP命令中包含AS COMPRESSED BACKUPSET选项，使用RMAN支持对备份集进行二进制压缩。">进行压缩备份</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-22AFE123-0D60-4194-9DE0-C4C0884BAEF9" title="通过多节备份，可以将大型数据文件划分为多个部分，这些部分可以跨多个通道并行备份。这提供了更快的备份性能和更好的恢复时间。">指定多节增量备份</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-6F1B35CC-9292-4A78-9E64-9206CB8EDFF8" title="在创建映像副本时，RMAN使用多个通道写入文件节。但是，此操作的输出是每个数据文件的一个副本。">使用映像副本进行多节备份</a></p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-FCD2EDB0-817F-4E92-A318-6E4BEC35B467__GUID-35365433-9562-4D70-9A60-0B88DC9DBE6F">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="backing-up-database-advanced.html#GUID-A4FABEF4-677C-42ED-9DF8-3731ADA12E5F" title="您可以使用CONFIGURE命令创建管理备份集大小的持久设置。BACKUP命令的MAXSETSIZE参数指定备份集的最大大小，以字节（默认），千字节，兆字节或千兆字节为单位。在超过文件系统或媒体管理软件的最大文件大小的情况下，备份大小是一个问题。使用CONFIGURE CHANNEL或ALLOCATE CHANNEL命令的MAXSETSIZE参数来限制备份片的大小。如果在BACKUP命令上指定SECTION SIZE参数，则RMAN会创建一个备份集，其中每个备份片段包含来自一个文件节的块。您运行CONFIGURE BACKUP OPTIMIZATION命令以启用备份优化。满足特定条件时，RMAN会跳过与已备份文件相同的文件备份。在Oracle Secure Backup中，媒体系列是一组命名的卷，具有一组共享的用户定义属性。在此方案中，您将不在磁带上的日志备份到一个媒体系列，然后将相同的日志备份到第二个媒体系列。最后，删除旧日志。默认情况下，BACKUP命令在无法访问数据文件时终止。RMAN最多可以同时备份四个备份集，每个副本与其他备份集完全相同。配置......BACKUP COPIES命令指定要在指定设备类型上创建的相同备份集的数量。BACKUP命令的COPIES选项会覆盖所有其他COPIES或DUPLEX设置，以控制备份集的双工。许多站点保留存储在磁盘上的数据库的备份，以防主数据库发生介质故障或不正确的用户操作需要时间点恢复。磁盘上的数据文件备份简化了恢复的恢复步骤，使恢复更加快速和可靠。您可以使用备份加密保护RMAN备份集。如果未经授权的用户获取加密备份，则无法读取这些备份。备份加密基于指定的加密设置执行。您可以通过执行SET ENCRYPTION BY PASSWORD命令在RMAN会话中设置加密密码。如果配置了透明加密，则指定ONLY关键字以指示备份受密码保护，而不是使用配置的透明加密。在RMAN提示符下使用SET ENCRYPTION BY PASSWORD命令进行受密码保护的备份。如果配置了透明加密，则省略ONLY关键字以指示备份受密码和配置的透明加密保护。使用可重新启动的备份功能，RMAN仅备份在指定日期之后未备份的那些文件。可重启性的最小单位是数据文件。但是，如果备份集包含一个备份片，并且如果该片包含来自多个数据文件的块，则可重新启动单元是备份片。图像副本的可重启性单位是数据文件。使用BACKUP命令的SINCE TIME参数指定需要新备份的日期。备份窗口是备份必须完成的一段时间。例如，您可能希望将数据库备份限制在系统上的用户活动较少时的时间窗口，例如凌晨2:00到6:00 am之间使用BACKUP命令的DURATION参数指定给定的时间长度允许备份作业运行。指定PARTIAL时，由于备份窗口结束，备份中断时RMAN不会报告错误。相反，RMAN会显示一条消息，显示未备份哪些文件。使用DURATION时，您可以以最大可能性能运行备份，或者在仍然在指定时间内完成的同时尽可能慢地运行备份，以最大限度地降低备份任务对性能的影响。">备份数据库：高级主题</a>以了解高级备份选项，例如双工和重新启动备份</p>
                  </div>
               </div><a id="BRADV211"></a><a id="BRADV89509"></a><div class="props_rev_3"><a id="GUID-5F7FFAD5-2D51-4803-B56A-9C94E7D2FBB2" name="GUID-5F7FFAD5-2D51-4803-B56A-9C94E7D2FBB2"></a><h4 id="BRADV-GUID-5F7FFAD5-2D51-4803-B56A-9C94E7D2FBB2" class="sect4"><span class="enumeration_section">9.2.1</span>指定RMAN备份的设备类型</h4>
                  <div>
                     <p><code class="codeph">BACKUP</code>命令采用<code class="codeph">DEVICE TYPE</code>子句，指定是备份到磁盘还是磁带设备。
                     </p>
                     <div class="section">
                        <p>在没有<code class="codeph">DEVICE TYPE</code>子句的情况下运行<code class="codeph">BACKUP</code> ，RMAN会将备份存储在配置的默认设备（磁盘或<a href="glossary.html#GUID-2E48CE71-9547-4196-B715-5CE59033262E"><span class="xrefglossterm">SBT</span></a> ）上。使用<a href="../rcmrf/CONFIGURE.html#RCMRF113" target="_blank"><code class="codeph">CONFIGURE DEFAULT DEVICE TYPE</code></a>命令设置默认设备。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-5F7FFAD5-2D51-4803-B56A-9C94E7D2FBB2__BGBCIIGJ">
                        <p class="titleinexample">例9-1指定设备类型DISK</p>
                        <p>此示例说明了备份到磁盘。</p><pre class="pre codeblock"><code>备份设备类型磁盘数据库;</code></pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-5F7FFAD5-2D51-4803-B56A-9C94E7D2FBB2__GUID-75365359-67F9-42F6-A26A-8F6BC1432CC2">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="configuring-rman-client-basic.html#GUID-3845B630-DD47-4147-BA6E-8D677CAF1CC2" title="未指定目标设备类型的备份将定向到已配置的默认设备。RMAN已预先配置为使用磁盘作为默认设备类型。无需其他配置。">配置备份的默认设备：磁盘或SBT，</a>以获取有关配置默认设备的信息</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV212"></a><a id="BRADV213"></a><a id="BRADV89510"></a><div class="props_rev_3"><a id="GUID-030BA0C5-832E-42A1-A63A-5E2D768BABB9" name="GUID-030BA0C5-832E-42A1-A63A-5E2D768BABB9"></a><h4 id="BRADV-GUID-030BA0C5-832E-42A1-A63A-5E2D768BABB9" class="sect4"><span class="enumeration_section">9.2.2</span>指定RMAN备份到磁盘的备份集或副本</h4>
                  <div>
                     <p>RMAN可以在磁盘上创建备份作为映像副本或备份集。</p>
                     <div class="section">
                        <p><span class="q">“ <a href="configuring-rman-client-basic.html#GUID-BC37B3E4-3338-4452-A363-DB882F2E9415" title="BACKUP命令可以创建备份集或映像副本。对于磁盘，您可以使用CONFIGURE DEVICE TYPE DISK BACKUP TYPE TO命令将RMAN配置为创建备份集或映像副本作为其默认备份类型。">配置备份的默认类型：备份集或副本</a> ”</span>说明了如何配置默认磁盘设备。您可以使用<code class="codeph">AS</code> <code class="codeph">COPY</code>或<code class="codeph">AS</code> <code class="codeph">BACKUPSET</code>子句覆盖此默认值。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-030BA0C5-832E-42A1-A63A-5E2D768BABB9__BGBHDIAG">
                        <p class="titleinexample">示例9-2进行映像复制</p>
                        <p>此示例使用<code class="codeph">BACKUP AS COPY</code>作为映像副本备份到磁盘。
                        </p><pre class="pre codeblock"><code>备份为复制设备类型磁盘数据库;</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-030BA0C5-832E-42A1-A63A-5E2D768BABB9__BGBBHEDE">
                        <p class="titleinexample">示例9-3制作备份集</p>
                        <p>要将数据备份到备份集中，请使用<code class="codeph">AS BACKUPSET</code>子句。此示例说明如何允许在配置的默认设备上创建备份集，或者将它们专门定向到磁盘或磁带。
                        </p><pre class="pre codeblock"><code>备份作为备用数据库;备份为BACKUPSET设备类型磁盘数据库;备份作为BACKUPSET设备类型SBT数据库;</code></pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="BRADV89511"></a><div class="props_rev_3"><a id="GUID-A733BDFC-8239-4610-8D26-40B6F2D07091" name="GUID-A733BDFC-8239-4610-8D26-40B6F2D07091"></a><h4 id="BRADV-GUID-A733BDFC-8239-4610-8D26-40B6F2D07091" class="sect4"><span class="enumeration_section">9.2.3</span>指定RMAN备份的格式</h4>
                  <div>
                     <p>RMAN提供了一系列选项来命名<code class="codeph">BACKUP</code>命令生成的文件。
                     </p>
                     <div class="section">
                        <p>RMAN使用以下规则集来确定输出文件的格式，这些格式按优先顺序列出：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>如果在<code class="codeph">BACKUP</code>命令中指定了<a href="../rcmrf/formatSpec.html#RCMRF195" target="_blank"><code class="codeph">FORMAT</code></a>参数，则此设置将控制生成的文件名。</span><div>
                              <p>例如，您可以将输出定向到特定位置，如以下命令所示：</p><pre class="pre codeblock"><code>BACKUP DATABASE FORMAT“/ disk1 / backup_％U”; ＃指定文件系统上的位置</code></pre><p>在这种情况下，备份与生成的唯一文件名一起存储，前缀为<code class="codeph">/disk1/backup_</code> 。用于在文件名中此时生成唯一字符串的<code class="codeph">%U</code>替换变量是必需的。
                              </p>
                              <p>您还可以使用<code class="codeph">FORMAT</code>参数将ASM磁盘组命名为备份目标，如以下示例所示：</p><pre class="pre codeblock"><code>BACKUP DATABASE FORMAT'+ dgroup1'; ＃指定ASM磁盘组</code></pre><p>在这种情况下，不需要<code class="codeph">%U</code> ，因为<a href="glossary.html#GUID-94080845-3FF3-4FB4-91EB-AEA1749411DC"><span class="xrefglossterm">自动存储管理（ASM）会</span></a>根据需要生成唯一的文件名。但是，如果需要，您可以指定<code class="codeph">%U</code> 。
                              </p>
                              <div class="infoboxnote" id="GUID-A733BDFC-8239-4610-8D26-40B6F2D07091__GUID-9F997D14-5D45-4034-A2FE-EE9660D43EAE">
                                 <p class="notep1">注意：</p>
                                 <p>如果在启用快速恢复区域时指定<code class="codeph">FORMAT</code> ，则RMAN将遵循<code class="codeph">FORMAT</code>设置。如果<code class="codeph">FORMAT</code>子句中未指定任何位置，则RMAN会在特定于平台的位置创建备份。
                                 </p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>如果为用于备份的特定通道配置了<code class="codeph">FORMAT</code>设置，则此设置将控制生成的文件名。</span></li>
                        <li class="stepexpand"><span>如果为用于备份的设备类型配置了<code class="codeph">FORMAT</code>设置，则此设置将控制生成的文件名。</span></li>
                        <li class="stepexpand"><span>如果在磁盘备份期间启用了<a href="glossary.html#GUID-6E3CDD76-A573-4E5C-B12D-59C232C96C19"><span class="xrefglossterm">快速恢复区域</span></a> ，并且未指定<code class="codeph">FORMAT</code> ，则RMAN将在快速恢复区域中使用自动生成的名称创建备份。</span></li>
                        <li class="stepexpand"><span>如果此列表中没有其他条件适用，则备份的默认位置和文件名格式是特定于平台的。</span></li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-A733BDFC-8239-4610-8D26-40B6F2D07091__GUID-29F7F2E5-3406-4BCD-9F8D-DD4667BF374D">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../rcmrf/formatSpec.html#RCMRF195" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a>了解<code class="codeph">FORMAT</code>子句以及Oracle数据库文档库中的安装指南，以了解适用于您的平台的默认文件位置</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div><a id="BRADV89512"></a><div class="props_rev_3"><a id="GUID-D9A1870F-E5E4-48DD-B479-C55C09B59388" name="GUID-D9A1870F-E5E4-48DD-B479-C55C09B59388"></a><h5 id="BRADV-GUID-D9A1870F-E5E4-48DD-B479-C55C09B59388" class="sect5"><span class="enumeration_section">9.2.3.1</span>为磁盘备份指定多种格式</h5>
                     <div>
                        <p>备份到磁盘时，您可以指定一种格式以将备份分布在多个驱动器上以提高性能。</p>
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>要将数据库备份到多个磁盘驱动器，请为每个磁盘驱动器分配一个<code class="codeph">DISK</code>通道，并在<code class="codeph">ALLOCATE CHANNEL</code>命令上指定格式字符串，以便文件名位于不同的磁盘上。
                                 </p><pre class="pre codeblock"><code>RUN {ALLOCATE CHANNEL disk1 DEVICE TYPE DISK FORMAT'/ disk1 /％d_backups /％U'; ALLOCATE CHANNEL disk2 DEVICE TYPE DISK FORMAT'/ disk2 /％d_backups /％U'; ALLOCATE CHANNEL disk3 DEVICE TYPE DISK FORMAT'/ disk3 /％d_backups /％U';备份为复制数据库; }</code></pre></li>
                              <li>
                                 <p>要创建默认配置以将备份分发到多个磁盘驱动器，请配置多个磁盘通道。</p><pre class="pre codeblock"><code>配置设备类型磁盘并行3;配置默认设备类型磁盘; CONFIGURE CHANNEL 1 DEVICE TYPE DISK FORMAT'/ disk1 /％d_backups /％U'; CONFIGURE CHANNEL 2 DEVICE TYPE DISK FORMAT'/ disk2 /％d_backups /％U'; CONFIGURE CHANNEL 3 DEVICE TYPE DISK FORMAT'/ disk3 /％d_backups /％U';备份为复制数据库;</code></pre></li>
                           </ul>
                           <p>通常，备份到磁带时不需要指定格式，因为默认的<code class="codeph">%U</code>变量会为磁带备份生成唯一的文件名。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="BRADV89513"></a><div class="props_rev_3"><a id="GUID-88BAB25A-FD25-4577-A08A-71B78A91583F" name="GUID-88BAB25A-FD25-4577-A08A-71B78A91583F"></a><h4 id="BRADV-GUID-88BAB25A-FD25-4577-A08A-71B78A91583F" class="sect4"><span class="enumeration_section">9.2.4</span>指定RMAN备份的标记</h4>
                  <div>
                     <p>RMAN将一个称为标记的字符串附加到它创建的每个备份上，作为识别备份的一种方式。您可以接受默认标记，也可以使用<code class="codeph">BACKUP</code>命令的<code class="codeph">TAG</code>参数指定自己的<code class="codeph">TAG</code> 。
                     </p>
                     <p>本节包含以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="backing-up-database.html#GUID-DB2C0F4B-C1CF-4023-A2B0-DF09D0788B15" title="用户指定的标记是指示不同类别的备份或副本的用途或用法的有用方法。">关于备份标签</a></p>
                        </li>
                        <li>
                           <p><a href="backing-up-database.html#GUID-938A6B6B-F16E-4D43-B902-A4D09429ED36" title="将TAG参数与BACKUP命令一起使用可指定备份集和映像副本的标记。">指定备份集和映像副本的标记</a></p>
                        </li>
                     </ul>
                  </div><a id="BRADV89514"></a><div class="props_rev_3"><a id="GUID-DB2C0F4B-C1CF-4023-A2B0-DF09D0788B15" name="GUID-DB2C0F4B-C1CF-4023-A2B0-DF09D0788B15"></a><h5 id="BRADV-GUID-DB2C0F4B-C1CF-4023-A2B0-DF09D0788B15" class="sect5"><span class="enumeration_section">9.2.4.1</span>关于备份标记</h5>
                     <div>
                        <p>用户指定的标记是指示不同类别的备份或副本的用途或用法的有用方法。</p>
                        <p>您可以标记备份集，代理副本，数据文件副本或控制文件副本。例如，您可以将要在<a href="../rcmrf/SWITCH.html#RCMRF159" target="_blank"><code class="codeph">SWITCH</code></a>命令中使用的数据文件副本标记为<code class="codeph">for_switch_only</code> ，将文件副本<code class="codeph">for_switch_only</code>为仅用于<a href="../rcmrf/RESTORE.html#RCMRF149" target="_blank"><code class="codeph">RESTORE</code></a>命令，如<code class="codeph">for_restore_only</code> 。
                        </p>
                        <p>标签不需要是唯一的，因此多个备份集或映像副本可以具有相同的标记（例如， <code class="codeph">weekly_backup</code> ）。假设您指定从具有特定标记的备份还原数据文件。如果所请求文件的多个备份具有所需标记，则RMAN将在<code class="codeph">RESTORE</code>命令的任何约束内恢复具有所需标记的最新备份。
                        </p>
                        <p>实际上，标签通常用于区分作为单个策略的一部分创建的一系列备份，例如增量备份策略。例如，您可以使用<code class="codeph">BACKUP TAG weekly_incremental</code>等标记创建每周增量备份。许多形式的<code class="codeph">BACKUP</code>命令允许您将标记与备份相关联，并且许多<code class="codeph">RESTORE</code>和<a href="../rcmrf/RECOVER.html#RCMRF140" target="_blank"><code class="codeph">RECOVER</code></a>命令允许您指定标记以限制在<code class="codeph">RESTORE</code>或<code class="codeph">RECOVER</code>操作中使用哪些备份。
                        </p>
                        <p>如果未使用<code class="codeph">BACKUP</code>命令的<code class="codeph">TAG</code>参数显式指定标记，则RMAN会隐式创建备份的默认标记（控制文件自动备份除外）。标签的格式为<code class="codeph">TAG</code> <span class="italic"><code class="codeph">YYYYMMDD</code></span> <code class="codeph">T</code> <span class="italic"><code class="codeph">HHMMSS</code></span> ，其中<span class="italic"><code class="codeph">YYYY</code></span>是年份， <span class="italic"><code class="codeph">MM</code></span>是月份， <span class="italic"><code class="codeph">DD</code></span>是日期， <span class="italic"><code class="codeph">HH</code></span>是小时（24小时格式）， <span class="italic"><code class="codeph">MM</code></span>是分钟， <span class="italic"><code class="codeph">SS</code></span>是秒。例如，数据文件<code class="codeph">1</code>的备份可以获得标签<code class="codeph">TAG20070208T133437</code> 。日期和时间是指RMAN在执行备份的实例的时区中启动备份的时间。如果一个<code class="codeph">BACKUP</code>命令创建了多个备份集，则每个备份片具有相同的默认标记。
                        </p>
                        <p>无论输入时使用何种情况，标签都以大写形式存储。备份标记的最大长度为30个字节。标签不能使用操作系统环境变量或使用特殊格式，如<code class="codeph">%T</code>或<code class="codeph">%D</code> 。</p>
                        <div class="infoboxnotealso" id="GUID-DB2C0F4B-C1CF-4023-A2B0-DF09D0788B15__GUID-281FEFA1-06F9-4CE8-B1B1-759674355ED3">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><span><cite>Oracle数据库备份和恢复参考，</cite></span></a>用于<code class="codeph">BACKUP...的默认格式描述<code class="codeph">BACKUP...标签</code> 
                           </p>
                        </div>
                     </div>
                  </div><a id="BRADV214"></a><a id="BRADV609"></a><a id="BRADV610"></a><a id="BRADV89515"></a><div class="props_rev_3"><a id="GUID-938A6B6B-F16E-4D43-B902-A4D09429ED36" name="GUID-938A6B6B-F16E-4D43-B902-A4D09429ED36"></a><h5 id="BRADV-GUID-938A6B6B-F16E-4D43-B902-A4D09429ED36" class="sect5"><span class="enumeration_section">9.2.4.2</span>指定备份集和映像副本的标记</h5>
                     <div>
                        <p>将<code class="codeph">TAG</code>参数与<code class="codeph">BACKUP</code>命令一起使用可指定备份集和映像副本的标记。
                        </p>
                        <div class="p">标记中的字符必须限制为目标数据库文件系统上文件名中合法的字符。例如， <a href="glossary.html#GUID-94080845-3FF3-4FB4-91EB-AEA1749411DC"><span class="xrefglossterm">自动存储管理（ASM）</span></a>不支持在内部使用的文件名中使用连字符（ <code class="codeph">-</code> ），因此包含连字符的标记（例如<code class="codeph">weekly-incr</code> ）不是备份的合法标记名称。 ASM磁盘组。
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>标记备份集时，标记是备份集的给定副本中每个备份片段的属性。如果创建<a href="glossary.html#GUID-EA6CE3E8-6986-4512-AF66-710D80376093"><span class="xrefglossterm">多路复用备份集</span></a> ，则会为备份集的每个副本分配相同的标记。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-938A6B6B-F16E-4D43-B902-A4D09429ED36__CHDEEGGD">
                           <p class="titleinexample">示例9-4将标记应用于备份集</p>
                           <p>此示例使用标记<code class="codeph">MONDAYBKP</code>创建一个备份集。</p><pre class="pre codeblock"><code>BACKUP AS BACKUPSET COPIES 1 DATAFILE 7 TAG mondaybkp;</code></pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-938A6B6B-F16E-4D43-B902-A4D09429ED36__CHDHAABB">
                           <p class="titleinexample">示例9-5将标记应用于图像副本</p>
                           <p>此示例显示表空间<code class="codeph">users</code>和<code class="codeph">tools</code>中的数据文件副本被分配了标记<code class="codeph">MONDAYCPY</code> 。为图像副本指定标记时，标记将应用于每个单独的副本。
                           </p><pre class="pre codeblock"><code>备份为COPY TABLESPACE用户，工具TAG mondaycpy;</code></pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-938A6B6B-F16E-4D43-B902-A4D09429ED36__CHDFIDHD">
                           <p class="titleinexample">示例9-6为输出副本分配标记</p>
                           <p>此示例为具有标记<code class="codeph">full_cold_copy</code>的数据库的所有映像副本创建新副本，并为新副本提供标记<code class="codeph">new_full_cold_copy</code> 。您可以使用<code class="codeph">FROM TAG</code>复制具有特定标记的图像副本，然后使用<code class="codeph">TAG</code>为输出副本分配不同的标记。
                           </p><pre class="pre codeblock"><code>备份为来自TAG的数据库的复制拷贝full_cold_copy TAG new_full_cold_copy;</code></pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div><a id="BRADV218"></a><a id="BRADV8138"></a><div class="props_rev_3"><a id="GUID-E0D30989-9477-45DD-8FE1-367BDD0A7A8E" name="GUID-E0D30989-9477-45DD-8FE1-367BDD0A7A8E"></a><h4 id="BRADV-GUID-E0D30989-9477-45DD-8FE1-367BDD0A7A8E" class="sect4"><span class="enumeration_section">9.2.5进行</span>压缩备份</h4>
                  <div>
                     <p>创建备份集时，可以通过在<code class="codeph">BACKUP</code>命令中包含<code class="codeph">AS COMPRESSED BACKUPSET</code>选项，使用RMAN支持对备份集进行二进制压缩。
                     </p>
                     <div class="section">
                        <p>RMAN在将备份集内容写入磁盘之前压缩它们。使用哪个二进制压缩级别的详细信息会自动记录在备份集中。无需明确提及所使用的压缩类型或如何在恢复操作中解压缩备份集。</p>
                        <p>二进制压缩在备份和还原操作期间会产生一些性能开销。二进制压缩会占用CPU资源，因此在CPU使用率较高时不要定期调度压缩备份。但是，以下情况可能需要支付性能损失：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>当快速恢复区域或其他基于磁盘的备份目标中的磁盘空间有限时，您正在使用基于磁盘的备份。</p>
                           </li>
                           <li>
                              <p>当网络带宽减少比CPU使用率更重要时，您将通过网络对某些设备执行备份。</p>
                           </li>
                           <li>
                              <p>您正在使用一些存档备份媒体，如CD或DVD，其中减少备份大小可节省媒体成本和存档存储。</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-E0D30989-9477-45DD-8FE1-367BDD0A7A8E__GUID-AD1CE662-A3FB-48E9-BF25-511746AAB792">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="rman-backup-concepts.html#GUID-2AFCD551-95CB-4F9F-946E-550E89613974" title="RMAN支持备份集的二进制压缩。二进制压缩仅在BACKUP命令中指定AS COMPRESSED BACKUPSET时启用，或者一次使用配置设备类型[DISK | SBT] BACKUP TYPE TO COMPRESSED BACKUPSET命令。">关于RMAN备份集的二进制压缩</a></p>
                              </li>
                              <li>
                                 <p>有关备份集的性能详细信息，请参阅<a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a>中的<code class="codeph">BACKUP</code>命令的<code class="codeph">AS COMPRESSED BACKUPSET</code>选项</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-E0D30989-9477-45DD-8FE1-367BDD0A7A8E__CHDHCDFJ">
                        <p class="titleinexample">示例9-7进行压缩备份</p>
                        <p>此示例将整个数据库和归档日志备份到配置的默认备份目标（磁盘或磁带），从而生成压缩备份集。</p><pre class="pre codeblock"><code>备份为压缩备用数据库加ARCHIVELOG;</code></pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="BRADV711"></a><a id="BRADV728"></a><a id="BRADV659"></a><a id="BRADV380"></a><div class="props_rev_3"><a id="GUID-22AFE123-0D60-4194-9DE0-C4C0884BAEF9" name="GUID-22AFE123-0D60-4194-9DE0-C4C0884BAEF9"></a><h4 id="BRADV-GUID-22AFE123-0D60-4194-9DE0-C4C0884BAEF9" class="sect4"><span class="enumeration_section">9.2.6</span>指定多节增量备份</h4>
                  <div>
                     <p>通过多节备份，可以将大型数据文件划分为多个部分，这些部分可以跨多个通道并行备份。这提供了更快的备份性能和更好的恢复时间。</p>
                     <div class="section">
                        <p>多节备份包含多个备份片。在多节备份操作期间，RMAN通过为每个备份片使用单独的通道并行地写入每个备份片。</p>
                        <p>从Oracle Database <span class="italic">11g</span>第1版开始，支持对数据库和数据文件进行多节完整备份。从Oracle Database 12 <span class="italic">c</span>第1版（12.1）开始，RMAN支持多节增量备份。在适用的情况下，RMAN还会在创建多节增量备份时使用<a href="glossary.html#GUID-0AA7EB43-FEA6-405F-9443-A4A2B43FFF96"><span class="xrefglossterm">未使用的块压缩</span></a>和<a href="glossary.html#GUID-C80ACD57-9170-4FA5-A61F-81A05E77A1A4"><span class="xrefglossterm">块更改跟踪</span></a> 。使用备份集时，可以创建多节完整备份或增量备份。
                        </p>
                        <p>要创建0级多节增量备份， <code class="codeph">COMPATIBLE</code>参数必须设置为11.0或更高。但是，要创建级别1或更高级别的多节增量备份，必须将<code class="codeph">COMPATIBLE</code>参数设置为12.0.0或更高。RMAN始终创建多层增量备份，并将<code class="codeph">FILESPERSET</code>设置为1。
                        </p>
                        <p>使用<code class="codeph">BACKUP</code>命令的<code class="codeph">SECTION SIZE</code>子句创建多节备份。<code class="codeph">SECTION SIZE</code>子句指定每个备份部分的大小。如果指定的段大小大于文件大小，则RMAN不会对该文件使用多节备份。如果指定的小部分大小将产生超过256个部分，则RMAN会将部分大小增加到一个导致恰好256个部分的值。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-22AFE123-0D60-4194-9DE0-C4C0884BAEF9__GUID-BDE5693E-D052-4F9B-B27D-8D3A6B174C78">用于识别多节备份的视图</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>使用<code class="codeph">V$BACKUP_SET</code>视图的<code class="codeph">MULTI_SECTION</code>列或恢复目录视图<code class="codeph">RC_BACKUP_SET</code>来确定备份是否为多节备份。对于多节备份， <code class="codeph">MULTI_SECTION</code>列包含YES。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-22AFE123-0D60-4194-9DE0-C4C0884BAEF9__GUID-D2F6C1E2-3CB5-4DD5-827F-33A7E659F687">包含多节备份元数据的视图</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><code class="codeph">V$BACKUP_DATAFILE</code>和<code class="codeph">RC_BACKUP_DATAFILE</code>视图提供有关多节备份的每个部分中的块数的信息。<code class="codeph">BLOCKS</code>列指定每个多节备份中的块数。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-22AFE123-0D60-4194-9DE0-C4C0884BAEF9__GUID-2F5DB958-0409-48E3-879B-BFAB1222CCB4">
                        <p class="titleinexample">示例9-8作为备份集的多节增量备份数据库</p>
                        <p>以下示例将数据文件的多节级1增量备份创建为备份集。</p>
                        <ol>
                           <li>
                              <p>确保目标数据库的初始化参数<code class="codeph">COMPATIBLE</code>设置为12.0.0或更高版本。
                              </p>
                           </li>
                           <li>
                              <p>启动RMAN并以具有<code class="codeph">SYSBACKUP</code>或<code class="codeph">SYSDBA</code>权限的用户身份连接到目标数据库。
                              </p> 
                              <div class="infoboxnotealso" id="GUID-22AFE123-0D60-4194-9DE0-C4C0884BAEF9__GUID-20AF60A9-6FDD-4473-9154-50880EE0763B">
                                 <p class="notep1">也可以看看：</p>
                                 <p><a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">与RMAN建立数据库连接，</a>以获取有关连接到目标数据库的信息</p>
                              </div>
                           </li>
                           <li>
                              <p>如果需要，请将RMAN配置为与备份设备并行写入。</p>
                              <p>以下示例将RMAN配置为并行使用两个磁盘通道。</p><pre class="pre codeblock"><code>配置设备类型磁盘PARALLELISM 2;</code></pre></li>
                           <li>
                              <p>使用<code class="codeph">SECTION SIZE</code>执行<code class="codeph">BACKUP</code>以指示必须创建多节备份。
                              </p>
                              <p>以下示例使用备份集创建数据文件<code class="codeph">users_df.dbf</code>的多节段1级备份。每个备份片为100MB。</p><pre class="pre codeblock"><code>BACKUP INCREMENTAL LEVEL 1 SECTION SIZE 100M DATAFILE'/oradata/datafiles/users_df.dbf';</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-22AFE123-0D60-4194-9DE0-C4C0884BAEF9__GUID-184CBFAC-CCED-48B1-85D4-06977F56DF9F">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="rman-backup-concepts.html#GUID-50F8DBCD-C285-491F-B8E7-E1B2140E1B51" title="使用未使用的块压缩时，RMAN会跳过读取和备份当前未分配给某个数据库对象的任何数据库块。这与先前是否已分配这些块无关。">关于未使用的块压缩</a></p>
                              </li>
                              <li>
                                 <p><a href="backing-up-database.html#GUID-4E1F605A-76A7-48D0-9D9B-7343B4327E2A" title="增量备份的块更改跟踪功能通过记录每个数据文件的更改块来提高备份性能。">使用块更改跟踪来提高增量备份性能</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV660"></a><a id="BRADV665"></a><div class="props_rev_3"><a id="GUID-6F1B35CC-9292-4A78-9E64-9206CB8EDFF8" name="GUID-6F1B35CC-9292-4A78-9E64-9206CB8EDFF8"></a><h4 id="BRADV-GUID-6F1B35CC-9292-4A78-9E64-9206CB8EDFF8" class="sect4"><span class="enumeration_section">9.2.7</span>使用映像副本进行多节备份</h4>
                  <div>
                     <p>在创建映像副本时，RMAN使用多个通道写入文件节。但是，此操作的输出是每个数据文件的一个副本。</p>
                     <div class="section">
                        <p>通过使用多个通道并行备份大型文件，多节备份可提供更好的性能。从Oracle Database 12 <span class="italic">c</span>第1版（12.1）开始，您可以创建存储为映像副本的多节完整备份。
                        </p>
                        <p>使用<code class="codeph">SECTION SIZE</code>子句创建多节备份。如果指定的节大小大于文件大小，则RMAN不会对该文件使用多节备份。如果指定的小部分大小将产生超过256个部分，则RMAN会将部分大小增加到一个导致恰好256个部分的值</p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-6F1B35CC-9292-4A78-9E64-9206CB8EDFF8__GUID-ED50DFB3-AA81-4E4E-BE42-F3B6CC92B765">
                        <p class="titleinexample">示例9-9数据文件的多节备份作为映像副本</p>
                        <p>使用以下步骤创建数据库的多节备份作为映像副本：</p>
                        <ol>
                           <li>
                              <p>确保目标数据库的<code class="codeph">COMPATIBLE</code>参数设置为12.0.0或更高版本。
                              </p>
                           </li>
                           <li>
                              <p>启动RMAN并以具有<code class="codeph">SYSBACKUP</code>或<code class="codeph">SYSDBA</code>权限的用户身份连接到目标数据库。
                              </p>
                           </li>
                           <li>
                              <p>如果需要，请配置<a href="glossary.html#GUID-57D1A253-9620-4588-82E3-EC2BEC2B1B0C"><span class="xrefglossterm">通道并行性，</span></a>以便RMAN可以并行使用多个驱动器执行备份操作。
                              </p>
                           </li>
                           <li>
                              <p>使用<code class="codeph">SECTION SIZE</code>和<code class="codeph">AS COPY</code>执行<code class="codeph">BACKUP</code>以指示必须使用映像副本创建多节备份。
                              </p>
                              <p>以下命令使用映像副本创建整个数据库的多节增量备份。每个备份片500MB。</p><pre class="pre codeblock"><code>备份为复制部分大小500M数据库;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-6F1B35CC-9292-4A78-9E64-9206CB8EDFF8__GUID-816FAD2E-CCED-4B34-B21C-4E505A474E8A">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">与RMAN建立数据库连接，</a>以获取有关连接到目标数据库的信息</p>
                              </li>
                              <li>
                                 <p><a href="backing-up-database.html#GUID-22AFE123-0D60-4194-9DE0-C4C0884BAEF9" title="通过多节备份，可以将大型数据文件划分为多个部分，这些部分可以跨多个通道并行备份。这提供了更快的备份性能和更好的恢复时间。">指定多节增量备份</a>以获取有关包含有关多节备份信息的视图的信息。
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV8132"></a><div class="props_rev_3"><a id="GUID-344F4D14-AC81-4093-B921-6403EE75112C" name="GUID-344F4D14-AC81-4093-B921-6403EE75112C"></a><h3 id="BRADV-GUID-344F4D14-AC81-4093-B921-6403EE75112C" class="sect3"><span class="enumeration_section">9.3</span>使用RMAN备份数据库文件</h3>
               <div>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="backing-up-database.html#GUID-D7EC8119-A260-4300-8756-F53DBC2C2D45" title="您可以在装入或打开数据库的情况下执行整个数据库备份。">使用RMAN备份整个数据库</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-71976B2C-B142-46D8-AB45-2D6F783CCEF1" title="您可以使用BACKUP TABLESPACE命令备份一个或多个表空间，或使用BACKUP DATAFILE命令备份一个或多个数据文件。">使用RMAN备份表空间和数据文件</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-D25F0A92-12AE-490E-AB8F-C9E54E081CDD" title="您可以在装入或打开数据库时备份控制文件。RMAN使用快照控制文件来确保读取一致的版本。">使用RMAN备份控制文件</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-D3E617F5-121C-41DC-A191-B3BA6D121B30" title="在某些情况下，RMAN会自动备份当前服务器参数文件。BACKUP SPFILE命令显式备份参数文件。备份的服务器参数文件是实例当前使用的文件。">使用RMAN备份服务器参数文件</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-31FBFBD3-B8C8-4085-AAFC-8BA696A8F31E" title="只有在数据库关闭且处于一致状态时，才能以NOARCHIVELOG模式备份数据库。">在NOARCHIVELOG模式下备份数据库</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV220"></a><a id="BRADV8231"></a><div class="props_rev_3"><a id="GUID-D7EC8119-A260-4300-8756-F53DBC2C2D45" name="GUID-D7EC8119-A260-4300-8756-F53DBC2C2D45"></a><h4 id="BRADV-GUID-D7EC8119-A260-4300-8756-F53DBC2C2D45" class="sect4"><span class="enumeration_section">9.3.1</span>使用RMAN备份整个数据库</h4>
                  <div>
                     <p>您可以在装入或打开数据库的情况下执行整个数据库备份。</p>
                     <div class="section">
                        <p>要从RMAN提示符执行整个数据库备份，请使用<a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><code class="codeph">BACKUP DATABASE</code></a>命令。
                        </p>
                        <p>您可能希望从整个数据库备份中排除指定的表空间。通过对您始终要跳过的每个表空间执行<a href="../rcmrf/CONFIGURE.html#RCMRF113" target="_blank"><code class="codeph">CONFIGURE EXCLUDE</code></a>命令，可以跨RMAN会话持久跳过表空间。您可以使用<code class="codeph">BACKUP ...覆盖已配置的设置<code class="codeph">BACKUP ...NOEXCLUDE</code> 。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-D7EC8119-A260-4300-8756-F53DBC2C2D45__GUID-E55F5DB6-6CC2-4A07-BD96-1B01EAB727D6">要备份数据库：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用），如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”中所述</span> 。</span></li>
                        <li class="stepexpand"><span>确保已装入或打开数据库。</span></li>
                        <li class="stepexpand"><span>在RMAN提示符下发出<code class="codeph">BACKUP DATABASE</code>命令。</span><div>
                              <p>最简单的命令形式不需要选项或参数：</p><pre class="pre codeblock"><code>备份数据库;</code></pre><p>备份的文件列表（数据文件，控制文件，服务器参数文件）取决于<code class="codeph">BACKUP</code>命令使用的关键字。
                              </p>
                              <p>以下示例备份数据库，切换联机重做日志，并在备份中包含已归档日志：</p><pre class="pre codeblock"><code>BACKUP DATABASE PLUS ARCHIVELOG;</code></pre><p>通过在备份后立即归档日志，可确保在备份期间拥有一整套归档日志。这样，您可以保证在还原此备份后可以执行介质恢复。</p>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-D7EC8119-A260-4300-8756-F53DBC2C2D45__GUID-8B865B1E-D66E-4C3E-A213-CDED2E040DEC">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../rcmrf/index.html" target="_blank"><span class="italic">Oracle数据库备份和恢复参考，</span></a>以了解<code class="codeph">BACKUP</code>命令和<code class="codeph">CONNECT</code>命令</p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="backing-up-database-advanced.html#GUID-CBF7B516-AEBB-433F-A57C-EECAEF153C12" title="默认情况下，BACKUP命令在无法访问数据文件时终止。">跳过脱机，只读和无法访问的文件</a> ”</span>以了解如何使用<code class="codeph">BACKUP ...SKIP</code>跳过无法访问的数据文件或脱机或只读表空间中的数据文件</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV222"></a><a id="BRADV89516"></a><div class="props_rev_3"><a id="GUID-71976B2C-B142-46D8-AB45-2D6F783CCEF1" name="GUID-71976B2C-B142-46D8-AB45-2D6F783CCEF1"></a><h4 id="BRADV-GUID-71976B2C-B142-46D8-AB45-2D6F783CCEF1" class="sect4"><span class="enumeration_section">9.3.2</span>使用RMAN备份表空间和数据文件</h4>
                  <div>
                     <p>您可以使用<code class="codeph">BACKUP TABLESPACE</code>命令<code class="codeph">BACKUP TABLESPACE</code>一个或多个表空间，或使用<code class="codeph">BACKUP DATAFILE</code>命令<code class="codeph">BACKUP DATAFILE</code>一个或多个数据文件。
                     </p>
                     <div class="section">
                        <p>指定表空间时，RMAN会将表空间名称内部转换为数据文件列表。数据库可以安装或打开。表空间可以是读/写或只读。</p>
                        <div class="infoboxnote" id="GUID-71976B2C-B142-46D8-AB45-2D6F783CCEF1__GUID-17CBBDAE-D18F-49BC-9EEF-1FB7D6499241">
                           <p class="notep1">注意：</p>
                           <p>与以前的版本一样，可传输表空间不必处于读/写模式以进行备份。</p>
                        </div>
                        <p>当数据文件<code class="codeph">1</code>包含在备份中时，RMAN会自动备份控制文件和服务器参数文件（如果实例是使用服务器参数文件启动的）。如果启用了<a href="glossary.html#GUID-7CDA6567-DFB0-450D-8771-B033E9872AF7"><span class="xrefglossterm">控制文件自动</span></a>备份，则RMAN会将当前控制文件和服务器参数文件写入单独的自动备份段。否则，RMAN将这些文件包含在包含数据文件<code class="codeph">1</code>的备份集中。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-71976B2C-B142-46D8-AB45-2D6F783CCEF1__GUID-06FDFCBA-2731-4FEC-B270-B8B4DADF95D4">要备份表空间或数据文件：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span><div>
                              <div class="infoboxnotealso" id="GUID-71976B2C-B142-46D8-AB45-2D6F783CCEF1__GUID-65E9AB0A-8BCF-4466-B7F2-862799C57A43">
                                 <p class="notep1">也可以看看：</p>
                                 <p><a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">与RMAN建立数据库连接，</a>以获取有关连接到目标数据库的信息</p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>如果未启动数据库实例，则安装或打开数据库。</span></li>
                        <li class="stepexpand"><span>在RMAN提示符下运行<code class="codeph">BACKUP</code> <code class="codeph">TABLESPACE</code>命令或<code class="codeph">BACKUP DATAFILE</code>命令。</span></li>
                     </ol>
                     <div class="section">
                        <p>以下示例将<code class="codeph">users</code>和<code class="codeph">tools</code>表空间备份到磁带：</p><pre class="pre codeblock"><code>备份设备类型sbt TABLESPACE用户，工具;</code></pre><p>以下示例使用SBT通道将数据文件<code class="codeph">1</code>到<code class="codeph">4</code>以及存储在<code class="codeph">/tmp/system01.dbf</code>的数据文件副本备份到磁带：</p><pre class="pre codeblock"><code>备份设备类型sbt DATAFILE 1,2,3,4 DATAFILECOPY'/ tmp / system01.dbf';</code></pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89517"></a><div class="props_rev_3"><a id="GUID-D25F0A92-12AE-490E-AB8F-C9E54E081CDD" name="GUID-D25F0A92-12AE-490E-AB8F-C9E54E081CDD"></a><h4 id="BRADV-GUID-D25F0A92-12AE-490E-AB8F-C9E54E081CDD" class="sect4"><span class="enumeration_section">9.3.3</span>使用RMAN备份控制文件</h4>
                  <div>
                     <p>您可以在装入或打开数据库时备份控制文件。RMAN使用快照控制文件来确保读取一致的版本。</p>
                     <p>如果<a href="../rcmrf/CONFIGURE.html#RCMRF113" target="_blank"><code class="codeph">CONFIGURE CONTROLFILE AUTOBACKUP</code></a>命令设置为<code class="codeph">ON</code> （默认情况下为<code class="codeph">OFF</code> ），则RMAN会在每次备份后以及数据库结构更改后自动备份控制文件和服务器参数文件。<a href="glossary.html#GUID-7CDA6567-DFB0-450D-8771-B033E9872AF7"><span class="xrefglossterm">控制文件自动</span></a>备份包含有关先前备份的元数据，这对于<a href="glossary.html#GUID-641AA42A-EAFE-449E-99D9-55DCBAE6539D"><span class="xrefglossterm">灾难恢复</span></a>至关重要。
                     </p>
                     <div class="infoboxnote" id="GUID-D25F0A92-12AE-490E-AB8F-C9E54E081CDD__GUID-FB72AC7A-D9BC-401A-8918-7C5F7944D5C9">
                        <p class="notep1">注意：</p>
                        <p>您可以将在一个Data Guard数据库上创建的控制文件的备份还原到环境中的任何其他数据库。主要和备用控制文件备份是可互换的。请参阅<a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a>以了解如何使用RMAN还原备用数据库上的文件。
                        </p>
                     </div>
                     <p>如果未设置自动备份功能，则必须使用以下方法之一手动备份控制文件：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>运行<code class="codeph">BACKUP</code> <code class="codeph">CURRENT</code> <code class="codeph">CONTROLFILE</code> 。</p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">BACKUP</code>命令的<code class="codeph">INCLUDE</code> <code class="codeph">CURRENT</code> <code class="codeph">CONTROLFILE</code>选项在任何备份中包含控制文件的<code class="codeph">BACKUP</code> 。
                           </p>
                        </li>
                        <li>
                           <p>备份数据文件<code class="codeph">1</code> ，因为RMAN自动包括在数据文件的备份的控制文件和服务器参数文件<code class="codeph">1</code> 。
                           </p>
                           <div class="infoboxnote" id="GUID-D25F0A92-12AE-490E-AB8F-C9E54E081CDD__GUID-74C12E57-6DC4-4132-8DB3-584EB0D9142A">
                              <p class="notep1">注意：</p>
                              <p>如果控制文件块大小与数据文件<code class="codeph">1</code>的块大小不同，则控制文件不能写入与数据文件相同的备份集。如果块大小不同，RMAN会将控制文件自行写入备份集。<code class="codeph">V$CONTROLFILE.BLOCK_SIZE</code>列指示控制文件块大小，而<code class="codeph">DB_BLOCK_SIZE</code>初始化参数指示数据文件<code class="codeph">1</code>的块大小。
                              </p>
                           </div>
                        </li>
                     </ul>
                  </div><a id="BRADV729"></a><div class="props_rev_3"><a id="GUID-D796580F-B3F0-46BE-A47B-D8130461CF3D" name="GUID-D796580F-B3F0-46BE-A47B-D8130461CF3D"></a><h5 id="BRADV-GUID-D796580F-B3F0-46BE-A47B-D8130461CF3D" class="sect5"><span class="enumeration_section">9.3.3.1</span>关于控制文件的手动备份</h5>
                     <div>
                        <p>控制文件的手动备份与控制文件自动备份不同。在<code class="codeph">BACKUP</code>命令中指定的文件后，RMAN会进行控制文件自动备份。
                        </p>
                        <p>因此，自动备份 - 与手动控制文件备份不同 - 包含有关刚刚完成的备份的元数据。此外，RMAN可以在不使用恢复目录的情况下自动恢复自动备份。</p>
                        <p>您可以将当前控制文件的手动备份作为<a href="glossary.html#GUID-6AA43E7D-9946-4C41-A62F-01E5BACEB8A7"><span class="xrefglossterm">备份集</span></a>或<a href="glossary.html#GUID-397CB99E-3F07-4980-96B3-9D0D0ABBABEA"><span class="xrefglossterm">映像副本</span></a> 。对于备份集，RMAN首先创建快照控制文件以实现读取一致性。您可以配置快照控制文件的文件名和位置。图像副本不需要快照控制文件。
                        </p>
                        <p>在Oracle Real Application Clusters（Oracle RAC）环境中，以下限制适用：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>快照控制文件位置必须位于共享存储上，即所有Oracle RAC实例均可访问的存储。</p>
                           </li>
                           <li>
                              <p>当前控制文件的映像副本的目标必须是共享存储。</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-D796580F-B3F0-46BE-A47B-D8130461CF3D__GUID-0A0E143A-8CAC-4CE4-8421-3FE2504FAD13">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="configuring-rman-client-advanced.html#GUID-B7B61600-6DED-413D-B134-1DAE79627A01" title="当RMAN需要控制文件的读取一致版本时，它会创建临时快照控制文件。在与恢复目录重新同步时或在备份当前控制文件时，RMAN需要快照控制文件。">配置快照控制文件位置</a></p>
                              </li>
                              <li>
                                 <p><a href="backing-up-database.html#GUID-F3EC4BC5-DF2B-4052-9BDF-28D16E9B4351" title="要进行手动备份，可以在备份其他文件时指定INCLUDE CURRENT CONTROLFILE或指定BACKUP CURRENT CONTROLFILE。">手动备份控制文件</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="BRADV226"></a><a id="BRADV89518"></a><div class="props_rev_3"><a id="GUID-F3EC4BC5-DF2B-4052-9BDF-28D16E9B4351" name="GUID-F3EC4BC5-DF2B-4052-9BDF-28D16E9B4351"></a><h5 id="BRADV-GUID-F3EC4BC5-DF2B-4052-9BDF-28D16E9B4351" class="sect5"><span class="enumeration_section">9.3.3.2</span>手动备份控制文件</h5>
                     <div>
                        <p>要进行手动备份，可以在备份其他文件时指定<code class="codeph">INCLUDE CURRENT CONTROLFILE</code>或指定<code class="codeph">BACKUP CURRENT CONTROLFILE</code> 。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-F3EC4BC5-DF2B-4052-9BDF-28D16E9B4351__GUID-05BE8ABE-2C80-4287-AFDF-6F417F2D4527">要手动备份控制文件：</p>
                           <p>您还可以通过指定<code class="codeph">CONTROLFILECOPY</code>参数来备份磁盘上的控制文件副本。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li><span>启动RMAN并连接到目标数据库和恢复目录（如果使用），如<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接中</a>所述。</span></li>
                           <li><span>确保已装入或打开目标数据库。</span></li>
                           <li><span>使用所需的控制文件子句执行<code class="codeph">BACKUP</code>命令。</span></li>
                        </ol>
                        <div class="example" id="GUID-F3EC4BC5-DF2B-4052-9BDF-28D16E9B4351__GUID-2D6645D6-C509-40E5-9294-C7DED2AA3345">
                           <p class="titleinexample">示例9-10将表空间和当前控制文件备份到磁带</p>
                           <p>此示例将表空间<code class="codeph">users</code>备份到磁带，并在备份中包含当前控制文件：</p><pre class="pre codeblock"><code>备份设备类型sbt TABLESPACE用户包括当前控制文件;</code></pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-F3EC4BC5-DF2B-4052-9BDF-28D16E9B4351__GUID-F9AD00DF-FB34-4E0D-8E71-EF470E855B51">
                           <p class="titleinexample">例9-11将当前控制文件备份到快速恢复区</p>
                           <p>此示例将当前控制文件备份到快速恢复区域作为备份集：</p><pre class="pre codeblock"><code>备份当前控制文件;</code></pre><p>RMAN首先创建快照控制文件。</p>
                        </div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-F3EC4BC5-DF2B-4052-9BDF-28D16E9B4351__GUID-CB923A26-D480-47C4-AA32-FD41EEAF7DAC">
                           <p class="titleinexample">示例9-12将当前控制文件备份为映像副本</p>
                           <p>此示例将当前控制文件作为映像副本备份到默认磁盘设备：</p><pre class="pre codeblock"><code>BACKUP as COPY CURRENT CONTROLFILE FORMAT'/ tmp / control01.ctl';</code></pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-F3EC4BC5-DF2B-4052-9BDF-28D16E9B4351__GUID-46227440-AE01-4DF8-AD96-6872CA776B2F">
                           <p class="titleinexample">示例9-13备份控制文件副本</p>
                           <p>此示例将上一个示例中创建的控制文件副本备份到磁带：</p><pre class="pre codeblock"><code>BACKUP as COPY CURRENT CONTROLFILE FORMAT'/ tmp / control01.ctl';备份设备类型sbt CONTROLFILECOPY'/ tmp / control01.ctl';</code></pre><p>备份控制文件副本时不需要快照控制文件。</p>
                           <p>如果启用了控制文件自动备份功能，则RMAN会在这些示例中进行两个控制文件备份：显式备份<code class="codeph">BACKUP</code>命令中指定的文件以及控制文件和服务器参数文件自动备份。
                           </p>
                           <div class="infoboxnotealso" id="GUID-F3EC4BC5-DF2B-4052-9BDF-28D16E9B4351__GUID-0F793CC9-89D7-43E2-9F18-E030AD452369">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="../rcmrf/CONFIGURE.html#RCMRF113" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a>了解<code class="codeph">CONFIGURE CONTROLFILE AUTOBACKUP</code>命令</p>
                           </div>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div><a id="BRADV230"></a><a id="BRADV89519"></a><div class="props_rev_3"><a id="GUID-D3E617F5-121C-41DC-A191-B3BA6D121B30" name="GUID-D3E617F5-121C-41DC-A191-B3BA6D121B30"></a><h4 id="BRADV-GUID-D3E617F5-121C-41DC-A191-B3BA6D121B30" class="sect4"><span class="enumeration_section">9.3.4</span>使用RMAN备份服务器参数文件</h4>
                  <div>
                     <p>在某些情况下，RMAN会自动备份当前服务器参数文件。<code class="codeph">BACKUP</code> <code class="codeph">SPFILE</code>命令显式备份参数文件。备份的服务器参数文件是实例当前使用的文件。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-D3E617F5-121C-41DC-A191-B3BA6D121B30__GUID-66C6EEDF-7CAA-43D4-A266-D4E45C98BC64">要备份服务器参数文件：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用），如<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接中</a>所述。</span></li>
                        <li class="stepexpand"><span>确保已装入或打开目标数据库。</span><div>
                              <p>必须已使用服务器参数文件启动数据库。如果使用客户端初始化参数文件启动实例，则RMAN会在执行<code class="codeph">BACKUP ...发出错误<code class="codeph">BACKUP ...SPFILE</code> 。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>执行<code class="codeph">BACKUP ...SPFILE</code>命令。</span><div>
                              <p>以下示例将服务器参数文件备份到磁带：</p><pre class="oac_no_warn" dir="ltr">备份设备类型sbt SPFILE;</pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-D3E617F5-121C-41DC-A191-B3BA6D121B30__GUID-E755E933-2FC6-48DD-BE06-F63F254C728F">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="backing-up-database.html#GUID-D25F0A92-12AE-490E-AB8F-C9E54E081CDD" title="您可以在装入或打开数据库时备份控制文件。RMAN使用快照控制文件来确保读取一致的版本。">使用RMAN备份控制文件</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV231"></a><a id="BRADV89526"></a><div class="props_rev_3"><a id="GUID-31FBFBD3-B8C8-4085-AAFC-8BA696A8F31E" name="GUID-31FBFBD3-B8C8-4085-AAFC-8BA696A8F31E"></a><h4 id="BRADV-GUID-31FBFBD3-B8C8-4085-AAFC-8BA696A8F31E" class="sect4"><span class="enumeration_section">9.3.5</span>在NOARCHIVELOG模式下备份数据库</h4>
                  <div>
                     <p>只有在数据库关闭且处于一致状态时，才能以<code class="codeph">NOARCHIVELOG</code>模式备份数据库。
                     </p>
                     <div class="section">
                        <p><a href="backing-up-database.html#GUID-31FBFBD3-B8C8-4085-AAFC-8BA696A8F31E__BGBBDDEA">示例9-14中</a>显示的脚本将数据库置于正确的模式，以进行一致的整个数据库备份，然后备份数据库。该脚本假定为数据库启用了<a href="glossary.html#GUID-7CDA6567-DFB0-450D-8771-B033E9872AF7"><span class="xrefglossterm">控制文件自动备份</span></a> 。
                        </p>
                        <p>您可以跳过表空间（例如只读表空间），但是如果必须从备份还原数据库，则由于上次备份丢失，因此任何跳过的表空间都没有脱机或只读。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-31FBFBD3-B8C8-4085-AAFC-8BA696A8F31E__BGBBDDEA">
                        <p class="titleinexample">示例9-14在NOARCHIVELOG模式下备份数据库</p><pre class="pre codeblock"><code>立即关闭; ＃在启动此脚本之前启动数据库，以防它出现实例故障或者以SHUTDOWN ABORT关闭＃。STARTUP FORCE DBA;立即关闭;启动安装; ＃此示例使用自动通道进行备份BACKUP INCREMENTAL LEVEL 0 MAXSETSIZE 10M DATABASE TAG'BACKUP_1'; ＃现在备份已完成，请打开数据库。ALTER DATABASE OPEN;</code></pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-7F9F8913-2838-4066-A000-048B35A70EA4" name="GUID-7F9F8913-2838-4066-A000-048B35A70EA4"></a><h4 id="BRADV-GUID-7F9F8913-2838-4066-A000-048B35A70EA4" class="sect4"><span class="enumeration_section">9.3.6</span>创建整个数据库的预刷新备份</h4>
                  <div>
                     <p>预打印备份确保在将非CDB作为PDB插入CDB后可以使用RMAN备份。</p>
                     <div class="section">
                        <p></p>
                        <p>从Oracle Database Release 18c开始，您可以创建非CDB的预备份备份。在将非CDB作为目标CDB中的PDB插入之后，预刷新备份用于还原和恢复操作。预备份备份可以是磁带备份和磁盘备份。</p>
                        <p><span class="bold">要创建非CDB的预刷新备份：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的用户身份连接到目标数据库（非CDB），如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”中所述</span> 。</span><div>
                              <p>如果使用，则连接到恢复目录。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>确保满足所需的先决条件，如<a href="../rcmrf/BACKUP.html#RCMRF-GUID-73642FF2-43C5-48B2-9969-99001C52EB50" target="_blank"><span><cite>Oracle数据库备份和恢复参考中所述</cite></span></a> 。</span></li>
                        <li class="stepexpand"><span>（可选）配置数据库控制文件和服务器参数文件的自动备份，如<span class="q">“ <a href="configuring-rman-client-basic.html#GUID-98BA7492-7108-4DF9-B5A2-21957072E308" title="您可以配置RMAN以自动备份控制文件和服务器参数文件。每当添加备份记录时都会发生自动备份。">配置控制文件和服务器参数文件自动备份</a> ”中所述</span> 。</span></li>
                        <li class="stepexpand"><span>执行非CDB的完整备份，包括归档重做日志文件。</span><div>
                              <p>如果已存在非CDB的备份，则只需创建归档重做日志文件的备份即可。使用<code class="codeph">dbms_pdb.exportrmanbackup()</code>过程将所有现有RMAN备份导出到数据字典后，可以使用所有现有RMAN备份。
                              </p>
                              <p>虽然备份归档重做日志文件不是必需的，但建议您这样做。通过在备份后立即归档日志，可确保在备份期间拥有一整套归档日志。这使您可以在还原此备份后执行介质恢复。</p>
                              <p>以下命令备份非CDB，包括所有归档重做日志文件。<code class="codeph">TAG</code>子句指定用于标识此RMAN备份的备份标记。
                              </p><pre class="pre codeblock"><code>RMAN&gt; BACKUP DATABASE PLUS ARCHIVELOG ALL TAG for_migration;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>退出RMAN。</span></li>
                        <li class="stepexpand"><span>在目标数据库中，以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的用户身份连接到SQL * Plus。</span></li>
                        <li class="stepexpand"><span>使用<code class="codeph">DBMS_PDB.EXPORTRMANBACKUP</code>过程将非CDB的RMAN备份元数据导出到其数据字典中。</span><div><pre class="pre codeblock"><code>SQL&gt; EXECUTE DBMS_PDB.EXPORTRMANBACKUP（）;</code></pre><p>在将非CDB作为PDB插入目标CDB时，源非CDB的该备份元数据被复制到目标CDB的数据字典中。</p>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-7F9F8913-2838-4066-A000-048B35A70EA4__GUID-C1FD65DC-4C9D-4A39-A3CE-47C0F0F5A4B7">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="rman-backup-concepts.html#GUID-7D69CBCA-123F-49FF-85E9-F5C70E47202D" title="预包装备份是在非CDB或PDB插入其他CDB之前创建的非CDB或PDB的RMAN备份。">关于Preplugin备份</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV428"></a><div class="props_rev_3"><a id="GUID-EB261F93-318D-4EBA-8E26-B0589703CC73" name="GUID-EB261F93-318D-4EBA-8E26-B0589703CC73"></a><h3 id="BRADV-GUID-EB261F93-318D-4EBA-8E26-B0589703CC73" class="sect3"><span class="enumeration_section">9.4</span>备份CDB和PDB</h3>
               <div>
                  <p>使用<code class="codeph">BACKUP</code>命令备份多租户容器数据库（CDB）和可插拔数据库（PDB）。
                  </p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="backing-up-database.html#GUID-E96DC7C6-7A02-4DF6-92A0-795CD8E9FE37" title="RMAN和Oracle Enterprise Manager Cloud Control为多租户环境中的备份和恢复提供全面支持。">关于备份CDB和PDB</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-9A4E9357-820F-449A-8832-C32F1A8C9BDB" title="备份整个多租户容器数据库（CDB）类似于备份非CDB。备份整个CDB时，RMAN会备份根，所有可插拔数据库（PDB）和归档重做日志。">备份整个CDB</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-B416FCDB-1EA1-48F8-8162-F9181A75B6BB" title="您可以使用RMAN仅备份根。由于根包含整个CDB的关键元数据，因此Oracle建议您定期备份根或备份整个CDB。">使用RMAN备份根</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-079A8D28-018C-4B99-ACAE-129E3D265ED5" title="Oracle Enterprise Manager云控制（云控制）可用于备份根。">使用Oracle Enterprise Manager云控制备份根</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-655DC5F5-FF8D-4A73-B67D-F5AAE20CA382" title="RMAN允许您使用BACKUP命令备份CDB中的一个或多个PDB。">使用RMAN备份PDB</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-F7E1D8EA-2F4F-4497-87FF-547EF6D0EE8B" title="Oracle Enterprise Manager云控制（云控制）可用于执行可插拔数据库（PDB）的备份。">使用Oracle Enterprise Manager云控制备份PDB</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-6AD83271-F900-4EA6-B787-865E5DC0678A" title="由于不同PDB中的表空间可以具有相同的名称，因此为了消除歧义，您必须直接连接到PDB以备份其一个或多个表空间。">备份PDB中的表空间和数据文件</a></p>
                     </li>
                  </ul>
                  <div class="infoboxnote" id="GUID-EB261F93-318D-4EBA-8E26-B0589703CC73__GUID-3D62F1DC-06C5-451A-8FED-401F47CB69CD">
                     <p class="notep1">注意：</p>
                     <p><a href="glossary.html#GUID-62A96A52-3B97-455A-A443-75B999DCAC94"><span class="xrefglossterm">非CDB</span></a>作为PDB插入另一个CDB后，非CDB的备份不可用。</p>
                  </div>
                  <div class="infoboxnotealso" id="GUID-EB261F93-318D-4EBA-8E26-B0589703CC73__GUID-FEFB7343-2E65-49AA-940C-D5F270049444">
                     <p class="notep1">也可以看看：</p>
                     <p>有关PDB简介的<a href="../multi/multitenant-architecture.html#CNCPT89233" target="_blank"><span><cite>Oracle数据库概念</cite></span></a></p>
                  </div>
               </div><a id="BRADV730"></a><div class="props_rev_3"><a id="GUID-E96DC7C6-7A02-4DF6-92A0-795CD8E9FE37" name="GUID-E96DC7C6-7A02-4DF6-92A0-795CD8E9FE37"></a><h4 id="BRADV-GUID-E96DC7C6-7A02-4DF6-92A0-795CD8E9FE37" class="sect4"><span class="enumeration_section">9.4.1</span>关于备份CDB和PDB</h4>
                  <div>
                     <p>RMAN和Oracle Enterprise Manager Cloud Control为多租户环境中的备份和恢复提供全面支持。</p>
                     <p><a href="glossary.html#GUID-665B741C-5624-40B5-81FF-93B1EC67FC56"><span class="xrefglossterm">多租户架构</span></a>使Oracle数据库可以充当CDB。您可以备份和恢复整个CDB，仅限<a href="glossary.html#GUID-EA3DB8F4-F68E-4FC5-A599-32A4886FFF8A"><span class="xrefglossterm">root用户</span></a>或一个或多个可插拔数据库（PDB）。您还可以备份和恢复PDB中的各个表空间和数据文件。</p>
                     <p>您可能希望使用增量备份策略对整个多租户容器数据库（CDB）执行夜间备份，或者您可能希望对各个PDB进行频繁的单独备份，并对整个CDB或根目录进行较少的备份。</p>
                     <p>就从数据丢失中恢复的能力而言，单独备份根和所有PDB（包括CDB种子）相当于备份整个CDB。主要区别在于您必须输入的RMAN命令数和恢复时间。恢复整个CDB所需的时间比恢复根加上所有PDB所需的时间短。</p>
                     <p>如果CDB和PDB的兼容性参数设置为12.2或更高，则RMAN还允许您在CDB和PDB上执行稀疏备份。这些备份从分配给每个数据库的增量存储空间复制最新更新。</p>
                     <div class="infoboxnotealso" id="GUID-E96DC7C6-7A02-4DF6-92A0-795CD8E9FE37__GUID-2282CD9B-87ED-4F09-913E-B964659AD381">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="rman-backup-concepts.html#GUID-D0AEBAF2-FDEA-4977-9B4D-97759A1CA865" title="您可以使用RMAN BACKUP命令从稀疏数据文件，包含稀疏数据文件的表空间，稀疏可插拔数据库（PDB）和包含稀疏PDB的多租户容器数据库（CDB）备份数据块。">有关稀疏备份</a>的详细信息，请参阅稀疏备份</p>
                     </div>
                  </div>
               </div><a id="BRADV429"></a><a id="BRADV731"></a><div class="props_rev_3"><a id="GUID-9A4E9357-820F-449A-8832-C32F1A8C9BDB" name="GUID-9A4E9357-820F-449A-8832-C32F1A8C9BDB"></a><h4 id="BRADV-GUID-9A4E9357-820F-449A-8832-C32F1A8C9BDB" class="sect4"><span class="enumeration_section">9.4.2</span>备份整个CDB</h4>
                  <div>
                     <p>备份整个多租户容器数据库（CDB）类似于备份非CDB。备份整个CDB时，RMAN会备份根，所有可插拔数据库（PDB）和归档重做日志。</p>
                     <div class="section">
                        <p><code class="codeph">BACKUP</code>命令用于备份CDB。然后，您可以从CDB备份中恢复整个CDB，仅root用户或一个或多个PDB。
                        </p>
                        <p><span class="bold">备份整个CDB：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并以具有<code class="codeph">SYSBACKUP</code>或<code class="codeph">SYSDBA</code>权限的公共用户身份连接到根，并连接到恢复目录（如果使用），如<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接中</a>所述。</span></li>
                        <li class="stepexpand"><span>确保已装入或打开数据库。</span></li>
                        <li class="stepexpand"><span>在RMAN提示符下发出<a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><code class="codeph">BACKUP DATABASE</code></a>命令。</span><div>
                              <p>最简单的命令形式不需要选项或参数：</p><pre class="pre codeblock"><code>备份数据库;</code></pre><p>备份的文件列表取决于<code class="codeph">BACKUP</code>命令使用的关键字。
                              </p>
                              <p>以下示例备份CDB，切换联机重做日志，并在备份中包含存档日志：</p><pre class="pre codeblock"><code>BACKUP DATABASE PLUS ARCHIVELOG;</code></pre><p>通过在备份后立即归档日志，可确保在备份期间拥有一整套归档日志。这样，您可以保证在还原此备份后可以执行介质恢复。</p>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnote" id="GUID-9A4E9357-820F-449A-8832-C32F1A8C9BDB__GUID-C2ECAD7C-21AD-48B7-989C-549A8D6A6526">
                           <p class="notep1">注意：</p>
                           <p>备份CDB时不备份代理PDB。</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV733"></a><a id="BRADV732"></a><div class="props_rev_3"><a id="GUID-B416FCDB-1EA1-48F8-8162-F9181A75B6BB" name="GUID-B416FCDB-1EA1-48F8-8162-F9181A75B6BB"></a><h4 id="BRADV-GUID-B416FCDB-1EA1-48F8-8162-F9181A75B6BB" class="sect4"><span class="enumeration_section">9.4.3</span>使用RMAN备份根</h4>
                  <div>
                     <p>您可以使用RMAN仅备份根。由于根包含整个CDB的关键元数据，因此Oracle建议您定期备份根或备份整个CDB。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-B416FCDB-1EA1-48F8-8162-F9181A75B6BB__GUID-0F04A9C3-BC7D-46AB-89ED-65ADC629449A">使用RMAN备份根目录：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并以具有<code class="codeph">SYSBACKUP</code>或<code class="codeph">SYSDBA</code>权限的公共用户身份连接到根，如将<a href="starting-interacting-with-rman-client.html#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D" title="有几种方法可以将目标连接到根目录。">目标连接到根目录中所述</a> 。</span></li>
                        <li class="stepexpand"><span>输入以下命令：</span><div><pre class="oac_no_warn" dir="ltr">备份数据库根;</pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV734"></a><div class="props_rev_3"><a id="GUID-079A8D28-018C-4B99-ACAE-129E3D265ED5" name="GUID-079A8D28-018C-4B99-ACAE-129E3D265ED5"></a><h4 id="BRADV-GUID-079A8D28-018C-4B99-ACAE-129E3D265ED5" class="sect4"><span class="enumeration_section">9.4.4</span>使用Oracle Enterprise Manager云控制备份根</h4>
                  <div>
                     <p>Oracle Enterprise Manager云控制（云控制）可用于备份根。</p>
                     <div class="section">
                        <p>使用以下步骤通过Cloud Control备份根目录：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>从Database Home页面，从Availability菜单中选择<span class="uicontrol bold">Backup＆Recovery</span> ，然后选择<span class="uicontrol bold">Schedule Backup</span> 。</span></li>
                        <li class="stepexpand"><span>如果以前未登录过数据库，则会显示“数据库登录”页面。使用“命名”或“新凭据” <span class="uicontrol bold">登录</span>数据库，然后单击“ <span class="uicontrol bold">登录”</span> 。</span><div>
                              <p>Cloud Control显示“计划备份”页面。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>从“自定义备份”部分，选择“ <span class="uicontrol bold">容器数据库根”</span> ，然后单击“ <span class="uicontrol bold">计划自定义备份”</span> 。</span><div>
                              <p>出现“计划备份向导”并显示“选项”页面。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>通过导航其余页面来完成向导以备份根目录。有关向导的每个页面的更多信息，请单击“ <span class="uicontrol bold">帮助”</span> 。</span></li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-079A8D28-018C-4B99-ACAE-129E3D265ED5__GUID-FE568C63-0C02-4C65-B4E5-72FACAC53A58">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="introduction-backup-recovery.html#GUID-7557D8F6-2DC8-460A-8453-74E73DEF8705" title="数据库主页是Oracle企业管理器云控制（云控制）中的主数据库管理页面。">使用云控制访问数据库主页</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV542"></a><a id="BRADV736"></a><a id="BRADV735"></a><div class="props_rev_3"><a id="GUID-655DC5F5-FF8D-4A73-B67D-F5AAE20CA382" name="GUID-655DC5F5-FF8D-4A73-B67D-F5AAE20CA382"></a><h4 id="BRADV-GUID-655DC5F5-FF8D-4A73-B67D-F5AAE20CA382" class="sect4"><span class="enumeration_section">9.4.5</span>使用RMAN备份PDB</h4>
                  <div>
                     <p>RMAN允许您使用<code class="codeph">BACKUP</code>命令<code class="codeph">BACKUP</code> CDB中的一个或多个PDB。
                     </p>
                     <div class="section">
                        <p>使用RMAN备份PDB有两种方法：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>连接到root，然后使用<code class="codeph">BACKUP PLUGGABLE DATABASE</code>命令。此方法使您可以使用单个命令备份多个PDB。
                              </p>
                              <p>当您连接到根并备份PDB时，此备份对根和该特定PDB可见，但对其他PDB不可见。</p>
                           </li>
                           <li>
                              <p>连接到PDB并使用<code class="codeph">BACKUP DATABASE</code>命令。此方法仅备份单个PDB，并允许您使用用于备份非CDB的相同命令。
                              </p>
                              <p>连接到任何PDB时创建的备份在连接到根目录时可见。</p>
                           </li>
                        </ul>
                        <p>备份单个PDB时，不会备份存档的重做日志。</p>
                        <p></p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-655DC5F5-FF8D-4A73-B67D-F5AAE20CA382__GUID-F1726ECB-8C7D-4BD8-A61C-C3D57F5B32F0">在连接到根时备份一个或多个PDB：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ol>
                           <li>
                              <p>启动RMAN。使用<code class="codeph">SYSBACKUP</code>或<code class="codeph">SYSDBA</code>权限以及恢复目录（如果使用）连接到root用户，如将<a href="starting-interacting-with-rman-client.html#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D" title="有几种方法可以将目标连接到根目录。">目标连接到根</a>目录中所述。
                              </p> 
                           </li>
                           <li>
                              <p>在RMAN提示符下发出<code class="codeph">BACKUP PLUGGABLE DATABASE</code>命令。
                              </p>
                              <p>以下示例备份PDB <code class="codeph">sales</code>和<code class="codeph">hr</code> ：</p><pre class="oac_no_warn" dir="ltr">BACKUP PLUGGABLE DATABASE销售额，小时;</pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-655DC5F5-FF8D-4A73-B67D-F5AAE20CA382__GUID-9508D3A8-C9F8-441C-887F-A5382A92CE24">在连接到PDB时备份一个PDB：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并以具有<code class="codeph">SYSBACKUP</code>或<code class="codeph">SYSDBA</code>权限的<a href="glossary.html#GUID-43EA1A4C-E5EB-4926-99EC-1DDA0E74A07C"><span class="xrefglossterm">本地用户</span></a>身份连接到PDB，并连接到恢复目录（如果使用），如将<a href="starting-interacting-with-rman-client.html#GUID-E95C5C27-C036-4773-B77C-E4120526F422" title="您可以从RMAN提示符或操作系统命令行连接到PDB。">目标连接到PDB中所述</a> 。</span><div></div>
                        </li>
                        <li class="stepexpand"><span>在RMAN提示符下发出<code class="codeph">BACKUP DATABASE</code>命令。</span><div><pre class="oac_no_warn" dir="ltr">备份数据库;</pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnote" id="GUID-655DC5F5-FF8D-4A73-B67D-F5AAE20CA382__GUID-157CE916-7749-4C2D-B857-BE105FB07488">
                           <p class="notep1">注意：</p>
                           <p>不支持使用RMAN备份代理PDB。</p>
                        </div>
                        <p></p>
                        <p></p>
                        <div class="infoboxnote" id="GUID-655DC5F5-FF8D-4A73-B67D-F5AAE20CA382__GUID-76DBD35B-F953-46CF-8160-2E25B2EA577D">
                           <p class="notep1">注意：</p>
                           <p>仅当备份包含包含此PDB更改的所有归档重做日志文件时，才能使用PDB备份执行介质恢复。在连接到PDB时创建备份时，可能会出现某些情况，即未备份所有必需的日志。</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-E5A3E523-C55C-4666-8334-81E7A224371B" name="GUID-E5A3E523-C55C-4666-8334-81E7A224371B"></a><h4 id="BRADV-GUID-E5A3E523-C55C-4666-8334-81E7A224371B" class="sect4"><span class="enumeration_section">9.4.6</span>使用RMAN创建PDB的预刷新备份</h4>
                  <div>
                     <p>在PDB迁移并插入到其他目标CDB之后，PDB的预刷新备份可用于执行还原和恢复操作。</p>
                     <div class="section">
                        <p></p>
                        <p>从Oracle Database Release 18c开始，您可以创建PDB的预备份备份到磁盘和磁带。</p>
                        <div class="infoboxnote" id="GUID-E5A3E523-C55C-4666-8334-81E7A224371B__GUID-F15F2EEB-64C3-40DA-818A-26D90557C63A">
                           <p class="notep1">注意：</p>
                           <p>目标CDB在插入目标CDB后，不管理在源CDB上创建的备份。</p>
                        </div>
                        <p><span class="bold">要创建PDB的预备份备份：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>确保满足所需的先决条件，如<a href="../rcmrf/BACKUP.html#RCMRF-GUID-73642FF2-43C5-48B2-9969-99001C52EB50" target="_blank"><span><cite>Oracle数据库备份和恢复参考中所述</cite></span></a> 。</span></li>
                        <li class="stepexpand"><span>启动RMAN并使用<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">使用RMAN建立数据库连接</a> ”</span>中所述的以下技术之一进行<span class="q"><a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">连接</a></span> ：</span><div>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>使用<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限以普通用户身份连接到root用户。
                                    </p>
                                 </li>
                                 <li>
                                    <p>使用<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限以本地用户或普通用户身份连接到PDB。
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>（可选）配置目标数据库的控制文件和服务器参数文件自动备份，如<span class="q">“ <a href="configuring-rman-client-basic.html#GUID-98BA7492-7108-4DF9-B5A2-21957072E308" title="您可以配置RMAN以自动备份控制文件和服务器参数文件。每当添加备份记录时都会发生自动备份。">配置控制文件和服务器参数文件自动备份</a> ”中所述</span> 。</span></li>
                        <li class="stepexpand"><span>创建PDB的完整备份，包括存档的重做日志文件。</span><div>
                              <p>如果已存在PDB的RMAN备份，则在将PDB迁移到另一个目标CDB后，这些备份可用。但是，建议您备份存档的重做日志文件。</p>
                              <p>当您以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的本地用户身份连接到PDB时，以下命令将备份PDB：</p><pre class="pre codeblock"><code>RMAN&gt; BACKUP DATABASE PLUS ARCHIVELOG ALL TAG for_migration;</code></pre><p>当作为具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的普通用户连接到<code class="codeph">ROOT</code>时，以下命令备份PDB <code class="codeph">my_pdb</code> ：</p><pre class="pre codeblock"><code>RMAN&gt; BACKUP PLUGGABLE DATABASE my_pdb PLUS ARCHIVELOG ALL TAG for_migration;</code></pre><div class="infoboxnote" id="GUID-E5A3E523-C55C-4666-8334-81E7A224371B__GUID-9B7108FA-8C3D-4DFA-8108-17E48B3667BB">
                                 <p class="notep1">注意：</p>
                                 <p>使用<code class="codeph">BACKUP PLUGGABLE DATABASE</code> ，仅在CDB使用本地撤消时才备份所有必需的归档重做日志。
                                 </p>
                              </div>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <p>从源CDB拔出PDB时创建的XML文件中包含这些预备份备份可在目标CDB中使用所需的元数据。</p>
                        <div class="infoboxnotealso" id="GUID-E5A3E523-C55C-4666-8334-81E7A224371B__GUID-BEB9686E-0D45-43EE-AEDD-34A0258D90BA">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="rman-backup-concepts.html#GUID-7D69CBCA-123F-49FF-85E9-F5C70E47202D" title="预包装备份是在非CDB或PDB插入其他CDB之前创建的非CDB或PDB的RMAN备份。">关于Preplugin备份</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV737"></a><div class="props_rev_3"><a id="GUID-F7E1D8EA-2F4F-4497-87FF-547EF6D0EE8B" name="GUID-F7E1D8EA-2F4F-4497-87FF-547EF6D0EE8B"></a><h4 id="BRADV-GUID-F7E1D8EA-2F4F-4497-87FF-547EF6D0EE8B" class="sect4"><span class="enumeration_section">9.4.7</span>使用Oracle Enterprise Manager云控制备份PDB</h4>
                  <div>
                     <p>Oracle Enterprise Manager云控制（云控制）可用于执行可插拔数据库（PDB）的备份。</p>
                     <div class="section">
                        <p>要使用Cloud Control备份一个或多个PDB，请完成以下步骤：</p>
                        <ol>
                           <li>
                              <p>从Database Home页面，从Availability菜单中选择<span class="uicontrol bold">Backup＆Recovery</span> ，然后选择<span class="uicontrol bold">Schedule Backup</span> 。
                              </p>
                           </li>
                           <li>
                              <p>如果以前未登录过数据库，则会显示“数据库登录”页面。使用“命名”或“新凭据” <span class="uicontrol bold">登录</span>数据库，然后单击“ <span class="uicontrol bold">登录”</span> 。
                              </p>
                              <p>Cloud Control显示“计划备份”页面。</p>
                           </li>
                           <li>
                              <p>从“自定义备份”部分，选择“ <span class="uicontrol bold">可插拔数据库”</span> ，然后单击“ <span class="uicontrol bold">计划自定义备份”</span> 。
                              </p>
                              <p>将显示“计划备份向导”，并显示“可插拔数据库”页面。</p>
                           </li>
                           <li>
                              <p>按照以下步骤选择要备份的PDB：</p>
                              <ol type="a">
                                 <li>
                                    <p>单击“ <span class="uicontrol bold">添加”</span>以显示“可用的可插拔数据库”页面。
                                    </p>
                                 </li>
                                 <li>
                                    <p>从显示的PDB列表中，单击“ <span class="uicontrol bold">选择”</span>列以指定要备份的PDB。（可选）您可以单击“全<span class="uicontrol bold">选”</span>以打开所有可用PDB的“选择”选项。单击“ <span class="bold">选择无”</span>以取消选择所有PDB。
                                    </p>
                                 </li>
                                 <li>
                                    <p>单击“ <span class="uicontrol bold">选择”</span>按钮返回“可插拔数据库”页面。
                                    </p>
                                 </li>
                                 <li>
                                    <p>（可选）通过单击要删除的每个PDB的“ <span class="uicontrol bold">选择”</span>列，然后单击“ <span class="uicontrol bold">删除”</span> ，可以从表中删除PDB。
                                    </p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>单击“ <span class="uicontrol bold">下一步”</span>以转到向导的“选项”页面。
                              </p>
                           </li>
                           <li>
                              <p>通过导航其余页面来完成向导以备份PDB。有关向导的每个页面的更多信息，请单击“ <span class="uicontrol bold">帮助”</span> 。
                              </p>
                           </li>
                        </ol>
                        <div class="infoboxnotealso" id="GUID-F7E1D8EA-2F4F-4497-87FF-547EF6D0EE8B__GUID-CE8E08A1-A4EF-4915-9477-08806EA3888D">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="introduction-backup-recovery.html#GUID-7557D8F6-2DC8-460A-8453-74E73DEF8705" title="数据库主页是Oracle企业管理器云控制（云控制）中的主数据库管理页面。">使用云控制访问数据库主页</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV545"></a><a id="BRADV739"></a><a id="BRADV738"></a><div class="props_rev_3"><a id="GUID-6AD83271-F900-4EA6-B787-865E5DC0678A" name="GUID-6AD83271-F900-4EA6-B787-865E5DC0678A"></a><h4 id="BRADV-GUID-6AD83271-F900-4EA6-B787-865E5DC0678A" class="sect4"><span class="enumeration_section">9.4.8</span>备份PDB中的表空间和数据文件</h4>
                  <div>
                     <p>由于不同PDB中的表空间可以具有相同的名称，因此为了消除歧义，您必须直接连接到PDB以备份其一个或多个表空间。</p>
                     <div class="p">确保CDB已打开或已安装。表空间可以是只读或读写。</div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>相反，由于数据文件编号和路径在CDB中是唯一的，因此您可以连接到根或PDB以备份PDB数据文件。如果连接到根，则可以使用单个命令从多个PDB备份数据文件。如果连接到PDB，则只能备份该PDB中的数据文件。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-6AD83271-F900-4EA6-B787-865E5DC0678A__GUID-FB8EE1F9-55BF-46A0-9B3B-79E6507A2C8B">要备份PDB中的表空间：</p>
                        <p></p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ol>
                           <li>
                              <p>启动RMAN。以具有<code class="codeph">SYSBACKUP</code>或<code class="codeph">SYSDBA</code>权限的本地用户身份连接到PDB，并连接到恢复目录（如果使用），如将<a href="starting-interacting-with-rman-client.html#GUID-E95C5C27-C036-4773-B77C-E4120526F422" title="您可以从RMAN提示符或操作系统命令行连接到PDB。">目标连接到PDB中所述</a> 。</p>
                           </li>
                           <li>
                              <p>发出<code class="codeph">BACKUP TABLESPACE</code>命令。
                              </p>
                              <p>以下示例将表空间<code class="codeph">users</code>和<code class="codeph">examples</code>备份到配置的默认设备。
                              </p><pre class="pre codeblock"><code>BACKUP TABLESPACE用户，例子;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-6AD83271-F900-4EA6-B787-865E5DC0678A__GUID-0758FEA3-0AD8-4253-BDFA-5464B1E87999">要备份PDB中的数据文件：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>执行以下操作之一：</span><div>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>启动RMAN并以具有<code class="codeph">SYSBACKUP</code>或<code class="codeph">SYSDBA</code>权限的公共用户身份连接到root。
                                    </p>
                                 </li>
                                 <li>
                                    <p>启动RMAN并以具有<code class="codeph">SYSBACKUP</code>或<code class="codeph">SYSDBA</code>权限的本地用户身份连接到PDB。
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>发出<code class="codeph">BACKUP</code> <code class="codeph">DATAFILE</code>命令。</span><div><pre class="pre codeblock"><code>备份数据文件10,13;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-6AD83271-F900-4EA6-B787-865E5DC0678A__GUID-203C3C03-744A-4841-B3E6-652AE06E04EB">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="starting-interacting-with-rman-client.html#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D" title="有几种方法可以将目标连接到根目录。">作为目标连接到根</a></p>
                              </li>
                              <li>
                                 <p><a href="starting-interacting-with-rman-client.html#GUID-E95C5C27-C036-4773-B77C-E4120526F422" title="您可以从RMAN提示符或操作系统命令行连接到PDB。">作为目标连接到PDB</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-A506832F-F3AA-4458-B3B9-B0E80A3BC252" name="GUID-A506832F-F3AA-4458-B3B9-B0E80A3BC252"></a><h4 id="BRADV-GUID-A506832F-F3AA-4458-B3B9-B0E80A3BC252" class="sect4"><span class="enumeration_section">9.4.9</span>示例：使用RMAN创建PDB的预刷新备份</h4>
                  <div>
                     <p>此示例创建CDB <code class="codeph">cdb_prod</code>包含的PDB <code class="codeph">my_pdb</code>的预包装备份。CDB使用共享撤消，并在读写模式下打开。
                     </p>
                     <div class="section">
                        <p></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>确保满足创建预备份备份所需的先决条件，如<a href="../rcmrf/BACKUP.html#RCMRF-GUID-73642FF2-43C5-48B2-9969-99001C52EB50" target="_blank"><span><cite>Oracle数据库备份和恢复参考中所述</cite></span></a> 。</span></li>
                        <li class="stepexpand"><span>启动RMAN并以具有<code class="codeph">SYSBACKUP</code>权限的普通用户身份连接到root。</span><div>
                              <p>以下命令使用密码文件身份验证连接到根。 <code class="codeph">cdb_prod</code>是CDB的网络服务名称。</p><pre class="pre codeblock"><code>CONNECT TARGET“sbu @ cdb_prod AS SYSBACKUP”;</code></pre><p>出现提示时输入<code class="codeph">sbu</code>用户的密码。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>为CDB启用控制文件自动备份。</span><div><pre class="pre codeblock"><code>配置CONTROLFILE AUTOBACKUP ON;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>使用<code class="codeph">BACKUP PLUGGABLE DATABASE</code>命令<code class="codeph">BACKUP PLUGGABLE DATABASE</code> PDB。在备份中包含已归档的重做日志，以便您可以根据需要使用此备份执行介质恢复。</span><div>
                              <p>以下命令创建my_pdb的<code class="codeph">my_pdb</code>刷新备份，包括归档的重做日志文件。命名备份时使用的标记是<code class="codeph">mypdb_bkup</code> 。
                              </p><pre class="pre codeblock"><code>BACKUP PLUGGABLE DATABASE my_pdb PLUS ARCHIVELOG TAG mypdb_bkup;</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-896D464C-7741-4CE2-A8FD-E897300EB1AC" name="GUID-896D464C-7741-4CE2-A8FD-E897300EB1AC"></a><h3 id="BRADV-GUID-896D464C-7741-4CE2-A8FD-E897300EB1AC" class="sect3"><span class="enumeration_section">9.5</span>备份应用程序容器</h3>
               <div>
                  <p>RMAN使您可以使用<code class="codeph">BACKUP</code>命令在应用程序根，一个或多个应用程序PDB和应用程序容器上执行备份操作。
                  </p>
                  <p></p>
                  <div class="infoboxnote" id="GUID-896D464C-7741-4CE2-A8FD-E897300EB1AC__GUID-CAFE9238-7975-452A-A996-FF2E32E12F6D">
                     <p class="notep1">注意：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="backing-up-database.html#GUID-3F46FE1E-670A-4EE1-89A2-D0C9CE0CCA03" title="RMAN可以备份应用程序容器，应用程序PDB和应用程序根目录。">关于备份应用程序容器</a></p>
                        </li>
                        <li>
                           <p><a href="backing-up-database.html#GUID-DDB57A12-4A1C-4E7A-9B1A-BE680603F233" title="使用RMAN BACKUP命令备份应用程序根目录。">备份应用程序根目录</a></p>
                        </li>
                        <li>
                           <p><a href="backing-up-database.html#GUID-78023B42-87D5-40F4-A0EF-A99BAF68AE4F" title="使用BACKUP命令备份应用程序容器，该容器由应用程序根目录和属于应用程序根目录的所有应用程序PDB组成。">备份应用程序根及其应用程序PDB</a></p>
                        </li>
                        <li>
                           <p><a href="backing-up-database.html#GUID-9EAA1FF9-9F42-4EDC-8A77-0C29191BAAA1" title="BACKUP命令用于备份一个或多个应用程序PDB。">备份应用程序PDB</a></p>
                        </li>
                     </ul>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-3F46FE1E-670A-4EE1-89A2-D0C9CE0CCA03" name="GUID-3F46FE1E-670A-4EE1-89A2-D0C9CE0CCA03"></a><h4 id="BRADV-GUID-3F46FE1E-670A-4EE1-89A2-D0C9CE0CCA03" class="sect4"><span class="enumeration_section">9.5.1</span>关于备份应用程序容器</h4>
                  <div>
                     <p>RMAN可以备份应用程序容器，应用程序PDB和应用程序根目录。</p>
                     <p><a href="glossary.html#GUID-F213CD77-8CCF-430E-AA7B-A6BA7927EC98"><span class="xrefglossterm">应用程序容器</span></a>是CDB的可选组件，其存储一个或多个应用程序的数据并共享应用程序元数据和公共数据。CDB可以包含零个或多个应用程序容器。应用程序容器只包含一个<a href="glossary.html#GUID-CC9EB948-16BC-4AB6-A05E-08EEAFCDD05F"><span class="xrefglossterm">应用程序根</span></a> （与其CDB中的根不同）和一个或多个<a href="glossary.html#GUID-6E2F65AE-C36C-446D-84D7-4F709C7DEBCE"><span class="xrefglossterm">应用程序PDB</span></a> 。应用程序根用作插入其中的所有应用程序PDB的父容器。
                     </p>
                     <p>应用程序容器通常包含一个或多个应用程序公共用户。应用程序通用用户只能连接到创建它的应用程序根目录或插入此应用程序根目录的PDB。应用程序根目录具有自己的服务名称，您可以使用与连接到PDB相同的方式连接到应用程序根目录。</p>
                     <p>要为应用程序根或应用程序PDB执行备份和恢复任务，请将其连接到应用程序根目录或CDB根目录。</p>
                     <div class="infoboxnotealso" id="GUID-3F46FE1E-670A-4EE1-89A2-D0C9CE0CCA03__GUID-7D3A9019-4D77-4BA5-827A-7681B3F60B23">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关应用程序容器的概念信息的<a href="../multi/overview-of-the-multitenant-architecture.html#GUID-8F8979E3-9B81-4293-B3CF-ACCF42A0B2D6" target="_blank"><span><cite>Oracle数据库概念</cite></span></a></p>
                           </li>
                           <li>
                              <p>有关创建应用程序容器的信息，请参见<a href="../multi/creating-removing-application-containers-seeds-with-sql-plus.html#GUID-065649AC-18ED-4858-ACC5-36F011362A83" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-DDB57A12-4A1C-4E7A-9B1A-BE680603F233" name="GUID-DDB57A12-4A1C-4E7A-9B1A-BE680603F233"></a><h4 id="BRADV-GUID-DDB57A12-4A1C-4E7A-9B1A-BE680603F233" class="sect4"><span class="enumeration_section">9.5.2</span>备份应用程序根目录</h4>
                  <div>
                     <p>使用RMAN <code class="codeph">BACKUP</code>命令备份应用程序根目录。
                     </p>
                     <div class="section"></div>
                     <!-- class="section" -->
                     <div class="p">
                        <p>CDB的<code class="codeph">COMPATIBLE</code>参数必须设置为19.0或更高。
                        </p>
                        <p><span class="bold">要备份应用程序根目录：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到CDB根作为与所述共同的用户<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>特权或到应用程序的根作为与应用程序共同的用户<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>特权。</span></li>
                        <li class="stepexpand"><span>使用<code class="codeph">BACKUP APPLICATION ROOT</code>命令<code class="codeph">BACKUP APPLICATION ROOT</code>程序根目录。</span><div><pre class="pre codeblock"><code>备份应用程序根数据库;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-DDB57A12-4A1C-4E7A-9B1A-BE680603F233__GUID-1C7EB91F-53EE-47E5-8C85-7B5DDB6B37C1">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="您可以将RMAN客户端连接到多租户容器数据库（CDB）和可插拔数据库（PDB）。">与CDB建立RMAN连接</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-78023B42-87D5-40F4-A0EF-A99BAF68AE4F" name="GUID-78023B42-87D5-40F4-A0EF-A99BAF68AE4F"></a><h4 id="BRADV-GUID-78023B42-87D5-40F4-A0EF-A99BAF68AE4F" class="sect4"><span class="enumeration_section">9.5.3</span>备份应用程序根及其应用程序PDB</h4>
                  <div>
                     <p>使用<code class="codeph">BACKUP</code>命令备份应用程序容器，该容器由应用程序根目录和属于应用程序根目录的所有应用程序PDB组成。
                     </p>
                     <div class="p">
                        <p>CDB的<code class="codeph">COMPATIBLE</code>参数必须设置为12.2或更高。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><span class="bold">要连接到CDB并备份应用程序根目录及其所有应用程序PDB：</span></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p></p>
                        <ol id="GUID-78023B42-87D5-40F4-A0EF-A99BAF68AE4F__OL_PWZ_VGY_JGB">
                           <li>启动RMAN并以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的公共用户身份连接到CDB根目录。
                           </li>
                           <li>使用以下命令，其中<code class="codeph">hr_appcont</code>是应用程序根目录的名称：<pre class="pre codeblock"><code>BACKUP PLUGGABLE DATABASE hr_appcont</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><span class="bold">要连接到应用程序根目录并备份应用程序根目录及其所有应用程序PDB：</span></div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的应用程序通用用户身份连接到<a href="glossary.html#GUID-CC9EB948-16BC-4AB6-A05E-08EEAFCDD05F"><span class="xrefglossterm">应用程序根目录</span></a> 。</span><div>应用程序根目录有自己的服务名称，您可以使用与连接到PDB相同的方式连接到应用程序根目录。</div>
                        </li>
                        <li class="stepexpand"><span>使用以下命令备份<a href="glossary.html#GUID-F213CD77-8CCF-430E-AA7B-A6BA7927EC98"><span class="xrefglossterm">应用程序容器</span></a> ：</span><div><pre class="pre codeblock"><code>备份数据库;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-78023B42-87D5-40F4-A0EF-A99BAF68AE4F__GUID-B23BCB70-4949-40F8-8683-0084CCCA16E7">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="您可以将RMAN客户端连接到多租户容器数据库（CDB）和可插拔数据库（PDB）。">与CDB建立RMAN连接</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-9EAA1FF9-9F42-4EDC-8A77-0C29191BAAA1" name="GUID-9EAA1FF9-9F42-4EDC-8A77-0C29191BAAA1"></a><h4 id="BRADV-GUID-9EAA1FF9-9F42-4EDC-8A77-0C29191BAAA1" class="sect4"><span class="enumeration_section">9.5.4</span>备份应用程序PDB</h4>
                  <div>
                     <p><code class="codeph">BACKUP</code>命令用于备份一个或多个应用程序PDB。
                     </p>
                     <div class="p">
                        <p>CDB的<code class="codeph">COMPATIBLE</code>参数必须设置为12.2或更高。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><span class="bold">要备份一个或多个应用程序PDB：</span></div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并建立以下类型的连接之一：</span><div>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的应用程序通用用户身份连接到<a href="glossary.html#GUID-CC9EB948-16BC-4AB6-A05E-08EEAFCDD05F"><span class="xrefglossterm">应用程序根目录</span></a> 。
                                    </p>
                                    <p>应用程序根目录有自己的服务名称，您可以使用与连接到PDB相同的方式连接到应用程序根目录。</p>
                                 </li>
                                 <li>
                                    <p>使用<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限以普通用户身份连接到CDB根目录。
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>使用<code class="codeph">BACKUP PLUGGABLE DATABASE</code>命令备份<a href="glossary.html#GUID-6E2F65AE-C36C-446D-84D7-4F709C7DEBCE"><span class="xrefglossterm">应用程序PDB</span></a> 。要备份多个应用程序PDB，请使用以逗号分隔的应用程序PDB名称列表。</span><div>
                              <p>以下命令备份名为<code class="codeph">hr_app_pdb</code>的应用程序PDB：</p><pre class="pre codeblock"><code>BACKUP PLUGGABLE DATABASE hr_app_pdb;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-9EAA1FF9-9F42-4EDC-8A77-0C29191BAAA1__GUID-158AEBBC-28BE-4683-8773-29160EB3FDA2">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="您可以将RMAN客户端连接到多租户容器数据库（CDB）和可插拔数据库（PDB）。">与CDB建立RMAN连接</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-17F2020E-9C9B-4D1C-BC60-A09C3A87CF55" name="GUID-17F2020E-9C9B-4D1C-BC60-A09C3A87CF55"></a><h3 id="BRADV-GUID-17F2020E-9C9B-4D1C-BC60-A09C3A87CF55" class="sect3"><span class="enumeration_section">9.6</span>使用RMAN备份稀疏数据库</h3>
               <div>
                  <p>使用<code class="codeph">BACKUP</code>命令备份稀疏数据库。
                  </p>
                  <p></p>
                  <div class="p">本节包含以下主题：<ul style="list-style-type:disc">
                        <li>
                           <p><a href="backing-up-database.html#GUID-E61CEE70-896E-49D0-8405-C9E4F243D4BF" title="RMAN使您可以使用备份集或映像副本格式中的备份整个数据库的步骤来备份稀疏数据库。">使用RMAN备份稀疏数据库</a></p>
                        </li>
                        <li>
                           <p><a href="backing-up-database.html#GUID-0A2A3056-AD3A-4A92-B4FB-4EABB200FA42" title="您可以使用BACKUP命令备份包含稀疏数据文件或单个稀疏数据文件的一个或多个表空间。">使用RMAN备份稀疏表空间和数据文件</a></p>
                        </li>
                        <li>
                           <p><a href="backing-up-database.html#GUID-731D2F5F-9B1F-4209-8257-FD30C636998F">使用RMAN备份稀疏CDB</a></p>
                        </li>
                        <li>
                           <p><a href="backing-up-database.html#GUID-4BCE971E-3860-4BDE-A052-E4D313FCB5A6" title="RMAN使您可以备份CDB中的一个或多个稀疏PDB。">使用RMAN备份稀疏PDB</a></p>
                        </li>
                     </ul>
                  </div>
                  <div class="infoboxnote" id="GUID-17F2020E-9C9B-4D1C-BC60-A09C3A87CF55__GUID-2E33F1E3-CD94-48B0-B648-801094DEFE23">
                     <p class="notep1">注意：</p>
                     <p>稀疏数据库中的基本（只读）数据文件未加密。确保基础数据文件存储在受保护的存储中，并使用安全通信进行访问。</p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-E61CEE70-896E-49D0-8405-C9E4F243D4BF" name="GUID-E61CEE70-896E-49D0-8405-C9E4F243D4BF"></a><h4 id="BRADV-GUID-E61CEE70-896E-49D0-8405-C9E4F243D4BF" class="sect4"><span class="enumeration_section">9.6.1</span>使用RMAN备份稀疏数据库</h4>
                  <div>
                     <p>RMAN使您可以使用备份集或映像副本格式中的备份整个数据库的步骤来备份稀疏数据库。</p>
                     <div class="section">
                        <p>备份稀疏数据库时的区别在于RMAN仅从数据库的增量存储空间备份数据，其中包含对稀疏数据库中的数据块所做的最新更改。</p>
                        <div class="p">在备份稀疏数据库之前，请确保满足以下要求：<ul style="list-style-type:disc">
                              <li>
                                 <p>稀疏数据库的基础数据库必须是只读的</p>
                              </li>
                              <li>
                                 <p>要备份的数据库的<code class="codeph">COMPATIBLE</code>初始化参数必须设置为12.2或更高。
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-E61CEE70-896E-49D0-8405-C9E4F243D4BF__GUID-978469A7-AFB2-4C95-BFA1-F990AA0FABA3">备份稀疏数据库</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库，如<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接中</a>所述。</span><div></div>
                        </li>
                        <li class="stepexpand"><span>确保已装入或打开数据库。</span></li>
                        <li class="stepexpand"><span>使用<code class="codeph">AS SPARSE</code>选项发出<code class="codeph">BACKUP</code>命令。要指定备份格式，请使用以下选项之一：</span><div>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <div class="p">要以备份集格式创建备份，请使用<code class="codeph">AS SPARSE BACKUPSET</code>选项。以下示例以备份集格式执行稀疏备份：<pre class="pre codeblock"><code>备份为SPARSE BACKUPSET DATABASE PLUS ARCHIVELOG;</code></pre></div>
                                 </li>
                                 <li>
                                    <div class="p">要以映像副本格式创建备份，请使用<code class="codeph">AS SPARSE COPY</code>选项。以下示例以图像副本格式执行备份：<pre class="pre codeblock"><code>备份为SPARSE COPY DATABASE PLUS ARCHIVELOG;</code></pre></div>
                                 </li>
                                 <li>
                                    <div class="p">要以压缩备份集格式创建备份，请使用<code class="codeph">COMPRESSED BACKUPSET</code>选项。以下示例以压缩备份集格式执行备份：<pre class="pre codeblock"><code>备份为SPARSE压缩备用数据库;</code></pre></div>
                                 </li>
                              </ul>
                              <div class="infoboxnotealso" id="GUID-E61CEE70-896E-49D0-8405-C9E4F243D4BF__GUID-66CEE34A-5872-4BF8-95A4-04F1E4931675">
                                 <p class="notep1">也可以看看：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><a href="rman-backup-concepts.html#GUID-D0AEBAF2-FDEA-4977-9B4D-97759A1CA865" title="您可以使用RMAN BACKUP命令从稀疏数据文件，包含稀疏数据文件的表空间，稀疏可插拔数据库（PDB）和包含稀疏PDB的多租户容器数据库（CDB）备份数据块。">有关稀疏备份</a>的详细信息，请参阅稀疏备份</p>
                                    </li>
                                    <li>
                                       <p><a href="backing-up-database.html#GUID-D7EC8119-A260-4300-8756-F53DBC2C2D45" title="您可以在装入或打开数据库的情况下执行整个数据库备份。">使用RMAN备份整个数据库，</a>以获取有关如何在普通数据库上执行传统备份的更多信息</p>
                                    </li>
                                    <li>
                                       <p><a href="backing-up-database.html#GUID-0A2A3056-AD3A-4A92-B4FB-4EABB200FA42" title="您可以使用BACKUP命令备份包含稀疏数据文件或单个稀疏数据文件的一个或多个表空间。">使用RMAN备份稀疏表空间和数据文件</a></p>
                                    </li>
                                    <li>
                                       <p><a href="rman-complete-database-recovery.html#GUID-C8453C47-BA71-4272-B0D4-BC7B97EC2584" title="执行包含稀疏数据文件的数据库的恢复与执行整个数据库的恢复非常相似。">执行稀疏数据库的完全恢复</a></p>
                                    </li>
                                 </ul>
                              </div>
                              <div class="infoboxnotealso" id="GUID-E61CEE70-896E-49D0-8405-C9E4F243D4BF__GUID-1700583F-8783-4E12-8AC5-D7E4634D8428">
                                 <p class="notep1">也可以看看：</p>
                                 <p><span class="italic"><a href="../rcmrf/BACKUP.html#RCMRF-GUID-73642FF2-43C5-48B2-9969-99001C52EB50" target="_blank"><span><cite>有关备份</cite></span></a></span>稀疏数据库的选项的更多信息，请<span class="italic"><a href="../rcmrf/BACKUP.html#RCMRF-GUID-73642FF2-43C5-48B2-9969-99001C52EB50" target="_blank"><span><cite>参见Oracle数据库备份和恢复参考</cite></span></a></span></p>
                              </div>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-0A2A3056-AD3A-4A92-B4FB-4EABB200FA42" name="GUID-0A2A3056-AD3A-4A92-B4FB-4EABB200FA42"></a><h4 id="BRADV-GUID-0A2A3056-AD3A-4A92-B4FB-4EABB200FA42" class="sect4"><span class="enumeration_section">9.6.2</span>使用RMAN备份稀疏表空间和数据文件</h4>
                  <div>
                     <p>您可以使用<code class="codeph">BACKUP</code>命令<code class="codeph">BACKUP</code>包含稀疏数据文件或单个稀疏数据文件的一个或多个表空间。
                     </p>
                     <div class="section">在备份表空间时，RMAN将<code class="codeph">BACKUP</code>命令转换为稀疏兼容的各个数据文件。同样，只有包含稀疏数据块的数据文件才有资格进行稀疏备份。RMAN创建稀疏数据文件的稀疏备份和非稀疏数据文件的非稀疏备份。
                     </div>
                     <!-- class="section" -->
                     <div class="p">确保包含稀疏表空间或数据文件的数据库将<code class="codeph">COMPATIBLE</code>初始化参数设置为12.2或更高。
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-0A2A3056-AD3A-4A92-B4FB-4EABB200FA42__GUID-31D7A2D3-7787-402A-B265-BC26A2BA79EF">要备份稀疏表空间或数据文件：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库。对于CDB中的表空间和数据文件，必须以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的用户身份连接到root。</span><div>
                              <div class="infoboxnotealso" id="GUID-0A2A3056-AD3A-4A92-B4FB-4EABB200FA42__GUID-6AA90B4E-0469-4661-A457-3DAECA20B68D">
                                 <p class="notep1">也可以看看：</p>
                                 <p><a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">与RMAN建立数据库连接，</a>以获取有关连接到目标数据库的信息</p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>确保已装入或打开数据库实例。</span></li>
                        <li class="stepexpand"><span>使用<code class="codeph">AS SPARSE</code>选项运行表空间或数据文件的<code class="codeph">BACKUP</code>命令。指定是否要以备份集格式，映像副本格式或压缩备份集格式进行备份。为此，请说明以下选项之一：</span><div>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <div class="p">要以备份集格式创建备份，请使用<code class="codeph">AS SPARSE BACKUPSET</code>选项。以下示例以备份集格式执行稀疏备份：<pre class="pre codeblock"><code>备份为SPARSE BACKUPSET TABLESPACE MYTBS1;</code></pre></div>
                                 </li>
                                 <li>
                                    <div class="p">要以映像副本格式创建备份，请使用<code class="codeph">AS SPARSE COPY</code>选项。以下示例以图像副本格式执行备份：<pre class="pre codeblock"><code>备份为SPARSE复制数据文件8,9,10;</code></pre></div>
                                 </li>
                                 <li>
                                    <div class="p">要以压缩备份集格式创建备份，请使用<code class="codeph">COMPRESSED BACKUPSET</code>选项。以下示例以压缩备份集格式执行备份：<pre class="pre codeblock"><code>备份为SPARSE压缩备用空间MYTBS3;</code></pre></div>
                                 </li>
                              </ul>
                              <div class="infoboxnotealso" id="GUID-0A2A3056-AD3A-4A92-B4FB-4EABB200FA42__GUID-910D6C32-953A-4D66-B10D-B8CAA8D6A6D6">
                                 <p class="notep1">也可以看看：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><a href="backing-up-database.html#GUID-E61CEE70-896E-49D0-8405-C9E4F243D4BF" title="RMAN使您可以使用备份集或映像副本格式中的备份整个数据库的步骤来备份稀疏数据库。">使用RMAN备份稀疏数据库</a></p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></span></p>
                                    </li>
                                 </ul>
                              </div>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-731D2F5F-9B1F-4209-8257-FD30C636998F" name="GUID-731D2F5F-9B1F-4209-8257-FD30C636998F"></a><h4 id="BRADV-GUID-731D2F5F-9B1F-4209-8257-FD30C636998F" class="sect4"><span class="enumeration_section">9.6.3</span>使用RMAN备份稀疏CDB</h4>
                  <div>
                     <div class="section">您可以通过执行类似于使用<code class="codeph">BACKUP</code>命令<code class="codeph">BACKUP</code>稀疏数据库的备份操作来备份稀疏多租户容器数据库（CDB）或包含一些稀疏可插拔数据库（PDB）的CDB。
                     </div>
                     <!-- class="section" -->
                     <div class="p">确保CDB的<code class="codeph">COMPATIBLE</code>初始化参数设置为12.2或更高。
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-731D2F5F-9B1F-4209-8257-FD30C636998F__GUID-BF30ED66-CD16-404E-BC04-076074E28536">备份稀疏的CDB：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并以具有<code class="codeph">SYSBACKUP</code>或<code class="codeph">SYSDBA</code>权限的公共用户身份连接到root。</span></li>
                        <li class="stepexpand"><span>确保CDB已安装或打开并处于<code class="codeph">ARCHIVELOG</code>模式。</span></li>
                        <li class="stepexpand"><span>使用<code class="codeph">AS SPARSE</code>选项输入<code class="codeph">BACKUP</code>命令。指定要在其中创建备份的格式：</span><div>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <div class="p">要以备份集格式创建备份，请使用<code class="codeph">AS SPARSE BACKUPSET</code>选项。以下示例以备份集格式在稀疏CDB上执行备份：<pre class="pre codeblock"><code>备份为SPARSE BACKUPSET数据库;</code></pre></div>
                                 </li>
                                 <li>
                                    <div class="p">要以映像副本格式创建备份，请使用<code class="codeph">AS SPARSE COPY</code>选项。以下示例以图像副本格式在稀疏CDB上执行备份：<pre class="pre codeblock"><code>备份为SPARSE COPY DATABASE;</code></pre></div>
                                 </li>
                                 <li>
                                    <div class="p">要以压缩备份集格式创建备份，请使用<code class="codeph">COMPRESSED BACKUPSET</code>选项。以下示例以压缩备份集格式在稀疏CDB上执行备份：<pre class="pre codeblock"><code>备份为SPARSE压缩备用数据库;</code></pre></div>
                                 </li>
                              </ul>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-731D2F5F-9B1F-4209-8257-FD30C636998F__GUID-3F18313D-B01D-48E4-AB10-1DC6D955119A">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="backing-up-database.html#GUID-E61CEE70-896E-49D0-8405-C9E4F243D4BF" title="RMAN使您可以使用备份集或映像副本格式中的备份整个数据库的步骤来备份稀疏数据库。">使用RMAN备份稀疏数据库</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-complete-database-recovery.html#GUID-9E0A0ABF-4DC9-4DF6-9015-004868ACB01C" title="执行稀疏CDB的恢复与执行稀疏数据库的完全恢复非常相似。">执行稀疏CDB的完全恢复</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-4BCE971E-3860-4BDE-A052-E4D313FCB5A6" name="GUID-4BCE971E-3860-4BDE-A052-E4D313FCB5A6"></a><h4 id="BRADV-GUID-4BCE971E-3860-4BDE-A052-E4D313FCB5A6" class="sect4"><span class="enumeration_section">9.6.4</span>使用RMAN备份稀疏PDB</h4>
                  <div>
                     <p>RMAN使您可以备份CDB中的一个或多个稀疏PDB。</p>
                     <div class="p">确保<code class="codeph">COMPATIBLE</code>初始化参数设置为12.2或更高。
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-4BCE971E-3860-4BDE-A052-E4D313FCB5A6__GUID-1DA3E499-9362-4B9B-A63A-8545A0E3A91E">在连接到root时备份稀疏PDB：</p>
                        <ol>
                           <li>
                              <p>启动RMAN并以具有<code class="codeph">SYSBACKUP</code>或<code class="codeph">SYSDBA</code>权限的公共用户身份连接到根，如将<a href="starting-interacting-with-rman-client.html#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D" title="有几种方法可以将目标连接到根目录。">目标连接到根目录中所述</a> 。
                              </p>
                           </li>
                           <li>
                              <div class="p">运行可插拔数据库的<code class="codeph">BACKUP</code>命令。指定备份的格式：<ul style="list-style-type:disc">
                                    <li>
                                       <div class="p">要以备份集格式创建备份，请使用<code class="codeph">AS SPARSE BACKUPSET</code>选项。以下示例以备份集格式执行稀疏备份：<pre class="pre codeblock"><code>备份为SPARSE BACKUPSET PLOGGABLE DATABASE PDB1;</code></pre></div>
                                    </li>
                                    <li>
                                       <div class="p">要以映像副本格式创建备份，请使用<code class="codeph">AS SPARSE COPY</code>选项。以下示例以图像副本格式执行备份：<pre class="pre codeblock"><code>备份为SPARSE COPY PLUGGABLE DATABASE PDB1;</code></pre></div>
                                    </li>
                                    <li>
                                       <div class="p">要以压缩备份集格式创建备份，请使用<code class="codeph">COMPRESSED BACKUPSET</code>选项。以下示例以压缩备份集格式执行备份：<pre class="pre codeblock"><code>备份为SPARSE压缩备用可插拔数据库PDB1;</code></pre></div>
                                    </li>
                                 </ul>
                              </div>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-4BCE971E-3860-4BDE-A052-E4D313FCB5A6__GUID-2158B9B7-A413-40FF-A734-9D62D0A41236">在连接到PDB时备份稀疏PDB：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN。以具有<code class="codeph">SYSBACKUP</code>或<code class="codeph">SYSDBA</code>权限的<a href="glossary.html#GUID-43EA1A4C-E5EB-4926-99EC-1DDA0E74A07C"><span class="xrefglossterm">本地用户</span></a>身份连接到稀疏PDB，如将<a href="starting-interacting-with-rman-client.html#GUID-E95C5C27-C036-4773-B77C-E4120526F422" title="您可以从RMAN提示符或操作系统命令行连接到PDB。">目标连接到PDB中所述</a> 。</span><div></div>
                        </li>
                        <li class="stepexpand"><span>在RMAN提示符下运行<code class="codeph">BACKUP</code>命令，使用<code class="codeph">AS SPARSE</code>选项和所需格式。要指定备份的格式，请使用以下命令之一：</span><div>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <div class="p">要以备份集格式创建备份，请使用<code class="codeph">AS SPARSE BACKUPSET</code>选项。以下示例以备份集格式执行稀疏备份：<pre class="pre codeblock"><code>备份为SPARSE BACKUPSET数据库;</code></pre></div>
                                 </li>
                                 <li>
                                    <div class="p">要以映像副本格式创建备份，请使用<code class="codeph">AS SPARSE COPY</code>选项。以下示例以图像副本格式执行备份：<pre class="pre codeblock"><code>备份为SPARSE COPY DATABASE;</code></pre></div>
                                 </li>
                                 <li>
                                    <div class="p">要以压缩备份集格式创建备份，请使用<code class="codeph">COMPRESSED BACKUPSET</code>选项。以下示例以压缩备份集格式执行备份：<pre class="pre codeblock"><code>备份为SPARSE压缩备用数据库;</code></pre></div>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>要从稀疏PDB备份表空间，请直接连接到选定的PDB，然后使用<code class="codeph">AS SPARSE</code>选项，相应的备份格式和表空间名称运行<code class="codeph">BACKUP</code>命令。</span></li>
                        <li class="stepexpand"><span>要从稀疏PDB备份数据文件，您可以连接到root或直接连接到PDB。使用<code class="codeph">AS SPARSE</code>选项，备份格式和数据文件名运行<code class="codeph">BACKUP</code>命令，以备份单个数据文件。</span></li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-4BCE971E-3860-4BDE-A052-E4D313FCB5A6__GUID-6379A333-5C78-4A01-8455-98166E5ABE27">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="backing-up-database.html#GUID-655DC5F5-FF8D-4A73-B67D-F5AAE20CA382" title="RMAN允许您使用BACKUP命令备份CDB中的一个或多个PDB。">使用RMAN备份PDB</a></p>
                           <p><a href="rman-complete-database-recovery.html#GUID-C7DF025E-B8DF-4686-876D-AAE28E7869CF" title="在根级别或CDB级别连接时，可以恢复稀疏PDB。">使用RMAN执行稀疏PDB的恢复</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV81399"></a><div class="props_rev_3"><a id="GUID-4481CA5F-B1B5-4819-9E6B-7184951EC81A" name="GUID-4481CA5F-B1B5-4819-9E6B-7184951EC81A"></a><h3 id="BRADV-GUID-4481CA5F-B1B5-4819-9E6B-7184951EC81A" class="sect3"><span class="enumeration_section">9.7</span>使用RMAN备份存档的重做日志</h3>
               <div>
                  <p>归档重做日志是成功恢复媒体的关键。你应该定期备份它们。</p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="backing-up-database.html#GUID-344774AE-65ED-49CB-A0EE-021E2C60102E" title="RMAN备份的若干功能特定于归档重做日志。例如，您可以使用BACKUP ...删除以将备份到备份集后从磁盘中删除一个或所有归档重做日志副本。">关于非CDB的归档重做日志的备份</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-2E06F006-55ED-46EA-A3CD-35DD34E067C9" title="在CDB中，只有当您以具有SYSDBA或SYSBACKUP权限的普通用户身份连接到根时，才能备份存档的重做日志。">关于在CDB中备份存档重做日志</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-66760DDA-F264-4ECC-9FDF-861FF8032F0C" title="要备份存档日志，请使用BACKUP ARCHIVELOG命令。">在非CDB中备份存档的重做日志文件</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-4AA2DE00-B80B-47CE-8861-8733C120E8E2" title="您可以指示RMAN应自动跳过归档重做日志的备份。">仅备份需要在非CDB中备份的存档重做日志</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-82593941-EA75-4BB0-A001-3B086C6B72EA" title="您可以使用BACKUP ARCHIVELOG命令备份多租户容器数据库（CDB）中的归档重做日志。">在CDB中备份存档的重做日志</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-E99C2A06-868F-458A-88F1-B257EADD63CB" title="BACKUP ARCHIVELOG ......DELETE INPUT命令在备份后删除存档的日志文件。此命令消除了手动删除存档重做日志的单独步骤。">在非CDB中备份后删除存档的重做日志</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-3ABF5B11-71BA-4161-8CC1-DE7C33EDE853" title="在CDB中，您可以使用BACKUP ARCHIVELOG备份后删除存档的重做日志...DELETE INPUT命令。">在CDB中备份后删除存档的重做日志</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89520"></a><div class="props_rev_3"><a id="GUID-344774AE-65ED-49CB-A0EE-021E2C60102E" name="GUID-344774AE-65ED-49CB-A0EE-021E2C60102E"></a><h4 id="BRADV-GUID-344774AE-65ED-49CB-A0EE-021E2C60102E" class="sect4"><span class="enumeration_section">9.7.1</span>关于非CDB的归档重做日志的备份</h4>
                  <div>
                     <p>RMAN备份的若干功能特定于归档重做日志。例如，您可以使用<code class="codeph">BACKUP ...DELETE</code>以将备份到备份集后从磁盘中删除一个或所有归档重做日志副本。
                     </p>
                     <p>本节包含以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="backing-up-database.html#GUID-2AC0D66D-D261-432E-8E28-FD3030C4AB0C" title="即使您的重做日志存档到多个目标并且您使用RMAN备份存档的重做日志，RMAN也只选择一个存档的重做日志文件副本以包含在备份集中。由于具有相同日志序列号的日志相同，因此RMAN不需要包含多个日志副本。">关于存档重做日志故障转移</a></p>
                        </li>
                        <li>
                           <p><a href="backing-up-database.html#GUID-5A2AEEA4-CB81-421A-8C4A-805B92DBD8FA" title="自动在线重做日志切换是一项重要的RMAN功能。">关于在线重做日志切换</a></p>
                        </li>
                     </ul>
                  </div><a id="BRADV232"></a><a id="BRADV89521"></a><div class="props_rev_3"><a id="GUID-2AC0D66D-D261-432E-8E28-FD3030C4AB0C" name="GUID-2AC0D66D-D261-432E-8E28-FD3030C4AB0C"></a><h5 id="BRADV-GUID-2AC0D66D-D261-432E-8E28-FD3030C4AB0C" class="sect5"><span class="enumeration_section">9.7.1.1</span>关于存档重做日志故障转移</h5>
                     <div>
                        <p>即使您的重做日志存档到多个目标并且您使用RMAN备份存档的重做日志，RMAN也只选择一个存档的重做日志文件副本以包含在备份集中。由于具有相同日志序列号的日志相同，因此RMAN不需要包含多个日志副本。</p>
                        <p><a href="glossary.html#GUID-DFD7F339-C64C-4FE2-8F89-C88B4A020571"><span class="xrefglossterm">归档重做日志故障转移</span></a>功能使RMAN即使在某些归档目标缺少日志或包含具有损坏块的日志时也能完成备份。如果快速恢复区域或任何归档目标中至少有一个对应于给定日志序列和线程的日志，则RMAN会尝试对其进行备份。如果RMAN在备份期间在日志文件中发现损坏的块，则会在其他目标中搜索该日志的副本，而不会出现损坏的块。
                        </p>
                        <p>例如，假设您将日志121到124存档到两个目标： <code class="codeph">/arch1</code>和<code class="codeph">/arch2</code> 。<a href="backing-up-database.html#GUID-2AC0D66D-D261-432E-8E28-FD3030C4AB0C__CHDHDGAE" title="采样归档重做日志记录">表9-1</a>显示了控制文件中的归档重做日志记录。
                        </p>
                        <div class="tblformal" id="GUID-2AC0D66D-D261-432E-8E28-FD3030C4AB0C__CHDHDGAE">
                           <p class="titleintable">表9-1存档的重做日志记录示例</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="归档重做日志记录示例" width="100%" border="1" summary="Sampled archived redo log records" frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="14%" id="d40792e7300">序列</th>
                                    <th align="left" valign="bottom" width="43%" id="d40792e7303">/ arch1中的文件名</th>
                                    <th align="left" valign="bottom" width="43%" id="d40792e7306">/ arch2中的文件名</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="14%" id="d40792e7311" headers="d40792e7300 ">
                                       <p>121</p>
                                    </td>
                                    <td align="left" valign="top" width="43%" headers="d40792e7311 d40792e7303 ">
                                       <p><code class="codeph">/arch1/archive1_121.arc</code></p>
                                    </td>
                                    <td align="left" valign="top" width="43%" headers="d40792e7311 d40792e7306 ">
                                       <p><code class="codeph">/arch2/archive1_121.arc</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="14%" id="d40792e7323" headers="d40792e7300 ">
                                       <p>122</p>
                                    </td>
                                    <td align="left" valign="top" width="43%" headers="d40792e7323 d40792e7303 ">
                                       <p><code class="codeph">/arch1/archive1_122.arc</code></p>
                                    </td>
                                    <td align="left" valign="top" width="43%" headers="d40792e7323 d40792e7306 ">
                                       <p><code class="codeph">/arch2/archive1_122.arc</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="14%" id="d40792e7335" headers="d40792e7300 ">
                                       <p>123</p>
                                    </td>
                                    <td align="left" valign="top" width="43%" headers="d40792e7335 d40792e7303 ">
                                       <p><code class="codeph">/arch1/archive1_123.arc</code></p>
                                    </td>
                                    <td align="left" valign="top" width="43%" headers="d40792e7335 d40792e7306 ">
                                       <p><code class="codeph">/arch2/archive1_123.arc</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="14%" id="d40792e7347" headers="d40792e7300 ">
                                       <p>124</p>
                                    </td>
                                    <td align="left" valign="top" width="43%" headers="d40792e7347 d40792e7303 ">
                                       <p><code class="codeph">/arch1/archive1_124.arc</code></p>
                                    </td>
                                    <td align="left" valign="top" width="43%" headers="d40792e7347 d40792e7306 ">
                                       <p><code class="codeph">/arch2/archive1_124.arc</code></p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>但是，RMAN不知道，用户从<code class="codeph">/arch1</code>目录中删除日志122和124。然后，运行以下备份：</p><pre class="pre codeblock"><code>序列中的备份存档121直到序列125;</code></pre><p>通过故障转移，RMAN使用<code class="codeph">/arch2</code>日志122和124完成备份。
                        </p>
                     </div>
                  </div><a id="BRADV89523"></a><div class="props_rev_3"><a id="GUID-5A2AEEA4-CB81-421A-8C4A-805B92DBD8FA" name="GUID-5A2AEEA4-CB81-421A-8C4A-805B92DBD8FA"></a><h5 id="BRADV-GUID-5A2AEEA4-CB81-421A-8C4A-805B92DBD8FA" class="sect5"><span class="enumeration_section">9.7.1.2</span>关于在线重做日志切换</h5>
                     <div>
                        <p>自动在线重做日志切换是一项重要的RMAN功能。</p>
                        <p>要对包含最新联机重做日志的归档重做日志进行打开数据库备份，可以使用以下任何子句执行<code class="codeph">BACKUP</code>命令：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">加上ARCHIVELOG</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">ARCHIVELOG ALL</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">ARCHIVELOG来自......</code></p>
                           </li>
                        </ul>
                        <p>在开始备份之前，RMAN会切换出当前的重做日志组，并归档所有尚未归档的联机重做日志，包括发出命令时当前的重做日志组。此功能可确保备份包含在命令启动之前生成的所有重做。</p>
                        <p>备份归档重做日志的有效方法是<code class="codeph">BACKUP</code> <code class="codeph">...</code> <code class="codeph">PLUS</code> <code class="codeph">ARCHIVELOG</code>命令，导致RMAN执行以下操作：</p>
                        <ol>
                           <li>
                              <p>运行<a href="../sqlrf/ALTER-SYSTEM.html#SQLRF00902" target="_blank"><code class="codeph">ALTER SYSTEM</code></a> <code class="codeph">ARCHIVE</code> <code class="codeph">LOG</code> <code class="codeph">CURRENT</code>语句。
                              </p>
                           </li>
                           <li>
                              <p>运行<code class="codeph">BACKUP ARCHIVELOG ALL</code> 。如果启用了<a href="glossary.html#GUID-C75B395F-CA6E-4286-826B-67AABE99606A"><span class="xrefglossterm">备份优化</span></a> ，则RMAN会跳过已备份到指定设备的日志。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">BACKUP</code>命令中指定的其余文件。
                              </p>
                           </li>
                           <li>
                              <p>运行<code class="codeph">ALTER SYSTEM ARCHIVE LOG CURRENT</code>语句。
                              </p>
                           </li>
                           <li>
                              <p>备份备份期间生成的所有剩余存档日志。如果未启用备份优化，则RMAN将备份步骤1中生成的日志以及备份期间生成的所有日志。</p>
                           </li>
                        </ol>
                        <p>上述步骤保证在命令期间采取的数据文件备份可恢复到一致状态。此外，除非在备份结束时归档联机重做日志，否则备份无法进行<code class="codeph">DUPLICATE</code> 。
                        </p>
                     </div>
                  </div>
               </div><a id="BRADV835"></a><div class="props_rev_3"><a id="GUID-2E06F006-55ED-46EA-A3CD-35DD34E067C9" name="GUID-2E06F006-55ED-46EA-A3CD-35DD34E067C9"></a><h4 id="BRADV-GUID-2E06F006-55ED-46EA-A3CD-35DD34E067C9" class="sect4"><span class="enumeration_section">9.7.2</span>关于在CDB中备份存档的重做日志</h4>
                  <div>
                     <p>在CDB中，只有当您以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的普通用户身份连接到根时，才能备份存档的重做日志。
                     </p>
                     <p>以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的本地用户身份连接到PDB时，无法备份或删除存档的重做日志。
                     </p>
                     <p>如果将归档的重做日志复制到多个目标，则在连接到根目录和备份归档的重做日志文件时，RMAN仅在备份中包含一个归档的重做日志文件副本。连接到CDB的根目录时，可以切换存档的重做日志文件。因此，当您连接到根时， <span class="q">“ <a href="backing-up-database.html#GUID-2AC0D66D-D261-432E-8E28-FD3030C4AB0C" title="即使您的重做日志存档到多个目标并且您使用RMAN备份存档的重做日志，RMAN也只选择一个存档的重做日志文件副本以包含在备份集中。由于具有相同日志序列号的日志相同，因此RMAN不需要包含多个日志副本。">关于存档重做日志故障转移</a> ”</span>和<span class="q">“ <a href="backing-up-database.html#GUID-5A2AEEA4-CB81-421A-8C4A-805B92DBD8FA" title="自动在线重做日志切换是一项重要的RMAN功能。">关于联机重做日志切换</a> ”</span>中的信息适用。但是，连接到PDB时，无法备份或切换存档的重做日志文件。</p>
                     <div class="infoboxnotealso" id="GUID-2E06F006-55ED-46EA-A3CD-35DD34E067C9__GUID-CDBE0F48-A5A5-4FD4-892D-770DF24C00F8">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="backing-up-database.html#GUID-82593941-EA75-4BB0-A001-3B086C6B72EA" title="您可以使用BACKUP ARCHIVELOG命令备份多租户容器数据库（CDB）中的归档重做日志。">在CDB中备份存档的重做日志</a></p>
                     </div>
                  </div>
               </div><a id="BRADV611"></a><a id="BRADV89525"></a><div class="props_rev_3"><a id="GUID-66760DDA-F264-4ECC-9FDF-861FF8032F0C" name="GUID-66760DDA-F264-4ECC-9FDF-861FF8032F0C"></a><h4 id="BRADV-GUID-66760DDA-F264-4ECC-9FDF-861FF8032F0C" class="sect4"><span class="enumeration_section">9.7.3</span>备份非CDB中的归档重做日志文件</h4>
                  <div>
                     <p>要备份存档日志，请使用<code class="codeph">BACKUP</code> <code class="codeph">ARCHIVELOG</code>命令。
                     </p>
                     <div class="section">
                        <p>如果启用了<a href="glossary.html#GUID-C75B395F-CA6E-4286-826B-67AABE99606A"><span class="xrefglossterm">备份优化</span></a> ，则RMAN会跳过已备份到指定设备的已归档日志的备份。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-66760DDA-F264-4ECC-9FDF-861FF8032F0C__GUID-1DFBA5B2-6D14-416E-848B-6979481368EF">要备份存档的重做日志文件：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用），如<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接中</a>所述。</span></li>
                        <li class="stepexpand"><span>确保已装入或打开目标数据库。</span></li>
                        <li class="stepexpand"><span>执行<code class="codeph">BACKUP ARCHIVELOG</code>或<code class="codeph">BACKUP ...PLUS ARCHIVELOG</code>命令。</span><div>
                              <p>以下示例备份数据库和所有归档重做日志：</p><pre class="pre codeblock"><code>BACKUP DATABASE PLUS ARCHIVELOG;</code></pre><p>以下示例使用已配置的磁盘或SBT通道备份所有归档重做日志的每个日志序列号的一个副本：</p><pre class="pre codeblock"><code>备份ARCHIVELOG ALL;</code></pre><p>您还可以按时间，SCN或日志序列号指定一系列归档重做日志，如以下示例所示：</p><pre class="pre codeblock"><code>从'SYDATE-30'时间开始备份存档，直到时间'SYSDATE-7';</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV234"></a><a id="BRADV89522"></a><div class="props_rev_3"><a id="GUID-4AA2DE00-B80B-47CE-8861-8733C120E8E2" name="GUID-4AA2DE00-B80B-47CE-8861-8733C120E8E2"></a><h4 id="BRADV-GUID-4AA2DE00-B80B-47CE-8861-8733C120E8E2" class="sect4"><span class="enumeration_section">9.7.4</span>仅备份需要在非CDB中备份的存档重做日志</h4>
                  <div>
                     <p>您可以指示RMAN应<span class="italic">自动</span>跳过归档重做日志的备份。
                     </p>
                     <div class="section">
                        <p>使用以下技术之一：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>配置<a href="glossary.html#GUID-C75B395F-CA6E-4286-826B-67AABE99606A"><span class="xrefglossterm">备份优化</span></a> 。
                              </p>
                              <p>如果启用了备份优化，则在将相同的归档日志备份到指定的设备类型时， <a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><code class="codeph">BACKUP ARCHIVELOG</code></a>命令会跳过备份文件。当归档日志具有相同的DBID，线程，序列号和<code class="codeph">RESETLOGS</code> SCN和时间时，它们被视为与另一个日志相同。
                              </p>
                           </li>
                           <li>
                              <p>配置<a href="glossary.html#GUID-3492E0C3-F42C-45E6-84E2-63E30A3489A4"><span class="xrefglossterm">归档重做日志删除策略</span></a> 。
                              </p>
                              <p>如果使用<code class="codeph">BACKED UP</code> <span class="italic"><code class="codeph">integer</code></span> <code class="codeph">TIMES</code>子句配置删除策略，则<code class="codeph">BACKUP ARCHIVELOG</code>命令将复制日志，除非指定设备类型上存在<span class="italic"><code class="codeph">integer</code></span>备份。如果存在日志的<span class="italic"><code class="codeph">integer</code></span>备份，则<code class="codeph">BACKUP ARCHIVELOG</code>命令会跳过日志。
                              </p>
                           </li>
                        </ul>
                        <p><code class="codeph">BACKUP ...NOT BACKED UP</code> <span class="italic"><code class="codeph">integer</code></span> <code class="codeph">TIMES</code>命令指定RMAN仅将尚未备份至少<span class="italic"><code class="codeph">integer</code></span>数倍的归档日志文件备份到指定设备。要确定文件的备份数，RMAN仅考虑在与当前备份相同的设备类型上创建的备份。
                        </p>
                        <p><code class="codeph">BACKED UP</code>子句是将归档日志备份到指定设备类型的便捷方式。例如，您可以指定RMAN应在磁带上保留每个归档重做日志的两个副本，并跳过其他备份。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-4AA2DE00-B80B-47CE-8861-8733C120E8E2__GUID-36CFB441-ED8B-49C4-82CC-C7AA13EFC3D8">要备份需要备份的归档重做日志：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用），如<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接中</a>所述。</span></li>
                        <li class="stepexpand"><span>确保已装入或打开目标数据库。</span></li>
                        <li class="stepexpand"><span>确保为备份配置了适当的通道。</span></li>
                        <li class="stepexpand"><span>使用<code class="codeph">NOT BACKED UP</code>子句执行<code class="codeph">BACKUP ARCHIVELOG</code>命令。</span><div><pre class="pre codeblock"><code>BACKUP ARCHIVELOG全部没有备份2次;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-4AA2DE00-B80B-47CE-8861-8733C120E8E2__GUID-798A7CD8-F06B-4EA8-8B66-FA0D140B63D5">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="configuring-rman-client-basic.html#GUID-914A65A7-872E-465B-95E5-0FD5ADAF6A9C" title="运行RMAN CONFIGURE命令以启用和禁用备份优化。如果备份了相同的文件或相同版本的文件，则备份优化会在某些情况下跳过文件备份。">备份优化和CONFIGURE命令</a></p>
                              </li>
                              <li>
                                 <p><a href="configuring-rman-client-basic.html#GUID-FA142760-8ACB-43DA-939C-8407618D2D0F" title="您可以使用RMAN创建一个持久性配置，以管理归档重做日志何时有资格从磁盘中删除。">配置存档重做日志删除策略</a></p>
                              </li>
                              <li>
                                 <p><a href="backing-up-database-advanced.html#GUID-BC32C333-F0EB-4F17-AD79-8882E224D2F4" title="You run the CONFIGURE BACKUP OPTIMIZATION command to enable backup optimization. When certain criteria are met, RMAN skips backups of files that are identical to files that are already backed up.">使用备份优化来跳过</a>使用<code class="codeph">NOT BACKED UP</code>方案的<a href="backing-up-database-advanced.html#GUID-BC32C333-F0EB-4F17-AD79-8882E224D2F4" title="您运行CONFIGURE BACKUP OPTIMIZATION命令以启用备份优化。满足特定条件时，RMAN会跳过与已备份文件相同的文件备份。">文件</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV837"></a><a id="BRADV838"></a><a id="BRADV836"></a><div class="props_rev_3"><a id="GUID-82593941-EA75-4BB0-A001-3B086C6B72EA" name="GUID-82593941-EA75-4BB0-A001-3B086C6B72EA"></a><h4 id="BRADV-GUID-82593941-EA75-4BB0-A001-3B086C6B72EA" class="sect4"><span class="enumeration_section">9.7.5</span>在CDB中备份存档的重做日志</h4>
                  <div>
                     <p>您可以使用<code class="codeph">BACKUP ARCHIVELOG</code>命令<code class="codeph">BACKUP ARCHIVELOG</code>多租户容器数据库（CDB）中的归档重做日志。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-82593941-EA75-4BB0-A001-3B086C6B72EA__GUID-ACE0900F-F961-47C1-9B24-91208621AE8D">要备份CDB中的归档重做日志：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ol>
                           <li>
                              <p>启动RMAN并以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的用户身份连接到root，如将<a href="starting-interacting-with-rman-client.html#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D" title="有几种方法可以将目标连接到根目录。">目标连接到根目录中所述</a> 。
                              </p>
                           </li>
                           <li>
                              <p>确保已安装或打开目标CDB。</p>
                           </li>
                           <li>
                              <p>执行<code class="codeph">BACKUP ARCHIVELOG</code>或<code class="codeph">BACKUP ...PLUS ARCHIVELOG</code>命令。
                              </p>
                              <p>以下示例备份数据库和所有归档重做日志：</p><pre class="pre codeblock"><code>BACKUP DATABASE PLUS ARCHIVELOG;</code></pre><p>以下示例使用已配置的磁盘或SBT通道备份所有归档重做日志的每个日志序列号的一个副本：</p><pre class="pre codeblock"><code>备份ARCHIVELOG ALL;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-82593941-EA75-4BB0-A001-3B086C6B72EA__GUID-0A3BE9A7-3C95-4538-A083-530AF066FD8E">要仅备份需要在CDB中备份的归档重做日志：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ol>
                           <li>
                              <p>启动RMAN并以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的公共用户身份连接到root。
                              </p>
                           </li>
                           <li>
                              <p>确保已安装或打开目标CDB。</p>
                           </li>
                           <li>
                              <p>确保为备份配置了适当的通道。</p>
                           </li>
                           <li>
                              <p>配置RMAN以自动跳过归档重做日志的备份。使用以下技术之一：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>配置备份优化，以便在将相同的归档日志备份到指定的设备类型时， <code class="codeph">BACKUP ARCHIVELOG</code>命令会跳过备份文件。
                                    </p>
                                 </li>
                                 <li>
                                    <p>使用<code class="codeph">BACKED UP</code> <span class="italic">整数</span> <code class="codeph">TIMES</code>子句配置存档的重做日志保留策略。<code class="codeph">BACKUP ARCHIVELOG</code>命令将复制日志，除非指定的设备类型上存在<span class="italic">整数</span>备份。
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>使用<code class="codeph">NOT BACKED UP</code>子句执行<code class="codeph">BACKUP ARCHIVELOG</code>命令。
                              </p><pre class="pre codeblock"><code>BACKUP ARCHIVELOG全部没有备份2次;</code></pre></li>
                        </ol>
                        <div class="infoboxnotealso" id="GUID-82593941-EA75-4BB0-A001-3B086C6B72EA__GUID-4AB728C9-496D-45EB-A4FE-DC57172A635A">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="backing-up-database.html#GUID-2E06F006-55ED-46EA-A3CD-35DD34E067C9" title="在CDB中，只有当您以具有SYSDBA或SYSBACKUP权限的普通用户身份连接到根时，才能备份存档的重做日志。">关于在CDB中备份存档重做日志</a></p>
                              </li>
                              <li>
                                 <p><a href="backing-up-database.html#GUID-4AA2DE00-B80B-47CE-8861-8733C120E8E2" title="您可以指示RMAN应自动跳过归档重做日志的备份。">仅备份需要在非CDB中备份的存档重做日志</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV235"></a><a id="BRADV89524"></a><div class="props_rev_3"><a id="GUID-E99C2A06-868F-458A-88F1-B257EADD63CB" name="GUID-E99C2A06-868F-458A-88F1-B257EADD63CB"></a><h4 id="BRADV-GUID-E99C2A06-868F-458A-88F1-B257EADD63CB" class="sect4"><span class="enumeration_section">9.7.6</span>在非CDB中备份后删除存档的重做日志</h4>
                  <div>
                     <p><code class="codeph">BACKUP ARCHIVELOG</code> <code class="codeph">...DELETE INPUT</code>命令在备份后删除存档的日志文件。此命令消除了手动删除存档重做日志的单独步骤。
                     </p>
                     <div class="section">
                        <p>使用<code class="codeph">DELETE INPUT</code> ，RMAN仅删除为备份集选择的存档日志的特定副本。使用<code class="codeph">DELETE ALL INPUT</code> ，RMAN将从所有日志归档目标中删除每个备份的归档重做日志文件。
                        </p>
                        <p><code class="codeph">BACKUP ...DELETE INPUT</code>和<code class="codeph">DELETE ARCHIVELOG</code>命令遵循所有归档位置中日志的<a href="glossary.html#GUID-3492E0C3-F42C-45E6-84E2-63E30A3489A4"><span class="xrefglossterm">归档重做日志删除策略</span></a> 。例如，如果指定仅在备份至少两次磁带时删除日志，则<code class="codeph">BACKUP ...DELETE</code>尊重此政策。
                        </p>
                        <p>对于以下过程，假设您归档到<code class="codeph">/arc_dest1</code> ， <code class="codeph">/arc_dest2</code>和快速恢复区域。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-E99C2A06-868F-458A-88F1-B257EADD63CB__GUID-5C647184-B49F-42A7-90B5-950079C8140D">要在备份后删除归档重做日志，请执行以下操作：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用），如<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接中</a>所述。</span></li>
                        <li class="stepexpand"><span>确保已装入或打开目标数据库。</span></li>
                        <li class="stepexpand"><span>使用<code class="codeph">DELETE INPUT</code>子句运行<code class="codeph">BACKUP</code>命令。</span><div>
                              <p>假设您运行以下<code class="codeph">BACKUP</code>命令：</p><pre class="pre codeblock"><code>备份设备类型sbt ARCHIVELOG ALL DELETE ALL INPUT;</code></pre><p>在这种情况下，RMAN仅备份这些归档位置中每个日志序列号的一个副本。RMAN从快速恢复区域和其他归档目标中删除它备份的任何日志的所有副本。</p>
                              <p>如果指定<code class="codeph">DELETE</code> <code class="codeph">INPUT</code>而不是<code class="codeph">DELETE</code> <code class="codeph">ALL</code> <code class="codeph">INPUT</code> ，则RMAN仅删除它备份的特定归档重做日志文件。例如，如果这些文件用作备份源，RMAN将删除<code class="codeph">/arc_dest1</code>的日志，但保留<code class="codeph">/arc_dest2</code>的内容不变。
                              </p>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-E99C2A06-868F-458A-88F1-B257EADD63CB__GUID-6A785433-6EC0-407F-8699-161D1A64CCAF">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="configuring-rman-client-basic.html#GUID-FA142760-8ACB-43DA-939C-8407618D2D0F" title="您可以使用RMAN创建一个持久性配置，以管理归档重做日志何时有资格从磁盘中删除。">配置存档重做日志删除策略</a></p>
                              </li>
                              <li>
                                 <p><a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a> ，了解备用数据库的归档重做日志管理</p>
                              </li>
                              <li>
                                 <p><a href="../rcmrf/index.html" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a> ，了解<code class="codeph">CONFIGURE ARCHIVELOG DELETION POLICY</code>和<code class="codeph">DELETE ARCHIVELOG</code>命令</p>
                              </li>
                              <li>
                                 <p><a href="maintaining-rman-backups.html#GUID-8C4B395D-7C24-485F-BEA0-A355821FB93D" title="您可以使用RMAN DELETE命令删除存档的重做日志和RMAN备份。">删除RMAN备份和归档重做日志</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV840"></a><a id="BRADV839"></a><div class="props_rev_3"><a id="GUID-3ABF5B11-71BA-4161-8CC1-DE7C33EDE853" name="GUID-3ABF5B11-71BA-4161-8CC1-DE7C33EDE853"></a><h4 id="BRADV-GUID-3ABF5B11-71BA-4161-8CC1-DE7C33EDE853" class="sect4"><span class="enumeration_section">9.7.7</span>在CDB中备份后删除存档的重做日志</h4>
                  <div>
                     <p>在CDB中，您可以使用<code class="codeph">BACKUP ARCHIVELOG ...备份后删除存档的重做日志<code class="codeph">BACKUP ARCHIVELOG ...DELETE INPUT</code>命令。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-3ABF5B11-71BA-4161-8CC1-DE7C33EDE853__GUID-7C2D258E-AE8B-478B-A4BA-DE4F7CEA5B93">要在备份后删除CDB中的归档重做日志，请执行以下操作：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ol>
                           <li>
                              <p>启动RMAN并以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的用户身份连接到root，如<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接中</a>所述。</p>
                           </li>
                           <li>
                              <p>确保已装入或打开目标数据库。</p>
                           </li>
                           <li>
                              <p>使用<code class="codeph">DELETE INPUT</code>子句运行<code class="codeph">BACKUP</code>命令。
                              </p>
                           </li>
                        </ol>
                        <div class="infoboxnotealso" id="GUID-3ABF5B11-71BA-4161-8CC1-DE7C33EDE853__GUID-39B662DB-C307-45F8-8B80-98075947294B">
                           <p class="notep1">也可以看看：</p>
                           <p>有关<code class="codeph">BACKUP</code>命令的信息<a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><span><cite>，请参见Oracle数据库备份和恢复参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV8133"></a><div class="props_rev_3"><a id="GUID-2AF8EE74-CEB2-468D-A3B2-DD6AD8E41304" name="GUID-2AF8EE74-CEB2-468D-A3B2-DD6AD8E41304"></a><h3 id="BRADV-GUID-2AF8EE74-CEB2-468D-A3B2-DD6AD8E41304" class="sect3"><span class="enumeration_section">9.8创建</span>和更新RMAN增量备份</h3>
               <div>
                  <p>增量备份仅复制自指定的先前备份以来已更改的数据文件块。使用<code class="codeph">BACKUP</code>命令创建增量备份。
                  </p>
                  <p>增量备份是<a href="glossary.html#GUID-8BABFB51-EA47-4204-9A44-E1695A9F9FBF"><span class="xrefglossterm">累积增量备份</span></a>或<a href="glossary.html#GUID-353B6668-6BA5-4815-8F08-1CD5B446FBD6"><span class="xrefglossterm">差异增量备份</span></a> 。
                  </p>
                  <p>虽然备份的内容相同，但<code class="codeph">BACKUP DATABASE</code>和<code class="codeph">BACKUP INCREMENTAL LEVEL 0 DATABASE</code>是不同的。<a href="glossary.html#GUID-D47BE9B3-BAE1-4415-B4B4-4D577B6CB493"><span class="xrefglossterm">完整备份</span></a>不可用作增量策略的一部分，而<a href="glossary.html#GUID-DF84C185-E97D-4D3C-BF4E-41A9090C5F4C"><span class="xrefglossterm">0级增量备份</span></a>是增量策略的基础。没有RMAN命令可以将完整备份更改为0级增量备份。
                  </p>
                  <p>与完全备份一样，RMAN可以对打开的<code class="codeph">ARCHIVELOG</code>模式数据库进行增量备份。如果数据库处于<code class="codeph">NOARCHIVELOG</code>模式，则RMAN只能在一致关闭后才能进行增量备份。
                  </p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="backing-up-database.html#GUID-38B982A8-FBD5-487C-98E4-5A2300648BDE" title="RMAN增量备份提供多种好处。">RMAN增量备份的目的</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-309CCC44-79F6-4760-97BF-2CBC39EDAF3B" title="根据可接受的MTTR（平均恢复时间）选择备份策略。">规划增量备份策略</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-D918BE3A-31CD-4F4D-8728-2314F1CB504E" title="您可以将卷影复制服务（VSS）与Oracle VSS编写器一起使用，以在数据库中制作卷影副本或文件快照。">进行增量备份</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-AF130A6B-06D1-4D52-87AC-BB8F4B30C9F9" title="通过逐步更新备份，可以避免对数据文件进行完整映像副本备份的开销，同时还可以最大限度地减少介质恢复数据库所需的时间。例如，如果您运行每日备份脚本，那么您永远不会有超过1天的重做时间来申请媒体恢复。">逐步更新备份</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-4E1F605A-76A7-48D0-9D9B-7343B4327E2A" title="增量备份的块更改跟踪功能通过记录每个数据文件的更改块来提高备份性能。">使用块更改跟踪来提高增量备份性能</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89527"></a><div class="props_rev_3"><a id="GUID-38B982A8-FBD5-487C-98E4-5A2300648BDE" name="GUID-38B982A8-FBD5-487C-98E4-5A2300648BDE"></a><h4 id="BRADV-GUID-38B982A8-FBD5-487C-98E4-5A2300648BDE" class="sect4"><span class="enumeration_section">9.8.1</span> RMAN增量备份的目的</h4>
                  <div>
                     <p>RMAN增量备份提供多种好处。</p>
                     <p>将增量备份作为策略的一部分的主要原因是：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>如果启用了<a href="glossary.html#GUID-C80ACD57-9170-4FA5-A61F-81A05E77A1A4"><span class="xrefglossterm">块更改跟踪，</span></a>则每日备份速度更快（请参阅<span class="q">“ <a href="backing-up-database.html#GUID-4E1F605A-76A7-48D0-9D9B-7343B4327E2A" title="增量备份的块更改跟踪功能通过记录每个数据文件的更改块来提高备份性能。">使用块更改跟踪来提高增量备份性能</a> ”</span> ）</p>
                        </li>
                        <li>
                           <p>能够前滚数据文件映像副本，从而缩短恢复时间并避免重复的完整备份</p>
                        </li>
                        <li>
                           <p>通过网络备份时减少带宽消耗</p>
                        </li>
                        <li>
                           <p>当磁带写入I / O的聚合磁带带宽远小于磁盘读取I / O的聚合磁盘带宽时，性能得到改善</p>
                        </li>
                        <li>
                           <p>可以恢复使用<code class="codeph">NOLOGGING</code>选项创建的对象的更改</p>
                           <p>例如，直接装入插入不会创建重做日志条目，因此无法使用介质恢复重现其更改。但是，直接加载插入会更改数据块，并且这些块由增量备份捕获。</p>
                        </li>
                        <li>
                           <p>能够将物理备用数据库与主数据库同步</p>
                           <p>您可以使用RMAN <code class="codeph">BACKUP INCREMENTAL FROM SCN</code>命令在主数据库上创建备份，该备份从备用数据库的当前SCN开始，然后您可以使用该备份来转发备用数据库。请参阅<a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a>以了解如何将增量备份应用于备用数据库。
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-38B982A8-FBD5-487C-98E4-5A2300648BDE__GUID-F51FA7D7-450C-4A3E-A7BB-2A57964B7614">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<code class="codeph">NOLOGGING</code>模式的详细信息，请<code class="codeph">NOLOGGING</code> <a href="../admin/managing-tablespaces.html#ADMIN11374" target="_blank"><span><cite>“Oracle数据库管理员指南”</cite></span></a></p>
                     </div>
                  </div>
               </div><a id="BRADV89528"></a><div class="props_rev_3"><a id="GUID-309CCC44-79F6-4760-97BF-2CBC39EDAF3B" name="GUID-309CCC44-79F6-4760-97BF-2CBC39EDAF3B"></a><h4 id="BRADV-GUID-309CCC44-79F6-4760-97BF-2CBC39EDAF3B" class="sect4"><span class="enumeration_section">9.8.2</span>规划增量备份策略</h4>
                  <div>
                     <p>根据可接受的MTTR（平均恢复时间）选择备份策略。</p>
                     <p>例如，您可以实施三级备份方案，以便每月进行0级备份，每周采用累计级别1，每天采用差异级别1。在此策略中，您永远不必应用超过一天的重做来完成恢复。</p>
                     <p>在决定采用0级备份的频率时，一般规则是在20％或更多数据发生更改时采用新的0级备份。如果数据库的更改速率是可预测的，那么您可以观察增量备份的大小，以确定何时适合新的0级备份。以下SQL查询确定写入每个数据文件的增量级别1备份的块数，其中至少有20％的块备份：</p><pre class="pre codeblock"><code>SELECT FILE＃，INCREMENTAL_LEVEL，COMPLETION_TIME，BLOCKS，DATAFILE_BLOCKS FROM V $ BACKUP_DATAFILE WHERE INCREMENTAL_LEVEL&gt; 0 AND BLOCKS / DATAFILE_BLOCKS&gt; .2 ORDER BY COMPLETION_TIME;</code></pre><p>将1级备份中的块数与0级备份进行比较。例如，如果仅创建1级累积备份，则在最新的1级备份大约是0级备份大小的一半时，采用新的0级备份。</p>
                     <p>节省磁盘空间的有效方法是对磁盘进行增量备份，然后使用<code class="codeph">BACKUP</code> <code class="codeph">AS</code> <code class="codeph">BACKUPSET</code>命令将备份卸载到磁带。增量备份通常小于完整备份，这限制了存储它们所需的空间，直到它们被移动到磁带。当磁盘上的增量备份备份到磁带时，磁带更有可能流式传输，因为增量备份的所有块都复制到磁带。由于RMAN需要时间来定位数据文件中的更改块，因此不会出现延迟。
                     </p>
                     <p>另一种策略是使用增量更新的备份，如<span class="q">“ <a href="backing-up-database.html#GUID-AF130A6B-06D1-4D52-87AC-BB8F4B30C9F9" title="通过逐步更新备份，可以避免对数据文件进行完整映像副本备份的开销，同时还可以最大限度地减少介质恢复数据库所需的时间。例如，如果您运行每日备份脚本，那么您永远不会有超过1天的重做时间来申请媒体恢复。">增量更新备份</a> ”中所述</span> 。在此策略中，您将创建每个数据文件的映像副本，然后通过制作然后应用1级增量备份来定期前滚此副本。通过这种方式，您可以避免重复制作数据文件的完整映像副本，但享受所有优势。
                     </p>
                     <p>在Data Guard环境中，您可以将增量备份卸载到<a href="glossary.html#GUID-009B3F56-8C1E-4CF6-AF0F-A9D2C2E4B9C2"><span class="xrefglossterm">物理备用数据库</span></a> 。备用数据库和主数据库的增量备份是可互换的。因此，您可以将备用数据库的增量备份应用于主数据库，或将主数据库的增量备份应用于备用数据库。
                     </p>
                     <div class="infoboxnotealso" id="GUID-309CCC44-79F6-4760-97BF-2CBC39EDAF3B__GUID-FA4F3605-1AFE-4B31-8A04-20E4BD4676EB">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a> ，了解如何使用RMAN备份备用数据库。特别是，请参阅第10章“管理物理和快照备用数据库”</p>
                     </div>
                  </div>
               </div><a id="BRADV236"></a><a id="BRADV89529"></a><div class="props_rev_3"><a id="GUID-D918BE3A-31CD-4F4D-8728-2314F1CB504E" name="GUID-D918BE3A-31CD-4F4D-8728-2314F1CB504E"></a><h4 id="BRADV-GUID-D918BE3A-31CD-4F4D-8728-2314F1CB504E" class="sect4"><span class="enumeration_section">9.8.3进行</span>增量备份</h4>
                  <div>
                     <div class="section">
                        <p>启动RMAN后，在RMAN提示符下运行<code class="codeph">BACKUP</code> <code class="codeph">INCREMENTAL</code>命令。默认情况下，增量备份是差异的
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-D918BE3A-31CD-4F4D-8728-2314F1CB504E__GUID-6518512D-C4F9-454A-908A-86CEDFA6D23B">要进行增量备份：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span><div>
                              <div class="infoboxnotealso" id="GUID-D918BE3A-31CD-4F4D-8728-2314F1CB504E__GUID-7C100209-BD5A-424A-9E54-532DCB933A82">
                                 <p class="notep1">也可以看看：</p>
                                 <p><a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a></p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>确保已装入或打开目标数据库。</span></li>
                        <li class="stepexpand"><span>使用所需选项执行<code class="codeph">BACKUP INCREMENTAL</code>命令。</span><div>
                              <p>使用<code class="codeph">LEVEL</code>参数指示增量级别。以下示例进行0级增量数据库备份。
                              </p><pre class="pre codeblock"><code>BACKUP INCREMENTAL LEVEL 0 DATABASE;</code></pre><p>以下示例在<code class="codeph">SYSTEM</code>和<code class="codeph">tools</code>表空间的级别1处进行<a href="glossary.html#GUID-353B6668-6BA5-4815-8F08-1CD5B446FBD6"><span class="xrefglossterm">差异增量备份</span></a> 。它仅备份自最近的1级或0级备份以来更改的数据块。
                              </p><pre class="pre codeblock"><code>BACKUP INCREMENTAL LEVEL 1 TABLESPACE SYSTEM，工具;</code></pre><p>以下示例在表空间<code class="codeph">users</code>级别1进行<a href="glossary.html#GUID-8BABFB51-EA47-4204-9A44-E1695A9F9FBF"><span class="xrefglossterm">累积增量备份</span></a> ，备份自最近的0级备份以来更改的所有块。
                              </p><pre class="pre codeblock"><code>BACKUP INCREMENTAL LEVEL 1 Cumulrative TABLESPACE用户;</code></pre></div>
                        </li>
                     </ol>
                  </div><a id="BRADV89530"></a><div class="props_rev_3"><a id="GUID-1B709C63-3857-40C6-BB3B-C2F73ED7CBA8" name="GUID-1B709C63-3857-40C6-BB3B-C2F73ED7CBA8"></a><h5 id="BRADV-GUID-1B709C63-3857-40C6-BB3B-C2F73ED7CBA8" class="sect5"><span class="enumeration_section">9.8.3.1</span>进行VSS快照的增量备份</h5>
                     <div>
                        <p>您可以将卷影复制服务（VSS）与Oracle VSS编写器一起使用，以在数据库中制作卷影副本或文件快照。</p>
                        <div class="section">
                           <p>必须使用RMAN以外的第三方备份程序才能使用Oracle VSS编写器生成VSS快照。在这种情况下， <a href="glossary.html#GUID-6E3CDD76-A573-4E5C-B12D-59C232C96C19"><span class="xrefglossterm">快速恢复区域会</span></a>自动管理在VSS快照中备份的文件，并根据需要删除它们。
                           </p>
                           <p>你可以使用<code class="codeph">BACKUP INCREMENTAL LEVEL 1 ...RMAN中的FROM SCN</code>命令在快速恢复区域中创建增量备份。因此，您可以使用此命令创建VSS卷影副本的增量级别1备份。RMAN可以在恢复期间透明地应用增量备份。
                           </p>
                           <div class="infoboxnotealso" id="GUID-1B709C63-3857-40C6-BB3B-C2F73ED7CBA8__GUID-099B7F37-540A-4862-B0B6-A83C03343E9F">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=NTQRF280" target="_blank"><span><cite>适用于Microsoft Windows的Oracle数据库管理员参考，</cite></span></a>了解如何使用RMAN进行VSS备份</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="BRADV237"></a><a id="BRADV8186"></a><div class="props_rev_3"><a id="GUID-AF130A6B-06D1-4D52-87AC-BB8F4B30C9F9" name="GUID-AF130A6B-06D1-4D52-87AC-BB8F4B30C9F9"></a><h4 id="BRADV-GUID-AF130A6B-06D1-4D52-87AC-BB8F4B30C9F9" class="sect4"><span class="enumeration_section">9.8.4</span>增量备份更新</h4>
                  <div>
                     <p>通过逐步更新备份，可以避免对数据文件进行完整映像副本备份的开销，同时还可以最大限度地减少介质恢复数据库所需的时间。例如，如果您运行每日备份脚本，那么您永远不会有超过1天的重做时间来申请媒体恢复。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-AF130A6B-06D1-4D52-87AC-BB8F4B30C9F9__GUID-F40C0B17-F1C5-4EB9-A0C0-EB0A6500F332">要逐步更新数据文件备份：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li><span>使用指定的标记创建数据文件的完整映像副本备份。</span></li>
                        <li><span>定期（例如每天），对数据文件进行1级差异增量备份，并使用与基础数据文件副本相同的标记。</span></li>
                        <li><span>将增量备份应用于具有相同标记的最新备份。</span></li>
                     </ol>
                     <div class="section">
                        <p>此技术将备份前滚到进行1级增量备份的时间。RMAN可以<a href="glossary.html#GUID-F879F805-CAD5-4798-B9C1-A9C877D4FBC8"><span class="xrefglossterm">永久</span></a>恢复此<a href="glossary.html#GUID-F879F805-CAD5-4798-B9C1-A9C877D4FBC8"><span class="xrefglossterm">增量</span></a>并应用重做日志中的更改。结果等于恢复在最近应用的增量级别1备份的SCN处获取的数据文件备份。
                        </p>
                        <div class="infoboxnote" id="GUID-AF130A6B-06D1-4D52-87AC-BB8F4B30C9F9__GUID-30C611AD-B2A7-486C-9D7A-81910735C64E">
                           <p class="notep1">注意：</p>
                           <p>如果您每天运行<code class="codeph">RECOVER COPY</code> <span class="italic">而未</span>指定<code class="codeph">UNTIL TIME</code> ，则持续更新的图像副本不能满足超过一天的<a href="glossary.html#GUID-1C595EF7-B8A1-4AA3-8C45-44E9FC8BAB9E"><span class="xrefglossterm">恢复窗口</span></a> 。增量更新的备份功能是快速介质恢复的优化。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div><a id="BRADV239"></a><a id="BRADV238"></a><a id="BRADV89531"></a><div class="props_rev_3"><a id="GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A" name="GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A"></a><h5 id="BRADV-GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A" class="sect5"><span class="enumeration_section">9.8.4.1</span>递增更新备份：基本示例</h5>
                     <div>
                        <p>要创建增量备份以用于增量更新的备份策略，请使用<code class="codeph">BACKUP ...</code> <code class="codeph">FOR</code> <code class="codeph">RECOVER</code> <code class="codeph">OF</code> <code class="codeph">COPY</code> <code class="codeph">WITH</code> <code class="codeph">TAG</code>的形式<code class="codeph">BACKUP</code>命令。在实现策略的示例脚本中最好地理解该命令。
                        </p>
                        <p><a href="backing-up-database.html#GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A__CHDCHGAE">实例9-15中</a>的脚本定期运行，这是实现基于增量更新备份的策略所需的全部内容。
                        </p>
                        <div class="example" id="GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A__CHDCHGAE">
                           <p class="titleinexample">示例9-15基本增量更新脚本</p><pre class="pre codeblock"><code>运行{恢复数据库与标记'incr_update';用TAG'incr_update'数据库恢复补充级别1以恢复复制; }</code></pre></div>
                        <!-- class="example" -->
                        <div class="section">
                           <p>要了解脚本和策略，必须在不存在数据文件副本或增量备份时了解这两个命令的效果。注意两个重要特征：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="backing-up-database.html#GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A__CHDCHGAE">例9-15</a>中的<code class="codeph">BACKUP</code>命令并不总是创建1级增量备份。
                                 </p>
                              </li>
                              <li>
                                 <p><a href="backing-up-database.html#GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A__CHDCHGAE">例9-15中</a>的<a href="../rcmrf/RECOVER.html#RCMRF140" target="_blank"><code class="codeph">RECOVER</code></a>命令使RMAN将具有指定标记的任何可用增量级别1备份应用于具有相同标记的一组数据文件副本。
                                 </p>
                              </li>
                           </ul>
                           <p><a href="backing-up-database.html#GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A__BGBGCEBG" title="此表显示每天运行基本脚本时的示例增量更新策略。">表9-2</a>显示了脚本从星期一开始每天运行一次时的效果。
                           </p>
                           <div class="tblformalwide" id="GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A__BGBGCEBG">
                              <p class="titleintable">表9-2每日运行时基本脚本的效果</p>
                              <table cellpadding="4" cellspacing="0" class="FormalWide" title="每日运行时基本脚本的影响" width="100%" border="1" summary="This table shows an example incremental update strategy when the basic script is run daily. " frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="11%" id="d40792e9563">命令</th>
                                       <th align="left" valign="bottom" width="22%" id="d40792e9566">星期一</th>
                                       <th align="left" valign="bottom" width="22%" id="d40792e9569">星期二</th>
                                       <th align="left" valign="bottom" width="22%" id="d40792e9572">星期三</th>
                                       <th align="left" valign="bottom" width="22%" id="d40792e9575">周四开始</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="11%" id="d40792e9580" headers="d40792e9563 ">
                                          <p><code class="codeph">恢复</code></p>
                                       </td>
                                       <td align="left" valign="top" width="22%" headers="d40792e9580 d40792e9566 ">
                                          <p>由于不存在增量备份或数据文件副本，因此该命令会生成消息（但不会生成错误）。也就是说，该命令无效。</p>
                                       </td>
                                       <td align="left" valign="top" width="22%" headers="d40792e9580 d40792e9569 ">
                                          <p>现在存在数据库副本，但不存在用于恢复它的增量级别1备份。因此， <code class="codeph">RECOVER</code>命令无效。
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="22%" headers="d40792e9580 d40792e9572 ">
                                          <p>在星期二进行的1级增量备份将应用于数据库副本，从而将副本提升到1级增量备份的检查点SCN。</p>
                                       </td>
                                       <td align="left" valign="top" width="22%" headers="d40792e9580 d40792e9575 ">
                                          <p>昨天进行的1级增量备份将应用于数据库副本，从而将副本提升到1级增量备份的检查点SCN。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="11%" id="d40792e9600" headers="d40792e9563 ">
                                          <p><code class="codeph">BACKUP</code></p>
                                       </td>
                                       <td align="left" valign="top" width="22%" headers="d40792e9600 d40792e9566 ">
                                          <p>不存在0级映像副本，因此该命令会创建数据库的映像副本并应用标记<code class="codeph">incr_update</code> 。需要此副本才能开始增量更新循环。
                                          </p>
                                          <p><span class="bold">注意：</span>如果脚本设置了<code class="codeph">DEVICE</code> <code class="codeph">TYPE</code> <code class="codeph">sbt</code> ，则第一次运行会在磁盘上创建副本，而不是在磁带上创建。后续运行在磁带上进行1级备份。
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="22%" headers="d40792e9600 d40792e9569 ">
                                          <p>该命令进行增量级别1备份，并为其分配标记<code class="codeph">incr_update</code> 。此备份包含在星期一和星期二之间更改的块。
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="22%" headers="d40792e9600 d40792e9572 ">
                                          <p>该命令进行增量级别1备份，并为其分配标记<code class="codeph">incr_update</code> 。此备份包含在星期二和星期三之间更改的块。
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="22%" headers="d40792e9600 d40792e9575 ">
                                          <p>该命令进行增量级别1备份，并为其分配标记<code class="codeph">incr_update</code> 。此备份包含使用标记<code class="codeph">incr_update</code>在现在和最近备份之间更改的块。
                                          </p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p>请注意有关<a href="backing-up-database.html#GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A__CHDCHGAE">示例9-15</a>的以下其他详细信息：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>每次将数据文件添加到数据库时，下次运行脚本时都会创建新数据文件的映像副本。下一次运行使添加的数据文件的第一级增量为1。在所有后续运行中，新数据文件的处理方式与任何其他数据文件一样。</p>
                              </li>
                              <li>
                                 <p>您必须使用标记来标识此策略中的数据文件副本和增量备份，以便它们不会干扰其他备份策略。如果使用多个增量备份策略，则RMAN无法明确创建增量级别1备份，除非您标记级别0备份。</p>
                                 <p>根据映像副本数据文件的标记和可用的增量级别1备份，选择要应用于这些映像副本的增量级别1备份。标签对于选择增量级备份至关重要。</p>
                              </li>
                              <li>
                                 <p>在第三次运行脚本之后，以下文件可用于时间点恢复：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>24小时前，数据库的映像副本，从前一次运行脚本的检查点SCN开始</p>
                                    </li>
                                    <li>
                                       <p>前一次运行的检查点SCN之后的更改的增量备份</p>
                                    </li>
                                    <li>
                                       <p>存档的重做日志，包括图像副本的检查点SCN与当前时间之间的所有更改</p>
                                    </li>
                                 </ul>
                                 <p>如果必须在接下来的24小时内还原和恢复数据库，则可以从增量更新的数据文件副本中还原数据文件。然后，您可以应用最新增量级别1和重做日志中的更改以到达所需的SCN。最多需要24小时的重做才能应用，这限制了完成时间点恢复所需的时间。</p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV243"></a><a id="BRADV240"></a><a id="BRADV89532"></a><div class="props_rev_3"><a id="GUID-025D990B-4EB0-48FA-A181-13787069E573" name="GUID-025D990B-4EB0-48FA-A181-13787069E573"></a><h5 id="BRADV-GUID-025D990B-4EB0-48FA-A181-13787069E573" class="sect5"><span class="enumeration_section">9.8.4.2</span>增量更新备份：高级示例</h5>
                     <div>
                        <p>您可以扩展<a href="backing-up-database.html#GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A__CHDCHGAE">示例9-15中</a>的基本脚本，以便为超过24小时的窗口提供快速恢复。<a href="backing-up-database.html#GUID-025D990B-4EB0-48FA-A181-13787069E573__CHDCDFDF">例9-16</a>显示了如何通过在<code class="codeph">RECOVER</code>命令中指定可恢复性窗口的开始时间来维护7天的窗口。
                        </p>
                        <div class="example" id="GUID-025D990B-4EB0-48FA-A181-13787069E573__CHDCDFDF">
                           <p class="titleinexample">示例9-16高级增量更新脚本</p><pre class="pre codeblock"><code>运行{TRATVER COPY OF DATABASE with TAG'incr_update'ENTIL TIME'SYSDATE  -  7';用TAG'incr_update'数据库恢复补充级别1以恢复复制; }</code></pre></div>
                        <!-- class="example" -->
                        <div class="section">
                           <p><a href="backing-up-database.html#GUID-025D990B-4EB0-48FA-A181-13787069E573__BGBHAIFA" title="此表显示运行高级脚本时的示例增量更新策略。">表9-3</a>显示了脚本从1月1日星期一开始每天运行一次时的效果。
                           </p>
                           <div class="tblformalwide" id="GUID-025D990B-4EB0-48FA-A181-13787069E573__BGBHAIFA">
                              <p class="titleintable">表9-3每日运行时高级脚本的效果</p>
                              <table cellpadding="4" cellspacing="0" class="FormalWide" title="每日运行时高级脚本的影响" width="100%" border="1" summary="This table shows an example incremental update strategy when an advanced script is run. " frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="11%" id="d40792e9779">命令</th>
                                       <th align="left" valign="bottom" width="22%" id="d40792e9782">星期一1/1</th>
                                       <th align="left" valign="bottom" width="22%" id="d40792e9785">周二1/2  - 周一1/8</th>
                                       <th align="left" valign="bottom" width="22%" id="d40792e9788">星期二1/9</th>
                                       <th align="left" valign="bottom" width="22%" id="d40792e9791">周三1/10开始</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="11%" id="d40792e9796" headers="d40792e9779 ">
                                          <p><code class="codeph">恢复</code></p>
                                       </td>
                                       <td align="left" valign="top" width="22%" headers="d40792e9796 d40792e9782 ">
                                          <p>由于不存在增量备份或数据文件副本，因此该命令会生成消息（但不会生成错误）。也就是说，该命令无效。</p>
                                       </td>
                                       <td align="left" valign="top" width="22%" headers="d40792e9796 d40792e9785 ">
                                          <p>存在数据库副本，但<code class="codeph">SYSDATE-7</code>指定创建基本副本<span class="italic">之前</span>的时间。例如，星期三<code class="codeph">SYSDATE-7</code>指定星期一1/1 <span class="italic">之前</span>的星期三。因此， <code class="codeph">RECOVER</code>命令无效。
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="22%" headers="d40792e9796 d40792e9788 ">
                                          <p><code class="codeph">SYSDATE-7</code>现在指定创建基本副本<span class="italic">后</span>的日期。在星期一1/1进行的数据库复制使用在星期二1/2进行的增量备份进行更新，将副本带到1级增量备份的检查点SCN。
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="22%" headers="d40792e9796 d40792e9791 ">
                                          <p>使用7天前进行的增量备份更新数据库副本，将副本提升到1级增量备份的检查点SCN。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="11%" id="d40792e9833" headers="d40792e9779 ">
                                          <p><code class="codeph">BACKUP</code></p>
                                       </td>
                                       <td align="left" valign="top" width="22%" headers="d40792e9833 d40792e9782 ">
                                          <p>不存在0级映像副本，因此该命令会创建数据库的映像副本并应用标记<code class="codeph">incr_update</code> 。需要此副本才能开始增量更新循环。
                                          </p>
                                          <p><span class="bold">注意：</span>如果脚本设置了<code class="codeph">DEVICE</code> <code class="codeph">TYPE</code> <code class="codeph">sbt</code> ，则第一次运行会在磁盘上创建副本，而不是在磁带上创建。后续运行在磁带上进行1级备份。
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="22%" headers="d40792e9833 d40792e9785 ">
                                          <p>该命令进行增量级别1备份，并为其分配标记<code class="codeph">incr_update</code> 。此备份包含在昨天和今天之间更改的块。
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="22%" headers="d40792e9833 d40792e9788 ">
                                          <p>该命令进行增量级别1备份，并为其分配标记<code class="codeph">incr_update</code> 。此备份包含在星期一1/8和星期二1/9之间更改的块。
                                          </p>
                                       </td>
                                       <td align="left" valign="top" width="22%" headers="d40792e9833 d40792e9791 ">
                                          <p>该命令进行增量级别1备份，并为其分配标记<code class="codeph">incr_update</code> 。此备份包含在昨天和今天之间更改的块。
                                          </p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p>与<a href="backing-up-database.html#GUID-5225B54C-7720-473E-9B8B-68A66B4ADA0A__CHDCHGAE">示例9-15中</a>的基本脚本一样，您可以快速恢复数据文件副本的SCN与当前之间的任何时间点。RMAN可以使用增量备份中的块更改和重做日志中的各个更改。因为您具有每日1级增量备份，所以您永远不需要应用超过1天的重做。
                           </p>
                           <div class="infoboxnotealso" id="GUID-025D990B-4EB0-48FA-A181-13787069E573__GUID-B91B28B3-63E7-4866-9548-B772F468BC17">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="../rcmrf/RECOVER.html#RCMRF140" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a>了解<code class="codeph">RECOVER</code>命令</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="BRADV8125"></a><div class="props_rev_3"><a id="GUID-4E1F605A-76A7-48D0-9D9B-7343B4327E2A" name="GUID-4E1F605A-76A7-48D0-9D9B-7343B4327E2A"></a><h4 id="BRADV-GUID-4E1F605A-76A7-48D0-9D9B-7343B4327E2A" class="sect4"><span class="enumeration_section">9.8.5</span>使用块更改跟踪来提高增量备份性能</h4>
                  <div>
                     <p>增量备份的块更改跟踪功能通过记录每个数据文件的更改块来提高备份性能。</p>
                     <p>本节包含以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="backing-up-database.html#GUID-22A5856C-970A-4DA0-AEB8-41C8F180280B" title="如果在主数据库或备用数据库上启用了块更改跟踪，则RMAN使用块更改跟踪文件来标识已更改的块以进行增量备份。通过读取这个小位图文件来确定哪些块发生了变化，RMAN避免了必须扫描它备份的数据文件中的每个块。">关于区块变更跟踪</a></p>
                        </li>
                        <li>
                           <p><a href="backing-up-database.html#GUID-5753BEEF-5F87-442E-9BC9-A69E21769C14" title="您可以在打开或装入数据库时启用块更改跟踪。">启用和禁用块更改跟踪</a></p>
                        </li>
                        <li>
                           <p><a href="backing-up-database.html#GUID-83495ADC-6DC8-414A-8E27-D2CC7F208E71" title="禁用块更改跟踪时，数据库将从操作系统中删除块更改跟踪文件。">禁用块更改跟踪</a></p>
                        </li>
                        <li>
                           <p><a href="backing-up-database.html#GUID-7E510FA0-952E-4799-8928-3DAC1E3E9EFE" title="您可以查询V $ BLOCK_CHANGE_TRACKING视图以确定是否启用了更改跟踪，如果是，则确定块更改跟踪文件的文件名。">检查是否启用了更改跟踪</a></p>
                        </li>
                        <li>
                           <p><a href="backing-up-database.html#GUID-268DD5BF-27DE-4536-8F93-D57431CE4397" title="要移动更改跟踪文件，请使用ALTER DATABASE RENAME FILE语句。">更改块更改跟踪文件的位置</a></p>
                        </li>
                     </ul>
                  </div><a id="BRADV89533"></a><div class="props_rev_3"><a id="GUID-22A5856C-970A-4DA0-AEB8-41C8F180280B" name="GUID-22A5856C-970A-4DA0-AEB8-41C8F180280B"></a><h5 id="BRADV-GUID-22A5856C-970A-4DA0-AEB8-41C8F180280B" class="sect5"><span class="enumeration_section">9.8.5.1</span>关于块更改跟踪</h5>
                     <div>
                        <p>如果在主数据库或备用数据库上启用了块更改跟踪，则RMAN使用块更改跟踪文件来标识已更改的块以进行增量备份。通过读取这个小位图文件来确定哪些块发生了变化，RMAN避免了必须扫描它备份的数据文件中的每个块。</p>
                        <p>默认情况下禁用块更改跟踪。尽管如此，在备份期间避免完整数据文件扫描的好处是相当大的，特别是如果备份之间只更改了一小部分数据块。如果备份策略涉及增量备份，则建议进行块更改跟踪。块更改跟踪不会更改用于执行增量备份的命令。初始配置后， <a href="glossary.html#GUID-67A48E71-6A0D-4590-A2BC-C9DE6DAEA3A5"><span class="xrefglossterm">块更改跟踪文件</span></a>无需维护。
                        </p>
                        <p>如果启用了Oracle Active Data Guard选项的许可证，则只能在物理备用数据库上启用块更改跟踪。</p>
                     </div><a id="BRADV100"></a><div class="props_rev_3"><a id="GUID-F4254E7F-1BB6-4BE7-A605-8E28E93703A5" name="GUID-F4254E7F-1BB6-4BE7-A605-8E28E93703A5"></a><h6 id="BRADV-GUID-F4254E7F-1BB6-4BE7-A605-8E28E93703A5" class="sect6"><span class="enumeration_section">9.8.5.1.1</span>关于块更改跟踪文件中的空间管理</h6>
                        <div>
                           <p>Oracle数据库自动管理更改跟踪文件中的空间，以保留涵盖最近八个备份的块更改数据。达到最多八个位图后，最旧的位图将被跟踪当前更改的位图覆盖。</p>
                           <p>块更改跟踪文件维护位图，以标记备份之间数据文件的更改。数据库在每次备份之前执行位图切换。</p>
                           <p>第一级0增量备份扫描整个数据文件。后续增量备份使用块更改跟踪文件仅扫描自上次备份以来已标记为已更改的块。仅当增量备份基于块更改跟踪文件中最旧位图开始之后创建的父备份时，才能优化增量备份。</p>
                           <p>在开发增量备份策略时，请考虑八位图限制。例如，如果您进行0级数据库备份，然后进行7次差异增量备份，则块更改跟踪文件现在包含8个位图。如果随后进行累积级别1增量备份，则RMAN无法优化备份，因为与父级别0备份对应的位图将被跟踪当前更改的位图覆盖。</p>
                        </div>
                     </div><a id="BRADV89534"></a><div class="props_rev_3"><a id="GUID-68349131-773B-4920-9D04-2FCF9C280257" name="GUID-68349131-773B-4920-9D04-2FCF9C280257"></a><h6 id="BRADV-GUID-68349131-773B-4920-9D04-2FCF9C280257" class="sect6"><span class="enumeration_section">9.8.5.1.2</span>块更改跟踪文件的位置</h6>
                        <div>
                           <p>默认情况下，块更改跟踪文件在<code class="codeph">DB_CREATE_FILE_DEST</code>初始化参数指定的目标中创建为Oracle托管文件。您还可以通过在启用块更改跟踪时指定其名称，将块更改跟踪文件放在您选择的任何位置。
                           </p>
                           <p>为整个数据库创建一个块更改跟踪文件。Oracle建议不要使用原始设备（即没有文件系统的磁盘）作为更改跟踪文件。</p>
                           <div class="infoboxnote" id="GUID-68349131-773B-4920-9D04-2FCF9C280257__GUID-C58DD63D-7316-4FB7-9304-B830BAD9CF91">
                              <p class="notep1">注意：</p>
                              <p>在Oracle Real Application Clusters（Oracle RAC）环境中，更改跟踪文件必须位于可从群集中的所有节点访问的共享存储上。</p>
                           </div>
                           <p>RMAN不支持备份和恢复更改跟踪文件。数据库在确定更改跟踪文件无效时重置更改跟踪文件。如果还原并恢复整个数据库或子集，则数据库将重置块更改跟踪文件并再次开始跟踪更改。进行0级增量备份后，下一个增量备份可以使用更改跟踪数据。</p>
                        </div>
                     </div><a id="BRADV89535"></a><div class="props_rev_3"><a id="GUID-FA0A845D-C071-404F-B7CB-3876C5981B0F" name="GUID-FA0A845D-C071-404F-B7CB-3876C5981B0F"></a><h6 id="BRADV-GUID-FA0A845D-C071-404F-B7CB-3876C5981B0F" class="sect6"><span class="enumeration_section">9.8.5.1.3</span>关于块更改跟踪文件的大小</h6>
                        <div>
                           <p>块更改跟踪文件的大小与数据库的大小和重做的已启用线程数成比例。</p>
                           <p>随着数据库的更改，块更改跟踪文件的大小可以增加或减少。大小与数据库更新的频率无关。通常，单个实例的块更改跟踪所需的空间大约是要跟踪的数据块大小的1 / 30,000。对于Oracle RAC环境，它是数据库大小的1 / 30,000，是启用线程数的倍。</p>
                           <p>以下可能导致文件大于此估计值的因素表明：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>为了避免在数据库增长时分配空间的开销，块更改跟踪文件大小从10兆字节开始。新空间以10 MB为增量分配。因此，对于任何高达大约300千兆字节的数据库，文件大小不小于10 MB，对于大约600千兆字节，文件大小不小于20兆字节，依此类推。</p>
                              </li>
                              <li>
                                 <p>对于每个数据文件，无论数据文件的大小如何，块更改跟踪文件中至少分配320千字节的空间。因此，如果您有大量相对较小的数据文件，则更改跟踪文件大于包含相同数据的较大数据的较大数据文件的数据库。</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="BRADV247"></a><a id="BRADV89536"></a><div class="props_rev_3"><a id="GUID-5753BEEF-5F87-442E-9BC9-A69E21769C14" name="GUID-5753BEEF-5F87-442E-9BC9-A69E21769C14"></a><h5 id="BRADV-GUID-5753BEEF-5F87-442E-9BC9-A69E21769C14" class="sect5"><span class="enumeration_section">9.8.5.2</span>启用和禁用块更改跟踪</h5>
                     <div>
                        <p>您可以在打开或装入数据库时启用块更改跟踪。</p>
                        <div class="section">
                           <p>本节假定您打算将块更改跟踪文件创建为<a href="glossary.html#GUID-B2954743-3455-4045-9200-891927E38048"><span class="xrefglossterm">数据库区域中</span></a>的<a href="glossary.html#GUID-37F461C5-AAE0-4F82-92E4-7FB822874640"><span class="xrefglossterm">Oracle托管文件</span></a> ，这是数据库维护活动数据库文件（如数据文件，控制文件和联机重做日志文件）的位置。请参阅<span class="q">“ <a href="configuring-rman-client-basic.html#GUID-061CCF1D-2C8D-4460-B469-9C32893A590A" title="快速恢复区域可以包含控制文件，联机重做日志，归档重做日志，闪回日志和RMAN备份。">快速恢复区中的文件概述</a> ”</span>以了解数据库区域和<a href="glossary.html#GUID-6E3CDD76-A573-4E5C-B12D-59C232C96C19"><span class="xrefglossterm">快速恢复区域</span></a> 。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-5753BEEF-5F87-442E-9BC9-A69E21769C14__GUID-EDF30EE9-6F1C-4F25-A186-8AA266CC5654">要启用块更改跟踪：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>启动SQL * Plus并使用管理员权限连接到目标数据库。</span></li>
                           <li class="stepexpand"><span>确保已设置<code class="codeph">DB_CREATE_FILE_DEST</code>初始化参数。</span><div><pre class="pre codeblock"><code>SHOW PARAMETER DB_CREATE_FILE_DEST</code></pre><p>如果未设置参数，并且数据库已打开，则可以使用以下形式的<a href="../sqlrf/ALTER-SYSTEM.html#SQLRF00902" target="_blank"><code class="codeph">ALTER SYSTEM</code></a>语句设置参数：</p><pre class="pre codeblock"><code>ALTER SYSTEM SET DB_CREATE_FILE_DEST ='/ disk1 / bct /'SCOPE = BOTH SID ='*';</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>启用块更改跟踪。</span><div>
                                 <p>执行以下<code class="codeph">ALTER DATABASE</code>语句：</p><pre class="pre codeblock"><code>ALTER DATABASE ENABLE BLOCK CHANGE TRACKING;</code></pre><p>您还可以使用以下形式的SQL语句在自己选择的位置创建更改跟踪文件：</p><pre class="pre codeblock"><code>ALTER DATABASE使用FILE'/mydir/rman_change_track.f'重新启动块更改跟踪;</code></pre><p><code class="codeph">REUSE</code>选项告知Oracle数据库使用指定的名称覆盖任何现有的块更改跟踪文件。
                                 </p>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="BRADV248"></a><a id="BRADV89537"></a><div class="props_rev_3"><a id="GUID-83495ADC-6DC8-414A-8E27-D2CC7F208E71" name="GUID-83495ADC-6DC8-414A-8E27-D2CC7F208E71"></a><h5 id="BRADV-GUID-83495ADC-6DC8-414A-8E27-D2CC7F208E71" class="sect5"><span class="enumeration_section">9.8.5.3</span>禁用块更改跟踪</h5>
                     <div>
                        <p>禁用块更改跟踪时，数据库将从操作系统中删除块更改跟踪文件。</p>
                        <div class="section">
                           <p>本节假定当前启用了块更改跟踪功能。</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-83495ADC-6DC8-414A-8E27-D2CC7F208E71__GUID-37D81D1B-DEC7-42F2-A1CD-0F93CAACA6B9">要禁用块更改跟踪：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>启动SQL * Plus并使用管理员权限连接到目标数据库。</span></li>
                           <li class="stepexpand"><span>确保已装入或打开目标数据库。</span></li>
                           <li class="stepexpand"><span>禁用块更改跟踪。</span><div>
                                 <p>执行以下<code class="codeph">ALTER DATABASE</code>语句：</p><pre class="pre codeblock"><code>ALTER DATABASE DISABLE BLOCK CHANGE TRACKING;</code></pre></div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="BRADV249"></a><a id="BRADV89538"></a><div class="props_rev_3"><a id="GUID-7E510FA0-952E-4799-8928-3DAC1E3E9EFE" name="GUID-7E510FA0-952E-4799-8928-3DAC1E3E9EFE"></a><h5 id="BRADV-GUID-7E510FA0-952E-4799-8928-3DAC1E3E9EFE" class="sect5"><span class="enumeration_section">9.8.5.4</span>检查是否启用了更改跟踪</h5>
                     <div>
                        <p>您可以查询<code class="codeph">V$BLOCK_CHANGE_TRACKING</code>视图以确定是否启用了更改跟踪，如果是，则确定块更改跟踪文件的文件名。
                        </p>
                        <div class="section">
                           <p class="subhead3" id="GUID-7E510FA0-952E-4799-8928-3DAC1E3E9EFE__GUID-A7F37229-90D9-4C04-88B1-96A0CE36095B">要确定是否启用了更改跟踪：</p>
                           <p>在SQL * Plus中输入以下查询（包括示例输出）：</p><pre class="pre codeblock"><code>COL STATUS FORMAT A8 COL FILENAME FORMAT A60 SELECT STATUS，FILENAME from V $ BLOCK_CHANGE_TRACKING; STATUS FILENAME -------- ---------------------------------------- -------------------- ENABLED /disk1/bct/RDBMS/changetracking/o1_mf_2f71np5j_.chg</code></pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV250"></a><a id="BRADV89539"></a><div class="props_rev_3"><a id="GUID-268DD5BF-27DE-4536-8F93-D57431CE4397" name="GUID-268DD5BF-27DE-4536-8F93-D57431CE4397"></a><h5 id="BRADV-GUID-268DD5BF-27DE-4536-8F93-D57431CE4397" class="sect5"><span class="enumeration_section">9.8.5.5</span>更改块更改跟踪文件的位置</h5>
                     <div>
                        <p>要移动更改跟踪文件，请使用<code class="codeph">ALTER DATABASE RENAME FILE</code>语句。
                        </p>
                        <div class="section">
                           <p>必须安装数据库。该语句更新控制文件以引用新位置并保留更改跟踪文件的内容。如果无法关闭数据库，则可以禁用并启用块更改跟踪。在这种情况下，您将丢失现有块更改跟踪文件的内容。</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-268DD5BF-27DE-4536-8F93-D57431CE4397__GUID-2CC2F988-3C7D-40AF-BFFE-CEE712134ECF">要更改更改跟踪文件的位置：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>启动SQL * Plus并连接到目标数据库。</span></li>
                           <li class="stepexpand"><span>如有必要，请确定更改跟踪文件的当前名称：</span><div><pre class="pre codeblock"><code>SQL&gt; SELECT FILENAME FROM V $ BLOCK_CHANGE_TRACKING;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>如果可能，请关闭数据库。例如：</span><div><pre class="pre codeblock"><code>SQL&gt; SHUTDOWN IMMEDIATE</code></pre><p>如果关闭数据库，则跳到下一步。如果选择不关闭数据库，则执行以下SQL语句并跳过所有剩余步骤：</p><pre class="pre codeblock"><code>SQL&gt; ALTER DATABASE DISABLE BLOCK CHANGE TRACKING; SQL&gt; ALTER DATABASE使用<span class="italic">FILE'new_location</span> '启用块更改跟踪;</code></pre><p>在这种情况下，您将丢失块更改跟踪文件的内容。</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>使用主机操作系统命令，将块更改跟踪文件移动到其新位置。</span></li>
                           <li class="stepexpand"><span>装入数据库并将更改跟踪文件移动到具有更多空间的位置。例如：</span><div><pre class="pre codeblock"><code>ALTER DATABASE RENAME FILE'/disk1/bct/RDBMS/changetracking/o1_mf_2f71np5j_.chg'to'/disk2/bct/RDBMS/changetracking/o1_mf_2f71np5j_.chg';</code></pre><p>此语句在保留其内容的同时更改更改跟踪文件的位置。</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>打开数据库：</span><div><pre class="pre codeblock"><code>SQL&gt; ALTER DATABASE OPEN;</code></pre></div>
                           </li>
                        </ol>
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-268DD5BF-27DE-4536-8F93-D57431CE4397__GUID-B6DD290D-32D6-4FF6-80CA-2325F45AD28E">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="../sqlrf/index.html" target="_blank"><span><cite>Oracle Database SQL语言参考</cite></span></a> ，了解<code class="codeph">ALTER DATABASE</code>语句和<code class="codeph">ALTER SYSTEM</code>语句</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="BRADV89551"></a><div class="props_rev_3"><a id="GUID-8894680E-8BBA-475D-8815-D789C1A04FD9" name="GUID-8894680E-8BBA-475D-8815-D789C1A04FD9"></a><h3 id="BRADV-GUID-8894680E-8BBA-475D-8815-D789C1A04FD9" class="sect3"><span class="enumeration_section">9.9</span>为长期存储进行数据库备份</h3>
               <div>
                  <p>本节介绍了为长期存储进行备份所涉及的基本概念和任务。</p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="backing-up-database.html#GUID-8C01CFF7-EE90-4A04-8E27-EA5C725919AC" title="你可以使用BACKUP ......保持创建既包含所有权又不受备份保留策略限制的备份。">档案备份的目的</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-09DA2028-0C54-492B-BDE9-9CE07BCD4390" title="通过使用带有BACKUP命令的KEEP选项，可以从保留策略中免除备份。">档案备份的基本概念</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-471E69FD-5483-40AD-A598-8BF6F4530287" title="通常，您将归档备份到磁带。由于您的数据保护备份最有可能位于一组仍可访问且可回收的磁带上，因此建议为归档备份保留一组磁带。">为长期存储制作档案备份</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-F6594D70-D4F8-498E-BEC3-8B4B5C1C45D3" title="归档备份的一个目的是创建测试数据库。">进行临时存档备份</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89552"></a><div class="props_rev_3"><a id="GUID-8C01CFF7-EE90-4A04-8E27-EA5C725919AC" name="GUID-8C01CFF7-EE90-4A04-8E27-EA5C725919AC"></a><h4 id="BRADV-GUID-8C01CFF7-EE90-4A04-8E27-EA5C725919AC" class="sect4"><span class="enumeration_section">9.9.1</span>档案备份的目的</h4>
                  <div>
                     <p>你可以使用<code class="codeph">BACKUP...KEEP</code>创建既包含所有权又不受备份保留策略限制的备份。
                     </p>
                     <p>备份是包罗万象的，因为还原和恢复数据库所需的每个文件都备份到单个磁盘或磁带位置。<code class="codeph">KEEP</code>选项还指定备份永久或在指定时间段内免于保留策略。使用<code class="codeph">BACKUP ...创建的备份的通用名称<code class="codeph">BACKUP ...KEEP</code>是一个<a href="glossary.html#GUID-52B0BB49-8AC2-4C8E-A52F-1908CDE77717"><span class="xrefglossterm">档案备份</span></a> 。
                     </p>
                     <p>如<span class="q">“ <a href="introduction-backup-recovery.html#GUID-8863FC3F-43B7-43B4-A017-30A90F5DA7D5" title="数据存档虽然与数据保护有关，但却有不同的用途。归档备份免于正常的备份和恢复策略。这些备份通常存档在单独的存储介质上并保留很长时间。">关于数据存档</a> ”</span>中所述，备份和恢复策略的一个目的是保留数据。你可以使用<code class="codeph">BACKUP ...KEEP</code>保留数据库备份比保留策略规定的时间更长。例如，您可以在每年的第一天备份数据库以满足法规要求并将介质存储在异地。进行归档备份多年后，您可以恢复并恢复它以查询备份时显示的数据。
                     </p>
                     <p>归档备份的另一个目的是创建要为测试目的还原的备份，然后删除。例如，您可以备份数据库，在测试环境中还原数据库，然后在测试数据库运行后丢弃存档备份。相关目的是创建一个自包含备份，您可以在将其传输到另一个用户或主机后删除。例如，另一个用户可能需要数据库的副本以进行报告或测试。</p>
                  </div>
               </div><a id="BRADV89553"></a><div class="props_rev_3"><a id="GUID-09DA2028-0C54-492B-BDE9-9CE07BCD4390" name="GUID-09DA2028-0C54-492B-BDE9-9CE07BCD4390"></a><h4 id="BRADV-GUID-09DA2028-0C54-492B-BDE9-9CE07BCD4390" class="sect4"><span class="enumeration_section">9.9.2</span>档案备份的基本概念</h4>
                  <div>
                     <p>通过使用带有<code class="codeph">BACKUP</code>命令的<code class="codeph">KEEP</code>选项，可以从保留策略中免除备份。
                     </p>
                     <p>您还可以使用<a href="../rcmrf/CHANGE.html#RCMRF110" target="_blank"><code class="codeph">CHANGE</code></a>命令的<code class="codeph">KEEP</code>和<code class="codeph">NOKEEP</code>选项来更改现有备份的状态。具有<code class="codeph">KEEP</code>属性的备份是可以像任何其他备份一样恢复的有效备份。
                     </p>
                     <p>您可以使用<a href="../rcmrf/untilClause.html#RCMRF160" target="_blank"><code class="codeph">KEEP UNTIL TIME</code></a>子句指定存档备份的结束日期，或指定备份保持<code class="codeph">FOREVER</code> 。如果指定<code class="codeph">UNTIL</code> ，则无论何时配置保留策略，RMAN都会在<code class="codeph">UNTIL</code>时间过后将备份标记为已过时。例如，如果指定<code class="codeph">KEEP UNTIL TIME '01-JAN-13'</code> ，则备份将在2013年1月1日午夜后一秒钟过时。如果指定<code class="codeph">UNTIL TIME</code>为晚上9:00，则备份将在晚上9:01过时</p>
                     <p>在<code class="codeph">BACKUP</code>命令上指定<code class="codeph">KEEP</code>时，RMAN会生成多个备份集。注意<code class="codeph">BACKUP ...的以下特性<code class="codeph">BACKUP ...KEEP</code>命令：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>它会自动备份数据文件，控制文件（即使禁用<a href="glossary.html#GUID-7CDA6567-DFB0-450D-8771-B033E9872AF7"><span class="xrefglossterm">控制文件自动备份</span></a> ）和服务器参数文件。
                           </p>
                        </li>
                        <li>
                           <p>它会自动生成归档重做日志备份，以确保可以将数据库备份恢复到一致状态。</p>
                        </li>
                        <li>
                           <p>如果指定了<code class="codeph">FORMAT</code> ， <code class="codeph">POOL</code>或<code class="codeph">TAG</code>参数，则它们将用于所有备份。因此， <code class="codeph">FORMAT</code>字符串必须允许创建多个备份片段。指定<code class="codeph">%U</code>替换变量是满足此要求的最简单方法。
                           </p>
                        </li>
                        <li>
                           <p>它支持可选的<code class="codeph">RESTORE POINT</code>子句，该子句创建一个<a href="glossary.html#GUID-565076C7-1651-4D58-9F8E-9617561A450A"><span class="xrefglossterm">正常的还原点</span></a> ，该备份点是必须恢复备份以使其一致的SCN的标签。数据文件备份完成后立即捕获SCN。RMAN将还原点与<a href="glossary.html#GUID-CBFA8015-2DFF-42B1-A818-D6C5B92C608F"><span class="xrefglossterm">恢复目录</span></a>重新同步，并在备份存在时维护还原点。
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-09DA2028-0C54-492B-BDE9-9CE07BCD4390__GUID-BA7EB7FF-5055-4ADF-B3DE-4A3FF29F33A2">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="using-flasback-database-restore-points.html#GUID-305E9D61-0F50-4885-891C-A7D86C6D3C8D">列出还原点使用LIST命令</a>获取有关如何显示还原点的信息</p>
                           </li>
                           <li>
                              <p>适用于<code class="codeph">CHANGE</code>语法的<a href="../rcmrf/CHANGE.html#RCMRF110" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                           </li>
                           <li>
                              <p>用于<code class="codeph">BACKUP ... <a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a> <code class="codeph">BACKUP ...KEEP</code>语法</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV89554"></a><div class="props_rev_3"><a id="GUID-471E69FD-5483-40AD-A598-8BF6F4530287" name="GUID-471E69FD-5483-40AD-A598-8BF6F4530287"></a><h4 id="BRADV-GUID-471E69FD-5483-40AD-A598-8BF6F4530287" class="sect4"><span class="enumeration_section">9.9.3</span>为长期存储制作档案备份</h4>
                  <div>
                     <p>通常，您将归档备份到磁带。由于您的数据保护备份最有可能位于一组仍可访问且可回收的磁带上，因此建议为归档备份保留一组磁带。</p>
                     <p>您可以将归档备份写入此特殊磁带集，然后将其置于异地存储中。您可以通过创建动态更新的<a href="glossary.html#GUID-6A46F2BF-D1BF-4993-89BC-52A0AEC9370C"><span class="xrefglossterm">存储脚本</span></a>或shell脚本来改变创建存档备份的过程。运行脚本时，可以动态设置还原点的名称，备份格式等。
                     </p>
                     <div class="infoboxnotealso" id="GUID-471E69FD-5483-40AD-A598-8BF6F4530287__GUID-673B8EE2-4F4D-4F2D-9E58-A045702C3403">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="starting-interacting-with-rman-client.html#GUID-A9321B2D-6CFF-4616-B629-67960A8F87DD" title="运行命令文件时，可以在USING子句中指定一个或多个值，以便在命令文件中的替换变量中使用。通过这种方式，您可以使命令文件动态化。">在命令文件中使用替换变量</a></p>
                           </li>
                           <li>
                              <p><a href="managing-recovery-catalog.html#GUID-BA0C61D6-BE78-4950-946F-2E83A8E65B2C" title="您可以在CREATE SCRIPT命令中指定替换变量。">创建和执行动态存储脚本</a>以了解如何使用RMAN命令文件进行存档备份</p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="BRADV251"></a><a id="BRADV89555"></a><div class="props_rev_3"><a id="GUID-71184821-155F-4540-B2CB-E5126DE10600" name="GUID-71184821-155F-4540-B2CB-E5126DE10600"></a><h5 id="BRADV-GUID-71184821-155F-4540-B2CB-E5126DE10600" class="sect5"><span class="enumeration_section">9.9.3.1</span>进行存档备份</h5>
                     <div>
                        <p>使用带有<code class="codeph">KEEP</code>选项的<code class="codeph">BACKUP</code>命令进行归档备份。
                        </p>
                        <div class="section">
                           <p>此方案使用<code class="codeph">QUARTERLY</code>的备份<a href="glossary.html#GUID-7679D8DB-B41A-4DDC-A1DD-20CEDC0BCA8E"><span class="xrefglossterm">标记</span></a>进行长期归档备份，并将其分配给保留用于长期存储的特殊Oracle Secure Backup磁带系列。请注意此示例的以下功能：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">FOREVER</code>关键字表示此备份永远不符合<a href="glossary.html#GUID-ECF0ADBB-3255-43A2-A425-26850EA598EA"><span class="xrefglossterm">备份保留策略的</span></a>删除条件。
                                 </p>
                              </li>
                              <li>
                                 <p><a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><code class="codeph">BACKUP</code></a>命令创建名为<code class="codeph">FY06Q4</code>以匹配此备份一致的SCN。
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-71184821-155F-4540-B2CB-E5126DE10600__GUID-A8AC649E-6ADA-4B0E-8735-E2649F82F846">要进行长期归档备份：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录。</span><div>
                                 <p>目标数据库可以打开或挂载。<code class="codeph">KEEP FOREVER</code>需要恢复目录，但任何其他<code class="codeph">KEEP</code>选项都不需要。
                                 </p>
                                 <div class="infoboxnotealso" id="GUID-71184821-155F-4540-B2CB-E5126DE10600__GUID-2880F3BE-5EA8-4F24-B471-4702642288CF">
                                    <p class="notep1">也可以看看：</p>
                                    <p><a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a></p>
                                 </div>
                              </div>
                           </li>
                           <li class="stepexpand"><span>运行<code class="codeph">BACKUP ...KEEP</code>进行备份。</span><div>
                                 <p>以下示例生成数据文件和归档日志备份，并创建<a href="glossary.html#GUID-565076C7-1651-4D58-9F8E-9617561A450A"><span class="xrefglossterm">正常还原点</span></a> 。指定的还原点必须不存在。
                                 </p>
                                 <p>日志备份仅包含将此备份还原到一致状态所需的归档日志。数据库执行联机重做日志切换以归档当前联机日志中的重做，并且必须使此新备份保持一致。控制文件自动备份具有还原点的副本，因此可以在还原控制文件后立即引用它。</p><pre class="pre codeblock"><code>RUN {ALLOCATE CHANNEL c1 DEVICE TYPE sbt PARMS'ENV =（OB_MEDIA_FAMILY = archival_backup）'; BACKUP DATABASE TAG每季度保持永久恢复点FY06Q4; }</code></pre><p>以下变体将备份保留365天而不是永久保留。一年过去后，无论备份保留策略设置如何，备份都将过时。</p><pre class="pre codeblock"><code>RUN {ALLOCATE CHANNEL c1 DEVICE TYPE sbt PARMS'ENV =（OB_MEDIA_FAMILY = archival_backup）'; BACKUP DATABASE TAG每季度保持时间'SYSDATE + 365'恢复点FY06Q4; }</code></pre></div>
                           </li>
                        </ol>
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-71184821-155F-4540-B2CB-E5126DE10600__GUID-C441D7B9-010C-41ED-86A9-034DB2E89381">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="using-flasback-database-restore-points.html#GUID-FAA04D1F-36E2-4B20-954F-845E42386775" title="Oracle闪回数据库和还原点是相关的数据保护功能，使您能够及时回溯数据，以纠正在指定时间窗口内由逻辑数据损坏或用户错误导致的任何问题。">闪回数据库，还原点和保证还原点概述，</a>以了解还原点</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="BRADV252"></a><a id="BRADV89556"></a><div class="props_rev_3"><a id="GUID-F6594D70-D4F8-498E-BEC3-8B4B5C1C45D3" name="GUID-F6594D70-D4F8-498E-BEC3-8B4B5C1C45D3"></a><h4 id="BRADV-GUID-F6594D70-D4F8-498E-BEC3-8B4B5C1C45D3" class="sect4"><span class="enumeration_section">9.9.4</span>进行临时存档备份</h4>
                  <div>
                     <p>归档备份的一个目的是创建测试数据库。</p>
                     <div class="section">
                        <p>制作测试数据库的技术与<span class="q">“ <a href="backing-up-database.html#GUID-471E69FD-5483-40AD-A598-8BF6F4530287" title="通常，您将归档备份到磁带。由于您的数据保护备份最有可能位于一组仍可访问且可回收的磁带上，因此建议为归档备份保留一组磁带。">为长期存储制作存档备份</a> ”中</span>描述的技术基本相同。不同之处在于您打算在创建备份后立即删除备份。
                        </p>
                        <p>您可以使用<code class="codeph">BACKUP ...指定备份的临时状态<code class="codeph">BACKUP ...KEEP UNTIL</code>参数。假设您要进行备份，然后在同一天将其还原到新主机。在这种情况下，您可以指定<code class="codeph">KEEP UNTIL</code> <code class="codeph">TIME SYSDATE+1</code>以指示RMAN仅覆盖此备份的保留策略一天。一天后，无论是否配置了任何备份保留策略，备份都将过时。
                        </p>
                        <p><a href="backing-up-database.html#GUID-F6594D70-D4F8-498E-BEC3-8B4B5C1C45D3__CHDDJHCG">例9-17中</a>的命令在带有标记<code class="codeph">TESTDB</code>的临时磁盘上进行归档备份。该示例创建一个正常还原点，该时间点是恢复备份的时间的标签。如果数据库在备份期间处于打开状态，则RMAN仅备份存档的重做日志。脱机备份不需要存档日志，因此不会备份。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-F6594D70-D4F8-498E-BEC3-8B4B5C1C45D3__CHDDJHCG">
                        <p class="titleinexample">示例9-17创建临时存档备份</p><pre class="oac_no_warn" dir="ltr">BACKUP DATABASE FORMAT'/ disk1 / oraclebck /％U'TAG TESTDB保持时间'SYSDATE + 1'RESTORE POINT TESTDB06;</pre><p>恢复归档备份的推荐技术是使用<a href="../rcmrf/DUPLICATE.html#RCMRF126" target="_blank"><code class="codeph">DUPLICATE</code></a>命令。
                        </p>
                     </div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div><a id="BRADV89557"></a><div class="props_rev_3"><a id="GUID-731ADA67-235E-481D-AC17-9F9067AD55BF" name="GUID-731ADA67-235E-481D-AC17-9F9067AD55BF"></a><h3 id="BRADV-GUID-731ADA67-235E-481D-AC17-9F9067AD55BF" class="sect3"><span class="enumeration_section">9.10</span>备份RMAN备份</h3>
               <div>
                  <p>本节介绍如何备份备份集和映像副本，并包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="backing-up-database.html#GUID-B4D2B5C1-7382-48E6-A2FD-3FBE038930D5" title="您可以使用BACKUP BACKUPSET命令备份其他备份作业生成的备份集。您还可以使用BACKUP RECOVERY AREA备份在当前和所有先前快速恢复区域目标中创建的恢复文件。">关于RMAN备份的备份</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-ACE4E75B-FE49-4C45-97B0-89CB57048B78" title="使用BACKUP BACKUPSET命令将备份集从磁盘复制到磁带。">使用RMAN备份备份集</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database.html#GUID-2A0B4416-2AAC-49C1-A617-28CDEF96E97A" title="使用BACKUP命令将映像副本备份到磁带。">使用RMAN备份映像副本备份</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89558"></a><div class="props_rev_3"><a id="GUID-B4D2B5C1-7382-48E6-A2FD-3FBE038930D5" name="GUID-B4D2B5C1-7382-48E6-A2FD-3FBE038930D5"></a><h4 id="BRADV-GUID-B4D2B5C1-7382-48E6-A2FD-3FBE038930D5" class="sect4"><span class="enumeration_section">9.10.1</span>关于RMAN备份的备份</h4>
                  <div>
                     <p>您可以使用<code class="codeph">BACKUP BACKUPSET</code>命令备份其他备份作业生成的备份集。您还可以使用<code class="codeph">BACKUP RECOVERY AREA</code>备份在当前和所有先前快速恢复区域目标中创建的恢复文件。
                     </p>
                     <p>恢复文件是完整备份集和增量备份集，控制文件自动备份，数据文件副本和归档重做日志。<code class="codeph">BACKUP RECOVERY AREA</code>支持SBT和磁盘备份。对于恢复文件的磁盘备份，必须使用<code class="codeph">TO DESTINATION</code>选项。
                     </p>
                     <p>上述命令在以下场景中特别有用：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>确保磁盘和磁带上都存在所有备份。</p>
                        </li>
                        <li>
                           <p>将备份从磁盘移动到磁带，然后释放磁盘空间。当数据库使用快速恢复区域时，此任务尤为重要，以便可以根据需要重用空间。</p>
                        </li>
                     </ul>
                     <p>您还可以使用<code class="codeph">BACKUP COPY OF</code>命令备份数据文件，控制文件和归档重做日志的映像副本。此命令的输出可以是备份集或映像副本，因此您可以从映像副本生成备份集。这种备份形式用于备份在磁盘上作为映像副本创建的数据库备份到磁带。
                     </p>
                     <div class="infoboxnote" id="GUID-B4D2B5C1-7382-48E6-A2FD-3FBE038930D5__GUID-81CE4233-2FCF-487D-98AD-DDD832355AD6">
                        <p class="notep1">注意：</p>
                        <p>在多租户环境中，您无法备份已删除的PDB的备份集和映像副本。RMAN跳过备份这些备份。</p>
                     </div>
                  </div><a id="BRADV89559"></a><div class="props_rev_3"><a id="GUID-99B02CD1-1302-46F7-A354-1CD3BB57BF80" name="GUID-99B02CD1-1302-46F7-A354-1CD3BB57BF80"></a><h5 id="BRADV-GUID-99B02CD1-1302-46F7-A354-1CD3BB57BF80" class="sect5"><span class="enumeration_section">9.10.1.1</span>关于RMAN备份集的多个副本</h5>
                     <div>
                        <p><code class="codeph">BACKUP BACKUPSET</code>命令在备份集中创建备份片的其他副本，但不创建新的备份集。
                        </p>
                        <p>因此， <code class="codeph">BACKUP BACKUPSET</code>是类似于使用<code class="codeph">DUPLEX</code>或<code class="codeph">MAXCOPIES</code>的选项<code class="codeph">BACKUP</code> （见<span class="q">“ <a href="backing-up-database-advanced.html#GUID-4CFE9BA0-E298-42B8-9FB6-D36751C09D54" title="RMAN最多可以同时备份四个备份集，每个副本与其他备份集完全相同。">双工备份集</a> ”）。</span>由<code class="codeph">BACKUP BACKUPSET</code>创建的备份集的额外副本不是新的备份集，就像由其他形式的<code class="codeph">BACKUP</code>命令生成的备份集的副本不是单独的备份集一样。
                        </p>
                     </div>
                  </div><a id="BRADV253"></a><a id="BRADV89560"></a><div class="props_rev_3"><a id="GUID-7170DF18-ABD2-45DF-83E3-72B3811020B6" name="GUID-7170DF18-ABD2-45DF-83E3-72B3811020B6"></a><h5 id="BRADV-GUID-7170DF18-ABD2-45DF-83E3-72B3811020B6" class="sect5"><span class="enumeration_section">9.10.1.2</span>查看备份保留策略对备份备份的影响</h5>
                     <div>
                        <p>对于基于冗余的备份保留策略，备份集将计为备份的一个实例。即使存在构成备份集的备份片的多个副本（例如，备份集已从磁盘备份到磁带），此语句也是如此。</p>
                        <div class="section">
                           <p>对于<a href="glossary.html#GUID-1C595EF7-B8A1-4AA3-8C45-44E9FC8BAB9E"><span class="xrefglossterm">恢复窗口</span></a>保留策略，备份集的所有副本都已过时，或者都不是。查看<a href="../rcmrf/LIST.html#RCMRF132" target="_blank"><code class="codeph">LIST</code></a>和<a href="../rcmrf/REPORT.html#RCMRF147" target="_blank"><code class="codeph">REPORT</code></a>命令的输出时，这一点最容易掌握。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-7170DF18-ABD2-45DF-83E3-72B3811020B6__GUID-FC292FEB-1BDC-4CF6-86E3-14C34B02DC1F">要查看备份保留策略对备份备份的影响，请执行以下操作：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>备份数据文件。</span><div>
                                 <p>以下示例备份数据文件5：</p><pre class="pre codeblock"><code>备份作为BACKUPSET DATAFILE 5;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>从步骤1运行数据文件备份的<code class="codeph">LIST</code>命令。</span><div>
                                 <p>例如，运行以下命令（包括示例输出）。</p><pre class="pre codeblock"><code>数据文件的列表备份5摘要;备份列表===============键TY LV S设备类型完成时间#Pieces #Copies压缩标签-------  -   -   -  ------ ----- --------------- ------- ------- ---------- --- 18 BFA DISK 04-AUG-13 1 1 NO TAG20070804T160 134</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>使用上一步中的备份集密钥备份备份集。</span><div>
                                 <p>例如，输入以下命令：</p><pre class="oac_no_warn" dir="ltr">BACKUP BACKUPSET 18;</pre></div>
                           </li>
                           <li class="stepexpand"><span>运行在步骤2中运行的相同<code class="codeph">LIST</code>命令。</span><div>
                                 <p>例如，运行以下命令（包括示例输出）。</p><pre class="pre codeblock"><code>数据文件的列表备份5摘要;备份列表===============键TY LV S设备类型完成时间#Pieces #Copies压缩标签-------  -   -   -  ------ ----- --------------- ------- ------- ---------- --- 18 BFA DISK 04-AUG-13 1 2 NO TAG20070804T160 134</code></pre><p>此输出中仅显示一个备份集，但现在有两个副本。</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>生成报告以查看基于冗余的备份保留策略下这些副本的效果。</span><div>
                                 <p>例如，发出以下命令：</p><pre class="pre codeblock"><code>报告已废除冗余1;</code></pre><p>没有报告副本已过时，因为备份集的两个副本都具有相同的<code class="codeph">set_stamp</code>和<code class="codeph">set_count</code>值。
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>生成报告以在基于恢复窗口的备份保留策略下查看这些副本的效果。</span><div>
                                 <p>例如，发出以下命令：</p><pre class="pre codeblock"><code>报告1天内未完成的恢复窗口;</code></pre><p>没有备份集的副本报告为过时或基于此备份集的<code class="codeph">CHECKPOINT_CHANGE#</code> ，以及当前时间和其他备份的可用性。
                                 </p>
                                 <div class="infoboxnotealso" id="GUID-7170DF18-ABD2-45DF-83E3-72B3811020B6__GUID-DC504A2A-1D5D-44F4-8414-AB9A30B39423">
                                    <p class="notep1">也可以看看：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="configuring-rman-client-basic.html#GUID-E9AEAC34-6C40-40A1-BAF5-3EAE20417715" title="CONFIGURE RETENTION POLICY命令的REDUNDANCY参数指定RMAN保留的每个数据文件和控制文件的完整备份数或0级备份数。默认保留策略为REDUNDANCY 1。">配置基于冗余的保留策略</a></p>
                                       </li>
                                       <li>
                                          <p><a href="reporting-rman-operations.html#GUID-550638CC-0D16-4B1A-83C7-5D10181DC7C1" title="作为备份和恢复策略的一部分，您应定期运行指示已备份内容的报告。您可以确定哪些数据文件需要备份或哪些文件最近未备份。此外，您还可以预览出现问题时RMAN必须还原的备份。RMAN存储执行操作的每个数据库的元数据。在Data Guard环境中，您可以在不使用Data Guard时使用LIST，REPORT和SHOW命令。您可以使用FOR DB_UNIQUE_NAME子句运行这些命令，以显示与指定数据库关联的备份。LIST命令使用RMAN存储库中的信息来提供备份列表以及与备份和恢复相关的其他对象。LIST命令的主要用途是列出备份和副本。使用listObjList或recordSpec子句指定所需的对象。如果未指定对象，则RMAN将显示所有数据库文件和归档重做日志文件的副本。您可以指定几个不同的条件来缩小LIST输出。使用LIST命令列出预包装备份和预刷新存档的重做日志文件。每次在数据库上执行OPEN RESETLOGS操作时，此操作都会创建数据库的新版本。RMAN REPORT命令分析可用备份和数据库。REPORT命令提供各种RMAN备份报告。使用REPORT NEED BACKUP命令确定在特定保留策略下需要备份的数据库文件。您可以使用REPORT NEED BACKUP命令的选项指定不同的保留策略。REPORT NEED BACKUP命令可以检查整个数据库，跳过指定的表空间，或仅根据不同的保留策略检查特定的表空间或数据文件。您可以将REPORT NEED BACKUP命令测试的备份限制为仅基于磁盘或基于磁带的备份。当通过不可恢复的操作（例如直接加载插入）更改数据文件时，不能使用正常的介质恢复来恢复文件，因为不可恢复的操作不会生成重做。在执行此类操作后，您必须对受影响的数据文件执行完全备份或增量备份，以确保可以使用RMAN恢复受不可恢复操作影响的数据块。您可以报告已过时的备份集，备份片和数据文件副本是，不需要通过指定OBSOLETE关键字来满足指定的保留策略。REPORT SCHEMA命令列出并显示有关数据库文件，表空间等的信息。您可以查看与多租户容器数据库（CDB），仅root用户或一个或多个可插拔数据库（PDB）相关的元数据的报告。使用带有GUID选项的LIST命令列出已从多租户容器数据库（CDB）中删除的可插拔数据库（PDB）的备份。在某些情况下，V $视图通过使用LIST和REPORT命令提供不可用的信息。RMAN作业是在RMAN会话中执行的一组命令。因此，一个RMAN作业可以包含多个命令。V $ BACKUP_PIECE和V $ RMAN_BACKUP_PIECE视图的ENCRYPTED列指示备份片段是加密（YES）还是未加密（NO）。LIST，REPORT和SHOW命令提供了访问控制文件和恢复目录中数据的最简单方法。RMAN从目标数据库控制文件中获取备份和恢复元数据，并将其存储在恢复目录的表中。恢复目录视图是从这些表派生的。恢复目录视图未针对用户查询进行规范化或优化。大多数恢复目录视图包含DB_KEY和DBINC_KEY列。可以通过主键（DB_KEY列值）或DBID（32位唯一数据库标识符）唯一标识在恢复目录中注册的每个数据库。数据库的每个版本都由DBINC_KEY列唯一标识。在Data Guard环境中查询恢复目录时，需要考虑特殊注意事项。DB_KEY值是注册数据库的主键，仅在恢复目录中使用。最简单的方法是获取DB_KEY是使用目标数据库的DBID，每当您将RMAN作为TARGET连接到数据库时，都会显示该DBID。您可以查询视图RC_BACKUP_FILES，以获取有关在恢复目录中注册的任何数据库的所有备份的信息。但是，在查询RC_BACKUP_FILES之前，必须调用DBMS_RCVMAN.SETDATABASE过程。">报告RMAN操作</a>以了解如何使用<code class="codeph">LIST</code>和<code class="codeph">REPORT</code>命令</p>
                                       </li>
                                    </ul>
                                 </div>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div><a id="BRADV254"></a><a id="BRADV147"></a><div class="props_rev_3"><a id="GUID-ACE4E75B-FE49-4C45-97B0-89CB57048B78" name="GUID-ACE4E75B-FE49-4C45-97B0-89CB57048B78"></a><h4 id="BRADV-GUID-ACE4E75B-FE49-4C45-97B0-89CB57048B78" class="sect4"><span class="enumeration_section">9.10.2</span>使用RMAN备份备份集</h4>
                  <div>
                     <p>使用<code class="codeph">BACKUP BACKUPSET</code>命令将备份集从磁盘复制到磁带。
                     </p>
                     <div class="section">
                        <p>本节中的过程假定您已将<a href="glossary.html#GUID-2E48CE71-9547-4196-B715-5CE59033262E"><span class="xrefglossterm">SBT</span></a>设备配置为默认设备。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-ACE4E75B-FE49-4C45-97B0-89CB57048B78__GUID-C0B52A6F-18BE-47C4-8BE0-A5053D4330CF">要将备份集从磁盘备份到磁带：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>如果要备份可用备份集的子集，则执行<code class="codeph">LIST BACKUPSET</code>命令以获取其主键。</span><div>
                              <p>以下示例以摘要形式列出备份集：</p><pre class="pre codeblock"><code>RMAN&gt; LIST BACKUPSET SUMMARY;备份列表===============键TY LV S设备类型完成时间#Pieces #Copies Comp Tag ---  -   -   -  ---------- -  --------------- ------- ------- ---- --- 1 BFA DISK 28-MAY-13 1 1 NO TAG20070528T132432 2 BFA DISK 29-MAY-13 1 1 NO TAG20070529T132433 3 BFA DISK 30-MAY-13 1 1 NO TAG20070530T132434</code></pre><p>以下示例列出了有关备份集3的详细信息：</p><pre class="pre codeblock"><code>RMAN&gt; LIST BACKUPSET 3;备份集列表=================== BS密钥类型LV大小设备类型经过时间完成时间------- ------ --- ------- ----------- ------------ --------------- 3完全8.33M碟00:00:01 30-MAY-13 BP密钥：3状态：可用压缩：否标签：TAG20070530T132434件名：/ disk1 / oracle / dbs / c-35764265-20070530-02包含控制文件：Ckp SCN：397221 Ckp时间：30-MAY-13 SPFILE包含：修改时间：30-MAY-13 SPFILE db_unique_name：PROD</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>执行<code class="codeph">BACKUP BACKUPSET</code>命令。</span><div>
                              <p>以下示例将所有磁盘备份集备份到磁带，然后删除输入磁盘备份：</p><pre class="pre codeblock"><code>BACKUP BACKUPSET ALL DELETE INPUT;</code></pre><p>以下示例仅备份主键1和2到磁带的备份集，然后删除输入磁盘备份：</p><pre class="pre codeblock"><code>BACKUP BACKUPSET 1,2 DELETE INPUT;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>（可选）执行<a href="../rcmrf/LIST.html#RCMRF132" target="_blank"><code class="codeph">LIST</code></a>命令以查看备份集和部分的列表。</span><div>
                              <p>输出列出所有副本，包括<code class="codeph">BACKUP BACKUPSET</code>创建的备份片副本。
                              </p>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV255"></a><a id="BRADV89561"></a><div class="props_rev_3"><a id="GUID-2A0B4416-2AAC-49C1-A617-28CDEF96E97A" name="GUID-2A0B4416-2AAC-49C1-A617-28CDEF96E97A"></a><h4 id="BRADV-GUID-2A0B4416-2AAC-49C1-A617-28CDEF96E97A" class="sect4"><span class="enumeration_section">9.10.3</span>使用RMAN备份映像副本备份</h4>
                  <div>
                     <p>使用<code class="codeph">BACKUP</code>命令将映像副本备份到磁带。
                     </p>
                     <div class="section">
                        <p>本节假定您已将<a href="glossary.html#GUID-2E48CE71-9547-4196-B715-5CE59033262E"><span class="xrefglossterm">SBT</span></a>设备配置为默认设备。
                        </p>
                        <p>备份具有多个数据文件副本的映像副本时，为备份指定标记可以更轻松地标识输入映像副本。数据文件的所有图像副本都有标签。将映像副本备份为新映像副本时，默认情况下会继承映像副本的<a href="glossary.html#GUID-7679D8DB-B41A-4DDC-A1DD-20CEDC0BCA8E"><span class="xrefglossterm">标记</span></a> 。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-2A0B4416-2AAC-49C1-A617-28CDEF96E97A__GUID-7D7D64DF-D7A1-44B6-BD09-B3BFB19D9144">要将映像副本从磁盘备份到磁带：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>发出<code class="codeph">BACKUP ...COPY OF</code>或<code class="codeph">BACKUP DATAFILECOPY</code>命令。</span><div>
                              <p>以下示例备份具有标记<code class="codeph">DBCopy</code>数据文件副本：</p><pre class="pre codeblock"><code>从TAG DBCopy备份DATAFILECOPY;</code></pre><p>以下示例将数据库的最新映像副本备份到磁带，分配标记<code class="codeph">QUARTERLY_BACKUP</code> ，并删除输入磁盘备份：</p><pre class="pre codeblock"><code>备份设备类型sbt TAG“quarterly_backup”数据库删除输入的复制;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>（可选）发出<a href="../rcmrf/LIST.html#RCMRF132" target="_blank"><code class="codeph">LIST</code></a>命令以查看备份集列表。输出列出所有副本，包括<code class="codeph">BACKUP</code>命令使用<code class="codeph">BACKUPSET</code>子句创建的备份片副本。</span></li>
                     </ol>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>