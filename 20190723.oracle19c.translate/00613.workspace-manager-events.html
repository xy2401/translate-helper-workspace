<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="Certain applications may be interested in knowing what Workspace Manager operations are being performed and may want to take some actions based on that. Several types of Workspace Manager operations can be captured as events."></meta>
      <meta name="description" content="Certain applications may be interested in knowing what Workspace Manager operations are being performed and may want to take some actions based on that. Several types of Workspace Manager operations can be captured as events."></meta>
      <title>工作区管理器事件</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Workspace Manager Developer&#39;s Guide"></meta>
      <meta property="og:description" content="Certain applications may be interested in knowing what Workspace Manager operations are being performed and may want to take some actions based on that. Several types of Workspace Manager operations can be captured as events."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Workspace Manager Developer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="workspace-manager-developers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-11T16:49:08-08:00"></meta>
      <meta name="dcterms.title" content="Workspace Manager Developer&#39;s Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="2000, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E94792-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="introduction-to-workspace-manager.html" title="Previous" type="text/html"></link>
      <link rel="next" href="valid-time-support.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="ADWSM"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="introduction-to-workspace-manager.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="valid-time-support.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Workspace Manager开发人员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="workspace-manager-concepts-usage.html" property="item" typeof="WebPage"><span property="name">概念和使用信息</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">工作区管理器事件</li>
            </ol>
            <a id="GUID-C37F89FE-48D9-478D-A227-DBC043FF569D" name="GUID-C37F89FE-48D9-478D-A227-DBC043FF569D"></a><a id="ADWSM040"></a>
            
            <h2 id="ADWSM-GUID-C37F89FE-48D9-478D-A227-DBC043FF569D" class="sect2"><span class="enumeration_chapter">2</span>工作区管理器事件</h2>
         </header>
         <div class="ind">
            <div>
               <p>某些应用程序可能对了解正在执行的Workspace Manager操作感兴趣，并且可能希望基于此操作采取某些操作。可以将多种类型的Workspace Manager操作捕获为事件。</p>
               <p>Workspace Manager提供了一个框架，用于将这些事件异步传递给感兴趣的应用程序。然后，应用程序可以根据事件采取一些操作。可以使用事件的一些场景包括：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p>每当工作空间合并到LIVE时，应用程序都希望得到通知，以便它可以刷新其数据。</p>
                  </li>
                  <li>
                     <p>每当创建新的保存点时，都需要存档工作区数据。</p>
                  </li>
               </ul>
               <p><a id="d24603e36" class="indexterm-anchor"></a> Workspace Manager事件框架基于Oracle Advanced Queuing（AQ）功能构建。AQ提供的消息传递功能（如异步通知，持久性，传播，访问控制，历史记录和基于规则的订阅）可用于Workspace Manager事件。
               </p>
               <p>Workspace Manager创建一个多队员队列，其中事件被排队。有关事件的相关信息（例如事件类型，触发事件的用户和工作空间以及版本化表的名称）将在事件有效内容中初始化并入队。应用程序可以订阅这些事件，可以选择为其订阅指定规则。只有满足规则的事件才适用于订户。订阅者可以通过各种方式获取事件通知，例如侦听队列中的事件，注册回调以进行通知，或者显式地从队列中出列事件。</p>
               <p>由于事件以异步方式传递给其他应用程序，因此生成事件的工作空间操作的性能不受影响。</p>
               <div class="infoboxnote" id="GUID-C37F89FE-48D9-478D-A227-DBC043FF569D__GUID-AB5D6343-B5B6-4B66-94B2-EA919FD1030C">
                  <p class="notep1">注意：</p>
                  <p>要在应用程序中使用Workspace Manager事件，您必须了解<a href="../adque/aq-introduction.html#ADQUE0100" target="_blank"><span class="italic">Oracle Database Advanced Queuing用户指南中</span></a>描述的相关AQ概念和技术。
                  </p>
               </div>
               <p>本章包含以下主要部分：</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="workspace-manager-events.html#GUID-75395F72-985A-472F-AFB2-D9A18D854DAA">工作区管理器事件列表</a><br>下表列出了Workspace Manager事件以及每次事件发生的时间。
                  </li>
                  <li class="ulchildlink"><a href="workspace-manager-events.html#GUID-1E5983A9-ECAD-4BC6-8B3C-2B158A2F06C4">事件参数</a><br>发生事件时，信息存储在捆绑到名为<code class="codeph">WMSYS.WM$EVENT_TYPE</code>的对象类型的参数中，并排入事件队列。订户可以在接收通知时使事件对象出列。
                  </li>
                  <li class="ulchildlink"><a href="workspace-manager-events.html#GUID-E5CD75CB-7402-450F-BB3B-32F18E6394F8">ALLOW_CAPTURE_EVENTS系统参数</a><br>Workspace Manager系统参数<code class="codeph">ALLOW_CAPTURE_EVENTS</code>可用于捕获事件。
                  </li>
                  <li class="ulchildlink"><a href="workspace-manager-events.html#GUID-FF092E6F-784F-4D5E-AA64-E9A0CDDBC8BA">AQ操作和工作区管理器事件</a><br>本节介绍与使用捕获的Workspace Manager事件的应用程序开发人员相关的高级队列对象和技术。
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="workspace-manager-concepts-usage.html#GUID-4364945A-B6E1-47FF-9360-273FF92D7F76">概念和使用信息</a></p>
                  </div>
               </div>
            </div>
            <a id="ADWSM99182"></a><a id="ADWSM99181"></a><div class="props_rev_3"><a id="GUID-75395F72-985A-472F-AFB2-D9A18D854DAA" name="GUID-75395F72-985A-472F-AFB2-D9A18D854DAA"></a><h3 id="ADWSM-GUID-75395F72-985A-472F-AFB2-D9A18D854DAA" class="sect3"><span class="enumeration_section">2.1</span>工作区管理器事件列表</h3>
               <div>
                  <p>下表列出了Workspace Manager事件以及每次事件发生的时间。</p>
                  <div class="tblformal" id="GUID-75395F72-985A-472F-AFB2-D9A18D854DAA__G1021522">
                     <p class="titleintable">表2-1工作区管理器事件</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="工作区管理器事件" width="100%" border="1" summary="Workspace Manager Events. Column 1 is Event, and column 2 is Occurs." frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="50%" id="d24603e144">事件</th>
                              <th align="left" valign="bottom" width="50%" id="d24603e147">发生</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e152" headers="d24603e144 ">
                                 <p>TABLE_MERGE_W_REMOVE_DATA</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e152 d24603e147 ">
                                 <p>在<a href="DBMS_WM-reference.html#GUID-025C9C04-73BD-4AD6-91AA-029EE4D50F4A">将</a> <code class="codeph">remove_data</code>设置为<code class="codeph">TRUE</code>情况下调用<a href="DBMS_WM-reference.html#GUID-025C9C04-73BD-4AD6-91AA-029EE4D50F4A">MergeTable时</a> 。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e169" headers="d24603e144 ">
                                 <p>TABLE_MERGE_WO_REMOVE_DATA</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e169 d24603e147 ">
                                 <p>在<a href="DBMS_WM-reference.html#GUID-025C9C04-73BD-4AD6-91AA-029EE4D50F4A">将</a> <code class="codeph">remove_data</code>设置为<code class="codeph">FALSE</code>情况下调用<a href="DBMS_WM-reference.html#GUID-025C9C04-73BD-4AD6-91AA-029EE4D50F4A">MergeTable时</a> 。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e186" headers="d24603e144 ">
                                 <p>TABLE_REFRESH</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e186 d24603e147 ">
                                 <p>调用<a href="DBMS_WM-reference.html#GUID-6600B232-A8C2-4564-B0DD-227F7271317A">RefreshTable时</a> 。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e197" headers="d24603e144 ">
                                 <p>TABLE_ROLLBACK</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e197 d24603e147 ">
                                 <p>调用<a href="DBMS_WM-reference.html#GUID-7AB0F531-1C20-48CA-893D-EE252A57EA73">RollbackTable时</a> 。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e208" headers="d24603e144 ">
                                 <p>WORKSPACE_COMPRESS</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e208 d24603e147 ">
                                 <p>调用<a href="DBMS_WM-reference.html#GUID-BD1132FA-656F-442D-A940-661E67DC562E">CompressWorkspace</a>或<a href="DBMS_WM-reference.html#GUID-7622FE8D-B9FF-41F9-AF69-8523E10FE535">CompressWorkspaceTree时</a> 。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e223" headers="d24603e144 ">
                                 <p>WORKSPACE_CREATE</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e223 d24603e147 ">
                                 <p>调用<a href="DBMS_WM-reference.html#GUID-963E70CB-491F-4539-A9FD-4CA9E49D75B1">CreateWorkspace时</a> 。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e234" headers="d24603e144 ">
                                 <p>WORKSPACE_MERGE_W_REMOVE</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e234 d24603e147 ">
                                 <p>当<a href="DBMS_WM-reference.html#GUID-638B284A-0A7F-4D3F-8DD7-D302489B29C7">MergeWorkspace</a>与调用<code class="codeph">remove_workspace</code>设置为<code class="codeph">TRUE</code> 。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e251" headers="d24603e144 ">
                                 <p>WORKSPACE_MERGE_WO_REMOVE</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e251 d24603e147 ">
                                 <p>当<a href="DBMS_WM-reference.html#GUID-638B284A-0A7F-4D3F-8DD7-D302489B29C7">MergeWorkspace</a>与调用<code class="codeph">remove_workspace</code>设置为<code class="codeph">FALSE</code> 。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e268" headers="d24603e144 ">
                                 <p>WORKSPACE_REFRESH</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e268 d24603e147 ">
                                 <p>调用<a href="DBMS_WM-reference.html#GUID-E4AE382B-FF99-4333-8F21-A56DE5318338">RefreshWorkspace时</a> 。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e279" headers="d24603e144 ">
                                 <p>WORKSPACE_REMOVE</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e279 d24603e147 ">
                                 <p>调用<a href="DBMS_WM-reference.html#GUID-C2D5232B-C82F-4D1F-8FDE-D5800EF5DE13">RemoveWorkspace</a>或<a href="DBMS_WM-reference.html#GUID-C6B0F84A-9649-425B-97CF-0299344F2C68">RemoveWorkspaceTree时</a> 。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e294" headers="d24603e144 ">
                                 <p>WORKSPACE_ROLLBACK</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e294 d24603e147 ">
                                 <p>调用<a href="DBMS_WM-reference.html#GUID-34F03A7E-6280-4231-BFBC-28D0FEB0486C">RollbackWorkspace时</a> 。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e306" headers="d24603e144 ">
                                 <p>WORKSPACE_VERSION</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e306 d24603e147 ">
                                 <p>由于创建显式或隐式保存点而在工作空间中创建新版本。（ <a href="introduction-to-workspace-manager.html#GUID-9F85C3B4-55C8-4C15-87B1-381B0AB04206">使用保存</a>点中描述了<a href="introduction-to-workspace-manager.html#GUID-9F85C3B4-55C8-4C15-87B1-381B0AB04206">保存点</a> 。）
                                 </p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="workspace-manager-events.html#GUID-C37F89FE-48D9-478D-A227-DBC043FF569D" title="某些应用程序可能对了解正在执行的Workspace Manager操作感兴趣，并且可能希望基于此操作采取某些操作。可以将多种类型的Workspace Manager操作捕获为事件。">工作区管理器事件</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADWSM99184"></a><a id="ADWSM99183"></a><div class="props_rev_3"><a id="GUID-1E5983A9-ECAD-4BC6-8B3C-2B158A2F06C4" name="GUID-1E5983A9-ECAD-4BC6-8B3C-2B158A2F06C4"></a><h3 id="ADWSM-GUID-1E5983A9-ECAD-4BC6-8B3C-2B158A2F06C4" class="sect3"><span class="enumeration_section">2.2</span>事件参数</h3>
               <div>
                  <p>发生事件时，信息存储在捆绑到名为<code class="codeph">WMSYS.WM$EVENT_TYPE</code>的对象类型的参数中，并排入事件队列。订户可以在接收通知时使事件对象出列。
                  </p>
                  <p>下表介绍了Workspace Manager事件参数。</p>
                  <div class="tblformal" id="GUID-1E5983A9-ECAD-4BC6-8B3C-2B158A2F06C4__G1021565">
                     <p class="titleintable">表2-2工作区管理器事件参数</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="工作区管理器事件参数" width="100%" border="1" summary="Workspace Manager Event Parameters. Column 1 is Event Parameter, column 2 is Data Type, and column 3 is Description." frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="29%" id="d24603e377">事件参数</th>
                              <th align="left" valign="bottom" width="29%" id="d24603e380">数据类型</th>
                              <th align="left" valign="bottom" width="43%" id="d24603e383">描述</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d24603e388" headers="d24603e377 ">
                                 <p>EVENT_NAME</p>
                              </td>
                              <td align="left" valign="top" width="29%" headers="d24603e388 d24603e380 ">
                                 <p><code class="codeph">VARCHAR2（128）</code></p>
                              </td>
                              <td align="left" valign="top" width="43%" headers="d24603e388 d24603e383 ">
                                 <p>指示事件类型的名称。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d24603e399" headers="d24603e377 ">
                                 <p>workspace_name</p>
                              </td>
                              <td align="left" valign="top" width="29%" headers="d24603e399 d24603e380 ">
                                 <p><code class="codeph">VARCHAR2（128）</code></p>
                              </td>
                              <td align="left" valign="top" width="43%" headers="d24603e399 d24603e383 ">
                                 <p>导致事件发生的工作区。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d24603e410" headers="d24603e377 ">
                                 <p>parent_workspace_name</p>
                              </td>
                              <td align="left" valign="top" width="29%" headers="d24603e410 d24603e380 ">
                                 <p><code class="codeph">VARCHAR2（128）</code></p>
                              </td>
                              <td align="left" valign="top" width="43%" headers="d24603e410 d24603e383 ">
                                 <p>导致事件发生的工作空间的父工作空间。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d24603e421" headers="d24603e377 ">
                                 <p>用户名</p>
                              </td>
                              <td align="left" valign="top" width="29%" headers="d24603e421 d24603e380 ">
                                 <p><code class="codeph">VARCHAR2（128）</code></p>
                              </td>
                              <td align="left" valign="top" width="43%" headers="d24603e421 d24603e383 ">
                                 <p>导致事件发生的用户。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d24603e432" headers="d24603e377 ">
                                 <p>TABLE_NAME</p>
                              </td>
                              <td align="left" valign="top" width="29%" headers="d24603e432 d24603e380 ">
                                 <p><code class="codeph">VARCHAR2（128）</code></p>
                              </td>
                              <td align="left" valign="top" width="43%" headers="d24603e432 d24603e383 ">
                                 <p>发生事件的启用版本的表。如果此参数不适用于某个事件，则该参数为null。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d24603e443" headers="d24603e377 ">
                                 <p>aux_params</p>
                              </td>
                              <td align="left" valign="top" width="29%" headers="d24603e443 d24603e380 ">
                                 <p><code class="codeph">WMSYS.WM$NV_PAIR_NT_TYPE</code> （这是表<code class="codeph">WMSYS.WM$NV_PAIR_TYPE</code> ）</p>
                              </td>
                              <td align="left" valign="top" width="43%" headers="d24603e443 d24603e383 ">
                                 <p>一个（名称，值）对的嵌套表，可以包含有关该事件的其他信息。</p>
                                 <p>对于<code class="codeph">TABLE_</code> <span class="italic">xxx</span> <span class="italic"> </span>事件，它有一行包含用于操作的<code class="codeph">WHERE</code>子句字符串。
                                 </p>
                                 <p>对于<code class="codeph">WORKSPACE_VERSION</code>事件，它有一行包含与新创建的版本关联的保存点名称。
                                 </p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="workspace-manager-events.html#GUID-C37F89FE-48D9-478D-A227-DBC043FF569D" title="某些应用程序可能对了解正在执行的Workspace Manager操作感兴趣，并且可能希望基于此操作采取某些操作。可以将多种类型的Workspace Manager操作捕获为事件。">工作区管理器事件</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADWSM99186"></a><a id="ADWSM99185"></a><div class="props_rev_3"><a id="GUID-E5CD75CB-7402-450F-BB3B-32F18E6394F8" name="GUID-E5CD75CB-7402-450F-BB3B-32F18E6394F8"></a><h3 id="ADWSM-GUID-E5CD75CB-7402-450F-BB3B-32F18E6394F8" class="sect3"><span class="enumeration_section">2.3</span> ALLOW_CAPTURE_EVENTS系统参数</h3>
               <div>
                  <p>Workspace Manager系统参数<code class="codeph">ALLOW_CAPTURE_EVENTS</code>可用于捕获事件。
                  </p>
                  <p>在捕获任何Workspace Manager事件之前，必须使用<a href="DBMS_WM-reference.html#GUID-3DF05DFE-4D98-4F09-AB40-2CDA0A0F3EFD">SetSystemParameter</a>过程将Workspace Manager系统参数<code class="codeph">ALLOW_CAPTURE_EVENTS</code>设置为值<code class="codeph">ON</code> 。但是，这不会导致任何事件被捕获;要捕获事件，必须使用<a href="DBMS_WM-reference.html#GUID-9D766800-9C80-440A-82EB-8FFD56062641">SetCaptureEvent</a>过程。
                  </p>
                  <p>您可以稍后通过使用<a href="DBMS_WM-reference.html#GUID-3DF05DFE-4D98-4F09-AB40-2CDA0A0F3EFD">SetSystemParameter</a>过程将<code class="codeph">ALLOW_CAPTURE_EVENTS</code>设置为<code class="codeph">OFF</code>值来禁止捕获Workspace Manager事件，但您必须首先确保当前没有捕获任何事件。<a href="workspace-manager-events.html#GUID-E5CD75CB-7402-450F-BB3B-32F18E6394F8__I1021298">示例2-1</a>显示了启用和禁用所有事件捕获以及启动和停止捕获所有事件的过程调用序列。
                  </p>
                  <div class="example" id="GUID-E5CD75CB-7402-450F-BB3B-32F18E6394F8__I1021298">
                     <p class="titleinexample">示例2-1捕获Workspace Manager事件</p><pre class="oac_no_warn" dir="ltr">- 允许捕获Workspace Manager事件。（SetCaptureEvent必需）EXECUTE DBMS_WM.SetSystemParameter（'ALLOW_CAPTURE_EVENTS'，'ON'）; - 开始捕获所有Workspace Manager事件。EXECUTE DBMS_WM.SetCaptureEvent（'ALL_EVENTS'，'ON'）; 。。。- 停止捕获所有Workspace Manager事件。EXECUTE DBMS_WM.SetCaptureEvent（'ALL_EVENTS'，'OFF'）; - 禁止捕获Workspace Manager事件。EXECUTE DBMS_WM.SetSystemParameter（'ALLOW_CAPTURE_EVENTS'，'OFF'）;</pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="workspace-manager-events.html#GUID-C37F89FE-48D9-478D-A227-DBC043FF569D" title="某些应用程序可能对了解正在执行的Workspace Manager操作感兴趣，并且可能希望基于此操作采取某些操作。可以将多种类型的Workspace Manager操作捕获为事件。">工作区管理器事件</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADWSM99187"></a><div class="props_rev_3"><a id="GUID-FF092E6F-784F-4D5E-AA64-E9A0CDDBC8BA" name="GUID-FF092E6F-784F-4D5E-AA64-E9A0CDDBC8BA"></a><h3 id="ADWSM-GUID-FF092E6F-784F-4D5E-AA64-E9A0CDDBC8BA" class="sect3"><span class="enumeration_section">2.4</span> AQ操作和工作区管理器事件</h3>
               <div>
                  <p>本节介绍与使用捕获的Workspace Manager事件的应用程序开发人员相关的高级队列对象和技术。</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="workspace-manager-events.html#GUID-D5B33938-643E-4F53-9B06-06559BB03244">工作区管理器事件队列管理</a><br></li>
                     <li class="ulchildlink"><a href="workspace-manager-events.html#GUID-8F9EF92F-F4F7-45CE-838F-5873685018AE">队列的权限和访问控制</a><br></li>
                     <li class="ulchildlink"><a href="workspace-manager-events.html#GUID-264003A4-9C2C-4529-81B0-A78C1E1073CC">基于规则的订阅</a><br></li>
                     <li class="ulchildlink"><a href="workspace-manager-events.html#GUID-19EB7A56-8914-4265-AFAD-448CF9F78AC8">倾听事件</a><br></li>
                     <li class="ulchildlink"><a href="workspace-manager-events.html#GUID-C598F17B-DBC2-4F6F-8951-0D96BF226453">异步通知</a><br></li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="workspace-manager-events.html#GUID-C37F89FE-48D9-478D-A227-DBC043FF569D" title="某些应用程序可能对了解正在执行的Workspace Manager操作感兴趣，并且可能希望基于此操作采取某些操作。可以将多种类型的Workspace Manager操作捕获为事件。">工作区管理器事件</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADWSM99189"></a><a id="ADWSM99188"></a><div class="props_rev_3"><a id="GUID-D5B33938-643E-4F53-9B06-06559BB03244" name="GUID-D5B33938-643E-4F53-9B06-06559BB03244"></a><h4 id="ADWSM-GUID-D5B33938-643E-4F53-9B06-06559BB03244" class="sect4"><span class="enumeration_section">2.4.1</span>工作区管理器事件队列管理</h4>
                  <div>
                     <p>工作区管理器创建一个名为multiconsumer队列<code class="codeph">WMSYS.WM$EVENT_QUEUE</code>基于命名队列表<code class="codeph">WMSYS.WM$EVENT_QUEUE_TABLE</code> 。队列有效负载类型是<code class="codeph">WMSYS.WM$EVENT_TYPE</code> ，它是一种对象类型。
                     </p>
                     <p>AQ为队列创建了一些可用于管理目的的视图。<a href="workspace-manager-events.html#GUID-D5B33938-643E-4F53-9B06-06559BB03244__G1021601" title="工作区管理器的AQ管理视图。第1列是视图名称，第2列是描述。">表2-3</a>描述了Workspace Manager应用程序开发人员感兴趣的视图。
                     </p>
                     <div class="tblformal" id="GUID-D5B33938-643E-4F53-9B06-06559BB03244__G1021601">
                        <p class="titleintable">表2-3工作区管理器的AQ管理视图</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="工作区管理器的AQ管理视图" width="100%" border="1" summary="AQ Administrative Views for Workspace Manager. Column 1 is View Name, and column 2 is Description." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="31%" id="d24603e684">查看名称</th>
                                 <th align="left" valign="bottom" width="69%" id="d24603e687">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d24603e692" headers="d24603e684 ">
                                    <p>WMSYS.AQ $ WM $ EVENT_QUEUE_TABLE</p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d24603e692 d24603e687 ">
                                    <p>描述存储事件的队列表。此视图可用于查询事件。<code class="codeph">AQ_ADMINISTRATOR_ROLE</code>角色和<code class="codeph">WM_ADMIN</code>系统特权被授予此视图的select权限。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d24603e705" headers="d24603e684 ">
                                    <p>WMSYS.AQ $ WM $ EVENT_QUEUE_TABLE_S</p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d24603e705 d24603e687 ">
                                    <p>显示事件队列的所有订户;如果用户创建了转换，也会显示订户的转换。<code class="codeph">AQ_ADMINISTRATOR_ROLE</code>角色和<code class="codeph">WM_ADMIN</code>系统特权被授予此视图的select权限。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d24603e718" headers="d24603e684 ">
                                    <p>WMSYS.AQ $ WM $ EVENT_QUEUE_TABLE_R</p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d24603e718 d24603e687 ">
                                    <p>仅显示给定队列表中所有队列的基于规则的订户，以及每个订户定义的规则文本。如果指定了订户，还会显示订户的转换。<code class="codeph">AQ_ADMINISTRATOR_ROLE</code>角色和<code class="codeph">WM_ADMIN</code>系统特权被授予此视图的select权限。
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="workspace-manager-events.html#GUID-FF092E6F-784F-4D5E-AA64-E9A0CDDBC8BA" title="本节介绍与使用捕获的Workspace Manager事件的应用程序开发人员相关的高级队列对象和技术。">AQ操作和工作区管理器事件</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADWSM99191"></a><a id="ADWSM99190"></a><div class="props_rev_3"><a id="GUID-8F9EF92F-F4F7-45CE-838F-5873685018AE" name="GUID-8F9EF92F-F4F7-45CE-838F-5873685018AE"></a><h4 id="ADWSM-GUID-8F9EF92F-F4F7-45CE-838F-5873685018AE" class="sect4"><span class="enumeration_section">2.4.2</span>队列的权限和访问控制</h4>
                  <div>
                     <p>数据库管理员有几种选项可用于授予权限和访问队列。一些可能的情况包括：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>授予的系统权限<code class="codeph">ENQUEUE ANY QUEUE</code>和<code class="codeph">DEQUEUE ANY QUEUE</code>通过使用直接到数据库用户<code class="codeph">DBMS_AQADM.GRANT_SYSTEM_PRIVILEGE</code>过程，以及任选以后用撤消特权<code class="codeph">DBMS_AQADM.REVOKE_SYSTEM_PRIVILEGE</code>过程。
                           </p>
                        </li>
                        <li>
                           <p>通过使用<code class="codeph">DBMS_AQADM.GRANT_QUEUE_PRIVILEGE</code>过程将事件队列<code class="codeph">WMSYS.WM$EVENT_QUEUE</code>的队列权限<code class="codeph">ENQUEUE</code>和<code class="codeph">DEQUEUE</code>授予数据库用户，并可选择稍后使用<code class="codeph">DBMS_AQADM.REVOKE_QUEUE_PRIVILEGE</code>过程撤消权限。
                           </p>
                        </li>
                        <li>
                           <p>将角色<code class="codeph">AQ_ADMINISTRATOR_ROLE</code>授予数据库用户，以便为该用户授予任何队列的管理权限。
                           </p>
                        </li>
                     </ul>
                     <p><a href="workspace-manager-events.html#GUID-8F9EF92F-F4F7-45CE-838F-5873685018AE__i1021283">示例2-2</a>显示了为用户授予订阅事件队列和出列事件的权限。
                     </p>
                     <div class="example" id="GUID-8F9EF92F-F4F7-45CE-838F-5873685018AE__i1021283">
                        <p class="titleinexample">示例2-2授予队列访问权限</p><pre class="oac_no_warn" dir="ltr">- 作为SYSDBA连接时执行以下操作。 - 用户执行AQ包时需要这些权限。将DBMS_AQ上的执行授予SCOTT;将DBMS_AQADM上的执行授予SCOTT; - 授予SCOTT订阅事件队列的权限。exec DBMS_AQADM.GRANT_SYSTEM_PRIVILEGE（'MANAGE_ANY'，'SCOTT'）; - 授予SCOTT出列事件的特权。（作为替代方法，您可以使用 -  DBMS_AQADM.GRANT_QUEUE_PRIVILEGE授予DEQUEUE权限 -  WMSYS.WM $ EVENT_QUEUE。）exec DBMS_AQADM.GRANT_SYSTEM_PRIVILEGE（'DEQUEUE_ANY'，'SCOTT'）;</pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="workspace-manager-events.html#GUID-FF092E6F-784F-4D5E-AA64-E9A0CDDBC8BA" title="本节介绍与使用捕获的Workspace Manager事件的应用程序开发人员相关的高级队列对象和技术。">AQ操作和工作区管理器事件</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADWSM99193"></a><a id="ADWSM99192"></a><div class="props_rev_3"><a id="GUID-264003A4-9C2C-4529-81B0-A78C1E1073CC" name="GUID-264003A4-9C2C-4529-81B0-A78C1E1073CC"></a><h4 id="ADWSM-GUID-264003A4-9C2C-4529-81B0-A78C1E1073CC" class="sect4"><span class="enumeration_section">2.4.3</span>基于规则的订阅</h4>
                  <div>
                     <p>可以根据事件参数将事件传递给多个收件人。您可以为事件队列定义基于规则的订阅，作为指定接收事件的兴趣的机制。然后使用订户规则来评估事件传递的收件人。空规则表示订户希望接收所有事件。</p>
                     <p><a href="workspace-manager-events.html#GUID-264003A4-9C2C-4529-81B0-A78C1E1073CC__i1021306">示例2-3</a>为用户SCOTT创建基于规则的订阅，以在父工作空间为<code class="codeph">LIVE</code>工作空间时传递WORKSPACE_MERGE_WO_REMOVE事件。
                     </p>
                     <div class="example" id="GUID-264003A4-9C2C-4529-81B0-A78C1E1073CC__i1021306">
                        <p class="titleinexample">示例2-3 Workspace Manager事件的基于规则的订阅</p><pre class="oac_no_warn" dir="ltr">rem ================================================= rem创建队列订阅者rem当rem将工作空间合并到LIVE rem时注册MergeWorkspace事件================================ ================= connect scott  - 出现提示时输入密码。DECLARE订户sys.aq $ _agent; BEGIN subscriber：= sys.aq $ _agent（'MERGE_LISTENER'，NULL，NULL）; dbms_aqadm.add_subscriber（queue_name =&gt;'WMSYS.WM $ EVENT_QUEUE'，subscriber =&gt; subscriber，rule =&gt;'tab.user_data.event_name =''WORKSPACE_MERGE_WO_REMOVE''和tab.user_data.parent_workspace_name =''LIVE'''）;结束; /</pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="workspace-manager-events.html#GUID-FF092E6F-784F-4D5E-AA64-E9A0CDDBC8BA" title="本节介绍与使用捕获的Workspace Manager事件的应用程序开发人员相关的高级队列对象和技术。">AQ操作和工作区管理器事件</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADWSM99195"></a><a id="ADWSM99194"></a><div class="props_rev_3"><a id="GUID-19EB7A56-8914-4265-AFAD-448CF9F78AC8" name="GUID-19EB7A56-8914-4265-AFAD-448CF9F78AC8"></a><h4 id="ADWSM-GUID-19EB7A56-8914-4265-AFAD-448CF9F78AC8" class="sect4"><span class="enumeration_section">2.4.4</span>听取事件</h4>
                  <div>
                     <p>listen调用是一个阻塞调用，可用于等待队列或订阅列表上的事件。如果listen返回成功，则必须使用dequeue来检索事件。</p>
                     <p><a href="workspace-manager-events.html#GUID-19EB7A56-8914-4265-AFAD-448CF9F78AC8__i1021314">示例2-4</a>侦听事件队列上的事件。
                     </p>
                     <div class="example" id="GUID-19EB7A56-8914-4265-AFAD-448CF9F78AC8__i1021314">
                        <p class="titleinexample">示例2-4收听工作区管理器事件</p><pre class="oac_no_warn" dir="ltr">rem ================================================= ============= rem以下示例显示了应用程序如何侦听rem事件。必须执行显式出列才能获得实际的rem事件参数。用户SCOTT必须具有足够的权限rem，如“访问控制”部分所述。rem ================================================= ============= connect scott  - 出现提示时输入密码。在DECLARE qlist上设置serveroutput dbms_aq.aq $ _agent_list_t; agent_w_msg sys.aq $ _agent; listen_timeout异常; pragma exception_init（listen_timeout，-25254）; BEGIN qlist（0）：= sys.aq $ _agent（'MERGE_LISTENER'，'WMSYS.WM $ EVENT_QUEUE'，NULL）; dbms_output.put_line（'侦听事件队列。“）; BEGIN DBMS_AQ.LISTEN（agent_list =&gt; qlist，wait =&gt; 30，agent =&gt; agent_w_msg）; dbms_output.put_line（agent_w_msg.name）; / *当listen_timeout THEN为null时，事件可以在此处出列以获取事件数据* / EXCEPTION;结束;结束; /</pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="workspace-manager-events.html#GUID-FF092E6F-784F-4D5E-AA64-E9A0CDDBC8BA" title="本节介绍与使用捕获的Workspace Manager事件的应用程序开发人员相关的高级队列对象和技术。">AQ操作和工作区管理器事件</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADWSM99197"></a><a id="ADWSM99196"></a><div class="props_rev_3"><a id="GUID-C598F17B-DBC2-4F6F-8951-0D96BF226453" name="GUID-C598F17B-DBC2-4F6F-8951-0D96BF226453"></a><h4 id="ADWSM-GUID-C598F17B-DBC2-4F6F-8951-0D96BF226453" class="sect4"><span class="enumeration_section">2.4.5</span>异步通知</h4>
                  <div>
                     <p>异步通知允许客户端接收感兴趣事件的通知。客户端可以使用它来监视多个订阅。客户端不必连接到数据库即可接收有关其订阅的通知。</p>
                     <p>如果应用程序使用回调注册Workspace Manager事件的异步通知，则以下<code class="codeph">init.ora</code>参数的最小值应为：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">aq_tm_processes</code> = 1</p>
                        </li>
                        <li>
                           <p><code class="codeph">job_queue_processes</code> = 2</p>
                        </li>
                     </ul>
                     <p><a href="workspace-manager-events.html#GUID-C598F17B-DBC2-4F6F-8951-0D96BF226453__I1021329">例2-5</a>注册了一个回调以接收事件的异步通知。
                     </p>
                     <div class="example" id="GUID-C598F17B-DBC2-4F6F-8951-0D96BF226453__I1021329">
                        <p class="titleinexample">例2-5接收事件的异步通知</p><pre class="oac_no_warn" dir="ltr">rem ================================================= ==== rem如何代表订阅者注册回调到事件rem队列的示例。订阅者已在上一节中进行了重新定义。每当满足订户的rem规则的事件发生时，AQ框架就会调用回调。rem的以下init.ora参数的最小值应设置如下。rem aq_tm_processes = 1 rem job_queue_processes = 2 rem用户SCOTT必须具有足够的权限。rem ================================================= ========== CONNECT scott  - 出现提示时输入密码。CREATE TABLE merge_log（event_name varchar2（128），workspace_name varchar2（128），parent_workspace_name varchar2（128），user_name varchar2（128））;创建或替换过程scott.event_callback（context RAW，reginfo sys.aq $ _reg_info，descr sys.aq $ _descriptor，payload VARCHAR2，payloadl NUMBER）AS deq_msgid RAW（16）; dopt dbms_aq.dequeue_options_t; mprop dbms_aq.message_properties_t;事件WMSYS.WM $ EVENT_TYPE; no_messages例外; pragma exception_init（no_messages，-25228）; BEGIN dopt.consumer_name：='MERGE_LISTENER'; dopt.wait：= 30; dopt.msgid：= descr.msg_id; dbms_aq.dequeue（queue_name =&gt;'WMSYS.WM $ EVENT_QUEUE'，dequeue_options =&gt; dopt，message_properties =&gt; mprop，payload =&gt; event，msgid =&gt; deq_msgid）; INSERT INTO merge_log VALUES（event.event_name，event.workspace_name，event.parent_workspace_name，event.user_name）; / *注意：如果“aux_params”属性中存储了其他参数，可以使用event.aux_params（1）.name，event.aux_params（1）.value，event.aux_params（2）.name ...等进行访问。上。当aux_params不为null时，可以使用event.aux_params.count访问参数的数量。*/ 结束; / grant将scott.event_callback执行到public; rem ================================================= = rem注册事件rem的回调队列名称和用户名必须在注册回调时指定rem ========================= ========================= DECLARE reginfo1 sys.aq $ _reg_info; reginfolist sys.aq $ _reg_info_list; BEGIN reginfo1：= sys.aq $ _reg_info（'WMSYS.WM $ EVENT_QUEUE：MERGE_LISTENER'，1，'plsql：//scott.event_callback？PR = 1' ，HEXTORAW（ 'FF'））; reginfolist：= sys.aq $ _reg_info_list（reginfo1）; sys.dbms_aq.register（reginfolist，1）;承诺;结束; /</pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="workspace-manager-events.html#GUID-FF092E6F-784F-4D5E-AA64-E9A0CDDBC8BA" title="本节介绍与使用捕获的Workspace Manager事件的应用程序开发人员相关的高级队列对象和技术。">AQ操作和工作区管理器事件</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>